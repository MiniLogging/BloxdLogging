/*! For license information please see gknhd.32.5ce5dec3.chunk.js.LICENSE.txt */
(self["3b8bnhi4gzj"]=self["3b8bnhi4gzj"]||[]).push([[32],{13762:(Z,h,V)=>{"use strict";var v=V(13768),A=V(13773),H=V(13778);V.g.__TYPEDARRAY_POOL||(V.g.__TYPEDARRAY_POOL={UINT8:A([32,0]),UINT16:A([32,0]),UINT32:A([32,0]),INT8:A([32,0]),INT16:A([32,0]),INT32:A([32,0]),FLOAT:A([32,0]),DOUBLE:A([32,0]),DATA:A([32,0]),UINT8C:A([32,0]),BUFFER:A([32,0])});var K="undefined"!==typeof Uint8ClampedArray,d=V.g.__TYPEDARRAY_POOL;d.UINT8C||(d.UINT8C=A([32,0])),d.BUFFER||(d.BUFFER=A([32,0]));var a=d.DATA,n=d.BUFFER;function x(Z){if(Z){var h=Z.length||Z.byteLength,V=v.log2(h);a[V].push(Z)}}function N(Z){Z=v.nextPow2(Z);var h=v.log2(Z),V=a[h];return V.length>0?V.pop():new ArrayBuffer(Z)}function D(Z){return new Uint8Array(N(Z),0,Z)}function k(Z){return new Uint16Array(N(2*Z),0,Z)}function u(Z){return new Uint32Array(N(4*Z),0,Z)}function F(Z){return new Int8Array(N(Z),0,Z)}function b(Z){return new Int16Array(N(2*Z),0,Z)}function o(Z){return new Int32Array(N(4*Z),0,Z)}function q(Z){return new Float32Array(N(4*Z),0,Z)}function X(Z){return new Float64Array(N(8*Z),0,Z)}function E(Z){return K?new Uint8ClampedArray(N(Z),0,Z):D(Z)}function j(Z){return new DataView(N(Z),0,Z)}h.free=function(Z){if(H(Z))n[v.log2(Z.length)].push(Z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Z)&&(Z=Z.buffer),!Z)return;var h=Z.length||Z.byteLength,V=0|v.log2(h);a[V].push(Z)}},h.freeUint8=h.freeUint16=h.freeUint32=h.freeInt8=h.freeInt16=h.freeInt32=h.freeFloat32=h.freeFloat=h.freeFloat64=h.freeDouble=h.freeUint8Clamped=h.freeDataView=function(Z){x(Z.buffer)},h.freeArrayBuffer=x,h.freeBuffer=function(Z){n[v.log2(Z.length)].push(Z)},h.malloc=function(Z,h){if(void 0===h||"arraybuffer"===h)return N(Z);switch(h){case"uint8":return D(Z);case"uint16":return k(Z);case"uint32":return u(Z);case"int8":return F(Z);case"int16":return b(Z);case"int32":return o(Z);case"float":case"float32":return q(Z);case"double":case"float64":return X(Z);case"uint8_clamped":return E(Z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return j(Z);default:return null}return null},h.mallocArrayBuffer=N,h.mallocUint8=D,h.mallocUint16=k,h.mallocUint32=u,h.mallocInt8=F,h.mallocInt16=b,h.mallocInt32=o,h.mallocFloat32=h.mallocFloat=q,h.mallocFloat64=h.mallocDouble=X,h.mallocUint8Clamped=E,h.mallocDataView=j,h.clearCache=function(){for(var Z=0;Z<32;++Z)d.UINT8[Z].length=0,d.UINT16[Z].length=0,d.UINT32[Z].length=0,d.INT8[Z].length=0,d.INT16[Z].length=0,d.INT32[Z].length=0,d.FLOAT[Z].length=0,d.DOUBLE[Z].length=0,d.UINT8C[Z].length=0,a[Z].length=0,n[Z].length=0}},13870:(Z,h,V)=>{Z.exports=A;var v=V(12545);function A(Z,h){if(!(this instanceof A))return new A(Z,h);var V=v.create();v.add(V,Z,h),this.base=v.min(v.create(),Z,V),this.kx=v.clone(h),this.max=v.max(v.create(),Z,V),this.mag=v.length(this.kx)}var H=A.prototype;H.width=function(){return this.kx[0]},H.height=function(){return this.kx[1]},H.depth=function(){return this.kx[2]},H.x0=function(){return this.base[0]},H.y0=function(){return this.base[1]},H.z0=function(){return this.base[2]},H.x1=function(){return this.max[0]},H.y1=function(){return this.max[1]},H.z1=function(){return this.max[2]},H.translate=function(Z){return v.add(this.max,this.max,Z),v.add(this.base,this.base,Z),this},H.setPosition=function(Z){return v.add(this.max,Z,this.kx),v.i(this.base,Z),this},H.expand=function(Z){var h=v.create(),V=v.create();return v.max(h,Z.max,this.max),v.min(V,Z.base,this.base),v.rh(h,h,V),new A(V,h)},H.intersects=function(Z){return!(Z.base[0]>this.max[0])&&(!(Z.base[1]>this.max[1])&&(!(Z.base[2]>this.max[2])&&(!(Z.max[0]<this.base[0])&&(!(Z.max[1]<this.base[1])&&!(Z.max[2]<this.base[2])))))},H.touches=function(Z){var h=this.union(Z);return null!==h&&(0==h.width()||0==h.height()||0==h.depth())},H.union=function(Z){if(!this.intersects(Z))return null;var h=Math.max(Z.base[0],this.base[0]),V=Math.max(Z.base[1],this.base[1]),v=Math.max(Z.base[2],this.base[2]);return new A([h,V,v],[Math.min(Z.max[0],this.max[0])-h,Math.min(Z.max[1],this.max[1])-V,Math.min(Z.max[2],this.max[2])-v])}},13768:(Z,h)=>{"use strict";function V(Z){var h=32;return(Z&=-Z)&&h--,65535&Z&&(h-=16),16711935&Z&&(h-=8),252645135&Z&&(h-=4),858993459&Z&&(h-=2),1431655765&Z&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(Z){return(Z>0)-(Z<0)},h.abs=function(Z){var h=Z>>31;return(Z^h)-h},h.min=function(Z,h){return h^(Z^h)&-(Z<h)},h.max=function(Z,h){return Z^(Z^h)&-(Z<h)},h.isPow2=function(Z){return!(Z&Z-1)&&!!Z},h.log2=function(Z){var h,V;return h=(Z>65535)<<4,h|=V=((Z>>>=h)>255)<<3,h|=V=((Z>>>=V)>15)<<2,(h|=V=((Z>>>=V)>3)<<1)|(Z>>>=V)>>1},h.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},h.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},h.countTrailingZeros=V,h.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},h.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},h.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var v=new Array(256);!function(Z){for(var h=0;h<256;++h){var V=h,v=h,A=7;for(V>>>=1;V;V>>>=1)v<<=1,v|=1&V,--A;Z[h]=v<<A&255}}(v),h.reverse=function(Z){return v[255&Z]<<24|v[Z>>>8&255]<<16|v[Z>>>16&255]<<8|v[Z>>>24&255]},h.interleave2=function(Z,h){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(Z,h){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>h&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},h.interleave3=function(Z,h,V){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<2},h.deinterleave3=function(Z,h){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>h&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},h.nextCombination=function(Z){var h=Z|Z-1;return h+1|(~h&-~h)-1>>>V(Z)+1}},13759:(Z,h,V)=>{"use strict";Z.exports=function(Z,h,V){switch(arguments.length){case 1:return v=[],n(A=Z,A,x,!0),v;case 2:return"function"===typeof h?n(Z,Z,h,!0):function(Z,h){return v=[],n(Z,h,x,!1),v}(Z,h);case 3:return n(Z,h,V,!1);default:throw new Error("box-intersect: Invalid arguments")}var A};var v,A=V(13762),H=V(13784),K=V(13800);function d(Z,h){for(var V=0;V<Z;++V)if(!(h[V]<=h[V+Z]))return!0;return!1}function a(Z,h,V,v){for(var A=0,H=0,K=0,a=Z.length;K<a;++K){var n=Z[K];if(!d(h,n)){for(var x=0;x<2*h;++x)V[A++]=n[x];v[H++]=K}}return H}function n(Z,h,V,v){var d=Z.length,n=h.length;if(!(d<=0||n<=0)){var x=Z[0].length>>>1;if(!(x<=0)){var N,D=A.mallocDouble(2*x*d),k=A.mallocInt32(d);if((d=a(Z,x,D,k))>0){if(1===x&&v)H.init(d),N=H.sweepComplete(x,V,0,d,D,k,0,d,D,k);else{var u=A.mallocDouble(2*x*n),F=A.mallocInt32(n);(n=a(h,x,u,F))>0&&(H.init(d+n),N=1===x?H.sweepBipartite(x,V,0,d,D,k,0,n,u,F):K(x,V,v,d,D,k,n,u,F),A.free(u),A.free(F))}A.free(D),A.free(k)}return N}}}function x(Z,h){v.push([Z,h])}},13806:(Z,h)=>{"use strict";var V="d",v="ax",A="fp",H="es",K="rs",d="re",a="rb",n="bs",x="be",N="bb",D=[V,v,"vv",K,d,a,"ri",n,x,N,"bi"];function k(Z){var h="bruteForce"+(Z?"Full":"Partial"),v=[],K=D.slice();Z||K.splice(3,0,A);var d=["function "+h+"("+K.join()+"){"];function a(h,A){var K=function(Z,h,v){var A="bruteForce"+(Z?"Red":"Blue")+(h?"Flip":"")+(v?"Full":""),K=["function ",A,"(",D.join(),"){","var ",H,"=2*",V,";"],d="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",a="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(v?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Z?K.push(d,"Q",":",a):K.push(a,"Q",":",d),v?K.push("if(y1<x0||x1<y0)continue;"):h?K.push("if(y0<=x0||x1<y0)continue;"):K.push("if(y0<x0||x1<y0)continue;"),K.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),h?K.push("yi,xi"):K.push("xi,yi"),K.push(");if(rv!==void 0)return rv;}}}"),{name:A,code:K.join("")}}(h,A,Z);v.push(K.code),d.push("return "+K.name+"("+D.join()+");")}d.push("if(re-rs>be-bs){"),Z?(a(!0,!1),d.push("}else{"),a(!1,!1)):(d.push("if(fp){"),a(!0,!0),d.push("}else{"),a(!0,!1),d.push("}}else{if(fp){"),a(!1,!0),d.push("}else{"),a(!1,!1),d.push("}")),d.push("}}return "+h);var n=v.join("")+d.join("");return new Function(n)()}h.partial=k(!1),h.full=k(!0)},13800:(Z,h,V)=>{"use strict";Z.exports=function(Z,h,V,H,x,r,L,y,W){!function(Z,h){var V=8*A.log2(h+1)*(Z+1)|0,H=A.nextPow2(E*V);P.length<H&&(v.free(P),P=v.mallocInt32(H));var K=A.nextPow2(j*V);C.length<K&&(v.free(C),C=v.mallocDouble(K))}(Z,H+L);var z,m=0,g=2*Z;l(m++,0,0,H,0,L,V?16:0,-1/0,1/0),V||l(m++,0,0,L,0,H,1,-1/0,1/0);for(;m>0;){var I=(m-=1)*E,e=P[I],U=P[I+1],R=P[I+2],Q=P[I+3],w=P[I+4],T=P[I+5],t=m*j,c=C[t],i=C[t+1],M=1&T,O=!!(16&T),s=x,J=r,f=y,p=W;if(M&&(s=y,J=W,f=x,p=r),!(2&T&&U>=(R=b(Z,e,U,R,s,J,i)))&&!(4&T&&(U=o(Z,e,U,R,s,J,c))>=R)){var Y=R-U,G=w-Q;if(O){if(Z*Y*(Y+G)<k){if(void 0!==(z=a.scanComplete(Z,e,h,U,R,s,J,Q,w,f,p)))return z;continue}}else{if(Z*Math.min(Y,G)<N){if(void 0!==(z=K(Z,e,h,M,U,R,s,J,Q,w,f,p)))return z;continue}if(Z*Y*G<D){if(void 0!==(z=a.scanBipartite(Z,e,h,M,U,R,s,J,Q,w,f,p)))return z;continue}}var ZZ=u(Z,e,U,R,s,J,c,i);if(U<ZZ)if(Z*(ZZ-U)<N){if(void 0!==(z=d(Z,e+1,h,U,ZZ,s,J,Q,w,f,p)))return z}else if(e===Z-2){if(void 0!==(z=M?a.sweepBipartite(Z,h,Q,w,f,p,U,ZZ,s,J):a.sweepBipartite(Z,h,U,ZZ,s,J,Q,w,f,p)))return z}else l(m++,e+1,U,ZZ,Q,w,M,-1/0,1/0),l(m++,e+1,Q,w,U,ZZ,1^M,-1/0,1/0);if(ZZ<R){var hZ=n(Z,e,Q,w,f,p),VZ=f[g*hZ+e],vZ=F(Z,e,hZ,w,f,p,VZ);if(vZ<w&&l(m++,e,ZZ,R,vZ,w,(4|M)+(O?16:0),VZ,i),Q<hZ&&l(m++,e,ZZ,R,Q,hZ,(2|M)+(O?16:0),c,VZ),hZ+1===vZ){if(void 0!==(z=O?S(Z,e,h,ZZ,R,s,J,hZ,f,p[hZ]):B(Z,e,h,M,ZZ,R,s,J,hZ,f,p[hZ])))return z}else if(hZ<vZ){var AZ;if(O){if(ZZ<(AZ=q(Z,e,ZZ,R,s,J,VZ))){var HZ=F(Z,e,ZZ,AZ,s,J,VZ);if(e===Z-2){if(ZZ<HZ&&void 0!==(z=a.sweepComplete(Z,h,ZZ,HZ,s,J,hZ,vZ,f,p)))return z;if(HZ<AZ&&void 0!==(z=a.sweepBipartite(Z,h,HZ,AZ,s,J,hZ,vZ,f,p)))return z}else ZZ<HZ&&l(m++,e+1,ZZ,HZ,hZ,vZ,16,-1/0,1/0),HZ<AZ&&(l(m++,e+1,HZ,AZ,hZ,vZ,0,-1/0,1/0),l(m++,e+1,hZ,vZ,HZ,AZ,1,-1/0,1/0))}}else ZZ<(AZ=M?X(Z,e,ZZ,R,s,J,VZ):q(Z,e,ZZ,R,s,J,VZ))&&(e===Z-2?z=M?a.sweepBipartite(Z,h,hZ,vZ,f,p,ZZ,AZ,s,J):a.sweepBipartite(Z,h,ZZ,AZ,s,J,hZ,vZ,f,p):(l(m++,e+1,ZZ,AZ,hZ,vZ,M,-1/0,1/0),l(m++,e+1,hZ,vZ,ZZ,AZ,1^M,-1/0,1/0)))}}}}};var v=V(13762),A=V(13768),H=V(13806),K=H.partial,d=H.full,a=V(13784),n=V(13814),x=V(13822),N=128,D=1<<22,k=1<<22,u=x("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),F=x("lo===p0",["p0"]),b=x("lo<p0",["p0"]),o=x("hi<=p0",["p0"]),q=x("lo<=p0&&p0<=hi",["p0"]),X=x("lo<p0&&p0<=hi",["p0"]),E=6,j=2,P=v.mallocInt32(1024),C=v.mallocDouble(1024);function l(Z,h,V,v,A,H,K,d,a){var n=E*Z;P[n]=h,P[n+1]=V,P[n+2]=v,P[n+3]=A,P[n+4]=H,P[n+5]=K;var x=j*Z;C[x]=d,C[x+1]=a}function B(Z,h,V,v,A,H,K,d,a,n,x){var N=2*Z,D=a*N,k=n[D+h];Z:for(var u=A,F=A*N;u<H;++u,F+=N){var b=K[F+h],o=K[F+h+Z];if(!(k<b||o<k)&&(!v||k!==b)){for(var q,X=d[u],E=h+1;E<Z;++E){b=K[F+E],o=K[F+E+Z];var j=n[D+E],P=n[D+E+Z];if(o<j||P<b)continue Z}if(void 0!==(q=v?V(x,X):V(X,x)))return q}}}function S(Z,h,V,v,A,H,K,d,a,n){var x=2*Z,N=d*x,D=a[N+h];Z:for(var k=v,u=v*x;k<A;++k,u+=x){var F=K[k];if(F!==n){var b=H[u+h],o=H[u+h+Z];if(!(D<b||o<D)){for(var q=h+1;q<Z;++q){b=H[u+q],o=H[u+q+Z];var X=a[N+q],E=a[N+q+Z];if(o<X||E<b)continue Z}var j=V(F,n);if(void 0!==j)return j}}}}},13814:(Z,h,V)=>{"use strict";Z.exports=function(Z,h,V,K,d,a){if(K<=V+1)return V;var n=V,x=K,N=K+V>>>1,D=2*Z,k=N,u=d[D*N+h];for(;n<x;){if(x-n<A){H(Z,h,n,x,d,a),u=d[D*N+h];break}var F=x-n,b=Math.random()*F+n|0,o=d[D*b+h],q=Math.random()*F+n|0,X=d[D*q+h],E=Math.random()*F+n|0,j=d[D*E+h];o<=X?j>=X?(k=q,u=X):o>=j?(k=b,u=o):(k=E,u=j):X>=j?(k=q,u=X):j>=o?(k=b,u=o):(k=E,u=j);for(var P=D*(x-1),C=D*k,l=0;l<D;++l,++P,++C){var B=d[P];d[P]=d[C],d[C]=B}var S=a[x-1];a[x-1]=a[k],a[k]=S;for(P=D*(x-1),C=D*(k=v(Z,h,n,x-1,d,a,u)),l=0;l<D;++l,++P,++C){B=d[P];d[P]=d[C],d[C]=B}S=a[x-1];if(a[x-1]=a[k],a[k]=S,N<k){for(x=k-1;n<x&&d[D*(x-1)+h]===u;)x-=1;x+=1}else{if(!(k<N))break;for(n=k+1;n<x&&d[D*n+h]===u;)n+=1}}return v(Z,h,V,N,d,a,d[D*N+h])};var v=V(13822)("lo<p0",["p0"]),A=8;function H(Z,h,V,v,A,H){for(var K=2*Z,d=K*(V+1)+h,a=V+1;a<v;++a,d+=K)for(var n=A[d],x=a,N=K*(a-1);x>V&&A[N+h]>n;--x,N-=K){for(var D=N,k=N+K,u=0;u<K;++u,++D,++k){var F=A[D];A[D]=A[k],A[k]=F}var b=H[x];H[x]=H[x-1],H[x-1]=b}}},13822:Z=>{"use strict";Z.exports=function(Z,V){var v="abcdef".split("").concat(V),A=[];Z.indexOf("lo")>=0&&A.push("lo=e[k+n]");Z.indexOf("hi")>=0&&A.push("hi=e[k+o]");return v.push(h.replace("_",A.join()).replace("$",Z)),Function.apply(void 0,v)};var h="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13793:Z=>{"use strict";Z.exports=function(Z,v){v<=4*h?V(0,v-1,Z):n(0,v-1,Z)};var h=32;function V(Z,h,V){for(var v=2*(Z+1),A=Z+1;A<=h;++A){for(var H=V[v++],K=V[v++],d=A,a=v-2;d-- >Z;){var n=V[a-2],x=V[a-1];if(n<H)break;if(n===H&&x<K)break;V[a]=n,V[a+1]=x,a-=2}V[a]=H,V[a+1]=K}}function v(Z,h,V){h*=2;var v=V[Z*=2],A=V[Z+1];V[Z]=V[h],V[Z+1]=V[h+1],V[h]=v,V[h+1]=A}function A(Z,h,V){h*=2,V[Z*=2]=V[h],V[Z+1]=V[h+1]}function H(Z,h,V,v){h*=2,V*=2;var A=v[Z*=2],H=v[Z+1];v[Z]=v[h],v[Z+1]=v[h+1],v[h]=v[V],v[h+1]=v[V+1],v[V]=A,v[V+1]=H}function K(Z,h,V,v,A){h*=2,A[Z*=2]=A[h],A[h]=V,A[Z+1]=A[h+1],A[h+1]=v}function d(Z,h,V){h*=2;var v=V[Z*=2],A=V[h];return!(v<A)&&(v!==A||V[Z+1]>V[h+1])}function a(Z,h,V,v){var A=v[Z*=2];return A<h||A===h&&v[Z+1]<V}function n(Z,x,N){var D=(x-Z+1)/6|0,k=Z+D,u=x-D,F=Z+x>>1,b=F-D,o=F+D,q=k,X=b,E=F,j=o,P=u,C=Z+1,l=x-1,B=0;d(q,X,N)&&(B=q,q=X,X=B),d(j,P,N)&&(B=j,j=P,P=B),d(q,E,N)&&(B=q,q=E,E=B),d(X,E,N)&&(B=X,X=E,E=B),d(q,j,N)&&(B=q,q=j,j=B),d(E,j,N)&&(B=E,E=j,j=B),d(X,P,N)&&(B=X,X=P,P=B),d(X,E,N)&&(B=X,X=E,E=B),d(j,P,N)&&(B=j,j=P,P=B);for(var S=N[2*X],r=N[2*X+1],L=N[2*j],y=N[2*j+1],W=2*q,z=2*E,m=2*P,g=2*k,I=2*F,e=2*u,U=0;U<2;++U){var R=N[W+U],Q=N[z+U],w=N[m+U];N[g+U]=R,N[I+U]=Q,N[e+U]=w}A(b,Z,N),A(o,x,N);for(var T=C;T<=l;++T)if(a(T,S,r,N))T!==C&&v(T,C,N),++C;else if(!a(T,L,y,N))for(;;){if(a(l,L,y,N)){a(l,S,r,N)?(H(T,C,l,N),++C,--l):(v(T,l,N),--l);break}if(--l<T)break}K(Z,C-1,S,r,N),K(x,l+1,L,y,N),C-2-Z<=h?V(Z,C-2,N):n(Z,C-2,N),x-(l+2)<=h?V(l+2,x,N):n(l+2,x,N),l-C<=h?V(C,l,N):n(C,l,N)}},13784:(Z,h,V)=>{"use strict";Z.exports={init:function(Z){var h=A.nextPow2(Z);a.length<h&&(v.free(a),a=v.mallocInt32(h));n.length<h&&(v.free(n),n=v.mallocInt32(h));x.length<h&&(v.free(x),x=v.mallocInt32(h));N.length<h&&(v.free(N),N=v.mallocInt32(h));D.length<h&&(v.free(D),D=v.mallocInt32(h));k.length<h&&(v.free(k),k=v.mallocInt32(h));var V=8*h;u.length<V&&(v.free(u),u=v.mallocDouble(V))},sweepBipartite:function(Z,h,V,v,A,d,D,k,o,q){for(var X=0,E=2*Z,j=Z-1,P=E-1,C=V;C<v;++C){var l=d[C],B=E*C;u[X++]=A[B+j],u[X++]=-(l+1),u[X++]=A[B+P],u[X++]=l}for(C=D;C<k;++C){l=q[C]+K;var S=E*C;u[X++]=o[S+j],u[X++]=-l,u[X++]=o[S+P],u[X++]=l}var r=X>>>1;H(u,r);var L=0,y=0;for(C=0;C<r;++C){var W=0|u[2*C+1];if(W>=K)F(x,N,y--,W=W-K|0);else if(W>=0)F(a,n,L--,W);else if(W<=-K){W=-W-K|0;for(var z=0;z<L;++z){if(void 0!==(m=h(a[z],W)))return m}b(x,N,y++,W)}else{W=-W-1|0;for(z=0;z<y;++z){var m;if(void 0!==(m=h(W,x[z])))return m}b(a,n,L++,W)}}},sweepComplete:function(Z,h,V,v,A,K,d,o,q,X){for(var E=0,j=2*Z,P=Z-1,C=j-1,l=V;l<v;++l){var B=K[l]+1<<1,S=j*l;u[E++]=A[S+P],u[E++]=-B,u[E++]=A[S+C],u[E++]=B}for(l=d;l<o;++l){B=X[l]+1<<1;var r=j*l;u[E++]=q[r+P],u[E++]=1|-B,u[E++]=q[r+C],u[E++]=1|B}var L=E>>>1;H(u,L);var y=0,W=0,z=0;for(l=0;l<L;++l){var m=0|u[2*l+1],g=1&m;if(l<L-1&&m>>1===u[2*l+3]>>1&&(g=2,l+=1),m<0){for(var I=-(m>>1)-1,e=0;e<z;++e){if(void 0!==(U=h(D[e],I)))return U}if(0!==g)for(e=0;e<y;++e){if(void 0!==(U=h(a[e],I)))return U}if(1!==g)for(e=0;e<W;++e){var U;if(void 0!==(U=h(x[e],I)))return U}0===g?b(a,n,y++,I):1===g?b(x,N,W++,I):2===g&&b(D,k,z++,I)}else{I=(m>>1)-1;0===g?F(a,n,y--,I):1===g?F(x,N,W--,I):2===g&&F(D,k,z--,I)}}},scanBipartite:function(Z,h,V,v,A,d,x,N,D,k,o,q){var X=0,E=2*Z,j=h,P=h+Z,C=1,l=1;v?l=K:C=K;for(var B=A;B<d;++B){var S=B+C,r=E*B;u[X++]=x[r+j],u[X++]=-S,u[X++]=x[r+P],u[X++]=S}for(B=D;B<k;++B){S=B+l;var L=E*B;u[X++]=o[L+j],u[X++]=-S}var y=X>>>1;H(u,y);var W=0;for(B=0;B<y;++B){var z=0|u[2*B+1];if(z<0){var m=!1;if((S=-z)>=K?(m=!v,S-=K):(m=!!v,S-=1),m)b(a,n,W++,S);else{var g=q[S],I=E*S,e=o[I+h+1],U=o[I+h+1+Z];Z:for(var R=0;R<W;++R){var Q=a[R],w=E*Q;if(!(U<x[w+h+1]||x[w+h+1+Z]<e)){for(var T=h+2;T<Z;++T)if(o[I+T+Z]<x[w+T]||x[w+T+Z]<o[I+T])continue Z;var t,c=N[Q];if(void 0!==(t=v?V(g,c):V(c,g)))return t}}}}else F(a,n,W--,z-C)}},scanComplete:function(Z,h,V,v,A,d,n,x,N,D,k){for(var F=0,b=2*Z,o=h,q=h+Z,X=v;X<A;++X){var E=X+K,j=b*X;u[F++]=d[j+o],u[F++]=-E,u[F++]=d[j+q],u[F++]=E}for(X=x;X<N;++X){E=X+1;var P=b*X;u[F++]=D[P+o],u[F++]=-E}var C=F>>>1;H(u,C);var l=0;for(X=0;X<C;++X){var B=0|u[2*X+1];if(B<0){if((E=-B)>=K)a[l++]=E-K;else{var S=k[E-=1],r=b*E,L=D[r+h+1],y=D[r+h+1+Z];Z:for(var W=0;W<l;++W){var z=a[W],m=n[z];if(m===S)break;var g=b*z;if(!(y<d[g+h+1]||d[g+h+1+Z]<L)){for(var I=h+2;I<Z;++I)if(D[r+I+Z]<d[g+I]||d[g+I+Z]<D[r+I])continue Z;var e=V(m,S);if(void 0!==e)return e}}}}else{for(E=B-K,W=l-1;W>=0;--W)if(a[W]===E){for(I=W+1;I<l;++I)a[I-1]=a[I];break}--l}}}};var v=V(13762),A=V(13768),H=V(13793),K=1<<28,d=1024,a=v.mallocInt32(d),n=v.mallocInt32(d),x=v.mallocInt32(d),N=v.mallocInt32(d),D=v.mallocInt32(d),k=v.mallocInt32(d),u=v.mallocDouble(8192);function F(Z,h,V,v){var A=h[v],H=Z[V-1];Z[A]=H,h[H]=A}function b(Z,h,V,v){Z[V]=v,h[v]=V}},13773:Z=>{"use strict";function h(Z,V,v){var A=0|Z[v];if(A<=0)return[];var H,K=new Array(A);if(v===Z.length-1)for(H=0;H<A;++H)K[H]=V;else for(H=0;H<A;++H)K[H]=h(Z,V,v+1);return K}Z.exports=function(Z,V){switch("undefined"===typeof V&&(V=0),typeof Z){case"number":if(Z>0)return function(Z,h){var V,v;for(V=new Array(Z),v=0;v<Z;++v)V[v]=h;return V}(0|Z,V);break;case"object":if("number"===typeof Z.length)return h(Z,V,0)}return[]}},13717:(Z,h,V)=>{Z.exports=function(){var Z=this;this.components={},this.comps=this.components;var h=this.components,V=1,A={},H=[],K=[],d={timeout:!1,removals:[],multiComps:[]};function a(Z,V){var v=h[V],H=A[V],K=H.hash[Z];K&&(H.remove(Z),v.Kh&&(v.multi?(K.forEach((h=>{h&&v.Kh(Z,h)})),K.length=0):v.Kh(Z,K)),d.removals.push(H),n())}function n(){d.timeout||(d.timeout=!0,setTimeout(x,1))}function x(){d.timeout=!1,N()}function N(){d.multiComps.length&&function(Z){for(var h=0;h<Z.length;h++){var{entID:V,data:v}=Z[h],A=v.hash[V];if(A){for(var H=0;H<A.length;H++)A[H]||(A.splice(H,1),H--);0===A.length&&(v.remove(V),d.removals.push(v))}}Z.length=0}(d.multiComps),d.removals.length&&function(Z){for(var h=0;h<Z.length;h++){Z[h].flush()}Z.length=0}(d.removals)}this.mN=A,this._systems=H,this._renderSystems=K,this.bx=function(h){var v=V++;return Array.isArray(h)&&h.forEach((h=>Z.Ja(v,h))),v},this.deleteEntity=function(h){return Object.keys(A).forEach((Z=>{A[Z].hash[h]&&a(h,Z)})),Z},this.mx=function(Z){if(!Z)throw new Error("Missing component definition");var V=Z.name;if(!V)throw new Error("Component definition must have a name property.");if("string"!==typeof V)throw new Error("Component name must be a string.");if(""===V)throw new Error("Component name must be a non-empty string.");if(A[V])throw new Error(`Component ${V} already exists.`);var d={};return d.name=V,d.multi=!!Z.multi,d.order=isNaN(Z.order)?99:Z.order,d.stateConstructor=Z.stateConstructor||null,d.state=Z.state||{},d.Id=Z.Id||null,d.Kh=Z.Kh||null,d.system=Z.system||null,d.td=Z.td||null,h[V]=d,A[V]=new v,A[V]._pendingMultiCleanup=!1,A[V]._multiCleanupIDs=d.multi?[]:null,d.system&&(H.push(V),H.sort(((Z,V)=>h[Z].order-h[V].order))),d.td&&(K.push(V),K.sort(((Z,V)=>h[Z].order-h[V].order))),V},this.overwriteComponent=function(Z,V){var v=h[Z];if(!v)throw new Error(`Unknown component: ${Z}`);if(!V)throw new Error("Missing component definition");if(v.name!==V.name)throw new Error("Overwriting component must use the same name property.");var d={};d.name=Z,d.multi=!!V.multi,d.order=isNaN(V.order)?99:V.order,d.state=V.state||{},d.Id=V.Id||null,d.Kh=V.Kh||null,d.system=V.system||null,d.td=V.td||null,h[Z]=d,A[Z]._pendingMultiCleanup=!1,A[Z]._multiCleanupIDs=d.multi?[]:null;var a=H.indexOf(Z);d.system&&a<0&&H.push(Z),!d.system&&a>=0&&H.splice(a,1),H.sort(((Z,V)=>h[Z].order-h[V].order));var n=K.indexOf(Z);d.td&&n<0&&K.push(Z),!d.td&&n>=0&&K.splice(n,1),K.sort(((Z,V)=>h[Z].order-h[V].order));var x=d.state;return this.Jn(Z).forEach((Z=>{for(var h in x)h in Z||(Z[h]=x[h]);d.Id&&d.Id(Z.wd,Z)})),Z},this.deleteComponent=function(V){var v=A[V];if(!v)throw new Error(`Unknown component: ${V}`);v.flush(),v.list.forEach((Z=>{Z&&a(Z.wd||Z[0].wd,V)}));var d=H.indexOf(V),n=K.indexOf(V);return d>-1&&H.splice(d,1),n>-1&&K.splice(n,1),A[V].dispose(),delete A[V],delete h[V],Z},this.Ja=function(Z,V,v){var H,K=h[V],d=A[V];if(!d)throw new Error(`Unknown component: ${V}.`);if(d.hash[Z]&&!K.multi)throw new Error(`Entity ${Z} already has component: ${V}.`);if(K.stateConstructor){if(!(H=new K.stateConstructor).hasOwnProperty("wd"))throw new Error(`Component ${K.name} stateConstructor type does not have property __id`)}else H=Object.assign({},{wd:Z},K.state,v);if(H.wd=Z,K.multi){var a=d.hash[Z];a||(a=[],d.add(Z,a)),a.push(H)}else d.add(Z,H);return K.Id&&K.Id(Z,H),this},this.Hn=function(Z,h){var V=A[h];if(!V)throw new Error(`Unknown component: ${h}.`);return!!V.hash[Z]},this.Ga=function(h,V){if(!A[V])throw new Error(`Unknown component: ${V}.`);return a(h,V),Z},this.getState=function(Z,h){var V=A[h];if(!V)throw new Error(`Unknown component: ${h}.`);return V.hash[Z]},this.Jn=function(Z){var h=A[Z];if(!h)throw new Error(`Unknown component: ${Z}.`);return N(),h.list},this.jk=function(Z){if(!A[Z])throw new Error(`Unknown component: ${Z}.`);var h=A[Z].hash;return Z=>h[Z]},this.lk=function(Z){if(!A[Z])throw new Error(`Unknown component: ${Z}.`);var h=A[Z].hash;return Z=>!!h[Z]},this.Pd=function(V){N();for(var v=0;v<H.length;v++){var K=H[v],d=h[K],a=A[K];d.system(V,a.list),N()}return Z},this.render=function(V){N();for(var v=0;v<K.length;v++){var H=K[v],d=h[H],a=A[H];d.td(V,a.list),N()}return Z},this.removeMultiComponent=function(V,v,H){var K=h[v],a=A[v];if(!a)throw new Error(`Unknown component: ${v}.`);if(!K.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Z,h,V,v){var A=V.hash[Z];if(A){var H=A[v];H&&(A[v]=null,h.Kh&&h.Kh(Z,H),d.multiComps.push({entID:Z,data:V}),n())}}(V,K,a,H),Z}};var v=V(13726)},13726:Z=>{function h(Z,h){var V=Z._map[h];if(delete Z.hash[h],delete Z._map[h],V===Z.list.length-1)Z.list.pop();else{var v=Z.list.pop();if(Z.list[V]=v,null===v||null===v[0]){var A=Z.list.length;for(var H in Z._map)if(Z._map[H]===A)return void(Z._map[H]=V)}else{var K=v.wd||v[0].wd;Z._map[K]=V}}}Z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(Z,h){if("number"===typeof this._map[Z]){var V=this._map[Z];this.hash[Z]=h,this.list[V]=h}else this._map[Z]=this.list.length,this.hash[Z]=h,this.list.push(h)}remove(Z){var h=this._map[Z];this.hash[Z]=null,this.list[h]=null,this._pendingRemovals.push(Z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var Z=0;Z<this._pendingRemovals.length;Z++){var V=this._pendingRemovals[Z];null===this.hash[V]&&h(this,V)}this._pendingRemovals.length=0}}},13675:Z=>{"use strict";var h,V="object"===typeof Reflect?Reflect:null,v=function(Z,h,V){return Function.prototype.apply.call(Z,h,V)};h=V&&"function"===typeof V.ownKeys?V.ownKeys:Object.getOwnPropertySymbols?function(Z){return Object.getOwnPropertyNames(Z).concat(Object.getOwnPropertySymbols(Z))}:function(Z){return Object.getOwnPropertyNames(Z)};var A=Number.isNaN||function(Z){return Z!==Z};function H(){H.init.call(this)}Z.exports=H,Z.exports.once=function(Z,h){return new Promise((function(V,v){function A(V){Z.removeListener(h,H),v(V)}function H(){"function"===typeof Z.removeListener&&Z.removeListener("error",A),V([].slice.call(arguments))}F(Z,h,H,{once:!0}),"error"!==h&&function(Z,h,V){"function"===typeof Z.on&&F(Z,"error",h,V)}(Z,A,{once:!0})}))},H.EventEmitter=H,H.prototype._events=void 0,H.prototype._eventsCount=0,H.prototype._maxListeners=void 0;var K=10;function d(Z){if("function"!==typeof Z)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Z)}function a(Z){return void 0===Z._maxListeners?H.defaultMaxListeners:Z._maxListeners}function n(Z,h,V,v){var A,H,K,n;if(d(V),void 0===(H=Z._events)?(H=Z._events=Object.create(null),Z._eventsCount=0):(void 0!==H.newListener&&(Z.emit("newListener",h,V.listener?V.listener:V),H=Z._events),K=H[h]),void 0===K)K=H[h]=V,++Z._eventsCount;else if("function"===typeof K?K=H[h]=v?[V,K]:[K,V]:v?K.unshift(V):K.push(V),(A=a(Z))>0&&K.length>A&&!K.warned){K.warned=!0;var x=new Error("Possible EventEmitter memory leak detected. "+K.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");x.name="MaxListenersExceededWarning",x.Ah=Z,x.type=h,x.count=K.length,n=x,console&&console.warn&&console.warn(n)}return Z}function x(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function N(Z,h,V){var v={fired:!1,wrapFn:void 0,target:Z,type:h,listener:V},A=x.bind(v);return A.listener=V,v.wrapFn=A,A}function D(Z,h,V){var v=Z._events;if(void 0===v)return[];var A=v[h];return void 0===A?[]:"function"===typeof A?V?[A.listener||A]:[A]:V?function(Z){for(var h=new Array(Z.length),V=0;V<h.length;++V)h[V]=Z[V].listener||Z[V];return h}(A):u(A,A.length)}function k(Z){var h=this._events;if(void 0!==h){var V=h[Z];if("function"===typeof V)return 1;if(void 0!==V)return V.length}return 0}function u(Z,h){for(var V=new Array(h),v=0;v<h;++v)V[v]=Z[v];return V}function F(Z,h,V,v){if("function"===typeof Z.on)v.once?Z.once(h,V):Z.on(h,V);else{if("function"!==typeof Z.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Z);Z.addEventListener(h,(function A(H){v.once&&Z.removeEventListener(h,A),V(H)}))}}Object.defineProperty(H,"defaultMaxListeners",{enumerable:!0,get:function(){return K},set:function(Z){if("number"!==typeof Z||Z<0||A(Z))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Z+".");K=Z}}),H.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},H.prototype.setMaxListeners=function(Z){if("number"!==typeof Z||Z<0||A(Z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Z+".");return this._maxListeners=Z,this},H.prototype.getMaxListeners=function(){return a(this)},H.prototype.emit=function(Z){for(var h=[],V=1;V<arguments.length;V++)h.push(arguments[V]);var A="error"===Z,H=this._events;if(void 0!==H)A=A&&void 0===H.error;else if(!A)return!1;if(A){var K;if(h.length>0&&(K=h[0]),K instanceof Error)throw K;var d=new Error("Unhandled error."+(K?" ("+K.message+")":""));throw d.context=K,d}var a=H[Z];if(void 0===a)return!1;if("function"===typeof a)v(a,this,h);else{var n=a.length,x=u(a,n);for(V=0;V<n;++V)v(x[V],this,h)}return!0},H.prototype.addListener=function(Z,h){return n(this,Z,h,!1)},H.prototype.on=H.prototype.addListener,H.prototype.prependListener=function(Z,h){return n(this,Z,h,!0)},H.prototype.once=function(Z,h){return d(h),this.on(Z,N(this,Z,h)),this},H.prototype.prependOnceListener=function(Z,h){return d(h),this.prependListener(Z,N(this,Z,h)),this},H.prototype.removeListener=function(Z,h){var V,v,A,H,K;if(d(h),void 0===(v=this._events))return this;if(void 0===(V=v[Z]))return this;if(V===h||V.listener===h)0===--this._eventsCount?this._events=Object.create(null):(delete v[Z],v.removeListener&&this.emit("removeListener",Z,V.listener||h));else if("function"!==typeof V){for(A=-1,H=V.length-1;H>=0;H--)if(V[H]===h||V[H].listener===h){K=V[H].listener,A=H;break}if(A<0)return this;0===A?V.shift():function(Z,h){for(;h+1<Z.length;h++)Z[h]=Z[h+1];Z.pop()}(V,A),1===V.length&&(v[Z]=V[0]),void 0!==v.removeListener&&this.emit("removeListener",Z,K||h)}return this},H.prototype.off=H.prototype.removeListener,H.prototype.Hh=function(Z){var h,V,v;if(void 0===(V=this._events))return this;if(void 0===V.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==V[Z]&&(0===--this._eventsCount?this._events=Object.create(null):delete V[Z]),this;if(0===arguments.length){var A,H=Object.keys(V);for(v=0;v<H.length;++v)"removeListener"!==(A=H[v])&&this.Hh(A);return this.Hh("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(h=V[Z]))this.removeListener(Z,h);else if(void 0!==h)for(v=h.length-1;v>=0;v--)this.removeListener(Z,h[v]);return this},H.prototype.listeners=function(Z){return D(this,Z,!0)},H.prototype.rawListeners=function(Z){return D(this,Z,!1)},H.listenerCount=function(Z,h){return"function"===typeof Z.listenerCount?Z.listenerCount(h):k.call(Z,h)},H.prototype.listenerCount=k,H.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]}},14022:Z=>{"use strict";Z.exports=function(Z,h,V,v,A,H){var K=+h[0],d=+h[1],a=+h[2],n=+V[0],x=+V[1],N=+V[2],D=Math.sqrt(n*n+x*x+N*N);if(0===D)throw new Error("Can't raycast along a zero vector");return function(Z,h,V,v,A,H,K,d,a,n){for(var x=0,N=Math.floor,D=0|N(h),k=0|N(V),u=0|N(v),F=A>0?1:-1,b=H>0?1:-1,o=K>0?1:-1,q=Math.abs(1/A),X=Math.abs(1/H),E=Math.abs(1/K),j=q<1/0?q*(F>0?D+1-h:h-D):1/0,P=X<1/0?X*(b>0?k+1-V:V-k):1/0,C=E<1/0?E*(o>0?u+1-v:v-u):1/0,l=-1;x<=d;){var B=Z(D,k,u);if(B)return a&&(a[0]=h+x*A,a[1]=V+x*H,a[2]=v+x*K),n&&(n[0]=n[1]=n[2]=0,0===l&&(n[0]=-F),1===l&&(n[1]=-b),2===l&&(n[2]=-o)),B;j<P?j<C?(D+=F,x=j,j+=q,l=0):(u+=o,x=C,C+=E,l=2):P<C?(k+=b,x=P,P+=X,l=1):(u+=o,x=C,C+=E,l=2)}return a&&(a[0]=h+x*A,a[1]=V+x*H,a[2]=v+x*K),n&&(n[0]=n[1]=n[2]=0),0}(Z,K,d,a,n/=D,x/=D,N/=D,v="undefined"===typeof v?64:+v,A,H)}},14055:(Z,h,V)=>{"use strict";V.d(h,{b:()=>H});var v=V(13675);function A(){this.jD=!1,this.stopPropagation=!1,this.PD=!1,this.disabled=!1}class H{constructor(Z,h){this.version="0.7.0";var V=Object.assign({},new A,h||{});this.element=Z||document,this.jD=!!V.jD,this.stopPropagation=!!V.stopPropagation,this.PD=!!V.PD,this.disabled=!!V.disabled,this.filterEvents=(Z,h)=>!0,this.down=new v.EventEmitter,this.up=new v.EventEmitter,this.state={},this.Tn={dx:0,dy:0,Nk:0,wn:0,Dk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?d(this):document.addEventListener("DOMContentLoaded",(Z=>{d(this)}),{once:!0})}bind(Z){for(var h=arguments.length,V=new Array(h>1?h-1:0),v=1;v<h;v++)V[v-1]=arguments[v];V.forEach((h=>{var V=this._keyBindmap[h]||[];V.includes(Z)||(V.push(Z),this._keyBindmap[h]=V)})),this.state[Z]=!!this.state[Z],this.pressCount[Z]=this.pressCount[Z]||0,this.releaseCount[Z]=this.releaseCount[Z]||0}unbind(Z){for(var h in this._keyBindmap){var V=this._keyBindmap[h],v=V.indexOf(Z);v>-1&&V.splice(v,1)}}getBindings(){var Z={};for(var h in this._keyBindmap){this._keyBindmap[h].forEach((V=>{Z[V]=Z[V]||[],Z[V].push(h)}))}return Z}Pd(){K(this.Tn),K(this.pressCount),K(this.releaseCount)}}function K(Z){for(var h in Z)Z[h]=0}function d(Z){window.addEventListener("keydown",u.bind(null,Z,!0),!1),window.addEventListener("keyup",u.bind(null,Z,!1),!1);var h={passive:!0};Z.element.addEventListener("touchstart",N.bind(void 0,Z),{passive:!1}),Z.element.addEventListener("touchend",k.bind(void 0,Z),h),Z.element.addEventListener("mousedown",F.bind(null,Z,!0),h),window.document.addEventListener("mouseup",F.bind(null,Z,!1),h),Z.element.addEventListener("touchmove",b.bind(null,Z),h),Z.element.addEventListener("mousemove",b.bind(null,Z),h),window.PointerEvent,Z.element.addEventListener("wheel",o.bind(null,Z),h),Z.element.addEventListener("contextmenu",q.bind(null,Z),!1),window.addEventListener("blur",X.bind(null,Z),!1)}var a=0,n=0,x=null;function N(Z,h){h.preventDefault(),D(h)}function D(Z){let h=!1;for(let V=0;V<Z.touches.length;++V)if(Z.touches[V].identifier===x){h=!0;break}if(!h){const h=Z.changedTouches[0];a=h.clientX,n=h.clientY,x=h.identifier}}function k(Z,h){for(var V=h.changedTouches,v=0;v<V.length;++v)V[v].identifier===x&&(x=null)}function u(Z,h,V){E(V.code,h,Z,V)}function F(Z,h,V){if("pointerId"in V)if(h){if(null!==Z._touches.currID)return;Z._touches.currID=V.pointerId}else{if(Z._touches.currID!==V.pointerId)return;Z._touches.currID=null}return E("Mouse"+("button"in V?V.button+1:1),h,Z,V),!1}function b(Z,h){var V=h.movementX||h.mozMovementX||0,v=h.movementY||h.mozMovementY||0;if(h.touches&&0===(V|v)){var A=function(Z){D(Z);for(let h=0;h<Z.changedTouches.length;++h)if(Z.changedTouches[h].identifier==x){const V=Z.changedTouches[h],v=[V.clientX-a,V.clientY-n];return a=V.clientX,n=V.clientY,v}return console.error(`Did not find touch id ${x}`),[0,0]}(h);V=A[0],v=A[1]}Z.Tn.dx+=V,Z.Tn.dy+=v}function o(Z,h){var V=1;switch(h.deltaMode){case 0:V=1;break;case 1:V=12;break;case 2:V=Z.element.clientHeight||window.innerHeight}Z.Tn.Nk+=(h.deltaX||0)*V,Z.Tn.wn+=(h.deltaY||0)*V,Z.Tn.Dk+=(h.deltaZ||0)*V}function q(Z,h){if(!Z.PD)return h.preventDefault(),!1}function X(Z){for(var h in Z._keyStates)Z._keyStates[h]&&(/^Mouse\d/.test(h)||E(h,!1,Z,{code:h,note:"5fs04bhdeuc",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(Z,h,V,v){var A=V._keyBindmap[Z];A&&(j(V._keyStates[Z],h)&&(V._keyStates[Z]=h,A.forEach((Z=>{(!V.filterEvents||V.filterEvents(v,Z))&&function(Z,h,V,v){var A=h?V.pressCount:V.releaseCount;A[Z]=(A[Z]||0)+1;var H=V._bindPressCount[Z]||0;(H+=h?1:-1)<0&&(H=0);V._bindPressCount[Z]=H;var K=V.state[Z];if(j(K,H)){V.state[Z]=H>0;var d=h?V.down:V.up;V.disabled||d.emit(Z,v)}}(Z,h,V,v)}))),"button"in v||(V.jD&&!v.defaultPrevented&&v.preventDefault(),V.stopPropagation&&v.stopPropagation()))}function j(Z,h){return Z?!h:h}},12605:Z=>{Z.exports=function(Z,h,V){return Z[0]=h[0]+V[0],Z[1]=h[1]+V[1],Z[2]=h[2]+V[2],Z}},12563:(Z,h,V)=>{Z.exports=function(Z,h){var V=v(Z[0],Z[1],Z[2]),K=v(h[0],h[1],h[2]);A(V,V),A(K,K);var d=H(V,K);return d>1?0:Math.acos(d)};var v=V(12569),A=V(12574),H=V(12579)},12658:Z=>{Z.exports=function(Z,h){return Z[0]=Math.ceil(h[0]),Z[1]=Math.ceil(h[1]),Z[2]=Math.ceil(h[2]),Z}},12559:Z=>{Z.exports=function(Z){var h=new Float32Array(3);return h[0]=Z[0],h[1]=Z[1],h[2]=Z[2],h}},12585:Z=>{Z.exports=function(Z,h){return Z[0]=h[0],Z[1]=h[1],Z[2]=h[2],Z}},12552:Z=>{Z.exports=function(){var Z=new Float32Array(3);return Z[0]=0,Z[1]=0,Z[2]=0,Z}},12748:Z=>{Z.exports=function(Z,h,V){var v=h[0],A=h[1],H=h[2],K=V[0],d=V[1],a=V[2];return Z[0]=A*a-H*d,Z[1]=H*K-v*a,Z[2]=v*d-A*K,Z}},12693:(Z,h,V)=>{Z.exports=V(12686)},12686:Z=>{Z.exports=function(Z,h){var V=h[0]-Z[0],v=h[1]-Z[1],A=h[2]-Z[2];return Math.sqrt(V*V+v*v+A*A)}},12636:(Z,h,V)=>{Z.exports=V(12633)},12633:Z=>{Z.exports=function(Z,h,V){return Z[0]=h[0]/V[0],Z[1]=h[1]/V[1],Z[2]=h[2]/V[2],Z}},12579:Z=>{Z.exports=function(Z,h){return Z[0]*h[0]+Z[1]*h[1]+Z[2]*h[2]}},12550:Z=>{Z.exports=1e-6},12593:(Z,h,V)=>{Z.exports=function(Z,h){var V=Z[0],A=Z[1],H=Z[2],K=h[0],d=h[1],a=h[2];return Math.abs(V-K)<=v*Math.max(1,Math.abs(V),Math.abs(K))&&Math.abs(A-d)<=v*Math.max(1,Math.abs(A),Math.abs(d))&&Math.abs(H-a)<=v*Math.max(1,Math.abs(H),Math.abs(a))};var v=V(12550)},12602:Z=>{Z.exports=function(Z,h){return Z[0]===h[0]&&Z[1]===h[1]&&Z[2]===h[2]}},12651:Z=>{Z.exports=function(Z,h){return Z[0]=Math.floor(h[0]),Z[1]=Math.floor(h[1]),Z[2]=Math.floor(h[2]),Z}},12802:(Z,h,V)=>{Z.exports=function(Z,h,V,A,H,K){var d,a;h||(h=3);V||(V=0);a=A?Math.min(A*h+V,Z.length):Z.length;for(d=V;d<a;d+=h)v[0]=Z[d],v[1]=Z[d+1],v[2]=Z[d+2],H(v,v,K),Z[d]=v[0],Z[d+1]=v[1],Z[d+2]=v[2];return Z};var v=V(12552)()},12569:Z=>{Z.exports=function(Z,h,V){var v=new Float32Array(3);return v[0]=Z,v[1]=h,v[2]=V,v}},12545:(Z,h,V)=>{Z.exports={EPSILON:V(12550),create:V(12552),clone:V(12559),angle:V(12563),Kd:V(12569),i:V(12585),set:V(12590),equals:V(12593),exactEquals:V(12602),add:V(12605),rh:V(12614),sub:V(12618),multiply:V(12620),mul:V(12627),divide:V(12633),div:V(12636),min:V(12640),max:V(12642),floor:V(12651),ceil:V(12658),round:V(12666),scale:V(12669),dd:V(12678),distance:V(12686),k:V(12693),squaredDistance:V(12698),sqrDist:V(12703),length:V(12706),len:V(12714),squaredLength:V(12723),ad:V(12730),negate:V(12736),inverse:V(12744),normalize:V(12574),dot:V(12579),cross:V(12748),Vd:V(12754),random:V(12757),transformMat4:V(12766),transformMat3:V(12774),transformQuat:V(12778),Nd:V(12780),Dd:V(12788),ud:V(12793),forEach:V(12802)}},12744:Z=>{Z.exports=function(Z,h){return Z[0]=1/h[0],Z[1]=1/h[1],Z[2]=1/h[2],Z}},12714:(Z,h,V)=>{Z.exports=V(12706)},12706:Z=>{Z.exports=function(Z){var h=Z[0],V=Z[1],v=Z[2];return Math.sqrt(h*h+V*V+v*v)}},12754:Z=>{Z.exports=function(Z,h,V,v){var A=h[0],H=h[1],K=h[2];return Z[0]=A+v*(V[0]-A),Z[1]=H+v*(V[1]-H),Z[2]=K+v*(V[2]-K),Z}},12642:Z=>{Z.exports=function(Z,h,V){return Z[0]=Math.max(h[0],V[0]),Z[1]=Math.max(h[1],V[1]),Z[2]=Math.max(h[2],V[2]),Z}},12640:Z=>{Z.exports=function(Z,h,V){return Z[0]=Math.min(h[0],V[0]),Z[1]=Math.min(h[1],V[1]),Z[2]=Math.min(h[2],V[2]),Z}},12627:(Z,h,V)=>{Z.exports=V(12620)},12620:Z=>{Z.exports=function(Z,h,V){return Z[0]=h[0]*V[0],Z[1]=h[1]*V[1],Z[2]=h[2]*V[2],Z}},12736:Z=>{Z.exports=function(Z,h){return Z[0]=-h[0],Z[1]=-h[1],Z[2]=-h[2],Z}},12574:Z=>{Z.exports=function(Z,h){var V=h[0],v=h[1],A=h[2],H=V*V+v*v+A*A;H>0&&(H=1/Math.sqrt(H),Z[0]=h[0]*H,Z[1]=h[1]*H,Z[2]=h[2]*H);return Z}},12757:Z=>{Z.exports=function(Z,h){h=h||1;var V=2*Math.random()*Math.PI,v=2*Math.random()-1,A=Math.sqrt(1-v*v)*h;return Z[0]=Math.cos(V)*A,Z[1]=Math.sin(V)*A,Z[2]=v*h,Z}},12780:Z=>{Z.exports=function(Z,h,V,v){var A=V[1],H=V[2],K=h[1]-A,d=h[2]-H,a=Math.sin(v),n=Math.cos(v);return Z[0]=h[0],Z[1]=A+K*n-d*a,Z[2]=H+K*a+d*n,Z}},12788:Z=>{Z.exports=function(Z,h,V,v){var A=V[0],H=V[2],K=h[0]-A,d=h[2]-H,a=Math.sin(v),n=Math.cos(v);return Z[0]=A+d*a+K*n,Z[1]=h[1],Z[2]=H+d*n-K*a,Z}},12793:Z=>{Z.exports=function(Z,h,V,v){var A=V[0],H=V[1],K=h[0]-A,d=h[1]-H,a=Math.sin(v),n=Math.cos(v);return Z[0]=A+K*n-d*a,Z[1]=H+K*a+d*n,Z[2]=h[2],Z}},12666:Z=>{Z.exports=function(Z,h){return Z[0]=Math.round(h[0]),Z[1]=Math.round(h[1]),Z[2]=Math.round(h[2]),Z}},12669:Z=>{Z.exports=function(Z,h,V){return Z[0]=h[0]*V,Z[1]=h[1]*V,Z[2]=h[2]*V,Z}},12678:Z=>{Z.exports=function(Z,h,V,v){return Z[0]=h[0]+V[0]*v,Z[1]=h[1]+V[1]*v,Z[2]=h[2]+V[2]*v,Z}},12590:Z=>{Z.exports=function(Z,h,V,v){return Z[0]=h,Z[1]=V,Z[2]=v,Z}},12703:(Z,h,V)=>{Z.exports=V(12698)},12730:(Z,h,V)=>{Z.exports=V(12723)},12698:Z=>{Z.exports=function(Z,h){var V=h[0]-Z[0],v=h[1]-Z[1],A=h[2]-Z[2];return V*V+v*v+A*A}},12723:Z=>{Z.exports=function(Z){var h=Z[0],V=Z[1],v=Z[2];return h*h+V*V+v*v}},12618:(Z,h,V)=>{Z.exports=V(12614)},12614:Z=>{Z.exports=function(Z,h,V){return Z[0]=h[0]-V[0],Z[1]=h[1]-V[1],Z[2]=h[2]-V[2],Z}},12774:Z=>{Z.exports=function(Z,h,V){var v=h[0],A=h[1],H=h[2];return Z[0]=v*V[0]+A*V[3]+H*V[6],Z[1]=v*V[1]+A*V[4]+H*V[7],Z[2]=v*V[2]+A*V[5]+H*V[8],Z}},12766:Z=>{Z.exports=function(Z,h,V){var v=h[0],A=h[1],H=h[2],K=V[3]*v+V[7]*A+V[11]*H+V[15];return K=K||1,Z[0]=(V[0]*v+V[4]*A+V[8]*H+V[12])/K,Z[1]=(V[1]*v+V[5]*A+V[9]*H+V[13])/K,Z[2]=(V[2]*v+V[6]*A+V[10]*H+V[14])/K,Z}},12778:Z=>{Z.exports=function(Z,h,V){var v=h[0],A=h[1],H=h[2],K=V[0],d=V[1],a=V[2],n=V[3],x=n*v+d*H-a*A,N=n*A+a*v-K*H,D=n*H+K*A-d*v,k=-K*v-d*A-a*H;return Z[0]=x*n+k*-K+N*-a-D*-d,Z[1]=N*n+k*-d+D*-K-x*-a,Z[2]=D*n+k*-a+x*-d-N*-K,Z}},13699:Z=>{"use strict";Z.exports=function(Z){for(var h=new Array(Z),V=0;V<Z;++V)h[V]=V;return h}},13778:Z=>{Z.exports=function(Z){return null!=Z&&null!=Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}},14028:(Z,h,V)=>{"use strict";V.d(h,{b:()=>v});class v{constructor(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.AN=!1,this.HN=!1,this.VN=30,this.vN=0,this.kN=!1,this.fullscreen=!1,this.dN=function(Z){},this.aN=function(){},this.NN=function(){},this.dh=function(){},this.nN=function(Z){},this.onFullscreenChanged=function(Z){},n((()=>{!function(Z,h){Z._nowObject=performance||Date,Z._lastTick=0,Z._renderAccum=0,Z._rt=0,Z._frameCB=d.bind(null,Z),requestAnimationFrame(Z._frameCB),h>0&&(Z._intervalCB=K.bind(null,Z),Z._interval=setInterval(Z._intervalCB,Math.max(h,1e3/Z.VN/2)))}(this,h),function(Z,h){if(!h)return;var V=!1,v=!1;document.addEventListener("pointerlockchange",(v=>{V=document.pointerLockElement===h,Z.nN(V)})),document.addEventListener("fullscreenchange",(V=>{v=document.fullscreenElement===h,Z.onFullscreenChanged(v)})),Object.defineProperty(Z,"kN",{get:()=>V,set:Z=>{Z&&!V?a(h):V&&!Z&&function(Z){Z.exitPointerLock&&Z.exitPointerLock()}(document)}}),Object.defineProperty(Z,"fullscreen",{get:()=>v,set:Z=>{Z&&!v?h.requestFullscreen():v&&!Z&&document.exitFullscreen()}}),h.addEventListener("click",(A=>{Z.AN&&!V&&a(h),Z.HN&&!v&&h.requestFullscreen()}));var A=()=>Z.dh();if(window.ResizeObserver){new ResizeObserver(A).observe(h)}else window.addEventListener("resize",A)}(this,Z),this.NN()}))}}var A=3,H=20;function K(Z){for(var h=1e3/Z.VN,V=Z._nowObject.now()+H,v=0;Z._nowObject.now()>=Z._lastTick+h&&Z._nowObject.now()<V&&++v<=A;)Z.dN(h),Z._lastTick+=h;var K=5*(h+5),d=Z._nowObject.now();if(d-Z._lastTick>K)for(;d>=Z._lastTick+h;)Z._lastTick+=h}function d(Z){requestAnimationFrame(Z._frameCB),K(Z);var h=Z._nowObject.now(),V=h-Z._rt;if(Z._rt=h,Z.vN>0){Z._renderAccum+=V;var v=1e3/Z.vN;if(Z._renderAccum<v)return;Z._renderAccum=Math.min(Z._renderAccum-v,v)}var A=1e3/Z.VN,H=(h-Z._lastTick)/A;Z.aN(V,H,A)}function a(Z){Z.requestPointerLock&&Z.requestPointerLock()}var n=Z=>{if("loading"===document.readyState){var h=()=>{document.removeEventListener("readystatechange",h),Z()};document.addEventListener("readystatechange",h)}else setTimeout(Z,1)}},13691:(Z,h,V)=>{var v=V(13699),A=V(13708),H="undefined"!==typeof Float64Array;function K(Z,h){return Z[0]-h[0]}function d(){var Z,h=this.stride,V=new Array(h.length);for(Z=0;Z<V.length;++Z)V[Z]=[Math.abs(h[Z]),Z];V.sort(K);var v=new Array(V.length);for(Z=0;Z<v.length;++Z)v[Z]=V[Z][1];return v}function a(Z,h){var V=["View",h,"d",Z].join("");h<0&&(V="View_Nil"+Z);var A="generic"===Z;if(-1===h){var H="function "+V+"(a){this.data=a;};var proto="+V+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+V+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+V+"(a){return new "+V+"(a);}";return new Function(H)()}if(0===h){H="function "+V+"(a,d) {this.data = a;this.offset = d};var proto="+V+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+V+"_copy() {return new "+V+"(this.data,this.offset)};proto.pick=function "+V+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+V+"_get(){return "+(A?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+V+"_set(v){return "+(A?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+V+"(a,b,c,d){return new "+V+"(a,d)}";return new Function("TrivialArray",H)(n[Z][0])}H=["'use strict'"];var K=v(h),a=K.map((function(Z){return"i"+Z})),x="this.offset+"+K.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),N=K.map((function(Z){return"b"+Z})).join(","),D=K.map((function(Z){return"c"+Z})).join(",");H.push("function "+V+"(a,"+N+","+D+",d){this.data=a","this.shape=["+N+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+V+".prototype","proto.dtype='"+Z+"'","proto.dimension="+h),H.push("Object.defineProperty(proto,'size',{get:function "+V+"_size(){return "+K.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===h?H.push("proto.order=[0]"):(H.push("Object.defineProperty(proto,'order',{get:"),h<4?(H.push("function "+V+"_order(){"),2===h?H.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&H.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):H.push("ORDER})")),H.push("proto.set=function "+V+"_set("+a.join(",")+",v){"),A?H.push("return this.data.set("+x+",v)}"):H.push("return this.data["+x+"]=v}"),H.push("proto.get=function "+V+"_get("+a.join(",")+"){"),A?H.push("return this.data.get("+x+")}"):H.push("return this.data["+x+"]}"),H.push("proto.index=function "+V+"_index(",a.join(),"){return "+x+"}"),H.push("proto.hi=function "+V+"_hi("+a.join(",")+"){return new "+V+"(this.data,"+K.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+K.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var k=K.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),u=K.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));H.push("proto.lo=function "+V+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+u.join(","));for(var F=0;F<h;++F)H.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");H.push("return new "+V+"(this.data,"+K.map((function(Z){return"a"+Z})).join(",")+","+K.map((function(Z){return"c"+Z})).join(",")+",b)}"),H.push("proto.step=function "+V+"_step("+a.join(",")+"){var "+K.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+K.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<h;++F)H.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");H.push("return new "+V+"(this.data,"+K.map((function(Z){return"a"+Z})).join(",")+","+K.map((function(Z){return"b"+Z})).join(",")+",c)}");var b=new Array(h),o=new Array(h);for(F=0;F<h;++F)b[F]="a[i"+F+"]",o[F]="b[i"+F+"]";H.push("proto.transpose=function "+V+"_transpose("+a+"){"+a.map((function(Z,h){return Z+"=("+Z+"===undefined?"+h+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+V+"(this.data,"+b.join(",")+","+o.join(",")+",this.offset)}"),H.push("proto.pick=function "+V+"_pick("+a+"){var a=[],b=[],c=this.offset");for(F=0;F<h;++F)H.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return H.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),H.push("return function construct_"+V+"(data,shape,stride,offset){return new "+V+"(data,"+K.map((function(Z){return"shape["+Z+"]"})).join(",")+","+K.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",H.join("\n"))(n[Z],d)}var n={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,h,V,v){if(void 0===Z)return(0,n.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===h&&(h=[Z.length]);var K=h.length;if(void 0===V){V=new Array(K);for(var d=K-1,x=1;d>=0;--d)V[d]=x,x*=h[d]}if(void 0===v){v=0;for(d=0;d<K;++d)V[d]<0&&(v-=(h[d]-1)*V[d])}for(var N=function(Z){if(A(Z))return"buffer";if(H)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),D=n[N];D.length<=K+1;)D.push(a(N,D.length-1));return(0,D[K+1])(Z,h,V,v)}},13708:Z=>{function h(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(h(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&h(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},13878:Z=>{"use strict";var h=[],V=[],v=[],A=[],H=[],K=[],d=[],a=[],n=[],x=[],N=[],D=[];Z.exports=function(Z,k,u,F,b,o){for(var q=d,X=n,E=x,j=D,P=0;P<3;P++)q[P]=+u[P],E[P]=+k.max[P],X[P]=+k.base[P];o||(o=1e-10);var C=function(Z,d,n,x,D,k){var u=h,F=V,b=v,o=A,q=H,X=K,E=a,j=Math.floor,P=0,C=0,l=0,B=0,S=0;if(r(),0===l)return 0;for(B=W();C<=l;){if(L(B)&&y())return P;B=W()}for(P+=l,S=0;S<3;S++)x[S]+=n[S],D[S]+=n[S];return P;function r(){if(C=0,0!==(l=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])))for(var Z=0;Z<3;Z++){var h=n[Z]>=0;o[Z]=h?1:-1;var V=h?D[Z]:x[Z];u[Z]=h?x[Z]:D[Z],F[Z]=z(V,o[Z]),b[Z]=m(u[Z],o[Z]),E[Z]=n[Z]/l,q[Z]=Math.abs(1/E[Z]);var v=h?F[Z]+1-V:V-F[Z];X[Z]=q[Z]<1/0?q[Z]*v:1/0}}function L(h){for(var V=o[0],v=0===h?F[0]:b[0],A=F[0]+V,H=o[1],K=1===h?F[1]:b[1],d=F[1]+H,a=o[2],n=2===h?F[2]:b[2],x=F[2]+a,N=v;N!=A;N+=V)for(var D=K;D!=d;D+=H)for(var k=n;k!=x;k+=a)if(Z(N,D,k))return!0;return!1}function y(){P+=C;var Z=o[B],h=C/l,V=N;for(S=0;S<3;S++){var v=n[S]*h;x[S]+=v,D[S]+=v,V[S]=n[S]-v}if(Z>0?D[B]=Math.round(D[B]):x[B]=Math.round(x[B]),d(P,B,Z,V))return!0;for(S=0;S<3;S++)n[S]=V[S];return r(),0===l}function W(){var Z=X[0]<X[1]?X[0]<X[2]?0:2:X[1]<X[2]?1:2,h=X[Z]-C;for(C=X[Z],F[Z]+=o[Z],X[Z]+=q[Z],S=0;S<3;S++)u[S]+=h*E[S],b[S]=m(u[S],o[S]);return Z}function z(Z,h){return j(Z-h*k)}function m(Z,h){return j(Z+h*k)}}(Z,F,q,X,E,o);if(!b){for(P=0;P<3;P++)j[P]=u[P]>0?E[P]-k.max[P]:X[P]-k.base[P];k.translate(j)}return C}},14062:(Z,h,V)=>{"use strict";V.d(h,{e:()=>N});var v=V(13870),A=V(12545);class H{constructor(Z,h,V,H,K,d,a){this.sn=new v(Z.base,Z.kx),this.AH=h,this.friction=V,this.restitution=H,this.JK=K,this.mk=d,this.fK=!!a,this.Dx=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Xu=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.jn=A.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=A.create(),this._impulses=A.create(),this._sleepFrameCount=10}loadFromCopy(Z){A.i(this.sn.base,Z.sn.base),A.i(this.sn.kx,Z.sn.kx),A.i(this.sn.max,Z.sn.max),this.sn.mag=Z.sn.mag,this.AH=Z.AH,this.friction=Z.friction,this.restitution=Z.restitution,this.JK=Z.JK,this.mk=Z.mk,this.fK=Z.fK,this.Dx=Z.Dx,this.fluidDrag=Z.fluidDrag,this.Xu=Z.Xu,this.preventFallOffEdge=Z.preventFallOffEdge,this.rolledBackLastTick=Z.rolledBackLastTick,A.i(this.jn,Z.jn),A.i(this.resting,Z.resting),this.inFluid=Z.inFluid,this._ratioInFluid=Z._ratioInFluid,A.i(this._forces,Z._forces),A.i(this._impulses,Z._impulses),this._sleepFrameCount=Z._sleepFrameCount}setPosition(Z){K(Z),A.rh(Z,Z,this.sn.base),this.sn.translate(Z),this.ln()}Nh(){return A.clone(this.sn.base)}applyForce(Z){K(Z),A.add(this._forces,this._forces,Z),this.ln()}applyImpulse(Z){K(Z),A.add(this._impulses,this._impulses,Z),this.ln()}ln(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var K=Z=>{};var d=V(13870),a=V(12545),n=V(13878);function x(){this.Dx=.1,this.fluidDrag=.4,this.hd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function N(Z,h,V){Z=Object.assign(new x,Z),this.gravity=Z.gravity||[0,-10,0],this.Dx=Z.Dx||.1,this.hd=Z.hd||2,this.fluidDrag=Z.fluidDrag||.4,this.minBounceImpulse=Z.minBounceImpulse,this.bodies=[],this.hk=Z.hk,this.testSolid=h,this.testFluid=V}N.prototype.wk=function(Z,h,V,v,A,K){Z=Z||new d([0,0,0],[1,1,1]),"undefined"==typeof h&&(h=1),"undefined"==typeof V&&(V=1),"undefined"==typeof v&&(v=0),"undefined"==typeof A&&(A=1);var a=new H(Z,h,V,v,A,K);return this.bodies.push(a),a},N.prototype.Tk=function(Z){var h=this.bodies.indexOf(Z);h<0||(this.bodies.splice(h,1),Z.sn=Z.mk=null)};var D=a.create(),k=a.create(),u=a.create(),F=a.create(),b=a.create(),o=a.create(),q=a.create(),X=new d([0,0,0],[1,1,1]),E=new H(X,1,1,0,1,(()=>{}),!1);function j(Z,h,V){return h=V,h*=1-(1-Z.ratioInFluid)**2}N.prototype.Pd=function(Z){Z/=1e3;var h=R(0,a.squaredLength(this.gravity));this.bodies.forEach((V=>function(Z,h,V,v){a.i(b,h.resting),Z.hk&&E.loadFromCopy(h);if(h.AH<=0)return a.set(h.jn,0,0,0),a.set(h._forces,0,0,0),void a.set(h._impulses,0,0,0);var A=v||0===h.JK;if(function(Z,h,V,v){if(h._sleepFrameCount>0)return!1;if(v)return!0;var A=!1,H=.5*V*V*h.JK;return a.scale(U,Z.gravity,H),n(Z.testSolid,h.sn,U,(function(){return A=!0,!0}),!0),A}(Z,h,V,A))return;h._sleepFrameCount--,function(Z,h){var V=h.sn,v=Math.floor(V.base[0]),A=Math.floor(V.base[2]),H=Math.floor(V.base[1]),K=Math.floor(V.max[1]);if(!Z.testFluid(v,H,A))return h.inFluid=!1,void(h.ratioInFluid=0);var d=1,n=H+1;for(;n<=K&&Z.testFluid(v,n,A);)d++,n++;var x=(H+d-V.base[1])/V.kx[1];x>1&&(x=1);var N=V.kx[0]*V.kx[1]*V.kx[2]*x,D=C;a.scale(D,Z.gravity,-Z.hd*N*h.JK),h.applyForce(D),h.inFluid=!0,h.ratioInFluid=x}(Z,h),w(h._forces),w(h._impulses),w(h.jn),w(h.resting),a.scale(D,h._forces,1/h.AH),a.dd(D,D,Z.gravity,h.JK),a.scale(k,h._impulses,1/h.AH),a.dd(k,k,D,V),a.add(h.jn,h.jn,k),h.friction&&(l(Z,0,h,k,V),l(Z,1,h,k,V),l(Z,2,h,k,V));var H=h.fluidDrag>=0?h.fluidDrag:Z.fluidDrag,K=h.Dx>=0?h.Dx:Z.Dx,d=K,x=K;h.inFluid&&(d=j(h,d,h.fluidDragHoriz>=0?h.fluidDragHoriz:H),x=j(h,x,h.fluidDragVert>=0?h.fluidDragVert:H));d=Math.max(1-d*V/h.AH,0),x=Math.max(1-x*V/h.AH,0),a.set(P,d,x,d),a.multiply(h.jn,h.jn,P),a.scale(u,h.jn,V),a.set(h._forces,0,0,0),a.set(h._impulses,0,0,0),h.fK&&Q(r,h.sn);a.i(o,u),a.set(q,0,0,0),h.preventFallOffEdge&&function(Z,h,V,v){if(!h.resting[1]||V[1]>0)return;var A=g;Q(A,h.sn);for(var H=0;H<3;H+=2){a.set(m,0,0,0),m[H]=V[H];var K=!0;(K=(K=(K=(K=K&&!e(Z,A.base[0]+m[0]+1e-5,A.base[1],A.base[2]+m[2]+1e-5))&&!e(Z,A.max[0]+m[0]-1e-5,A.base[1],A.base[2]+m[2]+1e-5))&&!e(Z,A.base[0]+m[0]+1e-5,A.base[1],A.max[2]+m[2]-1e-5))&&!e(Z,A.max[0]+m[0]-1e-5,A.base[1],A.max[2]+m[2]-1e-5))?(v[H]=V[H]>0?1:-1,V[H]=0):0===H&&(a.set(I,V[0],0,0),S(Z,A,I,v,h.slideOnCollision))}}(Z,h,u,q);S(Z,h.sn,u,h.resting,h.slideOnCollision),h.fK&&function(Z,h,V,v){if(h.resting[1]>=0&&!h.inFluid)return;var A=0!==h.resting[0],H=0!==h.resting[2];if(!A&&!H)return;var K=Math.abs(v[0]/v[2]),d=4;if(!A&&K>d)return;if(!H&&K<1/d)return;a.add(y,V.base,v);var x=Z.testSolid;n(x,V,v,(function(Z,h,V,v){if(1!==h)return!0;v[h]=0}));var N=V.base[1],D=h.inFluid?1.951:1.001,k=Math.floor(N+D)-N;a.set(W,0,k,0);var u=!1;if(n(x,V,W,(function(Z,h,V,v){return u=!0,!0})),u)return;a.rh(z,y,V.base),z[1]=0,S(Z,V,z,L,!0);var F=R(V.base[0],y[0]),b=R(V.base[2],y[2]);if(A&&!F&&(!b||!H))return;if(H&&(!F||!A)&&!b)return;var o=!0;if(o=o&&!e(Z,V.base[0]+1e-5,V.base[1],V.base[2]+1e-5),o=o&&!e(Z,V.max[0]-1e-5,V.base[1],V.base[2]+1e-5),o=o&&!e(Z,V.base[0]+1e-5,V.base[1],V.max[2]-1e-5),o=o&&!e(Z,V.max[0]-1e-5,V.base[1],V.max[2]-1e-5),o)return;Q(h.sn,V),h.resting[0]=L[0],h.resting[2]=L[2],h.Xu&&h.Xu()}(Z,h,r,o);for(var N=0;N<3;++N)h.resting[N]=h.resting[N]||q[N],F[N]=0,h.resting[N]&&(b[N]||(F[N]=-h.jn[N]),h.jn[N]=0);var X=a.length(F);X>.001&&(a.scale(F,F,h.AH),h.mk&&h.mk(F),h.restitution>0&&X>Z.minBounceImpulse&&(a.scale(F,F,h.restitution),h.applyImpulse(F)));var B=a.squaredLength(h.jn);B>1e-5&&h.ln();Z.hk&&Z.hk(h)?(h.loadFromCopy(E),h.rolledBackLastTick=!0):h.rolledBackLastTick=!1}(this,V,Z,h)))};var P=a.create([0,0,0]);var C=a.create();function l(Z,h,V,v,A){var H=V.resting[h],K=v[h];if(!V.alwaysApplyHorizFriction||1!==h){if(0===H)return;if(H*K<=0)return}a.i(B,V.jn),B[h]=0;var d=a.length(B);if(!R(d,0)){var n=Math.abs(V.friction*Z.gravity[h]*A),x=d>n?(d-n)/d:0;V.jn[(h+1)%3]*=x,V.jn[(h+2)%3]*=x}}var B=a.create();function S(Z,h,V,v,A){return a.set(v,0,0,0),n(Z.testSolid,h,V,(function(Z,h,V,H){v[h]=V,H[h]=0,A||(H[0]=0,H[1]=0,H[2]=0)}))}var r=new d([],[]),L=a.create(),y=a.create(),W=a.create(),z=a.create();var m=a.create(),g=new d([],[]),I=a.create();function e(Z,h,V,v){return Z.testSolid(Math.floor(h),Math.floor(V-1),Math.floor(v))}var U=a.create();function R(Z,h){return Math.abs(Z-h)<1e-5}function Q(Z,h){for(var V=0;V<3;V++)Z.base[V]=h.base[V],Z.max[V]=h.max[V],Z.kx[V]=h.kx[V]}var w=function(Z){}},12427:function(Z,h){!function(Z){"use strict";var h=function(Z,V){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,h){Z.__proto__=h}||function(Z,h){for(var V in h)Object.prototype.hasOwnProperty.call(h,V)&&(Z[V]=h[V])},h(Z,V)};function V(Z,V){if("function"!==typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function v(){this.constructor=Z}h(Z,V),Z.prototype=null===V?Object.create(V):(v.prototype=V.prototype,new v)}function v(Z,h,V,v){var A,H=arguments.length,K=H<3?h:null===v?v=Object.getOwnPropertyDescriptor(h,V):v;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)K=Reflect.decorate(Z,h,V,v);else for(var d=Z.length-1;d>=0;d--)(A=Z[d])&&(K=(H<3?A(K):H>3?A(h,V,K):A(h,V))||K);return H>3&&K&&Object.defineProperty(h,V,K),K}function A(Z,h,V){if(V||2===arguments.length)for(var v,A=0,H=h.length;A<H;A++)!v&&A in h||(v||(v=Array.prototype.slice.call(h,0,A)),v[A]=h[A]);return Z.concat(v||Array.prototype.slice.call(h))}var H,K=255,d=213;Z.OPERATION=void 0,(H=Z.OPERATION||(Z.OPERATION={}))[H.ADD=128]="ADD",H[H.REPLACE=0]="REPLACE",H[H.DELETE=64]="DELETE",H[H.DELETE_AND_ADD=192]="DELETE_AND_ADD",H[H.TOUCH=1]="TOUCH",H[H.CLEAR=10]="CLEAR";var a=function(){function h(Z,h,V){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Z,this.setParent(h,V)}return h.prototype.setParent=function(Z,h,V){var v=this;if(this.indexes||(this.indexes=this.ref instanceof zZ?this.ref._definition.indexes:{}),this.parent=Z,this.parentIndex=V,h)if(this.root=h,this.ref instanceof zZ){var A=this.ref._definition;for(var H in A.schema){var K=this.ref[H];if(K&&K.$changes){var d=A.indexes[H];K.$changes.setParent(this.ref,h,d)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Z,h){if(Z instanceof zZ){var V=Z.$changes,A=v.ref.$changes.indexes[h];V.setParent(v.ref,v.root,A)}}))},h.prototype.operation=function(Z){this.changes.set(--this.currentCustomOperation,Z)},h.prototype.change=function(h,V){void 0===V&&(V=Z.OPERATION.ADD);var v="number"===typeof h?h:this.indexes[h];this.assertValidIndex(v,h);var A=this.changes.get(v);A&&A.op!==Z.OPERATION.DELETE&&A.op!==Z.OPERATION.TOUCH||this.changes.set(v,{op:A&&A.op===Z.OPERATION.DELETE?Z.OPERATION.DELETE_AND_ADD:V,index:v}),this.allChanges.add(v),this.changed=!0,this.touchParents()},h.prototype.touch=function(h){var V="number"===typeof h?h:this.indexes[h];this.assertValidIndex(V,h),this.changes.has(V)||this.changes.set(V,{op:Z.OPERATION.TOUCH,index:V}),this.allChanges.add(V),this.touchParents()},h.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},h.prototype.getType=function(Z){if(this.ref._definition)return(h=this.ref._definition).schema[h.fieldsByIndex[Z]];var h,V=(h=this.parent._definition).schema[h.fieldsByIndex[this.parentIndex]];return Object.values(V)[0]},h.prototype.getChildrenFilter=function(){var Z=this.parent._definition.childFilters;return Z&&Z[this.parentIndex]},h.prototype.getValue=function(Z){return this.ref.getByIndex(Z)},h.prototype.delete=function(h){var V="number"===typeof h?h:this.indexes[h];if(void 0!==V){var v=this.getValue(V);this.changes.set(V,{op:Z.OPERATION.DELETE,index:V}),this.allChanges.delete(V),delete this.caches[V],v&&v.$changes&&(v.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(h," (").concat(V,")"))},h.prototype.discard=function(h,V){var v=this;void 0===h&&(h=!1),void 0===V&&(V=!1),this.ref instanceof zZ||this.changes.forEach((function(h){if(h.op===Z.OPERATION.DELETE){var V=v.ref.getIndex(h.index);delete v.indexes[V]}})),this.changes.clear(),this.changed=h,V&&this.allChanges.clear(),this.currentCustomOperation=0},h.prototype.discardAll=function(){var Z=this;this.changes.forEach((function(h){var V=Z.getValue(h.index);V&&V.$changes&&V.$changes.discardAll()})),this.discard()},h.prototype.cache=function(Z,h){this.caches[Z]=h},h.prototype.clone=function(){return new h(this.ref,this.parent,this.root)},h.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},h.prototype.assertValidIndex=function(Z,h){if(void 0===Z)throw new Error('ChangeTree: missing index for field "'.concat(h,'"'))},h}();function n(Z,h,V,v){return Z[h]||(Z[h]=[]),Z[h].push(V),null===v||void 0===v||v.forEach((function(Z,h){return V(Z,h)})),function(){return N(Z[h],Z[h].indexOf(V))}}function x(h){var V=this,v="string"!==typeof this.$changes.getType();this.$items.forEach((function(A,H){h.push({refId:V.$changes.refId,op:Z.OPERATION.DELETE,field:H,value:void 0,previousValue:A}),v&&V.$changes.root.removeRef(A.$changes.refId)}))}function N(Z,h){if(-1===h||h>=Z.length)return!1;for(var V=Z.length-1,v=h;v<V;v++)Z[v]=Z[v+1];return Z.length=V,!0}var D=function(Z,h){var V=Z.toString(),v=h.toString();return V<v?-1:V>v?1:0};function k(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,h){return"symbol"===typeof h||isNaN(h)?Z[h]:Z.at(h)},set:function(Z,h,V){if("symbol"===typeof h||isNaN(h))Z[h]=V;else{var v=Array.from(Z.$items.keys()),A=parseInt(v[h]||h);void 0===V||null===V?Z.deleteAt(A):Z.setAt(A,V)}return!0},deleteProperty:function(Z,h){return"number"===typeof h?Z.deleteAt(h):delete Z[h],!0}})}var u=function(){function h(){for(var Z=[],h=0;h<arguments.length;h++)Z[h]=arguments[h];this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Z)}return h.prototype.Id=function(h,V){return void 0===V&&(V=!0),n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,h,V?this.$items:void 0)},h.prototype.Kh=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,h)},h.is=function(Z){return Array.isArray(Z)||void 0!==Z.array},Object.defineProperty(h.prototype,"length",{get:function(){return this.$items.size},set:function(Z){0===Z?this.clear():this.splice(Z,this.length-Z)},enumerable:!1,configurable:!0}),h.prototype.push=function(){for(var Z,h=this,V=[],v=0;v<arguments.length;v++)V[v]=arguments[v];return V.forEach((function(V){Z=h.$refId++,h.setAt(Z,V)})),Z},h.prototype.pop=function(){var Z=Array.from(this.$indexes.values()).pop();if(void 0!==Z){this.$changes.delete(Z),this.$indexes.delete(Z);var h=this.$items.get(Z);return this.$items.delete(Z),h}},h.prototype.at=function(Z){var h=Array.from(this.$items.keys())[Z];return this.$items.get(h)},h.prototype.setAt=function(h,V){var v,A;if(void 0!==V&&null!==V){if(this.$items.get(h)!==V){void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,h);var H=null!==(A=null===(v=this.$changes.indexes[h])||void 0===v?void 0:v.op)&&void 0!==A?A:Z.OPERATION.ADD;this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,V),this.$changes.change(h,H)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},h.prototype.deleteAt=function(Z){var h=Array.from(this.$items.keys())[Z];return void 0!==h&&this.$deleteAt(h)},h.prototype.$deleteAt=function(Z){return this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&x.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.concat=function(){for(var Z,V=[],v=0;v<arguments.length;v++)V[v]=arguments[v];return new(h.bind.apply(h,A([void 0],(Z=Array.from(this.$items.values())).concat.apply(Z,V),!1)))},h.prototype.join=function(Z){return Array.from(this.$items.values()).join(Z)},h.prototype.reverse=function(){var Z=this,h=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(V,v){Z.setAt(h[v],V)})),this},h.prototype.shift=function(){var Z=Array.from(this.$items.keys()).shift();if(void 0!==Z){var h=this.$items.get(Z);return this.$deleteAt(Z),h}},h.prototype.slice=function(Z,V){var v=new h;return v.push.apply(v,Array.from(this.$items.values()).slice(Z,V)),v},h.prototype.sort=function(Z){var h=this;void 0===Z&&(Z=D);var V=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Z).forEach((function(Z,v){h.setAt(V[v],Z)})),this},h.prototype.splice=function(Z,h){void 0===h&&(h=this.length-Z);for(var V=Array.from(this.$items.keys()),v=[],A=Z;A<Z+h;A++)v.push(this.$items.get(V[A])),this.$deleteAt(V[A]);return v},h.prototype.unshift=function(){for(var Z=this,h=[],V=0;V<arguments.length;V++)h[V]=arguments[V];var v=this.length,A=h.length,H=Array.from(this.$items.values());return h.forEach((function(h,V){Z.setAt(V,h)})),H.forEach((function(h,V){Z.setAt(A+V,h)})),v+A},h.prototype.indexOf=function(Z,h){return Array.from(this.$items.values()).indexOf(Z,h)},h.prototype.lastIndexOf=function(Z,h){return void 0===h&&(h=this.length-1),Array.from(this.$items.values()).lastIndexOf(Z,h)},h.prototype.every=function(Z,h){return Array.from(this.$items.values()).every(Z,h)},h.prototype.some=function(Z,h){return Array.from(this.$items.values()).some(Z,h)},h.prototype.forEach=function(Z,h){Array.from(this.$items.values()).forEach(Z,h)},h.prototype.map=function(Z,h){return Array.from(this.$items.values()).map(Z,h)},h.prototype.filter=function(Z,h){return Array.from(this.$items.values()).filter(Z,h)},h.prototype.reduce=function(Z,h){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},h.prototype.reduceRight=function(Z,h){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},h.prototype.find=function(Z,h){return Array.from(this.$items.values()).find(Z,h)},h.prototype.findIndex=function(Z,h){return Array.from(this.$items.values()).findIndex(Z,h)},h.prototype.fill=function(Z,h,V){throw new Error("ArraySchema#fill() not implemented")},h.prototype.copyWithin=function(Z,h,V){throw new Error("ArraySchema#copyWithin() not implemented")},h.prototype.toString=function(){return this.$items.toString()},h.prototype.toLocaleString=function(){return this.$items.toLocaleString()},h.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},h.prototype.includes=function(Z,h){return Array.from(this.$items.values()).includes(Z,h)},h.prototype.flatMap=function(Z,h){throw new Error("ArraySchema#flatMap() is not supported.")},h.prototype.flat=function(Z){throw new Error("ArraySchema#flat() is not supported.")},h.prototype.findLast=function(){var Z=Array.from(this.$items.values());return Z.findLast.apply(Z,arguments)},h.prototype.findLastIndex=function(){var Z=Array.from(this.$items.values());return Z.findLastIndex.apply(Z,arguments)},h.prototype.setIndex=function(Z,h){this.$indexes.set(Z,h)},h.prototype.getIndex=function(Z){return this.$indexes.get(Z)},h.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},h.prototype.deleteByIndex=function(Z){var h=this.$indexes.get(Z);this.$items.delete(h),this.$indexes.delete(Z)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){return this.toArray().map((function(Z){return"function"===typeof Z.toJSON?Z.toJSON():Z}))},h.prototype.clone=function(Z){return Z?new(h.bind.apply(h,A([void 0],Array.from(this.$items.values()),!1))):new(h.bind.apply(h,A([void 0],this.map((function(Z){return Z.$changes?Z.clone():Z})),!1)))},h}();function F(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,h){return"symbol"!==typeof h&&"undefined"===typeof Z[h]?Z.get(h):Z[h]},set:function(Z,h,V){return"symbol"!==typeof h&&-1===h.indexOf("$")&&"Id"!==h&&"Kh"!==h&&"onChange"!==h?Z.set(h,V):Z[h]=V,!0},deleteProperty:function(Z,h){return Z.delete(h),!0}})}var b=function(){function h(Z){var V=this;if(this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z)if(Z instanceof Map||Z instanceof h)Z.forEach((function(Z,h){return V.set(h,Z)}));else for(var v in Z)this.set(v,Z[v])}return h.prototype.Id=function(h,V){return void 0===V&&(V=!0),n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,h,V?this.$items:void 0)},h.prototype.Kh=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,h)},h.is=function(Z){return void 0!==Z.map},h.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(h.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.set=function(h,V){if(void 0===V||null===V)throw new Error("MapSchema#set('".concat(h,"', ").concat(V,"): trying to set ").concat(V," value on '").concat(h,"'."));h=h.toString();var v="undefined"!==typeof this.$changes.indexes[h],A=v?this.$changes.indexes[h]:this.$refId++,H=v?Z.OPERATION.REPLACE:Z.OPERATION.ADD,K=void 0!==V.$changes;if(K&&V.$changes.setParent(this,this.$changes.root,A),v){if(!K&&this.$items.get(h)===V)return;K&&this.$items.get(h)!==V&&(H=Z.OPERATION.ADD)}else this.$changes.indexes[h]=A,this.$indexes.set(A,h);return this.$items.set(h,V),this.$changes.change(h,H),this},h.prototype.get=function(Z){return this.$items.get(Z)},h.prototype.delete=function(Z){return this.$changes.delete(Z),this.$items.delete(Z)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&x.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(Z){return this.$items.has(Z)},h.prototype.forEach=function(Z){this.$items.forEach(Z)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(Z,h){this.$indexes.set(Z,h)},h.prototype.getIndex=function(Z){return this.$indexes.get(Z)},h.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},h.prototype.deleteByIndex=function(Z){var h=this.$indexes.get(Z);this.$items.delete(h),this.$indexes.delete(Z)},h.prototype.toJSON=function(){var Z={};return this.forEach((function(h,V){Z[V]="function"===typeof h.toJSON?h.toJSON():h})),Z},h.prototype.clone=function(Z){var V;return Z?V=Object.assign(new h,this):(V=new h,this.forEach((function(Z,h){Z.$changes?V.set(h,Z.clone()):V.set(h,Z)}))),V},h}(),o={};function q(Z,h){o[Z]=h}function X(Z){return o[Z]}var E=function(){function Z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Z.create=function(h){var V=new Z;return V.schema=Object.assign({},h&&h.schema||{}),V.indexes=Object.assign({},h&&h.indexes||{}),V.fieldsByIndex=Object.assign({},h&&h.fieldsByIndex||{}),V.descriptors=Object.assign({},h&&h.descriptors||{}),V.deprecated=Object.assign({},h&&h.deprecated||{}),V},Z.prototype.addField=function(Z,h){var V=this.getNextFieldIndex();this.fieldsByIndex[V]=Z,this.indexes[Z]=V,this.schema[Z]=Array.isArray(h)?{array:h[0]}:h},Z.prototype.hasField=function(Z){return void 0!==this.indexes[Z]},Z.prototype.addFilter=function(Z,h){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Z]]=h,this.indexesWithFilters.push(this.indexes[Z]),!0},Z.prototype.addChildrenFilter=function(Z,h){var V=this.indexes[Z],v=this.schema[Z];if(X(Object.keys(v)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[V]=h,!0;console.warn("@filterChildren: field '".concat(Z,"' can't have children. Ignoring filter."))},Z.prototype.getChildrenFilter=function(Z){return this.childFilters&&this.childFilters[this.indexes[Z]]},Z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Z}();function j(Z){return Z._context&&Z._context.useFilters}var P=function(){function Z(){this.types={},this.schemas=new Map,this.useFilters=!1}return Z.prototype.has=function(Z){return this.schemas.has(Z)},Z.prototype.get=function(Z){return this.types[Z]},Z.prototype.add=function(Z,h){void 0===h&&(h=this.schemas.size),Z._definition=E.create(Z._definition),Z._typeid=h,this.types[h]=Z,this.schemas.set(Z,h)},Z.create=function(h){return void 0===h&&(h={}),function(V){return h.context||(h.context=new Z),l(V,h)}},Z}(),C=new P;function l(Z,h){return void 0===h&&(h={}),function(V,v){var H=h.context||C,K=V.constructor;if(K._context=H,!Z)throw new Error("".concat(K.name,': @type() reference provided for "').concat(v,"\" is undefined. Make sure you don't have any circular dependencies."));H.has(K)||H.add(K);var d=K._definition;if(d.addField(v,Z),d.descriptors[v]){if(d.deprecated[v])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(v,"' definition on '").concat(K.name,"'.\nCheck @type() annotation"))}catch(o){var a=o.stack.split("\n")[4].trim();throw new Error("".concat(o.message," ").concat(a))}}var n=u.is(Z),x=!n&&b.is(Z);if("string"!==typeof Z&&!zZ.is(Z)){var N=Object.values(Z)[0];"string"===typeof N||H.has(N)||H.add(N)}if(h.manual)d.descriptors[v]={enumerable:!0,configurable:!0,writable:!0};else{var D="_".concat(v);d.descriptors[D]={enumerable:!1,configurable:!1,writable:!0},d.descriptors[v]={get:function(){return this[D]},set:function(Z){Z!==this[D]&&(void 0!==Z&&null!==Z?(!n||Z instanceof u||(Z=new(u.bind.apply(u,A([void 0],Z,!1)))),!x||Z instanceof b||(Z=new b(Z)),void 0===Z.$proxy&&(x?Z=F(Z):n&&(Z=k(Z))),this.$changes.change(v),Z.$changes&&Z.$changes.setParent(this,this.$changes.root,this._definition.indexes[v])):this[D]&&this.$changes.delete(v),this[D]=Z)},enumerable:!0,configurable:!0}}}}function B(Z){return function(h,V){var v=h.constructor;v._definition.addFilter(V,Z)&&(v._context.useFilters=!0)}}function S(Z){return function(h,V){var v=h.constructor;v._definition.addChildrenFilter(V,Z)&&(v._context.useFilters=!0)}}function r(Z){return void 0===Z&&(Z=!0),function(h,V){var v=h.constructor._definition;v.deprecated[V]=!0,Z&&(v.descriptors[V]={get:function(){throw new Error("".concat(V," is deprecated."))},set:function(Z){},enumerable:!1,configurable:!0})}}function L(Z,h,V){for(var v in void 0===V&&(V={}),V.context||(V.context=Z._context||V.context||C),h)l(h[v],V)(Z.prototype,v);return Z}function y(Z){for(var h=0,V=0,v=0,A=Z.length;v<A;v++)(h=Z.charCodeAt(v))<128?V+=1:h<2048?V+=2:h<55296||h>=57344?V+=3:(v++,V+=4);return V}function W(Z,h,V){for(var v=0,A=0,H=V.length;A<H;A++)(v=V.charCodeAt(A))<128?Z[h++]=v:v<2048?(Z[h++]=192|v>>6,Z[h++]=128|63&v):v<55296||v>=57344?(Z[h++]=224|v>>12,Z[h++]=128|v>>6&63,Z[h++]=128|63&v):(A++,v=65536+((1023&v)<<10|1023&V.charCodeAt(A)),Z[h++]=240|v>>18,Z[h++]=128|v>>12&63,Z[h++]=128|v>>6&63,Z[h++]=128|63&v)}function z(Z,h){Z.push(255&h)}function m(Z,h){Z.push(255&h)}function g(Z,h){Z.push(255&h),Z.push(h>>8&255)}function I(Z,h){Z.push(255&h),Z.push(h>>8&255)}function e(Z,h){Z.push(255&h),Z.push(h>>8&255),Z.push(h>>16&255),Z.push(h>>24&255)}function U(Z,h){var V=h>>24,v=h>>16,A=h>>8,H=h;Z.push(255&H),Z.push(255&A),Z.push(255&v),Z.push(255&V)}function R(Z,h){var V=Math.floor(h/Math.pow(2,32));U(Z,h>>>0),U(Z,V)}function Q(Z,h){var V=h/Math.pow(2,32)|0;U(Z,h>>>0),U(Z,V)}function w(Z,h){M(Z,h)}function T(Z,h){O(Z,h)}var t=new Int32Array(2),c=new Float32Array(t.buffer),i=new Float64Array(t.buffer);function M(Z,h){c[0]=h,e(Z,t[0])}function O(Z,h){i[0]=h,e(Z,t[0]),e(Z,t[1])}function s(Z,h){return m(Z,h?1:0)}function J(Z,h){h||(h="");var V=y(h),v=0;if(V<32)Z.push(160|V),v=1;else if(V<256)Z.push(217),m(Z,V),v=2;else if(V<65536)Z.push(218),I(Z,V),v=3;else{if(!(V<4294967296))throw new Error("String too long");Z.push(219),U(Z,V),v=5}return W(Z,Z.length,h),v+V}function f(Z,h){return isNaN(h)?f(Z,0):isFinite(h)?h!==(0|h)?(Z.push(203),O(Z,h),9):h>=0?h<128?(m(Z,h),1):h<256?(Z.push(204),m(Z,h),2):h<65536?(Z.push(205),I(Z,h),3):h<4294967296?(Z.push(206),U(Z,h),5):(Z.push(207),Q(Z,h),9):h>=-32?(Z.push(224|h+32),1):h>=-128?(Z.push(208),z(Z,h),2):h>=-32768?(Z.push(209),g(Z,h),3):h>=-2147483648?(Z.push(210),e(Z,h),5):(Z.push(211),R(Z,h),9):f(Z,h>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:W,int8:z,uint8:m,int16:g,uint16:I,int32:e,uint32:U,int64:R,uint64:Q,float32:w,float64:T,writeFloat32:M,writeFloat64:O,boolean:s,string:J,number:f});function Y(Z,h,V){for(var v="",A=0,H=h,K=h+V;H<K;H++){var d=Z[H];0!==(128&d)?192!==(224&d)?224!==(240&d)?240!==(248&d)?console.error("Invalid byte "+d.toString(16)):(A=(7&d)<<18|(63&Z[++H])<<12|(63&Z[++H])<<6|63&Z[++H])>=65536?(A-=65536,v+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):v+=String.fromCharCode(A):v+=String.fromCharCode((15&d)<<12|(63&Z[++H])<<6|63&Z[++H]):v+=String.fromCharCode((31&d)<<6|63&Z[++H]):v+=String.fromCharCode(d)}return v}function G(Z,h){return ZZ(Z,h)<<24>>24}function ZZ(Z,h){return Z[h.offset++]}function hZ(Z,h){return VZ(Z,h)<<16>>16}function VZ(Z,h){return Z[h.offset++]|Z[h.offset++]<<8}function vZ(Z,h){return Z[h.offset++]|Z[h.offset++]<<8|Z[h.offset++]<<16|Z[h.offset++]<<24}function AZ(Z,h){return vZ(Z,h)>>>0}function HZ(Z,h){return DZ(Z,h)}function KZ(Z,h){return kZ(Z,h)}function dZ(Z,h){var V=AZ(Z,h);return vZ(Z,h)*Math.pow(2,32)+V}function aZ(Z,h){var V=AZ(Z,h);return AZ(Z,h)*Math.pow(2,32)+V}var nZ=new Int32Array(2),xZ=new Float32Array(nZ.buffer),NZ=new Float64Array(nZ.buffer);function DZ(Z,h){return nZ[0]=vZ(Z,h),xZ[0]}function kZ(Z,h){return nZ[0]=vZ(Z,h),nZ[1]=vZ(Z,h),NZ[0]}function uZ(Z,h){return ZZ(Z,h)>0}function FZ(Z,h){var V,v=Z[h.offset++];v<192?V=31&v:217===v?V=ZZ(Z,h):218===v?V=VZ(Z,h):219===v&&(V=AZ(Z,h));var A=Y(Z,h.offset,V);return h.offset+=V,A}function bZ(Z,h){var V=Z[h.offset];return V<192&&V>160||217===V||218===V||219===V}function oZ(Z,h){var V=Z[h.offset++];return V<128?V:202===V?DZ(Z,h):203===V?kZ(Z,h):204===V?ZZ(Z,h):205===V?VZ(Z,h):206===V?AZ(Z,h):207===V?aZ(Z,h):208===V?G(Z,h):209===V?hZ(Z,h):210===V?vZ(Z,h):211===V?dZ(Z,h):V>223?-1*(255-V+1):void 0}function qZ(Z,h){var V=Z[h.offset];return V<128||V>=202&&V<=211}function XZ(Z,h){return Z[h.offset]<160}function EZ(Z,h){return Z[h.offset-1]===K&&(Z[h.offset]<128||Z[h.offset]>=202&&Z[h.offset]<=211)}var jZ=Object.freeze({__proto__:null,int8:G,uint8:ZZ,int16:hZ,uint16:VZ,int32:vZ,uint32:AZ,float32:HZ,float64:KZ,int64:dZ,uint64:aZ,readFloat32:DZ,readFloat64:kZ,boolean:uZ,string:FZ,stringCheck:bZ,number:oZ,numberCheck:qZ,arrayCheck:XZ,switchStructureCheck:EZ}),PZ=function(){function h(Z){var h=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return h.add(Z)}))}return h.prototype.Id=function(h,V){return void 0===V&&(V=!0),n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,h,V?this.$items:void 0)},h.prototype.Kh=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,h)},h.is=function(Z){return void 0!==Z.collection},h.prototype.add=function(Z){var h=this.$refId++;return void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,h),this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,Z),this.$changes.change(h),h},h.prototype.at=function(Z){var h=Array.from(this.$items.keys())[Z];return this.$items.get(h)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(Z){for(var h,V,v=this.$items.entries();(V=v.next())&&!V.done;)if(Z===V.value[1]){h=V.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&x.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(Z){return Array.from(this.$items.values()).some((function(h){return h===Z}))},h.prototype.forEach=function(Z){var h=this;this.$items.forEach((function(V,v,A){return Z(V,v,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(Z,h){this.$indexes.set(Z,h)},h.prototype.getIndex=function(Z){return this.$indexes.get(Z)},h.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},h.prototype.deleteByIndex=function(Z){var h=this.$indexes.get(Z);this.$items.delete(h),this.$indexes.delete(Z)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var Z=[];return this.forEach((function(h,V){Z.push("function"===typeof h.toJSON?h.toJSON():h)})),Z},h.prototype.clone=function(Z){var V;return Z?V=Object.assign(new h,this):(V=new h,this.forEach((function(Z){Z.$changes?V.add(Z.clone()):V.add(Z)}))),V},h}(),CZ=function(){function h(Z){var h=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return h.add(Z)}))}return h.prototype.Id=function(h,V){return void 0===V&&(V=!0),n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,h,V?this.$items:void 0)},h.prototype.Kh=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,h)},h.is=function(Z){return void 0!==Z.set},h.prototype.add=function(h){var V,v;if(this.has(h))return!1;var A=this.$refId++;void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,A);var H=null!==(v=null===(V=this.$changes.indexes[A])||void 0===V?void 0:V.op)&&void 0!==v?v:Z.OPERATION.ADD;return this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,h),this.$changes.change(A,H),A},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(Z){for(var h,V,v=this.$items.entries();(V=v.next())&&!V.done;)if(Z===V.value[1]){h=V.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&x.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(Z){for(var h,V=this.$items.values(),v=!1;(h=V.next())&&!h.done;)if(Z===h.value){v=!0;break}return v},h.prototype.forEach=function(Z){var h=this;this.$items.forEach((function(V,v,A){return Z(V,v,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(Z,h){this.$indexes.set(Z,h)},h.prototype.getIndex=function(Z){return this.$indexes.get(Z)},h.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},h.prototype.deleteByIndex=function(Z){var h=this.$indexes.get(Z);this.$items.delete(h),this.$indexes.delete(Z)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var Z=[];return this.forEach((function(h,V){Z.push("function"===typeof h.toJSON?h.toJSON():h)})),Z},h.prototype.clone=function(Z){var V;return Z?V=Object.assign(new h,this):(V=new h,this.forEach((function(Z){Z.$changes?V.add(Z.clone()):V.add(Z)}))),V},h}(),lZ=function(){function Z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Z.prototype.addRefId=function(Z){this.refIds.has(Z)||(this.refIds.add(Z),this.containerIndexes.set(Z,new Set))},Z.get=function(h){return void 0===h.$filterState&&(h.$filterState=new Z),h.$filterState},Z}(),BZ=function(){function Z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Z.prototype.addRef=function(Z,h,V){void 0===V&&(V=!0),this.refs.set(Z,h),V&&(this.refCounts[Z]=(this.refCounts[Z]||0)+1)},Z.prototype.removeRef=function(Z){this.refCounts[Z]=this.refCounts[Z]-1,this.deletedRefs.add(Z)},Z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Z.prototype.garbageCollectDeletedRefs=function(){var Z=this;this.deletedRefs.forEach((function(h){if(!(Z.refCounts[h]>0)){var V=Z.refs.get(h);if(V instanceof zZ)for(var v in V._definition.schema)"string"!==typeof V._definition.schema[v]&&V[v]&&V[v].$changes&&Z.removeRef(V[v].$changes.refId);else{var A=V.$changes.parent._definition,H=A.schema[A.fieldsByIndex[V.$changes.parentIndex]];"function"===typeof Object.values(H)[0]&&Array.from(V.values()).forEach((function(h){return Z.removeRef(h.$changes.refId)}))}Z.refs.delete(h),delete Z.refCounts[h]}})),this.deletedRefs.clear()},Z}(),SZ=function(Z){function h(){return null!==Z&&Z.apply(this,arguments)||this}return V(h,Z),h}(Error);function rZ(Z,h,V,v){var A,H=!1;switch(h){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":A="number",isNaN(Z)&&console.log('trying to encode "NaN" in '.concat(V.constructor.name,"#").concat(v));break;case"string":A="string",H=!0;break;case"boolean":return}if(typeof Z!==A&&(!H||H&&null!==Z)){var K="'".concat(JSON.stringify(Z),"'").concat(Z&&Z.constructor&&" (".concat(Z.constructor.name,")")||"");throw new SZ("a '".concat(A,"' was expected, but ").concat(K," was provided in ").concat(V.constructor.name,"#").concat(v))}}function LZ(Z,h,V,v){if(!(Z instanceof h))throw new SZ("a '".concat(h.name,"' was expected, but '").concat(Z.constructor.name,"' was provided in ").concat(V.constructor.name,"#").concat(v))}function yZ(Z,h,V,v,A){rZ(V,Z,v,A);var H=p[Z];if(!H)throw new SZ("a '".concat(Z,"' was expected, but ").concat(V," was provided in ").concat(v.constructor.name,"#").concat(A));H(h,V)}function WZ(Z,h,V){return jZ[Z](h,V)}var zZ=function(){function h(){for(var Z=[],h=0;h<arguments.length;h++)Z[h]=arguments[h];Object.defineProperties(this,{$changes:{value:new a(this,void 0,new BZ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var V=this._definition.descriptors;V&&Object.defineProperties(this,V),Z[0]&&this.assign(Z[0])}return h.onError=function(Z){console.error(Z)},h.is=function(Z){return Z._definition&&void 0!==Z._definition.schema},h.prototype.onChange=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,h)},h.prototype.Kh=function(h){return n(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,h)},h.prototype.assign=function(Z){return Object.assign(this,Z),this},Object.defineProperty(h.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),h.prototype.setDirty=function(Z,h){this.$changes.change(Z,h)},h.prototype.listen=function(Z,h,V){var v=this;return void 0===V&&(V=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Z]||(this.$callbacks[Z]=[]),this.$callbacks[Z].push(h),V&&void 0!==this[Z]&&h(this[Z],void 0),function(){return N(v.$callbacks[Z],v.$callbacks[Z].indexOf(h))}},h.prototype.decode=function(V,v,A){var H;void 0===v&&(v={offset:0}),void 0===A&&(A=this);var d=[],a=this.$changes.root,n=V.length,x=0;for(a.refs.set(x,this);v.offset<n;){var N=V[v.offset++];if(N!=K){var D=A.$changes,k=void 0!==A._definition,F=k?N>>6<<6:N;if(F!==Z.OPERATION.CLEAR){var o=k?N%(F||255):oZ(V,v),q=k?A._definition.fieldsByIndex[o]:"",E=D.getType(o),j=void 0,P=void 0,C=void 0;if(k?P=A["_".concat(q)]:(P=A.getByIndex(o),(F&Z.OPERATION.ADD)===Z.OPERATION.ADD?(C=A instanceof b?FZ(V,v):o,A.setIndex(o,C)):C=A.getIndex(o)),(F&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&(F!==Z.OPERATION.DELETE_AND_ADD&&A.deleteByIndex(o),P&&P.$changes&&a.removeRef(P.$changes.refId),j=null),void 0!==q){if(F===Z.OPERATION.DELETE);else if(h.is(E)){var l=oZ(V,v);if(j=a.refs.get(l),F!==Z.OPERATION.REPLACE){var B=this.getSchemaType(V,v,E);j||((j=this.createTypeInstance(B)).$changes.refId=l,P&&(j.$callbacks=P.$callbacks,P.$changes.refId&&l!==P.$changes.refId&&a.removeRef(P.$changes.refId))),a.addRef(l,j,j!==P)}}else if("string"===typeof E)j=WZ(E,V,v);else{var S=X(Object.keys(E)[0]),r=oZ(V,v),L=a.refs.has(r)?P||a.refs.get(r):new S.constructor;if((j=L.clone(!0)).$changes.refId=r,P&&(j.$callbacks=P.$callbacks,P.$changes.refId&&r!==P.$changes.refId)){a.removeRef(P.$changes.refId);for(var y=P.entries(),W=void 0;(W=y.next())&&!W.done;){var z=(H=W.value)[0],m=H[1];d.push({refId:r,op:Z.OPERATION.DELETE,field:z,value:void 0,previousValue:m})}}a.addRef(r,j,L!==P)}if(null!==j&&void 0!==j)if(j.$changes&&j.$changes.setParent(D.ref,D.root,o),A instanceof h)A[q]=j;else if(A instanceof b)z=C,A.$items.set(z,j),A.$changes.allChanges.add(o);else if(A instanceof u)A.setAt(o,j);else if(A instanceof PZ){var g=A.add(j);A.setIndex(o,g)}else A instanceof CZ&&!1!==(g=A.add(j))&&A.setIndex(o,g);P!==j&&d.push({refId:x,op:F,field:q,dynamicIndex:C,value:j,previousValue:P})}else{console.warn("@colyseus/schema: definition mismatch");for(var I={offset:v.offset};v.offset<n&&(!EZ(V,v)||(I.offset=v.offset+1,!a.refs.has(oZ(V,I))));)v.offset++}}else A.clear(d)}else{x=oZ(V,v);var e=a.refs.get(x);if(!e)throw new Error('"refId" not found: '.concat(x));A=e}}return this._triggerChanges(d),a.garbageCollectDeletedRefs(),d},h.prototype.encode=function(V,v,A){void 0===V&&(V=!1),void 0===v&&(v=[]),void 0===A&&(A=!1);for(var H=this.$changes,d=new WeakSet,a=[H],n=1,x=0;x<n;x++){var N=a[x],D=N.ref,k=D instanceof h;N.ensureRefId(),d.add(N),N!==H&&(N.changed||V)&&(m(v,K),f(v,N.refId));for(var u=V?Array.from(N.allChanges):Array.from(N.changes.values()),F=0,o=u.length;F<o;F++){var q=V?{op:Z.OPERATION.ADD,index:u[F]}:u[F],E=q.index,j=k?D._definition.fieldsByIndex&&D._definition.fieldsByIndex[E]:E,P=v.length;if(q.op!==Z.OPERATION.TOUCH)if(k)m(v,E|q.op);else{if(m(v,q.op),q.op===Z.OPERATION.CLEAR)continue;f(v,E)}if(k||(q.op&Z.OPERATION.ADD)!=Z.OPERATION.ADD||D instanceof b&&J(v,N.ref.$indexes.get(E)),q.op!==Z.OPERATION.DELETE){var C=N.getType(E),l=N.getValue(E);if(l&&l.$changes&&!d.has(l.$changes)&&(a.push(l.$changes),l.$changes.ensureRefId(),n++),q.op!==Z.OPERATION.TOUCH){if(h.is(C))LZ(l,C,D,j),f(v,l.$changes.refId),(q.op&Z.OPERATION.ADD)===Z.OPERATION.ADD&&this.tryEncodeTypeId(v,C,l.constructor);else if("string"===typeof C)yZ(C,v,l,D,j);else{var B=X(Object.keys(C)[0]);LZ(D["_".concat(j)],B.constructor,D,j),f(v,l.$changes.refId)}A&&N.cache(E,v.slice(P))}}}V||A||N.discard()}return v},h.prototype.encodeAll=function(Z){return this.encode(!0,[],Z)},h.prototype.applyFilters=function(V,v){var A,H;void 0===v&&(v=!1);for(var d=this,a=new Set,n=lZ.get(V),x=[this.$changes],N=1,D=[],k=function(k){var u=x[k];if(a.has(u.refId))return"continue";var F=u.ref,o=F instanceof h;m(D,K),f(D,u.refId);var q=n.refIds.has(u),X=v||!q;n.addRefId(u);var E=n.containerIndexes.get(u),j=X?Array.from(u.allChanges):Array.from(u.changes.values());!v&&o&&F._definition.indexesWithFilters&&F._definition.indexesWithFilters.forEach((function(h){!E.has(h)&&u.allChanges.has(h)&&(X?j.push(h):j.push({op:Z.OPERATION.ADD,index:h}))}));for(var P=0,C=j.length;P<C;P++){var l=X?{op:Z.OPERATION.ADD,index:j[P]}:j[P];if(l.op!==Z.OPERATION.CLEAR){var B=l.index;if(l.op!==Z.OPERATION.DELETE){var S=u.getValue(B),r=u.getType(B);if(o){if((L=F._definition.filters&&F._definition.filters[B])&&!L.call(F,V,S,d)){S&&S.$changes&&a.add(S.$changes.refId);continue}}else{var L,y=u.parent;if((L=u.getChildrenFilter())&&!L.call(y,V,F.$indexes.get(B),S,d)){S&&S.$changes&&a.add(S.$changes.refId);continue}}if(S.$changes&&(x.push(S.$changes),N++),l.op!==Z.OPERATION.TOUCH)if(l.op===Z.OPERATION.ADD||o)D.push.apply(D,null!==(A=u.caches[B])&&void 0!==A?A:[]),E.add(B);else if(E.has(B))D.push.apply(D,null!==(H=u.caches[B])&&void 0!==H?H:[]);else{if(E.add(B),m(D,Z.OPERATION.ADD),f(D,B),F instanceof b){var W=u.ref.$indexes.get(B);J(D,W)}S.$changes?f(D,S.$changes.refId):p[r](D,S)}else S.$changes&&!o&&(m(D,Z.OPERATION.ADD),f(D,B),F instanceof b&&(W=u.ref.$indexes.get(B),J(D,W)),f(D,S.$changes.refId))}else o?m(D,l.op|B):(m(D,l.op),f(D,B))}else m(D,l.op)}},u=0;u<N;u++)k(u);return D},h.prototype.clone=function(){var Z,h=new this.constructor,V=this._definition.schema;for(var v in V)"object"===typeof this[v]&&"function"===typeof(null===(Z=this[v])||void 0===Z?void 0:Z.clone)?h[v]=this[v].clone():h[v]=this[v];return h},h.prototype.toJSON=function(){var Z=this._definition.schema,h=this._definition.deprecated,V={};for(var v in Z)h[v]||null===this[v]||"undefined"===typeof this[v]||(V[v]="function"===typeof this[v].toJSON?this[v].toJSON():this["_".concat(v)]);return V},h.prototype.discardAllChanges=function(){this.$changes.discardAll()},h.prototype.getByIndex=function(Z){return this[this._definition.fieldsByIndex[Z]]},h.prototype.deleteByIndex=function(Z){this[this._definition.fieldsByIndex[Z]]=void 0},h.prototype.tryEncodeTypeId=function(Z,h,V){h._typeid!==V._typeid&&(m(Z,d),f(Z,V._typeid))},h.prototype.getSchemaType=function(Z,h,V){var v;return Z[h.offset]===d&&(h.offset++,v=this.constructor._context.get(oZ(Z,h))),v||V},h.prototype.createTypeInstance=function(Z){var h=new Z;return h.$changes.root=this.$changes.root,h},h.prototype._triggerChanges=function(V){for(var v,A,H,K,d,a,n,x,N,D=new Set,k=this.$changes.root.refs,u=function(u){var F=V[u],b=F.refId,o=k.get(b),q=o.$callbacks;if((F.op&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&F.previousValue instanceof h&&(null===(A=null===(v=F.previousValue.$callbacks)||void 0===v?void 0:v[Z.OPERATION.DELETE])||void 0===A||A.forEach((function(Z){return Z()}))),!q)return"continue";if(o instanceof h){if(!D.has(b))try{null===(H=null===q||void 0===q?void 0:q[Z.OPERATION.REPLACE])||void 0===H||H.forEach((function(Z){return Z()}))}catch(X){h.onError(X)}try{q.hasOwnProperty(F.field)&&(null===(K=q[F.field])||void 0===K||K.forEach((function(Z){return Z(F.value,F.previousValue)})))}catch(X){h.onError(X)}}else F.op===Z.OPERATION.ADD&&void 0===F.previousValue?null===(d=q[Z.OPERATION.ADD])||void 0===d||d.forEach((function(Z){var h;return Z(F.value,null!==(h=F.dynamicIndex)&&void 0!==h?h:F.field)})):F.op===Z.OPERATION.DELETE?void 0!==F.previousValue&&(null===(a=q[Z.OPERATION.DELETE])||void 0===a||a.forEach((function(Z){var h;return Z(F.previousValue,null!==(h=F.dynamicIndex)&&void 0!==h?h:F.field)}))):F.op===Z.OPERATION.DELETE_AND_ADD&&(void 0!==F.previousValue&&(null===(n=q[Z.OPERATION.DELETE])||void 0===n||n.forEach((function(Z){var h;return Z(F.previousValue,null!==(h=F.dynamicIndex)&&void 0!==h?h:F.field)}))),null===(x=q[Z.OPERATION.ADD])||void 0===x||x.forEach((function(Z){var h;return Z(F.value,null!==(h=F.dynamicIndex)&&void 0!==h?h:F.field)}))),F.value!==F.previousValue&&(null===(N=q[Z.OPERATION.REPLACE])||void 0===N||N.forEach((function(Z){var h;return Z(F.value,null!==(h=F.dynamicIndex)&&void 0!==h?h:F.field)})));D.add(b)},F=0;F<V.length;F++)u(F)},h._definition=E.create(),h}();function mZ(Z){for(var h=[Z.$changes],V=1,v={},A=v,H=function(Z){var V=h[Z];V.changes.forEach((function(Z){var h=V.ref,v=Z.index,H=h._definition?h._definition.fieldsByIndex[v]:h.$indexes.get(v);A[H]=V.getValue(v)}))},K=0;K<V;K++)H(K);return v}var gZ={context:new P},IZ=function(Z){function h(){return null!==Z&&Z.apply(this,arguments)||this}return V(h,Z),v([l("string",gZ)],h.prototype,"name",void 0),v([l("string",gZ)],h.prototype,"type",void 0),v([l("number",gZ)],h.prototype,"referencedType",void 0),h}(zZ),eZ=function(Z){function h(){var h=null!==Z&&Z.apply(this,arguments)||this;return h.fields=new u,h}return V(h,Z),v([l("number",gZ)],h.prototype,"id",void 0),v([l([IZ],gZ)],h.prototype,"fields",void 0),h}(zZ),UZ=function(Z){function h(){var h=null!==Z&&Z.apply(this,arguments)||this;return h.types=new u,h}return V(h,Z),h.encode=function(Z){var V=Z.constructor,v=new h;v.rootType=V._typeid;var A=function(Z,h){for(var V in h){var A=new IZ;A.name=V;var H=void 0;if("string"===typeof h[V])H=h[V];else{var K=h[V],d=void 0;zZ.is(K)?(H="ref",d=h[V]):"string"===typeof K[H=Object.keys(K)[0]]?H+=":"+K[H]:d=K[H],A.referencedType=d?d._typeid:-1}A.type=H,Z.fields.push(A)}v.types.push(Z)},H=V._context.types;for(var K in H){var d=new eZ;d.id=Number(K),A(d,H[K]._definition.schema)}return v.encodeAll()},h.decode=function(Z,v){var A=new P,H=new h;H.decode(Z,v);var K=H.types.reduce((function(Z,h){var v=function(Z){function h(){return null!==Z&&Z.apply(this,arguments)||this}return V(h,Z),h}(zZ),H=h.id;return Z[H]=v,A.add(v,H),Z}),{});H.types.forEach((function(Z){var h=K[Z.id];Z.fields.forEach((function(Z){var V;if(void 0!==Z.referencedType){var v=Z.type,H=K[Z.referencedType];if(!H){var d=Z.type.split(":");v=d[0],H=d[1]}"ref"===v?l(H,{context:A})(h.prototype,Z.name):l(((V={})[v]=H,V),{context:A})(h.prototype,Z.name)}else l(Z.type,{context:A})(h.prototype,Z.name)}))}));var d=K[H.rootType],a=new d;for(var n in d._definition.schema){var x=d._definition.schema[n];"string"!==typeof x&&(a[n]="function"===typeof x?new x:new(X(Object.keys(x)[0]).constructor))}return a},v([l([eZ],gZ)],h.prototype,"types",void 0),v([l("number",gZ)],h.prototype,"rootType",void 0),h}(zZ);q("map",{constructor:b}),q("array",{constructor:u}),q("set",{constructor:CZ}),q("collection",{constructor:PZ}),Z.ArraySchema=u,Z.CollectionSchema=PZ,Z.Context=P,Z.MapSchema=b,Z.Reflection=UZ,Z.ReflectionField=IZ,Z.ReflectionType=eZ,Z.Schema=zZ,Z.SchemaDefinition=E,Z.SetSchema=CZ,Z.decode=jZ,Z.defineTypes=L,Z.deprecated=r,Z.dumpChanges=mZ,Z.encode=p,Z.filter=B,Z.filterChildren=S,Z.hasFilter=j,Z.registerType=q,Z.type=l,Object.defineProperty(Z,"__esModule",{value:!0})}(h)},13926:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13919:(Z,h,V)=>{var v=V(13926),A=V(13929),H=Object.hasOwnProperty,K=Object.create(null);for(var d in v)H.call(v,d)&&(K[v[d]]=d);var a=Z.exports={to:{},get:{}};function n(Z,h,V){return Math.min(Math.max(h,Z),V)}function x(Z){var h=Math.round(Z).toString(16).toUpperCase();return h.length<2?"0"+h:h}a.get=function(Z){var h,V;switch(Z.substring(0,3).toLowerCase()){case"hsl":h=a.get.hsl(Z),V="hsl";break;case"hwb":h=a.get.hwb(Z),V="hwb";break;default:h=a.get.rgb(Z),V="rgb"}return h?{model:V,value:h}:null},a.get.rgb=function(Z){if(!Z)return null;var h,V,A,K=[0,0,0,1];if(h=Z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(A=h[2],h=h[1],V=0;V<3;V++){var d=2*V;K[V]=parseInt(h.slice(d,d+2),16)}A&&(K[3]=parseInt(A,16)/255)}else if(h=Z.match(/^#([a-f0-9]{3,4})$/i)){for(A=(h=h[1])[3],V=0;V<3;V++)K[V]=parseInt(h[V]+h[V],16);A&&(K[3]=parseInt(A+A,16)/255)}else if(h=Z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(V=0;V<3;V++)K[V]=parseInt(h[V+1],0);h[4]&&(h[5]?K[3]=.01*parseFloat(h[4]):K[3]=parseFloat(h[4]))}else{if(!(h=Z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(h=Z.match(/^(\w+)$/))?"transparent"===h[1]?[0,0,0,0]:H.call(v,h[1])?((K=v[h[1]])[3]=1,K):null:null;for(V=0;V<3;V++)K[V]=Math.round(2.55*parseFloat(h[V+1]));h[4]&&(h[5]?K[3]=.01*parseFloat(h[4]):K[3]=parseFloat(h[4]))}for(V=0;V<3;V++)K[V]=n(K[V],0,255);return K[3]=n(K[3],0,1),K},a.get.hsl=function(Z){if(!Z)return null;var h=Z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var V=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,n(parseFloat(h[2]),0,100),n(parseFloat(h[3]),0,100),n(isNaN(V)?1:V,0,1)]}return null},a.get.hwb=function(Z){if(!Z)return null;var h=Z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var V=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,n(parseFloat(h[2]),0,100),n(parseFloat(h[3]),0,100),n(isNaN(V)?1:V,0,1)]}return null},a.to.hex=function(){var Z=A(arguments);return"#"+x(Z[0])+x(Z[1])+x(Z[2])+(Z[3]<1?x(Math.round(255*Z[3])):"")},a.to.rgb=function(){var Z=A(arguments);return Z.length<4||1===Z[3]?"rgb("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+")":"rgba("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+", "+Z[3]+")"},a.to.rgb.percent=function(){var Z=A(arguments),h=Math.round(Z[0]/255*100),V=Math.round(Z[1]/255*100),v=Math.round(Z[2]/255*100);return Z.length<4||1===Z[3]?"rgb("+h+"%, "+V+"%, "+v+"%)":"rgba("+h+"%, "+V+"%, "+v+"%, "+Z[3]+")"},a.to.hsl=function(){var Z=A(arguments);return Z.length<4||1===Z[3]?"hsl("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%)":"hsla("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%, "+Z[3]+")"},a.to.hwb=function(){var Z=A(arguments),h="";return Z.length>=4&&1!==Z[3]&&(h=", "+Z[3]),"hwb("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%"+h+")"},a.to.keyword=function(Z){return K[Z.slice(0,3)]}},13911:(Z,h,V)=>{const v=V(13919),A=V(13945),H=["keyword","gray","hex"],K={};for(const k of Object.keys(A))K[[...A[k].labels].sort().join("")]=k;const d={};function a(Z,h){if(!(this instanceof a))return new a(Z,h);if(h&&h in H&&(h=null),h&&!(h in A))throw new Error("Unknown model: "+h);let V,n;if(null==Z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Z instanceof a)this.model=Z.model,this.color=[...Z.color],this.valpha=Z.valpha;else if("string"===typeof Z){const h=v.get(Z);if(null===h)throw new Error("Unable to parse color from string: "+Z);this.model=h.model,n=A[this.model].channels,this.color=h.value.slice(0,n),this.valpha="number"===typeof h.value[n]?h.value[n]:1}else if(Z.length>0){this.model=h||"rgb",n=A[this.model].channels;const V=Array.prototype.slice.call(Z,0,n);this.color=D(V,n),this.valpha="number"===typeof Z[n]?Z[n]:1}else if("number"===typeof Z)this.model="rgb",this.color=[Z>>16&255,Z>>8&255,255&Z],this.valpha=1;else{this.valpha=1;const h=Object.keys(Z);"alpha"in Z&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"===typeof Z.alpha?Z.alpha:0);const v=h.sort().join("");if(!(v in K))throw new Error("Unable to parse color from object: "+JSON.stringify(Z));this.model=K[v];const{labels:H}=A[this.model],d=[];for(V=0;V<H.length;V++)d.push(Z[H[V]]);this.color=D(d)}if(d[this.model])for(n=A[this.model].channels,V=0;V<n;V++){const Z=d[this.model][V];Z&&(this.color[V]=Z(this.color[V]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}a.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Z){let h=this.model in v.to?this:this.rgb();h=h.round("number"===typeof Z?Z:1);const V=1===h.valpha?h.color:[...h.color,this.valpha];return v.to[h.model](V)},percentString(Z){const h=this.rgb().round("number"===typeof Z?Z:1),V=1===h.valpha?h.color:[...h.color,this.valpha];return v.to.rgb.percent(V)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Z={},{channels:h}=A[this.model],{labels:V}=A[this.model];for(let v=0;v<h;v++)Z[V[v]]=this.color[v];return 1!==this.valpha&&(Z.alpha=this.valpha),Z},unitArray(){const Z=this.rgb().color;return Z[0]/=255,Z[1]/=255,Z[2]/=255,1!==this.valpha&&Z.push(this.valpha),Z},unitObject(){const Z=this.rgb().object();return Z.r/=255,Z.g/=255,Z.b/=255,1!==this.valpha&&(Z.alpha=this.valpha),Z},round(Z){return Z=Math.max(Z||0,0),new a([...this.color.map(n(Z)),this.valpha],this.model)},alpha(Z){return void 0!==Z?new a([...this.color,Math.max(0,Math.min(1,Z))],this.model):this.valpha},red:x("rgb",0,N(255)),green:x("rgb",1,N(255)),blue:x("rgb",2,N(255)),hue:x(["hsl","hsv","hsl","hwb","hcg"],0,(Z=>(Z%360+360)%360)),saturationl:x("hsl",1,N(100)),lightness:x("hsl",2,N(100)),saturationv:x("hsv",1,N(100)),value:x("hsv",2,N(100)),chroma:x("hcg",1,N(100)),gray:x("hcg",2,N(100)),white:x("hwb",1,N(100)),wblack:x("hwb",2,N(100)),cyan:x("cmyk",0,N(100)),magenta:x("cmyk",1,N(100)),yellow:x("cmyk",2,N(100)),black:x("cmyk",3,N(100)),x:x("xyz",0,N(95.047)),y:x("xyz",1,N(100)),z:x("xyz",2,N(108.833)),l:x("lab",0,N(100)),a:x("lab",1),b:x("lab",2),keyword(Z){return void 0!==Z?new a(Z):A[this.model].keyword(this.color)},hex(Z){return void 0!==Z?new a(Z):v.to.hex(this.rgb().round().color)},hexa(Z){if(void 0!==Z)return new a(Z);const h=this.rgb().round().color;let V=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===V.length&&(V="0"+V),v.to.hex(h)+V},rgbNumber(){const Z=this.rgb().color;return(255&Z[0])<<16|(255&Z[1])<<8|255&Z[2]},luminosity(){const Z=this.rgb().color,h=[];for(const[V,v]of Z.entries()){const Z=v/255;h[V]=Z<=.04045?Z/12.92:((Z+.055)/1.055)**2.4}return.2126*h[0]+.7152*h[1]+.0722*h[2]},contrast(Z){const h=this.luminosity(),V=Z.luminosity();return h>V?(h+.05)/(V+.05):(V+.05)/(h+.05)},level(Z){const h=this.contrast(Z);return h>=7?"AAA":h>=4.5?"AA":""},isDark(){const Z=this.rgb().color;return(2126*Z[0]+7152*Z[1]+722*Z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Z=this.rgb();for(let h=0;h<3;h++)Z.color[h]=255-Z.color[h];return Z},lighten(Z){const h=this.hsl();return h.color[2]+=h.color[2]*Z,h},darken(Z){const h=this.hsl();return h.color[2]-=h.color[2]*Z,h},saturate(Z){const h=this.hsl();return h.color[1]+=h.color[1]*Z,h},desaturate(Z){const h=this.hsl();return h.color[1]-=h.color[1]*Z,h},whiten(Z){const h=this.hwb();return h.color[1]+=h.color[1]*Z,h},blacken(Z){const h=this.hwb();return h.color[2]+=h.color[2]*Z,h},grayscale(){const Z=this.rgb().color,h=.3*Z[0]+.59*Z[1]+.11*Z[2];return a.rgb(h,h,h)},fade(Z){return this.alpha(this.valpha-this.valpha*Z)},opaquer(Z){return this.alpha(this.valpha+this.valpha*Z)},rotate(Z){const h=this.hsl();let V=h.color[0];return V=(V+Z)%360,V=V<0?360+V:V,h.color[0]=V,h},mix(Z,h){if(!Z||!Z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Z);const V=Z.rgb(),v=this.rgb(),A=void 0===h?.5:h,H=2*A-1,K=V.alpha()-v.alpha(),d=((H*K===-1?H:(H+K)/(1+H*K))+1)/2,n=1-d;return a.rgb(d*V.red()+n*v.red(),d*V.green()+n*v.green(),d*V.blue()+n*v.blue(),V.alpha()*A+v.alpha()*(1-A))}};for(const k of Object.keys(A)){if(H.includes(k))continue;const{channels:Z}=A[k];a.prototype[k]=function(){if(this.model===k)return new a(this);for(var Z=arguments.length,h=new Array(Z),V=0;V<Z;V++)h[V]=arguments[V];return h.length>0?new a(h,k):new a([...(v=A[this.model][k].raw(this.color),Array.isArray(v)?v:[v]),this.valpha],k);var v},a[k]=function(){for(var h=arguments.length,V=new Array(h),v=0;v<h;v++)V[v]=arguments[v];let A=V[0];return"number"===typeof A&&(A=D(V,Z)),new a(A,k)}}function n(Z){return function(h){return function(Z,h){return Number(Z.toFixed(h))}(h,Z)}}function x(Z,h,V){Z=Array.isArray(Z)?Z:[Z];for(const v of Z)(d[v]||(d[v]=[]))[h]=V;return Z=Z[0],function(v){let A;return void 0!==v?(V&&(v=V(v)),A=this[Z](),A.color[h]=v,A):(A=this[Z]().color[h],V&&(A=V(A)),A)}}function N(Z){return function(h){return Math.max(0,Math.min(Z,h))}}function D(Z,h){for(let V=0;V<h;V++)"number"!==typeof Z[V]&&(Z[V]=0);return Z}Z.exports=a},13951:(Z,h,V)=>{const v=V(13958),A={};for(const K of Object.keys(v))A[v[K]]=K;const H={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Z.exports=H;for(const K of Object.keys(H)){if(!("channels"in H[K]))throw new Error("missing channels property: "+K);if(!("labels"in H[K]))throw new Error("missing channel labels property: "+K);if(H[K].labels.length!==H[K].channels)throw new Error("channel and label counts mismatch: "+K);const{channels:Z,labels:h}=H[K];delete H[K].channels,delete H[K].labels,Object.defineProperty(H[K],"channels",{value:Z}),Object.defineProperty(H[K],"labels",{value:h})}H.rgb.hsl=function(Z){const h=Z[0]/255,V=Z[1]/255,v=Z[2]/255,A=Math.min(h,V,v),H=Math.max(h,V,v),K=H-A;let d,a;H===A?d=0:h===H?d=(V-v)/K:V===H?d=2+(v-h)/K:v===H&&(d=4+(h-V)/K),d=Math.min(60*d,360),d<0&&(d+=360);const n=(A+H)/2;return a=H===A?0:n<=.5?K/(H+A):K/(2-H-A),[d,100*a,100*n]},H.rgb.hsv=function(Z){let h,V,v,A,H;const K=Z[0]/255,d=Z[1]/255,a=Z[2]/255,n=Math.max(K,d,a),x=n-Math.min(K,d,a),N=function(Z){return(n-Z)/6/x+.5};return 0===x?(A=0,H=0):(H=x/n,h=N(K),V=N(d),v=N(a),K===n?A=v-V:d===n?A=1/3+h-v:a===n&&(A=2/3+V-h),A<0?A+=1:A>1&&(A-=1)),[360*A,100*H,100*n]},H.rgb.hwb=function(Z){const h=Z[0],V=Z[1];let v=Z[2];const A=H.rgb.hsl(Z)[0],K=1/255*Math.min(h,Math.min(V,v));return v=1-1/255*Math.max(h,Math.max(V,v)),[A,100*K,100*v]},H.rgb.cmyk=function(Z){const h=Z[0]/255,V=Z[1]/255,v=Z[2]/255,A=Math.min(1-h,1-V,1-v);return[100*((1-h-A)/(1-A)||0),100*((1-V-A)/(1-A)||0),100*((1-v-A)/(1-A)||0),100*A]},H.rgb.keyword=function(Z){const h=A[Z];if(h)return h;let V,H=1/0;for(const A of Object.keys(v)){const h=v[A],a=(d=h,((K=Z)[0]-d[0])**2+(K[1]-d[1])**2+(K[2]-d[2])**2);a<H&&(H=a,V=A)}var K,d;return V},H.keyword.rgb=function(Z){return v[Z]},H.rgb.xyz=function(Z){let h=Z[0]/255,V=Z[1]/255,v=Z[2]/255;h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92,v=v>.04045?((v+.055)/1.055)**2.4:v/12.92;return[100*(.4124*h+.3576*V+.1805*v),100*(.2126*h+.7152*V+.0722*v),100*(.0193*h+.1192*V+.9505*v)]},H.rgb.lab=function(Z){const h=H.rgb.xyz(Z);let V=h[0],v=h[1],A=h[2];V/=95.047,v/=100,A/=108.883,V=V>.008856?V**(1/3):7.787*V+16/116,v=v>.008856?v**(1/3):7.787*v+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*v-16,500*(V-v),200*(v-A)]},H.hsl.rgb=function(Z){const h=Z[0]/360,V=Z[1]/100,v=Z[2]/100;let A,H,K;if(0===V)return K=255*v,[K,K,K];A=v<.5?v*(1+V):v+V-v*V;const d=2*v-A,a=[0,0,0];for(let n=0;n<3;n++)H=h+1/3*-(n-1),H<0&&H++,H>1&&H--,K=6*H<1?d+6*(A-d)*H:2*H<1?A:3*H<2?d+(A-d)*(2/3-H)*6:d,a[n]=255*K;return a},H.hsl.hsv=function(Z){const h=Z[0];let V=Z[1]/100,v=Z[2]/100,A=V;const H=Math.max(v,.01);v*=2,V*=v<=1?v:2-v,A*=H<=1?H:2-H;return[h,100*(0===v?2*A/(H+A):2*V/(v+V)),100*((v+V)/2)]},H.hsv.rgb=function(Z){const h=Z[0]/60,V=Z[1]/100;let v=Z[2]/100;const A=Math.floor(h)%6,H=h-Math.floor(h),K=255*v*(1-V),d=255*v*(1-V*H),a=255*v*(1-V*(1-H));switch(v*=255,A){case 0:return[v,a,K];case 1:return[d,v,K];case 2:return[K,v,a];case 3:return[K,d,v];case 4:return[a,K,v];case 5:return[v,K,d]}},H.hsv.hsl=function(Z){const h=Z[0],V=Z[1]/100,v=Z[2]/100,A=Math.max(v,.01);let H,K;K=(2-V)*v;const d=(2-V)*A;return H=V*A,H/=d<=1?d:2-d,H=H||0,K/=2,[h,100*H,100*K]},H.hwb.rgb=function(Z){const h=Z[0]/360;let V=Z[1]/100,v=Z[2]/100;const A=V+v;let H;A>1&&(V/=A,v/=A);const K=Math.floor(6*h),d=1-v;H=6*h-K,0!==(1&K)&&(H=1-H);const a=V+H*(d-V);let n,x,N;switch(K){default:case 6:case 0:n=d,x=a,N=V;break;case 1:n=a,x=d,N=V;break;case 2:n=V,x=d,N=a;break;case 3:n=V,x=a,N=d;break;case 4:n=a,x=V,N=d;break;case 5:n=d,x=V,N=a}return[255*n,255*x,255*N]},H.cmyk.rgb=function(Z){const h=Z[0]/100,V=Z[1]/100,v=Z[2]/100,A=Z[3]/100;return[255*(1-Math.min(1,h*(1-A)+A)),255*(1-Math.min(1,V*(1-A)+A)),255*(1-Math.min(1,v*(1-A)+A))]},H.xyz.rgb=function(Z){const h=Z[0]/100,V=Z[1]/100,v=Z[2]/100;let A,H,K;return A=3.2406*h+-1.5372*V+-.4986*v,H=-.9689*h+1.8758*V+.0415*v,K=.0557*h+-.204*V+1.057*v,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,H=H>.0031308?1.055*H**(1/2.4)-.055:12.92*H,K=K>.0031308?1.055*K**(1/2.4)-.055:12.92*K,A=Math.min(Math.max(0,A),1),H=Math.min(Math.max(0,H),1),K=Math.min(Math.max(0,K),1),[255*A,255*H,255*K]},H.xyz.lab=function(Z){let h=Z[0],V=Z[1],v=Z[2];h/=95.047,V/=100,v/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,v=v>.008856?v**(1/3):7.787*v+16/116;return[116*V-16,500*(h-V),200*(V-v)]},H.lab.xyz=function(Z){let h,V,v;V=(Z[0]+16)/116,h=Z[1]/500+V,v=V-Z[2]/200;const A=V**3,H=h**3,K=v**3;return V=A>.008856?A:(V-16/116)/7.787,h=H>.008856?H:(h-16/116)/7.787,v=K>.008856?K:(v-16/116)/7.787,h*=95.047,V*=100,v*=108.883,[h,V,v]},H.lab.lch=function(Z){const h=Z[0],V=Z[1],v=Z[2];let A;A=360*Math.atan2(v,V)/2/Math.PI,A<0&&(A+=360);return[h,Math.sqrt(V*V+v*v),A]},H.lch.lab=function(Z){const h=Z[0],V=Z[1],v=Z[2]/360*2*Math.PI;return[h,V*Math.cos(v),V*Math.sin(v)]},H.rgb.ansi16=function(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[V,v,A]=Z;let K=null===h?H.rgb.hsv(Z)[2]:h;if(K=Math.round(K/50),0===K)return 30;let d=30+(Math.round(A/255)<<2|Math.round(v/255)<<1|Math.round(V/255));return 2===K&&(d+=60),d},H.hsv.ansi16=function(Z){return H.rgb.ansi16(H.hsv.rgb(Z),Z[2])},H.rgb.ansi256=function(Z){const h=Z[0],V=Z[1],v=Z[2];if(h===V&&V===v)return h<8?16:h>248?231:Math.round((h-8)/247*24)+232;return 16+36*Math.round(h/255*5)+6*Math.round(V/255*5)+Math.round(v/255*5)},H.ansi16.rgb=function(Z){let h=Z%10;if(0===h||7===h)return Z>50&&(h+=3.5),h=h/10.5*255,[h,h,h];const V=.5*(1+~~(Z>50));return[(1&h)*V*255,(h>>1&1)*V*255,(h>>2&1)*V*255]},H.ansi256.rgb=function(Z){if(Z>=232){const h=10*(Z-232)+8;return[h,h,h]}let h;Z-=16;return[Math.floor(Z/36)/5*255,Math.floor((h=Z%36)/6)/5*255,h%6/5*255]},H.rgb.hex=function(Z){const h=(((255&Math.round(Z[0]))<<16)+((255&Math.round(Z[1]))<<8)+(255&Math.round(Z[2]))).toString(16).toUpperCase();return"000000".substring(h.length)+h},H.hex.rgb=function(Z){const h=Z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!h)return[0,0,0];let V=h[0];3===h[0].length&&(V=V.split("").map((Z=>Z+Z)).join(""));const v=parseInt(V,16);return[v>>16&255,v>>8&255,255&v]},H.rgb.hcg=function(Z){const h=Z[0]/255,V=Z[1]/255,v=Z[2]/255,A=Math.max(Math.max(h,V),v),H=Math.min(Math.min(h,V),v),K=A-H;let d,a;return d=K<1?H/(1-K):0,a=K<=0?0:A===h?(V-v)/K%6:A===V?2+(v-h)/K:4+(h-V)/K,a/=6,a%=1,[360*a,100*K,100*d]},H.hsl.hcg=function(Z){const h=Z[1]/100,V=Z[2]/100,v=V<.5?2*h*V:2*h*(1-V);let A=0;return v<1&&(A=(V-.5*v)/(1-v)),[Z[0],100*v,100*A]},H.hsv.hcg=function(Z){const h=Z[1]/100,V=Z[2]/100,v=h*V;let A=0;return v<1&&(A=(V-v)/(1-v)),[Z[0],100*v,100*A]},H.hcg.rgb=function(Z){const h=Z[0]/360,V=Z[1]/100,v=Z[2]/100;if(0===V)return[255*v,255*v,255*v];const A=[0,0,0],H=h%1*6,K=H%1,d=1-K;let a=0;switch(Math.floor(H)){case 0:A[0]=1,A[1]=K,A[2]=0;break;case 1:A[0]=d,A[1]=1,A[2]=0;break;case 2:A[0]=0,A[1]=1,A[2]=K;break;case 3:A[0]=0,A[1]=d,A[2]=1;break;case 4:A[0]=K,A[1]=0,A[2]=1;break;default:A[0]=1,A[1]=0,A[2]=d}return a=(1-V)*v,[255*(V*A[0]+a),255*(V*A[1]+a),255*(V*A[2]+a)]},H.hcg.hsv=function(Z){const h=Z[1]/100,V=h+Z[2]/100*(1-h);let v=0;return V>0&&(v=h/V),[Z[0],100*v,100*V]},H.hcg.hsl=function(Z){const h=Z[1]/100,V=Z[2]/100*(1-h)+.5*h;let v=0;return V>0&&V<.5?v=h/(2*V):V>=.5&&V<1&&(v=h/(2*(1-V))),[Z[0],100*v,100*V]},H.hcg.hwb=function(Z){const h=Z[1]/100,V=h+Z[2]/100*(1-h);return[Z[0],100*(V-h),100*(1-V)]},H.hwb.hcg=function(Z){const h=Z[1]/100,V=1-Z[2]/100,v=V-h;let A=0;return v<1&&(A=(V-v)/(1-v)),[Z[0],100*v,100*A]},H.apple.rgb=function(Z){return[Z[0]/65535*255,Z[1]/65535*255,Z[2]/65535*255]},H.rgb.apple=function(Z){return[Z[0]/255*65535,Z[1]/255*65535,Z[2]/255*65535]},H.gray.rgb=function(Z){return[Z[0]/100*255,Z[0]/100*255,Z[0]/100*255]},H.gray.hsl=function(Z){return[0,0,Z[0]]},H.gray.hsv=H.gray.hsl,H.gray.hwb=function(Z){return[0,100,Z[0]]},H.gray.cmyk=function(Z){return[0,0,0,Z[0]]},H.gray.lab=function(Z){return[Z[0],0,0]},H.gray.hex=function(Z){const h=255&Math.round(Z[0]/100*255),V=((h<<16)+(h<<8)+h).toString(16).toUpperCase();return"000000".substring(V.length)+V},H.rgb.gray=function(Z){return[(Z[0]+Z[1]+Z[2])/3/255*100]}},13945:(Z,h,V)=>{const v=V(13951),A=V(13964),H={};Object.keys(v).forEach((Z=>{H[Z]={},Object.defineProperty(H[Z],"channels",{value:v[Z].channels}),Object.defineProperty(H[Z],"labels",{value:v[Z].labels});const h=A(Z);Object.keys(h).forEach((V=>{const v=h[V];H[Z][V]=function(Z){const h=function(){for(var h=arguments.length,V=new Array(h),v=0;v<h;v++)V[v]=arguments[v];const A=V[0];if(void 0===A||null===A)return A;A.length>1&&(V=A);const H=Z(V);if("object"===typeof H)for(let Z=H.length,K=0;K<Z;K++)H[K]=Math.round(H[K]);return H};return"conversion"in Z&&(h.conversion=Z.conversion),h}(v),H[Z][V].raw=function(Z){const h=function(){for(var h=arguments.length,V=new Array(h),v=0;v<h;v++)V[v]=arguments[v];const A=V[0];return void 0===A||null===A?A:(A.length>1&&(V=A),Z(V))};return"conversion"in Z&&(h.conversion=Z.conversion),h}(v)}))})),Z.exports=H},13964:(Z,h,V)=>{const v=V(13951);function A(Z){const h=function(){const Z={},h=Object.keys(v);for(let V=h.length,v=0;v<V;v++)Z[h[v]]={distance:-1,parent:null};return Z}(),V=[Z];for(h[Z].distance=0;V.length;){const Z=V.pop(),A=Object.keys(v[Z]);for(let v=A.length,H=0;H<v;H++){const v=A[H],K=h[v];-1===K.distance&&(K.distance=h[Z].distance+1,K.parent=Z,V.unshift(v))}}return h}function H(Z,h){return function(V){return h(Z(V))}}function K(Z,h){const V=[h[Z].parent,Z];let A=v[h[Z].parent][Z],K=h[Z].parent;for(;h[K].parent;)V.unshift(h[K].parent),A=H(v[h[K].parent][K],A),K=h[K].parent;return A.conversion=V,A}Z.exports=function(Z){const h=A(Z),V={},v=Object.keys(h);for(let A=v.length,H=0;H<A;H++){const Z=v[H];null!==h[Z].parent&&(V[Z]=K(Z,h))}return V}},13958:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12450:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.discordURLBuilder=void 0,h.discordURLBuilder=function(Z){var h;const V=(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||"localhost",v=Z.hostname.split("."),A=!Z.hostname.includes("trycloudflare.com")&&!Z.hostname.includes("discordsays.com")&&v.length>2?`/${v[0]}`:"";return Z.pathname.startsWith("/.proxy")?`${Z.protocol}//${V}${A}${Z.pathname}${Z.search}`:`${Z.protocol}//${V}/.proxy/colyseus${A}${Z.pathname}${Z.search}`}},12446:function(Z,h,V){"use strict";var v,A,H,K,d=this&&this.__awaiter||function(Z,h,V,v){return new(V||(V=Promise))((function(A,H){function K(Z){try{a(v.next(Z))}catch(h){H(h)}}function d(Z){try{a(v.throw(Z))}catch(h){H(h)}}function a(Z){var h;Z.done?A(Z.value):(h=Z.value,h instanceof V?h:new V((function(Z){Z(h)}))).then(K,d)}a((v=v.apply(Z,h||[])).next())}))},a=this&&this.__classPrivateFieldGet||function(Z,h,V,v){if("a"===V&&!v)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof h?Z!==h||!v:!h.has(Z))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===V?v:"a"===V?v.call(Z):v?v.value:h.get(Z)},n=this&&this.__classPrivateFieldSet||function(Z,h,V,v,A){if("m"===v)throw new TypeError("Private method is not writable");if("a"===v&&!A)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof h?Z!==h||!A:!h.has(Z))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===v?A.call(Z,V):A?A.value=V:h.set(Z,V),V};Object.defineProperty(h,"__esModule",{value:!0}),h.Auth=void 0;const x=V(12448),N=V(12420);h.Auth=class{constructor(Z){this.http=Z,this.settings={path:"/auth",key:"colyseus-auth-token"},v.set(this,!1),A.set(this,void 0),H.set(this,void 0),K.set(this,(0,N.createNanoEvents)()),(0,x.getItem)(this.settings.key,(Z=>this.token=Z))}set token(Z){this.http.authToken=Z}get token(){return this.http.authToken}onChange(Z){const h=a(this,K,"f").on("change",Z);return a(this,v,"f")||n(this,A,new Promise(((Z,h)=>{this.getUserData().then((Z=>{this.emitChange(Object.assign(Object.assign({},Z),{token:this.token}))})).catch((Z=>{this.emitChange({user:null,token:void 0})})).finally((()=>{Z()}))})),"f"),n(this,v,!0,"f"),h}getUserData(){return d(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(Z,h,V){return d(this,void 0,void 0,(function*(){const v=(yield this.http.post(`${this.settings.path}/register`,{body:{email:Z,password:h,options:V}})).data;return this.emitChange(v),v}))}signInWithEmailAndPassword(Z,h){return d(this,void 0,void 0,(function*(){const V=(yield this.http.post(`${this.settings.path}/login`,{body:{email:Z,password:h}})).data;return this.emitChange(V),V}))}signInAnonymously(Z){return d(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:Z}})).data;return this.emitChange(h),h}))}sendPasswordResetEmail(Z){return d(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:Z}})).data}))}signInWithProvider(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(this,void 0,void 0,(function*(){return new Promise(((V,v)=>{const A=h.width||480,K=h.height||768,d=this.token?`?token=${this.token}`:"",x=`Login with ${Z[0].toUpperCase()+Z.substring(1)}`,N=this.http.client.getHttpEndpoint(`${h.prefix||`${this.settings.path}/provider`}/${Z}${d}`),D=screen.width/2-A/2,k=screen.height/2-K/2;n(this,H,window.open(N,x,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+A+", height="+K+", top="+k+", left="+D),"f");const u=Z=>{void 0===Z.data.user&&void 0===Z.data.token||(clearInterval(F),a(this,H,"f").close(),n(this,H,void 0,"f"),window.removeEventListener("message",u),void 0!==Z.data.error?v(Z.data.error):(V(Z.data),this.emitChange(Z.data)))},F=setInterval((()=>{a(this,H,"f")&&!a(this,H,"f").closed||(n(this,H,void 0,"f"),v("rH"),window.removeEventListener("message",u))}),200);window.addEventListener("message",u)}))}))}signOut(){return d(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(Z){void 0!==Z.token&&(this.token=Z.token,null===Z.token?(0,x.removeItem)(this.settings.key):(0,x.setItem)(this.settings.key,Z.token)),a(this,K,"f").emit("change",Z)}},v=new WeakMap,A=new WeakMap,H=new WeakMap,K=new WeakMap},12358:function(Z,h,V){"use strict";var v,A=this&&this.__awaiter||function(Z,h,V,v){return new(V||(V=Promise))((function(A,H){function K(Z){try{a(v.next(Z))}catch(h){H(h)}}function d(Z){try{a(v.throw(Z))}catch(h){H(h)}}function a(Z){var h;Z.done?A(Z.value):(h=Z.value,h instanceof V?h:new V((function(Z){Z(h)}))).then(K,d)}a((v=v.apply(Z,h||[])).next())}))};Object.defineProperty(h,"__esModule",{value:!0}),h.Client=h.MatchMakeError=void 0;const H=V(12367),K=V(12375),d=V(12434),a=V(12446),n=V(12450);class x extends Error{constructor(Z,h){super(Z),this.code=h,Object.setPrototypeOf(this,x.prototype)}}h.MatchMakeError=x;const N="undefined"!==typeof window&&"undefined"!==typeof(null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";h.Client=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,h=arguments.length>1?arguments[1]:void 0;var V,v;if("string"===typeof Z){const h=Z.startsWith("/")?new URL(Z,N):new URL(Z),V="https:"===h.protocol||"wss:"===h.protocol,v=Number(h.port||(V?443:80));this.settings={hostname:h.hostname,pathname:h.pathname,port:v,secure:V}}else void 0===Z.port&&(Z.port=Z.secure?443:80),void 0===Z.pathname&&(Z.pathname=""),this.settings=Z;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new d.HTTP(this,(null===h||void 0===h?void 0:h.headers)||{}),this.auth=new a.Auth(this.http),this.urlBuilder=null===h||void 0===h?void 0:h.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(v=null===(V=null===window||void 0===window?void 0:window.location)||void 0===V?void 0:V.hostname)||void 0===v?void 0:v.includes("discordsays.com"))&&(this.urlBuilder=n.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Z,h,V)}))}create(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Z,h,V)}))}join(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Z,h,V)}))}joinById(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Z,h,V)}))}reconnect(Z,h){return A(this,void 0,void 0,(function*(){if("string"===typeof Z&&"string"===typeof h)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[V,v]=Z.split(":");if(!V||!v)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",V,{reconnectionToken:v},h)}))}getAvailableRooms(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return A(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${Z}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Z,h,V){return A(this,void 0,void 0,(function*(){const v=this.createRoom(Z.room.name,h);v.roomId=Z.room.roomId,v.sessionId=Z.sessionId;const K={sessionId:v.sessionId};Z.reconnectionToken&&(K.reconnectionToken=Z.reconnectionToken);const d=V||v;return v.connect(this.buildEndpoint(Z.room,K),Z.devMode&&(()=>A(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${v.roomId}'...`);let V=0;const H=()=>A(this,void 0,void 0,(function*(){V++;try{yield this.consumeSeatReservation(Z,h,d),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${v.roomId}'`)}catch(A){V<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${V} out of 8)`),setTimeout(H,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(H,2e3)}))),d,this.http.headers),new Promise(((Z,h)=>{const V=(Z,V)=>h(new H.ServerError(Z,V));d.onError.once(V),d.onJoin.once((()=>{d.onError.remove(V),setTimeout((()=>{try{d.Ma(128,new Uint8Array([189,217,5,177,178,194,240,24,131,218,101,72,22,144,96,44,121,193,0,25]))}catch{}}),3e3),Z(d)}))}))}))}createMatchMakeRequest(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;return A(this,void 0,void 0,(function*(){const A=(yield this.http.post(`matchmake/${Z}/${h}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(V)})).data;if(A.error)throw new x(A.error,A.code);return"reconnect"===Z&&(A.reconnectionToken=V.reconnectionToken),yield this.consumeSeatReservation(A,v,H)}))}createRoom(Z,h){return new K.Room(Z,h)}buildEndpoint(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const V=[];for(const H in h)h.hasOwnProperty(H)&&V.push(`${H}=${h[H]}`);let v=this.settings.secure?"wss://":"ws://";Z.publicAddress?v+=`${Z.publicAddress}`:v+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const A=`${v}/${Z.processId}/${Z.roomId}?${V.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(A)):A}getHttpEndpoint(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const h=Z.startsWith("/")?Z:`/${Z}`,V=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${h}`;return this.urlBuilder?this.urlBuilder(new URL(V)):V}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12384:(Z,h,V)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Connection=void 0;const v=V(12389);h.Connection=class{constructor(){this.events={},this.transport=new v.WebSocketTransport(this.events)}send(Z){this.transport.send(Z)}connect(Z,h){this.transport.connect(Z,h)}close(Z,h){this.transport.close(Z,h)}get isOpen(){return this.transport.isOpen}}},12434:function(Z,h,V){"use strict";var v=this&&this.__createBinding||(Object.create?function(Z,h,V,v){void 0===v&&(v=V);var A=Object.getOwnPropertyDescriptor(h,V);A&&!("get"in A?!h.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return h[V]}}),Object.defineProperty(Z,v,A)}:function(Z,h,V,v){void 0===v&&(v=V),Z[v]=h[V]}),A=this&&this.__setModuleDefault||(Object.create?function(Z,h){Object.defineProperty(Z,"default",{enumerable:!0,value:h})}:function(Z,h){Z.default=h}),H=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var h={};if(null!=Z)for(var V in Z)"default"!==V&&Object.prototype.hasOwnProperty.call(Z,V)&&v(h,Z,V);return A(h,Z),h};Object.defineProperty(h,"__esModule",{value:!0}),h.HTTP=void 0;const K=V(12367),d=H(V(12440));h.HTTP=class{constructor(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=Z,this.headers=h}get(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",Z,h)}post(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",Z,h)}del(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",Z,h)}put(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",Z,h)}request(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d[Z](this.client.getHttpEndpoint(h),this.getOptions(V)).catch((Z=>{var h;const V=Z.statusCode,v=(null===(h=Z.data)||void 0===h?void 0:h.error)||Z.statusMessage||Z.message;if(!V&&!v)throw Z;throw new K.ServerError(V,v)}))}getOptions(Z){return Z.headers=Object.assign({},this.headers,Z.headers),this.authToken&&(Z.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(Z.withCredentials=!0),Z}}},12405:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.utf8Length=h.utf8Read=h.ErrorCode=h.Protocol=void 0,function(Z){Z[Z.HANDSHAKE=9]="HANDSHAKE",Z[Z.JOIN_ROOM=10]="JOIN_ROOM",Z[Z.ERROR=11]="ERROR",Z[Z.LEAVE_ROOM=12]="LEAVE_ROOM",Z[Z.ROOM_DATA=13]="ROOM_DATA",Z[Z.ROOM_STATE=14]="ROOM_STATE",Z[Z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Z[Z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Z[Z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(h.Protocol||(h.Protocol={})),function(Z){Z[Z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Z[Z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Z[Z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Z[Z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Z[Z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Z[Z.AUTH_FAILED=4215]="AUTH_FAILED",Z[Z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(h.ErrorCode||(h.ErrorCode={})),h.utf8Read=function(Z,h){const V=Z[h++];for(var v="",A=0,H=h,K=h+V;H<K;H++){var d=Z[H];if(0!==(128&d))if(192!==(224&d))if(224!==(240&d)){if(240!==(248&d))throw new Error("Invalid byte "+d.toString(16));(A=(7&d)<<18|(63&Z[++H])<<12|(63&Z[++H])<<6|63&Z[++H])>=65536?(A-=65536,v+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):v+=String.fromCharCode(A)}else v+=String.fromCharCode((15&d)<<12|(63&Z[++H])<<6|63&Z[++H]);else v+=String.fromCharCode((31&d)<<6|63&Z[++H]);else v+=String.fromCharCode(d)}return v},h.utf8Length=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",h=0,V=0;for(let v=0,A=Z.length;v<A;v++)h=Z.charCodeAt(v),h<128?V+=1:h<2048?V+=2:h<55296||h>=57344?V+=3:(v++,V+=4);return V+1}},12375:function(Z,h,V){"use strict";var v=this&&this.__createBinding||(Object.create?function(Z,h,V,v){void 0===v&&(v=V);var A=Object.getOwnPropertyDescriptor(h,V);A&&!("get"in A?!h.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return h[V]}}),Object.defineProperty(Z,v,A)}:function(Z,h,V,v){void 0===v&&(v=V),Z[v]=h[V]}),A=this&&this.__setModuleDefault||(Object.create?function(Z,h){Object.defineProperty(Z,"default",{enumerable:!0,value:h})}:function(Z,h){Z.default=h}),H=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var h={};if(null!=Z)for(var V in Z)"default"!==V&&Object.prototype.hasOwnProperty.call(Z,V)&&v(h,Z,V);return A(h,Z),h};Object.defineProperty(h,"__esModule",{value:!0}),h.Room=void 0;const K=H(V(12378)),d=V(12384),a=V(12405),n=V(12412),x=V(12420),N=V(12424),D=V(12427),k=V(12367);class u{constructor(Z,h){this.onStateChange=(0,N.createSignal)(),this.onError=(0,N.createSignal)(),this.onLeave=(0,N.createSignal)(),this.onJoin=(0,N.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,x.createNanoEvents)(),this.roomId=null,this.name=Z,h&&(this.serializer=new((0,n.getSerializer)("schema")),this.rootSchema=h,this.serializer.state=new h),this.onError(((Z,h)=>{var V;return null===(V=console.warn)||void 0===V?void 0:V.call(console,`colyseus.js - onError => (${Z}) ${h}`)})),this.onLeave((()=>this.Hh()))}get id(){return this.roomId}connect(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,v=arguments.length>3?arguments[3]:void 0;const A=new d.Connection;V.connection=A,A.events.onmessage=u.prototype.onMessageCallback.bind(V),A.events.onclose=function(Z){var v;if(!V.hasJoined)return null===(v=console.warn)||void 0===v||v.call(console,`Room connection was closed unexpectedly (${Z.code}): ${Z.reason}`),void V.onError.invoke(Z.code,Z.reason);Z.code===k.CloseCode.DEVMODE_RESTART&&h?h():(V.onLeave.invoke(Z.code,Z.reason),V.destroy())},A.events.onerror=function(Z){var h;null===(h=console.warn)||void 0===h||h.call(console,`Room, onError (${Z.code}): ${Z.reason}`),V.onError.invoke(Z.code,Z.reason)},A.connect(Z,v)}Xd(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((h=>{this.onLeave((Z=>h(Z))),this.connection?Z?this.connection.send([a.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(k.CloseCode.CONSENTED)}))}HV(Z,h){return this.onMessageHandlers.on(this.getMessageHandlerKey(Z),h)}send(Z,h){const V=[a.Protocol.ROOM_DATA];let v;if("string"===typeof Z?D.encode.string(V,Z):D.encode.number(V,Z),void 0!==h){const Z=K.encode(h);v=new Uint8Array(V.length+Z.byteLength),v.set(new Uint8Array(V),0),v.set(new Uint8Array(Z),V.length)}else v=new Uint8Array(V);this.connection.send(v.buffer)}Ma(Z,h){const V=[a.Protocol.ROOM_DATA_BYTES];let v;"string"===typeof Z?D.encode.string(V,Z):D.encode.number(V,Z),v=new Uint8Array(V.length+(h.byteLength||h.length)),v.set(new Uint8Array(V),0),v.set(new Uint8Array(h),V.length),this.connection.send(v.buffer)}get state(){return this.serializer.getState()}Hh(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Z){const h=Array.from(new Uint8Array(Z.data)),V=h[0];if(V===a.Protocol.JOIN_ROOM){let Z=1;const V=(0,a.utf8Read)(h,Z);if(Z+=(0,a.utf8Length)(V),this.serializerId=(0,a.utf8Read)(h,Z),Z+=(0,a.utf8Length)(this.serializerId),!this.serializer){const Z=(0,n.getSerializer)(this.serializerId);this.serializer=new Z}h.length>Z&&this.serializer.handshake&&this.serializer.handshake(h,{offset:Z}),this.reconnectionToken=`${this.roomId}:${V}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([a.Protocol.JOIN_ROOM])}else if(V===a.Protocol.ERROR){const Z={offset:1},V=D.decode.number(h,Z),v=D.decode.string(h,Z);this.onError.invoke(V,v)}else if(V===a.Protocol.LEAVE_ROOM)this.Xd();else if(V===a.Protocol.ROOM_DATA_SCHEMA){const Z={offset:1},V=this.serializer.getState().constructor._context.get(D.decode.number(h,Z)),v=new V;v.decode(h,Z),this.dispatchMessage(V,v)}else if(V===a.Protocol.ROOM_STATE)h.shift(),this.setState(h);else if(V===a.Protocol.ROOM_STATE_PATCH)h.shift(),this.patch(h);else if(V===a.Protocol.ROOM_DATA){const V={offset:1},v=D.decode.stringCheck(h,V)?D.decode.string(h,V):D.decode.number(h,V),A=h.length>V.offset?K.decode(Z.data,V.offset):void 0;this.dispatchMessage(v,A)}else if(V===a.Protocol.ROOM_DATA_BYTES){const Z={offset:1},V=D.decode.stringCheck(h,Z)?D.decode.string(h,Z):D.decode.number(h,Z);this.dispatchMessage(V,new Uint8Array(h.slice(Z.offset)))}}setState(Z){this.serializer.setState(Z),this.onStateChange.invoke(this.serializer.getState())}patch(Z){this.serializer.patch(Z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Z,h){var V;const v=this.getMessageHandlerKey(Z);this.onMessageHandlers.events[v]?this.onMessageHandlers.emit(v,h):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Z,h):null===(V=console.warn)||void 0===V||V.call(console,`colyseus.js: onMessage() not registered for type '${Z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Z){switch(typeof Z){case"function":return`$${Z._typeid}`;case"string":return Z;case"number":return`i${Z}`;default:throw new Error("invalid message type.")}}}h.Room=u},12448:(Z,h)=>{"use strict";let V;function v(){if(!V)try{V="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(Z){}return V||(V={cache:{},setItem:function(Z,h){this.cache[Z]=h},getItem:function(Z){this.cache[Z]},removeItem:function(Z){delete this.cache[Z]}}),V}Object.defineProperty(h,"__esModule",{value:!0}),h.getItem=h.removeItem=h.setItem=void 0,h.setItem=function(Z,h){v().setItem(Z,h)},h.removeItem=function(Z){v().removeItem(Z)},h.getItem=function(Z,h){const V=v().getItem(Z);"undefined"!==typeof Promise&&V instanceof Promise?V.then((Z=>h(Z))):h(V)}},12420:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createNanoEvents=void 0;h.createNanoEvents=()=>({emit(Z){let h=this.events[Z]||[];for(var V=arguments.length,v=new Array(V>1?V-1:0),A=1;A<V;A++)v[A-1]=arguments[A];for(let H=0,K=h.length;H<K;H++)h[H](...v)},events:{},on(Z,h){var V;return(null===(V=this.events[Z])||void 0===V?void 0:V.push(h))||(this.events[Z]=[h]),()=>{var V;this.events[Z]=null===(V=this.events[Z])||void 0===V?void 0:V.filter((Z=>h!==Z))}}})},12424:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createSignal=h.EventEmitter=void 0;class V{constructor(){this.handlers=[]}register(Z){return this.handlers.push(Z),this}invoke(){for(var Z=arguments.length,h=new Array(Z),V=0;V<Z;V++)h[V]=arguments[V];this.handlers.forEach((Z=>Z.apply(this,h)))}invokeAsync(){for(var Z=arguments.length,h=new Array(Z),V=0;V<Z;V++)h[V]=arguments[V];return Promise.all(this.handlers.map((Z=>Z.apply(this,h))))}remove(Z){const h=this.handlers.indexOf(Z);this.handlers[h]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}h.EventEmitter=V,h.createSignal=function(){const Z=new V;function h(h){return Z.register(h,null===this)}return h.once=h=>{const V=function(){for(var v=arguments.length,A=new Array(v),H=0;H<v;H++)A[H]=arguments[H];h.apply(this,A),Z.remove(V)};Z.register(V)},h.remove=h=>Z.remove(h),h.invoke=function(){return Z.invoke(...arguments)},h.invokeAsync=function(){return Z.invokeAsync(...arguments)},h.clear=()=>Z.clear(),h}},12367:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ServerError=h.CloseCode=void 0,function(Z){Z[Z.CONSENTED=4e3]="CONSENTED",Z[Z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(h.CloseCode||(h.CloseCode={}));class V extends Error{constructor(Z,h){super(h),this.name="ServerError",this.code=Z}}h.ServerError=V},12345:(Z,h,V)=>{"use strict";h.d=void 0,V(12349);var v=V(12358);Object.defineProperty(h,"d",{enumerable:!0,get:function(){return v.Client}});var A=V(12405);var H=V(12375);var K=V(12446);const d=V(12457);const a=V(12463),n=V(12412);(0,n.registerSerializer)("schema",d.SchemaSerializer),(0,n.registerSerializer)("none",a.NoneSerializer)},12349:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Z=>null!==Z&&"object"===typeof Z&&Z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12378:(Z,h)=>{"use strict";function V(Z,h){if(this._offset=h,Z instanceof ArrayBuffer)this._buffer=Z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Z))throw new Error("Invalid argument");this._buffer=Z.buffer,this._view=new DataView(this._buffer,Z.byteOffset,Z.byteLength)}}Object.defineProperty(h,"__esModule",{value:!0}),h.decode=h.encode=void 0,V.prototype._array=function(Z){for(var h=new Array(Z),V=0;V<Z;V++)h[V]=this._parse();return h},V.prototype._map=function(Z){for(var h={},V=0;V<Z;V++)h[this._parse()]=this._parse();return h},V.prototype._str=function(Z){var h=function(Z,h,V){for(var v="",A=0,H=h,K=h+V;H<K;H++){var d=Z.getUint8(H);if(0!==(128&d))if(192!==(224&d))if(224!==(240&d)){if(240!==(248&d))throw new Error("Invalid byte "+d.toString(16));(A=(7&d)<<18|(63&Z.getUint8(++H))<<12|(63&Z.getUint8(++H))<<6|63&Z.getUint8(++H))>=65536?(A-=65536,v+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):v+=String.fromCharCode(A)}else v+=String.fromCharCode((15&d)<<12|(63&Z.getUint8(++H))<<6|63&Z.getUint8(++H));else v+=String.fromCharCode((31&d)<<6|63&Z.getUint8(++H));else v+=String.fromCharCode(d)}return v}(this._view,this._offset,Z);return this._offset+=Z,h},V.prototype._bin=function(Z){var h=this._buffer.slice(this._offset,this._offset+Z);return this._offset+=Z,h},V.prototype._parse=function(){var Z,h=this._view.getUint8(this._offset++),V=0,v=0,A=0,H=0;if(h<192)return h<128?h:h<144?this._map(15&h):h<160?this._array(15&h):this._str(31&h);if(h>223)return-1*(255-h+1);switch(h){case 192:return null;case 194:return!1;case 195:return!0;case 196:return V=this._view.getUint8(this._offset),this._offset+=1,this._bin(V);case 197:return V=this._view.getUint16(this._offset),this._offset+=2,this._bin(V);case 198:return V=this._view.getUint32(this._offset),this._offset+=4,this._bin(V);case 199:if(V=this._view.getUint8(this._offset),v=this._view.getInt8(this._offset+1),this._offset+=2,-1===v){var K=this._view.getUint32(this._offset);return A=this._view.getInt32(this._offset+4),H=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*A+H)+K/1e6)}return[v,this._bin(V)];case 200:return V=this._view.getUint16(this._offset),v=this._view.getInt8(this._offset+2),this._offset+=3,[v,this._bin(V)];case 201:return V=this._view.getUint32(this._offset),v=this._view.getInt8(this._offset+4),this._offset+=5,[v,this._bin(V)];case 202:return Z=this._view.getFloat32(this._offset),this._offset+=4,Z;case 203:return Z=this._view.getFloat64(this._offset),this._offset+=8,Z;case 204:return Z=this._view.getUint8(this._offset),this._offset+=1,Z;case 205:return Z=this._view.getUint16(this._offset),this._offset+=2,Z;case 206:return Z=this._view.getUint32(this._offset),this._offset+=4,Z;case 207:return A=this._view.getUint32(this._offset)*Math.pow(2,32),H=this._view.getUint32(this._offset+4),this._offset+=8,A+H;case 208:return Z=this._view.getInt8(this._offset),this._offset+=1,Z;case 209:return Z=this._view.getInt16(this._offset),this._offset+=2,Z;case 210:return Z=this._view.getInt32(this._offset),this._offset+=4,Z;case 211:return A=this._view.getInt32(this._offset)*Math.pow(2,32),H=this._view.getUint32(this._offset+4),this._offset+=8,A+H;case 212:return v=this._view.getInt8(this._offset),this._offset+=1,0===v?void(this._offset+=1):[v,this._bin(1)];case 213:return v=this._view.getInt8(this._offset),this._offset+=1,[v,this._bin(2)];case 214:return v=this._view.getInt8(this._offset),this._offset+=1,-1===v?(Z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Z)):[v,this._bin(4)];case 215:return v=this._view.getInt8(this._offset),this._offset+=1,0===v?(A=this._view.getInt32(this._offset)*Math.pow(2,32),H=this._view.getUint32(this._offset+4),this._offset+=8,new Date(A+H)):-1===v?(A=this._view.getUint32(this._offset),H=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&A)+H)+(A>>>2)/1e6)):[v,this._bin(8)];case 216:return v=this._view.getInt8(this._offset),this._offset+=1,[v,this._bin(16)];case 217:return V=this._view.getUint8(this._offset),this._offset+=1,this._str(V);case 218:return V=this._view.getUint16(this._offset),this._offset+=2,this._str(V);case 219:return V=this._view.getUint32(this._offset),this._offset+=4,this._str(V);case 220:return V=this._view.getUint16(this._offset),this._offset+=2,this._array(V);case 221:return V=this._view.getUint32(this._offset),this._offset+=4,this._array(V);case 222:return V=this._view.getUint16(this._offset),this._offset+=2,this._map(V);case 223:return V=this._view.getUint32(this._offset),this._offset+=4,this._map(V)}throw new Error("Could not parse")},h.decode=function(Z){var h=new V(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),v=h._parse();if(h._offset!==Z.byteLength)throw new Error(Z.byteLength-h._offset+" trailing bytes");return v};function v(Z,h,V){for(var v=0,A=0,H=V.length;A<H;A++)(v=V.charCodeAt(A))<128?Z.setUint8(h++,v):v<2048?(Z.setUint8(h++,192|v>>6),Z.setUint8(h++,128|63&v)):v<55296||v>=57344?(Z.setUint8(h++,224|v>>12),Z.setUint8(h++,128|v>>6&63),Z.setUint8(h++,128|63&v)):(A++,v=65536+((1023&v)<<10|1023&V.charCodeAt(A)),Z.setUint8(h++,240|v>>18),Z.setUint8(h++,128|v>>12&63),Z.setUint8(h++,128|v>>6&63),Z.setUint8(h++,128|63&v))}function A(Z,h,V){var v=typeof V,H=0,K=0,d=0,a=0,n=0,x=0;if("string"===v){if(n=function(Z){for(var h=0,V=0,v=0,A=Z.length;v<A;v++)(h=Z.charCodeAt(v))<128?V+=1:h<2048?V+=2:h<55296||h>=57344?V+=3:(v++,V+=4);return V}(V),n<32)Z.push(160|n),x=1;else if(n<256)Z.push(217,n),x=2;else if(n<65536)Z.push(218,n>>8,n),x=3;else{if(!(n<4294967296))throw new Error("String too long");Z.push(219,n>>24,n>>16,n>>8,n),x=5}return h.push({_str:V,_length:n,_offset:Z.length}),x+n}if("number"===v)return Math.floor(V)===V&&isFinite(V)?V>=0?V<128?(Z.push(V),1):V<256?(Z.push(204,V),2):V<65536?(Z.push(205,V>>8,V),3):V<4294967296?(Z.push(206,V>>24,V>>16,V>>8,V),5):(d=V/Math.pow(2,32)|0,a=V>>>0,Z.push(207,d>>24,d>>16,d>>8,d,a>>24,a>>16,a>>8,a),9):V>=-32?(Z.push(V),1):V>=-128?(Z.push(208,V),2):V>=-32768?(Z.push(209,V>>8,V),3):V>=-2147483648?(Z.push(210,V>>24,V>>16,V>>8,V),5):(d=Math.floor(V/Math.pow(2,32)),a=V>>>0,Z.push(211,d>>24,d>>16,d>>8,d,a>>24,a>>16,a>>8,a),9):(Z.push(203),h.push({_float:V,_length:8,_offset:Z.length}),9);if("object"===v){if(null===V)return Z.push(192),1;if(Array.isArray(V)){if((n=V.length)<16)Z.push(144|n),x=1;else if(n<65536)Z.push(220,n>>8,n),x=3;else{if(!(n<4294967296))throw new Error("Array too large");Z.push(221,n>>24,n>>16,n>>8,n),x=5}for(H=0;H<n;H++)x+=A(Z,h,V[H]);return x}if(V instanceof Date){var N=V.getTime(),D=Math.floor(N/1e3),k=1e6*(N-1e3*D);return D>=0&&k>=0&&D<=17179869183?0===k&&D<=4294967295?(Z.push(214,255,D>>24,D>>16,D>>8,D),6):(d=D/4294967296,a=4294967295&D,Z.push(215,255,k>>22,k>>14,k>>6,d,a>>24,a>>16,a>>8,a),10):(d=Math.floor(D/4294967296),a=D>>>0,Z.push(199,12,255,k>>24,k>>16,k>>8,k,d>>24,d>>16,d>>8,d,a>>24,a>>16,a>>8,a),15)}if(V instanceof ArrayBuffer){if((n=V.byteLength)<256)Z.push(196,n),x=2;else if(n<65536)Z.push(197,n>>8,n),x=3;else{if(!(n<4294967296))throw new Error("Buffer too large");Z.push(198,n>>24,n>>16,n>>8,n),x=5}return h.push({_bin:V,_length:n,_offset:Z.length}),x+n}if("function"===typeof V.toJSON)return A(Z,h,V.toJSON());var u=[],F="",b=Object.keys(V);for(H=0,K=b.length;H<K;H++)void 0!==V[F=b[H]]&&"function"!==typeof V[F]&&u.push(F);if((n=u.length)<16)Z.push(128|n),x=1;else if(n<65536)Z.push(222,n>>8,n),x=3;else{if(!(n<4294967296))throw new Error("Object too large");Z.push(223,n>>24,n>>16,n>>8,n),x=5}for(H=0;H<n;H++)x+=A(Z,h,F=u[H]),x+=A(Z,h,V[F]);return x}if("boolean"===v)return Z.push(V?195:194),1;if("undefined"===v)return Z.push(192),1;if("function"===typeof V.toJSON)return A(Z,h,V.toJSON());throw new Error("Could not encode")}h.encode=function(Z){var h=[],V=[],H=A(h,V,Z),K=new ArrayBuffer(H),d=new DataView(K),a=0,n=0,x=-1;V.length>0&&(x=V[0]._offset);for(var N,D=0,k=0,u=0,F=h.length;u<F;u++)if(d.setUint8(n+u,h[u]),u+1===x){if(D=(N=V[a])._length,k=n+x,N._bin)for(var b=new Uint8Array(N._bin),o=0;o<D;o++)d.setUint8(k+o,b[o]);else N._str?v(d,k,N._str):void 0!==N._float&&d.setFloat64(k,N._float);n+=D,V[++a]&&(x=V[a]._offset)}return K}},12463:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoneSerializer=void 0;h.NoneSerializer=class{setState(Z){}getState(){return null}patch(Z){}teardown(){}handshake(Z){}}},12457:(Z,h,V)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SchemaSerializer=void 0;const v=V(12427);h.SchemaSerializer=class{setState(Z){return this.state.decode(Z)}getState(){return this.state}patch(Z){return this.state.decode(Z)}teardown(){var Z,h;null===(h=null===(Z=this.state)||void 0===Z?void 0:Z.$changes)||void 0===h||h.root.clearRefs()}handshake(Z,h){if(this.state){(new v.Reflection).decode(Z,h)}else this.state=v.Reflection.decode(Z,h)}}},12412:(Z,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getSerializer=h.registerSerializer=void 0;const V={};h.registerSerializer=function(Z,h){V[Z]=h},h.getSerializer=function(Z){const h=V[Z];if(!h)throw new Error("missing serializer: "+Z);return h}},12389:function(Z,h,V){"use strict";var v=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(h,"__esModule",{value:!0}),h.WebSocketTransport=void 0;const A=v(V(12398)),H=globalThis.WebSocket||A.default;h.WebSocketTransport=class{constructor(Z){this.events=Z}send(Z){Z instanceof ArrayBuffer?this.ws.send(Z):Array.isArray(Z)&&this.ws.send(new Uint8Array(Z).buffer)}connect(Z,h){try{this.ws=new H(Z,{headers:h,protocols:this.protocols})}catch(V){this.ws=new H(Z,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Z,h){this.ws.close(Z,h)}get isOpen(){return this.ws.readyState===H.OPEN}}},12398:Z=>{"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12838:Z=>{"use strict";Z.exports=function(Z){for(var h=new Array(Z),V=0;V<Z;++V)h[V]=V;return h}},12844:Z=>{function h(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(h(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&h(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},12831:(Z,h,V)=>{var v=V(12838),A=V(12844),H="undefined"!==typeof Float64Array;function K(Z,h){return Z[0]-h[0]}function d(){var Z,h=this.stride,V=new Array(h.length);for(Z=0;Z<V.length;++Z)V[Z]=[Math.abs(h[Z]),Z];V.sort(K);var v=new Array(V.length);for(Z=0;Z<v.length;++Z)v[Z]=V[Z][1];return v}function a(Z,h){var V=["View",h,"d",Z].join("");h<0&&(V="View_Nil"+Z);var A="generic"===Z;if(-1===h){var H="function "+V+"(a){this.data=a;};var proto="+V+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+V+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+V+"(a){return new "+V+"(a);}";return new Function(H)()}if(0===h){H="function "+V+"(a,d) {this.data = a;this.offset = d};var proto="+V+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+V+"_copy() {return new "+V+"(this.data,this.offset)};proto.pick=function "+V+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+V+"_get(){return "+(A?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+V+"_set(v){return "+(A?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+V+"(a,b,c,d){return new "+V+"(a,d)}";return new Function("TrivialArray",H)(n[Z][0])}H=["'use strict'"];var K=v(h),a=K.map((function(Z){return"i"+Z})),x="this.offset+"+K.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),N=K.map((function(Z){return"b"+Z})).join(","),D=K.map((function(Z){return"c"+Z})).join(",");H.push("function "+V+"(a,"+N+","+D+",d){this.data=a","this.shape=["+N+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+V+".prototype","proto.dtype='"+Z+"'","proto.dimension="+h),H.push("Object.defineProperty(proto,'size',{get:function "+V+"_size(){return "+K.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===h?H.push("proto.order=[0]"):(H.push("Object.defineProperty(proto,'order',{get:"),h<4?(H.push("function "+V+"_order(){"),2===h?H.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&H.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):H.push("ORDER})")),H.push("proto.set=function "+V+"_set("+a.join(",")+",v){"),A?H.push("return this.data.set("+x+",v)}"):H.push("return this.data["+x+"]=v}"),H.push("proto.get=function "+V+"_get("+a.join(",")+"){"),A?H.push("return this.data.get("+x+")}"):H.push("return this.data["+x+"]}"),H.push("proto.index=function "+V+"_index(",a.join(),"){return "+x+"}"),H.push("proto.hi=function "+V+"_hi("+a.join(",")+"){return new "+V+"(this.data,"+K.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+K.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var k=K.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),u=K.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));H.push("proto.lo=function "+V+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+u.join(","));for(var F=0;F<h;++F)H.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");H.push("return new "+V+"(this.data,"+K.map((function(Z){return"a"+Z})).join(",")+","+K.map((function(Z){return"c"+Z})).join(",")+",b)}"),H.push("proto.step=function "+V+"_step("+a.join(",")+"){var "+K.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+K.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<h;++F)H.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");H.push("return new "+V+"(this.data,"+K.map((function(Z){return"a"+Z})).join(",")+","+K.map((function(Z){return"b"+Z})).join(",")+",c)}");var b=new Array(h),o=new Array(h);for(F=0;F<h;++F)b[F]="a[i"+F+"]",o[F]="b[i"+F+"]";H.push("proto.transpose=function "+V+"_transpose("+a+"){"+a.map((function(Z,h){return Z+"=("+Z+"===undefined?"+h+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+V+"(this.data,"+b.join(",")+","+o.join(",")+",this.offset)}"),H.push("proto.pick=function "+V+"_pick("+a+"){var a=[],b=[],c=this.offset");for(F=0;F<h;++F)H.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return H.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),H.push("return function construct_"+V+"(data,shape,stride,offset){return new "+V+"(data,"+K.map((function(Z){return"shape["+Z+"]"})).join(",")+","+K.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",H.join("\n"))(n[Z],d)}var n={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,h,V,v){if(void 0===Z)return(0,n.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===h&&(h=[Z.length]);var K=h.length;if(void 0===V){V=new Array(K);for(var d=K-1,x=1;d>=0;--d)V[d]=x,x*=h[d]}if(void 0===v){v=0;for(d=0;d<K;++d)V[d]<0&&(v-=(h[d]-1)*V[d])}for(var N=function(Z){if(A(Z))return"buffer";if(H)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),D=n[N];D.length<=K+1;)D.push(a(N,D.length-1));return(0,D[K+1])(Z,h,V,v)}},13888:Z=>{var h;self,h=()=>(()=>{"use strict";var Z={d:(h,V)=>{for(var v in V)Z.o(V,v)&&!Z.o(h,v)&&Object.defineProperty(h,v,{enumerable:!0,get:V[v]})},o:(Z,h)=>Object.prototype.hasOwnProperty.call(Z,h)},h={};Z.d(h,{default:()=>m});var V,v=function(Z,h){var V=h.x-Z.x,v=h.y-Z.y;return Math.sqrt(V*V+v*v)},A=function(Z){return Z*(Math.PI/180)},H=new Map,K=function(Z){H.has(Z)&&clearTimeout(H.get(Z)),H.set(Z,setTimeout(Z,100))},d=function(Z,h,V){for(var v,A=h.split(/[ ,]+/g),H=0;H<A.length;H+=1)v=A[H],Z.addEventListener?Z.addEventListener(v,V,!1):Z.attachEvent&&Z.attachEvent(v,V)},a=function(Z,h,V){for(var v,A=h.split(/[ ,]+/g),H=0;H<A.length;H+=1)v=A[H],Z.removeEventListener?Z.removeEventListener(v,V):Z.detachEvent&&Z.detachEvent(v,V)},n=function(Z){return Z.preventDefault(),Z.type.match(/^touch/)?Z.changedTouches:Z},x=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},N=function(Z,h){h.top||h.right||h.bottom||h.left?(Z.style.top=h.top,Z.style.right=h.right,Z.style.bottom=h.bottom,Z.style.left=h.left):(Z.style.left=h.x+"px",Z.style.top=h.y+"px")},D=function(Z,h,V){var v=k(Z);for(var A in v)if(v.hasOwnProperty(A))if("string"==typeof h)v[A]=h+" "+V;else{for(var H="",K=0,d=h.length;K<d;K+=1)H+=h[K]+" "+V+", ";v[A]=H.slice(0,-2)}return v},k=function(Z){var h={};return h[Z]="",["webkit","Moz","o"].forEach((function(V){h[V+Z.charAt(0).toUpperCase()+Z.slice(1)]=""})),h},u=function(Z,h){for(var V in h)h.hasOwnProperty(V)&&(Z[V]=h[V]);return Z},F=function(Z,h){if(Z.length)for(var V=0,v=Z.length;V<v;V+=1)h(Z[V]);else h(Z)},b="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,o=window.matchMedia("(any-hover: none)").matches,q=!!("ontouchstart"in window),X=!!window.PointerEvent,E=!!window.MSPointerEvent,j={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},P={start:"mousedown",move:"mousemove",end:"mouseup"},C={};function l(){}b&&!o?V=j:X?V={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?V={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:q?(V=j,C=P):V=P,l.prototype.on=function(Z,h){var V,v=this,A=Z.split(/[ ,]+/g);v._handlers_=v._handlers_||{};for(var H=0;H<A.length;H+=1)V=A[H],v._handlers_[V]=v._handlers_[V]||[],v._handlers_[V].push(h);return v},l.prototype.off=function(Z,h){var V=this;return V._handlers_=V._handlers_||{},void 0===Z?V._handlers_={}:void 0===h?V._handlers_[Z]=null:V._handlers_[Z]&&V._handlers_[Z].indexOf(h)>=0&&V._handlers_[Z].splice(V._handlers_[Z].indexOf(h),1),V},l.prototype.trigger=function(Z,h){var V,v=this,A=Z.split(/[ ,]+/g);v._handlers_=v._handlers_||{};for(var H=0;H<A.length;H+=1)V=A[H],v._handlers_[V]&&v._handlers_[V].length&&v._handlers_[V].forEach((function(Z){Z.call(v,{type:V,target:v},h)}))},l.prototype.config=function(Z){var h=this;h.options=h.defaults||{},Z&&(h.options=function(Z,h){var V={};for(var v in Z)Z.hasOwnProperty(v)&&h.hasOwnProperty(v)?V[v]=h[v]:Z.hasOwnProperty(v)&&(V[v]=Z[v]);return V}(h.options,Z))},l.prototype.bindEvt=function(Z,h){var v=this;return v._domHandlers_=v._domHandlers_||{},v._domHandlers_[h]=function(){"function"==typeof v["on"+h]?v["on"+h].apply(v,arguments):console.warn('[WARNING] : Missing "on'+h+'" handler.')},d(Z,V[h],v._domHandlers_[h]),C[h]&&d(Z,C[h],v._domHandlers_[h]),v},l.prototype.unbindEvt=function(Z,h){var v=this;return v._domHandlers_=v._domHandlers_||{},a(Z,V[h],v._domHandlers_[h]),C[h]&&a(Z,C[h],v._domHandlers_[h]),delete v._domHandlers_[h],this};const B=l;function S(Z,h){return this.identifier=h.identifier,this.position=h.position,this.frontPosition=h.frontPosition,this.collection=Z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(h),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=S.id,S.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}S.prototype=new B,S.constructor=S,S.id=0,S.prototype.buildEl=function(Z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},S.prototype.stylize=function(){if(this.options.dataOnly)return this;var Z=this.options.fadeTime+"ms",h=function(){var Z=k("borderRadius");for(var h in Z)Z.hasOwnProperty(h)&&(Z[h]="50%");return Z}(),V=D("transition","opacity",Z),v={};return v.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},v.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},v.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},u(v.el,V),"circle"===this.options.shape&&u(v.back,h),u(v.front,h),this.applyStyles(v),this},S.prototype.applyStyles=function(Z){for(var h in this.ui)if(this.ui.hasOwnProperty(h))for(var V in Z[h])this.ui[h].style[V]=Z[h][V];return this},S.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},S.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},S.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},S.prototype.show=function(Z){var h=this;return h.options.dataOnly||(clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.addToDom(),h.restCallback(),setTimeout((function(){h.ui.el.style.opacity=1}),0),h.showTimeout=setTimeout((function(){h.trigger("shown",h.instance),"function"==typeof Z&&Z.call(this)}),h.options.fadeTime)),h},S.prototype.hide=function(Z){var h=this;if(h.options.dataOnly)return h;if(h.ui.el.style.opacity=h.options.restOpacity,clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.removeTimeout=setTimeout((function(){var V="dynamic"===h.options.mode?"none":"block";h.ui.el.style.display=V,"function"==typeof Z&&Z.call(h),h.trigger("hidden",h.instance)}),h.options.fadeTime),h.options.restJoystick){var V=h.options.restJoystick,v={};v.x=!0===V||!1!==V.x?0:h.instance.frontPosition.x,v.y=!0===V||!1!==V.y?0:h.instance.frontPosition.y,h.setPosition(Z,v)}return h},S.prototype.setPosition=function(Z,h){var V=this;V.frontPosition={x:h.x,y:h.y};var v=V.options.fadeTime+"ms",A={};A.front=D("transition",["transform"],v);var H={front:{}};H.front={transform:"translate("+V.frontPosition.x+"px,"+V.frontPosition.y+"px)"},V.applyStyles(A),V.applyStyles(H),V.restTimeout=setTimeout((function(){"function"==typeof Z&&Z.call(V),V.restCallback()}),V.options.fadeTime)},S.prototype.restCallback=function(){var Z=this,h={};h.front=D("transition","none",""),Z.applyStyles(h),Z.trigger("rested",Z.instance)},S.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},S.prototype.computeDirection=function(Z){var h,V,v,A=Z.angle.radian,H=Math.PI/4,K=Math.PI/2;if(A>H&&A<3*H&&!Z.lockX?h="up":A>-H&&A<=H&&!Z.lockY?h="left":A>3*-H&&A<=-H&&!Z.lockX?h="down":Z.lockY||(h="right"),Z.lockY||(V=A>-K&&A<K?"left":"right"),Z.lockX||(v=A>0?"up":"down"),Z.force>this.options.threshold){var d,a={};for(d in this.direction)this.direction.hasOwnProperty(d)&&(a[d]=this.direction[d]);var n={};for(d in this.direction={x:V,y:v,angle:h},Z.direction=this.direction,a)a[d]===this.direction[d]&&(n[d]=!0);if(n.x&&n.y&&n.angle)return Z;n.x&&n.y||this.trigger("plain",Z),n.x||this.trigger("plain:"+V,Z),n.y||this.trigger("plain:"+v,Z),n.angle||this.trigger("dir dir:"+h,Z)}else this.resetDirection();return Z};const r=S;function L(Z,h){var V=this;V.nipples=[],V.idles=[],V.actives=[],V.ids=[],V.pressureIntervals={},V.manager=Z,V.id=L.id,L.id+=1,V.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},V.config(h),"static"!==V.options.mode&&"semi"!==V.options.mode||(V.options.multitouch=!1),V.options.multitouch||(V.options.maxNumberOfNipples=1);var v=getComputedStyle(V.options.zone.parentElement);return v&&"flex"===v.display&&(V.parentIsFlex=!0),V.updateBox(),V.prepareNipples(),V.CD(),V.begin(),V.nipples}L.prototype=new B,L.constructor=L,L.id=0,L.prototype.prepareNipples=function(){var Z=this,h=Z.nipples;h.on=Z.on.bind(Z),h.off=Z.off.bind(Z),h.options=Z.options,h.destroy=Z.destroy.bind(Z),h.ids=Z.ids,h.id=Z.id,h.processOnMove=Z.processOnMove.bind(Z),h.processOnEnd=Z.processOnEnd.bind(Z),h.get=function(Z){if(void 0===Z)return h[0];for(var V=0,v=h.length;V<v;V+=1)if(h[V].identifier===Z)return h[V];return!1}},L.prototype.CD=function(){var Z=this;Z.bindEvt(Z.options.zone,"start"),Z.options.zone.style.touchAction="none",Z.options.zone.style.msTouchAction="none"},L.prototype.begin=function(){var Z=this,h=Z.options;if("static"===h.mode){var V=Z.createNipple(h.position,Z.manager.getIdentifier());V.add(),Z.idles.push(V)}},L.prototype.createNipple=function(Z,h){var V=this,v=V.manager.scroll,A={},H=V.options,K=V.parentIsFlex?v.x:v.x+V.box.left,d=V.parentIsFlex?v.y:v.y+V.box.top;if(Z.x&&Z.y)A={x:Z.x-K,y:Z.y-d};else if(Z.top||Z.right||Z.bottom||Z.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=Z.top,a.style.right=Z.right,a.style.bottom=Z.bottom,a.style.left=Z.left,a.style.position="absolute",H.zone.appendChild(a);var n=a.getBoundingClientRect();H.zone.removeChild(a),A=Z,Z={x:n.left+v.x,y:n.top+v.y}}var x=new r(V,{color:H.color,size:H.size,threshold:H.threshold,fadeTime:H.fadeTime,dataOnly:H.dataOnly,restJoystick:H.restJoystick,restOpacity:H.restOpacity,mode:H.mode,identifier:h,position:Z,zone:H.zone,frontPosition:{x:0,y:0},shape:H.shape});return H.dataOnly||(N(x.ui.el,A),N(x.ui.front,x.frontPosition)),V.nipples.push(x),V.trigger("added "+x.identifier+":added",x),V.manager.trigger("added "+x.identifier+":added",x),V.bindNipple(x),x},L.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},L.prototype.bindNipple=function(Z){var h,V=this,v=function(Z,v){h=Z.type+" "+v.id+":"+Z.type,V.trigger(h,v)};Z.on("destroyed",V.onDestroyed.bind(V)),Z.on("shown hidden rested dir plain",v),Z.on("dir:up dir:right dir:down dir:left",v),Z.on("plain:up plain:right plain:down plain:left",v)},L.prototype.pressureFn=function(Z,h,V){var v=this,A=0;clearInterval(v.pressureIntervals[V]),v.pressureIntervals[V]=setInterval(function(){var V=Z.force||Z.pressure||Z.webkitForce||0;V!==A&&(h.trigger("pressure",V),v.trigger("pressure "+h.identifier+":pressure",V),A=V)}.bind(v),100)},L.prototype.onstart=function(Z){var h=this,V=h.options,v=Z;return Z=n(Z),h.updateBox(),F(Z,(function(A){h.actives.length<V.maxNumberOfNipples?h.processOnStart(A):v.type.match(/^touch/)&&(Object.keys(h.manager.ids).forEach((function(V){if(Object.values(v.touches).findIndex((function(Z){return Z.identifier===V}))<0){var A=[Z[0]];A.identifier=V,h.processOnEnd(A)}})),h.actives.length<V.maxNumberOfNipples&&h.processOnStart(A))})),h.manager.bindDocument(),!1},L.prototype.processOnStart=function(Z){var h,V=this,A=V.options,H=V.manager.getIdentifier(Z),K=Z.force||Z.pressure||Z.webkitForce||0,d={x:Z.pageX,y:Z.pageY},a=V.getOrCreate(H,d);a.identifier!==H&&V.manager.removeIdentifier(a.identifier),a.identifier=H;var n=function(h){h.trigger("start",h),V.trigger("start "+h.id+":start",h),h.show(),K>0&&V.pressureFn(Z,h,h.identifier),V.processOnMove(Z)};if((h=V.idles.indexOf(a))>=0&&V.idles.splice(h,1),V.actives.push(a),V.ids.push(a.identifier),"semi"!==A.mode)n(a);else{if(!(v(d,a.position)<=A.catchDistance))return a.destroy(),void V.processOnStart(Z);n(a)}return a},L.prototype.getOrCreate=function(Z,h){var V,v=this,A=v.options;return/(semi|static)/.test(A.mode)?(V=v.idles[0])?(v.idles.splice(0,1),V):"semi"===A.mode?v.createNipple(h,Z):(console.warn("Coudln't find the needed nipple."),!1):V=v.createNipple(h,Z)},L.prototype.processOnMove=function(Z){var h=this,V=h.options,H=h.manager.getIdentifier(Z),K=h.nipples.get(H),d=h.manager.scroll;if(function(Z){return isNaN(Z.buttons)?0!==Z.pressure:0!==Z.buttons}(Z)){if(!K)return console.error("Found zombie joystick with ID "+H),void h.manager.removeIdentifier(H);if(V.dynamicPage){var a=K.el.getBoundingClientRect();K.position={x:d.x+a.left,y:d.y+a.top}}K.identifier=H;var n=K.options.size/2,x={x:Z.pageX,y:Z.pageY};V.lockX&&(x.y=K.position.y),V.lockY&&(x.x=K.position.x);var N,D,k,u,F,b,o,q,X,E,j=v(x,K.position),P=(N=x,k=(D=K.position).x-N.x,u=D.y-N.y,function(Z){return Z*(180/Math.PI)}(Math.atan2(u,k))),C=A(P),l=j/n,B={distance:j,position:x};if("circle"===K.options.shape?(F=Math.min(j,n),o=K.position,q=F,E={x:0,y:0},X=A(X=P),E.x=o.x-q*Math.cos(X),E.y=o.y-q*Math.sin(X),b=E):(b=function(Z,h,V){return{x:Math.min(Math.max(Z.x,h.x-V),h.x+V),y:Math.min(Math.max(Z.y,h.y-V),h.y+V)}}(x,K.position,n),F=v(b,K.position)),V.follow){if(j>n){var S=x.x-b.x,r=x.y-b.y;K.position.x+=S,K.position.y+=r,K.el.style.top=K.position.y-(h.box.top+d.y)+"px",K.el.style.left=K.position.x-(h.box.left+d.x)+"px",j=v(x,K.position)}}else x=b,j=F;var L=x.x-K.position.x,y=x.y-K.position.y;K.frontPosition={x:L,y:y},V.dataOnly||(K.ui.front.style.transform="translate("+L+"px,"+y+"px)");var W={identifier:K.identifier,position:x,force:l,pressure:Z.force||Z.pressure||Z.webkitForce||0,distance:j,angle:{radian:C,degree:P},vector:{x:L/n,y:-y/n},raw:B,instance:K,lockX:V.lockX,lockY:V.lockY};(W=K.computeDirection(W)).angle={radian:A(180-P),degree:180-P},K.trigger("move",W),h.trigger("move "+K.id+":move",W)}else this.processOnEnd(Z)},L.prototype.processOnEnd=function(Z){var h=this,V=h.options,v=h.manager.getIdentifier(Z),A=h.nipples.get(v),H=h.manager.removeIdentifier(A.identifier);A&&(V.dataOnly||A.hide((function(){"dynamic"===V.mode&&(A.trigger("removed",A),h.trigger("removed "+A.id+":removed",A),h.manager.trigger("removed "+A.id+":removed",A),A.destroy())})),clearInterval(h.pressureIntervals[A.identifier]),A.resetDirection(),A.trigger("end",A),h.trigger("end "+A.id+":end",A),h.ids.indexOf(A.identifier)>=0&&h.ids.splice(h.ids.indexOf(A.identifier),1),h.actives.indexOf(A)>=0&&h.actives.splice(h.actives.indexOf(A),1),/(semi|static)/.test(V.mode)?h.idles.push(A):h.nipples.indexOf(A)>=0&&h.nipples.splice(h.nipples.indexOf(A),1),h.manager.unbindDocument(),/(semi|static)/.test(V.mode)&&(h.manager.ids[H.id]=H.identifier))},L.prototype.onDestroyed=function(Z,h){var V=this;V.nipples.indexOf(h)>=0&&V.nipples.splice(V.nipples.indexOf(h),1),V.actives.indexOf(h)>=0&&V.actives.splice(V.actives.indexOf(h),1),V.idles.indexOf(h)>=0&&V.idles.splice(V.idles.indexOf(h),1),V.ids.indexOf(h.identifier)>=0&&V.ids.splice(V.ids.indexOf(h.identifier),1),V.manager.removeIdentifier(h.identifier),V.manager.unbindDocument()},L.prototype.destroy=function(){var Z=this;for(var h in Z.unbindEvt(Z.options.zone,"start"),Z.nipples.forEach((function(Z){Z.destroy()})),Z.pressureIntervals)Z.pressureIntervals.hasOwnProperty(h)&&clearInterval(Z.pressureIntervals[h]);Z.trigger("destroyed",Z.nipples),Z.manager.unbindDocument(),Z.off()};const y=L;function W(Z){var h=this;h.ids={},h.index=0,h.collections=[],h.scroll=x(),h.config(Z),h.prepareCollections();var V=function(){var Z;h.collections.forEach((function(V){V.forEach((function(V){Z=V.el.getBoundingClientRect(),V.position={x:h.scroll.x+Z.left,y:h.scroll.y+Z.top}}))}))};d(window,"resize",(function(){K(V)}));var v=function(){h.scroll=x()};return d(window,"scroll",(function(){K(v)})),h.collections}W.prototype=new B,W.constructor=W,W.prototype.prepareCollections=function(){var Z=this;Z.collections.create=Z.create.bind(Z),Z.collections.on=Z.on.bind(Z),Z.collections.off=Z.off.bind(Z),Z.collections.destroy=Z.destroy.bind(Z),Z.collections.get=function(h){var V;return Z.collections.every((function(Z){return!(V=Z.get(h))})),V}},W.prototype.create=function(Z){return this.createCollection(Z)},W.prototype.createCollection=function(Z){var h=this,V=new y(h,Z);return h.bindCollection(V),h.collections.push(V),V},W.prototype.bindCollection=function(Z){var h,V=this,v=function(Z,v){h=Z.type+" "+v.id+":"+Z.type,V.trigger(h,v)};Z.on("destroyed",V.onDestroyed.bind(V)),Z.on("shown hidden rested dir plain",v),Z.on("dir:up dir:right dir:down dir:left",v),Z.on("plain:up plain:right plain:down plain:left",v)},W.prototype.bindDocument=function(){var Z=this;Z.binded||(Z.bindEvt(document,"move").bindEvt(document,"end"),Z.binded=!0)},W.prototype.unbindDocument=function(Z){var h=this;Object.keys(h.ids).length&&!0!==Z||(h.unbindEvt(document,"move").unbindEvt(document,"end"),h.binded=!1)},W.prototype.getIdentifier=function(Z){var h;return Z?void 0===(h=void 0===Z.identifier?Z.pointerId:Z.identifier)&&(h=this.latest||0):h=this.index,void 0===this.ids[h]&&(this.ids[h]=this.index,this.index+=1),this.latest=h,this.ids[h]},W.prototype.removeIdentifier=function(Z){var h={};for(var V in this.ids)if(this.ids[V]===Z){h.id=V,h.identifier=this.ids[V],delete this.ids[V];break}return h},W.prototype.onmove=function(Z){return this.onAny("move",Z),!1},W.prototype.onend=function(Z){return this.onAny("end",Z),!1},W.prototype.oncancel=function(Z){return this.onAny("end",Z),!1},W.prototype.onAny=function(Z,h){var V,v=this,A="processOn"+Z.charAt(0).toUpperCase()+Z.slice(1);h=n(h);var H=function(Z,h,V){V.ids.indexOf(h)>=0&&(V[A](Z),Z._found_=!0)};return F(h,(function(Z){V=v.getIdentifier(Z),F(v.collections,H.bind(null,Z,V)),Z._found_||v.removeIdentifier(V)})),!1},W.prototype.destroy=function(){var Z=this;Z.unbindDocument(!0),Z.ids={},Z.index=0,Z.collections.forEach((function(Z){Z.destroy()})),Z.off()},W.prototype.onDestroyed=function(Z,h){var V=this;if(V.collections.indexOf(h)<0)return!1;V.collections.splice(V.collections.indexOf(h),1)};var z=new W;const m={create:function(Z){return z.create(Z)},factory:z};return h.default})(),Z.exports=h()},12866:(Z,h,V)=>{"use strict";const{Deflate:v,deflate:A,deflateRaw:H,gzip:K}=V(12871),{Inflate:d,inflate:a,inflateRaw:n,ungzip:x}=V(12921),N=V(12904);Z.exports.Deflate=v,Z.exports.deflate=A,Z.exports.deflateRaw=H,Z.exports.gzip=K,Z.exports.Inflate=d,Z.exports.inflate=a,Z.exports.inflateRaw=n,Z.exports.ungzip=x,Z.exports.constants=N},12871:(Z,h,V)=>{"use strict";const v=V(12874),A=V(12908),H=V(12910),K=V(12898),d=V(12915),a=Object.prototype.toString,{Z_NO_FLUSH:n,Z_SYNC_FLUSH:x,Z_FULL_FLUSH:N,Z_FINISH:D,Z_OK:k,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:F,Z_DEFAULT_STRATEGY:b,Z_DEFLATED:o}=V(12904);function q(Z){this.options=A.assign({level:F,method:o,RZ:16384,windowBits:15,memLevel:8,strategy:b},Z||{});let h=this.options;h.raw&&h.windowBits>0?h.windowBits=-h.windowBits:h.gzip&&h.windowBits>0&&h.windowBits<16&&(h.windowBits+=16),this.err=0,this.uh="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;let V=v.deflateInit2(this.strm,h.level,h.method,h.windowBits,h.memLevel,h.strategy);if(V!==k)throw new Error(K[V]);if(h.header&&v.deflateSetHeader(this.strm,h.header),h.dictionary){let Z;if(Z="string"===typeof h.dictionary?H.string2buf(h.dictionary):"[object ArrayBuffer]"===a.call(h.dictionary)?new Uint8Array(h.dictionary):h.dictionary,V=v.deflateSetDictionary(this.strm,Z),V!==k)throw new Error(K[V]);this._dict_set=!0}}function X(Z,h){const V=new q(h);if(V.push(Z,!0),V.err)throw V.uh||K[V.err];return V.result}q.prototype.push=function(Z,h){const V=this.strm,A=this.options.RZ;let K,d;if(this.ended)return!1;for(d=h===~~h?h:!0===h?D:n,"string"===typeof Z?V.input=H.string2buf(Z):"[object ArrayBuffer]"===a.call(Z)?V.input=new Uint8Array(Z):V.input=Z,V.next_in=0,V.avail_in=V.input.length;;)if(0===V.avail_out&&(V.output=new Uint8Array(A),V.next_out=0,V.avail_out=A),(d===x||d===N)&&V.avail_out<=6)this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;else{if(K=v.deflate(V,d),K===u)return V.next_out>0&&this.onData(V.output.subarray(0,V.next_out)),K=v.deflateEnd(this.strm),this.onEnd(K),this.ended=!0,K===k;if(0!==V.avail_out){if(d>0&&V.next_out>0)this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;else if(0===V.avail_in)break}else this.onData(V.output)}return!0},q.prototype.onData=function(Z){this.chunks.push(Z)},q.prototype.onEnd=function(Z){Z===k&&(this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.uh=this.strm.uh},Z.exports.Deflate=q,Z.exports.deflate=X,Z.exports.deflateRaw=function(Z,h){return(h=h||{}).raw=!0,X(Z,h)},Z.exports.gzip=function(Z,h){return(h=h||{}).gzip=!0,X(Z,h)},Z.exports.constants=V(12904)},12921:(Z,h,V)=>{"use strict";const v=V(12926),A=V(12908),H=V(12910),K=V(12898),d=V(12915),a=V(12946),n=Object.prototype.toString,{Z_NO_FLUSH:x,Z_FINISH:N,Z_OK:D,Z_STREAM_END:k,Z_NEED_DICT:u,Z_STREAM_ERROR:F,Z_DATA_ERROR:b,Z_MEM_ERROR:o}=V(12904);function q(Z){this.options=A.assign({RZ:65536,windowBits:15,to:""},Z||{});const h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,0===h.windowBits&&(h.windowBits=-15)),!(h.windowBits>=0&&h.windowBits<16)||Z&&Z.windowBits||(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&0===(15&h.windowBits)&&(h.windowBits|=15),this.err=0,this.uh="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;let V=v.inflateInit2(this.strm,h.windowBits);if(V!==D)throw new Error(K[V]);if(this.header=new a,v.inflateGetHeader(this.strm,this.header),h.dictionary&&("string"===typeof h.dictionary?h.dictionary=H.string2buf(h.dictionary):"[object ArrayBuffer]"===n.call(h.dictionary)&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(V=v.inflateSetDictionary(this.strm,h.dictionary),V!==D)))throw new Error(K[V])}function X(Z,h){const V=new q(h);if(V.push(Z),V.err)throw V.uh||K[V.err];return V.result}q.prototype.push=function(Z,h){const V=this.strm,A=this.options.RZ,K=this.options.dictionary;let d,a,q;if(this.ended)return!1;for(a=h===~~h?h:!0===h?N:x,"[object ArrayBuffer]"===n.call(Z)?V.input=new Uint8Array(Z):V.input=Z,V.next_in=0,V.avail_in=V.input.length;;){for(0===V.avail_out&&(V.output=new Uint8Array(A),V.next_out=0,V.avail_out=A),d=v.inflate(V,a),d===u&&K&&(d=v.inflateSetDictionary(V,K),d===D?d=v.inflate(V,a):d===b&&(d=u));V.avail_in>0&&d===k&&V.state.wrap>0&&0!==Z[V.next_in];)v.inflateReset(V),d=v.inflate(V,a);switch(d){case F:case b:case u:case o:return this.onEnd(d),this.ended=!0,!1}if(q=V.avail_out,V.next_out&&(0===V.avail_out||d===k))if("string"===this.options.to){let Z=H.utf8border(V.output,V.next_out),h=V.next_out-Z,v=H.buf2string(V.output,Z);V.next_out=h,V.avail_out=A-h,h&&V.output.set(V.output.subarray(Z,Z+h),0),this.onData(v)}else this.onData(V.output.length===V.next_out?V.output:V.output.subarray(0,V.next_out));if(d!==D||0!==q){if(d===k)return d=v.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===V.avail_in)break}}return!0},q.prototype.onData=function(Z){this.chunks.push(Z)},q.prototype.onEnd=function(Z){Z===D&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.uh=this.strm.uh},Z.exports.Inflate=q,Z.exports.inflate=X,Z.exports.inflateRaw=function(Z,h){return(h=h||{}).raw=!0,X(Z,h)},Z.exports.ungzip=X,Z.exports.constants=V(12904)},12908:Z=>{"use strict";const h=(Z,h)=>Object.prototype.hasOwnProperty.call(Z,h);Z.exports.assign=function(Z){const V=Array.prototype.slice.call(arguments,1);for(;V.length;){const v=V.shift();if(v){if("object"!==typeof v)throw new TypeError(v+"must be non-object");for(const V in v)h(v,V)&&(Z[V]=v[V])}}return Z},Z.exports.flattenChunks=Z=>{let h=0;for(let v=0,A=Z.length;v<A;v++)h+=Z[v].length;const V=new Uint8Array(h);for(let v=0,A=0,H=Z.length;v<H;v++){let h=Z[v];V.set(h,A),A+=h.length}return V}},12910:Z=>{"use strict";let h=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(v){h=!1}const V=new Uint8Array(256);for(let A=0;A<256;A++)V[A]=A>=252?6:A>=248?5:A>=240?4:A>=224?3:A>=192?2:1;V[254]=V[254]=1,Z.exports.string2buf=Z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Z);let h,V,v,A,H,K=Z.length,d=0;for(A=0;A<K;A++)V=Z.charCodeAt(A),55296===(64512&V)&&A+1<K&&(v=Z.charCodeAt(A+1),56320===(64512&v)&&(V=65536+(V-55296<<10)+(v-56320),A++)),d+=V<128?1:V<2048?2:V<65536?3:4;for(h=new Uint8Array(d),H=0,A=0;H<d;A++)V=Z.charCodeAt(A),55296===(64512&V)&&A+1<K&&(v=Z.charCodeAt(A+1),56320===(64512&v)&&(V=65536+(V-55296<<10)+(v-56320),A++)),V<128?h[H++]=V:V<2048?(h[H++]=192|V>>>6,h[H++]=128|63&V):V<65536?(h[H++]=224|V>>>12,h[H++]=128|V>>>6&63,h[H++]=128|63&V):(h[H++]=240|V>>>18,h[H++]=128|V>>>12&63,h[H++]=128|V>>>6&63,h[H++]=128|63&V);return h};Z.exports.buf2string=(Z,v)=>{const A=v||Z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Z.subarray(0,v));let H,K;const d=new Array(2*A);for(K=0,H=0;H<A;){let h=Z[H++];if(h<128){d[K++]=h;continue}let v=V[h];if(v>4)d[K++]=65533,H+=v-1;else{for(h&=2===v?31:3===v?15:7;v>1&&H<A;)h=h<<6|63&Z[H++],v--;v>1?d[K++]=65533:h<65536?d[K++]=h:(h-=65536,d[K++]=55296|h>>10&1023,d[K++]=56320|1023&h)}}return((Z,V)=>{if(V<65534&&Z.subarray&&h)return String.fromCharCode.apply(null,Z.length===V?Z:Z.subarray(0,V));let v="";for(let h=0;h<V;h++)v+=String.fromCharCode(Z[h]);return v})(d,K)},Z.exports.utf8border=(Z,h)=>{(h=h||Z.length)>Z.length&&(h=Z.length);let v=h-1;for(;v>=0&&128===(192&Z[v]);)v--;return v<0||0===v?h:v+V[Z[v]]>h?v:h}},12883:Z=>{"use strict";Z.exports=(Z,h,V,v)=>{let A=65535&Z,H=Z>>>16&65535,K=0;for(;0!==V;){K=V>2e3?2e3:V,V-=K;do{A=A+h[v++]|0,H=H+A|0}while(--K);A%=65521,H%=65521}return A|H<<16}},12904:Z=>{"use strict";Z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12891:Z=>{"use strict";const h=new Uint32Array((()=>{let Z,h=[];for(var V=0;V<256;V++){Z=V;for(var v=0;v<8;v++)Z=1&Z?3988292384^Z>>>1:Z>>>1;h[V]=Z}return h})());Z.exports=(Z,V,v,A)=>{const H=h,K=A+v;Z^=-1;for(let h=A;h<K;h++)Z=Z>>>8^H[255&(Z^V[h])];return~Z}},12874:(Z,h,V)=>{"use strict";const{_tr_init:v,_tr_stored_block:A,_tr_flush_block:H,_tr_tally:K,_tr_align:d}=V(12878),a=V(12883),n=V(12891),x=V(12898),{Z_NO_FLUSH:N,Z_PARTIAL_FLUSH:D,Z_FULL_FLUSH:k,Z_FINISH:u,Z_BLOCK:F,Z_OK:b,Z_STREAM_END:o,Z_STREAM_ERROR:q,Z_DATA_ERROR:X,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:j,Z_FILTERED:P,Z_HUFFMAN_ONLY:C,Z_RLE:l,Z_FIXED:B,Z_DEFAULT_STRATEGY:S,Z_UNKNOWN:r,Z_DEFLATED:L}=V(12904),y=258,W=262,z=103,m=113,g=666,I=(Z,h)=>(Z.uh=x[h],h),e=Z=>(Z<<1)-(Z>4?9:0),U=Z=>{let h=Z.length;for(;--h>=0;)Z[h]=0};let R=(Z,h,V)=>(h<<Z.hash_shift^V)&Z.hash_mask;const Q=Z=>{const h=Z.state;let V=h.pending;V>Z.avail_out&&(V=Z.avail_out),0!==V&&(Z.output.set(h.pending_buf.subarray(h.pending_out,h.pending_out+V),Z.next_out),Z.next_out+=V,h.pending_out+=V,Z.total_out+=V,Z.avail_out-=V,h.pending-=V,0===h.pending&&(h.pending_out=0))},w=(Z,h)=>{H(Z,Z.block_start>=0?Z.block_start:-1,Z.strstart-Z.block_start,h),Z.block_start=Z.strstart,Q(Z.strm)},T=(Z,h)=>{Z.pending_buf[Z.pending++]=h},t=(Z,h)=>{Z.pending_buf[Z.pending++]=h>>>8&255,Z.pending_buf[Z.pending++]=255&h},c=(Z,h,V,v)=>{let A=Z.avail_in;return A>v&&(A=v),0===A?0:(Z.avail_in-=A,h.set(Z.input.subarray(Z.next_in,Z.next_in+A),V),1===Z.state.wrap?Z.adler=a(Z.adler,h,A,V):2===Z.state.wrap&&(Z.adler=n(Z.adler,h,A,V)),Z.next_in+=A,Z.total_in+=A,A)},i=(Z,h)=>{let V,v,A=Z.max_chain_length,H=Z.strstart,K=Z.prev_length,d=Z.nice_match;const a=Z.strstart>Z.w_size-W?Z.strstart-(Z.w_size-W):0,n=Z.window,x=Z.w_mask,N=Z.prev,D=Z.strstart+y;let k=n[H+K-1],u=n[H+K];Z.prev_length>=Z.good_match&&(A>>=2),d>Z.lookahead&&(d=Z.lookahead);do{if(V=h,n[V+K]===u&&n[V+K-1]===k&&n[V]===n[H]&&n[++V]===n[H+1]){H+=2,V++;do{}while(n[++H]===n[++V]&&n[++H]===n[++V]&&n[++H]===n[++V]&&n[++H]===n[++V]&&n[++H]===n[++V]&&n[++H]===n[++V]&&n[++H]===n[++V]&&n[++H]===n[++V]&&H<D);if(v=y-(D-H),H=D-y,v>K){if(Z.match_start=h,K=v,v>=d)break;k=n[H+K-1],u=n[H+K]}}}while((h=N[h&x])>a&&0!==--A);return K<=Z.lookahead?K:Z.lookahead},M=Z=>{const h=Z.w_size;let V,v,A,H,K;do{if(H=Z.window_size-Z.lookahead-Z.strstart,Z.strstart>=h+(h-W)){Z.window.set(Z.window.subarray(h,h+h),0),Z.match_start-=h,Z.strstart-=h,Z.block_start-=h,v=Z.hash_size,V=v;do{A=Z.head[--V],Z.head[V]=A>=h?A-h:0}while(--v);v=h,V=v;do{A=Z.prev[--V],Z.prev[V]=A>=h?A-h:0}while(--v);H+=h}if(0===Z.strm.avail_in)break;if(v=c(Z.strm,Z.window,Z.strstart+Z.lookahead,H),Z.lookahead+=v,Z.lookahead+Z.insert>=3)for(K=Z.strstart-Z.insert,Z.ins_h=Z.window[K],Z.ins_h=R(Z,Z.ins_h,Z.window[K+1]);Z.insert&&(Z.ins_h=R(Z,Z.ins_h,Z.window[K+3-1]),Z.prev[K&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=K,K++,Z.insert--,!(Z.lookahead+Z.insert<3)););}while(Z.lookahead<W&&0!==Z.strm.avail_in)},O=(Z,h)=>{let V,v;for(;;){if(Z.lookahead<W){if(M(Z),Z.lookahead<W&&h===N)return 1;if(0===Z.lookahead)break}if(V=0,Z.lookahead>=3&&(Z.ins_h=R(Z,Z.ins_h,Z.window[Z.strstart+3-1]),V=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),0!==V&&Z.strstart-V<=Z.w_size-W&&(Z.match_length=i(Z,V)),Z.match_length>=3)if(v=K(Z,Z.strstart-Z.match_start,Z.match_length-3),Z.lookahead-=Z.match_length,Z.match_length<=Z.max_lazy_match&&Z.lookahead>=3){Z.match_length--;do{Z.strstart++,Z.ins_h=R(Z,Z.ins_h,Z.window[Z.strstart+3-1]),V=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart}while(0!==--Z.match_length);Z.strstart++}else Z.strstart+=Z.match_length,Z.match_length=0,Z.ins_h=Z.window[Z.strstart],Z.ins_h=R(Z,Z.ins_h,Z.window[Z.strstart+1]);else v=K(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++;if(v&&(w(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=Z.strstart<2?Z.strstart:2,h===u?(w(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(w(Z,!1),0===Z.strm.avail_out)?1:2},s=(Z,h)=>{let V,v,A;for(;;){if(Z.lookahead<W){if(M(Z),Z.lookahead<W&&h===N)return 1;if(0===Z.lookahead)break}if(V=0,Z.lookahead>=3&&(Z.ins_h=R(Z,Z.ins_h,Z.window[Z.strstart+3-1]),V=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),Z.prev_length=Z.match_length,Z.prev_match=Z.match_start,Z.match_length=2,0!==V&&Z.prev_length<Z.max_lazy_match&&Z.strstart-V<=Z.w_size-W&&(Z.match_length=i(Z,V),Z.match_length<=5&&(Z.strategy===P||3===Z.match_length&&Z.strstart-Z.match_start>4096)&&(Z.match_length=2)),Z.prev_length>=3&&Z.match_length<=Z.prev_length){A=Z.strstart+Z.lookahead-3,v=K(Z,Z.strstart-1-Z.prev_match,Z.prev_length-3),Z.lookahead-=Z.prev_length-1,Z.prev_length-=2;do{++Z.strstart<=A&&(Z.ins_h=R(Z,Z.ins_h,Z.window[Z.strstart+3-1]),V=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart)}while(0!==--Z.prev_length);if(Z.match_available=0,Z.match_length=2,Z.strstart++,v&&(w(Z,!1),0===Z.strm.avail_out))return 1}else if(Z.match_available){if(v=K(Z,0,Z.window[Z.strstart-1]),v&&w(Z,!1),Z.strstart++,Z.lookahead--,0===Z.strm.avail_out)return 1}else Z.match_available=1,Z.strstart++,Z.lookahead--}return Z.match_available&&(v=K(Z,0,Z.window[Z.strstart-1]),Z.match_available=0),Z.insert=Z.strstart<2?Z.strstart:2,h===u?(w(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(w(Z,!1),0===Z.strm.avail_out)?1:2};function J(Z,h,V,v,A){this.good_length=Z,this.max_lazy=h,this.nice_length=V,this.max_chain=v,this.func=A}const f=[new J(0,0,0,0,((Z,h)=>{let V=65535;for(V>Z.pending_buf_size-5&&(V=Z.pending_buf_size-5);;){if(Z.lookahead<=1){if(M(Z),0===Z.lookahead&&h===N)return 1;if(0===Z.lookahead)break}Z.strstart+=Z.lookahead,Z.lookahead=0;const v=Z.block_start+V;if((0===Z.strstart||Z.strstart>=v)&&(Z.lookahead=Z.strstart-v,Z.strstart=v,w(Z,!1),0===Z.strm.avail_out))return 1;if(Z.strstart-Z.block_start>=Z.w_size-W&&(w(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,h===u?(w(Z,!0),0===Z.strm.avail_out?3:4):(Z.strstart>Z.block_start&&(w(Z,!1),Z.strm.avail_out),1)})),new J(4,4,8,4,O),new J(4,5,16,8,O),new J(4,6,32,32,O),new J(4,4,16,16,s),new J(8,16,32,32,s),new J(8,16,128,128,s),new J(8,32,128,256,s),new J(32,128,258,1024,s),new J(32,258,258,4096,s)];function p(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Y=Z=>{if(!Z||!Z.state)return I(Z,q);Z.total_in=Z.total_out=0,Z.data_type=r;const h=Z.state;return h.pending=0,h.pending_out=0,h.wrap<0&&(h.wrap=-h.wrap),h.status=h.wrap?42:m,Z.adler=2===h.wrap?0:1,h.last_flush=N,v(h),b},G=Z=>{const h=Y(Z);var V;return h===b&&((V=Z.state).window_size=2*V.w_size,U(V.head),V.max_lazy_match=f[V.level].max_lazy,V.good_match=f[V.level].good_length,V.nice_match=f[V.level].nice_length,V.max_chain_length=f[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=2,V.match_available=0,V.ins_h=0),h},ZZ=(Z,h,V,v,A,H)=>{if(!Z)return q;let K=1;if(h===j&&(h=6),v<0?(K=0,v=-v):v>15&&(K=2,v-=16),A<1||A>9||V!==L||v<8||v>15||h<0||h>9||H<0||H>B)return I(Z,q);8===v&&(v=9);const d=new p;return Z.state=d,d.strm=Z,d.wrap=K,d.gzhead=null,d.w_bits=v,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=A+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<A+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=3*d.lit_bufsize,d.level=h,d.strategy=H,d.method=V,G(Z)};Z.exports.deflateInit=(Z,h)=>ZZ(Z,h,L,15,8,S),Z.exports.deflateInit2=ZZ,Z.exports.deflateReset=G,Z.exports.deflateResetKeep=Y,Z.exports.deflateSetHeader=(Z,h)=>Z&&Z.state?2!==Z.state.wrap?q:(Z.state.gzhead=h,b):q,Z.exports.deflate=(Z,h)=>{let V,v;if(!Z||!Z.state||h>F||h<0)return Z?I(Z,q):q;const H=Z.state;if(!Z.output||!Z.input&&0!==Z.avail_in||H.status===g&&h!==u)return I(Z,0===Z.avail_out?E:q);H.strm=Z;const a=H.last_flush;if(H.last_flush=h,42===H.status)if(2===H.wrap)Z.adler=0,T(H,31),T(H,139),T(H,8),H.gzhead?(T(H,(H.gzhead.text?1:0)+(H.gzhead.hcrc?2:0)+(H.gzhead.extra?4:0)+(H.gzhead.name?8:0)+(H.gzhead.comment?16:0)),T(H,255&H.gzhead.time),T(H,H.gzhead.time>>8&255),T(H,H.gzhead.time>>16&255),T(H,H.gzhead.time>>24&255),T(H,9===H.level?2:H.strategy>=C||H.level<2?4:0),T(H,255&H.gzhead.os),H.gzhead.extra&&H.gzhead.extra.length&&(T(H,255&H.gzhead.extra.length),T(H,H.gzhead.extra.length>>8&255)),H.gzhead.hcrc&&(Z.adler=n(Z.adler,H.pending_buf,H.pending,0)),H.gzindex=0,H.status=69):(T(H,0),T(H,0),T(H,0),T(H,0),T(H,0),T(H,9===H.level?2:H.strategy>=C||H.level<2?4:0),T(H,3),H.status=m);else{let h=L+(H.w_bits-8<<4)<<8,V=-1;V=H.strategy>=C||H.level<2?0:H.level<6?1:6===H.level?2:3,h|=V<<6,0!==H.strstart&&(h|=32),h+=31-h%31,H.status=m,t(H,h),0!==H.strstart&&(t(H,Z.adler>>>16),t(H,65535&Z.adler)),Z.adler=1}if(69===H.status)if(H.gzhead.extra){for(V=H.pending;H.gzindex<(65535&H.gzhead.extra.length)&&(H.pending!==H.pending_buf_size||(H.gzhead.hcrc&&H.pending>V&&(Z.adler=n(Z.adler,H.pending_buf,H.pending-V,V)),Q(Z),V=H.pending,H.pending!==H.pending_buf_size));)T(H,255&H.gzhead.extra[H.gzindex]),H.gzindex++;H.gzhead.hcrc&&H.pending>V&&(Z.adler=n(Z.adler,H.pending_buf,H.pending-V,V)),H.gzindex===H.gzhead.extra.length&&(H.gzindex=0,H.status=73)}else H.status=73;if(73===H.status)if(H.gzhead.name){V=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>V&&(Z.adler=n(Z.adler,H.pending_buf,H.pending-V,V)),Q(Z),V=H.pending,H.pending===H.pending_buf_size)){v=1;break}v=H.gzindex<H.gzhead.name.length?255&H.gzhead.name.charCodeAt(H.gzindex++):0,T(H,v)}while(0!==v);H.gzhead.hcrc&&H.pending>V&&(Z.adler=n(Z.adler,H.pending_buf,H.pending-V,V)),0===v&&(H.gzindex=0,H.status=91)}else H.status=91;if(91===H.status)if(H.gzhead.comment){V=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>V&&(Z.adler=n(Z.adler,H.pending_buf,H.pending-V,V)),Q(Z),V=H.pending,H.pending===H.pending_buf_size)){v=1;break}v=H.gzindex<H.gzhead.comment.length?255&H.gzhead.comment.charCodeAt(H.gzindex++):0,T(H,v)}while(0!==v);H.gzhead.hcrc&&H.pending>V&&(Z.adler=n(Z.adler,H.pending_buf,H.pending-V,V)),0===v&&(H.status=z)}else H.status=z;if(H.status===z&&(H.gzhead.hcrc?(H.pending+2>H.pending_buf_size&&Q(Z),H.pending+2<=H.pending_buf_size&&(T(H,255&Z.adler),T(H,Z.adler>>8&255),Z.adler=0,H.status=m)):H.status=m),0!==H.pending){if(Q(Z),0===Z.avail_out)return H.last_flush=-1,b}else if(0===Z.avail_in&&e(h)<=e(a)&&h!==u)return I(Z,E);if(H.status===g&&0!==Z.avail_in)return I(Z,E);if(0!==Z.avail_in||0!==H.lookahead||h!==N&&H.status!==g){let V=H.strategy===C?((Z,h)=>{let V;for(;;){if(0===Z.lookahead&&(M(Z),0===Z.lookahead)){if(h===N)return 1;break}if(Z.match_length=0,V=K(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,V&&(w(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,h===u?(w(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(w(Z,!1),0===Z.strm.avail_out)?1:2})(H,h):H.strategy===l?((Z,h)=>{let V,v,A,H;const d=Z.window;for(;;){if(Z.lookahead<=y){if(M(Z),Z.lookahead<=y&&h===N)return 1;if(0===Z.lookahead)break}if(Z.match_length=0,Z.lookahead>=3&&Z.strstart>0&&(A=Z.strstart-1,v=d[A],v===d[++A]&&v===d[++A]&&v===d[++A])){H=Z.strstart+y;do{}while(v===d[++A]&&v===d[++A]&&v===d[++A]&&v===d[++A]&&v===d[++A]&&v===d[++A]&&v===d[++A]&&v===d[++A]&&A<H);Z.match_length=y-(H-A),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=3?(V=K(Z,1,Z.match_length-3),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(V=K(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),V&&(w(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,h===u?(w(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(w(Z,!1),0===Z.strm.avail_out)?1:2})(H,h):f[H.level].func(H,h);if(3!==V&&4!==V||(H.status=g),1===V||3===V)return 0===Z.avail_out&&(H.last_flush=-1),b;if(2===V&&(h===D?d(H):h!==F&&(A(H,0,0,!1),h===k&&(U(H.head),0===H.lookahead&&(H.strstart=0,H.block_start=0,H.insert=0))),Q(Z),0===Z.avail_out))return H.last_flush=-1,b}return h!==u?b:H.wrap<=0?o:(2===H.wrap?(T(H,255&Z.adler),T(H,Z.adler>>8&255),T(H,Z.adler>>16&255),T(H,Z.adler>>24&255),T(H,255&Z.total_in),T(H,Z.total_in>>8&255),T(H,Z.total_in>>16&255),T(H,Z.total_in>>24&255)):(t(H,Z.adler>>>16),t(H,65535&Z.adler)),Q(Z),H.wrap>0&&(H.wrap=-H.wrap),0!==H.pending?b:o)},Z.exports.deflateEnd=Z=>{if(!Z||!Z.state)return q;const h=Z.state.status;return 42!==h&&69!==h&&73!==h&&91!==h&&h!==z&&h!==m&&h!==g?I(Z,q):(Z.state=null,h===m?I(Z,X):b)},Z.exports.deflateSetDictionary=(Z,h)=>{let V=h.length;if(!Z||!Z.state)return q;const v=Z.state,A=v.wrap;if(2===A||1===A&&42!==v.status||v.lookahead)return q;if(1===A&&(Z.adler=a(Z.adler,h,V,0)),v.wrap=0,V>=v.w_size){0===A&&(U(v.head),v.strstart=0,v.block_start=0,v.insert=0);let Z=new Uint8Array(v.w_size);Z.set(h.subarray(V-v.w_size,V),0),h=Z,V=v.w_size}const H=Z.avail_in,K=Z.next_in,d=Z.input;for(Z.avail_in=V,Z.next_in=0,Z.input=h,M(v);v.lookahead>=3;){let Z=v.strstart,h=v.lookahead-2;do{v.ins_h=R(v,v.ins_h,v.window[Z+3-1]),v.prev[Z&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=Z,Z++}while(--h);v.strstart=Z,v.lookahead=2,M(v)}return v.strstart+=v.lookahead,v.block_start=v.strstart,v.insert=v.lookahead,v.lookahead=0,v.match_length=v.prev_length=2,v.match_available=0,Z.next_in=K,Z.input=d,Z.avail_in=H,v.wrap=A,b},Z.exports.deflateInfo="pako deflate (from Nodeca project)"},12946:Z=>{"use strict";Z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12930:Z=>{"use strict";Z.exports=function(Z,h){let V,v,A,H,K,d,a,n,x,N,D,k,u,F,b,o,q,X,E,j,P,C,l,B;const S=Z.state;V=Z.next_in,l=Z.input,v=V+(Z.avail_in-5),A=Z.next_out,B=Z.output,H=A-(h-Z.avail_out),K=A+(Z.avail_out-257),d=S.dmax,a=S.wsize,n=S.whave,x=S.wnext,N=S.window,D=S.hold,k=S.bits,u=S.lencode,F=S.distcode,b=(1<<S.lenbits)-1,o=(1<<S.distbits)-1;Z:do{k<15&&(D+=l[V++]<<k,k+=8,D+=l[V++]<<k,k+=8),q=u[D&b];h:for(;;){if(X=q>>>24,D>>>=X,k-=X,X=q>>>16&255,0===X)B[A++]=65535&q;else{if(!(16&X)){if(0===(64&X)){q=u[(65535&q)+(D&(1<<X)-1)];continue h}if(32&X){S.mode=12;break Z}Z.uh="invalid literal/length code",S.mode=30;break Z}E=65535&q,X&=15,X&&(k<X&&(D+=l[V++]<<k,k+=8),E+=D&(1<<X)-1,D>>>=X,k-=X),k<15&&(D+=l[V++]<<k,k+=8,D+=l[V++]<<k,k+=8),q=F[D&o];V:for(;;){if(X=q>>>24,D>>>=X,k-=X,X=q>>>16&255,!(16&X)){if(0===(64&X)){q=F[(65535&q)+(D&(1<<X)-1)];continue V}Z.uh="invalid distance code",S.mode=30;break Z}if(j=65535&q,X&=15,k<X&&(D+=l[V++]<<k,k+=8,k<X&&(D+=l[V++]<<k,k+=8)),j+=D&(1<<X)-1,j>d){Z.uh="invalid distance too far back",S.mode=30;break Z}if(D>>>=X,k-=X,X=A-H,j>X){if(X=j-X,X>n&&S.sane){Z.uh="invalid distance too far back",S.mode=30;break Z}if(P=0,C=N,0===x){if(P+=a-X,X<E){E-=X;do{B[A++]=N[P++]}while(--X);P=A-j,C=B}}else if(x<X){if(P+=a+x-X,X-=x,X<E){E-=X;do{B[A++]=N[P++]}while(--X);if(P=0,x<E){X=x,E-=X;do{B[A++]=N[P++]}while(--X);P=A-j,C=B}}}else if(P+=x-X,X<E){E-=X;do{B[A++]=N[P++]}while(--X);P=A-j,C=B}for(;E>2;)B[A++]=C[P++],B[A++]=C[P++],B[A++]=C[P++],E-=3;E&&(B[A++]=C[P++],E>1&&(B[A++]=C[P++]))}else{P=A-j;do{B[A++]=B[P++],B[A++]=B[P++],B[A++]=B[P++],E-=3}while(E>2);E&&(B[A++]=B[P++],E>1&&(B[A++]=B[P++]))}break}}break}}while(V<v&&A<K);E=k>>3,V-=E,k-=E<<3,D&=(1<<k)-1,Z.next_in=V,Z.next_out=A,Z.avail_in=V<v?v-V+5:5-(V-v),Z.avail_out=A<K?K-A+257:257-(A-K),S.hold=D,S.bits=k}},12926:(Z,h,V)=>{"use strict";const v=V(12883),A=V(12891),H=V(12930),K=V(12938),{Z_FINISH:d,Z_BLOCK:a,Z_TREES:n,Z_OK:x,Z_STREAM_END:N,Z_NEED_DICT:D,Z_STREAM_ERROR:k,Z_DATA_ERROR:u,Z_MEM_ERROR:F,Z_BUF_ERROR:b,Z_DEFLATED:o}=V(12904),q=12,X=30,E=Z=>(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24);function j(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const P=Z=>{if(!Z||!Z.state)return k;const h=Z.state;return Z.total_in=Z.total_out=h.total=0,Z.uh="",h.wrap&&(Z.adler=1&h.wrap),h.mode=1,h.last=0,h.havedict=0,h.dmax=32768,h.head=null,h.hold=0,h.bits=0,h.lencode=h.lendyn=new Int32Array(852),h.distcode=h.distdyn=new Int32Array(592),h.sane=1,h.back=-1,x},C=Z=>{if(!Z||!Z.state)return k;const h=Z.state;return h.wsize=0,h.whave=0,h.wnext=0,P(Z)},l=(Z,h)=>{let V;if(!Z||!Z.state)return k;const v=Z.state;return h<0?(V=0,h=-h):(V=1+(h>>4),h<48&&(h&=15)),h&&(h<8||h>15)?k:(null!==v.window&&v.wbits!==h&&(v.window=null),v.wrap=V,v.wbits=h,C(Z))},B=(Z,h)=>{if(!Z)return k;const V=new j;Z.state=V,V.window=null;const v=l(Z,h);return v!==x&&(Z.state=null),v};let S,r,L=!0;const y=Z=>{if(L){S=new Int32Array(512),r=new Int32Array(32);let h=0;for(;h<144;)Z.lens[h++]=8;for(;h<256;)Z.lens[h++]=9;for(;h<280;)Z.lens[h++]=7;for(;h<288;)Z.lens[h++]=8;for(K(1,Z.lens,0,288,S,0,Z.work,{bits:9}),h=0;h<32;)Z.lens[h++]=5;K(2,Z.lens,0,32,r,0,Z.work,{bits:5}),L=!1}Z.lencode=S,Z.lenbits=9,Z.distcode=r,Z.distbits=5},W=(Z,h,V,v)=>{let A;const H=Z.state;return null===H.window&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new Uint8Array(H.wsize)),v>=H.wsize?(H.window.set(h.subarray(V-H.wsize,V),0),H.wnext=0,H.whave=H.wsize):(A=H.wsize-H.wnext,A>v&&(A=v),H.window.set(h.subarray(V-v,V-v+A),H.wnext),(v-=A)?(H.window.set(h.subarray(V-v,V),0),H.wnext=v,H.whave=H.wsize):(H.wnext+=A,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=A))),0};Z.exports.inflateReset=C,Z.exports.inflateReset2=l,Z.exports.inflateResetKeep=P,Z.exports.inflateInit=Z=>B(Z,15),Z.exports.inflateInit2=B,Z.exports.inflate=(Z,h)=>{let V,j,P,C,l,B,S,r,L,z,m,g,I,e,U,R,Q,w,T,t,c,i,M=0;const O=new Uint8Array(4);let s,J;const f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Z||!Z.state||!Z.output||!Z.input&&0!==Z.avail_in)return k;V=Z.state,V.mode===q&&(V.mode=13),l=Z.next_out,P=Z.output,S=Z.avail_out,C=Z.next_in,j=Z.input,B=Z.avail_in,r=V.hold,L=V.bits,z=B,m=S,i=x;Z:for(;;)switch(V.mode){case 1:if(0===V.wrap){V.mode=13;break}for(;L<16;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(2&V.wrap&&35615===r){V.check=0,O[0]=255&r,O[1]=r>>>8&255,V.check=A(V.check,O,2,0),r=0,L=0,V.mode=2;break}if(V.flags=0,V.head&&(V.head.done=!1),!(1&V.wrap)||(((255&r)<<8)+(r>>8))%31){Z.uh="incorrect header check",V.mode=X;break}if((15&r)!==o){Z.uh="unknown compression method",V.mode=X;break}if(r>>>=4,L-=4,c=8+(15&r),0===V.wbits)V.wbits=c;else if(c>V.wbits){Z.uh="invalid window size",V.mode=X;break}V.dmax=1<<V.wbits,Z.adler=V.check=1,V.mode=512&r?10:q,r=0,L=0;break;case 2:for(;L<16;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(V.flags=r,(255&V.flags)!==o){Z.uh="unknown compression method",V.mode=X;break}if(57344&V.flags){Z.uh="unknown header flags set",V.mode=X;break}V.head&&(V.head.text=r>>8&1),512&V.flags&&(O[0]=255&r,O[1]=r>>>8&255,V.check=A(V.check,O,2,0)),r=0,L=0,V.mode=3;case 3:for(;L<32;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}V.head&&(V.head.time=r),512&V.flags&&(O[0]=255&r,O[1]=r>>>8&255,O[2]=r>>>16&255,O[3]=r>>>24&255,V.check=A(V.check,O,4,0)),r=0,L=0,V.mode=4;case 4:for(;L<16;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}V.head&&(V.head.xflags=255&r,V.head.os=r>>8),512&V.flags&&(O[0]=255&r,O[1]=r>>>8&255,V.check=A(V.check,O,2,0)),r=0,L=0,V.mode=5;case 5:if(1024&V.flags){for(;L<16;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}V.length=r,V.head&&(V.head.extra_len=r),512&V.flags&&(O[0]=255&r,O[1]=r>>>8&255,V.check=A(V.check,O,2,0)),r=0,L=0}else V.head&&(V.head.extra=null);V.mode=6;case 6:if(1024&V.flags&&(g=V.length,g>B&&(g=B),g&&(V.head&&(c=V.head.extra_len-V.length,V.head.extra||(V.head.extra=new Uint8Array(V.head.extra_len)),V.head.extra.set(j.subarray(C,C+g),c)),512&V.flags&&(V.check=A(V.check,j,g,C)),B-=g,C+=g,V.length-=g),V.length))break Z;V.length=0,V.mode=7;case 7:if(2048&V.flags){if(0===B)break Z;g=0;do{c=j[C+g++],V.head&&c&&V.length<65536&&(V.head.name+=String.fromCharCode(c))}while(c&&g<B);if(512&V.flags&&(V.check=A(V.check,j,g,C)),B-=g,C+=g,c)break Z}else V.head&&(V.head.name=null);V.length=0,V.mode=8;case 8:if(4096&V.flags){if(0===B)break Z;g=0;do{c=j[C+g++],V.head&&c&&V.length<65536&&(V.head.comment+=String.fromCharCode(c))}while(c&&g<B);if(512&V.flags&&(V.check=A(V.check,j,g,C)),B-=g,C+=g,c)break Z}else V.head&&(V.head.comment=null);V.mode=9;case 9:if(512&V.flags){for(;L<16;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(r!==(65535&V.check)){Z.uh="header crc mismatch",V.mode=X;break}r=0,L=0}V.head&&(V.head.hcrc=V.flags>>9&1,V.head.done=!0),Z.adler=V.check=0,V.mode=q;break;case 10:for(;L<32;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}Z.adler=V.check=E(r),r=0,L=0,V.mode=11;case 11:if(0===V.havedict)return Z.next_out=l,Z.avail_out=S,Z.next_in=C,Z.avail_in=B,V.hold=r,V.bits=L,D;Z.adler=V.check=1,V.mode=q;case q:if(h===a||h===n)break Z;case 13:if(V.last){r>>>=7&L,L-=7&L,V.mode=27;break}for(;L<3;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}switch(V.last=1&r,r>>>=1,L-=1,3&r){case 0:V.mode=14;break;case 1:if(y(V),V.mode=20,h===n){r>>>=2,L-=2;break Z}break;case 2:V.mode=17;break;case 3:Z.uh="invalid block type",V.mode=X}r>>>=2,L-=2;break;case 14:for(r>>>=7&L,L-=7&L;L<32;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if((65535&r)!==(r>>>16^65535)){Z.uh="invalid stored block lengths",V.mode=X;break}if(V.length=65535&r,r=0,L=0,V.mode=15,h===n)break Z;case 15:V.mode=16;case 16:if(g=V.length,g){if(g>B&&(g=B),g>S&&(g=S),0===g)break Z;P.set(j.subarray(C,C+g),l),B-=g,C+=g,S-=g,l+=g,V.length-=g;break}V.mode=q;break;case 17:for(;L<14;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(V.nlen=257+(31&r),r>>>=5,L-=5,V.ndist=1+(31&r),r>>>=5,L-=5,V.ncode=4+(15&r),r>>>=4,L-=4,V.nlen>286||V.ndist>30){Z.uh="too many length or distance symbols",V.mode=X;break}V.have=0,V.mode=18;case 18:for(;V.have<V.ncode;){for(;L<3;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}V.lens[f[V.have++]]=7&r,r>>>=3,L-=3}for(;V.have<19;)V.lens[f[V.have++]]=0;if(V.lencode=V.lendyn,V.lenbits=7,s={bits:V.lenbits},i=K(0,V.lens,0,19,V.lencode,0,V.work,s),V.lenbits=s.bits,i){Z.uh="invalid code lengths set",V.mode=X;break}V.have=0,V.mode=19;case 19:for(;V.have<V.nlen+V.ndist;){for(;M=V.lencode[r&(1<<V.lenbits)-1],U=M>>>24,R=M>>>16&255,Q=65535&M,!(U<=L);){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(Q<16)r>>>=U,L-=U,V.lens[V.have++]=Q;else{if(16===Q){for(J=U+2;L<J;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(r>>>=U,L-=U,0===V.have){Z.uh="invalid bit length repeat",V.mode=X;break}c=V.lens[V.have-1],g=3+(3&r),r>>>=2,L-=2}else if(17===Q){for(J=U+3;L<J;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}r>>>=U,L-=U,c=0,g=3+(7&r),r>>>=3,L-=3}else{for(J=U+7;L<J;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}r>>>=U,L-=U,c=0,g=11+(127&r),r>>>=7,L-=7}if(V.have+g>V.nlen+V.ndist){Z.uh="invalid bit length repeat",V.mode=X;break}for(;g--;)V.lens[V.have++]=c}}if(V.mode===X)break;if(0===V.lens[256]){Z.uh="invalid code -- missing end-of-block",V.mode=X;break}if(V.lenbits=9,s={bits:V.lenbits},i=K(1,V.lens,0,V.nlen,V.lencode,0,V.work,s),V.lenbits=s.bits,i){Z.uh="invalid literal/lengths set",V.mode=X;break}if(V.distbits=6,V.distcode=V.distdyn,s={bits:V.distbits},i=K(2,V.lens,V.nlen,V.ndist,V.distcode,0,V.work,s),V.distbits=s.bits,i){Z.uh="invalid distances set",V.mode=X;break}if(V.mode=20,h===n)break Z;case 20:V.mode=21;case 21:if(B>=6&&S>=258){Z.next_out=l,Z.avail_out=S,Z.next_in=C,Z.avail_in=B,V.hold=r,V.bits=L,H(Z,m),l=Z.next_out,P=Z.output,S=Z.avail_out,C=Z.next_in,j=Z.input,B=Z.avail_in,r=V.hold,L=V.bits,V.mode===q&&(V.back=-1);break}for(V.back=0;M=V.lencode[r&(1<<V.lenbits)-1],U=M>>>24,R=M>>>16&255,Q=65535&M,!(U<=L);){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(R&&0===(240&R)){for(w=U,T=R,t=Q;M=V.lencode[t+((r&(1<<w+T)-1)>>w)],U=M>>>24,R=M>>>16&255,Q=65535&M,!(w+U<=L);){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}r>>>=w,L-=w,V.back+=w}if(r>>>=U,L-=U,V.back+=U,V.length=Q,0===R){V.mode=26;break}if(32&R){V.back=-1,V.mode=q;break}if(64&R){Z.uh="invalid literal/length code",V.mode=X;break}V.extra=15&R,V.mode=22;case 22:if(V.extra){for(J=V.extra;L<J;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}V.length+=r&(1<<V.extra)-1,r>>>=V.extra,L-=V.extra,V.back+=V.extra}V.was=V.length,V.mode=23;case 23:for(;M=V.distcode[r&(1<<V.distbits)-1],U=M>>>24,R=M>>>16&255,Q=65535&M,!(U<=L);){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(0===(240&R)){for(w=U,T=R,t=Q;M=V.distcode[t+((r&(1<<w+T)-1)>>w)],U=M>>>24,R=M>>>16&255,Q=65535&M,!(w+U<=L);){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}r>>>=w,L-=w,V.back+=w}if(r>>>=U,L-=U,V.back+=U,64&R){Z.uh="invalid distance code",V.mode=X;break}V.offset=Q,V.extra=15&R,V.mode=24;case 24:if(V.extra){for(J=V.extra;L<J;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}V.offset+=r&(1<<V.extra)-1,r>>>=V.extra,L-=V.extra,V.back+=V.extra}if(V.offset>V.dmax){Z.uh="invalid distance too far back",V.mode=X;break}V.mode=25;case 25:if(0===S)break Z;if(g=m-S,V.offset>g){if(g=V.offset-g,g>V.whave&&V.sane){Z.uh="invalid distance too far back",V.mode=X;break}g>V.wnext?(g-=V.wnext,I=V.wsize-g):I=V.wnext-g,g>V.length&&(g=V.length),e=V.window}else e=P,I=l-V.offset,g=V.length;g>S&&(g=S),S-=g,V.length-=g;do{P[l++]=e[I++]}while(--g);0===V.length&&(V.mode=21);break;case 26:if(0===S)break Z;P[l++]=V.length,S--,V.mode=21;break;case 27:if(V.wrap){for(;L<32;){if(0===B)break Z;B--,r|=j[C++]<<L,L+=8}if(m-=S,Z.total_out+=m,V.total+=m,m&&(Z.adler=V.check=V.flags?A(V.check,P,m,l-m):v(V.check,P,m,l-m)),m=S,(V.flags?r:E(r))!==V.check){Z.uh="incorrect data check",V.mode=X;break}r=0,L=0}V.mode=28;case 28:if(V.wrap&&V.flags){for(;L<32;){if(0===B)break Z;B--,r+=j[C++]<<L,L+=8}if(r!==(4294967295&V.total)){Z.uh="incorrect length check",V.mode=X;break}r=0,L=0}V.mode=29;case 29:i=N;break Z;case X:i=u;break Z;case 31:return F;default:return k}return Z.next_out=l,Z.avail_out=S,Z.next_in=C,Z.avail_in=B,V.hold=r,V.bits=L,(V.wsize||m!==Z.avail_out&&V.mode<X&&(V.mode<27||h!==d))&&W(Z,Z.output,Z.next_out,m-Z.avail_out)?(V.mode=31,F):(z-=Z.avail_in,m-=Z.avail_out,Z.total_in+=z,Z.total_out+=m,V.total+=m,V.wrap&&m&&(Z.adler=V.check=V.flags?A(V.check,P,m,Z.next_out-m):v(V.check,P,m,Z.next_out-m)),Z.data_type=V.bits+(V.last?64:0)+(V.mode===q?128:0)+(20===V.mode||15===V.mode?256:0),(0===z&&0===m||h===d)&&i===x&&(i=b),i)},Z.exports.inflateEnd=Z=>{if(!Z||!Z.state)return k;let h=Z.state;return h.window&&(h.window=null),Z.state=null,x},Z.exports.inflateGetHeader=(Z,h)=>{if(!Z||!Z.state)return k;const V=Z.state;return 0===(2&V.wrap)?k:(V.head=h,h.done=!1,x)},Z.exports.inflateSetDictionary=(Z,h)=>{const V=h.length;let A,H,K;return Z&&Z.state?(A=Z.state,0!==A.wrap&&11!==A.mode?k:11===A.mode&&(H=1,H=v(H,h,V,0),H!==A.check)?u:(K=W(Z,h,V,V),K?(A.mode=31,F):(A.havedict=1,x))):k},Z.exports.inflateInfo="pako inflate (from Nodeca project)"},12938:Z=>{"use strict";const h=15,V=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),v=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),A=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),H=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Z.exports=(Z,K,d,a,n,x,N,D)=>{const k=D.bits;let u,F,b,o,q,X,E=0,j=0,P=0,C=0,l=0,B=0,S=0,r=0,L=0,y=0,W=null,z=0;const m=new Uint16Array(16),g=new Uint16Array(16);let I,e,U,R=null,Q=0;for(E=0;E<=h;E++)m[E]=0;for(j=0;j<a;j++)m[K[d+j]]++;for(l=k,C=h;C>=1&&0===m[C];C--);if(l>C&&(l=C),0===C)return n[x++]=20971520,n[x++]=20971520,D.bits=1,0;for(P=1;P<C&&0===m[P];P++);for(l<P&&(l=P),r=1,E=1;E<=h;E++)if(r<<=1,r-=m[E],r<0)return-1;if(r>0&&(0===Z||1!==C))return-1;for(g[1]=0,E=1;E<h;E++)g[E+1]=g[E]+m[E];for(j=0;j<a;j++)0!==K[d+j]&&(N[g[K[d+j]]++]=j);if(0===Z?(W=R=N,X=19):1===Z?(W=V,z-=257,R=v,Q-=257,X=256):(W=A,R=H,X=-1),y=0,j=0,E=P,q=x,B=l,S=0,b=-1,L=1<<l,o=L-1,1===Z&&L>852||2===Z&&L>592)return 1;for(;;){I=E-S,N[j]<X?(e=0,U=N[j]):N[j]>X?(e=R[Q+N[j]],U=W[z+N[j]]):(e=96,U=0),u=1<<E-S,F=1<<B,P=F;do{F-=u,n[q+(y>>S)+F]=I<<24|e<<16|U}while(0!==F);for(u=1<<E-1;y&u;)u>>=1;if(0!==u?(y&=u-1,y+=u):y=0,j++,0===--m[E]){if(E===C)break;E=K[d+N[j]]}if(E>l&&(y&o)!==b){for(0===S&&(S=l),q+=P,B=E-S,r=1<<B;B+S<C&&(r-=m[B+S],!(r<=0));)B++,r<<=1;if(L+=1<<B,1===Z&&L>852||2===Z&&L>592)return 1;b=y&o,n[b]=l<<24|B<<16|q-x}}return 0!==y&&(n[q+y]=E-S<<24|64<<16),D.bits=l,0}},12898:Z=>{"use strict";Z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12878:Z=>{"use strict";function h(Z){let h=Z.length;for(;--h>=0;)Z[h]=0}const V=256,v=286,A=30,H=15,K=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),d=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),x=new Array(576);h(x);const N=new Array(60);h(N);const D=new Array(512);h(D);const k=new Array(256);h(k);const u=new Array(29);h(u);const F=new Array(A);function b(Z,h,V,v,A){this.static_tree=Z,this.extra_bits=h,this.extra_base=V,this.elems=v,this.max_length=A,this.has_stree=Z&&Z.length}let o,q,X;function E(Z,h){this.dyn_tree=Z,this.max_code=0,this.stat_desc=h}h(F);const j=Z=>Z<256?D[Z]:D[256+(Z>>>7)],P=(Z,h)=>{Z.pending_buf[Z.pending++]=255&h,Z.pending_buf[Z.pending++]=h>>>8&255},C=(Z,h,V)=>{Z.bi_valid>16-V?(Z.bi_buf|=h<<Z.bi_valid&65535,P(Z,Z.bi_buf),Z.bi_buf=h>>16-Z.bi_valid,Z.bi_valid+=V-16):(Z.bi_buf|=h<<Z.bi_valid&65535,Z.bi_valid+=V)},l=(Z,h,V)=>{C(Z,V[2*h],V[2*h+1])},B=(Z,h)=>{let V=0;do{V|=1&Z,Z>>>=1,V<<=1}while(--h>0);return V>>>1},S=(Z,h,V)=>{const v=new Array(16);let A,K,d=0;for(A=1;A<=H;A++)v[A]=d=d+V[A-1]<<1;for(K=0;K<=h;K++){let h=Z[2*K+1];0!==h&&(Z[2*K]=B(v[h]++,h))}},r=Z=>{let h;for(h=0;h<v;h++)Z.dyn_ltree[2*h]=0;for(h=0;h<A;h++)Z.dyn_dtree[2*h]=0;for(h=0;h<19;h++)Z.bl_tree[2*h]=0;Z.dyn_ltree[512]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0},L=Z=>{Z.bi_valid>8?P(Z,Z.bi_buf):Z.bi_valid>0&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0},y=(Z,h,V,v)=>{const A=2*h,H=2*V;return Z[A]<Z[H]||Z[A]===Z[H]&&v[h]<=v[V]},W=(Z,h,V)=>{const v=Z.heap[V];let A=V<<1;for(;A<=Z.heap_len&&(A<Z.heap_len&&y(h,Z.heap[A+1],Z.heap[A],Z.depth)&&A++,!y(h,v,Z.heap[A],Z.depth));)Z.heap[V]=Z.heap[A],V=A,A<<=1;Z.heap[V]=v},z=(Z,h,v)=>{let A,H,a,n,x=0;if(0!==Z.last_lit)do{A=Z.pending_buf[Z.d_buf+2*x]<<8|Z.pending_buf[Z.d_buf+2*x+1],H=Z.pending_buf[Z.l_buf+x],x++,0===A?l(Z,H,h):(a=k[H],l(Z,a+V+1,h),n=K[a],0!==n&&(H-=u[a],C(Z,H,n)),A--,a=j(A),l(Z,a,v),n=d[a],0!==n&&(A-=F[a],C(Z,A,n)))}while(x<Z.last_lit);l(Z,256,h)},m=(Z,h)=>{const V=h.dyn_tree,v=h.stat_desc.static_tree,A=h.stat_desc.has_stree,K=h.stat_desc.elems;let d,a,n,x=-1;for(Z.heap_len=0,Z.heap_max=573,d=0;d<K;d++)0!==V[2*d]?(Z.heap[++Z.heap_len]=x=d,Z.depth[d]=0):V[2*d+1]=0;for(;Z.heap_len<2;)n=Z.heap[++Z.heap_len]=x<2?++x:0,V[2*n]=1,Z.depth[n]=0,Z.opt_len--,A&&(Z.static_len-=v[2*n+1]);for(h.max_code=x,d=Z.heap_len>>1;d>=1;d--)W(Z,V,d);n=K;do{d=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],W(Z,V,1),a=Z.heap[1],Z.heap[--Z.heap_max]=d,Z.heap[--Z.heap_max]=a,V[2*n]=V[2*d]+V[2*a],Z.depth[n]=(Z.depth[d]>=Z.depth[a]?Z.depth[d]:Z.depth[a])+1,V[2*d+1]=V[2*a+1]=n,Z.heap[1]=n++,W(Z,V,1)}while(Z.heap_len>=2);Z.heap[--Z.heap_max]=Z.heap[1],((Z,h)=>{const V=h.dyn_tree,v=h.max_code,A=h.stat_desc.static_tree,K=h.stat_desc.has_stree,d=h.stat_desc.extra_bits,a=h.stat_desc.extra_base,n=h.stat_desc.max_length;let x,N,D,k,u,F,b=0;for(k=0;k<=H;k++)Z.bl_count[k]=0;for(V[2*Z.heap[Z.heap_max]+1]=0,x=Z.heap_max+1;x<573;x++)N=Z.heap[x],k=V[2*V[2*N+1]+1]+1,k>n&&(k=n,b++),V[2*N+1]=k,N>v||(Z.bl_count[k]++,u=0,N>=a&&(u=d[N-a]),F=V[2*N],Z.opt_len+=F*(k+u),K&&(Z.static_len+=F*(A[2*N+1]+u)));if(0!==b){do{for(k=n-1;0===Z.bl_count[k];)k--;Z.bl_count[k]--,Z.bl_count[k+1]+=2,Z.bl_count[n]--,b-=2}while(b>0);for(k=n;0!==k;k--)for(N=Z.bl_count[k];0!==N;)D=Z.heap[--x],D>v||(V[2*D+1]!==k&&(Z.opt_len+=(k-V[2*D+1])*V[2*D],V[2*D+1]=k),N--)}})(Z,h),S(V,x,Z.bl_count)},g=(Z,h,V)=>{let v,A,H=-1,K=h[1],d=0,a=7,n=4;for(0===K&&(a=138,n=3),h[2*(V+1)+1]=65535,v=0;v<=V;v++)A=K,K=h[2*(v+1)+1],++d<a&&A===K||(d<n?Z.bl_tree[2*A]+=d:0!==A?(A!==H&&Z.bl_tree[2*A]++,Z.bl_tree[32]++):d<=10?Z.bl_tree[34]++:Z.bl_tree[36]++,d=0,H=A,0===K?(a=138,n=3):A===K?(a=6,n=3):(a=7,n=4))},I=(Z,h,V)=>{let v,A,H=-1,K=h[1],d=0,a=7,n=4;for(0===K&&(a=138,n=3),v=0;v<=V;v++)if(A=K,K=h[2*(v+1)+1],!(++d<a&&A===K)){if(d<n)do{l(Z,A,Z.bl_tree)}while(0!==--d);else 0!==A?(A!==H&&(l(Z,A,Z.bl_tree),d--),l(Z,16,Z.bl_tree),C(Z,d-3,2)):d<=10?(l(Z,17,Z.bl_tree),C(Z,d-3,3)):(l(Z,18,Z.bl_tree),C(Z,d-11,7));d=0,H=A,0===K?(a=138,n=3):A===K?(a=6,n=3):(a=7,n=4)}};let e=!1;const U=(Z,h,V,v)=>{C(Z,0+(v?1:0),3),((Z,h,V,v)=>{L(Z),v&&(P(Z,V),P(Z,~V)),Z.pending_buf.set(Z.window.subarray(h,h+V),Z.pending),Z.pending+=V})(Z,h,V,!0)};Z.exports._tr_init=Z=>{e||((()=>{let Z,h,V,n,E;const j=new Array(16);for(V=0,n=0;n<28;n++)for(u[n]=V,Z=0;Z<1<<K[n];Z++)k[V++]=n;for(k[V-1]=n,E=0,n=0;n<16;n++)for(F[n]=E,Z=0;Z<1<<d[n];Z++)D[E++]=n;for(E>>=7;n<A;n++)for(F[n]=E<<7,Z=0;Z<1<<d[n]-7;Z++)D[256+E++]=n;for(h=0;h<=H;h++)j[h]=0;for(Z=0;Z<=143;)x[2*Z+1]=8,Z++,j[8]++;for(;Z<=255;)x[2*Z+1]=9,Z++,j[9]++;for(;Z<=279;)x[2*Z+1]=7,Z++,j[7]++;for(;Z<=287;)x[2*Z+1]=8,Z++,j[8]++;for(S(x,287,j),Z=0;Z<A;Z++)N[2*Z+1]=5,N[2*Z]=B(Z,5);o=new b(x,K,257,v,H),q=new b(N,d,0,A,H),X=new b(new Array(0),a,0,19,7)})(),e=!0),Z.l_desc=new E(Z.dyn_ltree,o),Z.d_desc=new E(Z.dyn_dtree,q),Z.bl_desc=new E(Z.bl_tree,X),Z.bi_buf=0,Z.bi_valid=0,r(Z)},Z.exports._tr_stored_block=U,Z.exports._tr_flush_block=(Z,h,v,A)=>{let H,K,d=0;Z.level>0?(2===Z.strm.data_type&&(Z.strm.data_type=(Z=>{let h,v=4093624447;for(h=0;h<=31;h++,v>>>=1)if(1&v&&0!==Z.dyn_ltree[2*h])return 0;if(0!==Z.dyn_ltree[18]||0!==Z.dyn_ltree[20]||0!==Z.dyn_ltree[26])return 1;for(h=32;h<V;h++)if(0!==Z.dyn_ltree[2*h])return 1;return 0})(Z)),m(Z,Z.l_desc),m(Z,Z.d_desc),d=(Z=>{let h;for(g(Z,Z.dyn_ltree,Z.l_desc.max_code),g(Z,Z.dyn_dtree,Z.d_desc.max_code),m(Z,Z.bl_desc),h=18;h>=3&&0===Z.bl_tree[2*n[h]+1];h--);return Z.opt_len+=3*(h+1)+5+5+4,h})(Z),H=Z.opt_len+3+7>>>3,K=Z.static_len+3+7>>>3,K<=H&&(H=K)):H=K=v+5,v+4<=H&&-1!==h?U(Z,h,v,A):4===Z.strategy||K===H?(C(Z,2+(A?1:0),3),z(Z,x,N)):(C(Z,4+(A?1:0),3),((Z,h,V,v)=>{let A;for(C(Z,h-257,5),C(Z,V-1,5),C(Z,v-4,4),A=0;A<v;A++)C(Z,Z.bl_tree[2*n[A]+1],3);I(Z,Z.dyn_ltree,h-1),I(Z,Z.dyn_dtree,V-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,d+1),z(Z,Z.dyn_ltree,Z.dyn_dtree)),r(Z),A&&L(Z)},Z.exports._tr_tally=(Z,h,v)=>(Z.pending_buf[Z.d_buf+2*Z.last_lit]=h>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&h,Z.pending_buf[Z.l_buf+Z.last_lit]=255&v,Z.last_lit++,0===h?Z.dyn_ltree[2*v]++:(Z.matches++,h--,Z.dyn_ltree[2*(k[v]+V+1)]++,Z.dyn_dtree[2*j(h)]++),Z.last_lit===Z.lit_bufsize-1),Z.exports._tr_align=Z=>{C(Z,2,3),l(Z,256,x),(Z=>{16===Z.bi_valid?(P(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):Z.bi_valid>=8&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)})(Z)}},12915:Z=>{"use strict";Z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.uh="",this.state=null,this.data_type=2,this.adler=0}},12536:Z=>{function h(Z,h,V){for(var v=Z.length,A=-1/0,H=1/0,K=0;K<v;K++){var d=(V[0][K]-Z[K])/h[K],a=(V[1][K]-Z[K])/h[K];if(d>a){var n=d;d=a,a=n}if(a<A||d>H)return 1/0;d>A&&(A=d),a<H&&(H=a)}return A>H?1/0:A}Z.exports=function(Z,V,v,A){var H=h(V,v,A);if(H===1/0)Z=null;else{Z=Z||[];for(var K=0;K<V.length;K++)Z[K]=V[K]+v[K]*H}return Z},Z.exports.distance=h},13980:(Z,h,V)=>{"use strict";V.d(h,{e:()=>K});var v=V(41);const A=v.useLayoutEffect;const H=function(Z){var h=(0,v.useRef)(Z);return A((function(){h.current=Z})),h};var K=function(Z){var h=H(Z);(0,v.nh)((function(){var Z=function(Z){var V;if(null!=h.current&&(V=h.current(Z)),Z.defaultPrevented&&(Z.returnValue=""),"string"===typeof V)return Z.returnValue=V,V};return window.addEventListener("beforeunload",Z),function(){window.removeEventListener("beforeunload",Z)}}),[])}},13929:(Z,h,V)=>{"use strict";var v=V(13936),A=Array.prototype.concat,H=Array.prototype.slice,K=Z.exports=function(Z){for(var h=[],V=0,K=Z.length;V<K;V++){var d=Z[V];v(d)?h=A.call(h,H.call(d)):h.push(d)}return h};K.wrap=function(Z){return function(){return Z(K(arguments))}}},13936:Z=>{Z.exports=function(Z){return!(!Z||"string"===typeof Z)&&(Z instanceof Array||Array.isArray(Z)||Z.length>=0&&(Z.splice instanceof Function||Object.getOwnPropertyDescriptor(Z,Z.length-1)&&"String"!==Z.constructor.name))}},12820:(Z,h,V)=>{var v=V(12826);function A(Z){for(var h,V,A=0,H=Z.length,K=0;K<Z.length;){for(h=Z[K],V=0;K<H&&Z[K]===h;)++K,++V;A+=v.log2(V)/7|0,A+=v.log2(h>>>0)/7|0,A+=2}return A}h.size=A,h.encode=function(Z,h){h||(h=new Uint8Array(A(Z)));for(var V,v,H=0,K=h.length,d=0;d<Z.length;){for(V=Z[d],v=0;d<Z.length&&Z[d]===V;)++d,++v;for(;H<K&&v>=128;)h[H++]=128+(127&v),v>>>=7;if(H>=K)throw new Error("RLE buffer overflow");for(h[H++]=v,V>>>=0;H<K&&V>=128;)h[H++]=128+(127&V),V>>>=7;if(H>=K)throw new Error("RLE buffer overflow");h[H++]=V}return h},h.decode=function(Z,h){for(var V,v,A,H,K=h.length,d=Z.length,a=0,n=0;n<d;){for(V=0,v=0;n<d&&Z[n]>=128;)V+=(127&Z[n++])<<v,v+=7;if(V+=Z[n++]<<v,n>=d)throw new Error("RLE buffer underrun");if(a+V>K)throw new Error("Chunk buffer overflow");for(A=0,v=0;n<d&&Z[n]>=128;)A+=(127&Z[n++])<<v,v+=7;if(n>=d)throw new Error("RLE buffer underrun");for(A+=Z[n++]<<v,H=0;H<V;++H)h[a++]=A}return h}},12826:(Z,h)=>{"use strict";function V(Z){var h=32;return(Z&=-Z)&&h--,65535&Z&&(h-=16),16711935&Z&&(h-=8),252645135&Z&&(h-=4),858993459&Z&&(h-=2),1431655765&Z&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(Z){return(Z>0)-(Z<0)},h.abs=function(Z){var h=Z>>31;return(Z^h)-h},h.min=function(Z,h){return h^(Z^h)&-(Z<h)},h.max=function(Z,h){return Z^(Z^h)&-(Z<h)},h.isPow2=function(Z){return!(Z&Z-1)&&!!Z},h.log2=function(Z){var h,V;return h=(Z>65535)<<4,h|=V=((Z>>>=h)>255)<<3,h|=V=((Z>>>=V)>15)<<2,(h|=V=((Z>>>=V)>3)<<1)|(Z>>>=V)>>1},h.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},h.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},h.countTrailingZeros=V,h.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},h.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},h.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var v=new Array(256);!function(Z){for(var h=0;h<256;++h){var V=h,v=h,A=7;for(V>>>=1;V;V>>>=1)v<<=1,v|=1&V,--A;Z[h]=v<<A&255}}(v),h.reverse=function(Z){return v[255&Z]<<24|v[Z>>>8&255]<<16|v[Z>>>16&255]<<8|v[Z>>>24&255]},h.interleave2=function(Z,h){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(Z,h){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>h&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},h.interleave3=function(Z,h,V){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<2},h.deinterleave3=function(Z,h){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>h&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},h.nextCombination=function(Z){var h=Z|Z-1;return h+1|(~h&-~h)-1>>>V(Z)+1}},12859:Z=>{"use strict";Z.exports=function(Z,h,V,v){var A=self||window;try{try{var H;try{H=new A.Blob([Z])}catch(n){(H=new(A.BlobBuilder||A.WebKitBlobBuilder||A.MozBlobBuilder||A.MSBlobBuilder)).append(Z),H=H.getBlob()}var K=A.URL||A.webkitURL,d=K.createObjectURL(H),a=new A[h](d,V);return K.revokeObjectURL(d),a}catch(n){return new A[h]("data:application/javascript,".concat(encodeURIComponent(Z)),V)}}catch(n){if(!v)throw Error("Inline worker is not supported");return new A[h](v,V)}}},12521:(Z,h,V)=>{"use strict";function v(Z,h,V,v,A){var H={};return Object.keys(v).forEach((function(Z){H[Z]=v[Z]})),H.enumerable=!!H.enumerable,H.configurable=!!H.configurable,("value"in H||H.initializer)&&(H.writable=!0),H=V.slice().reverse().reduce((function(V,v){return v(Z,h,V)||V}),H),A&&void 0!==H.initializer&&(H.value=H.initializer?H.initializer.call(A):void 0,H.initializer=void 0),void 0===H.initializer&&(Object.defineProperty(Z,h,H),H=null),H}V.d(h,{c:()=>v})},12513:(Z,h,V)=>{"use strict";function v(Z,h,V,v){V&&Object.defineProperty(Z,h,{enumerable:V.enumerable,configurable:V.configurable,writable:V.writable,value:V.initializer?V.initializer.call(v):void 0})}V.d(h,{d:()=>v})},13975:(Z,h,V)=>{"use strict";V.d(h,{e:()=>K,f:()=>N,j:()=>d,n:()=>H,q:()=>a,s:()=>A,w:()=>n,x:()=>x});var v=V(11954);class A{constructor(){this._easingMode=A.EASINGMODE_EASEIN}setEasingMode(Z){const h=Math.min(Math.max(Z,0),2);this._easingMode=h}getEasingMode(){return this._easingMode}easeInCore(Z){throw new Error("You must implement this method")}ease(Z){switch(this._easingMode){case A.EASINGMODE_EASEIN:return this.easeInCore(Z);case A.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Z)}return Z>=.5?.5*(1-this.easeInCore(2*(1-Z)))+.5:.5*this.easeInCore(2*Z)}}A.EASINGMODE_EASEIN=0,A.EASINGMODE_EASEOUT=1,A.EASINGMODE_EASEINOUT=2;class H extends A{easeInCore(Z){return Z=Math.max(0,Math.min(1,Z)),1-Math.sqrt(1-Z*Z)}}class K extends A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Z}easeInCore(Z){const h=Math.max(0,this.amplitude);return Math.pow(Z,3)-Z*h*Math.sin(3.141592653589793*Z)}}class d extends A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Z,this.bounciness=h}easeInCore(Z){const h=Math.max(0,this.bounces);let V=this.bounciness;V<=1&&(V=1.001);const v=Math.pow(V,h),A=1-V,H=(1-v)/A+.5*v,K=Z*H,d=Math.log(-K*(1-V)+1)/Math.log(V),a=Math.floor(d),n=a+1,x=(1-Math.pow(V,a))/(A*H),N=.5*(x+(1-Math.pow(V,n))/(A*H)),D=Z-N,k=N-x;return-Math.pow(1/V,h-a)/(k*k)*(D-k)*(D+k)}}class a extends A{easeInCore(Z){return Z*Z*Z}}class n extends A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Z,this.springiness=h}easeInCore(Z){let h;const V=Math.max(0,this.oscillations),v=Math.max(0,this.springiness);return h=0==v?Z:(Math.exp(v*Z)-1)/(Math.exp(v)-1),h*Math.sin((6.283185307179586*V+1.5707963267948966)*Z)}}class x extends A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Z}easeInCore(Z){return this.exponent<=0?Z:(Math.exp(this.exponent*Z)-1)/(Math.exp(this.exponent)-1)}}class N extends A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Z,this.y1=h,this.x2=V,this.y2=v}easeInCore(Z){return v.c.Interpolate(Z,this.x1,this.y1,this.x2,this.y2)}}},13392:(Z,h,V)=>{"use strict";V.d(h,{c:()=>K});var v=V(11729),A=V(11739),H=V(12150);class K extends H.c{get _matrix(){return this._compose(),this.QD}set _matrix(Z){(Z.updateFlag!==this.QD.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.QD.v(Z),this._markAsDirtyAndDecompose())}constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Z,h.CZ(),!1),this.name=Z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=h,this.QD=(null===A||void 0===A?void 0:A.clone())??v.Matrix.Identity(),this._restMatrix=H??this.QD.clone(),this._bindMatrix=K??this.QD.clone(),this._index=d,this._absoluteMatrix=new v.Matrix,this._absoluteBindMatrix=new v.Matrix,this._absoluteInverseBindMatrix=new v.Matrix,this._finalMatrix=new v.Matrix,h.bones.push(this),this.setParent(V,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Z){this.setParent(Z)}setParent(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Z){if(this.parent){const Z=this.parent.children.indexOf(this);-1!==Z&&this.parent.children.splice(Z,1)}this._parentNode=Z,this.parent&&this.parent.children.push(this),h&&this._updateAbsoluteBindMatrices(),this.Vx()}}getLocalMatrix(){return this._compose(),this.QD}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Z){this._restMatrix.v(Z)}setRestPose(Z){this.setRestMatrix(Z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Z){this.wh(Z)}setBindPose(Z){this.setBindMatrix(Z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Z=v.TmpVectors.Ch[0],h=v.TmpVectors.Quaternion[0],V=v.TmpVectors.Ch[1];this.getRestMatrix().decompose(Z,h,V),this._linkedTransformNode.position.v(V),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??v.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.v(h),this._linkedTransformNode.tv.v(Z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Aa}set position(Z){this._decompose(),this.Aa.v(Z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Z){this.setRotation(Z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Z){this.setRotationQuaternion(Z)}get tv(){return this.getScale()}set tv(Z){this.setScale(Z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=v.Ch.Zero(),this._localRotation=v.Quaternion.Zero(),this.Aa=v.Ch.Zero()),this.QD.decompose(this._localScaling,this._localRotation,this.Aa))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,v.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Aa,this.QD)):this._needToCompose=!1)}wh(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.v(Z),h&&this._updateAbsoluteBindMatrices(),V?this._matrix=Z:this.Vx()}_updateAbsoluteBindMatrices(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z||(Z=this._bindMatrix),this.parent?Z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.v(Z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),h)for(let V=0;V<this.children.length;V++)this.children[V]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Vx(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Vx(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Vx(),this._needToDecompose=!0}_updatePosition(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const H=this.getLocalMatrix();if(0==h)A?(H.addAtIndex(12,Z.x),H.addAtIndex(13,Z.y),H.addAtIndex(14,Z.z)):H.setTranslationFromFloats(Z.x,Z.y,Z.z);else{let h=null;V&&(h=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=K._TmpMats[0],a=K._TmpVecs[0];this.parent?V&&h?(d.v(this.parent.getAbsoluteMatrix()),d.multiplyToRef(h,d)):d.v(this.parent.getAbsoluteMatrix()):v.Matrix.IdentityToRef(d),A&&d.setTranslationFromFloats(0,0,0),d.invert(),v.Ch.TransformCoordinatesToRef(Z,d,a),A?(H.addAtIndex(12,a.x),H.addAtIndex(13,a.y),H.addAtIndex(14,a.z)):H.setTranslationFromFloats(a.x,a.y,a.z)}this._markAsDirtyAndDecompose()}translate(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,h,V,!0)}setPosition(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,h,V,!1)}setAbsolutePosition(Z,h){this.setPosition(Z,1,h)}scale(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const H=this.getLocalMatrix(),d=K._TmpMats[0];v.Matrix.ScalingToRef(Z,h,V,d),d.multiplyToRef(H,H),d.invert();for(const v of this.children){const A=v.getLocalMatrix();A.multiplyToRef(d,A),A.multiplyAtIndex(12,Z),A.multiplyAtIndex(13,h),A.multiplyAtIndex(14,V),v._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),A)for(const v of this.children)v.scale(Z,h,V,A)}setScale(Z){this._decompose(),this._localScaling.v(Z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Z){this._decompose(),Z.v(this._localScaling)}setYawPitchRoll(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4?arguments[4]:void 0;if(0===A){const d=K._TmpQuat;return v.Quaternion.RotationYawPitchRollToRef(Z,h,V,d),void this.setRotationQuaternion(d,A,H)}const d=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,H))return;const a=K._TmpMats[1];v.Matrix.RotationYawPitchRollToRef(Z,h,V,a),d.multiplyToRef(a,a),this._rotateWithMatrix(a,A,H)}rotate(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;const H=K._TmpMats[0];H.setTranslationFromFloats(0,0,0),v.Matrix.RotationAxisToRef(Z,h,H),this._rotateWithMatrix(H,V,A)}setAxisAngle(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;if(0===V){const H=K._TmpQuat;return v.Quaternion.RotationAxisToRef(Z,h,H),void this.setRotationQuaternion(H,V,A)}const H=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(H,A))return;const d=K._TmpMats[1];v.Matrix.RotationAxisToRef(Z,h,d),H.multiplyToRef(d,d),this._rotateWithMatrix(d,V,A)}setRotation(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Z.y,Z.x,Z.z,h,V)}setRotationQuaternion(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;if(0===h)return this._decompose(),this._localRotation.v(Z),void this._markAsDirtyAndCompose();const A=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,V))return;const H=K._TmpMats[1];v.Matrix.FromQuaternionToRef(Z,H),A.multiplyToRef(H,H),this._rotateWithMatrix(H,h,V)}setRotationMatrix(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;if(0===h){const A=K._TmpQuat;return v.Quaternion.FromRotationMatrixToRef(Z,A),void this.setRotationQuaternion(A,h,V)}const A=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,V))return;const H=K._TmpMats[1];H.v(Z),A.multiplyToRef(Z,H),this._rotateWithMatrix(H,h,V)}_rotateWithMatrix(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;const v=this.getLocalMatrix(),A=v.m[12],H=v.m[13],d=v.m[14],a=this.getParent(),n=K._TmpMats[3],x=K._TmpMats[4];a&&1==h?(V?(n.v(V.getWorldMatrix()),a.getAbsoluteMatrix().multiplyToRef(n,n)):n.v(a.getAbsoluteMatrix()),x.v(n),x.invert(),v.multiplyToRef(n,v),v.multiplyToRef(Z,v),v.multiplyToRef(x,v)):1==h&&V?(n.v(V.getWorldMatrix()),x.v(n),x.invert(),v.multiplyToRef(n,v),v.multiplyToRef(Z,v),v.multiplyToRef(x,v)):v.multiplyToRef(Z,v),v.setTranslationFromFloats(A,H,d),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Z,h){const V=K._TmpMats[2];return Z.v(this.getAbsoluteMatrix()),h?(Z.multiplyToRef(h.getWorldMatrix(),Z),v.Matrix.ScalingToRef(h.tv.x,h.tv.y,h.tv.z,V)):v.Matrix.IdentityToRef(V),Z.invert(),!isNaN(Z.m[0])&&(V.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyToRef(V,Z),!0)}Nh(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=v.Ch.Zero();return this.getPositionToRef(Z,h,V),V}getPositionToRef(){let Z=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Z=this.getLocalMatrix();h.x=Z.m[12],h.y=Z.m[13],h.z=Z.m[14]}else{let V=null;Z&&(V=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let v=K._TmpMats[0];Z&&V?(v.v(this.getAbsoluteMatrix()),v.multiplyToRef(V,v)):v=this.getAbsoluteMatrix(),h.x=v.m[12],h.y=v.m[13],h.z=v.m[14]}}getAbsolutePosition(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=v.Ch.Zero();return this.getPositionToRef(1,Z,h),h}getAbsolutePositionToRef(Z,h){this.getPositionToRef(1,Z,h)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.QD.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.v(this.QD);const Z=this._skeleton.getPoseMatrix();Z&&this._absoluteMatrix.multiplyToRef(Z,this._absoluteMatrix)}const Z=this.children,h=Z.length;for(let V=0;V<h;V++)Z[V].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}ma(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=v.Ch.Zero();return this.getDirectionToRef(Z,h,V),V}getDirectionToRef(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,A=null;h&&(A=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=K._TmpMats[0];H.v(this.getAbsoluteMatrix()),h&&A&&H.multiplyToRef(A,H),v.Ch.TransformNormalToRef(Z,H,V),V.normalize()}getRotation(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=v.Ch.Zero();return this.getRotationToRef(Z,h,V),V}getRotationToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;const v=K._TmpQuat;this.getRotationQuaternionToRef(Z,h,v),v.toEulerAnglesToRef(V)}getRotationQuaternion(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=v.Quaternion.Identity();return this.getRotationQuaternionToRef(Z,h,V),V}getRotationQuaternionToRef(){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),h.v(this._localRotation);else{const V=K._TmpMats[0],v=this.getAbsoluteMatrix();Z?v.multiplyToRef(Z.getWorldMatrix(),V):V.v(v),V.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyAtIndex(1,this._scalingDeterminant),V.multiplyAtIndex(2,this._scalingDeterminant),V.decompose(void 0,h,void 0)}}getRotationMatrix(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1?arguments[1]:void 0;const V=v.Matrix.Identity();return this.getRotationMatrixToRef(Z,h,V),V}getRotationMatrixToRef(){let Z=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(h);else{const V=K._TmpMats[0],v=this.getAbsoluteMatrix();Z?v.multiplyToRef(Z.getWorldMatrix(),V):V.v(v),V.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyAtIndex(1,this._scalingDeterminant),V.multiplyAtIndex(2,this._scalingDeterminant),V.getRotationMatrixToRef(h)}}getAbsolutePositionFromLocal(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=v.Ch.Zero();return this.getAbsolutePositionFromLocalToRef(Z,h,V),V}getAbsolutePositionFromLocalToRef(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,A=null;h&&(A=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=K._TmpMats[0];H.v(this.getAbsoluteMatrix()),h&&A&&H.multiplyToRef(A,H),v.Ch.TransformCoordinatesToRef(Z,H,V)}getLocalPositionFromAbsolute(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=v.Ch.Zero();return this.getLocalPositionFromAbsoluteToRef(Z,h,V),V}getLocalPositionFromAbsoluteToRef(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,A=null;h&&(A=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=K._TmpMats[0];H.v(this.getAbsoluteMatrix()),h&&A&&H.multiplyToRef(A,H),H.invert(),v.Ch.TransformCoordinatesToRef(Z,H,V)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Z=this._skeleton.bones.indexOf(this);if(-1!==Z&&this._skeleton.bones.splice(Z,1),this._parentNode&&this._parentNode.children){const Z=this._parentNode.children,h=Z.indexOf(this);-1!==h&&Z.splice(h,1)}super.dispose()}}K._TmpVecs=(0,A.d)(2,v.Ch.Zero),K._TmpQuat=v.Quaternion.Identity(),K._TmpMats=(0,A.d)(5,v.Matrix.Identity)},13971:(Z,h,V)=>{"use strict";V.d(h,{e:()=>m});var v=V(11720),A=V(11723),H=V(11566),K=V(11729),d=V(11748),a=V(12150),n=V(12184),x=V(12019),N=V(11588),D=V(11737);class k{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Z){this._idleRotationSpeed=Z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Z){this._idleRotationWaitTime=Z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Z){this._idleRotationSpinupTime=Z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Z){this._attachedCamera=Z;const h=this._attachedCamera.CZ();this._onPrePointerObservableObserver=h.onPrePointerObservable.add((Z=>{Z.type!==x.b.POINTERDOWN?Z.type===x.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Z=N.e.Now;let h=0;null!=this._lastFrameTime&&(h=Z-this._lastFrameTime),this._lastFrameTime=Z,this._applyUserInteraction();const V=Z-this._lastInteractionTime-this._idleRotationWaitTime,v=Math.max(Math.min(V/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*v,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(h/1e3))}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.CZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Z){this._lastInteractionTime=Z??N.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<D.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=N.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var u=V(13975),F=V(12268);class b{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Z){if(this._autoTransitionRange===Z)return;this._autoTransitionRange=Z;const h=this._attachedCamera;h&&(Z?this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((Z=>{if(Z&&(Z.sh(!0),Z.getBoundingInfo)){const h=Z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*h,this.upperRadiusTransitionRange=.05*h}})):this._onMeshTargetChangedObserver&&h.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Z){this._attachedCamera=Z,this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Z){return!!this._attachedCamera&&(this._attachedCamera.radius===Z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Z){if(!this._attachedCamera)return;this._radiusBounceTransition||(b.EasingFunction.setEasingMode(b.EasingMode),this._radiusBounceTransition=F.c.CreateAnimation("radius",F.c.ANIMATIONTYPE_FLOAT,60,b.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const h=F.c.TransitionTo("radius",this._attachedCamera.radius+Z,this._attachedCamera,this._attachedCamera.CZ(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));h&&this._animatables.push(h)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}b.EasingFunction=new u.e(.3),b.EasingMode=u.s.EASINGMODE_EASEOUT;class o{constructor(){this.onTargetFramingAnimationEndObservable=new H.b,this._mode=o.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Z){this._mode=Z}get mode(){return this._mode}set radiusScale(Z){this._radiusScale=Z}get radiusScale(){return this._radiusScale}set positionScale(Z){this._positionScale=Z}get positionScale(){return this._positionScale}set defaultElevation(Z){this._defaultElevation=Z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Z){this._elevationReturnTime=Z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Z){this._elevationReturnWaitTime=Z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Z){this._framingTime=Z}get framingTime(){return this._framingTime}init(){}attach(Z){this._attachedCamera=Z;const h=this._attachedCamera.CZ();o.EasingFunction.setEasingMode(o.EasingMode),this._onPrePointerObservableObserver=h.onPrePointerObservable.add((Z=>{Z.type!==x.b.POINTERDOWN?Z.type===x.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((Z=>{Z&&Z.getBoundingInfo&&this.zoomOnMesh(Z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.CZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.sh(!0);const v=Z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(v.minimumWorld,v.maximumWorld,h,V)}zoomOnMeshHierarchy(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.sh(!0);const v=Z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(v.min,v.max,h,V)}zoomOnMeshesHierarchy(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new K.Ch(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new K.Ch(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let H=0;H<Z.length;H++){const h=Z[H].getHierarchyBoundingVectors(!0);K.Ch.CheckExtends(h.min,v,A),K.Ch.CheckExtends(h.max,v,A)}this.zoomOnBoundingInfo(v,A,h,V)}zoomOnBoundingInfo(Z,h){let V,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const H=Z.y,d=H+(h.y-H)*this._positionScale,a=h.rh(Z).scale(.5);if(!isFinite(d))return!1;if(v)V=new K.Ch(0,d,0);else{const h=Z.add(a);V=new K.Ch(h.x,d,h.z)}this._vectorTransition||(this._vectorTransition=F.c.CreateAnimation("target",F.c.ANIMATIONTYPE_VECTOR3,60,o.EasingFunction)),this._betaIsAnimating=!0;let n=F.c.TransitionTo("target",V,this._attachedCamera,this._attachedCamera.CZ(),60,this._vectorTransition,this._framingTime);n&&this._animatables.push(n);let x=0;if(this._mode===o.FitFrustumSidesMode){const V=this._calculateLowerRadiusFromModelBoundingSphere(Z,h);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=a.length()+this._attachedCamera.Rh),x=V}else this._mode===o.IgnoreBoundsSizeMode&&(x=this._calculateLowerRadiusFromModelBoundingSphere(Z,h),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Rh));if(this.autoCorrectCameraLimitsAndSensibility){const V=h.rh(Z).length();this._attachedCamera.panningSensibility=5e3/V,this._attachedCamera.wheelPrecision=100/x}return this._radiusTransition||(this._radiusTransition=F.c.CreateAnimation("radius",F.c.ANIMATIONTYPE_FLOAT,60,o.EasingFunction)),n=F.c.TransitionTo("radius",x,this._attachedCamera,this._attachedCamera.CZ(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),A&&A(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),n&&this._animatables.push(n),!0}_calculateLowerRadiusFromModelBoundingSphere(Z,h){const V=this._attachedCamera;if(!V)return 0;let v=V._calculateLowerRadiusFromModelBoundingSphere(Z,h,this._radiusScale);return V.lowerRadiusLimit&&this._mode===o.IgnoreBoundsSizeMode&&(v=v<V.lowerRadiusLimit?V.lowerRadiusLimit:v),V.upperRadiusLimit&&(v=v>V.upperRadiusLimit?V.upperRadiusLimit:v),v}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Z=N.e.Now-this._lastInteractionTime,h=.5*Math.PI-this._defaultElevation,V=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>V&&Z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.c.CreateAnimation("beta",F.c.ANIMATIONTYPE_FLOAT,60,o.EasingFunction));const Z=F.c.TransitionTo("beta",h,this._attachedCamera,this._attachedCamera.CZ(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Z&&this._animatables.push(Z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=N.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}o.EasingFunction=new u.x,o.EasingMode=u.s.EASINGMODE_EASEINOUT,o.IgnoreBoundsSizeMode=0,o.FitFrustumSidesMode=1;var q=V(12192),X=V(12222),E=V(13390),j=V(11564);class P{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Z){Z=j.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),V=h.getInputElement();let v=0,A=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=H=>{var K,d;const a=H.event,n="touch"===a.pointerType;if(H.type!==x.b.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const N=a.target;if(this._altKey=a.altKey,this._ctrlKey=a.ctrlKey,this._metaKey=a.metaKey,this._shiftKey=a.shiftKey,this._buttonsPressed=a.buttons,h.isPointerLock){const Z=a.movementX,h=a.movementY;this.onTouch(null,Z,h),this._pointA=null,this._pointB=null}else{if(H.type!==x.b.POINTERDOWN&&H.type!==x.b.POINTERDOUBLETAP&&n&&(null===(K=this._pointA)||void 0===K?void 0:K.pointerId)!==a.pointerId&&(null===(d=this._pointB)||void 0===d?void 0:d.pointerId)!==a.pointerId)return;if(H.type!==x.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!n)if(H.type===x.b.POINTERDOUBLETAP)this.onDoubleTap(a.pointerType);else if(H.type!==x.b.POINTERUP||this._currentMousePointerIdDown!==a.pointerId&&!n){if(H.type===x.b.POINTERMOVE)if(Z||a.preventDefault(),this._pointA&&null===this._pointB){const Z=a.clientX-this._pointA.x,h=a.clientY-this._pointA.y;this._pointA.x=a.clientX,this._pointA.y=a.clientY,this.onTouch(this._pointA,Z,h)}else if(this._pointA&&this._pointB){const Z=this._pointA.pointerId===a.pointerId?this._pointA:this._pointB;Z.x=a.clientX,Z.y=a.clientY;const h=this._pointA.x-this._pointB.x,V=this._pointA.y-this._pointB.y,K=h*h+V*V,d={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:a.pointerId,type:H.type};this.onMultiTouch(this._pointA,this._pointB,v,K,A,d),A=d,v=K}}else{try{null===N||void 0===N||N.releasePointerCapture(a.pointerId)}catch(D){}n||(this._pointB=null),h._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==a.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==a.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==v||A)&&(this.onMultiTouch(this._pointA,this._pointB,v,0,A,null),v=0,A=null),this._currentMousePointerIdDown=-1,this.onButtonUp(a),Z||a.preventDefault()}else{try{null===N||void 0===N||N.setPointerCapture(a.pointerId)}catch(D){}if(null===this._pointA)this._pointA={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType};else{if(null!==this._pointB)return;this._pointB={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType}}-1!==this._currentMousePointerIdDown||n||(this._currentMousePointerIdDown=a.pointerId),this.onButtonDown(a),Z||(a.preventDefault(),V&&V.focus())}}},this._observer=this.camera.CZ()._inputManager._addCameraPointerObserver(this._pointerInput,x.b.POINTERDOWN|x.b.POINTERUP|x.b.POINTERMOVE|x.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,v=0,A=null,this.onLostFocus()},this._contextMenuBind=Z=>this.onContextMenu(Z),V&&V.addEventListener("contextmenu",this._contextMenuBind,!1);const H=this.camera.CZ().getEngine().getHostWindow();H&&j.Tools.RegisterTopRootEvents(H,[{name:"blur",handler:this._onLostFocus}])}pN(){if(this._onLostFocus){const Z=this.camera.CZ().getEngine().getHostWindow();Z&&j.Tools.UnregisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.CZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Z=this.camera.CZ().getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Z){}onTouch(Z,h,V){}onMultiTouch(Z,h,V,v,A,H){}onContextMenu(Z){Z.preventDefault()}onButtonDown(Z){}onButtonUp(Z){}onLostFocus(){}}(0,v.b)([(0,A.I)()],P.prototype,"buttons",void 0);class C extends P{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Z,h){if(0!==this.panningSensibility&&Z&&h){const V=h.x-Z.x,v=h.y-Z.y;this.camera.inertialPanningX+=-V/this.panningSensibility,this.camera.inertialPanningY+=v/this.panningSensibility}}_computePinchZoom(Z,h){const V=this.camera.radius||C.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=V*Math.sqrt(Z)/Math.sqrt(h):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(h-Z)*V*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(h-Z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Z,h,V){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=V/this.panningSensibility):(this.camera.inertialAlphaOffset-=h/this.angularSensibilityX,this.camera.inertialBetaOffset-=V/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Z,h,V,v,A,H){0===V&&null===A||0===v&&null===H||(this.multiTouchPanAndZoom?(this._computePinchZoom(V,v),this._computeMultiTouchPanning(A,H)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(v)-Math.sqrt(V))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(V,v),this._isPinching=!0):this._computeMultiTouchPanning(A,H)):this.multiTouchPanning?this._computeMultiTouchPanning(A,H):this.pinchZoom&&this._computePinchZoom(V,v))}onButtonDown(Z){this._isPanClick=Z.button===this.camera._panningMouseButton}onButtonUp(Z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}C.MinimumRadiusForPinch=.001,(0,v.b)([(0,A.I)()],C.prototype,"buttons",void 0),(0,v.b)([(0,A.I)()],C.prototype,"angularSensibilityX",void 0),(0,v.b)([(0,A.I)()],C.prototype,"angularSensibilityY",void 0),(0,v.b)([(0,A.I)()],C.prototype,"pinchPrecision",void 0),(0,v.b)([(0,A.I)()],C.prototype,"pinchDeltaPercentage",void 0),(0,v.b)([(0,A.I)()],C.prototype,"useNaturalPinchZoom",void 0),(0,v.b)([(0,A.I)()],C.prototype,"pinchZoom",void 0),(0,v.b)([(0,A.I)()],C.prototype,"panningSensibility",void 0),(0,v.b)([(0,A.I)()],C.prototype,"multiTouchPanning",void 0),(0,v.b)([(0,A.I)()],C.prototype,"multiTouchPanAndZoom",void 0),E.c.ArcRotateCameraPointersInput=C;var l=V(12023);class B{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Z){Z=j.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.CZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const V=h.event;if(!V.metaKey)if(h.type===l.c.KEYDOWN){if(this._ctrlPressed=V.ctrlKey,this._altPressed=V.altKey,-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysReset.indexOf(V.keyCode)){-1===this._keys.indexOf(V.keyCode)&&this._keys.push(V.keyCode),V.preventDefault&&(Z||V.preventDefault())}}else if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysReset.indexOf(V.keyCode)){const h=this._keys.indexOf(V.keyCode);h>=0&&this._keys.splice(h,1),V.preventDefault&&(Z||V.preventDefault())}})))}pN(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let h=0;h<this._keys.length;h++){const V=this._keys[h];-1!==this.keysLeft.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX-=1/this.panningSensibility:Z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset+=1/this.zoomingSensibility:Z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX+=1/this.panningSensibility:Z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset-=1/this.zoomingSensibility:Z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(V)&&Z.useInputToRestoreState&&Z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,v.b)([(0,A.I)()],B.prototype,"keysUp",void 0),(0,v.b)([(0,A.I)()],B.prototype,"keysDown",void 0),(0,v.b)([(0,A.I)()],B.prototype,"keysLeft",void 0),(0,v.b)([(0,A.I)()],B.prototype,"keysRight",void 0),(0,v.b)([(0,A.I)()],B.prototype,"keysReset",void 0),(0,v.b)([(0,A.I)()],B.prototype,"panningSensibility",void 0),(0,v.b)([(0,A.I)()],B.prototype,"zoomingSensibility",void 0),(0,v.b)([(0,A.I)()],B.prototype,"useAltToZoom",void 0),(0,v.b)([(0,A.I)()],B.prototype,"angularSpeed",void 0),E.c.ArcRotateCameraKeyboardMoveInput=B;var S=V(11790),r=V(12026);class L{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new K.Ch(0,0,0),this._globalOffset=new K.Ch(0,0,0),this._inertialPanning=K.Ch.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Z,h){let V=0;const v=.01*Z*this.wheelDeltaPercentage*h;return V=Z>0?v/(1+this.wheelDeltaPercentage):v*(1+this.wheelDeltaPercentage),V}attachControl(Z){Z=j.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==x.b.POINTERWHEEL)return;const V=h.event;let v=0;const A=V.deltaMode===r.d.DOM_DELTA_LINE?40:1,H=-V.deltaY*A;if(this.customComputeDeltaFromMouseWheel)v=this.customComputeDeltaFromMouseWheel(H,this,V);else if(this.wheelDeltaPercentage){if(v=this._computeDeltaFromMouseWheelLegacyEvent(H,this.camera.radius),v>0){let Z=this.camera.radius,h=this.camera.inertialRadiusOffset+v;for(let V=0;V<20&&!(Z<=h)&&!(Math.abs(h*this.camera.inertia)<.001);V++)Z-=h,h*=this.camera.inertia;Z=(0,d.Clamp)(Z,0,Number.MAX_VALUE),v=this._computeDeltaFromMouseWheelLegacyEvent(H,Z)}}else v=H/(40*this.wheelPrecision);v&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(v)):this.camera.inertialRadiusOffset+=v),V.preventDefault&&(Z||V.preventDefault())},this._observer=this.camera.CZ()._inputManager._addCameraPointerObserver(this._wheel,x.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.vd(0)}pN(){this._observer&&(this.camera.CZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Z=this.camera;0+Z.inertialAlphaOffset+Z.inertialBetaOffset+Z.inertialRadiusOffset&&(this._updateHitPlane(),Z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Z=this.camera,h=Z.target.rh(Z.position);this._hitPlane=S.c.FromPositionAndNormal(Z.target,h)}_getPosition(){const Z=this.camera,h=Z.CZ(),V=h.createPickingRay(h.pointerX,h.pointerY,K.Matrix.Identity(),Z,!1);0===Z.targetScreenOffset.x&&0===Z.targetScreenOffset.y||(this._viewOffset.set(Z.targetScreenOffset.x,Z.targetScreenOffset.y,0),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),this._globalOffset=K.Ch.TransformNormal(this._viewOffset,Z._cameraTransformMatrix),V.origin.addInPlace(this._globalOffset));let v=0;return this._hitPlane&&(v=V.intersectsPlane(this._hitPlane)??0),V.origin.addInPlace(V.direction.scaleInPlace(v))}_zoomToMouse(Z){const h=this.camera,V=1-h.inertia;if(h.lowerRadiusLimit){const v=h.lowerRadiusLimit??0;h.radius-(h.inertialRadiusOffset+Z)/V<v&&(Z=(h.radius-v)*V-h.inertialRadiusOffset)}if(h.upperRadiusLimit){const v=h.upperRadiusLimit??0;h.radius-(h.inertialRadiusOffset+Z)/V>v&&(Z=(h.radius-v)*V-h.inertialRadiusOffset)}const v=Z/V/h.radius,A=this._getPosition(),H=K.TmpVectors.Ch[6];A.subtractToRef(h.target,H),H.scaleInPlace(v),H.scaleInPlace(V),this._inertialPanning.addInPlace(H),h.inertialRadiusOffset+=Z}_zeroIfClose(Z){Math.abs(Z.x)<D.c&&(Z.x=0),Math.abs(Z.y)<D.c&&(Z.y=0),Math.abs(Z.z)<D.c&&(Z.z=0)}}(0,v.b)([(0,A.I)()],L.prototype,"wheelPrecision",void 0),(0,v.b)([(0,A.I)()],L.prototype,"zoomToMouseLocation",void 0),(0,v.b)([(0,A.I)()],L.prototype,"wheelDeltaPercentage",void 0),E.c.ArcRotateCameraMouseWheelInput=L;class y extends E.g{constructor(Z){super(Z)}addMouseWheel(){return this.add(new L),this}addPointers(){return this.add(new C),this}addKeyboard(){return this.add(new B),this}}var W=V(11691);function z(Z,h){return isNaN(Z)?h:Z}a.c.AddNodeConstructor("ArcRotateCamera",((Z,h)=>()=>new m(Z,0,0,1,K.Ch.Zero(),h)));class m extends X.e{get target(){return this._target}set target(Z){this.setTarget(Z)}get targetHost(){return this._targetHost}set targetHost(Z){Z&&this.setTarget(Z)}getTarget(){return this.target}get position(){return this._position}set position(Z){this.setPosition(Z)}set upVector(Z){this._upToYMatrix||(this._yToUpMatrix=new K.Matrix,this._upToYMatrix=new K.Matrix,this._upVector=K.Ch.Zero()),Z.normalize(),this._upVector.v(Z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){K.Matrix.RotationAlignToRef(K.Ch.UpReadOnly,this._upVector,this._yToUpMatrix),K.Matrix.RotationAlignToRef(this._upVector,K.Ch.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityX:0}set angularSensibilityX(Z){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityX=Z)}get angularSensibilityY(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityY:0}set angularSensibilityY(Z){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityY=Z)}get pinchPrecision(){const Z=this.inputs.attached.pointers;return Z?Z.pinchPrecision:0}set pinchPrecision(Z){const h=this.inputs.attached.pointers;h&&(h.pinchPrecision=Z)}get pinchDeltaPercentage(){const Z=this.inputs.attached.pointers;return Z?Z.pinchDeltaPercentage:0}set pinchDeltaPercentage(Z){const h=this.inputs.attached.pointers;h&&(h.pinchDeltaPercentage=Z)}get useNaturalPinchZoom(){const Z=this.inputs.attached.pointers;return!!Z&&Z.useNaturalPinchZoom}set useNaturalPinchZoom(Z){const h=this.inputs.attached.pointers;h&&(h.useNaturalPinchZoom=Z)}get panningSensibility(){const Z=this.inputs.attached.pointers;return Z?Z.panningSensibility:0}set panningSensibility(Z){const h=this.inputs.attached.pointers;h&&(h.panningSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const h=this.inputs.attached.keyboard;h&&(h.keysUp=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const h=this.inputs.attached.keyboard;h&&(h.keysDown=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const h=this.inputs.attached.keyboard;h&&(h.keysRight=Z)}get wheelPrecision(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelPrecision:0}set wheelPrecision(Z){const h=this.inputs.attached.mousewheel;h&&(h.wheelPrecision=Z)}get zoomToMouseLocation(){const Z=this.inputs.attached.mousewheel;return!!Z&&Z.zoomToMouseLocation}set zoomToMouseLocation(Z){const h=this.inputs.attached.mousewheel;h&&(h.zoomToMouseLocation=Z)}get wheelDeltaPercentage(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelDeltaPercentage:0}set wheelDeltaPercentage(Z){const h=this.inputs.attached.mousewheel;h&&(h.wheelDeltaPercentage=Z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Z){Z!==this.useBouncingBehavior&&(Z?(this._bouncingBehavior=new b,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Z){Z!==this.useFramingBehavior&&(Z?(this._framingBehavior=new o,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Z){Z!==this.useAutoRotationBehavior&&(Z?(this._autoRotationBehavior=new k,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Z,h,V,v,A,d){var a;let n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Z,K.Ch.Zero(),d,n),a=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=K.Ch.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=K.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new K.Matrix,this.panningAxis=new K.Ch(1,1,0),this._transformedDirection=new K.Ch,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new H.b,this.checkCollisions=!1,this.collisionRadius=new K.Ch(.5,.5,.5),this._previousPosition=K.Ch.Zero(),this._collisionVelocity=K.Ch.Zero(),this._newPosition=K.Ch.Zero(),this._computationVector=K.Ch.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new K.Ch(NaN,NaN,NaN),this._goalTargetScreenOffset=new K.Vector2(NaN,NaN),this._onCollisionPositionChange=function(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V?(a.setPosition(h),a.mk&&a.mk(V)):a._previousPosition.v(a._position);const v=Math.cos(a.alpha),A=Math.sin(a.alpha),H=Math.cos(a.beta);let K=Math.sin(a.beta);0===K&&(K=1e-4);const d=a._getTargetPosition();a._computationVector.IV(a.radius*v*K,a.radius*H,a.radius*A*K),d.addToRef(a._computationVector,a._newPosition),a._position.v(a._newPosition);let n=a.upVector;a.allowUpsideDown&&a.beta<0&&(n=n.clone(),n=n.negate()),a._computeViewMatrix(a._position,d,n),a._viewMatrix.addAtIndex(12,a.targetScreenOffset.x),a._viewMatrix.addAtIndex(13,a.targetScreenOffset.y),a._collisionTriggered=!1},this._target=K.Ch.Zero(),A&&this.setTarget(A),this.alpha=h,this.beta=V,this.radius=v,this.getViewMatrix(),this.inputs=new y(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new K.Ch(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=K.Vector2.Zero()}_updateCache(Z){Z||super._updateCache(),this._cache._target.v(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.v(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Z.addToRef(this._targetBoundingCenter,this._target):this._target.v(Z)}const Z=this._getLockedTargetPosition();return Z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>D.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,H=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=H?this._currentInterpolationFactor=H:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=z(Z,this._goalAlpha),this._goalBeta=z(h,this._goalBeta),this._goalRadius=z(V,this._goalRadius),this._goalTarget.set(z(v.x,this._goalTarget.x),z(v.y,this._goalTarget.y),z(v.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(z(A.x,this._goalTargetScreenOffset.x),z(A.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,d.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,d.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,d.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,d.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Z,h){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const A=arguments;h=j.Tools.BackCompatCameraNoPreventDefault(A),this._useCtrlForPanning=V,this._panningMouseButton=v,"boolean"===typeof A[0]&&(A.length>1&&(this._useCtrlForPanning=A[1]),A.length>2&&(this._panningMouseButton=A[2])),this.inputs.attachElement(h),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}pN(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Z=!0;const h=this.invertRotation?-1:1,V=this._calculateHandednessMultiplier();let v=this.inertialAlphaOffset*V;this.beta<0&&(v*=-1),this.alpha+=v*h,this.beta+=this.inertialBetaOffset*h,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<D.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<D.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*D.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Z=!0;const h=new K.Ch(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),h.multiplyInPlace(this.panningAxis),K.Ch.TransformNormalToRef(h,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Z=this.upVector,h=K.Ch.CrossToRef(this._transformedDirection,Z,this._transformedDirection);K.Ch.CrossToRef(Z,h,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);K.Ch.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.v(this._transformedDirection)}else{if(this.parent){const Z=K.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.transposeToRef(Z),K.Ch.TransformCoordinatesToRef(this._transformedDirection,Z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*D.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*D.c&&(this.inertialPanningY=0)}if(Z)this.stopInterpolation();else if(this._isInterpolating){let Z=!1;const h=this._scene.getEngine().getDeltaTime()/1e3,V=1-Math.pow(2,-h/this._currentInterpolationFactor),v=z(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const h=K.TmpVectors.Ch[0].set(z(this._goalTarget.x,this._target.x),z(this._goalTarget.y,this._target.y),z(this._goalTarget.z,this._target.z));K.Ch.LerpToRef(this.target,h,V,this._target),10*K.Ch.Distance(this.target,h)/v<D.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.v(h),this.setTarget(this.target,!1,!0,!0)):Z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const h=K.Quaternion.RotationAlphaBetaGammaToRef(z(this._goalAlpha,this.alpha),z(this._goalBeta,this.beta),0,K.TmpVectors.Quaternion[0]),v=K.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,K.TmpVectors.Quaternion[1]),A=K.Quaternion.SlerpToRef(v,h,V,K.TmpVectors.Quaternion[2]);A.normalize();const H=A.toAlphaBetaGammaToRef(K.TmpVectors.Ch[0]);if(this.alpha=H.x,this.beta=H.y,A.isApprox(h,D.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Z=h.toAlphaBetaGammaToRef(K.TmpVectors.Ch[0]);this.alpha=Z.x,this.beta=Z.y}else Z=!0}if(isNaN(this._goalRadius)||(this.radius+=(v-this.radius)*V,Math.abs(v/this.radius-1)<D.c?(this._goalRadius=NaN,this.radius=v):Z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const h=K.TmpVectors.Vector2[0].set(z(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),z(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));K.Vector2.LerpToRef(this.targetScreenOffset,h,V,this.targetScreenOffset),K.Vector2.Distance(this.targetScreenOffset,h)<D.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.v(h)):Z=!0}this._isInterpolating=Z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||K.Ch.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Z=this.alpha;var h,V;this.alpha=function(Z){let h=Math.PI/2;return 0===Z.x&&0===Z.z||(h=Math.acos(Z.x/Math.sqrt(Math.pow(Z.x,2)+Math.pow(Z.z,2)))),Z.z<0&&(h=2*Math.PI-h),h}(this._computationVector),this.beta=(h=this._computationVector.y,V=this.radius,Math.acos(h/V));const v=Math.round((Z-this.alpha)/(2*Math.PI));this.alpha+=2*v*Math.PI,this._checkLimits()}setPosition(Z){this._position.equals(Z)||(this._position.v(Z),this.rebuildAnglesAndRadius())}setTarget(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(v=this.overrideCloneAlphaBetaRadius??v,Z.sh)h&&Z.getBoundingInfo?this._targetBoundingCenter=Z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Z.sh(),this._targetHost=Z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const h=Z,v=this._getTargetPosition();if(v&&!V&&v.equals(h))return;this._targetHost=null,this._target=h,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}v||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Z=Math.cos(this.alpha),h=Math.sin(this.alpha),V=Math.cos(this.beta);let v=Math.sin(this.beta);0===v&&(v=1e-4),0===this.radius&&(this.radius=1e-4);const A=this._getTargetPosition();if(this._computationVector.IV(this.radius*Z*v,this.radius*V,this.radius*h*v),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||K.Ch.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),A.addToRef(this._computationVector,this._newPosition),this.CZ().collisionsEnabled&&this.checkCollisions){const Z=this.CZ().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.v(this._newPosition);let Z=this.upVector;this.allowUpsideDown&&v<0&&(Z=Z.negate()),this._computeViewMatrix(this._position,A,Z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.v(A),this._viewMatrix}zoomOn(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z=Z||this.CZ().meshes;const V=n.c.MinMax(Z);let v=this._calculateLowerRadiusFromModelBoundingSphere(V.min,V.max);if(v=Math.max(Math.min(v,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=v*this.zoomOnFactor,this.mode===q.e.ORTHOGRAPHIC_CAMERA){const Z=this.CZ().getEngine().getAspectRatio(this),h=v*this.zoomOnFactor/2;this.orthoLeft=-h*Z,this.orthoRight=h*Z,this.orthoBottom=-h,this.orthoTop=h}this.focusOn({min:V.min,max:V.max,distance:v},h)}focusOn(Z){let h,V,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Z.min){const v=Z||this.CZ().meshes;h=n.c.MinMax(v),V=K.Ch.Distance(h.min,h.max)}else{h=Z,V=Z.distance}this._target=n.c.Center(h),v||(this.maxZ=2*V)}createRigCamera(Z,h){let V=0;switch(this.cameraRigMode){case q.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case q.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case q.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case q.e.RIG_MODE_VR:V=this._cameraRigParams.stereoHalfAngle*(0===h?1:-1);break;case q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V=this._cameraRigParams.stereoHalfAngle*(0===h?-1:1)}const v=new m(Z,this.alpha+V,this.beta,this.radius,this._target,this.CZ());return v._cameraRigParams={},v.isRigCamera=!0,v.rigParent=this,v.upVector=this.upVector,v.mode=this.mode,v.orthoLeft=this.orthoLeft,v.orthoRight=this.orthoRight,v.orthoBottom=this.orthoBottom,v.orthoTop=this.orthoTop,v}_updateRigCameras(){const Z=this._rigCameras[0],h=this._rigCameras[1];switch(Z.beta=h.beta=this.beta,this.cameraRigMode){case q.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case q.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case q.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case q.e.RIG_MODE_VR:Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const v=K.Ch.Distance(Z,h),A=this.CZ().getEngine().getAspectRatio(this),H=Math.tan(this.fov/2),d=H*A,a=.5*v*V,n=a*Math.sqrt(1+1/(d*d)),x=a*Math.sqrt(1+1/(H*H));return Math.max(n,x)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,v.b)([(0,A.I)()],m.prototype,"alpha",void 0),(0,v.b)([(0,A.I)()],m.prototype,"beta",void 0),(0,v.b)([(0,A.I)()],m.prototype,"radius",void 0),(0,v.b)([(0,A.I)()],m.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,v.b)([(0,A.G)("target")],m.prototype,"_target",void 0),(0,v.b)([(0,A.u)("targetHost")],m.prototype,"_targetHost",void 0),(0,v.b)([(0,A.I)()],m.prototype,"inertialAlphaOffset",void 0),(0,v.b)([(0,A.I)()],m.prototype,"inertialBetaOffset",void 0),(0,v.b)([(0,A.I)()],m.prototype,"inertialRadiusOffset",void 0),(0,v.b)([(0,A.I)()],m.prototype,"lowerAlphaLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"upperAlphaLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"lowerBetaLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"upperBetaLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"lowerRadiusLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"upperRadiusLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"lowerTargetYLimit",void 0),(0,v.b)([(0,A.I)()],m.prototype,"inertialPanningX",void 0),(0,v.b)([(0,A.I)()],m.prototype,"inertialPanningY",void 0),(0,v.b)([(0,A.I)()],m.prototype,"pinchToPanMaxDistance",void 0),(0,v.b)([(0,A.I)()],m.prototype,"panningDistanceLimit",void 0),(0,v.b)([(0,A.G)()],m.prototype,"panningOriginTarget",void 0),(0,v.b)([(0,A.I)()],m.prototype,"panningInertia",void 0),(0,v.b)([(0,A.I)()],m.prototype,"zoomToMouseLocation",null),(0,v.b)([(0,A.I)()],m.prototype,"zoomOnFactor",void 0),(0,v.b)([(0,A.C)()],m.prototype,"targetScreenOffset",void 0),(0,v.b)([(0,A.I)()],m.prototype,"allowUpsideDown",void 0),(0,v.b)([(0,A.I)()],m.prototype,"useInputToRestoreState",void 0),(0,v.b)([(0,A.I)()],m.prototype,"restoreStateInterpolationFactor",void 0),(0,W.i)("BABYLON.ArcRotateCamera",m)},13390:(Z,h,V)=>{"use strict";V.d(h,{c:()=>K,g:()=>d});var v=V(11580),A=V(11769),H=V(12192),K={};class d{constructor(Z){this.attachedToElement=!1,this.attached={},this.camera=Z,this.checkInputs=()=>{}}add(Z){const h=Z.getSimpleName();this.attached[h]?v.b.Warn("camera input of type "+h+" already exists on camera"):(this.attached[h]=Z,Z.camera=this.camera,Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z))),this.attachedToElement&&Z.attachControl(this.noPreventDefault))}remove(Z){for(const h in this.attached){const V=this.attached[h];if(V===Z)return V.pN(),V.camera=null,delete this.attached[h],void this.rebuildInputCheck()}}removeByType(Z){for(const h in this.attached){const V=this.attached[h];V.getClassName()===Z&&(V.pN(),V.camera=null,delete this.attached[h],this.rebuildInputCheck())}}_addCheckInputs(Z){const h=this.checkInputs;return()=>{h(),Z()}}attachInput(Z){this.attachedToElement&&Z.attachControl(this.noPreventDefault)}attachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Z=!H.e.ForceAttachControlToAlwaysPreventDefault&&Z,this.attachedToElement=!0,this.noPreventDefault=Z;for(const h in this.attached)this.attached[h].attachControl(Z)}}detachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const h in this.attached)this.attached[h].pN(),Z&&(this.attached[h].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Z in this.attached){const h=this.attached[Z];h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Z){const h={};for(const V in this.attached){const Z=this.attached[V],v=A.b.Serialize(Z);h[Z.getClassName()]=v}Z.inputsmgr=h}parse(Z){const h=Z.inputsmgr;if(h){this.clear();for(const Z in h){const V=K[Z];if(V){const v=h[Z],H=A.b.Parse((()=>new V),v,null);this.add(H)}}}else for(const V in this.attached){const h=K[this.attached[V].getClassName()];if(h){const v=A.b.Parse((()=>new h),Z,null);this.remove(this.attached[V]),this.add(v)}}}}},13387:(Z,h,V)=>{"use strict";V.d(h,{c:()=>P});var v=V(11720),A=V(11723),H=V(11729),K=V(12222),d=V(13390),a=V(12023),n=V(11564);class x{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Z){Z=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.CZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const V=h.event;if(!V.metaKey)if(h.type===a.c.KEYDOWN){if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysUpward.indexOf(V.keyCode)||-1!==this.keysDownward.indexOf(V.keyCode)||-1!==this.keysRotateLeft.indexOf(V.keyCode)||-1!==this.keysRotateRight.indexOf(V.keyCode)||-1!==this.keysRotateUp.indexOf(V.keyCode)||-1!==this.keysRotateDown.indexOf(V.keyCode)){-1===this._keys.indexOf(V.keyCode)&&this._keys.push(V.keyCode),Z||V.preventDefault()}}else if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysUpward.indexOf(V.keyCode)||-1!==this.keysDownward.indexOf(V.keyCode)||-1!==this.keysRotateLeft.indexOf(V.keyCode)||-1!==this.keysRotateRight.indexOf(V.keyCode)||-1!==this.keysRotateUp.indexOf(V.keyCode)||-1!==this.keysRotateDown.indexOf(V.keyCode)){const h=this._keys.indexOf(V.keyCode);h>=0&&this._keys.splice(h,1),Z||V.preventDefault()}})))}pN(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let h=0;h<this._keys.length;h++){const V=this._keys[h],v=Z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(V)?Z._localDirection.IV(-v,0,0):-1!==this.keysUp.indexOf(V)?Z._localDirection.IV(0,0,v):-1!==this.keysRight.indexOf(V)?Z._localDirection.IV(v,0,0):-1!==this.keysDown.indexOf(V)?Z._localDirection.IV(0,0,-v):-1!==this.keysUpward.indexOf(V)?Z._localDirection.IV(0,v,0):-1!==this.keysDownward.indexOf(V)?Z._localDirection.IV(0,-v,0):-1!==this.keysRotateLeft.indexOf(V)?(Z._localDirection.IV(0,0,0),Z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(V)?(Z._localDirection.IV(0,0,0),Z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(V)?(Z._localDirection.IV(0,0,0),Z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(V)&&(Z._localDirection.IV(0,0,0),Z.cameraRotation.x+=this._getLocalRotation()),Z.CZ().useRightHandedSystem&&(Z._localDirection.z*=-1),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),H.Ch.TransformNormalToRef(Z._localDirection,Z._cameraTransformMatrix,Z._transformedDirection),Z.cameraDirection.addInPlace(Z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Z}}(0,v.b)([(0,A.I)()],x.prototype,"keysUp",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysUpward",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysDown",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysDownward",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysLeft",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysRight",void 0),(0,v.b)([(0,A.I)()],x.prototype,"rotationSpeed",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysRotateLeft",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysRotateRight",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysRotateUp",void 0),(0,v.b)([(0,A.I)()],x.prototype,"keysRotateDown",void 0),d.c.FreeCameraKeyboardMoveInput=x;var N=V(11566),D=V(12019);class k{constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new N.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Z){Z=n.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),V=h.getInputElement();this._pointerInput||(this._pointerInput=v=>{const A=v.event,H="touch"===A.pointerType;if(!this.touchEnabled&&H)return;if(v.type!==D.b.POINTERMOVE&&-1===this.buttons.indexOf(A.button))return;const K=A.target;if(v.type===D.b.POINTERDOWN){if(H&&-1!==this._activePointerId||!H&&-1!==this._currentActiveButton)return;this._activePointerId=A.pointerId;try{null===K||void 0===K||K.setPointerCapture(A.pointerId)}catch(d){}-1===this._currentActiveButton&&(this._currentActiveButton=A.button),this._previousPosition={x:A.clientX,y:A.clientY},Z||(A.preventDefault(),V&&V.focus()),h.isPointerLock&&this._onMouseMove&&this._onMouseMove(v.event)}else if(v.type===D.b.POINTERUP){if(H&&this._activePointerId!==A.pointerId||!H&&this._currentActiveButton!==A.button)return;try{null===K||void 0===K||K.releasePointerCapture(A.pointerId)}catch(d){}this._currentActiveButton=-1,this._previousPosition=null,Z||A.preventDefault(),this._activePointerId=-1}else if(v.type===D.b.POINTERMOVE&&(this._activePointerId===A.pointerId||!H))if(h.isPointerLock&&this._onMouseMove)this._onMouseMove(v.event);else if(this._previousPosition){const h=this.camera._calculateHandednessMultiplier(),V=(A.clientX-this._previousPosition.x)*h,v=A.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=V/this.angularSensibility,this.camera.cameraRotation.x+=v/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:V,offsetY:v}),this._previousPosition={x:A.clientX,y:A.clientY},Z||A.preventDefault()}}),this._onMouseMove=V=>{if(!h.isPointerLock)return;const v=this.camera._calculateHandednessMultiplier(),A=V.movementX*v;this.camera.cameraRotation.y+=A/this.angularSensibility;const H=V.movementY;this.camera.cameraRotation.x+=H/this.angularSensibility,this._previousPosition=null,Z||V.preventDefault()},this._observer=this.camera.CZ()._inputManager._addCameraPointerObserver(this._pointerInput,D.b.POINTERDOWN|D.b.POINTERUP|D.b.POINTERMOVE),V&&(this._contextMenuBind=Z=>this.onContextMenu(Z),V.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Z){Z.preventDefault()}pN(){if(this._observer){if(this.camera.CZ()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,v.b)([(0,A.I)()],k.prototype,"buttons",void 0),(0,v.b)([(0,A.I)()],k.prototype,"angularSensibility",void 0),d.c.FreeCameraMouseInput=k;var u,F=V(12026);class b{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new N.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Z){Z=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==D.b.POINTERWHEEL)return;const V=h.event,v=V.deltaMode===F.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*v*V.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*v*V.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*v*V.deltaZ/this._normalize,V.preventDefault&&(Z||V.preventDefault())},this._observer=this.camera.CZ()._inputManager._addCameraPointerObserver(this._wheel,D.b.POINTERWHEEL)}pN(){this._observer&&(this.camera.CZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,v.b)([(0,A.I)()],b.prototype,"wheelPrecisionX",void 0),(0,v.b)([(0,A.I)()],b.prototype,"wheelPrecisionY",void 0),(0,v.b)([(0,A.I)()],b.prototype,"wheelPrecisionZ",void 0),function(Z){Z[Z.MoveRelative=0]="MoveRelative",Z[Z.RotateRelative=1]="RotateRelative",Z[Z.MoveScene=2]="MoveScene"}(u||(u={}));class o extends b{constructor(){super(...arguments),this._moveRelative=H.Ch.Zero(),this._rotateRelative=H.Ch.Zero(),this._moveScene=H.Ch.Zero(),this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Z){null===Z&&this._wheelXAction!==u.MoveRelative||(this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=Z)}get wheelXMoveRelative(){return this._wheelXAction!==u.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Z){null===Z&&this._wheelYAction!==u.MoveRelative||(this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=Z)}get wheelYMoveRelative(){return this._wheelYAction!==u.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Z){null===Z&&this._wheelZAction!==u.MoveRelative||(this._wheelZAction=u.MoveRelative,this._wheelZActionCoordinate=Z)}get wheelZMoveRelative(){return this._wheelZAction!==u.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Z){null===Z&&this._wheelXAction!==u.RotateRelative||(this._wheelXAction=u.RotateRelative,this._wheelXActionCoordinate=Z)}get wheelXRotateRelative(){return this._wheelXAction!==u.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Z){null===Z&&this._wheelYAction!==u.RotateRelative||(this._wheelYAction=u.RotateRelative,this._wheelYActionCoordinate=Z)}get wheelYRotateRelative(){return this._wheelYAction!==u.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Z){null===Z&&this._wheelZAction!==u.RotateRelative||(this._wheelZAction=u.RotateRelative,this._wheelZActionCoordinate=Z)}get wheelZRotateRelative(){return this._wheelZAction!==u.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Z){null===Z&&this._wheelXAction!==u.MoveScene||(this._wheelXAction=u.MoveScene,this._wheelXActionCoordinate=Z)}get wheelXMoveScene(){return this._wheelXAction!==u.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Z){null===Z&&this._wheelYAction!==u.MoveScene||(this._wheelYAction=u.MoveScene,this._wheelYActionCoordinate=Z)}get wheelYMoveScene(){return this._wheelYAction!==u.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Z){null===Z&&this._wheelZAction!==u.MoveScene||(this._wheelZAction=u.MoveScene,this._wheelZActionCoordinate=Z)}get wheelZMoveScene(){return this._wheelZAction!==u.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.vd(0),this._rotateRelative.vd(0),this._moveScene.vd(0),this._updateCamera(),this.camera.CZ().useRightHandedSystem&&(this._moveRelative.z*=-1);const Z=H.Matrix.Zero();this.camera.getViewMatrix().invertToRef(Z);const h=H.Ch.Zero();H.Ch.TransformNormalToRef(this._moveRelative,Z,h),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(h),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Z,h,V){if(0===Z)return;if(null===h||null===V)return;let v=null;switch(h){case u.MoveRelative:v=this._moveRelative;break;case u.RotateRelative:v=this._rotateRelative;break;case u.MoveScene:v=this._moveScene}switch(V){case 0:v.set(Z,0,0);break;case 1:v.set(0,Z,0);break;case 2:v.set(0,0,Z)}}}(0,v.b)([(0,A.I)()],o.prototype,"wheelXMoveRelative",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelYMoveRelative",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelZMoveRelative",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelXRotateRelative",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelYRotateRelative",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelZRotateRelative",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelXMoveScene",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelYMoveScene",null),(0,v.b)([(0,A.I)()],o.prototype,"wheelZMoveScene",null),d.c.FreeCameraMouseWheelInput=o;class q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=n.Tools.IsSafari()}attachControl(Z){Z=n.Tools.BackCompatCameraNoPreventDefault(arguments);let h=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=V=>{const v=V.event,A="mouse"===v.pointerType||this._isSafari&&"undefined"===typeof v.pointerType;if(this.allowMouse||!A)if(V.type===D.b.POINTERDOWN){if(Z||v.preventDefault(),this._pointerPressed.push(v.pointerId),1!==this._pointerPressed.length)return;h={x:v.clientX,y:v.clientY}}else if(V.type===D.b.POINTERUP){Z||v.preventDefault();const V=this._pointerPressed.indexOf(v.pointerId);if(-1===V)return;if(this._pointerPressed.splice(V,1),0!=V)return;h=null,this._offsetX=null,this._offsetY=null}else if(V.type===D.b.POINTERMOVE){if(Z||v.preventDefault(),!h)return;if(0!=this._pointerPressed.indexOf(v.pointerId))return;this._offsetX=v.clientX-h.x,this._offsetY=-(v.clientY-h.y)}}),this._observer=this.camera.CZ()._inputManager._addCameraPointerObserver(this._pointerInput,D.b.POINTERDOWN|D.b.POINTERUP|D.b.POINTERMOVE),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.addEventListener("blur",this._onLostFocus)}}pN(){if(this._pointerInput){if(this._observer&&(this.camera.CZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Z=this.camera,h=Z._calculateHandednessMultiplier();Z.cameraRotation.y=h*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const h=Z._computeLocalCameraSpeed(),V=new H.Ch(0,0,0!==this.touchMoveSensibility?h*this._offsetY/this.touchMoveSensibility:0);H.Matrix.RotationYawPitchRollToRef(Z.rotation.y,Z.rotation.x,0,Z._cameraRotationMatrix),Z.cameraDirection.addInPlace(H.Ch.TransformCoordinates(V,Z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,v.b)([(0,A.I)()],q.prototype,"touchAngularSensibility",void 0),(0,v.b)([(0,A.I)()],q.prototype,"touchMoveSensibility",void 0),d.c.FreeCameraTouchInput=q;class X extends d.g{constructor(Z){super(Z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new x),this}addMouse(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new k(Z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new o,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new q),this}clear(){super.clear(),this._mouseInput=null}}var E=V(11691),j=V(11635);class P extends K.e{get angularSensibility(){const Z=this.inputs.attached.mouse;return Z?Z.angularSensibility:0}set angularSensibility(Z){const h=this.inputs.attached.mouse;h&&(h.angularSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const h=this.inputs.attached.keyboard;h&&(h.keysUp=Z)}get keysUpward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUpward:[]}set keysUpward(Z){const h=this.inputs.attached.keyboard;h&&(h.keysUpward=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const h=this.inputs.attached.keyboard;h&&(h.keysDown=Z)}get keysDownward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDownward:[]}set keysDownward(Z){const h=this.inputs.attached.keyboard;h&&(h.keysDownward=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const h=this.inputs.attached.keyboard;h&&(h.keysRight=Z)}get keysRotateLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateLeft:[]}set keysRotateLeft(Z){const h=this.inputs.attached.keyboard;h&&(h.keysRotateLeft=Z)}get keysRotateRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateRight:[]}set keysRotateRight(Z){const h=this.inputs.attached.keyboard;h&&(h.keysRotateRight=Z)}get keysRotateUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateUp:[]}set keysRotateUp(Z){const h=this.inputs.attached.keyboard;h&&(h.keysRotateUp=Z)}get keysRotateDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateDown:[]}set keysRotateDown(Z){const h=this.inputs.attached.keyboard;h&&(h.keysRotateDown=Z)}constructor(Z,h,V){var v;super(Z,h,V,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),v=this,this.ellipsoid=new H.Ch(.5,1,.5),this.ellipsoidOffset=new H.Ch(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=H.Ch.Zero(),this._diffPosition=H.Ch.Zero(),this._newPosition=H.Ch.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v._newPosition.v(h),v._newPosition.subtractToRef(v._oldPosition,v._diffPosition),v._diffPosition.length()>j.d.CollisionsEpsilon&&(v.position.addToRef(v._diffPosition,v._deferredPositionUpdate),v._deferOnly?v._deferredUpdated=!0:v.position.v(v._deferredPositionUpdate),v.mk&&V&&v.mk(V))},this.inputs=new X(this),this.inputs.addKeyboard().addMouse()}attachControl(Z,h){h=n.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(h)}pN(){this.inputs.detachElement(),this.cameraDirection=new H.Ch(0,0,0),this.cameraRotation=new H.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Z){this._collisionMask=isNaN(Z)?-1:Z}_collideWithWorld(Z){let h;h=this.parent?H.Ch.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,h.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const V=this.CZ().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let v=Z;this.applyGravity&&(v=Z.add(this.CZ().gravity)),V.getNewPosition(this._oldPosition,v,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=H.Ch.Zero(),this._transformedDirection=H.Ch.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Z){this._needMoveForGravity=Z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.CZ().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Bd"}}(0,v.b)([(0,A.G)()],P.prototype,"ellipsoid",void 0),(0,v.b)([(0,A.G)()],P.prototype,"ellipsoidOffset",void 0),(0,v.b)([(0,A.I)()],P.prototype,"checkCollisions",void 0),(0,v.b)([(0,A.I)()],P.prototype,"applyGravity",void 0),(0,E.i)("BABYLON.FreeCamera",P)},14031:(Z,h,V)=>{"use strict";V.d(h,{d:()=>H});var v=V(11833),A=V(14039);class H{constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=V,this.bN=[],this._maxBlockCapacity=h||64,this._selectionContent=new v.d(1024),this._creationFunc=Z}update(Z,h,V){A.d._CreateBlocks(Z,h,V,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}qx(Z){for(let h=0;h<this.zx.length;h++){this.zx[h].addEntry(Z)}}ox(Z){for(let h=0;h<this.zx.length;h++){this.zx[h].removeEntry(Z)}}select(Z,h){this._selectionContent.reset();for(let V=0;V<this.zx.length;V++){this.zx[V].select(Z,this._selectionContent,h)}return h?this._selectionContent.concat(this.bN):this._selectionContent.concatWithNoDuplicate(this.bN),this._selectionContent}intersects(Z,h,V){this._selectionContent.reset();for(let v=0;v<this.zx.length;v++){this.zx[v].intersects(Z,h,this._selectionContent,V)}return V?this._selectionContent.concat(this.bN):this._selectionContent.concatWithNoDuplicate(this.bN),this._selectionContent}intersectsRay(Z){this._selectionContent.reset();for(let h=0;h<this.zx.length;h++){this.zx[h].intersectsRay(Z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bN),this._selectionContent}}H.CreationFuncForMeshes=(Z,h)=>{const V=Z.getBoundingInfo();!Z.isBlocked&&V.boundingBox.intersectsMinMax(h.jN,h.PN)&&h.entries.push(Z)},H.CreationFuncForSubMeshes=(Z,h)=>{Z.getBoundingInfo().boundingBox.intersectsMinMax(h.jN,h.PN)&&h.entries.push(Z)}},14039:(Z,h,V)=>{"use strict";V.d(h,{d:()=>H});var v=V(11729),A=V(12080);class H{constructor(Z,h,V,v,A,H){this.entries=[],this.CN=new Array,this._capacity=V,this._depth=v,this._maxDepth=A,this._creationFunc=H,this._minPoint=Z,this._maxPoint=h,this.CN.push(Z.clone()),this.CN.push(h.clone()),this.CN.push(Z.clone()),this.CN[2].x=h.x,this.CN.push(Z.clone()),this.CN[3].y=h.y,this.CN.push(Z.clone()),this.CN[4].z=h.z,this.CN.push(h.clone()),this.CN[5].z=Z.z,this.CN.push(h.clone()),this.CN[6].x=Z.x,this.CN.push(h.clone()),this.CN[7].y=Z.y}get Th(){return this._capacity}get jN(){return this._minPoint}get PN(){return this._maxPoint}addEntry(Z){if(this.zx)for(let h=0;h<this.zx.length;h++){this.zx[h].addEntry(Z)}else this._creationFunc(Z,this),this.entries.length>this.Th&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Z){if(this.zx){for(let h=0;h<this.zx.length;h++){this.zx[h].removeEntry(Z)}return}const h=this.entries.indexOf(Z);h>-1&&this.entries.splice(h,1)}addEntries(Z){for(let h=0;h<Z.length;h++){const V=Z[h];this.addEntry(V)}}select(Z,h,V){if(A.b.IsInFrustum(this.CN,Z)){if(this.zx){for(let v=0;v<this.zx.length;v++){this.zx[v].select(Z,h,V)}return}V?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersects(Z,h,V,v){if(A.b.IntersectsSphere(this._minPoint,this._maxPoint,Z,h)){if(this.zx){for(let A=0;A<this.zx.length;A++){this.zx[A].intersects(Z,h,V,v)}return}v?V.concat(this.entries):V.concatWithNoDuplicate(this.entries)}}intersectsRay(Z,h){if(Z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.zx){for(let V=0;V<this.zx.length;V++){this.zx[V].intersectsRay(Z,h)}return}h.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){H._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Z,h,V,A,K,d,a,n){a.zx=new Array;const x=new v.Ch((h.x-Z.x)/2,(h.y-Z.y)/2,(h.z-Z.z)/2);for(let v=0;v<2;v++)for(let h=0;h<2;h++)for(let N=0;N<2;N++){const D=Z.add(x.multiplyByFloats(v,h,N)),k=Z.add(x.multiplyByFloats(v+1,h+1,N+1)),u=new H(D,k,A,K+1,d,n);u.addEntries(V),a.zx.push(u)}}}},14048:(Z,h,V)=>{"use strict";V.d(h,{e:()=>x});var v=V(11983),A=V(11729),H=V(12157),K=V(13137),d=V(12014),a=V(14031),n=V(11599);v.e.prototype.createOrUpdateSelectionOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,V=this._getComponent(d.d.NAME_OCTREE);V||(V=new x(this),this.Fh(V)),this.uN||(this.uN=new a.d(a.d.CreationFuncForMeshes,Z,h));const v=this.getWorldExtends();return this.uN.update(v.min,v.max,this.meshes),this.uN},Object.defineProperty(v.e.prototype,"selectionOctree",{get:function(){return this.uN},enumerable:!0,configurable:!0}),H.e.prototype.createOrUpdateSubmeshesOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const V=this.CZ();let v=V._getComponent(d.d.NAME_OCTREE);v||(v=new x(V),V.Fh(v)),this._submeshesOctree||(this._submeshesOctree=new a.d(a.d.CreationFuncForSubMeshes,Z,h)),this.sh(!0);const A=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(A.minimumWorld,A.maximumWorld,this.zh),this._submeshesOctree};class x{constructor(Z){this.name=d.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new K.e(A.Ch.Zero(),new A.Ch(1,1,1)),(Z=Z||n.b.LastCreatedScene)&&(this.Wh=Z,this.Wh.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Wh.getActiveSubMeshCandidates=Z=>this.getActiveSubMeshCandidates(Z),this.Wh.getCollidingSubMeshCandidates=(Z,h)=>this.getCollidingSubMeshCandidates(Z,h),this.Wh.getIntersectingSubMeshCandidates=(Z,h)=>this.getIntersectingSubMeshCandidates(Z,h))}register(){this.Wh.onMeshRemovedObservable.add((Z=>{const h=this.Wh.selectionOctree;if(void 0!==h&&null!==h){const V=h.bN.indexOf(Z);-1!==V&&h.bN.splice(V,1)}})),this.Wh.onMeshImportedObservable.add((Z=>{const h=this.Wh.selectionOctree;void 0!==h&&null!==h&&h.qx(Z)}))}getActiveMeshCandidates(){var Z;return(null===(Z=this.Wh.uN)||void 0===Z?void 0:Z.select(this.Wh.frustumPlanes))||this.Wh._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Z){if(Z._submeshesOctree&&Z.useOctreeForRenderingSelection){return Z._submeshesOctree.select(this.Wh.frustumPlanes)}return this.Wh._getDefaultSubMeshCandidates(Z)}getIntersectingSubMeshCandidates(Z,h){if(Z._submeshesOctree&&Z.useOctreeForPicking){K.e.TransformToRef(h,Z.getWorldMatrix(),this._tempRay);return Z._submeshesOctree.intersectsRay(this._tempRay)}return this.Wh._getDefaultSubMeshCandidates(Z)}getCollidingSubMeshCandidates(Z,h){if(Z._submeshesOctree&&Z.useOctreeForCollisions){const V=h._velocityWorldLength+Math.max(h._radius.x,h._radius.y,h._radius.z);return Z._submeshesOctree.intersects(h._basePointWorld,V)}return this.Wh._getDefaultSubMeshCandidates(Z)}rebuild(){}dispose(){}}},13137:(Z,h,V)=>{"use strict";V.d(h,{e:()=>k});var v=V(11983),A=V(12192),H=V(11737),K=V(11729),d=V(11739),a=V(12070),n=V(12009),x=V(11599),N=V(12033);const D={internalPickerForMesh:void 0};class k{constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.c;this.origin=Z,this.direction=h,this.length=V,this.epsilon=v}clone(){return new k(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const v=k._TmpVector3[0].IV(Z.x-V,Z.y-V,Z.z-V),A=k._TmpVector3[1].IV(h.x+V,h.y+V,h.z+V);let H,K,d,a,n=0,x=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<v.x||this.origin.x>A.x)return!1}else if(H=1/this.direction.x,K=(v.x-this.origin.x)*H,d=(A.x-this.origin.x)*H,d===-1/0&&(d=1/0),K>d&&(a=K,K=d,d=a),n=Math.max(K,n),x=Math.min(d,x),n>x)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<v.y||this.origin.y>A.y)return!1}else if(H=1/this.direction.y,K=(v.y-this.origin.y)*H,d=(A.y-this.origin.y)*H,d===-1/0&&(d=1/0),K>d&&(a=K,K=d,d=a),n=Math.max(K,n),x=Math.min(d,x),n>x)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<v.z||this.origin.z>A.z)return!1}else if(H=1/this.direction.z,K=(v.z-this.origin.z)*H,d=(A.z-this.origin.z)*H,d===-1/0&&(d=1/0),K>d&&(a=K,K=d,d=a),n=Math.max(K,n),x=Math.min(d,x),n>x)return!1;return!0}intersectsBox(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Z.minimum,Z.maximum,h)}intersectsSphere(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=Z.center.x-this.origin.x,v=Z.center.y-this.origin.y,A=Z.center.z-this.origin.z,H=V*V+v*v+A*A,K=Z.radius+h,d=K*K;if(H<=d)return!0;const a=V*this.direction.x+v*this.direction.y+A*this.direction.z;if(a<0)return!1;return H-a*a<=d}intersectsTriangle(Z,h,V){const v=k._TmpVector3[0],A=k._TmpVector3[1],H=k._TmpVector3[2],d=k._TmpVector3[3],n=k._TmpVector3[4];h.subtractToRef(Z,v),V.subtractToRef(Z,A),K.Ch.CrossToRef(this.direction,A,H);const x=K.Ch.Dot(v,H);if(0===x)return null;const N=1/x;this.origin.subtractToRef(Z,d);const D=K.Ch.Dot(d,H)*N;if(D<-this.epsilon||D>1+this.epsilon)return null;K.Ch.CrossToRef(d,v,n);const u=K.Ch.Dot(this.direction,n)*N;if(u<-this.epsilon||D+u>1+this.epsilon)return null;const F=K.Ch.Dot(A,n)*N;return F>this.length?null:new a.d(1-D-u,D,F)}intersectsPlane(Z){let h;const V=K.Ch.Dot(Z.normal,this.direction);if(Math.abs(V)<9.99999997475243e-7)return null;{const v=K.Ch.Dot(Z.normal,this.origin);return h=(-Z.d-v)/V,h<0?h<-9.99999997475243e-7?null:0:h}}intersectsAxis(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Z){case"y":{const Z=(this.origin.y-h)/this.direction.y;return Z>0?null:new K.Ch(this.origin.x+this.direction.x*-Z,h,this.origin.z+this.direction.z*-Z)}case"x":{const Z=(this.origin.x-h)/this.direction.x;return Z>0?null:new K.Ch(h,this.origin.y+this.direction.y*-Z,this.origin.z+this.direction.z*-Z)}case"z":{const Z=(this.origin.z-h)/this.direction.z;return Z>0?null:new K.Ch(this.origin.x+this.direction.x*-Z,this.origin.y+this.direction.y*-Z,h)}default:return null}}intersectsMesh(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const d=K.TmpVectors.Matrix[0];return Z.getWorldMatrix().invertToRef(d),this._tmpRay?k.TransformToRef(this,d,this._tmpRay):this._tmpRay=k.Transform(this,d),Z.intersects(this._tmpRay,h,V,v,A,H)}intersectsMeshes(Z,h,V){V?V.length=0:V=[];for(let v=0;v<Z.length;v++){const A=this.intersectsMesh(Z[v],h);A.hit&&V.push(A)}return V.sort(this._comparePickingInfo),V}_comparePickingInfo(Z,h){return Z.distance<h.distance?-1:Z.distance>h.distance?1:0}intersectionSegment(Z,h,V){const v=this.origin,A=K.TmpVectors.Ch[0],H=K.TmpVectors.Ch[1],d=K.TmpVectors.Ch[2],a=K.TmpVectors.Ch[3];h.subtractToRef(Z,A),this.direction.scaleToRef(k._Rayl,d),v.addToRef(d,H),Z.subtractToRef(v,a);const n=K.Ch.Dot(A,A),x=K.Ch.Dot(A,d),N=K.Ch.Dot(d,d),D=K.Ch.Dot(A,a),u=K.Ch.Dot(d,a),F=n*N-x*x;let b,o,q=F,X=F;F<k._Smallnum?(b=0,q=1,o=u,X=N):(b=x*u-N*D,o=n*u-x*D,b<0?(b=0,o=u,X=N):b>q&&(b=q,o=u+x,X=N)),o<0?(o=0,-D<0?b=0:-D>n?b=q:(b=-D,q=n)):o>X&&(o=X,-D+x<0?b=0:-D+x>n?b=q:(b=-D+x,q=n));const E=Math.abs(b)<k._Smallnum?0:b/q,j=Math.abs(o)<k._Smallnum?0:o/X,P=K.TmpVectors.Ch[4];d.scaleToRef(j,P);const C=K.TmpVectors.Ch[5];A.scaleToRef(E,C),C.addInPlace(a);const l=K.TmpVectors.Ch[6];C.subtractToRef(P,l);return j>0&&j<=this.length&&l.lengthSquared()<V*V?C.length():-1}update(Z,h,V,v,A,H,d){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){k._RayDistant||(k._RayDistant=k.Zero()),k._RayDistant.unprojectRayToRef(Z,h,V,v,K.Matrix.IdentityReadOnly,H,d);const a=K.TmpVectors.Matrix[0];A.invertToRef(a),k.TransformToRef(k._RayDistant,a,this)}else this.unprojectRayToRef(Z,h,V,v,A,H,d);return this}static Zero(){return new k(K.Ch.Zero(),K.Ch.Zero())}static CreateNew(Z,h,V,v,A,H,K){return k.Zero().update(Z,h,V,v,A,H,K)}static CreateNewFromTo(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.Matrix.IdentityReadOnly;const v=new k(new K.Ch(0,0,0),new K.Ch(0,0,0));return k.CreateFromToToRef(Z,h,v,V)}static CreateFromToToRef(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.Matrix.IdentityReadOnly;V.origin.v(Z);const A=h.subtractToRef(Z,V.direction),H=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return V.length=H,V.direction.normalize(),k.TransformToRef(V,v,V)}static Transform(Z,h){const V=new k(new K.Ch(0,0,0),new K.Ch(0,0,0));return k.TransformToRef(Z,h,V),V}static TransformToRef(Z,h,V){K.Ch.TransformCoordinatesToRef(Z.origin,h,V.origin),K.Ch.TransformNormalToRef(Z.direction,h,V.direction),V.length=Z.length,V.epsilon=Z.epsilon;const v=V.direction,A=v.length();if(0!==A&&1!==A){const Z=1/A;v.x*=Z,v.y*=Z,v.z*=Z,V.length*=A}return V}unprojectRayToRef(Z,h,V,v,A,H,d){const a=K.TmpVectors.Matrix[0];A.multiplyToRef(H,a),a.multiplyToRef(d,a),a.invert();const n=x.b.LastCreatedEngine,N=K.TmpVectors.Ch[0];N.x=Z/V*2-1,N.y=-(h/v*2-1),N.z=null!==n&&void 0!==n&&n.useReverseDepthBuffer?1:null!==n&&void 0!==n&&n.isNDCHalfZRange?0:-1;const D=K.TmpVectors.Ch[1].IV(N.x,N.y,1-1e-8),k=K.TmpVectors.Ch[2],u=K.TmpVectors.Ch[3];K.Ch._UnprojectFromInvertedMatrixToRef(N,a,k),K.Ch._UnprojectFromInvertedMatrixToRef(D,a,u),this.origin.v(k),u.subtractToRef(k,this.direction),this.direction.normalize()}}function u(Z,h,V,v,A){let H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=k.Zero();return F(Z,h,V,v,K,A,H),K}function F(Z,h,V,v,A,H){let d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const n=Z.getEngine();if(!H&&!(H=Z.activeCamera))return Z;const x=H.viewport,N=n.getRenderHeight(),{x:D,y:k,width:u,height:F}=x.toGlobal(n.getRenderWidth(),N),b=1/n.getHardwareScalingLevel();return h=h*b-D,V=V*b-(N-k-F),A.update(h,V,u,F,v||K.Matrix.IdentityReadOnly,d?K.Matrix.IdentityReadOnly:H.getViewMatrix(),H.getProjectionMatrix(),a),Z}function b(Z,h,V,v,A){if(!n.c)return Z;const H=Z.getEngine();if(!A&&!(A=Z.activeCamera))throw new Error("Active camera not set");const d=A.viewport,a=H.getRenderHeight(),{x:x,y:N,width:D,height:k}=d.toGlobal(H.getRenderWidth(),a),u=K.Matrix.Identity(),F=1/H.getHardwareScalingLevel();return h=h*F-x,V=V*F-(a-N-k),v.update(h,V,D,k,u,u,A.getProjectionMatrix()),Z}function o(Z,h,V,v,A,H,K,d){const a=h(v,V.enableDistantPicking),n=V.intersects(a,A,K,H,v,d);return n&&n.hit?!A&&null!=Z&&n.distance>=Z.distance?null:n:null}function q(Z,h,V,v,A,H){let d=null;const a=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),x=Z.cameraToUseForPointers||Z.activeCamera,N=D.internalPickerForMesh||o;for(let n=0;n<Z.meshes.length;n++){const D=Z.meshes[n];if(V){if(!V(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.pa)continue;const k=a&&D.isWorldMatrixCameraDependent(),u=D.sh(k,x);if(D.hasThinInstances&&D.Wn){const Z=N(d,h,D,u,!0,!0,H);if(Z){if(A)return Z;const a=K.TmpVectors.Matrix[1],n=D.thinInstanceGetWorldMatrices();for(let Z=0;Z<n.length;Z++){if(V&&!V(D,Z))continue;n[Z].multiplyToRef(u,a);const K=N(d,h,D,a,v,A,H,!0);if(K&&(d=K,d.thinInstanceIndex=Z,v))return d}}}else{const Z=N(d,h,D,u,v,A,H);if(Z&&(d=Z,v))return d}}return d||new n.c}function X(Z,h,V,v){if(!n.c)return null;const A=[],H=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),d=Z.cameraToUseForPointers||Z.activeCamera,a=D.internalPickerForMesh||o;for(let n=0;n<Z.meshes.length;n++){const x=Z.meshes[n];if(V){if(!V(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.pa)continue;const N=H&&x.isWorldMatrixCameraDependent(),D=x.sh(N,d);if(x.hasThinInstances&&x.Wn){if(a(null,h,x,D,!0,!0,v)){const Z=K.TmpVectors.Matrix[1],H=x.thinInstanceGetWorldMatrices();for(let K=0;K<H.length;K++){if(V&&!V(x,K))continue;H[K].multiplyToRef(D,Z);const d=a(null,h,x,Z,!1,!1,v,!0);d&&(d.thinInstanceIndex=K,A.push(d))}}}else{const Z=a(null,h,x,D,!1,!1,v);Z&&A.push(Z)}}return A}function E(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,v=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;v||(v=Z.getWorldMatrix()),h.length=V,A?h.origin.v(A):h.origin.v(Z.position);const H=K.TmpVectors.Ch[2];H.set(0,0,Z._scene.useRightHandedSystem?-1:1);const d=K.TmpVectors.Ch[3];return K.Ch.TransformNormalToRef(H,v,d),K.Ch.NormalizeToRef(d,h.direction),h}var j,P;k._TmpVector3=(0,d.d)(6,K.Ch.Zero),k._RayDistant=k.Zero(),k._Smallnum=1e-8,k._Rayl=1e9,j=v.e,(P=A.e)&&(P.prototype.getForwardRay=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,h=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;return E(this,new k(K.Ch.Zero(),K.Ch.Zero(),Z),Z,h,V)},P.prototype.getForwardRayToRef=function(Z){return E(this,Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),j&&(N.b._IsPickingAvailable=!0,j.prototype.createPickingRay=function(Z,h,V,v){return u(this,Z,h,V,v,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),v.e.prototype.createPickingRayToRef=function(Z,h,V,v,A){return F(this,Z,h,V,v,A,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},v.e.prototype.createPickingRayInCameraSpace=function(Z,h,V){return function(Z,h,V,v){const A=k.Zero();return b(Z,h,V,A,v),A}(this,Z,h,V)},v.e.prototype.createPickingRayInCameraSpaceToRef=function(Z,h,V,v){return b(this,Z,h,V,v)},v.e.prototype.pickWithBoundingInfo=function(Z,h,V,v,A){return function(Z,h,V,v,A,H){if(!n.c)return null;const d=q(Z,(v=>(Z._tempPickingRay||(Z._tempPickingRay=k.Zero()),F(Z,h,V,v,Z._tempPickingRay,H||null),Z._tempPickingRay)),v,A,!0);return d&&(d.ray=u(Z,h,V,K.Matrix.Identity(),H||null)),d}(this,Z,h,V,v,A)},v.e.prototype.RV=function(Z,h,V,v,A,H){return function(Z,h,V,v,A,H,d){const a=q(Z,((v,A)=>(Z._tempPickingRay||(Z._tempPickingRay=k.Zero()),F(Z,h,V,v,Z._tempPickingRay,H||null,!1,A),Z._tempPickingRay)),v,A,!1,d);return a&&(a.ray=u(Z,h,V,K.Matrix.Identity(),H||null)),a}(this,Z,h,V,v,A,H)},v.e.prototype.pickWithRay=function(Z,h,V,v){return function(Z,h,V,v,A){const H=q(Z,(V=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=K.Matrix.Identity()),V.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=k.Zero()),k.TransformToRef(h,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),V,v,!1,A);return H&&(H.ray=h),H}(this,Z,h,V,v)},v.e.prototype.multiPick=function(Z,h,V,v,A){return function(Z,h,V,v,A,H){return X(Z,(v=>u(Z,h,V,v,A||null)),v,H)}(this,Z,h,V,v,A)},v.e.prototype.multiPickWithRay=function(Z,h,V){return function(Z,h,V,v){return X(Z,(V=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=K.Matrix.Identity()),V.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=k.Zero()),k.TransformToRef(h,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),V,v)}(this,Z,h,V)}},13426:(Z,h,V)=>{"use strict";var v=V(11673),A=V(11580),H=V(11602),K=V(11700),d=V(11635),a=V(11683);d.d.prototype._partialLoadFile=function(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Z,(Z=>{V[h]=Z,V._internalCount++,6===V._internalCount&&v(V)}),void 0,void 0,!0,((Z,h)=>{A&&Z&&A(Z.status+" "+Z.statusText,h)}))},d.d.prototype._cascadeLoadFiles=function(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=[];A._internalCount=0;for(let H=0;H<6;H++)this._partialLoadFile(V[H],H,A,h,v)},d.d.prototype._cascadeLoadImgs=function(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5?arguments[5]:void 0;const K=[];K._internalCount=0;for(let d=0;d<6;d++)this._partialLoadImg(v[d],d,K,Z,h,V,A,H)},d.d.prototype._partialLoadImg=function(Z,h,V,v,A,d){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7?arguments[7]:void 0;const x=(0,K.e)();(0,H.u)(Z,(Z=>{V[h]=Z,V._internalCount++,v&&v.removePendingData(x),6===V._internalCount&&d&&d(A,V)}),((Z,h)=>{v&&v.removePendingData(x),a&&a(Z,h)}),v?v.offlineProvider:null,n),v&&v.addPendingData(x)},d.d.prototype.createCubeTextureBase=function(Z,h,V,H){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8],D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,b=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,o=arguments.length>14&&void 0!==arguments[14]&&arguments[14],q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const X=u||new v.c(this,7);X.isCube=!0,X.url=Z,X.generateMipMaps=!H,X._lodGenerationScale=D,X._lodGenerationOffset=k,X._useSRGBBuffer=!!o&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!H),X!==u&&(X.label=Z.substring(0,60)),this._doNotHandleContextLost||(X._extension=x,X._files=V,X._buffer=q);const E=Z;this._transformTextureUrl&&!u&&(Z=this._transformTextureUrl(Z));const j=x??function(Z){const h=Z.split("?")[0],V=h.lastIndexOf(".");return V>-1?h.substring(V).toLowerCase():""}(Z),P=(0,a.b)(j),C=(Z,h)=>{X.dispose(),d?d(Z,h):Z&&A.b.Warn(Z)},l=(v,d)=>{Z===E?v&&C(v.status+" "+v.statusText,d):(A.b.Warn(`Failed to load ${Z}, falling back to the ${E}`),this.createCubeTextureBase(E,h,V,!!H,K,C,n,x,N,D,k,X,F,b,o,q))};if(P)P.then((v=>{const A=Z=>{F&&F(X,Z),v.loadCubeData(Z,X,N,K,((Z,h)=>{C(Z,h)}))};q?A(q):V&&6===V.length?v.supportCascades?this._cascadeLoadFiles(h,(Z=>A(Z.map((Z=>new Uint8Array(Z))))),V,C):C("Textures type does not support cascades."):this._loadFile(Z,(Z=>A(new Uint8Array(Z))),void 0,void 0,!0,l)}));else{if(!V||0===V.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(h,X,((Z,h)=>{b&&b(Z,h)}),V,C)}return this._internalTexturesCache.push(X),X}},14053:(Z,h,V)=>{"use strict";V(11580);var v=V(11870);V(11673),V(11813),V(11664),V(11913),V(11875);v.b},13450:(Z,h,V)=>{"use strict";V.d(h,{b:()=>A});var v=V(11691);class A{constructor(Z){this.value=this._toInt(Z)}_toInt(Z){return 0|Z}add(Z){return new A(this.value+Z.value)}rh(Z){return new A(this.value-Z.value)}multiply(Z){return new A(Math.imul(this.value,Z.value))}divide(Z){return new A(this.value/Z.value)}getClassName(){return A.ClassName}equals(Z){return this.value===Z.value}static FromValue(Z){return new A(Z)}toString(){return this.value.toString()}}A.ClassName="FlowGraphInteger",(0,v.i)("FlowGraphInteger",A)},13466:(Z,h,V)=>{"use strict";V.d(h,{c:()=>A,f:()=>H});var v=V(11729);class A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Bh=Z}get m(){return this.Bh}transformVector(Z){return this.transformVectorToRef(Z,new v.Vector2)}transformVectorToRef(Z,h){return h.x=Z.x*this.Bh[0]+Z.y*this.Bh[1],h.y=Z.x*this.Bh[2]+Z.y*this.Bh[3],h}mh(){return this.toArray()}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<4;h++)Z[h]=this.Bh[h];return Z}QV(Z){for(let h=0;h<4;h++)this.Bh[h]=Z[h];return this}multiplyToRef(Z,h){const V=Z.Bh,v=this.Bh,A=h.Bh;return A[0]=V[0]*v[0]+V[1]*v[2],A[1]=V[0]*v[1]+V[1]*v[3],A[2]=V[2]*v[0]+V[3]*v[2],A[3]=V[2]*v[1]+V[3]*v[3],h}multiply(Z){return this.multiplyToRef(Z,new A)}divideToRef(Z,h){const V=this.Bh,v=Z.Bh,A=h.Bh;return A[0]=V[0]/v[0],A[1]=V[1]/v[1],A[2]=V[2]/v[2],A[3]=V[3]/v[3],h}divide(Z){return this.divideToRef(Z,new A)}addToRef(Z,h){const V=this.Bh,v=Z.m,A=h.m;return A[0]=V[0]+v[0],A[1]=V[1]+v[1],A[2]=V[2]+v[2],A[3]=V[3]+v[3],h}add(Z){return this.addToRef(Z,new A)}subtractToRef(Z,h){const V=this.Bh,v=Z.m,A=h.m;return A[0]=V[0]-v[0],A[1]=V[1]-v[1],A[2]=V[2]-v[2],A[3]=V[3]-v[3],h}rh(Z){return this.subtractToRef(Z,new A)}transpose(){const Z=this.Bh;return new A([Z[0],Z[2],Z[1],Z[3]])}determinant(){const Z=this.Bh;return Z[0]*Z[3]-Z[1]*Z[2]}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const h=this.Bh,V=1/Z;return new A([h[3]*V,-h[1]*V,-h[2]*V,h[0]*V])}equals(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=this.Bh,v=Z.m;return 0===h?V[0]===v[0]&&V[1]===v[1]&&V[2]===v[2]&&V[3]===v[3]:Math.abs(V[0]-v[0])<h&&Math.abs(V[1]-v[1])<h&&Math.abs(V[2]-v[2])<h&&Math.abs(V[3]-v[3])<h}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Bh.join(", ")})`}}class H{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Bh=Z}get m(){return this.Bh}transformVector(Z){return this.transformVectorToRef(Z,new v.Ch)}transformVectorToRef(Z,h){const V=this.Bh;return h.x=Z.x*V[0]+Z.y*V[1]+Z.z*V[2],h.y=Z.x*V[3]+Z.y*V[4]+Z.z*V[5],h.z=Z.x*V[6]+Z.y*V[7]+Z.z*V[8],h}multiplyToRef(Z,h){const V=Z.Bh,v=this.Bh,A=h.m;return A[0]=V[0]*v[0]+V[1]*v[3]+V[2]*v[6],A[1]=V[0]*v[1]+V[1]*v[4]+V[2]*v[7],A[2]=V[0]*v[2]+V[1]*v[5]+V[2]*v[8],A[3]=V[3]*v[0]+V[4]*v[3]+V[5]*v[6],A[4]=V[3]*v[1]+V[4]*v[4]+V[5]*v[7],A[5]=V[3]*v[2]+V[4]*v[5]+V[5]*v[8],A[6]=V[6]*v[0]+V[7]*v[3]+V[8]*v[6],A[7]=V[6]*v[1]+V[7]*v[4]+V[8]*v[7],A[8]=V[6]*v[2]+V[7]*v[5]+V[8]*v[8],h}multiply(Z){return this.multiplyToRef(Z,new H)}divideToRef(Z,h){const V=this.Bh,v=Z.m,A=h.m;return A[0]=V[0]/v[0],A[1]=V[1]/v[1],A[2]=V[2]/v[2],A[3]=V[3]/v[3],A[4]=V[4]/v[4],A[5]=V[5]/v[5],A[6]=V[6]/v[6],A[7]=V[7]/v[7],A[8]=V[8]/v[8],h}divide(Z){return this.divideToRef(Z,new H)}addToRef(Z,h){const V=this.Bh,v=Z.m,A=h.m;return A[0]=V[0]+v[0],A[1]=V[1]+v[1],A[2]=V[2]+v[2],A[3]=V[3]+v[3],A[4]=V[4]+v[4],A[5]=V[5]+v[5],A[6]=V[6]+v[6],A[7]=V[7]+v[7],A[8]=V[8]+v[8],h}add(Z){return this.addToRef(Z,new H)}subtractToRef(Z,h){const V=this.Bh,v=Z.m,A=h.m;return A[0]=V[0]-v[0],A[1]=V[1]-v[1],A[2]=V[2]-v[2],A[3]=V[3]-v[3],A[4]=V[4]-v[4],A[5]=V[5]-v[5],A[6]=V[6]-v[6],A[7]=V[7]-v[7],A[8]=V[8]-v[8],h}rh(Z){return this.subtractToRef(Z,new H)}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<9;h++)Z[h]=this.Bh[h];return Z}mh(){return this.toArray()}QV(Z){for(let h=0;h<9;h++)this.Bh[h]=Z[h];return this}transpose(){const Z=this.Bh;return new H([Z[0],Z[3],Z[6],Z[1],Z[4],Z[7],Z[2],Z[5],Z[8]])}determinant(){const Z=this.Bh;return Z[0]*(Z[4]*Z[8]-Z[5]*Z[7])-Z[1]*(Z[3]*Z[8]-Z[5]*Z[6])+Z[2]*(Z[3]*Z[7]-Z[4]*Z[6])}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const h=this.Bh,V=1/Z;return new H([(h[4]*h[8]-h[5]*h[7])*V,(h[2]*h[7]-h[1]*h[8])*V,(h[1]*h[5]-h[2]*h[4])*V,(h[5]*h[6]-h[3]*h[8])*V,(h[0]*h[8]-h[2]*h[6])*V,(h[2]*h[3]-h[0]*h[5])*V,(h[3]*h[7]-h[4]*h[6])*V,(h[1]*h[6]-h[0]*h[7])*V,(h[0]*h[4]-h[1]*h[3])*V])}equals(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=this.Bh,v=Z.m;return 0===h?V[0]===v[0]&&V[1]===v[1]&&V[2]===v[2]&&V[3]===v[3]&&V[4]===v[4]&&V[5]===v[5]&&V[6]===v[6]&&V[7]===v[7]&&V[8]===v[8]:Math.abs(V[0]-v[0])<h&&Math.abs(V[1]-v[1])<h&&Math.abs(V[2]-v[2])<h&&Math.abs(V[3]-v[3])<h&&Math.abs(V[4]-v[4])<h&&Math.abs(V[5]-v[5])<h&&Math.abs(V[6]-v[6])<h&&Math.abs(V[7]-v[7])<h&&Math.abs(V[8]-v[8])<h}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Bh.join(", ")})`}}},13470:(Z,h,V)=>{"use strict";var v;function A(Z,h,V,v){switch(h){case"Animation":return v?Z.animations.find((Z=>Z.uniqueId===V))??null:Z.animations[V]??null;case"AnimationGroup":return v?Z.animationGroups.find((Z=>Z.uniqueId===V))??null:Z.animationGroups[V]??null;case"Mesh":return v?Z.meshes.find((Z=>Z.uniqueId===V))??null:Z.meshes[V]??null;case"Material":return v?Z.materials.find((Z=>Z.uniqueId===V))??null:Z.materials[V]??null;case"Sx":return v?Z.cameras.find((Z=>Z.uniqueId===V))??null:Z.cameras[V]??null;case"Light":return v?Z.lights.find((Z=>Z.uniqueId===V))??null:Z.lights[V]??null;default:return null}}V.d(h,{e:()=>A}),function(Z){Z.Animation="Animation",Z.AnimationGroup="AnimationGroup",Z.Mesh="Mesh",Z.Material="Material",Z.Sx="Sx",Z.Light="Light"}(v||(v={}))},13509:(Z,h,V)=>{"use strict";V.d(h,{b:()=>A});var v=V(13512);class A extends v.b{constructor(Z,h){if(super(Z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),h)for(const V of h)this._eventsSignalOutputs[V]=this._registerSignalOutput(V+"Event")}_executeOnTick(Z){}_startPendingTasks(Z){Z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Z),this._resetAfterCanceled(Z)),this._preparePendingTasks(Z),Z._addPendingBlock(this),this.out._activateSignal(Z),Z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Z){Z._deleteExecutionVariable(this,"_initialized"),Z._removePendingBlock(this)}}},13480:(Z,h,V)=>{"use strict";V.d(h,{d:()=>n});var v=V(11700),A=V(11691),H=V(13489),K=V(11566),d=V(13448);class a extends H.c{constructor(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v.defaultValue,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Z,h,V),this.richType=v,this._defaultValue=A,this._optional=H,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new K.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Z){this._isDisabled!==Z&&(this._isDisabled=Z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Z,h){h._getConnectionValue(this)!==Z&&(h._setConnectionValue(this,Z),this.onValueChangedObservable.notifyObservers(Z))}resetToDefaultValue(Z){Z._setConnectionValue(this,this._defaultValue)}connectTo(Z){this._isDisabled||super.connectTo(Z)}_getValueOrDefault(Z){const h=Z._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(h):h}getValue(Z){if(1===this.connectionType){Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Z);const h=this._getValueOrDefault(Z);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}const h=this.isConnected()?this._connectedPoint[0].getValue(Z):this._getValueOrDefault(Z);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.richType={},this.richType.serialize(Z.richType),Z.optional=this._optional,(0,d.e)("defaultValue",this._defaultValue,Z)}}(0,A.i)("FlowGraphDataConnection",a);class n{constructor(Z){var h;this.config=Z,this.uniqueId=(0,v.e)(),this.name=(null===(h=this.config)||void 0===h?void 0:h.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Z){}registerDataInput(Z,h,V){const v=new a(Z,0,this,h,V);return this.dataInputs.push(v),v}registerDataOutput(Z,h,V){const v=new a(Z,1,this,h,V);return this.dataOutputs.push(v),v}getDataInput(Z){return this.dataInputs.find((h=>h.name===Z))}getDataOutput(Z){return this.dataOutputs.find((h=>h.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.e;if(Z.uniqueId=this.uniqueId,Z.config={},this.config){const V=this.config,v=Object.keys(V);for(const A of v)h(A,V[A],Z.config)}Z.dataInputs=[],Z.dataOutputs=[],Z.className=this.getClassName();for(const V of this.dataInputs){const h={};V.serialize(h),Z.dataInputs.push(h)}for(const V of this.dataOutputs){const h={};V.serialize(h),Z.dataOutputs.push(h)}}deserialize(Z){}_log(Z,h,V){var v;null===(v=Z.logger)||void 0===v||v.addLogItem({action:h,wV:V,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13489:(Z,h,V)=>{"use strict";V.d(h,{c:()=>H});var v,A=V(11700);!function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(v||(v={}));class H{constructor(Z,h,V){this._ownerBlock=V,this._connectedPoint=[],this.uniqueId=(0,A.e)(),this.connectedPointIds=[],this.name=Z,this._connectionType=h}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Z){if(this._connectionType===Z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Z._isSingularConnection()&&Z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Z),Z._connectedPoint.push(this)}disconnectFrom(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=this._connectedPoint.indexOf(Z),v=Z._connectedPoint.indexOf(this);-1!==V&&-1!==v&&(h&&this._connectedPoint.splice(V,1),Z._connectedPoint.splice(v,1))}disconnectFromAll(){for(const Z of this._connectedPoint)this.disconnectFrom(Z,!1);this._connectedPoint.length=0}dispose(){for(const Z of this._connectedPoint)this.disconnectFrom(Z)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Z.uniqueId=this.uniqueId,Z.name=this.name,Z._connectionType=this._connectionType,Z.connectedPointIds=[],Z.className=this.getClassName();for(const h of this._connectedPoint)Z.connectedPointIds.push(h.uniqueId)}getClassName(){return"FGConnection"}deserialize(Z){this.uniqueId=Z.uniqueId,this.name=Z.name,this._connectionType=Z._connectionType,this.connectedPointIds=Z.connectedPointIds}}},13443:(Z,h,V)=>{"use strict";V.d(h,{e:()=>X});var v,A=V(11566),H=V(11720),K=V(11723),d=V(11700),a=V(13448),n=V(13470),x=V(11580);!function(Z){Z.ExecuteBlock="ExecuteBlock",Z.ExecuteEvent="ExecuteEvent",Z.TriggerConnection="TriggerConnection",Z.ContextVariableSet="ContextVariableSet",Z.GlobalVariableSet="GlobalVariableSet",Z.GlobalVariableDelete="GlobalVariableDelete",Z.GlobalVariableGet="GlobalVariableGet",Z.AddConnection="AddConnection",Z.GetConnectionValue="GetConnectionValue",Z.SetConnectionValue="SetConnectionValue",Z.ActivateSignal="ActivateSignal",Z.ContextVariableGet="ContextVariableGet"}(v||(v={}));class N{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Z){if(Z.time||(Z.time=Date.now()),this.log.push(Z),this.logToConsole){var h;const V=null===(h=Z.wV)||void 0===h?void 0:h.value;"object"===typeof V&&V.getClassName?x.b.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(V.getClassName())}: ${V.toString()}`):x.b.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(Z.wV)}`)}}getItemsOfType(Z){return this.log.filter((h=>h.action===Z))}}class D{get enableLogging(){return this._enableLogging}set enableLogging(Z){this._enableLogging!==Z&&(this._enableLogging=Z,this._enableLogging?(this.logger=new N,this.logger.logToConsole=!0):this.logger=null)}constructor(Z){this.uniqueId=(0,d.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new A.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Z,this.assetsContext=Z.assetsContext??Z.Wh}hasVariable(Z){return Z in this._userVariables}setVariable(Z,h){var V;this._userVariables[Z]=h,null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",wV:{name:Z,value:h}})}getAsset(Z,h){return(0,n.e)(this.assetsContext,Z,h)}getVariable(Z){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",wV:{name:Z,value:this._userVariables[Z]}}),this._userVariables[Z]}get userVariables(){return this._userVariables}CZ(){return this._configuration.Wh}_getUniqueIdPrefixedName(Z,h){return`${Z.uniqueId}_${h}`}_getGlobalContextVariable(Z,h){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",wV:{name:Z,defaultValue:h,possibleValue:this._globalContextVariables[Z]}}),this._hasGlobalContextVariable(Z)?this._globalContextVariables[Z]:h}_setGlobalContextVariable(Z,h){var V;null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",wV:{name:Z,value:h}}),this._globalContextVariables[Z]=h}_deleteGlobalContextVariable(Z){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",wV:{name:Z}}),delete this._globalContextVariables[Z]}_hasGlobalContextVariable(Z){return Z in this._globalContextVariables}_setExecutionVariable(Z,h,V){this._executionVariables[this._getUniqueIdPrefixedName(Z,h)]=V}_getExecutionVariable(Z,h,V){return this._hasExecutionVariable(Z,h)?this._executionVariables[this._getUniqueIdPrefixedName(Z,h)]:V}_deleteExecutionVariable(Z,h){delete this._executionVariables[this._getUniqueIdPrefixedName(Z,h)]}_hasExecutionVariable(Z,h){return this._getUniqueIdPrefixedName(Z,h)in this._executionVariables}_hasConnectionValue(Z){return Z.uniqueId in this._connectionValues}_setConnectionValue(Z,h){var V;this._connectionValues[Z.uniqueId]=h,null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",wV:{connectionPointId:Z.uniqueId,value:h}})}_setConnectionValueByKey(Z,h){this._connectionValues[Z]=h}_getConnectionValue(Z){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",wV:{connectionPointId:Z.uniqueId,value:this._connectionValues[Z.uniqueId]}}),this._connectionValues[Z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Z){this._pendingBlocks.includes(Z)||(this._pendingBlocks.push(Z),this._pendingBlocks.sort(((Z,h)=>Z.priority-h.priority)))}_removePendingBlock(Z){const h=this._pendingBlocks.indexOf(Z);-1!==h&&this._pendingBlocks.splice(h,1)}_clearPendingBlocks(){for(const Z of this._pendingBlocks)Z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Z){var h;this.onNodeExecutedObservable.notifyObservers(Z),null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:Z.getClassName(),uniqueId:Z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Z){this._setGlobalContextVariable("timeSinceStart",Z.timeSinceStart),this._setGlobalContextVariable("deltaTime",Z.deltaTime);for(const V of this._pendingBlocks){var h;null===(h=V._executeOnTick)||void 0===h||h.call(V,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.e;Z.uniqueId=this.uniqueId,Z._userVariables={};for(const v in this._userVariables)h(v,this._userVariables[v],Z._userVariables);Z._connectionValues={};for(const v in this._connectionValues)h(v,this._connectionValues[v],Z._connectionValues);var V;this.assetsContext!==this.CZ()&&(Z._assetsContext={meshes:this.assetsContext.meshes.map((Z=>Z.id)),materials:this.assetsContext.materials.map((Z=>Z.id)),textures:this.assetsContext.textures.map((Z=>Z.name)),animations:this.assetsContext.animations.map((Z=>Z.name)),lights:this.assetsContext.lights.map((Z=>Z.id)),cameras:this.assetsContext.cameras.map((Z=>Z.id)),pD:null===(V=this.assetsContext.pD)||void 0===V?void 0:V.map((Z=>Z.name)),skeletons:this.assetsContext.skeletons.map((Z=>Z.id)),bD:this.assetsContext.bD.map((Z=>Z.name)),geometries:this.assetsContext.geometries.map((Z=>Z.id)),multiMaterials:this.assetsContext.multiMaterials.map((Z=>Z.id)),transformNodes:this.assetsContext.transformNodes.map((Z=>Z.id))})}getClassName(){return"FlowGraphContext"}}(0,H.b)([(0,K.I)()],D.prototype,"uniqueId",void 0);var k=V(13474),u=V(12019);class F{constructor(Z){this.onEventTriggeredObservable=new A.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.jh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",wV:{timeSinceStart:this._startingTime,deltaTime:Z}}),this._startingTime+=Z})),this._meshPickedObserver=this._scene.onPointerObservable.add((Z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",wV:Z})}),u.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Z=>{const h=Z.pointerId,V=Z.mesh,v=this._pointerUnderMeshState[h];!v&&V?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",wV:{pointerId:h,mesh:V}}):v&&!V?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",wV:{pointerId:h,mesh:v}}):v&&V&&v!==V&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",wV:{pointerId:h,mesh:v,over:V}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",wV:{pointerId:h,mesh:V,out:v}})),this._pointerUnderMeshState[h]=V}),u.b.POINTERMOVE)}dispose(){var Z,h,V,v,A;null===(Z=this._sceneDisposeObserver)||void 0===Z||Z.remove(),null===(h=this._sceneReadyObserver)||void 0===h||h.remove(),null===(V=this._sceneOnBeforeRenderObserver)||void 0===V||V.remove(),null===(v=this._meshPickedObserver)||void 0===v||v.remove(),null===(A=this._meshUnderPointerObserver)||void 0===A||A.remove(),this.onEventTriggeredObservable.clear()}}var b,o=V(13491);!function(Z){Z[Z.Stopped=0]="Stopped",Z[Z.Started=1]="Started"}(b||(b={}));class q{get state(){return this._state}set state(Z){this._state=Z,this.onStateChangedObservable.notifyObservers(Z)}constructor(Z){this.onStateChangedObservable=new A.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Z.Wh,this._sceneEventCoordinator=new F(this._scene),this._coordinator=Z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Z=>{for(const h of this._executionContexts){const V=this._getContextualOrder(Z.type,h);for(const v of V)if(!v._executeEvent(h,Z.wV))break}switch(Z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const h of this._executionContexts)h._notifyOnTick(Z.wV);break;case"SceneDispose":this.dispose()}}))}createContext(){const Z=new D({Wh:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Z),Z}getContext(Z){return this._executionContexts[Z]}addEventBlock(Z){if("PointerOver"!==Z.type&&"PointerOut"!==Z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Z.type&&this._eventBlocks[Z.type].push(Z),1===this.state)for(const h of this._executionContexts)Z._startPendingTasks(h);else this.onStateChangedObservable.addOnce((h=>{if(1===h)for(const V of this._executionContexts)Z._startPendingTasks(V)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Z=>{1===Z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Z of this._executionContexts)for(const h in this._eventBlocks){const V=this._getContextualOrder(h,Z);for(const h of V)h._startPendingTasks(Z)}}_getContextualOrder(Z,h){const V=this._eventBlocks[Z].sort(((Z,h)=>h.initPriority-Z.initPriority));if("MeshPick"===Z){const Z=[];for(const v of V){const A=v.asset.getValue(h);let H=0;for(;H<V.length;H++){const Z=V[H].asset.getValue(h);if(A&&Z&&(0,o.o)(A,Z))break}Z.splice(H,0,v)}return Z}return V}dispose(){var Z;if(0!==this.state){this.state=0;for(const Z of this._executionContexts)Z._clearPendingBlocks();this._executionContexts.length=0;for(const Z in this._eventBlocks)this._eventBlocks[Z].length=0;null===(Z=this._eventObserver)||void 0===Z||Z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Z){const h=[],V=new Set;for(const v in this._eventBlocks)for(const Z of this._eventBlocks[v])h.push(Z),V.add(Z.uniqueId);for(;h.length>0;){const v=h.pop();Z(v);for(const Z of v.dataInputs)for(const v of Z._connectedPoint)V.has(v._ownerBlock.uniqueId)||(h.push(v._ownerBlock),V.add(v._ownerBlock.uniqueId));if(v instanceof k.b)for(const Z of v.signalOutputs)for(const v of Z._connectedPoint)V.has(v._ownerBlock.uniqueId)||(h.push(v._ownerBlock),V.add(v._ownerBlock.uniqueId))}}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1?arguments[1]:void 0;Z.allBlocks=[],this.visitAllBlocks((h=>{const V={};h.serialize(V),Z.allBlocks.push(V)})),Z.executionContexts=[];for(const V of this._executionContexts){const v={};V.serialize(v,h),Z.executionContexts.push(v)}}}class X{constructor(Z){this.config=Z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Wh.jh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Wh.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Z=this._executeOnNextFrame.slice(0);if(Z.length)for(const h of Z){this.notifyCustomEvent(h.id,h.data,!1);const Z=this._executeOnNextFrame.findIndex((Z=>Z.uniqueId===h.uniqueId));-1!==Z&&this._executeOnNextFrame.splice(Z,1)}}));(X.SceneCoordinators.get(this.config.Wh)??[]).push(this)}createGraph(){const Z=new q({Wh:this.config.Wh,coordinator:this});return this._flowGraphs.push(Z),Z}removeGraph(Z){const h=this._flowGraphs.indexOf(Z);-1!==h&&(Z.dispose(),this._flowGraphs.splice(h,1))}start(){for(const Z of this._flowGraphs)Z.start()}dispose(){var Z,h;for(const A of this._flowGraphs)A.dispose();this._flowGraphs.length=0,null===(Z=this._disposeObserver)||void 0===Z||Z.remove(),null===(h=this._onBeforeRenderObserver)||void 0===h||h.remove();const V=X.SceneCoordinators.get(this.config.Wh)??[],v=V.indexOf(this);-1!==v&&V.splice(v,1)}serialize(Z,h){Z._flowGraphs=[];for(const V of this._flowGraphs){const v={};V.serialize(v,h),Z._flowGraphs.push(v)}Z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Z){let h=this._customEventsMap.get(Z);return h||(h=new A.b,this._customEventsMap.set(Z,h)),h}notifyCustomEvent(Z,h){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Z,data:h,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Z)){const h=this._eventExecutionCounter.get(Z);if(this._eventExecutionCounter.set(Z,h+1),h>=X.MaxEventTypeExecutionPerFrame)return void(h===X.MaxEventTypeExecutionPerFrame&&x.b.Warn(`FlowGraphCoordinator: Too many executions of event "${Z}".`))}else this._eventExecutionCounter.set(Z,1);const V=this._customEventsMap.get(Z);V&&V.notifyObservers(h)}}X.MaxEventsPerType=30,X.MaxEventTypeExecutionPerFrame=30,X.SceneCoordinators=new Map},13500:(Z,h,V)=>{"use strict";V.d(h,{d:()=>A});var v=V(13509);class A extends v.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Z){Z._notifyExecuteNode(this),this.done._activateSignal(Z)}}},13474:(Z,h,V)=>{"use strict";V.d(h,{b:()=>d});var v=V(13480),A=V(13489),H=V(11691);class K extends A.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Z){super.connectTo(Z),this._connectedPoint.sort(((Z,h)=>h.priority-Z.priority))}_activateSignal(Z){var h;if(null===(h=Z.logger)||void 0===h||h.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,wV:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Z,this),Z._increaseExecutionId();else for(const V of this._connectedPoint)V._activateSignal(Z)}}(0,H.i)("FlowGraphSignalConnection",K);class d extends v.d{constructor(Z){super(Z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Z){const h=new K(Z,0,this);return this.signalInputs.push(h),h}_registerSignalOutput(Z){const h=new K(Z,1,this);return this.signalOutputs.push(h),h}_unregisterSignalInput(Z){const h=this.signalInputs.findIndex((h=>h.name===Z));-1!==h&&(this.signalInputs[h].dispose(),this.signalInputs.splice(h,1))}_unregisterSignalOutput(Z){const h=this.signalOutputs.findIndex((h=>h.name===Z));-1!==h&&(this.signalOutputs[h].dispose(),this.signalOutputs.splice(h,1))}_reportError(Z,h){this.error.wV="string"===typeof h?new Error(h):h,this.error._activateSignal(Z)}getSignalInput(Z){return this.signalInputs.find((h=>h.name===Z))}getSignalOutput(Z){return this.signalOutputs.find((h=>h.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.signalInputs=[],Z.signalOutputs=[];for(const h of this.signalInputs){const V={};h.serialize(V),Z.signalInputs.push(V)}for(const h of this.signalOutputs){const V={};h.serialize(V),Z.signalOutputs.push(V)}}deserialize(Z){for(let h=0;h<Z.signalInputs.length;h++){const V=this.getSignalInput(Z.signalInputs[h].name);if(!V)throw new Error("Could not find signal input with name "+Z.signalInputs[h].name+" in block "+Z.className);V.deserialize(Z.signalInputs[h])}for(let h=0;h<Z.signalOutputs.length;h++){const V=this.getSignalOutput(Z.signalOutputs[h].name);if(!V)throw new Error("Could not find signal output with name "+Z.signalOutputs[h].name+" in block "+Z.className);V.deserialize(Z.signalOutputs[h])}}getClassName(){return"FlowGraphExecutionBlock"}}},13512:(Z,h,V)=>{"use strict";V.d(h,{b:()=>A});var v=V(13474);class A extends v.b{constructor(Z){super(Z),this.out=this._registerSignalOutput("out")}}},13459:(Z,h,V)=>{"use strict";V.d(h,{A:()=>x,C:()=>k,G:()=>u,K:()=>F,O:()=>B,R:()=>S,S:()=>l,T:()=>C,c:()=>n,f:()=>D,h:()=>P,k:()=>b,m:()=>o,p:()=>q,t:()=>N,x:()=>j});var v,A=V(11729),H=V(11781),K=V(13450),d=V(13466);!function(Z){Z.Any="any",Z.String="string",Z.Number="number",Z.Boolean="boolean",Z.Object="object",Z.Integer="FlowGraphInteger",Z.Vector2="Vector2",Z.Ch="Ch",Z.Vector4="Vector4",Z.Quaternion="Quaternion",Z.Matrix="Matrix",Z.Matrix2D="Matrix2D",Z.Matrix3D="Matrix3D",Z.Ih="Ih",Z.nd="nd"}(v||(v={}));class a{constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Z,this.defaultValue=h,this.animationType=V}serialize(Z){Z.typeName=this.typeName,Z.defaultValue=this.defaultValue}}const n=new a("any",void 0),x=new a("string",""),N=new a("number",0,0),D=new a("boolean",!1),k=new a("Vector2",A.Vector2.Zero(),5),u=new a("Ch",A.Ch.Zero(),1),F=new a("Vector4",A.Vector4.Zero()),b=new a("Matrix",A.Matrix.Identity(),3),o=new a("Matrix2D",new d.c),q=new a("Matrix3D",new d.f),X=new a("Ih",H.Ih.Black(),4),E=new a("nd",new H.nd(0,0,0,0),7),j=new a("Quaternion",A.Quaternion.Identity(),2);j.typeTransformer=Z=>{if(Z.getClassName){if("Vector4"===Z.getClassName())return A.Quaternion.eh(Z.mh());if("Ch"===Z.getClassName())return A.Quaternion.FromEulerVector(Z);if("Matrix"===Z.getClassName())return A.Quaternion.FromRotationMatrix(Z)}return Z};const P=new a("FlowGraphInteger",new K.b(0),0);function C(Z){const h=Z;switch(typeof Z){case"string":return x;case"number":return N;case"boolean":return D;case"object":if(h.getClassName)switch(h.getClassName()){case"Vector2":return k;case"Ch":return u;case"Vector4":return F;case"Matrix":return b;case"Ih":return X;case"nd":return E;case"Quaternion":return j;case"FlowGraphInteger":return P;case"Matrix2D":return o;case"Matrix3D":return q}return n;default:return n}}function l(Z){switch(Z){case"string":return x;case"number":return N;case"boolean":return D;case"Vector2":return k;case"Ch":return u;case"Vector4":return F;case"Matrix":return b;case"Ih":return X;case"nd":return E;case"Quaternion":return j;case"FlowGraphInteger":return P;case"Matrix2D":return o;case"Matrix3D":return q;default:return n}}function B(Z){switch(Z){case"number":default:return 0;case"Vector2":return 5;case"Ch":return 1;case"Matrix":return 3;case"Ih":return 4;case"nd":return 7;case"Quaternion":return 2}}function S(Z){switch(Z){case 0:return N;case 5:return k;case 1:return u;case 3:return b;case 4:return X;case 7:return E;case 2:return j;default:return n}}},13448:(Z,h,V)=>{"use strict";V.d(h,{d:()=>x,e:()=>n,i:()=>N});var v=V(11781),A=V(11729),H=V(13450),K=V(13459),d=V(13466);function a(Z){return"Vector2"===Z||"Ch"===Z||"Vector4"===Z||"Quaternion"===Z||"Ih"===Z||"nd"===Z}function n(Z,h,V){var v;const A=(null===h||void 0===h||null===(v=h.getClassName)||void 0===v?void 0:v.call(h))??"";if(a(A)||function(Z){return"Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z}(A))V[Z]={value:h.mh(),className:A};else if("FlowGraphInteger"===A)V[Z]={value:h.value,className:A};else if(A&&(h.id||h.name))V[Z]={id:h.id,name:h.name,className:A};else{if("object"===typeof h)throw new Error(`Could not serialize value ${h}`);V[Z]=h}}function x(Z,h,V,n){const N=h[Z];let D;const k=(null===N||void 0===N?void 0:N.type)??(null===N||void 0===N?void 0:N.className);if(function(Z){return"Mesh"===Z||"AbstractMesh"===Z||"GroundMesh"===Z||"InstanceMesh"===Z||"LinesMesh"===Z||"GoldbergMesh"===Z||"GreasedLineMesh"===Z||"TrailMesh"===Z}(k)){let Z=n.meshes.filter((Z=>N.id?Z.id===N.id:Z.name===N.name));0===Z.length&&(Z=n.transformNodes.filter((Z=>N.id?Z.id===N.id:Z.name===N.name))),D=N.uniqueId?Z.find((Z=>Z.uniqueId===N.uniqueId)):Z[0]}else if(a(k))D=function(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Z)return A.Vector2.eh(h);if("Ch"===Z)return V&&(h[2]*=-1),A.Ch.eh(h);if("Vector4"===Z)return A.Vector4.eh(h);if("Quaternion"===Z)return V&&(h[2]*=-1,h[3]*=-1),A.Quaternion.eh(h);if("Ih"===Z)return new v.Ih(h[0],h[1],h[2]);if("nd"===Z)return new v.nd(h[0],h[1],h[2],h[3]);throw new Error(`Unknown vector class name ${Z}`)}(k,N.value);else if(function(Z){return"AnimationGroup"===Z}(k)){const Z=n.animationGroups.filter((Z=>Z.name===N.name));D=1===Z.length?Z[0]:Z.find((Z=>Z.uniqueId===N.uniqueId))}else D="Matrix"===k?A.Matrix.eh(N.value):"Matrix2D"===k?new d.c(N.value):"Matrix3D"===k?new d.f(N.value):"FlowGraphInteger"===k?H.b.FromValue(N.value):"number"===k||"string"===k||"boolean"===k?N.value[0]:N&&void 0!==N.value?N.value:Array.isArray(N)?N.reduce(((Z,h)=>h.eventData?(Z[h.id]={type:(0,K.S)(h.type)},"undefined"!==typeof h.value&&(Z[h.id].value=x("value",h,V,n)),Z):Z),{}):N;return D}function N(Z){return"FlowGraphJsonPointerParserBlock"===Z}},13491:(Z,h,V)=>{"use strict";function v(Z,h){return!(!Z.parent||Z.parent!==h&&!v(Z.parent,h))}function A(Z){if(Z.getClassName)return Z.getClassName()}function H(Z,h){return Z===h&&("Vector2"===Z||"Ch"===Z||"Vector4"===Z||"Quaternion"===Z)}function K(Z,h){return Z===h&&("Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z)}function d(Z,h){return"FlowGraphInteger"===Z&&"FlowGraphInteger"===h}function a(Z,h){const V="number"===typeof Z||"number"===typeof(null===Z||void 0===Z?void 0:Z.value);return V&&!h?!isNaN(n(Z)):V}function n(Z){return"number"===typeof Z?Z:Z.value}V.d(h,{d:()=>d,g:()=>K,k:()=>H,l:()=>A,o:()=>v,q:()=>n,u:()=>a})},12852:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{SceneInstrumentation:()=>H});var v=V(11564),A=V(11962);class H{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Z){Z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Z,Z?(this._onBeforeActiveMeshesEvaluationObserver=this.Wh.onBeforeActiveMeshesEvaluationObservable.add((()=>{v.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Wh.onAfterActiveMeshesEvaluationObservable.add((()=>{v.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Wh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Wh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Z){Z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Z,Z?(this._onBeforeRenderTargetsRenderObserver=this.Wh.onBeforeRenderTargetsRenderObservable.add((()=>{v.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Wh.onAfterRenderTargetsRenderObservable.add((()=>{v.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Wh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Wh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Z){Z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Z,Z?(this._onBeforeParticlesRenderingObserver=this.Wh.onBeforeParticlesRenderingObservable.add((()=>{v.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Wh.onAfterParticlesRenderingObservable.add((()=>{v.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Wh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Wh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Z){Z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Z,this.Wh.spriteManagers&&(Z?(this._onBeforeSpritesRenderingObserver=this.Wh.onBeforeSpritesRenderingObservable.add((()=>{v.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Wh.onAfterSpritesRenderingObservable.add((()=>{v.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Wh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Wh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Z){Z!==this._capturePhysicsTime&&this.Wh.onBeforePhysicsObservable&&(this._capturePhysicsTime=Z,Z?(this._onBeforePhysicsObserver=this.Wh.onBeforePhysicsObservable.add((()=>{v.Tools.StartPerformanceCounter("Sd"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Wh.onAfterPhysicsObservable.add((()=>{v.Tools.EndPerformanceCounter("Sd"),this._physicsTime.endMonitoring()}))):(this.Wh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Wh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Z){Z!==this._captureAnimationsTime&&(this._captureAnimationsTime=Z,Z?this._onAfterAnimationsObserver=this.Wh.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Wh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Z){this._captureFrameTime=Z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Z){this._captureInterFrameTime=Z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Z){Z!==this._captureRenderTime&&(this._captureRenderTime=Z,Z?(this._onBeforeDrawPhaseObserver=this.Wh.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),v.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Wh.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),v.Tools.EndPerformanceCounter("Main render")}))):(this.Wh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Wh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Z){Z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Z,Z?(this._onBeforeCameraRenderObserver=this.Wh.onBeforeCameraRenderObservable.add((Z=>{this._cameraRenderTime.beginMonitoring(),v.Tools.StartPerformanceCounter(`Rendering camera ${Z.name}`)})),this._onAfterCameraRenderObserver=this.Wh.onAfterCameraRenderObservable.add((Z=>{this._cameraRenderTime.endMonitoring(!1),v.Tools.EndPerformanceCounter(`Rendering camera ${Z.name}`)}))):(this.Wh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Wh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Wh.getEngine()._drawCalls}constructor(Z){this.Wh=Z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new A.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new A.d,this._captureFrameTime=!1,this._frameTime=new A.d,this._captureRenderTime=!1,this._renderTime=new A.d,this._captureInterFrameTime=!1,this._interFrameTime=new A.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new A.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new A.d,this._capturePhysicsTime=!1,this._physicsTime=new A.d,this._captureAnimationsTime=!1,this._animationsTime=new A.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new A.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(v.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Wh.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(v.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Xh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Xh(),this._captureParticlesRenderTime&&this._particlesRenderTime.Xh(),this._captureSpritesRenderTime&&this._spritesRenderTime.Xh(),this._captureRenderTime&&this._renderTime.Xh(),this._captureCameraRenderTime&&this._cameraRenderTime.Xh()}))}dispose(){this._disposed||(this.Wh.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Wh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Wh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Wh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Wh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Wh.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Wh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Wh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Wh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Wh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Wh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Wh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Wh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Wh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Wh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Wh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Wh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Wh=null,this._disposed=!0)}}},13436:(Z,h,V)=>{"use strict";V.d(h,{d:()=>x});var v=V(11720),A=V(11723),H=V(11729),K=V(12150),d=V(12281),a=V(12333),n=V(11691);K.c.AddNodeConstructor("Light_Type_1",((Z,h)=>()=>new x(Z,H.Ch.Zero(),h)));class x extends a.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Z){this._shadowFrustumSize=Z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Z){this._shadowOrthoScale=Z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Z){this._orthoLeft=Z}get orthoRight(){return this._orthoRight}set orthoRight(Z){this._orthoRight=Z}get orthoTop(){return this._orthoTop}set orthoTop(Z){this._orthoTop=Z}get orthoBottom(){return this._orthoBottom}set orthoBottom(Z){this._orthoBottom=Z}constructor(Z,h,V){super(Z,V),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=h.scale(-1),this.direction=h}getClassName(){return"yd"}getTypeID(){return d.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Z,h,V){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Z):this._setDefaultAutoExtendShadowProjectionMatrix(Z,h,V)}_setDefaultFixedFrustumShadowProjectionMatrix(Z){const h=this.CZ().activeCamera;h&&H.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:h.Rh,void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,Z,this.CZ().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Z,h,V){const v=this.CZ().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Z=H.Ch.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let v=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let K=0;K<V.length;K++){const d=V[K];if(!d)continue;const a=d.getBoundingInfo().boundingBox;for(let V=0;V<a.vectorsWorld.length;V++)H.Ch.TransformCoordinatesToRef(a.vectorsWorld[V],h,Z),Z.x<this._orthoLeft&&(this._orthoLeft=Z.x),Z.y<this._orthoBottom&&(this._orthoBottom=Z.y),Z.x>this._orthoRight&&(this._orthoRight=Z.x),Z.y>this._orthoTop&&(this._orthoTop=Z.y),this.autoCalcShadowZBounds&&(Z.z<v&&(v=Z.z),Z.z>A&&(A=Z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=v,this._shadowMaxZ=A)}const A=this._orthoRight-this._orthoLeft,K=this._orthoTop-this._orthoBottom,d=void 0!==this.shadowMinZ?this.shadowMinZ:(null===v||void 0===v?void 0:v.Rh)||0,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===v||void 0===v?void 0:v.maxZ)||1e4,n=this.CZ().getEngine().useReverseDepthBuffer;H.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-A*this.shadowOrthoScale,this._orthoRight+A*this.shadowOrthoScale,this._orthoBottom-K*this.shadowOrthoScale,this._orthoTop+K*this.shadowOrthoScale,n?a:d,n?d:a,Z,this.CZ().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,h){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,h),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,h),this)}transferToNodeMaterialEffect(Z,h){return this.computeTransformedInformation()?(Z.setFloat3(h,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Z.setFloat3(h,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Z){const h=this._scene.getEngine();return!h.useReverseDepthBuffer&&h.isNDCHalfZRange?0:1}getDepthMaxZ(Z){const h=this._scene.getEngine();return h.useReverseDepthBuffer&&h.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Z,h){Z["DIRLIGHT"+h]=!0}}(0,v.b)([(0,A.I)()],x.prototype,"shadowFrustumSize",null),(0,v.b)([(0,A.I)()],x.prototype,"shadowOrthoScale",null),(0,v.b)([(0,A.I)()],x.prototype,"autoUpdateExtends",void 0),(0,v.b)([(0,A.I)()],x.prototype,"autoCalcShadowZBounds",void 0),(0,v.b)([(0,A.I)("orthoLeft")],x.prototype,"_orthoLeft",void 0),(0,v.b)([(0,A.I)("orthoRight")],x.prototype,"_orthoRight",void 0),(0,v.b)([(0,A.I)("orthoTop")],x.prototype,"_orthoTop",void 0),(0,v.b)([(0,A.I)("orthoBottom")],x.prototype,"_orthoBottom",void 0),(0,n.i)("BABYLON.DirectionalLight",x)},13978:(Z,h,V)=>{"use strict";V.d(h,{e:()=>x});var v=V(11720),A=V(11723),H=V(11729),K=V(11781),d=V(12150),a=V(12281),n=V(11691);d.c.AddNodeConstructor("Light_Type_3",((Z,h)=>()=>new x(Z,H.Ch.Zero(),h)));class x extends a.c{constructor(Z,h,V){super(Z,V),this.groundColor=new K.Ih(0,0,0),this.direction=h||H.Ch.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Wd"}setDirectionToTarget(Z){return this.direction=H.Ch.Normalize(Z.rh(H.Ch.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Z,h){const V=H.Ch.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",V.x,V.y,V.z,0,h),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Fd),h),this}transferToNodeMaterialEffect(Z,h){const V=H.Ch.Normalize(this.direction);return Z.setFloat3(h,V.x,V.y,V.z),this}sh(){return this._worldMatrix||(this._worldMatrix=H.Matrix.Identity()),this._worldMatrix}getTypeID(){return a.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Z,h){Z["HEMILIGHT"+h]=!0}}(0,v.b)([(0,A.j)()],x.prototype,"groundColor",void 0),(0,v.b)([(0,A.G)()],x.prototype,"direction",void 0),(0,n.i)("BABYLON.HemisphericLight",x)},13410:(Z,h,V)=>{"use strict";V.d(h,{c:()=>N});var v=V(11720),A=V(11723),H=V(11729),K=V(12150),d=V(12281),a=V(12333),n=V(11713),x=V(11691);K.c.AddNodeConstructor("Light_Type_2",((Z,h)=>()=>new N(Z,H.Ch.Zero(),H.Ch.Zero(),0,0,h)));class N extends a.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Z){this._iesProfileTexture!==Z&&(this._iesProfileTexture=Z,this._iesProfileTexture&&N._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Z){this._angle=Z,this._cosHalfAngle=Math.cos(.5*Z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Z){this._innerAngle=Z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Z){this._shadowAngleScale=Z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Z){this._projectionTextureLightNear=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Z){this._projectionTextureLightFar=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Z){this._projectionTextureUpDirection=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Z){this._projectionTexture!==Z&&(this._projectionTexture=Z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(N._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):N._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Z){return void 0!==Z.onGeneratedObservable}static _IsTexture(Z){return void 0!==Z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Z){this._projectionTextureProjectionLightMatrix=Z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Z,h,V,v,A,K){super(Z,K),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=H.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=H.Ch.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=H.Ch.Zero(),this._projectionTextureViewLightMatrix=H.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=H.Matrix.Zero(),this._projectionTextureScalingMatrix=H.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=h,this.direction=V,this.angle=v,this.exponent=A}getClassName(){return"SpotLight"}getTypeID(){return d.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(Z){super._setDirection(Z),this._projectionTextureViewLightDirty=!0}_setPosition(Z){super._setPosition(Z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Z,h,V){const v=this.CZ().activeCamera;if(!v)return;this._shadowAngleScale=this._shadowAngleScale||1;const A=this._shadowAngleScale*this._angle,K=void 0!==this.shadowMinZ?this.shadowMinZ:v.Rh,d=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,a=this.CZ().getEngine().useReverseDepthBuffer;H.Matrix.PerspectiveFovLHToRef(A,1,a?d:K,a?K:d,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),H.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Z=this.projectionTextureLightFar,h=this.projectionTextureLightNear,V=Z/(Z-h),v=-V*h,A=1/Math.tan(this._angle/2);H.Matrix.FromValuesToRef(A/1,0,0,0,0,A,0,0,0,0,V,1,0,0,v,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof n.e){const Z=this._projectionTexture.uScale/2,h=this._projectionTexture.vScale/2;H.Matrix.FromValuesToRef(Z,0,0,0,0,h,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Z,h){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Z.setMatrix("textureProjectionMatrix"+h,this._projectionTextureMatrix),Z.setTexture("projectionLightTexture"+h,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Z.setTexture("iesLightTexture"+h,this._iesProfileTexture),this}transferToEffect(Z,h){let V;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,h),V=H.Ch.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,h),V=H.Ch.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",V.x,V.y,V.z,this._cosHalfAngle,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,h),this}transferToNodeMaterialEffect(Z,h){let V;return V=this.computeTransformedInformation()?H.Ch.Normalize(this.transformedDirection):H.Ch.Normalize(this.direction),this.CZ().useRightHandedSystem?Z.setFloat3(h,-V.x,-V.y,-V.z):Z.setFloat3(h,V.x,V.y,V.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Z){const h=this._scene.getEngine(),V=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.Rh)??0;return h.useReverseDepthBuffer&&h.isNDCHalfZRange?V:this._scene.getEngine().isNDCHalfZRange?0:V}getDepthMaxZ(Z){const h=this._scene.getEngine(),V=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)??1e4;return h.useReverseDepthBuffer&&h.isNDCHalfZRange?0:V}prepareLightSpecificDefines(Z,h){Z["SPOTLIGHT"+h]=!0,Z["PROJECTEDLIGHTTEXTURE"+h]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Z["IESLIGHTTEXTURE"+h]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,v.b)([(0,A.I)()],N.prototype,"angle",null),(0,v.b)([(0,A.I)()],N.prototype,"innerAngle",null),(0,v.b)([(0,A.I)()],N.prototype,"shadowAngleScale",null),(0,v.b)([(0,A.I)()],N.prototype,"exponent",void 0),(0,v.b)([(0,A.I)()],N.prototype,"projectionTextureLightNear",null),(0,v.b)([(0,A.I)()],N.prototype,"projectionTextureLightFar",null),(0,v.b)([(0,A.I)()],N.prototype,"projectionTextureUpDirection",null),(0,v.b)([(0,A.z)("projectedLightTexture")],N.prototype,"_projectionTexture",void 0),(0,x.i)("BABYLON.SpotLight",N)},13123:(Z,h,V)=>{"use strict";V.d(h,{d:()=>K,h:()=>H,i:()=>d});const v={},A={};function H(Z,h){v[Z]=h}function K(Z,h){A[Z]=h}function d(Z){return A[Z]?A[Z]:null}},13029:(Z,h,V)=>{"use strict";V.d(h,{b:()=>C,d:()=>I});var v,A=V(11564),H=V(11566),K=V(11983),d=V(11599),a=V(11580),n=V(12204),x=V(11602),N=V(11607),D=V(11700),k=V(11635),u=V(11596);!function(Z){Z[Z.Clean=0]="Clean",Z[Z.Stop=1]="Stop",Z[Z.Sync=2]="Sync",Z[Z.NoSync=3]="NoSync"}(v||(v={}));const F=new H.b,b={};let o=!1;function q(){return b[".babylon"]}function X(Z,h){const V=b[Z];return V||(a.b.Warn("Unable to find a plugin to load "+Z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),h?q():void 0)}function E(Z,h,V){let v="Unable to load from "+(Z.rawData?"binary data":Z.url);return h?v+=`: ${h}`:V&&(v+=`: ${V}`),v}async function j(Z,h,V,v,A,H,K,d,a){var n;const N="data:"===(D=Z.url).substring(0,5)?D.substring(5):null;var D;if(Z.rawData&&!K)throw"When using ArrayBufferView to load data the file extension must be provided.";const o=N||K?"":function(Z){const h=Z.indexOf("?");-1!==h&&(Z=Z.substring(0,h));const V=Z.lastIndexOf(".");return Z.substring(V,Z.length).toLowerCase()}(Z.url);let E=K?X(K,!0):N?function(Z){for(const h in b){const V=b[h].plugin;if(V.canDirectLoad&&V.canDirectLoad(Z))return b[h]}return q()}(Z.url):X(o,!1);if(!E&&o){if(Z.url&&!Z.url.startsWith("blob:")){const h=await async function(Z,h){const V=h.method||"GET";return await new Promise(((v,A)=>{const H=new u.e;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const Z={};if(h.responseHeaders)for(const V of h.responseHeaders)Z[V]=H.getResponseHeader(V)||"";v({response:H.response,headerValues:Z})}else A(`Unable to fetch data from ${Z}. Error code: ${H.status}`)})),H.open(V,Z),H.send()}))}(Z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),V=h.headerValues?h.headerValues["Content-Type"]:"";V&&(E=function(Z){for(const h in b){const V=b[h];if(V.mimeType===Z)return V}}(V))}E||(E=q())}if(!E)throw new Error(`No plugin or fallback for ${K??Z.url}`);if(!1===(null===a||void 0===a||null===(n=a[E.plugin.name])||void 0===n?void 0:n.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Z.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Z=>{if(E.plugin.createPlugin){const h=E.plugin.createPlugin(a??{});return h instanceof Promise?(h.then(Z).catch((Z=>{A("Error instantiating plugin.",Z)})),null):(Z(h),h)}return Z(E.plugin),E.plugin})((a=>{var n;if(!a)throw`The loader plugin corresponding to the '${K}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(F.notifyObservers(a),N&&(a.canDirectLoad&&a.canDirectLoad(Z.url)||!(0,x.k)(Z.url))){if(a.directLoad){const Z=a.directLoad(h,N);Z instanceof Promise?Z.then((Z=>{V(a,Z)})).catch((Z=>{A("Error in directLoad of _loadData: "+Z,Z)})):V(a,Z)}else V(a,N);return}const D=E.isBinary,u=(Z,v)=>{h.K?A("Scene has been disposed"):V(a,Z,v)};let b=null,o=!1;null===(n=a.jh)||void 0===n||n.add((()=>{o=!0,b&&(b.abort(),b=null),H()}));const q=()=>{if(o)return;const V=(Z,h)=>{A(null===Z||void 0===Z?void 0:Z.statusText,h)};if(!a.loadFile&&Z.rawData)throw"Plugin does not support loading ArrayBufferView.";b=a.loadFile?a.loadFile(h,Z.rawData||Z.file||Z.url,Z.rootUrl,u,v,D,V,d):h._loadFile(Z.file||Z.url,u,v,!0,D,V)},X=h.getEngine();let j=X.enableOfflineSupport;if(j){let V=!1;for(const v of h.disableOfflineSupportExceptionRules)if(v.test(Z.url)){V=!0;break}j=!V}j&&k.d.OfflineProviderFactory?h.offlineProvider=k.d.OfflineProviderFactory(Z.url,q,X.disableManifestCheck):q()}))}function P(Z,h){let V,v,H=null,K=null;if(h)if(h.name)V=`file:${h.name}`,v=h.name,H=h;else if(ArrayBuffer.isView(h))V="",v=(0,D.e)(),K=h;else if(h.startsWith("data:"))V=h,v="";else if(Z){const H=h;if("/"===H.substring(0,1))return A.Tools.Error("Wrong sceneFilename parameter"),null;V=Z+H,v=H}else V=h,v=A.Tools.GetFilename(h),Z=A.Tools.GetFolderPath(h);else V=Z,v=A.Tools.GetFilename(Z),Z=A.Tools.GetFolderPath(Z);return{url:V,rootUrl:Z,name:v,file:H,rawData:K}}function C(Z){if("string"===typeof Z.extensions){const h=Z.extensions;b[h.toLowerCase()]={plugin:Z,isBinary:!1}}else{const h=Z.extensions,V=Object.keys(h);for(const v of V)b[v.toLowerCase()]={plugin:Z,isBinary:h[v].isBinary,mimeType:h[v].mimeType}}}async function l(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.b.LastCreatedScene,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!v)return a.b.Error("No scene available to import mesh to"),null;const k=P(h,V);if(!k)return null;const u={};v.addPendingData(u);const F=()=>{v.removePendingData(u)},b=(Z,h)=>{const V=E(k,Z,h);K?K(v,V,new N.j(V,N.g.SceneLoaderError,h)):a.b.Error(V),F()},o=H?Z=>{try{H(Z)}catch(h){b("Error in onProgress callback: "+h,h)}}:void 0,q=(Z,h,V,H,K,d,a,n)=>{if(v.importedMeshesFiles.push(k.url),A)try{A(Z,h,V,H,K,d,a,n)}catch(x){b("Error in onSuccess callback: "+x,x)}v.removePendingData(u)};return await j(k,v,((h,V,A)=>{if(h.rewriteRootURL&&(k.rootUrl=h.rewriteRootURL(k.rootUrl,A)),h.importMesh){const A=[],H=[],K=[];if(!h.importMesh(Z,v,V,k.rootUrl,A,H,K,b))return;v.loadingPluginName=h.name,q(A,H,K,[],[],[],[],[])}else{h.importMeshAsync(Z,v,V,k.rootUrl,o,k.name).then((Z=>{v.loadingPluginName=h.name,q(Z.meshes,Z.bD,Z.skeletons,Z.animationGroups,Z.transformNodes,Z.geometries,Z.lights,Z.spriteManagers)})).catch((Z=>{b(Z.message,Z)}))}}),o,b,F,n,x,D)}async function B(Z,h,V,v,A,H,K,d){return await new Promise(((a,n)=>{try{l(Z,h,V,v,((Z,h,V,v,A,H,K,d)=>{a({meshes:Z,bD:h,skeletons:V,animationGroups:v,transformNodes:A,geometries:H,lights:K,spriteManagers:d})}),A,((Z,h,V)=>{n(V||new Error(h))}),H,K,d).catch(n)}catch(N){n(N)}}))}async function S(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.b.LastCreatedEngine,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};V?await L(Z,h,new K.e(V),v,H,a,n,x,N):A.Tools.Error("No engine available")}async function r(Z,h,V,v,A,H,K){return await new Promise(((d,a)=>{S(Z,h,V,(Z=>{d(Z)}),v,((Z,h,V)=>{a(V||new Error(h))}),A,H,K)}))}async function L(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.b.LastCreatedScene,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!V)return a.b.Error("No scene available to append to"),null;const k=P(Z,h);if(!k)return null;const u={};V.addPendingData(u);const F=()=>{V.removePendingData(u)};n.d.ShowLoadingScreen&&!o&&(o=!0,V.getEngine().displayLoadingUI(),V.executeWhenReady((()=>{V.getEngine().hideLoadingUI(),o=!1})));const b=(Z,h)=>{const v=E(k,Z,h);H?H(V,v,new N.j(v,N.g.SceneLoaderError,h)):a.b.Error(v),F()},q=A?Z=>{try{A(Z)}catch(h){b("Error in onProgress callback",h)}}:void 0,X=()=>{if(v)try{v(V)}catch(Z){b("Error in onSuccess callback",Z)}V.removePendingData(u)};return await j(k,V,((Z,h)=>{if(Z.load){if(!Z.load(V,h,k.rootUrl,b))return;V.loadingPluginName=Z.name,X()}else{Z.loadAsync(V,h,k.rootUrl,q,k.name).then((()=>{V.loadingPluginName=Z.name,X()})).catch((Z=>{b(Z.message,Z)}))}}),q,b,F,K,x,D)}async function y(Z,h,V,v,A,H,K){return await new Promise(((d,a)=>{try{L(Z,h,V,(Z=>{d(Z)}),v,((Z,h,V)=>{a(V||new Error(h))}),A,H,K).catch(a)}catch(N){a(N)}}))}async function W(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.b.LastCreatedScene,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!V)return a.b.Error("No scene available to load asset container to"),null;const D=P(Z,h);if(!D)return null;const k={};V.addPendingData(k);const u=()=>{V.removePendingData(k)},F=(Z,h)=>{const v=E(D,Z,h);H?H(V,v,new N.j(v,N.g.SceneLoaderError,h)):a.b.Error(v),u()},b=A?Z=>{try{A(Z)}catch(h){F("Error in onProgress callback",h)}}:void 0,o=Z=>{if(v)try{v(Z)}catch(h){F("Error in onSuccess callback",h)}V.removePendingData(k)};return await j(D,V,((Z,h)=>{if(Z.loadAssetContainer){const v=Z.loadAssetContainer(V,h,D.rootUrl,F);if(!v)return;v.populateRootNodes(),V.loadingPluginName=Z.name,o(v)}else if(Z.loadAssetContainerAsync){Z.loadAssetContainerAsync(V,h,D.rootUrl,b,D.name).then((h=>{h.populateRootNodes(),V.loadingPluginName=Z.name,o(h)})).catch((Z=>{F(Z.message,Z)}))}else F("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),b,F,u,K,n,x)}async function z(Z,h,V,v,A,H,K){return await new Promise(((d,a)=>{try{W(Z,h,V,(Z=>{d(Z)}),v,((Z,h,V)=>{a(V||new Error(h))}),A,H,K).catch(a)}catch(N){a(N)}}))}async function m(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.b.LastCreatedScene,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!V)return void a.b.Error("No scene available to load animations to");if(v){for(const v of V.animatables)v.reset();V.stopAllAnimations();const Z=V.animationGroups.slice();for(const V of Z)V.dispose();const h=V.getNodes();for(const V of h)V.animations&&(V.animations=[])}else switch(A){case 0:const Z=V.animationGroups.slice();for(const h of Z)h.dispose();break;case 1:for(const h of V.animationGroups)h.stop();break;case 2:for(const h of V.animationGroups)h.reset(),h.restart();break;case 3:break;default:return void a.b.Error("Unknown animation group loading mode value '"+A+"'")}const u=V.animatables.length;await W(Z,h,V,(Z=>{Z.mergeAnimationsTo(V,V.animatables.slice(u),H),Z.dispose(),V.onAnimationFileImportedObservable.notifyObservers(V),K&&K(V)}),n,x,N,D,k)}async function g(Z,h,V,v,A,H,K,d,a,n){return await new Promise(((x,D)=>{try{m(Z,h,V,v,A,H,(Z=>{x(Z)}),K,((Z,h,V)=>{D(V||new Error(h))}),d,a,n).catch(D)}catch(N){D(N)}}))}class I{static get ForceFullSceneLoadingForIncremental(){return n.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Z){n.d.ForceFullSceneLoadingForIncremental=Z}static get ShowLoadingScreen(){return n.d.ShowLoadingScreen}static set ShowLoadingScreen(Z){n.d.ShowLoadingScreen=Z}static get loggingLevel(){return n.d.loggingLevel}static set loggingLevel(Z){n.d.loggingLevel=Z}static get CleanBoneMatrixWeights(){return n.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Z){n.d.CleanBoneMatrixWeights=Z}static GetDefaultPlugin(){return q()}static GetPluginForExtension(Z){var h;return null===(h=X(Z,!0))||void 0===h?void 0:h.plugin}static IsPluginForExtensionAvailable(Z){return function(Z){return!!b[Z]}(Z)}static RegisterPlugin(Z){C(Z)}static ImportMesh(Z,h,V,v,A,H,K,a,n){l(Z,h,V,v,A,H,K,a,n).catch((Z=>null===K||void 0===K?void 0:K(d.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportMeshAsync(Z,h,V,v,A,H,K){return await B(Z,h,V,v,A,H,K)}static Load(Z,h,V,v,A,H,K,a){S(Z,h,V,v,A,H,K,a).catch((Z=>null===H||void 0===H?void 0:H(d.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAsync(Z,h,V,v,A,H){return await r(Z,h,V,v,A,H)}static Append(Z,h,V,v,A,H,K,a){L(Z,h,V,v,A,H,K,a).catch((Z=>null===H||void 0===H?void 0:H(V??d.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async AppendAsync(Z,h,V,v,A,H){return await y(Z,h,V,v,A,H)}static LoadAssetContainer(Z,h,V,v,A,H,K,a){W(Z,h,V,v,A,H,K,a).catch((Z=>null===H||void 0===H?void 0:H(V??d.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAssetContainerAsync(Z,h,V,v,A,H){return await z(Z,h,V,v,A,H)}static ImportAnimations(Z,h,V,v,A,H,K,a,n,x,N){m(Z,h,V,v,A,H,K,a,n,x,N).catch((Z=>null===n||void 0===n?void 0:n(V??d.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportAnimationsAsync(Z,h,V,v,A,H,K,d,a,n,x){return await g(Z,h,V,v,A,H,d,n,x)}}I.NO_LOGGING=0,I.MINIMAL_LOGGING=1,I.SUMMARY_LOGGING=2,I.DETAILED_LOGGING=3,I.OnPluginActivatedObservable=F},13424:(Z,h,V)=>{"use strict";V.d(h,{c:()=>D});var v=V(11720),A=V(11723),H=V(11564),K=V(11729),d=V(11754),a=V(11713),n=V(11691),x=V(11566),N=V(11769);V(13426);class D extends d.e{set boundingBoxSize(Z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Z))return;this._boundingBoxSize=Z;const h=this.CZ();h&&h.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Z){this._rotationY=Z,this.setReflectionTextureMatrix(K.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Z,h,V){let v="";for(const A of Z)v+=A;return new D(v,h,null,V,Z)}static CreateFromPrefilteredData(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=h.useDelayedTextureLoading;h.useDelayedTextureLoading=!1;const H=new D(Z,h,null,!1,null,null,null,void 0,!0,V,v);return h.useDelayedTextureLoading=A,H}constructor(Z,h){var V;let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,o=arguments.length>13?arguments[13]:void 0,q=arguments.length>14?arguments[14]:void 0;super(h),this.onLoadObservable=new x.b,this.boundingBoxPosition=K.Ch.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new K.Matrix,this._buffer=null,this.name=Z,this.url=Z,this._noMipmap=A,this.Uh=!1,this.isCube=!0,this._textureMatrix=K.Matrix.Identity(),this.coordinatesMode=a.e.CUBIC_MODE;let X=null,E=null;null===v||Array.isArray(v)?(this._noMipmap=A,this._format=N,this._createPolynomials=u,X=v,this._loaderOptions=o,this._useSRGBBuffer=q,this._lodScale=F,this._lodOffset=b):(X=v.extensions??null,this._noMipmap=v.noMipmap??!1,H=v.files??null,E=v.buffer??null,this._format=v.format??5,D=v.prefiltered??!1,k=v.forcedExtension??null,this._createPolynomials=v.createPolynomials??!1,this._lodScale=v.lodScale??.8,this._lodOffset=v.lodOffset??0,this._loaderOptions=v.loaderOptions,this._useSRGBBuffer=v.useSRGBBuffer,d=v.p??null,n=v.onError??null),(Z||H)&&this.updateURL(Z,k,d,D,n,X,null===(V=this.CZ())||void 0===V?void 0:V.useDelayedTextureLoading,H,E)}getClassName(){return"CubeTexture"}updateURL(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,h&&(this._forcedExtension=h);const n=Z.lastIndexOf("."),x=h||(n>-1?Z.substring(n).toLowerCase():""),N=0===x.indexOf(".dds"),D=0===x.indexOf(".env"),k=0===x.indexOf(".basis");if(D?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=v,v&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),d)this._files=d;else if(k||D||N||H||(H=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,H){for(let h=0;h<H.length;h++)this._files.push(Z+H[h]);this._extensions=H}this._buffer=a,K?(this.delayLoadState=4,this._delayedOnLoad=V,this._delayedOnError=A):this._loadTexture(V,A)}delayLoad(Z){4===this.delayLoadState&&(Z&&(this._forcedExtension=Z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Z){var h,V;if(Z.updateFlag===this._textureMatrix.updateFlag)return;Z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(V=this.CZ())||void 0===V||V.markAllMaterialsAsDirty(1,(Z=>-1!==Z.getActiveTextures().indexOf(this))));if(this._textureMatrix=Z,null===(h=this.CZ())||void 0===h||!h.useRightHandedSystem)return;const v=K.TmpVectors.Ch[0],A=K.TmpVectors.Quaternion[0],H=K.TmpVectors.Ch[1];this._textureMatrix.decompose(v,A,H),A.z*=-1,A.w*=-1,K.Matrix.ComposeToRef(v,A,H,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Z;return null!==(Z=this.CZ())&&void 0!==Z&&Z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this.CZ(),v=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const A=()=>{var h;(this.onLoadObservable.notifyObservers(this),v)&&(v.dispose(),null===(h=this.CZ())||void 0===h||h.markAllMaterialsAsDirty(1));Z&&Z()},K=(Z,V)=>{this._loadingError=!0,this._errorObject={message:Z,exception:V},h&&h(Z,V),a.e.OnTextureLoadErrorObservable.notifyObservers(this)};var d;this._texture?this._texture.isReady?H.Tools.SetImmediate((()=>A())):this._texture.onLoadedObservable.add((()=>A())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,V,this._lodScale,this._lodOffset,Z,K,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,V,this._files,this._noMipmap,Z,K,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(d=this._texture)||void 0===d||d.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Z,h,V){const v=N.b.Parse((()=>{let v=!1;return Z.prefiltered&&(v=Z.prefiltered),new D(V+(Z.url??Z.name),h,Z.extensions,!1,Z.files||null,null,null,void 0,v,Z.forcedExtension)}),Z,h);if(Z.boundingBoxPosition&&(v.boundingBoxPosition=K.Ch.eh(Z.boundingBoxPosition)),Z.boundingBoxSize&&(v.boundingBoxSize=K.Ch.eh(Z.boundingBoxSize)),Z.animations)for(let A=0;A<Z.animations.length;A++){const h=Z.animations[A],V=(0,n.e)("BABYLON.Animation");V&&v.animations.push(V.Parse(h))}return v}clone(){let Z=0;const h=N.b.Clone((()=>{const h=new D(this.url,this.CZ()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Z=h.uniqueId,h}),this);return h.uniqueId=Z,h}}(0,v.b)([(0,A.I)()],D.prototype,"url",void 0),(0,v.b)([(0,A.G)()],D.prototype,"boundingBoxPosition",void 0),(0,v.b)([(0,A.G)()],D.prototype,"boundingBoxSize",null),(0,v.b)([(0,A.I)("rotationY")],D.prototype,"rotationY",null),(0,v.b)([(0,A.I)("files")],D.prototype,"_files",void 0),(0,v.b)([(0,A.I)("forcedExtension")],D.prototype,"_forcedExtension",void 0),(0,v.b)([(0,A.I)("extensions")],D.prototype,"_extensions",void 0),(0,v.b)([(0,A.t)("textureMatrix")],D.prototype,"_textureMatrix",void 0),(0,v.b)([(0,A.t)("textureMatrixRefraction")],D.prototype,"_textureMatrixRefraction",void 0),a.e._CubeTextureParser=D.Parse,(0,n.i)("BABYLON.CubeTexture",D)},13989:(Z,h,V)=>{"use strict";V.d(h,{d:()=>a});var v=V(11580),A=V(11713),H=V(11709),K=V(11872),d=V(11673);K.ThinEngine.prototype.createDynamicTexture=function(Z,h,V,v){const A=new d.c(this,4);return A.baseWidth=Z,A.baseHeight=h,V&&(Z=this.needPOTTextures?(0,H.e)(Z,this._caps.maxTextureSize):Z,h=this.needPOTTextures?(0,H.e)(h,this._caps.maxTextureSize):h),A.width=Z,A.height=h,A.isReady=!1,A.generateMipMaps=V,A.samplingMode=v,this.updateTextureSamplingMode(v,A),this._internalTexturesCache.push(A),A},K.ThinEngine.prototype.updateDynamicTexture=function(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z)return;const K=this._gl,d=K.TEXTURE_2D,a=this._bindTextureDirectly(d,Z,!0,H);this._unpackFlipY(void 0===V?Z.invertY:V),v&&K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const n=this._getWebGLTextureType(Z.type),x=this._getInternalFormat(A||Z.format),N=this._getRGBABufferInternalSizedFormat(Z.type,x);K.texImage2D(d,0,N,x,n,h),Z.generateMipMaps&&K.generateMipmap(d),a||this._bindTextureDirectly(d,null),v&&K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),A&&(Z.format=A),Z._dynamicTextureSource=h,Z._premulAlpha=v,Z.invertY=V||!1,Z.isReady=!0};class a extends A.e{constructor(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,d=arguments.length>6?arguments[6]:void 0;const a=!V||V._isScene;super(null,a?V:null===V||void 0===V?void 0:V.Wh,a?!v:V,d,H,void 0,void 0,void 0,void 0,K),this.name=Z,this.wrapU=A.e.CLAMP_ADDRESSMODE,this.wrapV=A.e.CLAMP_ADDRESSMODE,this._generateMipMaps=v;const n=this._getEngine();if(!n)return;if(h.getContext)this._canvas=h,this._ownCanvas=!1,this._texture=n.createDynamicTexture(this._canvas.width,this._canvas.height,v,H);else{this._canvas=n.createCanvas(1,1),this._ownCanvas=!0;const Z=h;Z.width||0===Z.width?this._texture=n.createDynamicTexture(Z.width,Z.height,v,H):this._texture=n.createDynamicTexture(h,h,v,H)}const x=this.getSize();this._canvas.width!==x.width&&(this._canvas.width=x.width),this._canvas.height!==x.height&&(this._canvas.height=x.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Z){this._canvas.width=Z.width,this._canvas.height=Z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Z.width,Z.height,this._generateMipMaps,this.samplingMode)}scale(Z){const h=this.getSize();h.width*=Z,h.height*=Z,this._recreate(h)}scaleTo(Z,h){const V=this.getSize();V.width=Z,V.height=h,this._recreate(V)}getContext(){return this._context}clear(Z){const h=this.getSize();Z&&(this._context.fillStyle=Z),this._context.clearRect(0,0,h.width,h.height)}update(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Z||Z,h,this._format||void 0,void 0,V)}drawText(Z,h,V,v,A,H,K){let d=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const a=this.getSize();if(H&&(this._context.fillStyle=H,this._context.fillRect(0,0,a.width,a.height)),this._context.font=v,null===h||void 0===h){const V=this._context.measureText(Z);h=(a.width-V.width)/2}if(null===V||void 0===V){const Z=parseInt(v.replace(/\D/g,""));V=a.height/2+Z/3.65}this._context.fillStyle=A||"",this._context.fillText(Z,h,V),d&&this.update(K)}dispose(){var Z,h;(super.dispose(),this._ownCanvas)&&(null===(Z=this._canvas)||void 0===Z||null===(h=Z.remove)||void 0===h||h.call(Z));this._canvas=null,this._context=null}clone(){const Z=this.CZ();if(!Z)return this;const h=this.getSize(),V=new a(this.name,h,Z,this._generateMipMaps);return V.Uh=this.Uh,V.level=this.level,V.wrapU=this.wrapU,V.wrapV=this.wrapV,V}serialize(){const Z=this.CZ();Z&&!Z.isReady()&&v.b.Warn("The scene must be ready before serializing the dynamic texture");const h=super.serialize();return a._IsCanvasElement(this._canvas)&&(h.base64String=this._canvas.toDataURL()),h.invertY=this._invertY,h.samplingMode=this.samplingMode,h}static _IsCanvasElement(Z){return void 0!==Z.toDataURL}_rebuild(){this.update()}}},13341:(Z,h,V)=>{"use strict";V.d(h,{c:()=>A});var v=V(11713);class A extends v.e{get depth(){return this._depth}constructor(Z,h,V,A,H,K){let d=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:v.e.TRILINEAR_SAMPLINGMODE,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10?arguments[10]:void 0;super(null,K,!d,a),this.format=H,this._texture=K.getEngine().createRawTexture2DArray(Z,h,V,A,H,d,a,n,null,x,N),this._depth=A,this.is2DArray=!0}update(Z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Z,h,V,v,H){return new A(Z,h,V,v,5,H,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13144:(Z,h,V)=>{"use strict";V.d(h,{c:()=>d,d:()=>a,e:()=>H,i:()=>K});var v=V(11748),A=V(11729);function H(Z,h){return`{X: ${Z.x.toFixed(h)} Y: ${Z.y.toFixed(h)}}`}function K(Z,h){return`{X: ${Z._x.toFixed(h)} Y: ${Z._y.toFixed(h)} Z: ${Z._z.toFixed(h)}}`}function d(Z,h){return 2*Math.acos((0,v.Clamp)(A.Quaternion.Dot(Z,h)))}function a(Z,h){const V=new A.Quaternion;return function(Z,h,V){const H=A.Ch.Cross(Z,h),K=Math.acos((0,v.Clamp)(A.Ch.Dot(Z,h),-1,1));A.Quaternion.RotationAxisToRef(H,K,V)}(Z,h,V),V}},12976:(Z,h,V)=>{"use strict";V.d(h,{c:()=>n});var v=V(11729),A=V(11781),H=V(12184),K=V(12161),d=V(11792);V(12980);function a(Z){let h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const V=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],H=[];let a=[];const n=Z.width||Z.size||1,x=Z.height||Z.size||1,N=Z.depth||Z.size||1,D=Z.wrap||!1;let k=void 0===Z.topBaseAt?1:Z.topBaseAt,u=void 0===Z.bottomBaseAt?0:Z.bottomBaseAt;k=(k+4)%4,u=(u+4)%4;let F=[2,0,3,1][k],b=[2,0,1,3][u],o=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(D){h=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],o=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],V=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const v=[17,18,19,16],A=[22,23,20,21];for(;F>0;)Z.unshift(Z.pop()),v.unshift(v.pop()),F--;for(;b>0;)V.unshift(V.pop()),A.unshift(A.pop()),b--;Z=Z.flat(),V=V.flat(),o=o.concat(Z).concat(V),h.push(v[0],v[2],v[3],v[0],v[1],v[2]),h.push(A[0],A[2],A[3],A[0],A[1],A[2])}const q=[n/2,x/2,N/2];a=o.reduce(((Z,h,V)=>Z.concat(h*q[V%3])),[]);const X=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,E=Z.faceUV||new Array(6),j=Z.faceColors,P=[];for(let K=0;K<6;K++)void 0===E[K]&&(E[K]=new v.Vector4(0,0,1,1)),j&&void 0===j[K]&&(j[K]=new A.nd(1,1,1,1));for(let v=0;v<6;v++)if(H.push(E[v].z,d.b?1-E[v].w:E[v].w),H.push(E[v].x,d.b?1-E[v].w:E[v].w),H.push(E[v].x,d.b?1-E[v].y:E[v].y),H.push(E[v].z,d.b?1-E[v].y:E[v].y),j)for(let Z=0;Z<4;Z++)P.push(j[v].r,j[v].g,j[v].b,j[v].a);K.e._ComputeSides(X,a,h,V,H,Z.frontUVs,Z.backUVs);const C=new K.e;if(C.indices=h,C.BZ=a,C.SZ=V,C.LZ=H,j){const Z=X===K.e.DOUBLESIDE?P.concat(P):P;C.rZ=Z}return C}function n(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new H.c(Z,V);h.sideOrientation=H.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return a(h).WZ(v,h.updatable),v}K.e.CreateBox=a,H.c.CreateBox=function(Z,h){return n(Z,{size:h,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13131:(Z,h,V)=>{"use strict";V.d(h,{b:()=>d});var v=V(12184),A=V(12161),H=V(11792);function K(Z){const h=[],V=[],v=[],K=[],d=Z.radius||.5,a=Z.tessellation||64,n=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,x=0===Z.sideOrientation?0:Z.sideOrientation||A.e.DEFAULTSIDE;h.push(0,0,0),K.push(.5,.5);const N=2*Math.PI*n,D=1===n?N/a:N/(a-1);let k=0;for(let A=0;A<a;A++){const Z=Math.cos(k),V=Math.sin(k),v=(Z+1)/2,A=(1-V)/2;h.push(d*Z,d*V,0),K.push(v,H.b?1-A:A),k+=D}1===n&&(h.push(h[3],h[4],h[5]),K.push(K[2],H.b?1-K[3]:K[3]));const u=h.length/3;for(let A=1;A<u-1;A++)V.push(A+1,0,A);A.e.ComputeNormals(h,V,v),A.e._ComputeSides(x,h,V,v,K,Z.frontUVs,Z.backUVs);const F=new A.e;return F.indices=V,F.BZ=h,F.SZ=v,F.LZ=K,F}function d(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new v.c(Z,V);h.sideOrientation=v.c._GetDefaultSideOrientation(h.sideOrientation),A._originalBuilderSideOrientation=h.sideOrientation;return K(h).WZ(A,h.updatable),A}A.e.CreateDisc=K,v.c.CreateDisc=function(Z,h,V){return d(Z,{radius:h,tessellation:V,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12980:(Z,h,V)=>{"use strict";V.d(h,{f:()=>b,d:()=>q,j:()=>o});var v=V(11729),A=V(11781),H=V(12184),K=V(12161),d=V(11805);H.c._GroundMeshParser=(Z,h)=>a.Parse(Z,h);class a extends H.c{constructor(Z,h){super(Z,h),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Z,this._subdivisionsY=Z,this.subdivide(Z);const V=this;V.createOrUpdateSubmeshesOctree&&V.createOrUpdateSubmeshesOctree(h)}getHeightAtCoordinates(Z,h){const V=this.getWorldMatrix(),A=v.TmpVectors.Matrix[5];V.invertToRef(A);const H=v.TmpVectors.Ch[8];if(v.Ch.TransformCoordinatesFromFloatsToRef(Z,0,h,A,H),Z=H.x,h=H.z,Z<this._minX||Z>=this._maxX||h<=this._minZ||h>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const K=this._getFacetAt(Z,h),d=-(K.x*Z+K.z*h+K.w)/K.y;return v.Ch.TransformCoordinatesFromFloatsToRef(0,d,0,V,H),H.y}getNormalAtCoordinates(Z,h){const V=new v.Ch(0,1,0);return this.getNormalAtCoordinatesToRef(Z,h,V),V}getNormalAtCoordinatesToRef(Z,h,V){const A=this.getWorldMatrix(),H=v.TmpVectors.Matrix[5];A.invertToRef(H);const K=v.TmpVectors.Ch[8];if(v.Ch.TransformCoordinatesFromFloatsToRef(Z,0,h,H,K),Z=K.x,h=K.z,Z<this._minX||Z>this._maxX||h<this._minZ||h>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const d=this._getFacetAt(Z,h);return v.Ch.TransformNormalFromFloatsToRef(d.x,d.y,d.z,A,V),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Z,h){const V=Math.floor((Z+this._maxX)*this._subdivisionsX/this._width),v=Math.floor(-(h+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),A=this._heightQuads[v*this._subdivisionsX+V];let H;return H=h<A.slope.x*Z+A.slope.y?A.facet1:A.facet2,H}_initHeightQuads(){const Z=this._subdivisionsX,h=this._subdivisionsY;this._heightQuads=[];for(let V=0;V<h;V++)for(let h=0;h<Z;h++){const A={slope:v.Vector2.Zero(),facet1:new v.Vector4(0,0,0,0),facet2:new v.Vector4(0,0,0,0)};this._heightQuads[V*Z+h]=A}return this}_computeHeightQuads(){const Z=this.getVerticesData(d.f.PositionKind);if(!Z)return this;const h=v.TmpVectors.Ch[3],V=v.TmpVectors.Ch[2],A=v.TmpVectors.Ch[1],H=v.TmpVectors.Ch[0],K=v.TmpVectors.Ch[4],a=v.TmpVectors.Ch[5],n=v.TmpVectors.Ch[6],x=v.TmpVectors.Ch[7],N=v.TmpVectors.Ch[8];let D=0,k=0,u=0,F=0,b=0,o=0,q=0;const X=this._subdivisionsX,E=this._subdivisionsY;for(let d=0;d<E;d++)for(let E=0;E<X;E++){D=3*E,k=d*(X+1)*3,u=(d+1)*(X+1)*3,h.x=Z[k+D],h.y=Z[k+D+1],h.z=Z[k+D+2],V.x=Z[k+D+3],V.y=Z[k+D+4],V.z=Z[k+D+5],A.x=Z[u+D],A.y=Z[u+D+1],A.z=Z[u+D+2],H.x=Z[u+D+3],H.y=Z[u+D+4],H.z=Z[u+D+5],F=(H.z-h.z)/(H.x-h.x),b=h.z-F*h.x,V.subtractToRef(h,K),A.subtractToRef(h,a),H.subtractToRef(h,n),v.Ch.CrossToRef(n,a,x),v.Ch.CrossToRef(K,n,N),x.normalize(),N.normalize(),o=-(x.x*h.x+x.y*h.y+x.z*h.z),q=-(N.x*V.x+N.y*V.y+N.z*V.z);const j=this._heightQuads[d*X+E];j.slope.IV(F,b),j.facet1.IV(x.x,x.y,x.z,o),j.facet2.IV(N.x,N.y,N.z,q)}return this}serialize(Z){super.serialize(Z),Z.subdivisionsX=this._subdivisionsX,Z.subdivisionsY=this._subdivisionsY,Z.minX=this._minX,Z.maxX=this._maxX,Z.Rh=this._minZ,Z.maxZ=this._maxZ,Z.width=this._width,Z.height=this._height}static Parse(Z,h){const V=new a(Z.name,h);return V._subdivisionsX=Z.subdivisionsX||1,V._subdivisionsY=Z.subdivisionsY||1,V._minX=Z.minX,V._maxX=Z.maxX,V._minZ=Z.Rh,V._maxZ=Z.maxZ,V._width=Z.width,V._height=Z.height,V}}var n=V(11564),x=V(11599),N=V(11737),D=V(11792);function k(Z){const h=[],V=[],A=[],H=[];let d,a;const n=Z.width||Z.size||1,x=Z.height||Z.size||1,N=0|(Z.subdivisionsX||Z.subdivisions||1),k=0|(Z.subdivisionsY||Z.subdivisions||1);for(d=0;d<=k;d++)for(a=0;a<=N;a++){const Z=new v.Ch(a*n/N-n/2,0,(k-d)*x/k-x/2),h=new v.Ch(0,1,0);V.push(Z.x,Z.y,Z.z),A.push(h.x,h.y,h.z),H.push(a/N,D.b?d/k:1-d/k)}for(d=0;d<k;d++)for(a=0;a<N;a++)h.push(a+1+(d+1)*(N+1)),h.push(a+1+d*(N+1)),h.push(a+d*(N+1)),h.push(a+(d+1)*(N+1)),h.push(a+1+(d+1)*(N+1)),h.push(a+d*(N+1));const u=new K.e;return u.indices=h,u.BZ=V,u.SZ=A,u.LZ=H,u}function u(Z){const h=void 0!==Z.xmin&&null!==Z.xmin?Z.xmin:-1,V=void 0!==Z.zmin&&null!==Z.zmin?Z.zmin:-1,A=void 0!==Z.xmax&&null!==Z.xmax?Z.xmax:1,H=void 0!==Z.zmax&&null!==Z.zmax?Z.zmax:1,d=Z.subdivisions||{w:1,h:1},a=Z.precision||{w:1,h:1},n=[],x=[],N=[],D=[];let k,u,F,b;d.h=d.h<1?1:d.h,d.w=d.w<1?1:d.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;const o=(A-h)/d.w,q=(H-V)/d.h;function X(Z,h,V,A){const H=x.length/3,K=a.w+1;for(k=0;k<a.h;k++)for(u=0;u<a.w;u++){const Z=[H+u+k*K,H+(u+1)+k*K,H+(u+1)+(k+1)*K,H+u+(k+1)*K];n.push(Z[1]),n.push(Z[2]),n.push(Z[3]),n.push(Z[0]),n.push(Z[1]),n.push(Z[3])}const d=v.Ch.Zero(),F=new v.Ch(0,1,0);for(k=0;k<=a.h;k++)for(d.z=k*(A-h)/a.h+h,u=0;u<=a.w;u++)d.x=u*(V-Z)/a.w+Z,d.y=0,x.push(d.x,d.y,d.z),N.push(F.x,F.y,F.z),D.push(u/a.w,k/a.h)}for(F=0;F<d.h;F++)for(b=0;b<d.w;b++)X(h+b*o,V+F*q,h+(b+1)*o,V+(F+1)*q);const E=new K.e;return E.indices=n,E.BZ=x,E.SZ=N,E.LZ=D,E}function F(Z){const h=[],V=[],H=[],d=[];let a,n;const x=Z.colorFilter||new A.Ih(.3,.59,.11),D=Z.alphaFilter||0;let k=!1;if(Z.minHeight>Z.maxHeight){k=!0;const h=Z.maxHeight;Z.maxHeight=Z.minHeight,Z.minHeight=h}for(a=0;a<=Z.subdivisions;a++)for(n=0;n<=Z.subdivisions;n++){const h=new v.Ch(n*Z.width/Z.subdivisions-Z.width/2,0,(Z.subdivisions-a)*Z.height/Z.subdivisions-Z.height/2),A=4*(((h.x+Z.width/2)/Z.width*(Z.bufferWidth-1)|0)+((1-(h.z+Z.height/2)/Z.height)*(Z.bufferHeight-1)|0)*Z.bufferWidth);let K=Z.buffer[A]/255,u=Z.buffer[A+1]/255,F=Z.buffer[A+2]/255;const b=Z.buffer[A+3]/255;k&&(K=1-K,u=1-u,F=1-F);const o=K*x.r+u*x.g+F*x.b;h.y=b>=D?Z.minHeight+(Z.maxHeight-Z.minHeight)*o:Z.minHeight-N.c,Z.heightBuffer&&(Z.heightBuffer[a*(Z.subdivisions+1)+n]=h.y),V.push(h.x,h.y,h.z),H.push(0,0,0),d.push(n/Z.subdivisions,1-a/Z.subdivisions)}for(a=0;a<Z.subdivisions;a++)for(n=0;n<Z.subdivisions;n++){const v=n+1+(a+1)*(Z.subdivisions+1),A=n+1+a*(Z.subdivisions+1),H=n+a*(Z.subdivisions+1),K=n+(a+1)*(Z.subdivisions+1),d=V[3*v+1]>=Z.minHeight,x=V[3*A+1]>=Z.minHeight,N=V[3*H+1]>=Z.minHeight;d&&x&&N&&(h.push(v),h.push(A),h.push(H));V[3*K+1]>=Z.minHeight&&d&&N&&(h.push(K),h.push(v),h.push(H))}K.e.ComputeNormals(V,h,H);const u=new K.e;return u.indices=h,u.BZ=V,u.SZ=H,u.LZ=d,u}function b(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const V=new a(Z,arguments.length>2?arguments[2]:void 0);V._setReady(!1),V._subdivisionsX=h.subdivisionsX||h.subdivisions||1,V._subdivisionsY=h.subdivisionsY||h.subdivisions||1,V._width=h.width||1,V._height=h.height||1,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ;return k(h).WZ(V,h.updatable),V._setReady(!0),V}function o(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new H.c(Z,V);return u(h).WZ(v,h.updatable),v}function q(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const H=V.width||10,K=V.height||10,d=V.subdivisions||1,N=V.minHeight||0,D=V.maxHeight||1,k=V.colorFilter||new A.Ih(.3,.59,.11),u=V.alphaFilter||0,b=V.updatable,o=V.onReady;v=v||x.b.LastCreatedScene;const q=new a(Z,v);let X;q._subdivisionsX=d,q._subdivisionsY=d,q._width=H,q._height=K,q._maxX=q._width/2,q._maxZ=q._height/2,q._minX=-q._maxX,q._minZ=-q._maxZ,q._setReady(!1),V.passHeightBufferInCallback&&(X=new Float32Array((d+1)*(d+1)));const E=(Z,h,V)=>{F({width:H,height:K,subdivisions:d,minHeight:N,maxHeight:D,colorFilter:k,buffer:Z,bufferWidth:h,bufferHeight:V,alphaFilter:u,heightBuffer:X}).WZ(q,b),o&&o(q,X),q._setReady(!0)};if("string"===typeof h){const Z=Z=>{var h;const V=Z.width,A=Z.height;if(v.K)return;const H=null===(h=v)||void 0===h?void 0:h.getEngine().resizeImageBitmap(Z,V,A);E(H,V,A)};n.Tools.LoadImage(h,Z,V.onError?V.onError:()=>{},v.offlineProvider)}else E(h.data,h.width,h.height);return q}K.e.CreateGround=k,K.e.CreateTiledGround=u,K.e.CreateGroundFromHeightMap=F,H.c.CreateGround=(Z,h,V,v,A,H)=>b(Z,{width:h,height:V,subdivisions:v,updatable:H},A),H.c.CreateTiledGround=(Z,h,V,v,A,H,K,d,a)=>o(Z,{xmin:h,zmin:V,xmax:v,zmax:A,subdivisions:H,precision:K,updatable:a},d),H.c.CreateGroundFromHeightMap=(Z,h,V,v,A,H,K,d,a,n,x)=>q(Z,h,{width:V,height:v,subdivisions:A,minHeight:H,maxHeight:K,updatable:a,onReady:n,alphaFilter:x},d)},13645:(Z,h,V)=>{"use strict";V.d(h,{d:()=>k,h:()=>N,l:()=>D});var v=V(11729),A=V(12184),H=V(12161),K=V(12287),d=V(11805),a=V(11580);function n(Z){const h=[],V=[],v=Z.lines,A=Z.rZ,K=[];let d=0;for(let H=0;H<v.length;H++){const Z=v[H];for(let v=0;v<Z.length;v++){const{x:a,y:n,z:x}=Z[v];if(V.push(a,n,x),A){const Z=A[H],{r:h,g:V,b:d,a:a}=Z[v];K.push(h,V,d,a)}v>0&&(h.push(d-1),h.push(d)),d++}}const a=new H.e;return a.indices=h,a.BZ=V,A&&(a.rZ=K),a}function x(Z){const h=Z.dashSize||3,V=Z.gapSize||1,A=Z.dashNb||200,K=Z.points,d=[],a=[],n=v.Ch.Zero();let x=0,N=0,D=0,k=0,u=0,F=0,b=0;for(b=0;b<K.length-1;b++)K[b+1].subtractToRef(K[b],n),x+=n.length();for(D=x/A,k=h*D/(h+V),b=0;b<K.length-1;b++){K[b+1].subtractToRef(K[b],n),N=Math.floor(n.length()/D),n.normalize();for(let Z=0;Z<N;Z++)u=D*Z,d.push(K[b].x+u*n.x,K[b].y+u*n.y,K[b].z+u*n.z),d.push(K[b].x+(u+k)*n.x,K[b].y+(u+k)*n.y,K[b].z+(u+k)*n.z),a.push(F,F+1),F+=2}const o=new H.e;return o.BZ=d,o.indices=a,o}function N(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=h.instance,A=h.lines,H=h.rZ;if(v){const Z=v.getVerticesData(d.f.PositionKind);let h,V;H&&(h=v.getVerticesData(d.f.ColorKind));let K=0,a=0;for(let v=0;v<A.length;v++){const d=A[v];for(let A=0;A<d.length;A++)Z[K]=d[A].x,Z[K+1]=d[A].y,Z[K+2]=d[A].z,H&&h&&(V=H[v],h[a]=V[A].r,h[a+1]=V[A].g,h[a+2]=V[A].b,h[a+3]=V[A].a,a+=4),K+=3}return v.updateVerticesData(d.f.PositionKind,Z,!1,!1),H&&h&&v.updateVerticesData(d.f.ColorKind,h,!1,!1),v.refreshBoundingInfo(),v}const a=!!H,x=new K.e(Z,V,null,void 0,void 0,a,h.useVertexAlpha,h.material);return n(h).WZ(x,h.updatable),x}function D(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=h.rZ?[h.rZ]:null;return N(Z,{lines:[h.points],updatable:h.updatable,instance:h.instance,rZ:v,useVertexAlpha:h.useVertexAlpha,material:h.material},V)}function k(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.points,d=h.instance,n=h.gapSize||1,N=h.dashSize||3;if(d){const Z=Z=>{const h=v.Ch.Zero(),V=Z.length/6;let A=0,K=0,a=0,n=0,x=0,N=0,D=0,k=0;for(D=0;D<H.length-1;D++)H[D+1].subtractToRef(H[D],h),A+=h.length();a=A/V;const u=d._creationDataStorage.dashSize;for(n=u*a/(u+d._creationDataStorage.gapSize),D=0;D<H.length-1;D++)for(H[D+1].subtractToRef(H[D],h),K=Math.floor(h.length()/a),h.normalize(),k=0;k<K&&N<Z.length;)x=a*k,Z[N]=H[D].x+x*h.x,Z[N+1]=H[D].y+x*h.y,Z[N+2]=H[D].z+x*h.z,Z[N+3]=H[D].x+(x+n)*h.x,Z[N+4]=H[D].y+(x+n)*h.y,Z[N+5]=H[D].z+(x+n)*h.z,N+=6,k++;for(;N<Z.length;)Z[N]=H[D].x,Z[N+1]=H[D].y,Z[N+2]=H[D].z,N+=3};return(h.dashNb||h.dashSize||h.gapSize||h.useVertexAlpha||h.material)&&a.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),d.updateMeshPositions(Z,!1),d}const D=new K.e(Z,V,null,void 0,void 0,void 0,h.useVertexAlpha,h.material);return x(h).WZ(D,h.updatable),D._creationDataStorage=new A.g,D._creationDataStorage.dashSize=N,D._creationDataStorage.gapSize=n,D}H.e.CreateLineSystem=n,H.e.CreateDashedLines=x,A.c.yn=function(Z,h){return D(Z,{points:h,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},A.c.CreateDashedLines=function(Z,h,V,v,A){return k(Z,{points:h,dashSize:V,gapSize:v,dashNb:A,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13034:(Z,h,V)=>{"use strict";V.d(h,{b:()=>d,e:()=>a});var v=V(12184),A=V(12161),H=V(11792);function K(Z){const h=[],V=[],v=[],K=[],d=void 0!==Z.width?Z.width:void 0!==Z.size?Z.size:1,a=void 0!==Z.height?Z.height:void 0!==Z.size?Z.size:1,n=0===Z.sideOrientation?0:Z.sideOrientation||A.e.DEFAULTSIDE,x=d/2,N=a/2;V.push(-x,-N,0),v.push(0,0,-1),K.push(0,H.b?1:0),V.push(x,-N,0),v.push(0,0,-1),K.push(1,H.b?1:0),V.push(x,N,0),v.push(0,0,-1),K.push(1,H.b?0:1),V.push(-x,N,0),v.push(0,0,-1),K.push(0,H.b?0:1),h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),A.e._ComputeSides(n,V,h,v,K,Z.frontUVs,Z.backUVs);const D=new A.e;return D.indices=h,D.BZ=V,D.SZ=v,D.LZ=K,D}function d(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new v.c(Z,V);h.sideOrientation=v.c._GetDefaultSideOrientation(h.sideOrientation),A._originalBuilderSideOrientation=h.sideOrientation;return K(h).WZ(A,h.updatable),h.sourcePlane&&(A.translate(h.sourcePlane.normal,-h.sourcePlane.d),A.setDirection(h.sourcePlane.normal.scale(-1))),A}const a={mn:d};A.e.mn=K,v.c.mn=(Z,h,V,v,A)=>d(Z,{size:h,width:h,height:h,sideOrientation:A,updatable:v},V)},13121:(Z,h,V)=>{"use strict";V.d(h,{d:()=>a});var v=V(11729),A=V(12184),H=V(12161),K=V(11792);function d(Z){const h=0|(Z.segments||32),V=Z.diameterX||Z.diameter||1,A=Z.diameterY||Z.diameter||1,d=Z.diameterZ||Z.diameter||1,a=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,n=Z.slice&&Z.slice<=0?1:Z.slice||1,x=0===Z.sideOrientation?0:Z.sideOrientation||H.e.DEFAULTSIDE,N=!!Z.dedupTopBottomIndices,D=new v.Ch(V/2,A/2,d/2),k=2+h,u=2*k,F=[],b=[],o=[],q=[];for(let H=0;H<=k;H++){const Z=H/k,h=Z*Math.PI*n;for(let V=0;V<=u;V++){const A=V/u,H=A*Math.PI*2*a,d=v.Matrix.RotationZ(-h),n=v.Matrix.RotationY(H),x=v.Ch.TransformCoordinates(v.Ch.Up(),d),N=v.Ch.TransformCoordinates(x,n),k=N.multiply(D),F=N.divide(D).normalize();b.push(k.x,k.y,k.z),o.push(F.x,F.y,F.z),q.push(A,K.b?1-Z:Z)}if(H>0){const Z=b.length/3;for(let h=Z-2*(u+1);h+u+2<Z;h++)N?(H>1&&(F.push(h),F.push(h+1),F.push(h+u+1)),(H<k||n<1)&&(F.push(h+u+1),F.push(h+1),F.push(h+u+2))):(F.push(h),F.push(h+1),F.push(h+u+1),F.push(h+u+1),F.push(h+1),F.push(h+u+2))}}H.e._ComputeSides(x,b,F,o,q,Z.frontUVs,Z.backUVs);const X=new H.e;return X.indices=F,X.BZ=b,X.SZ=o,X.LZ=q,X}function a(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return d(h).WZ(v,h.updatable),v}H.e.CreateSphere=d,A.c.CreateSphere=(Z,h,V,v,A,H)=>a(Z,{segments:h,diameterX:V,diameterY:V,diameterZ:V,sideOrientation:H,updatable:A},v)},14002:(Z,h,V)=>{"use strict";V.d(h,{b:()=>d});var v=V(12311),A=V(13430),H=V(12322),K=V(12161);class d{static get Configuration(){return{get decoder(){return A.b.DefaultConfiguration},set decoder(Z){A.b.DefaultConfiguration=Z}}}static set Configuration(Z){A.b.DefaultConfiguration=Z.decoder}static get DecoderAvailable(){return(0,v.j)(A.b.DefaultConfiguration)}static get Default(){return d._Default??(d._Default=new d),d._Default}static ResetDefault(Z){d._Default&&(Z||d._Default.dispose(),d._Default=null)}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.DefaultNumWorkers;const h="number"===typeof Z?{...A.b.DefaultConfiguration,numWorkers:Z}:{...A.b.DefaultConfiguration,...Z};this._decoder=new A.b(h)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Z,h,V){return this._decoder.decodeMeshToMeshDataAsync(Z,h,V)}async decodeMeshToGeometryAsync(Z,h,V,v){return await this._decoder.decodeMeshToGeometryAsync(Z,h,V,v)}async _decodeMeshToGeometryForGltfAsync(Z,h,V,v,A,H){return await this._decoder._decodeMeshToGeometryForGltfAsync(Z,h,V,v,A,H)}async decodeMeshAsync(Z,h){const V=await this._decoder.decodeMeshToMeshDataAsync(Z,h),v=new K.e;V.indices&&(v.indices=V.indices);for(const A of V.attributes){const Z=H.d.GetFloatData(A.data,A.size,H.d.GetDataType(A.data),A.byteOffset,A.byteStride,A.normalized,V.totalVertices);v.set(Z,A.kind)}return v}}d.DefaultNumWorkers=(0,v.h)(),d._Default=null},13430:(Z,h,V)=>{"use strict";V.d(h,{b:()=>n});var v=V(12311),A=V(11564),H=V(12197),K=V(12322),d=V(11580),a=V(12315);class n extends v.d{static get DefaultAvailable(){return(0,v.j)(n.DefaultConfiguration)}static get Default(){return n._Default??(n._Default=new n),n._Default}static ResetDefault(Z){n._Default&&(Z||n._Default.dispose(),n._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Z,h){return{module:await(h||DracoDecoderModule)({wasmBinary:Z})}}_getWorkerContent(){return`${a.d}(${a.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DefaultConfiguration)}decodeMeshToMeshDataAsync(Z,h,V){const v=Z instanceof ArrayBuffer?new Int8Array(Z):new Int8Array(Z.buffer,Z.byteOffset,Z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Z=>await new Promise(((A,H)=>{Z.push(((Z,K)=>{let a=null;const n=[],x=h=>{Z.removeEventListener("error",x),Z.removeEventListener("message",N),H(h),K()},N=h=>{const v=h.data;switch(v.id){case"indices":a=v.data;break;case"attribute":n.push({kind:v.kind,data:v.data,size:v.size,byteOffset:v.byteOffset,byteStride:v.byteStride,normalized:(H=v.kind,D=v.normalized,V&&void 0!==V[H]?(D!==V[H]&&d.b.Warn(`Normalized flag from Draco data (${D}) does not match normalized flag from glTF accessor (${V[H]}). Using flag from glTF accessor.`),V[H]):D)});break;case"decodeMeshDone":Z.removeEventListener("error",x),Z.removeEventListener("message",N),A({indices:a,attributes:n,totalVertices:v.totalVertices}),K()}var H,D};Z.addEventListener("error",x),Z.addEventListener("message",N);const D=v.slice();Z.postMessage({id:"decodeMesh",dataView:D,attributes:h},[D.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Z=>{let V=null;const A=[],H=(0,a.d)(Z.module,v,h,(Z=>{V=Z}),((Z,h,V,v,H,K)=>{A.push({kind:Z,data:h,size:V,byteOffset:v,byteStride:H,normalized:K})}));return{indices:V,attributes:A,totalVertices:H}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Z,h,V,v){const A=await this.decodeMeshToMeshDataAsync(V,v),d=new H.e(Z,h);A.indices&&d.setIndices(A.indices);for(const H of A.attributes)d.setVerticesBuffer(new K.d(h.getEngine(),H.data,H.kind,!1,void 0,H.byteStride,void 0,H.byteOffset,H.size,void 0,H.normalized,!0),A.totalVertices);return d}async _decodeMeshToGeometryForGltfAsync(Z,h,V,v,A,d){const a=await this.decodeMeshToMeshDataAsync(V,v,A),n=new H.e(Z,h);d&&(n._boundingInfo=d,n.useBoundingInfoFromGeometry=!0),a.indices&&n.setIndices(a.indices);for(const H of a.attributes)n.setVerticesBuffer(new K.d(h.getEngine(),H.data,H.kind,!1,void 0,H.byteStride,void 0,H.byteOffset,H.size,void 0,H.normalized,!0),a.totalVertices);return n}}n.DefaultConfiguration={wasmUrl:`${A.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${A.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${A.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},n._Default=null},13638:(Z,h,V)=>{"use strict";V.d(h,{c:()=>dZ});var v=V(11729),A=V(12184),H=V(11805),K=V(12161),d=V(11792);function a(Z){let h=Z.pathArray;const V=Z.closeArray||!1,v=Z.closePath||!1,A=Z.invertUV||!1,a=Math.floor(h[0].length/2);let n=Z.offset||a;n=n>a?a:Math.floor(n);const x=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,N=Z.LZ,D=Z.rZ,k=[],u=[],F=[],b=[],o=[],q=[],X=[],E=[];let j;const P=[],C=[];let l,B,S;if(h.length<2){const Z=[],V=[];for(B=0;B<h[0].length-n;B++)Z.push(h[0][B]),V.push(h[0][B+n]);h=[Z,V]}let r=0;const L=v?1:0,y=V?1:0;let W,z,m,g,I,e;for(j=h[0].length,l=0;l<h.length+y;l++){for(X[l]=0,o[l]=[0],W=l===h.length?h[0]:h[l],z=W.length,j=j<z?j:z,S=0;S<z;)k.push(W[S].x,W[S].y,W[S].z),S>0&&(m=W[S].rh(W[S-1]).length(),g=m+X[l],o[l].push(g),X[l]=g),S++;v&&(S--,k.push(W[0].x,W[0].y,W[0].z),m=W[S].rh(W[0]).length(),g=m+X[l],o[l].push(g),X[l]=g),P[l]=z+L,C[l]=r,r+=z+L}let U,R,Q=null,w=null;for(B=0;B<j+L;B++)for(E[B]=0,q[B]=[0],l=0;l<h.length-1+y;l++)I=h[l],e=l===h.length-1?h[0]:h[l+1],B===j?(Q=I[0],w=e[0]):(Q=I[B],w=e[B]),m=w.rh(Q).length(),g=m+E[B],q[B].push(g),E[B]=g;if(N)for(l=0;l<N.length;l++)b.push(N[l].x,d.b?1-N[l].y:N[l].y);else for(l=0;l<h.length+y;l++)for(B=0;B<j+L;B++)U=0!=X[l]?o[l][B]/X[l]:0,R=0!=E[B]?q[B][l]/E[B]:0,A?b.push(R,U):b.push(U,d.b?1-R:R);l=0;let T=0,t=P[l]-1,c=P[l+1]-1,i=t<c?t:c,M=C[1]-C[0];const O=P.length-1;for(;T<=i&&l<O;)u.push(T,T+M,T+1),u.push(T+M+1,T+1,T+M),T+=1,T===i&&(l++,M=C[l+1]-C[l],t=P[l]-1,c=P[l+1]-1,T=C[l],i=t<c?t+T:c+T);if(K.e.ComputeNormals(k,u,F),v){let Z=0,V=0;for(l=0;l<h.length;l++){Z=3*C[l],V=l+1<h.length?3*(C[l+1]-1):F.length-3,F[Z]=.5*(F[Z]+F[V]),F[Z+1]=.5*(F[Z+1]+F[V+1]),F[Z+2]=.5*(F[Z+2]+F[V+2]);const v=Math.sqrt(F[Z]*F[Z]+F[Z+1]*F[Z+1]+F[Z+2]*F[Z+2]);F[Z]/=v,F[Z+1]/=v,F[Z+2]/=v,F[V]=F[Z],F[V+1]=F[Z+1],F[V+2]=F[Z+2]}}if(V){let Z=3*C[0],V=3*C[h.length];for(B=0;B<j+L;B++){F[Z]=.5*(F[Z]+F[V]),F[Z+1]=.5*(F[Z+1]+F[V+1]),F[Z+2]=.5*(F[Z+2]+F[V+2]);const h=Math.sqrt(F[Z]*F[Z]+F[Z+1]*F[Z+1]+F[Z+2]*F[Z+2]);F[Z]/=h,F[Z+1]/=h,F[Z+2]/=h,F[V]=F[Z],F[V+1]=F[Z+1],F[V+2]=F[Z+2],Z+=3,V+=3}}K.e._ComputeSides(x,k,u,F,b,Z.frontUVs,Z.backUVs);let s=null;if(D){s=new Float32Array(4*D.length);for(let Z=0;Z<D.length;Z++)s[4*Z]=D[Z].r,s[4*Z+1]=D[Z].g,s[4*Z+2]=D[Z].b,s[4*Z+3]=D[Z].a}const J=new K.e,f=new Float32Array(k),p=new Float32Array(F),Y=new Float32Array(b);return J.indices=u,J.BZ=f,J.SZ=p,J.LZ=Y,s&&J.set(s,H.f.ColorKind),v&&(J._idx=C),J}function n(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=h.pathArray,x=h.closeArray,N=h.closePath,D=A.c._GetDefaultSideOrientation(h.sideOrientation),k=h.instance,u=h.updatable;if(k){const Z=v.TmpVectors.Ch[0].vd(Number.MAX_VALUE),V=v.TmpVectors.Ch[1].vd(-Number.MAX_VALUE),a=h=>{let v=n[0].length;const H=k;let K=0;const d=H._originalBuilderSideOrientation===A.c.DOUBLESIDE?2:1;for(let A=1;A<=d;++A)for(let d=0;d<n.length;++d){const A=n[d],a=A.length;v=v<a?v:a;for(let H=0;H<v;++H){const v=A[H];h[K]=v.x,h[K+1]=v.y,h[K+2]=v.z,Z.minimizeInPlaceFromFloats(v.x,v.y,v.z),V.maximizeInPlaceFromFloats(v.x,v.y,v.z),K+=3}if(H._creationDataStorage&&H._creationDataStorage.closePath){const Z=A[0];h[K]=Z.x,h[K+1]=Z.y,h[K+2]=Z.z,K+=3}}},x=k.getVerticesData(H.f.PositionKind);if(a(x),k.hasBoundingInfo?k.getBoundingInfo().reConstruct(Z,V,k._worldMatrix):k.buildBoundingInfo(Z,V,k._worldMatrix),k.updateVerticesData(H.f.PositionKind,x,!1,!1),h.rZ){const Z=k.getVerticesData(H.f.ColorKind);for(let V=0,v=0;V<h.rZ.length;V++,v+=4){const A=h.rZ[V];Z[v]=A.r,Z[v+1]=A.g,Z[v+2]=A.b,Z[v+3]=A.a}k.updateVerticesData(H.f.ColorKind,Z,!1,!1)}if(h.LZ){const Z=k.getVerticesData(H.f.UVKind);for(let V=0;V<h.LZ.length;V++)Z[2*V]=h.LZ[V].x,Z[2*V+1]=d.b?1-h.LZ[V].y:h.LZ[V].y;k.updateVerticesData(H.f.UVKind,Z,!1,!1)}if(!k.areNormalsFrozen||k.isFacetDataEnabled){const Z=k.fh(),h=k.getVerticesData(H.f.NormalKind),V=k.isFacetDataEnabled?k.getFacetDataParameters():null;if(K.e.ComputeNormals(x,Z,h,V),k._creationDataStorage&&k._creationDataStorage.closePath){let Z=0,V=0;for(let v=0;v<n.length;v++)Z=3*k._creationDataStorage.idx[v],V=v+1<n.length?3*(k._creationDataStorage.idx[v+1]-1):h.length-3,h[Z]=.5*(h[Z]+h[V]),h[Z+1]=.5*(h[Z+1]+h[V+1]),h[Z+2]=.5*(h[Z+2]+h[V+2]),h[V]=h[Z],h[V+1]=h[Z+1],h[V+2]=h[Z+2]}k.areNormalsFrozen||k.updateVerticesData(H.f.NormalKind,h,!1,!1)}return k}{const v=new A.c(Z,V);v._originalBuilderSideOrientation=D,v._creationDataStorage=new A.g;const H=a(h);return N&&(v._creationDataStorage.idx=H._idx),v._creationDataStorage.closePath=N,v._creationDataStorage.closeArray=x,H.WZ(v,u),v}}K.e.CreateRibbon=a,A.c.CreateRibbon=function(Z,h){return n(Z,{pathArray:h,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var x=V(13131),N=V(12976),D=V(11781);function k(Z){const h=Z.pattern||A.c.NO_FLIP,V=Z.tileWidth||Z.tileSize||1,v=Z.tileHeight||Z.tileSize||1,H=Z.alignHorizontal||0,d=Z.alignVertical||0,a=Z.width||Z.size||1,n=Math.floor(a/V);let x=a-n*V;const N=Z.height||Z.size||1,D=Math.floor(N/v);let k=N-D*v;const u=V*n/2,F=v*D/2;let b=0,o=0,q=0,X=0,E=0,j=0;if(x>0||k>0){switch(q=-u,X=-F,E=u,j=F,H){case A.c.CENTER:x/=2,q-=x,E+=x;break;case A.c.LEFT:E+=x,b=-x/2;break;case A.c.RIGHT:q-=x,b=x/2}switch(d){case A.c.CENTER:k/=2,X-=k,j+=k;break;case A.c.BOTTOM:j+=k,o=-k/2;break;case A.c.TOP:X-=k,o=k/2}}const P=[],C=[],l=[];l[0]=[0,0,1,0,1,1,0,1],l[1]=[0,0,1,0,1,1,0,1],h!==A.c.ROTATE_TILE&&h!==A.c.ROTATE_ROW||(l[1]=[1,1,0,1,0,0,1,0]),h!==A.c.FLIP_TILE&&h!==A.c.FLIP_ROW||(l[1]=[1,0,0,0,0,1,1,1]),h!==A.c.FLIP_N_ROTATE_TILE&&h!==A.c.FLIP_N_ROTATE_ROW||(l[1]=[0,1,1,1,1,0,0,0]);let B=[];const S=[],r=[];let L=0;for(let K=0;K<D;K++)for(let Z=0;Z<n;Z++)P.push(Z*V-u+b,K*v-F+o,0),P.push((Z+1)*V-u+b,K*v-F+o,0),P.push((Z+1)*V-u+b,(K+1)*v-F+o,0),P.push(Z*V-u+b,(K+1)*v-F+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),B=h===A.c.FLIP_TILE||h===A.c.ROTATE_TILE||h===A.c.FLIP_N_ROTATE_TILE?B.concat(l[(Z%2+K%2)%2]):h===A.c.FLIP_ROW||h===A.c.ROTATE_ROW||h===A.c.FLIP_N_ROTATE_ROW?B.concat(l[K%2]):B.concat(l[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),L+=4;if(x>0||k>0){const Z=k>0&&(d===A.c.CENTER||d===A.c.TOP),K=k>0&&(d===A.c.CENTER||d===A.c.BOTTOM),a=x>0&&(H===A.c.CENTER||H===A.c.RIGHT),N=x>0&&(H===A.c.CENTER||H===A.c.LEFT);let l,y,W,z,m=[];if(Z&&a&&(P.push(q+b,X+o,0),P.push(-u+b,X+o,0),P.push(-u+b,X+k+o,0),P.push(q+b,X+k+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,l=1-x/V,y=1-k/v,W=1,z=1,m=[l,y,W,y,W,z,l,z],h===A.c.ROTATE_ROW&&(m=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),h===A.c.FLIP_ROW&&(m=[1-l,y,1-W,y,1-W,z,1-l,z]),h===A.c.FLIP_N_ROTATE_ROW&&(m=[l,1-y,W,1-y,W,1-z,l,1-z]),B=B.concat(m),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&N&&(P.push(u+b,X+o,0),P.push(E+b,X+o,0),P.push(E+b,X+k+o,0),P.push(u+b,X+k+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,l=0,y=1-k/v,W=x/V,z=1,m=[l,y,W,y,W,z,l,z],(h===A.c.ROTATE_ROW||h===A.c.ROTATE_TILE&&n%2===0)&&(m=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),(h===A.c.FLIP_ROW||h===A.c.FLIP_TILE&&n%2===0)&&(m=[1-l,y,1-W,y,1-W,z,1-l,z]),(h===A.c.FLIP_N_ROTATE_ROW||h===A.c.FLIP_N_ROTATE_TILE&&n%2===0)&&(m=[l,1-y,W,1-y,W,1-z,l,1-z]),B=B.concat(m),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&a&&(P.push(q+b,F+o,0),P.push(-u+b,F+o,0),P.push(-u+b,j+o,0),P.push(q+b,j+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,l=1-x/V,y=0,W=1,z=k/v,m=[l,y,W,y,W,z,l,z],(h===A.c.ROTATE_ROW&&D%2===1||h===A.c.ROTATE_TILE&&D%1===0)&&(m=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),(h===A.c.FLIP_ROW&&D%2===1||h===A.c.FLIP_TILE&&D%2===0)&&(m=[1-l,y,1-W,y,1-W,z,1-l,z]),(h===A.c.FLIP_N_ROTATE_ROW&&D%2===1||h===A.c.FLIP_N_ROTATE_TILE&&D%2===0)&&(m=[l,1-y,W,1-y,W,1-z,l,1-z]),B=B.concat(m),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&N&&(P.push(u+b,F+o,0),P.push(E+b,F+o,0),P.push(E+b,j+o,0),P.push(u+b,j+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,l=0,y=0,W=x/V,z=k/v,m=[l,y,W,y,W,z,l,z],(h===A.c.ROTATE_ROW&&D%2===1||h===A.c.ROTATE_TILE&&(D+n)%2===1)&&(m=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),(h===A.c.FLIP_ROW&&D%2===1||h===A.c.FLIP_TILE&&(D+n)%2===1)&&(m=[1-l,y,1-W,y,1-W,z,1-l,z]),(h===A.c.FLIP_N_ROTATE_ROW&&D%2===1||h===A.c.FLIP_N_ROTATE_TILE&&(D+n)%2===1)&&(m=[l,1-y,W,1-y,W,1-z,l,1-z]),B=B.concat(m),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z){const Z=[];l=0,y=1-k/v,W=1,z=1,Z[0]=[l,y,W,y,W,z,l,z],Z[1]=[l,y,W,y,W,z,l,z],h!==A.c.ROTATE_TILE&&h!==A.c.ROTATE_ROW||(Z[1]=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),h!==A.c.FLIP_TILE&&h!==A.c.FLIP_ROW||(Z[1]=[1-l,y,1-W,y,1-W,z,1-l,z]),h!==A.c.FLIP_N_ROTATE_TILE&&h!==A.c.FLIP_N_ROTATE_ROW||(Z[1]=[l,1-y,W,1-y,W,1-z,l,1-z]);for(let v=0;v<n;v++)P.push(v*V-u+b,X+o,0),P.push((v+1)*V-u+b,X+o,0),P.push((v+1)*V-u+b,X+k+o,0),P.push(v*V-u+b,X+k+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,B=h===A.c.FLIP_TILE||h===A.c.ROTATE_TILE||h===A.c.FLIP_N_ROTATE_TILE?B.concat(Z[(v+1)%2]):h===A.c.FLIP_ROW||h===A.c.ROTATE_ROW||h===A.c.FLIP_N_ROTATE_ROW?B.concat(Z[1]):B.concat(Z[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const Z=[];l=0,y=0,W=1,z=k/v,Z[0]=[l,y,W,y,W,z,l,z],Z[1]=[l,y,W,y,W,z,l,z],h!==A.c.ROTATE_TILE&&h!==A.c.ROTATE_ROW||(Z[1]=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),h!==A.c.FLIP_TILE&&h!==A.c.FLIP_ROW||(Z[1]=[1-l,y,1-W,y,1-W,z,1-l,z]),h!==A.c.FLIP_N_ROTATE_TILE&&h!==A.c.FLIP_N_ROTATE_ROW||(Z[1]=[l,1-y,W,1-y,W,1-z,l,1-z]);for(let v=0;v<n;v++)P.push(v*V-u+b,j-k+o,0),P.push((v+1)*V-u+b,j-k+o,0),P.push((v+1)*V-u+b,j+o,0),P.push(v*V-u+b,j+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,B=h===A.c.FLIP_TILE||h===A.c.ROTATE_TILE||h===A.c.FLIP_N_ROTATE_TILE?B.concat(Z[(v+D)%2]):h===A.c.FLIP_ROW||h===A.c.ROTATE_ROW||h===A.c.FLIP_N_ROTATE_ROW?B.concat(Z[D%2]):B.concat(Z[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const Z=[];l=1-x/V,y=0,W=1,z=1,Z[0]=[l,y,W,y,W,z,l,z],Z[1]=[l,y,W,y,W,z,l,z],h!==A.c.ROTATE_TILE&&h!==A.c.ROTATE_ROW||(Z[1]=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),h!==A.c.FLIP_TILE&&h!==A.c.FLIP_ROW||(Z[1]=[1-l,y,1-W,y,1-W,z,1-l,z]),h!==A.c.FLIP_N_ROTATE_TILE&&h!==A.c.FLIP_N_ROTATE_ROW||(Z[1]=[l,1-y,W,1-y,W,1-z,l,1-z]);for(let V=0;V<D;V++)P.push(q+b,V*v-F+o,0),P.push(q+x+b,V*v-F+o,0),P.push(q+x+b,(V+1)*v-F+o,0),P.push(q+b,(V+1)*v-F+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,B=h===A.c.FLIP_TILE||h===A.c.ROTATE_TILE||h===A.c.FLIP_N_ROTATE_TILE?B.concat(Z[(V+1)%2]):h===A.c.FLIP_ROW||h===A.c.ROTATE_ROW||h===A.c.FLIP_N_ROTATE_ROW?B.concat(Z[V%2]):B.concat(Z[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(N){const Z=[];l=0,y=0,W=x/v,z=1,Z[0]=[l,y,W,y,W,z,l,z],Z[1]=[l,y,W,y,W,z,l,z],h!==A.c.ROTATE_TILE&&h!==A.c.ROTATE_ROW||(Z[1]=[1-l,1-y,1-W,1-y,1-W,1-z,1-l,1-z]),h!==A.c.FLIP_TILE&&h!==A.c.FLIP_ROW||(Z[1]=[1-l,y,1-W,y,1-W,z,1-l,z]),h!==A.c.FLIP_N_ROTATE_TILE&&h!==A.c.FLIP_N_ROTATE_ROW||(Z[1]=[l,1-y,W,1-y,W,1-z,l,1-z]);for(let V=0;V<D;V++)P.push(E-x+b,V*v-F+o,0),P.push(E+b,V*v-F+o,0),P.push(E+b,(V+1)*v-F+o,0),P.push(E-x+b,(V+1)*v-F+o,0),r.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,B=h===A.c.FLIP_TILE||h===A.c.ROTATE_TILE||h===A.c.FLIP_N_ROTATE_TILE?B.concat(Z[(V+n)%2]):h===A.c.FLIP_ROW||h===A.c.ROTATE_ROW||h===A.c.FLIP_N_ROTATE_ROW?B.concat(Z[V%2]):B.concat(Z[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const y=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE;K.e._ComputeSides(y,P,r,C,B,Z.frontUVs,Z.backUVs);const W=new K.e;W.indices=r,W.BZ=P,W.SZ=C,W.LZ=B;const z=y===K.e.DOUBLESIDE?S.concat(S):S;return W.rZ=z,W}function u(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return k(h).WZ(v,h.updatable),v}function F(Z){const h=Z.faceUV||new Array(6),V=Z.faceColors,H=Z.pattern||A.c.NO_FLIP,a=Z.width||Z.size||1,n=Z.height||Z.size||1,x=Z.depth||Z.size||1,N=Z.tileWidth||Z.tileSize||1,u=Z.tileHeight||Z.tileSize||1,F=Z.alignHorizontal||0,b=Z.alignVertical||0,o=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE;for(let A=0;A<6;A++)void 0===h[A]&&(h[A]=new v.Vector4(0,0,1,1)),V&&void 0===V[A]&&(V[A]=new D.nd(1,1,1,1));const q=a/2,X=n/2,E=x/2,j=[];for(let v=0;v<2;v++)j[v]=k({pattern:H,tileWidth:N,tileHeight:u,width:a,height:n,alignVertical:b,alignHorizontal:F,sideOrientation:o});for(let v=2;v<4;v++)j[v]=k({pattern:H,tileWidth:N,tileHeight:u,width:x,height:n,alignVertical:b,alignHorizontal:F,sideOrientation:o});let P=b;b===A.c.BOTTOM?P=A.c.TOP:b===A.c.TOP&&(P=A.c.BOTTOM);for(let v=4;v<6;v++)j[v]=k({pattern:H,tileWidth:N,tileHeight:u,width:a,height:x,alignVertical:P,alignHorizontal:F,sideOrientation:o});let C=[],l=[],B=[],S=[];const r=[],L=[],y=[],W=[];let z=0,m=0;for(let A=0;A<6;A++){const Z=j[A].BZ.length;L[A]=[],y[A]=[];for(let h=0;h<Z/3;h++)L[A].push(new v.Ch(j[A].BZ[3*h],j[A].BZ[3*h+1],j[A].BZ[3*h+2])),y[A].push(new v.Ch(j[A].SZ[3*h],j[A].SZ[3*h+1],j[A].SZ[3*h+2]));z=j[A].LZ.length,W[A]=[];for(let V=0;V<z;V+=2)W[A][V]=h[A].x+(h[A].z-h[A].x)*j[A].LZ[V],W[A][V+1]=h[A].y+(h[A].w-h[A].y)*j[A].LZ[V+1],d.b&&(W[A][V+1]=1-W[A][V+1]);if(B=B.concat(W[A]),S=S.concat(j[A].indices.map((Z=>Z+m))),m+=L[A].length,V)for(let h=0;h<4;h++)r.push(V[A].r,V[A].g,V[A].b,V[A].a)}const g=new v.Ch(0,0,E),I=v.Matrix.RotationY(Math.PI);C=L[0].map((Z=>v.Ch.TransformNormal(Z,I).add(g))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[]),l=y[0].map((Z=>v.Ch.TransformNormal(Z,I))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[]),C=C.concat(L[1].map((Z=>Z.rh(g))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[])),l=l.concat(y[1].map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[]));const e=new v.Ch(q,0,0),U=v.Matrix.RotationY(-Math.PI/2);C=C.concat(L[2].map((Z=>v.Ch.TransformNormal(Z,U).add(e))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[])),l=l.concat(y[2].map((Z=>v.Ch.TransformNormal(Z,U))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[]));const R=v.Matrix.RotationY(Math.PI/2);C=C.concat(L[3].map((Z=>v.Ch.TransformNormal(Z,R).rh(e))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[])),l=l.concat(y[3].map((Z=>v.Ch.TransformNormal(Z,R))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[]));const Q=new v.Ch(0,X,0),w=v.Matrix.RotationX(Math.PI/2);C=C.concat(L[4].map((Z=>v.Ch.TransformNormal(Z,w).add(Q))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[])),l=l.concat(y[4].map((Z=>v.Ch.TransformNormal(Z,w))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[]));const T=v.Matrix.RotationX(-Math.PI/2);C=C.concat(L[5].map((Z=>v.Ch.TransformNormal(Z,T).rh(Q))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[])),l=l.concat(y[5].map((Z=>v.Ch.TransformNormal(Z,T))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,h)=>Z.concat(h)),[])),K.e._ComputeSides(o,C,S,l,B);const t=new K.e;if(t.indices=S,t.BZ=C,t.SZ=l,t.LZ=B,V){const Z=o===K.e.DOUBLESIDE?r.concat(r):r;t.rZ=Z}return t}function b(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return F(h).WZ(v,h.updatable),v}K.e.CreateTiledPlane=k;K.e.CreateTiledBox=F;var o=V(13121),q=V(11983),X=V(11937);function E(Z){const h=Z.height||2;let V=0===Z.diameterTop?0:Z.diameterTop||Z.diameter||1,H=0===Z.diameterBottom?0:Z.diameterBottom||Z.diameter||1;V=V||1e-5,H=H||1e-5;const a=0|(Z.tessellation||24),n=0|(Z.subdivisions||1),x=!!Z.hasRings,N=!!Z.enclose,k=0===Z.cap?0:Z.cap||A.c.CAP_ALL,u=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,F=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,b=Z.faceUV||new Array(3),o=Z.faceColors,q=2+(1+(1!==u&&N?2:0))*(x?n:1);let E;for(E=0;E<q;E++)o&&void 0===o[E]&&(o[E]=new D.nd(1,1,1,1));for(E=0;E<q;E++)b&&void 0===b[E]&&(b[E]=new v.Vector4(0,0,1,1));const j=[],P=[],C=[],l=[],B=[],S=2*Math.PI*u/a;let r,L,y;const W=(H-V)/2/h,z=v.Ch.Zero(),m=v.Ch.Zero(),g=v.Ch.Zero(),I=v.Ch.Zero(),e=v.Ch.Zero(),U=X.b.Y;let R,Q,w,T=1,t=1,c=0,i=0;for(R=0;R<=n;R++)for(L=R/n,y=(L*(V-H)+H)/2,T=x&&0!==R&&R!==n?2:1,w=0;w<T;w++){for(x&&(t+=w),N&&(t+=2*w),Q=0;Q<=a;Q++)r=Q*S,z.x=Math.cos(-r)*y,z.y=-h/2+L*h,z.z=Math.sin(-r)*y,0===V&&R===n?(m.x=C[C.length-3*(a+1)],m.y=C[C.length-3*(a+1)+1],m.z=C[C.length-3*(a+1)+2]):(m.x=z.x,m.z=z.z,m.y=Math.sqrt(m.x*m.x+m.z*m.z)*W,m.normalize()),0===Q&&(g.v(z),I.v(m)),P.push(z.x,z.y,z.z),C.push(m.x,m.y,m.z),i=x?c!==t?b[t].y:b[t].w:b[t].y+(b[t].w-b[t].y)*L,l.push(b[t].x+(b[t].z-b[t].x)*Q/a,d.b?1-i:i),o&&B.push(o[t].r,o[t].g,o[t].b,o[t].a);1!==u&&N&&(P.push(z.x,z.y,z.z),P.push(0,z.y,0),P.push(0,z.y,0),P.push(g.x,g.y,g.z),v.Ch.CrossToRef(U,m,e),e.normalize(),C.push(e.x,e.y,e.z,e.x,e.y,e.z),v.Ch.CrossToRef(I,U,e),e.normalize(),C.push(e.x,e.y,e.z,e.x,e.y,e.z),i=x?c!==t?b[t+1].y:b[t+1].w:b[t+1].y+(b[t+1].w-b[t+1].y)*L,l.push(b[t+1].x,d.b?1-i:i),l.push(b[t+1].z,d.b?1-i:i),i=x?c!==t?b[t+2].y:b[t+2].w:b[t+2].y+(b[t+2].w-b[t+2].y)*L,l.push(b[t+2].x,d.b?1-i:i),l.push(b[t+2].z,d.b?1-i:i),o&&(B.push(o[t+1].r,o[t+1].g,o[t+1].b,o[t+1].a),B.push(o[t+1].r,o[t+1].g,o[t+1].b,o[t+1].a),B.push(o[t+2].r,o[t+2].g,o[t+2].b,o[t+2].a),B.push(o[t+2].r,o[t+2].g,o[t+2].b,o[t+2].a))),c!==t&&(c=t)}const M=1!==u&&N?a+4:a;for(R=0,t=0;t<n;t++){let Z=0,h=0,V=0,v=0;for(Q=0;Q<a;Q++)Z=R*(M+1)+Q,h=(R+1)*(M+1)+Q,V=R*(M+1)+(Q+1),v=(R+1)*(M+1)+(Q+1),j.push(Z,h,V),j.push(v,V,h);1!==u&&N&&(j.push(Z+2,h+2,V+2),j.push(v+2,V+2,h+2),j.push(Z+4,h+4,V+4),j.push(v+4,V+4,h+4)),R=x?R+2:R+1}const O=Z=>{const A=Z?V/2:H/2;if(0===A)return;let K,n,x;const N=Z?b[q-1]:b[0];let D=null;o&&(D=Z?o[q-1]:o[0]);const k=P.length/3,F=Z?h/2:-h/2,X=new v.Ch(0,F,0);P.push(X.x,X.y,X.z),C.push(0,Z?1:-1,0);const E=N.y+.5*(N.w-N.y);l.push(N.x+.5*(N.z-N.x),d.b?1-E:E),D&&B.push(D.r,D.g,D.b,D.a);const S=new v.Vector2(.5,.5);for(x=0;x<=a;x++){K=2*Math.PI*x*u/a;const h=Math.cos(-K),V=Math.sin(-K);n=new v.Ch(h*A,F,V*A);const H=new v.Vector2(h*S.x+.5,V*S.y+.5);P.push(n.x,n.y,n.z),C.push(0,Z?1:-1,0);const k=N.y+(N.w-N.y)*H.y;l.push(N.x+(N.z-N.x)*H.x,d.b?1-k:k),D&&B.push(D.r,D.g,D.b,D.a)}for(x=0;x<a;x++)Z?(j.push(k),j.push(k+(x+2)),j.push(k+(x+1))):(j.push(k),j.push(k+(x+1)),j.push(k+(x+2)))};k!==A.c.CAP_START&&k!==A.c.CAP_ALL||O(!1),k!==A.c.CAP_END&&k!==A.c.CAP_ALL||O(!0),K.e._ComputeSides(F,P,j,C,l,Z.frontUVs,Z.backUVs);const s=new K.e;return s.indices=j,s.BZ=P,s.SZ=C,s.LZ=l,o&&(s.rZ=B),s}function j(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return E(h).WZ(v,h.updatable),v}function P(Z){const h=[],V=[],A=[],H=[],a=Z.diameter||1,n=Z.thickness||.5,x=0|(Z.tessellation||16),N=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,D=x+1;for(let K=0;K<=x;K++){const Z=K/x,N=K*Math.PI*2/x-Math.PI/2,k=v.Matrix.Translation(a/2,0,0).multiply(v.Matrix.RotationY(N));for(let a=0;a<=x;a++){const N=1-a/x,u=a*Math.PI*2/x+Math.PI,F=Math.cos(u),b=Math.sin(u);let o=new v.Ch(F,b,0),q=o.scale(n/2);const X=new v.Vector2(Z,N);q=v.Ch.TransformCoordinates(q,k),o=v.Ch.TransformNormal(o,k),V.push(q.x,q.y,q.z),A.push(o.x,o.y,o.z),H.push(X.x,d.b?1-X.y:X.y);const E=(K+1)%D,j=(a+1)%D;h.push(K*D+a),h.push(K*D+j),h.push(E*D+a),h.push(K*D+j),h.push(E*D+j),h.push(E*D+a)}}K.e._ComputeSides(N,V,h,A,H,Z.frontUVs,Z.backUVs);const k=new K.e;return k.indices=h,k.BZ=V,k.SZ=A,k.LZ=H,k}function C(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return P(h).WZ(v,h.updatable),v}K.e.CreateCylinder=E,A.c.CreateCylinder=(Z,h,V,v,H,K,d,a,n)=>{void 0!==d&&d instanceof q.e||(void 0!==d&&(n=a||A.c.DEFAULTSIDE,a=d),d=K,K=1);return j(Z,{height:h,diameterTop:V,diameterBottom:v,tessellation:H,subdivisions:K,sideOrientation:n,updatable:a},d)};function l(Z){const h=[],V=[],A=[],H=[],a=Z.radius||2,n=Z.tube||.5,x=Z.radialSegments||32,N=Z.tubularSegments||32,D=Z.p||2,k=Z.q||3,u=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,F=Z=>{const h=Math.cos(Z),V=Math.sin(Z),A=k/D*Z,H=Math.cos(A),K=a*(2+H)*.5*h,d=a*(2+H)*V*.5,n=a*Math.sin(A)*.5;return new v.Ch(K,d,n)};let b,o;for(b=0;b<=x;b++){const Z=b%x/x*2*D*Math.PI,h=F(Z),A=F(Z+.01),K=A.rh(h);let a=A.add(h);const k=v.Ch.Cross(K,a);for(a=v.Ch.Cross(k,K),k.normalize(),a.normalize(),o=0;o<N;o++){const Z=o%N/N*2*Math.PI,v=-n*Math.cos(Z),A=n*Math.sin(Z);V.push(h.x+v*a.x+A*k.x),V.push(h.y+v*a.y+A*k.y),V.push(h.z+v*a.z+A*k.z),H.push(b/x),H.push(d.b?1-o/N:o/N)}}for(b=0;b<x;b++)for(o=0;o<N;o++){const Z=(o+1)%N,V=b*N+o,v=(b+1)*N+o,A=(b+1)*N+Z,H=b*N+Z;h.push(H),h.push(v),h.push(V),h.push(H),h.push(A),h.push(v)}K.e.ComputeNormals(V,h,A),K.e._ComputeSides(u,V,h,A,H,Z.frontUVs,Z.backUVs);const q=new K.e;return q.indices=h,q.BZ=V,q.SZ=A,q.LZ=H,q}function B(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return l(h).WZ(v,h.updatable),v}K.e.CreateTorus=P,A.c.CreateTorus=(Z,h,V,v,A,H,K)=>C(Z,{diameter:h,thickness:V,tessellation:v,sideOrientation:K,updatable:H},A);K.e.CreateTorusKnot=l,A.c.CreateTorusKnot=(Z,h,V,v,A,H,K,d,a,n)=>B(Z,{radius:h,tube:V,radialSegments:v,tubularSegments:A,p:H,q:K,sideOrientation:n,updatable:a},d);var S=V(13645),r=V(12303),L=V(11954);function y(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=h.path,H=h.shape,K=h.scale||1,d=h.rotation||0,a=0===h.cap?0:h.cap||A.c.NO_CAP,n=h.updatable,x=A.c._GetDefaultSideOrientation(h.sideOrientation),N=h.instance||null,D=h.invertUV||!1,k=h.closeShape||!1,u=h.closePath||!1,F=h.capFunction||null;return z(Z,H,v,K,d,null,null,u,k,a,!1,V,!!n,x,N,D,h.frontUVs||null,h.backUVs||null,h.firstNormal||null,!!h.adjustFrame,F)}function W(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=h.path,H=h.shape,K=h.scaleFunction||(()=>1),d=h.rotationFunction||(()=>0),a=h.closePath||h.ribbonCloseArray||!1,n=h.closeShape||h.ribbonClosePath||!1,x=0===h.cap?0:h.cap||A.c.NO_CAP,N=h.updatable,D=h.firstNormal||null,k=h.adjustFrame||!1,u=A.c._GetDefaultSideOrientation(h.sideOrientation),F=h.instance,b=h.invertUV||!1,o=h.capFunction||null;return z(Z,H,v,null,null,K,d,a,n,x,!0,V,!!N,u,F||null,b,h.frontUVs||null,h.backUVs||null,D,k,o||null)}function z(Z,h,V,H,K,d,a,x,N,D,k,u,F,b,o,q,X,E,j,P,C){const l=(Z,h,V,H,K,d,a,n,x,N,D)=>{const k=V.getTangents(),u=V.getNormals(),F=V.getBinormals(),b=V.getDistances();if(D)for(let A=0;A<k.length;A++)if(0==k[A].x&&0==k[A].y&&0==k[A].z&&k[A].v(k[A-1]),0==u[A].x&&0==u[A].y&&0==u[A].z&&u[A].v(u[A-1]),0==F[A].x&&0==F[A].y&&0==F[A].z&&F[A].v(F[A-1]),A>0){let Z=k[A-1];v.Ch.Dot(Z,k[A])<0&&k[A].scaleInPlace(-1),Z=u[A-1],v.Ch.Dot(Z,u[A])<0&&u[A].scaleInPlace(-1),Z=F[A-1],v.Ch.Dot(Z,F[A])<0&&F[A].scaleInPlace(-1)}let o=0;const q=N&&n?n:()=>null!==d?d:0,X=N&&a?a:()=>null!==K?K:1;let E=x===A.c.NO_CAP||x===A.c.CAP_END?0:2;const j=v.TmpVectors.Matrix[0];for(let A=0;A<h.length;A++){const V=[],K=q(A,b[A]),d=X(A,b[A]);v.Matrix.RotationAxisToRef(k[A],o,j);for(let H=0;H<Z.length;H++){const K=k[A].scale(Z[H].z).add(u[A].scale(Z[H].x)).add(F[A].scale(Z[H].y)),a=v.Ch.Zero();v.Ch.TransformCoordinatesToRef(K,j,a),a.scaleInPlace(d).addInPlace(h[A]),V[H]=a}H[E]=V,o+=K,E++}const P=C||(Z=>{const h=Array(),V=v.Ch.Zero();let A;for(A=0;A<Z.length;A++)V.addInPlace(Z[A]);for(V.scaleInPlace(1/Z.length),A=0;A<Z.length;A++)h.push(V);return h});switch(x){case A.c.NO_CAP:break;case A.c.CAP_START:H[0]=P(H[2]),H[1]=H[2];break;case A.c.CAP_END:H[E]=H[E-1],H[E+1]=P(H[E-1]);break;case A.c.CAP_ALL:H[0]=P(H[2]),H[1]=H[2],H[E]=H[E-1],H[E+1]=P(H[E-1])}return H};let B,S;if(o){const Z=o._creationDataStorage;return B=j?Z.path3D.update(V,j):Z.path3D.update(V),S=l(h,V,Z.path3D,Z.pathArray,H,K,d,a,Z.cap,k,P),o=n("",{pathArray:S,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:o},u||void 0)}B=j?new L.l(V,j):new L.l(V);S=l(h,V,B,new Array,H,K,d,a,D=D<0||D>3?0:D,k,P);const r=n(Z,{pathArray:S,closeArray:x,closePath:N,updatable:F,sideOrientation:b,invertUV:q,frontUVs:X||void 0,backUVs:E||void 0},u);return r._creationDataStorage.pathArray=S,r._creationDataStorage.path3D=B,r._creationDataStorage.cap=D,r}function m(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.arc?h.arc<=0||h.arc>1?1:h.arc:1,K=void 0===h.closed||h.closed,d=h.shape,a=h.radius||1,x=h.tessellation||64,N=h.clip||0,D=h.updatable,k=A.c._GetDefaultSideOrientation(h.sideOrientation),u=h.cap||A.c.NO_CAP,F=2*Math.PI,b=[],o=h.invertUV||!1;let q=0,X=0;const E=F/x*H;let j,P;for(q=0;q<=x-N;q++){for(P=[],u!=A.c.CAP_START&&u!=A.c.CAP_ALL||(P.push(new v.Ch(0,d[0].y,0)),P.push(new v.Ch(Math.cos(q*E)*d[0].x*a,d[0].y,Math.sin(q*E)*d[0].x*a))),X=0;X<d.length;X++)j=new v.Ch(Math.cos(q*E)*d[X].x*a,d[X].y,Math.sin(q*E)*d[X].x*a),P.push(j);u!=A.c.CAP_END&&u!=A.c.CAP_ALL||(P.push(new v.Ch(Math.cos(q*E)*d[d.length-1].x*a,d[d.length-1].y,Math.sin(q*E)*d[d.length-1].x*a)),P.push(new v.Ch(0,d[d.length-1].y,0))),b.push(P)}return n(Z,{pathArray:b,closeArray:K,sideOrientation:k,updatable:D,invertUV:o,frontUVs:h.frontUVs,backUVs:h.backUVs},V)}A.c.ExtrudeShape=function(Z,h,V,v,H,K){let d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0,n=arguments.length>8?arguments[8]:void 0,x=arguments.length>9?arguments[9]:void 0;return y(Z,{shape:h,path:V,scale:v,rotation:H,cap:0===K?0:K||A.c.NO_CAP,sideOrientation:n,instance:x,updatable:a},d)},A.c.ExtrudeShapeCustom=(Z,h,V,v,H,K,d,a,n,x,N,D)=>W(Z,{shape:h,path:V,scaleFunction:v,rotationFunction:H,ribbonCloseArray:K,ribbonClosePath:d,cap:0===a?0:a||A.c.NO_CAP,sideOrientation:N,instance:D,updatable:x},n);A.c.CreateLathe=(Z,h,V,v,A,H,K)=>m(Z,{shape:h,radius:V,tessellation:v,sideOrientation:K,updatable:H},A);var g=V(13034),I=V(12980);function e(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.path;let K=h.instance,d=1;void 0!==h.radius?d=h.radius:K&&(d=K._creationDataStorage.radius);const a=h.tessellation||64,x=h.radiusFunction||null;let N=h.cap||A.c.NO_CAP;const D=h.invertUV||!1,k=h.updatable,u=A.c._GetDefaultSideOrientation(h.sideOrientation);h.arc=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1;const F=(Z,h,V,H,K,d,a,n)=>{const x=h.getTangents(),N=h.getNormals(),D=h.getDistances(),k=2*Math.PI/K*n,u=d||(()=>H);let F,b,o,q;const X=v.TmpVectors.Matrix[0];let E=a===A.c.NO_CAP||a===A.c.CAP_END?0:2;for(let A=0;A<Z.length;A++){b=u(A,D[A]),F=Array(),o=N[A];for(let h=0;h<K;h++)v.Matrix.RotationAxisToRef(x[A],k*h,X),q=F[h]?F[h]:v.Ch.Zero(),v.Ch.TransformCoordinatesToRef(o,X,q),q.scaleInPlace(b).addInPlace(Z[A]),F[h]=q;V[E]=F,E++}const j=(h,V)=>{const v=Array();for(let A=0;A<h;A++)v.push(Z[V]);return v};switch(a){case A.c.NO_CAP:break;case A.c.CAP_START:V[0]=j(K,0),V[1]=V[2].slice(0);break;case A.c.CAP_END:V[E]=V[E-1].slice(0),V[E+1]=j(K,Z.length-1);break;case A.c.CAP_ALL:V[0]=j(K,0),V[1]=V[2].slice(0),V[E]=V[E-1].slice(0),V[E+1]=j(K,Z.length-1)}return V};let b,o;if(K){const Z=K._creationDataStorage,V=h.arc||Z.arc;return b=Z.path3D.update(H),o=F(H,b,Z.pathArray,d,Z.tessellation,x,Z.cap,V),K=n("",{pathArray:o,instance:K}),Z.path3D=b,Z.pathArray=o,Z.arc=V,Z.radius=d,K}b=new L.l(H);N=N<0||N>3?0:N,o=F(H,b,new Array,d,a,x,N,h.arc);const q=n(Z,{pathArray:o,closePath:!0,closeArray:!1,updatable:k,sideOrientation:u,invertUV:D,frontUVs:h.frontUVs,backUVs:h.backUVs},V);return q._creationDataStorage.pathArray=o,q._creationDataStorage.path3D=b,q._creationDataStorage.tessellation=a,q._creationDataStorage.cap=N,q._creationDataStorage.arc=h.arc,q._creationDataStorage.radius=d,q}function U(Z){const h=[];h[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},h[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},h[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},h[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},h[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},h[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},h[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},h[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},h[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},h[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},h[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},h[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},h[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},h[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},h[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const V=Z.type&&(Z.type<0||Z.type>=h.length)?0:Z.type||0,A=Z.size,H=Z.sizeX||A||1,a=Z.sizeY||A||1,n=Z.sizeZ||A||1,x=Z.custom||h[V],N=x.face.length,k=Z.faceUV||new Array(N),u=Z.faceColors,F=void 0===Z.flat||Z.flat,b=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,o=[],q=[],X=[],E=[],j=[];let P=0,C=0;const l=[];let B,S,r,L,y,W,z=0,m=0;if(F)for(m=0;m<N;m++)u&&void 0===u[m]&&(u[m]=new D.nd(1,1,1,1)),k&&void 0===k[m]&&(k[m]=new v.Vector4(0,0,1,1));if(F)for(m=0;m<N;m++){const Z=x.face[m].length;for(r=2*Math.PI/Z,L=.5*Math.tan(r/2),y=.5,z=0;z<Z;z++)o.push(x.vertex[x.face[m][z]][0]*H,x.vertex[x.face[m][z]][1]*a,x.vertex[x.face[m][z]][2]*n),l.push(P),P++,B=k[m].x+(k[m].z-k[m].x)*(.5+L),S=k[m].y+(k[m].w-k[m].y)*(y-.5),E.push(B,d.b?1-S:S),W=L*Math.cos(r)-y*Math.sin(r),y=L*Math.sin(r)+y*Math.cos(r),L=W,u&&j.push(u[m].r,u[m].g,u[m].b,u[m].a);for(z=0;z<Z-2;z++)q.push(l[0+C],l[z+2+C],l[z+1+C]);C+=Z}else{for(z=0;z<x.vertex.length;z++)o.push(x.vertex[z][0]*H,x.vertex[z][1]*a,x.vertex[z][2]*n),E.push(0,d.b?1:0);for(m=0;m<N;m++)for(z=0;z<x.face[m].length-2;z++)q.push(x.face[m][0],x.face[m][z+2],x.face[m][z+1])}K.e.ComputeNormals(o,q,X),K.e._ComputeSides(b,o,q,X,E,Z.frontUVs,Z.backUVs);const g=new K.e;return g.BZ=o,g.indices=q,g.SZ=X,g.LZ=E,u&&F&&(g.rZ=j),g}function R(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return U(h).WZ(v,h.updatable),v}A.c.CreateTube=(Z,h,V,v,A,H,K,d,a,n)=>e(Z,{path:h,radius:V,tessellation:v,radiusFunction:A,arc:1,cap:H,updatable:d,sideOrientation:a,instance:n},K);function Q(Z){const h=Z.sideOrientation||K.e.DEFAULTSIDE,V=Z.radius||1,A=void 0===Z.flat||Z.flat,H=0|(Z.subdivisions||4),a=Z.radiusX||V,n=Z.radiusY||V,x=Z.radiusZ||V,N=(1+Math.sqrt(5))/2,D=[-1,N,-0,1,N,0,-1,-N,0,1,-N,0,0,-1,-N,0,1,-N,0,-1,N,0,1,N,N,0,1,N,0,-1,-N,0,1,-N,0,-1],k=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],F=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],b=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],o=[],q=[],X=[],E=[];let j=0;const P=new Array(3),C=new Array(3);let l;for(l=0;l<3;l++)P[l]=v.Ch.Zero(),C[l]=v.Vector2.Zero();for(let K=0;K<20;K++){for(l=0;l<3;l++){const Z=k[3*K+l];P[l].IV(D[3*u[Z]],D[3*u[Z]+1],D[3*u[Z]+2]),P[l].normalize(),C[l].IV(.134765625*F[2*Z]+.05859375+-.0390625*b[K],.2333984375*F[2*Z+1]+.025390625+.01953125*b[K])}const Z=(Z,h,V,K)=>{const N=v.Ch.Lerp(P[0],P[2],h/H),D=v.Ch.Lerp(P[1],P[2],h/H),k=H===h?P[2]:v.Ch.Lerp(N,D,Z/(H-h));let u;if(k.normalize(),A){const Z=v.Ch.Lerp(P[0],P[2],K/H),h=v.Ch.Lerp(P[1],P[2],K/H);u=v.Ch.Lerp(Z,h,V/(H-K))}else u=new v.Ch(k.x,k.y,k.z);u.x/=a,u.y/=n,u.z/=x,u.normalize();const F=v.Vector2.Lerp(C[0],C[2],h/H),b=v.Vector2.Lerp(C[1],C[2],h/H),l=H===h?C[2]:v.Vector2.Lerp(F,b,Z/(H-h));q.push(k.x*a,k.y*n,k.z*x),X.push(u.x,u.y,u.z),E.push(l.x,d.b?1-l.y:l.y),o.push(j),j++};for(let h=0;h<H;h++)for(let V=0;V+h<H;V++)Z(V,h,V+1/3,h+1/3),Z(V+1,h,V+1/3,h+1/3),Z(V,h+1,V+1/3,h+1/3),V+h+1<H&&(Z(V+1,h,V+2/3,h+2/3),Z(V+1,h+1,V+2/3,h+2/3),Z(V,h+1,V+2/3,h+2/3))}K.e._ComputeSides(h,q,o,X,E,Z.frontUVs,Z.backUVs);const B=new K.e;return B.indices=o,B.BZ=q,B.SZ=X,B.LZ=E,B}function w(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new A.c(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),v._originalBuilderSideOrientation=h.sideOrientation;return Q(h).WZ(v,h.updatable),v}K.e.CreatePolyhedron=U,A.c.CreatePolyhedron=(Z,h,V)=>R(Z,h,V);K.e.CreateIcoSphere=Q,A.c.CreateIcoSphere=(Z,h,V)=>w(Z,h,V);var T=V(11748);const t=new v.Ch(1,0,0),c=new v.Ch(-1,0,0),i=new v.Ch(0,1,0),M=new v.Ch(0,-1,0),O=new v.Ch(0,0,1),s=new v.Ch(0,0,-1);class J{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.Ch.Zero(),h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.Ch.Up(),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.Vector2.Zero(),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Z,this.normal=h,this.uv=V,this.vertexIdx=A,this.vertexIdxForBones=H,this.localPositionOverride=K,this.localNormalOverride=d,this.matrixIndicesOverride=a,this.matrixWeightsOverride=n}clone(){var Z,h,V,v;return new J(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Z=this.localPositionOverride)||void 0===Z?void 0:Z.slice(),null===(h=this.localNormalOverride)||void 0===h?void 0:h.slice(),null===(V=this.matrixIndicesOverride)||void 0===V?void 0:V.slice(),null===(v=this.matrixWeightsOverride)||void 0===v?void 0:v.slice())}}function f(Z,h,V){var a,n,x,N,D;const k=!!h.skeleton,u=!(null===(a=h.morphTargetManager)||void 0===a||!a.numTargets),F=V.localMode||k,b=h.fh(),o=k||u?h.Ud(!0,!0):h.getVerticesData(H.f.PositionKind),q=k||u?h.getNormalsData(!0,!0):h.getVerticesData(H.f.NormalKind),X=F?k?h.getVerticesData(H.f.PositionKind):o:null,E=F?k?h.getVerticesData(H.f.NormalKind):q:null,j=h.getVerticesData(H.f.UVKind),P=k?h.getVerticesData(H.f.MatricesIndicesKind):null,C=k?h.getVerticesData(H.f.MatricesWeightsKind):null,l=k?h.getVerticesData(H.f.MatricesIndicesExtraKind):null,B=k?h.getVerticesData(H.f.MatricesWeightsExtraKind):null,S=V.position||v.Ch.Zero();let r=V.normal||v.Ch.Up();const L=V.size||v.Ch.One(),y=V.angle||0;if(!r){const Z=new v.Ch(0,0,1),V=h.CZ().activeCamera,A=v.Ch.TransformCoordinates(Z,V.getWorldMatrix());r=V.globalPosition.rh(A)}const W=-Math.atan2(r.z,r.x)-Math.PI/2,z=Math.sqrt(r.x*r.x+r.z*r.z),m=Math.atan2(r.y,z),g=new K.e;g.indices=[],g.BZ=[],g.SZ=[],g.LZ=[],g.matricesIndices=k?[]:null,g.matricesWeights=k?[]:null,g.matricesIndicesExtra=l?[]:null,g.matricesWeightsExtra=B?[]:null;let I=0;const e=(Z,h)=>{const A=new J;if(!b||!o||!q)return A;const H=b[Z];if(A.vertexIdx=3*H,A.vertexIdxForBones=4*H,A.position=new v.Ch(o[3*H],o[3*H+1],o[3*H+2]),v.Ch.TransformCoordinatesToRef(A.position,h,A.position),A.normal=new v.Ch(q[3*H],q[3*H+1],q[3*H+2]),v.Ch.TransformNormalToRef(A.normal,h,A.normal),V.captureUVS&&j){const Z=j[2*H+1];A.uv=new v.Vector2(j[2*H],d.b?1-Z:Z)}return A},U=[0,0,0,0],R=(Z,h)=>{if(0===Z.length)return Z;const V=.5*Math.abs(v.Ch.Dot(L,h)),A=(Z,h,V,v)=>{for(let A=0;A<v;++A)if(Z[V+A]===h)return V+A;return-1},H=(Z,H)=>{const K=v.Ch.GetClipFactor(Z.position,H.position,h,V);let d=U,a=U;if(P&&C){const h=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,V=Z.matrixIndicesOverride??P,v=Z.matrixWeightsOverride??C,n=H.matrixIndicesOverride?0:H.vertexIdxForBones,x=H.matrixIndicesOverride??P,N=H.matrixWeightsOverride??C;d=[0,0,0,0],a=[0,0,0,0];let D=0;for(let Z=0;Z<4;++Z)if(v[h+Z]>0){const H=A(x,V[h+Z],n,4);d[D]=V[h+Z],a[D]=(0,T.Lerp)(v[h+Z],H>=0?N[H]:0,K),D++}for(let Z=0;Z<4&&D<4;++Z){const v=x[n+Z];-1===A(V,v,h,4)&&(d[D]=v,a[D]=(0,T.Lerp)(0,N[n+Z],K),D++)}const k=a[0]+a[1]+a[2]+a[3];a[0]/=k,a[1]/=k,a[2]/=k,a[3]/=k}const n=Z.localPositionOverride?Z.localPositionOverride[0]:(null===X||void 0===X?void 0:X[Z.vertexIdx])??0,x=Z.localPositionOverride?Z.localPositionOverride[1]:(null===X||void 0===X?void 0:X[Z.vertexIdx+1])??0,N=Z.localPositionOverride?Z.localPositionOverride[2]:(null===X||void 0===X?void 0:X[Z.vertexIdx+2])??0,D=H.localPositionOverride?H.localPositionOverride[0]:(null===X||void 0===X?void 0:X[H.vertexIdx])??0,k=H.localPositionOverride?H.localPositionOverride[1]:(null===X||void 0===X?void 0:X[H.vertexIdx+1])??0,u=H.localPositionOverride?H.localPositionOverride[2]:(null===X||void 0===X?void 0:X[H.vertexIdx+2])??0,F=Z.localNormalOverride?Z.localNormalOverride[0]:(null===E||void 0===E?void 0:E[Z.vertexIdx])??0,b=Z.localNormalOverride?Z.localNormalOverride[1]:(null===E||void 0===E?void 0:E[Z.vertexIdx+1])??0,o=Z.localNormalOverride?Z.localNormalOverride[2]:(null===E||void 0===E?void 0:E[Z.vertexIdx+2])??0,q=F+((H.localNormalOverride?H.localNormalOverride[0]:(null===E||void 0===E?void 0:E[H.vertexIdx])??0)-F)*K,j=b+((H.localNormalOverride?H.localNormalOverride[1]:(null===E||void 0===E?void 0:E[H.vertexIdx+1])??0)-b)*K,l=o+((H.localNormalOverride?H.localNormalOverride[2]:(null===E||void 0===E?void 0:E[H.vertexIdx+2])??0)-o)*K,B=Math.sqrt(q*q+j*j+l*l);return new J(v.Ch.Lerp(Z.position,H.position,K),v.Ch.Lerp(Z.normal,H.normal,K).normalize(),v.Vector2.Lerp(Z.uv,H.uv,K),-1,-1,X?[n+(D-n)*K,x+(k-x)*K,N+(u-N)*K]:null,E?[q/B,j/B,l/B]:null,d,a)};let K=null;Z.length>3&&(K=[]);for(let d=0;d<Z.length;d+=3){let A=0,a=null,n=null,x=null,N=null;const D=v.Ch.Dot(Z[d].position,h)-V>0,k=v.Ch.Dot(Z[d+1].position,h)-V>0,u=v.Ch.Dot(Z[d+2].position,h)-V>0;switch(A=(D?1:0)+(k?1:0)+(u?1:0),A){case 0:Z.length>3?(K.push(Z[d]),K.push(Z[d+1]),K.push(Z[d+2])):K=Z;break;case 1:if(K=K??new Array,D&&(a=Z[d+1],n=Z[d+2],x=H(Z[d],a),N=H(Z[d],n)),k){a=Z[d],n=Z[d+2],x=H(Z[d+1],a),N=H(Z[d+1],n),K.push(x),K.push(n.clone()),K.push(a.clone()),K.push(n.clone()),K.push(x.clone()),K.push(N);break}u&&(a=Z[d],n=Z[d+1],x=H(Z[d+2],a),N=H(Z[d+2],n)),a&&n&&x&&N&&(K.push(a.clone()),K.push(n.clone()),K.push(x),K.push(N),K.push(x.clone()),K.push(n.clone()));break;case 2:K=K??new Array,D||(a=Z[d].clone(),n=H(a,Z[d+1]),x=H(a,Z[d+2]),K.push(a),K.push(n),K.push(x)),k||(a=Z[d+1].clone(),n=H(a,Z[d+2]),x=H(a,Z[d]),K.push(a),K.push(n),K.push(x)),u||(a=Z[d+2].clone(),n=H(a,Z[d]),x=H(a,Z[d+1]),K.push(a),K.push(n),K.push(x))}}return K},Q=h instanceof A.c?h:null,w=null===Q||void 0===Q?void 0:Q._thinInstanceDataStorage.matrixData,f=(null===Q||void 0===Q?void 0:Q.kd)||1,p=v.TmpVectors.Matrix[0];p.v(v.Matrix.IdentityReadOnly);for(let A=0;A<f;++A){if(null!==Q&&void 0!==Q&&Q.hasThinInstances&&w){const Z=16*A;p.setRowFromFloats(0,w[Z+0],w[Z+1],w[Z+2],w[Z+3]),p.setRowFromFloats(1,w[Z+4],w[Z+5],w[Z+6],w[Z+7]),p.setRowFromFloats(2,w[Z+8],w[Z+9],w[Z+10],w[Z+11]),p.setRowFromFloats(3,w[Z+12],w[Z+13],w[Z+14],w[Z+15])}const Z=v.Matrix.RotationYawPitchRoll(W,m,y).multiply(v.Matrix.Translation(S.x,S.y,S.z)),H=v.Matrix.Invert(Z),K=h.getWorldMatrix(),a=p.multiply(K).multiply(H),n=new Array(3);for(let h=0;h<b.length;h+=3){let Z=n;if(Z[0]=e(h,a),Z[1]=e(h+1,a),Z[2]=e(h+2,a),!(V.cullBackFaces&&-Z[0].normal.z<=0&&-Z[1].normal.z<=0&&-Z[2].normal.z<=0)&&(Z=R(Z,t),Z&&(Z=R(Z,c),Z&&(Z=R(Z,i),Z&&(Z=R(Z,M),Z&&(Z=R(Z,O),Z&&(Z=R(Z,s),Z)))))))for(let h=0;h<Z.length;h++){const v=Z[h];if(g.indices.push(I),F?(v.localPositionOverride?(g.BZ[3*I]=v.localPositionOverride[0],g.BZ[3*I+1]=v.localPositionOverride[1],g.BZ[3*I+2]=v.localPositionOverride[2]):X&&(g.BZ[3*I]=X[v.vertexIdx],g.BZ[3*I+1]=X[v.vertexIdx+1],g.BZ[3*I+2]=X[v.vertexIdx+2]),v.localNormalOverride?(g.SZ[3*I]=v.localNormalOverride[0],g.SZ[3*I+1]=v.localNormalOverride[1],g.SZ[3*I+2]=v.localNormalOverride[2]):E&&(g.SZ[3*I]=E[v.vertexIdx],g.SZ[3*I+1]=E[v.vertexIdx+1],g.SZ[3*I+2]=E[v.vertexIdx+2])):(v.position.toArray(g.BZ,3*I),v.normal.toArray(g.SZ,3*I)),g.matricesIndices&&g.matricesWeights&&(v.matrixIndicesOverride?(g.matricesIndices[4*I]=v.matrixIndicesOverride[0],g.matricesIndices[4*I+1]=v.matrixIndicesOverride[1],g.matricesIndices[4*I+2]=v.matrixIndicesOverride[2],g.matricesIndices[4*I+3]=v.matrixIndicesOverride[3]):(P&&(g.matricesIndices[4*I]=P[v.vertexIdxForBones],g.matricesIndices[4*I+1]=P[v.vertexIdxForBones+1],g.matricesIndices[4*I+2]=P[v.vertexIdxForBones+2],g.matricesIndices[4*I+3]=P[v.vertexIdxForBones+3]),l&&g.matricesIndicesExtra&&(g.matricesIndicesExtra[4*I]=l[v.vertexIdxForBones],g.matricesIndicesExtra[4*I+1]=l[v.vertexIdxForBones+1],g.matricesIndicesExtra[4*I+2]=l[v.vertexIdxForBones+2],g.matricesIndicesExtra[4*I+3]=l[v.vertexIdxForBones+3])),v.matrixWeightsOverride?(g.matricesWeights[4*I]=v.matrixWeightsOverride[0],g.matricesWeights[4*I+1]=v.matrixWeightsOverride[1],g.matricesWeights[4*I+2]=v.matrixWeightsOverride[2],g.matricesWeights[4*I+3]=v.matrixWeightsOverride[3]):(C&&(g.matricesWeights[4*I]=C[v.vertexIdxForBones],g.matricesWeights[4*I+1]=C[v.vertexIdxForBones+1],g.matricesWeights[4*I+2]=C[v.vertexIdxForBones+2],g.matricesWeights[4*I+3]=C[v.vertexIdxForBones+3]),B&&g.matricesWeightsExtra&&(g.matricesWeightsExtra[4*I]=B[v.vertexIdxForBones],g.matricesWeightsExtra[4*I+1]=B[v.vertexIdxForBones+1],g.matricesWeightsExtra[4*I+2]=B[v.vertexIdxForBones+2],g.matricesWeightsExtra[4*I+3]=B[v.vertexIdxForBones+3]))),V.captureUVS)v.uv.toArray(g.LZ,2*I);else{g.LZ.push(.5+v.position.x/L.x);const Z=.5+v.position.y/L.y;g.LZ.push(d.b?1-Z:Z)}I++}}}0===g.indices.length&&(g.indices=null),0===g.BZ.length&&(g.BZ=null),0===g.SZ.length&&(g.SZ=null),0===g.LZ.length&&(g.LZ=null),0===(null===(n=g.matricesIndices)||void 0===n?void 0:n.length)&&(g.matricesIndices=null),0===(null===(x=g.matricesWeights)||void 0===x?void 0:x.length)&&(g.matricesWeights=null),0===(null===(N=g.matricesIndicesExtra)||void 0===N?void 0:N.length)&&(g.matricesIndicesExtra=null),0===(null===(D=g.matricesWeightsExtra)||void 0===D?void 0:D.length)&&(g.matricesWeightsExtra=null);const Y=new A.c(Z,h.CZ());return g.WZ(Y),F?(Y.skeleton=h.skeleton,Y.parent=h):(Y.position=S.clone(),Y.rotation=new v.Ch(m,W,y)),Y.sh(!0),Y.refreshBoundingInfo(!0,!0),Y}function p(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const h=0|Math.max(Z.subdivisions?Z.subdivisions:2,1),V=0|Math.max(Z.tessellation?Z.tessellation:16,3),A=Math.max(Z.height?Z.height:1,0),H=Math.max(Z.radius?Z.radius:.25,0),a=0|Math.max(Z.capSubdivisions?Z.capSubdivisions:6,1),n=V,x=h,N=Math.max(Z.radiusTop?Z.radiusTop:H,0),D=Math.max(Z.radiusBottom?Z.radiusBottom:H,0),k=A-(N+D),u=2*Math.PI,F=Math.max(Z.topCapSubdivisions?Z.topCapSubdivisions:a,1),b=Math.max(Z.bottomCapSubdivisions?Z.bottomCapSubdivisions:a,1),o=Math.acos((D-N)/A);let q=[];const X=[],E=[],j=[];let P=0;const C=[],l=.5*k,B=.5*Math.PI;let S,r;const L=v.Ch.Zero(),y=v.Ch.Zero(),W=Math.cos(o),z=Math.sin(o),m=new v.Vector2(N*z,l+N*W).rh(new v.Vector2(D*z,D*W-l)).length(),g=N*o+m+D*(B-o);let I=0;for(r=0;r<=F;r++){const Z=[],h=B-o*(r/F);I+=N*o/F;const V=Math.cos(h),v=Math.sin(h),A=V*N;for(S=0;S<=n;S++){const h=S/n,H=h*u+0,K=Math.sin(H),a=Math.cos(H);y.x=A*K,y.y=l+v*N,y.z=A*a,X.push(y.x,y.y,y.z),L.set(V*K,v,V*a),E.push(L.x,L.y,L.z),j.push(h,d.b?I/g:1-I/g),Z.push(P),P++}C.push(Z)}const e=A-N-D+W*N-W*D,U=z*(D-N)/e;for(r=1;r<=x;r++){const Z=[];I+=m/x;const h=z*(r*(D-N)/x+N);for(S=0;S<=n;S++){const V=S/n,v=V*u+0,A=Math.sin(v),H=Math.cos(v);y.x=h*A,y.y=l+W*N-r*e/x,y.z=h*H,X.push(y.x,y.y,y.z),L.set(A,U,H).normalize(),E.push(L.x,L.y,L.z),j.push(V,d.b?I/g:1-I/g),Z.push(P),P++}C.push(Z)}for(r=1;r<=b;r++){const Z=[],h=B-o-(Math.PI-o)*(r/b);I+=D*o/b;const V=Math.cos(h),v=Math.sin(h),A=V*D;for(S=0;S<=n;S++){const h=S/n,H=h*u+0,K=Math.sin(H),a=Math.cos(H);y.x=A*K,y.y=v*D-l,y.z=A*a,X.push(y.x,y.y,y.z),L.set(V*K,v,V*a),E.push(L.x,L.y,L.z),j.push(h,d.b?I/g:1-I/g),Z.push(P),P++}C.push(Z)}for(S=0;S<n;S++)for(r=0;r<F+x+b;r++){const Z=C[r][S],h=C[r+1][S],V=C[r+1][S+1],v=C[r][S+1];q.push(Z),q.push(h),q.push(v),q.push(h),q.push(V),q.push(v)}if(q=q.reverse(),Z.orientation&&!Z.orientation.equals(v.Ch.Up())){const h=new v.Matrix;Z.orientation.clone().scale(.5*Math.PI).cross(v.Ch.Up()).toQuaternion().toRotationMatrix(h);const V=v.Ch.Zero();for(let Z=0;Z<X.length;Z+=3)V.set(X[Z],X[Z+1],X[Z+2]),v.Ch.TransformCoordinatesToRef(V.clone(),h,V),X[Z]=V.x,X[Z+1]=V.y,X[Z+2]=V.z}const R=new K.e;return R.BZ=X,R.SZ=E,R.LZ=j,R.indices=q,R}function Y(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:v.Ch.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new A.c(Z,V);return p(h).WZ(H,h.updatable),H}A.c.CreateDecal=(Z,h,V,v,A,H)=>f(Z,h,{position:V,normal:v,size:A,angle:H});A.c.CreateCapsule=(Z,h,V)=>Y(Z,h,V),K.e.CreateCapsule=p;var G=V(11580),ZZ=V(11737);class hZ{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Z,this.y=h,Z!==Math.floor(Z)&&(Z=Math.floor(Z),G.b.Warn("x is not an integer, floor(x) used")),h!==Math.floor(h)&&(h=Math.floor(h),G.b.Warn("y is not an integer, floor(y) used"))}clone(){return new hZ(this.x,this.y)}rotate60About(Z){const h=this.x;return this.x=Z.x+Z.y-this.y,this.y=h+this.y-Z.x,this}rotateNeg60About(Z){const h=this.x;return this.x=h+this.y-Z.y,this.y=Z.x+Z.y-h,this}rotate120(Z,h){Z!==Math.floor(Z)&&(Z=Math.floor(Z),G.b.Warn("m not an integer only floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),G.b.Warn("n not an integer only floor(n) used"));const V=this.x;return this.x=Z-V-this.y,this.y=h+V,this}rotateNeg120(Z,h){Z!==Math.floor(Z)&&(Z=Math.floor(Z),G.b.Warn("m is not an integer, floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),G.b.Warn("n is not an integer,   floor(n) used"));const V=this.x;return this.x=this.y-h,this.y=Z+h-V-this.y,this}toCartesianOrigin(Z,h){const V=v.Ch.Zero();return V.x=Z.x+2*this.x*h+this.y*h,V.y=Z.y+Math.sqrt(3)*this.y*h,V}static Zero(){return new hZ(0,0)}}class VZ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new vZ("icosahedron","Regular",[[0,ZZ.f,-1],[-ZZ.f,1,0],[-1,0,-ZZ.f],[1,0,-ZZ.f],[ZZ.f,1,0],[0,ZZ.f,1],[-1,0,ZZ.f],[-ZZ.f,-1,0],[0,-ZZ.f,-1],[ZZ.f,-1,0],[1,0,ZZ.f],[0,-ZZ.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Z=12;const h={},V=this.m,v=this.n;let A,H,K,d,a,n=V,x=1,N=0;0!==v&&(n=(0,T.HighestCommonFactor)(V,v)),x=V/n,N=v/n;const D=hZ.Zero(),k=new hZ(V,v),u=new hZ(-v,V+v),F=hZ.Zero(),b=hZ.Zero(),o=hZ.Zero();let q,X,E,j,P=[];const C=[],l=this.vertByDist,B=(V,v,A,H)=>{q=V+"|"+A,X=v+"|"+H,q in h||X in h?q in h&&!(X in h)?h[X]=h[q]:X in h&&!(q in h)&&(h[q]=h[X]):(h[q]=Z,h[X]=Z,Z++),l[A][0]>2?C[h[q]]=[-l[A][0],l[A][1],h[q]]:C[h[q]]=[P[l[A][0]],l[A][1],h[q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let S=0;S<20;S++){if(P=this.IDATA.face[S],K=P[2],d=P[1],a=P[0],E=D.x+"|"+D.y,q=S+"|"+E,q in h||(h[q]=K,C[K]=[P[l[E][0]],l[E][1]]),E=k.x+"|"+k.y,q=S+"|"+E,q in h||(h[q]=d,C[d]=[P[l[E][0]],l[E][1]]),E=u.x+"|"+u.y,q=S+"|"+E,q in h||(h[q]=a,C[a]=[P[l[E][0]],l[E][1]]),A=this.IDATA.edgematch[S][0],H=this.IDATA.edgematch[S][1],"B"===H)for(let Z=1;Z<n;Z++)b.x=V-Z*(x+N),b.y=v+Z*x,o.x=-Z*N,o.y=Z*(x+N),E=b.x+"|"+b.y,j=o.x+"|"+o.y,B(S,A,E,j);if("O"===H)for(let Z=1;Z<n;Z++)o.x=-Z*N,o.y=Z*(x+N),F.x=Z*x,F.y=Z*N,E=o.x+"|"+o.y,j=F.x+"|"+F.y,B(S,A,E,j);if(A=this.IDATA.edgematch[S][2],H=this.IDATA.edgematch[S][3],H&&"A"===H)for(let Z=1;Z<n;Z++)F.x=Z*x,F.y=Z*N,b.x=V-(n-Z)*(x+N),b.y=v+(n-Z)*x,E=F.x+"|"+F.y,j=b.x+"|"+b.y,B(S,A,E,j);for(let V=0;V<this.vertices.length;V++)E=this.vertices[V].x+"|"+this.vertices[V].y,q=S+"|"+E,q in h||(h[q]=Z++,l[E][0]>2?C[h[q]]=[-l[E][0],l[E][1],h[q]]:C[h[q]]=[P[l[E][0]],l[E][1],h[q]])}this.closestTo=C,this.vecToidx=h}calcCoeffs(){const Z=this.m,h=this.n,V=Math.sqrt(3)/3,v=Z*Z+h*h+Z*h;this.coau=(Z+h)/v,this.cobu=-h/v,this.coav=-V*(Z-h)/v,this.cobv=V*(2*Z+h)/v}createInnerFacets(){const Z=this.m,h=this.n;for(let V=0;V<h+Z+1;V++)for(let Z=this.min[V];Z<this.max[V]+1;Z++)Z<this.max[V]&&Z<this.max[V+1]+1&&this.innerFacets.push(["|"+Z+"|"+V,"|"+Z+"|"+(V+1),"|"+(Z+1)+"|"+V]),V>0&&Z<this.max[V-1]&&Z+1<this.max[V]+1&&this.innerFacets.push(["|"+Z+"|"+V,"|"+(Z+1)+"|"+V,"|"+(Z+1)+"|"+(V-1)])}edgeVecsABOB(){const Z=this.m,h=this.n,V=new hZ(-h,Z+h);for(let v=1;v<Z+h;v++){const Z=new hZ(this.min[v],v),h=new hZ(this.min[v-1],v-1),A=new hZ(this.min[v+1],v+1),H=Z.clone(),K=h.clone(),d=A.clone();H.rotate60About(V),K.rotate60About(V),d.rotate60About(V);const a=new hZ(this.max[H.y],H.y),n=new hZ(this.max[H.y-1],H.y-1),x=new hZ(this.max[H.y-1]-1,H.y-1);H.x===a.x&&H.y===a.y||(H.x!==n.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,n,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,x,a])):H.y===d.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,h,n]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Z,n,A])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,h,n]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,n,a])))}}mapABOBtoOBOA(){const Z=new hZ(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const V=[];for(let v=0;v<3;v++)Z.x=this.isoVecsABOB[h][v].x,Z.y=this.isoVecsABOB[h][v].y,0===this.vertexTypes[h][v]&&Z.rotateNeg120(this.m,this.n),V.push(Z.clone());this.isoVecsOBOA.push(V)}}mapABOBtoBAOA(){const Z=new hZ(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const V=[];for(let v=0;v<3;v++)Z.x=this.isoVecsABOB[h][v].x,Z.y=this.isoVecsABOB[h][v].y,1===this.vertexTypes[h][v]&&Z.rotate120(this.m,this.n),V.push(Z.clone());this.isoVecsBAOA.push(V)}}MapToFace(Z,h){const V=this.IDATA.face[Z],A=V[2],H=V[1],K=V[0],d=v.Ch.eh(this.IDATA.vertex[A]),a=v.Ch.eh(this.IDATA.vertex[H]),n=v.Ch.eh(this.IDATA.vertex[K]),x=a.rh(d),N=n.rh(d),D=x.scale(this.coau).add(N.scale(this.cobu)),k=x.scale(this.coav).add(N.scale(this.cobv)),u=[];let F,b=v.TmpVectors.Ch[0];for(let v=0;v<this.cartesian.length;v++)b=D.scale(this.cartesian[v].x).add(k.scale(this.cartesian[v].y)).add(d),u[v]=[b.x,b.y,b.z],F=Z+"|"+this.vertices[v].x+"|"+this.vertices[v].y,h.vertex[this.vecToidx[F]]=[b.x,b.y,b.z]}build(Z,h){const V=[],v=hZ.Zero(),A=new hZ(Z,h),H=new hZ(-h,Z+h);V.push(v,A,H);for(let E=h;E<Z+1;E++)for(let h=0;h<Z+1-E;h++)V.push(new hZ(h,E));if(h>0){const v=(0,T.HighestCommonFactor)(Z,h),A=Z/v,H=h/v;for(let d=1;d<v;d++)V.push(new hZ(d*A,d*H)),V.push(new hZ(-d*H,d*(A+H))),V.push(new hZ(Z-d*(A+H),h+d*A));const K=Z/h;for(let d=1;d<h;d++)for(let v=0;v<d*K;v++)V.push(new hZ(v,d)),V.push(new hZ(v,d).rotate120(Z,h)),V.push(new hZ(v,d).rotateNeg120(Z,h))}V.sort(((Z,h)=>Z.x-h.x)),V.sort(((Z,h)=>Z.y-h.y));const K=new Array(Z+h+1),d=new Array(Z+h+1);for(let E=0;E<K.length;E++)K[E]=1/0,d[E]=-1/0;let a=0,n=0;const x=V.length;for(let E=0;E<x;E++)n=V[E].x,a=V[E].y,K[a]=Math.min(n,K[a]),d[a]=Math.max(n,d[a]);const N=(V,v)=>{const A=V.clone();return"A"===v&&A.rotateNeg120(Z,h),"B"===v&&A.rotate120(Z,h),A.x<0?A.y:A.x+A.y},D=[],k=[],u=[],F=[],b={},o=[];let q=-1,X=-1;for(let E=0;E<x;E++)D[E]=V[E].toCartesianOrigin(new hZ(0,0),.5),k[E]=N(V[E],"O"),u[E]=N(V[E],"A"),F[E]=N(V[E],"B"),k[E]===u[E]&&u[E]===F[E]?(q=3,X=k[E]):k[E]===u[E]?(q=4,X=k[E]):u[E]===F[E]?(q=5,X=u[E]):F[E]===k[E]&&(q=6,X=k[E]),k[E]<u[E]&&k[E]<F[E]&&(q=2,X=k[E]),u[E]<k[E]&&u[E]<F[E]&&(q=1,X=u[E]),F[E]<u[E]&&F[E]<k[E]&&(q=0,X=F[E]),o.push([q,X,V[E].x,V[E].y]);o.sort(((Z,h)=>Z[2]-h[2])),o.sort(((Z,h)=>Z[3]-h[3])),o.sort(((Z,h)=>Z[1]-h[1])),o.sort(((Z,h)=>Z[0]-h[0]));for(let E=0;E<o.length;E++)b[o[E][2]+"|"+o[E][3]]=[o[E][0],o[E][1],E];return this.m=Z,this.n=h,this.vertices=V,this.vertByDist=b,this.cartesian=D,this.min=K,this.max=d,this}}class vZ{constructor(Z,h,V,v){this.name=Z,this.category=h,this.vertex=V,this.face=v}}class AZ extends vZ{innerToData(Z,h){for(let V=0;V<h.innerFacets.length;V++)this.face.push(h.innerFacets[V].map((V=>h.vecToidx[Z+V])))}mapABOBtoDATA(Z,h){const V=h.IDATA.edgematch[Z][0];for(let v=0;v<h.isoVecsABOB.length;v++){const A=[];for(let H=0;H<3;H++)0===h.vertexTypes[v][H]?A.push(Z+"|"+h.isoVecsABOB[v][H].x+"|"+h.isoVecsABOB[v][H].y):A.push(V+"|"+h.isoVecsABOB[v][H].x+"|"+h.isoVecsABOB[v][H].y);this.face.push([h.vecToidx[A[0]],h.vecToidx[A[1]],h.vecToidx[A[2]]])}}mapOBOAtoDATA(Z,h){const V=h.IDATA.edgematch[Z][0];for(let v=0;v<h.isoVecsOBOA.length;v++){const A=[];for(let H=0;H<3;H++)1===h.vertexTypes[v][H]?A.push(Z+"|"+h.isoVecsOBOA[v][H].x+"|"+h.isoVecsOBOA[v][H].y):A.push(V+"|"+h.isoVecsOBOA[v][H].x+"|"+h.isoVecsOBOA[v][H].y);this.face.push([h.vecToidx[A[0]],h.vecToidx[A[1]],h.vecToidx[A[2]]])}}mapBAOAtoDATA(Z,h){const V=h.IDATA.edgematch[Z][2];for(let v=0;v<h.isoVecsBAOA.length;v++){const A=[];for(let H=0;H<3;H++)1===h.vertexTypes[v][H]?A.push(Z+"|"+h.isoVecsBAOA[v][H].x+"|"+h.isoVecsBAOA[v][H].y):A.push(V+"|"+h.isoVecsBAOA[v][H].x+"|"+h.isoVecsBAOA[v][H].y);this.face.push([h.vecToidx[A[0]],h.vecToidx[A[1]],h.vecToidx[A[2]]])}}orderData(Z){const h=[];for(let H=0;H<13;H++)h[H]=[];const V=Z.closestTo;for(let H=0;H<V.length;H++)V[H][0]>-1?V[H][1]>0&&h[V[H][0]].push([H,V[H][1]]):h[12].push([H,V[H][0]]);const v=[];for(let H=0;H<12;H++)v[H]=H;let A=12;for(let H=0;H<12;H++){h[H].sort(((Z,h)=>Z[1]-h[1]));for(let Z=0;Z<h[H].length;Z++)v[h[H][Z][0]]=A++}for(let H=0;H<h[12].length;H++)v[h[12][H][0]]=A++;for(let H=0;H<this.vertex.length;H++)this.vertex[H].push(v[H]);this.vertex.sort(((Z,h)=>Z[3]-h[3]));for(let H=0;H<this.vertex.length;H++)this.vertex[H].pop();for(let H=0;H<this.face.length;H++)for(let Z=0;Z<this.face[H].length;Z++)this.face[H][Z]=v[this.face[H][Z]];this.sharedNodes=h[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Z,h){const V=[],v=[];let A=h.pop();v.push(A);let H=this.face[A].indexOf(Z);H=(H+2)%3;let K=this.face[A][H];V.push(K);let d=0;for(;h.length>0;)A=h[d],this.face[A].indexOf(K)>-1?(H=(this.face[A].indexOf(K)+1)%3,K=this.face[A][H],V.push(K),v.push(A),h.splice(d,1),d=0):d++;return this.adjacentFaces.push(V),v}toGoldbergPolyhedronData(){const Z=new vZ("GeoDual","Goldberg",[],[]);Z.name="GD dual";const h=this.vertex.length,V=new Array(h);for(let a=0;a<h;a++)V[a]=[];for(let a=0;a<this.face.length;a++)for(let Z=0;Z<3;Z++)V[this.face[a][Z]].push(a);let v=0,A=0,H=0,K=[],d=[];this.adjacentFaces=[];for(let a=0;a<V.length;a++){Z.face[a]=this.setOrder(a,V[a].concat([]));for(const h of V[a]){v=0,A=0,H=0,K=this.face[h];for(let Z=0;Z<3;Z++)d=this.vertex[K[Z]],v+=d[0],A+=d[1],H+=d[2];Z.vertex[h]=[v/3,A/3,H/3]}}return Z}static BuildGeodesicData(Z){const h=new AZ("Geodesic-m-n","Geodesic",[[0,ZZ.f,-1],[-ZZ.f,1,0],[-1,0,-ZZ.f],[1,0,-ZZ.f],[ZZ.f,1,0],[0,ZZ.f,1],[-1,0,ZZ.f],[-ZZ.f,-1,0],[0,-ZZ.f,-1],[ZZ.f,-1,0],[1,0,ZZ.f],[0,-ZZ.f,1]],[]);Z.setIndices(),Z.calcCoeffs(),Z.createInnerFacets(),Z.edgeVecsABOB(),Z.mapABOBtoOBOA(),Z.mapABOBtoBAOA();for(let V=0;V<Z.IDATA.face.length;V++)Z.MapToFace(V,h),h.innerToData(V,Z),"B"===Z.IDATA.edgematch[V][1]&&h.mapABOBtoDATA(V,Z),"O"===Z.IDATA.edgematch[V][1]&&h.mapOBOAtoDATA(V,Z),"A"===Z.IDATA.edgematch[V][3]&&h.mapBAOAtoDATA(V,Z);h.orderData(Z);return h.vertex=h.vertex.map((function(Z){const h=Z[0],V=Z[1],v=Z[2],A=Math.sqrt(h*h+V*V+v*v);return Z[0]*=1/A,Z[1]*=1/A,Z[2]*=1/A,Z})),h}}A.c._GoldbergMeshParser=(Z,h)=>HZ.Parse(Z,h);class HZ extends A.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Z,h){return void 0===h?(Z>this.goldbergData.nbUnsharedFaces-1&&(G.b.Warn("Maximum number of unshared faces used"),Z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Z):(Z>11&&(G.b.Warn("Last pole used"),Z=11),h>this.goldbergData.nbFacesAtPole-1&&(G.b.Warn("Maximum number of faces at a pole used"),h=this.goldbergData.nbFacesAtPole-1),12+Z*this.goldbergData.nbFacesAtPole+h)}_changeGoldbergFaceColors(Z){for(let V=0;V<Z.length;V++){const h=Z[V][0],v=Z[V][1],A=Z[V][2];for(let Z=h;Z<v+1;Z++)this.goldbergData.faceColors[Z]=A}const h=[];for(let V=0;V<12;V++)for(let Z=0;Z<5;Z++)h.push(this.goldbergData.faceColors[V].r,this.goldbergData.faceColors[V].g,this.goldbergData.faceColors[V].b,this.goldbergData.faceColors[V].a);for(let V=12;V<this.goldbergData.faceColors.length;V++)for(let Z=0;Z<6;Z++)h.push(this.goldbergData.faceColors[V].r,this.goldbergData.faceColors[V].g,this.goldbergData.faceColors[V].b,this.goldbergData.faceColors[V].a);return h}setGoldbergFaceColors(Z){const h=this._changeGoldbergFaceColors(Z);this.IZ(H.f.ColorKind,h)}updateGoldbergFaceColors(Z){const h=this._changeGoldbergFaceColors(Z);this.updateVerticesData(H.f.ColorKind,h)}_changeGoldbergFaceUVs(Z){const h=this.getVerticesData(H.f.UVKind);for(let V=0;V<Z.length;V++){const v=Z[V][0],A=Z[V][1],H=Z[V][2],K=Z[V][3],d=Z[V][4],a=[],n=[];let x,N;for(let Z=0;Z<5;Z++)x=H.x+K*Math.cos(d+Z*Math.PI/2.5),N=H.y+K*Math.sin(d+Z*Math.PI/2.5),x<0&&(x=0),x>1&&(x=1),a.push(x,N);for(let Z=0;Z<6;Z++)x=H.x+K*Math.cos(d+Z*Math.PI/3),N=H.y+K*Math.sin(d+Z*Math.PI/3),x<0&&(x=0),x>1&&(x=1),n.push(x,N);for(let Z=v;Z<Math.min(12,A+1);Z++)for(let V=0;V<5;V++)h[10*Z+2*V]=a[2*V],h[10*Z+2*V+1]=a[2*V+1];for(let Z=Math.max(12,v);Z<A+1;Z++)for(let V=0;V<6;V++)h[12*Z-24+2*V]=n[2*V],h[12*Z-23+2*V]=n[2*V+1]}return h}setGoldbergFaceUVs(Z){const h=this._changeGoldbergFaceUVs(Z);this.IZ(H.f.UVKind,h)}updateGoldbergFaceUVs(Z){const h=this._changeGoldbergFaceUVs(Z);this.updateVerticesData(H.f.UVKind,h)}placeOnGoldbergFaceAt(Z,h,V){const A=v.Ch.RotationFromAxis(this.goldbergData.faceXaxis[h],this.goldbergData.faceYaxis[h],this.goldbergData.faceZaxis[h]);Z.rotation=A,Z.position=this.goldbergData.faceCenters[h].add(this.goldbergData.faceXaxis[h].scale(V.x)).add(this.goldbergData.faceYaxis[h].scale(V.y)).add(this.goldbergData.faceZaxis[h].scale(V.z))}serialize(Z){super.serialize(Z),Z.type="GoldbergMesh";const h={};if(h.adjacentFaces=this.goldbergData.adjacentFaces,h.nbSharedFaces=this.goldbergData.nbSharedFaces,h.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,h.nbFaces=this.goldbergData.nbFaces,h.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){h.faceColors=[];for(const Z of this.goldbergData.faceColors)h.faceColors.push(Z.mh())}if(this.goldbergData.faceCenters){h.faceCenters=[];for(const Z of this.goldbergData.faceCenters)h.faceCenters.push(Z.mh())}if(this.goldbergData.faceZaxis){h.faceZaxis=[];for(const Z of this.goldbergData.faceZaxis)h.faceZaxis.push(Z.mh())}if(this.goldbergData.faceYaxis){h.faceYaxis=[];for(const Z of this.goldbergData.faceYaxis)h.faceYaxis.push(Z.mh())}if(this.goldbergData.faceXaxis){h.faceXaxis=[];for(const Z of this.goldbergData.faceXaxis)h.faceXaxis.push(Z.mh())}Z.goldbergData=h}static Parse(Z,h){const V=Z.goldbergData;V.faceColors=V.faceColors.map((Z=>D.nd.eh(Z))),V.faceCenters=V.faceCenters.map((Z=>v.Ch.eh(Z))),V.faceZaxis=V.faceZaxis.map((Z=>v.Ch.eh(Z))),V.faceXaxis=V.faceXaxis.map((Z=>v.Ch.eh(Z))),V.faceYaxis=V.faceYaxis.map((Z=>v.Ch.eh(Z)));const A=new HZ(Z.name,h);return A.goldbergData=V,A}}var KZ=V(12295);const dZ={CreateBox:N.c,CreateTiledBox:b,CreateSphere:o.d,CreateDisc:x.b,CreateIcoSphere:w,CreateRibbon:n,CreateCylinder:j,CreateTorus:C,CreateTorusKnot:B,CreateLineSystem:S.h,yn:S.l,CreateDashedLines:S.d,ExtrudeShape:y,ExtrudeShapeCustom:W,CreateLathe:m,CreateTiledPlane:u,mn:g.b,CreateGround:I.f,CreateTiledGround:I.j,CreateGroundFromHeightMap:I.d,CreatePolygon:r.e,ExtrudePolygon:r.g,CreateTube:e,CreatePolyhedron:R,CreateGeodesic:function(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=h.m||1;v!==Math.floor(v)&&(v=Math.floor(v),G.b.Warn("m not an integer only floor(m) used"));let A=h.n||0;if(A!==Math.floor(A)&&(A=Math.floor(A),G.b.Warn("n not an integer only floor(n) used")),A>v){const Z=A;A=v,v=Z,G.b.Warn("n > m therefore m and n swapped")}const H=new VZ;return H.build(v,A),R(Z,{custom:AZ.BuildGeodesicData(H),size:h.size,sizeX:h.sizeX,sizeY:h.sizeY,sizeZ:h.sizeZ,faceUV:h.faceUV,faceColors:h.faceColors,flat:h.flat,updatable:h.updatable,sideOrientation:h.sideOrientation,frontUVs:h.frontUVs,backUVs:h.backUVs},V)},CreateGoldberg:function(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.size,a=h.sizeX||H||1,n=h.sizeY||H||1,x=h.sizeZ||H||1;let N=h.m||1;N!==Math.floor(N)&&(N=Math.floor(N),G.b.Warn("m not an integer only floor(m) used"));let k=h.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),G.b.Warn("n not an integer only floor(n) used")),k>N){const Z=k;k=N,N=Z,G.b.Warn("n > m therefore m and n swapped")}const u=new VZ;u.build(N,k);const F=AZ.BuildGeodesicData(u),b=F.toGoldbergPolyhedronData(),o=new HZ(Z,V);h.sideOrientation=A.c._GetDefaultSideOrientation(h.sideOrientation),o._originalBuilderSideOrientation=h.sideOrientation;(function(Z,h){const V=Z.size,A=Z.sizeX||V||1,H=Z.sizeY||V||1,a=Z.sizeZ||V||1,n=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,x=[],N=[],D=[],k=[];let u=1/0,F=-1/0,b=1/0,o=-1/0;for(let v=0;v<h.vertex.length;v++)u=Math.min(u,h.vertex[v][0]*A),F=Math.max(F,h.vertex[v][0]*A),b=Math.min(b,h.vertex[v][1]*H),o=Math.max(o,h.vertex[v][1]*H);let q=0;for(let K=0;K<h.face.length;K++){const Z=h.face[K],V=v.Ch.eh(h.vertex[Z[0]]),n=v.Ch.eh(h.vertex[Z[2]]),X=v.Ch.eh(h.vertex[Z[1]]),E=n.rh(V),j=X.rh(V),P=v.Ch.Cross(j,E).normalize();for(let v=0;v<Z.length;v++){D.push(P.x,P.y,P.z);const V=h.vertex[Z[v]];x.push(V[0]*A,V[1]*H,V[2]*a);const K=(V[1]*H-b)/(o-b);k.push((V[0]*A-u)/(F-u),d.b?1-K:K)}for(let h=0;h<Z.length-2;h++)N.push(q,q+h+2,q+h+1);q+=Z.length}K.e._ComputeSides(n,x,N,D,k);const X=new K.e;return X.BZ=x,X.indices=N,X.SZ=D,X.LZ=k,X})(h,b).WZ(o,h.updatable),o.goldbergData.nbSharedFaces=F.sharedNodes,o.goldbergData.nbUnsharedFaces=F.poleNodes,o.goldbergData.adjacentFaces=F.adjacentFaces,o.goldbergData.nbFaces=o.goldbergData.nbSharedFaces+o.goldbergData.nbUnsharedFaces,o.goldbergData.nbFacesAtPole=(o.goldbergData.nbUnsharedFaces-12)/12;for(let A=0;A<F.vertex.length;A++)o.goldbergData.faceCenters.push(v.Ch.eh(F.vertex[A])),o.goldbergData.faceCenters[A].x*=a,o.goldbergData.faceCenters[A].y*=n,o.goldbergData.faceCenters[A].z*=x,o.goldbergData.faceColors.push(new D.nd(1,1,1,1));for(let A=0;A<b.face.length;A++){const Z=b.face[A],h=v.Ch.eh(b.vertex[Z[0]]),V=v.Ch.eh(b.vertex[Z[2]]),H=v.Ch.eh(b.vertex[Z[1]]),K=V.rh(h),d=H.rh(h),a=v.Ch.Cross(d,K).normalize(),n=v.Ch.Cross(d,a).normalize();o.goldbergData.faceXaxis.push(d.normalize()),o.goldbergData.faceYaxis.push(a),o.goldbergData.faceZaxis.push(n)}return o},CreateDecal:f,CreateCapsule:Y,CreateText:KZ.g}},13058:(Z,h,V)=>{"use strict";V.d(h,{d:()=>dh});var v=V(11729),A=V(12115);class H extends A.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var K=V(11781),d=(V(11907),V(11691));class a{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this._targetStopDuration!==Z&&(this._targetStopDuration=Z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){this._noiseTexture!==Z&&(this._noiseTexture=Z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Z){this._isAnimationSheetEnabled!=Z&&(this._isAnimationSheetEnabled=Z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Z){this._useLogarithmicDepth=Z&&this.CZ().getEngine().getCaps().fragmentDepthSupported}CZ(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Z){switch(Z){case a.BLENDMODE_MULTIPLYADD:return;case a.BLENDMODE_ADD:Z=1;break;case a.BLENDMODE_ONEONE:Z=6;break;case a.BLENDMODE_STANDARD:Z=2;break;case a.BLENDMODE_MULTIPLY:Z=4;break;case a.BLENDMODE_SUBTRACT:Z=3}this._engine.setAlphaMode(Z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:v.Ch.Zero()}set direction1(Z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:v.Ch.Zero()}set direction2(Z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:v.Ch.Zero()}set minEmitBox(Z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:v.Ch.Zero()}set maxEmitBox(Z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Z)}get billboardMode(){return this._billboardMode}set billboardMode(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Z){this._isBillboardBased!==Z&&(this._isBillboardBased=Z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z)}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(!Z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Z)}_reset(){}_removeGradientAndTexture(Z,h,V){if(!h)return this;let v=0;for(const A of h){if(A.gradient===Z){h.splice(v,1);break}v++}return V&&V.dispose(),this}constructor(Z){this.animations=[],this.renderingGroupId=0,this.Ah=v.Ch.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new v.Ch(10,10,10),this.onAnimationEnd=null,this.blendMode=a.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new v.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Sn=new v.Ch(0,0,0),this._useLogarithmicDepth=!1,this.gravity=v.Ch.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new K.nd(1,1,1,1),this.color2=new K.nd(1,1,1,1),this.colorDead=new K.nd(0,0,0,1),this.textureMask=new K.nd(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new H,this.id=Z,this.name=Z}createPointEmitter(Z,h){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new v.Ch(0,1,0),arguments.length>2&&void 0!==arguments[2]||new v.Ch(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new v.Ch(0,1,0),arguments.length>4&&void 0!==arguments[4]||new v.Ch(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new v.Ch(0,1,0),arguments.length>3&&void 0!==arguments[3]||new v.Ch(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Z,h,V,v){throw new Error("Method not implemented.")}}a.BLENDMODE_ONEONE=0,a.BLENDMODE_STANDARD=1,a.BLENDMODE_ADD=2,a.BLENDMODE_MULTIPLY=3,a.BLENDMODE_MULTIPLYADD=4,a.BLENDMODE_SUBTRACT=-1,(0,d.i)("BABYLON.BaseParticleSystem",a);var n=V(11748),x=V(11582);class N{constructor(){this.direction1=new v.Ch(0,1,0),this.direction2=new v.Ch(0,1,0),this.minEmitBox=new v.Ch(-.5,-.5,-.5),this.maxEmitBox=new v.Ch(.5,.5,.5)}startDirectionFunction(Z,h,V,A){const H=(0,n.RandomRange)(this.direction1.x,this.direction2.x),K=(0,n.RandomRange)(this.direction1.y,this.direction2.y),d=(0,n.RandomRange)(this.direction1.z,this.direction2.z);if(A)return h.x=H,h.y=K,void(h.z=d);v.Ch.TransformNormalFromFloatsToRef(H,K,d,Z,h)}startPositionFunction(Z,h,V,A){const H=(0,n.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),K=(0,n.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),d=(0,n.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(A)return h.x=H,h.y=K,void(h.z=d);v.Ch.TransformCoordinatesFromFloatsToRef(H,K,d,Z,h)}clone(){const Z=new N;return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2),Z.setVector3("minEmitBox",this.minEmitBox),Z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3),Z.addUniform("minEmitBox",3),Z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.mh(),Z.direction2=this.direction2.mh(),Z.minEmitBox=this.minEmitBox.mh(),Z.maxEmitBox=this.maxEmitBox.mh(),Z}parse(Z){v.Ch.FromArrayToRef(Z.direction1,0,this.direction1),v.Ch.FromArrayToRef(Z.direction2,0,this.direction2),v.Ch.FromArrayToRef(Z.minEmitBox,0,this.minEmitBox),v.Ch.FromArrayToRef(Z.maxEmitBox,0,this.maxEmitBox)}}class D{get radius(){return this._radius}set radius(Z){this._radius=Z,this._buildHeight()}get angle(){return this._angle}set angle(Z){this._angle=Z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=V,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=h,this.radius=Z}startDirectionFunction(Z,h,V,A){A?v.TmpVectors.Ch[0].v(V.Aa).normalize():V.position.subtractToRef(Z.getTranslation(),v.TmpVectors.Ch[0]).normalize();const H=(0,n.RandomRange)(0,this.directionRandomizer),K=(0,n.RandomRange)(0,this.directionRandomizer),d=(0,n.RandomRange)(0,this.directionRandomizer);h.x=v.TmpVectors.Ch[0].x+H,h.y=v.TmpVectors.Ch[0].y+K,h.z=v.TmpVectors.Ch[0].z+d,h.normalize()}startPositionFunction(Z,h,V,A){const H=(0,n.RandomRange)(0,2*Math.PI);let K;this.emitFromSpawnPointOnly?K=1e-4:(K=(0,n.RandomRange)(0,this.heightRange),K=1-K*K);let d=this._radius-(0,n.RandomRange)(0,this._radius*this.radiusRange);d*=K;const a=d*Math.sin(H),x=d*Math.cos(H),N=K*this._height;if(A)return h.x=a,h.y=N,void(h.z=x);v.Ch.TransformCoordinatesFromFloatsToRef(a,N,x,Z,h)}clone(){const Z=new D(this._radius,this._angle,this.directionRandomizer);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat2("radius",this._radius,this.radiusRange),Z.setFloat("coneAngle",this._angle),Z.setFloat2("height",this._height,this.heightRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",2),Z.addUniform("coneAngle",1),Z.addUniform("height",2),Z.addUniform("directionRandomizer",1)}getEffectDefines(){let Z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Z+="\n#define CONEEMITTERSPAWNPOINT"),Z}getClassName(){return"ConeParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this._radius,Z.angle=this._angle,Z.directionRandomizer=this.directionRandomizer,Z.radiusRange=this.radiusRange,Z.heightRange=this.heightRange,Z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Z}parse(Z){this.radius=Z.radius,this.angle=Z.angle,this.directionRandomizer=Z.directionRandomizer,this.radiusRange=void 0!==Z.radiusRange?Z.radiusRange:1,this.heightRange=void 0!==Z.radiusRange?Z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Z.emitFromSpawnPointOnly&&Z.emitFromSpawnPointOnly}}class k extends D{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0);super(Z,h),this.direction1=V,this.direction2=A}startDirectionFunction(Z,h){const V=(0,n.RandomRange)(this.direction1.x,this.direction2.x),A=(0,n.RandomRange)(this.direction1.y,this.direction2.y),H=(0,n.RandomRange)(this.direction1.z,this.direction2.z);v.Ch.TransformNormalFromFloatsToRef(V,A,H,Z,h)}clone(){const Z=new k(this.radius,this.angle,this.direction1,this.direction2);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.mh(),Z.direction2=this.direction2.mh(),Z}parse(Z){super.parse(Z),this.direction1.v(Z.direction1),this.direction2.v(Z.direction2)}}class u{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Z,this.height=h,this.radiusRange=V,this.directionRandomizer=A,this._tempVector=v.Ch.Zero()}startDirectionFunction(Z,h,V,A,H){V.position.subtractToRef(Z.getTranslation(),this._tempVector),this._tempVector.normalize(),v.Ch.TransformNormalToRef(this._tempVector,H,this._tempVector);const K=(0,n.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let d=Math.atan2(this._tempVector.x,this._tempVector.z);d+=(0,n.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=K,this._tempVector.x=Math.sin(d),this._tempVector.z=Math.cos(d),this._tempVector.normalize(),A?h.v(this._tempVector):v.Ch.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z,h)}startPositionFunction(Z,h,V,A){const H=(0,n.RandomRange)(-this.height/2,this.height/2),K=(0,n.RandomRange)(0,2*Math.PI),d=(0,n.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),a=Math.sqrt(d)*this.radius,x=a*Math.cos(K),N=a*Math.sin(K);A?h.IV(x,H,N):v.Ch.TransformCoordinatesFromFloatsToRef(x,H,N,Z,h)}clone(){const Z=new u(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.height=this.height,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.height=Z.height,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class F extends u{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0),H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.Ch(0,1,0);super(Z,h,V),this.direction1=A,this.direction2=H}startDirectionFunction(Z,h,V,A){const H=(0,n.RandomRange)(this.direction1.x,this.direction2.x),K=(0,n.RandomRange)(this.direction1.y,this.direction2.y),d=(0,n.RandomRange)(this.direction1.z,this.direction2.z);A?h.IV(H,K,d):v.Ch.TransformNormalFromFloatsToRef(H,K,d,Z,h)}clone(){const Z=new F(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.mh(),Z.direction2=this.direction2.mh(),Z}parse(Z){super.parse(Z),v.Ch.FromArrayToRef(Z.direction1,0,this.direction1),v.Ch.FromArrayToRef(Z.direction2,0,this.direction2)}}class b{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=h,this.directionRandomizer=V}startDirectionFunction(Z,h,V,A){const H=V.position.rh(Z.getTranslation()).normalize(),K=(0,n.RandomRange)(0,this.directionRandomizer),d=(0,n.RandomRange)(0,this.directionRandomizer),a=(0,n.RandomRange)(0,this.directionRandomizer);H.x+=K,H.y+=d,H.z+=a,H.normalize(),A?h.v(H):v.Ch.TransformNormalFromFloatsToRef(H.x,H.y,H.z,Z,h)}startPositionFunction(Z,h,V,A){const H=this.radius-(0,n.RandomRange)(0,this.radius*this.radiusRange),K=(0,n.RandomRange)(0,1),d=(0,n.RandomRange)(0,2*Math.PI),a=Math.acos(2*K-1),x=H*Math.cos(d)*Math.sin(a),N=H*Math.cos(a),D=H*Math.sin(d)*Math.sin(a);A?h.IV(x,Math.abs(N),D):v.Ch.TransformCoordinatesFromFloatsToRef(x,Math.abs(N),D,Z,h)}clone(){const Z=new b(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class o{constructor(){this.direction1=new v.Ch(0,1,0),this.direction2=new v.Ch(0,1,0)}startDirectionFunction(Z,h,V,A){const H=(0,n.RandomRange)(this.direction1.x,this.direction2.x),K=(0,n.RandomRange)(this.direction1.y,this.direction2.y),d=(0,n.RandomRange)(this.direction1.z,this.direction2.z);A?h.IV(H,K,d):v.Ch.TransformNormalFromFloatsToRef(H,K,d,Z,h)}startPositionFunction(Z,h,V,A){A?h.IV(0,0,0):v.Ch.TransformCoordinatesFromFloatsToRef(0,0,0,Z,h)}clone(){const Z=new o;return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.mh(),Z.direction2=this.direction2.mh(),Z}parse(Z){v.Ch.FromArrayToRef(Z.direction1,0,this.direction1),v.Ch.FromArrayToRef(Z.direction2,0,this.direction2)}}class q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=h,this.directionRandomizer=V}startDirectionFunction(Z,h,V,A){const H=V.position.rh(Z.getTranslation()).normalize(),K=(0,n.RandomRange)(0,this.directionRandomizer),d=(0,n.RandomRange)(0,this.directionRandomizer),a=(0,n.RandomRange)(0,this.directionRandomizer);H.x+=K,H.y+=d,H.z+=a,H.normalize(),A?h.v(H):v.Ch.TransformNormalFromFloatsToRef(H.x,H.y,H.z,Z,h)}startPositionFunction(Z,h,V,A){const H=this.radius-(0,n.RandomRange)(0,this.radius*this.radiusRange),K=(0,n.RandomRange)(0,1),d=(0,n.RandomRange)(0,2*Math.PI),a=Math.acos(2*K-1),x=H*Math.cos(d)*Math.sin(a),N=H*Math.cos(a),D=H*Math.sin(d)*Math.sin(a);A?h.IV(x,N,D):v.Ch.TransformCoordinatesFromFloatsToRef(x,N,D,Z,h)}clone(){const Z=new q(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class X extends q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.Ch(0,1,0),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0);super(Z),this.direction1=h,this.direction2=V}startDirectionFunction(Z,h){const V=(0,n.RandomRange)(this.direction1.x,this.direction2.x),A=(0,n.RandomRange)(this.direction1.y,this.direction2.y),H=(0,n.RandomRange)(this.direction1.z,this.direction2.z);v.Ch.TransformNormalFromFloatsToRef(V,A,H,Z,h)}clone(){const Z=new X(this.radius,this.direction1,this.direction2);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.mh(),Z.direction2=this.direction2.mh(),Z}parse(Z){super.parse(Z),this.direction1.v(Z.direction1),this.direction2.v(Z.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Z,h,V,A){const H=v.TmpVectors.Ch[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,V,H);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,V,H);const Z=v.TmpVectors.Ch[1];H.subtractToRef(V.position,Z),Z.scaleToRef(1/V.lifeTime,H)}else H.set(0,0,0);A?h.v(H):v.Ch.TransformNormalToRef(H,Z,h)}startPositionFunction(Z,h,V,A){const H=v.TmpVectors.Ch[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,V,H):H.set(0,0,0),A?h.v(H):v.Ch.TransformCoordinatesToRef(H,Z,h)}clone(){const Z=new E;return x.b.DeepCopy(this,Z),Z}applyToShader(Z){}buildUniformLayout(Z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.particlePositionGenerator=this.particlePositionGenerator,Z.particleDestinationGenerator=this.particleDestinationGenerator,Z}parse(Z){Z.particlePositionGenerator&&(this.particlePositionGenerator=Z.particlePositionGenerator),Z.particleDestinationGenerator&&(this.particleDestinationGenerator=Z.particleDestinationGenerator)}}var j=V(11805);class P{get mesh(){return this._mesh}set mesh(Z){this._mesh!==Z&&(this._mesh=Z,Z?(this._indices=Z.fh(),this._positions=Z.getVerticesData(j.f.PositionKind),this._normals=Z.getVerticesData(j.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=v.Ch.Zero(),this._mesh=null,this.direction1=new v.Ch(0,1,0),this.direction2=new v.Ch(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Z}startDirectionFunction(Z,h,V,A){if(this.useMeshNormalsForDirection&&this._normals)return void v.Ch.TransformNormalToRef(this._storedNormal,Z,h);const H=(0,n.RandomRange)(this.direction1.x,this.direction2.x),K=(0,n.RandomRange)(this.direction1.y,this.direction2.y),d=(0,n.RandomRange)(this.direction1.z,this.direction2.z);A?h.IV(H,K,d):v.Ch.TransformNormalFromFloatsToRef(H,K,d,Z,h)}startPositionFunction(Z,h,V,A){if(!this._indices||!this._positions)return;const H=3*(Math.random()*(this._indices.length/3)|0),K=Math.random(),d=Math.random()*(1-K),a=1-K-d,n=this._indices[H],x=this._indices[H+1],N=this._indices[H+2],D=v.TmpVectors.Ch[0],k=v.TmpVectors.Ch[1],u=v.TmpVectors.Ch[2],F=v.TmpVectors.Ch[3];v.Ch.FromArrayToRef(this._positions,3*n,D),v.Ch.FromArrayToRef(this._positions,3*x,k),v.Ch.FromArrayToRef(this._positions,3*N,u),F.x=K*D.x+d*k.x+a*u.x,F.y=K*D.y+d*k.y+a*u.y,F.z=K*D.z+d*k.z+a*u.z,A?h.IV(F.x,F.y,F.z):v.Ch.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,Z,h),this.useMeshNormalsForDirection&&this._normals&&(v.Ch.FromArrayToRef(this._normals,3*n,D),v.Ch.FromArrayToRef(this._normals,3*x,k),v.Ch.FromArrayToRef(this._normals,3*N,u),this._storedNormal.x=K*D.x+d*k.x+a*u.x,this._storedNormal.y=K*D.y+d*k.y+a*u.y,this._storedNormal.z=K*D.z+d*k.z+a*u.z)}clone(){const Z=new P(this.mesh);return x.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Z;const h={};return h.type=this.getClassName(),h.direction1=this.direction1.mh(),h.direction2=this.direction2.mh(),h.meshId=null===(Z=this.mesh)||void 0===Z?void 0:Z.id,h.useMeshNormalsForDirection=this.useMeshNormalsForDirection,h}parse(Z,h){v.Ch.FromArrayToRef(Z.direction1,0,this.direction1),v.Ch.FromArrayToRef(Z.direction2,0,this.direction2),Z.meshId&&h&&(this.mesh=h.getLastMeshById(Z.meshId)),this.useMeshNormalsForDirection=Z.useMeshNormalsForDirection}}class C{_isUbo(Z){return void 0!==Z.addUniform}constructor(Z){this._isUbo(Z)?(this.setMatrix3x3=Z.updateMatrix3x3.bind(Z),this.setMatrix2x2=Z.updateMatrix2x2.bind(Z),this.setFloat=Z.updateFloat.bind(Z),this.setFloat2=Z.updateFloat2.bind(Z),this.setFloat3=Z.updateFloat3.bind(Z),this.setFloat4=Z.updateFloat4.bind(Z),this.setFloatArray=Z.updateFloatArray.bind(Z),this.setArray=Z.updateArray.bind(Z),this.setIntArray=Z.updateIntArray.bind(Z),this.setMatrix=Z.wh.bind(Z),this.setMatrices=Z.updateMatrices.bind(Z),this.setVector3=Z.updateVector3.bind(Z),this.setVector4=Z.updateVector4.bind(Z),this.setColor3=Z.updateColor3.bind(Z),this.setColor4=Z.updateColor4.bind(Z),this.setDirectColor4=Z.updateDirectColor4.bind(Z),this.setInt=Z.updateInt.bind(Z),this.setInt2=Z.updateInt2.bind(Z),this.setInt3=Z.updateInt3.bind(Z),this.setInt4=Z.updateInt4.bind(Z)):(this.setMatrix3x3=Z.setMatrix3x3.bind(Z),this.setMatrix2x2=Z.setMatrix2x2.bind(Z),this.setFloat=Z.setFloat.bind(Z),this.setFloat2=Z.setFloat2.bind(Z),this.setFloat3=Z.setFloat3.bind(Z),this.setFloat4=Z.setFloat4.bind(Z),this.setFloatArray=Z.setFloatArray.bind(Z),this.setArray=Z.setArray.bind(Z),this.setIntArray=Z.setIntArray.bind(Z),this.setMatrix=Z.setMatrix.bind(Z),this.setMatrices=Z.setMatrices.bind(Z),this.setVector3=Z.setVector3.bind(Z),this.setVector4=Z.setVector4.bind(Z),this.setColor3=Z.setColor3.bind(Z),this.setColor4=Z.setColor4.bind(Z),this.setDirectColor4=Z.setDirectColor4.bind(Z),this.setInt=Z.setInt.bind(Z),this.setInt2=Z.setInt2.bind(Z),this.setInt3=Z.setInt3.bind(Z),this.setInt4=Z.setInt4.bind(Z))}}var l=V(11647);const B="gpuUpdateParticlesPixelShader",S="#version 300 es\nvoid main() {discard;}\n";l.c.ShadersStore[B]||(l.c.ShadersStore[B]=S);const r="gpuUpdateParticlesVertexShader",L="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";l.c.ShadersStore[r]||(l.c.ShadersStore[r]=L);(0,d.i)("BABYLON.WebGL2ParticleSystem",class{constructor(Z,h){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Z,this._engine=h,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Z;return(null===(Z=this._updateEffect)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new C(this._updateEffect)}createVertexBuffers(Z,h){this._updateVAO.push(this._createUpdateVAO(Z)),this._renderVAO.push(this._engine.recordVertexArrayObject(h,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=h}createParticleBuffer(Z){return Z}bindDrawBuffers(Z,h,V){V?this._engine.bindBuffers(this._renderVertexBuffers,V,h):this._engine.bindVertexArrayObject(this._renderVAO[Z],null)}preUpdateParticleBuffer(){const Z=this._engine;if(this._engine.enableEffect(this._updateEffect),!Z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Z,h,V){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Z],null);const v=this._engine;v.bindTransformFeedbackBuffer(h.getBuffer()),v.setRasterizerState(!1),v.beginTransformFeedback(!0),v.drawArraysType(3,0,V),v.endTransformFeedback(),v.setRasterizerState(!0),v.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Z=0;Z<this._updateVAO.length;Z++)this._engine.releaseVertexArrayObject(this._updateVAO[Z]);this._updateVAO.length=0;for(let Z=0;Z<this._renderVAO.length;Z++)this._engine.releaseVertexArrayObject(this._renderVAO[Z]);this._renderVAO.length=0}_createUpdateVAO(Z){const h={};h.position=Z.createVertexBuffer("position",0,3);let V=3;h.age=Z.createVertexBuffer("age",V,1),V+=1,h.size=Z.createVertexBuffer("size",V,3),V+=3,h.life=Z.createVertexBuffer("life",V,1),V+=1,h.seed=Z.createVertexBuffer("seed",V,4),V+=4,h.direction=Z.createVertexBuffer("direction",V,3),V+=3,this._parent.particleEmitterType instanceof E&&(h.initialPosition=Z.createVertexBuffer("initialPosition",V,3),V+=3),this._parent._colorGradientsTexture||(h.color=Z.createVertexBuffer("color",V,4),V+=4),this._parent._isBillboardBased||(h.initialDirection=Z.createVertexBuffer("initialDirection",V,3),V+=3),this._parent.noiseTexture&&(h.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",V,3),V+=3,h.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",V,3),V+=3),this._parent._angularSpeedGradientsTexture?(h.angle=Z.createVertexBuffer("angle",V,1),V+=1):(h.angle=Z.createVertexBuffer("angle",V,2),V+=2),this._parent._isAnimationSheetEnabled&&(h.cellIndex=Z.createVertexBuffer("cellIndex",V,1),V+=1,this._parent.spriteRandomStartCell&&(h.cellStartOffset=Z.createVertexBuffer("cellStartOffset",V,1),V+=1));const v=this._engine.recordVertexArrayObject(h,null,this._updateEffect);return this._engine.bindArrayBuffer(null),v}});class y{constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,v=arguments.length>3?arguments[3]:void 0;this._engine=Z,this._label=v,this._engine._storageBuffers.push(this),this._create(h,V)}_create(Z,h){this._bufferSize=Z,this._creationFlags=h,this._buffer=this._engine.createStorageBuffer(Z,h,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Z,h,V){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Z,h,V)}async read(Z,h,V,v){return await this._engine.readFromStorageBuffer(this._buffer,Z,h,V,v)}dispose(){const Z=this._engine._storageBuffers,h=Z.indexOf(this);-1!==h&&(Z[h]=Z[Z.length-1],Z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var W=V(11720),z=V(11723),m=V(11769),g=V(11713),I=V(12036),e=V(11580),U=V(11679),R=V(11962);class Q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.d}_addDuration(Z,h){Z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(h,!1),this._gpuTimeInFrameId=Z):this.counter.addCount(h,!1))}}var w=V(11633);class T{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Z,this._engine=h,this.uniqueId=I.c.UniqueId,h.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Q),this._engine.getCaps().supportComputeShaders?v.bindingsMapping?(this._context=h.createComputeContext(),this._shaderPath=V,this._options={bindingsMapping:{},defines:[],...v}):e.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):e.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Z,h){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=this._bindings[Z];this._bindings[Z]={type:V?0:4,object:h,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!v||v.object!==h||v.type!==this._bindings[Z].type)}setStorageTexture(Z,h){const V=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==h),this._bindings[Z]={type:1,object:h,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setExternalTexture(Z,h){const V=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==h),this._bindings[Z]={type:6,object:h,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setVideoTexture(Z,h){return!!h.externalTexture&&(this.setExternalTexture(Z,h.externalTexture),!0)}setUniformBuffer(Z,h){const V=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==h),this._bindings[Z]={type:T._BufferIsDataBuffer(h)?7:2,object:h,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setStorageBuffer(Z,h){const V=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==h),this._bindings[Z]={type:T._BufferIsDataBuffer(h)?7:3,object:h,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setTextureSampler(Z,h){const V=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!V||!h.compareSampler(V.object)),this._bindings[Z]={type:5,object:h,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}isReady(){let Z=this._effect;for(const A in this._bindings){const Z=this._bindings[A],h=Z.type,V=Z.object;switch(h){case 0:case 4:case 1:if(!V.isReady())return!1;break;case 6:if(!V.isReady())return!1;break}}const h=[],V=this._shaderPath;if(this._options.defines)for(let A=0;A<this._options.defines.length;A++)h.push(this._options.defines[A]);const v=h.join("\n");return this._cachedDefines!==v&&(this._cachedDefines=v,Z=this._engine.createComputeEffect(V,{defines:v,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Z),!!Z.isReady()}dispatch(Z,h,V){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Z,h,V,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const V=T._BufferIsDataBuffer(Z)?Z:Z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,V,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const h in this._bindings){const V=this._bindings[h];if(!this._options.bindingsMapping[h])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+h+"'");switch(V.type){case 0:{const v=this._samplers[h],A=V.object;var Z;if(!v||!A._texture||!v.compareSampler(A._texture))this._samplers[h]=(new U.d).setParameters(A.wrapU,A.wrapV,A.wrapR,A.anisotropicFilteringLevel,A._texture.samplingMode,null===(Z=A._texture)||void 0===Z?void 0:Z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Z=V.object;Z.getBuffer()!==V.buffer&&(V.buffer=Z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((A=>{(0,w.h)((()=>this.dispatch(Z,h,V)),A,void 0,v)}))}serialize(){const Z=m.b.Serialize(this);Z.options=this._options,Z.shaderPath=this._shaderPath,Z.CD={},Z.textures={};for(const h in this._bindings){const V=this._bindings[h],v=V.object;switch(V.type){case 0:case 4:case 1:{const A=v.serialize();A&&(Z.textures[h]=A,Z.CD[h]={type:V.type});break}}}return Z}static Parse(Z,h,V){const v=m.b.Parse((()=>new T(Z.name,h.getEngine(),Z.shaderPath,Z.options)),Z,h,V);for(const A in Z.textures){const H=Z.CD[A],K=g.e.Parse(Z.textures[A],h,V);0===H.type?v.setTexture(A,K):4===H.type?v.setTexture(A,K,!1):v.setStorageTexture(A,K)}return v}static _BufferIsDataBuffer(Z){return void 0!==Z.underlyingResource}}(0,W.b)([(0,z.I)()],T.prototype,"name",void 0),(0,W.b)([(0,z.I)()],T.prototype,"fastMode",void 0),(0,d.i)("BABYLON.ComputeShader",T);var t=V(12003);const c="gpuUpdateParticlesComputeShader",i="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";l.c.ShadersStoreWGSL[c]||(l.c.ShadersStoreWGSL[c]=i);(0,d.i)("BABYLON.ComputeShaderParticleSystem",class{constructor(Z,h){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Z,this._engine=h}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Z;return(null===(Z=this._updateComputeShader)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){var h;const V={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(V.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(V.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(V.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(V.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(V.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(V.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(V.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new T("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:V,defines:Z.split("\n")}),null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=new t.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new C(this._simParamsComputeShader)}createVertexBuffers(Z,h){this._renderVertexBuffers.push(h)}createParticleBuffer(Z){const h=new y(this._engine,4*Z.length,11,"ComputeShaderParticleSystemBuffer");return h.update(Z),this._bufferComputeShader.push(h),h.getBuffer()}bindDrawBuffers(Z,h,V){this._engine.bindBuffers(this._renderVertexBuffers[Z],V,h)}preUpdateParticleBuffer(){}updateParticleBuffer(Z,h,V){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Z]),this._updateComputeShader.dispatch(Math.ceil(V/64))}releaseBuffers(){var Z;for(let h=0;h<this._bufferComputeShader.length;++h)this._bufferComputeShader[h].dispose();this._bufferComputeShader.length=0,null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class M{constructor(Z,h,V){this.gradient=Z,this.color1=h,this.color2=V}getColorToRef(Z){this.color2?K.nd.LerpToRef(this.color1,this.color2,Math.random(),Z):Z.v(this.color1)}}class O{constructor(Z,h){this.gradient=Z,this.color=h}}class s{constructor(Z,h,V){this.gradient=Z,this.factor1=h,this.factor2=V}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class J{static GetCurrentGradient(Z,h,V){if(h[0].gradient>Z)return void V(h[0],h[0],1);for(let A=0;A<h.length-1;A++){const v=h[A],H=h[A+1];if(Z>=v.gradient&&Z<=H.gradient){return void V(v,H,(Z-v.gradient)/(H.gradient-v.gradient))}}const v=h.length-1;V(h[v],h[v],1)}}var f=V(11566),p=V(12211),Y=V(11599);class G{constructor(Z){this.particleSystem=Z,this.position=v.Ch.Zero(),this.direction=v.Ch.Zero(),this.color=new K.nd(0,0,0,0),this.colorStep=new K.nd(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new v.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new K.nd(0,0,0,0),this._currentColor2=new K.nd(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=G._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Z=this.age,h=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===h?(h=1,Z=this._randomCellOffset):Z+=this._randomCellOffset);const V=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let v;v=this._initialSpriteCellLoop?(0,n.Clamp)(Z*h%this.lifeTime/this.lifeTime):(0,n.Clamp)(Z*h/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+v*V|0}_inheritParticleInfoToSubEmitter(Z){if(Z.particleSystem.Ah.position){const h=Z.particleSystem.Ah;if(h.position.v(this.position),Z.inheritDirection){const Z=v.TmpVectors.Ch[0];this.direction.normalizeToRef(Z),h.setDirection(Z,0,Math.PI/2)}}else{Z.particleSystem.Ah.v(this.position)}this.direction.scaleToRef(Z.inheritedVelocityAmount/2,v.TmpVectors.Ch[0]),Z.particleSystem._inheritedVelocityOffset.v(v.TmpVectors.Ch[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Z)}_reset(){this.age=0,this.id=G._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Z){Z.position.v(this.position),this._initialDirection?Z._initialDirection?Z._initialDirection.v(this._initialDirection):Z._initialDirection=this._initialDirection.clone():Z._initialDirection=null,Z.direction.v(this.direction),this.Aa&&(Z.Aa?Z.Aa.v(this.Aa):Z.Aa=this.Aa.clone()),Z.color.v(this.color),Z.colorStep.v(this.colorStep),Z.lifeTime=this.lifeTime,Z.age=this.age,Z._randomCellOffset=this._randomCellOffset,Z.size=this.size,Z.scale.v(this.scale),Z.angle=this.angle,Z.angularSpeed=this.angularSpeed,Z.particleSystem=this.particleSystem,Z.cellIndex=this.cellIndex,Z.id=this.id,Z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Z._currentColorGradient=this._currentColorGradient,Z._currentColor1.v(this._currentColor1),Z._currentColor2.v(this._currentColor2)),this._currentSizeGradient&&(Z._currentSizeGradient=this._currentSizeGradient,Z._currentSize1=this._currentSize1,Z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Z._currentAngularSpeed1=this._currentAngularSpeed1,Z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Z._currentVelocityGradient=this._currentVelocityGradient,Z._currentVelocity1=this._currentVelocity1,Z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Z._currentLimitVelocity1=this._currentLimitVelocity1,Z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Z._currentDragGradient=this._currentDragGradient,Z._currentDrag1=this._currentDrag1,Z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Z._initialStartSpriteCellId=this._initialStartSpriteCellId,Z._initialEndSpriteCellId=this._initialEndSpriteCellId,Z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Z.remapData&&this.remapData?Z.remapData.v(this.remapData):Z.remapData=new v.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.v(this._randomNoiseCoordinates1),Z._randomNoiseCoordinates2.v(this._randomNoiseCoordinates2)):(Z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}G._Count=0;var ZZ=V(11860),hZ=(V(11900),V(12099)),VZ=V(12096),vZ=V(12001);function AZ(Z,h){const V=(0,n.RandomRange)(0,1);K.nd.LerpToRef(h.color1,h.color2,V,Z.color),h.colorDead.subtractToRef(Z.color,h._colorDiff),h._colorDiff.scaleToRef(1/Z.lifeTime,Z.colorStep)}function HZ(Z,h){Z._currentColorGradient=h._colorGradients[0],Z._currentColorGradient.getColorToRef(Z.color),Z._currentColor1.v(Z.color),h._colorGradients.length>1?h._colorGradients[1].getColorToRef(Z._currentColor2):Z._currentColor2.v(Z.color)}function KZ(Z,h){const V=h._colorGradients;J.GetCurrentGradient(h._ratio,V,((h,V,v)=>{h!==Z._currentColorGradient&&(Z._currentColor1.v(Z._currentColor2),V.getColorToRef(Z._currentColor2),Z._currentColorGradient=h),K.nd.LerpToRef(Z._currentColor1,Z._currentColor2,v,Z.color)}))}function dZ(Z,h){Z.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),Z.color.addInPlace(h._scaledColorStep),Z.color.a<0&&(Z.color.a=0)}function aZ(Z,h){J.GetCurrentGradient(h._ratio,h._angularSpeedGradients,((h,V,v)=>{h!==Z._currentAngularSpeedGradient&&(Z._currentAngularSpeed1=Z._currentAngularSpeed2,Z._currentAngularSpeed2=V.getFactor(),Z._currentAngularSpeedGradient=h),Z.angularSpeed=(0,n.Lerp)(Z._currentAngularSpeed1,Z._currentAngularSpeed2,v)}))}function nZ(Z,h){Z.angle+=Z.angularSpeed*h._scaledUpdateSpeed}function xZ(Z,h){h.particleEmitterType.startDirectionFunction(h._emitterWorldMatrix,Z.direction,Z,h.isLocal,h._emitterInverseWorldMatrix)}function NZ(Z,h){h.startDirectionFunction(h._emitterWorldMatrix,Z.direction,Z,h.isLocal)}function DZ(Z,h){Z._currentVelocityGradient=h._velocityGradients[0],Z._currentVelocity1=Z._currentVelocityGradient.getFactor(),h._velocityGradients.length>1?Z._currentVelocity2=h._velocityGradients[1].getFactor():Z._currentVelocity2=Z._currentVelocity1}function kZ(Z,h){Z._currentLimitVelocityGradient=h._limitVelocityGradients[0],Z._currentLimitVelocity1=Z._currentLimitVelocityGradient.getFactor(),h._limitVelocityGradients.length>1?Z._currentLimitVelocity2=h._limitVelocityGradients[1].getFactor():Z._currentLimitVelocity2=Z._currentLimitVelocity1}function uZ(Z,h){J.GetCurrentGradient(h._ratio,h._velocityGradients,((V,v,A)=>{V!==Z._currentVelocityGradient&&(Z._currentVelocity1=Z._currentVelocity2,Z._currentVelocity2=v.getFactor(),Z._currentVelocityGradient=V),h._directionScale*=(0,n.Lerp)(Z._currentVelocity1,Z._currentVelocity2,A)}))}function FZ(Z,h){J.GetCurrentGradient(h._ratio,h._limitVelocityGradients,((V,v,A)=>{V!==Z._currentLimitVelocityGradient&&(Z._currentLimitVelocity1=Z._currentLimitVelocity2,Z._currentLimitVelocity2=v.getFactor(),Z._currentLimitVelocityGradient=V);const H=(0,n.Lerp)(Z._currentLimitVelocity1,Z._currentLimitVelocity2,A);Z.direction.length()>H&&Z.direction.scaleInPlace(h.limitVelocityDamping)}))}function bZ(Z,h){Z.direction.scaleToRef(h._directionScale,h._scaledDirection)}function oZ(Z,h){h.particleEmitterType.startPositionFunction(h._emitterWorldMatrix,Z.position,Z,h.isLocal)}function qZ(Z,h){h.startPositionFunction(h._emitterWorldMatrix,Z.position,Z,h.isLocal)}function XZ(Z,h){Z.Aa?Z.Aa.v(Z.position):Z.Aa=Z.position.clone(),v.Ch.TransformCoordinatesToRef(Z.Aa,h._emitterWorldMatrix,Z.position)}function EZ(Z,h){h.isLocal&&Z.Aa?(Z.Aa.addInPlace(h._scaledDirection),v.Ch.TransformCoordinatesToRef(Z.Aa,h._emitterWorldMatrix,Z.position)):Z.position.addInPlace(h._scaledDirection)}function jZ(Z,h){Z._currentDragGradient=h._dragGradients[0],Z._currentDrag1=Z._currentDragGradient.getFactor(),h._dragGradients.length>1?Z._currentDrag2=h._dragGradients[1].getFactor():Z._currentDrag2=Z._currentDrag1}function PZ(Z,h){J.GetCurrentGradient(h._ratio,h._dragGradients,((V,v,A)=>{V!==Z._currentDragGradient&&(Z._currentDrag1=Z._currentDrag2,Z._currentDrag2=v.getFactor(),Z._currentDragGradient=V);const H=(0,n.Lerp)(Z._currentDrag1,Z._currentDrag2,A);h._scaledDirection.scaleInPlace(1-H)}))}function CZ(Z,h){Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.IV(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2.IV(Math.random(),Math.random(),Math.random())):(Z._randomNoiseCoordinates1=new v.Ch(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2=new v.Ch(Math.random(),Math.random(),Math.random()))}function lZ(Z,h){const V=h._noiseTextureData,A=h._noiseTextureSize;if(V&&A&&Z._randomNoiseCoordinates1){const H=h._fetchR(Z._randomNoiseCoordinates1.x,Z._randomNoiseCoordinates1.y,A.width,A.height,V),K=h._fetchR(Z._randomNoiseCoordinates1.z,Z._randomNoiseCoordinates2.x,A.width,A.height,V),d=h._fetchR(Z._randomNoiseCoordinates2.y,Z._randomNoiseCoordinates2.z,A.width,A.height,V),a=v.TmpVectors.Ch[0],n=v.TmpVectors.Ch[1];a.IV((2*H-1)*h.noiseStrength.x,(2*K-1)*h.noiseStrength.y,(2*d-1)*h.noiseStrength.z),a.scaleToRef(h._tempScaledUpdateSpeed,n),Z.direction.addInPlace(n)}}function BZ(Z,h){h.gravity.scaleToRef(h._tempScaledUpdateSpeed,h._scaledGravity),Z.direction.addInPlace(h._scaledGravity)}function SZ(Z,h){Z.size=(0,n.RandomRange)(h.minSize,h.maxSize),Z.scale.IV((0,n.RandomRange)(h.minScaleX,h.maxScaleX),(0,n.RandomRange)(h.minScaleY,h.maxScaleY))}function rZ(Z,h){Z._currentSizeGradient=h._sizeGradients[0],Z._currentSize1=Z._currentSizeGradient.getFactor(),Z.size=Z._currentSize1,h._sizeGradients.length>1?Z._currentSize2=h._sizeGradients[1].getFactor():Z._currentSize2=Z._currentSize1,Z.scale.IV((0,n.RandomRange)(h.minScaleX,h.maxScaleX),(0,n.RandomRange)(h.minScaleY,h.maxScaleY))}function LZ(Z,h){const V=h._actualFrame/h.targetStopDuration;J.GetCurrentGradient(V,h._startSizeGradients,((V,v,A)=>{V!==h._currentStartSizeGradient&&(h._currentStartSize1=h._currentStartSize2,h._currentStartSize2=v.getFactor(),h._currentStartSizeGradient=V);const H=(0,n.Lerp)(h._currentStartSize1,h._currentStartSize2,A);Z.scale.scaleInPlace(H)}))}function yZ(Z,h){J.GetCurrentGradient(h._ratio,h._sizeGradients,((h,V,v)=>{h!==Z._currentSizeGradient&&(Z._currentSize1=Z._currentSize2,Z._currentSize2=V.getFactor(),Z._currentSizeGradient=h),Z.size=(0,n.Lerp)(Z._currentSize1,Z._currentSize2,v)}))}function WZ(Z,h){Z.remapData=new v.Vector4(0,1,0,1)}function zZ(Z,h){h._colorRemapGradients&&h._colorRemapGradients.length>0&&J.GetCurrentGradient(h._ratio,h._colorRemapGradients,((h,V,v)=>{const A=(0,n.Lerp)(h.factor1,V.factor1,v),H=(0,n.Lerp)(h.factor2,V.factor2,v);Z.remapData.x=A,Z.remapData.y=H-A})),h._alphaRemapGradients&&h._alphaRemapGradients.length>0&&J.GetCurrentGradient(h._ratio,h._alphaRemapGradients,((h,V,v)=>{const A=(0,n.Lerp)(h.factor1,V.factor1,v),H=(0,n.Lerp)(h.factor2,V.factor2,v);Z.remapData.z=A,Z.remapData.w=H-A}))}function mZ(Z,h){const V=(0,n.Clamp)(h._actualFrame/h.targetStopDuration);J.GetCurrentGradient(V,h._lifeTimeGradients,((h,v)=>{const A=h,H=v,K=A.getFactor(),d=H.getFactor(),a=(V-A.gradient)/(H.gradient-A.gradient);Z.lifeTime=(0,n.Lerp)(K,d,a)})),h._emitPower=(0,n.RandomRange)(h.minEmitPower,h.maxEmitPower)}function gZ(Z,h){Z.lifeTime=(0,n.RandomRange)(h.minLifeTime,h.maxLifeTime),h._emitPower=(0,n.RandomRange)(h.minEmitPower,h.maxEmitPower)}function IZ(Z,h){0===h._emitPower?(Z._initialDirection?Z._initialDirection.v(Z.direction):Z._initialDirection=Z.direction.clone(),Z.direction.set(0,0,0)):(Z._initialDirection=null,Z.direction.scaleInPlace(h._emitPower)),Z.direction.addInPlace(h._inheritedVelocityOffset)}function eZ(Z,h){Z.angularSpeed=(0,n.RandomRange)(h.minAngularSpeed,h.maxAngularSpeed),Z.angle=(0,n.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function UZ(Z,h){Z._currentAngularSpeedGradient=h._angularSpeedGradients[0],Z.angularSpeed=Z._currentAngularSpeedGradient.getFactor(),Z._currentAngularSpeed1=Z.angularSpeed,h._angularSpeedGradients.length>1?Z._currentAngularSpeed2=h._angularSpeedGradients[1].getFactor():Z._currentAngularSpeed2=Z._currentAngularSpeed1,Z.angle=(0,n.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function RZ(Z,h){Z._initialStartSpriteCellId=h.startSpriteCellID,Z._initialEndSpriteCellId=h.endSpriteCellID,Z._initialSpriteCellLoop=h.spriteCellLoop}function QZ(Z,h){Z.previousItem=h.previousItem,Z.nextItem=h,h.previousItem&&(h.previousItem.nextItem=Z),h.previousItem=Z}function wZ(Z,h){Z.previousItem=h,Z.nextItem=h.nextItem,h.nextItem&&(h.nextItem.previousItem=Z),h.nextItem=Z}function TZ(Z,h){let V=h;for(;V.nextItem;)V=V.nextItem;Z.previousItem=V,Z.nextItem=V.nextItem,V.nextItem=Z}function tZ(Z){Z.previousItem&&(Z.previousItem.nextItem=Z.nextItem),Z.nextItem&&(Z.nextItem.previousItem=Z.previousItem)}class cZ extends a{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Z){this._startDirectionFunction!==Z&&(this._startDirectionFunction=Z,this._directionProcessing.process=Z?NZ:xZ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Z){this._startPositionFunction!==Z&&(this._startPositionFunction=Z,this._positionCreation.process=Z?qZ:oZ)}set onDispose(Z){this._onDisposeObserver&&this.jh.remove(this._onDisposeObserver),this._onDisposeObserver=this.jh.add(Z)}get K(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Z){this._useRampGradients!==Z&&(this._useRampGradients=Z,this._resetEffect(),Z?(this._rampCreation={process:WZ,previousItem:null,nextItem:null},wZ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:zZ,previousItem:null,nextItem:null},wZ(this._remapGradientProcessing,this._gravityProcessing)):(tZ(this._rampCreation),tZ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Z){this._isLocal!==Z&&(this._isLocal=Z,Z?(this._isLocalCreation={process:XZ,previousItem:null,nextItem:null},wZ(this._isLocalCreation,this._positionCreation)):tZ(this._isLocalCreation))}get particles(){return this.qD}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z,Z?(this._sheetCreation={process:RZ,previousItem:null,nextItem:null},wZ(this._sheetCreation,this._colorCreation)):tZ(this._sheetCreation),this._reset())}getActiveCount(){return this.qD.length}getClassName(){return"od"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Z;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[h])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new ZZ.e(this._engine),this._customWrappers[h].effect=Z,this._customWrappers[h].drawContext&&(this._customWrappers[h].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){if(this.noiseTexture!==Z){if(this._noiseTexture=Z,!Z)return tZ(this._noiseCreation),void tZ(this._noiseProcessing);this._noiseCreation={process:CZ,previousItem:null,nextItem:null},wZ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:lZ,previousItem:null,nextItem:null},wZ(this._noiseProcessing,this._positionProcessing)}}constructor(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Z),this._emitterInverseWorldMatrix=v.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new v.Ch,this.jh=new f.b,this.onStoppedObservable=new f.b,this.onStartedObservable=new f.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.qD=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new K.nd(0,0,0,0),this._colorDiff=new K.nd(0,0,0,0),this._scaledDirection=v.Ch.Zero(),this._scaledGravity=v.Ch.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Z=>{},this.recycleParticle=Z=>{const h=this.qD.pop();h!==Z&&h.copyTo(Z),this._stockParticles.push(h)},this._createParticle=()=>{let Z;return 0!==this._stockParticles.length?(Z=this._stockParticles.pop(),Z._reset()):Z=new G(this),this._prepareParticle(Z),Z},this.paused=!1,this._shadersLoaded=!1,this._capacity=h,this._epsilon=d,V&&"Scene"!==V.getClassName()?(this._engine=V,this.defaultProjectionMatrix=v.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=V||Y.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.bD.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:gZ,previousItem:null,nextItem:null},this._positionCreation={process:oZ,previousItem:null,nextItem:null},wZ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:xZ,previousItem:null,nextItem:null},wZ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:IZ,previousItem:null,nextItem:null},wZ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:SZ,previousItem:null,nextItem:null},wZ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:eZ,previousItem:null,nextItem:null},wZ(this._angleCreation,this._sizeCreation),this._colorCreation={process:AZ,previousItem:null,nextItem:null},wZ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,a||(this._colorProcessing={process:dZ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:nZ,previousItem:null,nextItem:null},wZ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:bZ,previousItem:null,nextItem:null},wZ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:EZ,previousItem:null,nextItem:null},wZ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:BZ,previousItem:null,nextItem:null},wZ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=H,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ZZ.e(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new N,this.updateFunction=Z=>{var h;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(h=this.noiseTexture.getContent())||void 0===h||h.then((Z=>{this._noiseTextureData=Z})));const V=Z===this.qD;for(let v=0;v<Z.length;v++){const h=Z[v];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const A=h.age;if(h.age+=this._tempScaledUpdateSpeed,h.age>h.lifeTime){const Z=h.age-A,V=h.lifeTime-A;this._tempScaledUpdateSpeed=V*this._tempScaledUpdateSpeed/Z,h.age=h.lifeTime}this._ratio=h.age/h.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let H=this._updateQueueStart;for(;H;)H.process(h,this),H=H.nextItem;if(this._isAnimationSheetEnabled&&!a&&h.updateCellIndex(),h._inheritParticleInfoToSubEmitters(),h.age>=h.lifeTime){if(this._emitFromParticle(h),h._attachedSubEmitters){for(const Z of h._attachedSubEmitters)Z.particleSystem.disposeOnStop=!0,Z.particleSystem.stop();h._attachedSubEmitters=null}this.recycleParticle(h),V&&v--}else;}}}serialize(Z){throw new Error("Method not implemented.")}clone(Z,h){throw new Error("Method not implemented.")}_addFactorGradient(Z,h,V,v){const A=new s(h,V,v);Z.push(A),Z.sort(((Z,h)=>Z.gradient<h.gradient?-1:Z.gradient>h.gradient?1:0))}_removeFactorGradient(Z,h){if(!Z)return;let V=0;for(const v of Z){if(v.gradient===h){Z.splice(V,1);break}V++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=mZ:this._lifeTimeCreation.process=gZ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:LZ,previousItem:null,nextItem:null},wZ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(tZ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this.targetStopDuration!==Z&&(this._targetStopDuration=Z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Z,h,V){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Z,h,V),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Z){return this._removeFactorGradient(this._lifeTimeGradients,Z),this._syncLifeTimeCreation(),this}addSizeGradient(Z,h,V){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=rZ,this._sizeGradientProcessing={process:yZ,previousItem:null,nextItem:null},QZ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Z,h,V),this}removeSizeGradient(Z){var h;return this._removeFactorGradient(this._sizeGradients,Z),0===(null===(h=this._sizeGradients)||void 0===h?void 0:h.length)&&(tZ(this._sizeGradientProcessing),this._sizeCreation.process=SZ),this}addColorRemapGradient(Z,h,V){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Z,h,V),this}removeColorRemapGradient(Z){return this._removeFactorGradient(this._colorRemapGradients,Z),this}addAlphaRemapGradient(Z,h,V){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Z,h,V),this}removeAlphaRemapGradient(Z){return this._removeFactorGradient(this._alphaRemapGradients,Z),this}addAngularSpeedGradient(Z,h,V){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=UZ,this._angularSpeedGradientProcessing={process:aZ,previousItem:null,nextItem:null},QZ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Z,h,V),this}removeAngularSpeedGradient(Z){var h;return this._removeFactorGradient(this._angularSpeedGradients,Z),0===(null===(h=this._angularSpeedGradients)||void 0===h?void 0:h.length)&&(this._angleCreation.process=eZ,tZ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Z,h,V){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:DZ,previousItem:null,nextItem:null},wZ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:uZ,previousItem:null,nextItem:null},QZ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Z,h,V),this}removeVelocityGradient(Z){var h;return this._removeFactorGradient(this._velocityGradients,Z),0===(null===(h=this._velocityGradients)||void 0===h?void 0:h.length)&&(tZ(this._velocityCreation),tZ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Z,h,V){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:kZ,previousItem:null,nextItem:null},wZ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:FZ,previousItem:null,nextItem:null},wZ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Z,h,V),this}removeLimitVelocityGradient(Z){var h;return this._removeFactorGradient(this._limitVelocityGradients,Z),0===(null===(h=this._limitVelocityGradients)||void 0===h?void 0:h.length)&&(tZ(this._limitVelocityCreation),tZ(this._limitVelocityGradientProcessing)),this}addDragGradient(Z,h,V){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:jZ,previousItem:null,nextItem:null},QZ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:PZ,previousItem:null,nextItem:null},QZ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Z,h,V),this}removeDragGradient(Z){var h;return this._removeFactorGradient(this._dragGradients,Z),0===(null===(h=this._dragGradients)||void 0===h?void 0:h.length)&&(tZ(this._dragCreation),tZ(this._dragGradientProcessing)),this}addEmitRateGradient(Z,h,V){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Z,h,V),this}removeEmitRateGradient(Z){return this._removeFactorGradient(this._emitRateGradients,Z),this}addStartSizeGradient(Z,h,V){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Z,h,V),this._syncStartSizeCreation(),this}removeStartSizeGradient(Z){return this._removeFactorGradient(this._startSizeGradients,Z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Z=new Uint8Array(4*this._rawTextureWidth),h=K.TmpColors.Ih[0];for(let V=0;V<this._rawTextureWidth;V++){const v=V/this._rawTextureWidth;J.GetCurrentGradient(v,this._rampGradients,((v,A,H)=>{K.Ih.LerpToRef(v.color,A.color,H,h),Z[4*V]=255*h.r,Z[4*V+1]=255*h.g,Z[4*V+2]=255*h.b,Z[4*V+3]=255}))}this._rampGradientsTexture=p.d.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Z,h)=>Z.gradient<h.gradient?-1:Z.gradient>h.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Z,h){this._rampGradients||(this._rampGradients=[]);const V=new O(Z,h);return this._rampGradients.push(V),this._syncRampGradientTexture(),this}removeRampGradient(Z){return this._removeGradientAndTexture(Z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Z,h,V){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=HZ,this._colorProcessing.process=KZ);const v=new M(Z,h,V);return this._colorGradients.push(v),this._colorGradients.sort(((Z,h)=>Z.gradient<h.gradient?-1:Z.gradient>h.gradient?1:0)),this}removeColorGradient(Z){if(!this._colorGradients)return this;let h=0;for(const V of this._colorGradients){if(V.gradient===Z){this._colorGradients.splice(h,1);break}h++}return 0===this._colorGradients.length&&(this._colorCreation.process=AZ,this._colorProcessing.process=dZ),this}resetDrawCache(){if(this._drawWrappers){for(const Z of this._drawWrappers)if(Z)for(const h of Z)null===h||void 0===h||h.dispose();this._drawWrappers=[]}}_fetchR(Z,h,V,v,A){return A[4*(((Z=.5*Math.abs(Z)+.5)*V%V|0)+((h=.5*Math.abs(h)+.5)*v%v|0)*V)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Z=this._engine,h=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*h),this._vertexBuffer=new j.b(Z,this._vertexData,!0,h);let V=0;const v=this._vertexBuffer.createVertexBuffer(j.f.PositionKind,V,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.f.PositionKind]=v,V+=3;const A=this._vertexBuffer.createVertexBuffer(j.f.ColorKind,V,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.f.ColorKind]=A,V+=4;const H=this._vertexBuffer.createVertexBuffer("angle",V,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=H,V+=1;const K=this._vertexBuffer.createVertexBuffer("size",V,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=K,V+=2,this._isAnimationSheetEnabled){const Z=this._vertexBuffer.createVertexBuffer("cellIndex",V,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Z,V+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Z=this._vertexBuffer.createVertexBuffer("direction",V,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Z,V+=3}if(this._useRampGradients){const Z=this._vertexBuffer.createVertexBuffer("remapData",V,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Z,V+=4}let d;if(this._useInstancing){const h=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new j.b(Z,h,!1,2),d=this._spriteBuffer.createVertexBuffer("offset",0,2)}else d=this._vertexBuffer.createVertexBuffer("offset",V,2,this._vertexBufferSize,this._useInstancing),V+=2;this._vertexBuffers.offset=d,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Z=[],h=[];let V=0;for(let v=0;v<this._capacity;v++)Z.push(V),Z.push(V+1),Z.push(V+2),Z.push(V),Z.push(V+2),Z.push(V+3),h.push(V,V+1,V+1,V+2,V+2,V+3,V+3,V,V,V+3),V+=4;this._indexBuffer=this._engine.createIndexBuffer(Z),this._linesIndexBuffer=this._engine.createIndexBuffer(h)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Z)setTimeout((()=>{this.start(0)}),Z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var h;-1!==(null===(h=this.Ah)||void 0===h?void 0:h.getClassName().indexOf("Mesh"))&&this.Ah.sh(!0);const Z=this.noiseTexture;if(Z&&Z.onGeneratedObservable)Z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),Z.render()}))}));else for(let h=0;h<this.preWarmCycles;h++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Z))}_postStop(Z){}reset(){this._stockParticles.length=0,this.qD.length=0}_appendParticleVertex(Z,h,V,A){let H=Z*this._vertexBufferSize;if(this._vertexData[H++]=h.position.x+this.Sn.x,this._vertexData[H++]=h.position.y+this.Sn.y,this._vertexData[H++]=h.position.z+this.Sn.z,this._vertexData[H++]=h.color.r,this._vertexData[H++]=h.color.g,this._vertexData[H++]=h.color.b,this._vertexData[H++]=h.color.a,this._vertexData[H++]=h.angle,this._vertexData[H++]=h.scale.x*h.size,this._vertexData[H++]=h.scale.y*h.size,this._isAnimationSheetEnabled&&(this._vertexData[H++]=h.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[H++]=h.direction.x,this._vertexData[H++]=h.direction.y,this._vertexData[H++]=h.direction.z);else if(h._initialDirection){let Z=h._initialDirection;this.isLocal&&(v.Ch.TransformNormalToRef(Z,this._emitterWorldMatrix,v.TmpVectors.Ch[0]),Z=v.TmpVectors.Ch[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[H++]=Z.x,this._vertexData[H++]=Z.y,this._vertexData[H++]=Z.z}else{let Z=h.direction;this.isLocal&&(v.Ch.TransformNormalToRef(Z,this._emitterWorldMatrix,v.TmpVectors.Ch[0]),Z=v.TmpVectors.Ch[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[H++]=Z.x,this._vertexData[H++]=Z.y,this._vertexData[H++]=Z.z}this._useRampGradients&&h.remapData&&(this._vertexData[H++]=h.remapData.x,this._vertexData[H++]=h.remapData.y,this._vertexData[H++]=h.remapData.z,this._vertexData[H++]=h.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===V?V=this._epsilon:1===V&&(V=1-this._epsilon),0===A?A=this._epsilon:1===A&&(A=1-this._epsilon)),this._vertexData[H++]=V,this._vertexData[H++]=A)}_prepareParticle(Z){}_createNewOnes(Z){let h;for(let V=0;V<Z&&this.qD.length!==this._capacity;V++){h=this._createParticle(),this.qD.push(h);let Z=this._createQueueStart;for(;Z;)Z.process(h,this),Z=Z.nextItem;h._inheritParticleInfoToSubEmitters()}}_update(Z){if(this._alive=this.qD.length>0,this.Ah.position){const Z=this.Ah;this._emitterWorldMatrix=Z.getWorldMatrix()}else{const Z=this.Ah;this._emitterWorldMatrix=v.Matrix.Translation(Z.x,Z.y,Z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.qD),this._createNewOnes(Z)}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=[j.f.PositionKind,j.f.ColorKind,"angle","offset","size"];return Z&&v.push("cellIndex"),h||v.push("direction"),V&&v.push("remapData"),v}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,hZ.c)(v),Z&&v.push("particlesInfos"),h&&v.push("logarithmicDepthConstant"),V&&(v.push("vFogInfos"),v.push("vFogColor")),v}fillDefines(Z,h){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hZ.j)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Z.push("#define FOG")),this._isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),h===a.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case 2:Z.push("#define BILLBOARDY");break;case 8:case 9:Z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Z.push("#define BILLBOARDMODE_ALL")}V&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,h,V){h.push(...cZ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Z.push(...cZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),V.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,vZ.e)(Z,this._imageProcessingConfigurationDefines),(0,vZ.d)(V,this._imageProcessingConfigurationDefines))}_getWrapper(Z){const h=this._getCustomDrawWrapper(Z);if(null!==h&&void 0!==h&&h.effect)return h;const V=[];this.fillDefines(V,Z);const v=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let A=this._drawWrappers[v];A||(A=this._drawWrappers[v]=[]);let H=A[Z];H||(H=new ZZ.e(this._engine),H.drawContext&&(H.drawContext.useInstancing=this._useInstancing),A[Z]=H);const K=V.join("\n");if(H.defines!==K){const Z=[],h=[],V=[];this.fillUniformsAttributesAndSamplerNames(h,Z,V),H.setEffect(this._engine.createEffect("particles",Z,h,V,K,void 0,void 0,void 0,void 0,this._shaderLanguage),K)}return H}animate(){var Z;let h,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!V&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(V?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this.manualEmitCount>-1)h=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const h=this._actualFrame/this.targetStopDuration;J.GetCurrentGradient(h,this._emitRateGradients,((h,V,v)=>{h!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=V.getFactor(),this._currentEmitRateGradient=h),Z=(0,n.Lerp)(this._currentEmitRate1,this._currentEmitRate2,v)}))}h=Z*this._scaledUpdateSpeed|0,this._newPartsExcess+=Z*this._scaledUpdateSpeed-h}if(this._newPartsExcess>1&&(h+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?h=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(h),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!V){let Z=0;for(let h=0;h<this.qD.length;h++){const V=this.qD[h];this._appendParticleVertices(Z,V),Z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.qD.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Z,h){this._appendParticleVertex(Z++,h,0,0),this._useInstancing||(this._appendParticleVertex(Z++,h,1,0),this._appendParticleVertex(Z++,h,1,1),this._appendParticleVertex(Z++,h,0,1))}rebuild(){var Z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Z=this._spriteBuffer)||void 0===Z||Z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!cZ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(V.bind(V,13220)),Promise.resolve().then(V.bind(V,13169))])):await Promise.all([Promise.resolve().then(V.bind(V,13162)),Promise.resolve().then(V.bind(V,13149))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Ah||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==a.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(a.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(a.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Z){const h=this._getWrapper(Z),V=h.effect,A=this._engine;A.enableEffect(h);const H=this.defaultViewMatrix??this._scene.getViewMatrix();if(V.setTexture("diffuseSampler",this.particleTexture),V.setMatrix("view",H),V.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();V.setFloat3("particlesInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,this.spriteCellWidth/Z.width)}if(V.setVector2("translationPivot",this.translationPivot),V.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;V.setVector3("eyePosition",Z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),V.setTexture("rampSampler",this._rampGradientsTexture));const K=V.defines;var d,a,n,x,N,D;(this._scene&&((0,hZ.e)(V,this,this._scene),this.applyFog&&(0,VZ.d)(this._scene,void 0,V)),K.indexOf("#define BILLBOARDMODE_ALL")>=0&&(H.invertToRef(v.TmpVectors.Matrix[0]),V.setMatrix("invView",v.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?A.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,V):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,V)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?A.bindBuffers(this._vertexBuffers,null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._linesIndexBuffer:this._indexBuffer,V):A.bindBuffers(this._vertexBuffers,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null,V);(this.useLogarithmicDepth&&this._scene&&(0,VZ.k)(K,V,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(V),this._setEngineBasedOnBlendMode(Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(V),this._useInstancing)?null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?A.drawElementsType(6,0,10,this.qD.length):A.drawArraysType(7,0,4,this.qD.length):null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?A.drawElementsType(1,0,10*this.qD.length):A.drawElementsType(0,0,6*this.qD.length);return this.qD.length}render(){if(!this.isReady()||!this.qD.length)return 0;const Z=this._engine;Z.setState&&(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0));let h=0;return h=this.blendMode===a.BLENDMODE_MULTIPLYADD?this._render(a.BLENDMODE_MULTIPLY)+this._render(a.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),h}_onDispose(){}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(h,V),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Z=this._scene.bD.indexOf(this);Z>-1&&this._scene.bD.splice(Z,1),this._scene._activeParticleSystems.dispose()}this.jh.notifyObservers(this),this.jh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}cZ.ForceGLSL=!1;var iZ,MZ=V(11594);!function(Z){Z[Z.ATTACHED=0]="ATTACHED",Z[Z.END=1]="END"}(iZ||(iZ={}));class OZ{constructor(Z){if(this.particleSystem=Z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Z.Ah||!Z.Ah.dispose){const h=(0,d.e)("BABYLON.AbstractMesh");Z.Ah=new h("SubemitterSystemEmitter",Z.CZ()),Z._disposeEmitterOnDispose=!0}}clone(){let Z=this.particleSystem.Ah;if(Z){if(Z instanceof v.Ch)Z=Z.clone();else if(-1!==Z.getClassName().indexOf("Mesh")){Z=new((0,d.e)("BABYLON.Mesh"))("",Z.CZ()),Z.isVisible=!1}}else Z=new v.Ch;const h=new OZ(this.particleSystem.clone(this.particleSystem.name,Z));return h.particleSystem.name+="Clone",h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem._disposeEmitterOnDispose=!0,h.particleSystem.disposeOnStop=!0,h}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem=this.particleSystem.serialize(Z),h}static _ParseParticleSystem(Z,h,V){throw(0,MZ.d)("ParseParticle")}static Parse(Z,h,V){const v=Z.particleSystem,A=new OZ(OZ._ParseParticleSystem(v,h,V,!0));return A.type=Z.type,A.inheritDirection=Z.inheritDirection,A.inheritedVelocityAmount=Z.inheritedVelocityAmount,A.particleSystem._isSubEmitter=!0,A}dispose(){this.particleSystem.dispose()}}var sZ=V(11635);function JZ(Z,h){const V=new o;return V.direction1=Z,V.direction2=h,V}function fZ(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function pZ(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function YZ(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.Ch(0,1,0),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0);return new X(Z,h,V)}function GZ(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Zh(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0),H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.Ch(0,1,0);return new F(Z,h,V,A,H)}function hh(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new D(Z,h)}function Vh(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0);return new k(Z,h,V,A)}const vh=v.Ch.Zero(),Ah=v.Ch.Zero(),Hh=v.Ch.Zero();class Kh{constructor(){this.strength=0,this.position=v.Ch.Zero()}_processParticle(Z,h){this.position.subtractToRef(Z.position,vh);const V=vh.lengthSquared()+1;vh.normalize().scaleToRef(this.strength/V,Ah),Ah.scaleToRef(h._tempScaledUpdateSpeed,Hh),Z.direction.addInPlace(Hh)}serialize(){return{position:this.position.mh(),strength:this.strength}}}class dh extends cZ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const h=Math.floor(Math.random()*this._subEmitters.length);for(const V of this._subEmitters[h])if(1===V.type){const h=V.clone();Z._inheritParticleInfoToSubEmitter(h),h.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(h.particleSystem),h.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Z,h){const V=JZ(Z,h);return this.particleEmitterType=V,V}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z,this._flowMapUpdate&&(tZ(this._flowMapUpdate),this._flowMapUpdate=null),Z&&(this._flowMapUpdate={process:Z=>{var h;const V=null===(h=this.CZ())||void 0===h?void 0:h.getTransformMatrix();this._flowMap._processParticle(Z,this.flowMapStrength*this._tempScaledUpdateSpeed,V)},previousItem:null,nextItem:null},wZ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Z){this._attractors.push(Z),1===this._attractors.length&&(this._attractorUpdate={process:Z=>{for(const h of this._attractors)h._processParticle(Z,this)},previousItem:null,nextItem:null},wZ(this._attractorUpdate,this._directionProcessing))}removeAttractor(Z){const h=this._attractors.indexOf(Z);-1!==h&&this._attractors.splice(h,1),0===this._attractors.length&&tZ(this._attractorUpdate)}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Z)}createHemisphericEmitter(){const Z=fZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=pZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=YZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.Ch(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=GZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.Ch(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Vh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,h,V,v){const A=new N;return this.particleEmitterType=A,this.direction1=Z,this.direction2=h,this.minEmitBox=V,this.maxEmitBox=v,A}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Z of this.subEmitters)Z instanceof dh?this._subEmitters.push([new OZ(Z)]):Z instanceof OZ?this._subEmitters.push([Z]):Z instanceof Array&&this._subEmitters.push(Z)}_stopSubEmitters(){if(this.activeSubSystems){for(const Z of this.activeSubSystems)Z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Z&&this._rootParticleSystem.activeSubSystems.splice(Z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Z){Z&&this._stopSubEmitters()}_prepareParticle(Z){if(this._subEmitters&&this._subEmitters.length>0){const h=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Z._attachedSubEmitters=[];for(const V of h)if(0===V.type){const h=V.clone();Z._attachedSubEmitters.push(h),h.particleSystem.start()}}}_onDispose(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Z&&this.particles)for(const V of this.particles)if(V._attachedSubEmitters)for(let Z=V._attachedSubEmitters.length-1;Z>=0;Z-=1)V._attachedSubEmitters[Z].dispose();if(h&&this.activeSubSystems)for(let V=this.activeSubSystems.length-1;V>=0;V-=1)this.activeSubSystems[V].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Z=0;Z<this._subEmitters.length;Z++)for(const h of this._subEmitters[Z])h.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Ah&&this.Ah.dispose&&this.Ah.dispose(!0)}static _Parse(Z,h,V,A){let H;H=V instanceof sZ.d?null:V;const a=(0,d.e)("BABYLON.Texture");if(a&&H&&(Z.texture?h.particleTexture=a.Parse(Z.texture,H,A):Z.textureName&&(h.particleTexture=new a(A+Z.textureName,H,!1,void 0===Z.invertY||Z.invertY),h.particleTexture.name=Z.textureName)),Z.emitterId||0===Z.emitterId||void 0!==Z.Ah?Z.emitterId&&H?h.Ah=H.getLastMeshById(Z.emitterId):h.Ah=v.Ch.eh(Z.Ah):h.Ah=v.Ch.Zero(),h.isLocal=!!Z.isLocal,void 0!==Z.renderingGroupId&&(h.renderingGroupId=Z.renderingGroupId),void 0!==Z.isBillboardBased&&(h.isBillboardBased=Z.isBillboardBased),void 0!==Z.billboardMode&&(h.billboardMode=Z.billboardMode),void 0!==Z.useLogarithmicDepth&&(h.useLogarithmicDepth=Z.useLogarithmicDepth),Z.animations){for(let V=0;V<Z.animations.length;V++){const v=Z.animations[V],A=(0,d.e)("BABYLON.Animation");A&&h.animations.push(A.Parse(v))}h.beginAnimationOnStart=Z.beginAnimationOnStart,h.beginAnimationFrom=Z.beginAnimationFrom,h.beginAnimationTo=Z.beginAnimationTo,h.beginAnimationLoop=Z.beginAnimationLoop}if(Z.autoAnimate&&H&&H.beginAnimation(h,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),h.startDelay=0|Z.startDelay,h.minAngularSpeed=Z.minAngularSpeed,h.maxAngularSpeed=Z.maxAngularSpeed,h.minSize=Z.minSize,h.maxSize=Z.maxSize,Z.minScaleX&&(h.minScaleX=Z.minScaleX,h.maxScaleX=Z.maxScaleX,h.minScaleY=Z.minScaleY,h.maxScaleY=Z.maxScaleY),void 0!==Z.preWarmCycles&&(h.preWarmCycles=Z.preWarmCycles,h.preWarmStepOffset=Z.preWarmStepOffset),void 0!==Z.minInitialRotation&&(h.minInitialRotation=Z.minInitialRotation,h.maxInitialRotation=Z.maxInitialRotation),h.minLifeTime=Z.minLifeTime,h.maxLifeTime=Z.maxLifeTime,h.minEmitPower=Z.minEmitPower,h.maxEmitPower=Z.maxEmitPower,h.emitRate=Z.emitRate,h.gravity=v.Ch.eh(Z.gravity),Z.noiseStrength&&(h.noiseStrength=v.Ch.eh(Z.noiseStrength)),h.color1=K.nd.eh(Z.color1),h.color2=K.nd.eh(Z.color2),h.colorDead=K.nd.eh(Z.colorDead),h.updateSpeed=Z.updateSpeed,h.targetStopDuration=Z.targetStopDuration,h.blendMode=Z.blendMode,Z.colorGradients)for(const v of Z.colorGradients)h.addColorGradient(v.gradient,K.nd.eh(v.color1),v.color2?K.nd.eh(v.color2):void 0);if(Z.rampGradients){for(const V of Z.rampGradients)h.addRampGradient(V.gradient,K.Ih.eh(V.color));h.useRampGradients=Z.useRampGradients}if(Z.colorRemapGradients)for(const v of Z.colorRemapGradients)h.addColorRemapGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.alphaRemapGradients)for(const v of Z.alphaRemapGradients)h.addAlphaRemapGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.sizeGradients)for(const v of Z.sizeGradients)h.addSizeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.angularSpeedGradients)for(const v of Z.angularSpeedGradients)h.addAngularSpeedGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.velocityGradients)for(const v of Z.velocityGradients)h.addVelocityGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.dragGradients)for(const v of Z.dragGradients)h.addDragGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.emitRateGradients)for(const v of Z.emitRateGradients)h.addEmitRateGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.startSizeGradients)for(const v of Z.startSizeGradients)h.addStartSizeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.lifeTimeGradients)for(const v of Z.lifeTimeGradients)h.addLifeTimeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(Z.limitVelocityGradients){for(const V of Z.limitVelocityGradients)h.addLimitVelocityGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);h.limitVelocityDamping=Z.limitVelocityDamping}if(Z.noiseTexture&&H){const V=(0,d.e)("BABYLON.ProceduralTexture");h.noiseTexture=V.Parse(Z.noiseTexture,H,A)}let n;if(Z.particleEmitterType){switch(Z.particleEmitterType.type){case"SphereParticleEmitter":n=new q;break;case"SphereDirectedParticleEmitter":n=new X;break;case"ConeEmitter":case"ConeParticleEmitter":n=new D;break;case"ConeDirectedParticleEmitter":n=new k;break;case"CylinderParticleEmitter":n=new u;break;case"CylinderDirectedParticleEmitter":n=new F;break;case"HemisphericParticleEmitter":n=new b;break;case"PointParticleEmitter":n=new o;break;case"MeshParticleEmitter":n=new P;break;case"CustomParticleEmitter":n=new E;break;default:n=new N}n.parse(Z.particleEmitterType,H)}else n=new N,n.parse(Z,H);h.particleEmitterType=n,h.startSpriteCellID=Z.startSpriteCellID,h.endSpriteCellID=Z.endSpriteCellID,h.spriteCellLoop=Z.spriteCellLoop??!0,h.spriteCellWidth=Z.spriteCellWidth,h.spriteCellHeight=Z.spriteCellHeight,h.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,h.spriteRandomStartCell=Z.spriteRandomStartCell,h.disposeOnStop=Z.disposeOnStop??!1,h.manualEmitCount=Z.manualEmitCount??-1}static Parse(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0;const d=Z.name;let a,n,x=null,N=null;if(h instanceof sZ.d?a=h:(n=h,a=n.getEngine()),Z.customShader&&a.createEffectForParticles){N=Z.customShader;const h=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";x=a.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,h)}const D=new dh(d,H||Z.Th,h,x,Z.isAnimationSheetEnabled);if(D.customShader=N,D._rootUrl=V,Z.id&&(D.id=Z.id),Z.subEmitters){D.subEmitters=[];for(const v of Z.subEmitters){const Z=[];for(const A of v)Z.push(OZ.Parse(A,h,V));D.subEmitters.push(Z)}}if(Z.attractors)for(const K of Z.attractors){const Z=new Kh;Z.position=v.Ch.eh(K.position),Z.strength=K.strength,D.addAttractor(Z)}return dh._Parse(Z,D,h,V),Z.textureMask&&(D.textureMask=K.nd.eh(Z.textureMask)),Z.Sn&&(D.Sn=v.Ch.eh(Z.Sn)),Z.preventAutoStart&&(D.preventAutoStart=Z.preventAutoStart),A||D.preventAutoStart||D.start(),D}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};if(dh._Serialize(h,this,Z),h.textureMask=this.textureMask.mh(),h.customShader=this.customShader,h.preventAutoStart=this.preventAutoStart,h.Sn=this.Sn.mh(),this.subEmitters){h.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const V of this._subEmitters){const v=[];for(const h of V)v.push(h.serialize(Z));h.subEmitters.push(v)}}if(this._attractors&&this._attractors.length){h.attractors=[];for(const Z of this._attractors)h.attractors.push(Z.serialize())}return h}static _Serialize(Z,h,V){if(Z.name=h.name,Z.id=h.id,Z.Th=h.getCapacity(),Z.disposeOnStop=h.disposeOnStop,Z.manualEmitCount=h.manualEmitCount,h.Ah.position){const V=h.Ah;Z.emitterId=V.id}else{const V=h.Ah;Z.Ah=V.mh()}h.particleEmitterType&&(Z.particleEmitterType=h.particleEmitterType.serialize()),h.particleTexture&&(V?Z.texture=h.particleTexture.serialize():(Z.textureName=h.particleTexture.name,Z.invertY=!!h.particleTexture._invertY)),Z.isLocal=h.isLocal,m.b.AppendSerializedAnimations(h,Z),Z.beginAnimationOnStart=h.beginAnimationOnStart,Z.beginAnimationFrom=h.beginAnimationFrom,Z.beginAnimationTo=h.beginAnimationTo,Z.beginAnimationLoop=h.beginAnimationLoop,Z.startDelay=h.startDelay,Z.renderingGroupId=h.renderingGroupId,Z.isBillboardBased=h.isBillboardBased,Z.billboardMode=h.billboardMode,Z.minAngularSpeed=h.minAngularSpeed,Z.maxAngularSpeed=h.maxAngularSpeed,Z.minSize=h.minSize,Z.maxSize=h.maxSize,Z.minScaleX=h.minScaleX,Z.maxScaleX=h.maxScaleX,Z.minScaleY=h.minScaleY,Z.maxScaleY=h.maxScaleY,Z.minEmitPower=h.minEmitPower,Z.maxEmitPower=h.maxEmitPower,Z.minLifeTime=h.minLifeTime,Z.maxLifeTime=h.maxLifeTime,Z.emitRate=h.emitRate,Z.gravity=h.gravity.mh(),Z.noiseStrength=h.noiseStrength.mh(),Z.color1=h.color1.mh(),Z.color2=h.color2.mh(),Z.colorDead=h.colorDead.mh(),Z.updateSpeed=h.updateSpeed,Z.targetStopDuration=h.targetStopDuration,Z.blendMode=h.blendMode,Z.preWarmCycles=h.preWarmCycles,Z.preWarmStepOffset=h.preWarmStepOffset,Z.minInitialRotation=h.minInitialRotation,Z.maxInitialRotation=h.maxInitialRotation,Z.startSpriteCellID=h.startSpriteCellID,Z.spriteCellLoop=h.spriteCellLoop,Z.endSpriteCellID=h.endSpriteCellID,Z.spriteCellChangeSpeed=h.spriteCellChangeSpeed,Z.spriteCellWidth=h.spriteCellWidth,Z.spriteCellHeight=h.spriteCellHeight,Z.spriteRandomStartCell=h.spriteRandomStartCell,Z.isAnimationSheetEnabled=h.isAnimationSheetEnabled,Z.useLogarithmicDepth=h.useLogarithmicDepth;const v=h.getColorGradients();if(v){Z.colorGradients=[];for(const h of v){const V={gradient:h.gradient,color1:h.color1.mh()};h.color2?V.color2=h.color2.mh():V.color2=h.color1.mh(),Z.colorGradients.push(V)}}const A=h.getRampGradients();if(A){Z.rampGradients=[];for(const h of A){const V={gradient:h.gradient,color:h.color.mh()};Z.rampGradients.push(V)}Z.useRampGradients=h.useRampGradients}const H=h.getColorRemapGradients();if(H){Z.colorRemapGradients=[];for(const h of H){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.colorRemapGradients.push(V)}}const K=h.getAlphaRemapGradients();if(K){Z.alphaRemapGradients=[];for(const h of K){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.alphaRemapGradients.push(V)}}const d=h.getSizeGradients();if(d){Z.sizeGradients=[];for(const h of d){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.sizeGradients.push(V)}}const a=h.getAngularSpeedGradients();if(a){Z.angularSpeedGradients=[];for(const h of a){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.angularSpeedGradients.push(V)}}const n=h.getVelocityGradients();if(n){Z.velocityGradients=[];for(const h of n){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.velocityGradients.push(V)}}const x=h.getDragGradients();if(x){Z.dragGradients=[];for(const h of x){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.dragGradients.push(V)}}const N=h.getEmitRateGradients();if(N){Z.emitRateGradients=[];for(const h of N){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.emitRateGradients.push(V)}}const D=h.getStartSizeGradients();if(D){Z.startSizeGradients=[];for(const h of D){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.startSizeGradients.push(V)}}const k=h.getLifeTimeGradients();if(k){Z.lifeTimeGradients=[];for(const h of k){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.lifeTimeGradients.push(V)}}const u=h.getLimitVelocityGradients();if(u){Z.limitVelocityGradients=[];for(const h of u){const V={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?V.factor2=h.factor2:V.factor2=h.factor1,Z.limitVelocityGradients.push(V)}Z.limitVelocityDamping=h.limitVelocityDamping}h.noiseTexture&&(Z.noiseTexture=h.noiseTexture.serialize())}clone(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v={...this._customWrappers};let A=null;const H=this._engine;if(H.createEffectForParticles&&null!=this.customShader){A=this.customShader;const Z=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",h=H.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,Z);v[0]?v[0].effect=h:this.setCustomEffect(h,0)}const K=this.serialize(V),d=dh.Parse(K,this._scene||this._engine,this._rootUrl);return d.name=Z,d.customShader=A,d._customWrappers=v,void 0===h&&(h=this.Ah),this.noiseTexture&&(d.noiseTexture=this.noiseTexture.clone()),d.Ah=h,this.preventAutoStart||d.start(),d}}dh.BILLBOARDMODE_Y=2,dh.BILLBOARDMODE_ALL=7,dh.BILLBOARDMODE_STRETCHED=8,dh.BILLBOARDMODE_STRETCHED_LOCAL=9,OZ._ParseParticleSystem=dh.Parse;var ah=V(11989),nh=V(11983),xh=V(11870);xh.b.prototype.createTransformFeedback=function(){const Z=this._gl.createTransformFeedback();if(!Z)throw new Error("Unable to create Transform Feedback");return Z},xh.b.prototype.deleteTransformFeedback=function(Z){this._gl.deleteTransformFeedback(Z)},xh.b.prototype.bindTransformFeedback=function(Z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Z)},xh.b.prototype.beginTransformFeedback=function(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Z?this._gl.POINTS:this._gl.TRIANGLES)},xh.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},xh.b.prototype.setTranformFeedbackVaryings=function(Z,h){this._gl.transformFeedbackVaryings(Z,h,this._gl.INTERLEAVED_ATTRIBS)},xh.b.prototype.bindTransformFeedbackBuffer=function(Z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z?Z.underlyingResource:null)},xh.b.prototype.readTransformFeedbackBuffer=function(Z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z)};const Nh="clipPlaneFragmentDeclaration2",Dh="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";l.c.IncludesShadersStore[Nh]||(l.c.IncludesShadersStore[Nh]=Dh);V(13061),V(13067),V(13073),V(13077),V(13079),V(13086),V(13093),V(13095);const kh="gpuRenderParticlesPixelShader",uh="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";l.c.ShadersStore[kh]||(l.c.ShadersStore[kh]=uh);const Fh="clipPlaneVertexDeclaration2",bh="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";l.c.IncludesShadersStore[Fh]||(l.c.IncludesShadersStore[Fh]=bh);V(13100),V(13103),V(13112),V(13114);const oh="gpuRenderParticlesVertexShader",qh="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";l.c.ShadersStore[oh]||(l.c.ShadersStore[oh]=qh);class Xh extends a{static get IsSupported(){if(!Y.b.LastCreatedEngine)return!1;const Z=Y.b.LastCreatedEngine.getCaps();return Z.supportTransformFeedbacks||Z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Z){this._maxActiveParticleCount=Math.min(Z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Z){this.maxActiveParticleCount=Z}createPointEmitter(Z,h){const V=JZ(Z,h);return this.particleEmitterType=V,V}createHemisphericEmitter(){const Z=fZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=pZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=YZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.Ch(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=GZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.Ch(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Vh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.Ch(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.Ch(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,h,V,v){const A=new N;return this.particleEmitterType=A,this.direction1=Z,this.direction2=h,this.minEmitBox=V,this.maxEmitBox=v,A}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z)}isReady(){if(!this.Ah||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==dh.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(dh.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(dh.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Z?setTimeout((()=>{this.start(0)}),Z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Z;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[h])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new ZZ.e(this._engine),this._customWrappers[h].effect=Z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Z,h,V){return super._removeGradientAndTexture(Z,h,V),this._releaseBuffers(),this}addColorGradient(Z,h){this._colorGradients||(this._colorGradients=[]);const V=new M(Z,h);return this._colorGradients.push(V),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Z&&this._colorGradients.sort(((Z,h)=>Z.gradient<h.gradient?-1:Z.gradient>h.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Z){return this._removeGradientAndTexture(Z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const h in this._drawWrappers){var Z;null===(Z=this._drawWrappers[h].drawContext)||void 0===Z||Z.reset()}}_addFactorGradient(Z,h,V){const v=new s(h,V);Z.push(v),this._releaseBuffers()}addSizeGradient(Z,h){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,h),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Z){return this._removeGradientAndTexture(Z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Z,h){if(!Z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Z.sort(((Z,h)=>Z.gradient<h.gradient?-1:Z.gradient>h.gradient?1:0));const V=this;V[h]&&(V[h].dispose(),V[h]=null)}addAngularSpeedGradient(Z,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,h),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Z){return this._removeGradientAndTexture(Z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Z,h){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,h),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Z,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,h),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Z,h){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,h),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Z){return this._removeGradientAndTexture(Z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.jh=new f.b,this.onStoppedObservable=new f.b,this.onStartedObservable=new f.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,V&&"Scene"!==V.getClassName()?(this._engine=V,this.defaultProjectionMatrix=v.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=V||Y.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.bD.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,d.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,d.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,d.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,d.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ZZ.e(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers={0:new ZZ.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(h=h??{}).randomTextureSize||delete h.randomTextureSize;const K={Th:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...h},a=h;isFinite(a)&&(K.Th=a),this._capacity=K.Th,this._maxActiveParticleCount=K.Th,this._currentActiveCount=0,this._isAnimationSheetEnabled=H,this.particleEmitterType=new N;const n=Math.min(this._engine.getCaps().maxTextureSize,K.randomTextureSize);let x=[];for(let v=0;v<n;++v)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture=new p.d(new Float32Array(x),n,1,5,V,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,x=[];for(let v=0;v<n;++v)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture2=new p.d(new Float32Array(x),n,1,5,V,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=n}_reset(){this._releaseBuffers()}_createVertexBuffers(Z,h,V){const v={};v.position=h.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let A=3;v.age=h.createVertexBuffer("age",A,1,this._attributesStrideSize,!0),A+=1,v.size=h.createVertexBuffer("size",A,3,this._attributesStrideSize,!0),A+=3,v.life=h.createVertexBuffer("life",A,1,this._attributesStrideSize,!0),A+=1,A+=4,this.billboardMode===dh.BILLBOARDMODE_STRETCHED&&(v.direction=h.createVertexBuffer("direction",A,3,this._attributesStrideSize,!0)),A+=3,this._platform.alignDataInBuffer&&(A+=1),this.particleEmitterType instanceof E&&(A+=3,this._platform.alignDataInBuffer&&(A+=1)),this._colorGradientsTexture||(v.color=h.createVertexBuffer("color",A,4,this._attributesStrideSize,!0),A+=4),this._isBillboardBased||(v.initialDirection=h.createVertexBuffer("initialDirection",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),this.noiseTexture&&(v.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1),v.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),v.angle=h.createVertexBuffer("angle",A,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?A++:A+=2,this._isAnimationSheetEnabled&&(v.cellIndex=h.createVertexBuffer("cellIndex",A,1,this._attributesStrideSize,!0),A+=1,this.spriteRandomStartCell&&(v.cellStartOffset=h.createVertexBuffer("cellStartOffset",A,1,this._attributesStrideSize,!0),A+=1)),v.offset=V.createVertexBuffer("offset",0,2),v.uv=V.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(v),this._platform.createVertexBuffers(Z,v),this.resetDrawCache()}_initialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Z)return;const h=this._engine,V=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const A=this.particleEmitterType instanceof E,H=v.TmpVectors.Ch[0];let K=0;for(let v=0;v<this._capacity;v++)if(V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),A?(this.particleEmitterType.particleDestinationGenerator(v,null,H),V.push(H.x),V.push(H.y),V.push(H.z)):(V.push(0),V.push(0),V.push(0)),this._platform.alignDataInBuffer&&V.push(0),K+=16,A&&(this.particleEmitterType.particlePositionGenerator(v,null,H),V.push(H.x),V.push(H.y),V.push(H.z),this._platform.alignDataInBuffer&&V.push(0),K+=4),this._colorGradientsTexture||(V.push(0),V.push(0),V.push(0),V.push(0),K+=4),this.isBillboardBased||(V.push(0),V.push(0),V.push(0),this._platform.alignDataInBuffer&&V.push(0),K+=4),this.noiseTexture&&(V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),this._platform.alignDataInBuffer&&V.push(0),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),this._platform.alignDataInBuffer&&V.push(0),K+=8),V.push(0),K+=1,this._angularSpeedGradientsTexture||(V.push(0),K+=1),this._isAnimationSheetEnabled&&(V.push(0),K+=1,this.spriteRandomStartCell&&(V.push(0),K+=1)),this._platform.alignDataInBuffer){let Z=3-(K+3&3);for(K+=Z;Z-- >0;)V.push(0)}const d=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),a=this._platform.createParticleBuffer(V),n=this._platform.createParticleBuffer(V);this._buffer0=new j.b(h,a,!1,this._attributesStrideSize),this._buffer1=new j.b(h,n,!1,this._attributesStrideSize),this._spriteBuffer=new j.b(h,d,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Z+="\n#define DRAGGRADIENTS"),this._flowMap&&(Z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Z+="\n#define NOISE"),this.isLocal&&(Z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Z||(this._cachedUpdateDefines=Z,this._updateBuffer=this._platform.createUpdateBuffer(Z)),this._platform.isUpdateBufferReady()}_getWrapper(Z){const h=this._getCustomDrawWrapper(Z);if(null!==h&&void 0!==h&&h.effect)return h;const V=[];this.fillDefines(V,Z);let v=this._drawWrappers[Z];v||(v=new ZZ.e(this._engine),v.drawContext&&(v.drawContext.useInstancing=!0),this._drawWrappers[Z]=v);const A=V.join("\n");if(v.defines!==A){const Z=[],h=[],V=[];this.fillUniformsAttributesAndSamplerNames(h,Z,V),v.setEffect(this._engine.createEffect("gpuRenderParticles",Z,h,V,A),A)}return v}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=[j.f.PositionKind,"age","life","size","angle"];return Z||A.push(j.f.ColorKind),h&&A.push("cellIndex"),V||A.push("initialDirection"),v&&A.push("direction"),A.push("offset",j.f.UVKind),A}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=["emitterWM","Sn","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,hZ.c)(v),Z&&v.push("sheetInfos"),h&&v.push("logarithmicDepthConstant"),V&&(v.push("vFogInfos"),v.push("vFogColor")),v}fillDefines(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hZ.j)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==nh.e.FOGMODE_NONE&&Z.push("#define FOG")),h===dh.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Z.push("#define LOCAL"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case dh.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case dh.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case dh.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),V&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,h,V){h.push(...Xh._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===dh.BILLBOARDMODE_STRETCHED)),Z.push(...Xh._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),V.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(ah.c.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),ah.c.PrepareSamplers(V,this._imageProcessingConfigurationDefines))}animate(){var Z;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(h?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Z,h){const V=this[h];if(!Z||!Z.length||V)return;const v=new Float32Array(this._rawTextureWidth);for(let A=0;A<this._rawTextureWidth;A++){const h=A/this._rawTextureWidth;J.GetCurrentGradient(h,Z,((Z,h,V)=>{v[A]=(0,n.Lerp)(Z.factor1,h.factor1,V)}))}this[h]=p.d.CreateRTexture(v,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[h].name=h.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Z=new Uint8Array(4*this._rawTextureWidth),h=K.TmpColors.nd[0];for(let V=0;V<this._rawTextureWidth;V++){const v=V/this._rawTextureWidth;J.GetCurrentGradient(v,this._colorGradients,((v,A,H)=>{K.nd.LerpToRef(v.color1,A.color1,H,h),Z[4*V]=255*h.r,Z[4*V+1]=255*h.g,Z[4*V+2]=255*h.b,Z[4*V+3]=255*h.a}))}this._colorGradientsTexture=p.d.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Z,h){var V,A,H,K;const d=this._getWrapper(Z),a=d.effect;this._engine.enableEffect(d);const n=(null===(V=this._scene)||void 0===V?void 0:V.getViewMatrix())||v.Matrix.IdentityReadOnly;if(a.setMatrix("view",n),a.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),a.setTexture("diffuseSampler",this.particleTexture),a.setVector2("translationPivot",this.translationPivot),a.setVector3("Sn",this.Sn),this.isLocal&&a.setMatrix("emitterWM",h),this._colorGradientsTexture?a.setTexture("colorGradientSampler",this._colorGradientsTexture):a.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();a.setFloat3("sheetInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,Z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;a.setVector3("eyePosition",Z.globalPosition)}const x=a.defines;if(this._scene&&((0,hZ.e)(a,this,this._scene),this.applyFog&&(0,VZ.d)(this._scene,void 0,a)),x.indexOf("#define BILLBOARDMODE_ALL")>=0){const Z=n.clone();Z.invert(),a.setMatrix("invView",Z)}return this.useLogarithmicDepth&&this._scene&&(0,VZ.k)(x,a,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(a),this._setEngineBasedOnBlendMode(Z),this._platform.bindDrawBuffers(this._targetIndex,a,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(a),null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(K=this._scene)&&void 0!==K&&K.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Z){if(!this.Ah||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Z)if(this.Ah.position){Z=this.Ah.getWorldMatrix()}else{const h=this.Ah;Z=v.TmpVectors.Matrix[0],v.Matrix.TranslationToRef(h.x,h.y,h.z,Z)}const h=this._engine,V=h.getDepthWrite();if(h.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Z=this.CZ();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const A=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=A,h.setDepthWrite(V)}render(){let Z,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!h&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Z=0|this._accumulatedCount;this._accumulatedCount-=Z,this._currentActiveCount+=Z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Ah.position){Z=this.Ah.getWorldMatrix()}else{const h=this.Ah;Z=v.TmpVectors.Matrix[0],v.Matrix.TranslationToRef(h.x,h.y,h.z,Z)}const A=this._engine;this.updateInAnimate||this._update(Z);let H=0;return h||V||(A.setState(!1),this.forceDepthWrite&&A.setDepthWrite(!0),H=this.blendMode===dh.BLENDMODE_MULTIPLYADD?this._render(dh.BLENDMODE_MULTIPLY,Z)+this._render(dh.BLENDMODE_ADD,Z):this._render(this.blendMode,Z),this._engine.setAlphaMode(0)),H}rebuild(){const Z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const h in this._drawWrappers){this._drawWrappers[h].dispose()}if(this._drawWrappers={},this._scene){const Z=this._scene.bD.indexOf(this);Z>-1&&this._scene.bD.splice(Z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let h=0;h<this._renderVertexBuffers.length;++h){const Z=this._renderVertexBuffers[h];for(const h in Z)Z[h].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.jh.notifyObservers(this),this.jh.clear()}clone(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v={...this._customWrappers};let A=null;const H=this._engine;if(H.createEffectForParticles&&null!=this.customShader){A=this.customShader;const Z=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";v[0]=H.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,Z,void 0,void 0,void 0,this)}const K=this.serialize(V),d=Xh.Parse(K,this._scene||this._engine,this._rootUrl);return d.name=Z,d.customShader=A,d._customWrappers=v,void 0===h&&(h=this.Ah),this.noiseTexture&&(d.noiseTexture=this.noiseTexture.clone()),d.Ah=h,d}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return dh._Serialize(h,this,Z),h.activeParticleCount=this.activeParticleCount,h.randomTextureSize=this._randomTextureSize,h.customShader=this.customShader,h}static Parse(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const H=Z.name;let K,d;h instanceof sZ.d?K=h:(d=h,K=d.getEngine());const a=new Xh(H,{Th:A||Z.Th,randomTextureSize:Z.randomTextureSize},h,null,Z.isAnimationSheetEnabled);if(a._rootUrl=V,Z.customShader&&K.createEffectForParticles){const h=Z.customShader,V=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",v=K.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,V,void 0,void 0,void 0,a);a.setCustomEffect(v,0),a.customShader=h}return Z.id&&(a.id=Z.id),Z.activeParticleCount&&(a.activeParticleCount=Z.activeParticleCount),dh._Parse(Z,a,h,V),Z.preventAutoStart&&(a.preventAutoStart=Z.preventAutoStart),v||a.preventAutoStart||a.start(),a}}var Eh=V(11564),jh=V(13121),Ph=V(12102);class Ch{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const h of this.systems)h.Ah=Z;this._emitterNode=Z}setEmitterAsSphere(Z,h,V){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Z,renderingGroupId:h};const v=(0,jh.d)("emitterSphere",{diameter:Z.diameter,segments:Z.segments},V);v.renderingGroupId=h;const A=new Ph.gh("emitterSphereMaterial",V);A.emissiveColor=Z.color,v.material=A;for(const H of this.systems)H.Ah=v;this._emitterNode=v}start(Z){for(const h of this.systems)Z&&(h.Ah=Z),h.start()}dispose(){for(const Z of this.systems)Z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={systems:[]};for(const V of this.systems)h.systems.push(V.serialize(Z));return this._emitterNode&&(h.Ah=this._emitterCreationOptions),h}static Parse(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;const A=new Ch,H=this.BaseAssetsUrl+"/textures/";h=h||Y.b.LastCreatedScene;for(const K of Z.systems)A.systems.push(V?Xh.Parse(K,h,H,!0,v):dh.Parse(K,h,H,!0,v));if(Z.Ah){const V=Z.Ah.options;if("Sphere"===Z.Ah.kind)A.setEmitterAsSphere({diameter:V.diameter,segments:V.segments,color:K.Ih.eh(V.color)},Z.Ah.renderingGroupId,h)}return A}}Ch.BaseAssetsUrl="https://assets.babylonjs.com/particles";var lh=V(11596);class Bh{static CreateDefault(Z){let h,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,v=arguments.length>2?arguments[2]:void 0;h=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Xh("default system",{Th:V},v):new dh("default system",V,v),h.Ah=Z;const A=Eh.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return h.particleTexture=new g.e(A,h.CZ()),h.createConeEmitter(.1,Math.PI/4),h.color1=new K.nd(1,1,1,1),h.color2=new K.nd(1,1,1,1),h.colorDead=new K.nd(1,1,1,0),h.minSize=.1,h.maxSize=.1,h.minEmitPower=2,h.maxEmitPower=2,h.updateSpeed=1/60,h.emitRate=30,h}static CreateAsync(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;h||(h=Y.b.LastCreatedScene);const A={};return h.addPendingData(A),new Promise(((H,K)=>{if(V&&!Xh.IsSupported)return h.removePendingData(A),K("Particle system with GPU is not supported.");Eh.Tools.LoadFile(`${Bh.BaseAssetsUrl}/systems/${Z}.json`,(Z=>{h.removePendingData(A);const K=JSON.parse(Z.toString());return H(Ch.Parse(K,h,V,v))}),void 0,void 0,void 0,(()=>(h.removePendingData(A),K(`An error occurred with the creation of your particle system. Check if your type '${Z}' exists.`))))}))}static ExportSet(Z){const h=new Ch;for(const V of Z)h.systems.push(V);return h}static ParseFromFileAsync(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",H=arguments.length>5?arguments[5]:void 0;return new Promise(((K,d)=>{const a=new lh.e;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const h=JSON.parse(a.responseText);let d;d=v?Xh.Parse(h,V,A,!1,H):dh.Parse(h,V,A,!1,H),Z&&(d.name=Z),K(d)}else d("Unable to load the particle system")})),a.open("GET",h),a.send()}))}static ParseFromSnippetAsync(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Z){const Z=this.CreateDefault(null);return Z.start(),Promise.resolve(Z)}return new Promise(((H,K)=>{const d=new lh.e;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const K=JSON.parse(JSON.parse(d.responseText).jsonPayload),a=JSON.parse(K.particleSystem);let n;n=V?Xh.Parse(a,h,v,!1,A):dh.Parse(a,h,v,!1,A),n.snippetId=Z,H(n)}else K("Unable to load the snippet "+Z)})),d.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),d.send()}))}}Bh.BaseAssetsUrl=Ch.BaseAssetsUrl,Bh.SnippetUrl="https://snippet.babylonjs.com",Bh.CreateFromSnippetAsync=Bh.ParseFromSnippetAsync;var Sh=V(12184),rh=V(12014),Lh=V(13123);(0,Lh.h)(rh.d.NAME_PARTICLESYSTEM,((Z,h,V,v)=>{const A=(0,Lh.i)(rh.d.NAME_PARTICLESYSTEM);if(A&&void 0!==Z.bD&&null!==Z.bD)for(let H=0,K=Z.bD.length;H<K;H++){const K=Z.bD[H];V.bD.push(A(K,h,v))}})),(0,Lh.d)(rh.d.NAME_PARTICLESYSTEM,((Z,h,V)=>{if(Z.activeParticleCount){return Xh.Parse(Z,h,V)}return dh.Parse(Z,h,V)})),sZ.d.prototype.createEffectForParticles=function(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",H=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9?arguments[9]:void 0,N=[],D=[];const k=[];return a?a.fillUniformsAttributesAndSamplerNames(D,N,k):(N=dh._GetAttributeNamesOrOptions(),D=dh._GetEffectCreationOptions()),-1===A.indexOf(" BILLBOARD")&&(A+="\n#define BILLBOARD\n"),null!==a&&void 0!==a&&a.isAnimationSheetEnabled&&-1===A.indexOf(" ANIMATESHEET")&&(A+="\n#define ANIMATESHEET\n"),-1===v.indexOf("diffuseSampler")&&v.push("diffuseSampler"),this.createEffect({vertex:x??(null===a||void 0===a?void 0:a.vertexShaderName)??"particles",fragmentElement:Z},N,D.concat(h),k.concat(v),A,H,K,d,void 0,n,(async()=>{0===n?await Promise.resolve().then(V.bind(V,13162)):await Promise.resolve().then(V.bind(V,13220))}))},Sh.c.prototype.getEmittedParticleSystems=function(){const Z=[];for(let h=0;h<this.CZ().bD.length;h++){const V=this.CZ().bD[h];V.Ah===this&&Z.push(V)}return Z},Sh.c.prototype.getHierarchyEmittedParticleSystems=function(){const Z=[],h=this.getDescendants();h.push(this);for(let V=0;V<this.CZ().bD.length;V++){const v=this.CZ().bD[V],A=v.Ah;A.position&&-1!==h.indexOf(A)&&Z.push(v)}return Z};V(12074),V(12085),V(12157);V(12161),V(13131),V(11937),V(12064),V(12207);V(11931);var yh;V(13137),V(11754);!function(Z){Z[Z.Color=2]="Color",Z[Z.UV=1]="UV",Z[Z.Random=0]="Random",Z[Z.Stated=3]="Stated"}(yh||(yh={}));var Wh=V(11975);const zh=new v.Ch(0,0,0),mh=new v.Ch(0,0,0),gh=new v.Ch(0,0,0);class Ih{constructor(Z,h,V){this.width=Z,this.height=h,this.data=V}processFlowable(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2?arguments[2]:void 0;if(!V)return;V instanceof v.Matrix?v.Ch.TransformCoordinatesToRef(Z.position,V,gh):(gh.x=V.x,gh.y=V.y,gh.z=V.z);const A=.5*gh.x+.5,H=1-(.5*gh.y+.5),K=Math.floor(A*this.width),d=Math.floor(H*this.height);if(K<0||K>=this.width||d<0||d>=this.height)return;const a=4*(d*this.width+K),n=this.data[a]/255*2-1,x=this.data[a+1]/255*2-1,N=this.data[a+2]/255*2-1,D=this.data[a+3]/255;zh.set(n,x,N),zh.scaleToRef(h*D,mh),Z.direction.addInPlace(mh)}_processParticle(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2?arguments[2]:void 0;this.processFlowable(Z,h,V)}static async FromUrlAsync(Z){return await new Promise(((h,V)=>{const v=document.createElement("canvas"),A=v.getContext("2d");let H=null;const K=new Image;K.crossOrigin="anonymous",K.src=Z,K.onerror=h=>{V(new Error(`Failed to load image: ${Z} : ${h}`))},K.onload=()=>{v.width=K.width,v.height=K.height,A.drawImage(K,0,0),H=A.getImageData(0,0,v.width,v.height),h(new Ih(v.width,v.height,H.data))}}))}static async ExtractFromTextureAsync(Z){return await new Promise(((h,V)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{const V=await this.ExtractFromTextureAsync(Z);h(V)}catch(v){V(v)}}));const v=Z.getSize();Wh.h.GetTextureDataAsync(Z,v.width,v.height).then((Z=>{h(new Ih(v.width,v.height,new Uint8ClampedArray(Z)))})).catch(V)}))}}var eh,Uh,Rh,Qh,wh,Th,th,ch,ih;!function(Z){Z[Z.Int=1]="Int",Z[Z.Float=2]="Float",Z[Z.Vector2=4]="Vector2",Z[Z.Ch=8]="Ch",Z[Z.Matrix=16]="Matrix",Z[Z.Particle=32]="Particle",Z[Z.Texture=64]="Texture",Z[Z.nd=128]="nd",Z[Z.FloatGradient=256]="FloatGradient",Z[Z.Vector2Gradient=512]="Vector2Gradient",Z[Z.Vector3Gradient=1024]="Vector3Gradient",Z[Z.Color4Gradient=2048]="Color4Gradient",Z[Z.System=4096]="System",Z[Z.AutoDetect=8192]="AutoDetect",Z[Z.BasedOnInput=16384]="BasedOnInput",Z[Z.Undefined=32768]="Undefined",Z[Z.All=65535]="All"}(eh||(eh={})),function(Z){Z[Z.Compatible=0]="Compatible",Z[Z.TypeIncompatible=1]="TypeIncompatible",Z[Z.HierarchyIssue=2]="HierarchyIssue"}(Uh||(Uh={})),function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(Rh||(Rh={}));class Mh{get direction(){return this._direction}get type(){if(this._type===eh.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===eh.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Z){this._type=Z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Z=>Z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Z,h,V){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=eh.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new f.b,this.onDisconnectionObservable=new f.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=h,this.name=Z,this._direction=V}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Z){var h;return this.isConnected?null!==(h=this._connectedPoint)&&void 0!==h&&h._storedFunction?this._connectedPoint._storedFunction(Z):this._connectedPoint._storedValue:this.value}canConnectTo(Z){return 0===this.checkCompatibilityState(Z)}checkCompatibilityState(Z){const h=this._ownerBlock,V=Z.ownerBlock;if(this.type!==Z.type&&Z.innerType!==eh.AutoDetect)return Z.acceptedConnectionPointTypes&&-1!==Z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Z.excludedConnectionPointTypes&&-1!==Z.excludedConnectionPointTypes.indexOf(this.type))return 1;let v=V,A=h;return 0===this.direction&&(v=h,A=V),v.isAnAncestorOf(A)?2:0}connectTo(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Z))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Z.ownerBlock.name}".${Z.name}`;return this._endpoints.push(Z),Z._connectedPoint=this,this.onConnectionObservable.notifyObservers(Z),Z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Z){const h=this._endpoints.indexOf(Z);return-1===h||(this._endpoints.splice(h,1),Z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Z),Z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Z){let h=1;for(;h<eh.All;)Z&h||this.excludedConnectionPointTypes.push(h),h<<=1}serialize(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const h={};return h.name=this.name,h.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.mh?(h.valueType="BABYLON."+this.value.getClassName(),h.value=this.value.mh()):(h.valueType="number",h.value=this.value)),Z&&this.connectedPoint&&(h.inputName=this.name,h.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,h.targetConnectionName=this.connectedPoint.name,h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),h}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Oh{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Z){this._name=Z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new f.b,this.jh=new f.b,this.onInputChangedObservable=new f.b,this.visibleOnFrame=!1,this._name=Z,this.uniqueId=I.c.UniqueId}_inputRename(Z){return Z}_outputRename(Z){return Z}isAnAncestorOf(Z){for(const h of this._outputs)if(h.hasEndpoints)for(const V of h.endpoints){if(V.ownerBlock===Z)return!0;if(V.ownerBlock.isAnAncestorOf(Z))return!0}return!1}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const h of this._outputs)if(h.hasEndpoints)for(const V of h.endpoints)if(V.ownerBlock.isAnAncestorOfType(Z))return!0;return!1}getInputByName(Z){const h=this._inputs.filter((h=>h.name===Z));return h.length?h[0]:null}_linkConnectionTypes(Z,h){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[h]._acceptedConnectionPointType=this._inputs[Z]:(this._inputs[Z]._linkedConnectionSource=this._inputs[h],this._inputs[Z]._isMainLinkSource=!0),this._inputs[h]._linkedConnectionSource=this._inputs[Z]}registerInput(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0;const K=new Mh(Z,this,0);return K.type=h,K.isOptional=V,K.defaultValue=v,K.value=v,K.valueMin=A,K.valueMax=H,this._inputs.push(K),this.onInputChangedObservable.notifyObservers(K),this}registerOutput(Z,h,V){return(V=V??new Mh(Z,this,1)).type=h,this._outputs.push(V),this}_build(Z){}_customBuildStep(Z){}build(Z){if(this._buildId===Z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Z=>Z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Z.buildId;for(const h of this._inputs){if(!h.connectedPoint){h.isOptional||Z.notConnectedNonOptionalInputs.push(h);continue}const V=h.connectedPoint.ownerBlock;V&&V!==this&&!V.isSystem&&V.build(Z)}return this._customBuildStep(Z),Z.verbose&&e.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Z={};Z.customType="BABYLON."+this.getClassName(),Z.id=this.uniqueId,Z.name=this.name,Z.visibleOnFrame=this.visibleOnFrame,Z.inputs=[],Z.outputs=[];for(const h of this.inputs)Z.inputs.push(h.serialize());for(const h of this.outputs)Z.outputs.push(h.serialize(!1));return Z}_deserialize(Z){this._name=Z.name,this.comments=Z.comments,this.visibleOnFrame=!!Z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Z)}_deserializePortDisplayNamesAndExposedOnFrame(Z){const h=Z.inputs,V=Z.outputs;if(h)for(const v of h){const Z=this.inputs.find((Z=>Z.name===v.name));if(!Z)return;if(v.displayName&&(Z.displayName=v.displayName),v.isExposedOnFrame&&(Z.isExposedOnFrame=v.isExposedOnFrame,Z.exposedPortPosition=v.exposedPortPosition),void 0!==v.value&&null!==v.value)if("number"===v.valueType)Z.value=v.value;else{const h=(0,d.e)(v.valueType);h&&(Z.value=h.eh(v.value))}}if(V)for(let v=0;v<V.length;v++){const Z=V[v];Z.displayName&&(this.outputs[v].displayName=Z.displayName),Z.isExposedOnFrame&&(this.outputs[v].isExposedOnFrame=Z.isExposedOnFrame,this.outputs[v].exposedPortPosition=Z.exposedPortPosition)}}clone(){const Z=this.serialize(),h=(0,d.e)(Z.customType);if(h){const V=new h;return V._deserialize(Z),V}return null}dispose(){this.jh.notifyObservers(this),this.jh.clear();for(const Z of this.inputs)Z.dispose();for(const Z of this.outputs)Z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function sh(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",v=arguments.length>3?arguments[3]:void 0;return(A,H)=>{let K=A._propStore;K||(K=[],A._propStore=K),K.push({propertyName:H,displayName:Z,type:h,groupName:V,options:v??{},className:A.getClassName()})}}(0,W.b)([(0,z.I)("comment")],Oh.prototype,"comments",void 0),function(Z){Z[Z.Boolean=0]="Boolean",Z[Z.Float=1]="Float",Z[Z.Int=2]="Int",Z[Z.Vector2=3]="Vector2",Z[Z.List=4]="List",Z[Z.nd=5]="nd",Z[Z.SamplingMode=6]="SamplingMode",Z[Z.TextureFormat=7]="TextureFormat",Z[Z.TextureType=8]="TextureType"}(Qh||(Qh={})),function(Z){Z[Z.None=0]="None",Z[Z.Position=1]="Position",Z[Z.Direction=2]="Direction",Z[Z.Age=3]="Age",Z[Z.Lifetime=4]="Lifetime",Z[Z.Color=5]="Color",Z[Z.ScaledDirection=6]="ScaledDirection",Z[Z.Scale=7]="Scale",Z[Z.AgeGradient=8]="AgeGradient",Z[Z.Angle=9]="Angle",Z[Z.SpriteCellIndex=16]="SpriteCellIndex",Z[Z.SpriteCellStart=17]="SpriteCellStart",Z[Z.SpriteCellEnd=18]="SpriteCellEnd"}(wh||(wh={})),function(Z){Z[Z.None=0]="None",Z[Z.Time=1]="Time",Z[Z.Delta=2]="Delta",Z[Z.Emitter=3]="Emitter"}(Th||(Th={}));class Jh{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Z="";for(const h of this.notConnectedNonOptionalInputs)Z+=`input ${h.name} from block ${h.ownerBlock.name}[${h.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Z)throw"Build of Node Particle System Set failed:\n"+Z}adapt(Z,h){const V=Z.getConnectedValue(this)||0;if(Z.type===h)return V;switch(h){case eh.Vector2:return new v.Vector2(V,V);case eh.Ch:return new v.Ch(V,V,V);case eh.nd:return new K.nd(V,V,V,V)}return null}getContextualValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case wh.Position:return this.particleContext.position;case wh.Direction:return this.particleContext.direction;case wh.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case wh.Color:return this.particleContext.color;case wh.Age:return this.particleContext.age;case wh.Lifetime:return this.particleContext.lifeTime;case wh.Angle:return this.particleContext.angle;case wh.Scale:return this.particleContext.scale;case wh.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case wh.SpriteCellEnd:return this.systemContext.endSpriteCellID;case wh.SpriteCellIndex:return this.particleContext.cellIndex;case wh.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Ah.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Ah.absolutePosition:this.systemContext.Ah:null}getSystemValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case Th.Time:return this.systemContext._actualFrame;case Th.Delta:return this.systemContext._scaledUpdateSpeed;case Th.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Ah.absolutePosition}return this.systemContext.Ah}return null}}function fh(Z,h,V){const v=new Jh;v.Wh=h;const A=Z.createSystem(v);return A.canStart=()=>!0,A.Ah=V.clone(),A.disposeOnStop=!0,A.start(),A}class ph extends Oh{constructor(Z){super(Z),this.blendMode=a.BLENDMODE_ONEONE,this.Th=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",eh.Particle),this.registerInput("texture",eh.Texture),this.registerInput("onStart",eh.System,!0),this.registerInput("onEnd",eh.System,!0),this.registerOutput("system",eh.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Z){Z.Th=this.Th,Z.buildId=this._buildId++,this.build(Z);const h=this.particle.getConnectedValue(Z);return h.particleTexture=this.texture.getConnectedValue(Z),h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.name=this.name,h._nodeGenerated=!0,h._targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,this.system._storedValue=this,h.canStart=()=>!this.doNoStart,h.onStartedObservable.add((V=>{const v=this.onStart.getConnectedValue(Z);v&&V.onStartedObservable.addOnce((()=>{Z.systemContext=h;const V=fh(v,Z.Wh,Z.emitterPosition);this.jh.addOnce((()=>{V.dispose()}))}));const A=this.onEnd.getConnectedValue(Z);A&&V.onStoppedObservable.addOnce((()=>{Z.systemContext=h;const V=fh(A,Z.Wh,Z.emitterPosition);this.jh.addOnce((()=>{V.dispose()}))}))})),this.jh.addOnce((()=>{h.dispose()})),h}serialize(){const Z=super.serialize();return Z.Th=this.Th,Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.doNoStart=this.doNoStart,Z.targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,Z}_deserialize(Z){super._deserialize(Z),this.Th=Z.Th,this.emitRate=Z.emitRate,this.doNoStart=!!Z.doNoStart,void 0!==Z.blendMode&&(this.blendMode=Z.blendMode),void 0!==Z.targetStopDuration&&(this.targetStopDuration=Z.targetStopDuration),void 0!==Z.startDelay&&(this.startDelay=Z.startDelay)}}(0,W.b)([sh("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:a.BLENDMODE_ONEONE},{label:"Standard",value:a.BLENDMODE_STANDARD},{label:"Add",value:a.BLENDMODE_ADD},{label:"Multiply",value:a.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:a.BLENDMODE_MULTIPLYADD}]})],ph.prototype,"blendMode",void 0),(0,W.b)([sh("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],ph.prototype,"Th",void 0),(0,W.b)([sh("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ph.prototype,"emitRate",void 0),(0,W.b)([sh("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ph.prototype,"targetStopDuration",void 0),(0,W.b)([sh("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ph.prototype,"startDelay",void 0),(0,W.b)([sh("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ph.prototype,"doNoStart",void 0),(0,d.i)("BABYLON.SystemBlock",ph);class Yh extends Oh{get type(){if(this._type===eh.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=eh.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=eh.Vector2,this._type;case"Ch":return this._type=eh.Ch,this._type;case"nd":return this._type=eh.nd,this._type;case"Matrix":return this._type=eh.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===wh.None&&this._systemSource!==Th.None}get systemSource(){return this._systemSource}set systemSource(Z){if(this._systemSource=Z,Z!==Th.None){switch(this._contextualSource=wh.None,this._type=eh.Float,Z){case Th.Time:case Th.Delta:this._type=eh.Float;break;case Th.Emitter:this._type=eh.Ch}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==wh.None}get contextualValue(){return this._contextualSource}set contextualValue(Z){if(this._contextualSource=Z,Z!==wh.None){switch(this._systemSource=Th.None,Z){case wh.Scale:this._type=eh.Vector2;break;case wh.Position:case wh.Direction:case wh.ScaledDirection:this._type=eh.Ch;break;case wh.Color:this._type=eh.nd;break;case wh.Age:case wh.Lifetime:case wh.Angle:case wh.AgeGradient:this._type=eh.Float;break;case wh.SpriteCellEnd:case wh.SpriteCellStart:case wh.SpriteCellIndex:this._type=eh.Int}this.output&&(this.output.type=this._type)}}constructor(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eh.AutoDetect;super(Z),this._type=eh.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new f.b,this._systemSource=Th.None,this._contextualSource=wh.None,this._type=h,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",h)}get value(){return this._storedValue}set value(Z){this.type===eh.Float&&this.min!==this.max&&(Z=Math.max(this.min,Z),Z=Math.min(this.max,Z)),this._storedValue=Z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Z){this._valueCallback=Z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case eh.Int:case eh.Float:this.value=0;break;case eh.Vector2:this.value=v.Vector2.Zero();break;case eh.Ch:this.value=v.Ch.Zero();break;case eh.nd:this.value=new K.nd(1,1,1,1);break;case eh.Matrix:this.value=v.Matrix.Identity()}}_build(Z){super._build(Z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Z=super.serialize();return Z.type=this.type,Z.contextualValue=this.contextualValue,Z.systemSource=this.systemSource,Z.min=this.min,Z.max=this.max,Z.groupInInspector=this.groupInInspector,Z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.mh?(Z.valueType="BABYLON."+this._storedValue.getClassName(),Z.value=this._storedValue.mh()):(Z.valueType="number",Z.value=this._storedValue)),Z}_deserialize(Z){if(super._deserialize(Z),this._type=Z.type,this.contextualValue=Z.contextualValue,this.systemSource=Z.systemSource||Th.None,this.min=Z.min||0,this.max=Z.max||0,this.groupInInspector=Z.groupInInspector||"",void 0!==Z.displayInInspector&&(this.displayInInspector=Z.displayInInspector),Z.valueType)if("number"===Z.valueType)this._storedValue=Z.value;else{const h=(0,d.e)(Z.valueType);h&&(this._storedValue=h.eh(Z.value))}}}(0,d.i)("BABYLON.ParticleInputBlock",Yh);class Gh extends Oh{get url(){return this._url}set url(Z){this._url!==Z&&(this._cachedData=null,this._url=Z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Z){this._textureDataUrl!==Z&&(this._cachedData=null,this._textureDataUrl=Z,this._url="",this._sourceTexture=null)}set sourceTexture(Z){this._sourceTexture!==Z&&(this._cachedData=null,this._sourceTexture=Z,this._url="",this._textureDataUrl="")}constructor(Z){super(Z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",eh.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Z=this.texture._storedValue;return await new Promise(((h,V)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),h(this._cachedData)}catch(Z){V(Z)}}));const v=Z.getSize();Wh.h.GetTextureDataAsync(Z,v.width,v.height).then((V=>{this._cachedData={width:v.width,height:v.height,data:new Uint8ClampedArray(V)},Z.dispose(),h(this._cachedData)})).catch(V)}))}_build(Z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new g.e(this._textureDataUrl,Z.Wh):this.texture._storedValue=new g.e(this._url,Z.Wh):this.texture._storedValue=null}serialize(){const Z=super.serialize();return Z.url=this.url,Z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Z.textureDataUrl=this.textureDataUrl),Z}_deserialize(Z){super._deserialize(Z),this.url=Z.url,this.serializedCachedData=!!Z.serializedCachedData,Z.textureDataUrl&&(this.textureDataUrl=Z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,d.i)("BABYLON.ParticleTextureSourceBlock",Gh);class ZV extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("position",eh.Ch),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Z){const h=this.particle.getConnectedValue(Z);if(this.output._storedValue=h,!this.position.isConnected)return;const V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.position.v(this.position.getConnectedValue(Z))},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V}}(0,d.i)("BABYLON.UpdatePositionBlock",ZV),function(Z){Z[Z.Add=0]="Add",Z[Z.Subtract=1]="Subtract",Z[Z.Multiply=2]="Multiply",Z[Z.Divide=3]="Divide",Z[Z.Max=4]="Max",Z[Z.Min=5]="Min"}(th||(th={}));class hV extends Oh{constructor(Z){super(Z),this.operation=th.Add,this.registerInput("left",eh.AutoDetect),this.registerInput("right",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this.output._typeConnectionSource=this.left;const h=[eh.Matrix,eh.Particle,eh.Texture,eh.System,eh.FloatGradient,eh.Color4Gradient,eh.Vector2Gradient,eh.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...h),this.right.excludedConnectionPointTypes.push(...h),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Z){let h;const V=this.left,A=this.right;if(!V.isConnected||!A.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const H=V.type===eh.Float||V.type===eh.Int,d=A.type===eh.Float||A.type===eh.Int,a=H&&d;switch(this.operation){case th.Add:h=a?Z=>V.getConnectedValue(Z)+A.getConnectedValue(Z):H?Z=>Z.adapt(V,A.type).add(A.getConnectedValue(Z)):Z=>V.getConnectedValue(Z).add(Z.adapt(A,V.type));break;case th.Subtract:h=a?Z=>V.getConnectedValue(Z)-A.getConnectedValue(Z):H?Z=>Z.adapt(V,A.type).rh(A.getConnectedValue(Z)):Z=>V.getConnectedValue(Z).rh(Z.adapt(A,V.type));break;case th.Multiply:h=a?Z=>V.getConnectedValue(Z)*A.getConnectedValue(Z):H?Z=>Z.adapt(V,A.type).multiply(A.getConnectedValue(Z)):Z=>V.getConnectedValue(Z).multiply(Z.adapt(A,V.type));break;case th.Divide:h=a?Z=>V.getConnectedValue(Z)/A.getConnectedValue(Z):H?Z=>Z.adapt(V,A.type).divide(A.getConnectedValue(Z)):Z=>V.getConnectedValue(Z).divide(Z.adapt(A,V.type));break;case th.Min:if(a)h=Z=>Math.min(V.getConnectedValue(Z),A.getConnectedValue(Z));else{const[Z,d]=H?[A,V]:[V,A];switch(Z.type){case eh.Vector2:h=h=>v.Vector2.Minimize(Z.getConnectedValue(h),h.adapt(d,Z.type));break;case eh.Ch:h=h=>v.Ch.Minimize(Z.getConnectedValue(h),h.adapt(d,Z.type));break;case eh.nd:h=h=>{const V=Z.getConnectedValue(h),{r:v,g:A,b:H,a:a}=h.adapt(d,Z.type);return new K.nd(Math.min(V.r,v),Math.min(V.g,A),Math.min(V.b,H),Math.min(V.a,a))}}}break;case th.Max:if(!a){const[Z,d]=H?[A,V]:[V,A];switch(Z.type){case eh.Vector2:h=h=>v.Vector2.Maximize(Z.getConnectedValue(h),h.adapt(d,Z.type));break;case eh.Ch:h=h=>v.Ch.Maximize(Z.getConnectedValue(h),h.adapt(d,Z.type));break;case eh.nd:h=h=>{const V=Z.getConnectedValue(h),{r:v,g:A,b:H,a:a}=h.adapt(d,Z.type);return new K.nd(Math.max(V.r,v),Math.min(V.g,A),Math.min(V.b,H),Math.min(V.a,a))}}break}h=Z=>Math.max(V.getConnectedValue(Z),A.getConnectedValue(Z))}this.output._storedFunction=Z=>V.type===eh.Int?0|h(Z):h(Z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===eh.Int||this.left.type===eh.Float&&this.right.type!==eh.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Z,h]of[[this.left,this.right],[this.right,this.left]])Z.acceptedConnectionPointTypes=[eh.Int,eh.Float],h.isConnected&&(Z.acceptedConnectionPointTypes.push(h.type),h.type!==eh.Int&&h.type!==eh.Float||Z.acceptedConnectionPointTypes.push(eh.Vector2,eh.Ch,eh.nd))}dispose(){super.dispose();for(const Z of this._connectionObservers)Z.remove();this._connectionObservers.length=0}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,W.b)([sh("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:th.Add},{label:"Subtract",value:th.Subtract},{label:"Multiply",value:th.Multiply},{label:"Divide",value:th.Divide},{label:"Max",value:th.Max},{label:"Min",value:th.Min}]})],hV.prototype,"operation",void 0),(0,d.i)("BABYLON.ParticleMathBlock",hV);class VV extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("direction1",eh.Ch,!0,new v.Ch(0,1,0)),this.registerInput("direction2",eh.Ch,!0,new v.Ch(0,1,0)),this.registerInput("minEmitBox",eh.Ch,!0,new v.Ch(-.5,-.5,-.5)),this.registerInput("maxEmitBox",eh.Ch,!0,new v.Ch(.5,.5,.5)),this.registerOutput("output",eh.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const h=this.particle.getConnectedValue(Z);h._directionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.direction1.getConnectedValue(Z),H=this.direction2.getConnectedValue(Z),K=(0,n.RandomRange)(A.x,H.x),d=(0,n.RandomRange)(A.y,H.y),a=(0,n.RandomRange)(A.z,H.z);Z.isEmitterTransformNode?v.Ch.TransformNormalFromFloatsToRef(K,d,a,Z.emitterWorldMatrix,V.direction):V.direction.IV(K,d,a)},h._positionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.minEmitBox.getConnectedValue(Z),H=this.maxEmitBox.getConnectedValue(Z),K=(0,n.RandomRange)(A.x,H.x),d=(0,n.RandomRange)(A.y,H.y),a=(0,n.RandomRange)(A.z,H.z);Z.isEmitterTransformNode?v.Ch.TransformCoordinatesFromFloatsToRef(K,d,a,Z.emitterWorldMatrix,V.position):(V.position.IV(K,d,a),V.position.addInPlace(Z.emitterPosition))},this.output._storedValue=h}}(0,d.i)("BABYLON.BoxShapeBlock",VV);class vV extends Oh{constructor(Z){super(Z),this.registerInput("emitPower",eh.Float,!0,1),this.registerInput("lifeTime",eh.Float,!0,1),this.registerInput("color",eh.nd,!0,new K.nd(1,1,1,1)),this.registerInput("scale",eh.Vector2,!0,new v.Vector2(1,1)),this.registerInput("angle",eh.Float,!0,0),this.registerOutput("particle",eh.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Z){const h=new dh(this.name,Z.Th,Z.Wh,null,!1,void 0,!0);h.particleEmitterType=new o,h._lifeTimeCreation.process=(h,V)=>{Z.particleContext=h,h.lifeTime=this.lifeTime.getConnectedValue(Z),V._emitPower=this.emitPower.getConnectedValue(Z)},h._colorCreation.process=h=>{Z.particleContext=h,h.color.v(this.color.getConnectedValue(Z))},h._sizeCreation.process=h=>{Z.particleContext=h,h.size=1,h.scale.v(this.scale.getConnectedValue(Z))},h._angleCreation.process=h=>{Z.particleContext=h,h.angle=this.angle.getConnectedValue(Z)},this.particle._storedValue=h}}(0,d.i)("BABYLON.CreateParticleBlock",vV);class AV{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Z=[];for(const h of this.attachedBlocks)h.isInput&&Z.push(h);return Z}constructor(Z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new f.b,this.name=Z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Z)&&this.attachedBlocks.push(Z);for(const V of Z.inputs){const v=V.connectedPoint;if(v){const V=v.ownerBlock;V!==Z&&this._initializeBlock(V,h)}}}async buildAsync(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((V=>{const v=new Ch;for(const Z of this._systemBlocks)this._initializeBlock(Z);for(const A of this.systemBlocks){const V=new Jh;V.buildId=this._buildId++,V.Wh=Z,V.verbose=h;const H=A.createSystem(V);V.emitErrors(),v.systems.push(H)}this.onBuildObservable.notifyObservers(this),V(v)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Z=new ph("Particle system"),h=new ZV("Update position");h.output.connectTo(Z.particle);const V=new Yh("Position");V.contextualValue=wh.Position;const v=new Yh("Scaled direction");v.contextualValue=wh.ScaledDirection;const A=new hV("Add");A.operation=th.Add,V.output.connectTo(A.left),v.output.connectTo(A.right),A.output.connectTo(h.position);const H=new vV("Create particle"),K=new VV("Box shape");H.particle.connectTo(K.particle),K.output.connectTo(h.particle);const d=new Gh("Texture");d.texture.connectTo(Z.texture),d.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Z)}removeBlock(Z){const h=this.attachedBlocks.indexOf(Z);if(h>-1&&this.attachedBlocks.splice(h,1),Z.isSystem){const h=this._systemBlocks.indexOf(Z);h>-1&&this._systemBlocks.splice(h,1)}}parseSerializedObject(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h||this.clear();const V={};for(const v of Z.zx){const Z=(0,d.e)(v.customType);if(Z){const h=new Z;h._deserialize(v),V[v.id]=h,this.attachedBlocks.push(h),h.isSystem&&this._systemBlocks.push(h)}}for(const v of this.attachedBlocks)if(v.isTeleportOut){const Z=v,h=Z._tempEntryPointUniqueId;if(h){const v=V[h];v&&v.attachToEndpoint(Z)}}for(let v=0;v<Z.zx.length;v++){const A=Z.zx[v],H=V[A.id];H&&(H.inputs.length&&A.inputs.some((Z=>Z.targetConnectionName))&&!h||this._restoreConnections(H,Z,V))}if(Z.locations||Z.editorData&&Z.editorData.locations){const v=Z.locations||Z.editorData.locations;for(const Z of v)V[Z.dv]&&(Z.dv=V[Z.dv].uniqueId);h&&this.editorData&&this.editorData.locations&&v.concat(this.editorData.locations),Z.locations?this.editorData={locations:v}:(this.editorData=Z.editorData,this.editorData.locations=v);const A=[];for(const Z in V)A[Z]=V[Z].uniqueId;this.editorData.map=A}this.comment=Z.comment}_restoreConnections(Z,h,V){for(const v of Z.outputs)for(const A of h.zx){const H=V[A.id];if(H)for(const K of A.inputs)if(V[K.targetBlockId]!==Z||K.targetConnectionName!==v.name);else{const Z=H.getInputByName(K.inputName);if(!Z||Z.isConnected)continue;v.connectTo(Z,!0),this._restoreConnections(H,h,V)}}}serialize(Z){const h=Z?{}:m.b.Serialize(this);h.editorData=JSON.parse(JSON.stringify(this.editorData));let V=[];Z?V=Z:h.customType="BABYLON.NodeParticleSystemSet",h.zx=[];for(const v of V)h.zx.push(v.serialize());if(!Z)for(const v of this.attachedBlocks)-1===V.indexOf(v)&&h.zx.push(v.serialize());return h}dispose(){for(const Z of this.attachedBlocks)Z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Z){const h=new AV(Z);return h.setToDefault(),h}static Parse(Z){const h=m.b.Parse((()=>new AV(Z.name)),Z,null);return h.parseSerializedObject(Z),h}static ParseFromSnippetAsync(Z,h){return"_BLANK"===Z?Promise.resolve(AV.CreateDefault("blank")):new Promise(((V,v)=>{const A=new lh.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const K=JSON.parse(JSON.parse(A.responseText).jsonPayload),d=JSON.parse(K.nodeParticle);h||(h=m.b.Parse((()=>new AV(Z)),d,null)),h.parseSerializedObject(d),h.snippetId=Z;try{V(h)}catch(H){v(H)}}else v("Unable to load the snippet "+Z)})),A.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),A.send()}))}}AV.EditorURL=`${Eh.Tools._DefaultCdnUrl}/v${sZ.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,AV.SnippetUrl="https://snippet.babylonjs.com",(0,W.b)([(0,z.I)()],AV.prototype,"name",void 0),(0,W.b)([(0,z.I)("comment")],AV.prototype,"comment",void 0),function(Z){Z[Z.None=0]="None",Z[Z.PerParticle=1]="PerParticle",Z[Z.PerSystem=2]="PerSystem"}(ch||(ch={}));class HV extends Oh{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=ch.PerParticle,this.registerInput("min",eh.AutoDetect,!0,0),this.registerInput("max",eh.AutoDetect,!0,1),this.registerOutput("output",eh.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(eh.Float|eh.Int|eh.Vector2|eh.Ch|eh.nd),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(eh.Float|eh.Int|eh.Vector2|eh.Ch|eh.nd),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=eh.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case eh.AutoDetect:case eh.Int:case eh.Float:Z=Z=>{const h=this.min.getConnectedValue(Z)||0,V=this.max.getConnectedValue(Z)||1;return h+Math.random()*(V-h)};break;case eh.Vector2:Z=Z=>{const h=this.min.getConnectedValue(Z)||v.Vector2.Zero(),V=this.max.getConnectedValue(Z)||v.Vector2.One();return new v.Vector2(h.x+Math.random()*(V.x-h.x),h.y+Math.random()*(V.y-h.y))};break;case eh.Ch:Z=Z=>{const h=this.min.getConnectedValue(Z)||v.Ch.Zero(),V=this.max.getConnectedValue(Z)||v.Ch.One();return new v.Ch(h.x+Math.random()*(V.x-h.x),h.y+Math.random()*(V.y-h.y),h.z+Math.random()*(V.z-h.z))};break;case eh.nd:Z=Z=>{const h=this.min.getConnectedValue(Z)||new K.nd(0,0,0,0),V=this.max.getConnectedValue(Z)||new K.nd(1,1,1,1);return new K.nd(h.x+Math.random()*(V.x-h.x),h.y+Math.random()*(V.y-h.y),h.z+Math.random()*(V.z-h.z),h.w+Math.random()*(V.w-h.w))}}this.output._storedFunction=h=>{var V;let v=0;switch(this.lockMode){case ch.PerParticle:v=(null===(V=h.particleContext)||void 0===V?void 0:V.id)||-1;break;case ch.PerSystem:v=h.buildId||0}return this._currentLockId!==v&&(this.lockMode!==ch.None&&(this._currentLockId=v),this.output._storedValue=Z(h)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),this.lockMode=Z.lockMode}}(0,W.b)([sh("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ch.None},{label:"Per particle",value:ch.PerParticle},{label:"Per system",value:ch.PerSystem}]})],HV.prototype,"lockMode",void 0),(0,d.i)("BABYLON.ParticleRandomBlock",HV);class KV extends Oh{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=ch.PerParticle,this.registerInput("min",eh.AutoDetect),this.registerInput("max",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const h=[eh.Matrix,eh.Particle,eh.Texture,eh.System,eh.FloatGradient,eh.Color4Gradient,eh.Vector2Gradient,eh.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...h),this.max.excludedConnectionPointTypes.push(...h)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case eh.Float:case eh.Int:Z=Z=>{const h=this.min.getConnectedValue(Z),V=this.max.getConnectedValue(Z);return Math.random()*(V-h)+h};break;case eh.Vector2:Z=Z=>{const h=this.min.getConnectedValue(Z),V=this.max.getConnectedValue(Z);return new v.Vector2(Math.random()*(V.x-h.x)+h.x,Math.random()*(V.y-h.y)+h.y)};break;case eh.Ch:Z=Z=>{const h=this.min.getConnectedValue(Z),V=this.max.getConnectedValue(Z);return new v.Ch(Math.random()*(V.x-h.x)+h.x,Math.random()*(V.y-h.y)+h.y,Math.random()*(V.z-h.z)+h.z)};break;case eh.nd:Z=Z=>{const h=this.min.getConnectedValue(Z),V=this.max.getConnectedValue(Z);return new K.nd(Math.random()*(V.r-h.r)+h.r,Math.random()*(V.g-h.g)+h.g,Math.random()*(V.b-h.b)+h.b,Math.random()*(V.a-h.a)+h.a)}}this.output._storedFunction=h=>{var V;let v=0;switch(this.lockMode){case ch.PerParticle:v=(null===(V=h.particleContext)||void 0===V?void 0:V.id)||-1;break;case ch.PerSystem:v=h.buildId||0}return this._currentLockId!==v&&(this.lockMode!==ch.None&&(this._currentLockId=v),this.output._storedValue=Z(h)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.lockMode&&(this.lockMode=Z.lockMode)}}(0,W.b)([sh("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ch.None},{label:"Per particle",value:ch.PerParticle},{label:"Per system",value:ch.PerSystem}]})],KV.prototype,"lockMode",void 0),(0,d.i)("BABYLON.RandomRangeBlock",KV);(0,d.i)("BABYLON.ParticleLerpBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("left",eh.AutoDetect),this.registerInput("right",eh.AutoDetect),this.registerInput("gradient",eh.Float,!0,0,0,1),this.registerOutput("output",eh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(eh.Float|eh.Int|eh.Vector2|eh.Ch|eh.nd)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=(Z,h,V)=>(1-Z)*h+Z*V;this.output._storedFunction=h=>{const V=this.left.getConnectedValue(h),A=this.right.getConnectedValue(h),H=this.gradient.getConnectedValue(h);switch(this.left.type){case eh.Int:case eh.Float:return Z(H,V,A);case eh.Vector2:return new v.Vector2(Z(H,V.x,A.x),Z(H,V.y,A.y));case eh.Ch:return new v.Ch(Z(H,V.x,A.x),Z(H,V.y,A.y),Z(H,V.z,A.z));case eh.nd:return new K.nd(Z(H,V.r,A.r),Z(H,V.g,A.g),Z(H,V.b,A.b),Z(H,V.a,A.a))}return 0}}});(0,d.i)("BABYLON.UpdateDirectionBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("direction",eh.Ch),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Z){const h=this.particle.getConnectedValue(Z);if(this.output._storedValue=h,!this.direction.isConnected)return;const V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.direction.v(this.direction.getConnectedValue(Z))},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V}});(0,d.i)("BABYLON.UpdateColorBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("color",eh.nd),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Z){const h=this.particle.getConnectedValue(Z);if(this.output._storedValue=h,!this.color.isConnected)return;const V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.color.v(this.color.getConnectedValue(Z))},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V}});(0,d.i)("BABYLON.UpdateScaleBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("scale",eh.Vector2),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Z){const h=this.particle.getConnectedValue(Z);if(this.output._storedValue=h,!this.scale.isConnected)return;const V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.scale.v(this.scale.getConnectedValue(Z))},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V}});(0,d.i)("BABYLON.UpdateAngleBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("angle",eh.Float),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Z){const h=this.particle.getConnectedValue(Z);if(this.output._storedValue=h,!this.angle.isConnected)return;const V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.angle=this.angle.getConnectedValue(Z)},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V}});(0,d.i)("BABYLON.BasicPositionUpdateBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Z){const h=this.particle.getConnectedValue(Z),V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.direction.scaleToRef(h._directionScale,h._scaledDirection),V.position.addInPlace(h._scaledDirection)},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V,this.output._storedValue=h}});(0,d.i)("BABYLON.BasicSpriteUpdateBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Z){const h=this.particle.getConnectedValue(Z),V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.updateCellIndex()},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V,this.output._storedValue=h}});(0,d.i)("BABYLON.UpdateSpriteCellIndexBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("cellIndex",eh.Int),this.registerOutput("output",eh.Particle),this.cellIndex.acceptedConnectionPointTypes=[eh.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Z){const h=this.particle.getConnectedValue(Z);if(this.output._storedValue=h,!this.cellIndex.isConnected)return;const V={process:V=>{Z.particleContext=V,Z.systemContext=h,V.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Z))},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V}});class dV extends Oh{constructor(Z){super(Z),this.strength=1,this.registerInput("particle",eh.Particle),this.registerInput("flowMap",eh.Texture),this.registerOutput("output",eh.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Z){var h;const V=this.particle.getConnectedValue(Z),v=Z.Wh;let A;(null===(h=this.flowMap.connectedPoint)||void 0===h?void 0:h.ownerBlock).extractTextureContentAsync().then((Z=>{Z&&(A=new Ih(Z.width,Z.height,Z.data))}));const H={process:Z=>{const h=v.getTransformMatrix();A&&A._processParticle(Z,this.strength*V._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null};V._updateQueueStart?TZ(H,V._updateQueueStart):V._updateQueueStart=H,this.output._storedValue=V}serialize(){const Z=super.serialize();return Z.strength=this.strength,Z}_deserialize(Z){super._deserialize(Z),this.strength=Z.strength}}(0,W.b)([sh("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dV.prototype,"strength",void 0),(0,d.i)("BABYLON.UpdateFlowMapBlock",dV);(0,d.i)("BABYLON.SphereShapeBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("input",eh.Particle),this.registerInput("radius",eh.Float,!0,1),this.registerInput("radiusRange",eh.Float,!0,1,0,1),this.registerInput("directionRandomizer",eh.Float,!0,0,0,1),this.registerOutput("output",eh.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Z){const h=this.input.getConnectedValue(Z);h._directionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.directionRandomizer.getConnectedValue(Z),H=V.position.rh(Z.emitterPosition).normalize(),K=(0,n.RandomRange)(0,A),d=(0,n.RandomRange)(0,A),a=(0,n.RandomRange)(0,A);H.x+=K,H.y+=d,H.z+=a,H.normalize(),Z.isEmitterTransformNode?v.Ch.TransformNormalFromFloatsToRef(K,d,a,Z.emitterWorldMatrix,V.direction):V.direction.IV(K,d,a)},h._positionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.radius.getConnectedValue(Z),H=this.radiusRange.getConnectedValue(Z),K=A-(0,n.RandomRange)(0,A*H),d=(0,n.RandomRange)(0,1),a=(0,n.RandomRange)(0,2*Math.PI),x=Math.acos(2*d-1),N=K*Math.cos(a)*Math.sin(x),D=K*Math.cos(x),k=K*Math.sin(a)*Math.sin(x);Z.isEmitterTransformNode?v.Ch.TransformCoordinatesFromFloatsToRef(N,D,k,Z.emitterWorldMatrix,V.position):(V.position.IV(N,D,k),V.position.addInPlace(Z.emitterPosition))},this.output._storedValue=h}});(0,d.i)("BABYLON.PointShapeBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("direction1",eh.Ch,!0,new v.Ch(0,1,0)),this.registerInput("direction2",eh.Ch,!0,new v.Ch(0,1,0)),this.registerOutput("output",eh.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const h=this.particle.getConnectedValue(Z);h._directionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.direction1.getConnectedValue(Z),H=this.direction2.getConnectedValue(Z),K=(0,n.RandomRange)(A.x,H.x),d=(0,n.RandomRange)(A.y,H.y),a=(0,n.RandomRange)(A.z,H.z);Z.isEmitterTransformNode?v.Ch.TransformNormalFromFloatsToRef(K,d,a,Z.emitterWorldMatrix,V.direction):V.direction.IV(K,d,a)},h._positionCreation.process=V=>{Z.systemContext=h,Z.isEmitterTransformNode?v.Ch.TransformCoordinatesFromFloatsToRef(0,0,0,Z.emitterWorldMatrix,V.position):V.position.v(Z.emitterPosition)},this.output._storedValue=h}});(0,d.i)("BABYLON.CustomShapeBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("particle",eh.Particle),this.registerInput("position",eh.Ch,!0,new v.Ch(0,0,0)),this.registerInput("direction",eh.Ch,!0,new v.Ch(0,1,0)),this.registerOutput("output",eh.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const h=this.particle.getConnectedValue(Z);h._directionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.direction.getConnectedValue(Z);Z.isEmitterTransformNode?v.Ch.TransformNormalToRef(A,Z.emitterWorldMatrix,V.direction):V.direction.v(A)},h._positionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.position.getConnectedValue(Z);Z.isEmitterTransformNode?v.Ch.TransformCoordinatesToRef(A,Z.emitterWorldMatrix,V.position):(V.position.v(A),V.position.addInPlace(Z.emitterPosition))},this.output._storedValue=h}});(0,d.i)("BABYLON.CylinderShapeBlock",class extends Oh{constructor(Z){super(Z),this._tempVector=v.Ch.Zero(),this.registerInput("particle",eh.Particle),this.registerInput("radius",eh.Float,!0,1),this.registerInput("height",eh.Float,!0,1,0),this.registerInput("radiusRange",eh.Float,!0,1,0,1),this.registerInput("directionRandomizer",eh.Float,!0,0,0,1),this.registerOutput("output",eh.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const h=this.particle.getConnectedValue(Z);h._directionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.directionRandomizer.getConnectedValue(Z);V.position.subtractToRef(Z.emitterPosition,this._tempVector),this._tempVector.normalize(),Z.isEmitterTransformNode&&v.Ch.TransformNormalToRef(this._tempVector,Z.emitterInverseWorldMatrix,this._tempVector);const H=(0,n.RandomRange)(-A/2,A/2);let K=Math.atan2(this._tempVector.x,this._tempVector.z);K+=(0,n.RandomRange)(-Math.PI/2,Math.PI/2)*A,this._tempVector.y=H,this._tempVector.x=Math.sin(K),this._tempVector.z=Math.cos(K),this._tempVector.normalize(),Z.isEmitterTransformNode?v.Ch.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z.emitterWorldMatrix,V.direction):V.direction.v(this._tempVector)},h._positionCreation.process=V=>{Z.particleContext=V,Z.systemContext=h;const A=this.height.getConnectedValue(Z),H=this.radiusRange.getConnectedValue(Z),K=this.radius.getConnectedValue(Z),d=(0,n.RandomRange)(-A/2,A/2),a=(0,n.RandomRange)(0,2*Math.PI),x=(0,n.RandomRange)((1-H)*(1-H),1),N=Math.sqrt(x)*K,D=N*Math.cos(a),k=N*Math.sin(a);Z.isEmitterTransformNode?v.Ch.TransformCoordinatesFromFloatsToRef(D,d,k,Z.emitterWorldMatrix,V.position):(V.position.IV(D,d,k),V.position.addInPlace(Z.emitterPosition))},this.output._storedValue=h}});class aV extends Oh{constructor(Z){super(Z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",eh.Particle),this.registerOutput("output",eh.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const h=this.particle.getConnectedValue(Z);h._isAnimationSheetEnabled=!0,h.spriteCellWidth=this.width,h.spriteCellHeight=this.height,h.startSpriteCellID=this.start,h.endSpriteCellID=this.end,h.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=h}serialize(){const Z=super.serialize();return Z.width=this.width,Z.height=this.height,Z.start=this.start,Z.end=this.end,Z.randomStartCell=this.randomStartCell,Z}_deserialize(Z){super._deserialize(Z),this.width=Z.width,this.height=Z.height,this.start=Z.start,this.end=Z.end,this.randomStartCell=Z.randomStartCell}}(0,W.b)([sh("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aV.prototype,"start",void 0),(0,W.b)([sh("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aV.prototype,"end",void 0),(0,W.b)([sh("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aV.prototype,"width",void 0),(0,W.b)([sh("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aV.prototype,"height",void 0),(0,W.b)([sh("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aV.prototype,"loop",void 0),(0,W.b)([sh("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aV.prototype,"randomStartCell",void 0),(0,d.i)("BABYLON.SetupSpriteSheetBlock",aV);class nV extends Oh{constructor(Z){super(Z),this.reference=0,this.registerInput("value",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case eh.Float:return eh.FloatGradient;case eh.Vector2:return eh.Vector2Gradient;case eh.Ch:return eh.Vector3Gradient;case eh.nd:return eh.Color4Gradient}return Z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(eh.Float|eh.Vector2|eh.Ch|eh.nd)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Z=>null}serialize(){const Z=super.serialize();return Z.reference=this.reference,Z}_deserialize(Z){super._deserialize(Z),this.reference=Z.reference}}(0,W.b)([sh("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],nV.prototype,"reference",void 0),(0,d.i)("BABYLON.ParticleGradientValueBlock",nV);(0,d.i)("BABYLON.ParticleGradientBlock",class extends Oh{constructor(Z){super(Z),this._entryCount=1,this.registerInput("gradient",eh.Float,!0,1,0,1),this.registerInput("value0",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case eh.FloatGradient:return eh.Float;case eh.Vector2Gradient:return eh.Vector2;case eh.Vector3Gradient:return eh.Ch;case eh.Color4Gradient:return eh.nd}return Z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(eh.FloatGradient|eh.Vector2Gradient|eh.Vector3Gradient|eh.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Z){this._inputs[Z].onConnectionObservable.add((()=>{this._entryCount>Z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),eh.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Z=[];for(let V=1;V<this._inputs.length;V++){var h;if(this._inputs[V].isConnected)Z.push(null===(h=this._inputs[V].connectedPoint)||void 0===h?void 0:h.ownerBlock)}Z.sort(((Z,h)=>Z.reference-h.reference)),this.output._storedFunction=h=>{const V=this.gradient.getConnectedValue(h);if(1===Z.length)return Z[0].value.getConnectedValue(h);let A=null;for(let H=Z.length-1;H>=0;H--){const d=Z[H];if(d.reference<=V){const Z=d.value.getConnectedValue(h);if(A){const H=A.value.getConnectedValue(h),a=A.reference,x=d.reference,N=Math.max(0,Math.min(1,(V-x)/(a-x)));switch(this.output.type){case eh.Float:return(0,n.Lerp)(Z,H,N);case eh.Vector2:return v.Vector2.Lerp(Z,H,N);case eh.Ch:return v.Ch.Lerp(Z,H,N);case eh.nd:return K.nd.Lerp(Z,H,N)}}return Z}A=d}return 0}}});(0,d.i)("BABYLON.ParticleConverterBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("color ",eh.nd,!0),this.registerInput("xyz ",eh.Ch,!0),this.registerInput("xy ",eh.Vector2,!0),this.registerInput("zw ",eh.Vector2,!0),this.registerInput("x ",eh.Float,!0),this.registerInput("y ",eh.Float,!0),this.registerInput("z ",eh.Float,!0),this.registerInput("w ",eh.Float,!0),this.registerOutput("color",eh.nd),this.registerOutput("xyz",eh.Ch),this.registerOutput("xy",eh.Vector2),this.registerOutput("zw",eh.Vector2),this.registerOutput("x",eh.Float),this.registerOutput("y",eh.Float),this.registerOutput("z",eh.Float),this.registerOutput("w",eh.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Z){return"color "===Z?"colorIn":"xyz "===Z?"xyzIn":"xy "===Z?"xyIn":"zw "===Z?"zwIn":"x "===Z?"xIn":"y "===Z?"yIn":"z "===Z?"zIn":"w "===Z?"wIn":Z}_outputRename(Z){switch(Z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Z}}_build(Z){super._build(Z);const h=this.xIn,V=this.yIn,A=this.zIn,H=this.wIn,d=this.xyIn,a=this.zwIn,n=this.xyzIn,x=this.colorIn,N=this.colorOut,D=this.xyzOut,k=this.xyOut,u=this.zwOut,F=this.xOut,b=this.yOut,o=this.zOut,q=this.wOut,X=Z=>{if(x.isConnected)return x.getConnectedValue(Z);let v=0,N=0,D=0,k=0;if(h.isConnected&&(v=h.getConnectedValue(Z)),V.isConnected&&(N=V.getConnectedValue(Z)),A.isConnected&&(D=A.getConnectedValue(Z)),H.isConnected&&(k=H.getConnectedValue(Z)),d.isConnected){const h=d.getConnectedValue(Z);h&&(v=h.x,N=h.y)}if(a.isConnected){const h=a.getConnectedValue(Z);h&&(D=h.x,k=h.y)}if(n.isConnected){const h=n.getConnectedValue(Z);h&&(v=h.x,N=h.y,D=h.z)}return new K.nd(v,N,D,k)};N._storedFunction=Z=>X(Z),D._storedFunction=Z=>{const h=X(Z);return new v.Ch(h.r,h.g,h.b)},k._storedFunction=Z=>{const h=X(Z);return new v.Vector2(h.r,h.g)},u._storedFunction=Z=>{const h=X(Z);return new v.Vector2(h.b,h.a)},F._storedFunction=Z=>X(Z).r,b._storedFunction=Z=>X(Z).g,o._storedFunction=Z=>X(Z).b,q._storedFunction=Z=>X(Z).a}}),function(Z){Z[Z.Cos=0]="Cos",Z[Z.Sin=1]="Sin",Z[Z.Abs=2]="Abs",Z[Z.Exp=3]="Exp",Z[Z.Exp2=4]="Exp2",Z[Z.Round=5]="Round",Z[Z.Floor=6]="Floor",Z[Z.Ceiling=7]="Ceiling",Z[Z.Sqrt=8]="Sqrt",Z[Z.Log=9]="Log",Z[Z.Tan=10]="Tan",Z[Z.ArcTan=11]="ArcTan",Z[Z.ArcCos=12]="ArcCos",Z[Z.ArcSin=13]="ArcSin",Z[Z.Sign=14]="Sign",Z[Z.Negate=15]="Negate",Z[Z.OneMinus=16]="OneMinus",Z[Z.Reciprocal=17]="Reciprocal",Z[Z.ToDegrees=18]="ToDegrees",Z[Z.ToRadians=19]="ToRadians",Z[Z.Fract=20]="Fract"}(ih||(ih={}));class xV extends Oh{constructor(Z){super(Z),this.operation=ih.Cos,this.registerInput("input",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(eh.Float|eh.Int|eh.Vector2|eh.Ch|eh.nd)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);let h=null;switch(this.operation){case ih.Cos:h=Z=>Math.cos(Z);break;case ih.Sin:h=Z=>Math.sin(Z);break;case ih.Abs:h=Z=>Math.abs(Z);break;case ih.Exp:h=Z=>Math.exp(Z);break;case ih.Exp2:h=Z=>Math.pow(2,Z);break;case ih.Round:h=Z=>Math.round(Z);break;case ih.Floor:h=Z=>Math.floor(Z);break;case ih.Ceiling:h=Z=>Math.ceil(Z);break;case ih.Sqrt:h=Z=>Math.sqrt(Z);break;case ih.Log:h=Z=>Math.log(Z);break;case ih.Tan:h=Z=>Math.tan(Z);break;case ih.ArcTan:h=Z=>Math.atan(Z);break;case ih.ArcCos:h=Z=>Math.acos(Z);break;case ih.ArcSin:h=Z=>Math.asin(Z);break;case ih.Sign:h=Z=>Math.sign(Z);break;case ih.Negate:h=Z=>-Z;break;case ih.OneMinus:h=Z=>1-Z;break;case ih.Reciprocal:h=Z=>1/Z;break;case ih.ToRadians:h=Z=>Z*Math.PI/180;break;case ih.ToDegrees:h=Z=>180*Z/Math.PI;break;case ih.Fract:h=Z=>Z>=0?Z-Math.floor(Z):Z-Math.ceil(Z)}if(!h)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case eh.Int:case eh.Float:this.output._storedFunction=Z=>{const V=this.input.getConnectedValue(Z);return h(V)};break;case eh.Vector2:this.output._storedFunction=Z=>{const V=this.input.getConnectedValue(Z);return new v.Vector2(h(V.x),h(V.y))};break;case eh.Ch:this.output._storedFunction=Z=>{const V=this.input.getConnectedValue(Z);return new v.Ch(h(V.x),h(V.y),h(V.z))};break;case eh.nd:this.output._storedFunction=Z=>{const V=this.input.getConnectedValue(Z);return new K.nd(h(V.r),h(V.g),h(V.b),h(V.a))}}return this}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,W.b)([sh("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ih.Cos},{label:"Sin",value:ih.Sin},{label:"Abs",value:ih.Abs},{label:"Exp",value:ih.Exp},{label:"Exp2",value:ih.Exp2},{label:"Round",value:ih.Round},{label:"Floor",value:ih.Floor},{label:"Ceiling",value:ih.Ceiling},{label:"Sqrt",value:ih.Sqrt},{label:"Log",value:ih.Log},{label:"Tan",value:ih.Tan},{label:"ArcTan",value:ih.ArcTan},{label:"ArcCos",value:ih.ArcCos},{label:"ArcSin",value:ih.ArcSin},{label:"Sign",value:ih.Sign},{label:"Negate",value:ih.Negate},{label:"OneMinus",value:ih.OneMinus},{label:"Reciprocal",value:ih.Reciprocal},{label:"ToDegrees",value:ih.ToDegrees},{label:"ToRadians",value:ih.ToRadians},{label:"Fract",value:ih.Fract}]})],xV.prototype,"operation",void 0),(0,d.i)("BABYLON.ParticleTrigonometryBlock",xV);var NV,DV=V(13144);class kV extends Oh{constructor(Z){super(Z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(eh.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(eh.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(eh.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(eh.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(eh.System),this._inputs[0].excludedConnectionPointTypes.push(eh.Particle),this._inputs[0].excludedConnectionPointTypes.push(eh.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const h=Z=>{const h=this.input.getConnectedValue(Z);if(this.log.length>=this.stackSize)return h;if(null===h||void 0===h)return this.log.push(["null",""]),h;switch(this.input.type){case eh.Vector2:this.log.push([(0,DV.e)(h,4),h.toString()]);break;case eh.Ch:this.log.push([(0,DV.i)(h,4),h.toString()]);break;case eh.nd:this.log.push([`{R: ${h.r.toFixed(4)} G: ${h.g.toFixed(4)} B: ${h.b.toFixed(4)} A: ${h.a.toFixed(4)}}`,h.toString()]);break;default:this.log.push([h.toString(),h.toString()])}return h};this.output.isConnected?this.output._storedFunction=h:this.output._storedValue=h(Z)}serialize(){const Z=super.serialize();return Z.stackSize=this.stackSize,Z}_deserialize(Z){super._deserialize(Z),this.stackSize=Z.stackSize}}(0,W.b)([sh("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],kV.prototype,"stackSize",void 0),(0,d.i)("BABYLON.ParticleDebugBlock",kV);(0,d.i)("BABYLON.ParticleElbowBlock",class extends Oh{constructor(Z){super(Z),this.registerInput("input",eh.AutoDetect),this.registerOutput("output",eh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const h=this._outputs[0],V=this._inputs[0];h._storedFunction=Z=>V.getConnectedValue(Z)}});(0,d.i)("BABYLON.ParticleTeleportInBlock",class extends Oh{get endpoints(){return this._endpoints}constructor(Z){super(Z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",eh.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const h of this.endpoints)if(h.isAnAncestorOfType(Z))return!0;return!1}isAnAncestorOf(Z){for(const h of this.endpoints){if(h===Z)return!0;if(h.isAnAncestorOf(Z))return!0}return!1}attachToEndpoint(Z){Z.detach(),this._endpoints.push(Z),Z._entryPoint=this,Z._outputs[0]._typeConnectionSource=this._inputs[0],Z._tempEntryPointUniqueId=null,Z.name="> "+this.name}detachFromEndpoint(Z){const h=this._endpoints.indexOf(Z);-1!==h&&(this._endpoints.splice(h,1),Z._outputs[0]._typeConnectionSource=null,Z._entryPoint=null)}_build(){for(const Z of this._endpoints)Z.output._storedFunction=Z=>this.input.getConnectedValue(Z)}});(0,d.i)("BABYLON.ParticleTeleportOutBlock",class extends Oh{constructor(Z){super(Z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",eh.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Z){this.entryPoint&&this.entryPoint.build(Z)}clone(){const Z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Z),Z}serialize(){var Z;const h=super.serialize();return h.entryPoint=(null===(Z=this.entryPoint)||void 0===Z?void 0:Z.uniqueId)??"",h}_deserialize(Z){super._deserialize(Z),this._tempEntryPointUniqueId=Z.entryPoint}}),function(Z){Z[Z.Equal=0]="Equal",Z[Z.NotEqual=1]="NotEqual",Z[Z.LessThan=2]="LessThan",Z[Z.GreaterThan=3]="GreaterThan",Z[Z.LessOrEqual=4]="LessOrEqual",Z[Z.GreaterOrEqual=5]="GreaterOrEqual",Z[Z.Xor=6]="Xor",Z[Z.Or=7]="Or",Z[Z.And=8]="And"}(NV||(NV={}));class uV extends Oh{constructor(Z){super(Z),this.test=NV.Equal,this.epsilon=0,this.registerInput("left",eh.Float),this.registerInput("right",eh.Float,!0,0),this.registerInput("ifTrue",eh.AutoDetect,!0,1),this.registerInput("ifFalse",eh.AutoDetect,!0,0),this.registerOutput("output",eh.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=eh.Float,this._inputs[0].acceptedConnectionPointTypes.push(eh.Int),this._inputs[1].acceptedConnectionPointTypes.push(eh.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Z=Z=>{const h=this.left.getConnectedValue(Z),V=this.right.getConnectedValue(Z);let v=!1;switch(this.test){case NV.Equal:v=(0,n.WithinEpsilon)(h,V,this.epsilon);break;case NV.NotEqual:v=!(0,n.WithinEpsilon)(h,V,this.epsilon);break;case NV.LessThan:v=h<V+this.epsilon;break;case NV.GreaterThan:v=h>V-this.epsilon;break;case NV.LessOrEqual:v=h<=V+this.epsilon;break;case NV.GreaterOrEqual:v=h>=V-this.epsilon;break;case NV.Xor:v=!!h&&!V||!h&&!!V;break;case NV.Or:v=!!h||!!V;break;case NV.And:v=!!h&&!!V}return v};this.output._storedFunction=h=>Z(h)?this.ifTrue.getConnectedValue(h):this.ifFalse.getConnectedValue(h)}serialize(){const Z=super.serialize();return Z.test=this.test,Z.epsilon=this.epsilon,Z}_deserialize(Z){super._deserialize(Z),this.test=Z.test,void 0!==Z.epsilon&&(this.epsilon=Z.epsilon)}}(0,W.b)([sh("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:NV.Equal},{label:"NotEqual",value:NV.NotEqual},{label:"LessThan",value:NV.LessThan},{label:"GreaterThan",value:NV.GreaterThan},{label:"LessOrEqual",value:NV.LessOrEqual},{label:"GreaterOrEqual",value:NV.GreaterOrEqual},{label:"Xor",value:NV.Xor},{label:"Or",value:NV.Or},{label:"And",value:NV.And}]})],uV.prototype,"test",void 0),(0,W.b)([sh("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uV.prototype,"epsilon",void 0),(0,d.i)("BABYLON.ParticleConditionBlock",uV);class FV extends Oh{constructor(Z){super(Z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",eh.Particle),this.registerInput("condition",eh.Float,!0,0),this.registerInput("system",eh.System),this.registerOutput("output",eh.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){this._triggerCount=0;const h=this.input.getConnectedValue(Z),V={process:V=>{if(Z.particleContext=V,Z.systemContext=h,0!==this.condition.getConnectedValue(Z)&&(0===this.limit||this._triggerCount<this.limit)){const v=(new Date).getTime();if(this._previousOne&&v-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=v;const A=this.system.getConnectedValue(Z);if(A){const v=fh(A,Z.Wh,V.position);v.jh.addOnce((()=>{this._triggerCount--})),h.jh.addOnce((()=>{v.dispose()}))}}},previousItem:null,nextItem:null};h._updateQueueStart?TZ(V,h._updateQueueStart):h._updateQueueStart=V,this.output._storedValue=h}serialize(){const Z=super.serialize();return Z.limit=this.limit,Z.delay=this.delay,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.limit&&(this.limit=Z.limit),void 0!==Z.delay&&(this.delay=Z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,W.b)([sh("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FV.prototype,"limit",void 0),(0,W.b)([sh("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FV.prototype,"delay",void 0),(0,d.i)("BABYLON.ParticleTriggerBlock",FV);V(13149),V(13162),V(13169),V(13220)},13212:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneFragment",H="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13177:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneFragmentDeclaration",H="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13239:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneVertex",H="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13224:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneVertexDeclaration",H="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13218:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogFragment",H="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13205:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogFragmentDeclaration",H="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13247:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogVertex",H="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13230:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogVertexDeclaration",H="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13193:(Z,h,V)=>{"use strict";var v=V(11647);const A="helperFunctions",H="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13179:(Z,h,V)=>{"use strict";var v=V(11647);const A="imageProcessingDeclaration",H="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13202:(Z,h,V)=>{"use strict";var v=V(11647);const A="imageProcessingFunctions",H="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13187:(Z,h,V)=>{"use strict";var v=V(11647);const A="logDepthDeclaration",H="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13216:(Z,h,V)=>{"use strict";var v=V(11647);const A="logDepthFragment",H="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13254:(Z,h,V)=>{"use strict";var v=V(11647);const A="logDepthVertex",H="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";v.c.IncludesShadersStoreWGSL[A]||(v.c.IncludesShadersStoreWGSL[A]=H)},13169:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{particlesPixelShaderWGSL:()=>K});var v=V(11647);V(13177),V(13179),V(13187),V(13193),V(13202),V(13205),V(13212),V(13216),V(13218);const A="particlesPixelShader",H="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";v.c.ShadersStoreWGSL[A]||(v.c.ShadersStoreWGSL[A]=H);const K={name:A,shader:H}},13220:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{particlesVertexShaderWGSL:()=>K});var v=V(11647);V(13224),V(13230),V(13187),V(13239),V(13247),V(13254);const A="particlesVertexShader",H="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";v.c.ShadersStoreWGSL[A]||(v.c.ShadersStoreWGSL[A]=H);const K={name:A,shader:H}},13086:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneFragment",H="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13154:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneFragmentDeclaration",H="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13103:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneVertex",H="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13164:(Z,h,V)=>{"use strict";var v=V(11647);const A="clipPlaneVertexDeclaration",H="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13095:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogFragment",H="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13079:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogFragmentDeclaration",H="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13112:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogVertex",H="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13100:(Z,h,V)=>{"use strict";var v=V(11647);const A="fogVertexDeclaration",H="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13073:(Z,h,V)=>{"use strict";var v=V(11647);const A="helperFunctions",H="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13061:(Z,h,V)=>{"use strict";var v=V(11647);const A="imageProcessingDeclaration",H="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13077:(Z,h,V)=>{"use strict";var v=V(11647);const A="imageProcessingFunctions",H="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13067:(Z,h,V)=>{"use strict";var v=V(11647);const A="logDepthDeclaration",H="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13093:(Z,h,V)=>{"use strict";var v=V(11647);const A="logDepthFragment",H="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13114:(Z,h,V)=>{"use strict";var v=V(11647);const A="logDepthVertex",H="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";v.c.IncludesShadersStore[A]||(v.c.IncludesShadersStore[A]=H)},13149:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{particlesPixelShader:()=>K});var v=V(11647);V(13154),V(13061),V(13067),V(13073),V(13077),V(13079),V(13086),V(13093),V(13095);const A="particlesPixelShader",H="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";v.c.ShadersStore[A]||(v.c.ShadersStore[A]=H);const K={name:A,shader:H}},13162:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{particlesVertexShader:()=>K});var v=V(11647);V(13164),V(13100),V(13067),V(13103),V(13112),V(13114);const A="particlesVertexShader",H="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";v.c.ShadersStore[A]||(v.c.ShadersStore[A]=H);const K={name:A,shader:H}},13517:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{FlowGraphGLTFDataProvider:()=>H});var v=V(13480),A=V(13459);class H extends v.d{constructor(Z){var h,V;super();const v=Z.glTF,H=(null===(h=v.animations)||void 0===h?void 0:h.map((Z=>Z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",A.c,H);const K=(null===(V=v.nodes)||void 0===V?void 0:V.map((Z=>Z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",A.c,K)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13404:(Z,h,V)=>{"use strict";V.d(h,{d:()=>b,g:()=>u,i:()=>k,l:()=>F});var v=V(11729),A=V(12218),H=V(11781),K=V(13410);const d=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class a{constructor(Z,h){this._gltf=Z,this._infoTree=h}convert(Z){let h,V=this._gltf,v=this._infoTree;if(!Z.startsWith("/"))throw new Error("Path must start with a /");const A=Z.split("/");if(A.shift(),A[A.length-1].includes(".length")){const Z=A[A.length-1].split(".");A.pop(),A.push(...Z)}let H=!1;for(const a of A){const A="length"===a;if(A&&!v.__array__)throw new Error(`Path ${Z} is invalid`);if(v.__ignoreObjectTree__&&(H=!0),v.__array__&&!A)v=v.__array__;else if(v=v[a],!v)throw new Error(`Path ${Z} is invalid`);if(!H)if(void 0===V){if(!d.find((h=>h.regex.test(Z))))throw new Error(`Path ${Z} is invalid`)}else if(!A){var K;V=null===(K=V)||void 0===K?void 0:K[a]}(v.__target__||A)&&(h=V)}return{object:h,info:v}}}function n(Z,h,V,v){const A=x(Z,h);return v?A[V][v]:A[V]}function x(Z,h,V){var v,H;return null===(v=Z._data)||void 0===v||null===(H=v[(null===V||void 0===V?void 0:V.fillMode)??A.e.MATERIAL_TriangleFillMode])||void 0===H?void 0:H.babylonMaterial}function N(Z,h){return{offset:{componentsCount:2,type:"Vector2",get:(V,A,H)=>{const K=n(V,H,Z,h);return new v.Vector2(null===K||void 0===K?void 0:K.uOffset,null===K||void 0===K?void 0:K.vOffset)},getTarget:x,set:(V,v,A,H)=>{const K=n(v,H,Z,h);K.uOffset=V.x,K.vOffset=V.y},getPropertyName:[()=>`${Z}${h?"."+h:""}.uOffset`,()=>`${Z}${h?"."+h:""}.vOffset`]},rotation:{type:"number",get:(V,v,A)=>{var H;return null===(H=n(V,A,Z,h))||void 0===H?void 0:H.wAng},getTarget:x,set:(V,v,A,H)=>n(v,H,Z,h).wAng=V,getPropertyName:[()=>`${Z}${h?"."+h:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(V,A,H)=>{const K=n(V,H,Z,h);return new v.Vector2(null===K||void 0===K?void 0:K.uScale,null===K||void 0===K?void 0:K.vScale)},getTarget:x,set:(V,v,A,H)=>{const K=n(v,H,Z,h);K.uScale=V.x,K.vScale=V.y},getPropertyName:[()=>`${Z}${h?"."+h:""}.uScale`,()=>`${Z}${h?"."+h:""}.vScale`]}}}const D={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Z=>{var h,V;return new v.Vector2((null===(h=Z._babylonCamera)||void 0===h?void 0:h.orthoLeft)??0,(null===(V=Z._babylonCamera)||void 0===V?void 0:V.orthoRight)??0)},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.orthoLeft=Z.x,h._babylonCamera.orthoRight=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Z=>{var h,V;return new v.Vector2((null===(h=Z._babylonCamera)||void 0===h?void 0:h.orthoBottom)??0,(null===(V=Z._babylonCamera)||void 0===V?void 0:V.orthoTop)??0)},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.orthoBottom=Z.x,h._babylonCamera.orthoTop=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Z=>{var h;return null===(h=Z._babylonCamera)||void 0===h?void 0:h.maxZ},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var h;return null===(h=Z._babylonCamera)||void 0===h?void 0:h.Rh},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.Rh=Z)},getTarget:Z=>Z,getPropertyName:[()=>"Rh"]}},perspective:{aspectRatio:{type:"number",get:Z=>{var h;return null===(h=Z._babylonCamera)||void 0===h?void 0:h.getEngine().getAspectRatio(Z._babylonCamera)},getTarget:Z=>Z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Z=>{var h;return null===(h=Z._babylonCamera)||void 0===h?void 0:h.fov},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.fov=Z)},getTarget:Z=>Z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Z=>{var h;return null===(h=Z._babylonCamera)||void 0===h?void 0:h.maxZ},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var h;return null===(h=Z._babylonCamera)||void 0===h?void 0:h.Rh},set:(Z,h)=>{h._babylonCamera&&(h._babylonCamera.Rh=Z)},getTarget:Z=>Z,getPropertyName:[()=>"Rh"]}}}},nodes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Ch",get:Z=>{var h;return null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.position},set:(Z,h)=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.position.v(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Z=>{var h;return null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion},set:(Z,h)=>{var V,v;return null===(V=h._babylonTransformNode)||void 0===V||null===(v=V.rotationQuaternion)||void 0===v?void 0:v.v(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Ch",get:Z=>{var h;return null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.tv},set:(Z,h)=>{var V;return null===(V=h._babylonTransformNode)||void 0===V?void 0:V.tv.v(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"tv"]},weights:{length:{type:"number",get:Z=>Z._numMorphTargets,getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Z,h)=>{var V,v;return void 0!==h?null===(V=Z._primitiveBabylonMeshes)||void 0===V||null===(v=V[0].morphTargetManager)||void 0===v?void 0:v.getTarget(h).influence:void 0},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Z,h)=>[0],getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Z=>{var h,V,A;return v.Matrix.Compose(null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.tv,null===(V=Z._babylonTransformNode)||void 0===V?void 0:V.rotationQuaternion,null===(A=Z._babylonTransformNode)||void 0===A?void 0:A.position)},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Z=>{var h,V,A,H;const K=v.Matrix.Identity();let d=Z.parent;for(;d&&d.parent;)d=d.parent;const a=(null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.position._isDirty)||(null===(V=Z._babylonTransformNode)||void 0===V||null===(A=V.rotationQuaternion)||void 0===A?void 0:A._isDirty)||(null===(H=Z._babylonTransformNode)||void 0===H?void 0:H.tv._isDirty);if(d){var n;const h=null===(n=d._babylonTransformNode)||void 0===n?void 0:n.sh(!0).invert();var x,N;if(h)null===(x=Z._babylonTransformNode)||void 0===x||null===(N=x.sh(a))||void 0===N||N.multiplyToRef(h,K)}else Z._babylonTransformNode&&K.v(Z._babylonTransformNode.sh(a));return K},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Z=>{var h,V;return null===(h=Z._babylonTransformNode)||void 0===h||null===(V=h.getChildren((Z=>Z instanceof K.c),!0)[0])||void 0===V?void 0:V.Fd},getTarget:Z=>{var h;return null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.getChildren((Z=>Z instanceof K.c),!0)[0]},set:(Z,h)=>{if(h._babylonTransformNode){const V=h._babylonTransformNode.getChildren((Z=>Z instanceof K.c),!0)[0];V&&(V.Fd=Z)}}},color:{type:"Ih",get:Z=>{var h,V;return null===(h=Z._babylonTransformNode)||void 0===h||null===(V=h.getChildren((Z=>Z instanceof K.c),!0)[0])||void 0===V?void 0:V.bd},getTarget:Z=>{var h;return null===(h=Z._babylonTransformNode)||void 0===h?void 0:h.getChildren((Z=>Z instanceof K.c),!0)[0]},set:(Z,h)=>{if(h._babylonTransformNode){const V=h._babylonTransformNode.getChildren((Z=>Z instanceof K.c),!0)[0];V&&(V.bd=Z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ih",get:(Z,h,V)=>x(Z,h,V).emissiveColor,set:(Z,h,V,v)=>x(h,V,v).emissiveColor.v(Z),getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:N("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Z,h,V)=>{var v;return null===(v=n(Z,V,"bumpTexture"))||void 0===v?void 0:v.level},set:(Z,h,V,v)=>{const A=n(h,v,"bumpTexture");A&&(A.level=Z)},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:N("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Z,h,V)=>x(Z,h,V).ambientTextureStrength,set:(Z,h,V,v)=>{const A=x(h,V,v);A&&(A.ambientTextureStrength=Z)},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:N("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"nd",get:(Z,h,V)=>{const v=x(Z,h,V);return H.nd.FromColor3(v.albedoColor,v.alpha)},set:(Z,h,V,v)=>{const A=x(h,V,v);A.albedoColor.set(Z.r,Z.g,Z.b),A.alpha=Z.a},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:N("albedoTexture")}},metallicFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).metallic,set:(Z,h,V,v)=>{const A=x(h,V,v);A&&(A.metallic=Z)},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).roughness,set:(Z,h,V,v)=>{const A=x(h,V,v);A&&(A.roughness=Z)},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:N("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Z,h,V)=>x(Z,h,V).anisotropy.Fd,set:(Z,h,V,v)=>{x(h,V,v).anisotropy.Fd=Z},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Z,h,V)=>x(Z,h,V).anisotropy.angle,set:(Z,h,V,v)=>{x(h,V,v).anisotropy.angle=Z},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:N("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).clearCoat.Fd,set:(Z,h,V,v)=>{x(h,V,v).clearCoat.Fd=Z},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).clearCoat.roughness,set:(Z,h,V,v)=>{x(h,V,v).clearCoat.roughness=Z},getTarget:(Z,h,V)=>x(Z,h,V),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:N("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Z,h,V)=>{var v;return null===(v=x(Z,h,V).clearCoat.bumpTexture)||void 0===v?void 0:v.level},getTarget:x,set:(Z,h,V,v)=>x(h,V,v).clearCoat.bumpTexture.level=Z},extensions:{KHR_texture_transform:N("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:N("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Z,h,V)=>x(Z,h,V).subSurface.dispersion,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).subSurface.dispersion=Z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Z,h,V)=>x(Z,h,V).emissiveIntensity,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).emissiveIntensity=Z}},KHR_materials_ior:{ior:{type:"number",get:(Z,h,V)=>x(Z,h,V).indexOfRefraction,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).indexOfRefraction=Z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).iridescence.Fd,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).iridescence.Fd=Z},iridescenceIor:{type:"number",get:(Z,h,V)=>x(Z,h,V).iridescence.indexOfRefraction,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).iridescence.indexOfRefraction=Z},iridescenceTexture:{extensions:{KHR_texture_transform:N("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Z,h,V)=>x(Z,h,V).iridescence.maximumThickness,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).iridescence.maximumThickness=Z},iridescenceThicknessMinimum:{type:"number",get:(Z,h,V)=>x(Z,h,V).iridescence.minimumThickness,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).iridescence.minimumThickness=Z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:N("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ih",get:(Z,h,V)=>x(Z,h,V).sheen.color,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).sheen.color.v(Z)},sheenColorTexture:{extensions:{KHR_texture_transform:N("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).sheen.Fd,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).sheen.Fd=Z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:N("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).metallicF0Factor,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).metallicF0Factor=Z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ih",get:(Z,h,V)=>x(Z,h,V).metallicReflectanceColor,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).metallicReflectanceColor.v(Z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:N("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:N("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).subSurface.refractionIntensity,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).subSurface.refractionIntensity=Z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:N("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).subSurface.translucencyIntensity,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).subSurface.translucencyIntensity=Z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:N("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ih",get:(Z,h,V)=>x(Z,h,V).subSurface.translucencyColor,getTarget:x,set:(Z,h,V,v)=>{var A;return Z&&(null===(A=x(h,V,v).subSurface.translucencyColor)||void 0===A?void 0:A.v(Z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:N("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ih",get:(Z,h,V)=>x(Z,h,V).subSurface.tintColor,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).subSurface.tintColor.v(Z)},attenuationDistance:{type:"number",get:(Z,h,V)=>x(Z,h,V).subSurface.tintColorAtDistance,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).subSurface.tintColorAtDistance=Z},thicknessFactor:{type:"number",get:(Z,h,V)=>x(Z,h,V).subSurface.maximumThickness,getTarget:x,set:(Z,h,V,v)=>x(h,V,v).subSurface.maximumThickness=Z},thicknessTexture:{extensions:{KHR_texture_transform:N("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,color:{type:"Ih",get:Z=>{var h;return null===(h=Z._babylonLight)||void 0===h?void 0:h.bd},set:(Z,h)=>{var V;return null===(V=h._babylonLight)||void 0===V?void 0:V.bd.v(Z)},getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"diffuse"]},Fd:{type:"number",get:Z=>{var h;return null===(h=Z._babylonLight)||void 0===h?void 0:h.Fd},set:(Z,h)=>h._babylonLight?h._babylonLight.Fd=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"intensity"]},range:{type:"number",get:Z=>{var h;return null===(h=Z._babylonLight)||void 0===h?void 0:h.range},set:(Z,h)=>h._babylonLight?h._babylonLight.range=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"range"]},spot:{innerConeAngle:{type:"number",get:Z=>{var h;return null===(h=Z._babylonLight)||void 0===h?void 0:h.innerAngle},set:(Z,h)=>h._babylonLight?h._babylonLight.innerAngle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Z=>{var h;return null===(h=Z._babylonLight)||void 0===h?void 0:h.angle},set:(Z,h)=>h._babylonLight?h._babylonLight.angle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTexture)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,Fd:{type:"number",get:Z=>{var h;return null===(h=Z._babylonTexture)||void 0===h?void 0:h.level},set:(Z,h)=>{h._babylonTexture&&(h._babylonTexture.level=Z)},getTarget:Z=>Z._babylonTexture},rotation:{type:"Quaternion",get:Z=>{var h;return Z._babylonTexture&&v.Quaternion.FromRotationMatrix(null===(h=Z._babylonTexture)||void 0===h?void 0:h.getReflectionTextureMatrix())},set:(Z,h)=>{var V;h._babylonTexture&&(null!==(V=h._babylonTexture.CZ())&&void 0!==V&&V.useRightHandedSystem||(Z=v.Quaternion.Inverse(Z)),v.Matrix.FromQuaternionToRef(Z,h._babylonTexture.getReflectionTextureMatrix()))},getTarget:Z=>Z._babylonTexture}}}}},animations:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>{var h;return null===(h=Z.primitives[0]._instanceData)||void 0===h?void 0:h.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function k(Z){return new a(Z,D)}function u(Z){const h=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let V=D;for(const v of h)v&&(V=V[v]);if(V&&V.type&&V.get)return V}function F(Z,h){const V=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let v=D;for(const A of V)A&&(v=v[A]);v&&v.type&&v.get&&(v.interpolation=h)}function b(Z,h){const V=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let v=D;for(const A of V)if(A){if(!v[A]){if("?"===A){v.__ignoreObjectTree__=!0;continue}v[A]={},"__array__"===A&&(v[A].__target__=!0)}v=v[A]}Object.assign(v,h)}},13417:(Z,h,V)=>{"use strict";V.r(h),V.d(h,{AnimationPropertyInfo:()=>n,TransformNodeAnimationPropertyInfo:()=>x,WeightAnimationPropertyInfo:()=>N,getQuaternion:()=>d,getVector3:()=>K,getWeights:()=>a});var v=V(12268),A=V(11729),H=V(13404);function K(Z,h,V,v){return A.Ch.eh(h,V).scaleInPlace(v)}function d(Z,h,V,v){return A.Quaternion.eh(h,V).scaleInPlace(v)}function a(Z,h,V,v){const A=new Array(Z._numMorphTargets);for(let H=0;H<A.length;H++)A[H]=h[V++]*v;return A}class n{constructor(Z,h,V,v){this.type=Z,this.name=h,this.getValue=V,this.getStride=v}_buildAnimation(Z,h,V){const A=new v.c(Z,this.name,h,this.type);return A.setKeys(V),A}}class x extends n{buildAnimations(Z,h,V,v){const A=[];return A.push({babylonAnimatable:Z._babylonTransformNode,babylonAnimation:this._buildAnimation(h,V,v)}),A}}class N extends n{buildAnimations(Z,h,V,A){const H=[];if(Z._numMorphTargets)for(let K=0;K<Z._numMorphTargets;K++){const d=new v.c(`${h}_${K}`,this.name,V,this.type);if(d.setKeys(A.map((Z=>({frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[K]:void 0,value:Z.value[K],outTangent:Z.outTangent?Z.outTangent[K]:void 0,interpolation:Z.interpolation})))),Z._primitiveBabylonMeshes)for(const h of Z._primitiveBabylonMeshes)if(h.morphTargetManager){const Z=h.morphTargetManager.getTarget(K),V=d.clone();Z.animations.push(V),H.push({babylonAnimatable:Z,babylonAnimation:V})}}return H}}(0,H.l)("/nodes/{}/translation",[new x(v.c.ANIMATIONTYPE_VECTOR3,"position",K,(()=>3))]),(0,H.l)("/nodes/{}/rotation",[new x(v.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",d,(()=>4))]),(0,H.l)("/nodes/{}/scale",[new x(v.c.ANIMATIONTYPE_VECTOR3,"tv",K,(()=>3))]),(0,H.l)("/nodes/{}/weights",[new N(v.c.ANIMATIONTYPE_FLOAT,"influence",a,(Z=>Z._numMorphTargets))])},13383:(Z,h,V)=>{"use strict";class v{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Z,h)=>{this._resolve=Z,this._reject=h}))}}var A=V(11729),H=V(11781),K=V(11564),d=V(12192),a=V(13387),n=V(13392),x=V(11566),N=V(12211),D=V(12268),k=V(12271),u=V(11599),F=V(11580),b=V(11582);class o{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Z){this._useTextureToStoreBoneMatrices=Z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Z,h,V){this.name=Z,this.id=h,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=A.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new x.b,this.bones=[],this._scene=V||u.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const v=this._scene.getEngine().getCaps();this._canUseTextureForBones=v.textureFloat&&v.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Z=>!Z.getParent()))}getTransformMatrices(Z){if(this.needInitialSkinMatrix){if(!Z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Z._bonesTransformMatrices||this.prepare(!0),Z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Z){return this.needInitialSkinMatrix&&Z._transformMatrixTexture?Z._transformMatrixTexture:this._transformMatrixTexture}CZ(){return this._scene}toString(Z){let h=`Name: ${this.name}, nBones: ${this.bones.length}`;if(h+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Z){h+=", Ranges: {";let Z=!0;for(const V in this._ranges)Z&&(h+=", ",Z=!1),h+=V;h+="}"}return h}getBoneIndexByName(Z){for(let h=0,V=this.bones.length;h<V;h++)if(this.bones[h].name===Z)return h;return-1}createAnimationRange(Z,h,V){if(!this._ranges[Z]){this._ranges[Z]=new k.c(Z,h,V);for(let v=0,A=this.bones.length;v<A;v++)this.bones[v].animations[0]&&this.bones[v].animations[0].createRange(Z,h,V)}}deleteAnimationRange(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let V=0,v=this.bones.length;V<v;V++)this.bones[V].animations[0]&&this.bones[V].animations[0].deleteRange(Z,h);this._ranges[Z]=null}getAnimationRange(Z){return this._ranges[Z]||null}getAnimationRanges(){const Z=[];let h;for(h in this._ranges)Z.push(this._ranges[h]);return Z}copyAnimationRange(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[h]||!Z.getAnimationRange(h))return!1;let v=!0;const A=this._getHighestAnimationFrame()+1,H={},K=Z.bones;let d,a;for(a=0,d=K.length;a<d;a++)H[K[a].name]=K[a];this.bones.length!==K.length&&(F.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${K.length}`),v=!1);const n=V&&this.dimensionsAtRest&&Z.dimensionsAtRest?this.dimensionsAtRest.divide(Z.dimensionsAtRest):null;for(a=0,d=this.bones.length;a<d;a++){const Z=this.bones[a].name,K=H[Z];K?v=v&&this.bones[a].copyAnimationRange(K,h,A,V,n):(F.b.Warn("copyAnimationRange: not same rig, missing source bone "+Z),v=!1)}const x=Z.getAnimationRange(h);return x&&(this._ranges[h]=new k.c(h,x.from+A,x.to+A)),v}returnToRest(){for(const Z of this.bones)-1!==Z._index&&Z.returnToRest()}_getHighestAnimationFrame(){let Z=0;for(let h=0,V=this.bones.length;h<V;h++)if(this.bones[h].animations[0]){const V=this.bones[h].animations[0].getHighestFrame();Z<V&&(Z=V)}return Z}beginAnimation(Z,h,V,v){const A=this.getAnimationRange(Z);return A?this._scene.beginAnimation(this,A.from,A.to,h,V,v):null}static MakeAnimationAdditive(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;const v=Z.getAnimationRange(V);if(!v)return null;const A=Z._scene.getAllAnimatablesByTarget(Z);let H=null;for(let d=0;d<A.length;d++){const Z=A[d];if(Z.fromFrame===(null===v||void 0===v?void 0:v.from)&&Z.toFrame===(null===v||void 0===v?void 0:v.to)){H=Z;break}}const K=Z.getAnimatables();for(let d=0;d<K.length;d++){const Z=K[d].animations;if(Z)for(let v=0;v<Z.length;v++)D.c.MakeAnimationAdditive(Z[v],h,V)}return H&&(H.isAdditive=!0),Z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Z){this._meshesWithPoseMatrix.push(Z)}_unregisterMeshWithPoseMatrix(Z){const h=this._meshesWithPoseMatrix.indexOf(Z);h>-1&&this._meshesWithPoseMatrix.splice(h,1)}_computeTransformMatrices(Z,h){this.onBeforeComputeObservable.notifyObservers(this);for(let V=0;V<this.bones.length;V++){const v=this.bones[V];v._childUpdateId++;const A=v.getParent();if(A?v.getLocalMatrix().multiplyToRef(A.getFinalMatrix(),v.getFinalMatrix()):h?v.getLocalMatrix().multiplyToRef(h,v.getFinalMatrix()):v.getFinalMatrix().v(v.getLocalMatrix()),-1!==v._index){const h=null===v._index?V:v._index;v.getAbsoluteInverseBindMatrix().multiplyToArray(v.getFinalMatrix(),Z,16*h)}}this._identity.copyToArray(Z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Z=this.CZ().getRenderId();if(this._currentRenderId===Z)return;this._currentRenderId=Z}if(this._numBonesWithLinkedTransformNode>0)for(const Z of this.bones)if(Z._linkedTransformNode){const h=Z._linkedTransformNode;Z.position=h.position,h.rotationQuaternion?Z.rotationQuaternion=h.rotationQuaternion:Z.rotation=h.rotation,Z.tv=h.tv}if(this.needInitialSkinMatrix)for(const Z of this._meshesWithPoseMatrix){const h=Z.getPoseMatrix();let V=this._isDirty;if(Z._bonesTransformMatrices&&Z._bonesTransformMatrices.length===16*(this.bones.length+1)||(Z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),V=!0),V){if(this._synchronizedWithMesh!==Z){this._synchronizedWithMesh=Z;for(const Z of this.bones)if(!Z.getParent()){Z.getBindMatrix().multiplyToRef(h,A.TmpVectors.Matrix[1]),Z._updateAbsoluteBindMatrices(A.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const h=4*(this.bones.length+1);Z._transformMatrixTexture&&Z._transformMatrixTexture.getSize().width===h||(Z._transformMatrixTexture&&Z._transformMatrixTexture.dispose(),Z._transformMatrixTexture=N.d.CreateRGBATexture(Z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Z._bonesTransformMatrices,h),this.isUsingTextureForMatrices&&Z._transformMatrixTexture&&Z._transformMatrixTexture.update(Z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=N.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Z=0;Z<this.bones.length;Z++)this._animatables.push(this.bones[Z])}return this._animatables}clone(Z,h){const V=new o(Z,h||Z,this._scene);V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let v=0;v<this.bones.length;v++){const Z=this.bones[v];let h=null;const A=Z.getParent();if(A){const Z=this.bones.indexOf(A);h=V.bones[Z]}const H=new n.c(Z.name,V,h,Z.getBindMatrix().clone(),Z.getRestMatrix().clone());H._index=Z._index,Z._linkedTransformNode&&H.linkTransformNode(Z._linkedTransformNode),b.b.DeepCopy(Z.animations,H.animations)}if(this._ranges){V._ranges={};for(const Z in this._ranges){const h=this._ranges[Z];h&&(V._ranges[Z]=h.clone())}}return this._isDirty=!0,V.prepare(!0),V}enableBlending(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const h of this.bones)for(const V of h.animations)V.enableBlending=!0,V.blendingSpeed=Z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.CZ().stopAnimation(this),this.CZ().removeSkeleton(this),this._parentContainer){const Z=this._parentContainer.skeletons.indexOf(this);Z>-1&&this._parentContainer.skeletons.splice(Z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Z={};Z.name=this.name,Z.id=this.id,this.dimensionsAtRest&&(Z.dimensionsAtRest=this.dimensionsAtRest.mh()),Z.bones=[],Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let V=0;V<this.bones.length;V++){var h;const v=this.bones[V],A=v.getParent(),H={parentBoneIndex:A?this.bones.indexOf(A):-1,index:v.getIndex(),name:v.name,id:v.id,matrix:v.getBindMatrix().mh(),rest:v.getRestMatrix().mh(),linkedTransformNodeId:null===(h=v.getTransformNode())||void 0===h?void 0:h.id};Z.bones.push(H),v.length&&(H.length=v.length),v.metadata&&(H.metadata=v.metadata),v.animations&&v.animations.length>0&&(H.animation=v.animations[0].serialize()),Z.ranges=[];for(const h in this._ranges){const V=this._ranges[h];if(!V)continue;const v={};v.name=h,v.from=V.from,v.to=V.to,Z.ranges.push(v)}}return Z}static Parse(Z,h){const V=new o(Z.name,Z.id,h);let v;for(Z.dimensionsAtRest&&(V.dimensionsAtRest=A.Ch.eh(Z.dimensionsAtRest)),V.needInitialSkinMatrix=Z.needInitialSkinMatrix,v=0;v<Z.bones.length;v++){const h=Z.bones[v],H=Z.bones[v].index;let K=null;h.parentBoneIndex>-1&&(K=V.bones[h.parentBoneIndex]);const d=h.rest?A.Matrix.eh(h.rest):null,a=new n.c(h.name,V,K,A.Matrix.eh(h.matrix),d,null,H);void 0!==h.id&&null!==h.id&&(a.id=h.id),h.length&&(a.length=h.length),h.metadata&&(a.metadata=h.metadata),h.animation&&a.animations.push(D.c.Parse(h.animation)),void 0!==h.linkedTransformNodeId&&null!==h.linkedTransformNodeId&&(V._hasWaitingData=!0,a._waitingTransformNodeId=h.linkedTransformNodeId)}if(Z.ranges)for(v=0;v<Z.ranges.length;v++){const h=Z.ranges[v];V.createAnimationRange(h.name,h.from,h.to)}return V}computeAbsoluteMatrices(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Z)}getPoseMatrix(){let Z=null;return this._meshesWithPoseMatrix.length>0&&(Z=this._meshesWithPoseMatrix[0].getPoseMatrix()),Z}sortBones(){const Z=[],h=new Array(this.bones.length);for(let V=0;V<this.bones.length;V++)this._sortBones(V,Z,h);this.bones=Z}_sortBones(Z,h,V){if(V[Z])return;V[Z]=!0;const v=this.bones[Z];if(!v)return;void 0===v._index&&(v._index=Z);const A=v.getParent();A&&this._sortBones(this.bones.indexOf(A),h,V),h.push(v)}setCurrentPoseAsRest(){for(const Z of this.bones)Z.setCurrentPoseAsRest()}}var q=V(12062),X=V(12230),E=V(11713),j=V(12146),P=V(11805),C=V(12197),l=V(12157),B=V(12184),S=V(12278),r=V(11833),L=V(13341);class y{set areUpdatesFrozen(Z){Z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new r.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Z||(Z=u.b.LastCreatedScene),this._scene=Z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Z.canUseGLVertexID&&Z.textureFloat&&Z.maxVertexTextureImageUnits>0&&Z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return y.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?y.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Z){this._numMaxInfluencers!==Z&&(this._numMaxInfluencers=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Z){this._useTextureToStoreTargets!==Z&&(this._useTextureToStoreTargets=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Z;return y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Z=this._scene)&&void 0!==Z&&Z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Z){return this._activeTargets.data[Z]}getTarget(Z){return this._targets[Z]}getTargetByName(Z){for(const h of this._targets)if(h.name===Z)return h;return null}addTarget(Z){this._targets.push(Z),this._targetInfluenceChangedObservers.push(Z.onInfluenceChanged.add((Z=>{this.areUpdatesFrozen&&Z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Z)}))),this._targetDataLayoutChangedObservers.push(Z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Z){const h=this._targets.indexOf(Z);h>=0&&(this._targets.splice(h,1),Z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(h,1)[0]),Z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(h,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Z)}_bind(Z){Z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Z.setTexture("morphTargets",this._targetStoreTexture),Z.setInt("morphTargetCount",this.numInfluencers)}clone(){const Z=new y(this._scene);for(const h of this._targets)Z.addTarget(h.clone());return Z.enablePositionMorphing=this.enablePositionMorphing,Z.enableNormalMorphing=this.enableNormalMorphing,Z.enableTangentMorphing=this.enableTangentMorphing,Z.enableUVMorphing=this.enableUVMorphing,Z.enableUV2Morphing=this.enableUV2Morphing,Z.enableColorMorphing=this.enableColorMorphing,Z}serialize(){const Z={};Z.id=this.uniqueId,Z.targets=[];for(const h of this._targets)Z.targets.push(h.serialize());return Z}_syncActiveTargets(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const h=!!this._targetStoreTexture,V=this.isUsingTextureForTargets;(this._mustSynchronize||h!==V)&&(this._mustSynchronize=!1,this.synchronize());let v=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let A=-1;for(const H of this._targets)if(A++,0!==H.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(H),this._morphTargetTextureIndices[v]=A,this._tempInfluences[v++]=H.influence}this._morphTargetTextureIndices.length!==v&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,v)),this._influences&&this._influences.length===v||(this._influences=new Float32Array(v));for(let H=0;H<v;H++)this._influences[H]=this._tempInfluences[H];if(Z&&this._scene)for(const H of this._scene.meshes)H.morphTargetManager===this&&(V?H._markSubMeshesAsAttributesDirty():H._syncGeometryWithMorphTargetManager())}synchronize(){var Z;if(!this._scene||this.areUpdatesFrozen)return;const h=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Z=this._targetStoreTexture)||void 0===Z||Z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>h.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const V of this._targets){this._supportsPositions=this._supportsPositions&&V.hasPositions,this._supportsNormals=this._supportsNormals&&V.hasNormals,this._supportsTangents=this._supportsTangents&&V.hasTangents,this._supportsUVs=this._supportsUVs&&V.hasUVs,this._supportsUV2s=this._supportsUV2s&&V.hasUV2s,this._supportsColors=this._supportsColors&&V.hasColors;const Z=V.vertexCount;if(0===this._vertexCount)this._vertexCount=Z;else if(this._vertexCount!==Z)return void F.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${V.name}": ${Z}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Z=h.getCaps().maxTextureSize;this._textureWidth>Z&&(this._textureHeight=Math.ceil(this._textureWidth/Z),this._textureWidth=Z);const V=this._targets.length,v=new Float32Array(V*this._textureWidth*this._textureHeight*4);let A=0;for(let h=0;h<V;h++){const Z=this._targets[h],V=Z.getPositions(),H=Z.getNormals(),K=Z.getUVs(),d=Z.getTangents(),a=Z.getUV2s(),n=Z.getColors();A=h*this._textureWidth*this._textureHeight*4;for(let h=0;h<this._vertexCount;h++)this._supportsPositions&&V&&(v[A]=V[3*h],v[A+1]=V[3*h+1],v[A+2]=V[3*h+2],A+=4),this._supportsNormals&&H&&(v[A]=H[3*h],v[A+1]=H[3*h+1],v[A+2]=H[3*h+2],A+=4),this._supportsUVs&&K&&(v[A]=K[2*h],v[A+1]=K[2*h+1],A+=4),this._supportsTangents&&d&&(v[A]=d[3*h],v[A+1]=d[3*h+1],v[A+2]=d[3*h+2],A+=4),this._supportsUV2s&&a&&(v[A]=a[2*h],v[A+1]=a[2*h+1],A+=4),this._supportsColors&&n&&(v[A]=n[4*h],v[A+1]=n[4*h+1],v[A+2]=n[4*h+2],v[A+3]=n[4*h+3],A+=4)}this._targetStoreTexture=L.c.CreateRGBATexture(v,this._textureWidth,this._textureHeight,V,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const V of this._scene.meshes)V.morphTargetManager===this&&V._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Z=this._parentContainer.morphTargetManagers.indexOf(this);Z>-1&&this._parentContainer.morphTargetManagers.splice(Z,1),this._parentContainer=null}for(const Z of this._targets)this._scene.stopAnimation(Z)}}static Parse(Z,h){const V=new y(h);for(const v of Z.targets)V.addTarget(S.c.Parse(v,h));return V}}y.EnableTextureStorage=!0,y.MaxActiveMorphTargetsInVertexAttributeMode=8,y.ConstantTargetCountForTextureMode=0;var W=V(13395),z=V(11602),m=V(12074);const g=new Map,I=g;function e(Z,h,V){U(Z)&&F.b.Warn(`Extension with the name '${Z}' already exists`),g.set(Z,{isGLTFExtension:h,factory:V})}function U(Z){return g.delete(Z)}var R=V(13404),Q=V(12326),w=V(11822);class T{static Get(Z,h,V){if(!h||void 0==V||!h[V])throw new Error(`${Z}: Failed to find index (${V})`);return h[V]}static TryGet(Z,h){return Z&&void 0!=h&&Z[h]?Z[h]:null}static Assign(Z){if(Z)for(let h=0;h<Z.length;h++)Z[h].index=h}}function t(Z){if(Z.min&&Z.max){const h=Z.min,V=Z.max,v=A.TmpVectors.Ch[0].IV(h[0],h[1],h[2]),H=A.TmpVectors.Ch[1].IV(V[0],V[1],V[2]);if(Z.normalized&&5126!==Z.componentType){let h=1;switch(Z.componentType){case 5120:h=127;break;case 5121:h=255;break;case 5122:h=32767;break;case 5123:h=65535}const V=1/h;v.scaleInPlace(V),H.scaleInPlace(V)}return new m.c(v,H)}return null}class c{static RegisterExtension(Z,h){e(Z,!1,h)}static UnregisterExtension(Z){return U(Z)}get Lh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Z=>Z.dispose&&Z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Z,h,V,v,A,H){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=h,this._assetContainer=V,this._loadData(v);let H=null;if(Z){const h={};if(this._gltf.nodes)for(const Z of this._gltf.nodes)Z.name&&(h[Z.name]=Z.index);H=(Z instanceof Array?Z:[Z]).map((Z=>{const V=h[Z];if(void 0===V)throw new Error(`Failed to find node '${Z}'`);return V}))}return await this._loadAsync(A,K,H,(()=>({meshes:this._getMeshes(),bD:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Z,this._loadData(h),await this._loadAsync(V,A,null,(()=>{}))}async _loadAsync(Z,h,V,v){return await Promise.resolve().then((async()=>{this._rootUrl=Z,this._uniqueRootUrl=!Z.startsWith("file:")&&h?Z:`${Z}${Date.now()}/`,this._fileName=h,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const A=`${W.m[W.m.LOADING]} => ${W.m[W.m.READY]}`,H=`${W.m[W.m.LOADING]} => ${W.m[W.m.COMPLETE]}`;this._parent._startPerformanceCounter(A),this._parent._startPerformanceCounter(H),this._parent._setState(W.m.LOADING),this._extensionsOnLoading();const d=new Array;if(!this.parent.loadOnlyMaterials)if(V)d.push(this.loadSceneAsync("/nodes",{nodes:V,index:-1}));else if(void 0!=this._gltf.Wh||this._gltf.scenes&&this._gltf.scenes[0]){const Z=T.Get("/scene",this._gltf.scenes,this._gltf.Wh||0);d.push(this.loadSceneAsync(`/scenes/${Z.index}`,Z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Z=0;Z<this._gltf.materials.length;++Z){const h=this._gltf.materials[Z],V="/materials/"+Z,v=q.b.TriangleFillMode;d.push(this._loadMaterialAsync(V,h,null,v,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&d.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&d.push(this._compileShadowGeneratorsAsync());const a=Promise.all(d).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Va(!0);for(const Z of this._babylonScene.materials){const h=Z;void 0!==h.maxSimultaneousLights&&(h.maxSimultaneousLights=Math.max(h.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(W.m.READY),this._skipStartAnimationStep||this._startAnimations(),v()}));return await a.then((Z=>(this._parent._endPerformanceCounter(A),K.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(H),this._parent._setState(W.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Z=>{this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()}))})),Z)))})).catch((Z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()),Z}))}_loadData(Z){if(this._gltf=Z.json,this._setupData(),Z.bin){const h=this._gltf.buffers;if(h&&h[0]&&!h[0].uri){const V=h[0];(V.byteLength<Z.bin.byteLength-3||V.byteLength>Z.bin.byteLength)&&F.b.Warn(`Binary buffer length (${V.byteLength}) from JSON does not match chunk length (${Z.bin.byteLength})`),this._bin=Z.bin}else F.b.Warn("Unexpected BIN chunk")}}_setupData(){if(T.Assign(this._gltf.accessors),T.Assign(this._gltf.animations),T.Assign(this._gltf.buffers),T.Assign(this._gltf.bufferViews),T.Assign(this._gltf.cameras),T.Assign(this._gltf.images),T.Assign(this._gltf.materials),T.Assign(this._gltf.meshes),T.Assign(this._gltf.nodes),T.Assign(this._gltf.samplers),T.Assign(this._gltf.scenes),T.Assign(this._gltf.skins),T.Assign(this._gltf.textures),this._gltf.nodes){const Z={};for(const V of this._gltf.nodes)if(V.children)for(const h of V.children)Z[h]=V.index;const h=this._createRootNode();for(const V of this._gltf.nodes){const v=Z[V.index];V.parent=void 0===v?h:this._gltf.nodes[v]}}}async _loadExtensionsAsync(){const Z=[];if(I.forEach(((h,V)=>{var v;!1===(null===(v=this.parent.extensionOptions[V])||void 0===v?void 0:v.enabled)?h.isGLTFExtension&&this.isExtensionUsed(V)&&F.b.Warn(`Extension ${V} is used but has been explicitly disabled.`):h.isGLTFExtension&&!this.isExtensionUsed(V)||Z.push((async()=>{const Z=await h.factory(this);return Z.name!==V&&F.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Z.name} !== ${V}`),this._parent.onExtensionLoadedObservable.notifyObservers(Z),Z})())})),this._extensions.push(...await Promise.all(Z)),this._extensions.sort(((Z,h)=>(Z.order||Number.MAX_VALUE)-(h.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const V of this._gltf.extensionsRequired){if(!this._extensions.some((Z=>Z.name===V&&Z.enabled))){var h;if(!1===(null===(h=this.parent.extensionOptions[V])||void 0===h?void 0:h.enabled))throw new Error(`Required extension ${V} is disabled`);throw new Error(`Required extension ${V} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new B.c("__root__",this._babylonScene);this._rootBabylonMesh=Z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Va(!1);const h={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case W.i.AUTO:this._babylonScene.useRightHandedSystem||(h.rotation=[0,1,0,0],h.scale=[1,1,-1],c._LoadTransform(h,this._rootBabylonMesh));break;case W.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Z),h}loadSceneAsync(Z,h){const V=this._extensionsLoadSceneAsync(Z,h);if(V)return V;const v=new Array;if(this.logOpen(`${Z} ${h.name||""}`),h.nodes)for(const A of h.nodes){const h=T.Get(`${Z}/nodes/${A}`,this._gltf.nodes,A);v.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(Z=>{Z.parent=this._rootBabylonMesh})))}for(const A of this._postSceneLoadActions)A();return v.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(v).then((()=>{}))}_forEachPrimitive(Z,h){if(Z._primitiveBabylonMeshes)for(const V of Z._primitiveBabylonMeshes)h(V)}_getGeometries(){const Z=[],h=this._gltf.nodes;if(h)for(const V of h)this._forEachPrimitive(V,(h=>{const V=h.Jh;V&&-1===Z.indexOf(V)&&Z.push(V)}));return Z}_getMeshes(){const Z=[];this._rootBabylonMesh instanceof l.e&&Z.push(this._rootBabylonMesh);const h=this._gltf.nodes;if(h)for(const V of h)this._forEachPrimitive(V,(h=>{Z.push(h)}));return Z}_getTransformNodes(){const Z=[],h=this._gltf.nodes;if(h)for(const V of h)V._babylonTransformNode&&"ld"===V._babylonTransformNode.getClassName()&&Z.push(V._babylonTransformNode),V._babylonTransformNodeForSkin&&Z.push(V._babylonTransformNodeForSkin);return Z}_getSkeletons(){const Z=[],h=this._gltf.skins;if(h)for(const V of h)V._data&&Z.push(V._data.babylonSkeleton);return Z}_getAnimationGroups(){const Z=[],h=this._gltf.animations;if(h)for(const V of h)V._babylonAnimationGroup&&Z.push(V._babylonAnimationGroup);return Z}_startAnimations(){switch(this._parent.animationStartMode){case W.e.NONE:break;case W.e.FIRST:{const Z=this._getAnimationGroups();0!==Z.length&&Z[0].start(!0);break}case W.e.ALL:{const Z=this._getAnimationGroups();for(const h of Z)h.start(!0);break}default:return void F.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadNodeAsync(Z,h,V);if(v)return v;if(h._babylonTransformNode)throw new Error(`${Z}: Invalid recursive node hierarchy`);const A=new Array;this.logOpen(`${Z} ${h.name||""}`);const H=v=>{if(c.AddPointerMetadata(v,Z),c._LoadTransform(h,v),void 0!=h.camera){const V=T.Get(`${Z}/camera`,this._gltf.cameras,h.camera);A.push(this.loadCameraAsync(`/cameras/${V.index}`,V,(Z=>{Z.parent=v,this._babylonScene.useRightHandedSystem||(v.tv.x=-1)})))}if(h.children)for(const V of h.children){const h=T.Get(`${Z}/children/${V}`,this._gltf.nodes,V);A.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(Z=>{Z.parent=v})))}V(v)},K=void 0!=h.mesh,d=this._parent.loadSkins&&void 0!=h.skin;if(!K||d){const Z=h.name||`node${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new j.d(Z,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==h.mesh?h._babylonTransformNode=V:h._babylonTransformNodeForSkin=V,H(V)}if(K)if(d){const V=T.Get(`${Z}/mesh`,this._gltf.meshes,h.mesh);A.push(this._loadMeshAsync(`/meshes/${V.index}`,h,V,(V=>{const v=h._babylonTransformNodeForSkin;V.metadata=(0,Q.d)(v.metadata,V.metadata||{});const H=T.Get(`${Z}/skin`,this._gltf.skins,h.skin);A.push(this._loadSkinAsync(`/skins/${H.index}`,h,H,(Z=>{this._forEachPrimitive(h,(h=>{h.skeleton=Z})),this._postSceneLoadActions.push((()=>{if(void 0!=H.skeleton){const Z=T.Get(`/skins/${H.index}/skeleton`,this._gltf.nodes,H.skeleton).parent;h.index===Z.index?V.parent=v.parent:V.parent=Z._babylonTransformNode}else V.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:v,skinnedNode:V})}))})))})))}else{const V=T.Get(`${Z}/mesh`,this._gltf.meshes,h.mesh);A.push(this._loadMeshAsync(`/meshes/${V.index}`,h,V,H))}return this.logClose(),Promise.all(A).then((()=>(this._forEachPrimitive(h,(Z=>{const h=Z;!h.isAnInstance&&h.Jh&&h.Jh.useBoundingInfoFromGeometry?Z.mZ():Z.refreshBoundingInfo(!0,!0)})),h._babylonTransformNode)))}_loadMeshAsync(Z,h,V,v){const A=V.primitives;if(!A||!A.length)throw new Error(`${Z}: Primitives are missing`);void 0==A[0].index&&T.Assign(A);const H=new Array;this.logOpen(`${Z} ${V.name||""}`);const K=h.name||`node${h.index}`;if(1===A.length){const v=V.primitives[0];H.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${v.index}`,K,h,V,v,(Z=>{h._babylonTransformNode=Z,h._primitiveBabylonMeshes=[Z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,h._babylonTransformNode=new j.d(K,this._babylonScene),h._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._primitiveBabylonMeshes=[];for(const v of A)H.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${v.index}`,`${K}_primitive${v.index}`,h,V,v,(Z=>{Z.parent=h._babylonTransformNode,h._primitiveBabylonMeshes.push(Z)})))}return v(h._babylonTransformNode),this.logClose(),Promise.all(H).then((()=>h._babylonTransformNode))}_loadMeshPrimitiveAsync(Z,h,V,v,A,H){const K=this._extensionsLoadMeshPrimitiveAsync(Z,h,V,v,A,H);if(K)return K;this.logOpen(`${Z}`);const d=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==V.skin&&!v.primitives[0].targets;let a,n;if(d&&A._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,a=A._instanceData.babylonSourceMesh.createInstance(h),a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n=A._instanceData.promise;else{const H=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new B.c(h,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.sideOrientation=this._babylonScene.useRightHandedSystem?q.b.CounterClockWiseSideOrientation:q.b.ClockWiseSideOrientation,this._createMorphTargets(Z,V,v,A,K),H.push(this._loadVertexDataAsync(Z,A,K).then((async h=>await this._loadMorphTargetsAsync(Z,A,K,h).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,h.WZ(K),h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const x=c._GetDrawMode(Z,A.mode);if(void 0==A.material){let Z=this._defaultBabylonMaterialData[x];Z||(Z=this._createDefaultMaterial("__GLTFLoader._default",x),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this._defaultBabylonMaterialData[x]=Z),K.material=Z}else if(!this.parent.skipMaterials){const h=T.Get(`${Z}/material`,this._gltf.materials,A.material);H.push(this._loadMaterialAsync(`/materials/${h.index}`,h,K,x,(Z=>{K.material=Z})))}n=Promise.all(H),d&&(A._instanceData={babylonSourceMesh:K,promise:n}),a=K}return c.AddPointerMetadata(a,Z),this._parent.onMeshLoadedObservable.notifyObservers(a),H(a),this.logClose(),n.then((()=>a))}_loadVertexDataAsync(Z,h,V){const v=this._extensionsLoadVertexDataAsync(Z,h,V);if(v)return v;const A=h.attributes;if(!A)throw new Error(`${Z}: Attributes are missing`);const H=new Array,K=new C.e(V.name,this._babylonScene);if(void 0==h.indices)V.isUnIndexed=!0;else{const V=T.Get(`${Z}/indices`,this._gltf.accessors,h.indices);H.push(this._loadIndicesAccessorAsync(`/accessors/${V.index}`,V).then((Z=>{K.setIndices(Z)})))}const d=(h,v,d)=>{if(void 0==A[h])return;V._delayInfo=V._delayInfo||[],-1===V._delayInfo.indexOf(v)&&V._delayInfo.push(v);const a=T.Get(`${Z}/attributes/${h}`,this._gltf.accessors,A[h]);H.push(this._loadVertexAccessorAsync(`/accessors/${a.index}`,a,v).then((Z=>{if(Z.getKind()===P.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!V.skeleton){const Z=t(a);Z&&(K._boundingInfo=Z,K.useBoundingInfoFromGeometry=!0)}K.setVerticesBuffer(Z,a.count)}))),v==P.f.MatricesIndicesExtraKind&&(V.numBoneInfluencers=8),d&&d(a)};return d("POSITION",P.f.PositionKind),d("NORMAL",P.f.NormalKind),d("TANGENT",P.f.TangentKind),d("TEXCOORD_0",P.f.UVKind),d("TEXCOORD_1",P.f.UV2Kind),d("TEXCOORD_2",P.f.UV3Kind),d("TEXCOORD_3",P.f.UV4Kind),d("TEXCOORD_4",P.f.UV5Kind),d("TEXCOORD_5",P.f.UV6Kind),d("JOINTS_0",P.f.MatricesIndicesKind),d("WEIGHTS_0",P.f.MatricesWeightsKind),d("JOINTS_1",P.f.MatricesIndicesExtraKind),d("WEIGHTS_1",P.f.MatricesWeightsExtraKind),d("COLOR_0",P.f.ColorKind,(Z=>{"VEC4"===Z.type&&(V.hasVertexAlpha=!0)})),Promise.all(H).then((()=>K))}_createMorphTargets(Z,h,V,v,A){if(!v.targets||!this._parent.loadMorphTargets)return;if(void 0==h._numMorphTargets)h._numMorphTargets=v.targets.length;else if(v.targets.length!==h._numMorphTargets)throw new Error(`${Z}: Primitives do not have the same number of targets`);const H=V.extras?V.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,A.morphTargetManager=new y(this._babylonScene),A.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.morphTargetManager.areUpdatesFrozen=!0;for(let K=0;K<v.targets.length;K++){const Z=h.weights?h.weights[K]:V.weights?V.weights[K]:0,v=H?H[K]:`morphTarget${K}`;A.morphTargetManager.addTarget(new S.c(v,Z,A.CZ()))}}_loadMorphTargetsAsync(Z,h,V,v){if(!h.targets||!this._parent.loadMorphTargets)return Promise.resolve();const A=new Array,H=V.morphTargetManager;for(let K=0;K<H.numTargets;K++){const V=H.getTarget(K);A.push(this._loadMorphTargetVertexDataAsync(`${Z}/targets/${K}`,v,h.targets[K],V))}return Promise.all(A).then((()=>{H.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Z,h,V,v){const A=new Array,H=(v,H,K)=>{if(void 0==V[v])return;const d=h.getVertexBuffer(H);if(!d)return;const a=T.Get(`${Z}/${v}`,this._gltf.accessors,V[v]);A.push(this._loadFloatAccessorAsync(`/accessors/${a.index}`,a).then((Z=>{K(d,Z)})))};return H("POSITION",P.f.PositionKind,((Z,h)=>{const V=new Float32Array(h.length);Z.forEach(h.length,((Z,v)=>{V[v]=h[v]+Z})),v.setPositions(V)})),H("NORMAL",P.f.NormalKind,((Z,h)=>{const V=new Float32Array(h.length);Z.forEach(V.length,((Z,v)=>{V[v]=h[v]+Z})),v.setNormals(V)})),H("TANGENT",P.f.TangentKind,((Z,h)=>{const V=new Float32Array(h.length/3*4);let A=0;Z.forEach(h.length/3*4,((Z,v)=>{(v+1)%4!==0&&(V[A]=h[A]+Z,A++)})),v.setTangents(V)})),H("TEXCOORD_0",P.f.UVKind,((Z,h)=>{const V=new Float32Array(h.length);Z.forEach(h.length,((Z,v)=>{V[v]=h[v]+Z})),v.setUVs(V)})),H("TEXCOORD_1",P.f.UV2Kind,((Z,h)=>{const V=new Float32Array(h.length);Z.forEach(h.length,((Z,v)=>{V[v]=h[v]+Z})),v.setUV2s(V)})),H("COLOR_0",P.f.ColorKind,((h,V)=>{let A=null;const H=h.getSize();if(3===H){A=new Float32Array(V.length/3*4),h.forEach(V.length,((Z,h)=>{const v=Math.floor(h/3),H=h%3;A[4*v+H]=V[3*v+H]+Z}));for(let Z=0;Z<V.length/3;++Z)A[4*Z+3]=1}else{if(4!==H)throw new Error(`${Z}: Invalid number of components (${H}) for COLOR_0 attribute`);A=new Float32Array(V.length),h.forEach(V.length,((Z,h)=>{A[h]=V[h]+Z}))}v.setColors(A)})),await Promise.all(A).then((()=>{}))}static _LoadTransform(Z,h){if(void 0!=Z.skin)return;let V=A.Ch.Zero(),v=A.Quaternion.Identity(),H=A.Ch.One();if(Z.matrix){A.Matrix.eh(Z.matrix).decompose(H,v,V)}else Z.translation&&(V=A.Ch.eh(Z.translation)),Z.rotation&&(v=A.Quaternion.eh(Z.rotation)),Z.scale&&(H=A.Ch.eh(Z.scale));h.position=V,h.rotationQuaternion=v,h.tv=H}_loadSkinAsync(Z,h,V,v){if(!this._parent.loadSkins)return Promise.resolve();const A=this._extensionsLoadSkinAsync(Z,h,V);if(A)return A;if(V._data)return v(V._data.babylonSkeleton),V._data.promise;const H=`skeleton${V.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new o(V.name||H,H,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Z,V,K);const d=this._loadSkinInverseBindMatricesDataAsync(Z,V).then((Z=>{this._updateBoneMatrices(K,Z)}));return V._data={babylonSkeleton:K,promise:d},v(K),d}_loadBones(Z,h,V){if(void 0==h.skeleton||this._parent.alwaysComputeSkeletonRootNode){const V=this._findSkeletonRootNode(`${Z}/joints`,h.joints);if(V)if(void 0===h.skeleton)h.skeleton=V.index;else{const v=(Z,h)=>{for(;h.parent;h=h.parent)if(h.parent===Z)return!0;return!1},A=T.Get(`${Z}/skeleton`,this._gltf.nodes,h.skeleton);A===V||v(A,V)||(F.b.Warn(`${Z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),h.skeleton=V.index)}else F.b.Warn(`${Z}: Failed to find common root`)}const v={};for(const A of h.joints){const H=T.Get(`${Z}/joints/${A}`,this._gltf.nodes,A);this._loadBone(H,h,V,v)}}_findSkeletonRootNode(Z,h){if(0===h.length)return null;const V={};for(const A of h){const h=[];let v=T.Get(`${Z}/${A}`,this._gltf.nodes,A);for(;-1!==v.index;)h.unshift(v),v=v.parent;V[A]=h}let v=null;for(let A=0;;++A){let Z=V[h[0]];if(A>=Z.length)return v;const H=Z[A];for(let K=1;K<h.length;++K)if(Z=V[h[K]],A>=Z.length||H!==Z[A])return v;v=H}}_loadBone(Z,h,V,v){Z._isJoint=!0;let A=v[Z.index];if(A)return A;let H=null;Z.index!==h.skeleton&&(Z.parent&&-1!==Z.parent.index?H=this._loadBone(Z.parent,h,V,v):void 0!==h.skeleton&&F.b.Warn(`/skins/${h.index}/skeleton: Skeleton node is not a common root`));const K=h.joints.indexOf(Z.index);return A=new n.c(Z.name||`joint${Z.index}`,V,H,this._getNodeMatrix(Z),null,null,K),v[Z.index]=A,this._postSceneLoadActions.push((()=>{A.linkTransformNode(Z._babylonTransformNode)})),A}_loadSkinInverseBindMatricesDataAsync(Z,h){if(void 0==h.inverseBindMatrices)return Promise.resolve(null);const V=T.Get(`${Z}/inverseBindMatrices`,this._gltf.accessors,h.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${V.index}`,V)}_updateBoneMatrices(Z,h){for(const V of Z.bones){const Z=A.Matrix.Identity(),v=V._index;h&&-1!==v&&(A.Matrix.FromArrayToRef(h,16*v,Z),Z.invertToRef(Z));const H=V.getParent();H&&Z.multiplyToRef(H.getAbsoluteInverseBindMatrix(),Z),V.wh(Z,!1,!1),V._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Z){return Z.matrix?A.Matrix.eh(Z.matrix):A.Matrix.Compose(Z.scale?A.Ch.eh(Z.scale):A.Ch.One(),Z.rotation?A.Quaternion.eh(Z.rotation):A.Quaternion.Identity(),Z.translation?A.Ch.eh(Z.translation):A.Ch.Zero())}loadCameraAsync(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadCameraAsync(Z,h,V);if(v)return v;const H=new Array;this.logOpen(`${Z} ${h.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new a.c(h.name||`camera${h.index}`,A.Ch.Zero(),this._babylonScene,!1);switch(K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonCamera=K,K.setTarget(new A.Ch(0,0,-1)),h.type){case"perspective":{const V=h.perspective;if(!V)throw new Error(`${Z}: Camera perspective properties are missing`);K.fov=V.yfov,K.Rh=V.znear,K.maxZ=V.zfar||0;break}case"orthographic":if(!h.orthographic)throw new Error(`${Z}: Camera orthographic properties are missing`);K.mode=d.e.ORTHOGRAPHIC_CAMERA,K.orthoLeft=-h.orthographic.xmag,K.orthoRight=h.orthographic.xmag,K.orthoBottom=-h.orthographic.ymag,K.orthoTop=h.orthographic.ymag,K.Rh=h.orthographic.znear,K.maxZ=h.orthographic.zfar;break;default:throw new Error(`${Z}: Invalid camera type (${h.type})`)}return c.AddPointerMetadata(K,Z),this._parent.onCameraLoadedObservable.notifyObservers(K),V(K),this.logClose(),Promise.all(H).then((()=>K))}_loadAnimationsAsync(){const Z=this._gltf.animations;if(!Z)return Promise.resolve();const h=new Array;for(let V=0;V<Z.length;V++){const v=Z[V];h.push(this.loadAnimationAsync(`/animations/${v.index}`,v).then((Z=>{0===Z.targetedAnimations.length&&Z.dispose()})))}return Promise.all(h).then((()=>{}))}loadAnimationAsync(Z,h){const v=this._extensionsLoadAnimationAsync(Z,h);return v||V.e(78).then(V.bind(V,14946)).then((V=>{let{AnimationGroup:v}=V;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new v(h.name||`animation${h.index}`,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonAnimationGroup=A;const H=new Array;T.Assign(h.channels),T.Assign(h.samplers);for(const K of h.channels)H.push(this._loadAnimationChannelAsync(`${Z}/channels/${K.index}`,Z,h,K,((Z,h)=>{Z.animations=Z.animations||[],Z.animations.push(h),A.addTargetedAnimation(h,Z)})));return Promise.all(H).then((()=>(A.normalize(0),A)))}))}async _loadAnimationChannelAsync(Z,h,v,A,H){const K=this._extensionsLoadAnimationChannelAsync(Z,h,v,A,H);if(K)return await K;if(void 0==A.target.node)return await Promise.resolve();const d=T.Get(`${Z}/target/node`,this._gltf.nodes,A.target.node),a=A.target.path,n="weights"===a;if(n&&!d._numMorphTargets||!n&&!d._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!n&&!d._isJoint)return await Promise.resolve();let x;switch(await Promise.resolve().then(V.bind(V,13417)),a){case"translation":var N;x=null===(N=(0,R.g)("/nodes/{}/translation"))||void 0===N?void 0:N.interpolation;break;case"rotation":var D;x=null===(D=(0,R.g)("/nodes/{}/rotation"))||void 0===D?void 0:D.interpolation;break;case"scale":var k;x=null===(k=(0,R.g)("/nodes/{}/scale"))||void 0===k?void 0:k.interpolation;break;case"weights":var u;x=null===(u=(0,R.g)("/nodes/{}/weights"))||void 0===u?void 0:u.interpolation;break;default:throw new Error(`${Z}/target/path: Invalid value (${A.target.path})`)}if(!x)throw new Error(`${Z}/target/path: Could not find interpolation properties for target path (${A.target.path})`);const F={object:d,info:x};return await this._loadAnimationChannelFromTargetInfoAsync(Z,h,v,A,F,H)}_loadAnimationChannelFromTargetInfoAsync(Z,h,V,v,A,H){const K=this.parent.targetFps,d=1/K,a=T.Get(`${Z}/sampler`,V.samplers,v.sampler);return this._loadAnimationSamplerAsync(`${h}/samplers/${v.sampler}`,a).then((Z=>{let h=0;const a=A.object,n=A.info;for(const A of n){const n=A.getStride(a),x=Z.input,N=Z.output,D=new Array(x.length);let k=0;switch(Z.interpolation){case"STEP":for(let Z=0;Z<x.length;Z++){const h=A.getValue(a,N,k,1);k+=n,D[Z]={frame:x[Z]*K,value:h,interpolation:1}}break;case"CUBICSPLINE":for(let Z=0;Z<x.length;Z++){const h=A.getValue(a,N,k,d);k+=n;const V=A.getValue(a,N,k,1);k+=n;const v=A.getValue(a,N,k,d);k+=n,D[Z]={frame:x[Z]*K,inTangent:h,value:V,outTangent:v}}break;case"LINEAR":for(let Z=0;Z<x.length;Z++){const h=A.getValue(a,N,k,1);k+=n,D[Z]={frame:x[Z]*K,value:h}}}if(k>0){const Z=`${V.name||`animation${V.index}`}_channel${v.index}_${h}`,d=A.buildAnimations(a,Z,K,D);for(const V of d)h++,H(V.babylonAnimatable,V.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Z,h){if(h._data)return h._data;const V=h.interpolation||"LINEAR";switch(V){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Z}/interpolation: Invalid value (${h.interpolation})`)}const v=T.Get(`${Z}/input`,this._gltf.accessors,h.input),A=T.Get(`${Z}/output`,this._gltf.accessors,h.output);return h._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${v.index}`,v),this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)]).then((Z=>{let[h,v]=Z;return{input:h,interpolation:V,output:v}})),h._data}loadBufferAsync(Z,h,V,v){const A=this._extensionsLoadBufferAsync(Z,h,V,v);if(A)return A;if(!h._data)if(h.uri)h._data=this.loadUriAsync(`${Z}/uri`,h,h.uri);else{if(!this._bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);h._data=this._bin.readAsync(0,h.byteLength)}return h._data.then((h=>{try{return new Uint8Array(h.buffer,h.byteOffset+V,v)}catch(A){throw new Error(`${Z}: ${A.message}`)}}))}loadBufferViewAsync(Z,h){const V=this._extensionsLoadBufferViewAsync(Z,h);if(V)return V;if(h._data)return h._data;const v=T.Get(`${Z}/buffer`,this._gltf.buffers,h.buffer);return h._data=this.loadBufferAsync(`/buffers/${v.index}`,v,h.byteOffset||0,h.byteLength),h._data}_loadAccessorAsync(Z,h,V){if(h._data)return h._data;const v=c._GetNumComponents(Z,h.type),A=v*P.f.GetTypeByteLength(h.componentType),H=v*h.count;if(void 0==h.bufferView)h._data=Promise.resolve(new V(H));else{const K=T.Get(`${Z}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((d=>{if(5126!==h.componentType||h.normalized||K.byteStride&&K.byteStride!==A){const Z=new V(H);return P.f.ForEach(d,h.byteOffset||0,K.byteStride||A,v,h.componentType,Z.length,h.normalized||!1,((h,V)=>{Z[V]=h})),Z}return c._GetTypedArray(Z,h.componentType,d,h.byteOffset,H)}))}if(h.sparse){const H=h.sparse;h._data=h._data.then((K=>{const d=K,a=T.Get(`${Z}/sparse/indices/bufferView`,this._gltf.bufferViews,H.indices.bufferView),n=T.Get(`${Z}/sparse/values/bufferView`,this._gltf.bufferViews,H.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${a.index}`,a),this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)]).then((K=>{let[a,n]=K;const x=c._GetTypedArray(`${Z}/sparse/indices`,H.indices.componentType,a,H.indices.byteOffset,H.count),N=v*H.count;let D;if(5126!==h.componentType||h.normalized){const K=c._GetTypedArray(`${Z}/sparse/values`,h.componentType,n,H.values.byteOffset,N);D=new V(N),P.f.ForEach(K,0,A,v,h.componentType,D.length,h.normalized||!1,((Z,h)=>{D[h]=Z}))}else D=c._GetTypedArray(`${Z}/sparse/values`,h.componentType,n,H.values.byteOffset,N);let k=0;for(let Z=0;Z<x.length;Z++){let h=x[Z]*v;for(let Z=0;Z<v;Z++)d[h++]=D[k++]}return d}))}))}return h._data}_loadFloatAccessorAsync(Z,h){return this._loadAccessorAsync(Z,h,Float32Array)}_loadIndicesAccessorAsync(Z,h){if("SCALAR"!==h.type)throw new Error(`${Z}/type: Invalid value ${h.type}`);if(5121!==h.componentType&&5123!==h.componentType&&5125!==h.componentType)throw new Error(`${Z}/componentType: Invalid value ${h.componentType}`);if(h._data)return h._data;if(h.sparse){const V=c._GetTypedArrayConstructor(`${Z}/componentType`,h.componentType);h._data=this._loadAccessorAsync(Z,h,V)}else{const V=T.Get(`${Z}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>c._GetTypedArray(Z,h.componentType,V,h.byteOffset,h.count)))}return h._data}_loadVertexBufferViewAsync(Z){if(Z._babylonBuffer)return Z._babylonBuffer;const h=this._babylonScene.getEngine();return Z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>new P.b(h,Z,!1))),Z._babylonBuffer}_loadVertexAccessorAsync(Z,h,V){var v;if(null!==(v=h._babylonVertexBuffer)&&void 0!==v&&v[V])return h._babylonVertexBuffer[V];h._babylonVertexBuffer||(h._babylonVertexBuffer={});const A=this._babylonScene.getEngine();if(h.sparse||void 0==h.bufferView)h._babylonVertexBuffer[V]=this._loadFloatAccessorAsync(Z,h).then((Z=>new P.f(A,Z,V,!1)));else{const v=T.Get(`${Z}/bufferView`,this._gltf.bufferViews,h.bufferView);h._babylonVertexBuffer[V]=this._loadVertexBufferViewAsync(v).then((H=>{const K=c._GetNumComponents(Z,h.type);return new P.f(A,H,V,!1,void 0,v.byteStride,void 0,h.byteOffset,K,h.componentType,h.normalized,!0,void 0,!0)}))}return h._babylonVertexBuffer[V]}_loadMaterialMetallicRoughnessPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return h&&(h.baseColorFactor?(V.albedoColor=H.Ih.eh(h.baseColorFactor),V.alpha=h.baseColorFactor[3]):V.albedoColor=H.Ih.White(),V.metallic=void 0==h.metallicFactor?1:h.metallicFactor,V.roughness=void 0==h.roughnessFactor?1:h.roughnessFactor,h.baseColorTexture&&v.push(this.loadTextureInfoAsync(`${Z}/baseColorTexture`,h.baseColorTexture,(Z=>{Z.name=`${V.name} (Base Color)`,V.albedoTexture=Z}))),h.metallicRoughnessTexture&&(h.metallicRoughnessTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${Z}/metallicRoughnessTexture`,h.metallicRoughnessTexture,(Z=>{Z.name=`${V.name} (Metallic Roughness)`,V.metallicTexture=Z}))),V.useMetallnessFromMetallicTextureBlue=!0,V.useRoughnessFromMetallicTextureGreen=!0,V.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(v).then((()=>{}))}_loadMaterialAsync(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const H=this._extensionsLoadMaterialAsync(Z,h,V,v,A);if(H)return H;h._data=h._data||{};let K=h._data[v];if(!K){this.logOpen(`${Z} ${h.name||""}`);const V=this.createMaterial(Z,h,v);K={babylonMaterial:V,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Z,h,V)},h._data[v]=K,c.AddPointerMetadata(V,Z),this._parent.onMaterialLoadedObservable.notifyObservers(V),this.logClose()}return V&&(K.babylonMeshes.push(V),V.jh.addOnce((()=>{const Z=K.babylonMeshes.indexOf(V);-1!==Z&&K.babylonMeshes.splice(Z,1)}))),A(K.babylonMaterial),K.promise.then((()=>K.babylonMaterial))}_createDefaultMaterial(Z,h){this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new X.c(Z,this._babylonScene);return V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.fillMode=h,V.enableSpecularAntiAliasing=!0,V.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,V.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,V.transparencyMode=X.c.PBRMATERIAL_OPAQUE,V.metallic=1,V.roughness=1,V}createMaterial(Z,h,V){const v=this._extensionsCreateMaterial(Z,h,V);if(v)return v;const A=h.name||`material${h.index}`;return this._createDefaultMaterial(A,V)}loadMaterialPropertiesAsync(Z,h,V){const v=this._extensionsLoadMaterialPropertiesAsync(Z,h,V);if(v)return v;const A=new Array;return A.push(this.loadMaterialBasePropertiesAsync(Z,h,V)),h.pbrMetallicRoughness&&A.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Z}/pbrMetallicRoughness`,h.pbrMetallicRoughness,V)),this.loadMaterialAlphaProperties(Z,h,V),Promise.all(A).then((()=>{}))}loadMaterialBasePropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return V.emissiveColor=h.emissiveFactor?H.Ih.eh(h.emissiveFactor):new H.Ih(0,0,0),h.doubleSided&&(V.Gh=!1,V.twoSidedLighting=!0),h.normalTexture&&(h.normalTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${Z}/normalTexture`,h.normalTexture,(Z=>{Z.name=`${V.name} (Normal)`,V.bumpTexture=Z}))),V.invertNormalMapX=!this._babylonScene.useRightHandedSystem,V.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=h.normalTexture.scale&&V.bumpTexture&&(V.bumpTexture.level=h.normalTexture.scale),V.forceIrradianceInFragment=!0),h.occlusionTexture&&(h.occlusionTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${Z}/occlusionTexture`,h.occlusionTexture,(Z=>{Z.name=`${V.name} (Occlusion)`,V.ambientTexture=Z}))),V.useAmbientInGrayScale=!0,void 0!=h.occlusionTexture.strength&&(V.ambientTextureStrength=h.occlusionTexture.strength)),h.emissiveTexture&&v.push(this.loadTextureInfoAsync(`${Z}/emissiveTexture`,h.emissiveTexture,(Z=>{Z.name=`${V.name} (Emissive)`,V.emissiveTexture=Z}))),Promise.all(v).then((()=>{}))}loadMaterialAlphaProperties(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);switch(h.alphaMode||"OPAQUE"){case"OPAQUE":V.transparencyMode=X.c.PBRMATERIAL_OPAQUE,V.alpha=1;break;case"MASK":V.transparencyMode=X.c.PBRMATERIAL_ALPHATEST,V.alphaCutOff=void 0==h.alphaCutoff?.5:h.alphaCutoff,V.albedoTexture&&(V.albedoTexture.Uh=!0);break;case"BLEND":V.transparencyMode=X.c.PBRMATERIAL_ALPHABLEND,V.albedoTexture&&(V.albedoTexture.Uh=!0,V.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Z}/alphaMode: Invalid value (${h.alphaMode})`)}}loadTextureInfoAsync(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadTextureInfoAsync(Z,h,V);if(v)return v;if(this.logOpen(`${Z}`),h.texCoord>=6)throw new Error(`${Z}/texCoord: Invalid value (${h.texCoord})`);const A=T.Get(`${Z}/index`,this._gltf.textures,h.index);A._textureInfo=h;const H=this._loadTextureAsync(`/textures/${h.index}`,A,(v=>{v.coordinatesIndex=h.texCoord||0,c.AddPointerMetadata(v,Z),this._parent.onTextureLoadedObservable.notifyObservers(v),V(v)}));return this.logClose(),H}_loadTextureAsync(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadTextureAsync(Z,h,V);if(v)return v;this.logOpen(`${Z} ${h.name||""}`);const A=void 0==h.sampler?c.DefaultSampler:T.Get(`${Z}/sampler`,this._gltf.samplers,h.sampler),H=T.Get(`${Z}/source`,this._gltf.images,h.source),K=this._createTextureAsync(Z,A,H,V,void 0,!h._textureInfo.nonColorData);return this.logClose(),K}_createTextureAsync(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},H=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;const d=this._loadSampler(`/samplers/${h.index}`,h),a=new Array,n=new v;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x={noMipmap:d.noMipMaps,invertY:!1,samplingMode:d.samplingMode,p:()=>{this._disposed||n.resolve()},onError:(h,V)=>{this._disposed||n.reject(new Error(`${Z}: ${V&&V.message?V.message:h||"Failed to load texture"}`))},mimeType:V.mimeType??(0,z.j)(V.uri??""),loaderOptions:H,useSRGBBuffer:!!K&&this._parent.useSRGBBuffers},N=new E.e(null,this._babylonScene,x);return N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.push(n.promise),a.push(this.loadImageAsync(`/images/${V.index}`,V).then((Z=>{const h=V.uri||`${this._fileName}#image${V.index}`,v=`data:${this._uniqueRootUrl}${h}`;N.updateURL(v,Z);const A=N.getInternalTexture();A&&(A.label=V.name)}))),N.wrapU=d.wrapU,N.wrapV=d.wrapV,A(N),this._parent.useGltfTextureNames&&(N.name=V.name||V.uri||`image${V.index}`),Promise.all(a).then((()=>N))}_loadSampler(Z,h){return h._data||(h._data={noMipMaps:9728===h.minFilter||9729===h.minFilter,samplingMode:c._GetTextureSamplingMode(Z,h),wrapU:c._GetTextureWrapMode(`${Z}/wrapS`,h.wrapS),wrapV:c._GetTextureWrapMode(`${Z}/wrapT`,h.wrapT)}),h._data}loadImageAsync(Z,h){if(!h._data){if(this.logOpen(`${Z} ${h.name||""}`),h.uri)h._data=this.loadUriAsync(`${Z}/uri`,h,h.uri);else{const V=T.Get(`${Z}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}this.logClose()}return h._data}loadUriAsync(Z,h,V){const v=this._extensionsLoadUriAsync(Z,h,V);if(v)return v;if(!c._ValidateUri(V))throw new Error(`${Z}: '${V}' is invalid`);if((0,z.k)(V)){const h=new Uint8Array((0,z.d)(V));return this.log(`${Z}: Decoded ${V.substring(0,64)}... (${h.length} bytes)`),Promise.resolve(h)}return this.log(`${Z}: Loading ${V}`),this._parent.preprocessUrlAsync(this._rootUrl+V).then((h=>new Promise(((v,A)=>{this._parent._loadFile(this._babylonScene,h,(h=>{this._disposed||(this.log(`${Z}: Loaded ${V} (${h.byteLength} bytes)`),v(new Uint8Array(h)))}),!0,(h=>{A(new z.o(`${Z}: Failed to load '${V}'${h?": "+h.status+" "+h.statusText:""}`,h))}))}))))}static AddPointerMetadata(Z,h){Z.metadata=Z.metadata||{};const V=Z._internalMetadata=Z._internalMetadata||{},v=V.Lh=V.Lh||{};(v.pointers=v.pointers||[]).push(h)}static _GetTextureWrapMode(Z,h){switch(h=void 0==h?10497:h){case 33071:return E.e.CLAMP_ADDRESSMODE;case 33648:return E.e.MIRROR_ADDRESSMODE;case 10497:return E.e.WRAP_ADDRESSMODE;default:return F.b.Warn(`${Z}: Invalid value (${h})`),E.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Z,h){const V=void 0==h.magFilter?9729:h.magFilter,v=void 0==h.minFilter?9987:h.minFilter;if(9729===V)switch(v){case 9728:return E.e.LINEAR_NEAREST;case 9729:return E.e.LINEAR_LINEAR;case 9984:return E.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return E.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return E.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return E.e.LINEAR_LINEAR_MIPLINEAR;default:return F.b.Warn(`${Z}/minFilter: Invalid value (${v})`),E.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==V&&F.b.Warn(`${Z}/magFilter: Invalid value (${V})`),v){case 9728:return E.e.NEAREST_NEAREST;case 9729:return E.e.NEAREST_LINEAR;case 9984:return E.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return E.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return E.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return E.e.NEAREST_LINEAR_MIPLINEAR;default:return F.b.Warn(`${Z}/minFilter: Invalid value (${v})`),E.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Z,h){try{return(0,w.o)(h)}catch(V){throw new Error(`${Z}: ${V.message}`)}}static _GetTypedArray(Z,h,V,v,A){const H=V.buffer;v=V.byteOffset+(v||0);const K=c._GetTypedArrayConstructor(`${Z}/componentType`,h),d=P.f.GetTypeByteLength(h);return v%d!==0?(F.b.Warn(`${Z}: Copying buffer as byte offset (${v}) is not a multiple of component type byte length (${d})`),new K(H.slice(v,v+A*d),0)):new K(H,v,A)}static _GetNumComponents(Z,h){switch(h){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Z}: Invalid type (${h})`)}static _ValidateUri(Z){return K.Tools.IsBase64(Z)||-1===Z.indexOf("..")}static _GetDrawMode(Z,h){switch(void 0==h&&(h=4),h){case 0:return q.b.PointListDrawMode;case 1:return q.b.LineListDrawMode;case 2:return q.b.LineLoopDrawMode;case 3:return q.b.LineStripDrawMode;case 4:return q.b.TriangleFillMode;case 5:return q.b.TriangleStripDrawMode;case 6:return q.b.TriangleFanDrawMode}throw new Error(`${Z}: Invalid mesh primitive mode (${h})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Z=new Array;if(this._gltf.materials)for(const h of this._gltf.materials)if(h._data)for(const V in h._data){const v=h._data[V];for(const h of v.babylonMeshes){h.sh(!0);const V=v.babylonMaterial;Z.push(V.forceCompilationAsync(h)),Z.push(V.forceCompilationAsync(h,{useInstances:!0})),this._parent.useClipPlane&&(Z.push(V.forceCompilationAsync(h,{clipPlane:!0})),Z.push(V.forceCompilationAsync(h,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Z=new Array,h=this._babylonScene.lights;for(const V of h){const h=V.getShadowGenerator();h&&Z.push(h.forceCompilationAsync())}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Z){for(const h of this._extensions)h.enabled&&Z(h)}_applyExtensions(Z,h,V){for(const v of this._extensions)if(v.enabled){const A=`${v.name}.${h}`,H=Z;H._activeLoaderExtensionFunctions=H._activeLoaderExtensionFunctions||{};const K=H._activeLoaderExtensionFunctions;if(!K[A]){K[A]=!0;try{const Z=V(v);if(Z)return Z}finally{delete K[A]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Z=>Z.onLoading&&Z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Z=>Z.onReady&&Z.onReady()))}_extensionsLoadSceneAsync(Z,h){return this._applyExtensions(h,"loadScene",(V=>V.loadSceneAsync&&V.loadSceneAsync(Z,h)))}_extensionsLoadNodeAsync(Z,h,V){return this._applyExtensions(h,"loadNode",(v=>v.loadNodeAsync&&v.loadNodeAsync(Z,h,V)))}_extensionsLoadCameraAsync(Z,h,V){return this._applyExtensions(h,"loadCamera",(v=>v.loadCameraAsync&&v.loadCameraAsync(Z,h,V)))}_extensionsLoadVertexDataAsync(Z,h,V){return this._applyExtensions(h,"loadVertexData",(v=>v._loadVertexDataAsync&&v._loadVertexDataAsync(Z,h,V)))}_extensionsLoadMeshPrimitiveAsync(Z,h,V,v,A,H){return this._applyExtensions(A,"loadMeshPrimitive",(K=>K._loadMeshPrimitiveAsync&&K._loadMeshPrimitiveAsync(Z,h,V,v,A,H)))}_extensionsLoadMaterialAsync(Z,h,V,v,A){return this._applyExtensions(h,"loadMaterial",(H=>H._loadMaterialAsync&&H._loadMaterialAsync(Z,h,V,v,A)))}_extensionsCreateMaterial(Z,h,V){return this._applyExtensions(h,"createMaterial",(v=>v.createMaterial&&v.createMaterial(Z,h,V)))}_extensionsLoadMaterialPropertiesAsync(Z,h,V){return this._applyExtensions(h,"loadMaterialProperties",(v=>v.loadMaterialPropertiesAsync&&v.loadMaterialPropertiesAsync(Z,h,V)))}_extensionsLoadTextureInfoAsync(Z,h,V){return this._applyExtensions(h,"loadTextureInfo",(v=>v.loadTextureInfoAsync&&v.loadTextureInfoAsync(Z,h,V)))}_extensionsLoadTextureAsync(Z,h,V){return this._applyExtensions(h,"loadTexture",(v=>v._loadTextureAsync&&v._loadTextureAsync(Z,h,V)))}_extensionsLoadAnimationAsync(Z,h){return this._applyExtensions(h,"loadAnimation",(V=>V.loadAnimationAsync&&V.loadAnimationAsync(Z,h)))}_extensionsLoadAnimationChannelAsync(Z,h,V,v,A){return this._applyExtensions(V,"loadAnimationChannel",(H=>H._loadAnimationChannelAsync&&H._loadAnimationChannelAsync(Z,h,V,v,A)))}_extensionsLoadSkinAsync(Z,h,V){return this._applyExtensions(V,"loadSkin",(v=>v._loadSkinAsync&&v._loadSkinAsync(Z,h,V)))}_extensionsLoadUriAsync(Z,h,V){return this._applyExtensions(h,"loadUri",(v=>v._loadUriAsync&&v._loadUriAsync(Z,h,V)))}_extensionsLoadBufferViewAsync(Z,h){return this._applyExtensions(h,"loadBufferView",(V=>V.loadBufferViewAsync&&V.loadBufferViewAsync(Z,h)))}_extensionsLoadBufferAsync(Z,h,V,v){return this._applyExtensions(h,"loadBuffer",(A=>A.loadBufferAsync&&A.loadBufferAsync(Z,h,V,v)))}static LoadExtensionAsync(Z,h,V,v){if(!h.extensions)return null;const A=h.extensions[V];return A?v(`${Z}/extensions/${V}`,A):null}static LoadExtraAsync(Z,h,V,v){if(!h.extras)return null;const A=h.extras[V];return A?v(`${Z}/extras/${V}`,A):null}isExtensionUsed(Z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Z)}logOpen(Z){this._parent._logOpen(Z)}logClose(){this._parent._logClose()}log(Z){this._parent._log(Z)}startPerformanceCounter(Z){this._parent._startPerformanceCounter(Z)}endPerformanceCounter(Z){this._parent._endPerformanceCounter(Z)}}c.DefaultSampler={index:-1},W.d._CreateGLTF2Loader=Z=>new c(Z);var i=V(13417),M=V(11925),O=V(11769),s=V(13421),J=V(13424);class f extends J.c{constructor(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Z),this._texture=Z.getEngine().createRawCubeTexture(h,V,v,A,H,K,d,a)}update(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Z,h,V,v,A)}updateRGBDAsync(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,s.n)(this._texture,Z,h,V,v).then((()=>{}))}clone(){return O.b.Clone((()=>{const Z=this.CZ(),h=this._texture,V=new f(Z,h._bufferViewArray,h.width,h.format,h.type,h.generateMipMaps,h.invertY,h.samplingMode,h._compression);return 13===h.source&&V.updateRGBDAsync(h._bufferViewArrayArray,h._sphericalPolynomial,h._lodGenerationScale,h._lodGenerationOffset),V}),this)}}const p="EXT_lights_image_based";class Y{constructor(Z){this.name=p,this._loader=Z,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Lh.extensions;if(Z&&Z[this.name]){const h=Z[this.name];this._lights=h.lights}}loadSceneAsync(Z,h){return c.LoadExtensionAsync(Z,h,this.name,(async(V,v)=>{this._loader._allMaterialsDirtyRequired=!0;const A=new Array;A.push(this._loader.loadSceneAsync(Z,h)),this._loader.logOpen(`${V}`);const H=T.Get(`${V}/light`,this._lights,v.Dh);return A.push(this._loadLightAsync(`/extensions/${this.name}/lights/${v.Dh}`,H).then((Z=>{this._loader.babylonScene.environmentTexture=Z}))),this._loader.logClose(),await Promise.all(A).then((()=>{}))}))}_loadLightAsync(Z,h){if(!h._loaded){const V=new Array;this._loader.logOpen(`${Z}`);const v=new Array(h.specularImages.length);for(let A=0;A<h.specularImages.length;A++){const H=h.specularImages[A];v[A]=new Array(H.length);for(let h=0;h<H.length;h++){const K=`${Z}/specularImages/${A}/${h}`;this._loader.logOpen(`${K}`);const d=H[h],a=T.Get(K,this._loader.Lh.images,d);V.push(this._loader.loadImageAsync(`/images/${d}`,a).then((Z=>{v[A][h]=Z}))),this._loader.logClose()}}this._loader.logClose(),h._loaded=Promise.all(V).then((async()=>{const V=new f(this._loader.babylonScene,null,h.specularImageSize);if(V.name=h.name||"environment",h._babylonTexture=V,void 0!=h.Fd&&(V.level=h.Fd),h.rotation){let Z=A.Quaternion.eh(h.rotation);this._loader.babylonScene.useRightHandedSystem||(Z=A.Quaternion.Inverse(Z)),A.Matrix.FromQuaternionToRef(Z,V.getReflectionTextureMatrix())}if(!h.irradianceCoefficients)throw new Error(`${Z}: Irradiance coefficients are missing`);const H=M.d.eh(h.irradianceCoefficients);H.scaleInPlace(h.Fd),H.convertIrradianceToLambertianRadiance();const K=M.g.FromHarmonics(H),d=(v.length-1)/Math.log2(h.specularImageSize);return await V.updateRGBDAsync(v,K,d)}))}return h._loaded.then((()=>h._babylonTexture))}}U(p),e(p,!0,(Z=>new Y(Z)));V(12305);const G="EXT_mesh_gpu_instancing";class ZZ{constructor(Z){this.name=G,this._loader=Z,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null}loadNodeAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(Z,v)=>{this._loader._disableInstancedMesh++;const H=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,V);if(this._loader._disableInstancedMesh--,!h._primitiveBabylonMeshes)return await H;const K=new Array;let d=0;const a=h=>{if(void 0==v.attributes[h])return void K.push(Promise.resolve(null));const V=T.Get(`${Z}/attributes/${h}`,this._loader.Lh.accessors,v.attributes[h]);if(K.push(this._loader._loadFloatAccessorAsync(`/accessors/${V.bufferView}`,V)),0===d)d=V.count;else if(d!==V.count)throw new Error(`${Z}/attributes: Instance buffer accessors do not have the same count.`)};return a("TRANSLATION"),a("ROTATION"),a("SCALE"),await H.then((async Z=>{const[V,v,H]=await Promise.all(K),a=new Float32Array(16*d);A.TmpVectors.Ch[0].IV(0,0,0),A.TmpVectors.Quaternion[0].IV(0,0,0,1),A.TmpVectors.Ch[1].IV(1,1,1);for(let h=0;h<d;++h)V&&A.Ch.FromArrayToRef(V,3*h,A.TmpVectors.Ch[0]),v&&A.Quaternion.FromArrayToRef(v,4*h,A.TmpVectors.Quaternion[0]),H&&A.Ch.FromArrayToRef(H,3*h,A.TmpVectors.Ch[1]),A.Matrix.ComposeToRef(A.TmpVectors.Ch[1],A.TmpVectors.Quaternion[0],A.TmpVectors.Ch[0],A.TmpVectors.Matrix[0]),A.TmpVectors.Matrix[0].copyToArray(a,16*h);for(const A of h._primitiveBabylonMeshes)A.UN("matrix",a,16,!0);return Z}))}))}}U(G),e(G,!0,(Z=>new ZZ(Z)));let hZ=0,VZ=null;class vZ{static get Default(){return vZ._Default||(vZ._Default=new vZ),vZ._Default}constructor(){const Z=vZ.Configuration.decoder;this._decoderModulePromise=K.Tools.LoadBabylonScriptAsync(Z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Z,h,V,v,A){await this._decoderModulePromise,0===hZ&&(MeshoptDecoder.useWorkers(1),hZ=1);const H=await MeshoptDecoder.decodeGltfBufferAsync(h,V,Z,v,A);return null!==VZ&&clearTimeout(VZ),VZ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),hZ=0,VZ=null}),1e3),H}}vZ.Configuration={decoder:{url:`${K.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},vZ._Default=null;const AZ="EXT_meshopt_compression";class HZ{constructor(Z){this.name=AZ,this.enabled=Z.isExtensionUsed(AZ),this._loader=Z}dispose(){this._loader=null}loadBufferViewAsync(Z,h){return c.LoadExtensionAsync(Z,h,this.name,(async(V,v)=>{const A=h;if(A._meshOptData)return await A._meshOptData;const H=T.Get(`${Z}/buffer`,this._loader.Lh.buffers,v.buffer);return A._meshOptData=this._loader.loadBufferAsync(`/buffers/${H.index}`,H,v.byteOffset||0,v.byteLength).then((async Z=>await vZ.Default.decodeGltfBufferAsync(Z,v.count,v.byteStride,v.mode,v.filter))),await A._meshOptData}))}}U(AZ),e(AZ,!0,(Z=>new HZ(Z)));const KZ="EXT_texture_webp";class dZ{constructor(Z){this.name=KZ,this._loader=Z,this.enabled=Z.isExtensionUsed(KZ)}dispose(){this._loader=null}_loadTextureAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=void 0==h.sampler?c.DefaultSampler:T.Get(`${Z}/sampler`,this._loader.Lh.samplers,h.sampler),K=T.Get(`${v}/source`,this._loader.Lh.images,A.source);return await this._loader._createTextureAsync(Z,H,K,(Z=>{V(Z)}),void 0,!h._textureInfo.nonColorData)}))}}U(KZ),e(KZ,!0,(Z=>new dZ(Z)));const aZ="EXT_texture_avif";class nZ{constructor(Z){this.name=aZ,this._loader=Z,this.enabled=Z.isExtensionUsed(aZ)}dispose(){this._loader=null}_loadTextureAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=void 0==h.sampler?c.DefaultSampler:T.Get(`${Z}/sampler`,this._loader.Lh.samplers,h.sampler),K=T.Get(`${v}/source`,this._loader.Lh.images,A.source);return await this._loader._createTextureAsync(Z,H,K,(Z=>{V(Z)}),void 0,!h._textureInfo.nonColorData)}))}}U(aZ),e(aZ,!0,(Z=>new nZ(Z)));var xZ=V(13410),NZ=V(12281);const DZ="EXT_lights_ies";class kZ{constructor(Z){this.name=DZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(DZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Lh.extensions;if(Z&&Z[this.name]){const h=Z[this.name];this._lights=h.lights,T.Assign(this._lights)}}loadNodeAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,K)=>{let d,a;this._loader._allMaterialsDirtyRequired=!0;const n=await this._loader.loadNodeAsync(Z,h,(Z=>{a=T.Get(v,this._lights,K.Dh);const h=a.name||Z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,d=new xZ.c(h,A.Ch.Zero(),A.Ch.Backward(),0,1,this._loader.babylonScene),d.angle=Math.PI/2,d.innerAngle=0,d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=d,d.falloffType=NZ.c.FALLOFF_GLTF,d.bd=K.color?H.Ih.eh(K.color):H.Ih.White(),d.Fd=K.multiplier||1,d.range=Number.MAX_VALUE,d.parent=Z,this._loader._babylonLights.push(d),c.AddPointerMetadata(d,v),V(Z)}));let x;if(a.uri)x=await this._loader.loadUriAsync(Z,a,a.uri);else{const h=T.Get(`${Z}/bufferView`,this._loader.Lh.bufferViews,a.bufferView);x=await this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}return d.iesProfileTexture=new E.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,x,!0,void 0,void 0,void 0,void 0,".ies"),n}))}}U(DZ),e(DZ,!0,(Z=>new kZ(Z)));var uZ=V(13430);const FZ="KHR_draco_mesh_compression";class bZ{constructor(Z){this.name=FZ,this.useNormalizedFlagFromAccessor=!0,this._loader=Z,this.enabled=uZ.b.DefaultAvailable&&this._loader.isExtensionUsed(FZ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{if(void 0!=h.mode&&4!==h.mode&&5!==h.mode)throw new Error(`${Z}: Unsupported mode ${h.mode}`);const H={},K={},d=(Z,v)=>{const d=A.attributes[Z];if(void 0!=d&&(V._delayInfo=V._delayInfo||[],-1===V._delayInfo.indexOf(v)&&V._delayInfo.push(v),H[v]=d,this.useNormalizedFlagFromAccessor)){const V=T.TryGet(this._loader.Lh.accessors,h.attributes[Z]);V&&(K[v]=V.normalized||!1)}};d("POSITION",P.f.PositionKind),d("NORMAL",P.f.NormalKind),d("TANGENT",P.f.TangentKind),d("TEXCOORD_0",P.f.UVKind),d("TEXCOORD_1",P.f.UV2Kind),d("TEXCOORD_2",P.f.UV3Kind),d("TEXCOORD_3",P.f.UV4Kind),d("TEXCOORD_4",P.f.UV5Kind),d("TEXCOORD_5",P.f.UV6Kind),d("JOINTS_0",P.f.MatricesIndicesKind),d("WEIGHTS_0",P.f.MatricesWeightsKind),d("COLOR_0",P.f.ColorKind);const a=T.Get(v,this._loader.Lh.bufferViews,A.bufferView);return a._dracoBabylonGeometry||(a._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((async v=>{const A=this.dracoDecoder||uZ.b.Default,d=T.TryGet(this._loader.Lh.accessors,h.attributes.POSITION),a=this._loader.parent.alwaysComputeBoundingBox||V.skeleton||!d?null:t(d);return await A._decodeMeshToGeometryForGltfAsync(V.name,this._loader.babylonScene,v,H,K,a).catch((h=>{throw new Error(`${Z}: ${h.message}`)}))}))),await a._dracoBabylonGeometry}))}}U(FZ),e(FZ,!0,(Z=>new bZ(Z)));var oZ=V(13436),qZ=V(11720),XZ=V(11723),EZ=V(12150),jZ=V(12333),PZ=V(11691);EZ.c.AddNodeConstructor("Light_Type_0",((Z,h)=>()=>new CZ(Z,A.Ch.Zero(),h)));class CZ extends jZ.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(Z){this._shadowAngle=Z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Z){const h=this.needCube();if(this._direction=Z,this.needCube()!==h&&this._shadowGenerators){const Z=this._shadowGenerators.values();for(let h=Z.next();!0!==h.done;h=Z.next()){h.value.recreateShadowMap()}}}constructor(Z,h,V){super(Z,V),this._shadowAngle=Math.PI/2,this.position=h}getClassName(){return"PointLight"}getTypeID(){return NZ.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Z){if(this.direction)return super.getShadowDirection(Z);switch(Z){case 0:return new A.Ch(1,0,0);case 1:return new A.Ch(-1,0,0);case 2:return new A.Ch(0,-1,0);case 3:return new A.Ch(0,1,0);case 4:return new A.Ch(0,0,1);case 5:return new A.Ch(0,0,-1)}return A.Ch.Zero()}_setDefaultShadowProjectionMatrix(Z,h,V){const v=this.CZ().activeCamera;if(!v)return;const H=void 0!==this.shadowMinZ?this.shadowMinZ:v.Rh,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,d=this.CZ().getEngine().useReverseDepthBuffer;A.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,d?K:H,d?H:K,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,d)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,h){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,h):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,h),this}transferToNodeMaterialEffect(Z,h){return this.computeTransformedInformation()?Z.setFloat3(h,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Z.setFloat3(h,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Z,h){Z["POINTLIGHT"+h]=!0}}(0,qZ.b)([(0,XZ.I)()],CZ.prototype,"shadowAngle",null),(0,PZ.i)("BABYLON.PointLight",CZ);const lZ="KHR_lights_punctual";class BZ{constructor(Z){this.name=lZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(lZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Lh.extensions;if(Z&&Z[this.name]){const h=Z[this.name];this._lights=h.lights,T.Assign(this._lights)}}loadNodeAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,K)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Z,h,(Z=>{let h;const d=T.Get(v,this._lights,K.Dh),a=d.name||Z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,d.type){case"directional":{const Z=new oZ.d(a,A.Ch.Backward(),this._loader.babylonScene);Z.position.vd(0),h=Z;break}case"point":h=new CZ(a,A.Ch.Zero(),this._loader.babylonScene);break;case"spot":{const Z=new xZ.c(a,A.Ch.Zero(),A.Ch.Backward(),0,1,this._loader.babylonScene);Z.angle=2*(d.spot&&d.spot.outerConeAngle||Math.PI/4),Z.innerAngle=2*(d.spot&&d.spot.innerConeAngle||0),h=Z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${v}: Invalid light type (${d.type})`)}h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,d._babylonLight=h,h.falloffType=NZ.c.FALLOFF_GLTF,h.bd=d.color?H.Ih.eh(d.color):H.Ih.White(),h.Fd=void 0==d.Fd?1:d.Fd,h.range=void 0==d.range?Number.MAX_VALUE:d.range,h.parent=Z,this._loader._babylonLights.push(h),c.AddPointerMetadata(h,v),V(Z)})))))}}U(lZ),e(lZ,!0,(Z=>new BZ(Z)));const SZ="KHR_materials_pbrSpecularGlossiness";class rZ{constructor(Z){this.name=SZ,this.order=200,this._loader=Z,this.enabled=this._loader.isExtensionUsed(SZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialBasePropertiesAsync(Z,h,V)),H.push(this._loadSpecularGlossinessPropertiesAsync(v,A,V)),this._loader.loadMaterialAlphaProperties(Z,h,V),await Promise.all(H).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return V.metallic=null,V.roughness=null,h.diffuseFactor?(V.albedoColor=H.Ih.eh(h.diffuseFactor),V.alpha=h.diffuseFactor[3]):V.albedoColor=H.Ih.White(),V.reflectivityColor=h.specularFactor?H.Ih.eh(h.specularFactor):H.Ih.White(),V.microSurface=void 0==h.glossinessFactor?1:h.glossinessFactor,h.diffuseTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTexture`,h.diffuseTexture,(Z=>{Z.name=`${V.name} (Diffuse)`,V.albedoTexture=Z}))),h.specularGlossinessTexture&&(v.push(this._loader.loadTextureInfoAsync(`${Z}/specularGlossinessTexture`,h.specularGlossinessTexture,(Z=>{Z.name=`${V.name} (Specular Glossiness)`,V.reflectivityTexture=Z,V.reflectivityTexture.Uh=!0}))),V.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(v).then((()=>{}))}}U(SZ),e(SZ,!0,(Z=>new rZ(Z)));const LZ="KHR_materials_unlit";class yZ{constructor(Z){this.name=LZ,this.order=210,this._loader=Z,this.enabled=this._loader.isExtensionUsed(LZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async()=>await this._loadUnlitPropertiesAsync(Z,h,V)))}_loadUnlitPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;V.unlit=!0;const A=h.pbrMetallicRoughness;return A&&(A.baseColorFactor?(V.albedoColor=H.Ih.eh(A.baseColorFactor),V.alpha=A.baseColorFactor[3]):V.albedoColor=H.Ih.White(),A.baseColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/baseColorTexture`,A.baseColorTexture,(Z=>{Z.name=`${V.name} (Base Color)`,V.albedoTexture=Z})))),h.doubleSided&&(V.Gh=!1,V.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Z,h,V),Promise.all(v).then((()=>{}))}}U(LZ),e(LZ,!0,(Z=>new yZ(Z)));const WZ="KHR_materials_clearcoat";class zZ{constructor(Z){this.name=WZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(WZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadClearCoatPropertiesAsync(v,A,V)),await Promise.all(H)}))}_loadClearCoatPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return V.clearCoat.isEnabled=!0,V.clearCoat.useRoughnessFromMainTexture=!1,V.clearCoat.remapF0OnInterfaceChange=!1,void 0!=h.clearcoatFactor?V.clearCoat.Fd=h.clearcoatFactor:V.clearCoat.Fd=0,h.clearcoatTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatTexture`,h.clearcoatTexture,(Z=>{Z.name=`${V.name} (ClearCoat)`,V.clearCoat.texture=Z}))),void 0!=h.clearcoatRoughnessFactor?V.clearCoat.roughness=h.clearcoatRoughnessFactor:V.clearCoat.roughness=0,h.clearcoatRoughnessTexture&&(h.clearcoatRoughnessTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatRoughnessTexture`,h.clearcoatRoughnessTexture,(Z=>{Z.name=`${V.name} (ClearCoat Roughness)`,V.clearCoat.textureRoughness=Z})))),h.clearcoatNormalTexture&&(h.clearcoatNormalTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatNormalTexture`,h.clearcoatNormalTexture,(Z=>{Z.name=`${V.name} (ClearCoat Normal)`,V.clearCoat.bumpTexture=Z}))),V.invertNormalMapX=!V.CZ().useRightHandedSystem,V.invertNormalMapY=V.CZ().useRightHandedSystem,void 0!=h.clearcoatNormalTexture.scale&&(V.clearCoat.bumpTexture.level=h.clearcoatNormalTexture.scale)),Promise.all(v).then((()=>{}))}}U(WZ),e(WZ,!0,(Z=>new zZ(Z)));const mZ="KHR_materials_iridescence";class gZ{constructor(Z){this.name=mZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(mZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadIridescencePropertiesAsync(v,A,V)),await Promise.all(H).then((()=>{}))}))}_loadIridescencePropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return V.iridescence.isEnabled=!0,V.iridescence.Fd=h.iridescenceFactor??0,V.iridescence.indexOfRefraction=h.iridescenceIor??h.iridescenceIOR??1.3,V.iridescence.minimumThickness=h.iridescenceThicknessMinimum??100,V.iridescence.maximumThickness=h.iridescenceThicknessMaximum??400,h.iridescenceTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceTexture`,h.iridescenceTexture,(Z=>{Z.name=`${V.name} (Iridescence)`,V.iridescence.texture=Z}))),h.iridescenceThicknessTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceThicknessTexture`,h.iridescenceThicknessTexture,(Z=>{Z.name=`${V.name} (Iridescence Thickness)`,V.iridescence.thicknessTexture=Z}))),Promise.all(v).then((()=>{}))}}U(mZ),e(mZ,!0,(Z=>new gZ(Z)));const IZ="KHR_materials_anisotropy";class eZ{constructor(Z){this.name=IZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(IZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadIridescencePropertiesAsync(v,A,V)),await Promise.all(H)}))}async _loadIridescencePropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;V.anisotropy.isEnabled=!0,V.anisotropy.Fd=h.anisotropyStrength??0,V.anisotropy.angle=h.anisotropyRotation??0,h.anisotropyTexture&&(h.anisotropyTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${Z}/anisotropyTexture`,h.anisotropyTexture,(Z=>{Z.name=`${V.name} (Anisotropy Intensity)`,V.anisotropy.texture=Z})))),await Promise.all(v)}}U(IZ),e(IZ,!0,(Z=>new eZ(Z)));const UZ="KHR_materials_emissive_strength";class RZ{constructor(Z){this.name=UZ,this.order=170,this._loader=Z,this.enabled=this._loader.isExtensionUsed(UZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>await this._loader.loadMaterialPropertiesAsync(Z,h,V).then((()=>{this._loadEmissiveProperties(v,A,V)}))))}_loadEmissiveProperties(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);void 0!==h.emissiveStrength&&(V.emissiveIntensity=h.emissiveStrength)}}U(UZ),e(UZ,!0,(Z=>new RZ(Z)));const QZ="KHR_materials_sheen";class wZ{constructor(Z){this.name=QZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(QZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadSheenPropertiesAsync(v,A,V)),await Promise.all(H).then((()=>{}))}))}_loadSheenPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return V.sheen.isEnabled=!0,V.sheen.Fd=1,void 0!=h.sheenColorFactor?V.sheen.color=H.Ih.eh(h.sheenColorFactor):V.sheen.color=H.Ih.Black(),h.sheenColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/sheenColorTexture`,h.sheenColorTexture,(Z=>{Z.name=`${V.name} (Sheen Color)`,V.sheen.texture=Z}))),void 0!==h.sheenRoughnessFactor?V.sheen.roughness=h.sheenRoughnessFactor:V.sheen.roughness=0,h.sheenRoughnessTexture&&(h.sheenRoughnessTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${Z}/sheenRoughnessTexture`,h.sheenRoughnessTexture,(Z=>{Z.name=`${V.name} (Sheen Roughness)`,V.sheen.textureRoughness=Z})))),V.sheen.albedoScaling=!0,V.sheen.useRoughnessFromMainTexture=!1,Promise.all(v).then((()=>{}))}}U(QZ),e(QZ,!0,(Z=>new wZ(Z)));var TZ=V(12218);const tZ="KHR_materials_specular";class cZ{constructor(Z){this.name=tZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(tZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;if(H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadSpecularPropertiesAsync(v,A,V)),A.extensions&&A.extensions.EXT_materials_specular_edge_color&&V instanceof X.c){A.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(V.brdf.dielectricSpecularModel=TZ.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,V.brdf.conductorSpecularModel=TZ.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(H).then((()=>{}))}))}_loadSpecularPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return void 0!==h.specularFactor&&(V.metallicF0Factor=h.specularFactor),void 0!==h.specularColorFactor&&(V.metallicReflectanceColor=H.Ih.eh(h.specularColorFactor)),h.specularTexture&&(h.specularTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${Z}/specularTexture`,h.specularTexture,(Z=>{Z.name=`${V.name} (Specular)`,V.metallicReflectanceTexture=Z,V.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),h.specularColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/specularColorTexture`,h.specularColorTexture,(Z=>{Z.name=`${V.name} (Specular Color)`,V.reflectanceTexture=Z}))),Promise.all(v).then((()=>{}))}}U(tZ),e(tZ,!0,(Z=>new cZ(Z)));const iZ="KHR_materials_ior";class MZ{constructor(Z){this.name=iZ,this.order=180,this._loader=Z,this.enabled=this._loader.isExtensionUsed(iZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadIorPropertiesAsync(v,A,V)),await Promise.all(H).then((()=>{}))}))}_loadIorPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);return void 0!==h.ior?V.indexOfRefraction=h.ior:V.indexOfRefraction=MZ._DEFAULT_IOR,Promise.resolve()}}MZ._DEFAULT_IOR=1.5,U(iZ),e(iZ,!0,(Z=>new MZ(Z)));const OZ="KHR_materials_variants";class sZ{constructor(Z){this.name=OZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(OZ)}dispose(){this._loader=null}static GetAvailableVariants(Z){const h=this._GetExtensionMetadata(Z);return h?Object.keys(h.variants):[]}getAvailableVariants(Z){return sZ.GetAvailableVariants(Z)}static SelectVariant(Z,h){const V=this._GetExtensionMetadata(Z);if(!V)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${OZ} extension`);const v=Z=>{const h=V.variants[Z];if(h)for(const V of h)V.mesh.material=V.material};if(h instanceof Array)for(const A of h)v(A);else v(h);V.lastSelected=h}selectVariant(Z,h){sZ.SelectVariant(Z,h)}static Reset(Z){const h=this._GetExtensionMetadata(Z);if(!h)throw new Error(`Cannot reset on a glTF mesh that does not have the ${OZ} extension`);for(const V of h.original)V.mesh.material=V.material;h.lastSelected=null}reset(Z){sZ.Reset(Z)}static GetLastSelectedVariant(Z){const h=this._GetExtensionMetadata(Z);if(!h)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${OZ} extension`);return h.lastSelected}getLastSelectedVariant(Z){return sZ.GetLastSelectedVariant(Z)}static _GetExtensionMetadata(Z){var h,V;return(null===Z||void 0===Z||null===(h=Z._internalMetadata)||void 0===h||null===(V=h.Lh)||void 0===V?void 0:V[OZ])||null}onLoading(){const Z=this._loader.Lh.extensions;if(Z&&Z[this.name]){const h=Z[this.name];this._variants=h.variants}}onReady(){const Z=this._loader.rootBabylonMesh;if(Z){var h;const V=this._loader.parent.extensionOptions[OZ];null!==V&&void 0!==V&&V.defaultVariant&&sZ.SelectVariant(Z,V.defaultVariant),null===V||void 0===V||null===(h=V.onLoaded)||void 0===h||h.call(V,{get variants(){return sZ.GetAvailableVariants(Z)},get selectedVariant(){const h=sZ.GetLastSelectedVariant(Z);return h?Array.isArray(h)?h[0]:h:sZ.GetAvailableVariants(Z)[0]},set selectedVariant(h){sZ.SelectVariant(Z,h)}})}}_loadMeshPrimitiveAsync(Z,h,V,v,A,H){return c.LoadExtensionAsync(Z,A,this.name,(async(K,d)=>{const a=new Array;return a.push(this._loader._loadMeshPrimitiveAsync(Z,h,V,v,A,(h=>{if(H(h),h instanceof B.c){const V=c._GetDrawMode(Z,A.mode),v=this._loader.rootBabylonMesh,H=v?v._internalMetadata=v._internalMetadata||{}:{},n=H.Lh=H.Lh||{},x=n[OZ]=n[OZ]||{lastSelected:null,original:[],variants:{}};x.original.push({mesh:h,material:h.material});for(let Z=0;Z<d.mappings.length;++Z){const A=d.mappings[Z],H=T.Get(`${K}/mappings/${Z}/material`,this._loader.Lh.materials,A.material);a.push(this._loader._loadMaterialAsync(`#/materials/${A.material}`,H,h,V,(Z=>{for(let V=0;V<A.variants.length;++V){const H=A.variants[V],K=T.Get(`/extensions/${OZ}/variants/${H}`,this._variants,H);x.variants[K.name]=x.variants[K.name]||[],x.variants[K.name].push({mesh:h,material:Z}),h.onClonedObservable.add((Z=>{const V=Z;let A=null,H=V;do{if(H=H.parent,!H)return;A=sZ._GetExtensionMetadata(H)}while(null===A);if(v&&A===sZ._GetExtensionMetadata(v)){H._internalMetadata={};for(const Z in v._internalMetadata)H._internalMetadata[Z]=v._internalMetadata[Z];H._internalMetadata.Lh=[];for(const Z in v._internalMetadata.Lh)H._internalMetadata.Lh[Z]=v._internalMetadata.Lh[Z];H._internalMetadata.Lh[OZ]={lastSelected:null,original:[],variants:{}};for(const Z of A.original)H._internalMetadata.Lh[OZ].original.push({mesh:Z.mesh,material:Z.material});for(const Z in A.variants)if(Object.prototype.hasOwnProperty.call(A.variants,Z)){H._internalMetadata.Lh[OZ].variants[Z]=[];for(const h of A.variants[Z])H._internalMetadata.Lh[OZ].variants[Z].push({mesh:h.mesh,material:h.material})}A=H._internalMetadata.Lh[OZ]}for(const v of A.original)v.mesh===h&&(v.mesh=V);for(const v of A.variants[K.name])v.mesh===h&&(v.mesh=V)}))}})))}}}))),await Promise.all(a).then((Z=>{let[h]=Z;return h}))}))}}U(OZ),e(OZ,!0,(Z=>new sZ(Z)));var JZ=V(11797);class fZ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:TZ.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Z,h){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...fZ._GetDefaultOptions(),...Z},this._scene=h,this._scene._transmissionHelper=this,this.onErrorObservable=new x.b,this._scene.jh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Z){if(!Object.keys(Z).filter((h=>this._options[h]!==Z[h])).length)return;const h={...this._options,...Z},V=this._options;this._options=h,h.renderSize===V.renderSize&&h.renderTargetTextureType===V.renderTargetTextureType&&h.generateMipmaps===V.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=h.samples,this._opaqueRenderTarget.lodGenerationScale=h.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=h.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Z){return!!Z&&!!(Z instanceof X.c&&Z.subSurface.isRefractionEnabled)}_addMesh(Z){this._materialObservers[Z.uniqueId]=Z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),K.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(Z.material)?(Z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Z)&&this._transparentMeshesCache.push(Z)):-1===this._opaqueMeshesCache.indexOf(Z)&&this._opaqueMeshesCache.push(Z)}))}_removeMesh(Z){Z.onMaterialChangedObservable.remove(this._materialObservers[Z.uniqueId]),delete this._materialObservers[Z.uniqueId];let h=this._transparentMeshesCache.indexOf(Z);-1!==h&&this._transparentMeshesCache.splice(h,1),h=this._opaqueMeshesCache.indexOf(Z),-1!==h&&this._opaqueMeshesCache.splice(h,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Z){const h=this._transparentMeshesCache.indexOf(Z),V=this._opaqueMeshesCache.indexOf(Z);this._shouldRenderAsTransmission(Z.material)?(Z.material instanceof X.c&&(Z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==V?(this._opaqueMeshesCache.splice(V,1),this._transparentMeshesCache.push(Z)):-1===h&&this._transparentMeshesCache.push(Z)):-1!==h?(this._transparentMeshesCache.splice(h,1),this._opaqueMeshesCache.push(Z)):-1===V&&this._opaqueMeshesCache.push(Z)}_isRenderTargetValid(){var Z;return null!==(null===(Z=this._opaqueRenderTarget)||void 0===Z?void 0:Z.getInternalTexture())}_setupRenderTargets(){var Z;let h;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new JZ.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Z=this._options.clearColor)||void 0===Z?void 0:Z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Z=>{h=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Z.clearColor.v(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=h}));for(const V of this._transparentMeshesCache)this._shouldRenderAsTransmission(V.material)&&(V.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const pZ="KHR_materials_transmission";class YZ{constructor(Z){this.name=pZ,this.order=175,this._loader=Z,this.enabled=this._loader.isExtensionUsed(pZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadTransparentPropertiesAsync(v,h,V,A)),await Promise.all(H).then((()=>{}))}))}_loadTransparentPropertiesAsync(Z,h,V,v){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const A=V;if(A.subSurface.isRefractionEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.useAlbedoToTintRefraction=!0,void 0===v.transmissionFactor)return A.subSurface.refractionIntensity=0,A.subSurface.isRefractionEnabled=!1,Promise.resolve();{var H;A.subSurface.refractionIntensity=v.transmissionFactor;const Z=A.CZ();if(A.subSurface.refractionIntensity&&!Z._transmissionHelper)new fZ({},A.CZ());else if(A.subSurface.refractionIntensity&&(null===(H=Z._transmissionHelper)||void 0===H||!H._isRenderTargetValid())){var K;null===(K=Z._transmissionHelper)||void 0===K||K._setupRenderTargets()}}return A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,v.transmissionTexture?(v.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/transmissionTexture`,v.transmissionTexture,void 0).then((Z=>{Z.name=`${V.name} (Transmission)`,A.subSurface.refractionIntensityTexture=Z,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}U(pZ),e(pZ,!0,(Z=>new YZ(Z)));const GZ="KHR_materials_diffuse_transmission";class Zh{constructor(Z){this.name=GZ,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(GZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadTranslucentPropertiesAsync(v,h,V,A)),await Promise.all(H).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Z,h,V,v){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const A=V;if(A.subSurface.isTranslucencyEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,A.subSurface.useAlbedoToTintTranslucency=!1,void 0===v.diffuseTransmissionFactor)return A.subSurface.translucencyIntensity=0,A.subSurface.isTranslucencyEnabled=!1,Promise.resolve();A.subSurface.translucencyIntensity=v.diffuseTransmissionFactor;const K=new Array;return A.subSurface.useGltfStyleTextures=!0,v.diffuseTransmissionTexture&&(v.diffuseTransmissionTexture.nonColorData=!0,K.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionTexture`,v.diffuseTransmissionTexture).then((Z=>{Z.name=`${V.name} (Diffuse Transmission)`,A.subSurface.translucencyIntensityTexture=Z})))),void 0!==v.diffuseTransmissionColorFactor?A.subSurface.translucencyColor=H.Ih.eh(v.diffuseTransmissionColorFactor):A.subSurface.translucencyColor=H.Ih.White(),v.diffuseTransmissionColorTexture&&K.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionColorTexture`,v.diffuseTransmissionColorTexture).then((Z=>{Z.name=`${V.name} (Diffuse Transmission Color)`,A.subSurface.translucencyColorTexture=Z}))),Promise.all(K).then((()=>{}))}}U(GZ),e(GZ,!0,(Z=>new Zh(Z)));const hh="KHR_materials_volume";class Vh{constructor(Z){this.name=hh,this.order=173,this._loader=Z,this.enabled=this._loader.isExtensionUsed(hh),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadVolumePropertiesAsync(v,h,V,A)),await Promise.all(H).then((()=>{}))}))}_loadVolumePropertiesAsync(Z,h,V,v){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);if(!V.subSurface.isRefractionEnabled&&!V.subSurface.isTranslucencyEnabled||!v.thicknessFactor)return Promise.resolve();V.subSurface.volumeIndexOfRefraction=V.indexOfRefraction;const A=void 0!==v.attenuationDistance?v.attenuationDistance:Number.MAX_VALUE;return V.subSurface.tintColorAtDistance=A,void 0!==v.attenuationColor&&3==v.attenuationColor.length&&V.subSurface.tintColor.IV(v.attenuationColor[0],v.attenuationColor[1],v.attenuationColor[2]),V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=v.thicknessFactor,V.subSurface.useThicknessAsDepth=!0,v.thicknessTexture?(v.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/thicknessTexture`,v.thicknessTexture).then((Z=>{Z.name=`${V.name} (Thickness)`,V.subSurface.thicknessTexture=Z,V.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}U(hh),e(hh,!0,(Z=>new Vh(Z)));const vh="KHR_materials_dispersion";class Ah{constructor(Z){this.name=vh,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(vh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadDispersionPropertiesAsync(v,h,V,A)),await Promise.all(H).then((()=>{}))}))}_loadDispersionPropertiesAsync(Z,h,V,v){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);return V.subSurface.isRefractionEnabled&&v.dispersion?(V.subSurface.isDispersionEnabled=!0,V.subSurface.dispersion=v.dispersion,Promise.resolve()):Promise.resolve()}}U(vh),e(vh,!0,(Z=>new Ah(Z)));const Hh="EXT_materials_diffuse_roughness";class Kh{constructor(Z){this.name=Hh,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(Z,h,V)),H.push(this._loadDiffuseRoughnessPropertiesAsync(v,A,V)),await Promise.all(H).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Z,h,V){if(!(V instanceof X.c))throw new Error(`${Z}: Material type not supported`);const v=new Array;return V.brdf.baseDiffuseModel=TZ.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=h.diffuseRoughnessFactor?V.baseDiffuseRoughness=h.diffuseRoughnessFactor:V.baseDiffuseRoughness=0,h.diffuseRoughnessTexture&&v.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseRoughnessTexture`,h.diffuseRoughnessTexture,(Z=>{Z.name=`${V.name} (Diffuse Roughness)`,V.baseDiffuseRoughnessTexture=Z}))),Promise.all(v).then((()=>{}))}}U(Hh),e(Hh,!0,(Z=>new Kh(Z)));const dh="KHR_mesh_quantization";class ah{constructor(Z){this.name=dh,this.enabled=Z.isExtensionUsed(dh)}dispose(){}}U(dh),e(dh,!0,(Z=>new ah(Z)));const nh="KHR_texture_basisu";class xh{constructor(Z){this.name=nh,this._loader=Z,this.enabled=Z.isExtensionUsed(nh)}dispose(){this._loader=null}_loadTextureAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>{const H=void 0==h.sampler?c.DefaultSampler:T.Get(`${Z}/sampler`,this._loader.Lh.samplers,h.sampler),K=T.Get(`${v}/source`,this._loader.Lh.images,A.source);return await this._loader._createTextureAsync(Z,H,K,(Z=>{V(Z)}),h._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!h._textureInfo.nonColorData)}))}}U(nh),e(nh,!0,(Z=>new xh(Z)));const Nh="KHR_texture_transform";class Dh{constructor(Z){this.name=Nh,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Nh)}dispose(){this._loader=null}loadTextureInfoAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(v,A)=>await this._loader.loadTextureInfoAsync(Z,h,(Z=>{if(!(Z instanceof E.e))throw new Error(`${v}: Texture type not supported`);A.offset&&(Z.uOffset=A.offset[0],Z.vOffset=A.offset[1]),Z.uRotationCenter=0,Z.vRotationCenter=0,A.rotation&&(Z.wAng=-A.rotation),A.scale&&(Z.uScale=A.scale[0],Z.vScale=A.scale[1]),void 0!=A.texCoord&&(Z.coordinatesIndex=A.texCoord),V(Z)}))))}}U(Nh),e(Nh,!0,(Z=>new Dh(Z)));const kh="KHR_xmp_json_ld";class uh{constructor(Z){this.name=kh,this.order=100,this._loader=Z,this.enabled=this._loader.isExtensionUsed(kh)}dispose(){this._loader=null}onLoading(){var Z,h,V;if(null===this._loader.rootBabylonMesh)return;const v=null===(Z=this._loader.Lh.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld,A=null===(h=this._loader.Lh.asset)||void 0===h||null===(V=h.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld;if(v&&A){const Z=+A.packet;v.packets&&Z<v.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=v.packets[Z])}}}function Fh(Z,h,V,v){return H.Ih.eh(h,V).scale(v)}function bh(Z,h,V,v){return h[V]*v}function oh(Z,h,V,v){return-h[V]*v}function qh(Z,h,V,v){return h[V+1]*v}function Xh(Z,h,V,v){return h[V]*v*2}function Eh(Z){return{scale:[new Ph(D.c.ANIMATIONTYPE_FLOAT,`${Z}.uScale`,bh,(()=>2)),new Ph(D.c.ANIMATIONTYPE_FLOAT,`${Z}.vScale`,qh,(()=>2))],offset:[new Ph(D.c.ANIMATIONTYPE_FLOAT,`${Z}.uOffset`,bh,(()=>2)),new Ph(D.c.ANIMATIONTYPE_FLOAT,`${Z}.vOffset`,qh,(()=>2))],rotation:[new Ph(D.c.ANIMATIONTYPE_FLOAT,`${Z}.wAng`,oh,(()=>1))]}}U(kh),e(kh,!0,(Z=>new uh(Z)));class jh extends i.AnimationPropertyInfo{buildAnimations(Z,h,V,v){return[{babylonAnimatable:Z._babylonCamera,babylonAnimation:this._buildAnimation(h,V,v)}]}}class Ph extends i.AnimationPropertyInfo{buildAnimations(Z,h,V,v){const A=[];for(const H in Z._data)A.push({babylonAnimatable:Z._data[H].babylonMaterial,babylonAnimation:this._buildAnimation(h,V,v)});return A}}class Ch extends i.AnimationPropertyInfo{buildAnimations(Z,h,V,v){return[{babylonAnimatable:Z._babylonLight,babylonAnimation:this._buildAnimation(h,V,v)}]}}(0,R.l)("/cameras/{}/orthographic/xmag",[new jh(D.c.ANIMATIONTYPE_FLOAT,"orthoLeft",oh,(()=>1)),new jh(D.c.ANIMATIONTYPE_FLOAT,"orthoRight",qh,(()=>1))]),(0,R.l)("/cameras/{}/orthographic/ymag",[new jh(D.c.ANIMATIONTYPE_FLOAT,"orthoBottom",oh,(()=>1)),new jh(D.c.ANIMATIONTYPE_FLOAT,"orthoTop",qh,(()=>1))]),(0,R.l)("/cameras/{}/orthographic/zfar",[new jh(D.c.ANIMATIONTYPE_FLOAT,"maxZ",bh,(()=>1))]),(0,R.l)("/cameras/{}/orthographic/znear",[new jh(D.c.ANIMATIONTYPE_FLOAT,"Rh",bh,(()=>1))]),(0,R.l)("/cameras/{}/perspective/yfov",[new jh(D.c.ANIMATIONTYPE_FLOAT,"fov",bh,(()=>1))]),(0,R.l)("/cameras/{}/perspective/zfar",[new jh(D.c.ANIMATIONTYPE_FLOAT,"maxZ",bh,(()=>1))]),(0,R.l)("/cameras/{}/perspective/znear",[new jh(D.c.ANIMATIONTYPE_FLOAT,"Rh",bh,(()=>1))]),(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Ph(D.c.ANIMATIONTYPE_COLOR3,"albedoColor",Fh,(()=>4)),new Ph(D.c.ANIMATIONTYPE_FLOAT,"alpha",(function(Z,h,V,v){return h[V+3]*v}),(()=>4))]),(0,R.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"metallic",bh,(()=>1))]),(0,R.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"roughness",bh,(()=>1))]);const lh=Eh("albedoTexture");(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",lh.scale),(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",lh.offset),(0,R.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",lh.rotation);const Bh=Eh("metallicTexture");(0,R.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Bh.scale),(0,R.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Bh.offset),(0,R.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Bh.rotation),(0,R.l)("/materials/{}/emissiveFactor",[new Ph(D.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Fh,(()=>3))]);const Sh=Eh("bumpTexture");(0,R.l)("/materials/{}/normalTexture/scale",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",bh,(()=>1))]),(0,R.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Sh.scale),(0,R.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Sh.offset),(0,R.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Sh.rotation),(0,R.l)("/materials/{}/occlusionTexture/strength",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",bh,(()=>1))]);const rh=Eh("ambientTexture");(0,R.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rh.scale),(0,R.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rh.offset),(0,R.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rh.rotation);const Lh=Eh("emissiveTexture");(0,R.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Lh.scale),(0,R.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Lh.offset),(0,R.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Lh.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",bh,(()=>1))]);const yh=Eh("anisotropy.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",yh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",yh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",yh.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",bh,(()=>1))]);const Wh=Eh("clearCoat.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Wh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Wh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Wh.rotation);const zh=Eh("clearCoat.bumpTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",zh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",zh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",zh.rotation);const mh=Eh("clearCoat.textureRoughness");(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",mh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",mh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",mh.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",bh,(()=>1))]);const gh=Eh("iridescence.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",gh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",gh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",gh.rotation);const Ih=Eh("iridescence.thicknessTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ih.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ih.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ih.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Ph(D.c.ANIMATIONTYPE_COLOR3,"sheen.color",Fh,(()=>3))]),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",bh,(()=>1))]);const eh=Eh("sheen.texture");(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",eh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",eh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",eh.rotation);const Uh=Eh("sheen.textureRoughness");(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Uh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Uh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Uh.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Ph(D.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Fh,(()=>3))]);const Rh=Eh("metallicReflectanceTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Rh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Rh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Rh.rotation);const Qh=Eh("reflectanceTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Qh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Qh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Qh.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",bh,(()=>1))]);const wh=Eh("subSurface.refractionIntensityTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",wh.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",wh.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",wh.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Ph(D.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Fh,(()=>3))]),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",bh,(()=>1))]),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",bh,(()=>1))]);const Th=Eh("subSurface.thicknessTexture");(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Th.scale),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Th.offset),(0,R.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Th.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Ph(D.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",bh,(()=>1))]);const th=Eh("subSurface.translucencyIntensityTexture");(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",th.scale),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",th.offset),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",th.rotation),(0,R.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Ph(D.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Fh,(()=>3))]);const ch=Eh("subSurface.translucencyColorTexture");(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",ch.scale),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",ch.offset),(0,R.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",ch.rotation),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new Ch(D.c.ANIMATIONTYPE_COLOR3,"diffuse",Fh,(()=>3))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Ch(D.c.ANIMATIONTYPE_FLOAT,"intensity",bh,(()=>1))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new Ch(D.c.ANIMATIONTYPE_FLOAT,"range",bh,(()=>1))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Ch(D.c.ANIMATIONTYPE_FLOAT,"innerAngle",Xh,(()=>1))]),(0,R.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Ch(D.c.ANIMATIONTYPE_FLOAT,"angle",Xh,(()=>1))]),(0,R.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new Ch(D.c.ANIMATIONTYPE_COLOR3,"diffuse",Fh,(()=>3))]),(0,R.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Ch(D.c.ANIMATIONTYPE_FLOAT,"intensity",bh,(()=>1))]);const ih="KHR_animation_pointer";class Mh{constructor(Z){this.name=ih,this._loader=Z,this._pathToObjectConverter=(0,R.i)(this._loader.Lh)}get enabled(){return this._loader.isExtensionUsed(ih)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Z,h,V,v,A){var H;const K=null===(H=v.target.extensions)||void 0===H?void 0:H.KHR_animation_pointer;if(!K||!this._pathToObjectConverter)return null;"pointer"!==v.target.path&&F.b.Warn(`${Z}/target/path: Value (${v.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=v.target.node&&F.b.Warn(`${Z}/target/node: Value (${v.target.node}) must not be present when using the ${this.name} extension`);const d=`${Z}/extensions/${this.name}`,a=K.pointer;if(!a)throw new Error(`${d}: Pointer is missing`);try{const H=this._pathToObjectConverter.convert(a);if(!H.info.interpolation)throw new Error(`${d}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Z,h,V,v,{object:H.object,info:H.info.interpolation},A)}catch(n){return F.b.Warn(`${d}/pointer: Invalid pointer (${a}) skipped`),null}}}U(ih),e(ih,!0,(Z=>new Mh(Z)));class Oh{constructor(Z,h,V){this.frame=Z,this.action=h,this.onlyOnce=V,this.isDone=!1}_clone(){return new Oh(this.frame,this.action,this.onlyOnce)}}var sh=V(11594),Jh=V(11635),fh=V(11633);class ph{get loop(){return this._loop}set loop(Z){Z!==this._loop&&(this._loop=Z,this.updateOptions({loop:Z}))}get currentTime(){var Z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.audioContext&&(this.isPlaying||this.isPaused)){const Z=this.isPaused?0:Jh.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Z){if(Z==this._spatialSound)return;const h=this.isPlaying;this.pause(),Z?(this._spatialSound=Z,this._updateSpatialParameters()):this._disableSpatialSound(),h&&this.play()}constructor(Z,h,V){var v;let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new x.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=A.Ch.Zero(),this._localDirection=new A.Ch(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Z,V=V||u.b.LastCreatedScene)if(this._scene=V,ph._SceneComponentInitialization(V),this._readyToPlayCallback=H,this._customAttenuationFunction=(Z,h,V,v,A)=>h<V?Z*(1-h/V):0,d&&(this.autoplay=d.autoplay||!1,this._loop=d.loop||!1,void 0!==d.volume&&(this._volume=d.volume),this._spatialSound=d.spatialSound??!1,this.maxDistance=d.maxDistance??100,this.useCustomAttenuation=d.useCustomAttenuation??!1,this.rolloffFactor=d.rolloffFactor||1,this.refDistance=d.refDistance||1,this.distanceModel=d.distanceModel||"linear",this._playbackRate=d.playbackRate||1,this._streaming=d.streaming??!1,this._length=d.length,this._offset=d.offset),null!==(v=Jh.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&Jh.d.audioEngine.audioContext){this._soundGain=Jh.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Z=!0;if(h)try{"string"===typeof h?(this._urlType="String",this._url=h):h instanceof ArrayBuffer?this._urlType="ArrayBuffer":h instanceof HTMLMediaElement?this._urlType="MediaElement":h instanceof MediaStream?this._urlType="MediaStream":h instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(h)&&(this._urlType="Array");let V=[],v=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Jh.d.audioEngine.audioContext.createMediaElementSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Jh.d.audioEngine.audioContext.createMediaStreamSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":h.byteLength>0&&(v=!0,this._soundLoaded(h));break;case"AudioBuffer":this._audioBufferLoaded(h);break;case"String":V.push(h);case"Array":0===V.length&&(V=h);for(let Z=0;Z<V.length;Z++){const h=V[Z];if(v=d&&d.skipCodecCheck||-1!==h.indexOf(".mp3",h.length-4)&&Jh.d.audioEngine.isMP3supported||-1!==h.indexOf(".ogg",h.length-4)&&Jh.d.audioEngine.isOGGsupported||-1!==h.indexOf(".wav",h.length-4)||-1!==h.indexOf(".m4a",h.length-4)||-1!==h.indexOf(".mp4",h.length-4)||-1!==h.indexOf("blob:"),v){this._streaming?(this._htmlAudioElement=new Audio(h),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,K.Tools.SetCorsBehavior(h,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(h,(Z=>{this._soundLoaded(Z)}),void 0,!0,!0,(Z=>{Z&&F.b.Error("XHR "+Z.status+" error on: "+h+"."),F.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Z=!1}Z?v||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):F.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(a){F.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Jh.d.audioEngine&&!Jh.d.audioEngine.WarnedWebAudioUnsupported&&(F.b.Error("Web Audio is not supported by your browser."),Jh.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Z;null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Z){var h;null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.audioContext&&(this._audioBuffer=Z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Z){var h;null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.audioContext&&Jh.d.audioEngine.audioContext.decodeAudioData(Z,(Z=>{this._audioBufferLoaded(Z)}),(Z=>{F.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+Z)}))}setAudioBuffer(Z){var h;null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this._audioBuffer=Z,this._isReadyToPlay=!0)}updateOptions(Z){Z&&(this.loop=Z.loop??this.loop,this.maxDistance=Z.maxDistance??this.maxDistance,this.useCustomAttenuation=Z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Z.rolloffFactor??this.rolloffFactor,this.refDistance=Z.refDistance??this.refDistance,this.distanceModel=Z.distanceModel??this.distanceModel,this._playbackRate=Z.playbackRate??this._playbackRate,this._length=Z.length??void 0,this.spatialSound=Z.spatialSound??this._spatialSound,this._setOffset(Z.offset??void 0),this.setVolume(Z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Z;null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&Jh.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Jh.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Z=this._soundPanner)||void 0===Z||Z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Z;null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Z){var h;null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Z),this._isOutputConnected=!0)}setDirectionalCone(Z,h,V){h<Z?F.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Z,this._coneOuterAngle=h,this._coneOuterGain=V,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!=this._coneInnerAngle){var h;if(this._coneOuterAngle<Z)return void F.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z,null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!=this._coneOuterAngle){var h;if(Z<this._coneInnerAngle)return void F.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z,null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Z){var h;Z.equals(this._position)||(this._position.v(Z),null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Z){var h;this._localDirection=Z,null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Z=this._connectedTransformNode.getWorldMatrix(),h=A.Ch.TransformNormal(this._localDirection,Z);h.normalize(),this._soundPanner.orientationX.value=h.x,this._soundPanner.orientationY.value=h.y,this._soundPanner.orientationZ.value=h.z}updateDistanceFromListener(){var Z;if(null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.rh(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Z){this._customAttenuationFunction=Z}play(Z,h,V){var v;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(v=Jh.d.audioEngine)&&void 0!==v&&v.audioContext)try{var A,H;this._clearTimeoutsAndObservers();let v=Z?(null===(A=Jh.d.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+Z:null===(H=Jh.d.audioEngine)||void 0===H?void 0:H.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Jh.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Z=()=>{var V;if(null!==(V=Jh.d.audioEngine)&&void 0!==V&&V.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=h??0;const V=this._htmlAudioElement.play();void 0!==V&&V.catch((()=>{var h,V;(null===(h=Jh.d.audioEngine)||void 0===h||h.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(V=Jh.d.audioEngine)||void 0===V?void 0:V.onAudioUnlockedObservable.addOnce((()=>{Z()})))}))}else{var v;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(v=Jh.d.audioEngine)||void 0===v?void 0:v.onAudioUnlockedObservable.addOnce((()=>{Z()}))}};Z()}}else{var K;const A=()=>{var A;if(null!==(A=Jh.d.audioEngine)&&void 0!==A&&A.audioContext){var H;if(V=V||this._length,void 0!==h&&this._setOffset(h),this._soundSource){const Z=this._soundSource;Z.onended=()=>{Z.disconnect()}}if(this._soundSource=null===(H=Jh.d.audioEngine)||void 0===H?void 0:H.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var K;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==h&&(this._soundSource.loopStart=h),void 0!==V&&(this._soundSource.loopEnd=(0|h)+V),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},v=Z?(null===(K=Jh.d.audioEngine)||void 0===K?void 0:K.audioContext.currentTime)+Z:Jh.d.audioEngine.audioContext.currentTime;const A=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(v,A,this.loop?void 0:V)}}};"suspended"===(null===(K=Jh.d.audioEngine)||void 0===K?void 0:K.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Z;"suspended"===(null===(Z=Jh.d.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?(Jh.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Jh.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{A()})))):A()}),500):A()}this._startTime=v,this.isPlaying=!0,this.isPaused=!1}catch(d){F.b.Error("Error while trying to play audio: "+this.name+", "+d.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Z){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var V;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(V=this._streamingSource)||void 0===V||V.disconnect();this.isPlaying=!1}else if(null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource){const h=Z?Jh.d.audioEngine.audioContext.currentTime+Z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(h)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Jh.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Z,h){var V;null!==(V=Jh.d.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._soundGain&&(h&&Jh.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Jh.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Jh.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Z,Jh.d.audioEngine.audioContext.currentTime+h)):this._soundGain.gain.value=Z),this._volume=Z}setPlaybackRate(Z){this._playbackRate=Z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Z=>this._onRegisterAfterWorldMatrixUpdate(Z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Z){var h;if(Z.getBoundingInfo){const h=Z.getBoundingInfo();this.setPosition(h.boundingSphere.centerWorld)}else this.setPosition(Z.absolutePosition);null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Z=()=>{(0,fh.h)((()=>this._isReadyToPlay),(()=>{V._audioBuffer=this.getAudioBuffer(),V._isReadyToPlay=!0,V.autoplay&&V.play(0,this._offset,this._length)}),void 0,300)},h={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},V=new ph(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,h);return this.useCustomAttenuation&&V.setAttenuationFunction(this._customAttenuationFunction),V.setPosition(this._position),V.setPlaybackRate(this._playbackRate),Z(),V}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Z.connectedMeshId=this._connectedTransformNode.id),Z.position=this._position.mh(),Z.refDistance=this.refDistance,Z.distanceModel=this.distanceModel,Z.isDirectional=this._isDirectional,Z.localDirectionToMesh=this._localDirection.mh(),Z.coneInnerAngle=this._coneInnerAngle,Z.coneOuterAngle=this._coneOuterAngle,Z.coneOuterGain=this._coneOuterGain),Z}static Parse(Z,h,V,v){const H=Z.name;let K;K=Z.url?V+Z.url:V+H;const d={autoplay:Z.autoplay,loop:Z.loop,volume:Z.volume,spatialSound:Z.spatialSound,maxDistance:Z.maxDistance,rolloffFactor:Z.rolloffFactor,refDistance:Z.refDistance,distanceModel:Z.distanceModel,playbackRate:Z.playbackRate};let a;if(v){const Z=()=>{(0,fh.h)((()=>v._isReadyToPlay),(()=>{a._audioBuffer=v.getAudioBuffer(),a._isReadyToPlay=!0,a.autoplay&&a.play(0,a._offset,a._length)}),void 0,300)};a=new ph(H,new ArrayBuffer(0),h,null,d),Z()}else a=new ph(H,K,h,(()=>{h.removePendingData(a)}),d),h.addPendingData(a);if(Z.position){const h=A.Ch.eh(Z.position);a.setPosition(h)}if(Z.isDirectional&&(a.setDirectionalCone(Z.coneInnerAngle||360,Z.coneOuterAngle||360,Z.coneOuterGain||0),Z.localDirectionToMesh)){const h=A.Ch.eh(Z.localDirectionToMesh);a.setLocalDirectionToMesh(h)}if(Z.connectedMeshId){const V=h.getMeshById(Z.connectedMeshId);V&&a.attachToMesh(V)}return Z.metadata&&(a.metadata=Z.metadata),a}_setOffset(Z){this._offset!==Z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Z)}_clearTimeoutsAndObservers(){var Z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Z=Jh.d.audioEngine)||void 0===Z||Z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}ph._SceneComponentInitialization=Z=>{throw(0,sh.d)("AudioSceneComponent")},(0,PZ.i)("BABYLON.Sound",ph);class Yh{constructor(Z,h,V){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],h.length!==V.length)throw new Error("Sounds length does not equal weights length");this.loop=Z,this._weights=V;let v=0;for(const H of V)v+=H;const A=v>0?1/v:0;for(let H=0;H<this._weights.length;H++)this._weights[H]*=A;this._sounds=h;for(const H of this._sounds)H.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!==this._coneInnerAngle){if(this._coneOuterAngle<Z)return void F.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z;for(const h of this._sounds)h.directionalConeInnerAngle=Z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!==this._coneOuterAngle){if(Z<this._coneInnerAngle)return void F.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z;for(const h of this._sounds)h.directionalConeOuterAngle=Z}}get volume(){return this._volume}set volume(Z){if(Z!==this._volume)for(const h of this._sounds)h.setVolume(Z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Z){if(!this.isPaused){this.stop();const Z=Math.random();let h=0;for(let V=0;V<this._weights.length;V++)if(h+=this._weights[V],Z<=h){this._currentIndex=V;break}}const h=this._sounds[this._currentIndex??0];h.isReady()?h.play(0,this.isPaused?void 0:Z):h.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Gh{constructor(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Z=Z||u.b.LastCreatedScene)&&(this._scene=Z,this.soundCollection=[],this._options=h,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Z;null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&Jh.d.audioEngine.audioContext&&(this._outputAudioNode=Jh.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Jh.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Jh.d.audioEngine&&Jh.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Z){var h;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&Z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Z.soundTrackId&&(-1===Z.soundTrackId?this._scene.mainSoundTrack.removeSound(Z):this._scene.soundTracks&&this._scene.soundTracks[Z.soundTrackId].removeSound(Z)),this.soundCollection.push(Z),Z.soundTrackId=this.id}removeSound(Z){const h=this.soundCollection.indexOf(Z);-1!==h&&this.soundCollection.splice(h,1)}setVolume(Z){var h;null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Z)}switchPanningModelToHRTF(){var Z;if(null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Z;if(null!==(Z=Jh.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToEqualPower()}connectToAnalyser(Z){var h;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Z,null!==(h=Jh.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Jh.d.audioEngine.masterGain))}}var ZV=V(12014),hV=V(11983),VV=V(11573);Jh.d.AudioEngineFactory=(Z,h,V)=>new vV(Z,h,V);class vV{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new x.b,this.onAudioLockedObservable=new x.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,VV.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const v=document.createElement("audio");this._hostElement=Z,this._audioContext=h,this._audioDestination=V;try{v&&v.canPlayType&&(v.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||v.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(A){}try{v&&v.canPlayType&&v.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(A){}}lock(){this._triggerSuspendedState()}unlock(){var Z,h;if("running"===(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(h=this._audioContext)||void 0===h||h.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{F.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Z;null===(Z=this._audioContext)||void 0===Z||Z.addEventListener("statechange",(()=>{var Z;this.unlocked&&"running"!==(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Z;return null!==(Z=this._audioContext)&&void 0!==Z&&Z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Z){this.canUseWebAudio=!1,F.b.Error("Web Audio: "+Z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",h=document.createElement("style");h.appendChild(document.createTextNode(Z)),document.getElementsByTagName("head")[0].appendChild(h),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Z=this._audioContext)||void 0===Z||Z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Z)}connectToAnalyser(Z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var AV=V(11588);(0,V(13123).h)(ZV.d.NAME_AUDIO,((Z,h,V,v)=>{let A,H=[];if(V.pD=V.pD||[],void 0!==Z.pD&&null!==Z.pD)for(let d=0,a=Z.pD.length;d<a;d++){var K;const a=Z.pD[d];null!==(K=Jh.d.audioEngine)&&void 0!==K&&K.canUseWebAudio?(a.url||(a.url=a.name),H[a.url]?V.pD.push(ph.Parse(a,h,v,H[a.url])):(A=ph.Parse(a,h,v),H[a.url]=A,V.pD.push(A))):V.pD.push(new ph(a.name,null,h))}H=[]})),Object.defineProperty(hV.e.prototype,"mainSoundTrack",{get:function(){let Z=this._getComponent(ZV.d.NAME_AUDIO);return Z||(Z=new HV(this),this.Fh(Z)),this._mainSoundTrack||(this._mainSoundTrack=new Gh(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),hV.e.prototype.getSoundByName=function(Z){let h;for(h=0;h<this.mainSoundTrack.soundCollection.length;h++)if(this.mainSoundTrack.soundCollection[h].name===Z)return this.mainSoundTrack.soundCollection[h];if(this.soundTracks)for(let V=0;V<this.soundTracks.length;V++)for(h=0;h<this.soundTracks[V].soundCollection.length;h++)if(this.soundTracks[V].soundCollection[h].name===Z)return this.soundTracks[V].soundCollection[h];return null},Object.defineProperty(hV.e.prototype,"audioEnabled",{get:function(){let Z=this._getComponent(ZV.d.NAME_AUDIO);return Z||(Z=new HV(this),this.Fh(Z)),Z.audioEnabled},set:function(Z){let h=this._getComponent(ZV.d.NAME_AUDIO);h||(h=new HV(this),this.Fh(h)),Z?h.enableAudio():h.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(hV.e.prototype,"headphone",{get:function(){let Z=this._getComponent(ZV.d.NAME_AUDIO);return Z||(Z=new HV(this),this.Fh(Z)),Z.headphone},set:function(Z){let h=this._getComponent(ZV.d.NAME_AUDIO);h||(h=new HV(this),this.Fh(h)),Z?h.switchAudioModeForHeadphones():h.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(hV.e.prototype,"audioListenerPositionProvider",{get:function(){let Z=this._getComponent(ZV.d.NAME_AUDIO);return Z||(Z=new HV(this),this.Fh(Z)),Z.audioListenerPositionProvider},set:function(Z){let h=this._getComponent(ZV.d.NAME_AUDIO);if(h||(h=new HV(this),this.Fh(h)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");h.audioListenerPositionProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(hV.e.prototype,"audioListenerRotationProvider",{get:function(){let Z=this._getComponent(ZV.d.NAME_AUDIO);return Z||(Z=new HV(this),this.Fh(Z)),Z.audioListenerRotationProvider},set:function(Z){let h=this._getComponent(ZV.d.NAME_AUDIO);if(h||(h=new HV(this),this.Fh(h)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");h.audioListenerRotationProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(hV.e.prototype,"audioPositioningRefreshRate",{get:function(){let Z=this._getComponent(ZV.d.NAME_AUDIO);return Z||(Z=new HV(this),this.Fh(Z)),Z.audioPositioningRefreshRate},set:function(Z){let h=this._getComponent(ZV.d.NAME_AUDIO);h||(h=new HV(this),this.Fh(h)),h.audioPositioningRefreshRate=Z},enumerable:!0,configurable:!0});class HV{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Z){this.name=ZV.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new A.Ch,this._cachedCameraPosition=new A.Ch,this._lastCheck=0,this._invertMatrixTemp=new A.Matrix,this._cameraDirectionTemp=new A.Ch,(Z=Z||u.b.LastCreatedScene)&&(this.Wh=Z,Z.soundTracks=[],Z.pD=[])}register(){this.Wh._afterRenderStage.registerStep(ZV.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Z){if(Z.pD=[],this.Wh.soundTracks)for(let h=0;h<this.Wh.soundTracks.length;h++){const V=this.Wh.soundTracks[h];for(let h=0;h<V.soundCollection.length;h++)Z.pD.push(V.soundCollection[h].serialize())}}addFromContainer(Z){if(Z.pD)for(const h of Z.pD)h.play(),h.autoplay=!0,this.Wh.mainSoundTrack.addSound(h)}removeFromContainer(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Z.pD)for(const V of Z.pD)V.stop(),V.autoplay=!1,this.Wh.mainSoundTrack.removeSound(V),h&&V.dispose()}dispose(){const Z=this.Wh;if(Z._mainSoundTrack&&Z.mainSoundTrack.dispose(),Z.soundTracks)for(let h=0;h<Z.soundTracks.length;h++)Z.soundTracks[h].dispose()}disableAudio(){const Z=this.Wh;let h;for(this._audioEnabled=!1,Jh.d.audioEngine&&Jh.d.audioEngine.audioContext&&Jh.d.audioEngine.audioContext.suspend(),h=0;h<Z.mainSoundTrack.soundCollection.length;h++)Z.mainSoundTrack.soundCollection[h].pause();if(Z.soundTracks)for(h=0;h<Z.soundTracks.length;h++)for(let V=0;V<Z.soundTracks[h].soundCollection.length;V++)Z.soundTracks[h].soundCollection[V].pause()}enableAudio(){const Z=this.Wh;let h;for(this._audioEnabled=!0,Jh.d.audioEngine&&Jh.d.audioEngine.audioContext&&Jh.d.audioEngine.audioContext.resume(),h=0;h<Z.mainSoundTrack.soundCollection.length;h++)Z.mainSoundTrack.soundCollection[h].isPaused&&Z.mainSoundTrack.soundCollection[h].play();if(Z.soundTracks)for(h=0;h<Z.soundTracks.length;h++)for(let V=0;V<Z.soundTracks[h].soundCollection.length;V++)Z.soundTracks[h].soundCollection[V].isPaused&&Z.soundTracks[h].soundCollection[V].play()}switchAudioModeForHeadphones(){const Z=this.Wh;if(this._headphone=!0,Z.mainSoundTrack.switchPanningModelToHRTF(),Z.soundTracks)for(let h=0;h<Z.soundTracks.length;h++)Z.soundTracks[h].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Z=this.Wh;if(this._headphone=!1,Z.mainSoundTrack.switchPanningModelToEqualPower(),Z.soundTracks)for(let h=0;h<Z.soundTracks.length;h++)Z.soundTracks[h].switchPanningModelToEqualPower()}_afterRender(){const Z=AV.e.Now;if(this._lastCheck&&Z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Z;const h=this.Wh;if(!this._audioEnabled||!h._mainSoundTrack||!h.soundTracks||0===h._mainSoundTrack.soundCollection.length&&1===h.soundTracks.length)return;const V=Jh.d.audioEngine;if(V&&V.audioContext){let Z,v=h.activeCamera;if(h.activeCameras&&h.activeCameras.length>0&&(v=h.activeCameras[0]),this.audioListenerPositionProvider){const Z=this.audioListenerPositionProvider();V.audioContext.listener.setPosition(Z.x||0,Z.y||0,Z.z||0)}else v?this._cachedCameraPosition.equals(v.globalPosition)||(this._cachedCameraPosition.v(v.globalPosition),V.audioContext.listener.setPosition(v.globalPosition.x,v.globalPosition.y,v.globalPosition.z)):V.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Z=this.audioListenerRotationProvider();V.audioContext.listener.setOrientation(Z.x||0,Z.y||0,Z.z||0,0,1,0)}else v?(v.rigCameras&&v.rigCameras.length>0&&(v=v.rigCameras[0]),v.getViewMatrix().invertToRef(this._invertMatrixTemp),A.Ch.TransformNormalToRef(HV._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.v(this._cameraDirectionTemp),V.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):V.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Z=0;Z<h.mainSoundTrack.soundCollection.length;Z++){const V=h.mainSoundTrack.soundCollection[Z];V.useCustomAttenuation&&V.updateDistanceFromListener()}if(h.soundTracks)for(Z=0;Z<h.soundTracks.length;Z++)for(let V=0;V<h.soundTracks[Z].soundCollection.length;V++){const v=h.soundTracks[Z].soundCollection[V];v.useCustomAttenuation&&v.updateDistanceFromListener()}}}}HV._CameraDirection=new A.Ch(0,0,-1),ph._SceneComponentInitialization=Z=>{let h=Z._getComponent(ZV.d.NAME_AUDIO);h||(h=new HV(Z),Z.Fh(h))};const KV="MSFT_audio_emitter";class dV{constructor(Z){this.name=KV,this._loader=Z,this.enabled=this._loader.isExtensionUsed(KV)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Z=this._loader.Lh.extensions;if(Z&&Z[this.name]){const h=Z[this.name];this._clips=h.clips,this._emitters=h.emitters,T.Assign(this._clips),T.Assign(this._emitters)}}loadSceneAsync(Z,h){return c.LoadExtensionAsync(Z,h,this.name,(async(V,v)=>{const A=new Array;A.push(this._loader.loadSceneAsync(Z,h));for(const Z of v.emitters){const h=T.Get(`${V}/emitters`,this._emitters,Z);if(void 0!=h.refDistance||void 0!=h.maxDistance||void 0!=h.rolloffFactor||void 0!=h.distanceModel||void 0!=h.innerAngle||void 0!=h.outerAngle)throw new Error(`${V}: Direction or Distance properties are not allowed on emitters attached to a scene`);A.push(this._loadEmitterAsync(`${V}/emitters/${h.index}`,h))}await Promise.all(A)}))}loadNodeAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(Z,v)=>{const H=new Array,d=await this._loader.loadNodeAsync(Z,h,(h=>{for(const V of v.emitters){const v=T.Get(`${Z}/emitters`,this._emitters,V);H.push(this._loadEmitterAsync(`${Z}/emitters/${v.index}`,v).then((()=>{for(const Z of v._babylonSounds)Z.attachToMesh(h),void 0==v.innerAngle&&void 0==v.outerAngle||(Z.setLocalDirectionToMesh(A.Ch.Forward()),Z.setDirectionalCone(2*K.Tools.ToDegrees(void 0==v.innerAngle?Math.PI:v.innerAngle),2*K.Tools.ToDegrees(void 0==v.outerAngle?Math.PI:v.outerAngle),0))})))}V(h)}));return await Promise.all(H),d}))}loadAnimationAsync(Z,h){return c.LoadExtensionAsync(Z,h,this.name,(async(V,v)=>{const A=await this._loader.loadAnimationAsync(Z,h),H=new Array;T.Assign(v.events);for(const K of v.events)H.push(this._loadAnimationEventAsync(`${V}/events/${K.index}`,Z,h,K,A));return await Promise.all(H),A}))}_loadClipAsync(Z,h){if(h._objectURL)return h._objectURL;let V;if(h.uri)V=this._loader.loadUriAsync(Z,h,h.uri);else{const v=T.Get(`${Z}/bufferView`,this._loader.Lh.bufferViews,h.bufferView);V=this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}return h._objectURL=V.then((Z=>URL.createObjectURL(new Blob([Z],{type:h.mimeType})))),h._objectURL}_loadEmitterAsync(Z,h){if(h._babylonSounds=h._babylonSounds||[],!h._babylonData){const Z=new Array,V=h.name||`emitter${h.index}`,v={loop:!1,autoplay:!1,volume:void 0==h.volume?1:h.volume};for(let H=0;H<h.clips.length;H++){const A=`/extensions/${this.name}/clips`,K=T.Get(A,this._clips,h.clips[H].clip);Z.push(this._loadClipAsync(`${A}/${h.clips[H].clip}`,K).then((Z=>{const A=h._babylonSounds[H]=new ph(V,Z,this._loader.babylonScene,null,v);A.refDistance=h.refDistance||1,A.maxDistance=h.maxDistance||256,A.rolloffFactor=h.rolloffFactor||1,A.distanceModel=h.distanceModel||"exponential"})))}const A=Promise.all(Z).then((()=>{const Z=h.clips.map((Z=>Z.weight||1)),V=new Yh(h.loop||!1,h._babylonSounds,Z);h.innerAngle&&(V.directionalConeInnerAngle=2*K.Tools.ToDegrees(h.innerAngle)),h.outerAngle&&(V.directionalConeOuterAngle=2*K.Tools.ToDegrees(h.outerAngle)),h.volume&&(V.volume=h.volume),h._babylonData.sound=V}));h._babylonData={loaded:A}}return h._babylonData.loaded}_getEventAction(Z,h,V,v,A){switch(V){case"play":return Z=>{const V=(A||0)+(Z-v);h.play(V)};case"stop":return()=>{h.stop()};case"pause":return()=>{h.pause()};default:throw new Error(`${Z}: Unsupported action ${V}`)}}_loadAnimationEventAsync(Z,h,V,v,A){if(0==A.targetedAnimations.length)return Promise.resolve();const H=A.targetedAnimations[0],K=v.Ah,d=T.Get(`/extensions/${this.name}/emitters`,this._emitters,K);return this._loadEmitterAsync(Z,d).then((()=>{const h=d._babylonData.sound;if(h){const V=new Oh(v.time,this._getEventAction(Z,h,v.action,v.time,v.startOffset));H.animation.addEvent(V),A.onAnimationGroupEndObservable.add((()=>{h.stop()})),A.onAnimationGroupPauseObservable.add((()=>{h.pause()}))}}))}}U(KV),e(KV,!0,(Z=>new dV(Z)));const aV="MSFT_lod";class nV{constructor(Z){var h;this.name=aV,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new x.b,this.onMaterialLODsLoadedObservable=new x.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Z,this.maxLODsToLoad=(null===(h=this._loader.parent.extensionOptions[aV])||void 0===h?void 0:h.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(aV)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Z=0;Z<this._nodePromiseLODs.length;Z++){const h=Promise.all(this._nodePromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Node LOD ${Z}`),this._loader.log(`Loaded node LOD ${Z}`)),this.onNodeLODsLoadedObservable.notifyObservers(Z),Z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Z+1}`),this._loadBufferLOD(this._nodeBufferLODs,Z+1),this._nodeSignalLODs[Z]&&this._nodeSignalLODs[Z].resolve())}));this._loader._completePromises.push(h)}for(let Z=0;Z<this._materialPromiseLODs.length;Z++){const h=Promise.all(this._materialPromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Material LOD ${Z}`),this._loader.log(`Loaded material LOD ${Z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Z),Z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Z+1}`),this._loadBufferLOD(this._materialBufferLODs,Z+1),this._materialSignalLODs[Z]&&this._materialSignalLODs[Z].resolve())}));this._loader._completePromises.push(h)}}loadSceneAsync(Z,h){const V=this._loader.loadSceneAsync(Z,h);return this._loadBufferLOD(this._bufferLODs,0),V}loadNodeAsync(Z,h,V){return c.LoadExtensionAsync(Z,h,this.name,(async(Z,A)=>{let H;const K=this._getLODs(Z,h,this._loader.Lh.nodes,A.ids);this._loader.logOpen(`${Z}`);for(let h=0;h<K.length;h++){const Z=K[h];0!==h&&(this._nodeIndexLOD=h,this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new v);const A=Z=>{V(Z),Z.Va(!1)},d=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,A).then((Z=>{if(0!==h){const Z=K[h-1];Z._babylonTransformNode&&(this._disposeTransformNode(Z._babylonTransformNode),delete Z._babylonTransformNode)}return Z.Va(!0),Z}));this._nodePromiseLODs[h]=this._nodePromiseLODs[h]||[],0===h?H=d:(this._nodeIndexLOD=null,this._nodePromiseLODs[h].push(d))}return this._loader.logClose(),await H}))}_loadMaterialAsync(Z,h,V,v,A){return this._nodeIndexLOD?null:c.LoadExtensionAsync(Z,h,this.name,(async(Z,H)=>{let K;const d=this._getLODs(Z,h,this._loader.Lh.materials,H.ids);this._loader.logOpen(`${Z}`);for(let h=0;h<d.length;h++){const Z=d[h];0!==h&&(this._materialIndexLOD=h);const H=this._loader._loadMaterialAsync(`/materials/${Z.index}`,Z,V,v,(Z=>{0===h&&A(Z)})).then((Z=>{if(0!==h){A(Z);const V=d[h-1]._data;V[v]&&(this._disposeMaterials([V[v].babylonMaterial]),delete V[v])}return Z}));this._materialPromiseLODs[h]=this._materialPromiseLODs[h]||[],0===h?K=H:(this._materialIndexLOD=null,this._materialPromiseLODs[h].push(H))}return this._loader.logClose(),await K}))}_loadUriAsync(Z,h,V){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const A=this._nodeIndexLOD-1;return this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new v,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Z,h,V)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const A=this._materialIndexLOD-1;return this._materialSignalLODs[A]=this._materialSignalLODs[A]||new v,this._materialSignalLODs[A].promise.then((async()=>await this._loader.loadUriAsync(Z,h,V)))}return null}loadBufferAsync(Z,h,V,A){if(this._loader.parent.useRangeRequests&&!h.uri){if(!this._loader.bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);const h=async(Z,h)=>{const H=V,K=H+A-1;let d=Z[h];return d?(d.start=Math.min(d.start,H),d.end=Math.max(d.end,K)):(d={start:H,end:K,loaded:new v},Z[h]=d),await d.loaded.promise.then((Z=>new Uint8Array(Z.buffer,Z.byteOffset+V-d.start,A)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?h(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?h(this._materialBufferLODs,this._materialIndexLOD):h(this._bufferLODs,0)}return null}_loadBufferLOD(Z,h){const V=Z[h];V&&(this._loader.log(`Loading buffer range [${V.start}-${V.end}]`),this._loader.bin.readAsync(V.start,V.end-V.start+1).then((Z=>{V.loaded.resolve(Z)}),(Z=>{V.loaded.reject(Z)})))}_getLODs(Z,h,V,v){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const A=[];for(let H=v.length-1;H>=0;H--)if(A.push(T.Get(`${Z}/ids/${v[H]}`,V,v[H])),A.length===this.maxLODsToLoad)return A;return A.push(h),A}_disposeTransformNode(Z){const h=[],V=Z.material;V&&h.push(V);for(const A of Z.getChildMeshes())A.material&&h.push(A.material);Z.dispose();const v=h.filter((Z=>this._loader.babylonScene.meshes.every((h=>h.material!=Z))));this._disposeMaterials(v)}_disposeMaterials(Z){const h={};for(const V of Z){for(const Z of V.getActiveTextures())h[Z.uniqueId]=Z;V.dispose()}for(const V in h)for(const Z of this._loader.babylonScene.materials)Z.hasTexture(h[V])&&delete h[V];for(const V in h)h[V].dispose()}}U(aV),e(aV,!0,(Z=>new nV(Z)));const xV="MSFT_minecraftMesh";class NV{constructor(Z){this.name=xV,this._loader=Z,this.enabled=this._loader.isExtensionUsed(xV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtraAsync(Z,h,this.name,(async(v,A)=>{if(A){if(!(V instanceof X.c))throw new Error(`${v}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(Z,h,V);return V.needAlphaBlending()&&(V.forceDepthWrite=!0,V.separateCullingPass=!0),V.Gh=V.forceDepthWrite,V.twoSidedLighting=!0,await A}}))}}U(xV),e(xV,!0,(Z=>new NV(Z)));const DV="MSFT_sRGBFactors";class kV{constructor(Z){this.name=DV,this._loader=Z,this.enabled=this._loader.isExtensionUsed(DV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,h,V){return c.LoadExtraAsync(Z,h,this.name,(async(v,A)=>{if(A){if(!(V instanceof X.c))throw new Error(`${v}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(Z,h,V),H=V.CZ().getEngine().useExactSrgbConversions;return V.albedoTexture||V.albedoColor.toLinearSpaceToRef(V.albedoColor,H),V.reflectivityTexture||V.reflectivityColor.toLinearSpaceToRef(V.reflectivityColor,H),await A}}))}}U(DV),e(DV,!0,(Z=>new kV(Z)));var uV=V(13443);const FV={};var bV=V(13500),oV=V(13474),qV=V(13448),XV=V(13459);function EV(Z,h){for(const V of Z)for(const Z of V.dataOutputs)if(Z.uniqueId===h)return Z;throw new Error("Could not find data out connection with unique id "+h)}function jV(Z,h){for(const V of Z)if(V instanceof oV.b)for(const Z of V.signalInputs)if(Z.uniqueId===h)return Z;throw new Error("Could not find signal in connection with unique id "+h)}async function PV(Z,h){const v=await Promise.all(Z.allBlocks.map((async Z=>{const h=function(Z){switch(Z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([V.e(78),V.e(79)]).then(V.bind(V,14950))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await V.e(80).then(V.bind(V,14954))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await V.e(81).then(V.bind(V,14956))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await V.e(82).then(V.bind(V,14961))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await V.e(83).then(V.bind(V,14970))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await V.e(84).then(V.bind(V,14976))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await V.e(85).then(V.bind(V,14980))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await V.e(86).then(V.bind(V,14988))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await V.e(87).then(V.bind(V,14996))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await V.e(90).then(V.bind(V,15039))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await V.e(90).then(V.bind(V,15039))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await V.e(90).then(V.bind(V,15039))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await V.e(90).then(V.bind(V,15039))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await V.e(95).then(V.bind(V,15045))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await V.e(96).then(V.bind(V,15052))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await V.e(97).then(V.bind(V,15054))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await V.e(98).then(V.bind(V,15060))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await V.e(99).then(V.bind(V,15065))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await V.e(100).then(V.bind(V,15070))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await V.e(101).then(V.bind(V,15075))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await V.e(102).then(V.bind(V,15081))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await V.e(103).then(V.bind(V,15090))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await V.e(104).then(V.bind(V,15094))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await V.e(105).then(V.bind(V,15098))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await V.e(106).then(V.bind(V,15106))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await V.e(107).then(V.bind(V,15111))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await V.e(108).then(V.bind(V,15118))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await V.e(109).then(V.bind(V,15125))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await V.e(110).then(V.bind(V,15132))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await V.e(111).then(V.bind(V,15141))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await V.e(112).then(V.bind(V,15146))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await V.e(113).then(V.bind(V,15151))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await V.e(92).then(V.bind(V,15159))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await V.e(114).then(V.bind(V,15168))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await V.e(115).then(V.bind(V,15171))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await V.e(116).then(V.bind(V,15180))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await V.e(93).then(V.bind(V,15186))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await V.e(88).then(V.bind(V,15005))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await V.e(94).then(V.bind(V,15188))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await V.e(89).then(V.bind(V,15030))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await V.e(90).then(V.bind(V,15039))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await V.e(90).then(V.bind(V,15039))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await V.e(91).then(V.bind(V,15192))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await V.e(91).then(V.bind(V,15192))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await V.e(91).then(V.bind(V,15192))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await V.e(91).then(V.bind(V,15192))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await V.e(91).then(V.bind(V,15192))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await V.e(91).then(V.bind(V,15192))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await V.e(117).then(V.bind(V,15201))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await V.e(118).then(V.bind(V,15203))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await V.e(119).then(V.bind(V,15210))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await V.e(120).then(V.bind(V,15219))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await V.e(121).then(V.bind(V,15228))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await V.e(122).then(V.bind(V,15236))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await V.e(123).then(V.bind(V,15238))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await V.e(124).then(V.bind(V,15243))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await V.e(125).then(V.bind(V,15247))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await V.e(126).then(V.bind(V,15255))).FlowGraphDataSwitchBlock;default:if(FV[Z])return FV[Z];throw new Error(`Unknown block name ${Z}`)}}(Z.className);return await h()})));return function(Z,h,V){const v=h.coordinator.createGraph(),A=[],H=h.valueParseFunction??qV.d;for(let K=0;K<Z.allBlocks.length;K++){const d=lV(Z.allBlocks[K],{Wh:h.coordinator.config.Wh,pathConverter:h.pathConverter,assetsContainer:h.coordinator.config.Wh,valueParseFunction:H},V[K]);A.push(d),d instanceof bV.d&&v.addEventBlock(d)}for(const K of A){for(const Z of K.dataInputs)for(const h of Z.connectedPointIds){const V=EV(A,h);Z.connectTo(V)}if(K instanceof oV.b)for(const Z of K.signalOutputs)for(const h of Z.connectedPointIds){const V=jV(A,h);Z.connectTo(V)}}for(const K of Z.executionContexts)CV(K,{graph:v,valueParseFunction:H},Z.rightHanded);return v}(Z,h,v)}function CV(Z,h,V){const v=h.graph.createContext();Z.enableLogging&&(v.enableLogging=!0),v.treatDataAsRightHanded=V||!1;const A=h.valueParseFunction??qV.d;v.uniqueId=Z.uniqueId;const H=v.CZ();if(Z._assetsContext){var K,d,a,n,x,N,D,k,u,F;const h=Z._assetsContext,V={meshes:null===(K=h.meshes)||void 0===K?void 0:K.map((Z=>H.getMeshById(Z))),lights:null===(d=h.lights)||void 0===d?void 0:d.map((Z=>H.getLightByName(Z))),cameras:null===(a=h.cameras)||void 0===a?void 0:a.map((Z=>H.getCameraByName(Z))),materials:null===(n=h.materials)||void 0===n?void 0:n.map((Z=>H.getMaterialById(Z))),textures:null===(x=h.textures)||void 0===x?void 0:x.map((Z=>H.getTextureByName(Z))),animations:null===(N=h.animations)||void 0===N?void 0:N.map((Z=>H.animations.find((h=>h.name===Z)))),skeletons:null===(D=h.skeletons)||void 0===D?void 0:D.map((Z=>H.getSkeletonByName(Z))),bD:null===(k=h.bD)||void 0===k?void 0:k.map((Z=>H.getParticleSystemById(Z))),animationGroups:null===(u=h.animationGroups)||void 0===u?void 0:u.map((Z=>H.getAnimationGroupByName(Z))),transformNodes:null===(F=h.transformNodes)||void 0===F?void 0:F.map((Z=>H.getTransformNodeById(Z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],pD:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};v.assetsContext=V}for(const b in Z._userVariables){const h=A(b,Z._userVariables,v.assetsContext,H);v.userVariables[b]=h}for(const b in Z._connectionValues){const h=A(b,Z._connectionValues,v.assetsContext,H);v._setConnectionValueByKey(b,h)}return v}function lV(Z,h,V){const v={},A=h.valueParseFunction??qV.d;if(Z.config)for(const K in Z.config)v[K]=A(K,Z.config,h.assetsContainer||h.Wh,h.Wh);if((0,qV.i)(Z.className)){if(!h.pathConverter)throw new Error("Path converter is required for this block");v.pathConverter=h.pathConverter}const H=new V(v);H.uniqueId=Z.uniqueId;for(let K=0;K<Z.dataInputs.length;K++){const h=H.getDataInput(Z.dataInputs[K].name);if(!h)throw new Error("Could not find data input with name "+Z.dataInputs[K].name+" in block "+Z.className);h.deserialize(Z.dataInputs[K])}for(let K=0;K<Z.dataOutputs.length;K++){const h=H.getDataOutput(Z.dataOutputs[K].name);if(!h)throw new Error("Could not find data output with name "+Z.dataOutputs[K].name+" in block "+Z.className);h.deserialize(Z.dataOutputs[K])}return H.metadata=Z.metadata,H.deserialize&&H.deserialize(Z),H}function BV(Z){const[h,V]=Z.split(":");return SV({op:h,extension:V})}function SV(Z){var h;let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const v=Z.extension?null===(h=LV[Z.extension])||void 0===h?void 0:h[Z.op]:yV[Z.op];if(!v&&(F.b.Warn(`No mapping found for operation ${Z.op} and extension ${Z.extension||"KHR_interactivity"}`),V)){const h={},V={flows:{}};if(Z.inputValueSockets){h.values={};for(const V in Z.inputValueSockets)h.values[V]={name:V}}return Z.outputValueSockets&&(V.values={},Object.keys(Z.outputValueSockets).forEach((Z=>{V.values[Z]={name:Z}}))),{zx:[],inputs:h,outputs:V}}return v}function rV(Z,h,V){LV[h]||(LV[h]={}),LV[h][Z]=V}const LV={BABYLON:{"flow/log":{zx:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},yV={"event/onStart":{zx:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{zx:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{zx:["FlowGraphSendCustomEventBlock"],extraProcessor(Z,h,V,v,A){if("event/send"!==h.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const H=Z.configuration.event.value[0];if("number"!==typeof H)throw new Error("Event id should be a number");const K=v.arrays.events[H],d=A[0];return d.config||(d.config={}),d.config.eventId=K.eventId,d.config.eventData=K.eventData,A}},"event/receive":{zx:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Z,h){var V;if(!Z.configuration)return F.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const v=Z.configuration.event;if(!v)return F.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const A=v.value[0];if("number"!==typeof A)return F.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(V=h.events)||void 0===V?void 0:V[A])?{valid:!0}:(F.b.Error(`Event with id ${A} not found`),{valid:!1,error:`Event with id ${A} not found`})},extraProcessor(Z,h,V,v,A){if("event/receive"!==h.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const H=Z.configuration.event.value[0];if("number"!==typeof H)throw new Error("Event id should be a number");const K=v.arrays.events[H],d=A[0];return d.config||(d.config={}),d.config.eventId=K.eventId,d.config.eventData=K.eventData,A}},"math/e":WV("FlowGraphEBlock"),"math/pi":WV("FlowGraphPIBlock"),"math/inf":WV("FlowGraphInfBlock"),"math/nan":WV("FlowGraphNaNBlock"),"math/abs":WV("FlowGraphAbsBlock"),"math/sign":WV("FlowGraphSignBlock"),"math/trunc":WV("FlowGraphTruncBlock"),"math/floor":WV("FlowGraphFloorBlock"),"math/ceil":WV("FlowGraphCeilBlock"),"math/round":{zx:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.roundHalfAwayFromZero=!0,A}},"math/fract":WV("FlowGraphFractBlock"),"math/neg":WV("FlowGraphNegationBlock"),"math/add":WV("FlowGraphAddBlock",["a","b"],!0),"math/sub":WV("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{zx:["FlowGraphMultiplyBlock"],extraProcessor(Z,h,V,v,A){var H;(H=A[0]).config||(H.config={}),A[0].config.useMatrixPerComponent=!0,A[0].config.preventIntegerFloatArithmetic=!0;let K=-1;return Object.keys(Z.values||{}).find((h=>{var V;return void 0!==(null===(V=Z.values)||void 0===V?void 0:V[h].type)&&(K=Z.values[h].type,!0)})),-1!==K&&(A[0].config.type=v.arrays.types[K].flowGraphType),A},validation:Z=>Z.values?zV(Z):{valid:!0}},"math/div":WV("FlowGraphDivideBlock",["a","b"],!0),"math/rem":WV("FlowGraphModuloBlock",["a","b"]),"math/min":WV("FlowGraphMinBlock",["a","b"]),"math/max":WV("FlowGraphMaxBlock",["a","b"]),"math/clamp":WV("FlowGraphClampBlock",["a","b","c"]),"math/saturate":WV("FlowGraphSaturateBlock"),"math/mix":WV("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":WV("FlowGraphEqualityBlock",["a","b"]),"math/lt":WV("FlowGraphLessThanBlock",["a","b"]),"math/le":WV("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":WV("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":WV("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":WV("FlowGraphIsNaNBlock"),"math/isinf":WV("FlowGraphIsInfBlock"),"math/select":{zx:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{zx:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":WV("FlowGraphSinBlock"),"math/cos":WV("FlowGraphCosBlock"),"math/tan":WV("FlowGraphTanBlock"),"math/asin":WV("FlowGraphASinBlock"),"math/acos":WV("FlowGraphACosBlock"),"math/atan":WV("FlowGraphATanBlock"),"math/atan2":WV("FlowGraphATan2Block",["a","b"]),"math/sinh":WV("FlowGraphSinhBlock"),"math/cosh":WV("FlowGraphCoshBlock"),"math/tanh":WV("FlowGraphTanhBlock"),"math/asinh":WV("FlowGraphASinhBlock"),"math/acosh":WV("FlowGraphACoshBlock"),"math/atanh":WV("FlowGraphATanhBlock"),"math/exp":WV("FlowGraphExponentialBlock"),"math/log":WV("FlowGraphLogBlock"),"math/log2":WV("FlowGraphLog2Block"),"math/log10":WV("FlowGraphLog10Block"),"math/sqrt":WV("FlowGraphSquareRootBlock"),"math/cbrt":WV("FlowGraphCubeRootBlock"),"math/pow":WV("FlowGraphPowerBlock",["a","b"]),"math/length":WV("FlowGraphLengthBlock"),"math/normalize":WV("FlowGraphNormalizeBlock"),"math/dot":WV("FlowGraphDotBlock",["a","b"]),"math/cross":WV("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":WV("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":WV("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{zx:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{zx:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{zx:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{zx:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{zx:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{zx:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{zx:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":WV("FlowGraphTransposeBlock"),"math/determinant":WV("FlowGraphDeterminantBlock"),"math/inverse":WV("FlowGraphInvertMatrixBlock"),"math/matmul":WV("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{zx:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"tv",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A,H){const K=A[0].dataInputs.find((Z=>"rotationQuaternion"===Z.name));if(!K)throw new Error("Rotation quaternion input not found");return H._connectionValues[K.uniqueId]&&(H._connectionValues[K.uniqueId].type="Quaternion"),A}},"math/matDecompose":{zx:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"tv"}}}},"math/quatConjugate":WV("FlowGraphConjugateBlock",["a"]),"math/quatMul":{zx:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.type="Quaternion",A}},"math/quatAngleBetween":WV("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{zx:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":WV("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":WV("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{zx:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract2x2":{zx:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{zx:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract3x3":{zx:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{zx:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract4x4":{zx:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{zx:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A,H){var K,d;(d=A[0]).config||(d.config={});const a=A[0].dataInputs[0];return A[0].config.valueType=(null===(K=H._connectionValues[a.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",A}},"math/and":{zx:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A,H){var K,d,a;(a=A[0]).config||(a.config={});const n=A[0].dataInputs[0],x=A[0].dataInputs[1];return A[0].config.valueType=(null===(K=H._connectionValues[n.uniqueId])||void 0===K?void 0:K.type)??(null===(d=H._connectionValues[x.uniqueId])||void 0===d?void 0:d.type)??"FlowGraphInteger",A}},"math/or":{zx:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A,H){var K,d,a;(a=A[0]).config||(a.config={});const n=A[0].dataInputs[0],x=A[0].dataInputs[1];return A[0].config.valueType=(null===(K=H._connectionValues[n.uniqueId])||void 0===K?void 0:K.type)??(null===(d=H._connectionValues[x.uniqueId])||void 0===d?void 0:d.type)??"FlowGraphInteger",A}},"math/xor":{zx:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,h,V,v,A,H){var K,d,a;(a=A[0]).config||(a.config={});const n=A[0].dataInputs[0],x=A[0].dataInputs[1];return A[0].config.valueType=(null===(K=H._connectionValues[n.uniqueId])||void 0===K?void 0:K.type)??(null===(d=H._connectionValues[x.uniqueId])||void 0===d?void 0:d.type)??"FlowGraphInteger",A}},"math/asr":WV("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":WV("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":WV("FlowGraphLeadingZerosBlock"),"math/ctz":WV("FlowGraphTrailingZerosBlock"),"math/popcnt":WV("FlowGraphOneBitsCounterBlock"),"math/rad":WV("FlowGraphDegToRadBlock"),"math/deg":WV("FlowGraphRadToDegBlock"),"type/boolToInt":WV("FlowGraphBooleanToInt"),"type/boolToFloat":WV("FlowGraphBooleanToFloat"),"type/intToBool":WV("FlowGraphIntToBoolean"),"type/intToFloat":WV("FlowGraphIntToFloat"),"type/floatToInt":WV("FlowGraphFloatToInt"),"type/floatToBool":WV("FlowGraphFloatToBoolean"),"flow/sequence":{zx:["FlowGraphSequenceBlock"],extraProcessor(Z,h,V,v,A){const H=A[0];return H.config||(H.config={}),H.config.outputSignalCount=Object.keys(Z.flows||[]).length,H.signalOutputs.forEach(((Z,h)=>{Z.name="out_"+h})),A}},"flow/branch":{zx:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{zx:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const h=Z.configuration.cases.value;if(!h.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return F.b.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const V=new Set(h);Z.configuration.cases.value=Array.from(V)}return{valid:!0}},extraProcessor(Z,h,V,v,A){if("flow/switch"!==h.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return A[0].signalOutputs.forEach((Z=>{"default"!==Z.name&&(Z.name="out_"+Z.name)})),A}},"flow/while":{zx:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{zx:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Z,h,V,v,A){const H=A[0];return H.config||(H.config={}),H.config.incrementIndexWhenLoopDone=!0,A}},"flow/doN":{zx:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{zx:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Z,h,V,v,A){if("flow/multiGate"!==h.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const H=A[0];return H.config||(H.config={}),H.config.outputSignalCount=Object.keys(Z.flows).length,H.signalOutputs.forEach(((Z,h)=>{Z.name="out_"+h})),A}},"flow/waitAll":{zx:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Z){var h,V;return"number"!==typeof(null===(h=Z.configuration)||void 0===h||null===(V=h.inputFlows)||void 0===V?void 0:V.value[0])&&(Z.configuration=Z.configuration||{inputFlows:{value:[0]}},Z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{zx:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{zx:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{zx:["FlowGraphCancelDelayBlock"]},"variable/get":{zx:["FlowGraphGetVariableBlock"],validation(Z){var h,V;return null!==(h=Z.configuration)&&void 0!==h&&null!==(V=h.variable)&&void 0!==V&&V.value?{valid:!0}:(F.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,h)=>[h.getVariableName(Z[0])]}}},"variable/set":{zx:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,h)=>[h.getVariableName(Z[0])]}}},"variable/setMultiple":{zx:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Z,h)=>[Z[0].map((Z=>h.getVariableName(Z)))]}},extraProcessor:(Z,h,V,v,A)=>(A[0].dataInputs.forEach((Z=>{Z.name=v.getVariableName(+Z.name)})),A)},"variable/interpolate":{zx:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Z,h)=>[h.getVariableName(Z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Z=>!0===Z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",tV:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",tV:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",tV:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",tV:"FlowGraphPlayAnimationBlock"},out:{name:"out",tV:"FlowGraphPlayAnimationBlock"},done:{name:"done",tV:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Z,h,V,v,A){var H,K,d;const a=A[0],n=null===(H=Z.configuration)||void 0===H?void 0:H.variable.value[0];if("number"!==typeof n)throw F.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const x=v.arrays.staticVariables[n];"undefined"===typeof a.config.animationType.value&&(v.arrays.staticVariables,a.config.animationType.value=(0,XV.O)(x.type));const N=A[4];return N.config||(N.config={}),(K=N.config).variable||(K.variable={}),N.config.variable.value=v.getVariableName(n),(d=A[3]).config||(d.config={}),A}},"pointer/get":{zx:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",tV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",tV:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,h,V,v,A)=>(A.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),A)},"pointer/set":{zx:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",tV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",tV:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,h,V,v,A)=>(A.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),A)},"pointer/interpolate":{zx:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",tV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",tV:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",tV:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",tV:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",tV:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",tV:"FlowGraphPlayAnimationBlock"},out:{name:"out",tV:"FlowGraphPlayAnimationBlock"},done:{name:"done",tV:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,h,V,v,A)=>(A.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className?(h.config||(h.config={}),h.config.outputValue=!0):"FlowGraphInterpolationBlock"===h.className&&(h.config||(h.config={}),Object.keys(Z.values||[]).forEach((V=>{var A;const H=null===(A=Z.values)||void 0===A?void 0:A[V];if("value"===V&&H){const Z=H.type;void 0!==Z&&(h.config.animationType=v.arrays.types[Z].flowGraphType)}})))})),A)},"animation/start":{zx:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",tV:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Z,h)=>[Z[0]*h._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Z,h)=>[Z[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,h,V,v,A,H,K){const d=A[A.length-1];return d.config||(d.config={}),d.config.glTF=K,A}},"animation/stop":{zx:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",tV:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,h,V,v,A,H,K){const d=A[A.length-1];return d.config||(d.config={}),d.config.glTF=K,A}},"animation/stopAt":{zx:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",tV:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Z,h)=>[Z[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,h,V,v,A,H,K){const d=A[A.length-1];return d.config||(d.config={}),d.config.glTF=K,A}},"math/switch":{zx:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const h=Z.configuration.cases.value;if(!h.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return F.b.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const V=new Set(h);Z.configuration.cases.value=Array.from(V)}return{valid:!0}},extraProcessor(Z,h,V,v,A){const H=A[0];return H.dataInputs.forEach((Z=>{"default"!==Z.name&&"case"!==Z.name&&(Z.name="in_"+Z.name)})),H.config||(H.config={}),H.config.treatCasesAsIntegers=!0,A}},"debug/log":{zx:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function WV(Z){let h=arguments.length>2?arguments[2]:void 0;return{zx:[Z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Z,h)=>(Z[h]={name:h},Z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,V,v,A,H){var K;if(h){(K=H[0]).config||(K.config={}),H[0].config.preventIntegerFloatArithmetic=!0;let h=-1;Object.keys(Z.values||{}).find((V=>{var v;return void 0!==(null===(v=Z.values)||void 0===v?void 0:v[V].type)&&(h=Z.values[V].type,!0)})),-1!==h&&(H[0].config.type=A.arrays.types[h].flowGraphType)}return H},validation:Z=>h?zV(Z):{valid:!0}}}function zV(Z){if(Z.values){const h=Object.keys(Z.values).map((h=>Z.values[h].type)).filter((Z=>void 0!==Z));if(!h.every((Z=>Z===h[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}yV["math/compose"]=yV["math/matCompose"],yV["math/decompose"]=yV["math/matDecompose"];var mV=V(11700);const gV={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Ch",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class IV{constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Z,this._gltf=h,this._animationTargetFps=V,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Z of this._interactivityGraph.types)this._types.push(gV[Z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Z of this._interactivityGraph.declarations){const h=SV(Z);if(!h)throw F.b.Error(["No mapping found for declaration",Z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:h,fullOperationName:Z.extension?Z.op+":"+Z.extension:Z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Z of this._interactivityGraph.variables){const h=this._parseVariable(Z);this._staticVariables.push(h)}}_parseVariable(Z,h){const V=this._types[Z.type];if(!V)throw F.b.Error(["No type found for variable",Z]),new Error("Error parsing variables");if(Z.value&&Z.value.length!==V.length)throw F.b.Error(["Invalid value length for variable",Z,V]),new Error("Error parsing variables");const v=Z.value||[];if(!v.length)switch(V.flowGraphType){case"boolean":v.push(!1);break;case"FlowGraphInteger":v.push(0);break;case"number":v.push(NaN);break;case"Vector2":v.push(NaN,NaN);break;case"Ch":v.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":v.fill(NaN,0,4);break;case"Matrix":v.fill(NaN,0,16);break;case"Matrix3D":v.fill(NaN,0,9)}return"number"===V.elementType&&"string"===typeof v[0]&&(v[0]=parseFloat(v[0])),{type:V.flowGraphType,value:h?h(v,this):v}}_parseEvents(){if(this._interactivityGraph.events)for(const Z of this._interactivityGraph.events){const h={eventId:Z.id||"internalEvent_"+this._internalEventsCounter++};Z.values&&(h.eventData=Object.keys(Z.values).map((h=>{var V;const v=null===(V=Z.values)||void 0===V?void 0:V[h];if(!v)throw F.b.Error(["No value found for event key",h]),new Error("Error parsing events");const A=this._types[v.type];if(!A)throw F.b.Error(["No type found for event value",v]),new Error("Error parsing events");const H="undefined"!==typeof v.value?this._parseVariable(v):void 0;return{id:h,type:A.flowGraphType,eventData:!0,value:H}}))),this._events.push(h)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const h of this._interactivityGraph.nodes){if("number"!==typeof h.declaration)throw F.b.Error(["No declaration found for node",h]),new Error("Error parsing nodes");const V=this._mappings[h.declaration];if(!V)throw F.b.Error(["No mapping found for node",h]),new Error("Error parsing nodes");if(V.flowGraphMapping.validation){const v=V.flowGraphMapping.validation(h,this._interactivityGraph,this._gltf);var Z;if(!v.valid)throw new Error(`Error validating interactivity node ${null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[h.declaration].op} - ${v.error}`)}const v=[];for(const Z of V.flowGraphMapping.zx){const A=this._getEmptyBlock(Z,V.fullOperationName);this._parseNodeConfiguration(h,A,V.flowGraphMapping,Z),v.push(A)}this._nodes.push({zx:v,fullOperationName:V.fullOperationName})}}_getEmptyBlock(Z,h){return{uniqueId:(0,mV.e)(),className:Z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:h,metadata:{}}}_parseNodeConfiguration(Z,h,V,v){const A=h.config;if(Z.configuration){const h=Object.keys(Z.configuration);for(const d of h){var H,K;const h=null===(H=Z.configuration)||void 0===H?void 0:H[d];if(!h)throw F.b.Error(["No value found for node configuration",d]),new Error("Error parsing node configuration");const a=null===(K=V.configuration)||void 0===K?void 0:K[d];if(a&&a.tV?a.tV===v:0===V.zx.indexOf(v)){const Z=(null===a||void 0===a?void 0:a.name)||d;h&&"undefined"!==typeof h.value||"undefined"===typeof(null===a||void 0===a?void 0:a.defaultValue)?h.value.length>=0?A[Z]={value:1===h.value.length?h.value[0]:h.value}:F.b.Warn(["Invalid value for node configuration",h]):A[Z]={value:a.defaultValue},a&&a.dataTransformer&&(A[Z].value=a.dataTransformer([A[Z].value],this)[0])}}}}_parseNodeConnections(Z){for(let P=0;P<this._nodes.length;P++){var h;const C=null===(h=this._interactivityGraph.nodes)||void 0===h?void 0:h[P];if(!C)throw F.b.Error(["No node found for interactivity node",this._nodes[P]]),new Error("Error parsing node connections");const l=this._nodes[P],B=this._mappings[C.declaration];if(!B)throw F.b.Error(["No mapping found for node",C]),new Error("Error parsing node connections");const S=C.flows||{},r=Object.keys(S).sort();for(const Z of r){var V,v,A,H;const h=S[Z],n=null===(V=B.flowGraphMapping.outputs)||void 0===V||null===(v=V.flows)||void 0===v?void 0:v[Z],x=(null===n||void 0===n?void 0:n.name)||Z,N=this._createNewSocketConnection(x,!0);(n&&n.tV&&l.zx.find((Z=>Z.className===n.tV))||l.zx[0]).signalOutputs.push(N);const D=h.node,k=this._nodes[D];if(!k)throw F.b.Error(["No node found for input node id",D]),new Error("Error parsing node connections");const u=BV(k.fullOperationName);if(!u)throw F.b.Error(["No mapping found for input node",k]),new Error("Error parsing node connections");let b=null===(A=u.inputs)||void 0===A||null===(H=A.flows)||void 0===H?void 0:H[h.socket||"in"],o=!1;if(!b)for(const Z in null===(K=u.inputs)||void 0===K?void 0:K.flows){var K,d,a;if(Z.startsWith("[")&&Z.endsWith("]"))o=!0,b=null===(d=u.inputs)||void 0===d||null===(a=d.flows)||void 0===a?void 0:a[Z]}const q=b?o?b.name.replace("$1",h.socket||""):b.name:h.socket||"in",X=b&&b.tV&&k.zx.find((Z=>Z.className===b.tV))||k.zx[0];let E=X.signalInputs.find((Z=>Z.name===q));E||(E=this._createNewSocketConnection(q),X.signalInputs.push(E)),E.connectedPointIds.push(N.uniqueId),N.connectedPointIds.push(E.uniqueId)}const L=C.values||{},y=Object.keys(L);for(const h of y){var n,x;const V=L[h];let v=null===(n=B.flowGraphMapping.inputs)||void 0===n||null===(x=n.values)||void 0===x?void 0:x[h],A=!1;if(!v)for(const Z in null===(N=B.flowGraphMapping.inputs)||void 0===N?void 0:N.values){var N,D,k;if(Z.startsWith("[")&&Z.endsWith("]"))A=!0,v=null===(D=B.flowGraphMapping.inputs)||void 0===D||null===(k=D.values)||void 0===k?void 0:k[Z]}const H=v?A?v.name.replace("$1",h):v.name:h,K=this._createNewSocketConnection(H);if((v&&v.tV&&l.zx.find((Z=>Z.className===v.tV))||l.zx[0]).dataInputs.push(K),void 0!==V.value){const h=this._parseVariable(V,v&&v.dataTransformer);Z._connectionValues[K.uniqueId]=h}else{if("undefined"===typeof V.node)throw F.b.Error(["Invalid value for value connection",V]),new Error("Error parsing node connections");{var u,b,o;const Z=V.node,h=V.socket||"value",v=this._nodes[Z];if(!v)throw F.b.Error(["No node found for output socket reference",V]),new Error("Error parsing node connections");const A=BV(v.fullOperationName);if(!A)throw F.b.Error(["No mapping found for output socket reference",V]),new Error("Error parsing node connections");let H=null===(u=A.outputs)||void 0===u||null===(b=u.values)||void 0===b?void 0:b[h],d=!1;if(!H)for(const V in null===(q=A.outputs)||void 0===q?void 0:q.values){var q,X,E;if(V.startsWith("[")&&V.endsWith("]"))d=!0,H=null===(X=A.outputs)||void 0===X||null===(E=X.values)||void 0===E?void 0:E[V]}const a=H?d?H.name.replace("$1",h):null===(o=H)||void 0===o?void 0:o.name:h,n=H&&H.tV&&v.zx.find((Z=>Z.className===H.tV))||v.zx[0];let x=n.dataOutputs.find((Z=>Z.name===a));x||(x=this._createNewSocketConnection(a,!0),n.dataOutputs.push(x)),K.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(K.uniqueId)}}}if(B.flowGraphMapping.interBlockConnectors)for(const Z of B.flowGraphMapping.interBlockConnectors){const h=Z.input,V=Z.output,v=Z.isVariable;this._connectFlowGraphNodes(h,V,l.zx[Z.inputBlockIndex],l.zx[Z.outputBlockIndex],v)}if(B.flowGraphMapping.extraProcessor){var j;const h=null===(j=this._interactivityGraph.declarations)||void 0===j?void 0:j[C.declaration];if(!h)throw F.b.Error(["No declaration found for extra processor",C]),new Error("Error parsing node connections");l.zx=B.flowGraphMapping.extraProcessor(C,h,B.flowGraphMapping,this,l.zx,Z,this._gltf)}}}_createNewSocketConnection(Z,h){return{uniqueId:(0,mV.e)(),name:Z,_connectionType:h?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Z,h,V,v,A){const H=A?V.dataInputs:V.signalInputs,K=A?v.dataOutputs:v.signalOutputs,d=H.find((h=>h.name===Z))||this._createNewSocketConnection(Z),a=K.find((Z=>Z.name===h))||this._createNewSocketConnection(h,!0);H.find((h=>h.name===Z))||H.push(d),K.find((Z=>Z.name===h))||K.push(a),d.connectedPointIds.push(a.uniqueId),a.connectedPointIds.push(d.uniqueId)}getVariableName(Z){return"staticVariable_"+Z}serializeToFlowGraph(){const Z={uniqueId:(0,mV.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Z);for(let h=0;h<this._staticVariables.length;h++){const V=this._staticVariables[h];Z._userVariables[this.getVariableName(h)]=V}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Z,h)=>Z.concat(h.zx)),[]),executionContexts:[Z]}}}const eV="KHR_interactivity";class UV{constructor(Z){this._loader=Z,this.name=eV,this.enabled=this._loader.isExtensionUsed(eV),this._pathConverter=(0,R.i)(this._loader.Lh),Z._skipStartAnimationStep=!0;const h=Z.babylonScene;h&&function(Z){(0,R.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Z.activeCamera)return new A.Quaternion(NaN,NaN,NaN,NaN);const h=A.Quaternion.FromRotationMatrix(Z.activeCamera.getWorldMatrix()).normalize();return Z.useRightHandedSystem||(h.w*=-1,h.x*=-1),h},type:"Quaternion",getTarget:()=>Z.activeCamera}),(0,R.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Z.activeCamera)return new A.Ch(NaN,NaN,NaN);const h=Z.activeCamera.getWorldMatrix().getTranslation();return Z.useRightHandedSystem||(h.x*=-1),h},type:"Ch",getTarget:()=>Z.activeCamera}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Z=>{var h;return(null===(h=Z._babylonAnimationGroup)||void 0===h?void 0:h.isPlaying)??!1},type:"boolean",getTarget:Z=>Z._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Z=>{var h;return((null===(h=Z._babylonAnimationGroup)||void 0===h?void 0:h.from)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Z=>{var h;return((null===(h=Z._babylonAnimationGroup)||void 0===h?void 0:h.to)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Z=>{var h;return((null===(h=Z._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,R.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Z=>{var h;return((null===(h=Z._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup})}(h)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Z;if(!this._loader.babylonScene||!this._pathConverter)return;const h=this._loader.babylonScene,V=null===(Z=this._loader.Lh.extensions)||void 0===Z?void 0:Z.KHR_interactivity;if(!V)return;const v=new uV.e({Wh:h});v.dispatchEventsSynchronously=!1;const A=V.graphs.map((Z=>new IV(Z,this._loader.Lh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(A.map((async Z=>await PV(Z,{coordinator:v,pathConverter:this._pathConverter})))),v.start()}}var RV;RV=async()=>(await Promise.resolve().then(V.bind(V,13517))).FlowGraphGLTFDataProvider,FV[`${eV}/${"FlowGraphGLTFDataProvider"}`]=RV,U(eV),e(eV,!0,(Z=>new UV(Z)));const QV="KHR_node_visibility";(0,R.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Z=>{const h=Z._babylonTransformNode;return!h||void 0===h.isVisible||h.isVisible},set:(Z,h)=>{var V,v;null===(V=h._primitiveBabylonMeshes)||void 0===V||V.forEach((Z=>{Z.inheritVisibility=!0})),h._babylonTransformNode&&(h._babylonTransformNode.isVisible=Z),null===(v=h._primitiveBabylonMeshes)||void 0===v||v.forEach((h=>{h.isVisible=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class wV{constructor(Z){this.name=QV,this._loader=Z,this.enabled=Z.isExtensionUsed(QV)}async onReady(){var Z;null===(Z=this._loader.Lh.nodes)||void 0===Z||Z.forEach((Z=>{var h,V,v,A;(null===(h=Z._primitiveBabylonMeshes)||void 0===h||h.forEach((Z=>{Z.inheritVisibility=!0})),null!==(V=Z.extensions)&&void 0!==V&&V.KHR_node_visibility)&&(!1===(null===(v=Z.extensions)||void 0===v?void 0:v.KHR_node_visibility.visible)&&(Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=!1),null===(A=Z._primitiveBabylonMeshes)||void 0===A||A.forEach((Z=>{Z.isVisible=!1}))))}))}dispose(){this._loader=null}}U(QV),e(QV,!0,(Z=>new wV(Z)));const TV="KHR_node_selectability";rV("event/onSelect",TV,{zx:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",tV:"FlowGraphGetVariableBlock",dataTransformer:Z=>["pickedMesh_"+Z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",tV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,h,V,v,A,H,K){var d,a,n,x,N,D;const k=A[A.length-1];k.config=k.config||{},k.config.glTF=K;const u=null===(d=Z.configuration)||void 0===d||null===(a=d.nodeIndex)||void 0===a?void 0:a.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const F="pickedMesh_"+u;return A[1].config.variable=F,H._userVariables[F]={className:"Mesh",id:null===K||void 0===K||null===(n=K.nodes)||void 0===n||null===(x=n[u]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===K||void 0===K||null===(N=K.nodes)||void 0===N||null===(D=N[u]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},A}}),(0,R.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Z=>{const h=Z._babylonTransformNode;return!h||void 0===h.pa||h.pa},set:(Z,h)=>{var V;null===(V=h._primitiveBabylonMeshes)||void 0===V||V.forEach((h=>{h.pa=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pa"],type:"boolean"});class tV{constructor(Z){this.name=TV,this._loader=Z,this.enabled=Z.isExtensionUsed(TV)}async onReady(){var Z;null===(Z=this._loader.Lh.nodes)||void 0===Z||Z.forEach((Z=>{var h,V,v;null!==(h=Z.extensions)&&void 0!==h&&h.KHR_node_selectability&&!1===(null===(V=Z.extensions)||void 0===V?void 0:V.KHR_node_selectability.selectable)&&(null===(v=Z._babylonTransformNode)||void 0===v||v.getChildMeshes().forEach((Z=>{Z.pa=!1})))}))}dispose(){this._loader=null}}U(TV),e(TV,!0,(Z=>new tV(Z)));const cV="KHR_node_hoverability",iV="targetMeshPointerOver_";rV("event/onHoverIn",cV,{zx:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",tV:"FlowGraphGetVariableBlock",dataTransformer:Z=>[iV+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",tV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,h,V,v,A,H,K){var d,a,n,x,N,D;const k=A[A.length-1];k.config=k.config||{},k.config.glTF=K;const u=null===(d=Z.configuration)||void 0===d||null===(a=d.nodeIndex)||void 0===a?void 0:a.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const F=iV+u;return A[1].config.variable=F,H._userVariables[F]={className:"Mesh",id:null===K||void 0===K||null===(n=K.nodes)||void 0===n||null===(x=n[u]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===K||void 0===K||null===(N=K.nodes)||void 0===N||null===(D=N[u]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},A}});const MV="targetMeshPointerOut_";rV("event/onHoverOut",cV,{zx:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",tV:"FlowGraphGetVariableBlock",dataTransformer:Z=>[MV+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",tV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,h,V,v,A,H,K){var d,a,n,x,N,D;const k=A[A.length-1];k.config=k.config||{},k.config.glTF=K;const u=null===(d=Z.configuration)||void 0===d||null===(a=d.nodeIndex)||void 0===a?void 0:a.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const F=MV+u;return A[1].config.variable=F,H._userVariables[F]={className:"Mesh",id:null===K||void 0===K||null===(n=K.nodes)||void 0===n||null===(x=n[u]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===K||void 0===K||null===(N=K.nodes)||void 0===N||null===(D=N[u]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},A}}),(0,R.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Z=>{const h=Z._babylonTransformNode;return!h||void 0===h.pointerOverDisableMeshTesting||h.pointerOverDisableMeshTesting},set:(Z,h)=>{var V;null===(V=h._primitiveBabylonMeshes)||void 0===V||V.forEach((h=>{h.pointerOverDisableMeshTesting=!Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class OV{constructor(Z){this.name=cV,this._loader=Z,this.enabled=Z.isExtensionUsed(cV)}async onReady(){var Z;null===(Z=this._loader.Lh.nodes)||void 0===Z||Z.forEach((Z=>{var h,V,v;null!==(h=Z.extensions)&&void 0!==h&&h.KHR_node_hoverability&&!1===(null===(V=Z.extensions)||void 0===V?void 0:V.KHR_node_hoverability.hoverable)&&(null===(v=Z._babylonTransformNode)||void 0===v||v.getChildMeshes().forEach((Z=>{Z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}U(cV),e(cV,!0,(Z=>new OV(Z)));const sV="ExtrasAsMetadata";class JV{_assignExtras(Z,h){if(h.extras&&Object.keys(h.extras).length>0){const V=Z.metadata=Z.metadata||{};(V.Lh=V.Lh||{}).extras=h.extras}}constructor(Z){this.name=sV,this.enabled=!0,this._loader=Z}dispose(){this._loader=null}loadNodeAsync(Z,h,V){return this._loader.loadNodeAsync(Z,h,(Z=>{this._assignExtras(Z,h),V(Z)}))}loadCameraAsync(Z,h,V){return this._loader.loadCameraAsync(Z,h,(Z=>{this._assignExtras(Z,h),V(Z)}))}createMaterial(Z,h,V){const v=this._loader.createMaterial(Z,h,V);return this._assignExtras(v,h),v}}U(sV),e(sV,!1,(Z=>new JV(Z)));V(13517)},13395:(Z,h,V)=>{"use strict";V.d(h,{d:()=>z,e:()=>B,i:()=>l,m:()=>S});var v=V(11566),A=V(11564),H=V(13029),K=V(12184),d=V(12146),a=V(12157),n=V(11580),x=V(11599),N=V(12176),D=V(12281),k=V(12192),u=V(11776);class F{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.bD=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.pD=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Z){this._environmentTexture=Z}getNodes(){let Z=[];Z=Z.concat(this.meshes),Z=Z.concat(this.lights),Z=Z.concat(this.cameras),Z=Z.concat(this.transformNodes);for(const h of this.skeletons)Z=Z.concat(h.bones);return Z}}class b extends F{}class o{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Z=this.rootNodes;for(const v of Z)v.dispose();Z.length=0;const h=this.skeletons;for(const v of h)v.dispose();h.length=0;const V=this.animationGroups;for(const v of V)v.dispose();V.length=0}}class q extends F{constructor(Z){super(),this._wasAddedToScene=!1,(Z=Z||x.b.LastCreatedScene)&&(this.Wh=Z,this.proceduralTextures=[],Z.jh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Z.getEngine().onContextRestoredObservable.add((()=>{for(const Z of this.geometries)Z._rebuild();for(const Z of this.meshes)Z._rebuild();for(const Z of this.bD)Z.rebuild();for(const Z of this.textures)Z._rebuild()})))}_topologicalSort(Z){const h=new Map;for(const K of Z)h.set(K.uniqueId,K);const V={dependsOn:new Map,dependedBy:new Map};for(const K of Z){const Z=K.uniqueId;V.dependsOn.set(Z,new Set),V.dependedBy.set(Z,new Set)}for(const K of Z){const Z=K.uniqueId,v=V.dependsOn.get(Z);if(K instanceof N.d){const A=K.sourceMesh;h.has(A.uniqueId)&&(v.add(A.uniqueId),V.dependedBy.get(A.uniqueId).add(Z))}const A=V.dependedBy.get(Z);for(const H of K.getDescendants()){const v=H.uniqueId;if(h.has(v)){A.add(v);V.dependsOn.get(v).add(Z)}}}const v=[],A=[];for(const K of Z){const Z=K.uniqueId;0===V.dependsOn.get(Z).size&&(A.push(K),h.delete(Z))}const H=A;for(;H.length>0;){const Z=H.shift();v.push(Z);const A=V.dependedBy.get(Z.uniqueId);for(const v of Array.from(A.values())){const A=V.dependsOn.get(v);A.delete(Z.uniqueId),0===A.size&&h.get(v)&&(H.push(h.get(v)),h.delete(v))}}return h.size>0&&(n.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),h.forEach((Z=>{n.b.Error(Z.name)}))),v}_addNodeAndDescendantsToList(Z,h,V,v){if(V&&(!v||v(V))&&!h.has(V.uniqueId)){Z.push(V),h.add(V.uniqueId);for(const A of V.getDescendants(!0))this._addNodeAndDescendantsToList(Z,h,A,v)}}_isNodeInContainer(Z){return Z instanceof a.e&&-1!==this.meshes.indexOf(Z)||(Z instanceof d.d&&-1!==this.transformNodes.indexOf(Z)||(Z instanceof D.c&&-1!==this.lights.indexOf(Z)||Z instanceof k.e&&-1!==this.cameras.indexOf(Z)))}_isValidHierarchy(){for(const Z of this.meshes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return n.b.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.transformNodes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return n.b.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.lights)if(Z.parent&&!this._isNodeInContainer(Z.parent))return n.b.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.cameras)if(Z.parent&&!this._isNodeInContainer(Z.parent))return n.b.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Z){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||A.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const v={},H={},d=new o,a=[],n=[],x={doNotInstantiate:!0,...V},N=[],D=new Set;for(const A of this.transformNodes)null===A.parent&&this._addNodeAndDescendantsToList(N,D,A,x.predicate);for(const A of this.meshes)null===A.parent&&this._addNodeAndDescendantsToList(N,D,A,x.predicate);const k=this._topologicalSort(N),u=(V,A)=>{if(((h,V)=>{if(v[h.uniqueId]=V.uniqueId,H[V.uniqueId]=V,Z&&(V.name=Z(h.name)),V instanceof K.c){const Z=V;if(Z.morphTargetManager){const V=h.morphTargetManager;Z.morphTargetManager=V.clone();for(let h=0;h<V.numTargets;h++){const A=V.getTarget(h),K=Z.morphTargetManager.getTarget(h);v[A.uniqueId]=K.uniqueId,H[K.uniqueId]=K}}}})(V,A),V.parent){const Z=v[V.parent.uniqueId],h=H[Z];A.parent=h||V.parent}if(A.position&&V.position&&A.position.v(V.position),A.rotationQuaternion&&V.rotationQuaternion&&A.rotationQuaternion.v(V.rotationQuaternion),A.rotation&&V.rotation&&A.rotation.v(V.rotation),A.tv&&V.tv&&A.tv.v(V.tv),A.material){const K=A;if(K.material)if(h){const h=V.material;if(-1===n.indexOf(h)){let V=h.clone(Z?Z(h.name):"Clone of "+h.name);if(n.push(h),v[h.uniqueId]=V.uniqueId,H[V.uniqueId]=V,"MultiMaterial"===h.getClassName()){const A=h;for(const h of A.xd)h&&(V=h.clone(Z?Z(h.name):"Clone of "+h.name),n.push(h),v[h.uniqueId]=V.uniqueId,H[V.uniqueId]=V);A.xd=A.xd.map((Z=>Z&&H[v[Z.uniqueId]]))}}"InstancedMesh"!==K.getClassName()&&(K.material=H[v[h.uniqueId]])}else"MultiMaterial"===K.material.getClassName()?-1===this.Wh.multiMaterials.indexOf(K.material)&&this.Wh.addMultiMaterial(K.material):-1===this.Wh.materials.indexOf(K.material)&&this.Wh.addMaterial(K.material)}null===A.parent&&d.rootNodes.push(A)};for(const A of k)if("InstancedMesh"===A.getClassName()){const Z=A,h=Z.sourceMesh,V=v[h.uniqueId];u(Z,("number"===typeof V?H[V]:h).createInstance(Z.name))}else{let Z=!0;"ld"===A.getClassName()||"Node"===A.getClassName()||A.skeleton||!A.getTotalVertices||0===A.getTotalVertices()?Z=!1:x.doNotInstantiate&&(Z="function"===typeof x.doNotInstantiate?!x.doNotInstantiate(A):!x.doNotInstantiate);const h=Z?A.createInstance(`instance of ${A.name}`):A.clone(`Clone of ${A.name}`,null,!0);if(!h)throw new Error(`Could not clone or instantiate node on Asset Container ${A.name}`);u(A,h)}for(const A of this.skeletons){if(x.predicate&&!x.predicate(A))continue;const h=A.clone(Z?Z(A.name):"Clone of "+A.name);for(const Z of this.meshes)if(Z.skeleton===A&&!Z.isAnInstance){const V=H[v[Z.uniqueId]];if(!V||V.isAnInstance)continue;if(V.skeleton=h,-1!==a.indexOf(h))continue;a.push(h);for(const Z of h.bones)Z._linkedTransformNode&&(Z._linkedTransformNode=H[v[Z._linkedTransformNode.uniqueId]])}d.skeletons.push(h)}for(const A of this.animationGroups){if(x.predicate&&!x.predicate(A))continue;const h=A.clone(Z?Z(A.name):"Clone of "+A.name,(Z=>H[v[Z.uniqueId]]||Z));d.animationGroups.push(h)}return d}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||A.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Wh.environmentTexture=this.environmentTexture);for(const Z of this.Wh._serializableComponents)Z.addFromContainer(this);this.Wh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=[];for(const V of this.cameras)Z&&!Z(V)||(this.Wh.addCamera(V),h.push(V));for(const V of this.lights)Z&&!Z(V)||(this.Wh.addLight(V),h.push(V));for(const V of this.meshes)Z&&!Z(V)||(this.Wh.qx(V),h.push(V));for(const V of this.skeletons)Z&&!Z(V)||this.Wh.addSkeleton(V);for(const V of this.animations)Z&&!Z(V)||this.Wh.addAnimation(V);for(const V of this.animationGroups)Z&&!Z(V)||this.Wh.addAnimationGroup(V);for(const V of this.multiMaterials)Z&&!Z(V)||this.Wh.addMultiMaterial(V);for(const V of this.materials)Z&&!Z(V)||this.Wh.addMaterial(V);for(const V of this.morphTargetManagers)Z&&!Z(V)||this.Wh.addMorphTargetManager(V);for(const V of this.geometries)Z&&!Z(V)||this.Wh.addGeometry(V);for(const V of this.transformNodes)Z&&!Z(V)||(this.Wh.addTransformNode(V),h.push(V));for(const V of this.actionManagers)Z&&!Z(V)||this.Wh.addActionManager(V);for(const V of this.textures)Z&&!Z(V)||this.Wh.addTexture(V);for(const V of this.reflectionProbes)Z&&!Z(V)||this.Wh.addReflectionProbe(V);for(const V of h)V.parent&&-1===this.Wh.getNodes().indexOf(V.parent)&&(V.setParent?V.setParent(null):V.parent=null)}removeAllFromScene(){this._isValidHierarchy()||A.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Wh.environmentTexture&&(this.Wh.environmentTexture=null);for(const Z of this.Wh._serializableComponents)Z.removeFromContainer(this)}removeFromScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const h of this.cameras)Z&&!Z(h)||this.Wh.removeCamera(h);for(const h of this.lights)Z&&!Z(h)||this.Wh.removeLight(h);for(const h of this.meshes)Z&&!Z(h)||this.Wh.ox(h,!0);for(const h of this.skeletons)Z&&!Z(h)||this.Wh.removeSkeleton(h);for(const h of this.animations)Z&&!Z(h)||this.Wh.removeAnimation(h);for(const h of this.animationGroups)Z&&!Z(h)||this.Wh.removeAnimationGroup(h);for(const h of this.multiMaterials)Z&&!Z(h)||this.Wh.removeMultiMaterial(h);for(const h of this.materials)Z&&!Z(h)||this.Wh.removeMaterial(h);for(const h of this.morphTargetManagers)Z&&!Z(h)||this.Wh.removeMorphTargetManager(h);for(const h of this.geometries)Z&&!Z(h)||this.Wh.removeGeometry(h);for(const h of this.transformNodes)Z&&!Z(h)||this.Wh.removeTransformNode(h);for(const h of this.actionManagers)Z&&!Z(h)||this.Wh.removeActionManager(h);for(const h of this.textures)Z&&!Z(h)||this.Wh.removeTexture(h);for(const h of this.reflectionProbes)Z&&!Z(h)||this.Wh.removeReflectionProbe(h)}dispose(){const Z=this.cameras.slice(0);for(const k of Z)k.dispose();this.cameras.length=0;const h=this.lights.slice(0);for(const k of h)k.dispose();this.lights.length=0;const V=this.meshes.slice(0);for(const k of V)k.dispose();this.meshes.length=0;const v=this.skeletons.slice(0);for(const k of v)k.dispose();this.skeletons.length=0;const A=this.animationGroups.slice(0);for(const k of A)k.dispose();this.animationGroups.length=0;const H=this.multiMaterials.slice(0);for(const k of H)k.dispose();this.multiMaterials.length=0;const K=this.materials.slice(0);for(const k of K)k.dispose();this.materials.length=0;const d=this.geometries.slice(0);for(const k of d)k.dispose();this.geometries.length=0;const a=this.transformNodes.slice(0);for(const k of a)k.dispose();this.transformNodes.length=0;const n=this.actionManagers.slice(0);for(const k of n)k.dispose();this.actionManagers.length=0;const x=this.textures.slice(0);for(const k of x)k.dispose();this.textures.length=0;const N=this.reflectionProbes.slice(0);for(const k of N)k.dispose();this.reflectionProbes.length=0;const D=this.morphTargetManagers.slice(0);for(const k of D)k.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const k of this.Wh._serializableComponents)k.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Wh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Z,h,V){if(Z&&h)for(const v of Z){let Z=!0;if(V)for(const h of V)if(v===h){Z=!1;break}Z&&(h.push(v),v._parentContainer=this)}}moveAllFromScene(Z){this._wasAddedToScene=!1,void 0===Z&&(Z=new b);for(const h in this)Object.prototype.hasOwnProperty.call(this,h)&&(this[h]=this[h]||("_environmentTexture"===h?null:[]),this._moveAssets(this.Wh[h],this[h],Z[h]));this.environmentTexture=this.Wh.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Z=new K.c("assetContainerRootMesh",this.Wh);for(const h of this.meshes)h.parent||Z.addChild(h);return this.meshes.unshift(Z),Z}mergeAnimationsTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.b.LastCreatedScene,h=arguments.length>1?arguments[1]:void 0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Z)return n.b.Error("No scene available to merge animations to"),[];const v=V||(h=>{let V=null;const v=h.animations.length?h.animations[0].targetProperty:"",A=h.name.split(".").join("").split("_primitive")[0];switch(v){case"position":case"rotationQuaternion":V=Z.getTransformNodeByName(h.name)||Z.getTransformNodeByName(A);break;case"influence":V=Z.getMorphTargetByName(h.name)||Z.getMorphTargetByName(A);break;default:V=Z.getNodeByName(h.name)||Z.getNodeByName(A)}return V}),A=this.getNodes();for(const d of A){const Z=v(d);if(null!==Z){for(const h of d.animations){const V=Z.animations.filter((Z=>Z.targetProperty===h.targetProperty));for(const h of V){const V=Z.animations.indexOf(h,0);V>-1&&Z.animations.splice(V,1)}}Z.animations=Z.animations.concat(d.animations)}}const H=[],K=this.animationGroups.slice();for(const d of K){H.push(d.clone(d.name,v));for(const Z of d.animatables)Z.stop()}for(const d of h){const h=v(d.target);h&&(Z.beginAnimation(h,d.fromFrame,d.toFrame,d.loopAnimation,d.speedRatio,d.onAnimationEnd?d.onAnimationEnd:void 0,void 0,!0,void 0,d.onAnimationLoop?d.onAnimationLoop:void 0),Z.stopAnimation(d.target))}return H}populateRootNodes(){this.rootNodes.length=0;for(const Z of this.meshes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.transformNodes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.lights)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.cameras)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z)}addAllAssetsToContainer(Z){if(!Z)return;const h=[],V=new Set;for(h.push(Z);h.length>0;){const Z=h.pop();if(Z instanceof K.c?(Z.Jh&&-1===this.geometries.indexOf(Z.Jh)&&this.geometries.push(Z.Jh),this.meshes.push(Z)):Z instanceof N.d?this.meshes.push(Z):Z instanceof d.d?this.transformNodes.push(Z):Z instanceof D.c?this.lights.push(Z):Z instanceof k.e&&this.cameras.push(Z),Z instanceof a.e){if(Z.material&&-1===this.materials.indexOf(Z.material)){this.materials.push(Z.material);for(const h of Z.material.getActiveTextures())-1===this.textures.indexOf(h)&&this.textures.push(h)}Z.skeleton&&-1===this.skeletons.indexOf(Z.skeleton)&&this.skeletons.push(Z.skeleton),Z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Z.morphTargetManager)&&this.morphTargetManagers.push(Z.morphTargetManager)}for(const v of Z.getChildren())V.has(v)||h.push(v);V.add(Z)}this.populateRootNodes()}_getByTags(Z,h,V){if(void 0===h)return Z;const v=[];for(const A in Z){const H=Z[A];u.d&&u.d.MatchesQuery(H,h)&&(!V||V(H))&&v.push(H)}return v}getMeshesByTags(Z,h){return this._getByTags(this.meshes,Z,h)}getCamerasByTags(Z,h){return this._getByTags(this.cameras,Z,h)}getLightsByTags(Z,h){return this._getByTags(this.lights,Z,h)}getMaterialsByTags(Z,h){return this._getByTags(this.materials,Z,h).concat(this._getByTags(this.multiMaterials,Z,h))}getTransformNodesByTags(Z,h){return this._getByTags(this.transformNodes,Z,h)}}var X=V(11612);class E{constructor(Z){this.byteOffset=0,this.buffer=Z}async loadAsync(Z){const h=await this.buffer.readAsync(this.byteOffset,Z);this._dataView=new DataView(h.buffer,h.byteOffset,h.byteLength),this._dataByteOffset=0}readUint32(){const Z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Z}readUint8Array(Z){const h=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Z);return this._dataByteOffset+=Z,this.byteOffset+=Z,h}readString(Z){return(0,X.i)(this.readUint8Array(Z))}skipBytes(Z){this._dataByteOffset+=Z,this.byteOffset+=Z}}var j=V(13402);const P="Z2xURg",C={name:"Lh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Z=>-1!==Z.indexOf("asset")&&-1!==Z.indexOf("version")||Z.startsWith("data:base64,"+P)||Z.startsWith("data:;base64,"+P)||Z.startsWith("data:application/octet-stream;base64,"+P)||Z.startsWith("data:model/gltf-binary;base64,"+P)};var l,B,S,r=V(11602),L=V(11607);function y(Z,h,V){try{return Promise.resolve(new Uint8Array(Z,h,V))}catch(v){return Promise.reject(v)}}!function(Z){Z[Z.AUTO=0]="AUTO",Z[Z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(l||(l={})),function(Z){Z[Z.NONE=0]="NONE",Z[Z.FIRST=1]="FIRST",Z[Z.ALL=2]="ALL"}(B||(B={})),function(Z){Z[Z.LOADING=0]="LOADING",Z[Z.READY=1]="READY",Z[Z.COMPLETE=2]="COMPLETE"}(S||(S={}));class W{constructor(){this.coordinateSystemMode=l.AUTO,this.animationStartMode=B.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.extensionOptions={}}v(Z){Z&&(this.onParsed=Z.onParsed,this.coordinateSystemMode=Z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Z.loadSkins??this.loadSkins,this.loadMorphTargets=Z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Z.compileMaterials??this.compileMaterials,this.useClipPlane=Z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Z.useRangeRequests??this.useRangeRequests,this.createInstances=Z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Z.customRootNode,this.onMeshLoaded=Z.onMeshLoaded,this.onSkinLoaded=Z.onSkinLoaded,this.onTextureLoaded=Z.onTextureLoaded,this.onMaterialLoaded=Z.onMaterialLoaded,this.onCameraLoaded=Z.onCameraLoaded,this.extensionOptions=Z.extensionOptions??this.extensionOptions)}}class z extends W{constructor(Z){super(),this.onParsedObservable=new v.b,this.onMeshLoadedObservable=new v.b,this.onSkinLoadedObservable=new v.b,this.onTextureLoadedObservable=new v.b,this.onMaterialLoadedObservable=new v.b,this.onCameraLoadedObservable=new v.b,this.onCompleteObservable=new v.b,this.onErrorObservable=new v.b,this.jh=new v.b,this.onExtensionLoadedObservable=new v.b,this.validate=!1,this.onValidatedObservable=new v.b,this._loader=null,this._state=null,this._requests=new Array,this.name=C.name,this.extensions=C.extensions,this.onLoaderStateChangedObservable=new v.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.v(Z)}set onParsed(Z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Z&&(this._onParsedObserver=this.onParsedObservable.add(Z))}set onMeshLoaded(Z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Z))}set onSkinLoaded(Z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((h=>Z(h.node,h.skinnedNode))))}set onTextureLoaded(Z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Z))}set onMaterialLoaded(Z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Z))}set onCameraLoaded(Z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Z))}set onComplete(Z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Z)}set onError(Z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Z)}set onDispose(Z){this._onDisposeObserver&&this.jh.remove(this._onDisposeObserver),this._onDisposeObserver=this.jh.add(Z)}set onExtensionLoaded(Z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Z){this._loggingEnabled!==Z&&(this._loggingEnabled=Z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Z){this._capturePerformanceCounters!==Z&&(this._capturePerformanceCounters=Z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Z of this._requests)Z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.jh.notifyObservers(void 0),this.jh.clear()}loadFile(Z,h,V,H,K,d,a,x){if(ArrayBuffer.isView(h))return this._loadBinary(Z,h,V,H,a,x),null;this._progressCallback=K;const N=h.name||A.Tools.GetFilename(h);if(d){if(this.useRangeRequests){this.validate&&n.b.Warn("glTF validation is not supported when range requests are enabled");const V={abort:()=>{},onCompleteObservable:new v.b},A={readAsync:(V,v)=>new Promise(((A,H)=>{this._loadFile(Z,h,(Z=>{A(new Uint8Array(Z))}),!0,(Z=>{H(Z)}),(Z=>{Z.setRequestHeader("Range",`bytes=${V}-${V+v-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(A)).then((Z=>{V.onCompleteObservable.notifyObservers(V),H(Z)}),a?Z=>a(void 0,Z):void 0),V}return this._loadFile(Z,h,(h=>{this._validate(Z,new Uint8Array(h,0,h.byteLength),V,N),this._unpackBinaryAsync(new E({readAsync:(Z,V)=>y(h,Z,V),byteLength:h.byteLength})).then((Z=>{H(Z)}),a?Z=>a(void 0,Z):void 0)}),!0,a)}return this._loadFile(Z,h,(h=>{try{this._validate(Z,h,V,N),H({json:this._parseJson(h)})}catch{a&&a()}}),!1,a)}_loadBinary(Z,h,V,v,A,H){this._validate(Z,new Uint8Array(h.buffer,h.byteOffset,h.byteLength),V,H),this._unpackBinaryAsync(new E({readAsync:(Z,V)=>function(Z,h,V){try{if(h<0||h>=Z.byteLength)throw new RangeError("Offset is out of range.");if(h+V>Z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Z.buffer,Z.byteOffset+h,V))}catch(v){return Promise.reject(v)}}(h,Z,V),byteLength:h.byteLength})).then((Z=>{v(Z)}),A?Z=>A(void 0,Z):void 0)}importMeshAsync(Z,h,V,v,A,H){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${H||""}`),this._loader=this._getLoader(V),this._loader.importMeshAsync(Z,h,null,V,v,A,H))))}loadAsync(Z,h,V,v,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(h),this._loader.loadAsync(Z,h,V,v,A))))}loadAssetContainerAsync(Z,h,V,v,A){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(h);const H=new q(Z),K=[];this.onMaterialLoadedObservable.add((Z=>{K.push(Z)}));const d=[];this.onTextureLoadedObservable.add((Z=>{d.push(Z)}));const a=[];this.onCameraLoadedObservable.add((Z=>{a.push(Z)}));const n=[];return this.onMeshLoadedObservable.add((Z=>{Z.morphTargetManager&&n.push(Z.morphTargetManager)})),this._loader.importMeshAsync(null,Z,H,h,V,v,A).then((Z=>(Array.prototype.push.apply(H.geometries,Z.geometries),Array.prototype.push.apply(H.meshes,Z.meshes),Array.prototype.push.apply(H.bD,Z.bD),Array.prototype.push.apply(H.skeletons,Z.skeletons),Array.prototype.push.apply(H.animationGroups,Z.animationGroups),Array.prototype.push.apply(H.materials,K),Array.prototype.push.apply(H.textures,d),Array.prototype.push.apply(H.lights,Z.lights),Array.prototype.push.apply(H.transformNodes,Z.transformNodes),Array.prototype.push.apply(H.cameras,a),Array.prototype.push.apply(H.morphTargetManagers,n),H)))}))}canDirectLoad(Z){return C.canDirectLoad(Z)}directLoad(Z,h){if(h.startsWith("base64,"+P)||h.startsWith(";base64,"+P)||h.startsWith("application/octet-stream;base64,"+P)||h.startsWith("model/gltf-binary;base64,"+P)){const V=(0,r.d)(h);return this._validate(Z,new Uint8Array(V,0,V.byteLength)),this._unpackBinaryAsync(new E({readAsync:(Z,h)=>y(V,Z,h),byteLength:V.byteLength}))}return this._validate(Z,h),Promise.resolve({json:this._parseJson(h)})}createPlugin(Z){return new z(Z[C.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Z,h)=>{this.onCompleteObservable.addOnce((()=>{Z()})),this.onErrorObservable.addOnce((Z=>{h(Z)}))}))}_setState(Z){this._state!==Z&&(this._state=Z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(S[this._state]))}_loadFile(Z,h,V,v,A,H){const K=Z._loadFile(h,V,(Z=>{this._onProgress(Z,K)}),!0,v,A,H);return K.onCompleteObservable.add((()=>{K._lengthComputable=!0,K._total=K._loaded})),this._requests.push(K),K}_onProgress(Z,h){if(!this._progressCallback)return;h._lengthComputable=Z.lengthComputable,h._loaded=Z.loaded,h._total=Z.total;let V=!0,v=0,A=0;for(const H of this._requests){if(void 0===H._lengthComputable||void 0===H._loaded||void 0===H._total)return;V=V&&H._lengthComputable,v+=H._loaded,A+=H._total}this._progressCallback({lengthComputable:V,loaded:v,total:V?A:0})}_validate(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),j.b.ValidateAsync(h,V,v,(h=>this.preprocessUrlAsync(V+h).then((h=>Z._loadFileAsync(h,void 0,!0,!0).then((Z=>new Uint8Array(Z,0,Z.byteLength))))))).then((Z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Z),this.onValidatedObservable.clear()}),(Z=>{this._endPerformanceCounter("Validate JSON"),A.Tools.Warn(`Failed to validate: ${Z.message}`),this.onValidatedObservable.clear()})))}_getLoader(Z){const h=Z.json.asset||{};this._log(`Asset version: ${h.version}`),h.minVersion&&this._log(`Asset minimum version: ${h.minVersion}`),h.generator&&this._log(`Asset generator: ${h.generator}`);const V=z._parseVersion(h.version);if(!V)throw new Error("Invalid version: "+h.version);if(void 0!==h.minVersion){const Z=z._parseVersion(h.minVersion);if(!Z)throw new Error("Invalid minimum version: "+h.minVersion);if(z._compareVersion(Z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+h.minVersion)}const v={1:z._CreateGLTF1Loader,2:z._CreateGLTF2Loader}[V.major];if(!v)throw new Error("Unsupported version: "+h.version);return v(this)}_parseJson(Z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Z.length}`);const h=JSON.parse(Z);return this._endPerformanceCounter("Parse JSON"),h}_unpackBinaryAsync(Z){return this._startPerformanceCounter("Unpack Binary"),Z.loadAsync(20).then((()=>{const h=Z.readUint32();if(1179937895!==h)throw new L.j("Unexpected magic: "+h,L.g.GLTFLoaderUnexpectedMagicError);const V=Z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${V}`);const v=Z.readUint32();let A;switch(this.useRangeRequests||v===Z.buffer.byteLength||n.b.Warn(`Length in header does not match actual data length: ${v} != ${Z.buffer.byteLength}`),V){case 1:A=this._unpackBinaryV1Async(Z,v);break;case 2:A=this._unpackBinaryV2Async(Z,v);break;default:throw new Error("Unsupported version: "+V)}return this._endPerformanceCounter("Unpack Binary"),A}))}_unpackBinaryV1Async(Z,h){const V=Z.readUint32(),v=Z.readUint32();if(0!==v)throw new Error(`Unexpected content format: ${v}`);const A=h-Z.byteOffset,H={json:this._parseJson(Z.readString(V)),bin:null};if(0!==A){const h=Z.byteOffset;H.bin={readAsync:(V,v)=>Z.buffer.readAsync(h+V,v),byteLength:A}}return Promise.resolve(H)}_unpackBinaryV2Async(Z,h){const V=1313821514,v=5130562,A=Z.readUint32();if(Z.readUint32()!==V)throw new Error("First chunk format is not JSON");return Z.byteOffset+A===h?Z.loadAsync(A).then((()=>({json:this._parseJson(Z.readString(A)),bin:null}))):Z.loadAsync(A+8).then((()=>{const H={json:this._parseJson(Z.readString(A)),bin:null},K=()=>{const A=Z.readUint32();switch(Z.readUint32()){case V:throw new Error("Unexpected JSON chunk");case v:{const h=Z.byteOffset;H.bin={readAsync:(V,v)=>Z.buffer.readAsync(h+V,v),byteLength:A},Z.skipBytes(A);break}default:Z.skipBytes(A)}return Z.byteOffset!==h?Z.loadAsync(8).then(K):Promise.resolve(H)};return K()}))}static _parseVersion(Z){if("1.0"===Z||"1.0.1"===Z)return{major:1,minor:0};const h=(Z+"").match(/^(\d+)\.(\d+)/);return h?{major:parseInt(h[1]),minor:parseInt(h[2])}:null}static _compareVersion(Z,h){return Z.major>h.major?1:Z.major<h.major?-1:Z.minor>h.minor?1:Z.minor<h.minor?-1:0}_logOpen(Z){this._log(Z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Z){const h=z._logSpaces.substring(0,2*this._logIndentLevel);n.b.Log(`${h}${Z}`)}_logDisabled(Z){}_startPerformanceCounterEnabled(Z){A.Tools.StartPerformanceCounter(Z)}_startPerformanceCounterDisabled(Z){}_endPerformanceCounterEnabled(Z){A.Tools.EndPerformanceCounter(Z)}_endPerformanceCounterDisabled(Z){}}z.IncrementalLoading=!0,z.HomogeneousCoordinates=!1,z._logSpaces="                                ",(0,H.b)(new z)},13402:(Z,h,V)=>{"use strict";V.d(h,{b:()=>K});var v=V(11564);function A(Z,h,V,v){const A={externalResourceFunction:v};return V&&(A.uri="file:"===h?V:h+V),ArrayBuffer.isView(Z)?GLTFValidator.validateBytes(Z,A):GLTFValidator.validateString(Z,A)}function H(){const Z=[];onmessage=h=>{const V=h.data;switch(V.id){case"init":importScripts(V.url);break;case"validate":A(V.data,V.rootUrl,V.fileName,(h=>new Promise(((V,v)=>{const A=Z.length;Z.push({resolve:V,reject:v}),postMessage({id:"getExternalResource",index:A,uri:h})})))).then((Z=>{postMessage({id:"validate.resolve",value:Z})}),(Z=>{postMessage({id:"validate.reject",reason:Z})}));break;case"getExternalResource.resolve":Z[V.index].resolve(V.value);break;case"getExternalResource.reject":Z[V.index].reject(V.reason)}}}class K{static ValidateAsync(Z,h,V,K){return"function"===typeof Worker?new Promise(((d,a)=>{const n=`${A}(${H})()`,x=URL.createObjectURL(new Blob([n],{type:"application/javascript"})),N=new Worker(x),D=Z=>{N.removeEventListener("error",D),N.removeEventListener("message",k),a(Z)},k=Z=>{const h=Z.data;switch(h.id){case"getExternalResource":K(h.uri).then((Z=>{N.postMessage({id:"getExternalResource.resolve",index:h.index,value:Z},[Z.buffer])}),(Z=>{N.postMessage({id:"getExternalResource.reject",index:h.index,reason:Z})}));break;case"validate.resolve":N.removeEventListener("error",D),N.removeEventListener("message",k),d(h.value),N.terminate();break;case"validate.reject":N.removeEventListener("error",D),N.removeEventListener("message",k),a(h.reason),N.terminate()}};if(N.addEventListener("error",D),N.addEventListener("message",k),N.postMessage({id:"init",url:v.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Z)){const v=Z.slice();N.postMessage({id:"validate",data:v,rootUrl:h,fileName:V},[v.buffer])}else N.postMessage({id:"validate",data:Z,rootUrl:h,fileName:V})})):(this._LoadScriptPromise||(this._LoadScriptPromise=v.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>A(Z,h,V,K))))}}K.Configuration={url:`${v.Tools._DefaultCdnUrl}/gltf_validator.js`}},13997:(Z,h,V)=>{"use strict";V.d(h,{c:()=>C});var v=V(11720),A=V(11723),H=V(11769),K=V(11729),d=V(12115),a=V(12053),n=V(11805),x=V(11983),N=V(11691),D=V(11647);V(13154),V(13067),V(13079),V(13073),V(13086),V(13093),V(13095);const k="imageProcessingCompatibility",u="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";D.c.IncludesShadersStore[k]||(D.c.IncludesShadersStore[k]=u);const F="skyPixelShader",b="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";D.c.ShadersStore[F]||(D.c.ShadersStore[F]=b);V(13164),V(13100),V(13103),V(13114),V(13112);const o="skyVertexShader",q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";D.c.ShadersStore[o]||(D.c.ShadersStore[o]=q);var X=V(12050),E=V(12099),j=V(12096);class P extends d.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class C extends a.b{constructor(Z,h){super(Z,h),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new K.Ch(0,100,0),this.useSunPosition=!1,this.cameraOffset=K.Ch.Zero(),this.up=K.Ch.Up(),this.dithering=!1,this._cameraPosition=K.Ch.Zero(),this._skyOrientation=new K.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Z,h){const V=h._drawWrapper;if(this.isFrozen&&V.effect&&V._wasPreviouslyReady)return!0;h.materialDefines||(h.materialDefines=new P);const v=h.materialDefines,A=this.CZ();if(this._isReadyForSubMesh(h))return!0;if((0,j.T)(Z,A,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,v),(0,j.I)(Z,v,!0,!1),v.IMAGEPROCESSINGPOSTPROCESS!==A.imageProcessingConfiguration.applyByPostProcess&&v.markAsMiscDirty(),v.DITHER!==this.dithering&&v.markAsMiscDirty(),v.isDirty){v.markAsProcessed(),A.resetCachedMaterial();const Z=new X.c;v.FOG&&Z.addFallback(1,"FOG"),v.IMAGEPROCESSINGPOSTPROCESS=A.imageProcessingConfiguration.applyByPostProcess,v.DITHER=this.dithering;const V=[n.f.PositionKind];v.VERTEXCOLOR&&V.push(n.f.ColorKind);const H="sky",K=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.c)(K);const d=v.toString();h.setEffect(A.getEngine().createEffect(H,V,K,[],d,Z,this.onCompiled,this.onError),v,this._materialContext)}return!(!h.effect||!h.effect.isReady())&&(v._renderId=A.getRenderId(),V._wasPreviouslyReady=!0,!0)}bindForSubMesh(Z,h,V){const v=this.CZ(),A=V.materialDefines;if(!A)return;const H=V.effect;if(!H)return;this._activeEffect=H,this.bindOnlyWorldMatrix(Z),this._activeEffect.setMatrix("viewProjection",v.getTransformMatrix()),this._mustRebind(v,H,V)&&((0,E.e)(H,this,v),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,j.k)(A,H,v)),v.fogEnabled&&h.applyFog&&v.fogMode!==x.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",v.getViewMatrix()),(0,j.d)(v,h,this._activeEffect);const d=v.activeCamera;if(d){const Z=d.getWorldMatrix();this._cameraPosition.x=Z.m[12],this._cameraPosition.y=Z.m[13],this._cameraPosition.z=Z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Z=Math.PI*(this.inclination-.5),h=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(h)*Math.cos(Z),this.sunPosition.y=this.distance*Math.sin(-Z),this.sunPosition.z=this.distance*Math.sin(h)*Math.cos(Z),K.Quaternion.FromUnitVectorsToRef(K.Ch.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(h,this._activeEffect,V)}getAnimatables(){return[]}dispose(Z){super.dispose(Z)}clone(Z){return H.b.Clone((()=>new C(Z,this.CZ())),this)}serialize(){const Z=super.serialize();return Z.customType="BABYLON.SkyMaterial",Z}getClassName(){return"SkyMaterial"}static Parse(Z,h,V){return H.b.Parse((()=>new C(Z.name,h)),Z,h,V)}}(0,v.b)([(0,A.I)()],C.prototype,"luminance",void 0),(0,v.b)([(0,A.I)()],C.prototype,"turbidity",void 0),(0,v.b)([(0,A.I)()],C.prototype,"rayleigh",void 0),(0,v.b)([(0,A.I)()],C.prototype,"mieCoefficient",void 0),(0,v.b)([(0,A.I)()],C.prototype,"mieDirectionalG",void 0),(0,v.b)([(0,A.I)()],C.prototype,"distance",void 0),(0,v.b)([(0,A.I)()],C.prototype,"inclination",void 0),(0,v.b)([(0,A.I)()],C.prototype,"azimuth",void 0),(0,v.b)([(0,A.G)()],C.prototype,"sunPosition",void 0),(0,v.b)([(0,A.I)()],C.prototype,"useSunPosition",void 0),(0,v.b)([(0,A.G)()],C.prototype,"cameraOffset",void 0),(0,v.b)([(0,A.G)()],C.prototype,"up",void 0),(0,v.b)([(0,A.I)()],C.prototype,"dithering",void 0),(0,N.i)("BABYLON.SkyMaterial",C)},12440:(Z,h,V)=>{"use strict";function v(Z,h){h.headers=Z.headers||{},h.statusMessage=Z.statusText,h.statusCode=Z.status,h.data=Z.response}function A(Z,h,V){return new Promise((function(A,H){V=V||{};var K,d,a,n=new XMLHttpRequest,x=V.body,N=V.headers||{};for(K in V.timeout&&(n.timeout=V.timeout),n.ontimeout=n.onerror=function(Z){Z.timeout="timeout"==Z.type,H(Z)},n.open(Z,h.href||h),n.onload=function(){for(a=n.getAllResponseHeaders().trim().split(/[\r\n]+/),v(n,n);d=a.shift();)d=d.split(": "),n.headers[d.shift().toLowerCase()]=d.join(": ");if((d=n.headers["content-type"])&&~d.indexOf("application/json"))try{n.data=JSON.parse(n.data,V.reviver)}catch(Z){return v(n,Z),H(Z)}(n.status>=400?H:A)(n)},typeof FormData<"u"&&x instanceof FormData||x&&"object"==typeof x&&(N["content-type"]="application/json",x=JSON.stringify(x)),n.withCredentials=!!V.withCredentials,N)n.setRequestHeader(K,N[K]);n.send(x)}))}V.r(h),V.d(h,{del:()=>a,get:()=>H,patch:()=>d,post:()=>K,put:()=>n,send:()=>A});var H=A.bind(A,"GET"),K=A.bind(A,"POST"),d=A.bind(A,"PATCH"),a=A.bind(A,"DELETE"),n=A.bind(A,"PUT")},14120:(Z,h,V)=>{"use strict";V.d(h,{b:()=>N});const v=.5*(Math.sqrt(3)-1),A=(3-Math.sqrt(3))/6,H=1/3,K=1/6,d=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20,n=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),x=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const N=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const h="function"==typeof Z?Z:function(Z){let h=0,V=0,v=0,A=1;const H=function(){let Z=4022871197;return function(h){h=h.toString();for(let V=0;V<h.length;V++){Z+=h.charCodeAt(V);let v=.02519603282416938*Z;Z=v>>>0,v-=Z,v*=Z,Z=v>>>0,v-=Z,Z+=4294967296*v}return 2.3283064365386963e-10*(Z>>>0)}}();h=H(" "),V=H(" "),v=H(" "),h-=H(Z),h<0&&(h+=1);V-=H(Z),V<0&&(V+=1);v-=H(Z),v<0&&(v+=1);return function(){const Z=2091639*h+2.3283064365386963e-10*A;return h=V,V=v,v=Z-(A=0|Z)}}(Z);this.p=function(Z){const h=new Uint8Array(256);for(let V=0;V<256;V++)h[V]=V;for(let V=0;V<255;V++){const v=V+~~(Z()*(256-V)),A=h[V];h[V]=h[v],h[v]=A}return h}(h),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let V=0;V<512;V++)this.perm[V]=this.p[255&V],this.permMod12[V]=this.perm[V]%12}noise2D(Z,h){const V=this.permMod12,H=this.perm;let K=0,d=0,a=0;const x=(Z+h)*v,N=Math.floor(Z+x),D=Math.floor(h+x),k=(N+D)*A,u=Z-(N-k),F=h-(D-k);let b,o;u>F?(b=1,o=0):(b=0,o=1);const q=u-b+A,X=F-o+A,E=u-1+2*A,j=F-1+2*A,P=255&N,C=255&D;let l=.5-u*u-F*F;if(l>=0){const Z=3*V[P+H[C]];l*=l,K=l*l*(n[Z]*u+n[Z+1]*F)}let B=.5-q*q-X*X;if(B>=0){const Z=3*V[P+b+H[C+o]];B*=B,d=B*B*(n[Z]*q+n[Z+1]*X)}let S=.5-E*E-j*j;if(S>=0){const Z=3*V[P+1+H[C+1]];S*=S,a=S*S*(n[Z]*E+n[Z+1]*j)}return 70*(K+d+a)}noise3D(Z,h,V){const v=this.permMod12,A=this.perm;let d,a,x,N;const D=(Z+h+V)*H,k=Math.floor(Z+D),u=Math.floor(h+D),F=Math.floor(V+D),b=(k+u+F)*K,o=Z-(k-b),q=h-(u-b),X=V-(F-b);let E,j,P,C,l,B;o>=q?q>=X?(E=1,j=0,P=0,C=1,l=1,B=0):o>=X?(E=1,j=0,P=0,C=1,l=0,B=1):(E=0,j=0,P=1,C=1,l=0,B=1):q<X?(E=0,j=0,P=1,C=0,l=1,B=1):o<X?(E=0,j=1,P=0,C=0,l=1,B=1):(E=0,j=1,P=0,C=1,l=1,B=0);const S=o-E+K,r=q-j+K,L=X-P+K,y=o-C+2*K,W=q-l+2*K,z=X-B+2*K,m=o-1+.5,g=q-1+.5,I=X-1+.5,e=255&k,U=255&u,R=255&F;let Q=.6-o*o-q*q-X*X;if(Q<0)d=0;else{const Z=3*v[e+A[U+A[R]]];Q*=Q,d=Q*Q*(n[Z]*o+n[Z+1]*q+n[Z+2]*X)}let w=.6-S*S-r*r-L*L;if(w<0)a=0;else{const Z=3*v[e+E+A[U+j+A[R+P]]];w*=w,a=w*w*(n[Z]*S+n[Z+1]*r+n[Z+2]*L)}let T=.6-y*y-W*W-z*z;if(T<0)x=0;else{const Z=3*v[e+C+A[U+l+A[R+B]]];T*=T,x=T*T*(n[Z]*y+n[Z+1]*W+n[Z+2]*z)}let t=.6-m*m-g*g-I*I;if(t<0)N=0;else{const Z=3*v[e+1+A[U+1+A[R+1]]];t*=t,N=t*t*(n[Z]*m+n[Z+1]*g+n[Z+2]*I)}return 32*(d+a+x+N)}noise4D(Z,h,V,v){const A=this.perm;let H,K,n,N,D;const k=(Z+h+V+v)*d,u=Math.floor(Z+k),F=Math.floor(h+k),b=Math.floor(V+k),o=Math.floor(v+k),q=(u+F+b+o)*a,X=Z-(u-q),E=h-(F-q),j=V-(b-q),P=v-(o-q);let C=0,l=0,B=0,S=0;X>E?C++:l++,X>j?C++:B++,X>P?C++:S++,E>j?l++:B++,E>P?l++:S++,j>P?B++:S++;const r=C>=3?1:0,L=l>=3?1:0,y=B>=3?1:0,W=S>=3?1:0,z=C>=2?1:0,m=l>=2?1:0,g=B>=2?1:0,I=S>=2?1:0,e=C>=1?1:0,U=l>=1?1:0,R=B>=1?1:0,Q=S>=1?1:0,w=X-r+a,T=E-L+a,t=j-y+a,c=P-W+a,i=X-z+2*a,M=E-m+2*a,O=j-g+2*a,s=P-I+2*a,J=X-e+3*a,f=E-U+3*a,p=j-R+3*a,Y=P-Q+3*a,G=X-1+4*a,ZZ=E-1+4*a,hZ=j-1+4*a,VZ=P-1+4*a,vZ=255&u,AZ=255&F,HZ=255&b,KZ=255&o;let dZ=.6-X*X-E*E-j*j-P*P;if(dZ<0)H=0;else{const Z=A[vZ+A[AZ+A[HZ+A[KZ]]]]%32*4;dZ*=dZ,H=dZ*dZ*(x[Z]*X+x[Z+1]*E+x[Z+2]*j+x[Z+3]*P)}let aZ=.6-w*w-T*T-t*t-c*c;if(aZ<0)K=0;else{const Z=A[vZ+r+A[AZ+L+A[HZ+y+A[KZ+W]]]]%32*4;aZ*=aZ,K=aZ*aZ*(x[Z]*w+x[Z+1]*T+x[Z+2]*t+x[Z+3]*c)}let nZ=.6-i*i-M*M-O*O-s*s;if(nZ<0)n=0;else{const Z=A[vZ+z+A[AZ+m+A[HZ+g+A[KZ+I]]]]%32*4;nZ*=nZ,n=nZ*nZ*(x[Z]*i+x[Z+1]*M+x[Z+2]*O+x[Z+3]*s)}let xZ=.6-J*J-f*f-p*p-Y*Y;if(xZ<0)N=0;else{const Z=A[vZ+e+A[AZ+U+A[HZ+R+A[KZ+Q]]]]%32*4;xZ*=xZ,N=xZ*xZ*(x[Z]*J+x[Z+1]*f+x[Z+2]*p+x[Z+3]*Y)}let NZ=.6-G*G-ZZ*ZZ-hZ*hZ-VZ*VZ;if(NZ<0)D=0;else{const Z=A[vZ+1+A[AZ+1+A[HZ+1+A[KZ+1]]]]%32*4;NZ*=NZ,D=NZ*NZ*(x[Z]*G+x[Z+1]*ZZ+x[Z+2]*hZ+x[Z+3]*VZ)}return 27*(H+K+n+N+D)}}}}]);