/*! For license information please see v4lu1n.32.d6c30b55.chunk.js.LICENSE.txt */
(self.fwuvyyymhp8=self.fwuvyyymhp8||[]).push([[32],{14316:(N,U,V)=>{"use strict";var A=V(14321),t=V(14330),n=V(14334);V.g.__TYPEDARRAY_POOL||(V.g.__TYPEDARRAY_POOL={UINT8:t([32,0]),UINT16:t([32,0]),UINT32:t([32,0]),INT8:t([32,0]),INT16:t([32,0]),INT32:t([32,0]),FLOAT:t([32,0]),DOUBLE:t([32,0]),DATA:t([32,0]),UINT8C:t([32,0]),BUFFER:t([32,0])});var q="undefined"!==typeof Uint8ClampedArray,i=V.g.__TYPEDARRAY_POOL;i.UINT8C||(i.UINT8C=t([32,0])),i.BUFFER||(i.BUFFER=t([32,0]));var z=i.DATA,S=i.BUFFER;function E(N){if(N){var U=N.length||N.byteLength,V=A.log2(U);z[V].push(N)}}function p(N){N=A.nextPow2(N);var U=A.log2(N),V=z[U];return V.length>0?V.pop():new ArrayBuffer(N)}function k(N){return new Uint8Array(p(N),0,N)}function B(N){return new Uint16Array(p(2*N),0,N)}function C(N){return new Uint32Array(p(4*N),0,N)}function x(N){return new Int8Array(p(N),0,N)}function J(N){return new Int16Array(p(2*N),0,N)}function d(N){return new Int32Array(p(4*N),0,N)}function r(N){return new Float32Array(p(4*N),0,N)}function v(N){return new Float64Array(p(8*N),0,N)}function h(N){return q?new Uint8ClampedArray(p(N),0,N):k(N)}function c(N){return new DataView(p(N),0,N)}U.free=function(N){if(n(N))S[A.log2(N.length)].push(N);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(N)&&(N=N.buffer),!N)return;var U=N.length||N.byteLength,V=0|A.log2(U);z[V].push(N)}},U.freeUint8=U.freeUint16=U.freeUint32=U.freeInt8=U.freeInt16=U.freeInt32=U.freeFloat32=U.freeFloat=U.freeFloat64=U.freeDouble=U.freeUint8Clamped=U.freeDataView=function(N){E(N.buffer)},U.freeArrayBuffer=E,U.freeBuffer=function(N){S[A.log2(N.length)].push(N)},U.malloc=function(N,U){if(void 0===U||"arraybuffer"===U)return p(N);switch(U){case"uint8":return k(N);case"uint16":return B(N);case"uint32":return C(N);case"int8":return x(N);case"int16":return J(N);case"int32":return d(N);case"float":case"float32":return r(N);case"double":case"float64":return v(N);case"uint8_clamped":return h(N);case"buffer":throw"Buffer not supported";case"data":case"dataview":return c(N);default:return null}return null},U.mallocArrayBuffer=p,U.mallocUint8=k,U.mallocUint16=B,U.mallocUint32=C,U.mallocInt8=x,U.mallocInt16=J,U.mallocInt32=d,U.mallocFloat32=U.mallocFloat=r,U.mallocFloat64=U.mallocDouble=v,U.mallocUint8Clamped=h,U.mallocDataView=c,U.clearCache=function(){for(var N=0;N<32;++N)i.UINT8[N].length=0,i.UINT16[N].length=0,i.UINT32[N].length=0,i.INT8[N].length=0,i.INT16[N].length=0,i.INT32[N].length=0,i.FLOAT[N].length=0,i.DOUBLE[N].length=0,i.UINT8C[N].length=0,z[N].length=0,S[N].length=0}},14407:(N,U,V)=>{N.exports=t;var A=V(13163);function t(N,U){if(!(this instanceof t))return new t(N,U);var V=A.create();A.add(V,N,U),this.base=A.min(A.create(),N,V),this.NE=A.clone(U),this.max=A.max(A.create(),N,V),this.mag=A.length(this.NE)}var n=t.prototype;n.width=function(){return this.NE[0]},n.height=function(){return this.NE[1]},n.depth=function(){return this.NE[2]},n.x0=function(){return this.base[0]},n.y0=function(){return this.base[1]},n.z0=function(){return this.base[2]},n.x1=function(){return this.max[0]},n.y1=function(){return this.max[1]},n.z1=function(){return this.max[2]},n.translate=function(N){return A.add(this.max,this.max,N),A.add(this.base,this.base,N),this},n.setPosition=function(N){return A.add(this.max,N,this.NE),A.j(this.base,N),this},n.expand=function(N){var U=A.create(),V=A.create();return A.max(U,N.max,this.max),A.min(V,N.base,this.base),A.xU(U,U,V),new t(V,U)},n.intersects=function(N){return!(N.base[0]>this.max[0])&&(!(N.base[1]>this.max[1])&&(!(N.base[2]>this.max[2])&&(!(N.max[0]<this.base[0])&&(!(N.max[1]<this.base[1])&&!(N.max[2]<this.base[2])))))},n.touches=function(N){var U=this.union(N);return null!==U&&(0==U.width()||0==U.height()||0==U.depth())},n.union=function(N){if(!this.intersects(N))return null;var U=Math.max(N.base[0],this.base[0]),V=Math.max(N.base[1],this.base[1]),A=Math.max(N.base[2],this.base[2]);return new t([U,V,A],[Math.min(N.max[0],this.max[0])-U,Math.min(N.max[1],this.max[1])-V,Math.min(N.max[2],this.max[2])-A])}},14321:(N,U)=>{"use strict";function V(N){var U=32;return(N&=-N)&&U--,65535&N&&(U-=16),16711935&N&&(U-=8),252645135&N&&(U-=4),858993459&N&&(U-=2),1431655765&N&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(N){return(N>0)-(N<0)},U.abs=function(N){var U=N>>31;return(N^U)-U},U.min=function(N,U){return U^(N^U)&-(N<U)},U.max=function(N,U){return N^(N^U)&-(N<U)},U.isPow2=function(N){return!(N&N-1)&&!!N},U.log2=function(N){var U,V;return U=(N>65535)<<4,U|=V=((N>>>=U)>255)<<3,U|=V=((N>>>=V)>15)<<2,(U|=V=((N>>>=V)>3)<<1)|(N>>>=V)>>1},U.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},U.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},U.countTrailingZeros=V,U.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},U.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},U.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var A=new Array(256);!function(N){for(var U=0;U<256;++U){var V=U,A=U,t=7;for(V>>>=1;V;V>>>=1)A<<=1,A|=1&V,--t;N[U]=A<<t&255}}(A),U.reverse=function(N){return A[255&N]<<24|A[N>>>8&255]<<16|A[N>>>16&255]<<8|A[N>>>24&255]},U.interleave2=function(N,U){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(N,U){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>U&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},U.interleave3=function(N,U,V){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<2},U.deinterleave3=function(N,U){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>U&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},U.nextCombination=function(N){var U=N|N-1;return U+1|(~U&-~U)-1>>>V(N)+1}},14309:(N,U,V)=>{"use strict";N.exports=function(N,U,V){switch(arguments.length){case 1:return A=[],S(t=N,t,E,!0),A;case 2:return"function"===typeof U?S(N,N,U,!0):function(N,U){return A=[],S(N,U,E,!1),A}(N,U);case 3:return S(N,U,V,!1);default:throw new Error("box-intersect: Invalid arguments")}var t};var A,t=V(14316),n=V(14336),q=V(14346);function i(N,U){for(var V=0;V<N;++V)if(!(U[V]<=U[V+N]))return!0;return!1}function z(N,U,V,A){for(var t=0,n=0,q=0,z=N.length;q<z;++q){var S=N[q];if(!i(U,S)){for(var E=0;E<2*U;++E)V[t++]=S[E];A[n++]=q}}return n}function S(N,U,V,A){var i=N.length,S=U.length;if(!(i<=0||S<=0)){var E=N[0].length>>>1;if(!(E<=0)){var p,k=t.mallocDouble(2*E*i),B=t.mallocInt32(i);if((i=z(N,E,k,B))>0){if(1===E&&A)n.init(i),p=n.sweepComplete(E,V,0,i,k,B,0,i,k,B);else{var C=t.mallocDouble(2*E*S),x=t.mallocInt32(S);(S=z(U,E,C,x))>0&&(n.init(i+S),p=1===E?n.sweepBipartite(E,V,0,i,k,B,0,S,C,x):q(E,V,A,i,k,B,S,C,x),t.free(C),t.free(x))}t.free(k),t.free(B)}return p}}}function E(N,U){A.push([N,U])}},14353:(N,U)=>{"use strict";var V="d",A="ax",t="fp",n="es",q="rs",i="re",z="rb",S="bs",E="be",p="bb",k=[V,A,"vv",q,i,z,"ri",S,E,p,"bi"];function B(N){var U="bruteForce"+(N?"Full":"Partial"),A=[],q=k.slice();N||q.splice(3,0,t);var i=["function "+U+"("+q.join()+"){"];function z(U,t){var q=function(N,U,A){var t="bruteForce"+(N?"Red":"Blue")+(U?"Flip":"")+(A?"Full":""),q=["function ",t,"(",k.join(),"){","var ",n,"=2*",V,";"],i="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",z="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(A?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return N?q.push(i,"Q",":",z):q.push(z,"Q",":",i),A?q.push("if(y1<x0||x1<y0)continue;"):U?q.push("if(y0<=x0||x1<y0)continue;"):q.push("if(y0<x0||x1<y0)continue;"),q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),U?q.push("yi,xi"):q.push("xi,yi"),q.push(");if(rv!==void 0)return rv;}}}"),{name:t,code:q.join("")}}(U,t,N);A.push(q.code),i.push("return "+q.name+"("+k.join()+");")}i.push("if(re-rs>be-bs){"),N?(z(!0,!1),i.push("}else{"),z(!1,!1)):(i.push("if(fp){"),z(!0,!0),i.push("}else{"),z(!0,!1),i.push("}}else{if(fp){"),z(!1,!0),i.push("}else{"),z(!1,!1),i.push("}")),i.push("}}return "+U);var S=A.join("")+i.join("");return new Function(S)()}U.partial=B(!1),U.full=B(!0)},14346:(N,U,V)=>{"use strict";N.exports=function(N,U,V,n,E,a,mN,w,X){!function(N,U){var V=8*t.log2(U+1)*(N+1)|0,n=t.nextPow2(h*V);H.length<n&&(A.free(H),H=A.mallocInt32(n));var q=t.nextPow2(c*V);Y.length<q&&(A.free(Y),Y=A.mallocDouble(q))}(N,n+mN);var e,Q=0,u=2*N;W(Q++,0,0,n,0,mN,V?16:0,-1/0,1/0),V||W(Q++,0,0,mN,0,n,1,-1/0,1/0);for(;Q>0;){var L=(Q-=1)*h,I=H[L],o=H[L+1],R=H[L+2],D=H[L+3],G=H[L+4],g=H[L+5],l=Q*c,K=Y[l],j=Y[l+1],F=1&g,P=!!(16&g),T=E,f=a,O=w,Z=X;if(F&&(T=w,f=X,O=E,Z=a),!(2&g&&o>=(R=J(N,I,o,R,T,f,j)))&&!(4&g&&(o=d(N,I,o,R,T,f,K))>=R)){var b=R-o,y=G-D;if(P){if(N*b*(b+y)<B){if(void 0!==(e=z.scanComplete(N,I,U,o,R,T,f,D,G,O,Z)))return e;continue}}else{if(N*Math.min(b,y)<p){if(void 0!==(e=q(N,I,U,F,o,R,T,f,D,G,O,Z)))return e;continue}if(N*b*y<k){if(void 0!==(e=z.scanBipartite(N,I,U,F,o,R,T,f,D,G,O,Z)))return e;continue}}var NN=C(N,I,o,R,T,f,K,j);if(o<NN)if(N*(NN-o)<p){if(void 0!==(e=i(N,I+1,U,o,NN,T,f,D,G,O,Z)))return e}else if(I===N-2){if(void 0!==(e=F?z.sweepBipartite(N,U,D,G,O,Z,o,NN,T,f):z.sweepBipartite(N,U,o,NN,T,f,D,G,O,Z)))return e}else W(Q++,I+1,o,NN,D,G,F,-1/0,1/0),W(Q++,I+1,D,G,o,NN,1^F,-1/0,1/0);if(NN<R){var UN=S(N,I,D,G,O,Z),VN=O[u*UN+I],AN=x(N,I,UN,G,O,Z,VN);if(AN<G&&W(Q++,I,NN,R,AN,G,(4|F)+(P?16:0),VN,j),D<UN&&W(Q++,I,NN,R,D,UN,(2|F)+(P?16:0),K,VN),UN+1===AN){if(void 0!==(e=P?M(N,I,U,NN,R,T,f,UN,O,Z[UN]):s(N,I,U,F,NN,R,T,f,UN,O,Z[UN])))return e}else if(UN<AN){var tN;if(P){if(NN<(tN=r(N,I,NN,R,T,f,VN))){var nN=x(N,I,NN,tN,T,f,VN);if(I===N-2){if(NN<nN&&void 0!==(e=z.sweepComplete(N,U,NN,nN,T,f,UN,AN,O,Z)))return e;if(nN<tN&&void 0!==(e=z.sweepBipartite(N,U,nN,tN,T,f,UN,AN,O,Z)))return e}else NN<nN&&W(Q++,I+1,NN,nN,UN,AN,16,-1/0,1/0),nN<tN&&(W(Q++,I+1,nN,tN,UN,AN,0,-1/0,1/0),W(Q++,I+1,UN,AN,nN,tN,1,-1/0,1/0))}}else NN<(tN=F?v(N,I,NN,R,T,f,VN):r(N,I,NN,R,T,f,VN))&&(I===N-2?e=F?z.sweepBipartite(N,U,UN,AN,O,Z,NN,tN,T,f):z.sweepBipartite(N,U,NN,tN,T,f,UN,AN,O,Z):(W(Q++,I+1,NN,tN,UN,AN,F,-1/0,1/0),W(Q++,I+1,UN,AN,NN,tN,1^F,-1/0,1/0)))}}}}};var A=V(14316),t=V(14321),n=V(14353),q=n.partial,i=n.full,z=V(14336),S=V(14358),E=V(14364),p=128,k=1<<22,B=1<<22,C=E("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),x=E("lo===p0",["p0"]),J=E("lo<p0",["p0"]),d=E("hi<=p0",["p0"]),r=E("lo<=p0&&p0<=hi",["p0"]),v=E("lo<p0&&p0<=hi",["p0"]),h=6,c=2,H=A.mallocInt32(1024),Y=A.mallocDouble(1024);function W(N,U,V,A,t,n,q,i,z){var S=h*N;H[S]=U,H[S+1]=V,H[S+2]=A,H[S+3]=t,H[S+4]=n,H[S+5]=q;var E=c*N;Y[E]=i,Y[E+1]=z}function s(N,U,V,A,t,n,q,i,z,S,E){var p=2*N,k=z*p,B=S[k+U];N:for(var C=t,x=t*p;C<n;++C,x+=p){var J=q[x+U],d=q[x+U+N];if(!(B<J||d<B)&&(!A||B!==J)){for(var r,v=i[C],h=U+1;h<N;++h){J=q[x+h],d=q[x+h+N];var c=S[k+h],H=S[k+h+N];if(d<c||H<J)continue N}if(void 0!==(r=A?V(E,v):V(v,E)))return r}}}function M(N,U,V,A,t,n,q,i,z,S){var E=2*N,p=i*E,k=z[p+U];N:for(var B=A,C=A*E;B<t;++B,C+=E){var x=q[B];if(x!==S){var J=n[C+U],d=n[C+U+N];if(!(k<J||d<k)){for(var r=U+1;r<N;++r){J=n[C+r],d=n[C+r+N];var v=z[p+r],h=z[p+r+N];if(d<v||h<J)continue N}var c=V(x,S);if(void 0!==c)return c}}}}},14358:(N,U,V)=>{"use strict";N.exports=function(N,U,V,q,i,z){if(q<=V+1)return V;var S=V,E=q,p=q+V>>>1,k=2*N,B=p,C=i[k*p+U];for(;S<E;){if(E-S<t){n(N,U,S,E,i,z),C=i[k*p+U];break}var x=E-S,J=Math.random()*x+S|0,d=i[k*J+U],r=Math.random()*x+S|0,v=i[k*r+U],h=Math.random()*x+S|0,c=i[k*h+U];d<=v?c>=v?(B=r,C=v):d>=c?(B=J,C=d):(B=h,C=c):v>=c?(B=r,C=v):c>=d?(B=J,C=d):(B=h,C=c);for(var H=k*(E-1),Y=k*B,W=0;W<k;++W,++H,++Y){var s=i[H];i[H]=i[Y],i[Y]=s}var M=z[E-1];z[E-1]=z[B],z[B]=M;for(H=k*(E-1),Y=k*(B=A(N,U,S,E-1,i,z,C)),W=0;W<k;++W,++H,++Y){s=i[H];i[H]=i[Y],i[Y]=s}M=z[E-1];if(z[E-1]=z[B],z[B]=M,p<B){for(E=B-1;S<E&&i[k*(E-1)+U]===C;)E-=1;E+=1}else{if(!(B<p))break;for(S=B+1;S<E&&i[k*S+U]===C;)S+=1}}return A(N,U,V,p,i,z,i[k*p+U])};var A=V(14364)("lo<p0",["p0"]),t=8;function n(N,U,V,A,t,n){for(var q=2*N,i=q*(V+1)+U,z=V+1;z<A;++z,i+=q)for(var S=t[i],E=z,p=q*(z-1);E>V&&t[p+U]>S;--E,p-=q){for(var k=p,B=p+q,C=0;C<q;++C,++k,++B){var x=t[k];t[k]=t[B],t[B]=x}var J=n[E];n[E]=n[E-1],n[E-1]=J}}},14364:N=>{"use strict";N.exports=function(N,V){var A="abcdef".split("").concat(V),t=[];N.indexOf("lo")>=0&&t.push("lo=e[k+n]");N.indexOf("hi")>=0&&t.push("hi=e[k+o]");return A.push(U.replace("_",t.join()).replace("$",N)),Function.apply(void 0,A)};var U="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14339:N=>{"use strict";N.exports=function(N,A){A<=4*U?V(0,A-1,N):S(0,A-1,N)};var U=32;function V(N,U,V){for(var A=2*(N+1),t=N+1;t<=U;++t){for(var n=V[A++],q=V[A++],i=t,z=A-2;i-- >N;){var S=V[z-2],E=V[z-1];if(S<n)break;if(S===n&&E<q)break;V[z]=S,V[z+1]=E,z-=2}V[z]=n,V[z+1]=q}}function A(N,U,V){U*=2;var A=V[N*=2],t=V[N+1];V[N]=V[U],V[N+1]=V[U+1],V[U]=A,V[U+1]=t}function t(N,U,V){U*=2,V[N*=2]=V[U],V[N+1]=V[U+1]}function n(N,U,V,A){U*=2,V*=2;var t=A[N*=2],n=A[N+1];A[N]=A[U],A[N+1]=A[U+1],A[U]=A[V],A[U+1]=A[V+1],A[V]=t,A[V+1]=n}function q(N,U,V,A,t){U*=2,t[N*=2]=t[U],t[U]=V,t[N+1]=t[U+1],t[U+1]=A}function i(N,U,V){U*=2;var A=V[N*=2],t=V[U];return!(A<t)&&(A!==t||V[N+1]>V[U+1])}function z(N,U,V,A){var t=A[N*=2];return t<U||t===U&&A[N+1]<V}function S(N,E,p){var k=(E-N+1)/6|0,B=N+k,C=E-k,x=N+E>>1,J=x-k,d=x+k,r=B,v=J,h=x,c=d,H=C,Y=N+1,W=E-1,s=0;i(r,v,p)&&(s=r,r=v,v=s),i(c,H,p)&&(s=c,c=H,H=s),i(r,h,p)&&(s=r,r=h,h=s),i(v,h,p)&&(s=v,v=h,h=s),i(r,c,p)&&(s=r,r=c,c=s),i(h,c,p)&&(s=h,h=c,c=s),i(v,H,p)&&(s=v,v=H,H=s),i(v,h,p)&&(s=v,v=h,h=s),i(c,H,p)&&(s=c,c=H,H=s);for(var M=p[2*v],a=p[2*v+1],mN=p[2*c],w=p[2*c+1],X=2*r,e=2*h,Q=2*H,u=2*B,L=2*x,I=2*C,o=0;o<2;++o){var R=p[X+o],D=p[e+o],G=p[Q+o];p[u+o]=R,p[L+o]=D,p[I+o]=G}t(J,N,p),t(d,E,p);for(var g=Y;g<=W;++g)if(z(g,M,a,p))g!==Y&&A(g,Y,p),++Y;else if(!z(g,mN,w,p))for(;;){if(z(W,mN,w,p)){z(W,M,a,p)?(n(g,Y,W,p),++Y,--W):(A(g,W,p),--W);break}if(--W<g)break}q(N,Y-1,M,a,p),q(E,W+1,mN,w,p),Y-2-N<=U?V(N,Y-2,p):S(N,Y-2,p),E-(W+2)<=U?V(W+2,E,p):S(W+2,E,p),W-Y<=U?V(Y,W,p):S(Y,W,p)}},14336:(N,U,V)=>{"use strict";N.exports={init:function(N){var U=t.nextPow2(N);z.length<U&&(A.free(z),z=A.mallocInt32(U));S.length<U&&(A.free(S),S=A.mallocInt32(U));E.length<U&&(A.free(E),E=A.mallocInt32(U));p.length<U&&(A.free(p),p=A.mallocInt32(U));k.length<U&&(A.free(k),k=A.mallocInt32(U));B.length<U&&(A.free(B),B=A.mallocInt32(U));var V=8*U;C.length<V&&(A.free(C),C=A.mallocDouble(V))},sweepBipartite:function(N,U,V,A,t,i,k,B,d,r){for(var v=0,h=2*N,c=N-1,H=h-1,Y=V;Y<A;++Y){var W=i[Y],s=h*Y;C[v++]=t[s+c],C[v++]=-(W+1),C[v++]=t[s+H],C[v++]=W}for(Y=k;Y<B;++Y){W=r[Y]+q;var M=h*Y;C[v++]=d[M+c],C[v++]=-W,C[v++]=d[M+H],C[v++]=W}var a=v>>>1;n(C,a);var mN=0,w=0;for(Y=0;Y<a;++Y){var X=0|C[2*Y+1];if(X>=q)x(E,p,w--,X=X-q|0);else if(X>=0)x(z,S,mN--,X);else if(X<=-q){X=-X-q|0;for(var e=0;e<mN;++e){if(void 0!==(Q=U(z[e],X)))return Q}J(E,p,w++,X)}else{X=-X-1|0;for(e=0;e<w;++e){var Q;if(void 0!==(Q=U(X,E[e])))return Q}J(z,S,mN++,X)}}},sweepComplete:function(N,U,V,A,t,q,i,d,r,v){for(var h=0,c=2*N,H=N-1,Y=c-1,W=V;W<A;++W){var s=q[W]+1<<1,M=c*W;C[h++]=t[M+H],C[h++]=-s,C[h++]=t[M+Y],C[h++]=s}for(W=i;W<d;++W){s=v[W]+1<<1;var a=c*W;C[h++]=r[a+H],C[h++]=1|-s,C[h++]=r[a+Y],C[h++]=1|s}var mN=h>>>1;n(C,mN);var w=0,X=0,e=0;for(W=0;W<mN;++W){var Q=0|C[2*W+1],u=1&Q;if(W<mN-1&&Q>>1===C[2*W+3]>>1&&(u=2,W+=1),Q<0){for(var L=-(Q>>1)-1,I=0;I<e;++I){if(void 0!==(o=U(k[I],L)))return o}if(0!==u)for(I=0;I<w;++I){if(void 0!==(o=U(z[I],L)))return o}if(1!==u)for(I=0;I<X;++I){var o;if(void 0!==(o=U(E[I],L)))return o}0===u?J(z,S,w++,L):1===u?J(E,p,X++,L):2===u&&J(k,B,e++,L)}else{L=(Q>>1)-1;0===u?x(z,S,w--,L):1===u?x(E,p,X--,L):2===u&&x(k,B,e--,L)}}},scanBipartite:function(N,U,V,A,t,i,E,p,k,B,d,r){var v=0,h=2*N,c=U,H=U+N,Y=1,W=1;A?W=q:Y=q;for(var s=t;s<i;++s){var M=s+Y,a=h*s;C[v++]=E[a+c],C[v++]=-M,C[v++]=E[a+H],C[v++]=M}for(s=k;s<B;++s){M=s+W;var mN=h*s;C[v++]=d[mN+c],C[v++]=-M}var w=v>>>1;n(C,w);var X=0;for(s=0;s<w;++s){var e=0|C[2*s+1];if(e<0){var Q=!1;if((M=-e)>=q?(Q=!A,M-=q):(Q=!!A,M-=1),Q)J(z,S,X++,M);else{var u=r[M],L=h*M,I=d[L+U+1],o=d[L+U+1+N];N:for(var R=0;R<X;++R){var D=z[R],G=h*D;if(!(o<E[G+U+1]||E[G+U+1+N]<I)){for(var g=U+2;g<N;++g)if(d[L+g+N]<E[G+g]||E[G+g+N]<d[L+g])continue N;var l,K=p[D];if(void 0!==(l=A?V(u,K):V(K,u)))return l}}}}else x(z,S,X--,e-Y)}},scanComplete:function(N,U,V,A,t,i,S,E,p,k,B){for(var x=0,J=2*N,d=U,r=U+N,v=A;v<t;++v){var h=v+q,c=J*v;C[x++]=i[c+d],C[x++]=-h,C[x++]=i[c+r],C[x++]=h}for(v=E;v<p;++v){h=v+1;var H=J*v;C[x++]=k[H+d],C[x++]=-h}var Y=x>>>1;n(C,Y);var W=0;for(v=0;v<Y;++v){var s=0|C[2*v+1];if(s<0){if((h=-s)>=q)z[W++]=h-q;else{var M=B[h-=1],a=J*h,mN=k[a+U+1],w=k[a+U+1+N];N:for(var X=0;X<W;++X){var e=z[X],Q=S[e];if(Q===M)break;var u=J*e;if(!(w<i[u+U+1]||i[u+U+1+N]<mN)){for(var L=U+2;L<N;++L)if(k[a+L+N]<i[u+L]||i[u+L+N]<k[a+L])continue N;var I=V(Q,M);if(void 0!==I)return I}}}}else{for(h=s-q,X=W-1;X>=0;--X)if(z[X]===h){for(L=X+1;L<W;++L)z[L-1]=z[L];break}--W}}}};var A=V(14316),t=V(14321),n=V(14339),q=1<<28,i=1024,z=A.mallocInt32(i),S=A.mallocInt32(i),E=A.mallocInt32(i),p=A.mallocInt32(i),k=A.mallocInt32(i),B=A.mallocInt32(i),C=A.mallocDouble(8192);function x(N,U,V,A){var t=U[A],n=N[V-1];N[t]=n,U[n]=t}function J(N,U,V,A){N[V]=A,U[A]=V}},14330:N=>{"use strict";function U(N,V,A){var t=0|N[A];if(t<=0)return[];var n,q=new Array(t);if(A===N.length-1)for(n=0;n<t;++n)q[n]=V;else for(n=0;n<t;++n)q[n]=U(N,V,A+1);return q}N.exports=function(N,V){switch("undefined"===typeof V&&(V=0),typeof N){case"number":if(N>0)return function(N,U){var V,A;for(V=new Array(N),A=0;A<N;++A)V[A]=U;return V}(0|N,V);break;case"object":if("number"===typeof N.length)return U(N,V,0)}return[]}},14288:(N,U,V)=>{N.exports=function(){var N=this;this.components={},this.comps=this.components;var U=this.components,V=1,t={},n=[],q=[],i={timeout:!1,removals:[],multiComps:[]};function z(N,V){var A=U[V],n=t[V],q=n.hash[N];q&&(n.remove(N),A.IV&&(A.multi?(q.forEach((U=>{U&&A.IV(N,U)})),q.length=0):A.IV(N,q)),i.removals.push(n),S())}function S(){i.timeout||(i.timeout=!0,setTimeout(E,1))}function E(){i.timeout=!1,p()}function p(){i.multiComps.length&&function(N){for(var U=0;U<N.length;U++){var{entID:V,data:A}=N[U],t=A.hash[V];if(t){for(var n=0;n<t.length;n++)t[n]||(t.splice(n,1),n--);0===t.length&&(A.remove(V),i.removals.push(A))}}N.length=0}(i.multiComps),i.removals.length&&function(N){for(var U=0;U<N.length;U++){N[U].flush()}N.length=0}(i.removals)}this.xp=t,this._systems=n,this._renderSystems=q,this.AE=function(U){var A=V++;return Array.isArray(U)&&U.forEach((U=>N.Gz(A,U))),A},this.deleteEntity=function(U){return Object.keys(t).forEach((N=>{t[N].hash[U]&&z(U,N)})),N},this.rE=function(N){if(!N)throw new Error("Missing component definition");var V=N.name;if(!V)throw new Error("Component definition must have a name property.");if("string"!==typeof V)throw new Error("Component name must be a string.");if(""===V)throw new Error("Component name must be a non-empty string.");if(t[V])throw new Error(`Component ${V} already exists.`);var i={};return i.name=V,i.multi=!!N.multi,i.order=isNaN(N.order)?99:N.order,i.stateConstructor=N.stateConstructor||null,i.state=N.state||{},i.Li=N.Li||null,i.IV=N.IV||null,i.system=N.system||null,i.gi=N.gi||null,U[V]=i,t[V]=new A,t[V]._pendingMultiCleanup=!1,t[V]._multiCleanupIDs=i.multi?[]:null,i.system&&(n.push(V),n.sort(((N,V)=>U[N].order-U[V].order))),i.gi&&(q.push(V),q.sort(((N,V)=>U[N].order-U[V].order))),V},this.overwriteComponent=function(N,V){var A=U[N];if(!A)throw new Error(`Unknown component: ${N}`);if(!V)throw new Error("Missing component definition");if(A.name!==V.name)throw new Error("Overwriting component must use the same name property.");var i={};i.name=N,i.multi=!!V.multi,i.order=isNaN(V.order)?99:V.order,i.state=V.state||{},i.Li=V.Li||null,i.IV=V.IV||null,i.system=V.system||null,i.gi=V.gi||null,U[N]=i,t[N]._pendingMultiCleanup=!1,t[N]._multiCleanupIDs=i.multi?[]:null;var z=n.indexOf(N);i.system&&z<0&&n.push(N),!i.system&&z>=0&&n.splice(z,1),n.sort(((N,V)=>U[N].order-U[V].order));var S=q.indexOf(N);i.gi&&S<0&&q.push(N),!i.gi&&S>=0&&q.splice(S,1),q.sort(((N,V)=>U[N].order-U[V].order));var E=i.state;return this.RS(N).forEach((N=>{for(var U in E)U in N||(N[U]=E[U]);i.Li&&i.Li(N.Di,N)})),N},this.deleteComponent=function(V){var A=t[V];if(!A)throw new Error(`Unknown component: ${V}`);A.flush(),A.list.forEach((N=>{N&&z(N.Di||N[0].Di,V)}));var i=n.indexOf(V),S=q.indexOf(V);return i>-1&&n.splice(i,1),S>-1&&q.splice(S,1),t[V].dispose(),delete t[V],delete U[V],N},this.Gz=function(N,V,A){var n,q=U[V],i=t[V];if(!i)throw new Error(`Unknown component: ${V}.`);if(i.hash[N]&&!q.multi)throw new Error(`Entity ${N} already has component: ${V}.`);if(q.stateConstructor){if(!(n=new q.stateConstructor).hasOwnProperty("Di"))throw new Error(`Component ${q.name} stateConstructor type does not have property __id`)}else n=Object.assign({},{Di:N},q.state,A);if(n.Di=N,q.multi){var z=i.hash[N];z||(z=[],i.add(N,z)),z.push(n)}else i.add(N,n);return q.Li&&q.Li(N,n),this},this.Zz=function(N,U){var V=t[U];if(!V)throw new Error(`Unknown component: ${U}.`);return!!V.hash[N]},this.jz=function(U,V){if(!t[V])throw new Error(`Unknown component: ${V}.`);return z(U,V),N},this.getState=function(N,U){var V=t[U];if(!V)throw new Error(`Unknown component: ${U}.`);return V.hash[N]},this.RS=function(N){var U=t[N];if(!U)throw new Error(`Unknown component: ${N}.`);return p(),U.list},this.tB=function(N){if(!t[N])throw new Error(`Unknown component: ${N}.`);var U=t[N].hash;return N=>U[N]},this.iB=function(N){if(!t[N])throw new Error(`Unknown component: ${N}.`);var U=t[N].hash;return N=>!!U[N]},this.Vi=function(V){p();for(var A=0;A<n.length;A++){var q=n[A],i=U[q],z=t[q];i.system(V,z.list),p()}return N},this.render=function(V){p();for(var A=0;A<q.length;A++){var n=q[A],i=U[n],z=t[n];i.gi(V,z.list),p()}return N},this.removeMultiComponent=function(V,A,n){var q=U[A],z=t[A];if(!z)throw new Error(`Unknown component: ${A}.`);if(!q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(N,U,V,A){var t=V.hash[N];if(t){var n=t[A];n&&(t[A]=null,U.IV&&U.IV(N,n),i.multiComps.push({entID:N,data:V}),S())}}(V,q,z,n),N}};var A=V(14290)},14290:N=>{function U(N,U){var V=N._map[U];if(delete N.hash[U],delete N._map[U],V===N.list.length-1)N.list.pop();else{var A=N.list.pop();if(N.list[V]=A,null===A||null===A[0]){var t=N.list.length;for(var n in N._map)if(N._map[n]===t)return void(N._map[n]=V)}else{var q=A.Di||A[0].Di;N._map[q]=V}}}N.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(N,U){if("number"===typeof this._map[N]){var V=this._map[N];this.hash[N]=U,this.list[V]=U}else this._map[N]=this.list.length,this.hash[N]=U,this.list.push(U)}remove(N){var U=this._map[N];this.hash[N]=null,this.list[U]=null,this._pendingRemovals.push(N)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var N=0;N<this._pendingRemovals.length;N++){var V=this._pendingRemovals[N];null===this.hash[V]&&U(this,V)}this._pendingRemovals.length=0}}},14258:N=>{"use strict";var U,V="object"===typeof Reflect?Reflect:null,A=function(N,U,V){return Function.prototype.apply.call(N,U,V)};U=V&&"function"===typeof V.ownKeys?V.ownKeys:Object.getOwnPropertySymbols?function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:function(N){return Object.getOwnPropertyNames(N)};var t=Number.isNaN||function(N){return N!==N};function n(){n.init.call(this)}N.exports=n,N.exports.once=function(N,U){return new Promise((function(V,A){function t(V){N.removeListener(U,n),A(V)}function n(){"function"===typeof N.removeListener&&N.removeListener("error",t),V([].slice.call(arguments))}x(N,U,n,{once:!0}),"error"!==U&&function(N,U,V){"function"===typeof N.on&&x(N,"error",U,V)}(N,t,{once:!0})}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var q=10;function i(N){if("function"!==typeof N)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}function z(N){return void 0===N._maxListeners?n.defaultMaxListeners:N._maxListeners}function S(N,U,V,A){var t,n,q,S;if(i(V),void 0===(n=N._events)?(n=N._events=Object.create(null),N._eventsCount=0):(void 0!==n.newListener&&(N.emit("newListener",U,V.listener?V.listener:V),n=N._events),q=n[U]),void 0===q)q=n[U]=V,++N._eventsCount;else if("function"===typeof q?q=n[U]=A?[V,q]:[q,V]:A?q.unshift(V):q.push(V),(t=z(N))>0&&q.length>t&&!q.warned){q.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(U)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.AU=N,E.type=U,E.count=q.length,S=E,console&&console.warn&&console.warn(S)}return N}function E(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(N,U,V){var A={fired:!1,wrapFn:void 0,target:N,type:U,listener:V},t=E.bind(A);return t.listener=V,A.wrapFn=t,t}function k(N,U,V){var A=N._events;if(void 0===A)return[];var t=A[U];return void 0===t?[]:"function"===typeof t?V?[t.listener||t]:[t]:V?function(N){for(var U=new Array(N.length),V=0;V<U.length;++V)U[V]=N[V].listener||N[V];return U}(t):C(t,t.length)}function B(N){var U=this._events;if(void 0!==U){var V=U[N];if("function"===typeof V)return 1;if(void 0!==V)return V.length}return 0}function C(N,U){for(var V=new Array(U),A=0;A<U;++A)V[A]=N[A];return V}function x(N,U,V,A){if("function"===typeof N.on)A.once?N.once(U,V):N.on(U,V);else{if("function"!==typeof N.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N);N.addEventListener(U,(function t(n){A.once&&N.removeEventListener(U,t),V(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return q},set:function(N){if("number"!==typeof N||N<0||t(N))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");q=N}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(N){if("number"!==typeof N||N<0||t(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this},n.prototype.getMaxListeners=function(){return z(this)},n.prototype.emit=function(N){for(var U=[],V=1;V<arguments.length;V++)U.push(arguments[V]);var t="error"===N,n=this._events;if(void 0!==n)t=t&&void 0===n.error;else if(!t)return!1;if(t){var q;if(U.length>0&&(q=U[0]),q instanceof Error)throw q;var i=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw i.context=q,i}var z=n[N];if(void 0===z)return!1;if("function"===typeof z)A(z,this,U);else{var S=z.length,E=C(z,S);for(V=0;V<S;++V)A(E[V],this,U)}return!0},n.prototype.addListener=function(N,U){return S(this,N,U,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(N,U){return S(this,N,U,!0)},n.prototype.once=function(N,U){return i(U),this.on(N,p(this,N,U)),this},n.prototype.prependOnceListener=function(N,U){return i(U),this.prependListener(N,p(this,N,U)),this},n.prototype.removeListener=function(N,U){var V,A,t,n,q;if(i(U),void 0===(A=this._events))return this;if(void 0===(V=A[N]))return this;if(V===U||V.listener===U)0===--this._eventsCount?this._events=Object.create(null):(delete A[N],A.removeListener&&this.emit("removeListener",N,V.listener||U));else if("function"!==typeof V){for(t=-1,n=V.length-1;n>=0;n--)if(V[n]===U||V[n].listener===U){q=V[n].listener,t=n;break}if(t<0)return this;0===t?V.shift():function(N,U){for(;U+1<N.length;U++)N[U]=N[U+1];N.pop()}(V,t),1===V.length&&(A[N]=V[0]),void 0!==A.removeListener&&this.emit("removeListener",N,q||U)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.tU=function(N){var U,V,A;if(void 0===(V=this._events))return this;if(void 0===V.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==V[N]&&(0===--this._eventsCount?this._events=Object.create(null):delete V[N]),this;if(0===arguments.length){var t,n=Object.keys(V);for(A=0;A<n.length;++A)"removeListener"!==(t=n[A])&&this.tU(t);return this.tU("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(U=V[N]))this.removeListener(N,U);else if(void 0!==U)for(A=U.length-1;A>=0;A--)this.removeListener(N,U[A]);return this},n.prototype.listeners=function(N){return k(this,N,!0)},n.prototype.rawListeners=function(N){return k(this,N,!1)},n.listenerCount=function(N,U){return"function"===typeof N.listenerCount?N.listenerCount(U):B.call(N,U)},n.prototype.listenerCount=B,n.prototype.eventNames=function(){return this._eventsCount>0?U(this._events):[]}},14551:N=>{"use strict";N.exports=function(N,U,V,A,t,n){var q=+U[0],i=+U[1],z=+U[2],S=+V[0],E=+V[1],p=+V[2],k=Math.sqrt(S*S+E*E+p*p);if(0===k)throw new Error("Can't raycast along a zero vector");return function(N,U,V,A,t,n,q,i,z,S){for(var E=0,p=Math.floor,k=0|p(U),B=0|p(V),C=0|p(A),x=t>0?1:-1,J=n>0?1:-1,d=q>0?1:-1,r=Math.abs(1/t),v=Math.abs(1/n),h=Math.abs(1/q),c=r<1/0?r*(x>0?k+1-U:U-k):1/0,H=v<1/0?v*(J>0?B+1-V:V-B):1/0,Y=h<1/0?h*(d>0?C+1-A:A-C):1/0,W=-1;E<=i;){var s=N(k,B,C);if(s)return z&&(z[0]=U+E*t,z[1]=V+E*n,z[2]=A+E*q),S&&(S[0]=S[1]=S[2]=0,0===W&&(S[0]=-x),1===W&&(S[1]=-J),2===W&&(S[2]=-d)),s;c<H?c<Y?(k+=x,E=c,c+=r,W=0):(C+=d,E=Y,Y+=h,W=2):H<Y?(B+=J,E=H,H+=v,W=1):(C+=d,E=Y,Y+=h,W=2)}return z&&(z[0]=U+E*t,z[1]=V+E*n,z[2]=A+E*q),S&&(S[0]=S[1]=S[2]=0),0}(N,q,i,z,S/=k,E/=k,p/=k,A="undefined"===typeof A?64:+A,t,n)}},14583:(N,U,V)=>{"use strict";V.d(U,{e:()=>n});var A=V(14258);function t(){this.tk=!1,this.stopPropagation=!1,this.nk=!1,this.disabled=!1,this.maxPointerMovement=150}class n{constructor(N,U){this.version="0.7.0";var V=Object.assign({},new t,U||{});this.element=N||document,this.tk=!!V.tk,this.stopPropagation=!!V.stopPropagation,this.nk=!!V.nk,this.disabled=!!V.disabled,this.filterEvents=(N,U)=>!0,this.down=new A.EventEmitter,this.up=new A.EventEmitter,this.state={},this.eS={dx:0,dy:0,fk:0,XS:0,Ok:0},this.maxPointerMovement=V.maxPointerMovement||0,this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?i(this):document.addEventListener("DOMContentLoaded",(N=>{i(this)}),{once:!0})}bind(N){for(var U=arguments.length,V=new Array(U>1?U-1:0),A=1;A<U;A++)V[A-1]=arguments[A];V.forEach((U=>{var V=this._keyBindmap[U]||[];V.includes(N)||(V.push(N),this._keyBindmap[U]=V)})),this.state[N]=!!this.state[N],this.pressCount[N]=this.pressCount[N]||0,this.releaseCount[N]=this.releaseCount[N]||0}unbind(N){for(var U in this._keyBindmap){var V=this._keyBindmap[U],A=V.indexOf(N);A>-1&&V.splice(A,1)}}getBindings(){var N={};for(var U in this._keyBindmap){this._keyBindmap[U].forEach((V=>{N[V]=N[V]||[],N[V].push(U)}))}return N}Vi(){q(this.eS),q(this.pressCount),q(this.releaseCount)}}function q(N){for(var U in N)N[U]=0}function i(N){window.addEventListener("keydown",C.bind(null,N,!0),!1),window.addEventListener("keyup",C.bind(null,N,!1),!1);var U={passive:!0};N.element.addEventListener("touchstart",p.bind(void 0,N),{passive:!1}),N.element.addEventListener("touchend",B.bind(void 0,N),U),N.element.addEventListener("mousedown",x.bind(null,N,!0),U),window.document.addEventListener("mouseup",x.bind(null,N,!1),U),N.element.addEventListener("touchmove",J.bind(null,N),U),N.element.addEventListener("mousemove",J.bind(null,N),U),window.PointerEvent,N.element.addEventListener("wheel",h.bind(null,N),U),N.element.addEventListener("contextmenu",c.bind(null,N),!1),window.addEventListener("blur",H.bind(null,N),!1)}var z=0,S=0,E=null;function p(N,U){U.preventDefault(),k(U)}function k(N){let U=!1;for(let V=0;V<N.touches.length;++V)if(N.touches[V].identifier===E){U=!0;break}if(!U){const U=N.changedTouches[0];z=U.clientX,S=U.clientY,E=U.identifier}}function B(N,U){for(var V=U.changedTouches,A=0;A<V.length;++A)V[A].identifier===E&&(E=null)}function C(N,U,V){Y(V.code,U,N,V)}function x(N,U,V){if("pointerId"in V)if(U){if(null!==N._touches.currID)return;N._touches.currID=V.pointerId}else{if(N._touches.currID!==V.pointerId)return;N._touches.currID=null}return Y("Mouse"+("button"in V?V.button+1:1),U,N,V),!1}function J(N,U){var V=U.movementX||U.mozMovementX||0,A=U.movementY||U.mozMovementY||0;if(U.touches&&0===(V|A)){var t=function(N){k(N);for(let U=0;U<N.changedTouches.length;++U)if(N.changedTouches[U].identifier==E){const V=N.changedTouches[U],A=[V.clientX-z,V.clientY-S];return z=V.clientX,S=V.clientY,A}return console.error(`Did not find touch id ${E}`),[0,0]}(U);V=t[0],A=t[1]}if((0!==V||0!==A)&&N.maxPointerMovement>0){var n=Math.abs(V-d),q=Math.abs(A-r),i=n>N.maxPointerMovement&&n/Math.abs(d||1)>12,p=q>N.maxPointerMovement&&q/Math.abs(r||1)>12,B=U.timeStamp;B-(v??B)<20&&(i||p)||(N.eS.dx+=V,N.eS.dy+=A,d=V||1,r=A||1),v=B}}var d=0,r=0,v=null;function h(N,U){var V=1;switch(U.deltaMode){case 0:V=1;break;case 1:V=12;break;case 2:V=N.element.clientHeight||window.innerHeight}N.eS.fk+=(U.deltaX||0)*V,N.eS.XS+=(U.deltaY||0)*V,N.eS.Ok+=(U.deltaZ||0)*V}function c(N,U){if(!N.nk)return U.preventDefault(),!1}function H(N){for(var U in N._keyStates)N._keyStates[U]&&(/^Mouse\d/.test(U)||Y(U,!1,N,{code:U,note:"pmenjkhto6j",preventDefault:()=>{},stopPropagation:()=>{}}))}function Y(N,U,V,A){var t=V._keyBindmap[N];t&&(W(V._keyStates[N],U)&&(V._keyStates[N]=U,t.forEach((N=>{(!V.filterEvents||V.filterEvents(A,N))&&function(N,U,V,A){var t=U?V.pressCount:V.releaseCount;t[N]=(t[N]||0)+1;var n=V._bindPressCount[N]||0;(n+=U?1:-1)<0&&(n=0);V._bindPressCount[N]=n;var q=V.state[N];if(W(q,n)){V.state[N]=n>0;var i=U?V.down:V.up;V.disabled||i.emit(N,A)}}(N,U,V,A)}))),"button"in A||(V.tk&&!A.defaultPrevented&&A.preventDefault(),V.stopPropagation&&A.stopPropagation()))}function W(N,U){return N?!U:U}},13232:N=>{N.exports=function(N,U,V){return N[0]=U[0]+V[0],N[1]=U[1]+V[1],N[2]=U[2]+V[2],N}},13188:(N,U,V)=>{N.exports=function(N,U){var V=A(N[0],N[1],N[2]),q=A(U[0],U[1],U[2]);t(V,V),t(q,q);var i=n(V,q);return i>1?0:Math.acos(i)};var A=V(13191),t=V(13196),n=V(13201)},13297:N=>{N.exports=function(N,U){return N[0]=Math.ceil(U[0]),N[1]=Math.ceil(U[1]),N[2]=Math.ceil(U[2]),N}},13181:N=>{N.exports=function(N){var U=new Float32Array(3);return U[0]=N[0],U[1]=N[1],U[2]=N[2],U}},13205:N=>{N.exports=function(N,U){return N[0]=U[0],N[1]=U[1],N[2]=U[2],N}},13178:N=>{N.exports=function(){var N=new Float32Array(3);return N[0]=0,N[1]=0,N[2]=0,N}},13373:N=>{N.exports=function(N,U,V){var A=U[0],t=U[1],n=U[2],q=V[0],i=V[1],z=V[2];return N[0]=t*z-n*i,N[1]=n*q-A*z,N[2]=A*i-t*q,N}},13326:(N,U,V)=>{N.exports=V(13321)},13321:N=>{N.exports=function(N,U){var V=U[0]-N[0],A=U[1]-N[1],t=U[2]-N[2];return Math.sqrt(V*V+A*A+t*t)}},13273:(N,U,V)=>{N.exports=V(13265)},13265:N=>{N.exports=function(N,U,V){return N[0]=U[0]/V[0],N[1]=U[1]/V[1],N[2]=U[2]/V[2],N}},13201:N=>{N.exports=function(N,U){return N[0]*U[0]+N[1]*U[1]+N[2]*U[2]}},13172:N=>{N.exports=1e-6},13217:(N,U,V)=>{N.exports=function(N,U){var V=N[0],t=N[1],n=N[2],q=U[0],i=U[1],z=U[2];return Math.abs(V-q)<=A*Math.max(1,Math.abs(V),Math.abs(q))&&Math.abs(t-i)<=A*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-z)<=A*Math.max(1,Math.abs(n),Math.abs(z))};var A=V(13172)},13223:N=>{N.exports=function(N,U){return N[0]===U[0]&&N[1]===U[1]&&N[2]===U[2]}},13288:N=>{N.exports=function(N,U){return N[0]=Math.floor(U[0]),N[1]=Math.floor(U[1]),N[2]=Math.floor(U[2]),N}},13410:(N,U,V)=>{N.exports=function(N,U,V,t,n,q){var i,z;U||(U=3);V||(V=0);z=t?Math.min(t*U+V,N.length):N.length;for(i=V;i<z;i+=U)A[0]=N[i],A[1]=N[i+1],A[2]=N[i+2],n(A,A,q),N[i]=A[0],N[i+1]=A[1],N[i+2]=A[2];return N};var A=V(13178)()},13191:N=>{N.exports=function(N,U,V){var A=new Float32Array(3);return A[0]=N,A[1]=U,A[2]=V,A}},13163:(N,U,V)=>{N.exports={EPSILON:V(13172),create:V(13178),clone:V(13181),angle:V(13188),Pq:V(13191),j:V(13205),set:V(13214),equals:V(13217),exactEquals:V(13223),add:V(13232),xU:V(13238),sub:V(13245),multiply:V(13252),mul:V(13260),divide:V(13265),div:V(13273),min:V(13280),max:V(13286),floor:V(13288),ceil:V(13297),round:V(13303),scale:V(13305),Tq:V(13312),distance:V(13321),i:V(13326),squaredDistance:V(13329),sqrDist:V(13336),length:V(13341),len:V(13348),squaredLength:V(13353),fq:V(13361),negate:V(13368),inverse:V(13370),normalize:V(13196),dot:V(13201),cross:V(13373),Kq:V(13375),random:V(13377),transformMat4:V(13385),transformMat3:V(13388),transformQuat:V(13396),Oq:V(13398),Zq:V(13403),bq:V(13407),forEach:V(13410)}},13370:N=>{N.exports=function(N,U){return N[0]=1/U[0],N[1]=1/U[1],N[2]=1/U[2],N}},13348:(N,U,V)=>{N.exports=V(13341)},13341:N=>{N.exports=function(N){var U=N[0],V=N[1],A=N[2];return Math.sqrt(U*U+V*V+A*A)}},13375:N=>{N.exports=function(N,U,V,A){var t=U[0],n=U[1],q=U[2];return N[0]=t+A*(V[0]-t),N[1]=n+A*(V[1]-n),N[2]=q+A*(V[2]-q),N}},13286:N=>{N.exports=function(N,U,V){return N[0]=Math.max(U[0],V[0]),N[1]=Math.max(U[1],V[1]),N[2]=Math.max(U[2],V[2]),N}},13280:N=>{N.exports=function(N,U,V){return N[0]=Math.min(U[0],V[0]),N[1]=Math.min(U[1],V[1]),N[2]=Math.min(U[2],V[2]),N}},13260:(N,U,V)=>{N.exports=V(13252)},13252:N=>{N.exports=function(N,U,V){return N[0]=U[0]*V[0],N[1]=U[1]*V[1],N[2]=U[2]*V[2],N}},13368:N=>{N.exports=function(N,U){return N[0]=-U[0],N[1]=-U[1],N[2]=-U[2],N}},13196:N=>{N.exports=function(N,U){var V=U[0],A=U[1],t=U[2],n=V*V+A*A+t*t;n>0&&(n=1/Math.sqrt(n),N[0]=U[0]*n,N[1]=U[1]*n,N[2]=U[2]*n);return N}},13377:N=>{N.exports=function(N,U){U=U||1;var V=2*Math.random()*Math.PI,A=2*Math.random()-1,t=Math.sqrt(1-A*A)*U;return N[0]=Math.cos(V)*t,N[1]=Math.sin(V)*t,N[2]=A*U,N}},13398:N=>{N.exports=function(N,U,V,A){var t=V[1],n=V[2],q=U[1]-t,i=U[2]-n,z=Math.sin(A),S=Math.cos(A);return N[0]=U[0],N[1]=t+q*S-i*z,N[2]=n+q*z+i*S,N}},13403:N=>{N.exports=function(N,U,V,A){var t=V[0],n=V[2],q=U[0]-t,i=U[2]-n,z=Math.sin(A),S=Math.cos(A);return N[0]=t+i*z+q*S,N[1]=U[1],N[2]=n+i*S-q*z,N}},13407:N=>{N.exports=function(N,U,V,A){var t=V[0],n=V[1],q=U[0]-t,i=U[1]-n,z=Math.sin(A),S=Math.cos(A);return N[0]=t+q*S-i*z,N[1]=n+q*z+i*S,N[2]=U[2],N}},13303:N=>{N.exports=function(N,U){return N[0]=Math.round(U[0]),N[1]=Math.round(U[1]),N[2]=Math.round(U[2]),N}},13305:N=>{N.exports=function(N,U,V){return N[0]=U[0]*V,N[1]=U[1]*V,N[2]=U[2]*V,N}},13312:N=>{N.exports=function(N,U,V,A){return N[0]=U[0]+V[0]*A,N[1]=U[1]+V[1]*A,N[2]=U[2]+V[2]*A,N}},13214:N=>{N.exports=function(N,U,V,A){return N[0]=U,N[1]=V,N[2]=A,N}},13336:(N,U,V)=>{N.exports=V(13329)},13361:(N,U,V)=>{N.exports=V(13353)},13329:N=>{N.exports=function(N,U){var V=U[0]-N[0],A=U[1]-N[1],t=U[2]-N[2];return V*V+A*A+t*t}},13353:N=>{N.exports=function(N){var U=N[0],V=N[1],A=N[2];return U*U+V*V+A*A}},13245:(N,U,V)=>{N.exports=V(13238)},13238:N=>{N.exports=function(N,U,V){return N[0]=U[0]-V[0],N[1]=U[1]-V[1],N[2]=U[2]-V[2],N}},13388:N=>{N.exports=function(N,U,V){var A=U[0],t=U[1],n=U[2];return N[0]=A*V[0]+t*V[3]+n*V[6],N[1]=A*V[1]+t*V[4]+n*V[7],N[2]=A*V[2]+t*V[5]+n*V[8],N}},13385:N=>{N.exports=function(N,U,V){var A=U[0],t=U[1],n=U[2],q=V[3]*A+V[7]*t+V[11]*n+V[15];return q=q||1,N[0]=(V[0]*A+V[4]*t+V[8]*n+V[12])/q,N[1]=(V[1]*A+V[5]*t+V[9]*n+V[13])/q,N[2]=(V[2]*A+V[6]*t+V[10]*n+V[14])/q,N}},13396:N=>{N.exports=function(N,U,V){var A=U[0],t=U[1],n=U[2],q=V[0],i=V[1],z=V[2],S=V[3],E=S*A+i*n-z*t,p=S*t+z*A-q*n,k=S*n+q*t-i*A,B=-q*A-i*t-z*n;return N[0]=E*S+B*-q+p*-z-k*-i,N[1]=p*S+B*-i+k*-q-E*-z,N[2]=k*S+B*-z+E*-i-p*-q,N}},14273:N=>{"use strict";N.exports=function(N){for(var U=new Array(N),V=0;V<N;++V)U[V]=V;return U}},14334:N=>{N.exports=function(N){return null!=N&&null!=N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}},14554:(N,U,V)=>{"use strict";V.d(U,{b:()=>A});class A{constructor(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.DE=!1,this.GE=!1,this.oE=30,this.RE=0,this.fE=!1,this.fullscreen=!1,this.lE=function(N){},this.KE=function(){},this.PE=function(){},this.gt=function(){},this.jE=function(N){},this.onFullscreenChanged=function(N){},S((()=>{!function(N,U){N._nowObject=performance||Date,N._lastTick=0,N._renderAccum=0,N._rt=0,N._frameCB=i.bind(null,N),requestAnimationFrame(N._frameCB),U>0&&(N._intervalCB=q.bind(null,N),N._interval=setInterval(N._intervalCB,Math.max(U,1e3/N.oE/2)))}(this,U),function(N,U){if(!U)return;var V=!1,A=!1;document.addEventListener("pointerlockchange",(A=>{V=document.pointerLockElement===U,N.jE(V)})),document.addEventListener("fullscreenchange",(V=>{A=document.fullscreenElement===U,N.onFullscreenChanged(A)})),Object.defineProperty(N,"fE",{get:()=>V,set:N=>{N&&!V?z(U):V&&!N&&function(N){N.exitPointerLock&&N.exitPointerLock()}(document)}}),Object.defineProperty(N,"fullscreen",{get:()=>A,set:N=>{N&&!A?U.requestFullscreen():A&&!N&&document.exitFullscreen()}}),U.addEventListener("click",(t=>{N.DE&&!V&&z(U),N.GE&&!A&&U.requestFullscreen()}));var t=()=>N.gt();if(window.ResizeObserver){new ResizeObserver(t).observe(U)}else window.addEventListener("resize",t)}(this,N),this.PE()}))}}var t=3,n=20;function q(N){for(var U=1e3/N.oE,V=N._nowObject.now()+n,A=0;N._nowObject.now()>=N._lastTick+U&&N._nowObject.now()<V&&++A<=t;)N.lE(U),N._lastTick+=U;var q=5*(U+5),i=N._nowObject.now();if(i-N._lastTick>q)for(;i>=N._lastTick+U;)N._lastTick+=U}function i(N){requestAnimationFrame(N._frameCB),q(N);var U=N._nowObject.now(),V=U-N._rt;if(N._rt=U,N.RE>0){N._renderAccum+=V;var A=1e3/N.RE;if(N._renderAccum<A)return;N._renderAccum=Math.min(N._renderAccum-A,A)}var t=1e3/N.oE,n=(U-N._lastTick)/t;N.KE(V,n,t)}function z(N){N.requestPointerLock&&N.requestPointerLock()}var S=N=>{if("loading"===document.readyState){var U=()=>{document.removeEventListener("readystatechange",U),N()};document.addEventListener("readystatechange",U)}else setTimeout(N,1)}},14270:(N,U,V)=>{var A=V(14273),t=V(14280),n="undefined"!==typeof Float64Array;function q(N,U){return N[0]-U[0]}function i(){var N,U=this.stride,V=new Array(U.length);for(N=0;N<V.length;++N)V[N]=[Math.abs(U[N]),N];V.sort(q);var A=new Array(V.length);for(N=0;N<A.length;++N)A[N]=V[N][1];return A}function z(N,U){var V=["View",U,"d",N].join("");U<0&&(V="View_Nil"+N);var t="generic"===N;if(-1===U){var n="function "+V+"(a){this.data=a;};var proto="+V+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+V+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+V+"(a){return new "+V+"(a);}";return new Function(n)()}if(0===U){n="function "+V+"(a,d) {this.data = a;this.offset = d};var proto="+V+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+V+"_copy() {return new "+V+"(this.data,this.offset)};proto.pick=function "+V+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+V+"_get(){return "+(t?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+V+"_set(v){return "+(t?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+V+"(a,b,c,d){return new "+V+"(a,d)}";return new Function("TrivialArray",n)(S[N][0])}n=["'use strict'"];var q=A(U),z=q.map((function(N){return"i"+N})),E="this.offset+"+q.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),p=q.map((function(N){return"b"+N})).join(","),k=q.map((function(N){return"c"+N})).join(",");n.push("function "+V+"(a,"+p+","+k+",d){this.data=a","this.shape=["+p+"]","this.stride=["+k+"]","this.offset=d|0}","var proto="+V+".prototype","proto.dtype='"+N+"'","proto.dimension="+U),n.push("Object.defineProperty(proto,'size',{get:function "+V+"_size(){return "+q.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===U?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),U<4?(n.push("function "+V+"_order(){"),2===U?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+V+"_set("+z.join(",")+",v){"),t?n.push("return this.data.set("+E+",v)}"):n.push("return this.data["+E+"]=v}"),n.push("proto.get=function "+V+"_get("+z.join(",")+"){"),t?n.push("return this.data.get("+E+")}"):n.push("return this.data["+E+"]}"),n.push("proto.index=function "+V+"_index(",z.join(),"){return "+E+"}"),n.push("proto.hi=function "+V+"_hi("+z.join(",")+"){return new "+V+"(this.data,"+q.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+q.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var B=q.map((function(N){return"a"+N+"=this.shape["+N+"]"})),C=q.map((function(N){return"c"+N+"=this.stride["+N+"]"}));n.push("proto.lo=function "+V+"_lo("+z.join(",")+"){var b=this.offset,d=0,"+B.join(",")+","+C.join(","));for(var x=0;x<U;++x)n.push("if(typeof i"+x+"==='number'&&i"+x+">=0){d=i"+x+"|0;b+=c"+x+"*d;a"+x+"-=d}");n.push("return new "+V+"(this.data,"+q.map((function(N){return"a"+N})).join(",")+","+q.map((function(N){return"c"+N})).join(",")+",b)}"),n.push("proto.step=function "+V+"_step("+z.join(",")+"){var "+q.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+q.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(x=0;x<U;++x)n.push("if(typeof i"+x+"==='number'){d=i"+x+"|0;if(d<0){c+=b"+x+"*(a"+x+"-1);a"+x+"=ceil(-a"+x+"/d)}else{a"+x+"=ceil(a"+x+"/d)}b"+x+"*=d}");n.push("return new "+V+"(this.data,"+q.map((function(N){return"a"+N})).join(",")+","+q.map((function(N){return"b"+N})).join(",")+",c)}");var J=new Array(U),d=new Array(U);for(x=0;x<U;++x)J[x]="a[i"+x+"]",d[x]="b[i"+x+"]";n.push("proto.transpose=function "+V+"_transpose("+z+"){"+z.map((function(N,U){return N+"=("+N+"===undefined?"+U+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+V+"(this.data,"+J.join(",")+","+d.join(",")+",this.offset)}"),n.push("proto.pick=function "+V+"_pick("+z+"){var a=[],b=[],c=this.offset");for(x=0;x<U;++x)n.push("if(typeof i"+x+"==='number'&&i"+x+">=0){c=(c+this.stride["+x+"]*i"+x+")|0}else{a.push(this.shape["+x+"]);b.push(this.stride["+x+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+V+"(data,shape,stride,offset){return new "+V+"(data,"+q.map((function(N){return"shape["+N+"]"})).join(",")+","+q.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(S[N],i)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,U,V,A){if(void 0===N)return(0,S.array[0])([]);"number"===typeof N&&(N=[N]),void 0===U&&(U=[N.length]);var q=U.length;if(void 0===V){V=new Array(q);for(var i=q-1,E=1;i>=0;--i)V[i]=E,E*=U[i]}if(void 0===A){A=0;for(i=0;i<q;++i)V[i]<0&&(A-=(U[i]-1)*V[i])}for(var p=function(N){if(t(N))return"buffer";if(n)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),k=S[p];k.length<=q+1;)k.push(z(p,k.length-1));return(0,k[q+1])(N,U,V,A)}},14280:N=>{function U(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(U(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&U(N.slice(0,0))}(N)||!!N._isBuffer)}},14416:N=>{"use strict";var U=[],V=[],A=[],t=[],n=[],q=[],i=[],z=[],S=[],E=[],p=[],k=[];N.exports=function(N,B,C,x,J,d){for(var r=i,v=S,h=E,c=k,H=0;H<3;H++)r[H]=+C[H],h[H]=+B.max[H],v[H]=+B.base[H];d||(d=1e-10);var Y=function(N,i,S,E,k,B){var C=U,x=V,J=A,d=t,r=n,v=q,h=z,c=Math.floor,H=0,Y=0,W=0,s=0,M=0;if(a(),0===W)return 0;for(s=X();Y<=W;){if(mN(s)&&w())return H;s=X()}for(H+=W,M=0;M<3;M++)E[M]+=S[M],k[M]+=S[M];return H;function a(){if(Y=0,0!==(W=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])))for(var N=0;N<3;N++){var U=S[N]>=0;d[N]=U?1:-1;var V=U?k[N]:E[N];C[N]=U?E[N]:k[N],x[N]=e(V,d[N]),J[N]=Q(C[N],d[N]),h[N]=S[N]/W,r[N]=Math.abs(1/h[N]);var A=U?x[N]+1-V:V-x[N];v[N]=r[N]<1/0?r[N]*A:1/0}}function mN(U){for(var V=d[0],A=0===U?x[0]:J[0],t=x[0]+V,n=d[1],q=1===U?x[1]:J[1],i=x[1]+n,z=d[2],S=2===U?x[2]:J[2],E=x[2]+z,p=A;p!=t;p+=V)for(var k=q;k!=i;k+=n)for(var B=S;B!=E;B+=z)if(N(p,k,B))return!0;return!1}function w(){H+=Y;var N=d[s],U=Y/W,V=p;for(M=0;M<3;M++){var A=S[M]*U;E[M]+=A,k[M]+=A,V[M]=S[M]-A}if(N>0?k[s]=Math.round(k[s]):E[s]=Math.round(E[s]),i(H,s,N,V))return!0;for(M=0;M<3;M++)S[M]=V[M];return a(),0===W}function X(){var N=v[0]<v[1]?v[0]<v[2]?0:2:v[1]<v[2]?1:2,U=v[N]-Y;for(Y=v[N],x[N]+=d[N],v[N]+=r[N],M=0;M<3;M++)C[M]+=U*h[M],J[M]=Q(C[M],d[M]);return N}function e(N,U){return c(N-U*B)}function Q(N,U){return c(N+U*B)}}(N,x,r,v,h,d);if(!J){for(H=0;H<3;H++)c[H]=C[H]>0?h[H]-B.max[H]:v[H]-B.base[H];B.translate(c)}return Y}},14586:(N,U,V)=>{"use strict";V.d(U,{e:()=>p});var A=V(14407),t=V(13163);class n{constructor(N,U,V,n,q,i,z){this.oS=new A(N.base,N.NE),this.rt=U,this.friction=V,this.restitution=n,this.Iq=q,this.xB=i,this.oq=!!z,this.yS=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.VC=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.kS=t.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=t.create(),this._impulses=t.create(),this._sleepFrameCount=10}loadFromCopy(N){t.j(this.oS.base,N.oS.base),t.j(this.oS.NE,N.oS.NE),t.j(this.oS.max,N.oS.max),this.oS.mag=N.oS.mag,this.rt=N.rt,this.friction=N.friction,this.restitution=N.restitution,this.Iq=N.Iq,this.xB=N.xB,this.oq=N.oq,this.yS=N.yS,this.fluidDrag=N.fluidDrag,this.VC=N.VC,this.preventFallOffEdge=N.preventFallOffEdge,this.rolledBackLastTick=N.rolledBackLastTick,t.j(this.kS,N.kS),t.j(this.resting,N.resting),this.inFluid=N.inFluid,this._ratioInFluid=N._ratioInFluid,t.j(this._forces,N._forces),t.j(this._impulses,N._impulses),this._sleepFrameCount=N._sleepFrameCount}setPosition(N){q(N),t.xU(N,N,this.oS.base),this.oS.translate(N),this.xS()}lt(){return t.clone(this.oS.base)}applyForce(N){q(N),t.add(this._forces,this._forces,N),this.xS()}applyImpulse(N){q(N),t.add(this._impulses,this._impulses,N),this.xS()}xS(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var q=N=>{};var i=V(14407),z=V(13163),S=V(14416);function E(){this.yS=.1,this.fluidDrag=.4,this.lq=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function p(N,U,V){N=Object.assign(new E,N),this.gravity=N.gravity||[0,-10,0],this.yS=N.yS||.1,this.lq=N.lq||2,this.fluidDrag=N.fluidDrag||.4,this.minBounceImpulse=N.minBounceImpulse,this.bodies=[],this.Rk=N.Rk,this.testSolid=U,this.testFluid=V}p.prototype.HB=function(N,U,V,A,t,q){N=N||new i([0,0,0],[1,1,1]),"undefined"==typeof U&&(U=1),"undefined"==typeof V&&(V=1),"undefined"==typeof A&&(A=0),"undefined"==typeof t&&(t=1);var z=new n(N,U,V,A,t,q);return this.bodies.push(z),z},p.prototype.YB=function(N){var U=this.bodies.indexOf(N);U<0||(this.bodies.splice(U,1),N.oS=N.xB=null)};var k=z.create(),B=z.create(),C=z.create(),x=z.create(),J=z.create(),d=z.create(),r=z.create(),v=new i([0,0,0],[1,1,1]),h=new n(v,1,1,0,1,(()=>{}),!1);function c(N,U,V){return U=V,U*=1-(1-N.ratioInFluid)**2}p.prototype.Vi=function(N){N/=1e3;var U=R(0,z.squaredLength(this.gravity));this.bodies.forEach((V=>function(N,U,V,A){z.j(J,U.resting),N.Rk&&h.loadFromCopy(U);if(U.rt<=0)return z.set(U.kS,0,0,0),z.set(U._forces,0,0,0),void z.set(U._impulses,0,0,0);var t=A||0===U.Iq;if(function(N,U,V,A){if(U._sleepFrameCount>0)return!1;if(A)return!0;var t=!1,n=.5*V*V*U.Iq;return z.scale(o,N.gravity,n),S(N.testSolid,U.oS,o,(function(){return t=!0,!0}),!0),t}(N,U,V,t))return;U._sleepFrameCount--,function(N,U){var V=U.oS,A=Math.floor(V.base[0]),t=Math.floor(V.base[2]),n=Math.floor(V.base[1]),q=Math.floor(V.max[1]);if(!N.testFluid(A,n,t))return U.inFluid=!1,void(U.ratioInFluid=0);var i=1,S=n+1;for(;S<=q&&N.testFluid(A,S,t);)i++,S++;var E=(n+i-V.base[1])/V.NE[1];E>1&&(E=1);var p=V.NE[0]*V.NE[1]*V.NE[2]*E,k=Y;z.scale(k,N.gravity,-N.lq*p*U.Iq),U.applyForce(k),U.inFluid=!0,U.ratioInFluid=E}(N,U),G(U._forces),G(U._impulses),G(U.kS),G(U.resting),z.scale(k,U._forces,1/U.rt),z.Tq(k,k,N.gravity,U.Iq),z.scale(B,U._impulses,1/U.rt),z.Tq(B,B,k,V),z.add(U.kS,U.kS,B),U.friction&&(W(N,0,U,B,V),W(N,1,U,B,V),W(N,2,U,B,V));var n=U.fluidDrag>=0?U.fluidDrag:N.fluidDrag,q=U.yS>=0?U.yS:N.yS,i=q,E=q;U.inFluid&&(i=c(U,i,U.fluidDragHoriz>=0?U.fluidDragHoriz:n),E=c(U,E,U.fluidDragVert>=0?U.fluidDragVert:n));i=Math.max(1-i*V/U.rt,0),E=Math.max(1-E*V/U.rt,0),z.set(H,i,E,i),z.multiply(U.kS,U.kS,H),z.scale(C,U.kS,V),z.set(U._forces,0,0,0),z.set(U._impulses,0,0,0),U.oq&&D(a,U.oS);z.j(d,C),z.set(r,0,0,0),U.preventFallOffEdge&&function(N,U,V,A){if(!U.resting[1]||V[1]>0)return;var t=u;D(t,U.oS);for(var n=0;n<3;n+=2){z.set(Q,0,0,0),Q[n]=V[n];var q=!0;(q=(q=(q=(q=q&&!I(N,t.base[0]+Q[0]+1e-5,t.base[1],t.base[2]+Q[2]+1e-5))&&!I(N,t.max[0]+Q[0]-1e-5,t.base[1],t.base[2]+Q[2]+1e-5))&&!I(N,t.base[0]+Q[0]+1e-5,t.base[1],t.max[2]+Q[2]-1e-5))&&!I(N,t.max[0]+Q[0]-1e-5,t.base[1],t.max[2]+Q[2]-1e-5))?(A[n]=V[n]>0?1:-1,V[n]=0):0===n&&(z.set(L,V[0],0,0),M(N,t,L,A,U.slideOnCollision))}}(N,U,C,r);M(N,U.oS,C,U.resting,U.slideOnCollision),U.oq&&function(N,U,V,A){if(U.resting[1]>=0&&!U.inFluid)return;var t=0!==U.resting[0],n=0!==U.resting[2];if(!t&&!n)return;var q=Math.abs(A[0]/A[2]),i=4;if(!t&&q>i)return;if(!n&&q<1/i)return;z.add(w,V.base,A);var E=N.testSolid;S(E,V,A,(function(N,U,V,A){if(1!==U)return!0;A[U]=0}));var p=V.base[1],k=U.inFluid?1.951:1.001,B=Math.floor(p+k)-p;z.set(X,0,B,0);var C=!1;if(S(E,V,X,(function(N,U,V,A){return C=!0,!0})),C)return;z.xU(e,w,V.base),e[1]=0,M(N,V,e,mN,!0);var x=R(V.base[0],w[0]),J=R(V.base[2],w[2]);if(t&&!x&&(!J||!n))return;if(n&&(!x||!t)&&!J)return;var d=!0;if(d=d&&!I(N,V.base[0]+1e-5,V.base[1],V.base[2]+1e-5),d=d&&!I(N,V.max[0]-1e-5,V.base[1],V.base[2]+1e-5),d=d&&!I(N,V.base[0]+1e-5,V.base[1],V.max[2]-1e-5),d=d&&!I(N,V.max[0]-1e-5,V.base[1],V.max[2]-1e-5),d)return;D(U.oS,V),U.resting[0]=mN[0],U.resting[2]=mN[2],U.VC&&U.VC()}(N,U,a,d);for(var p=0;p<3;++p)U.resting[p]=U.resting[p]||r[p],x[p]=0,U.resting[p]&&(J[p]||(x[p]=-U.kS[p]),U.kS[p]=0);var v=z.length(x);v>.001&&(z.scale(x,x,U.rt),U.xB&&U.xB(x),U.restitution>0&&v>N.minBounceImpulse&&(z.scale(x,x,U.restitution),U.applyImpulse(x)));var s=z.squaredLength(U.kS);s>1e-5&&U.xS();N.Rk&&N.Rk(U)?(U.loadFromCopy(h),U.rolledBackLastTick=!0):U.rolledBackLastTick=!1}(this,V,N,U)))};var H=z.create([0,0,0]);var Y=z.create();function W(N,U,V,A,t){var n=V.resting[U],q=A[U];if(!V.alwaysApplyHorizFriction||1!==U){if(0===n)return;if(n*q<=0)return}z.j(s,V.kS),s[U]=0;var i=z.length(s);if(!R(i,0)){var S=Math.abs(V.friction*N.gravity[U]*t),E=i>S?(i-S)/i:0;V.kS[(U+1)%3]*=E,V.kS[(U+2)%3]*=E}}var s=z.create();function M(N,U,V,A,t){return z.set(A,0,0,0),S(N.testSolid,U,V,(function(N,U,V,n){A[U]=V,n[U]=0,t||(n[0]=0,n[1]=0,n[2]=0)}))}var a=new i([],[]),mN=z.create(),w=z.create(),X=z.create(),e=z.create();var Q=z.create(),u=new i([],[]),L=z.create();function I(N,U,V,A){return N.testSolid(Math.floor(U),Math.floor(V-1),Math.floor(A))}var o=z.create();function R(N,U){return Math.abs(N-U)<1e-5}function D(N,U){for(var V=0;V<3;V++)N.base[V]=U.base[V],N.max[V]=U.max[V],N.NE[V]=U.NE[V]}var G=function(N){}},13008:function(N,U){!function(N){"use strict";var U=function(N,V){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,U){N.__proto__=U}||function(N,U){for(var V in U)Object.prototype.hasOwnProperty.call(U,V)&&(N[V]=U[V])},U(N,V)};function V(N,V){if("function"!==typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function A(){this.constructor=N}U(N,V),N.prototype=null===V?Object.create(V):(A.prototype=V.prototype,new A)}function A(N,U,V,A){var t,n=arguments.length,q=n<3?U:null===A?A=Object.getOwnPropertyDescriptor(U,V):A;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)q=Reflect.decorate(N,U,V,A);else for(var i=N.length-1;i>=0;i--)(t=N[i])&&(q=(n<3?t(q):n>3?t(U,V,q):t(U,V))||q);return n>3&&q&&Object.defineProperty(U,V,q),q}function t(N,U,V){if(V||2===arguments.length)for(var A,t=0,n=U.length;t<n;t++)!A&&t in U||(A||(A=Array.prototype.slice.call(U,0,t)),A[t]=U[t]);return N.concat(A||Array.prototype.slice.call(U))}var n,q=255,i=213;N.OPERATION=void 0,(n=N.OPERATION||(N.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.TOUCH=1]="TOUCH",n[n.CLEAR=10]="CLEAR";var z=function(){function U(N,U,V){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=N,this.setParent(U,V)}return U.prototype.setParent=function(N,U,V){var A=this;if(this.indexes||(this.indexes=this.ref instanceof eN?this.ref._definition.indexes:{}),this.parent=N,this.parentIndex=V,U)if(this.root=U,this.ref instanceof eN){var t=this.ref._definition;for(var n in t.schema){var q=this.ref[n];if(q&&q.$changes){var i=t.indexes[n];q.$changes.setParent(this.ref,U,i)}}}else"object"===typeof this.ref&&this.ref.forEach((function(N,U){if(N instanceof eN){var V=N.$changes,t=A.ref.$changes.indexes[U];V.setParent(A.ref,A.root,t)}}))},U.prototype.operation=function(N){this.changes.set(--this.currentCustomOperation,N)},U.prototype.change=function(U,V){void 0===V&&(V=N.OPERATION.ADD);var A="number"===typeof U?U:this.indexes[U];this.assertValidIndex(A,U);var t=this.changes.get(A);t&&t.op!==N.OPERATION.DELETE&&t.op!==N.OPERATION.TOUCH||this.changes.set(A,{op:t&&t.op===N.OPERATION.DELETE?N.OPERATION.DELETE_AND_ADD:V,index:A}),this.allChanges.add(A),this.changed=!0,this.touchParents()},U.prototype.touch=function(U){var V="number"===typeof U?U:this.indexes[U];this.assertValidIndex(V,U),this.changes.has(V)||this.changes.set(V,{op:N.OPERATION.TOUCH,index:V}),this.allChanges.add(V),this.touchParents()},U.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},U.prototype.getType=function(N){if(this.ref._definition)return(U=this.ref._definition).schema[U.fieldsByIndex[N]];var U,V=(U=this.parent._definition).schema[U.fieldsByIndex[this.parentIndex]];return Object.values(V)[0]},U.prototype.getChildrenFilter=function(){var N=this.parent._definition.childFilters;return N&&N[this.parentIndex]},U.prototype.getValue=function(N){return this.ref.getByIndex(N)},U.prototype.delete=function(U){var V="number"===typeof U?U:this.indexes[U];if(void 0!==V){var A=this.getValue(V);this.changes.set(V,{op:N.OPERATION.DELETE,index:V}),this.allChanges.delete(V),delete this.caches[V],A&&A.$changes&&(A.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(U," (").concat(V,")"))},U.prototype.discard=function(U,V){var A=this;void 0===U&&(U=!1),void 0===V&&(V=!1),this.ref instanceof eN||this.changes.forEach((function(U){if(U.op===N.OPERATION.DELETE){var V=A.ref.getIndex(U.index);delete A.indexes[V]}})),this.changes.clear(),this.changed=U,V&&this.allChanges.clear(),this.currentCustomOperation=0},U.prototype.discardAll=function(){var N=this;this.changes.forEach((function(U){var V=N.getValue(U.index);V&&V.$changes&&V.$changes.discardAll()})),this.discard()},U.prototype.cache=function(N,U){this.caches[N]=U},U.prototype.clone=function(){return new U(this.ref,this.parent,this.root)},U.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},U.prototype.assertValidIndex=function(N,U){if(void 0===N)throw new Error('ChangeTree: missing index for field "'.concat(U,'"'))},U}();function S(N,U,V,A){return N[U]||(N[U]=[]),N[U].push(V),null===A||void 0===A||A.forEach((function(N,U){return V(N,U)})),function(){return p(N[U],N[U].indexOf(V))}}function E(U){var V=this,A="string"!==typeof this.$changes.getType();this.$items.forEach((function(t,n){U.push({refId:V.$changes.refId,op:N.OPERATION.DELETE,field:n,value:void 0,previousValue:t}),A&&V.$changes.root.removeRef(t.$changes.refId)}))}function p(N,U){if(-1===U||U>=N.length)return!1;for(var V=N.length-1,A=U;A<V;A++)N[A]=N[A+1];return N.length=V,!0}var k=function(N,U){var V=N.toString(),A=U.toString();return V<A?-1:V>A?1:0};function B(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,U){return"symbol"===typeof U||isNaN(U)?N[U]:N.at(U)},set:function(N,U,V){if("symbol"===typeof U||isNaN(U))N[U]=V;else{var A=Array.from(N.$items.keys()),t=parseInt(A[U]||U);void 0===V||null===V?N.deleteAt(t):N.setAt(t,V)}return!0},deleteProperty:function(N,U){return"number"===typeof U?N.deleteAt(U):delete N[U],!0}})}var C=function(){function U(){for(var N=[],U=0;U<arguments.length;U++)N[U]=arguments[U];this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,N)}return U.prototype.Li=function(U,V){return void 0===V&&(V=!0),S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,U,V?this.$items:void 0)},U.prototype.IV=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,U)},U.is=function(N){return Array.isArray(N)||void 0!==N.array},Object.defineProperty(U.prototype,"length",{get:function(){return this.$items.size},set:function(N){0===N?this.clear():this.splice(N,this.length-N)},enumerable:!1,configurable:!0}),U.prototype.push=function(){for(var N,U=this,V=[],A=0;A<arguments.length;A++)V[A]=arguments[A];return V.forEach((function(V){N=U.$refId++,U.setAt(N,V)})),N},U.prototype.pop=function(){var N=Array.from(this.$indexes.values()).pop();if(void 0!==N){this.$changes.delete(N),this.$indexes.delete(N);var U=this.$items.get(N);return this.$items.delete(N),U}},U.prototype.at=function(N){var U=Array.from(this.$items.keys())[N];return this.$items.get(U)},U.prototype.setAt=function(U,V){var A,t;if(void 0!==V&&null!==V){if(this.$items.get(U)!==V){void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,U);var n=null!==(t=null===(A=this.$changes.indexes[U])||void 0===A?void 0:A.op)&&void 0!==t?t:N.OPERATION.ADD;this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,V),this.$changes.change(U,n)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},U.prototype.deleteAt=function(N){var U=Array.from(this.$items.keys())[N];return void 0!==U&&this.$deleteAt(U)},U.prototype.$deleteAt=function(N){return this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&E.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.concat=function(){for(var N,V=[],A=0;A<arguments.length;A++)V[A]=arguments[A];return new(U.bind.apply(U,t([void 0],(N=Array.from(this.$items.values())).concat.apply(N,V),!1)))},U.prototype.join=function(N){return Array.from(this.$items.values()).join(N)},U.prototype.reverse=function(){var N=this,U=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(V,A){N.setAt(U[A],V)})),this},U.prototype.shift=function(){var N=Array.from(this.$items.keys()).shift();if(void 0!==N){var U=this.$items.get(N);return this.$deleteAt(N),U}},U.prototype.slice=function(N,V){var A=new U;return A.push.apply(A,Array.from(this.$items.values()).slice(N,V)),A},U.prototype.sort=function(N){var U=this;void 0===N&&(N=k);var V=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(N).forEach((function(N,A){U.setAt(V[A],N)})),this},U.prototype.splice=function(N,U){void 0===U&&(U=this.length-N);for(var V=Array.from(this.$items.keys()),A=[],t=N;t<N+U;t++)A.push(this.$items.get(V[t])),this.$deleteAt(V[t]);return A},U.prototype.unshift=function(){for(var N=this,U=[],V=0;V<arguments.length;V++)U[V]=arguments[V];var A=this.length,t=U.length,n=Array.from(this.$items.values());return U.forEach((function(U,V){N.setAt(V,U)})),n.forEach((function(U,V){N.setAt(t+V,U)})),A+t},U.prototype.indexOf=function(N,U){return Array.from(this.$items.values()).indexOf(N,U)},U.prototype.lastIndexOf=function(N,U){return void 0===U&&(U=this.length-1),Array.from(this.$items.values()).lastIndexOf(N,U)},U.prototype.every=function(N,U){return Array.from(this.$items.values()).every(N,U)},U.prototype.some=function(N,U){return Array.from(this.$items.values()).some(N,U)},U.prototype.forEach=function(N,U){Array.from(this.$items.values()).forEach(N,U)},U.prototype.map=function(N,U){return Array.from(this.$items.values()).map(N,U)},U.prototype.filter=function(N,U){return Array.from(this.$items.values()).filter(N,U)},U.prototype.reduce=function(N,U){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},U.prototype.reduceRight=function(N,U){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},U.prototype.find=function(N,U){return Array.from(this.$items.values()).find(N,U)},U.prototype.findIndex=function(N,U){return Array.from(this.$items.values()).findIndex(N,U)},U.prototype.fill=function(N,U,V){throw new Error("ArraySchema#fill() not implemented")},U.prototype.copyWithin=function(N,U,V){throw new Error("ArraySchema#copyWithin() not implemented")},U.prototype.toString=function(){return this.$items.toString()},U.prototype.toLocaleString=function(){return this.$items.toLocaleString()},U.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},U.prototype.includes=function(N,U){return Array.from(this.$items.values()).includes(N,U)},U.prototype.flatMap=function(N,U){throw new Error("ArraySchema#flatMap() is not supported.")},U.prototype.flat=function(N){throw new Error("ArraySchema#flat() is not supported.")},U.prototype.findLast=function(){var N=Array.from(this.$items.values());return N.findLast.apply(N,arguments)},U.prototype.findLastIndex=function(){var N=Array.from(this.$items.values());return N.findLastIndex.apply(N,arguments)},U.prototype.setIndex=function(N,U){this.$indexes.set(N,U)},U.prototype.getIndex=function(N){return this.$indexes.get(N)},U.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},U.prototype.deleteByIndex=function(N){var U=this.$indexes.get(N);this.$items.delete(U),this.$indexes.delete(N)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){return this.toArray().map((function(N){return"function"===typeof N.toJSON?N.toJSON():N}))},U.prototype.clone=function(N){return N?new(U.bind.apply(U,t([void 0],Array.from(this.$items.values()),!1))):new(U.bind.apply(U,t([void 0],this.map((function(N){return N.$changes?N.clone():N})),!1)))},U}();function x(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,U){return"symbol"!==typeof U&&"undefined"===typeof N[U]?N.get(U):N[U]},set:function(N,U,V){return"symbol"!==typeof U&&-1===U.indexOf("$")&&"Li"!==U&&"IV"!==U&&"onChange"!==U?N.set(U,V):N[U]=V,!0},deleteProperty:function(N,U){return N.delete(U),!0}})}var J=function(){function U(N){var V=this;if(this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N)if(N instanceof Map||N instanceof U)N.forEach((function(N,U){return V.set(U,N)}));else for(var A in N)this.set(A,N[A])}return U.prototype.Li=function(U,V){return void 0===V&&(V=!0),S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,U,V?this.$items:void 0)},U.prototype.IV=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,U)},U.is=function(N){return void 0!==N.map},U.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(U.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.set=function(U,V){if(void 0===V||null===V)throw new Error("MapSchema#set('".concat(U,"', ").concat(V,"): trying to set ").concat(V," value on '").concat(U,"'."));U=U.toString();var A="undefined"!==typeof this.$changes.indexes[U],t=A?this.$changes.indexes[U]:this.$refId++,n=A?N.OPERATION.REPLACE:N.OPERATION.ADD,q=void 0!==V.$changes;if(q&&V.$changes.setParent(this,this.$changes.root,t),A){if(!q&&this.$items.get(U)===V)return;q&&this.$items.get(U)!==V&&(n=N.OPERATION.ADD)}else this.$changes.indexes[U]=t,this.$indexes.set(t,U);return this.$items.set(U,V),this.$changes.change(U,n),this},U.prototype.get=function(N){return this.$items.get(N)},U.prototype.delete=function(N){return this.$changes.delete(N),this.$items.delete(N)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&E.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(N){return this.$items.has(N)},U.prototype.forEach=function(N){this.$items.forEach(N)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(N,U){this.$indexes.set(N,U)},U.prototype.getIndex=function(N){return this.$indexes.get(N)},U.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},U.prototype.deleteByIndex=function(N){var U=this.$indexes.get(N);this.$items.delete(U),this.$indexes.delete(N)},U.prototype.toJSON=function(){var N={};return this.forEach((function(U,V){N[V]="function"===typeof U.toJSON?U.toJSON():U})),N},U.prototype.clone=function(N){var V;return N?V=Object.assign(new U,this):(V=new U,this.forEach((function(N,U){N.$changes?V.set(U,N.clone()):V.set(U,N)}))),V},U}(),d={};function r(N,U){d[N]=U}function v(N){return d[N]}var h=function(){function N(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return N.create=function(U){var V=new N;return V.schema=Object.assign({},U&&U.schema||{}),V.indexes=Object.assign({},U&&U.indexes||{}),V.fieldsByIndex=Object.assign({},U&&U.fieldsByIndex||{}),V.descriptors=Object.assign({},U&&U.descriptors||{}),V.deprecated=Object.assign({},U&&U.deprecated||{}),V},N.prototype.addField=function(N,U){var V=this.getNextFieldIndex();this.fieldsByIndex[V]=N,this.indexes[N]=V,this.schema[N]=Array.isArray(U)?{array:U[0]}:U},N.prototype.hasField=function(N){return void 0!==this.indexes[N]},N.prototype.addFilter=function(N,U){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[N]]=U,this.indexesWithFilters.push(this.indexes[N]),!0},N.prototype.addChildrenFilter=function(N,U){var V=this.indexes[N],A=this.schema[N];if(v(Object.keys(A)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[V]=U,!0;console.warn("@filterChildren: field '".concat(N,"' can't have children. Ignoring filter."))},N.prototype.getChildrenFilter=function(N){return this.childFilters&&this.childFilters[this.indexes[N]]},N.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},N}();function c(N){return N._context&&N._context.useFilters}var H=function(){function N(){this.types={},this.schemas=new Map,this.useFilters=!1}return N.prototype.has=function(N){return this.schemas.has(N)},N.prototype.get=function(N){return this.types[N]},N.prototype.add=function(N,U){void 0===U&&(U=this.schemas.size),N._definition=h.create(N._definition),N._typeid=U,this.types[U]=N,this.schemas.set(N,U)},N.create=function(U){return void 0===U&&(U={}),function(V){return U.context||(U.context=new N),W(V,U)}},N}(),Y=new H;function W(N,U){return void 0===U&&(U={}),function(V,A){var n=U.context||Y,q=V.constructor;if(q._context=n,!N)throw new Error("".concat(q.name,': @type() reference provided for "').concat(A,"\" is undefined. Make sure you don't have any circular dependencies."));n.has(q)||n.add(q);var i=q._definition;if(i.addField(A,N),i.descriptors[A]){if(i.deprecated[A])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(A,"' definition on '").concat(q.name,"'.\nCheck @type() annotation"))}catch(d){var z=d.stack.split("\n")[4].trim();throw new Error("".concat(d.message," ").concat(z))}}var S=C.is(N),E=!S&&J.is(N);if("string"!==typeof N&&!eN.is(N)){var p=Object.values(N)[0];"string"===typeof p||n.has(p)||n.add(p)}if(U.manual)i.descriptors[A]={enumerable:!0,configurable:!0,writable:!0};else{var k="_".concat(A);i.descriptors[k]={enumerable:!1,configurable:!1,writable:!0},i.descriptors[A]={get:function(){return this[k]},set:function(N){N!==this[k]&&(void 0!==N&&null!==N?(!S||N instanceof C||(N=new(C.bind.apply(C,t([void 0],N,!1)))),!E||N instanceof J||(N=new J(N)),void 0===N.$proxy&&(E?N=x(N):S&&(N=B(N))),this.$changes.change(A),N.$changes&&N.$changes.setParent(this,this.$changes.root,this._definition.indexes[A])):this[k]&&this.$changes.delete(A),this[k]=N)},enumerable:!0,configurable:!0}}}}function s(N){return function(U,V){var A=U.constructor;A._definition.addFilter(V,N)&&(A._context.useFilters=!0)}}function M(N){return function(U,V){var A=U.constructor;A._definition.addChildrenFilter(V,N)&&(A._context.useFilters=!0)}}function a(N){return void 0===N&&(N=!0),function(U,V){var A=U.constructor._definition;A.deprecated[V]=!0,N&&(A.descriptors[V]={get:function(){throw new Error("".concat(V," is deprecated."))},set:function(N){},enumerable:!1,configurable:!0})}}function mN(N,U,V){for(var A in void 0===V&&(V={}),V.context||(V.context=N._context||V.context||Y),U)W(U[A],V)(N.prototype,A);return N}function w(N){for(var U=0,V=0,A=0,t=N.length;A<t;A++)(U=N.charCodeAt(A))<128?V+=1:U<2048?V+=2:U<55296||U>=57344?V+=3:(A++,V+=4);return V}function X(N,U,V){for(var A=0,t=0,n=V.length;t<n;t++)(A=V.charCodeAt(t))<128?N[U++]=A:A<2048?(N[U++]=192|A>>6,N[U++]=128|63&A):A<55296||A>=57344?(N[U++]=224|A>>12,N[U++]=128|A>>6&63,N[U++]=128|63&A):(t++,A=65536+((1023&A)<<10|1023&V.charCodeAt(t)),N[U++]=240|A>>18,N[U++]=128|A>>12&63,N[U++]=128|A>>6&63,N[U++]=128|63&A)}function e(N,U){N.push(255&U)}function Q(N,U){N.push(255&U)}function u(N,U){N.push(255&U),N.push(U>>8&255)}function L(N,U){N.push(255&U),N.push(U>>8&255)}function I(N,U){N.push(255&U),N.push(U>>8&255),N.push(U>>16&255),N.push(U>>24&255)}function o(N,U){var V=U>>24,A=U>>16,t=U>>8,n=U;N.push(255&n),N.push(255&t),N.push(255&A),N.push(255&V)}function R(N,U){var V=Math.floor(U/Math.pow(2,32));o(N,U>>>0),o(N,V)}function D(N,U){var V=U/Math.pow(2,32)|0;o(N,U>>>0),o(N,V)}function G(N,U){F(N,U)}function g(N,U){P(N,U)}var l=new Int32Array(2),K=new Float32Array(l.buffer),j=new Float64Array(l.buffer);function F(N,U){K[0]=U,I(N,l[0])}function P(N,U){j[0]=U,I(N,l[0]),I(N,l[1])}function T(N,U){return Q(N,U?1:0)}function f(N,U){U||(U="");var V=w(U),A=0;if(V<32)N.push(160|V),A=1;else if(V<256)N.push(217),Q(N,V),A=2;else if(V<65536)N.push(218),L(N,V),A=3;else{if(!(V<4294967296))throw new Error("String too long");N.push(219),o(N,V),A=5}return X(N,N.length,U),A+V}function O(N,U){return isNaN(U)?O(N,0):isFinite(U)?U!==(0|U)?(N.push(203),P(N,U),9):U>=0?U<128?(Q(N,U),1):U<256?(N.push(204),Q(N,U),2):U<65536?(N.push(205),L(N,U),3):U<4294967296?(N.push(206),o(N,U),5):(N.push(207),D(N,U),9):U>=-32?(N.push(224|U+32),1):U>=-128?(N.push(208),e(N,U),2):U>=-32768?(N.push(209),u(N,U),3):U>=-2147483648?(N.push(210),I(N,U),5):(N.push(211),R(N,U),9):O(N,U>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Z=Object.freeze({__proto__:null,utf8Write:X,int8:e,uint8:Q,int16:u,uint16:L,int32:I,uint32:o,int64:R,uint64:D,float32:G,float64:g,writeFloat32:F,writeFloat64:P,boolean:T,string:f,number:O});function b(N,U,V){for(var A="",t=0,n=U,q=U+V;n<q;n++){var i=N[n];0!==(128&i)?192!==(224&i)?224!==(240&i)?240!==(248&i)?console.error("Invalid byte "+i.toString(16)):(t=(7&i)<<18|(63&N[++n])<<12|(63&N[++n])<<6|63&N[++n])>=65536?(t-=65536,A+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):A+=String.fromCharCode(t):A+=String.fromCharCode((15&i)<<12|(63&N[++n])<<6|63&N[++n]):A+=String.fromCharCode((31&i)<<6|63&N[++n]):A+=String.fromCharCode(i)}return A}function y(N,U){return NN(N,U)<<24>>24}function NN(N,U){return N[U.offset++]}function UN(N,U){return VN(N,U)<<16>>16}function VN(N,U){return N[U.offset++]|N[U.offset++]<<8}function AN(N,U){return N[U.offset++]|N[U.offset++]<<8|N[U.offset++]<<16|N[U.offset++]<<24}function tN(N,U){return AN(N,U)>>>0}function nN(N,U){return kN(N,U)}function qN(N,U){return BN(N,U)}function iN(N,U){var V=tN(N,U);return AN(N,U)*Math.pow(2,32)+V}function zN(N,U){var V=tN(N,U);return tN(N,U)*Math.pow(2,32)+V}var SN=new Int32Array(2),EN=new Float32Array(SN.buffer),pN=new Float64Array(SN.buffer);function kN(N,U){return SN[0]=AN(N,U),EN[0]}function BN(N,U){return SN[0]=AN(N,U),SN[1]=AN(N,U),pN[0]}function CN(N,U){return NN(N,U)>0}function xN(N,U){var V,A=N[U.offset++];A<192?V=31&A:217===A?V=NN(N,U):218===A?V=VN(N,U):219===A&&(V=tN(N,U));var t=b(N,U.offset,V);return U.offset+=V,t}function JN(N,U){var V=N[U.offset];return V<192&&V>160||217===V||218===V||219===V}function dN(N,U){var V=N[U.offset++];return V<128?V:202===V?kN(N,U):203===V?BN(N,U):204===V?NN(N,U):205===V?VN(N,U):206===V?tN(N,U):207===V?zN(N,U):208===V?y(N,U):209===V?UN(N,U):210===V?AN(N,U):211===V?iN(N,U):V>223?-1*(255-V+1):void 0}function rN(N,U){var V=N[U.offset];return V<128||V>=202&&V<=211}function vN(N,U){return N[U.offset]<160}function hN(N,U){return N[U.offset-1]===q&&(N[U.offset]<128||N[U.offset]>=202&&N[U.offset]<=211)}var cN=Object.freeze({__proto__:null,int8:y,uint8:NN,int16:UN,uint16:VN,int32:AN,uint32:tN,float32:nN,float64:qN,int64:iN,uint64:zN,readFloat32:kN,readFloat64:BN,boolean:CN,string:xN,stringCheck:JN,number:dN,numberCheck:rN,arrayCheck:vN,switchStructureCheck:hN}),HN=function(){function U(N){var U=this;this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return U.add(N)}))}return U.prototype.Li=function(U,V){return void 0===V&&(V=!0),S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,U,V?this.$items:void 0)},U.prototype.IV=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,U)},U.is=function(N){return void 0!==N.collection},U.prototype.add=function(N){var U=this.$refId++;return void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,U),this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,N),this.$changes.change(U),U},U.prototype.at=function(N){var U=Array.from(this.$items.keys())[N];return this.$items.get(U)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(N){for(var U,V,A=this.$items.entries();(V=A.next())&&!V.done;)if(N===V.value[1]){U=V.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&E.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(N){return Array.from(this.$items.values()).some((function(U){return U===N}))},U.prototype.forEach=function(N){var U=this;this.$items.forEach((function(V,A,t){return N(V,A,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(N,U){this.$indexes.set(N,U)},U.prototype.getIndex=function(N){return this.$indexes.get(N)},U.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},U.prototype.deleteByIndex=function(N){var U=this.$indexes.get(N);this.$items.delete(U),this.$indexes.delete(N)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var N=[];return this.forEach((function(U,V){N.push("function"===typeof U.toJSON?U.toJSON():U)})),N},U.prototype.clone=function(N){var V;return N?V=Object.assign(new U,this):(V=new U,this.forEach((function(N){N.$changes?V.add(N.clone()):V.add(N)}))),V},U}(),YN=function(){function U(N){var U=this;this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return U.add(N)}))}return U.prototype.Li=function(U,V){return void 0===V&&(V=!0),S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,U,V?this.$items:void 0)},U.prototype.IV=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,U)},U.is=function(N){return void 0!==N.set},U.prototype.add=function(U){var V,A;if(this.has(U))return!1;var t=this.$refId++;void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,t);var n=null!==(A=null===(V=this.$changes.indexes[t])||void 0===V?void 0:V.op)&&void 0!==A?A:N.OPERATION.ADD;return this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,U),this.$changes.change(t,n),t},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(N){for(var U,V,A=this.$items.entries();(V=A.next())&&!V.done;)if(N===V.value[1]){U=V.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&E.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(N){for(var U,V=this.$items.values(),A=!1;(U=V.next())&&!U.done;)if(N===U.value){A=!0;break}return A},U.prototype.forEach=function(N){var U=this;this.$items.forEach((function(V,A,t){return N(V,A,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(N,U){this.$indexes.set(N,U)},U.prototype.getIndex=function(N){return this.$indexes.get(N)},U.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},U.prototype.deleteByIndex=function(N){var U=this.$indexes.get(N);this.$items.delete(U),this.$indexes.delete(N)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var N=[];return this.forEach((function(U,V){N.push("function"===typeof U.toJSON?U.toJSON():U)})),N},U.prototype.clone=function(N){var V;return N?V=Object.assign(new U,this):(V=new U,this.forEach((function(N){N.$changes?V.add(N.clone()):V.add(N)}))),V},U}(),WN=function(){function N(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return N.prototype.addRefId=function(N){this.refIds.has(N)||(this.refIds.add(N),this.containerIndexes.set(N,new Set))},N.get=function(U){return void 0===U.$filterState&&(U.$filterState=new N),U.$filterState},N}(),sN=function(){function N(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return N.prototype.getNextUniqueId=function(){return this.nextUniqueId++},N.prototype.addRef=function(N,U,V){void 0===V&&(V=!0),this.refs.set(N,U),V&&(this.refCounts[N]=(this.refCounts[N]||0)+1)},N.prototype.removeRef=function(N){this.refCounts[N]=this.refCounts[N]-1,this.deletedRefs.add(N)},N.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},N.prototype.garbageCollectDeletedRefs=function(){var N=this;this.deletedRefs.forEach((function(U){if(!(N.refCounts[U]>0)){var V=N.refs.get(U);if(V instanceof eN)for(var A in V._definition.schema)"string"!==typeof V._definition.schema[A]&&V[A]&&V[A].$changes&&N.removeRef(V[A].$changes.refId);else{var t=V.$changes.parent._definition,n=t.schema[t.fieldsByIndex[V.$changes.parentIndex]];"function"===typeof Object.values(n)[0]&&Array.from(V.values()).forEach((function(U){return N.removeRef(U.$changes.refId)}))}N.refs.delete(U),delete N.refCounts[U]}})),this.deletedRefs.clear()},N}(),MN=function(N){function U(){return null!==N&&N.apply(this,arguments)||this}return V(U,N),U}(Error);function aN(N,U,V,A){var t,n=!1;switch(U){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":t="number",isNaN(N)&&console.log('trying to encode "NaN" in '.concat(V.constructor.name,"#").concat(A));break;case"string":t="string",n=!0;break;case"boolean":return}if(typeof N!==t&&(!n||n&&null!==N)){var q="'".concat(JSON.stringify(N),"'").concat(N&&N.constructor&&" (".concat(N.constructor.name,")")||"");throw new MN("a '".concat(t,"' was expected, but ").concat(q," was provided in ").concat(V.constructor.name,"#").concat(A))}}function mU(N,U,V,A){if(!(N instanceof U))throw new MN("a '".concat(U.name,"' was expected, but '").concat(N.constructor.name,"' was provided in ").concat(V.constructor.name,"#").concat(A))}function wN(N,U,V,A,t){aN(V,N,A,t);var n=Z[N];if(!n)throw new MN("a '".concat(N,"' was expected, but ").concat(V," was provided in ").concat(A.constructor.name,"#").concat(t));n(U,V)}function XN(N,U,V){return cN[N](U,V)}var eN=function(){function U(){for(var N=[],U=0;U<arguments.length;U++)N[U]=arguments[U];Object.defineProperties(this,{$changes:{value:new z(this,void 0,new sN),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var V=this._definition.descriptors;V&&Object.defineProperties(this,V),N[0]&&this.assign(N[0])}return U.onError=function(N){console.error(N)},U.is=function(N){return N._definition&&void 0!==N._definition.schema},U.prototype.onChange=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,U)},U.prototype.IV=function(U){return S(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,U)},U.prototype.assign=function(N){return Object.assign(this,N),this},Object.defineProperty(U.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),U.prototype.setDirty=function(N,U){this.$changes.change(N,U)},U.prototype.listen=function(N,U,V){var A=this;return void 0===V&&(V=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[N]||(this.$callbacks[N]=[]),this.$callbacks[N].push(U),V&&void 0!==this[N]&&U(this[N],void 0),function(){return p(A.$callbacks[N],A.$callbacks[N].indexOf(U))}},U.prototype.decode=function(V,A,t){var n;void 0===A&&(A={offset:0}),void 0===t&&(t=this);var i=[],z=this.$changes.root,S=V.length,E=0;for(z.refs.set(E,this);A.offset<S;){var p=V[A.offset++];if(p!=q){var k=t.$changes,B=void 0!==t._definition,x=B?p>>6<<6:p;if(x!==N.OPERATION.CLEAR){var d=B?p%(x||255):dN(V,A),r=B?t._definition.fieldsByIndex[d]:"",h=k.getType(d),c=void 0,H=void 0,Y=void 0;if(B?H=t["_".concat(r)]:(H=t.getByIndex(d),(x&N.OPERATION.ADD)===N.OPERATION.ADD?(Y=t instanceof J?xN(V,A):d,t.setIndex(d,Y)):Y=t.getIndex(d)),(x&N.OPERATION.DELETE)===N.OPERATION.DELETE&&(x!==N.OPERATION.DELETE_AND_ADD&&t.deleteByIndex(d),H&&H.$changes&&z.removeRef(H.$changes.refId),c=null),void 0!==r){if(x===N.OPERATION.DELETE);else if(U.is(h)){var W=dN(V,A);if(c=z.refs.get(W),x!==N.OPERATION.REPLACE){var s=this.getSchemaType(V,A,h);c||((c=this.createTypeInstance(s)).$changes.refId=W,H&&(c.$callbacks=H.$callbacks,H.$changes.refId&&W!==H.$changes.refId&&z.removeRef(H.$changes.refId))),z.addRef(W,c,c!==H)}}else if("string"===typeof h)c=XN(h,V,A);else{var M=v(Object.keys(h)[0]),a=dN(V,A),mN=z.refs.has(a)?H||z.refs.get(a):new M.constructor;if((c=mN.clone(!0)).$changes.refId=a,H&&(c.$callbacks=H.$callbacks,H.$changes.refId&&a!==H.$changes.refId)){z.removeRef(H.$changes.refId);for(var w=H.entries(),X=void 0;(X=w.next())&&!X.done;){var e=(n=X.value)[0],Q=n[1];i.push({refId:a,op:N.OPERATION.DELETE,field:e,value:void 0,previousValue:Q})}}z.addRef(a,c,mN!==H)}if(null!==c&&void 0!==c)if(c.$changes&&c.$changes.setParent(k.ref,k.root,d),t instanceof U)t[r]=c;else if(t instanceof J)e=Y,t.$items.set(e,c),t.$changes.allChanges.add(d);else if(t instanceof C)t.setAt(d,c);else if(t instanceof HN){var u=t.add(c);t.setIndex(d,u)}else t instanceof YN&&!1!==(u=t.add(c))&&t.setIndex(d,u);H!==c&&i.push({refId:E,op:x,field:r,dynamicIndex:Y,value:c,previousValue:H})}else{console.warn("@colyseus/schema: definition mismatch");for(var L={offset:A.offset};A.offset<S&&(!hN(V,A)||(L.offset=A.offset+1,!z.refs.has(dN(V,L))));)A.offset++}}else t.clear(i)}else{E=dN(V,A);var I=z.refs.get(E);if(!I)throw new Error('"refId" not found: '.concat(E));t=I}}return this._triggerChanges(i),z.garbageCollectDeletedRefs(),i},U.prototype.encode=function(V,A,t){void 0===V&&(V=!1),void 0===A&&(A=[]),void 0===t&&(t=!1);for(var n=this.$changes,i=new WeakSet,z=[n],S=1,E=0;E<S;E++){var p=z[E],k=p.ref,B=k instanceof U;p.ensureRefId(),i.add(p),p!==n&&(p.changed||V)&&(Q(A,q),O(A,p.refId));for(var C=V?Array.from(p.allChanges):Array.from(p.changes.values()),x=0,d=C.length;x<d;x++){var r=V?{op:N.OPERATION.ADD,index:C[x]}:C[x],h=r.index,c=B?k._definition.fieldsByIndex&&k._definition.fieldsByIndex[h]:h,H=A.length;if(r.op!==N.OPERATION.TOUCH)if(B)Q(A,h|r.op);else{if(Q(A,r.op),r.op===N.OPERATION.CLEAR)continue;O(A,h)}if(B||(r.op&N.OPERATION.ADD)!=N.OPERATION.ADD||k instanceof J&&f(A,p.ref.$indexes.get(h)),r.op!==N.OPERATION.DELETE){var Y=p.getType(h),W=p.getValue(h);if(W&&W.$changes&&!i.has(W.$changes)&&(z.push(W.$changes),W.$changes.ensureRefId(),S++),r.op!==N.OPERATION.TOUCH){if(U.is(Y))mU(W,Y,k,c),O(A,W.$changes.refId),(r.op&N.OPERATION.ADD)===N.OPERATION.ADD&&this.tryEncodeTypeId(A,Y,W.constructor);else if("string"===typeof Y)wN(Y,A,W,k,c);else{var s=v(Object.keys(Y)[0]);mU(k["_".concat(c)],s.constructor,k,c),O(A,W.$changes.refId)}t&&p.cache(h,A.slice(H))}}}V||t||p.discard()}return A},U.prototype.encodeAll=function(N){return this.encode(!0,[],N)},U.prototype.applyFilters=function(V,A){var t,n;void 0===A&&(A=!1);for(var i=this,z=new Set,S=WN.get(V),E=[this.$changes],p=1,k=[],B=function(B){var C=E[B];if(z.has(C.refId))return"continue";var x=C.ref,d=x instanceof U;Q(k,q),O(k,C.refId);var r=S.refIds.has(C),v=A||!r;S.addRefId(C);var h=S.containerIndexes.get(C),c=v?Array.from(C.allChanges):Array.from(C.changes.values());!A&&d&&x._definition.indexesWithFilters&&x._definition.indexesWithFilters.forEach((function(U){!h.has(U)&&C.allChanges.has(U)&&(v?c.push(U):c.push({op:N.OPERATION.ADD,index:U}))}));for(var H=0,Y=c.length;H<Y;H++){var W=v?{op:N.OPERATION.ADD,index:c[H]}:c[H];if(W.op!==N.OPERATION.CLEAR){var s=W.index;if(W.op!==N.OPERATION.DELETE){var M=C.getValue(s),a=C.getType(s);if(d){if((mN=x._definition.filters&&x._definition.filters[s])&&!mN.call(x,V,M,i)){M&&M.$changes&&z.add(M.$changes.refId);continue}}else{var mN,w=C.parent;if((mN=C.getChildrenFilter())&&!mN.call(w,V,x.$indexes.get(s),M,i)){M&&M.$changes&&z.add(M.$changes.refId);continue}}if(M.$changes&&(E.push(M.$changes),p++),W.op!==N.OPERATION.TOUCH)if(W.op===N.OPERATION.ADD||d)k.push.apply(k,null!==(t=C.caches[s])&&void 0!==t?t:[]),h.add(s);else if(h.has(s))k.push.apply(k,null!==(n=C.caches[s])&&void 0!==n?n:[]);else{if(h.add(s),Q(k,N.OPERATION.ADD),O(k,s),x instanceof J){var X=C.ref.$indexes.get(s);f(k,X)}M.$changes?O(k,M.$changes.refId):Z[a](k,M)}else M.$changes&&!d&&(Q(k,N.OPERATION.ADD),O(k,s),x instanceof J&&(X=C.ref.$indexes.get(s),f(k,X)),O(k,M.$changes.refId))}else d?Q(k,W.op|s):(Q(k,W.op),O(k,s))}else Q(k,W.op)}},C=0;C<p;C++)B(C);return k},U.prototype.clone=function(){var N,U=new this.constructor,V=this._definition.schema;for(var A in V)"object"===typeof this[A]&&"function"===typeof(null===(N=this[A])||void 0===N?void 0:N.clone)?U[A]=this[A].clone():U[A]=this[A];return U},U.prototype.toJSON=function(){var N=this._definition.schema,U=this._definition.deprecated,V={};for(var A in N)U[A]||null===this[A]||"undefined"===typeof this[A]||(V[A]="function"===typeof this[A].toJSON?this[A].toJSON():this["_".concat(A)]);return V},U.prototype.discardAllChanges=function(){this.$changes.discardAll()},U.prototype.getByIndex=function(N){return this[this._definition.fieldsByIndex[N]]},U.prototype.deleteByIndex=function(N){this[this._definition.fieldsByIndex[N]]=void 0},U.prototype.tryEncodeTypeId=function(N,U,V){U._typeid!==V._typeid&&(Q(N,i),O(N,V._typeid))},U.prototype.getSchemaType=function(N,U,V){var A;return N[U.offset]===i&&(U.offset++,A=this.constructor._context.get(dN(N,U))),A||V},U.prototype.createTypeInstance=function(N){var U=new N;return U.$changes.root=this.$changes.root,U},U.prototype._triggerChanges=function(V){for(var A,t,n,q,i,z,S,E,p,k=new Set,B=this.$changes.root.refs,C=function(C){var x=V[C],J=x.refId,d=B.get(J),r=d.$callbacks;if((x.op&N.OPERATION.DELETE)===N.OPERATION.DELETE&&x.previousValue instanceof U&&(null===(t=null===(A=x.previousValue.$callbacks)||void 0===A?void 0:A[N.OPERATION.DELETE])||void 0===t||t.forEach((function(N){return N()}))),!r)return"continue";if(d instanceof U){if(!k.has(J))try{null===(n=null===r||void 0===r?void 0:r[N.OPERATION.REPLACE])||void 0===n||n.forEach((function(N){return N()}))}catch(v){U.onError(v)}try{r.hasOwnProperty(x.field)&&(null===(q=r[x.field])||void 0===q||q.forEach((function(N){return N(x.value,x.previousValue)})))}catch(v){U.onError(v)}}else x.op===N.OPERATION.ADD&&void 0===x.previousValue?null===(i=r[N.OPERATION.ADD])||void 0===i||i.forEach((function(N){var U;return N(x.value,null!==(U=x.dynamicIndex)&&void 0!==U?U:x.field)})):x.op===N.OPERATION.DELETE?void 0!==x.previousValue&&(null===(z=r[N.OPERATION.DELETE])||void 0===z||z.forEach((function(N){var U;return N(x.previousValue,null!==(U=x.dynamicIndex)&&void 0!==U?U:x.field)}))):x.op===N.OPERATION.DELETE_AND_ADD&&(void 0!==x.previousValue&&(null===(S=r[N.OPERATION.DELETE])||void 0===S||S.forEach((function(N){var U;return N(x.previousValue,null!==(U=x.dynamicIndex)&&void 0!==U?U:x.field)}))),null===(E=r[N.OPERATION.ADD])||void 0===E||E.forEach((function(N){var U;return N(x.value,null!==(U=x.dynamicIndex)&&void 0!==U?U:x.field)}))),x.value!==x.previousValue&&(null===(p=r[N.OPERATION.REPLACE])||void 0===p||p.forEach((function(N){var U;return N(x.value,null!==(U=x.dynamicIndex)&&void 0!==U?U:x.field)})));k.add(J)},x=0;x<V.length;x++)C(x)},U._definition=h.create(),U}();function QN(N){for(var U=[N.$changes],V=1,A={},t=A,n=function(N){var V=U[N];V.changes.forEach((function(N){var U=V.ref,A=N.index,n=U._definition?U._definition.fieldsByIndex[A]:U.$indexes.get(A);t[n]=V.getValue(A)}))},q=0;q<V;q++)n(q);return A}var uN={context:new H},LN=function(N){function U(){return null!==N&&N.apply(this,arguments)||this}return V(U,N),A([W("string",uN)],U.prototype,"name",void 0),A([W("string",uN)],U.prototype,"type",void 0),A([W("number",uN)],U.prototype,"referencedType",void 0),U}(eN),IN=function(N){function U(){var U=null!==N&&N.apply(this,arguments)||this;return U.fields=new C,U}return V(U,N),A([W("number",uN)],U.prototype,"id",void 0),A([W([LN],uN)],U.prototype,"fields",void 0),U}(eN),oN=function(N){function U(){var U=null!==N&&N.apply(this,arguments)||this;return U.types=new C,U}return V(U,N),U.encode=function(N){var V=N.constructor,A=new U;A.rootType=V._typeid;var t=function(N,U){for(var V in U){var t=new LN;t.name=V;var n=void 0;if("string"===typeof U[V])n=U[V];else{var q=U[V],i=void 0;eN.is(q)?(n="ref",i=U[V]):"string"===typeof q[n=Object.keys(q)[0]]?n+=":"+q[n]:i=q[n],t.referencedType=i?i._typeid:-1}t.type=n,N.fields.push(t)}A.types.push(N)},n=V._context.types;for(var q in n){var i=new IN;i.id=Number(q),t(i,n[q]._definition.schema)}return A.encodeAll()},U.decode=function(N,A){var t=new H,n=new U;n.decode(N,A);var q=n.types.reduce((function(N,U){var A=function(N){function U(){return null!==N&&N.apply(this,arguments)||this}return V(U,N),U}(eN),n=U.id;return N[n]=A,t.add(A,n),N}),{});n.types.forEach((function(N){var U=q[N.id];N.fields.forEach((function(N){var V;if(void 0!==N.referencedType){var A=N.type,n=q[N.referencedType];if(!n){var i=N.type.split(":");A=i[0],n=i[1]}"ref"===A?W(n,{context:t})(U.prototype,N.name):W(((V={})[A]=n,V),{context:t})(U.prototype,N.name)}else W(N.type,{context:t})(U.prototype,N.name)}))}));var i=q[n.rootType],z=new i;for(var S in i._definition.schema){var E=i._definition.schema[S];"string"!==typeof E&&(z[S]="function"===typeof E?new E:new(v(Object.keys(E)[0]).constructor))}return z},A([W([IN],uN)],U.prototype,"types",void 0),A([W("number",uN)],U.prototype,"rootType",void 0),U}(eN);r("map",{constructor:J}),r("array",{constructor:C}),r("set",{constructor:YN}),r("collection",{constructor:HN}),N.ArraySchema=C,N.CollectionSchema=HN,N.Context=H,N.MapSchema=J,N.Reflection=oN,N.ReflectionField=LN,N.ReflectionType=IN,N.Schema=eN,N.SchemaDefinition=h,N.SetSchema=YN,N.decode=cN,N.defineTypes=mN,N.deprecated=a,N.dumpChanges=QN,N.encode=Z,N.filter=s,N.filterChildren=M,N.hasFilter=c,N.registerType=r,N.type=W,Object.defineProperty(N,"__esModule",{value:!0})}(U)},14454:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14448:(N,U,V)=>{var A=V(14454),t=V(14456),n=Object.hasOwnProperty,q=Object.create(null);for(var i in A)n.call(A,i)&&(q[A[i]]=i);var z=N.exports={to:{},get:{}};function S(N,U,V){return Math.min(Math.max(U,N),V)}function E(N){var U=Math.round(N).toString(16).toUpperCase();return U.length<2?"0"+U:U}z.get=function(N){var U,V;switch(N.substring(0,3).toLowerCase()){case"hsl":U=z.get.hsl(N),V="hsl";break;case"hwb":U=z.get.hwb(N),V="hwb";break;default:U=z.get.rgb(N),V="rgb"}return U?{model:V,value:U}:null},z.get.rgb=function(N){if(!N)return null;var U,V,t,q=[0,0,0,1];if(U=N.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(t=U[2],U=U[1],V=0;V<3;V++){var i=2*V;q[V]=parseInt(U.slice(i,i+2),16)}t&&(q[3]=parseInt(t,16)/255)}else if(U=N.match(/^#([a-f0-9]{3,4})$/i)){for(t=(U=U[1])[3],V=0;V<3;V++)q[V]=parseInt(U[V]+U[V],16);t&&(q[3]=parseInt(t+t,16)/255)}else if(U=N.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(V=0;V<3;V++)q[V]=parseInt(U[V+1],0);U[4]&&(U[5]?q[3]=.01*parseFloat(U[4]):q[3]=parseFloat(U[4]))}else{if(!(U=N.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(U=N.match(/^(\w+)$/))?"transparent"===U[1]?[0,0,0,0]:n.call(A,U[1])?((q=A[U[1]])[3]=1,q):null:null;for(V=0;V<3;V++)q[V]=Math.round(2.55*parseFloat(U[V+1]));U[4]&&(U[5]?q[3]=.01*parseFloat(U[4]):q[3]=parseFloat(U[4]))}for(V=0;V<3;V++)q[V]=S(q[V],0,255);return q[3]=S(q[3],0,1),q},z.get.hsl=function(N){if(!N)return null;var U=N.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var V=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,S(parseFloat(U[2]),0,100),S(parseFloat(U[3]),0,100),S(isNaN(V)?1:V,0,1)]}return null},z.get.hwb=function(N){if(!N)return null;var U=N.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var V=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,S(parseFloat(U[2]),0,100),S(parseFloat(U[3]),0,100),S(isNaN(V)?1:V,0,1)]}return null},z.to.hex=function(){var N=t(arguments);return"#"+E(N[0])+E(N[1])+E(N[2])+(N[3]<1?E(Math.round(255*N[3])):"")},z.to.rgb=function(){var N=t(arguments);return N.length<4||1===N[3]?"rgb("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+")":"rgba("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+", "+N[3]+")"},z.to.rgb.percent=function(){var N=t(arguments),U=Math.round(N[0]/255*100),V=Math.round(N[1]/255*100),A=Math.round(N[2]/255*100);return N.length<4||1===N[3]?"rgb("+U+"%, "+V+"%, "+A+"%)":"rgba("+U+"%, "+V+"%, "+A+"%, "+N[3]+")"},z.to.hsl=function(){var N=t(arguments);return N.length<4||1===N[3]?"hsl("+N[0]+", "+N[1]+"%, "+N[2]+"%)":"hsla("+N[0]+", "+N[1]+"%, "+N[2]+"%, "+N[3]+")"},z.to.hwb=function(){var N=t(arguments),U="";return N.length>=4&&1!==N[3]&&(U=", "+N[3]),"hwb("+N[0]+", "+N[1]+"%, "+N[2]+"%"+U+")"},z.to.keyword=function(N){return q[N.slice(0,3)]}},14443:(N,U,V)=>{const A=V(14448),t=V(14471),n=["keyword","gray","hex"],q={};for(const B of Object.keys(t))q[[...t[B].labels].sort().join("")]=B;const i={};function z(N,U){if(!(this instanceof z))return new z(N,U);if(U&&U in n&&(U=null),U&&!(U in t))throw new Error("Unknown model: "+U);let V,S;if(null==N)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(N instanceof z)this.model=N.model,this.color=[...N.color],this.valpha=N.valpha;else if("string"===typeof N){const U=A.get(N);if(null===U)throw new Error("Unable to parse color from string: "+N);this.model=U.model,S=t[this.model].channels,this.color=U.value.slice(0,S),this.valpha="number"===typeof U.value[S]?U.value[S]:1}else if(N.length>0){this.model=U||"rgb",S=t[this.model].channels;const V=Array.prototype.slice.call(N,0,S);this.color=k(V,S),this.valpha="number"===typeof N[S]?N[S]:1}else if("number"===typeof N)this.model="rgb",this.color=[N>>16&255,N>>8&255,255&N],this.valpha=1;else{this.valpha=1;const U=Object.keys(N);"alpha"in N&&(U.splice(U.indexOf("alpha"),1),this.valpha="number"===typeof N.alpha?N.alpha:0);const A=U.sort().join("");if(!(A in q))throw new Error("Unable to parse color from object: "+JSON.stringify(N));this.model=q[A];const{labels:n}=t[this.model],i=[];for(V=0;V<n.length;V++)i.push(N[n[V]]);this.color=k(i)}if(i[this.model])for(S=t[this.model].channels,V=0;V<S;V++){const N=i[this.model][V];N&&(this.color[V]=N(this.color[V]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}z.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(N){let U=this.model in A.to?this:this.rgb();U=U.round("number"===typeof N?N:1);const V=1===U.valpha?U.color:[...U.color,this.valpha];return A.to[U.model](V)},percentString(N){const U=this.rgb().round("number"===typeof N?N:1),V=1===U.valpha?U.color:[...U.color,this.valpha];return A.to.rgb.percent(V)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const N={},{channels:U}=t[this.model],{labels:V}=t[this.model];for(let A=0;A<U;A++)N[V[A]]=this.color[A];return 1!==this.valpha&&(N.alpha=this.valpha),N},unitArray(){const N=this.rgb().color;return N[0]/=255,N[1]/=255,N[2]/=255,1!==this.valpha&&N.push(this.valpha),N},unitObject(){const N=this.rgb().object();return N.r/=255,N.g/=255,N.b/=255,1!==this.valpha&&(N.alpha=this.valpha),N},round(N){return N=Math.max(N||0,0),new z([...this.color.map(S(N)),this.valpha],this.model)},alpha(N){return void 0!==N?new z([...this.color,Math.max(0,Math.min(1,N))],this.model):this.valpha},red:E("rgb",0,p(255)),green:E("rgb",1,p(255)),blue:E("rgb",2,p(255)),hue:E(["hsl","hsv","hsl","hwb","hcg"],0,(N=>(N%360+360)%360)),saturationl:E("hsl",1,p(100)),lightness:E("hsl",2,p(100)),saturationv:E("hsv",1,p(100)),value:E("hsv",2,p(100)),chroma:E("hcg",1,p(100)),gray:E("hcg",2,p(100)),white:E("hwb",1,p(100)),wblack:E("hwb",2,p(100)),cyan:E("cmyk",0,p(100)),magenta:E("cmyk",1,p(100)),yellow:E("cmyk",2,p(100)),black:E("cmyk",3,p(100)),x:E("xyz",0,p(95.047)),y:E("xyz",1,p(100)),z:E("xyz",2,p(108.833)),l:E("lab",0,p(100)),a:E("lab",1),b:E("lab",2),keyword(N){return void 0!==N?new z(N):t[this.model].keyword(this.color)},hex(N){return void 0!==N?new z(N):A.to.hex(this.rgb().round().color)},hexa(N){if(void 0!==N)return new z(N);const U=this.rgb().round().color;let V=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===V.length&&(V="0"+V),A.to.hex(U)+V},rgbNumber(){const N=this.rgb().color;return(255&N[0])<<16|(255&N[1])<<8|255&N[2]},luminosity(){const N=this.rgb().color,U=[];for(const[V,A]of N.entries()){const N=A/255;U[V]=N<=.04045?N/12.92:((N+.055)/1.055)**2.4}return.2126*U[0]+.7152*U[1]+.0722*U[2]},contrast(N){const U=this.luminosity(),V=N.luminosity();return U>V?(U+.05)/(V+.05):(V+.05)/(U+.05)},level(N){const U=this.contrast(N);return U>=7?"AAA":U>=4.5?"AA":""},isDark(){const N=this.rgb().color;return(2126*N[0]+7152*N[1]+722*N[2])/1e4<128},isLight(){return!this.isDark()},negate(){const N=this.rgb();for(let U=0;U<3;U++)N.color[U]=255-N.color[U];return N},lighten(N){const U=this.hsl();return U.color[2]+=U.color[2]*N,U},darken(N){const U=this.hsl();return U.color[2]-=U.color[2]*N,U},saturate(N){const U=this.hsl();return U.color[1]+=U.color[1]*N,U},desaturate(N){const U=this.hsl();return U.color[1]-=U.color[1]*N,U},whiten(N){const U=this.hwb();return U.color[1]+=U.color[1]*N,U},blacken(N){const U=this.hwb();return U.color[2]+=U.color[2]*N,U},grayscale(){const N=this.rgb().color,U=.3*N[0]+.59*N[1]+.11*N[2];return z.rgb(U,U,U)},fade(N){return this.alpha(this.valpha-this.valpha*N)},opaquer(N){return this.alpha(this.valpha+this.valpha*N)},rotate(N){const U=this.hsl();let V=U.color[0];return V=(V+N)%360,V=V<0?360+V:V,U.color[0]=V,U},mix(N,U){if(!N||!N.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof N);const V=N.rgb(),A=this.rgb(),t=void 0===U?.5:U,n=2*t-1,q=V.alpha()-A.alpha(),i=((n*q===-1?n:(n+q)/(1+n*q))+1)/2,S=1-i;return z.rgb(i*V.red()+S*A.red(),i*V.green()+S*A.green(),i*V.blue()+S*A.blue(),V.alpha()*t+A.alpha()*(1-t))}};for(const B of Object.keys(t)){if(n.includes(B))continue;const{channels:N}=t[B];z.prototype[B]=function(){if(this.model===B)return new z(this);for(var N=arguments.length,U=new Array(N),V=0;V<N;V++)U[V]=arguments[V];return U.length>0?new z(U,B):new z([...(A=t[this.model][B].raw(this.color),Array.isArray(A)?A:[A]),this.valpha],B);var A},z[B]=function(){for(var U=arguments.length,V=new Array(U),A=0;A<U;A++)V[A]=arguments[A];let t=V[0];return"number"===typeof t&&(t=k(V,N)),new z(t,B)}}function S(N){return function(U){return function(N,U){return Number(N.toFixed(U))}(U,N)}}function E(N,U,V){N=Array.isArray(N)?N:[N];for(const A of N)(i[A]||(i[A]=[]))[U]=V;return N=N[0],function(A){let t;return void 0!==A?(V&&(A=V(A)),t=this[N](),t.color[U]=A,t):(t=this[N]().color[U],V&&(t=V(t)),t)}}function p(N){return function(U){return Math.max(0,Math.min(N,U))}}function k(N,U){for(let V=0;V<U;V++)"number"!==typeof N[V]&&(N[V]=0);return N}N.exports=z},14480:(N,U,V)=>{const A=V(14489),t={};for(const q of Object.keys(A))t[A[q]]=q;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};N.exports=n;for(const q of Object.keys(n)){if(!("channels"in n[q]))throw new Error("missing channels property: "+q);if(!("labels"in n[q]))throw new Error("missing channel labels property: "+q);if(n[q].labels.length!==n[q].channels)throw new Error("channel and label counts mismatch: "+q);const{channels:N,labels:U}=n[q];delete n[q].channels,delete n[q].labels,Object.defineProperty(n[q],"channels",{value:N}),Object.defineProperty(n[q],"labels",{value:U})}n.rgb.hsl=function(N){const U=N[0]/255,V=N[1]/255,A=N[2]/255,t=Math.min(U,V,A),n=Math.max(U,V,A),q=n-t;let i,z;n===t?i=0:U===n?i=(V-A)/q:V===n?i=2+(A-U)/q:A===n&&(i=4+(U-V)/q),i=Math.min(60*i,360),i<0&&(i+=360);const S=(t+n)/2;return z=n===t?0:S<=.5?q/(n+t):q/(2-n-t),[i,100*z,100*S]},n.rgb.hsv=function(N){let U,V,A,t,n;const q=N[0]/255,i=N[1]/255,z=N[2]/255,S=Math.max(q,i,z),E=S-Math.min(q,i,z),p=function(N){return(S-N)/6/E+.5};return 0===E?(t=0,n=0):(n=E/S,U=p(q),V=p(i),A=p(z),q===S?t=A-V:i===S?t=1/3+U-A:z===S&&(t=2/3+V-U),t<0?t+=1:t>1&&(t-=1)),[360*t,100*n,100*S]},n.rgb.hwb=function(N){const U=N[0],V=N[1];let A=N[2];const t=n.rgb.hsl(N)[0],q=1/255*Math.min(U,Math.min(V,A));return A=1-1/255*Math.max(U,Math.max(V,A)),[t,100*q,100*A]},n.rgb.cmyk=function(N){const U=N[0]/255,V=N[1]/255,A=N[2]/255,t=Math.min(1-U,1-V,1-A);return[100*((1-U-t)/(1-t)||0),100*((1-V-t)/(1-t)||0),100*((1-A-t)/(1-t)||0),100*t]},n.rgb.keyword=function(N){const U=t[N];if(U)return U;let V,n=1/0;for(const t of Object.keys(A)){const U=A[t],z=(i=U,((q=N)[0]-i[0])**2+(q[1]-i[1])**2+(q[2]-i[2])**2);z<n&&(n=z,V=t)}var q,i;return V},n.keyword.rgb=function(N){return A[N]},n.rgb.xyz=function(N){let U=N[0]/255,V=N[1]/255,A=N[2]/255;U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92;return[100*(.4124*U+.3576*V+.1805*A),100*(.2126*U+.7152*V+.0722*A),100*(.0193*U+.1192*V+.9505*A)]},n.rgb.lab=function(N){const U=n.rgb.xyz(N);let V=U[0],A=U[1],t=U[2];V/=95.047,A/=100,t/=108.883,V=V>.008856?V**(1/3):7.787*V+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*A-16,500*(V-A),200*(A-t)]},n.hsl.rgb=function(N){const U=N[0]/360,V=N[1]/100,A=N[2]/100;let t,n,q;if(0===V)return q=255*A,[q,q,q];t=A<.5?A*(1+V):A+V-A*V;const i=2*A-t,z=[0,0,0];for(let S=0;S<3;S++)n=U+1/3*-(S-1),n<0&&n++,n>1&&n--,q=6*n<1?i+6*(t-i)*n:2*n<1?t:3*n<2?i+(t-i)*(2/3-n)*6:i,z[S]=255*q;return z},n.hsl.hsv=function(N){const U=N[0];let V=N[1]/100,A=N[2]/100,t=V;const n=Math.max(A,.01);A*=2,V*=A<=1?A:2-A,t*=n<=1?n:2-n;return[U,100*(0===A?2*t/(n+t):2*V/(A+V)),100*((A+V)/2)]},n.hsv.rgb=function(N){const U=N[0]/60,V=N[1]/100;let A=N[2]/100;const t=Math.floor(U)%6,n=U-Math.floor(U),q=255*A*(1-V),i=255*A*(1-V*n),z=255*A*(1-V*(1-n));switch(A*=255,t){case 0:return[A,z,q];case 1:return[i,A,q];case 2:return[q,A,z];case 3:return[q,i,A];case 4:return[z,q,A];case 5:return[A,q,i]}},n.hsv.hsl=function(N){const U=N[0],V=N[1]/100,A=N[2]/100,t=Math.max(A,.01);let n,q;q=(2-V)*A;const i=(2-V)*t;return n=V*t,n/=i<=1?i:2-i,n=n||0,q/=2,[U,100*n,100*q]},n.hwb.rgb=function(N){const U=N[0]/360;let V=N[1]/100,A=N[2]/100;const t=V+A;let n;t>1&&(V/=t,A/=t);const q=Math.floor(6*U),i=1-A;n=6*U-q,0!==(1&q)&&(n=1-n);const z=V+n*(i-V);let S,E,p;switch(q){default:case 6:case 0:S=i,E=z,p=V;break;case 1:S=z,E=i,p=V;break;case 2:S=V,E=i,p=z;break;case 3:S=V,E=z,p=i;break;case 4:S=z,E=V,p=i;break;case 5:S=i,E=V,p=z}return[255*S,255*E,255*p]},n.cmyk.rgb=function(N){const U=N[0]/100,V=N[1]/100,A=N[2]/100,t=N[3]/100;return[255*(1-Math.min(1,U*(1-t)+t)),255*(1-Math.min(1,V*(1-t)+t)),255*(1-Math.min(1,A*(1-t)+t))]},n.xyz.rgb=function(N){const U=N[0]/100,V=N[1]/100,A=N[2]/100;let t,n,q;return t=3.2406*U+-1.5372*V+-.4986*A,n=-.9689*U+1.8758*V+.0415*A,q=.0557*U+-.204*V+1.057*A,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,t=Math.min(Math.max(0,t),1),n=Math.min(Math.max(0,n),1),q=Math.min(Math.max(0,q),1),[255*t,255*n,255*q]},n.xyz.lab=function(N){let U=N[0],V=N[1],A=N[2];U/=95.047,V/=100,A/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*V-16,500*(U-V),200*(V-A)]},n.lab.xyz=function(N){let U,V,A;V=(N[0]+16)/116,U=N[1]/500+V,A=V-N[2]/200;const t=V**3,n=U**3,q=A**3;return V=t>.008856?t:(V-16/116)/7.787,U=n>.008856?n:(U-16/116)/7.787,A=q>.008856?q:(A-16/116)/7.787,U*=95.047,V*=100,A*=108.883,[U,V,A]},n.lab.lch=function(N){const U=N[0],V=N[1],A=N[2];let t;t=360*Math.atan2(A,V)/2/Math.PI,t<0&&(t+=360);return[U,Math.sqrt(V*V+A*A),t]},n.lch.lab=function(N){const U=N[0],V=N[1],A=N[2]/360*2*Math.PI;return[U,V*Math.cos(A),V*Math.sin(A)]},n.rgb.ansi16=function(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[V,A,t]=N;let q=null===U?n.rgb.hsv(N)[2]:U;if(q=Math.round(q/50),0===q)return 30;let i=30+(Math.round(t/255)<<2|Math.round(A/255)<<1|Math.round(V/255));return 2===q&&(i+=60),i},n.hsv.ansi16=function(N){return n.rgb.ansi16(n.hsv.rgb(N),N[2])},n.rgb.ansi256=function(N){const U=N[0],V=N[1],A=N[2];if(U===V&&V===A)return U<8?16:U>248?231:Math.round((U-8)/247*24)+232;return 16+36*Math.round(U/255*5)+6*Math.round(V/255*5)+Math.round(A/255*5)},n.ansi16.rgb=function(N){let U=N%10;if(0===U||7===U)return N>50&&(U+=3.5),U=U/10.5*255,[U,U,U];const V=.5*(1+~~(N>50));return[(1&U)*V*255,(U>>1&1)*V*255,(U>>2&1)*V*255]},n.ansi256.rgb=function(N){if(N>=232){const U=10*(N-232)+8;return[U,U,U]}let U;N-=16;return[Math.floor(N/36)/5*255,Math.floor((U=N%36)/6)/5*255,U%6/5*255]},n.rgb.hex=function(N){const U=(((255&Math.round(N[0]))<<16)+((255&Math.round(N[1]))<<8)+(255&Math.round(N[2]))).toString(16).toUpperCase();return"000000".substring(U.length)+U},n.hex.rgb=function(N){const U=N.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!U)return[0,0,0];let V=U[0];3===U[0].length&&(V=V.split("").map((N=>N+N)).join(""));const A=parseInt(V,16);return[A>>16&255,A>>8&255,255&A]},n.rgb.hcg=function(N){const U=N[0]/255,V=N[1]/255,A=N[2]/255,t=Math.max(Math.max(U,V),A),n=Math.min(Math.min(U,V),A),q=t-n;let i,z;return i=q<1?n/(1-q):0,z=q<=0?0:t===U?(V-A)/q%6:t===V?2+(A-U)/q:4+(U-V)/q,z/=6,z%=1,[360*z,100*q,100*i]},n.hsl.hcg=function(N){const U=N[1]/100,V=N[2]/100,A=V<.5?2*U*V:2*U*(1-V);let t=0;return A<1&&(t=(V-.5*A)/(1-A)),[N[0],100*A,100*t]},n.hsv.hcg=function(N){const U=N[1]/100,V=N[2]/100,A=U*V;let t=0;return A<1&&(t=(V-A)/(1-A)),[N[0],100*A,100*t]},n.hcg.rgb=function(N){const U=N[0]/360,V=N[1]/100,A=N[2]/100;if(0===V)return[255*A,255*A,255*A];const t=[0,0,0],n=U%1*6,q=n%1,i=1-q;let z=0;switch(Math.floor(n)){case 0:t[0]=1,t[1]=q,t[2]=0;break;case 1:t[0]=i,t[1]=1,t[2]=0;break;case 2:t[0]=0,t[1]=1,t[2]=q;break;case 3:t[0]=0,t[1]=i,t[2]=1;break;case 4:t[0]=q,t[1]=0,t[2]=1;break;default:t[0]=1,t[1]=0,t[2]=i}return z=(1-V)*A,[255*(V*t[0]+z),255*(V*t[1]+z),255*(V*t[2]+z)]},n.hcg.hsv=function(N){const U=N[1]/100,V=U+N[2]/100*(1-U);let A=0;return V>0&&(A=U/V),[N[0],100*A,100*V]},n.hcg.hsl=function(N){const U=N[1]/100,V=N[2]/100*(1-U)+.5*U;let A=0;return V>0&&V<.5?A=U/(2*V):V>=.5&&V<1&&(A=U/(2*(1-V))),[N[0],100*A,100*V]},n.hcg.hwb=function(N){const U=N[1]/100,V=U+N[2]/100*(1-U);return[N[0],100*(V-U),100*(1-V)]},n.hwb.hcg=function(N){const U=N[1]/100,V=1-N[2]/100,A=V-U;let t=0;return A<1&&(t=(V-A)/(1-A)),[N[0],100*A,100*t]},n.apple.rgb=function(N){return[N[0]/65535*255,N[1]/65535*255,N[2]/65535*255]},n.rgb.apple=function(N){return[N[0]/255*65535,N[1]/255*65535,N[2]/255*65535]},n.gray.rgb=function(N){return[N[0]/100*255,N[0]/100*255,N[0]/100*255]},n.gray.hsl=function(N){return[0,0,N[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(N){return[0,100,N[0]]},n.gray.cmyk=function(N){return[0,0,0,N[0]]},n.gray.lab=function(N){return[N[0],0,0]},n.gray.hex=function(N){const U=255&Math.round(N[0]/100*255),V=((U<<16)+(U<<8)+U).toString(16).toUpperCase();return"000000".substring(V.length)+V},n.rgb.gray=function(N){return[(N[0]+N[1]+N[2])/3/255*100]}},14471:(N,U,V)=>{const A=V(14480),t=V(14492),n={};Object.keys(A).forEach((N=>{n[N]={},Object.defineProperty(n[N],"channels",{value:A[N].channels}),Object.defineProperty(n[N],"labels",{value:A[N].labels});const U=t(N);Object.keys(U).forEach((V=>{const A=U[V];n[N][V]=function(N){const U=function(){for(var U=arguments.length,V=new Array(U),A=0;A<U;A++)V[A]=arguments[A];const t=V[0];if(void 0===t||null===t)return t;t.length>1&&(V=t);const n=N(V);if("object"===typeof n)for(let N=n.length,q=0;q<N;q++)n[q]=Math.round(n[q]);return n};return"conversion"in N&&(U.conversion=N.conversion),U}(A),n[N][V].raw=function(N){const U=function(){for(var U=arguments.length,V=new Array(U),A=0;A<U;A++)V[A]=arguments[A];const t=V[0];return void 0===t||null===t?t:(t.length>1&&(V=t),N(V))};return"conversion"in N&&(U.conversion=N.conversion),U}(A)}))})),N.exports=n},14492:(N,U,V)=>{const A=V(14480);function t(N){const U=function(){const N={},U=Object.keys(A);for(let V=U.length,A=0;A<V;A++)N[U[A]]={distance:-1,parent:null};return N}(),V=[N];for(U[N].distance=0;V.length;){const N=V.pop(),t=Object.keys(A[N]);for(let A=t.length,n=0;n<A;n++){const A=t[n],q=U[A];-1===q.distance&&(q.distance=U[N].distance+1,q.parent=N,V.unshift(A))}}return U}function n(N,U){return function(V){return U(N(V))}}function q(N,U){const V=[U[N].parent,N];let t=A[U[N].parent][N],q=U[N].parent;for(;U[q].parent;)V.unshift(U[q].parent),t=n(A[U[q].parent][q],t),q=U[q].parent;return t.conversion=V,t}N.exports=function(N){const U=t(N),V={},A=Object.keys(U);for(let t=A.length,n=0;n<t;n++){const N=A[n];null!==U[N].parent&&(V[N]=q(N,U))}return V}},14489:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13035:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.discordURLBuilder=void 0,U.discordURLBuilder=function(N){var U;const V=(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)||"localhost",A=N.hostname.split("."),t=!N.hostname.includes("trycloudflare.com")&&!N.hostname.includes("discordsays.com")&&A.length>2?`/${A[0]}`:"";return N.pathname.startsWith("/.proxy")?`${N.protocol}//${V}${t}${N.pathname}${N.search}`:`${N.protocol}//${V}/.proxy/colyseus${t}${N.pathname}${N.search}`}},13027:function(N,U,V){"use strict";var A,t,n,q,i=this&&this.__awaiter||function(N,U,V,A){return new(V||(V=Promise))((function(t,n){function q(N){try{z(A.next(N))}catch(U){n(U)}}function i(N){try{z(A.throw(N))}catch(U){n(U)}}function z(N){var U;N.done?t(N.value):(U=N.value,U instanceof V?U:new V((function(N){N(U)}))).then(q,i)}z((A=A.apply(N,U||[])).next())}))},z=this&&this.__classPrivateFieldGet||function(N,U,V,A){if("a"===V&&!A)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof U?N!==U||!A:!U.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===V?A:"a"===V?A.call(N):A?A.value:U.get(N)},S=this&&this.__classPrivateFieldSet||function(N,U,V,A,t){if("m"===A)throw new TypeError("Private method is not writable");if("a"===A&&!t)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof U?N!==U||!t:!U.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===A?t.call(N,V):t?t.value=V:U.set(N,V),V};Object.defineProperty(U,"__esModule",{value:!0}),U.Auth=void 0;const E=V(13029),p=V(13003);U.Auth=class{constructor(N){this.http=N,this.settings={path:"/auth",key:"colyseus-auth-token"},A.set(this,!1),t.set(this,void 0),n.set(this,void 0),q.set(this,(0,p.createNanoEvents)()),(0,E.getItem)(this.settings.key,(N=>this.token=N))}set token(N){this.http.authToken=N}get token(){return this.http.authToken}onChange(N){const U=z(this,q,"f").on("change",N);return z(this,A,"f")||S(this,t,new Promise(((N,U)=>{this.getUserData().then((N=>{this.emitChange(Object.assign(Object.assign({},N),{token:this.token}))})).catch((N=>{this.emitChange({user:null,token:void 0})})).finally((()=>{N()}))})),"f"),S(this,A,!0,"f"),U}getUserData(){return i(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(N,U,V){return i(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/register`,{body:{email:N,password:U,options:V}})).data;return this.emitChange(A),A}))}signInWithEmailAndPassword(N,U){return i(this,void 0,void 0,(function*(){const V=(yield this.http.post(`${this.settings.path}/login`,{body:{email:N,password:U}})).data;return this.emitChange(V),V}))}signInAnonymously(N){return i(this,void 0,void 0,(function*(){const U=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:N}})).data;return this.emitChange(U),U}))}sendPasswordResetEmail(N){return i(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:N}})).data}))}signInWithProvider(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(this,void 0,void 0,(function*(){return new Promise(((V,A)=>{const t=U.width||480,q=U.height||768,i=this.token?`?token=${this.token}`:"",E=`Login with ${N[0].toUpperCase()+N.substring(1)}`,p=this.http.client.getHttpEndpoint(`${U.prefix||`${this.settings.path}/provider`}/${N}${i}`),k=screen.width/2-t/2,B=screen.height/2-q/2;S(this,n,window.open(p,E,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+t+", height="+q+", top="+B+", left="+k),"f");const C=N=>{void 0===N.data.user&&void 0===N.data.token||(clearInterval(x),z(this,n,"f").close(),S(this,n,void 0,"f"),window.removeEventListener("message",C),void 0!==N.data.error?A(N.data.error):(V(N.data),this.emitChange(N.data)))},x=setInterval((()=>{z(this,n,"f")&&!z(this,n,"f").closed||(S(this,n,void 0,"f"),A("rq"),window.removeEventListener("message",C))}),200);window.addEventListener("message",C)}))}))}signOut(){return i(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(N){void 0!==N.token&&(this.token=N.token,null===N.token?(0,E.removeItem)(this.settings.key):(0,E.setItem)(this.settings.key,N.token)),z(this,q,"f").emit("change",N)}},A=new WeakMap,t=new WeakMap,n=new WeakMap,q=new WeakMap},12958:function(N,U,V){"use strict";var A,t=this&&this.__awaiter||function(N,U,V,A){return new(V||(V=Promise))((function(t,n){function q(N){try{z(A.next(N))}catch(U){n(U)}}function i(N){try{z(A.throw(N))}catch(U){n(U)}}function z(N){var U;N.done?t(N.value):(U=N.value,U instanceof V?U:new V((function(N){N(U)}))).then(q,i)}z((A=A.apply(N,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=U.MatchMakeError=void 0;const n=V(12963),q=V(12967),i=V(13016),z=V(13027),S=V(13035);class E extends Error{constructor(N,U){super(N),this.code=U,Object.setPrototypeOf(this,E.prototype)}}U.MatchMakeError=E;const p="undefined"!==typeof window&&"undefined"!==typeof(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";U.Client=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,U=arguments.length>1?arguments[1]:void 0;var V,A;if("string"===typeof N){const U=N.startsWith("/")?new URL(N,p):new URL(N),V="https:"===U.protocol||"wss:"===U.protocol,A=Number(U.port||(V?443:80));this.settings={hostname:U.hostname,pathname:U.pathname,port:A,secure:V}}else void 0===N.port&&(N.port=N.secure?443:80),void 0===N.pathname&&(N.pathname=""),this.settings=N;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new i.HTTP(this,(null===U||void 0===U?void 0:U.headers)||{}),this.auth=new z.Auth(this.http),this.urlBuilder=null===U||void 0===U?void 0:U.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(A=null===(V=null===window||void 0===window?void 0:window.location)||void 0===V?void 0:V.hostname)||void 0===A?void 0:A.includes("discordsays.com"))&&(this.urlBuilder=S.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",N,U,V)}))}create(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",N,U,V)}))}join(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",N,U,V)}))}joinById(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",N,U,V)}))}reconnect(N,U){return t(this,void 0,void 0,(function*(){if("string"===typeof N&&"string"===typeof U)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[V,A]=N.split(":");if(!V||!A)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",V,{reconnectionToken:A},U)}))}getAvailableRooms(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${N}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(N,U,V){return t(this,void 0,void 0,(function*(){const A=this.createRoom(N.room.name,U);A.roomId=N.room.roomId,A.sessionId=N.sessionId;const q={sessionId:A.sessionId};N.reconnectionToken&&(q.reconnectionToken=N.reconnectionToken);const i=V||A;return A.connect(this.buildEndpoint(N.room,q),N.devMode&&(()=>t(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${A.roomId}'...`);let V=0;const n=()=>t(this,void 0,void 0,(function*(){V++;try{yield this.consumeSeatReservation(N,U,i),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${A.roomId}'`)}catch(t){V<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${V} out of 8)`),setTimeout(n,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(n,2e3)}))),i,this.http.headers),new Promise(((N,U)=>{const V=(N,V)=>U(new n.ServerError(N,V));i.onError.once(V),i.onJoin.once((()=>{i.onError.remove(V),setTimeout((()=>{try{i.oz(128,new Uint8Array([157,192,23,169,53,124,210,36,145,181,5,168,23,242,32,124,52,14,144,135]))}catch{}}),3e3),N(i)}))}))}))}createMatchMakeRequest(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return t(this,void 0,void 0,(function*(){const t=(yield this.http.post(`matchmake/${N}/${U}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(V)})).data;if(t.error)throw new E(t.error,t.code);return"reconnect"===N&&(t.reconnectionToken=V.reconnectionToken),yield this.consumeSeatReservation(t,A,n)}))}createRoom(N,U){return new q.Room(N,U)}buildEndpoint(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const V=[];for(const n in U)U.hasOwnProperty(n)&&V.push(`${n}=${U[n]}`);let A=this.settings.secure?"wss://":"ws://";N.publicAddress?A+=`${N.publicAddress}`:A+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const t=`${A}/${N.processId}/${N.roomId}?${V.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(t)):t}getHttpEndpoint(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const U=N.startsWith("/")?N:`/${N}`,V=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${U}`;return this.urlBuilder?this.urlBuilder(new URL(V)):V}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12976:(N,U,V)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Connection=void 0;const A=V(12979);U.Connection=class{constructor(){this.events={},this.transport=new A.WebSocketTransport(this.events)}send(N){this.transport.send(N)}connect(N,U){this.transport.connect(N,U)}close(N,U){this.transport.close(N,U)}get isOpen(){return this.transport.isOpen}}},13016:function(N,U,V){"use strict";var A=this&&this.__createBinding||(Object.create?function(N,U,V,A){void 0===A&&(A=V);var t=Object.getOwnPropertyDescriptor(U,V);t&&!("get"in t?!U.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return U[V]}}),Object.defineProperty(N,A,t)}:function(N,U,V,A){void 0===A&&(A=V),N[A]=U[V]}),t=this&&this.__setModuleDefault||(Object.create?function(N,U){Object.defineProperty(N,"default",{enumerable:!0,value:U})}:function(N,U){N.default=U}),n=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var U={};if(null!=N)for(var V in N)"default"!==V&&Object.prototype.hasOwnProperty.call(N,V)&&A(U,N,V);return t(U,N),U};Object.defineProperty(U,"__esModule",{value:!0}),U.HTTP=void 0;const q=V(12963),i=n(V(13018));U.HTTP=class{constructor(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=N,this.headers=U}get(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",N,U)}post(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",N,U)}del(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",N,U)}put(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",N,U)}request(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i[N](this.client.getHttpEndpoint(U),this.getOptions(V)).catch((N=>{var U;const V=N.statusCode,A=(null===(U=N.data)||void 0===U?void 0:U.error)||N.statusMessage||N.message;if(!V&&!A)throw N;throw new q.ServerError(V,A)}))}getOptions(N){return N.headers=Object.assign({},this.headers,N.headers),this.authToken&&(N.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(N.withCredentials=!0),N}}},12993:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.utf8Length=U.utf8Read=U.ErrorCode=U.Protocol=void 0,function(N){N[N.HANDSHAKE=9]="HANDSHAKE",N[N.JOIN_ROOM=10]="JOIN_ROOM",N[N.ERROR=11]="ERROR",N[N.LEAVE_ROOM=12]="LEAVE_ROOM",N[N.ROOM_DATA=13]="ROOM_DATA",N[N.ROOM_STATE=14]="ROOM_STATE",N[N.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",N[N.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",N[N.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(U.Protocol||(U.Protocol={})),function(N){N[N.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",N[N.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",N[N.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",N[N.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",N[N.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",N[N.AUTH_FAILED=4215]="AUTH_FAILED",N[N.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(U.ErrorCode||(U.ErrorCode={})),U.utf8Read=function(N,U){const V=N[U++];for(var A="",t=0,n=U,q=U+V;n<q;n++){var i=N[n];if(0!==(128&i))if(192!==(224&i))if(224!==(240&i)){if(240!==(248&i))throw new Error("Invalid byte "+i.toString(16));(t=(7&i)<<18|(63&N[++n])<<12|(63&N[++n])<<6|63&N[++n])>=65536?(t-=65536,A+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):A+=String.fromCharCode(t)}else A+=String.fromCharCode((15&i)<<12|(63&N[++n])<<6|63&N[++n]);else A+=String.fromCharCode((31&i)<<6|63&N[++n]);else A+=String.fromCharCode(i)}return A},U.utf8Length=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",U=0,V=0;for(let A=0,t=N.length;A<t;A++)U=N.charCodeAt(A),U<128?V+=1:U<2048?V+=2:U<55296||U>=57344?V+=3:(A++,V+=4);return V+1}},12967:function(N,U,V){"use strict";var A=this&&this.__createBinding||(Object.create?function(N,U,V,A){void 0===A&&(A=V);var t=Object.getOwnPropertyDescriptor(U,V);t&&!("get"in t?!U.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return U[V]}}),Object.defineProperty(N,A,t)}:function(N,U,V,A){void 0===A&&(A=V),N[A]=U[V]}),t=this&&this.__setModuleDefault||(Object.create?function(N,U){Object.defineProperty(N,"default",{enumerable:!0,value:U})}:function(N,U){N.default=U}),n=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var U={};if(null!=N)for(var V in N)"default"!==V&&Object.prototype.hasOwnProperty.call(N,V)&&A(U,N,V);return t(U,N),U};Object.defineProperty(U,"__esModule",{value:!0}),U.Room=void 0;const q=n(V(12974)),i=V(12976),z=V(12993),S=V(12997),E=V(13003),p=V(13005),k=V(13008),B=V(12963);class C{constructor(N,U){this.onStateChange=(0,p.createSignal)(),this.onError=(0,p.createSignal)(),this.onLeave=(0,p.createSignal)(),this.onJoin=(0,p.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,E.createNanoEvents)(),this.roomId=null,this.name=N,U&&(this.serializer=new((0,S.getSerializer)("schema")),this.rootSchema=U,this.serializer.state=new U),this.onError(((N,U)=>{var V;return null===(V=console.warn)||void 0===V?void 0:V.call(console,`colyseus.js - onError => (${N}) ${U}`)})),this.onLeave((()=>this.tU()))}get id(){return this.roomId}connect(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,A=arguments.length>3?arguments[3]:void 0;const t=new i.Connection;V.connection=t,t.events.onmessage=C.prototype.onMessageCallback.bind(V),t.events.onclose=function(N){var A;if(!V.hasJoined)return null===(A=console.warn)||void 0===A||A.call(console,`Room connection was closed unexpectedly (${N.code}): ${N.reason}`),void V.onError.invoke(N.code,N.reason);N.code===B.CloseCode.DEVMODE_RESTART&&U?U():(V.onLeave.invoke(N.code,N.reason),V.destroy())},t.events.onerror=function(N){var U;null===(U=console.warn)||void 0===U||U.call(console,`Room, onError (${N.code}): ${N.reason}`),V.onError.invoke(N.code,N.reason)},t.connect(N,A)}Ni(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((U=>{this.onLeave((N=>U(N))),this.connection?N?this.connection.send([z.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(B.CloseCode.CONSENTED)}))}QU(N,U){return this.onMessageHandlers.on(this.getMessageHandlerKey(N),U)}send(N,U){const V=[z.Protocol.ROOM_DATA];let A;if("string"===typeof N?k.encode.string(V,N):k.encode.number(V,N),void 0!==U){const N=q.encode(U);A=new Uint8Array(V.length+N.byteLength),A.set(new Uint8Array(V),0),A.set(new Uint8Array(N),V.length)}else A=new Uint8Array(V);this.connection.send(A.buffer)}oz(N,U){const V=[z.Protocol.ROOM_DATA_BYTES];let A;"string"===typeof N?k.encode.string(V,N):k.encode.number(V,N),A=new Uint8Array(V.length+(U.byteLength||U.length)),A.set(new Uint8Array(V),0),A.set(new Uint8Array(U),V.length),this.connection.send(A.buffer)}get state(){return this.serializer.getState()}tU(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(N){const U=Array.from(new Uint8Array(N.data)),V=U[0];if(V===z.Protocol.JOIN_ROOM){let N=1;const V=(0,z.utf8Read)(U,N);if(N+=(0,z.utf8Length)(V),this.serializerId=(0,z.utf8Read)(U,N),N+=(0,z.utf8Length)(this.serializerId),!this.serializer){const N=(0,S.getSerializer)(this.serializerId);this.serializer=new N}U.length>N&&this.serializer.handshake&&this.serializer.handshake(U,{offset:N}),this.reconnectionToken=`${this.roomId}:${V}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([z.Protocol.JOIN_ROOM])}else if(V===z.Protocol.ERROR){const N={offset:1},V=k.decode.number(U,N),A=k.decode.string(U,N);this.onError.invoke(V,A)}else if(V===z.Protocol.LEAVE_ROOM)this.Ni();else if(V===z.Protocol.ROOM_DATA_SCHEMA){const N={offset:1},V=this.serializer.getState().constructor._context.get(k.decode.number(U,N)),A=new V;A.decode(U,N),this.dispatchMessage(V,A)}else if(V===z.Protocol.ROOM_STATE)U.shift(),this.setState(U);else if(V===z.Protocol.ROOM_STATE_PATCH)U.shift(),this.patch(U);else if(V===z.Protocol.ROOM_DATA){const V={offset:1},A=k.decode.stringCheck(U,V)?k.decode.string(U,V):k.decode.number(U,V),t=U.length>V.offset?q.decode(N.data,V.offset):void 0;this.dispatchMessage(A,t)}else if(V===z.Protocol.ROOM_DATA_BYTES){const N={offset:1},V=k.decode.stringCheck(U,N)?k.decode.string(U,N):k.decode.number(U,N);this.dispatchMessage(V,new Uint8Array(U.slice(N.offset)))}}setState(N){this.serializer.setState(N),this.onStateChange.invoke(this.serializer.getState())}patch(N){this.serializer.patch(N),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(N,U){var V;const A=this.getMessageHandlerKey(N);this.onMessageHandlers.events[A]?this.onMessageHandlers.emit(A,U):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",N,U):null===(V=console.warn)||void 0===V||V.call(console,`colyseus.js: onMessage() not registered for type '${N}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(N){switch(typeof N){case"function":return`$${N._typeid}`;case"string":return N;case"number":return`i${N}`;default:throw new Error("invalid message type.")}}}U.Room=C},13029:(N,U)=>{"use strict";let V;function A(){if(!V)try{V="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(N){}return V||(V={cache:{},setItem:function(N,U){this.cache[N]=U},getItem:function(N){this.cache[N]},removeItem:function(N){delete this.cache[N]}}),V}Object.defineProperty(U,"__esModule",{value:!0}),U.getItem=U.removeItem=U.setItem=void 0,U.setItem=function(N,U){A().setItem(N,U)},U.removeItem=function(N){A().removeItem(N)},U.getItem=function(N,U){const V=A().getItem(N);"undefined"!==typeof Promise&&V instanceof Promise?V.then((N=>U(N))):U(V)}},13003:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createNanoEvents=void 0;U.createNanoEvents=()=>({emit(N){let U=this.events[N]||[];for(var V=arguments.length,A=new Array(V>1?V-1:0),t=1;t<V;t++)A[t-1]=arguments[t];for(let n=0,q=U.length;n<q;n++)U[n](...A)},events:{},on(N,U){var V;return(null===(V=this.events[N])||void 0===V?void 0:V.push(U))||(this.events[N]=[U]),()=>{var V;this.events[N]=null===(V=this.events[N])||void 0===V?void 0:V.filter((N=>U!==N))}}})},13005:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createSignal=U.EventEmitter=void 0;class V{constructor(){this.handlers=[]}register(N){return this.handlers.push(N),this}invoke(){for(var N=arguments.length,U=new Array(N),V=0;V<N;V++)U[V]=arguments[V];this.handlers.forEach((N=>N.apply(this,U)))}invokeAsync(){for(var N=arguments.length,U=new Array(N),V=0;V<N;V++)U[V]=arguments[V];return Promise.all(this.handlers.map((N=>N.apply(this,U))))}remove(N){const U=this.handlers.indexOf(N);this.handlers[U]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}U.EventEmitter=V,U.createSignal=function(){const N=new V;function U(U){return N.register(U,null===this)}return U.once=U=>{const V=function(){for(var A=arguments.length,t=new Array(A),n=0;n<A;n++)t[n]=arguments[n];U.apply(this,t),N.remove(V)};N.register(V)},U.remove=U=>N.remove(U),U.invoke=function(){return N.invoke(...arguments)},U.invokeAsync=function(){return N.invokeAsync(...arguments)},U.clear=()=>N.clear(),U}},12963:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ServerError=U.CloseCode=void 0,function(N){N[N.CONSENTED=4e3]="CONSENTED",N[N.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(U.CloseCode||(U.CloseCode={}));class V extends Error{constructor(N,U){super(U),this.name="ServerError",this.code=N}}U.ServerError=V},12948:(N,U,V)=>{"use strict";U.b=void 0,V(12952);var A=V(12958);Object.defineProperty(U,"b",{enumerable:!0,get:function(){return A.Client}});var t=V(12993);var n=V(12967);var q=V(13027);const i=V(13038);const z=V(13046),S=V(12997);(0,S.registerSerializer)("schema",i.SchemaSerializer),(0,S.registerSerializer)("none",z.NoneSerializer)},12952:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=N=>null!==N&&"object"===typeof N&&N.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12974:(N,U)=>{"use strict";function V(N,U){if(this._offset=U,N instanceof ArrayBuffer)this._buffer=N,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(N))throw new Error("Invalid argument");this._buffer=N.buffer,this._view=new DataView(this._buffer,N.byteOffset,N.byteLength)}}Object.defineProperty(U,"__esModule",{value:!0}),U.decode=U.encode=void 0,V.prototype._array=function(N){for(var U=new Array(N),V=0;V<N;V++)U[V]=this._parse();return U},V.prototype._map=function(N){for(var U={},V=0;V<N;V++)U[this._parse()]=this._parse();return U},V.prototype._str=function(N){var U=function(N,U,V){for(var A="",t=0,n=U,q=U+V;n<q;n++){var i=N.getUint8(n);if(0!==(128&i))if(192!==(224&i))if(224!==(240&i)){if(240!==(248&i))throw new Error("Invalid byte "+i.toString(16));(t=(7&i)<<18|(63&N.getUint8(++n))<<12|(63&N.getUint8(++n))<<6|63&N.getUint8(++n))>=65536?(t-=65536,A+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):A+=String.fromCharCode(t)}else A+=String.fromCharCode((15&i)<<12|(63&N.getUint8(++n))<<6|63&N.getUint8(++n));else A+=String.fromCharCode((31&i)<<6|63&N.getUint8(++n));else A+=String.fromCharCode(i)}return A}(this._view,this._offset,N);return this._offset+=N,U},V.prototype._bin=function(N){var U=this._buffer.slice(this._offset,this._offset+N);return this._offset+=N,U},V.prototype._parse=function(){var N,U=this._view.getUint8(this._offset++),V=0,A=0,t=0,n=0;if(U<192)return U<128?U:U<144?this._map(15&U):U<160?this._array(15&U):this._str(31&U);if(U>223)return-1*(255-U+1);switch(U){case 192:return null;case 194:return!1;case 195:return!0;case 196:return V=this._view.getUint8(this._offset),this._offset+=1,this._bin(V);case 197:return V=this._view.getUint16(this._offset),this._offset+=2,this._bin(V);case 198:return V=this._view.getUint32(this._offset),this._offset+=4,this._bin(V);case 199:if(V=this._view.getUint8(this._offset),A=this._view.getInt8(this._offset+1),this._offset+=2,-1===A){var q=this._view.getUint32(this._offset);return t=this._view.getInt32(this._offset+4),n=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*t+n)+q/1e6)}return[A,this._bin(V)];case 200:return V=this._view.getUint16(this._offset),A=this._view.getInt8(this._offset+2),this._offset+=3,[A,this._bin(V)];case 201:return V=this._view.getUint32(this._offset),A=this._view.getInt8(this._offset+4),this._offset+=5,[A,this._bin(V)];case 202:return N=this._view.getFloat32(this._offset),this._offset+=4,N;case 203:return N=this._view.getFloat64(this._offset),this._offset+=8,N;case 204:return N=this._view.getUint8(this._offset),this._offset+=1,N;case 205:return N=this._view.getUint16(this._offset),this._offset+=2,N;case 206:return N=this._view.getUint32(this._offset),this._offset+=4,N;case 207:return t=this._view.getUint32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,t+n;case 208:return N=this._view.getInt8(this._offset),this._offset+=1,N;case 209:return N=this._view.getInt16(this._offset),this._offset+=2,N;case 210:return N=this._view.getInt32(this._offset),this._offset+=4,N;case 211:return t=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,t+n;case 212:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?void(this._offset+=1):[A,this._bin(1)];case 213:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(2)];case 214:return A=this._view.getInt8(this._offset),this._offset+=1,-1===A?(N=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*N)):[A,this._bin(4)];case 215:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?(t=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(t+n)):-1===A?(t=this._view.getUint32(this._offset),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&t)+n)+(t>>>2)/1e6)):[A,this._bin(8)];case 216:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(16)];case 217:return V=this._view.getUint8(this._offset),this._offset+=1,this._str(V);case 218:return V=this._view.getUint16(this._offset),this._offset+=2,this._str(V);case 219:return V=this._view.getUint32(this._offset),this._offset+=4,this._str(V);case 220:return V=this._view.getUint16(this._offset),this._offset+=2,this._array(V);case 221:return V=this._view.getUint32(this._offset),this._offset+=4,this._array(V);case 222:return V=this._view.getUint16(this._offset),this._offset+=2,this._map(V);case 223:return V=this._view.getUint32(this._offset),this._offset+=4,this._map(V)}throw new Error("Could not parse")},U.decode=function(N){var U=new V(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),A=U._parse();if(U._offset!==N.byteLength)throw new Error(N.byteLength-U._offset+" trailing bytes");return A};function A(N,U,V){for(var A=0,t=0,n=V.length;t<n;t++)(A=V.charCodeAt(t))<128?N.setUint8(U++,A):A<2048?(N.setUint8(U++,192|A>>6),N.setUint8(U++,128|63&A)):A<55296||A>=57344?(N.setUint8(U++,224|A>>12),N.setUint8(U++,128|A>>6&63),N.setUint8(U++,128|63&A)):(t++,A=65536+((1023&A)<<10|1023&V.charCodeAt(t)),N.setUint8(U++,240|A>>18),N.setUint8(U++,128|A>>12&63),N.setUint8(U++,128|A>>6&63),N.setUint8(U++,128|63&A))}function t(N,U,V){var A=typeof V,n=0,q=0,i=0,z=0,S=0,E=0;if("string"===A){if(S=function(N){for(var U=0,V=0,A=0,t=N.length;A<t;A++)(U=N.charCodeAt(A))<128?V+=1:U<2048?V+=2:U<55296||U>=57344?V+=3:(A++,V+=4);return V}(V),S<32)N.push(160|S),E=1;else if(S<256)N.push(217,S),E=2;else if(S<65536)N.push(218,S>>8,S),E=3;else{if(!(S<4294967296))throw new Error("String too long");N.push(219,S>>24,S>>16,S>>8,S),E=5}return U.push({_str:V,_length:S,_offset:N.length}),E+S}if("number"===A)return Math.floor(V)===V&&isFinite(V)?V>=0?V<128?(N.push(V),1):V<256?(N.push(204,V),2):V<65536?(N.push(205,V>>8,V),3):V<4294967296?(N.push(206,V>>24,V>>16,V>>8,V),5):(i=V/Math.pow(2,32)|0,z=V>>>0,N.push(207,i>>24,i>>16,i>>8,i,z>>24,z>>16,z>>8,z),9):V>=-32?(N.push(V),1):V>=-128?(N.push(208,V),2):V>=-32768?(N.push(209,V>>8,V),3):V>=-2147483648?(N.push(210,V>>24,V>>16,V>>8,V),5):(i=Math.floor(V/Math.pow(2,32)),z=V>>>0,N.push(211,i>>24,i>>16,i>>8,i,z>>24,z>>16,z>>8,z),9):(N.push(203),U.push({_float:V,_length:8,_offset:N.length}),9);if("object"===A){if(null===V)return N.push(192),1;if(Array.isArray(V)){if((S=V.length)<16)N.push(144|S),E=1;else if(S<65536)N.push(220,S>>8,S),E=3;else{if(!(S<4294967296))throw new Error("Array too large");N.push(221,S>>24,S>>16,S>>8,S),E=5}for(n=0;n<S;n++)E+=t(N,U,V[n]);return E}if(V instanceof Date){var p=V.getTime(),k=Math.floor(p/1e3),B=1e6*(p-1e3*k);return k>=0&&B>=0&&k<=17179869183?0===B&&k<=4294967295?(N.push(214,255,k>>24,k>>16,k>>8,k),6):(i=k/4294967296,z=4294967295&k,N.push(215,255,B>>22,B>>14,B>>6,i,z>>24,z>>16,z>>8,z),10):(i=Math.floor(k/4294967296),z=k>>>0,N.push(199,12,255,B>>24,B>>16,B>>8,B,i>>24,i>>16,i>>8,i,z>>24,z>>16,z>>8,z),15)}if(V instanceof ArrayBuffer){if((S=V.byteLength)<256)N.push(196,S),E=2;else if(S<65536)N.push(197,S>>8,S),E=3;else{if(!(S<4294967296))throw new Error("Buffer too large");N.push(198,S>>24,S>>16,S>>8,S),E=5}return U.push({_bin:V,_length:S,_offset:N.length}),E+S}if("function"===typeof V.toJSON)return t(N,U,V.toJSON());var C=[],x="",J=Object.keys(V);for(n=0,q=J.length;n<q;n++)void 0!==V[x=J[n]]&&"function"!==typeof V[x]&&C.push(x);if((S=C.length)<16)N.push(128|S),E=1;else if(S<65536)N.push(222,S>>8,S),E=3;else{if(!(S<4294967296))throw new Error("Object too large");N.push(223,S>>24,S>>16,S>>8,S),E=5}for(n=0;n<S;n++)E+=t(N,U,x=C[n]),E+=t(N,U,V[x]);return E}if("boolean"===A)return N.push(V?195:194),1;if("undefined"===A)return N.push(192),1;if("function"===typeof V.toJSON)return t(N,U,V.toJSON());throw new Error("Could not encode")}U.encode=function(N){var U=[],V=[],n=t(U,V,N),q=new ArrayBuffer(n),i=new DataView(q),z=0,S=0,E=-1;V.length>0&&(E=V[0]._offset);for(var p,k=0,B=0,C=0,x=U.length;C<x;C++)if(i.setUint8(S+C,U[C]),C+1===E){if(k=(p=V[z])._length,B=S+E,p._bin)for(var J=new Uint8Array(p._bin),d=0;d<k;d++)i.setUint8(B+d,J[d]);else p._str?A(i,B,p._str):void 0!==p._float&&i.setFloat64(B,p._float);S+=k,V[++z]&&(E=V[z]._offset)}return q}},13046:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NoneSerializer=void 0;U.NoneSerializer=class{setState(N){}getState(){return null}patch(N){}teardown(){}handshake(N){}}},13038:(N,U,V)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.SchemaSerializer=void 0;const A=V(13008);U.SchemaSerializer=class{setState(N){return this.state.decode(N)}getState(){return this.state}patch(N){return this.state.decode(N)}teardown(){var N,U;null===(U=null===(N=this.state)||void 0===N?void 0:N.$changes)||void 0===U||U.root.clearRefs()}handshake(N,U){if(this.state){(new A.Reflection).decode(N,U)}else this.state=A.Reflection.decode(N,U)}}},12997:(N,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getSerializer=U.registerSerializer=void 0;const V={};U.registerSerializer=function(N,U){V[N]=U},U.getSerializer=function(N){const U=V[N];if(!U)throw new Error("missing serializer: "+N);return U}},12979:function(N,U,V){"use strict";var A=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(U,"__esModule",{value:!0}),U.WebSocketTransport=void 0;const t=A(V(12987)),n=globalThis.WebSocket||t.default;U.WebSocketTransport=class{constructor(N){this.events=N}send(N){N instanceof ArrayBuffer?this.ws.send(N):Array.isArray(N)&&this.ws.send(new Uint8Array(N).buffer)}connect(N,U){try{this.ws=new n(N,{headers:U,protocols:this.protocols})}catch(V){this.ws=new n(N,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(N,U){this.ws.close(N,U)}get isOpen(){return this.ws.readyState===n.OPEN}}},12987:N=>{"use strict";N.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13436:N=>{"use strict";N.exports=function(N){for(var U=new Array(N),V=0;V<N;++V)U[V]=V;return U}},13438:N=>{function U(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(U(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&U(N.slice(0,0))}(N)||!!N._isBuffer)}},13429:(N,U,V)=>{var A=V(13436),t=V(13438),n="undefined"!==typeof Float64Array;function q(N,U){return N[0]-U[0]}function i(){var N,U=this.stride,V=new Array(U.length);for(N=0;N<V.length;++N)V[N]=[Math.abs(U[N]),N];V.sort(q);var A=new Array(V.length);for(N=0;N<A.length;++N)A[N]=V[N][1];return A}function z(N,U){var V=["View",U,"d",N].join("");U<0&&(V="View_Nil"+N);var t="generic"===N;if(-1===U){var n="function "+V+"(a){this.data=a;};var proto="+V+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+V+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+V+"(a){return new "+V+"(a);}";return new Function(n)()}if(0===U){n="function "+V+"(a,d) {this.data = a;this.offset = d};var proto="+V+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+V+"_copy() {return new "+V+"(this.data,this.offset)};proto.pick=function "+V+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+V+"_get(){return "+(t?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+V+"_set(v){return "+(t?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+V+"(a,b,c,d){return new "+V+"(a,d)}";return new Function("TrivialArray",n)(S[N][0])}n=["'use strict'"];var q=A(U),z=q.map((function(N){return"i"+N})),E="this.offset+"+q.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),p=q.map((function(N){return"b"+N})).join(","),k=q.map((function(N){return"c"+N})).join(",");n.push("function "+V+"(a,"+p+","+k+",d){this.data=a","this.shape=["+p+"]","this.stride=["+k+"]","this.offset=d|0}","var proto="+V+".prototype","proto.dtype='"+N+"'","proto.dimension="+U),n.push("Object.defineProperty(proto,'size',{get:function "+V+"_size(){return "+q.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===U?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),U<4?(n.push("function "+V+"_order(){"),2===U?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+V+"_set("+z.join(",")+",v){"),t?n.push("return this.data.set("+E+",v)}"):n.push("return this.data["+E+"]=v}"),n.push("proto.get=function "+V+"_get("+z.join(",")+"){"),t?n.push("return this.data.get("+E+")}"):n.push("return this.data["+E+"]}"),n.push("proto.index=function "+V+"_index(",z.join(),"){return "+E+"}"),n.push("proto.hi=function "+V+"_hi("+z.join(",")+"){return new "+V+"(this.data,"+q.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+q.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var B=q.map((function(N){return"a"+N+"=this.shape["+N+"]"})),C=q.map((function(N){return"c"+N+"=this.stride["+N+"]"}));n.push("proto.lo=function "+V+"_lo("+z.join(",")+"){var b=this.offset,d=0,"+B.join(",")+","+C.join(","));for(var x=0;x<U;++x)n.push("if(typeof i"+x+"==='number'&&i"+x+">=0){d=i"+x+"|0;b+=c"+x+"*d;a"+x+"-=d}");n.push("return new "+V+"(this.data,"+q.map((function(N){return"a"+N})).join(",")+","+q.map((function(N){return"c"+N})).join(",")+",b)}"),n.push("proto.step=function "+V+"_step("+z.join(",")+"){var "+q.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+q.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(x=0;x<U;++x)n.push("if(typeof i"+x+"==='number'){d=i"+x+"|0;if(d<0){c+=b"+x+"*(a"+x+"-1);a"+x+"=ceil(-a"+x+"/d)}else{a"+x+"=ceil(a"+x+"/d)}b"+x+"*=d}");n.push("return new "+V+"(this.data,"+q.map((function(N){return"a"+N})).join(",")+","+q.map((function(N){return"b"+N})).join(",")+",c)}");var J=new Array(U),d=new Array(U);for(x=0;x<U;++x)J[x]="a[i"+x+"]",d[x]="b[i"+x+"]";n.push("proto.transpose=function "+V+"_transpose("+z+"){"+z.map((function(N,U){return N+"=("+N+"===undefined?"+U+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+V+"(this.data,"+J.join(",")+","+d.join(",")+",this.offset)}"),n.push("proto.pick=function "+V+"_pick("+z+"){var a=[],b=[],c=this.offset");for(x=0;x<U;++x)n.push("if(typeof i"+x+"==='number'&&i"+x+">=0){c=(c+this.stride["+x+"]*i"+x+")|0}else{a.push(this.shape["+x+"]);b.push(this.stride["+x+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+V+"(data,shape,stride,offset){return new "+V+"(data,"+q.map((function(N){return"shape["+N+"]"})).join(",")+","+q.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(S[N],i)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,U,V,A){if(void 0===N)return(0,S.array[0])([]);"number"===typeof N&&(N=[N]),void 0===U&&(U=[N.length]);var q=U.length;if(void 0===V){V=new Array(q);for(var i=q-1,E=1;i>=0;--i)V[i]=E,E*=U[i]}if(void 0===A){A=0;for(i=0;i<q;++i)V[i]<0&&(A-=(U[i]-1)*V[i])}for(var p=function(N){if(t(N))return"buffer";if(n)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),k=S[p];k.length<=q+1;)k.push(z(p,k.length-1));return(0,k[q+1])(N,U,V,A)}},14426:N=>{var U;self,U=()=>(()=>{"use strict";var N={d:(U,V)=>{for(var A in V)N.o(V,A)&&!N.o(U,A)&&Object.defineProperty(U,A,{enumerable:!0,get:V[A]})},o:(N,U)=>Object.prototype.hasOwnProperty.call(N,U)},U={};N.d(U,{default:()=>Q});var V,A=function(N,U){var V=U.x-N.x,A=U.y-N.y;return Math.sqrt(V*V+A*A)},t=function(N){return N*(Math.PI/180)},n=new Map,q=function(N){n.has(N)&&clearTimeout(n.get(N)),n.set(N,setTimeout(N,100))},i=function(N,U,V){for(var A,t=U.split(/[ ,]+/g),n=0;n<t.length;n+=1)A=t[n],N.addEventListener?N.addEventListener(A,V,!1):N.attachEvent&&N.attachEvent(A,V)},z=function(N,U,V){for(var A,t=U.split(/[ ,]+/g),n=0;n<t.length;n+=1)A=t[n],N.removeEventListener?N.removeEventListener(A,V):N.detachEvent&&N.detachEvent(A,V)},S=function(N){return N.preventDefault(),N.type.match(/^touch/)?N.changedTouches:N},E=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},p=function(N,U){U.top||U.right||U.bottom||U.left?(N.style.top=U.top,N.style.right=U.right,N.style.bottom=U.bottom,N.style.left=U.left):(N.style.left=U.x+"px",N.style.top=U.y+"px")},k=function(N,U,V){var A=B(N);for(var t in A)if(A.hasOwnProperty(t))if("string"==typeof U)A[t]=U+" "+V;else{for(var n="",q=0,i=U.length;q<i;q+=1)n+=U[q]+" "+V+", ";A[t]=n.slice(0,-2)}return A},B=function(N){var U={};return U[N]="",["webkit","Moz","o"].forEach((function(V){U[V+N.charAt(0).toUpperCase()+N.slice(1)]=""})),U},C=function(N,U){for(var V in U)U.hasOwnProperty(V)&&(N[V]=U[V]);return N},x=function(N,U){if(N.length)for(var V=0,A=N.length;V<A;V+=1)U(N[V]);else U(N)},J="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,d=window.matchMedia("(any-hover: none)").matches,r=!!("ontouchstart"in window),v=!!window.PointerEvent,h=!!window.MSPointerEvent,c={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},H={start:"mousedown",move:"mousemove",end:"mouseup"},Y={};function W(){}J&&!d?V=c:v?V={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:h?V={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:r?(V=c,Y=H):V=H,W.prototype.on=function(N,U){var V,A=this,t=N.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var n=0;n<t.length;n+=1)V=t[n],A._handlers_[V]=A._handlers_[V]||[],A._handlers_[V].push(U);return A},W.prototype.off=function(N,U){var V=this;return V._handlers_=V._handlers_||{},void 0===N?V._handlers_={}:void 0===U?V._handlers_[N]=null:V._handlers_[N]&&V._handlers_[N].indexOf(U)>=0&&V._handlers_[N].splice(V._handlers_[N].indexOf(U),1),V},W.prototype.trigger=function(N,U){var V,A=this,t=N.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var n=0;n<t.length;n+=1)V=t[n],A._handlers_[V]&&A._handlers_[V].length&&A._handlers_[V].forEach((function(N){N.call(A,{type:V,target:A},U)}))},W.prototype.config=function(N){var U=this;U.options=U.defaults||{},N&&(U.options=function(N,U){var V={};for(var A in N)N.hasOwnProperty(A)&&U.hasOwnProperty(A)?V[A]=U[A]:N.hasOwnProperty(A)&&(V[A]=N[A]);return V}(U.options,N))},W.prototype.bindEvt=function(N,U){var A=this;return A._domHandlers_=A._domHandlers_||{},A._domHandlers_[U]=function(){"function"==typeof A["on"+U]?A["on"+U].apply(A,arguments):console.warn('[WARNING] : Missing "on'+U+'" handler.')},i(N,V[U],A._domHandlers_[U]),Y[U]&&i(N,Y[U],A._domHandlers_[U]),A},W.prototype.unbindEvt=function(N,U){var A=this;return A._domHandlers_=A._domHandlers_||{},z(N,V[U],A._domHandlers_[U]),Y[U]&&z(N,Y[U],A._domHandlers_[U]),delete A._domHandlers_[U],this};const s=W;function M(N,U){return this.identifier=U.identifier,this.position=U.position,this.frontPosition=U.frontPosition,this.collection=N,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(U),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=M.id,M.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}M.prototype=new s,M.constructor=M,M.id=0,M.prototype.buildEl=function(N){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},M.prototype.stylize=function(){if(this.options.dataOnly)return this;var N=this.options.fadeTime+"ms",U=function(){var N=B("borderRadius");for(var U in N)N.hasOwnProperty(U)&&(N[U]="50%");return N}(),V=k("transition","opacity",N),A={};return A.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},A.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},A.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},C(A.el,V),"circle"===this.options.shape&&C(A.back,U),C(A.front,U),this.applyStyles(A),this},M.prototype.applyStyles=function(N){for(var U in this.ui)if(this.ui.hasOwnProperty(U))for(var V in N[U])this.ui[U].style[V]=N[U][V];return this},M.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},M.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},M.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},M.prototype.show=function(N){var U=this;return U.options.dataOnly||(clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.addToDom(),U.restCallback(),setTimeout((function(){U.ui.el.style.opacity=1}),0),U.showTimeout=setTimeout((function(){U.trigger("shown",U.instance),"function"==typeof N&&N.call(this)}),U.options.fadeTime)),U},M.prototype.hide=function(N){var U=this;if(U.options.dataOnly)return U;if(U.ui.el.style.opacity=U.options.restOpacity,clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.removeTimeout=setTimeout((function(){var V="dynamic"===U.options.mode?"none":"block";U.ui.el.style.display=V,"function"==typeof N&&N.call(U),U.trigger("hidden",U.instance)}),U.options.fadeTime),U.options.restJoystick){var V=U.options.restJoystick,A={};A.x=!0===V||!1!==V.x?0:U.instance.frontPosition.x,A.y=!0===V||!1!==V.y?0:U.instance.frontPosition.y,U.setPosition(N,A)}return U},M.prototype.setPosition=function(N,U){var V=this;V.frontPosition={x:U.x,y:U.y};var A=V.options.fadeTime+"ms",t={};t.front=k("transition",["transform"],A);var n={front:{}};n.front={transform:"translate("+V.frontPosition.x+"px,"+V.frontPosition.y+"px)"},V.applyStyles(t),V.applyStyles(n),V.restTimeout=setTimeout((function(){"function"==typeof N&&N.call(V),V.restCallback()}),V.options.fadeTime)},M.prototype.restCallback=function(){var N=this,U={};U.front=k("transition","none",""),N.applyStyles(U),N.trigger("rested",N.instance)},M.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},M.prototype.computeDirection=function(N){var U,V,A,t=N.angle.radian,n=Math.PI/4,q=Math.PI/2;if(t>n&&t<3*n&&!N.lockX?U="up":t>-n&&t<=n&&!N.lockY?U="left":t>3*-n&&t<=-n&&!N.lockX?U="down":N.lockY||(U="right"),N.lockY||(V=t>-q&&t<q?"left":"right"),N.lockX||(A=t>0?"up":"down"),N.force>this.options.threshold){var i,z={};for(i in this.direction)this.direction.hasOwnProperty(i)&&(z[i]=this.direction[i]);var S={};for(i in this.direction={x:V,y:A,angle:U},N.direction=this.direction,z)z[i]===this.direction[i]&&(S[i]=!0);if(S.x&&S.y&&S.angle)return N;S.x&&S.y||this.trigger("plain",N),S.x||this.trigger("plain:"+V,N),S.y||this.trigger("plain:"+A,N),S.angle||this.trigger("dir dir:"+U,N)}else this.resetDirection();return N};const a=M;function mN(N,U){var V=this;V.nipples=[],V.idles=[],V.actives=[],V.ids=[],V.pressureIntervals={},V.manager=N,V.id=mN.id,mN.id+=1,V.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},V.config(U),"static"!==V.options.mode&&"semi"!==V.options.mode||(V.options.multitouch=!1),V.options.multitouch||(V.options.maxNumberOfNipples=1);var A=getComputedStyle(V.options.zone.parentElement);return A&&"flex"===A.display&&(V.parentIsFlex=!0),V.updateBox(),V.prepareNipples(),V.qk(),V.begin(),V.nipples}mN.prototype=new s,mN.constructor=mN,mN.id=0,mN.prototype.prepareNipples=function(){var N=this,U=N.nipples;U.on=N.on.bind(N),U.off=N.off.bind(N),U.options=N.options,U.destroy=N.destroy.bind(N),U.ids=N.ids,U.id=N.id,U.processOnMove=N.processOnMove.bind(N),U.processOnEnd=N.processOnEnd.bind(N),U.get=function(N){if(void 0===N)return U[0];for(var V=0,A=U.length;V<A;V+=1)if(U[V].identifier===N)return U[V];return!1}},mN.prototype.qk=function(){var N=this;N.bindEvt(N.options.zone,"start"),N.options.zone.style.touchAction="none",N.options.zone.style.msTouchAction="none"},mN.prototype.begin=function(){var N=this,U=N.options;if("static"===U.mode){var V=N.createNipple(U.position,N.manager.getIdentifier());V.add(),N.idles.push(V)}},mN.prototype.createNipple=function(N,U){var V=this,A=V.manager.scroll,t={},n=V.options,q=V.parentIsFlex?A.x:A.x+V.box.left,i=V.parentIsFlex?A.y:A.y+V.box.top;if(N.x&&N.y)t={x:N.x-q,y:N.y-i};else if(N.top||N.right||N.bottom||N.left){var z=document.createElement("DIV");z.style.display="hidden",z.style.top=N.top,z.style.right=N.right,z.style.bottom=N.bottom,z.style.left=N.left,z.style.position="absolute",n.zone.appendChild(z);var S=z.getBoundingClientRect();n.zone.removeChild(z),t=N,N={x:S.left+A.x,y:S.top+A.y}}var E=new a(V,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:U,position:N,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(p(E.ui.el,t),p(E.ui.front,E.frontPosition)),V.nipples.push(E),V.trigger("added "+E.identifier+":added",E),V.manager.trigger("added "+E.identifier+":added",E),V.bindNipple(E),E},mN.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},mN.prototype.bindNipple=function(N){var U,V=this,A=function(N,A){U=N.type+" "+A.id+":"+N.type,V.trigger(U,A)};N.on("destroyed",V.onDestroyed.bind(V)),N.on("shown hidden rested dir plain",A),N.on("dir:up dir:right dir:down dir:left",A),N.on("plain:up plain:right plain:down plain:left",A)},mN.prototype.pressureFn=function(N,U,V){var A=this,t=0;clearInterval(A.pressureIntervals[V]),A.pressureIntervals[V]=setInterval(function(){var V=N.force||N.pressure||N.webkitForce||0;V!==t&&(U.trigger("pressure",V),A.trigger("pressure "+U.identifier+":pressure",V),t=V)}.bind(A),100)},mN.prototype.onstart=function(N){var U=this,V=U.options,A=N;return N=S(N),U.updateBox(),x(N,(function(t){U.actives.length<V.maxNumberOfNipples?U.processOnStart(t):A.type.match(/^touch/)&&(Object.keys(U.manager.ids).forEach((function(V){if(Object.values(A.touches).findIndex((function(N){return N.identifier===V}))<0){var t=[N[0]];t.identifier=V,U.processOnEnd(t)}})),U.actives.length<V.maxNumberOfNipples&&U.processOnStart(t))})),U.manager.bindDocument(),!1},mN.prototype.processOnStart=function(N){var U,V=this,t=V.options,n=V.manager.getIdentifier(N),q=N.force||N.pressure||N.webkitForce||0,i={x:N.pageX,y:N.pageY},z=V.getOrCreate(n,i);z.identifier!==n&&V.manager.removeIdentifier(z.identifier),z.identifier=n;var S=function(U){U.trigger("start",U),V.trigger("start "+U.id+":start",U),U.show(),q>0&&V.pressureFn(N,U,U.identifier),V.processOnMove(N)};if((U=V.idles.indexOf(z))>=0&&V.idles.splice(U,1),V.actives.push(z),V.ids.push(z.identifier),"semi"!==t.mode)S(z);else{if(!(A(i,z.position)<=t.catchDistance))return z.destroy(),void V.processOnStart(N);S(z)}return z},mN.prototype.getOrCreate=function(N,U){var V,A=this,t=A.options;return/(semi|static)/.test(t.mode)?(V=A.idles[0])?(A.idles.splice(0,1),V):"semi"===t.mode?A.createNipple(U,N):(console.warn("Coudln't find the needed nipple."),!1):V=A.createNipple(U,N)},mN.prototype.processOnMove=function(N){var U=this,V=U.options,n=U.manager.getIdentifier(N),q=U.nipples.get(n),i=U.manager.scroll;if(function(N){return isNaN(N.buttons)?0!==N.pressure:0!==N.buttons}(N)){if(!q)return console.error("Found zombie joystick with ID "+n),void U.manager.removeIdentifier(n);if(V.dynamicPage){var z=q.el.getBoundingClientRect();q.position={x:i.x+z.left,y:i.y+z.top}}q.identifier=n;var S=q.options.size/2,E={x:N.pageX,y:N.pageY};V.lockX&&(E.y=q.position.y),V.lockY&&(E.x=q.position.x);var p,k,B,C,x,J,d,r,v,h,c=A(E,q.position),H=(p=E,B=(k=q.position).x-p.x,C=k.y-p.y,function(N){return N*(180/Math.PI)}(Math.atan2(C,B))),Y=t(H),W=c/S,s={distance:c,position:E};if("circle"===q.options.shape?(x=Math.min(c,S),d=q.position,r=x,h={x:0,y:0},v=t(v=H),h.x=d.x-r*Math.cos(v),h.y=d.y-r*Math.sin(v),J=h):(J=function(N,U,V){return{x:Math.min(Math.max(N.x,U.x-V),U.x+V),y:Math.min(Math.max(N.y,U.y-V),U.y+V)}}(E,q.position,S),x=A(J,q.position)),V.follow){if(c>S){var M=E.x-J.x,a=E.y-J.y;q.position.x+=M,q.position.y+=a,q.el.style.top=q.position.y-(U.box.top+i.y)+"px",q.el.style.left=q.position.x-(U.box.left+i.x)+"px",c=A(E,q.position)}}else E=J,c=x;var mN=E.x-q.position.x,w=E.y-q.position.y;q.frontPosition={x:mN,y:w},V.dataOnly||(q.ui.front.style.transform="translate("+mN+"px,"+w+"px)");var X={identifier:q.identifier,position:E,force:W,pressure:N.force||N.pressure||N.webkitForce||0,distance:c,angle:{radian:Y,degree:H},vector:{x:mN/S,y:-w/S},raw:s,instance:q,lockX:V.lockX,lockY:V.lockY};(X=q.computeDirection(X)).angle={radian:t(180-H),degree:180-H},q.trigger("move",X),U.trigger("move "+q.id+":move",X)}else this.processOnEnd(N)},mN.prototype.processOnEnd=function(N){var U=this,V=U.options,A=U.manager.getIdentifier(N),t=U.nipples.get(A),n=U.manager.removeIdentifier(t.identifier);t&&(V.dataOnly||t.hide((function(){"dynamic"===V.mode&&(t.trigger("removed",t),U.trigger("removed "+t.id+":removed",t),U.manager.trigger("removed "+t.id+":removed",t),t.destroy())})),clearInterval(U.pressureIntervals[t.identifier]),t.resetDirection(),t.trigger("end",t),U.trigger("end "+t.id+":end",t),U.ids.indexOf(t.identifier)>=0&&U.ids.splice(U.ids.indexOf(t.identifier),1),U.actives.indexOf(t)>=0&&U.actives.splice(U.actives.indexOf(t),1),/(semi|static)/.test(V.mode)?U.idles.push(t):U.nipples.indexOf(t)>=0&&U.nipples.splice(U.nipples.indexOf(t),1),U.manager.unbindDocument(),/(semi|static)/.test(V.mode)&&(U.manager.ids[n.id]=n.identifier))},mN.prototype.onDestroyed=function(N,U){var V=this;V.nipples.indexOf(U)>=0&&V.nipples.splice(V.nipples.indexOf(U),1),V.actives.indexOf(U)>=0&&V.actives.splice(V.actives.indexOf(U),1),V.idles.indexOf(U)>=0&&V.idles.splice(V.idles.indexOf(U),1),V.ids.indexOf(U.identifier)>=0&&V.ids.splice(V.ids.indexOf(U.identifier),1),V.manager.removeIdentifier(U.identifier),V.manager.unbindDocument()},mN.prototype.destroy=function(){var N=this;for(var U in N.unbindEvt(N.options.zone,"start"),N.nipples.forEach((function(N){N.destroy()})),N.pressureIntervals)N.pressureIntervals.hasOwnProperty(U)&&clearInterval(N.pressureIntervals[U]);N.trigger("destroyed",N.nipples),N.manager.unbindDocument(),N.off()};const w=mN;function X(N){var U=this;U.ids={},U.index=0,U.collections=[],U.scroll=E(),U.config(N),U.prepareCollections();var V=function(){var N;U.collections.forEach((function(V){V.forEach((function(V){N=V.el.getBoundingClientRect(),V.position={x:U.scroll.x+N.left,y:U.scroll.y+N.top}}))}))};i(window,"resize",(function(){q(V)}));var A=function(){U.scroll=E()};return i(window,"scroll",(function(){q(A)})),U.collections}X.prototype=new s,X.constructor=X,X.prototype.prepareCollections=function(){var N=this;N.collections.create=N.create.bind(N),N.collections.on=N.on.bind(N),N.collections.off=N.off.bind(N),N.collections.destroy=N.destroy.bind(N),N.collections.get=function(U){var V;return N.collections.every((function(N){return!(V=N.get(U))})),V}},X.prototype.create=function(N){return this.createCollection(N)},X.prototype.createCollection=function(N){var U=this,V=new w(U,N);return U.bindCollection(V),U.collections.push(V),V},X.prototype.bindCollection=function(N){var U,V=this,A=function(N,A){U=N.type+" "+A.id+":"+N.type,V.trigger(U,A)};N.on("destroyed",V.onDestroyed.bind(V)),N.on("shown hidden rested dir plain",A),N.on("dir:up dir:right dir:down dir:left",A),N.on("plain:up plain:right plain:down plain:left",A)},X.prototype.bindDocument=function(){var N=this;N.binded||(N.bindEvt(document,"move").bindEvt(document,"end"),N.binded=!0)},X.prototype.unbindDocument=function(N){var U=this;Object.keys(U.ids).length&&!0!==N||(U.unbindEvt(document,"move").unbindEvt(document,"end"),U.binded=!1)},X.prototype.getIdentifier=function(N){var U;return N?void 0===(U=void 0===N.identifier?N.pointerId:N.identifier)&&(U=this.latest||0):U=this.index,void 0===this.ids[U]&&(this.ids[U]=this.index,this.index+=1),this.latest=U,this.ids[U]},X.prototype.removeIdentifier=function(N){var U={};for(var V in this.ids)if(this.ids[V]===N){U.id=V,U.identifier=this.ids[V],delete this.ids[V];break}return U},X.prototype.onmove=function(N){return this.onAny("move",N),!1},X.prototype.onend=function(N){return this.onAny("end",N),!1},X.prototype.oncancel=function(N){return this.onAny("end",N),!1},X.prototype.onAny=function(N,U){var V,A=this,t="processOn"+N.charAt(0).toUpperCase()+N.slice(1);U=S(U);var n=function(N,U,V){V.ids.indexOf(U)>=0&&(V[t](N),N._found_=!0)};return x(U,(function(N){V=A.getIdentifier(N),x(A.collections,n.bind(null,N,V)),N._found_||A.removeIdentifier(V)})),!1},X.prototype.destroy=function(){var N=this;N.unbindDocument(!0),N.ids={},N.index=0,N.collections.forEach((function(N){N.destroy()})),N.off()},X.prototype.onDestroyed=function(N,U){var V=this;if(V.collections.indexOf(U)<0)return!1;V.collections.splice(V.collections.indexOf(U),1)};var e=new X;const Q={create:function(N){return e.create(N)},factory:e};return U.default})(),N.exports=U()},13447:(N,U,V)=>{"use strict";const{Deflate:A,deflate:t,deflateRaw:n,gzip:q}=V(13452),{Inflate:i,inflate:z,inflateRaw:S,ungzip:E}=V(13517),p=V(13490);N.exports.Deflate=A,N.exports.deflate=t,N.exports.deflateRaw=n,N.exports.gzip=q,N.exports.Inflate=i,N.exports.inflate=z,N.exports.inflateRaw=S,N.exports.ungzip=E,N.exports.constants=p},13452:(N,U,V)=>{"use strict";const A=V(13454),t=V(13498),n=V(13500),q=V(13485),i=V(13508),z=Object.prototype.toString,{Z_NO_FLUSH:S,Z_SYNC_FLUSH:E,Z_FULL_FLUSH:p,Z_FINISH:k,Z_OK:B,Z_STREAM_END:C,Z_DEFAULT_COMPRESSION:x,Z_DEFAULT_STRATEGY:J,Z_DEFLATED:d}=V(13490);function r(N){this.options=t.assign({level:x,method:d,RN:16384,windowBits:15,memLevel:8,strategy:J},N||{});let U=this.options;U.raw&&U.windowBits>0?U.windowBits=-U.windowBits:U.gzip&&U.windowBits>0&&U.windowBits<16&&(U.windowBits+=16),this.err=0,this.SU="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let V=A.deflateInit2(this.strm,U.level,U.method,U.windowBits,U.memLevel,U.strategy);if(V!==B)throw new Error(q[V]);if(U.header&&A.deflateSetHeader(this.strm,U.header),U.dictionary){let N;if(N="string"===typeof U.dictionary?n.string2buf(U.dictionary):"[object ArrayBuffer]"===z.call(U.dictionary)?new Uint8Array(U.dictionary):U.dictionary,V=A.deflateSetDictionary(this.strm,N),V!==B)throw new Error(q[V]);this._dict_set=!0}}function v(N,U){const V=new r(U);if(V.push(N,!0),V.err)throw V.SU||q[V.err];return V.result}r.prototype.push=function(N,U){const V=this.strm,t=this.options.RN;let q,i;if(this.ended)return!1;for(i=U===~~U?U:!0===U?k:S,"string"===typeof N?V.input=n.string2buf(N):"[object ArrayBuffer]"===z.call(N)?V.input=new Uint8Array(N):V.input=N,V.next_in=0,V.avail_in=V.input.length;;)if(0===V.avail_out&&(V.output=new Uint8Array(t),V.next_out=0,V.avail_out=t),(i===E||i===p)&&V.avail_out<=6)this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;else{if(q=A.deflate(V,i),q===C)return V.next_out>0&&this.onData(V.output.subarray(0,V.next_out)),q=A.deflateEnd(this.strm),this.onEnd(q),this.ended=!0,q===B;if(0!==V.avail_out){if(i>0&&V.next_out>0)this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;else if(0===V.avail_in)break}else this.onData(V.output)}return!0},r.prototype.onData=function(N){this.chunks.push(N)},r.prototype.onEnd=function(N){N===B&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.SU=this.strm.SU},N.exports.Deflate=r,N.exports.deflate=v,N.exports.deflateRaw=function(N,U){return(U=U||{}).raw=!0,v(N,U)},N.exports.gzip=function(N,U){return(U=U||{}).gzip=!0,v(N,U)},N.exports.constants=V(13490)},13517:(N,U,V)=>{"use strict";const A=V(13521),t=V(13498),n=V(13500),q=V(13485),i=V(13508),z=V(13539),S=Object.prototype.toString,{Z_NO_FLUSH:E,Z_FINISH:p,Z_OK:k,Z_STREAM_END:B,Z_NEED_DICT:C,Z_STREAM_ERROR:x,Z_DATA_ERROR:J,Z_MEM_ERROR:d}=V(13490);function r(N){this.options=t.assign({RN:65536,windowBits:15,to:""},N||{});const U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,0===U.windowBits&&(U.windowBits=-15)),!(U.windowBits>=0&&U.windowBits<16)||N&&N.windowBits||(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&0===(15&U.windowBits)&&(U.windowBits|=15),this.err=0,this.SU="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let V=A.inflateInit2(this.strm,U.windowBits);if(V!==k)throw new Error(q[V]);if(this.header=new z,A.inflateGetHeader(this.strm,this.header),U.dictionary&&("string"===typeof U.dictionary?U.dictionary=n.string2buf(U.dictionary):"[object ArrayBuffer]"===S.call(U.dictionary)&&(U.dictionary=new Uint8Array(U.dictionary)),U.raw&&(V=A.inflateSetDictionary(this.strm,U.dictionary),V!==k)))throw new Error(q[V])}function v(N,U){const V=new r(U);if(V.push(N),V.err)throw V.SU||q[V.err];return V.result}r.prototype.push=function(N,U){const V=this.strm,t=this.options.RN,q=this.options.dictionary;let i,z,r;if(this.ended)return!1;for(z=U===~~U?U:!0===U?p:E,"[object ArrayBuffer]"===S.call(N)?V.input=new Uint8Array(N):V.input=N,V.next_in=0,V.avail_in=V.input.length;;){for(0===V.avail_out&&(V.output=new Uint8Array(t),V.next_out=0,V.avail_out=t),i=A.inflate(V,z),i===C&&q&&(i=A.inflateSetDictionary(V,q),i===k?i=A.inflate(V,z):i===J&&(i=C));V.avail_in>0&&i===B&&V.state.wrap>0&&0!==N[V.next_in];)A.inflateReset(V),i=A.inflate(V,z);switch(i){case x:case J:case C:case d:return this.onEnd(i),this.ended=!0,!1}if(r=V.avail_out,V.next_out&&(0===V.avail_out||i===B))if("string"===this.options.to){let N=n.utf8border(V.output,V.next_out),U=V.next_out-N,A=n.buf2string(V.output,N);V.next_out=U,V.avail_out=t-U,U&&V.output.set(V.output.subarray(N,N+U),0),this.onData(A)}else this.onData(V.output.length===V.next_out?V.output:V.output.subarray(0,V.next_out));if(i!==k||0!==r){if(i===B)return i=A.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===V.avail_in)break}}return!0},r.prototype.onData=function(N){this.chunks.push(N)},r.prototype.onEnd=function(N){N===k&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.SU=this.strm.SU},N.exports.Inflate=r,N.exports.inflate=v,N.exports.inflateRaw=function(N,U){return(U=U||{}).raw=!0,v(N,U)},N.exports.ungzip=v,N.exports.constants=V(13490)},13498:N=>{"use strict";const U=(N,U)=>Object.prototype.hasOwnProperty.call(N,U);N.exports.assign=function(N){const V=Array.prototype.slice.call(arguments,1);for(;V.length;){const A=V.shift();if(A){if("object"!==typeof A)throw new TypeError(A+"must be non-object");for(const V in A)U(A,V)&&(N[V]=A[V])}}return N},N.exports.flattenChunks=N=>{let U=0;for(let A=0,t=N.length;A<t;A++)U+=N[A].length;const V=new Uint8Array(U);for(let A=0,t=0,n=N.length;A<n;A++){let U=N[A];V.set(U,t),t+=U.length}return V}},13500:N=>{"use strict";let U=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){U=!1}const V=new Uint8Array(256);for(let t=0;t<256;t++)V[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;V[254]=V[254]=1,N.exports.string2buf=N=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(N);let U,V,A,t,n,q=N.length,i=0;for(t=0;t<q;t++)V=N.charCodeAt(t),55296===(64512&V)&&t+1<q&&(A=N.charCodeAt(t+1),56320===(64512&A)&&(V=65536+(V-55296<<10)+(A-56320),t++)),i+=V<128?1:V<2048?2:V<65536?3:4;for(U=new Uint8Array(i),n=0,t=0;n<i;t++)V=N.charCodeAt(t),55296===(64512&V)&&t+1<q&&(A=N.charCodeAt(t+1),56320===(64512&A)&&(V=65536+(V-55296<<10)+(A-56320),t++)),V<128?U[n++]=V:V<2048?(U[n++]=192|V>>>6,U[n++]=128|63&V):V<65536?(U[n++]=224|V>>>12,U[n++]=128|V>>>6&63,U[n++]=128|63&V):(U[n++]=240|V>>>18,U[n++]=128|V>>>12&63,U[n++]=128|V>>>6&63,U[n++]=128|63&V);return U};N.exports.buf2string=(N,A)=>{const t=A||N.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(N.subarray(0,A));let n,q;const i=new Array(2*t);for(q=0,n=0;n<t;){let U=N[n++];if(U<128){i[q++]=U;continue}let A=V[U];if(A>4)i[q++]=65533,n+=A-1;else{for(U&=2===A?31:3===A?15:7;A>1&&n<t;)U=U<<6|63&N[n++],A--;A>1?i[q++]=65533:U<65536?i[q++]=U:(U-=65536,i[q++]=55296|U>>10&1023,i[q++]=56320|1023&U)}}return((N,V)=>{if(V<65534&&N.subarray&&U)return String.fromCharCode.apply(null,N.length===V?N:N.subarray(0,V));let A="";for(let U=0;U<V;U++)A+=String.fromCharCode(N[U]);return A})(i,q)},N.exports.utf8border=(N,U)=>{(U=U||N.length)>N.length&&(U=N.length);let A=U-1;for(;A>=0&&128===(192&N[A]);)A--;return A<0||0===A?U:A+V[N[A]]>U?A:U}},13469:N=>{"use strict";N.exports=(N,U,V,A)=>{let t=65535&N,n=N>>>16&65535,q=0;for(;0!==V;){q=V>2e3?2e3:V,V-=q;do{t=t+U[A++]|0,n=n+t|0}while(--q);t%=65521,n%=65521}return t|n<<16}},13490:N=>{"use strict";N.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13478:N=>{"use strict";const U=new Uint32Array((()=>{let N,U=[];for(var V=0;V<256;V++){N=V;for(var A=0;A<8;A++)N=1&N?3988292384^N>>>1:N>>>1;U[V]=N}return U})());N.exports=(N,V,A,t)=>{const n=U,q=t+A;N^=-1;for(let U=t;U<q;U++)N=N>>>8^n[255&(N^V[U])];return~N}},13454:(N,U,V)=>{"use strict";const{_tr_init:A,_tr_stored_block:t,_tr_flush_block:n,_tr_tally:q,_tr_align:i}=V(13462),z=V(13469),S=V(13478),E=V(13485),{Z_NO_FLUSH:p,Z_PARTIAL_FLUSH:k,Z_FULL_FLUSH:B,Z_FINISH:C,Z_BLOCK:x,Z_OK:J,Z_STREAM_END:d,Z_STREAM_ERROR:r,Z_DATA_ERROR:v,Z_BUF_ERROR:h,Z_DEFAULT_COMPRESSION:c,Z_FILTERED:H,Z_HUFFMAN_ONLY:Y,Z_RLE:W,Z_FIXED:s,Z_DEFAULT_STRATEGY:M,Z_UNKNOWN:a,Z_DEFLATED:mN}=V(13490),w=258,X=262,e=103,Q=113,u=666,L=(N,U)=>(N.SU=E[U],U),I=N=>(N<<1)-(N>4?9:0),o=N=>{let U=N.length;for(;--U>=0;)N[U]=0};let R=(N,U,V)=>(U<<N.hash_shift^V)&N.hash_mask;const D=N=>{const U=N.state;let V=U.pending;V>N.avail_out&&(V=N.avail_out),0!==V&&(N.output.set(U.pending_buf.subarray(U.pending_out,U.pending_out+V),N.next_out),N.next_out+=V,U.pending_out+=V,N.total_out+=V,N.avail_out-=V,U.pending-=V,0===U.pending&&(U.pending_out=0))},G=(N,U)=>{n(N,N.block_start>=0?N.block_start:-1,N.strstart-N.block_start,U),N.block_start=N.strstart,D(N.strm)},g=(N,U)=>{N.pending_buf[N.pending++]=U},l=(N,U)=>{N.pending_buf[N.pending++]=U>>>8&255,N.pending_buf[N.pending++]=255&U},K=(N,U,V,A)=>{let t=N.avail_in;return t>A&&(t=A),0===t?0:(N.avail_in-=t,U.set(N.input.subarray(N.next_in,N.next_in+t),V),1===N.state.wrap?N.adler=z(N.adler,U,t,V):2===N.state.wrap&&(N.adler=S(N.adler,U,t,V)),N.next_in+=t,N.total_in+=t,t)},j=(N,U)=>{let V,A,t=N.max_chain_length,n=N.strstart,q=N.prev_length,i=N.nice_match;const z=N.strstart>N.w_size-X?N.strstart-(N.w_size-X):0,S=N.window,E=N.w_mask,p=N.prev,k=N.strstart+w;let B=S[n+q-1],C=S[n+q];N.prev_length>=N.good_match&&(t>>=2),i>N.lookahead&&(i=N.lookahead);do{if(V=U,S[V+q]===C&&S[V+q-1]===B&&S[V]===S[n]&&S[++V]===S[n+1]){n+=2,V++;do{}while(S[++n]===S[++V]&&S[++n]===S[++V]&&S[++n]===S[++V]&&S[++n]===S[++V]&&S[++n]===S[++V]&&S[++n]===S[++V]&&S[++n]===S[++V]&&S[++n]===S[++V]&&n<k);if(A=w-(k-n),n=k-w,A>q){if(N.match_start=U,q=A,A>=i)break;B=S[n+q-1],C=S[n+q]}}}while((U=p[U&E])>z&&0!==--t);return q<=N.lookahead?q:N.lookahead},F=N=>{const U=N.w_size;let V,A,t,n,q;do{if(n=N.window_size-N.lookahead-N.strstart,N.strstart>=U+(U-X)){N.window.set(N.window.subarray(U,U+U),0),N.match_start-=U,N.strstart-=U,N.block_start-=U,A=N.hash_size,V=A;do{t=N.head[--V],N.head[V]=t>=U?t-U:0}while(--A);A=U,V=A;do{t=N.prev[--V],N.prev[V]=t>=U?t-U:0}while(--A);n+=U}if(0===N.strm.avail_in)break;if(A=K(N.strm,N.window,N.strstart+N.lookahead,n),N.lookahead+=A,N.lookahead+N.insert>=3)for(q=N.strstart-N.insert,N.ins_h=N.window[q],N.ins_h=R(N,N.ins_h,N.window[q+1]);N.insert&&(N.ins_h=R(N,N.ins_h,N.window[q+3-1]),N.prev[q&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=q,q++,N.insert--,!(N.lookahead+N.insert<3)););}while(N.lookahead<X&&0!==N.strm.avail_in)},P=(N,U)=>{let V,A;for(;;){if(N.lookahead<X){if(F(N),N.lookahead<X&&U===p)return 1;if(0===N.lookahead)break}if(V=0,N.lookahead>=3&&(N.ins_h=R(N,N.ins_h,N.window[N.strstart+3-1]),V=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),0!==V&&N.strstart-V<=N.w_size-X&&(N.match_length=j(N,V)),N.match_length>=3)if(A=q(N,N.strstart-N.match_start,N.match_length-3),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=3){N.match_length--;do{N.strstart++,N.ins_h=R(N,N.ins_h,N.window[N.strstart+3-1]),V=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart}while(0!==--N.match_length);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=R(N,N.ins_h,N.window[N.strstart+1]);else A=q(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(A&&(G(N,!1),0===N.strm.avail_out))return 1}return N.insert=N.strstart<2?N.strstart:2,U===C?(G(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(G(N,!1),0===N.strm.avail_out)?1:2},T=(N,U)=>{let V,A,t;for(;;){if(N.lookahead<X){if(F(N),N.lookahead<X&&U===p)return 1;if(0===N.lookahead)break}if(V=0,N.lookahead>=3&&(N.ins_h=R(N,N.ins_h,N.window[N.strstart+3-1]),V=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=2,0!==V&&N.prev_length<N.max_lazy_match&&N.strstart-V<=N.w_size-X&&(N.match_length=j(N,V),N.match_length<=5&&(N.strategy===H||3===N.match_length&&N.strstart-N.match_start>4096)&&(N.match_length=2)),N.prev_length>=3&&N.match_length<=N.prev_length){t=N.strstart+N.lookahead-3,A=q(N,N.strstart-1-N.prev_match,N.prev_length-3),N.lookahead-=N.prev_length-1,N.prev_length-=2;do{++N.strstart<=t&&(N.ins_h=R(N,N.ins_h,N.window[N.strstart+3-1]),V=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart)}while(0!==--N.prev_length);if(N.match_available=0,N.match_length=2,N.strstart++,A&&(G(N,!1),0===N.strm.avail_out))return 1}else if(N.match_available){if(A=q(N,0,N.window[N.strstart-1]),A&&G(N,!1),N.strstart++,N.lookahead--,0===N.strm.avail_out)return 1}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(A=q(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<2?N.strstart:2,U===C?(G(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(G(N,!1),0===N.strm.avail_out)?1:2};function f(N,U,V,A,t){this.good_length=N,this.max_lazy=U,this.nice_length=V,this.max_chain=A,this.func=t}const O=[new f(0,0,0,0,((N,U)=>{let V=65535;for(V>N.pending_buf_size-5&&(V=N.pending_buf_size-5);;){if(N.lookahead<=1){if(F(N),0===N.lookahead&&U===p)return 1;if(0===N.lookahead)break}N.strstart+=N.lookahead,N.lookahead=0;const A=N.block_start+V;if((0===N.strstart||N.strstart>=A)&&(N.lookahead=N.strstart-A,N.strstart=A,G(N,!1),0===N.strm.avail_out))return 1;if(N.strstart-N.block_start>=N.w_size-X&&(G(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,U===C?(G(N,!0),0===N.strm.avail_out?3:4):(N.strstart>N.block_start&&(G(N,!1),N.strm.avail_out),1)})),new f(4,4,8,4,P),new f(4,5,16,8,P),new f(4,6,32,32,P),new f(4,4,16,16,T),new f(8,16,32,32,T),new f(8,16,128,128,T),new f(8,32,128,256,T),new f(32,128,258,1024,T),new f(32,258,258,4096,T)];function Z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=mN,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const b=N=>{if(!N||!N.state)return L(N,r);N.total_in=N.total_out=0,N.data_type=a;const U=N.state;return U.pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?42:Q,N.adler=2===U.wrap?0:1,U.last_flush=p,A(U),J},y=N=>{const U=b(N);var V;return U===J&&((V=N.state).window_size=2*V.w_size,o(V.head),V.max_lazy_match=O[V.level].max_lazy,V.good_match=O[V.level].good_length,V.nice_match=O[V.level].nice_length,V.max_chain_length=O[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=2,V.match_available=0,V.ins_h=0),U},NN=(N,U,V,A,t,n)=>{if(!N)return r;let q=1;if(U===c&&(U=6),A<0?(q=0,A=-A):A>15&&(q=2,A-=16),t<1||t>9||V!==mN||A<8||A>15||U<0||U>9||n<0||n>s)return L(N,r);8===A&&(A=9);const i=new Z;return N.state=i,i.strm=N,i.wrap=q,i.gzhead=null,i.w_bits=A,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=t+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<t+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=U,i.strategy=n,i.method=V,y(N)};N.exports.deflateInit=(N,U)=>NN(N,U,mN,15,8,M),N.exports.deflateInit2=NN,N.exports.deflateReset=y,N.exports.deflateResetKeep=b,N.exports.deflateSetHeader=(N,U)=>N&&N.state?2!==N.state.wrap?r:(N.state.gzhead=U,J):r,N.exports.deflate=(N,U)=>{let V,A;if(!N||!N.state||U>x||U<0)return N?L(N,r):r;const n=N.state;if(!N.output||!N.input&&0!==N.avail_in||n.status===u&&U!==C)return L(N,0===N.avail_out?h:r);n.strm=N;const z=n.last_flush;if(n.last_flush=U,42===n.status)if(2===n.wrap)N.adler=0,g(n,31),g(n,139),g(n,8),n.gzhead?(g(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),g(n,255&n.gzhead.time),g(n,n.gzhead.time>>8&255),g(n,n.gzhead.time>>16&255),g(n,n.gzhead.time>>24&255),g(n,9===n.level?2:n.strategy>=Y||n.level<2?4:0),g(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(g(n,255&n.gzhead.extra.length),g(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(N.adler=S(N.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(g(n,0),g(n,0),g(n,0),g(n,0),g(n,0),g(n,9===n.level?2:n.strategy>=Y||n.level<2?4:0),g(n,3),n.status=Q);else{let U=mN+(n.w_bits-8<<4)<<8,V=-1;V=n.strategy>=Y||n.level<2?0:n.level<6?1:6===n.level?2:3,U|=V<<6,0!==n.strstart&&(U|=32),U+=31-U%31,n.status=Q,l(n,U),0!==n.strstart&&(l(n,N.adler>>>16),l(n,65535&N.adler)),N.adler=1}if(69===n.status)if(n.gzhead.extra){for(V=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>V&&(N.adler=S(N.adler,n.pending_buf,n.pending-V,V)),D(N),V=n.pending,n.pending!==n.pending_buf_size));)g(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>V&&(N.adler=S(N.adler,n.pending_buf,n.pending-V,V)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){V=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>V&&(N.adler=S(N.adler,n.pending_buf,n.pending-V,V)),D(N),V=n.pending,n.pending===n.pending_buf_size)){A=1;break}A=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,g(n,A)}while(0!==A);n.gzhead.hcrc&&n.pending>V&&(N.adler=S(N.adler,n.pending_buf,n.pending-V,V)),0===A&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){V=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>V&&(N.adler=S(N.adler,n.pending_buf,n.pending-V,V)),D(N),V=n.pending,n.pending===n.pending_buf_size)){A=1;break}A=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,g(n,A)}while(0!==A);n.gzhead.hcrc&&n.pending>V&&(N.adler=S(N.adler,n.pending_buf,n.pending-V,V)),0===A&&(n.status=e)}else n.status=e;if(n.status===e&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&D(N),n.pending+2<=n.pending_buf_size&&(g(n,255&N.adler),g(n,N.adler>>8&255),N.adler=0,n.status=Q)):n.status=Q),0!==n.pending){if(D(N),0===N.avail_out)return n.last_flush=-1,J}else if(0===N.avail_in&&I(U)<=I(z)&&U!==C)return L(N,h);if(n.status===u&&0!==N.avail_in)return L(N,h);if(0!==N.avail_in||0!==n.lookahead||U!==p&&n.status!==u){let V=n.strategy===Y?((N,U)=>{let V;for(;;){if(0===N.lookahead&&(F(N),0===N.lookahead)){if(U===p)return 1;break}if(N.match_length=0,V=q(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,V&&(G(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,U===C?(G(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(G(N,!1),0===N.strm.avail_out)?1:2})(n,U):n.strategy===W?((N,U)=>{let V,A,t,n;const i=N.window;for(;;){if(N.lookahead<=w){if(F(N),N.lookahead<=w&&U===p)return 1;if(0===N.lookahead)break}if(N.match_length=0,N.lookahead>=3&&N.strstart>0&&(t=N.strstart-1,A=i[t],A===i[++t]&&A===i[++t]&&A===i[++t])){n=N.strstart+w;do{}while(A===i[++t]&&A===i[++t]&&A===i[++t]&&A===i[++t]&&A===i[++t]&&A===i[++t]&&A===i[++t]&&A===i[++t]&&t<n);N.match_length=w-(n-t),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=3?(V=q(N,1,N.match_length-3),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(V=q(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),V&&(G(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,U===C?(G(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(G(N,!1),0===N.strm.avail_out)?1:2})(n,U):O[n.level].func(n,U);if(3!==V&&4!==V||(n.status=u),1===V||3===V)return 0===N.avail_out&&(n.last_flush=-1),J;if(2===V&&(U===k?i(n):U!==x&&(t(n,0,0,!1),U===B&&(o(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),D(N),0===N.avail_out))return n.last_flush=-1,J}return U!==C?J:n.wrap<=0?d:(2===n.wrap?(g(n,255&N.adler),g(n,N.adler>>8&255),g(n,N.adler>>16&255),g(n,N.adler>>24&255),g(n,255&N.total_in),g(n,N.total_in>>8&255),g(n,N.total_in>>16&255),g(n,N.total_in>>24&255)):(l(n,N.adler>>>16),l(n,65535&N.adler)),D(N),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?J:d)},N.exports.deflateEnd=N=>{if(!N||!N.state)return r;const U=N.state.status;return 42!==U&&69!==U&&73!==U&&91!==U&&U!==e&&U!==Q&&U!==u?L(N,r):(N.state=null,U===Q?L(N,v):J)},N.exports.deflateSetDictionary=(N,U)=>{let V=U.length;if(!N||!N.state)return r;const A=N.state,t=A.wrap;if(2===t||1===t&&42!==A.status||A.lookahead)return r;if(1===t&&(N.adler=z(N.adler,U,V,0)),A.wrap=0,V>=A.w_size){0===t&&(o(A.head),A.strstart=0,A.block_start=0,A.insert=0);let N=new Uint8Array(A.w_size);N.set(U.subarray(V-A.w_size,V),0),U=N,V=A.w_size}const n=N.avail_in,q=N.next_in,i=N.input;for(N.avail_in=V,N.next_in=0,N.input=U,F(A);A.lookahead>=3;){let N=A.strstart,U=A.lookahead-2;do{A.ins_h=R(A,A.ins_h,A.window[N+3-1]),A.prev[N&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=N,N++}while(--U);A.strstart=N,A.lookahead=2,F(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=2,A.match_available=0,N.next_in=q,N.input=i,N.avail_in=n,A.wrap=t,J},N.exports.deflateInfo="pako deflate (from Nodeca project)"},13539:N=>{"use strict";N.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13529:N=>{"use strict";N.exports=function(N,U){let V,A,t,n,q,i,z,S,E,p,k,B,C,x,J,d,r,v,h,c,H,Y,W,s;const M=N.state;V=N.next_in,W=N.input,A=V+(N.avail_in-5),t=N.next_out,s=N.output,n=t-(U-N.avail_out),q=t+(N.avail_out-257),i=M.dmax,z=M.wsize,S=M.whave,E=M.wnext,p=M.window,k=M.hold,B=M.bits,C=M.lencode,x=M.distcode,J=(1<<M.lenbits)-1,d=(1<<M.distbits)-1;N:do{B<15&&(k+=W[V++]<<B,B+=8,k+=W[V++]<<B,B+=8),r=C[k&J];U:for(;;){if(v=r>>>24,k>>>=v,B-=v,v=r>>>16&255,0===v)s[t++]=65535&r;else{if(!(16&v)){if(0===(64&v)){r=C[(65535&r)+(k&(1<<v)-1)];continue U}if(32&v){M.mode=12;break N}N.SU="invalid literal/length code",M.mode=30;break N}h=65535&r,v&=15,v&&(B<v&&(k+=W[V++]<<B,B+=8),h+=k&(1<<v)-1,k>>>=v,B-=v),B<15&&(k+=W[V++]<<B,B+=8,k+=W[V++]<<B,B+=8),r=x[k&d];V:for(;;){if(v=r>>>24,k>>>=v,B-=v,v=r>>>16&255,!(16&v)){if(0===(64&v)){r=x[(65535&r)+(k&(1<<v)-1)];continue V}N.SU="invalid distance code",M.mode=30;break N}if(c=65535&r,v&=15,B<v&&(k+=W[V++]<<B,B+=8,B<v&&(k+=W[V++]<<B,B+=8)),c+=k&(1<<v)-1,c>i){N.SU="invalid distance too far back",M.mode=30;break N}if(k>>>=v,B-=v,v=t-n,c>v){if(v=c-v,v>S&&M.sane){N.SU="invalid distance too far back",M.mode=30;break N}if(H=0,Y=p,0===E){if(H+=z-v,v<h){h-=v;do{s[t++]=p[H++]}while(--v);H=t-c,Y=s}}else if(E<v){if(H+=z+E-v,v-=E,v<h){h-=v;do{s[t++]=p[H++]}while(--v);if(H=0,E<h){v=E,h-=v;do{s[t++]=p[H++]}while(--v);H=t-c,Y=s}}}else if(H+=E-v,v<h){h-=v;do{s[t++]=p[H++]}while(--v);H=t-c,Y=s}for(;h>2;)s[t++]=Y[H++],s[t++]=Y[H++],s[t++]=Y[H++],h-=3;h&&(s[t++]=Y[H++],h>1&&(s[t++]=Y[H++]))}else{H=t-c;do{s[t++]=s[H++],s[t++]=s[H++],s[t++]=s[H++],h-=3}while(h>2);h&&(s[t++]=s[H++],h>1&&(s[t++]=s[H++]))}break}}break}}while(V<A&&t<q);h=B>>3,V-=h,B-=h<<3,k&=(1<<B)-1,N.next_in=V,N.next_out=t,N.avail_in=V<A?A-V+5:5-(V-A),N.avail_out=t<q?q-t+257:257-(t-q),M.hold=k,M.bits=B}},13521:(N,U,V)=>{"use strict";const A=V(13469),t=V(13478),n=V(13529),q=V(13533),{Z_FINISH:i,Z_BLOCK:z,Z_TREES:S,Z_OK:E,Z_STREAM_END:p,Z_NEED_DICT:k,Z_STREAM_ERROR:B,Z_DATA_ERROR:C,Z_MEM_ERROR:x,Z_BUF_ERROR:J,Z_DEFLATED:d}=V(13490),r=12,v=30,h=N=>(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24);function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const H=N=>{if(!N||!N.state)return B;const U=N.state;return N.total_in=N.total_out=U.total=0,N.SU="",U.wrap&&(N.adler=1&U.wrap),U.mode=1,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new Int32Array(852),U.distcode=U.distdyn=new Int32Array(592),U.sane=1,U.back=-1,E},Y=N=>{if(!N||!N.state)return B;const U=N.state;return U.wsize=0,U.whave=0,U.wnext=0,H(N)},W=(N,U)=>{let V;if(!N||!N.state)return B;const A=N.state;return U<0?(V=0,U=-U):(V=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?B:(null!==A.window&&A.wbits!==U&&(A.window=null),A.wrap=V,A.wbits=U,Y(N))},s=(N,U)=>{if(!N)return B;const V=new c;N.state=V,V.window=null;const A=W(N,U);return A!==E&&(N.state=null),A};let M,a,mN=!0;const w=N=>{if(mN){M=new Int32Array(512),a=new Int32Array(32);let U=0;for(;U<144;)N.lens[U++]=8;for(;U<256;)N.lens[U++]=9;for(;U<280;)N.lens[U++]=7;for(;U<288;)N.lens[U++]=8;for(q(1,N.lens,0,288,M,0,N.work,{bits:9}),U=0;U<32;)N.lens[U++]=5;q(2,N.lens,0,32,a,0,N.work,{bits:5}),mN=!1}N.lencode=M,N.lenbits=9,N.distcode=a,N.distbits=5},X=(N,U,V,A)=>{let t;const n=N.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),A>=n.wsize?(n.window.set(U.subarray(V-n.wsize,V),0),n.wnext=0,n.whave=n.wsize):(t=n.wsize-n.wnext,t>A&&(t=A),n.window.set(U.subarray(V-A,V-A+t),n.wnext),(A-=t)?(n.window.set(U.subarray(V-A,V),0),n.wnext=A,n.whave=n.wsize):(n.wnext+=t,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=t))),0};N.exports.inflateReset=Y,N.exports.inflateReset2=W,N.exports.inflateResetKeep=H,N.exports.inflateInit=N=>s(N,15),N.exports.inflateInit2=s,N.exports.inflate=(N,U)=>{let V,c,H,Y,W,s,M,a,mN,e,Q,u,L,I,o,R,D,G,g,l,K,j,F=0;const P=new Uint8Array(4);let T,f;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!N||!N.state||!N.output||!N.input&&0!==N.avail_in)return B;V=N.state,V.mode===r&&(V.mode=13),W=N.next_out,H=N.output,M=N.avail_out,Y=N.next_in,c=N.input,s=N.avail_in,a=V.hold,mN=V.bits,e=s,Q=M,j=E;N:for(;;)switch(V.mode){case 1:if(0===V.wrap){V.mode=13;break}for(;mN<16;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(2&V.wrap&&35615===a){V.check=0,P[0]=255&a,P[1]=a>>>8&255,V.check=t(V.check,P,2,0),a=0,mN=0,V.mode=2;break}if(V.flags=0,V.head&&(V.head.done=!1),!(1&V.wrap)||(((255&a)<<8)+(a>>8))%31){N.SU="incorrect header check",V.mode=v;break}if((15&a)!==d){N.SU="unknown compression method",V.mode=v;break}if(a>>>=4,mN-=4,K=8+(15&a),0===V.wbits)V.wbits=K;else if(K>V.wbits){N.SU="invalid window size",V.mode=v;break}V.dmax=1<<V.wbits,N.adler=V.check=1,V.mode=512&a?10:r,a=0,mN=0;break;case 2:for(;mN<16;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(V.flags=a,(255&V.flags)!==d){N.SU="unknown compression method",V.mode=v;break}if(57344&V.flags){N.SU="unknown header flags set",V.mode=v;break}V.head&&(V.head.text=a>>8&1),512&V.flags&&(P[0]=255&a,P[1]=a>>>8&255,V.check=t(V.check,P,2,0)),a=0,mN=0,V.mode=3;case 3:for(;mN<32;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}V.head&&(V.head.time=a),512&V.flags&&(P[0]=255&a,P[1]=a>>>8&255,P[2]=a>>>16&255,P[3]=a>>>24&255,V.check=t(V.check,P,4,0)),a=0,mN=0,V.mode=4;case 4:for(;mN<16;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}V.head&&(V.head.xflags=255&a,V.head.os=a>>8),512&V.flags&&(P[0]=255&a,P[1]=a>>>8&255,V.check=t(V.check,P,2,0)),a=0,mN=0,V.mode=5;case 5:if(1024&V.flags){for(;mN<16;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}V.length=a,V.head&&(V.head.extra_len=a),512&V.flags&&(P[0]=255&a,P[1]=a>>>8&255,V.check=t(V.check,P,2,0)),a=0,mN=0}else V.head&&(V.head.extra=null);V.mode=6;case 6:if(1024&V.flags&&(u=V.length,u>s&&(u=s),u&&(V.head&&(K=V.head.extra_len-V.length,V.head.extra||(V.head.extra=new Uint8Array(V.head.extra_len)),V.head.extra.set(c.subarray(Y,Y+u),K)),512&V.flags&&(V.check=t(V.check,c,u,Y)),s-=u,Y+=u,V.length-=u),V.length))break N;V.length=0,V.mode=7;case 7:if(2048&V.flags){if(0===s)break N;u=0;do{K=c[Y+u++],V.head&&K&&V.length<65536&&(V.head.name+=String.fromCharCode(K))}while(K&&u<s);if(512&V.flags&&(V.check=t(V.check,c,u,Y)),s-=u,Y+=u,K)break N}else V.head&&(V.head.name=null);V.length=0,V.mode=8;case 8:if(4096&V.flags){if(0===s)break N;u=0;do{K=c[Y+u++],V.head&&K&&V.length<65536&&(V.head.comment+=String.fromCharCode(K))}while(K&&u<s);if(512&V.flags&&(V.check=t(V.check,c,u,Y)),s-=u,Y+=u,K)break N}else V.head&&(V.head.comment=null);V.mode=9;case 9:if(512&V.flags){for(;mN<16;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(a!==(65535&V.check)){N.SU="header crc mismatch",V.mode=v;break}a=0,mN=0}V.head&&(V.head.hcrc=V.flags>>9&1,V.head.done=!0),N.adler=V.check=0,V.mode=r;break;case 10:for(;mN<32;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}N.adler=V.check=h(a),a=0,mN=0,V.mode=11;case 11:if(0===V.havedict)return N.next_out=W,N.avail_out=M,N.next_in=Y,N.avail_in=s,V.hold=a,V.bits=mN,k;N.adler=V.check=1,V.mode=r;case r:if(U===z||U===S)break N;case 13:if(V.last){a>>>=7&mN,mN-=7&mN,V.mode=27;break}for(;mN<3;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}switch(V.last=1&a,a>>>=1,mN-=1,3&a){case 0:V.mode=14;break;case 1:if(w(V),V.mode=20,U===S){a>>>=2,mN-=2;break N}break;case 2:V.mode=17;break;case 3:N.SU="invalid block type",V.mode=v}a>>>=2,mN-=2;break;case 14:for(a>>>=7&mN,mN-=7&mN;mN<32;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if((65535&a)!==(a>>>16^65535)){N.SU="invalid stored block lengths",V.mode=v;break}if(V.length=65535&a,a=0,mN=0,V.mode=15,U===S)break N;case 15:V.mode=16;case 16:if(u=V.length,u){if(u>s&&(u=s),u>M&&(u=M),0===u)break N;H.set(c.subarray(Y,Y+u),W),s-=u,Y+=u,M-=u,W+=u,V.length-=u;break}V.mode=r;break;case 17:for(;mN<14;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(V.nlen=257+(31&a),a>>>=5,mN-=5,V.ndist=1+(31&a),a>>>=5,mN-=5,V.ncode=4+(15&a),a>>>=4,mN-=4,V.nlen>286||V.ndist>30){N.SU="too many length or distance symbols",V.mode=v;break}V.have=0,V.mode=18;case 18:for(;V.have<V.ncode;){for(;mN<3;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}V.lens[O[V.have++]]=7&a,a>>>=3,mN-=3}for(;V.have<19;)V.lens[O[V.have++]]=0;if(V.lencode=V.lendyn,V.lenbits=7,T={bits:V.lenbits},j=q(0,V.lens,0,19,V.lencode,0,V.work,T),V.lenbits=T.bits,j){N.SU="invalid code lengths set",V.mode=v;break}V.have=0,V.mode=19;case 19:for(;V.have<V.nlen+V.ndist;){for(;F=V.lencode[a&(1<<V.lenbits)-1],o=F>>>24,R=F>>>16&255,D=65535&F,!(o<=mN);){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(D<16)a>>>=o,mN-=o,V.lens[V.have++]=D;else{if(16===D){for(f=o+2;mN<f;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(a>>>=o,mN-=o,0===V.have){N.SU="invalid bit length repeat",V.mode=v;break}K=V.lens[V.have-1],u=3+(3&a),a>>>=2,mN-=2}else if(17===D){for(f=o+3;mN<f;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}a>>>=o,mN-=o,K=0,u=3+(7&a),a>>>=3,mN-=3}else{for(f=o+7;mN<f;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}a>>>=o,mN-=o,K=0,u=11+(127&a),a>>>=7,mN-=7}if(V.have+u>V.nlen+V.ndist){N.SU="invalid bit length repeat",V.mode=v;break}for(;u--;)V.lens[V.have++]=K}}if(V.mode===v)break;if(0===V.lens[256]){N.SU="invalid code -- missing end-of-block",V.mode=v;break}if(V.lenbits=9,T={bits:V.lenbits},j=q(1,V.lens,0,V.nlen,V.lencode,0,V.work,T),V.lenbits=T.bits,j){N.SU="invalid literal/lengths set",V.mode=v;break}if(V.distbits=6,V.distcode=V.distdyn,T={bits:V.distbits},j=q(2,V.lens,V.nlen,V.ndist,V.distcode,0,V.work,T),V.distbits=T.bits,j){N.SU="invalid distances set",V.mode=v;break}if(V.mode=20,U===S)break N;case 20:V.mode=21;case 21:if(s>=6&&M>=258){N.next_out=W,N.avail_out=M,N.next_in=Y,N.avail_in=s,V.hold=a,V.bits=mN,n(N,Q),W=N.next_out,H=N.output,M=N.avail_out,Y=N.next_in,c=N.input,s=N.avail_in,a=V.hold,mN=V.bits,V.mode===r&&(V.back=-1);break}for(V.back=0;F=V.lencode[a&(1<<V.lenbits)-1],o=F>>>24,R=F>>>16&255,D=65535&F,!(o<=mN);){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(R&&0===(240&R)){for(G=o,g=R,l=D;F=V.lencode[l+((a&(1<<G+g)-1)>>G)],o=F>>>24,R=F>>>16&255,D=65535&F,!(G+o<=mN);){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}a>>>=G,mN-=G,V.back+=G}if(a>>>=o,mN-=o,V.back+=o,V.length=D,0===R){V.mode=26;break}if(32&R){V.back=-1,V.mode=r;break}if(64&R){N.SU="invalid literal/length code",V.mode=v;break}V.extra=15&R,V.mode=22;case 22:if(V.extra){for(f=V.extra;mN<f;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}V.length+=a&(1<<V.extra)-1,a>>>=V.extra,mN-=V.extra,V.back+=V.extra}V.was=V.length,V.mode=23;case 23:for(;F=V.distcode[a&(1<<V.distbits)-1],o=F>>>24,R=F>>>16&255,D=65535&F,!(o<=mN);){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(0===(240&R)){for(G=o,g=R,l=D;F=V.distcode[l+((a&(1<<G+g)-1)>>G)],o=F>>>24,R=F>>>16&255,D=65535&F,!(G+o<=mN);){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}a>>>=G,mN-=G,V.back+=G}if(a>>>=o,mN-=o,V.back+=o,64&R){N.SU="invalid distance code",V.mode=v;break}V.offset=D,V.extra=15&R,V.mode=24;case 24:if(V.extra){for(f=V.extra;mN<f;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}V.offset+=a&(1<<V.extra)-1,a>>>=V.extra,mN-=V.extra,V.back+=V.extra}if(V.offset>V.dmax){N.SU="invalid distance too far back",V.mode=v;break}V.mode=25;case 25:if(0===M)break N;if(u=Q-M,V.offset>u){if(u=V.offset-u,u>V.whave&&V.sane){N.SU="invalid distance too far back",V.mode=v;break}u>V.wnext?(u-=V.wnext,L=V.wsize-u):L=V.wnext-u,u>V.length&&(u=V.length),I=V.window}else I=H,L=W-V.offset,u=V.length;u>M&&(u=M),M-=u,V.length-=u;do{H[W++]=I[L++]}while(--u);0===V.length&&(V.mode=21);break;case 26:if(0===M)break N;H[W++]=V.length,M--,V.mode=21;break;case 27:if(V.wrap){for(;mN<32;){if(0===s)break N;s--,a|=c[Y++]<<mN,mN+=8}if(Q-=M,N.total_out+=Q,V.total+=Q,Q&&(N.adler=V.check=V.flags?t(V.check,H,Q,W-Q):A(V.check,H,Q,W-Q)),Q=M,(V.flags?a:h(a))!==V.check){N.SU="incorrect data check",V.mode=v;break}a=0,mN=0}V.mode=28;case 28:if(V.wrap&&V.flags){for(;mN<32;){if(0===s)break N;s--,a+=c[Y++]<<mN,mN+=8}if(a!==(4294967295&V.total)){N.SU="incorrect length check",V.mode=v;break}a=0,mN=0}V.mode=29;case 29:j=p;break N;case v:j=C;break N;case 31:return x;default:return B}return N.next_out=W,N.avail_out=M,N.next_in=Y,N.avail_in=s,V.hold=a,V.bits=mN,(V.wsize||Q!==N.avail_out&&V.mode<v&&(V.mode<27||U!==i))&&X(N,N.output,N.next_out,Q-N.avail_out)?(V.mode=31,x):(e-=N.avail_in,Q-=N.avail_out,N.total_in+=e,N.total_out+=Q,V.total+=Q,V.wrap&&Q&&(N.adler=V.check=V.flags?t(V.check,H,Q,N.next_out-Q):A(V.check,H,Q,N.next_out-Q)),N.data_type=V.bits+(V.last?64:0)+(V.mode===r?128:0)+(20===V.mode||15===V.mode?256:0),(0===e&&0===Q||U===i)&&j===E&&(j=J),j)},N.exports.inflateEnd=N=>{if(!N||!N.state)return B;let U=N.state;return U.window&&(U.window=null),N.state=null,E},N.exports.inflateGetHeader=(N,U)=>{if(!N||!N.state)return B;const V=N.state;return 0===(2&V.wrap)?B:(V.head=U,U.done=!1,E)},N.exports.inflateSetDictionary=(N,U)=>{const V=U.length;let t,n,q;return N&&N.state?(t=N.state,0!==t.wrap&&11!==t.mode?B:11===t.mode&&(n=1,n=A(n,U,V,0),n!==t.check)?C:(q=X(N,U,V,V),q?(t.mode=31,x):(t.havedict=1,E))):B},N.exports.inflateInfo="pako inflate (from Nodeca project)"},13533:N=>{"use strict";const U=15,V=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),A=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);N.exports=(N,q,i,z,S,E,p,k)=>{const B=k.bits;let C,x,J,d,r,v,h=0,c=0,H=0,Y=0,W=0,s=0,M=0,a=0,mN=0,w=0,X=null,e=0;const Q=new Uint16Array(16),u=new Uint16Array(16);let L,I,o,R=null,D=0;for(h=0;h<=U;h++)Q[h]=0;for(c=0;c<z;c++)Q[q[i+c]]++;for(W=B,Y=U;Y>=1&&0===Q[Y];Y--);if(W>Y&&(W=Y),0===Y)return S[E++]=20971520,S[E++]=20971520,k.bits=1,0;for(H=1;H<Y&&0===Q[H];H++);for(W<H&&(W=H),a=1,h=1;h<=U;h++)if(a<<=1,a-=Q[h],a<0)return-1;if(a>0&&(0===N||1!==Y))return-1;for(u[1]=0,h=1;h<U;h++)u[h+1]=u[h]+Q[h];for(c=0;c<z;c++)0!==q[i+c]&&(p[u[q[i+c]]++]=c);if(0===N?(X=R=p,v=19):1===N?(X=V,e-=257,R=A,D-=257,v=256):(X=t,R=n,v=-1),w=0,c=0,h=H,r=E,s=W,M=0,J=-1,mN=1<<W,d=mN-1,1===N&&mN>852||2===N&&mN>592)return 1;for(;;){L=h-M,p[c]<v?(I=0,o=p[c]):p[c]>v?(I=R[D+p[c]],o=X[e+p[c]]):(I=96,o=0),C=1<<h-M,x=1<<s,H=x;do{x-=C,S[r+(w>>M)+x]=L<<24|I<<16|o}while(0!==x);for(C=1<<h-1;w&C;)C>>=1;if(0!==C?(w&=C-1,w+=C):w=0,c++,0===--Q[h]){if(h===Y)break;h=q[i+p[c]]}if(h>W&&(w&d)!==J){for(0===M&&(M=W),r+=H,s=h-M,a=1<<s;s+M<Y&&(a-=Q[s+M],!(a<=0));)s++,a<<=1;if(mN+=1<<s,1===N&&mN>852||2===N&&mN>592)return 1;J=w&d,S[J]=W<<24|s<<16|r-E}}return 0!==w&&(S[r+w]=h-M<<24|64<<16),k.bits=W,0}},13485:N=>{"use strict";N.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13462:N=>{"use strict";function U(N){let U=N.length;for(;--U>=0;)N[U]=0}const V=256,A=286,t=30,n=15,q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),i=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E=new Array(576);U(E);const p=new Array(60);U(p);const k=new Array(512);U(k);const B=new Array(256);U(B);const C=new Array(29);U(C);const x=new Array(t);function J(N,U,V,A,t){this.static_tree=N,this.extra_bits=U,this.extra_base=V,this.elems=A,this.max_length=t,this.has_stree=N&&N.length}let d,r,v;function h(N,U){this.dyn_tree=N,this.max_code=0,this.stat_desc=U}U(x);const c=N=>N<256?k[N]:k[256+(N>>>7)],H=(N,U)=>{N.pending_buf[N.pending++]=255&U,N.pending_buf[N.pending++]=U>>>8&255},Y=(N,U,V)=>{N.bi_valid>16-V?(N.bi_buf|=U<<N.bi_valid&65535,H(N,N.bi_buf),N.bi_buf=U>>16-N.bi_valid,N.bi_valid+=V-16):(N.bi_buf|=U<<N.bi_valid&65535,N.bi_valid+=V)},W=(N,U,V)=>{Y(N,V[2*U],V[2*U+1])},s=(N,U)=>{let V=0;do{V|=1&N,N>>>=1,V<<=1}while(--U>0);return V>>>1},M=(N,U,V)=>{const A=new Array(16);let t,q,i=0;for(t=1;t<=n;t++)A[t]=i=i+V[t-1]<<1;for(q=0;q<=U;q++){let U=N[2*q+1];0!==U&&(N[2*q]=s(A[U]++,U))}},a=N=>{let U;for(U=0;U<A;U++)N.dyn_ltree[2*U]=0;for(U=0;U<t;U++)N.dyn_dtree[2*U]=0;for(U=0;U<19;U++)N.bl_tree[2*U]=0;N.dyn_ltree[512]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0},mN=N=>{N.bi_valid>8?H(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0},w=(N,U,V,A)=>{const t=2*U,n=2*V;return N[t]<N[n]||N[t]===N[n]&&A[U]<=A[V]},X=(N,U,V)=>{const A=N.heap[V];let t=V<<1;for(;t<=N.heap_len&&(t<N.heap_len&&w(U,N.heap[t+1],N.heap[t],N.depth)&&t++,!w(U,A,N.heap[t],N.depth));)N.heap[V]=N.heap[t],V=t,t<<=1;N.heap[V]=A},e=(N,U,A)=>{let t,n,z,S,E=0;if(0!==N.last_lit)do{t=N.pending_buf[N.d_buf+2*E]<<8|N.pending_buf[N.d_buf+2*E+1],n=N.pending_buf[N.l_buf+E],E++,0===t?W(N,n,U):(z=B[n],W(N,z+V+1,U),S=q[z],0!==S&&(n-=C[z],Y(N,n,S)),t--,z=c(t),W(N,z,A),S=i[z],0!==S&&(t-=x[z],Y(N,t,S)))}while(E<N.last_lit);W(N,256,U)},Q=(N,U)=>{const V=U.dyn_tree,A=U.stat_desc.static_tree,t=U.stat_desc.has_stree,q=U.stat_desc.elems;let i,z,S,E=-1;for(N.heap_len=0,N.heap_max=573,i=0;i<q;i++)0!==V[2*i]?(N.heap[++N.heap_len]=E=i,N.depth[i]=0):V[2*i+1]=0;for(;N.heap_len<2;)S=N.heap[++N.heap_len]=E<2?++E:0,V[2*S]=1,N.depth[S]=0,N.opt_len--,t&&(N.static_len-=A[2*S+1]);for(U.max_code=E,i=N.heap_len>>1;i>=1;i--)X(N,V,i);S=q;do{i=N.heap[1],N.heap[1]=N.heap[N.heap_len--],X(N,V,1),z=N.heap[1],N.heap[--N.heap_max]=i,N.heap[--N.heap_max]=z,V[2*S]=V[2*i]+V[2*z],N.depth[S]=(N.depth[i]>=N.depth[z]?N.depth[i]:N.depth[z])+1,V[2*i+1]=V[2*z+1]=S,N.heap[1]=S++,X(N,V,1)}while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],((N,U)=>{const V=U.dyn_tree,A=U.max_code,t=U.stat_desc.static_tree,q=U.stat_desc.has_stree,i=U.stat_desc.extra_bits,z=U.stat_desc.extra_base,S=U.stat_desc.max_length;let E,p,k,B,C,x,J=0;for(B=0;B<=n;B++)N.bl_count[B]=0;for(V[2*N.heap[N.heap_max]+1]=0,E=N.heap_max+1;E<573;E++)p=N.heap[E],B=V[2*V[2*p+1]+1]+1,B>S&&(B=S,J++),V[2*p+1]=B,p>A||(N.bl_count[B]++,C=0,p>=z&&(C=i[p-z]),x=V[2*p],N.opt_len+=x*(B+C),q&&(N.static_len+=x*(t[2*p+1]+C)));if(0!==J){do{for(B=S-1;0===N.bl_count[B];)B--;N.bl_count[B]--,N.bl_count[B+1]+=2,N.bl_count[S]--,J-=2}while(J>0);for(B=S;0!==B;B--)for(p=N.bl_count[B];0!==p;)k=N.heap[--E],k>A||(V[2*k+1]!==B&&(N.opt_len+=(B-V[2*k+1])*V[2*k],V[2*k+1]=B),p--)}})(N,U),M(V,E,N.bl_count)},u=(N,U,V)=>{let A,t,n=-1,q=U[1],i=0,z=7,S=4;for(0===q&&(z=138,S=3),U[2*(V+1)+1]=65535,A=0;A<=V;A++)t=q,q=U[2*(A+1)+1],++i<z&&t===q||(i<S?N.bl_tree[2*t]+=i:0!==t?(t!==n&&N.bl_tree[2*t]++,N.bl_tree[32]++):i<=10?N.bl_tree[34]++:N.bl_tree[36]++,i=0,n=t,0===q?(z=138,S=3):t===q?(z=6,S=3):(z=7,S=4))},L=(N,U,V)=>{let A,t,n=-1,q=U[1],i=0,z=7,S=4;for(0===q&&(z=138,S=3),A=0;A<=V;A++)if(t=q,q=U[2*(A+1)+1],!(++i<z&&t===q)){if(i<S)do{W(N,t,N.bl_tree)}while(0!==--i);else 0!==t?(t!==n&&(W(N,t,N.bl_tree),i--),W(N,16,N.bl_tree),Y(N,i-3,2)):i<=10?(W(N,17,N.bl_tree),Y(N,i-3,3)):(W(N,18,N.bl_tree),Y(N,i-11,7));i=0,n=t,0===q?(z=138,S=3):t===q?(z=6,S=3):(z=7,S=4)}};let I=!1;const o=(N,U,V,A)=>{Y(N,0+(A?1:0),3),((N,U,V,A)=>{mN(N),A&&(H(N,V),H(N,~V)),N.pending_buf.set(N.window.subarray(U,U+V),N.pending),N.pending+=V})(N,U,V,!0)};N.exports._tr_init=N=>{I||((()=>{let N,U,V,S,h;const c=new Array(16);for(V=0,S=0;S<28;S++)for(C[S]=V,N=0;N<1<<q[S];N++)B[V++]=S;for(B[V-1]=S,h=0,S=0;S<16;S++)for(x[S]=h,N=0;N<1<<i[S];N++)k[h++]=S;for(h>>=7;S<t;S++)for(x[S]=h<<7,N=0;N<1<<i[S]-7;N++)k[256+h++]=S;for(U=0;U<=n;U++)c[U]=0;for(N=0;N<=143;)E[2*N+1]=8,N++,c[8]++;for(;N<=255;)E[2*N+1]=9,N++,c[9]++;for(;N<=279;)E[2*N+1]=7,N++,c[7]++;for(;N<=287;)E[2*N+1]=8,N++,c[8]++;for(M(E,287,c),N=0;N<t;N++)p[2*N+1]=5,p[2*N]=s(N,5);d=new J(E,q,257,A,n),r=new J(p,i,0,t,n),v=new J(new Array(0),z,0,19,7)})(),I=!0),N.l_desc=new h(N.dyn_ltree,d),N.d_desc=new h(N.dyn_dtree,r),N.bl_desc=new h(N.bl_tree,v),N.bi_buf=0,N.bi_valid=0,a(N)},N.exports._tr_stored_block=o,N.exports._tr_flush_block=(N,U,A,t)=>{let n,q,i=0;N.level>0?(2===N.strm.data_type&&(N.strm.data_type=(N=>{let U,A=4093624447;for(U=0;U<=31;U++,A>>>=1)if(1&A&&0!==N.dyn_ltree[2*U])return 0;if(0!==N.dyn_ltree[18]||0!==N.dyn_ltree[20]||0!==N.dyn_ltree[26])return 1;for(U=32;U<V;U++)if(0!==N.dyn_ltree[2*U])return 1;return 0})(N)),Q(N,N.l_desc),Q(N,N.d_desc),i=(N=>{let U;for(u(N,N.dyn_ltree,N.l_desc.max_code),u(N,N.dyn_dtree,N.d_desc.max_code),Q(N,N.bl_desc),U=18;U>=3&&0===N.bl_tree[2*S[U]+1];U--);return N.opt_len+=3*(U+1)+5+5+4,U})(N),n=N.opt_len+3+7>>>3,q=N.static_len+3+7>>>3,q<=n&&(n=q)):n=q=A+5,A+4<=n&&-1!==U?o(N,U,A,t):4===N.strategy||q===n?(Y(N,2+(t?1:0),3),e(N,E,p)):(Y(N,4+(t?1:0),3),((N,U,V,A)=>{let t;for(Y(N,U-257,5),Y(N,V-1,5),Y(N,A-4,4),t=0;t<A;t++)Y(N,N.bl_tree[2*S[t]+1],3);L(N,N.dyn_ltree,U-1),L(N,N.dyn_dtree,V-1)})(N,N.l_desc.max_code+1,N.d_desc.max_code+1,i+1),e(N,N.dyn_ltree,N.dyn_dtree)),a(N),t&&mN(N)},N.exports._tr_tally=(N,U,A)=>(N.pending_buf[N.d_buf+2*N.last_lit]=U>>>8&255,N.pending_buf[N.d_buf+2*N.last_lit+1]=255&U,N.pending_buf[N.l_buf+N.last_lit]=255&A,N.last_lit++,0===U?N.dyn_ltree[2*A]++:(N.matches++,U--,N.dyn_ltree[2*(B[A]+V+1)]++,N.dyn_dtree[2*c(U)]++),N.last_lit===N.lit_bufsize-1),N.exports._tr_align=N=>{Y(N,2,3),W(N,256,E),(N=>{16===N.bi_valid?(H(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)})(N)}},13508:N=>{"use strict";N.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.SU="",this.state=null,this.data_type=2,this.adler=0}},13146:N=>{function U(N,U,V){for(var A=N.length,t=-1/0,n=1/0,q=0;q<A;q++){var i=(V[0][q]-N[q])/U[q],z=(V[1][q]-N[q])/U[q];if(i>z){var S=i;i=z,z=S}if(z<t||i>n)return 1/0;i>t&&(t=i),z<n&&(n=z)}return t>n?1/0:t}N.exports=function(N,V,A,t){var n=U(V,A,t);if(n===1/0)N=null;else{N=N||[];for(var q=0;q<V.length;q++)N[q]=V[q]+A[q]*n}return N},N.exports.distance=U},14513:(N,U,V)=>{"use strict";V.d(U,{c:()=>q});var A=V(23);const t=A.useLayoutEffect;const n=function(N){var U=(0,A.useRef)(N);return t((function(){U.current=N})),U};var q=function(N){var U=n(N);(0,A.qU)((function(){var N=function(N){var V;if(null!=U.current&&(V=U.current(N)),N.defaultPrevented&&(N.returnValue=""),"string"===typeof V)return N.returnValue=V,V};return window.addEventListener("beforeunload",N),function(){window.removeEventListener("beforeunload",N)}}),[])}},14456:(N,U,V)=>{"use strict";var A=V(14462),t=Array.prototype.concat,n=Array.prototype.slice,q=N.exports=function(N){for(var U=[],V=0,q=N.length;V<q;V++){var i=N[V];A(i)?U=t.call(U,n.call(i)):U.push(i)}return U};q.wrap=function(N){return function(){return N(q(arguments))}}},14462:N=>{N.exports=function(N){return!(!N||"string"===typeof N)&&(N instanceof Array||Array.isArray(N)||N.length>=0&&(N.splice instanceof Function||Object.getOwnPropertyDescriptor(N,N.length-1)&&"String"!==N.constructor.name))}},13423:(N,U,V)=>{var A=V(13427);function t(N){for(var U,V,t=0,n=N.length,q=0;q<N.length;){for(U=N[q],V=0;q<n&&N[q]===U;)++q,++V;t+=A.log2(V)/7|0,t+=A.log2(U>>>0)/7|0,t+=2}return t}U.size=t,U.encode=function(N,U){U||(U=new Uint8Array(t(N)));for(var V,A,n=0,q=U.length,i=0;i<N.length;){for(V=N[i],A=0;i<N.length&&N[i]===V;)++i,++A;for(;n<q&&A>=128;)U[n++]=128+(127&A),A>>>=7;if(n>=q)throw new Error("RLE buffer overflow");for(U[n++]=A,V>>>=0;n<q&&V>=128;)U[n++]=128+(127&V),V>>>=7;if(n>=q)throw new Error("RLE buffer overflow");U[n++]=V}return U},U.decode=function(N,U){for(var V,A,t,n,q=U.length,i=N.length,z=0,S=0;S<i;){for(V=0,A=0;S<i&&N[S]>=128;)V+=(127&N[S++])<<A,A+=7;if(V+=N[S++]<<A,S>=i)throw new Error("RLE buffer underrun");if(z+V>q)throw new Error("Chunk buffer overflow");for(t=0,A=0;S<i&&N[S]>=128;)t+=(127&N[S++])<<A,A+=7;if(S>=i)throw new Error("RLE buffer underrun");for(t+=N[S++]<<A,n=0;n<V;++n)U[z++]=t}return U}},13427:(N,U)=>{"use strict";function V(N){var U=32;return(N&=-N)&&U--,65535&N&&(U-=16),16711935&N&&(U-=8),252645135&N&&(U-=4),858993459&N&&(U-=2),1431655765&N&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(N){return(N>0)-(N<0)},U.abs=function(N){var U=N>>31;return(N^U)-U},U.min=function(N,U){return U^(N^U)&-(N<U)},U.max=function(N,U){return N^(N^U)&-(N<U)},U.isPow2=function(N){return!(N&N-1)&&!!N},U.log2=function(N){var U,V;return U=(N>65535)<<4,U|=V=((N>>>=U)>255)<<3,U|=V=((N>>>=V)>15)<<2,(U|=V=((N>>>=V)>3)<<1)|(N>>>=V)>>1},U.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},U.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},U.countTrailingZeros=V,U.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},U.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},U.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var A=new Array(256);!function(N){for(var U=0;U<256;++U){var V=U,A=U,t=7;for(V>>>=1;V;V>>>=1)A<<=1,A|=1&V,--t;N[U]=A<<t&255}}(A),U.reverse=function(N){return A[255&N]<<24|A[N>>>8&255]<<16|A[N>>>16&255]<<8|A[N>>>24&255]},U.interleave2=function(N,U){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(N,U){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>U&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},U.interleave3=function(N,U,V){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<2},U.deinterleave3=function(N,U){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>U&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},U.nextCombination=function(N){var U=N|N-1;return U+1|(~U&-~U)-1>>>V(N)+1}},13445:N=>{"use strict";N.exports=function(N,U,V,A){var t=self||window;try{try{var n;try{n=new t.Blob([N])}catch(S){(n=new(t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder)).append(N),n=n.getBlob()}var q=t.URL||t.webkitURL,i=q.createObjectURL(n),z=new t[U](i,V);return q.revokeObjectURL(i),z}catch(S){return new t[U]("data:application/javascript,".concat(encodeURIComponent(N)),V)}}catch(S){if(!A)throw Error("Inline worker is not supported");return new t[U](A,V)}}},13126:(N,U,V)=>{"use strict";function A(N,U,V,A,t){var n={};return Object.keys(A).forEach((function(N){n[N]=A[N]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=V.slice().reverse().reduce((function(V,A){return A(N,U,V)||V}),n),t&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(t):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(N,U,n),n=null),n}V.d(U,{b:()=>A})},13119:(N,U,V)=>{"use strict";function A(N,U,V,A){V&&Object.defineProperty(N,U,{enumerable:V.enumerable,configurable:V.configurable,writable:V.writable,value:V.initializer?V.initializer.call(A):void 0})}V.d(U,{d:()=>A})},14505:(N,U,V)=>{"use strict";V.d(U,{c:()=>q,e:()=>p,h:()=>i,k:()=>n,n:()=>z,p:()=>t,r:()=>S,s:()=>E});var A=V(12576);class t{constructor(){this._easingMode=t.EASINGMODE_EASEIN}setEasingMode(N){const U=Math.min(Math.max(N,0),2);this._easingMode=U}getEasingMode(){return this._easingMode}easeInCore(N){throw new Error("You must implement this method")}ease(N){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(N);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-N)}return N>=.5?.5*(1-this.easeInCore(2*(1-N)))+.5:.5*this.easeInCore(2*N)}}t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2;class n extends t{easeInCore(N){return N=Math.max(0,Math.min(1,N)),1-Math.sqrt(1-N*N)}}class q extends t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=N}easeInCore(N){const U=Math.max(0,this.amplitude);return Math.pow(N,3)-N*U*Math.sin(3.141592653589793*N)}}class i extends t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=N,this.bounciness=U}easeInCore(N){const U=Math.max(0,this.bounces);let V=this.bounciness;V<=1&&(V=1.001);const A=Math.pow(V,U),t=1-V,n=(1-A)/t+.5*A,q=N*n,i=Math.log(-q*(1-V)+1)/Math.log(V),z=Math.floor(i),S=z+1,E=(1-Math.pow(V,z))/(t*n),p=.5*(E+(1-Math.pow(V,S))/(t*n)),k=N-p,B=p-E;return-Math.pow(1/V,U-z)/(B*B)*(k-B)*(k+B)}}class z extends t{easeInCore(N){return N*N*N}}class S extends t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=N,this.springiness=U}easeInCore(N){let U;const V=Math.max(0,this.oscillations),A=Math.max(0,this.springiness);return U=0==A?N:(Math.exp(A*N)-1)/(Math.exp(A)-1),U*Math.sin((6.283185307179586*V+1.5707963267948966)*N)}}class E extends t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=N}easeInCore(N){return this.exponent<=0?N:(Math.exp(this.exponent*N)-1)/(Math.exp(this.exponent)-1)}}class p extends t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=N,this.y1=U,this.x2=V,this.y2=A}easeInCore(N){return A.e.Interpolate(N,this.x1,this.y1,this.x2,this.y2)}}},13961:(N,U,V)=>{"use strict";V.d(U,{d:()=>q});var A=V(12383),t=V(12392),n=V(12764);class q extends n.c{get _matrix(){return this._compose(),this.ck}set _matrix(N){(N.updateFlag!==this.ck.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ck.A(N),this._markAsDirtyAndDecompose())}constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(N,U.YN(),!1),this.name=N,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=U,this.ck=(null===t||void 0===t?void 0:t.clone())??A.Matrix.Identity(),this._restMatrix=n??this.ck.clone(),this._bindMatrix=q??this.ck.clone(),this._index=i,this._absoluteMatrix=new A.Matrix,this._absoluteBindMatrix=new A.Matrix,this._absoluteInverseBindMatrix=new A.Matrix,this._finalMatrix=new A.Matrix,U.bones.push(this),this.setParent(V,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(N){this.setParent(N)}setParent(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==N){if(this.parent){const N=this.parent.children.indexOf(this);-1!==N&&this.parent.children.splice(N,1)}this._parentNode=N,this.parent&&this.parent.children.push(this),U&&this._updateAbsoluteBindMatrices(),this.FS()}}getLocalMatrix(){return this._compose(),this.ck}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(N){this._restMatrix.A(N)}setRestPose(N){this.setRestMatrix(N)}getBindPose(){return this.getBindMatrix()}setBindMatrix(N){this.Ci(N)}setBindPose(N){this.setBindMatrix(N)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const N=A.TmpVectors.CU[0],U=A.TmpVectors.Quaternion[0],V=A.TmpVectors.CU[1];this.getRestMatrix().decompose(N,U,V),this._linkedTransformNode.position.A(V),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??A.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.A(U),this._linkedTransformNode.ci.A(N)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(N){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=N,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Ti}set position(N){this._decompose(),this.Ti.A(N),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(N){this.setRotation(N)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(N){this.setRotationQuaternion(N)}get ci(){return this.getScale()}set ci(N){this.setScale(N)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=A.CU.Zero(),this._localRotation=A.Quaternion.Zero(),this.Ti=A.CU.Zero()),this.ck.decompose(this._localScaling,this._localRotation,this.Ti))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,A.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Ti,this.ck)):this._needToCompose=!1)}Ci(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.A(N),U&&this._updateAbsoluteBindMatrices(),V?this._matrix=N:this.FS()}_updateAbsoluteBindMatrices(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N||(N=this._bindMatrix),this.parent?N.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.A(N),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),U)for(let V=0;V<this.children.length;V++)this.children[V]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}FS(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.FS(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.FS(),this._needToDecompose=!0}_updatePosition(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=this.getLocalMatrix();if(0==U)t?(n.addAtIndex(12,N.x),n.addAtIndex(13,N.y),n.addAtIndex(14,N.z)):n.setTranslationFromFloats(N.x,N.y,N.z);else{let U=null;V&&(U=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=q._TmpMats[0],z=q._TmpVecs[0];this.parent?V&&U?(i.A(this.parent.getAbsoluteMatrix()),i.multiplyToRef(U,i)):i.A(this.parent.getAbsoluteMatrix()):A.Matrix.IdentityToRef(i),t&&i.setTranslationFromFloats(0,0,0),i.invert(),A.CU.TransformCoordinatesToRef(N,i,z),t?(n.addAtIndex(12,z.x),n.addAtIndex(13,z.y),n.addAtIndex(14,z.z)):n.setTranslationFromFloats(z.x,z.y,z.z)}this._markAsDirtyAndDecompose()}translate(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,U,V,!0)}setPosition(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,U,V,!1)}setAbsolutePosition(N,U){this.setPosition(N,1,U)}scale(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=this.getLocalMatrix(),i=q._TmpMats[0];A.Matrix.ScalingToRef(N,U,V,i),i.multiplyToRef(n,n),i.invert();for(const A of this.children){const t=A.getLocalMatrix();t.multiplyToRef(i,t),t.multiplyAtIndex(12,N),t.multiplyAtIndex(13,U),t.multiplyAtIndex(14,V),A._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),t)for(const A of this.children)A.scale(N,U,V,t)}setScale(N){this._decompose(),this._localScaling.A(N),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(N){this._decompose(),N.A(this._localScaling)}setYawPitchRoll(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;if(0===t){const i=q._TmpQuat;return A.Quaternion.RotationYawPitchRollToRef(N,U,V,i),void this.setRotationQuaternion(i,t,n)}const i=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,n))return;const z=q._TmpMats[1];A.Matrix.RotationYawPitchRollToRef(N,U,V,z),i.multiplyToRef(z,z),this._rotateWithMatrix(z,t,n)}rotate(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;const n=q._TmpMats[0];n.setTranslationFromFloats(0,0,0),A.Matrix.RotationAxisToRef(N,U,n),this._rotateWithMatrix(n,V,t)}setAxisAngle(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;if(0===V){const n=q._TmpQuat;return A.Quaternion.RotationAxisToRef(N,U,n),void this.setRotationQuaternion(n,V,t)}const n=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,t))return;const i=q._TmpMats[1];A.Matrix.RotationAxisToRef(N,U,i),n.multiplyToRef(i,i),this._rotateWithMatrix(i,V,t)}setRotation(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(N.y,N.x,N.z,U,V)}setRotationQuaternion(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;if(0===U)return this._decompose(),this._localRotation.A(N),void this._markAsDirtyAndCompose();const t=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,V))return;const n=q._TmpMats[1];A.Matrix.FromQuaternionToRef(N,n),t.multiplyToRef(n,n),this._rotateWithMatrix(n,U,V)}setRotationMatrix(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;if(0===U){const t=q._TmpQuat;return A.Quaternion.FromRotationMatrixToRef(N,t),void this.setRotationQuaternion(t,U,V)}const t=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,V))return;const n=q._TmpMats[1];n.A(N),t.multiplyToRef(N,n),this._rotateWithMatrix(n,U,V)}_rotateWithMatrix(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;const A=this.getLocalMatrix(),t=A.m[12],n=A.m[13],i=A.m[14],z=this.getParent(),S=q._TmpMats[3],E=q._TmpMats[4];z&&1==U?(V?(S.A(V.getWorldMatrix()),z.getAbsoluteMatrix().multiplyToRef(S,S)):S.A(z.getAbsoluteMatrix()),E.A(S),E.invert(),A.multiplyToRef(S,A),A.multiplyToRef(N,A),A.multiplyToRef(E,A)):1==U&&V?(S.A(V.getWorldMatrix()),E.A(S),E.invert(),A.multiplyToRef(S,A),A.multiplyToRef(N,A),A.multiplyToRef(E,A)):A.multiplyToRef(N,A),A.setTranslationFromFloats(t,n,i),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(N,U){const V=q._TmpMats[2];return N.A(this.getAbsoluteMatrix()),U?(N.multiplyToRef(U.getWorldMatrix(),N),A.Matrix.ScalingToRef(U.ci.x,U.ci.y,U.ci.z,V)):A.Matrix.IdentityToRef(V),N.invert(),!isNaN(N.m[0])&&(V.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyToRef(V,N),!0)}lt(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=A.CU.Zero();return this.getPositionToRef(N,U,V),V}getPositionToRef(){let N=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const N=this.getLocalMatrix();U.x=N.m[12],U.y=N.m[13],U.z=N.m[14]}else{let V=null;N&&(V=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let A=q._TmpMats[0];N&&V?(A.A(this.getAbsoluteMatrix()),A.multiplyToRef(V,A)):A=this.getAbsoluteMatrix(),U.x=A.m[12],U.y=A.m[13],U.z=A.m[14]}}getAbsolutePosition(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=A.CU.Zero();return this.getPositionToRef(1,N,U),U}getAbsolutePositionToRef(N,U){this.getPositionToRef(1,N,U)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ck.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.A(this.ck);const N=this._skeleton.getPoseMatrix();N&&this._absoluteMatrix.multiplyToRef(N,this._absoluteMatrix)}const N=this.children,U=N.length;for(let V=0;V<U;V++)N[V].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Wz(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=A.CU.Zero();return this.getDirectionToRef(N,U,V),V}getDirectionToRef(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,t=null;U&&(t=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=q._TmpMats[0];n.A(this.getAbsoluteMatrix()),U&&t&&n.multiplyToRef(t,n),A.CU.TransformNormalToRef(N,n,V),V.normalize()}getRotation(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=A.CU.Zero();return this.getRotationToRef(N,U,V),V}getRotationToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;const A=q._TmpQuat;this.getRotationQuaternionToRef(N,U,A),A.toEulerAnglesToRef(V)}getRotationQuaternion(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=A.Quaternion.Identity();return this.getRotationQuaternionToRef(N,U,V),V}getRotationQuaternionToRef(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),U.A(this._localRotation);else{const V=q._TmpMats[0],A=this.getAbsoluteMatrix();N?A.multiplyToRef(N.getWorldMatrix(),V):V.A(A),V.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyAtIndex(1,this._scalingDeterminant),V.multiplyAtIndex(2,this._scalingDeterminant),V.decompose(void 0,U,void 0)}}getRotationMatrix(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1?arguments[1]:void 0;const V=A.Matrix.Identity();return this.getRotationMatrixToRef(N,U,V),V}getRotationMatrixToRef(){let N=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(U);else{const V=q._TmpMats[0],A=this.getAbsoluteMatrix();N?A.multiplyToRef(N.getWorldMatrix(),V):V.A(A),V.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyAtIndex(1,this._scalingDeterminant),V.multiplyAtIndex(2,this._scalingDeterminant),V.getRotationMatrixToRef(U)}}getAbsolutePositionFromLocal(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=A.CU.Zero();return this.getAbsolutePositionFromLocalToRef(N,U,V),V}getAbsolutePositionFromLocalToRef(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,t=null;U&&(t=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=q._TmpMats[0];n.A(this.getAbsoluteMatrix()),U&&t&&n.multiplyToRef(t,n),A.CU.TransformCoordinatesToRef(N,n,V)}getLocalPositionFromAbsolute(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=A.CU.Zero();return this.getLocalPositionFromAbsoluteToRef(N,U,V),V}getLocalPositionFromAbsoluteToRef(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,t=null;U&&(t=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=q._TmpMats[0];n.A(this.getAbsoluteMatrix()),U&&t&&n.multiplyToRef(t,n),n.invert(),A.CU.TransformCoordinatesToRef(N,n,V)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const N=this._skeleton.bones.indexOf(this);if(-1!==N&&this._skeleton.bones.splice(N,1),this._parentNode&&this._parentNode.children){const N=this._parentNode.children,U=N.indexOf(this);-1!==U&&N.splice(U,1)}super.dispose()}}q._TmpVecs=(0,t.b)(2,A.CU.Zero),q._TmpQuat=A.Quaternion.Identity(),q._TmpMats=(0,t.b)(5,A.Matrix.Identity)},14499:(N,U,V)=>{"use strict";V.d(U,{b:()=>Q});var A=V(12367),t=V(12369),n=V(12182),q=V(12383),i=V(12395),z=V(12764),S=V(12799),E=V(12624),p=V(12200),k=V(12389);class B{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(N){this._idleRotationSpeed=N}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(N){this._idleRotationWaitTime=N}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(N){this._idleRotationSpinupTime=N}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(N){this._attachedCamera=N;const U=this._attachedCamera.YN();this._onPrePointerObservableObserver=U.onPrePointerObservable.add((N=>{N.type!==E.b.POINTERDOWN?N.type===E.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const N=p.b.Now;let U=0;null!=this._lastFrameTime&&(U=N-this._lastFrameTime),this._lastFrameTime=N,this._applyUserInteraction();const V=N-this._lastInteractionTime-this._idleRotationWaitTime,A=Math.max(Math.min(V/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*A,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(U/1e3))}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.YN();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(N){this._lastInteractionTime=N??p.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<k.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let N=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(N=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?N:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=p.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var C=V(14505),x=V(12876);class J{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(N){if(this._autoTransitionRange===N)return;this._autoTransitionRange=N;const U=this._attachedCamera;U&&(N?this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((N=>{if(N&&(N.xi(!0),N.getBoundingInfo)){const U=N.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*U,this.upperRadiusTransitionRange=.05*U}})):this._onMeshTargetChangedObserver&&U.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(N){this._attachedCamera=N,this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(N){return!!this._attachedCamera&&(this._attachedCamera.radius===N&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(N){if(!this._attachedCamera)return;this._radiusBounceTransition||(J.EasingFunction.setEasingMode(J.EasingMode),this._radiusBounceTransition=x.e.CreateAnimation("radius",x.e.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const U=x.e.TransitionTo("radius",this._attachedCamera.radius+N,this._attachedCamera,this._attachedCamera.YN(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));U&&this._animatables.push(U)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}J.EasingFunction=new C.c(.3),J.EasingMode=C.p.EASINGMODE_EASEOUT;class d{constructor(){this.onTargetFramingAnimationEndObservable=new n.d,this._mode=d.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(N){this._mode=N}get mode(){return this._mode}set radiusScale(N){this._radiusScale=N}get radiusScale(){return this._radiusScale}set positionScale(N){this._positionScale=N}get positionScale(){return this._positionScale}set defaultElevation(N){this._defaultElevation=N}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(N){this._elevationReturnTime=N}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(N){this._elevationReturnWaitTime=N}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(N){this._framingTime=N}get framingTime(){return this._framingTime}init(){}attach(N){this._attachedCamera=N;const U=this._attachedCamera.YN();d.EasingFunction.setEasingMode(d.EasingMode),this._onPrePointerObservableObserver=U.onPrePointerObservable.add((N=>{N.type!==E.b.POINTERDOWN?N.type===E.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((N=>{N&&N.getBoundingInfo&&this.zoomOnMesh(N,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.YN();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.xi(!0);const A=N.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(A.minimumWorld,A.maximumWorld,U,V)}zoomOnMeshHierarchy(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.xi(!0);const A=N.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(A.min,A.max,U,V)}zoomOnMeshesHierarchy(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new q.CU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new q.CU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<N.length;n++){const U=N[n].getHierarchyBoundingVectors(!0);q.CU.CheckExtends(U.min,A,t),q.CU.CheckExtends(U.max,A,t)}this.zoomOnBoundingInfo(A,t,U,V)}zoomOnBoundingInfo(N,U){let V,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const n=N.y,i=n+(U.y-n)*this._positionScale,z=U.xU(N).scale(.5);if(!isFinite(i))return!1;if(A)V=new q.CU(0,i,0);else{const U=N.add(z);V=new q.CU(U.x,i,U.z)}this._vectorTransition||(this._vectorTransition=x.e.CreateAnimation("target",x.e.ANIMATIONTYPE_VECTOR3,60,d.EasingFunction)),this._betaIsAnimating=!0;let S=x.e.TransitionTo("target",V,this._attachedCamera,this._attachedCamera.YN(),60,this._vectorTransition,this._framingTime);S&&this._animatables.push(S);let E=0;if(this._mode===d.FitFrustumSidesMode){const V=this._calculateLowerRadiusFromModelBoundingSphere(N,U);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=z.length()+this._attachedCamera.Bi),E=V}else this._mode===d.IgnoreBoundsSizeMode&&(E=this._calculateLowerRadiusFromModelBoundingSphere(N,U),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Bi));if(this.autoCorrectCameraLimitsAndSensibility){const V=U.xU(N).length();this._attachedCamera.panningSensibility=5e3/V,this._attachedCamera.wheelPrecision=100/E}return this._radiusTransition||(this._radiusTransition=x.e.CreateAnimation("radius",x.e.ANIMATIONTYPE_FLOAT,60,d.EasingFunction)),S=x.e.TransitionTo("radius",E,this._attachedCamera,this._attachedCamera.YN(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),t&&t(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),S&&this._animatables.push(S),!0}_calculateLowerRadiusFromModelBoundingSphere(N,U){const V=this._attachedCamera;if(!V)return 0;let A=V._calculateLowerRadiusFromModelBoundingSphere(N,U,this._radiusScale);return V.lowerRadiusLimit&&this._mode===d.IgnoreBoundsSizeMode&&(A=A<V.lowerRadiusLimit?V.lowerRadiusLimit:A),V.upperRadiusLimit&&(A=A>V.upperRadiusLimit?V.upperRadiusLimit:A),A}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const N=p.b.Now-this._lastInteractionTime,U=.5*Math.PI-this._defaultElevation,V=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>V&&N>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=x.e.CreateAnimation("beta",x.e.ANIMATIONTYPE_FLOAT,60,d.EasingFunction));const N=x.e.TransitionTo("beta",U,this._attachedCamera,this._attachedCamera.YN(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));N&&this._animatables.push(N)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=p.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}d.EasingFunction=new C.s,d.EasingMode=C.p.EASINGMODE_EASEINOUT,d.IgnoreBoundsSizeMode=0,d.FitFrustumSidesMode=1;var r=V(12803),v=V(12839),h=V(13958),c=V(12179);class H{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(N){N=c.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),V=U.getInputElement();let A=0,t=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{var q,i;const z=n.event,S="touch"===z.pointerType;if(n.type!==E.b.POINTERMOVE&&-1===this.buttons.indexOf(z.button))return;const p=z.target;if(this._altKey=z.altKey,this._ctrlKey=z.ctrlKey,this._metaKey=z.metaKey,this._shiftKey=z.shiftKey,this._buttonsPressed=z.buttons,U.isPointerLock){const N=z.movementX,U=z.movementY;this.onTouch(null,N,U),this._pointA=null,this._pointB=null}else{if(n.type!==E.b.POINTERDOWN&&n.type!==E.b.POINTERDOUBLETAP&&S&&(null===(q=this._pointA)||void 0===q?void 0:q.pointerId)!==z.pointerId&&(null===(i=this._pointB)||void 0===i?void 0:i.pointerId)!==z.pointerId)return;if(n.type!==E.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!S)if(n.type===E.b.POINTERDOUBLETAP)this.onDoubleTap(z.pointerType);else if(n.type!==E.b.POINTERUP||this._currentMousePointerIdDown!==z.pointerId&&!S){if(n.type===E.b.POINTERMOVE)if(N||z.preventDefault(),this._pointA&&null===this._pointB){const N=z.clientX-this._pointA.x,U=z.clientY-this._pointA.y;this._pointA.x=z.clientX,this._pointA.y=z.clientY,this.onTouch(this._pointA,N,U)}else if(this._pointA&&this._pointB){const N=this._pointA.pointerId===z.pointerId?this._pointA:this._pointB;N.x=z.clientX,N.y=z.clientY;const U=this._pointA.x-this._pointB.x,V=this._pointA.y-this._pointB.y,q=U*U+V*V,i={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:z.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,A,q,t,i),t=i,A=q}}else{try{null===p||void 0===p||p.releasePointerCapture(z.pointerId)}catch(k){}S||(this._pointB=null),U._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==z.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==z.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==A||t)&&(this.onMultiTouch(this._pointA,this._pointB,A,0,t,null),A=0,t=null),this._currentMousePointerIdDown=-1,this.onButtonUp(z),N||z.preventDefault()}else{try{null===p||void 0===p||p.setPointerCapture(z.pointerId)}catch(k){}if(null===this._pointA)this._pointA={x:z.clientX,y:z.clientY,pointerId:z.pointerId,type:z.pointerType};else{if(null!==this._pointB)return;this._pointB={x:z.clientX,y:z.clientY,pointerId:z.pointerId,type:z.pointerType}}-1!==this._currentMousePointerIdDown||S||(this._currentMousePointerIdDown=z.pointerId),this.onButtonDown(z),N||(z.preventDefault(),V&&V.focus())}}},this._observer=this.camera.YN()._inputManager._addCameraPointerObserver(this._pointerInput,E.b.POINTERDOWN|E.b.POINTERUP|E.b.POINTERMOVE|E.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,A=0,t=null,this.onLostFocus()},this._contextMenuBind=N=>this.onContextMenu(N),V&&V.addEventListener("contextmenu",this._contextMenuBind,!1);const n=this.camera.YN().getEngine().getHostWindow();n&&c.Tools.RegisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}Qp(){if(this._onLostFocus){const N=this.camera.YN().getEngine().getHostWindow();N&&c.Tools.UnregisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.YN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const N=this.camera.YN().getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(N){}onTouch(N,U,V){}onMultiTouch(N,U,V,A,t,n){}onContextMenu(N){N.preventDefault()}onButtonDown(N){}onButtonUp(N){}onLostFocus(){}}(0,A.b)([(0,t.N)()],H.prototype,"buttons",void 0);class Y extends H{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(N,U){if(0!==this.panningSensibility&&N&&U){const V=U.x-N.x,A=U.y-N.y;this.camera.inertialPanningX+=-V/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility}}_computePinchZoom(N,U){const V=this.camera.radius||Y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=V*Math.sqrt(N)/Math.sqrt(U):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(U-N)*V*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(U-N)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(N,U,V){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=V/this.panningSensibility):(this.camera.inertialAlphaOffset-=U/this.angularSensibilityX,this.camera.inertialBetaOffset-=V/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(N,U,V,A,t,n){0===V&&null===t||0===A&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(V,A),this._computeMultiTouchPanning(t,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(A)-Math.sqrt(V))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(V,A),this._isPinching=!0):this._computeMultiTouchPanning(t,n)):this.multiTouchPanning?this._computeMultiTouchPanning(t,n):this.pinchZoom&&this._computePinchZoom(V,A))}onButtonDown(N){this._isPanClick=N.button===this.camera._panningMouseButton}onButtonUp(N){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Y.MinimumRadiusForPinch=.001,(0,A.b)([(0,t.N)()],Y.prototype,"buttons",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"angularSensibilityX",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"angularSensibilityY",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"pinchPrecision",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"pinchDeltaPercentage",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"useNaturalPinchZoom",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"pinchZoom",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"panningSensibility",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"multiTouchPanning",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"multiTouchPanAndZoom",void 0),h.b.ArcRotateCameraPointersInput=Y;var W=V(12628);class s{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(N){N=c.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.YN(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const V=U.event;if(!V.metaKey)if(U.type===W.c.KEYDOWN){if(this._ctrlPressed=V.ctrlKey,this._altPressed=V.altKey,-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysReset.indexOf(V.keyCode)){-1===this._keys.indexOf(V.keyCode)&&this._keys.push(V.keyCode),V.preventDefault&&(N||V.preventDefault())}}else if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysReset.indexOf(V.keyCode)){const U=this._keys.indexOf(V.keyCode);U>=0&&this._keys.splice(U,1),V.preventDefault&&(N||V.preventDefault())}})))}Qp(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let U=0;U<this._keys.length;U++){const V=this._keys[U];-1!==this.keysLeft.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX-=1/this.panningSensibility:N.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset+=1/this.zoomingSensibility:N.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX+=1/this.panningSensibility:N.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset-=1/this.zoomingSensibility:N.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(V)&&N.useInputToRestoreState&&N.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,A.b)([(0,t.N)()],s.prototype,"keysUp",void 0),(0,A.b)([(0,t.N)()],s.prototype,"keysDown",void 0),(0,A.b)([(0,t.N)()],s.prototype,"keysLeft",void 0),(0,A.b)([(0,t.N)()],s.prototype,"keysRight",void 0),(0,A.b)([(0,t.N)()],s.prototype,"keysReset",void 0),(0,A.b)([(0,t.N)()],s.prototype,"panningSensibility",void 0),(0,A.b)([(0,t.N)()],s.prototype,"zoomingSensibility",void 0),(0,A.b)([(0,t.N)()],s.prototype,"useAltToZoom",void 0),(0,A.b)([(0,t.N)()],s.prototype,"angularSpeed",void 0),h.b.ArcRotateCameraKeyboardMoveInput=s;var M=V(12429),a=V(12636);class mN{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new q.CU(0,0,0),this._globalOffset=new q.CU(0,0,0),this._inertialPanning=q.CU.Zero()}_computeDeltaFromMouseWheelLegacyEvent(N,U){let V=0;const A=.01*N*this.wheelDeltaPercentage*U;return V=N>0?A/(1+this.wheelDeltaPercentage):A*(1+this.wheelDeltaPercentage),V}attachControl(N){N=c.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==E.b.POINTERWHEEL)return;const V=U.event;let A=0;const t=V.deltaMode===a.b.DOM_DELTA_LINE?40:1,n=-V.deltaY*t;if(this.customComputeDeltaFromMouseWheel)A=this.customComputeDeltaFromMouseWheel(n,this,V);else if(this.wheelDeltaPercentage){if(A=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),A>0){let N=this.camera.radius,U=this.camera.inertialRadiusOffset+A;for(let V=0;V<20&&!(N<=U)&&!(Math.abs(U*this.camera.inertia)<.001);V++)N-=U,U*=this.camera.inertia;N=(0,i.Clamp)(N,0,Number.MAX_VALUE),A=this._computeDeltaFromMouseWheelLegacyEvent(n,N)}}else A=n/(40*this.wheelPrecision);A&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(A)):this.camera.inertialRadiusOffset+=A),V.preventDefault&&(N||V.preventDefault())},this._observer=this.camera.YN()._inputManager._addCameraPointerObserver(this._wheel,E.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Hi(0)}Qp(){this._observer&&(this.camera.YN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const N=this.camera;0+N.inertialAlphaOffset+N.inertialBetaOffset+N.inertialRadiusOffset&&(this._updateHitPlane(),N.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(N.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const N=this.camera,U=N.target.xU(N.position);this._hitPlane=M.d.FromPositionAndNormal(N.target,U)}_getPosition(){const N=this.camera,U=N.YN(),V=U.createPickingRay(U.pointerX,U.pointerY,q.Matrix.Identity(),N,!1);0===N.targetScreenOffset.x&&0===N.targetScreenOffset.y||(this._viewOffset.set(N.targetScreenOffset.x,N.targetScreenOffset.y,0),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),this._globalOffset=q.CU.TransformNormal(this._viewOffset,N._cameraTransformMatrix),V.origin.addInPlace(this._globalOffset));let A=0;return this._hitPlane&&(A=V.intersectsPlane(this._hitPlane)??0),V.origin.addInPlace(V.direction.scaleInPlace(A))}_zoomToMouse(N){const U=this.camera,V=1-U.inertia;if(U.lowerRadiusLimit){const A=U.lowerRadiusLimit??0;U.radius-(U.inertialRadiusOffset+N)/V<A&&(N=(U.radius-A)*V-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const A=U.upperRadiusLimit??0;U.radius-(U.inertialRadiusOffset+N)/V>A&&(N=(U.radius-A)*V-U.inertialRadiusOffset)}const A=N/V/U.radius,t=this._getPosition(),n=q.TmpVectors.CU[6];t.subtractToRef(U.target,n),n.scaleInPlace(A),n.scaleInPlace(V),this._inertialPanning.addInPlace(n),U.inertialRadiusOffset+=N}_zeroIfClose(N){Math.abs(N.x)<k.d&&(N.x=0),Math.abs(N.y)<k.d&&(N.y=0),Math.abs(N.z)<k.d&&(N.z=0)}}(0,A.b)([(0,t.N)()],mN.prototype,"wheelPrecision",void 0),(0,A.b)([(0,t.N)()],mN.prototype,"zoomToMouseLocation",void 0),(0,A.b)([(0,t.N)()],mN.prototype,"wheelDeltaPercentage",void 0),h.b.ArcRotateCameraMouseWheelInput=mN;class w extends h.f{constructor(N){super(N)}addMouseWheel(){return this.add(new mN),this}addPointers(){return this.add(new Y),this}addKeyboard(){return this.add(new s),this}}var X=V(12344);function e(N,U){return isNaN(N)?U:N}z.c.AddNodeConstructor("ArcRotateCamera",((N,U)=>()=>new Q(N,0,0,1,q.CU.Zero(),U)));class Q extends v.d{get target(){return this._target}set target(N){this.setTarget(N)}get targetHost(){return this._targetHost}set targetHost(N){N&&this.setTarget(N)}getTarget(){return this.target}get position(){return this._position}set position(N){this.setPosition(N)}set upVector(N){this._upToYMatrix||(this._yToUpMatrix=new q.Matrix,this._upToYMatrix=new q.Matrix,this._upVector=q.CU.Zero()),N.normalize(),this._upVector.A(N),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){q.Matrix.RotationAlignToRef(q.CU.UpReadOnly,this._upVector,this._yToUpMatrix),q.Matrix.RotationAlignToRef(this._upVector,q.CU.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityX:0}set angularSensibilityX(N){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityX=N)}get angularSensibilityY(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityY:0}set angularSensibilityY(N){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityY=N)}get pinchPrecision(){const N=this.inputs.attached.pointers;return N?N.pinchPrecision:0}set pinchPrecision(N){const U=this.inputs.attached.pointers;U&&(U.pinchPrecision=N)}get pinchDeltaPercentage(){const N=this.inputs.attached.pointers;return N?N.pinchDeltaPercentage:0}set pinchDeltaPercentage(N){const U=this.inputs.attached.pointers;U&&(U.pinchDeltaPercentage=N)}get useNaturalPinchZoom(){const N=this.inputs.attached.pointers;return!!N&&N.useNaturalPinchZoom}set useNaturalPinchZoom(N){const U=this.inputs.attached.pointers;U&&(U.useNaturalPinchZoom=N)}get panningSensibility(){const N=this.inputs.attached.pointers;return N?N.panningSensibility:0}set panningSensibility(N){const U=this.inputs.attached.pointers;U&&(U.panningSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const U=this.inputs.attached.keyboard;U&&(U.keysUp=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const U=this.inputs.attached.keyboard;U&&(U.keysDown=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const U=this.inputs.attached.keyboard;U&&(U.keysRight=N)}get wheelPrecision(){const N=this.inputs.attached.mousewheel;return N?N.wheelPrecision:0}set wheelPrecision(N){const U=this.inputs.attached.mousewheel;U&&(U.wheelPrecision=N)}get zoomToMouseLocation(){const N=this.inputs.attached.mousewheel;return!!N&&N.zoomToMouseLocation}set zoomToMouseLocation(N){const U=this.inputs.attached.mousewheel;U&&(U.zoomToMouseLocation=N)}get wheelDeltaPercentage(){const N=this.inputs.attached.mousewheel;return N?N.wheelDeltaPercentage:0}set wheelDeltaPercentage(N){const U=this.inputs.attached.mousewheel;U&&(U.wheelDeltaPercentage=N)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(N){N!==this.useBouncingBehavior&&(N?(this._bouncingBehavior=new J,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(N){N!==this.useFramingBehavior&&(N?(this._framingBehavior=new d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(N){N!==this.useAutoRotationBehavior&&(N?(this._autoRotationBehavior=new B,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(N,U,V,A,t,i){var z;let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(N,q.CU.Zero(),i,S),z=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=q.CU.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new q.Matrix,this.panningAxis=new q.CU(1,1,0),this._transformedDirection=new q.CU,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new n.d,this.checkCollisions=!1,this.collisionRadius=new q.CU(.5,.5,.5),this._previousPosition=q.CU.Zero(),this._collisionVelocity=q.CU.Zero(),this._newPosition=q.CU.Zero(),this._computationVector=q.CU.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new q.CU(NaN,NaN,NaN),this._goalTargetScreenOffset=new q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V?(z.setPosition(U),z.xB&&z.xB(V)):z._previousPosition.A(z._position);const A=Math.cos(z.alpha),t=Math.sin(z.alpha),n=Math.cos(z.beta);let q=Math.sin(z.beta);0===q&&(q=1e-4);const i=z._getTargetPosition();z._computationVector.hi(z.radius*A*q,z.radius*n,z.radius*t*q),i.addToRef(z._computationVector,z._newPosition),z._position.A(z._newPosition);let S=z.upVector;z.allowUpsideDown&&z.beta<0&&(S=S.clone(),S=S.negate()),z._computeViewMatrix(z._position,i,S),z._viewMatrix.addAtIndex(12,z.targetScreenOffset.x),z._viewMatrix.addAtIndex(13,z.targetScreenOffset.y),z._collisionTriggered=!1},this._target=q.CU.Zero(),t&&this.setTarget(t),this.alpha=U,this.beta=V,this.radius=A,this.getViewMatrix(),this.inputs=new w(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new q.CU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=q.Vector2.Zero()}_updateCache(N){N||super._updateCache(),this._cache._target.A(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.A(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const N=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?N.addToRef(this._targetBoundingCenter,this._target):this._target.A(N)}const N=this._getLockedTargetPosition();return N||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>k.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,n=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=n?this._currentInterpolationFactor=n:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=e(N,this._goalAlpha),this._goalBeta=e(U,this._goalBeta),this._goalRadius=e(V,this._goalRadius),this._goalTarget.set(e(A.x,this._goalTarget.x),e(A.y,this._goalTarget.y),e(A.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(e(t.x,this._goalTargetScreenOffset.x),e(t.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,i.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,i.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,i.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,i.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(N,U){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const t=arguments;U=c.Tools.BackCompatCameraNoPreventDefault(t),this._useCtrlForPanning=V,this._panningMouseButton=A,"boolean"===typeof t[0]&&(t.length>1&&(this._useCtrlForPanning=t[1]),t.length>2&&(this._panningMouseButton=t[2])),this.inputs.attachElement(U),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Qp(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let N=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){N=!0;const U=this.invertRotation?-1:1,V=this._calculateHandednessMultiplier();let A=this.inertialAlphaOffset*V;this.beta<0&&(A*=-1),this.alpha+=A*U,this.beta+=this.inertialBetaOffset*U,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<k.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<k.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*k.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){N=!0;const U=new q.CU(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),U.multiplyInPlace(this.panningAxis),q.CU.TransformNormalToRef(U,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const N=this.upVector,U=q.CU.CrossToRef(this._transformedDirection,N,this._transformedDirection);q.CU.CrossToRef(N,U,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);q.CU.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.A(this._transformedDirection)}else{if(this.parent){const N=q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.transposeToRef(N),q.CU.TransformCoordinatesToRef(this._transformedDirection,N,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*k.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*k.d&&(this.inertialPanningY=0)}if(N)this.stopInterpolation();else if(this._isInterpolating){let N=!1;const U=this._scene.getEngine().getDeltaTime()/1e3,V=1-Math.pow(2,-U/this._currentInterpolationFactor),A=e(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const U=q.TmpVectors.CU[0].set(e(this._goalTarget.x,this._target.x),e(this._goalTarget.y,this._target.y),e(this._goalTarget.z,this._target.z));q.CU.LerpToRef(this.target,U,V,this._target),10*q.CU.Distance(this.target,U)/A<k.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.A(U),this.setTarget(this.target,!1,!0,!0)):N=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const U=q.Quaternion.RotationAlphaBetaGammaToRef(e(this._goalAlpha,this.alpha),e(this._goalBeta,this.beta),0,q.TmpVectors.Quaternion[0]),A=q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,q.TmpVectors.Quaternion[1]),t=q.Quaternion.SlerpToRef(A,U,V,q.TmpVectors.Quaternion[2]);t.normalize();const n=t.toAlphaBetaGammaToRef(q.TmpVectors.CU[0]);if(this.alpha=n.x,this.beta=n.y,t.isApprox(U,k.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const N=U.toAlphaBetaGammaToRef(q.TmpVectors.CU[0]);this.alpha=N.x,this.beta=N.y}else N=!0}if(isNaN(this._goalRadius)||(this.radius+=(A-this.radius)*V,Math.abs(A/this.radius-1)<k.d?(this._goalRadius=NaN,this.radius=A):N=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const U=q.TmpVectors.Vector2[0].set(e(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),e(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));q.Vector2.LerpToRef(this.targetScreenOffset,U,V,this.targetScreenOffset),q.Vector2.Distance(this.targetScreenOffset,U)<k.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.A(U)):N=!0}this._isInterpolating=N}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.CU.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const N=this.alpha;var U,V;this.alpha=function(N){let U=Math.PI/2;return 0===N.x&&0===N.z||(U=Math.acos(N.x/Math.sqrt(Math.pow(N.x,2)+Math.pow(N.z,2)))),N.z<0&&(U=2*Math.PI-U),U}(this._computationVector),this.beta=(U=this._computationVector.y,V=this.radius,Math.acos(U/V));const A=Math.round((N-this.alpha)/(2*Math.PI));this.alpha+=2*A*Math.PI,this._checkLimits()}setPosition(N){this._position.equals(N)||(this._position.A(N),this.rebuildAnglesAndRadius())}setTarget(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(A=this.overrideCloneAlphaBetaRadius??A,N.xi)U&&N.getBoundingInfo?this._targetBoundingCenter=N.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,N.xi(),this._targetHost=N,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const U=N,A=this._getTargetPosition();if(A&&!V&&A.equals(U))return;this._targetHost=null,this._target=U,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}A||this.rebuildAnglesAndRadius()}_getViewMatrix(){const N=Math.cos(this.alpha),U=Math.sin(this.alpha),V=Math.cos(this.beta);let A=Math.sin(this.beta);0===A&&(A=1e-4),0===this.radius&&(this.radius=1e-4);const t=this._getTargetPosition();if(this._computationVector.hi(this.radius*N*A,this.radius*V,this.radius*U*A),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.CU.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),t.addToRef(this._computationVector,this._newPosition),this.YN().collisionsEnabled&&this.checkCollisions){const N=this.YN().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,N.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.A(this._newPosition);let N=this.upVector;this.allowUpsideDown&&A<0&&(N=N.negate()),this._computeViewMatrix(this._position,t,N),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.A(t),this._viewMatrix}zoomOn(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N||this.YN().meshes;const V=S.b.MinMax(N);let A=this._calculateLowerRadiusFromModelBoundingSphere(V.min,V.max);if(A=Math.max(Math.min(A,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=A*this.zoomOnFactor,this.mode===r.b.ORTHOGRAPHIC_CAMERA){const N=this.YN().getEngine().getAspectRatio(this),U=A*this.zoomOnFactor/2;this.orthoLeft=-U*N,this.orthoRight=U*N,this.orthoBottom=-U,this.orthoTop=U}this.focusOn({min:V.min,max:V.max,distance:A},U)}focusOn(N){let U,V,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===N.min){const A=N||this.YN().meshes;U=S.b.MinMax(A),V=q.CU.Distance(U.min,U.max)}else{U=N,V=N.distance}this._target=S.b.Center(U),A||(this.maxZ=2*V)}createRigCamera(N,U){let V=0;switch(this.cameraRigMode){case r.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case r.b.RIG_MODE_VR:V=this._cameraRigParams.stereoHalfAngle*(0===U?1:-1);break;case r.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V=this._cameraRigParams.stereoHalfAngle*(0===U?-1:1)}const A=new Q(N,this.alpha+V,this.beta,this.radius,this._target,this.YN());return A._cameraRigParams={},A.isRigCamera=!0,A.rigParent=this,A.upVector=this.upVector,A.mode=this.mode,A.orthoLeft=this.orthoLeft,A.orthoRight=this.orthoRight,A.orthoBottom=this.orthoBottom,A.orthoTop=this.orthoTop,A}_updateRigCameras(){const N=this._rigCameras[0],U=this._rigCameras[1];switch(N.beta=U.beta=this.beta,this.cameraRigMode){case r.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case r.b.RIG_MODE_VR:N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case r.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const A=q.CU.Distance(N,U),t=this.YN().getEngine().getAspectRatio(this),n=Math.tan(this.fov/2),i=n*t,z=.5*A*V,S=z*Math.sqrt(1+1/(i*i)),E=z*Math.sqrt(1+1/(n*n));return Math.max(S,E)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,A.b)([(0,t.N)()],Q.prototype,"alpha",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"beta",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"radius",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,A.b)([(0,t.J)("target")],Q.prototype,"_target",void 0),(0,A.b)([(0,t.y)("targetHost")],Q.prototype,"_targetHost",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"inertialAlphaOffset",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"inertialBetaOffset",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"inertialRadiusOffset",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"lowerAlphaLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"upperAlphaLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"lowerBetaLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"upperBetaLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"lowerRadiusLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"upperRadiusLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"lowerTargetYLimit",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"inertialPanningX",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"inertialPanningY",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"pinchToPanMaxDistance",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"panningDistanceLimit",void 0),(0,A.b)([(0,t.J)()],Q.prototype,"panningOriginTarget",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"panningInertia",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"zoomToMouseLocation",null),(0,A.b)([(0,t.N)()],Q.prototype,"zoomOnFactor",void 0),(0,A.b)([(0,t.H)()],Q.prototype,"targetScreenOffset",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"allowUpsideDown",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"useInputToRestoreState",void 0),(0,A.b)([(0,t.N)()],Q.prototype,"restoreStateInterpolationFactor",void 0),(0,X.e)("BABYLON.ArcRotateCamera",Q)},13958:(N,U,V)=>{"use strict";V.d(U,{b:()=>q,f:()=>i});var A=V(12193),t=V(12413),n=V(12803),q={};class i{constructor(N){this.attachedToElement=!1,this.attached={},this.camera=N,this.checkInputs=()=>{}}add(N){const U=N.getSimpleName();this.attached[U]?A.b.Warn("camera input of type "+U+" already exists on camera"):(this.attached[U]=N,N.camera=this.camera,N.checkInputs&&(this.checkInputs=this._addCheckInputs(N.checkInputs.bind(N))),this.attachedToElement&&N.attachControl(this.noPreventDefault))}remove(N){for(const U in this.attached){const V=this.attached[U];if(V===N)return V.Qp(),V.camera=null,delete this.attached[U],void this.rebuildInputCheck()}}removeByType(N){for(const U in this.attached){const V=this.attached[U];V.getClassName()===N&&(V.Qp(),V.camera=null,delete this.attached[U],this.rebuildInputCheck())}}_addCheckInputs(N){const U=this.checkInputs;return()=>{U(),N()}}attachInput(N){this.attachedToElement&&N.attachControl(this.noPreventDefault)}attachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){N=!n.b.ForceAttachControlToAlwaysPreventDefault&&N,this.attachedToElement=!0,this.noPreventDefault=N;for(const U in this.attached)this.attached[U].attachControl(N)}}detachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const U in this.attached)this.attached[U].Qp(),N&&(this.attached[U].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const N in this.attached){const U=this.attached[N];U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(N){const U={};for(const V in this.attached){const N=this.attached[V],A=t.d.Serialize(N);U[N.getClassName()]=A}N.inputsmgr=U}parse(N){const U=N.inputsmgr;if(U){this.clear();for(const N in U){const V=q[N];if(V){const A=U[N],n=t.d.Parse((()=>new V),A,null);this.add(n)}}}else for(const V in this.attached){const U=q[this.attached[V].getClassName()];if(U){const A=t.d.Parse((()=>new U),N,null);this.remove(this.attached[V]),this.add(A)}}}}},13953:(N,U,V)=>{"use strict";V.d(U,{b:()=>H});var A=V(12367),t=V(12369),n=V(12383),q=V(12839),i=V(13958),z=V(12628),S=V(12179);class E{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(N){N=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.YN(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const V=U.event;if(!V.metaKey)if(U.type===z.c.KEYDOWN){if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysUpward.indexOf(V.keyCode)||-1!==this.keysDownward.indexOf(V.keyCode)||-1!==this.keysRotateLeft.indexOf(V.keyCode)||-1!==this.keysRotateRight.indexOf(V.keyCode)||-1!==this.keysRotateUp.indexOf(V.keyCode)||-1!==this.keysRotateDown.indexOf(V.keyCode)){-1===this._keys.indexOf(V.keyCode)&&this._keys.push(V.keyCode),N||V.preventDefault()}}else if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysUpward.indexOf(V.keyCode)||-1!==this.keysDownward.indexOf(V.keyCode)||-1!==this.keysRotateLeft.indexOf(V.keyCode)||-1!==this.keysRotateRight.indexOf(V.keyCode)||-1!==this.keysRotateUp.indexOf(V.keyCode)||-1!==this.keysRotateDown.indexOf(V.keyCode)){const U=this._keys.indexOf(V.keyCode);U>=0&&this._keys.splice(U,1),N||V.preventDefault()}})))}Qp(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let U=0;U<this._keys.length;U++){const V=this._keys[U],A=N._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(V)?N._localDirection.hi(-A,0,0):-1!==this.keysUp.indexOf(V)?N._localDirection.hi(0,0,A):-1!==this.keysRight.indexOf(V)?N._localDirection.hi(A,0,0):-1!==this.keysDown.indexOf(V)?N._localDirection.hi(0,0,-A):-1!==this.keysUpward.indexOf(V)?N._localDirection.hi(0,A,0):-1!==this.keysDownward.indexOf(V)?N._localDirection.hi(0,-A,0):-1!==this.keysRotateLeft.indexOf(V)?(N._localDirection.hi(0,0,0),N.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(V)?(N._localDirection.hi(0,0,0),N.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(V)?(N._localDirection.hi(0,0,0),N.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(V)&&(N._localDirection.hi(0,0,0),N.cameraRotation.x+=this._getLocalRotation()),N.YN().useRightHandedSystem&&(N._localDirection.z*=-1),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),n.CU.TransformNormalToRef(N._localDirection,N._cameraTransformMatrix,N._transformedDirection),N.cameraDirection.addInPlace(N._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const N=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*N}}(0,A.b)([(0,t.N)()],E.prototype,"keysUp",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysUpward",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysDown",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysDownward",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysLeft",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysRight",void 0),(0,A.b)([(0,t.N)()],E.prototype,"rotationSpeed",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysRotateLeft",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysRotateRight",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysRotateUp",void 0),(0,A.b)([(0,t.N)()],E.prototype,"keysRotateDown",void 0),i.b.FreeCameraKeyboardMoveInput=E;var p=V(12182),k=V(12624);class B{constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=N,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new p.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(N){N=S.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),V=U.getInputElement();this._pointerInput||(this._pointerInput=A=>{const t=A.event,n="touch"===t.pointerType;if(!this.touchEnabled&&n)return;if(A.type!==k.b.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const q=t.target;if(A.type===k.b.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=t.pointerId;try{null===q||void 0===q||q.setPointerCapture(t.pointerId)}catch(i){}-1===this._currentActiveButton&&(this._currentActiveButton=t.button),this._previousPosition={x:t.clientX,y:t.clientY},N||(t.preventDefault(),V&&V.focus()),U.isPointerLock&&this._onMouseMove&&this._onMouseMove(A.event)}else if(A.type===k.b.POINTERUP){if(n&&this._activePointerId!==t.pointerId||!n&&this._currentActiveButton!==t.button)return;try{null===q||void 0===q||q.releasePointerCapture(t.pointerId)}catch(i){}this._currentActiveButton=-1,this._previousPosition=null,N||t.preventDefault(),this._activePointerId=-1}else if(A.type===k.b.POINTERMOVE&&(this._activePointerId===t.pointerId||!n))if(U.isPointerLock&&this._onMouseMove)this._onMouseMove(A.event);else if(this._previousPosition){const U=this.camera._calculateHandednessMultiplier(),V=(t.clientX-this._previousPosition.x)*U,A=t.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=V/this.angularSensibility,this.camera.cameraRotation.x+=A/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:V,offsetY:A}),this._previousPosition={x:t.clientX,y:t.clientY},N||t.preventDefault()}}),this._onMouseMove=V=>{if(!U.isPointerLock)return;const A=this.camera._calculateHandednessMultiplier(),t=V.movementX*A;this.camera.cameraRotation.y+=t/this.angularSensibility;const n=V.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,N||V.preventDefault()},this._observer=this.camera.YN()._inputManager._addCameraPointerObserver(this._pointerInput,k.b.POINTERDOWN|k.b.POINTERUP|k.b.POINTERMOVE),V&&(this._contextMenuBind=N=>this.onContextMenu(N),V.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(N){N.preventDefault()}Qp(){if(this._observer){if(this.camera.YN()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,A.b)([(0,t.N)()],B.prototype,"buttons",void 0),(0,A.b)([(0,t.N)()],B.prototype,"angularSensibility",void 0),i.b.FreeCameraMouseInput=B;var C,x=V(12636);class J{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new p.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(N){N=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==k.b.POINTERWHEEL)return;const V=U.event,A=V.deltaMode===x.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*A*V.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*A*V.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*A*V.deltaZ/this._normalize,V.preventDefault&&(N||V.preventDefault())},this._observer=this.camera.YN()._inputManager._addCameraPointerObserver(this._wheel,k.b.POINTERWHEEL)}Qp(){this._observer&&(this.camera.YN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,A.b)([(0,t.N)()],J.prototype,"wheelPrecisionX",void 0),(0,A.b)([(0,t.N)()],J.prototype,"wheelPrecisionY",void 0),(0,A.b)([(0,t.N)()],J.prototype,"wheelPrecisionZ",void 0),function(N){N[N.MoveRelative=0]="MoveRelative",N[N.RotateRelative=1]="RotateRelative",N[N.MoveScene=2]="MoveScene"}(C||(C={}));class d extends J{constructor(){super(...arguments),this._moveRelative=n.CU.Zero(),this._rotateRelative=n.CU.Zero(),this._moveScene=n.CU.Zero(),this._wheelXAction=C.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=C.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(N){null===N&&this._wheelXAction!==C.MoveRelative||(this._wheelXAction=C.MoveRelative,this._wheelXActionCoordinate=N)}get wheelXMoveRelative(){return this._wheelXAction!==C.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(N){null===N&&this._wheelYAction!==C.MoveRelative||(this._wheelYAction=C.MoveRelative,this._wheelYActionCoordinate=N)}get wheelYMoveRelative(){return this._wheelYAction!==C.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(N){null===N&&this._wheelZAction!==C.MoveRelative||(this._wheelZAction=C.MoveRelative,this._wheelZActionCoordinate=N)}get wheelZMoveRelative(){return this._wheelZAction!==C.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(N){null===N&&this._wheelXAction!==C.RotateRelative||(this._wheelXAction=C.RotateRelative,this._wheelXActionCoordinate=N)}get wheelXRotateRelative(){return this._wheelXAction!==C.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(N){null===N&&this._wheelYAction!==C.RotateRelative||(this._wheelYAction=C.RotateRelative,this._wheelYActionCoordinate=N)}get wheelYRotateRelative(){return this._wheelYAction!==C.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(N){null===N&&this._wheelZAction!==C.RotateRelative||(this._wheelZAction=C.RotateRelative,this._wheelZActionCoordinate=N)}get wheelZRotateRelative(){return this._wheelZAction!==C.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(N){null===N&&this._wheelXAction!==C.MoveScene||(this._wheelXAction=C.MoveScene,this._wheelXActionCoordinate=N)}get wheelXMoveScene(){return this._wheelXAction!==C.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(N){null===N&&this._wheelYAction!==C.MoveScene||(this._wheelYAction=C.MoveScene,this._wheelYActionCoordinate=N)}get wheelYMoveScene(){return this._wheelYAction!==C.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(N){null===N&&this._wheelZAction!==C.MoveScene||(this._wheelZAction=C.MoveScene,this._wheelZActionCoordinate=N)}get wheelZMoveScene(){return this._wheelZAction!==C.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Hi(0),this._rotateRelative.Hi(0),this._moveScene.Hi(0),this._updateCamera(),this.camera.YN().useRightHandedSystem&&(this._moveRelative.z*=-1);const N=n.Matrix.Zero();this.camera.getViewMatrix().invertToRef(N);const U=n.CU.Zero();n.CU.TransformNormalToRef(this._moveRelative,N,U),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(U),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(N,U,V){if(0===N)return;if(null===U||null===V)return;let A=null;switch(U){case C.MoveRelative:A=this._moveRelative;break;case C.RotateRelative:A=this._rotateRelative;break;case C.MoveScene:A=this._moveScene}switch(V){case 0:A.set(N,0,0);break;case 1:A.set(0,N,0);break;case 2:A.set(0,0,N)}}}(0,A.b)([(0,t.N)()],d.prototype,"wheelXMoveRelative",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelYMoveRelative",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelZMoveRelative",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelXRotateRelative",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelYRotateRelative",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelZRotateRelative",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelXMoveScene",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelYMoveScene",null),(0,A.b)([(0,t.N)()],d.prototype,"wheelZMoveScene",null),i.b.FreeCameraMouseWheelInput=d;class r{constructor(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=N,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=S.Tools.IsSafari()}attachControl(N){N=S.Tools.BackCompatCameraNoPreventDefault(arguments);let U=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=V=>{const A=V.event,t="mouse"===A.pointerType||this._isSafari&&"undefined"===typeof A.pointerType;if(this.allowMouse||!t)if(V.type===k.b.POINTERDOWN){if(N||A.preventDefault(),this._pointerPressed.push(A.pointerId),1!==this._pointerPressed.length)return;U={x:A.clientX,y:A.clientY}}else if(V.type===k.b.POINTERUP){N||A.preventDefault();const V=this._pointerPressed.indexOf(A.pointerId);if(-1===V)return;if(this._pointerPressed.splice(V,1),0!=V)return;U=null,this._offsetX=null,this._offsetY=null}else if(V.type===k.b.POINTERMOVE){if(N||A.preventDefault(),!U)return;if(0!=this._pointerPressed.indexOf(A.pointerId))return;this._offsetX=A.clientX-U.x,this._offsetY=-(A.clientY-U.y)}}),this._observer=this.camera.YN()._inputManager._addCameraPointerObserver(this._pointerInput,k.b.POINTERDOWN|k.b.POINTERUP|k.b.POINTERMOVE),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.addEventListener("blur",this._onLostFocus)}}Qp(){if(this._pointerInput){if(this._observer&&(this.camera.YN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const N=this.camera,U=N._calculateHandednessMultiplier();N.cameraRotation.y=U*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)N.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const U=N._computeLocalCameraSpeed(),V=new n.CU(0,0,0!==this.touchMoveSensibility?U*this._offsetY/this.touchMoveSensibility:0);n.Matrix.RotationYawPitchRollToRef(N.rotation.y,N.rotation.x,0,N._cameraRotationMatrix),N.cameraDirection.addInPlace(n.CU.TransformCoordinates(V,N._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,A.b)([(0,t.N)()],r.prototype,"touchAngularSensibility",void 0),(0,A.b)([(0,t.N)()],r.prototype,"touchMoveSensibility",void 0),i.b.FreeCameraTouchInput=r;class v extends i.f{constructor(N){super(N),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new E),this}addMouse(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new B(N),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new d,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new r),this}clear(){super.clear(),this._mouseInput=null}}var h=V(12344),c=V(12272);class H extends q.d{get angularSensibility(){const N=this.inputs.attached.mouse;return N?N.angularSensibility:0}set angularSensibility(N){const U=this.inputs.attached.mouse;U&&(U.angularSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const U=this.inputs.attached.keyboard;U&&(U.keysUp=N)}get keysUpward(){const N=this.inputs.attached.keyboard;return N?N.keysUpward:[]}set keysUpward(N){const U=this.inputs.attached.keyboard;U&&(U.keysUpward=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const U=this.inputs.attached.keyboard;U&&(U.keysDown=N)}get keysDownward(){const N=this.inputs.attached.keyboard;return N?N.keysDownward:[]}set keysDownward(N){const U=this.inputs.attached.keyboard;U&&(U.keysDownward=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const U=this.inputs.attached.keyboard;U&&(U.keysRight=N)}get keysRotateLeft(){const N=this.inputs.attached.keyboard;return N?N.keysRotateLeft:[]}set keysRotateLeft(N){const U=this.inputs.attached.keyboard;U&&(U.keysRotateLeft=N)}get keysRotateRight(){const N=this.inputs.attached.keyboard;return N?N.keysRotateRight:[]}set keysRotateRight(N){const U=this.inputs.attached.keyboard;U&&(U.keysRotateRight=N)}get keysRotateUp(){const N=this.inputs.attached.keyboard;return N?N.keysRotateUp:[]}set keysRotateUp(N){const U=this.inputs.attached.keyboard;U&&(U.keysRotateUp=N)}get keysRotateDown(){const N=this.inputs.attached.keyboard;return N?N.keysRotateDown:[]}set keysRotateDown(N){const U=this.inputs.attached.keyboard;U&&(U.keysRotateDown=N)}constructor(N,U,V){var A;super(N,U,V,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),A=this,this.ellipsoid=new n.CU(.5,1,.5),this.ellipsoidOffset=new n.CU(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.CU.Zero(),this._diffPosition=n.CU.Zero(),this._newPosition=n.CU.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A._newPosition.A(U),A._newPosition.subtractToRef(A._oldPosition,A._diffPosition),A._diffPosition.length()>c.c.CollisionsEpsilon&&(A.position.addToRef(A._diffPosition,A._deferredPositionUpdate),A._deferOnly?A._deferredUpdated=!0:A.position.A(A._deferredPositionUpdate),A.xB&&V&&A.xB(V))},this.inputs=new v(this),this.inputs.addKeyboard().addMouse()}attachControl(N,U){U=S.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(U)}Qp(){this.inputs.detachElement(),this.cameraDirection=new n.CU(0,0,0),this.cameraRotation=new n.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(N){this._collisionMask=isNaN(N)?-1:N}_collideWithWorld(N){let U;U=this.parent?n.CU.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,U.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const V=this.YN().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let A=N;this.applyGravity&&(A=N.add(this.YN().gravity)),V.getNewPosition(this._oldPosition,A,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.CU.Zero(),this._transformedDirection=n.CU.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(N){this._needMoveForGravity=N}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.YN().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ip"}}(0,A.b)([(0,t.J)()],H.prototype,"ellipsoid",void 0),(0,A.b)([(0,t.J)()],H.prototype,"ellipsoidOffset",void 0),(0,A.b)([(0,t.N)()],H.prototype,"checkCollisions",void 0),(0,A.b)([(0,t.N)()],H.prototype,"applyGravity",void 0),(0,h.e)("BABYLON.FreeCamera",H)},14563:(N,U,V)=>{"use strict";V.d(U,{b:()=>n});var A=V(12481),t=V(14568);class n{constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=V,this.bE=[],this._maxBlockCapacity=U||64,this._selectionContent=new A.d(1024),this._creationFunc=N}update(N,U,V){t.c._CreateBlocks(N,U,V,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}nE(N){for(let U=0;U<this.dE.length;U++){this.dE[U].addEntry(N)}}tE(N){for(let U=0;U<this.dE.length;U++){this.dE[U].removeEntry(N)}}select(N,U){this._selectionContent.reset();for(let V=0;V<this.dE.length;V++){this.dE[V].select(N,this._selectionContent,U)}return U?this._selectionContent.concat(this.bE):this._selectionContent.concatWithNoDuplicate(this.bE),this._selectionContent}intersects(N,U,V){this._selectionContent.reset();for(let A=0;A<this.dE.length;A++){this.dE[A].intersects(N,U,this._selectionContent,V)}return V?this._selectionContent.concat(this.bE):this._selectionContent.concatWithNoDuplicate(this.bE),this._selectionContent}intersectsRay(N){this._selectionContent.reset();for(let U=0;U<this.dE.length;U++){this.dE[U].intersectsRay(N,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bE),this._selectionContent}}n.CreationFuncForMeshes=(N,U)=>{const V=N.getBoundingInfo();!N.isBlocked&&V.boundingBox.intersectsMinMax(U.Ap,U.tp)&&U.entries.push(N)},n.CreationFuncForSubMeshes=(N,U)=>{N.getBoundingInfo().boundingBox.intersectsMinMax(U.Ap,U.tp)&&U.entries.push(N)}},14568:(N,U,V)=>{"use strict";V.d(U,{c:()=>n});var A=V(12383),t=V(12700);class n{constructor(N,U,V,A,t,n){this.entries=[],this.np=new Array,this._capacity=V,this._depth=A,this._maxDepth=t,this._creationFunc=n,this._minPoint=N,this._maxPoint=U,this.np.push(N.clone()),this.np.push(U.clone()),this.np.push(N.clone()),this.np[2].x=U.x,this.np.push(N.clone()),this.np[3].y=U.y,this.np.push(N.clone()),this.np[4].z=U.z,this.np.push(U.clone()),this.np[5].z=N.z,this.np.push(U.clone()),this.np[6].x=N.x,this.np.push(U.clone()),this.np[7].y=N.y}get SV(){return this._capacity}get Ap(){return this._minPoint}get tp(){return this._maxPoint}addEntry(N){if(this.dE)for(let U=0;U<this.dE.length;U++){this.dE[U].addEntry(N)}else this._creationFunc(N,this),this.entries.length>this.SV&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(N){if(this.dE){for(let U=0;U<this.dE.length;U++){this.dE[U].removeEntry(N)}return}const U=this.entries.indexOf(N);U>-1&&this.entries.splice(U,1)}addEntries(N){for(let U=0;U<N.length;U++){const V=N[U];this.addEntry(V)}}select(N,U,V){if(t.d.IsInFrustum(this.np,N)){if(this.dE){for(let A=0;A<this.dE.length;A++){this.dE[A].select(N,U,V)}return}V?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersects(N,U,V,A){if(t.d.IntersectsSphere(this._minPoint,this._maxPoint,N,U)){if(this.dE){for(let t=0;t<this.dE.length;t++){this.dE[t].intersects(N,U,V,A)}return}A?V.concat(this.entries):V.concatWithNoDuplicate(this.entries)}}intersectsRay(N,U){if(N.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.dE){for(let V=0;V<this.dE.length;V++){this.dE[V].intersectsRay(N,U)}return}U.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){n._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(N,U,V,t,q,i,z,S){z.dE=new Array;const E=new A.CU((U.x-N.x)/2,(U.y-N.y)/2,(U.z-N.z)/2);for(let A=0;A<2;A++)for(let U=0;U<2;U++)for(let p=0;p<2;p++){const k=N.add(E.multiplyByFloats(A,U,p)),B=N.add(E.multiplyByFloats(A+1,U+1,p+1)),C=new n(k,B,t,q+1,i,S);C.addEntries(V),z.dE.push(C)}}}},14570:(N,U,V)=>{"use strict";V.d(U,{e:()=>E});var A=V(12601),t=V(12383),n=V(12772),q=V(13734),i=V(12620),z=V(14563),S=V(12223);A.e.prototype.createOrUpdateSelectionOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,V=this._getComponent(i.e.NAME_OCTREE);V||(V=new E(this),this.o(V)),this.OE||(this.OE=new z.b(z.b.CreationFuncForMeshes,N,U));const A=this.getWorldExtends();return this.OE.update(A.min,A.max,this.meshes),this.OE},Object.defineProperty(A.e.prototype,"selectionOctree",{get:function(){return this.OE},enumerable:!0,configurable:!0}),n.e.prototype.createOrUpdateSubmeshesOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const V=this.YN();let A=V._getComponent(i.e.NAME_OCTREE);A||(A=new E(V),V.o(A)),this._submeshesOctree||(this._submeshesOctree=new z.b(z.b.CreationFuncForSubMeshes,N,U)),this.xi(!0);const t=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(t.minimumWorld,t.maximumWorld,this.Ei),this._submeshesOctree};class E{constructor(N){this.name=i.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new q.d(t.CU.Zero(),new t.CU(1,1,1)),(N=N||S.e.LastCreatedScene)&&(this.JU=N,this.JU.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.JU.getActiveSubMeshCandidates=N=>this.getActiveSubMeshCandidates(N),this.JU.getCollidingSubMeshCandidates=(N,U)=>this.getCollidingSubMeshCandidates(N,U),this.JU.getIntersectingSubMeshCandidates=(N,U)=>this.getIntersectingSubMeshCandidates(N,U))}register(){this.JU.onMeshRemovedObservable.add((N=>{const U=this.JU.selectionOctree;if(void 0!==U&&null!==U){const V=U.bE.indexOf(N);-1!==V&&U.bE.splice(V,1)}})),this.JU.onMeshImportedObservable.add((N=>{const U=this.JU.selectionOctree;void 0!==U&&null!==U&&U.nE(N)}))}getActiveMeshCandidates(){var N;return(null===(N=this.JU.OE)||void 0===N?void 0:N.select(this.JU.frustumPlanes))||this.JU._getDefaultMeshCandidates()}getActiveSubMeshCandidates(N){if(N._submeshesOctree&&N.useOctreeForRenderingSelection){return N._submeshesOctree.select(this.JU.frustumPlanes)}return this.JU._getDefaultSubMeshCandidates(N)}getIntersectingSubMeshCandidates(N,U){if(N._submeshesOctree&&N.useOctreeForPicking){q.d.TransformToRef(U,N.getWorldMatrix(),this._tempRay);return N._submeshesOctree.intersectsRay(this._tempRay)}return this.JU._getDefaultSubMeshCandidates(N)}getCollidingSubMeshCandidates(N,U){if(N._submeshesOctree&&N.useOctreeForCollisions){const V=U._velocityWorldLength+Math.max(U._radius.x,U._radius.y,U._radius.z);return N._submeshesOctree.intersects(U._basePointWorld,V)}return this.JU._getDefaultSubMeshCandidates(N)}rebuild(){}dispose(){}}},13734:(N,U,V)=>{"use strict";V.d(U,{d:()=>B});var A=V(12601),t=V(12803),n=V(12389),q=V(12383),i=V(12392),z=V(12685),S=V(12618),E=V(12223),p=V(12641);const k={internalPickerForMesh:void 0};class B{constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.d;this.origin=N,this.direction=U,this.length=V,this.epsilon=A}clone(){return new B(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const A=B._TmpVector3[0].hi(N.x-V,N.y-V,N.z-V),t=B._TmpVector3[1].hi(U.x+V,U.y+V,U.z+V);let n,q,i,z,S=0,E=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<A.x||this.origin.x>t.x)return!1}else if(n=1/this.direction.x,q=(A.x-this.origin.x)*n,i=(t.x-this.origin.x)*n,i===-1/0&&(i=1/0),q>i&&(z=q,q=i,i=z),S=Math.max(q,S),E=Math.min(i,E),S>E)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<A.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,q=(A.y-this.origin.y)*n,i=(t.y-this.origin.y)*n,i===-1/0&&(i=1/0),q>i&&(z=q,q=i,i=z),S=Math.max(q,S),E=Math.min(i,E),S>E)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<A.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,q=(A.z-this.origin.z)*n,i=(t.z-this.origin.z)*n,i===-1/0&&(i=1/0),q>i&&(z=q,q=i,i=z),S=Math.max(q,S),E=Math.min(i,E),S>E)return!1;return!0}intersectsBox(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(N.minimum,N.maximum,U)}intersectsSphere(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=N.center.x-this.origin.x,A=N.center.y-this.origin.y,t=N.center.z-this.origin.z,n=V*V+A*A+t*t,q=N.radius+U,i=q*q;if(n<=i)return!0;const z=V*this.direction.x+A*this.direction.y+t*this.direction.z;if(z<0)return!1;return n-z*z<=i}intersectsTriangle(N,U,V){const A=B._TmpVector3[0],t=B._TmpVector3[1],n=B._TmpVector3[2],i=B._TmpVector3[3],S=B._TmpVector3[4];U.subtractToRef(N,A),V.subtractToRef(N,t),q.CU.CrossToRef(this.direction,t,n);const E=q.CU.Dot(A,n);if(0===E)return null;const p=1/E;this.origin.subtractToRef(N,i);const k=q.CU.Dot(i,n)*p;if(k<-this.epsilon||k>1+this.epsilon)return null;q.CU.CrossToRef(i,A,S);const C=q.CU.Dot(this.direction,S)*p;if(C<-this.epsilon||k+C>1+this.epsilon)return null;const x=q.CU.Dot(t,S)*p;return x>this.length?null:new z.e(1-k-C,k,x)}intersectsPlane(N){let U;const V=q.CU.Dot(N.normal,this.direction);if(Math.abs(V)<9.99999997475243e-7)return null;{const A=q.CU.Dot(N.normal,this.origin);return U=(-N.d-A)/V,U<0?U<-9.99999997475243e-7?null:0:U}}intersectsAxis(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(N){case"y":{const N=(this.origin.y-U)/this.direction.y;return N>0?null:new q.CU(this.origin.x+this.direction.x*-N,U,this.origin.z+this.direction.z*-N)}case"x":{const N=(this.origin.x-U)/this.direction.x;return N>0?null:new q.CU(U,this.origin.y+this.direction.y*-N,this.origin.z+this.direction.z*-N)}case"z":{const N=(this.origin.z-U)/this.direction.z;return N>0?null:new q.CU(this.origin.x+this.direction.x*-N,this.origin.y+this.direction.y*-N,U)}default:return null}}intersectsMesh(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=q.TmpVectors.Matrix[0];return N.getWorldMatrix().invertToRef(i),this._tmpRay?B.TransformToRef(this,i,this._tmpRay):this._tmpRay=B.Transform(this,i),N.intersects(this._tmpRay,U,V,A,t,n)}intersectsMeshes(N,U,V){V?V.length=0:V=[];for(let A=0;A<N.length;A++){const t=this.intersectsMesh(N[A],U);t.hit&&V.push(t)}return V.sort(this._comparePickingInfo),V}_comparePickingInfo(N,U){return N.distance<U.distance?-1:N.distance>U.distance?1:0}intersectionSegment(N,U,V){const A=this.origin,t=q.TmpVectors.CU[0],n=q.TmpVectors.CU[1],i=q.TmpVectors.CU[2],z=q.TmpVectors.CU[3];U.subtractToRef(N,t),this.direction.scaleToRef(B._Rayl,i),A.addToRef(i,n),N.subtractToRef(A,z);const S=q.CU.Dot(t,t),E=q.CU.Dot(t,i),p=q.CU.Dot(i,i),k=q.CU.Dot(t,z),C=q.CU.Dot(i,z),x=S*p-E*E;let J,d,r=x,v=x;x<B._Smallnum?(J=0,r=1,d=C,v=p):(J=E*C-p*k,d=S*C-E*k,J<0?(J=0,d=C,v=p):J>r&&(J=r,d=C+E,v=p)),d<0?(d=0,-k<0?J=0:-k>S?J=r:(J=-k,r=S)):d>v&&(d=v,-k+E<0?J=0:-k+E>S?J=r:(J=-k+E,r=S));const h=Math.abs(J)<B._Smallnum?0:J/r,c=Math.abs(d)<B._Smallnum?0:d/v,H=q.TmpVectors.CU[4];i.scaleToRef(c,H);const Y=q.TmpVectors.CU[5];t.scaleToRef(h,Y),Y.addInPlace(z);const W=q.TmpVectors.CU[6];Y.subtractToRef(H,W);return c>0&&c<=this.length&&W.lengthSquared()<V*V?Y.length():-1}update(N,U,V,A,t,n,i){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){B._RayDistant||(B._RayDistant=B.Zero()),B._RayDistant.unprojectRayToRef(N,U,V,A,q.Matrix.IdentityReadOnly,n,i);const z=q.TmpVectors.Matrix[0];t.invertToRef(z),B.TransformToRef(B._RayDistant,z,this)}else this.unprojectRayToRef(N,U,V,A,t,n,i);return this}static Zero(){return new B(q.CU.Zero(),q.CU.Zero())}static CreateNew(N,U,V,A,t,n,q){return B.Zero().update(N,U,V,A,t,n,q)}static CreateNewFromTo(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.Matrix.IdentityReadOnly;const A=new B(new q.CU(0,0,0),new q.CU(0,0,0));return B.CreateFromToToRef(N,U,A,V)}static CreateFromToToRef(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.Matrix.IdentityReadOnly;V.origin.A(N);const t=U.subtractToRef(N,V.direction),n=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return V.length=n,V.direction.normalize(),B.TransformToRef(V,A,V)}static Transform(N,U){const V=new B(new q.CU(0,0,0),new q.CU(0,0,0));return B.TransformToRef(N,U,V),V}static TransformToRef(N,U,V){q.CU.TransformCoordinatesToRef(N.origin,U,V.origin),q.CU.TransformNormalToRef(N.direction,U,V.direction),V.length=N.length,V.epsilon=N.epsilon;const A=V.direction,t=A.length();if(0!==t&&1!==t){const N=1/t;A.x*=N,A.y*=N,A.z*=N,V.length*=t}return V}unprojectRayToRef(N,U,V,A,t,n,i){const z=q.TmpVectors.Matrix[0];t.multiplyToRef(n,z),z.multiplyToRef(i,z),z.invert();const S=E.e.LastCreatedEngine,p=q.TmpVectors.CU[0];p.x=N/V*2-1,p.y=-(U/A*2-1),p.z=null!==S&&void 0!==S&&S.ln?1:null!==S&&void 0!==S&&S.isNDCHalfZRange?0:-1;const k=q.TmpVectors.CU[1].hi(p.x,p.y,1-1e-8),B=q.TmpVectors.CU[2],C=q.TmpVectors.CU[3];q.CU._UnprojectFromInvertedMatrixToRef(p,z,B),q.CU._UnprojectFromInvertedMatrixToRef(k,z,C),this.origin.A(B),C.subtractToRef(B,this.direction),this.direction.normalize()}}function C(N,U,V,A,t){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=B.Zero();return x(N,U,V,A,q,t,n),q}function x(N,U,V,A,t,n){let i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const S=N.getEngine();if(!n&&!(n=N.activeCamera))return N;const E=n.viewport,p=S.getRenderHeight(),{x:k,y:B,width:C,height:x}=E.toGlobal(S.getRenderWidth(),p),J=1/S.getHardwareScalingLevel();return U=U*J-k,V=V*J-(p-B-x),t.update(U,V,C,x,A||q.Matrix.IdentityReadOnly,i?q.Matrix.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),z),N}function J(N,U,V,A,t){if(!S.d)return N;const n=N.getEngine();if(!t&&!(t=N.activeCamera))throw new Error("Active camera not set");const i=t.viewport,z=n.getRenderHeight(),{x:E,y:p,width:k,height:B}=i.toGlobal(n.getRenderWidth(),z),C=q.Matrix.Identity(),x=1/n.getHardwareScalingLevel();return U=U*x-E,V=V*x-(z-p-B),A.update(U,V,k,B,C,C,t.getProjectionMatrix()),N}function d(N,U,V,A,t,n,q,i){const z=U(A,V.enableDistantPicking),S=V.intersects(z,t,q,n,A,i);return S&&S.hit?!t&&null!=N&&S.distance>=N.distance?null:S:null}function r(N,U,V,A,t,n){let i=null;const z=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),E=N.cameraToUseForPointers||N.activeCamera,p=k.internalPickerForMesh||d;for(let S=0;S<N.meshes.length;S++){const k=N.meshes[S];if(V){if(!V(k,-1))continue}else if(!k.isEnabled()||!k.isVisible||!k.lz)continue;const B=z&&k.isWorldMatrixCameraDependent(),C=k.xi(B,E);if(k.hasThinInstances&&k.cS){const N=p(i,U,k,C,!0,!0,n);if(N){if(t)return N;const z=q.TmpVectors.Matrix[1],S=k.thinInstanceGetWorldMatrices();for(let N=0;N<S.length;N++){if(V&&!V(k,N))continue;S[N].multiplyToRef(C,z);const q=p(i,U,k,z,A,t,n,!0);if(q&&(i=q,i.thinInstanceIndex=N,A))return i}}}else{const N=p(i,U,k,C,A,t,n);if(N&&(i=N,A))return i}}return i||new S.d}function v(N,U,V,A){if(!S.d)return null;const t=[],n=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),i=N.cameraToUseForPointers||N.activeCamera,z=k.internalPickerForMesh||d;for(let S=0;S<N.meshes.length;S++){const E=N.meshes[S];if(V){if(!V(E,-1))continue}else if(!E.isEnabled()||!E.isVisible||!E.lz)continue;const p=n&&E.isWorldMatrixCameraDependent(),k=E.xi(p,i);if(E.hasThinInstances&&E.cS){if(z(null,U,E,k,!0,!0,A)){const N=q.TmpVectors.Matrix[1],n=E.thinInstanceGetWorldMatrices();for(let q=0;q<n.length;q++){if(V&&!V(E,q))continue;n[q].multiplyToRef(k,N);const i=z(null,U,E,N,!1,!1,A,!0);i&&(i.thinInstanceIndex=q,t.push(i))}}}else{const N=z(null,U,E,k,!1,!1,A);N&&t.push(N)}}return t}function h(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,A=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;A||(A=N.getWorldMatrix()),U.length=V,t?U.origin.A(t):U.origin.A(N.position);const n=q.TmpVectors.CU[2];n.set(0,0,N._scene.useRightHandedSystem?-1:1);const i=q.TmpVectors.CU[3];return q.CU.TransformNormalToRef(n,A,i),q.CU.NormalizeToRef(i,U.direction),U}var c,H;B._TmpVector3=(0,i.b)(6,q.CU.Zero),B._RayDistant=B.Zero(),B._Smallnum=1e-8,B._Rayl=1e9,c=A.e,(H=t.b)&&(H.prototype.getForwardRay=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,U=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;return h(this,new B(q.CU.Zero(),q.CU.Zero(),N),N,U,V)},H.prototype.getForwardRayToRef=function(N){return h(this,N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),c&&(p.e._IsPickingAvailable=!0,c.prototype.createPickingRay=function(N,U,V,A){return C(this,N,U,V,A,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),A.e.prototype.createPickingRayToRef=function(N,U,V,A,t){return x(this,N,U,V,A,t,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},A.e.prototype.createPickingRayInCameraSpace=function(N,U,V){return function(N,U,V,A){const t=B.Zero();return J(N,U,V,t,A),t}(this,N,U,V)},A.e.prototype.createPickingRayInCameraSpaceToRef=function(N,U,V,A){return J(this,N,U,V,A)},A.e.prototype.pickWithBoundingInfo=function(N,U,V,A,t){return function(N,U,V,A,t,n){if(!S.d)return null;const i=r(N,(A=>(N._tempPickingRay||(N._tempPickingRay=B.Zero()),x(N,U,V,A,N._tempPickingRay,n||null),N._tempPickingRay)),A,t,!0);return i&&(i.ray=C(N,U,V,q.Matrix.Identity(),n||null)),i}(this,N,U,V,A,t)},A.e.prototype.kV=function(N,U,V,A,t,n){return function(N,U,V,A,t,n,i){const z=r(N,((A,t)=>(N._tempPickingRay||(N._tempPickingRay=B.Zero()),x(N,U,V,A,N._tempPickingRay,n||null,!1,t),N._tempPickingRay)),A,t,!1,i);return z&&(z.ray=C(N,U,V,q.Matrix.Identity(),n||null)),z}(this,N,U,V,A,t,n)},A.e.prototype.pickWithRay=function(N,U,V,A){return function(N,U,V,A,t){const n=r(N,(V=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=q.Matrix.Identity()),V.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=B.Zero()),B.TransformToRef(U,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),V,A,!1,t);return n&&(n.ray=U),n}(this,N,U,V,A)},A.e.prototype.multiPick=function(N,U,V,A,t){return function(N,U,V,A,t,n){return v(N,(A=>C(N,U,V,A,t||null)),A,n)}(this,N,U,V,A,t)},A.e.prototype.multiPickWithRay=function(N,U,V){return function(N,U,V,A){return v(N,(V=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=q.Matrix.Identity()),V.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=B.Zero()),B.TransformToRef(U,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),V,A)}(this,N,U,V)}},14006:(N,U,V)=>{"use strict";var A=V(12319),t=V(12193),n=V(12232),q=V(12351),i=V(12272),z=V(12335);i.c.prototype._partialLoadFile=function(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(N,(N=>{V[U]=N,V._internalCount++,6===V._internalCount&&A(V)}),void 0,void 0,!0,((N,U)=>{t&&N&&t(N.status+" "+N.statusText,U)}))},i.c.prototype._cascadeLoadFiles=function(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=[];t._internalCount=0;for(let n=0;n<6;n++)this._partialLoadFile(V[n],n,t,U,A)},i.c.prototype._cascadeLoadImgs=function(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5?arguments[5]:void 0;const q=[];q._internalCount=0;for(let i=0;i<6;i++)this._partialLoadImg(A[i],i,q,N,U,V,t,n)},i.c.prototype._partialLoadImg=function(N,U,V,A,t,i){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0;const E=(0,q.b)();(0,n.s)(N,(N=>{V[U]=N,V._internalCount++,A&&A.removePendingData(E),6===V._internalCount&&i&&i(t,V)}),((N,U)=>{A&&A.removePendingData(E),z&&z(N,U)}),A?A.offlineProvider:null,S),A&&A.addPendingData(E)},i.c.prototype.createCubeTextureBase=function(N,U,V,n){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,J=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,d=arguments.length>14&&void 0!==arguments[14]&&arguments[14],r=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=C||new A.d(this,7);v.isCube=!0,v.url=N,v.generateMipMaps=!n,v._lodGenerationScale=k,v._lodGenerationOffset=B,v._useSRGBBuffer=!!d&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),v!==C&&(v.label=N.substring(0,60)),this._doNotHandleContextLost||(v._extension=E,v._files=V,v._buffer=r);const h=N;this._transformTextureUrl&&!C&&(N=this._transformTextureUrl(N));const c=E??function(N){const U=N.split("?")[0],V=U.lastIndexOf(".");return V>-1?U.substring(V).toLowerCase():""}(N),H=(0,z.d)(c),Y=(N,U)=>{v.dispose(),i?i(N,U):N&&t.b.Warn(N)},W=(A,i)=>{N===h?A&&Y(A.status+" "+A.statusText,i):(t.b.Warn(`Failed to load ${N}, falling back to the ${h}`),this.createCubeTextureBase(h,U,V,!!n,q,Y,S,E,p,k,B,v,x,J,d,r))};if(H)H.then((A=>{const t=N=>{x&&x(v,N),A.loadCubeData(N,v,p,q,((N,U)=>{Y(N,U)}))};r?t(r):V&&6===V.length?A.supportCascades?this._cascadeLoadFiles(U,(N=>t(N.map((N=>new Uint8Array(N))))),V,Y):Y("Textures type does not support cascades."):this._loadFile(N,(N=>t(new Uint8Array(N))),void 0,void 0,!0,W)}));else{if(!V||0===V.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,v,((N,U)=>{J&&J(N,U)}),V,Y)}return this._internalTexturesCache.push(v),v}},14578:(N,U,V)=>{"use strict";V(12193);var A=V(12512);V(12319),V(12462),V(12313),V(12554),V(12519);A.e},14031:(N,U,V)=>{"use strict";V.d(U,{b:()=>t});var A=V(12344);class t{constructor(N){this.value=this._toInt(N)}_toInt(N){return 0|N}add(N){return new t(this.value+N.value)}xU(N){return new t(this.value-N.value)}multiply(N){return new t(Math.imul(this.value,N.value))}divide(N){return new t(this.value/N.value)}getClassName(){return t.ClassName}equals(N){return this.value===N.value}static FromValue(N){return new t(N)}toString(){return this.value.toString()}}t.ClassName="FlowGraphInteger",(0,A.e)("FlowGraphInteger",t)},14045:(N,U,V)=>{"use strict";V.d(U,{c:()=>t,d:()=>n});var A=V(12383);class t{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ni=N}get m(){return this.ni}transformVector(N){return this.transformVectorToRef(N,new A.Vector2)}transformVectorToRef(N,U){return U.x=N.x*this.ni[0]+N.y*this.ni[1],U.y=N.x*this.ni[2]+N.y*this.ni[3],U}pi(){return this.toArray()}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<4;U++)N[U]=this.ni[U];return N}BV(N){for(let U=0;U<4;U++)this.ni[U]=N[U];return this}multiplyToRef(N,U){const V=N.ni,A=this.ni,t=U.ni;return t[0]=V[0]*A[0]+V[1]*A[2],t[1]=V[0]*A[1]+V[1]*A[3],t[2]=V[2]*A[0]+V[3]*A[2],t[3]=V[2]*A[1]+V[3]*A[3],U}multiply(N){return this.multiplyToRef(N,new t)}divideToRef(N,U){const V=this.ni,A=N.ni,t=U.ni;return t[0]=V[0]/A[0],t[1]=V[1]/A[1],t[2]=V[2]/A[2],t[3]=V[3]/A[3],U}divide(N){return this.divideToRef(N,new t)}addToRef(N,U){const V=this.ni,A=N.m,t=U.m;return t[0]=V[0]+A[0],t[1]=V[1]+A[1],t[2]=V[2]+A[2],t[3]=V[3]+A[3],U}add(N){return this.addToRef(N,new t)}subtractToRef(N,U){const V=this.ni,A=N.m,t=U.m;return t[0]=V[0]-A[0],t[1]=V[1]-A[1],t[2]=V[2]-A[2],t[3]=V[3]-A[3],U}xU(N){return this.subtractToRef(N,new t)}transpose(){const N=this.ni;return new t([N[0],N[2],N[1],N[3]])}determinant(){const N=this.ni;return N[0]*N[3]-N[1]*N[2]}inverse(){const N=this.determinant();if(0===N)throw new Error("Matrix is not invertible");const U=this.ni,V=1/N;return new t([U[3]*V,-U[1]*V,-U[2]*V,U[0]*V])}equals(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=this.ni,A=N.m;return 0===U?V[0]===A[0]&&V[1]===A[1]&&V[2]===A[2]&&V[3]===A[3]:Math.abs(V[0]-A[0])<U&&Math.abs(V[1]-A[1])<U&&Math.abs(V[2]-A[2])<U&&Math.abs(V[3]-A[3])<U}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ni.join(", ")})`}}class n{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ni=N}get m(){return this.ni}transformVector(N){return this.transformVectorToRef(N,new A.CU)}transformVectorToRef(N,U){const V=this.ni;return U.x=N.x*V[0]+N.y*V[1]+N.z*V[2],U.y=N.x*V[3]+N.y*V[4]+N.z*V[5],U.z=N.x*V[6]+N.y*V[7]+N.z*V[8],U}multiplyToRef(N,U){const V=N.ni,A=this.ni,t=U.m;return t[0]=V[0]*A[0]+V[1]*A[3]+V[2]*A[6],t[1]=V[0]*A[1]+V[1]*A[4]+V[2]*A[7],t[2]=V[0]*A[2]+V[1]*A[5]+V[2]*A[8],t[3]=V[3]*A[0]+V[4]*A[3]+V[5]*A[6],t[4]=V[3]*A[1]+V[4]*A[4]+V[5]*A[7],t[5]=V[3]*A[2]+V[4]*A[5]+V[5]*A[8],t[6]=V[6]*A[0]+V[7]*A[3]+V[8]*A[6],t[7]=V[6]*A[1]+V[7]*A[4]+V[8]*A[7],t[8]=V[6]*A[2]+V[7]*A[5]+V[8]*A[8],U}multiply(N){return this.multiplyToRef(N,new n)}divideToRef(N,U){const V=this.ni,A=N.m,t=U.m;return t[0]=V[0]/A[0],t[1]=V[1]/A[1],t[2]=V[2]/A[2],t[3]=V[3]/A[3],t[4]=V[4]/A[4],t[5]=V[5]/A[5],t[6]=V[6]/A[6],t[7]=V[7]/A[7],t[8]=V[8]/A[8],U}divide(N){return this.divideToRef(N,new n)}addToRef(N,U){const V=this.ni,A=N.m,t=U.m;return t[0]=V[0]+A[0],t[1]=V[1]+A[1],t[2]=V[2]+A[2],t[3]=V[3]+A[3],t[4]=V[4]+A[4],t[5]=V[5]+A[5],t[6]=V[6]+A[6],t[7]=V[7]+A[7],t[8]=V[8]+A[8],U}add(N){return this.addToRef(N,new n)}subtractToRef(N,U){const V=this.ni,A=N.m,t=U.m;return t[0]=V[0]-A[0],t[1]=V[1]-A[1],t[2]=V[2]-A[2],t[3]=V[3]-A[3],t[4]=V[4]-A[4],t[5]=V[5]-A[5],t[6]=V[6]-A[6],t[7]=V[7]-A[7],t[8]=V[8]-A[8],U}xU(N){return this.subtractToRef(N,new n)}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<9;U++)N[U]=this.ni[U];return N}pi(){return this.toArray()}BV(N){for(let U=0;U<9;U++)this.ni[U]=N[U];return this}transpose(){const N=this.ni;return new n([N[0],N[3],N[6],N[1],N[4],N[7],N[2],N[5],N[8]])}determinant(){const N=this.ni;return N[0]*(N[4]*N[8]-N[5]*N[7])-N[1]*(N[3]*N[8]-N[5]*N[6])+N[2]*(N[3]*N[7]-N[4]*N[6])}inverse(){const N=this.determinant();if(0===N)throw new Error("Matrix is not invertible");const U=this.ni,V=1/N;return new n([(U[4]*U[8]-U[5]*U[7])*V,(U[2]*U[7]-U[1]*U[8])*V,(U[1]*U[5]-U[2]*U[4])*V,(U[5]*U[6]-U[3]*U[8])*V,(U[0]*U[8]-U[2]*U[6])*V,(U[2]*U[3]-U[0]*U[5])*V,(U[3]*U[7]-U[4]*U[6])*V,(U[1]*U[6]-U[0]*U[7])*V,(U[0]*U[4]-U[1]*U[3])*V])}equals(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=this.ni,A=N.m;return 0===U?V[0]===A[0]&&V[1]===A[1]&&V[2]===A[2]&&V[3]===A[3]&&V[4]===A[4]&&V[5]===A[5]&&V[6]===A[6]&&V[7]===A[7]&&V[8]===A[8]:Math.abs(V[0]-A[0])<U&&Math.abs(V[1]-A[1])<U&&Math.abs(V[2]-A[2])<U&&Math.abs(V[3]-A[3])<U&&Math.abs(V[4]-A[4])<U&&Math.abs(V[5]-A[5])<U&&Math.abs(V[6]-A[6])<U&&Math.abs(V[7]-A[7])<U&&Math.abs(V[8]-A[8])<U}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ni.join(", ")})`}}},14047:(N,U,V)=>{"use strict";var A;function t(N,U,V,A){switch(U){case"Animation":return A?N.animations.find((N=>N.uniqueId===V))??null:N.animations[V]??null;case"AnimationGroup":return A?N.animationGroups.find((N=>N.uniqueId===V))??null:N.animationGroups[V]??null;case"Mesh":return A?N.meshes.find((N=>N.uniqueId===V))??null:N.meshes[V]??null;case"Material":return A?N.materials.find((N=>N.uniqueId===V))??null:N.materials[V]??null;case"BE":return A?N.cameras.find((N=>N.uniqueId===V))??null:N.cameras[V]??null;case"Light":return A?N.lights.find((N=>N.uniqueId===V))??null:N.lights[V]??null;default:return null}}V.d(U,{b:()=>t}),function(N){N.Animation="Animation",N.AnimationGroup="AnimationGroup",N.Mesh="Mesh",N.Material="Material",N.BE="BE",N.Light="Light"}(A||(A={}))},14085:(N,U,V)=>{"use strict";V.d(U,{c:()=>t});var A=V(14094);class t extends A.b{constructor(N,U){if(super(N),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),U)for(const V of U)this._eventsSignalOutputs[V]=this._registerSignalOutput(V+"Event")}_executeOnTick(N){}_startPendingTasks(N){N._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(N),this._resetAfterCanceled(N)),this._preparePendingTasks(N),N._addPendingBlock(this),this.out._activateSignal(N),N._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(N){N._deleteExecutionVariable(this,"_initialized"),N._removePendingBlock(this)}}},14058:(N,U,V)=>{"use strict";V.d(U,{c:()=>S});var A=V(12351),t=V(12344),n=V(14062),q=V(12182),i=V(14026);class z extends n.b{constructor(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.defaultValue,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(N,U,V),this.richType=A,this._defaultValue=t,this._optional=n,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new q.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(N){this._isDisabled!==N&&(this._isDisabled=N,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(N,U){U._getConnectionValue(this)!==N&&(U._setConnectionValue(this,N),this.onValueChangedObservable.notifyObservers(N))}resetToDefaultValue(N){N._setConnectionValue(this,this._defaultValue)}connectTo(N){this._isDisabled||super.connectTo(N)}_getValueOrDefault(N){const U=N._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(N){if(1===this.connectionType){N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(N);const U=this._getValueOrDefault(N);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}const U=this.isConnected()?this._connectedPoint[0].getValue(N):this._getValueOrDefault(N);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.richType={},this.richType.serialize(N.richType),N.optional=this._optional,(0,i.g)("defaultValue",this._defaultValue,N)}}(0,t.e)("FlowGraphDataConnection",z);class S{constructor(N){var U;this.config=N,this.uniqueId=(0,A.b)(),this.name=(null===(U=this.config)||void 0===U?void 0:U.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(N){}registerDataInput(N,U,V){const A=new z(N,0,this,U,V);return this.dataInputs.push(A),A}registerDataOutput(N,U,V){const A=new z(N,1,this,U,V);return this.dataOutputs.push(A),A}getDataInput(N){return this.dataInputs.find((U=>U.name===N))}getDataOutput(N){return this.dataOutputs.find((U=>U.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.g;if(N.uniqueId=this.uniqueId,N.config={},this.config){const V=this.config,A=Object.keys(V);for(const t of A)U(t,V[t],N.config)}N.dataInputs=[],N.dataOutputs=[],N.className=this.getClassName();for(const V of this.dataInputs){const U={};V.serialize(U),N.dataInputs.push(U)}for(const V of this.dataOutputs){const U={};V.serialize(U),N.dataOutputs.push(U)}}deserialize(N){}_log(N,U,V){var A;null===(A=N.logger)||void 0===A||A.addLogItem({action:U,CV:V,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14062:(N,U,V)=>{"use strict";V.d(U,{b:()=>n});var A,t=V(12351);!function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(A||(A={}));class n{constructor(N,U,V){this._ownerBlock=V,this._connectedPoint=[],this.uniqueId=(0,t.b)(),this.connectedPointIds=[],this.name=N,this._connectionType=U}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(N){if(this._connectionType===N._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||N._isSingularConnection()&&N._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(N),N._connectedPoint.push(this)}disconnectFrom(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=this._connectedPoint.indexOf(N),A=N._connectedPoint.indexOf(this);-1!==V&&-1!==A&&(U&&this._connectedPoint.splice(V,1),N._connectedPoint.splice(A,1))}disconnectFromAll(){for(const N of this._connectedPoint)this.disconnectFrom(N,!1);this._connectedPoint.length=0}dispose(){for(const N of this._connectedPoint)this.disconnectFrom(N)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.name=this.name,N._connectionType=this._connectionType,N.connectedPointIds=[],N.className=this.getClassName();for(const U of this._connectedPoint)N.connectedPointIds.push(U.uniqueId)}getClassName(){return"FGConnection"}deserialize(N){this.uniqueId=N.uniqueId,this.name=N.name,this._connectionType=N._connectionType,this.connectedPointIds=N.connectedPointIds}}},14022:(N,U,V)=>{"use strict";V.d(U,{c:()=>v});var A,t=V(12182),n=V(12367),q=V(12369),i=V(12351),z=V(14026),S=V(14047),E=V(12193);!function(N){N.ExecuteBlock="ExecuteBlock",N.ExecuteEvent="ExecuteEvent",N.TriggerConnection="TriggerConnection",N.ContextVariableSet="ContextVariableSet",N.GlobalVariableSet="GlobalVariableSet",N.GlobalVariableDelete="GlobalVariableDelete",N.GlobalVariableGet="GlobalVariableGet",N.AddConnection="AddConnection",N.GetConnectionValue="GetConnectionValue",N.SetConnectionValue="SetConnectionValue",N.ActivateSignal="ActivateSignal",N.ContextVariableGet="ContextVariableGet"}(A||(A={}));class p{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(N){if(N.time||(N.time=Date.now()),this.log.push(N),this.logToConsole){var U;const V=null===(U=N.CV)||void 0===U?void 0:U.value;"object"===typeof V&&V.getClassName?E.b.Log(`[FGLog] ${N.className}:${N.uniqueId.split("-")[0]} ${N.action} - ${JSON.stringify(V.getClassName())}: ${V.toString()}`):E.b.Log(`[FGLog] ${N.className}:${N.uniqueId.split("-")[0]} ${N.action} - ${JSON.stringify(N.CV)}`)}}getItemsOfType(N){return this.log.filter((U=>U.action===N))}}class k{get enableLogging(){return this._enableLogging}set enableLogging(N){this._enableLogging!==N&&(this._enableLogging=N,this._enableLogging?(this.logger=new p,this.logger.logToConsole=!0):this.logger=null)}constructor(N){this.uniqueId=(0,i.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new t.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=N,this.assetsContext=N.assetsContext??N.JU}hasVariable(N){return N in this._userVariables}setVariable(N,U){var V;this._userVariables[N]=U,null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",CV:{name:N,value:U}})}getAsset(N,U){return(0,S.b)(this.assetsContext,N,U)}getVariable(N){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",CV:{name:N,value:this._userVariables[N]}}),this._userVariables[N]}get userVariables(){return this._userVariables}YN(){return this._configuration.JU}_getUniqueIdPrefixedName(N,U){return`${N.uniqueId}_${U}`}_getGlobalContextVariable(N,U){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",CV:{name:N,defaultValue:U,possibleValue:this._globalContextVariables[N]}}),this._hasGlobalContextVariable(N)?this._globalContextVariables[N]:U}_setGlobalContextVariable(N,U){var V;null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",CV:{name:N,value:U}}),this._globalContextVariables[N]=U}_deleteGlobalContextVariable(N){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",CV:{name:N}}),delete this._globalContextVariables[N]}_hasGlobalContextVariable(N){return N in this._globalContextVariables}_setExecutionVariable(N,U,V){this._executionVariables[this._getUniqueIdPrefixedName(N,U)]=V}_getExecutionVariable(N,U,V){return this._hasExecutionVariable(N,U)?this._executionVariables[this._getUniqueIdPrefixedName(N,U)]:V}_deleteExecutionVariable(N,U){delete this._executionVariables[this._getUniqueIdPrefixedName(N,U)]}_hasExecutionVariable(N,U){return this._getUniqueIdPrefixedName(N,U)in this._executionVariables}_hasConnectionValue(N){return N.uniqueId in this._connectionValues}_setConnectionValue(N,U){var V;this._connectionValues[N.uniqueId]=U,null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",CV:{connectionPointId:N.uniqueId,value:U}})}_setConnectionValueByKey(N,U){this._connectionValues[N]=U}_getConnectionValue(N){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",CV:{connectionPointId:N.uniqueId,value:this._connectionValues[N.uniqueId]}}),this._connectionValues[N.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(N){this._pendingBlocks.includes(N)||(this._pendingBlocks.push(N),this._pendingBlocks.sort(((N,U)=>N.priority-U.priority)))}_removePendingBlock(N){const U=this._pendingBlocks.indexOf(N);-1!==U&&this._pendingBlocks.splice(U,1)}_clearPendingBlocks(){for(const N of this._pendingBlocks)N._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(N){var U;this.onNodeExecutedObservable.notifyObservers(N),null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:N.getClassName(),uniqueId:N.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(N){this._setGlobalContextVariable("timeSinceStart",N.timeSinceStart),this._setGlobalContextVariable("deltaTime",N.deltaTime);for(const V of this._pendingBlocks){var U;null===(U=V._executeOnTick)||void 0===U||U.call(V,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.g;N.uniqueId=this.uniqueId,N._userVariables={};for(const A in this._userVariables)U(A,this._userVariables[A],N._userVariables);N._connectionValues={};for(const A in this._connectionValues)U(A,this._connectionValues[A],N._connectionValues);var V;this.assetsContext!==this.YN()&&(N._assetsContext={meshes:this.assetsContext.meshes.map((N=>N.id)),materials:this.assetsContext.materials.map((N=>N.id)),textures:this.assetsContext.textures.map((N=>N.name)),animations:this.assetsContext.animations.map((N=>N.name)),lights:this.assetsContext.lights.map((N=>N.id)),cameras:this.assetsContext.cameras.map((N=>N.id)),Qk:null===(V=this.assetsContext.Qk)||void 0===V?void 0:V.map((N=>N.name)),skeletons:this.assetsContext.skeletons.map((N=>N.id)),yp:this.assetsContext.yp.map((N=>N.name)),geometries:this.assetsContext.geometries.map((N=>N.id)),multiMaterials:this.assetsContext.multiMaterials.map((N=>N.id)),transformNodes:this.assetsContext.transformNodes.map((N=>N.id))})}getClassName(){return"FlowGraphContext"}}(0,n.b)([(0,q.N)()],k.prototype,"uniqueId",void 0);var B=V(14051),C=V(12624);class x{constructor(N){this.onEventTriggeredObservable=new t.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=N,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ai.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const N=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",CV:{timeSinceStart:this._startingTime,deltaTime:N}}),this._startingTime+=N})),this._meshPickedObserver=this._scene.onPointerObservable.add((N=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",CV:N})}),C.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((N=>{const U=N.pointerId,V=N.mesh,A=this._pointerUnderMeshState[U];!A&&V?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",CV:{pointerId:U,mesh:V}}):A&&!V?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",CV:{pointerId:U,mesh:A}}):A&&V&&A!==V&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",CV:{pointerId:U,mesh:A,over:V}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",CV:{pointerId:U,mesh:V,out:A}})),this._pointerUnderMeshState[U]=V}),C.b.POINTERMOVE)}dispose(){var N,U,V,A,t;null===(N=this._sceneDisposeObserver)||void 0===N||N.remove(),null===(U=this._sceneReadyObserver)||void 0===U||U.remove(),null===(V=this._sceneOnBeforeRenderObserver)||void 0===V||V.remove(),null===(A=this._meshPickedObserver)||void 0===A||A.remove(),null===(t=this._meshUnderPointerObserver)||void 0===t||t.remove(),this.onEventTriggeredObservable.clear()}}var J,d=V(14069);!function(N){N[N.Stopped=0]="Stopped",N[N.Started=1]="Started"}(J||(J={}));class r{get state(){return this._state}set state(N){this._state=N,this.onStateChangedObservable.notifyObservers(N)}constructor(N){this.onStateChangedObservable=new t.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=N.JU,this._sceneEventCoordinator=new x(this._scene),this._coordinator=N.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((N=>{for(const U of this._executionContexts){const V=this._getContextualOrder(N.type,U);for(const A of V)if(!A._executeEvent(U,N.CV))break}switch(N.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const U of this._executionContexts)U._notifyOnTick(N.CV);break;case"SceneDispose":this.dispose()}}))}createContext(){const N=new k({JU:this._scene,coordinator:this._coordinator});return this._executionContexts.push(N),N}getContext(N){return this._executionContexts[N]}addEventBlock(N){if("PointerOver"!==N.type&&"PointerOut"!==N.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==N.type&&this._eventBlocks[N.type].push(N),1===this.state)for(const U of this._executionContexts)N._startPendingTasks(U);else this.onStateChangedObservable.addOnce((U=>{if(1===U)for(const V of this._executionContexts)N._startPendingTasks(V)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((N=>{1===N&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const N of this._executionContexts)for(const U in this._eventBlocks){const V=this._getContextualOrder(U,N);for(const U of V)U._startPendingTasks(N)}}_getContextualOrder(N,U){const V=this._eventBlocks[N].sort(((N,U)=>U.initPriority-N.initPriority));if("MeshPick"===N){const N=[];for(const A of V){const t=A.asset.getValue(U);let n=0;for(;n<V.length;n++){const N=V[n].asset.getValue(U);if(t&&N&&(0,d.p)(t,N))break}N.splice(n,0,A)}return N}return V}dispose(){var N;if(0!==this.state){this.state=0;for(const N of this._executionContexts)N._clearPendingBlocks();this._executionContexts.length=0;for(const N in this._eventBlocks)this._eventBlocks[N].length=0;null===(N=this._eventObserver)||void 0===N||N.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(N){const U=[],V=new Set;for(const A in this._eventBlocks)for(const N of this._eventBlocks[A])U.push(N),V.add(N.uniqueId);for(;U.length>0;){const A=U.pop();N(A);for(const N of A.dataInputs)for(const A of N._connectedPoint)V.has(A._ownerBlock.uniqueId)||(U.push(A._ownerBlock),V.add(A._ownerBlock.uniqueId));if(A instanceof B.b)for(const N of A.signalOutputs)for(const A of N._connectedPoint)V.has(A._ownerBlock.uniqueId)||(U.push(A._ownerBlock),V.add(A._ownerBlock.uniqueId))}}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1?arguments[1]:void 0;N.allBlocks=[],this.visitAllBlocks((U=>{const V={};U.serialize(V),N.allBlocks.push(V)})),N.executionContexts=[];for(const V of this._executionContexts){const A={};V.serialize(A,U),N.executionContexts.push(A)}}}class v{constructor(N){this.config=N,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.JU.Ai.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.JU.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const N=this._executeOnNextFrame.slice(0);if(N.length)for(const U of N){this.notifyCustomEvent(U.id,U.data,!1);const N=this._executeOnNextFrame.findIndex((N=>N.uniqueId===U.uniqueId));-1!==N&&this._executeOnNextFrame.splice(N,1)}}));(v.SceneCoordinators.get(this.config.JU)??[]).push(this)}createGraph(){const N=new r({JU:this.config.JU,coordinator:this});return this._flowGraphs.push(N),N}removeGraph(N){const U=this._flowGraphs.indexOf(N);-1!==U&&(N.dispose(),this._flowGraphs.splice(U,1))}start(){for(const N of this._flowGraphs)N.start()}dispose(){var N,U;for(const t of this._flowGraphs)t.dispose();this._flowGraphs.length=0,null===(N=this._disposeObserver)||void 0===N||N.remove(),null===(U=this._onBeforeRenderObserver)||void 0===U||U.remove();const V=v.SceneCoordinators.get(this.config.JU)??[],A=V.indexOf(this);-1!==A&&V.splice(A,1)}serialize(N,U){N._flowGraphs=[];for(const V of this._flowGraphs){const A={};V.serialize(A,U),N._flowGraphs.push(A)}N.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(N){let U=this._customEventsMap.get(N);return U||(U=new t.d,this._customEventsMap.set(N,U)),U}notifyCustomEvent(N,U){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:N,data:U,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(N)){const U=this._eventExecutionCounter.get(N);if(this._eventExecutionCounter.set(N,U+1),U>=v.MaxEventTypeExecutionPerFrame)return void(U===v.MaxEventTypeExecutionPerFrame&&E.b.Warn(`FlowGraphCoordinator: Too many executions of event "${N}".`))}else this._eventExecutionCounter.set(N,1);const V=this._customEventsMap.get(N);V&&V.notifyObservers(U)}}v.MaxEventsPerType=30,v.MaxEventTypeExecutionPerFrame=30,v.SceneCoordinators=new Map},14078:(N,U,V)=>{"use strict";V.d(U,{e:()=>t});var A=V(14085);class t extends A.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(N){N._notifyExecuteNode(this),this.done._activateSignal(N)}}},14051:(N,U,V)=>{"use strict";V.d(U,{b:()=>i});var A=V(14058),t=V(14062),n=V(12344);class q extends t.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(N){super.connectTo(N),this._connectedPoint.sort(((N,U)=>U.priority-N.priority))}_activateSignal(N){var U;if(null===(U=N.logger)||void 0===U||U.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,CV:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(N,this),N._increaseExecutionId();else for(const V of this._connectedPoint)V._activateSignal(N)}}(0,n.e)("FlowGraphSignalConnection",q);class i extends A.c{constructor(N){super(N),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(N){const U=new q(N,0,this);return this.signalInputs.push(U),U}_registerSignalOutput(N){const U=new q(N,1,this);return this.signalOutputs.push(U),U}_unregisterSignalInput(N){const U=this.signalInputs.findIndex((U=>U.name===N));-1!==U&&(this.signalInputs[U].dispose(),this.signalInputs.splice(U,1))}_unregisterSignalOutput(N){const U=this.signalOutputs.findIndex((U=>U.name===N));-1!==U&&(this.signalOutputs[U].dispose(),this.signalOutputs.splice(U,1))}_reportError(N,U){this.error.CV="string"===typeof U?new Error(U):U,this.error._activateSignal(N)}getSignalInput(N){return this.signalInputs.find((U=>U.name===N))}getSignalOutput(N){return this.signalOutputs.find((U=>U.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.signalInputs=[],N.signalOutputs=[];for(const U of this.signalInputs){const V={};U.serialize(V),N.signalInputs.push(V)}for(const U of this.signalOutputs){const V={};U.serialize(V),N.signalOutputs.push(V)}}deserialize(N){for(let U=0;U<N.signalInputs.length;U++){const V=this.getSignalInput(N.signalInputs[U].name);if(!V)throw new Error("Could not find signal input with name "+N.signalInputs[U].name+" in block "+N.className);V.deserialize(N.signalInputs[U])}for(let U=0;U<N.signalOutputs.length;U++){const V=this.getSignalOutput(N.signalOutputs[U].name);if(!V)throw new Error("Could not find signal output with name "+N.signalOutputs[U].name+" in block "+N.className);V.deserialize(N.signalOutputs[U])}}getClassName(){return"FlowGraphExecutionBlock"}}},14094:(N,U,V)=>{"use strict";V.d(U,{b:()=>t});var A=V(14051);class t extends A.b{constructor(N){super(N),this.out=this._registerSignalOutput("out")}}},14036:(N,U,V)=>{"use strict";V.d(U,{A:()=>s,B:()=>M,F:()=>W,I:()=>Y,b:()=>S,d:()=>k,g:()=>H,i:()=>J,l:()=>d,o:()=>r,p:()=>p,q:()=>c,t:()=>E,w:()=>B,y:()=>C,z:()=>x});var A,t=V(12383),n=V(12426),q=V(14031),i=V(14045);!function(N){N.Any="any",N.String="string",N.Number="number",N.Boolean="boolean",N.Object="object",N.Integer="FlowGraphInteger",N.Vector2="Vector2",N.CU="CU",N.Vector4="Vector4",N.Quaternion="Quaternion",N.Matrix="Matrix",N.Matrix2D="Matrix2D",N.Matrix3D="Matrix3D",N.rU="rU",N.Yi="Yi"}(A||(A={}));class z{constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=N,this.defaultValue=U,this.animationType=V}serialize(N){N.typeName=this.typeName,N.defaultValue=this.defaultValue}}const S=new z("any",void 0),E=new z("string",""),p=new z("number",0,0),k=new z("boolean",!1),B=new z("Vector2",t.Vector2.Zero(),5),C=new z("CU",t.CU.Zero(),1),x=new z("Vector4",t.Vector4.Zero()),J=new z("Matrix",t.Matrix.Identity(),3),d=new z("Matrix2D",new i.c),r=new z("Matrix3D",new i.d),v=new z("rU",n.rU.Black(),4),h=new z("Yi",new n.Yi(0,0,0,0),7),c=new z("Quaternion",t.Quaternion.Identity(),2);c.typeTransformer=N=>{if(N.getClassName){if("Vector4"===N.getClassName())return t.Quaternion.vU(N.pi());if("CU"===N.getClassName())return t.Quaternion.FromEulerVector(N);if("Matrix"===N.getClassName())return t.Quaternion.FromRotationMatrix(N)}return N};const H=new z("FlowGraphInteger",new q.b(0),0);function Y(N){const U=N;switch(typeof N){case"string":return E;case"number":return p;case"boolean":return k;case"object":if(U.getClassName)switch(U.getClassName()){case"Vector2":return B;case"CU":return C;case"Vector4":return x;case"Matrix":return J;case"rU":return v;case"Yi":return h;case"Quaternion":return c;case"FlowGraphInteger":return H;case"Matrix2D":return d;case"Matrix3D":return r}return S;default:return S}}function W(N){switch(N){case"string":return E;case"number":return p;case"boolean":return k;case"Vector2":return B;case"CU":return C;case"Vector4":return x;case"Matrix":return J;case"rU":return v;case"Yi":return h;case"Quaternion":return c;case"FlowGraphInteger":return H;case"Matrix2D":return d;case"Matrix3D":return r;default:return S}}function s(N){switch(N){case"number":default:return 0;case"Vector2":return 5;case"CU":return 1;case"Matrix":return 3;case"rU":return 4;case"Yi":return 7;case"Quaternion":return 2}}function M(N){switch(N){case 0:return p;case 5:return B;case 1:return C;case 3:return J;case 4:return v;case 7:return h;case 2:return c;default:return S}}},14026:(N,U,V)=>{"use strict";V.d(U,{c:()=>E,g:()=>S,h:()=>p});var A=V(12426),t=V(12383),n=V(14031),q=V(14036),i=V(14045);function z(N){return"Vector2"===N||"CU"===N||"Vector4"===N||"Quaternion"===N||"rU"===N||"Yi"===N}function S(N,U,V){var A;const t=(null===U||void 0===U||null===(A=U.getClassName)||void 0===A?void 0:A.call(U))??"";if(z(t)||function(N){return"Matrix"===N||"Matrix2D"===N||"Matrix3D"===N}(t))V[N]={value:U.pi(),className:t};else if("FlowGraphInteger"===t)V[N]={value:U.value,className:t};else if(t&&(U.id||U.name))V[N]={id:U.id,name:U.name,className:t};else{if("object"===typeof U)throw new Error(`Could not serialize value ${U}`);V[N]=U}}function E(N,U,V,S){const p=U[N];let k;const B=(null===p||void 0===p?void 0:p.type)??(null===p||void 0===p?void 0:p.className);if(function(N){return"Mesh"===N||"AbstractMesh"===N||"GroundMesh"===N||"InstanceMesh"===N||"LinesMesh"===N||"GoldbergMesh"===N||"GreasedLineMesh"===N||"TrailMesh"===N}(B)){let N=S.meshes.filter((N=>p.id?N.id===p.id:N.name===p.name));0===N.length&&(N=S.transformNodes.filter((N=>p.id?N.id===p.id:N.name===p.name))),k=p.uniqueId?N.find((N=>N.uniqueId===p.uniqueId)):N[0]}else if(z(B))k=function(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===N)return t.Vector2.vU(U);if("CU"===N)return V&&(U[2]*=-1),t.CU.vU(U);if("Vector4"===N)return t.Vector4.vU(U);if("Quaternion"===N)return V&&(U[2]*=-1,U[3]*=-1),t.Quaternion.vU(U);if("rU"===N)return new A.rU(U[0],U[1],U[2]);if("Yi"===N)return new A.Yi(U[0],U[1],U[2],U[3]);throw new Error(`Unknown vector class name ${N}`)}(B,p.value);else if(function(N){return"AnimationGroup"===N}(B)){const N=S.animationGroups.filter((N=>N.name===p.name));k=1===N.length?N[0]:N.find((N=>N.uniqueId===p.uniqueId))}else k="Matrix"===B?t.Matrix.vU(p.value):"Matrix2D"===B?new i.c(p.value):"Matrix3D"===B?new i.d(p.value):"FlowGraphInteger"===B?n.b.FromValue(p.value):"number"===B||"string"===B||"boolean"===B?p.value[0]:p&&void 0!==p.value?p.value:Array.isArray(p)?p.reduce(((N,U)=>U.eventData?(N[U.id]={type:(0,q.F)(U.type)},"undefined"!==typeof U.value&&(N[U.id].value=E("value",U,V,S)),N):N),{}):p;return k}function p(N){return"FlowGraphJsonPointerParserBlock"===N}},14069:(N,U,V)=>{"use strict";function A(N,U){return!(!N.parent||N.parent!==U&&!A(N.parent,U))}function t(N){if(N.getClassName)return N.getClassName()}function n(N,U){return N===U&&("Vector2"===N||"CU"===N||"Vector4"===N||"Quaternion"===N)}function q(N,U){return N===U&&("Matrix"===N||"Matrix2D"===N||"Matrix3D"===N)}function i(N,U){return"FlowGraphInteger"===N&&"FlowGraphInteger"===U}function z(N,U){const V="number"===typeof N||"number"===typeof(null===N||void 0===N?void 0:N.value);return V&&!U?!isNaN(S(N)):V}function S(N){return"number"===typeof N?N:N.value}V.d(U,{c:()=>i,e:()=>q,i:()=>n,m:()=>t,p:()=>A,s:()=>S,t:()=>z})},13442:(N,U,V)=>{"use strict";V.r(U),V.d(U,{SceneInstrumentation:()=>n});var A=V(12179),t=V(12579);class n{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(N){N!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=N,N?(this._onBeforeActiveMeshesEvaluationObserver=this.JU.onBeforeActiveMeshesEvaluationObservable.add((()=>{A.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.JU.onAfterActiveMeshesEvaluationObservable.add((()=>{A.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.JU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.JU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(N){N!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=N,N?(this._onBeforeRenderTargetsRenderObserver=this.JU.onBeforeRenderTargetsRenderObservable.add((()=>{A.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.JU.onAfterRenderTargetsRenderObservable.add((()=>{A.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.JU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.JU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(N){N!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=N,N?(this._onBeforeParticlesRenderingObserver=this.JU.onBeforeParticlesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.JU.onAfterParticlesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.JU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.JU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(N){N!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=N,this.JU.spriteManagers&&(N?(this._onBeforeSpritesRenderingObserver=this.JU.onBeforeSpritesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.JU.onAfterSpritesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.JU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.JU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(N){N!==this._capturePhysicsTime&&this.JU.onBeforePhysicsObservable&&(this._capturePhysicsTime=N,N?(this._onBeforePhysicsObserver=this.JU.onBeforePhysicsObservable.add((()=>{A.Tools.StartPerformanceCounter("jC"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.JU.onAfterPhysicsObservable.add((()=>{A.Tools.EndPerformanceCounter("jC"),this._physicsTime.endMonitoring()}))):(this.JU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.JU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(N){N!==this._captureAnimationsTime&&(this._captureAnimationsTime=N,N?this._onAfterAnimationsObserver=this.JU.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.JU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(N){this._captureFrameTime=N}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(N){this._captureInterFrameTime=N}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(N){N!==this._captureRenderTime&&(this._captureRenderTime=N,N?(this._onBeforeDrawPhaseObserver=this.JU.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),A.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.JU.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter("Main render")}))):(this.JU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.JU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(N){N!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=N,N?(this._onBeforeCameraRenderObserver=this.JU.onBeforeCameraRenderObservable.add((N=>{this._cameraRenderTime.beginMonitoring(),A.Tools.StartPerformanceCounter(`Rendering camera ${N.name}`)})),this._onAfterCameraRenderObserver=this.JU.onAfterCameraRenderObservable.add((N=>{this._cameraRenderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter(`Rendering camera ${N.name}`)}))):(this.JU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.JU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.JU.getEngine()._drawCalls}constructor(N){this.JU=N,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new t.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new t.d,this._captureFrameTime=!1,this._frameTime=new t.d,this._captureRenderTime=!1,this._renderTime=new t.d,this._captureInterFrameTime=!1,this._interFrameTime=new t.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new t.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new t.d,this._capturePhysicsTime=!1,this._physicsTime=new t.d,this._captureAnimationsTime=!1,this._animationsTime=new t.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new t.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=N.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(A.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.JU.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=N.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(A.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.eq(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.eq(),this._captureParticlesRenderTime&&this._particlesRenderTime.eq(),this._captureSpritesRenderTime&&this._spritesRenderTime.eq(),this._captureRenderTime&&this._renderTime.eq(),this._captureCameraRenderTime&&this._cameraRenderTime.eq()}))}dispose(){this._disposed||(this.JU.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.JU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.JU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.JU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.JU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.JU.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.JU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.JU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.JU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.JU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.JU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.JU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.JU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.JU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.JU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.JU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.JU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.JU=null,this._disposed=!0)}}},14018:(N,U,V)=>{"use strict";V.d(U,{c:()=>E});var A=V(12367),t=V(12369),n=V(12383),q=V(12764),i=V(12895),z=V(12942),S=V(12344);q.c.AddNodeConstructor("Light_Type_1",((N,U)=>()=>new E(N,n.CU.Zero(),U)));class E extends z.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(N){this._shadowFrustumSize=N,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(N){this._shadowOrthoScale=N,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(N){this._orthoLeft=N}get orthoRight(){return this._orthoRight}set orthoRight(N){this._orthoRight=N}get orthoTop(){return this._orthoTop}set orthoTop(N){this._orthoTop=N}get orthoBottom(){return this._orthoBottom}set orthoBottom(N){this._orthoBottom=N}constructor(N,U,V){super(N,V),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=U.scale(-1),this.direction=U}getClassName(){return"FC"}getTypeID(){return i.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(N,U,V){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(N):this._setDefaultAutoExtendShadowProjectionMatrix(N,U,V)}_setDefaultFixedFrustumShadowProjectionMatrix(N){const U=this.YN().activeCamera;U&&n.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:U.Bi,void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,N,this.YN().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(N,U,V){const A=this.YN().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const N=n.CU.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let A=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let q=0;q<V.length;q++){const i=V[q];if(!i)continue;const z=i.getBoundingInfo().boundingBox;for(let V=0;V<z.vectorsWorld.length;V++)n.CU.TransformCoordinatesToRef(z.vectorsWorld[V],U,N),N.x<this._orthoLeft&&(this._orthoLeft=N.x),N.y<this._orthoBottom&&(this._orthoBottom=N.y),N.x>this._orthoRight&&(this._orthoRight=N.x),N.y>this._orthoTop&&(this._orthoTop=N.y),this.autoCalcShadowZBounds&&(N.z<A&&(A=N.z),N.z>t&&(t=N.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=A,this._shadowMaxZ=t)}const t=this._orthoRight-this._orthoLeft,q=this._orthoTop-this._orthoBottom,i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.Bi)||0,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)||1e4,S=this.YN().getEngine().ln;n.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-t*this.shadowOrthoScale,this._orthoRight+t*this.shadowOrthoScale,this._orthoBottom-q*this.shadowOrthoScale,this._orthoTop+q*this.shadowOrthoScale,S?z:i,S?i:z,N,this.YN().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,U){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,U),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,U),this)}transferToNodeMaterialEffect(N,U){return this.computeTransformedInformation()?(N.setFloat3(U,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(N.setFloat3(U,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(N){const U=this._scene.getEngine();return!U.ln&&U.isNDCHalfZRange?0:1}getDepthMaxZ(N){const U=this._scene.getEngine();return U.ln&&U.isNDCHalfZRange?0:1}prepareLightSpecificDefines(N,U){N["DIRLIGHT"+U]=!0}}(0,A.b)([(0,t.N)()],E.prototype,"shadowFrustumSize",null),(0,A.b)([(0,t.N)()],E.prototype,"shadowOrthoScale",null),(0,A.b)([(0,t.N)()],E.prototype,"autoUpdateExtends",void 0),(0,A.b)([(0,t.N)()],E.prototype,"autoCalcShadowZBounds",void 0),(0,A.b)([(0,t.N)("orthoLeft")],E.prototype,"_orthoLeft",void 0),(0,A.b)([(0,t.N)("orthoRight")],E.prototype,"_orthoRight",void 0),(0,A.b)([(0,t.N)("orthoTop")],E.prototype,"_orthoTop",void 0),(0,A.b)([(0,t.N)("orthoBottom")],E.prototype,"_orthoBottom",void 0),(0,S.e)("BABYLON.DirectionalLight",E)},14509:(N,U,V)=>{"use strict";V.d(U,{d:()=>E});var A=V(12367),t=V(12369),n=V(12383),q=V(12426),i=V(12764),z=V(12895),S=V(12344);i.c.AddNodeConstructor("Light_Type_3",((N,U)=>()=>new E(N,n.CU.Zero(),U)));class E extends z.e{constructor(N,U,V){super(N,V),this.groundColor=new q.rU(0,0,0),this.direction=U||n.CU.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"PC"}setDirectionToTarget(N){return this.direction=n.CU.Normalize(N.xU(n.CU.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(N,U){const V=n.CU.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",V.x,V.y,V.z,0,U),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Mi),U),this}transferToNodeMaterialEffect(N,U){const V=n.CU.Normalize(this.direction);return N.setFloat3(U,V.x,V.y,V.z),this}xi(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),this._worldMatrix}getTypeID(){return z.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(N,U){N["HEMILIGHT"+U]=!0}}(0,A.b)([(0,t.j)()],E.prototype,"groundColor",void 0),(0,A.b)([(0,t.J)()],E.prototype,"direction",void 0),(0,S.e)("BABYLON.HemisphericLight",E)},13985:(N,U,V)=>{"use strict";V.d(U,{e:()=>p});var A=V(12367),t=V(12369),n=V(12383),q=V(12764),i=V(12895),z=V(12942),S=V(12364),E=V(12344);q.c.AddNodeConstructor("Light_Type_2",((N,U)=>()=>new p(N,n.CU.Zero(),n.CU.Zero(),0,0,U)));class p extends z.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(N){this._iesProfileTexture!==N&&(this._iesProfileTexture=N,this._iesProfileTexture&&p._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(N){this._angle=N,this._cosHalfAngle=Math.cos(.5*N),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(N){this._innerAngle=N,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(N){this._shadowAngleScale=N,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(N){this._projectionTextureLightNear=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(N){this._projectionTextureLightFar=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(N){this._projectionTextureUpDirection=N,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(N){this._projectionTexture!==N&&(this._projectionTexture=N,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(p._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):p._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(N){return void 0!==N.onGeneratedObservable}static _IsTexture(N){return void 0!==N.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(N){this._projectionTextureProjectionLightMatrix=N,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(N,U,V,A,t,q){super(N,q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=n.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=n.CU.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=n.CU.Zero(),this._projectionTextureViewLightMatrix=n.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=n.Matrix.Zero(),this._projectionTextureScalingMatrix=n.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=U,this.direction=V,this.angle=A,this.exponent=t}getClassName(){return"SpotLight"}getTypeID(){return i.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(N){super._setDirection(N),this._projectionTextureViewLightDirty=!0}_setPosition(N){super._setPosition(N),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(N,U,V){const A=this.YN().activeCamera;if(!A)return;this._shadowAngleScale=this._shadowAngleScale||1;const t=this._shadowAngleScale*this._angle,q=void 0!==this.shadowMinZ?this.shadowMinZ:A.Bi,i=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,z=this.YN().getEngine().ln;n.Matrix.PerspectiveFovLHToRef(t,1,z?i:q,z?q:i,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,z)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),n.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const N=this.projectionTextureLightFar,U=this.projectionTextureLightNear,V=N/(N-U),A=-V*U,t=1/Math.tan(this._angle/2);n.Matrix.FromValuesToRef(t/1,0,0,0,0,t,0,0,0,0,V,1,0,0,A,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof S.e){const N=this._projectionTexture.uScale/2,U=this._projectionTexture.vScale/2;n.Matrix.FromValuesToRef(N,0,0,0,0,U,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(N,U){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),N.setMatrix("textureProjectionMatrix"+U,this._projectionTextureMatrix),N.setTexture("projectionLightTexture"+U,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&N.setTexture("iesLightTexture"+U,this._iesProfileTexture),this}transferToEffect(N,U){let V;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,U),V=n.CU.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,U),V=n.CU.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",V.x,V.y,V.z,this._cosHalfAngle,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,U),this}transferToNodeMaterialEffect(N,U){let V;return V=this.computeTransformedInformation()?n.CU.Normalize(this.transformedDirection):n.CU.Normalize(this.direction),this.YN().useRightHandedSystem?N.setFloat3(U,-V.x,-V.y,-V.z):N.setFloat3(U,V.x,V.y,V.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(N){const U=this._scene.getEngine(),V=void 0!==this.shadowMinZ?this.shadowMinZ:(null===N||void 0===N?void 0:N.Bi)??0;return U.ln&&U.isNDCHalfZRange?V:this._scene.getEngine().isNDCHalfZRange?0:V}getDepthMaxZ(N){const U=this._scene.getEngine(),V=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===N||void 0===N?void 0:N.maxZ)??1e4;return U.ln&&U.isNDCHalfZRange?0:V}prepareLightSpecificDefines(N,U){N["SPOTLIGHT"+U]=!0,N["PROJECTEDLIGHTTEXTURE"+U]=!(!this.projectionTexture||!this.projectionTexture.isReady()),N["IESLIGHTTEXTURE"+U]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,A.b)([(0,t.N)()],p.prototype,"angle",null),(0,A.b)([(0,t.N)()],p.prototype,"innerAngle",null),(0,A.b)([(0,t.N)()],p.prototype,"shadowAngleScale",null),(0,A.b)([(0,t.N)()],p.prototype,"exponent",void 0),(0,A.b)([(0,t.N)()],p.prototype,"projectionTextureLightNear",null),(0,A.b)([(0,t.N)()],p.prototype,"projectionTextureLightFar",null),(0,A.b)([(0,t.N)()],p.prototype,"projectionTextureUpDirection",null),(0,A.b)([(0,t.D)("projectedLightTexture")],p.prototype,"_projectionTexture",void 0),(0,E.e)("BABYLON.SpotLight",p)},13721:(N,U,V)=>{"use strict";V.d(U,{b:()=>q,d:()=>n,f:()=>i});const A={},t={};function n(N,U){A[N]=U}function q(N,U){t[N]=U}function i(N){return t[N]?t[N]:null}},13617:(N,U,V)=>{"use strict";V.d(U,{c:()=>Y,g:()=>L});var A,t=V(12179),n=V(12182),q=V(12601),i=V(12223),z=V(12193),S=V(12815),E=V(12232),p=V(12235),k=V(12351),B=V(12272),C=V(12218);!function(N){N[N.Clean=0]="Clean",N[N.Stop=1]="Stop",N[N.Sync=2]="Sync",N[N.NoSync=3]="NoSync"}(A||(A={}));const x=new n.d,J={};let d=!1;function r(){return J[".babylon"]}function v(N,U){const V=J[N];return V||(z.b.Warn("Unable to find a plugin to load "+N+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U?r():void 0)}function h(N,U,V){let A="Unable to load from "+(N.rawData?"binary data":N.url);return U?A+=`: ${U}`:V&&(A+=`: ${V}`),A}async function c(N,U,V,A,t,n,q,i,z){var S;const p="data:"===(k=N.url).substring(0,5)?k.substring(5):null;var k;if(N.rawData&&!q)throw"When using ArrayBufferView to load data the file extension must be provided.";const d=p||q?"":function(N){const U=N.indexOf("?");-1!==U&&(N=N.substring(0,U));const V=N.lastIndexOf(".");return N.substring(V,N.length).toLowerCase()}(N.url);let h=q?v(q,!0):p?function(N){for(const U in J){const V=J[U].plugin;if(V.canDirectLoad&&V.canDirectLoad(N))return J[U]}return r()}(N.url):v(d,!1);if(!h&&d){if(N.url&&!N.url.startsWith("blob:")){const U=await async function(N,U){const V=U.method||"GET";return await new Promise(((A,t)=>{const n=new C.b;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const N={};if(U.responseHeaders)for(const V of U.responseHeaders)N[V]=n.getResponseHeader(V)||"";A({response:n.response,headerValues:N})}else t(`Unable to fetch data from ${N}. Error code: ${n.status}`)})),n.open(V,N),n.send()}))}(N.url,{method:"HEAD",responseHeaders:["Content-Type"]}),V=U.headerValues?U.headerValues["Content-Type"]:"";V&&(h=function(N){for(const U in J){const V=J[U];if(V.mimeType===N)return V}}(V))}h||(h=r())}if(!h)throw new Error(`No plugin or fallback for ${q??N.url}`);if(!1===(null===z||void 0===z||null===(S=z[h.plugin.name])||void 0===S?void 0:S.enabled))throw new Error(`The '${h.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(N.rawData&&!h.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(N=>{if(h.plugin.createPlugin){const U=h.plugin.createPlugin(z??{});return U instanceof Promise?(U.then(N).catch((N=>{t("Error instantiating plugin.",N)})),null):(N(U),U)}return N(h.plugin),h.plugin})((z=>{var S;if(!z)throw`The loader plugin corresponding to the '${q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(x.notifyObservers(z),p&&(z.canDirectLoad&&z.canDirectLoad(N.url)||!(0,E.j)(N.url))){if(z.directLoad){const N=z.directLoad(U,p);N instanceof Promise?N.then((N=>{V(z,N)})).catch((N=>{t("Error in directLoad of _loadData: "+N,N)})):V(z,N)}else V(z,p);return}const k=h.isBinary,C=(N,A)=>{U.S?t("Scene has been disposed"):V(z,N,A)};let J=null,d=!1;null===(S=z.Ai)||void 0===S||S.add((()=>{d=!0,J&&(J.abort(),J=null),n()}));const r=()=>{if(d)return;const V=(N,U)=>{t(null===N||void 0===N?void 0:N.statusText,U)};if(!z.loadFile&&N.rawData)throw"Plugin does not support loading ArrayBufferView.";J=z.loadFile?z.loadFile(U,N.rawData||N.file||N.url,N.rootUrl,C,A,k,V,i):U._loadFile(N.file||N.url,C,A,!0,k,V)},v=U.getEngine();let c=v.enableOfflineSupport;if(c){let V=!1;for(const A of U.disableOfflineSupportExceptionRules)if(A.test(N.url)){V=!0;break}c=!V}c&&B.c.OfflineProviderFactory?U.offlineProvider=B.c.OfflineProviderFactory(N.url,r,v.disableManifestCheck):r()}))}function H(N,U){let V,A,n=null,q=null;if(U)if(U.name)V=`file:${U.name}`,A=U.name,n=U;else if(ArrayBuffer.isView(U))V="",A=(0,k.b)(),q=U;else if(U.startsWith("data:"))V=U,A="";else if(N){const n=U;if("/"===n.substring(0,1))return t.Tools.Error("Wrong sceneFilename parameter"),null;V=N+n,A=n}else V=U,A=t.Tools.GetFilename(U),N=t.Tools.GetFolderPath(U);else V=N,A=t.Tools.GetFilename(N),N=t.Tools.GetFolderPath(N);return{url:V,rootUrl:N,name:A,file:n,rawData:q}}function Y(N){if("string"===typeof N.extensions){const U=N.extensions;J[U.toLowerCase()]={plugin:N,isBinary:!1}}else{const U=N.extensions,V=Object.keys(U);for(const A of V)J[A.toLowerCase()]={plugin:N,isBinary:U[A].isBinary,mimeType:U[A].mimeType}}}async function W(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.e.LastCreatedScene,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!A)return z.b.Error("No scene available to import mesh to"),null;const B=H(U,V);if(!B)return null;const C={};A.addPendingData(C);const x=()=>{A.removePendingData(C)},J=(N,U)=>{const V=h(B,N,U);q?q(A,V,new p.j(V,p.g.SceneLoaderError,U)):z.b.Error(V),x()},d=n?N=>{try{n(N)}catch(U){J("Error in onProgress callback: "+U,U)}}:void 0,r=(N,U,V,n,q,i,z,S)=>{if(A.importedMeshesFiles.push(B.url),t)try{t(N,U,V,n,q,i,z,S)}catch(E){J("Error in onSuccess callback: "+E,E)}A.removePendingData(C)};return await c(B,A,((U,V,t)=>{if(U.rewriteRootURL&&(B.rootUrl=U.rewriteRootURL(B.rootUrl,t)),U.importMesh){const t=[],n=[],q=[];if(!U.importMesh(N,A,V,B.rootUrl,t,n,q,J))return;A.loadingPluginName=U.name,r(t,n,q,[],[],[],[],[])}else{U.importMeshAsync(N,A,V,B.rootUrl,d,B.name).then((N=>{A.loadingPluginName=U.name,r(N.meshes,N.yp,N.skeletons,N.animationGroups,N.transformNodes,N.geometries,N.lights,N.spriteManagers)})).catch((N=>{J(N.message,N)}))}}),d,J,x,S,E,k)}async function s(N,U,V,A,t,n,q,i){return await new Promise(((z,S)=>{try{W(N,U,V,A,((N,U,V,A,t,n,q,i)=>{z({meshes:N,yp:U,skeletons:V,animationGroups:A,transformNodes:t,geometries:n,lights:q,spriteManagers:i})}),t,((N,U,V)=>{S(V||new Error(U))}),n,q,i).catch(S)}catch(p){S(p)}}))}async function M(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.e.LastCreatedEngine,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};V?await mN(N,U,new q.e(V),A,n,z,S,E,p):t.Tools.Error("No engine available")}async function a(N,U,V,A,t,n,q){return await new Promise(((i,z)=>{M(N,U,V,(N=>{i(N)}),A,((N,U,V)=>{z(V||new Error(U))}),t,n,q)}))}async function mN(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.e.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!V)return z.b.Error("No scene available to append to"),null;const B=H(N,U);if(!B)return null;const C={};V.addPendingData(C);const x=()=>{V.removePendingData(C)};S.d.ShowLoadingScreen&&!d&&(d=!0,V.getEngine().displayLoadingUI(),V.executeWhenReady((()=>{V.getEngine().hideLoadingUI(),d=!1})));const J=(N,U)=>{const A=h(B,N,U);n?n(V,A,new p.j(A,p.g.SceneLoaderError,U)):z.b.Error(A),x()},r=t?N=>{try{t(N)}catch(U){J("Error in onProgress callback",U)}}:void 0,v=()=>{if(A)try{A(V)}catch(N){J("Error in onSuccess callback",N)}V.removePendingData(C)};return await c(B,V,((N,U)=>{if(N.load){if(!N.load(V,U,B.rootUrl,J))return;V.loadingPluginName=N.name,v()}else{N.loadAsync(V,U,B.rootUrl,r,B.name).then((()=>{V.loadingPluginName=N.name,v()})).catch((N=>{J(N.message,N)}))}}),r,J,x,q,E,k)}async function w(N,U,V,A,t,n,q){return await new Promise(((i,z)=>{try{mN(N,U,V,(N=>{i(N)}),A,((N,U,V)=>{z(V||new Error(U))}),t,n,q).catch(z)}catch(p){z(p)}}))}async function X(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.e.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!V)return z.b.Error("No scene available to load asset container to"),null;const k=H(N,U);if(!k)return null;const B={};V.addPendingData(B);const C=()=>{V.removePendingData(B)},x=(N,U)=>{const A=h(k,N,U);n?n(V,A,new p.j(A,p.g.SceneLoaderError,U)):z.b.Error(A),C()},J=t?N=>{try{t(N)}catch(U){x("Error in onProgress callback",U)}}:void 0,d=N=>{if(A)try{A(N)}catch(U){x("Error in onSuccess callback",U)}V.removePendingData(B)};return await c(k,V,((N,U)=>{if(N.loadAssetContainer){const A=N.loadAssetContainer(V,U,k.rootUrl,x);if(!A)return;A.populateRootNodes(),V.loadingPluginName=N.name,d(A)}else if(N.loadAssetContainerAsync){N.loadAssetContainerAsync(V,U,k.rootUrl,J,k.name).then((U=>{U.populateRootNodes(),V.loadingPluginName=N.name,d(U)})).catch((N=>{x(N.message,N)}))}else x("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),J,x,C,q,S,E)}async function e(N,U,V,A,t,n,q){return await new Promise(((i,z)=>{try{X(N,U,V,(N=>{i(N)}),A,((N,U,V)=>{z(V||new Error(U))}),t,n,q).catch(z)}catch(p){z(p)}}))}async function Q(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.e.LastCreatedScene,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!V)return void z.b.Error("No scene available to load animations to");if(A){for(const A of V.animatables)A.reset();V.stopAllAnimations();const N=V.animationGroups.slice();for(const V of N)V.dispose();const U=V.getNodes();for(const V of U)V.animations&&(V.animations=[])}else switch(t){case 0:const N=V.animationGroups.slice();for(const U of N)U.dispose();break;case 1:for(const U of V.animationGroups)U.stop();break;case 2:for(const U of V.animationGroups)U.reset(),U.restart();break;case 3:break;default:return void z.b.Error("Unknown animation group loading mode value '"+t+"'")}const C=V.animatables.length;await X(N,U,V,(N=>{N.mergeAnimationsTo(V,V.animatables.slice(C),n),N.dispose(),V.onAnimationFileImportedObservable.notifyObservers(V),q&&q(V)}),S,E,p,k,B)}async function u(N,U,V,A,t,n,q,i,z,S){return await new Promise(((E,k)=>{try{Q(N,U,V,A,t,n,(N=>{E(N)}),q,((N,U,V)=>{k(V||new Error(U))}),i,z,S).catch(k)}catch(p){k(p)}}))}class L{static get ForceFullSceneLoadingForIncremental(){return S.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){S.d.ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return S.d.ShowLoadingScreen}static set ShowLoadingScreen(N){S.d.ShowLoadingScreen=N}static get loggingLevel(){return S.d.loggingLevel}static set loggingLevel(N){S.d.loggingLevel=N}static get CleanBoneMatrixWeights(){return S.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){S.d.CleanBoneMatrixWeights=N}static GetDefaultPlugin(){return r()}static GetPluginForExtension(N){var U;return null===(U=v(N,!0))||void 0===U?void 0:U.plugin}static IsPluginForExtensionAvailable(N){return function(N){return!!J[N]}(N)}static RegisterPlugin(N){Y(N)}static ImportMesh(N,U,V,A,t,n,q,z,S){W(N,U,V,A,t,n,q,z,S).catch((N=>null===q||void 0===q?void 0:q(i.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async ImportMeshAsync(N,U,V,A,t,n,q){return await s(N,U,V,A,t,n,q)}static Load(N,U,V,A,t,n,q,z){M(N,U,V,A,t,n,q,z).catch((N=>null===n||void 0===n?void 0:n(i.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async LoadAsync(N,U,V,A,t,n){return await a(N,U,V,A,t,n)}static Append(N,U,V,A,t,n,q,z){mN(N,U,V,A,t,n,q,z).catch((N=>null===n||void 0===n?void 0:n(V??i.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async AppendAsync(N,U,V,A,t,n){return await w(N,U,V,A,t,n)}static LoadAssetContainer(N,U,V,A,t,n,q,z){X(N,U,V,A,t,n,q,z).catch((N=>null===n||void 0===n?void 0:n(V??i.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async LoadAssetContainerAsync(N,U,V,A,t,n){return await e(N,U,V,A,t,n)}static ImportAnimations(N,U,V,A,t,n,q,z,S,E,p){Q(N,U,V,A,t,n,q,z,S,E,p).catch((N=>null===S||void 0===S?void 0:S(V??i.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async ImportAnimationsAsync(N,U,V,A,t,n,q,i,z,S,E){return await u(N,U,V,A,t,n,i,S,E)}}L.NO_LOGGING=0,L.MINIMAL_LOGGING=1,L.SUMMARY_LOGGING=2,L.DETAILED_LOGGING=3,L.OnPluginActivatedObservable=x},14003:(N,U,V)=>{"use strict";V.d(U,{e:()=>k});var A=V(12367),t=V(12369),n=V(12179),q=V(12383),i=V(12402),z=V(12364),S=V(12344),E=V(12182),p=V(12413);V(14006);class k extends i.b{set boundingBoxSize(N){if(this._boundingBoxSize&&this._boundingBoxSize.equals(N))return;this._boundingBoxSize=N;const U=this.YN();U&&U.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(N){this._rotationY=N,this.setReflectionTextureMatrix(q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(N,U,V){let A="";for(const t of N)A+=t;return new k(A,U,null,V,N)}static CreateFromPrefilteredData(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const n=new k(N,U,null,!1,null,null,null,void 0,!0,V,A);return U.useDelayedTextureLoading=t,n}constructor(N,U){var V;let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d=arguments.length>13?arguments[13]:void 0,r=arguments.length>14?arguments[14]:void 0;super(U),this.onLoadObservable=new E.d,this.boundingBoxPosition=q.CU.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new q.Matrix,this._buffer=null,this.name=N,this.url=N,this._noMipmap=t,this.ki=!1,this.isCube=!0,this._textureMatrix=q.Matrix.Identity(),this.coordinatesMode=z.e.CUBIC_MODE;let v=null,h=null;null===A||Array.isArray(A)?(this._noMipmap=t,this._format=p,this._createPolynomials=C,v=A,this._loaderOptions=d,this._useSRGBBuffer=r,this._lodScale=x,this._lodOffset=J):(v=A.extensions??null,this._noMipmap=A.noMipmap??!1,n=A.files??null,h=A.buffer??null,this._format=A.format??5,k=A.prefiltered??!1,B=A.forcedExtension??null,this._createPolynomials=A.createPolynomials??!1,this._lodScale=A.lodScale??.8,this._lodOffset=A.lodOffset??0,this._loaderOptions=A.loaderOptions,this._useSRGBBuffer=A.useSRGBBuffer,i=A.T??null,S=A.onError??null),(N||n)&&this.updateURL(N,B,i,k,S,v,null===(V=this.YN())||void 0===V?void 0:V.useDelayedTextureLoading,n,h)}getClassName(){return"CubeTexture"}updateURL(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=N),this.url=N,U&&(this._forcedExtension=U);const S=N.lastIndexOf("."),E=U||(S>-1?N.substring(S).toLowerCase():""),p=0===E.indexOf(".dds"),k=0===E.indexOf(".env"),B=0===E.indexOf(".basis");if(k?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=A,A&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),i)this._files=i;else if(B||k||p||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,n){for(let U=0;U<n.length;U++)this._files.push(N+n[U]);this._extensions=n}this._buffer=z,q?(this.delayLoadState=4,this._delayedOnLoad=V,this._delayedOnError=t):this._loadTexture(V,t)}delayLoad(N){4===this.delayLoadState&&(N&&(this._forcedExtension=N),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(N){var U,V;if(N.updateFlag===this._textureMatrix.updateFlag)return;N.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(V=this.YN())||void 0===V||V.markAllMaterialsAsDirty(1,(N=>-1!==N.getActiveTextures().indexOf(this))));if(this._textureMatrix=N,null===(U=this.YN())||void 0===U||!U.useRightHandedSystem)return;const A=q.TmpVectors.CU[0],t=q.TmpVectors.Quaternion[0],n=q.TmpVectors.CU[1];this._textureMatrix.decompose(A,t,n),t.z*=-1,t.w*=-1,q.Matrix.ComposeToRef(A,t,n,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var N;return null!==(N=this.YN())&&void 0!==N&&N.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this.YN(),A=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const t=()=>{var U;(this.onLoadObservable.notifyObservers(this),A)&&(A.dispose(),null===(U=this.YN())||void 0===U||U.markAllMaterialsAsDirty(1));N&&N()},q=(N,V)=>{this._loadingError=!0,this._errorObject={message:N,exception:V},U&&U(N,V),z.e.OnTextureLoadErrorObservable.notifyObservers(this)};var i;this._texture?this._texture.isReady?n.Tools.SetImmediate((()=>t())):this._texture.onLoadedObservable.add((()=>t())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,V,this._lodScale,this._lodOffset,N,q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,V,this._files,this._noMipmap,N,q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(i=this._texture)||void 0===i||i.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(N,U,V){const A=p.d.Parse((()=>{let A=!1;return N.prefiltered&&(A=N.prefiltered),new k(V+(N.url??N.name),U,N.extensions,!1,N.files||null,null,null,void 0,A,N.forcedExtension)}),N,U);if(N.boundingBoxPosition&&(A.boundingBoxPosition=q.CU.vU(N.boundingBoxPosition)),N.boundingBoxSize&&(A.boundingBoxSize=q.CU.vU(N.boundingBoxSize)),N.animations)for(let t=0;t<N.animations.length;t++){const U=N.animations[t],V=(0,S.d)("BABYLON.Animation");V&&A.animations.push(V.Parse(U))}return A}clone(){let N=0;const U=p.d.Clone((()=>{const U=new k(this.url,this.YN()||this._getEngine(),this._extensions,this._noMipmap,this._files);return N=U.uniqueId,U}),this);return U.uniqueId=N,U}}(0,A.b)([(0,t.N)()],k.prototype,"url",void 0),(0,A.b)([(0,t.J)()],k.prototype,"boundingBoxPosition",void 0),(0,A.b)([(0,t.J)()],k.prototype,"boundingBoxSize",null),(0,A.b)([(0,t.N)("rotationY")],k.prototype,"rotationY",null),(0,A.b)([(0,t.N)("files")],k.prototype,"_files",void 0),(0,A.b)([(0,t.N)("forcedExtension")],k.prototype,"_forcedExtension",void 0),(0,A.b)([(0,t.N)("extensions")],k.prototype,"_extensions",void 0),(0,A.b)([(0,t.v)("textureMatrix")],k.prototype,"_textureMatrix",void 0),(0,A.b)([(0,t.v)("textureMatrixRefraction")],k.prototype,"_textureMatrixRefraction",void 0),z.e._CubeTextureParser=k.Parse,(0,S.e)("BABYLON.CubeTexture",k)},14518:(N,U,V)=>{"use strict";V.d(U,{d:()=>z});var A=V(12193),t=V(12364),n=V(12355),q=V(12514),i=V(12319);q.ThinEngine.prototype.createDynamicTexture=function(N,U,V,A){const t=new i.d(this,4);return t.baseWidth=N,t.baseHeight=U,V&&(N=this.needPOTTextures?(0,n.d)(N,this._caps.maxTextureSize):N,U=this.needPOTTextures?(0,n.d)(U,this._caps.maxTextureSize):U),t.width=N,t.height=U,t.isReady=!1,t.generateMipMaps=V,t.samplingMode=A,this.updateTextureSamplingMode(A,t),this._internalTexturesCache.push(t),t},q.ThinEngine.prototype.updateDynamicTexture=function(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!N)return;const q=this._gl,i=q.TEXTURE_2D,z=this._bindTextureDirectly(i,N,!0,n);this._unpackFlipY(void 0===V?N.invertY:V),A&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const S=this._getWebGLTextureType(N.type),E=this._getInternalFormat(t||N.format),p=this._getRGBABufferInternalSizedFormat(N.type,E);q.texImage2D(i,0,p,E,S,U),N.generateMipMaps&&q.generateMipmap(i),z||this._bindTextureDirectly(i,null),A&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t&&(N.format=t),N._dynamicTextureSource=U,N._premulAlpha=A,N.invertY=V||!1,N.isReady=!0};class z extends t.e{constructor(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,i=arguments.length>6?arguments[6]:void 0;const z=!V||V._isScene;super(null,z?V:null===V||void 0===V?void 0:V.JU,z?!A:V,i,n,void 0,void 0,void 0,void 0,q),this.name=N,this.wrapU=t.e.CLAMP_ADDRESSMODE,this.wrapV=t.e.CLAMP_ADDRESSMODE,this._generateMipMaps=A;const S=this._getEngine();if(!S)return;if(U.getContext)this._canvas=U,this._ownCanvas=!1,this._texture=S.createDynamicTexture(this._canvas.width,this._canvas.height,A,n);else{this._canvas=S.createCanvas(1,1),this._ownCanvas=!0;const N=U;N.width||0===N.width?this._texture=S.createDynamicTexture(N.width,N.height,A,n):this._texture=S.createDynamicTexture(U,U,A,n)}const E=this.getSize();this._canvas.width!==E.width&&(this._canvas.width=E.width),this._canvas.height!==E.height&&(this._canvas.height=E.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(N){this._canvas.width=N.width,this._canvas.height=N.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(N.width,N.height,this._generateMipMaps,this.samplingMode)}scale(N){const U=this.getSize();U.width*=N,U.height*=N,this._recreate(U)}scaleTo(N,U){const V=this.getSize();V.width=N,V.height=U,this._recreate(V)}getContext(){return this._context}clear(N){const U=this.getSize();N&&(this._context.fillStyle=N),this._context.clearRect(0,0,U.width,U.height)}update(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===N||N,U,this._format||void 0,void 0,V)}drawText(N,U,V,A,t,n,q){let i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const z=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,z.width,z.height)),this._context.font=A,null===U||void 0===U){const V=this._context.measureText(N);U=(z.width-V.width)/2}if(null===V||void 0===V){const N=parseInt(A.replace(/\D/g,""));V=z.height/2+N/3.65}this._context.fillStyle=t||"",this._context.fillText(N,U,V),i&&this.update(q)}dispose(){var N,U;(super.dispose(),this._ownCanvas)&&(null===(N=this._canvas)||void 0===N||null===(U=N.remove)||void 0===U||U.call(N));this._canvas=null,this._context=null}clone(){const N=this.YN();if(!N)return this;const U=this.getSize(),V=new z(this.name,U,N,this._generateMipMaps);return V.ki=this.ki,V.level=this.level,V.wrapU=this.wrapU,V.wrapV=this.wrapV,V}serialize(){const N=this.YN();N&&!N.isReady()&&A.b.Warn("The scene must be ready before serializing the dynamic texture");const U=super.serialize();return z._IsCanvasElement(this._canvas)&&(U.base64String=this._canvas.toDataURL()),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U}static _IsCanvasElement(N){return void 0!==N.toDataURL}_rebuild(){this.update()}}},13913:(N,U,V)=>{"use strict";V.d(U,{b:()=>t});var A=V(12364);class t extends A.e{get depth(){return this._depth}constructor(N,U,V,t,n,q){let i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:A.e.TRILINEAR_SAMPLINGMODE,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,p=arguments.length>10?arguments[10]:void 0;super(null,q,!i,z),this.format=n,this._texture=q.getEngine().createRawTexture2DArray(N,U,V,t,n,i,z,S,null,E,p),this._depth=t,this.is2DArray=!0}update(N){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,N,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(N,U,V,A,n){return new t(N,U,V,A,5,n,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13743:(N,U,V)=>{"use strict";V.d(U,{d:()=>i,g:()=>z,k:()=>n,m:()=>q});var A=V(12395),t=V(12383);function n(N,U){return`{X: ${N.x.toFixed(U)} Y: ${N.y.toFixed(U)}}`}function q(N,U){return`{X: ${N._x.toFixed(U)} Y: ${N._y.toFixed(U)} Z: ${N._z.toFixed(U)}}`}function i(N,U){return 2*Math.acos((0,A.Clamp)(t.Quaternion.Dot(N,U)))}function z(N,U){const V=new t.Quaternion;return function(N,U,V){const n=t.CU.Cross(N,U),q=Math.acos((0,A.Clamp)(t.CU.Dot(N,U),-1,1));t.Quaternion.RotationAxisToRef(n,q,V)}(N,U,V),V}},13570:(N,U,V)=>{"use strict";V.d(U,{c:()=>S});var A=V(12383),t=V(12426),n=V(12799),q=V(12781),i=V(12436);V(13576);function z(N){let U=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const V=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[];let z=[];const S=N.width||N.size||1,E=N.height||N.size||1,p=N.depth||N.size||1,k=N.wrap||!1;let B=void 0===N.topBaseAt?1:N.topBaseAt,C=void 0===N.bottomBaseAt?0:N.bottomBaseAt;B=(B+4)%4,C=(C+4)%4;let x=[2,0,3,1][B],J=[2,0,1,3][C],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(k){U=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let N=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],V=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const A=[17,18,19,16],t=[22,23,20,21];for(;x>0;)N.unshift(N.pop()),A.unshift(A.pop()),x--;for(;J>0;)V.unshift(V.pop()),t.unshift(t.pop()),J--;N=N.flat(),V=V.flat(),d=d.concat(N).concat(V),U.push(A[0],A[2],A[3],A[0],A[1],A[2]),U.push(t[0],t[2],t[3],t[0],t[1],t[2])}const r=[S/2,E/2,p/2];z=d.reduce(((N,U,V)=>N.concat(U*r[V%3])),[]);const v=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,h=N.faceUV||new Array(6),c=N.faceColors,H=[];for(let q=0;q<6;q++)void 0===h[q]&&(h[q]=new A.Vector4(0,0,1,1)),c&&void 0===c[q]&&(c[q]=new t.Yi(1,1,1,1));for(let A=0;A<6;A++)if(n.push(h[A].z,i.c?1-h[A].w:h[A].w),n.push(h[A].x,i.c?1-h[A].w:h[A].w),n.push(h[A].x,i.c?1-h[A].y:h[A].y),n.push(h[A].z,i.c?1-h[A].y:h[A].y),c)for(let N=0;N<4;N++)H.push(c[A].r,c[A].g,c[A].b,c[A].a);q.c._ComputeSides(v,z,U,V,n,N.frontUVs,N.backUVs);const Y=new q.c;if(Y.indices=U,Y.sN=z,Y.MN=V,Y.mU=n,c){const N=v===q.c.DOUBLESIDE?H.concat(H):H;Y.aN=N}return Y}function S(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new n.b(N,V);U.sideOrientation=n.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return z(U).XN(A,U.updatable),A}q.c.CreateBox=z,n.b.CreateBox=function(N,U){return S(N,{size:U,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13728:(N,U,V)=>{"use strict";V.d(U,{b:()=>i});var A=V(12799),t=V(12781),n=V(12436);function q(N){const U=[],V=[],A=[],q=[],i=N.radius||.5,z=N.tessellation||64,S=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,E=0===N.sideOrientation?0:N.sideOrientation||t.c.DEFAULTSIDE;U.push(0,0,0),q.push(.5,.5);const p=2*Math.PI*S,k=1===S?p/z:p/(z-1);let B=0;for(let t=0;t<z;t++){const N=Math.cos(B),V=Math.sin(B),A=(N+1)/2,t=(1-V)/2;U.push(i*N,i*V,0),q.push(A,n.c?1-t:t),B+=k}1===S&&(U.push(U[3],U[4],U[5]),q.push(q[2],n.c?1-q[3]:q[3]));const C=U.length/3;for(let t=1;t<C-1;t++)V.push(t+1,0,t);t.c.ComputeNormals(U,V,A),t.c._ComputeSides(E,U,V,A,q,N.frontUVs,N.backUVs);const x=new t.c;return x.indices=V,x.sN=U,x.MN=A,x.mU=q,x}function i(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new A.b(N,V);U.sideOrientation=A.b._GetDefaultSideOrientation(U.sideOrientation),t._originalBuilderSideOrientation=U.sideOrientation;return q(U).XN(t,U.updatable),t}t.c.CreateDisc=q,A.b.CreateDisc=function(N,U,V){return i(N,{radius:U,tessellation:V,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13576:(N,U,V)=>{"use strict";V.d(U,{e:()=>J,d:()=>r,g:()=>d});var A=V(12383),t=V(12426),n=V(12799),q=V(12781),i=V(12453);n.b._GroundMeshParser=(N,U)=>z.Parse(N,U);class z extends n.b{constructor(N,U){super(N,U),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=N,this._subdivisionsY=N,this.subdivide(N);const V=this;V.createOrUpdateSubmeshesOctree&&V.createOrUpdateSubmeshesOctree(U)}getHeightAtCoordinates(N,U){const V=this.getWorldMatrix(),t=A.TmpVectors.Matrix[5];V.invertToRef(t);const n=A.TmpVectors.CU[8];if(A.CU.TransformCoordinatesFromFloatsToRef(N,0,U,t,n),N=n.x,U=n.z,N<this._minX||N>=this._maxX||U<=this._minZ||U>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const q=this._getFacetAt(N,U),i=-(q.x*N+q.z*U+q.w)/q.y;return A.CU.TransformCoordinatesFromFloatsToRef(0,i,0,V,n),n.y}getNormalAtCoordinates(N,U){const V=new A.CU(0,1,0);return this.getNormalAtCoordinatesToRef(N,U,V),V}getNormalAtCoordinatesToRef(N,U,V){const t=this.getWorldMatrix(),n=A.TmpVectors.Matrix[5];t.invertToRef(n);const q=A.TmpVectors.CU[8];if(A.CU.TransformCoordinatesFromFloatsToRef(N,0,U,n,q),N=q.x,U=q.z,N<this._minX||N>this._maxX||U<this._minZ||U>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const i=this._getFacetAt(N,U);return A.CU.TransformNormalFromFloatsToRef(i.x,i.y,i.z,t,V),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(N,U){const V=Math.floor((N+this._maxX)*this._subdivisionsX/this._width),A=Math.floor(-(U+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),t=this._heightQuads[A*this._subdivisionsX+V];let n;return n=U<t.slope.x*N+t.slope.y?t.facet1:t.facet2,n}_initHeightQuads(){const N=this._subdivisionsX,U=this._subdivisionsY;this._heightQuads=[];for(let V=0;V<U;V++)for(let U=0;U<N;U++){const t={slope:A.Vector2.Zero(),facet1:new A.Vector4(0,0,0,0),facet2:new A.Vector4(0,0,0,0)};this._heightQuads[V*N+U]=t}return this}_computeHeightQuads(){const N=this.getVerticesData(i.f.PositionKind);if(!N)return this;const U=A.TmpVectors.CU[3],V=A.TmpVectors.CU[2],t=A.TmpVectors.CU[1],n=A.TmpVectors.CU[0],q=A.TmpVectors.CU[4],z=A.TmpVectors.CU[5],S=A.TmpVectors.CU[6],E=A.TmpVectors.CU[7],p=A.TmpVectors.CU[8];let k=0,B=0,C=0,x=0,J=0,d=0,r=0;const v=this._subdivisionsX,h=this._subdivisionsY;for(let i=0;i<h;i++)for(let h=0;h<v;h++){k=3*h,B=i*(v+1)*3,C=(i+1)*(v+1)*3,U.x=N[B+k],U.y=N[B+k+1],U.z=N[B+k+2],V.x=N[B+k+3],V.y=N[B+k+4],V.z=N[B+k+5],t.x=N[C+k],t.y=N[C+k+1],t.z=N[C+k+2],n.x=N[C+k+3],n.y=N[C+k+4],n.z=N[C+k+5],x=(n.z-U.z)/(n.x-U.x),J=U.z-x*U.x,V.subtractToRef(U,q),t.subtractToRef(U,z),n.subtractToRef(U,S),A.CU.CrossToRef(S,z,E),A.CU.CrossToRef(q,S,p),E.normalize(),p.normalize(),d=-(E.x*U.x+E.y*U.y+E.z*U.z),r=-(p.x*V.x+p.y*V.y+p.z*V.z);const c=this._heightQuads[i*v+h];c.slope.hi(x,J),c.facet1.hi(E.x,E.y,E.z,d),c.facet2.hi(p.x,p.y,p.z,r)}return this}serialize(N){super.serialize(N),N.subdivisionsX=this._subdivisionsX,N.subdivisionsY=this._subdivisionsY,N.minX=this._minX,N.maxX=this._maxX,N.Bi=this._minZ,N.maxZ=this._maxZ,N.width=this._width,N.height=this._height}static Parse(N,U){const V=new z(N.name,U);return V._subdivisionsX=N.subdivisionsX||1,V._subdivisionsY=N.subdivisionsY||1,V._minX=N.minX,V._maxX=N.maxX,V._minZ=N.Bi,V._maxZ=N.maxZ,V._width=N.width,V._height=N.height,V}}var S=V(12179),E=V(12223),p=V(12389),k=V(12436);function B(N){const U=[],V=[],t=[],n=[];let i,z;const S=N.width||N.size||1,E=N.height||N.size||1,p=0|(N.subdivisionsX||N.subdivisions||1),B=0|(N.subdivisionsY||N.subdivisions||1);for(i=0;i<=B;i++)for(z=0;z<=p;z++){const N=new A.CU(z*S/p-S/2,0,(B-i)*E/B-E/2),U=new A.CU(0,1,0);V.push(N.x,N.y,N.z),t.push(U.x,U.y,U.z),n.push(z/p,k.c?i/B:1-i/B)}for(i=0;i<B;i++)for(z=0;z<p;z++)U.push(z+1+(i+1)*(p+1)),U.push(z+1+i*(p+1)),U.push(z+i*(p+1)),U.push(z+(i+1)*(p+1)),U.push(z+1+(i+1)*(p+1)),U.push(z+i*(p+1));const C=new q.c;return C.indices=U,C.sN=V,C.MN=t,C.mU=n,C}function C(N){const U=void 0!==N.xmin&&null!==N.xmin?N.xmin:-1,V=void 0!==N.zmin&&null!==N.zmin?N.zmin:-1,t=void 0!==N.xmax&&null!==N.xmax?N.xmax:1,n=void 0!==N.zmax&&null!==N.zmax?N.zmax:1,i=N.subdivisions||{w:1,h:1},z=N.precision||{w:1,h:1},S=[],E=[],p=[],k=[];let B,C,x,J;i.h=i.h<1?1:i.h,i.w=i.w<1?1:i.w,z.w=z.w<1?1:z.w,z.h=z.h<1?1:z.h;const d=(t-U)/i.w,r=(n-V)/i.h;function v(N,U,V,t){const n=E.length/3,q=z.w+1;for(B=0;B<z.h;B++)for(C=0;C<z.w;C++){const N=[n+C+B*q,n+(C+1)+B*q,n+(C+1)+(B+1)*q,n+C+(B+1)*q];S.push(N[1]),S.push(N[2]),S.push(N[3]),S.push(N[0]),S.push(N[1]),S.push(N[3])}const i=A.CU.Zero(),x=new A.CU(0,1,0);for(B=0;B<=z.h;B++)for(i.z=B*(t-U)/z.h+U,C=0;C<=z.w;C++)i.x=C*(V-N)/z.w+N,i.y=0,E.push(i.x,i.y,i.z),p.push(x.x,x.y,x.z),k.push(C/z.w,B/z.h)}for(x=0;x<i.h;x++)for(J=0;J<i.w;J++)v(U+J*d,V+x*r,U+(J+1)*d,V+(x+1)*r);const h=new q.c;return h.indices=S,h.sN=E,h.MN=p,h.mU=k,h}function x(N){const U=[],V=[],n=[],i=[];let z,S;const E=N.colorFilter||new t.rU(.3,.59,.11),k=N.alphaFilter||0;let B=!1;if(N.minHeight>N.maxHeight){B=!0;const U=N.maxHeight;N.maxHeight=N.minHeight,N.minHeight=U}for(z=0;z<=N.subdivisions;z++)for(S=0;S<=N.subdivisions;S++){const U=new A.CU(S*N.width/N.subdivisions-N.width/2,0,(N.subdivisions-z)*N.height/N.subdivisions-N.height/2),t=4*(((U.x+N.width/2)/N.width*(N.bufferWidth-1)|0)+((1-(U.z+N.height/2)/N.height)*(N.bufferHeight-1)|0)*N.bufferWidth);let q=N.buffer[t]/255,C=N.buffer[t+1]/255,x=N.buffer[t+2]/255;const J=N.buffer[t+3]/255;B&&(q=1-q,C=1-C,x=1-x);const d=q*E.r+C*E.g+x*E.b;U.y=J>=k?N.minHeight+(N.maxHeight-N.minHeight)*d:N.minHeight-p.d,N.heightBuffer&&(N.heightBuffer[z*(N.subdivisions+1)+S]=U.y),V.push(U.x,U.y,U.z),n.push(0,0,0),i.push(S/N.subdivisions,1-z/N.subdivisions)}for(z=0;z<N.subdivisions;z++)for(S=0;S<N.subdivisions;S++){const A=S+1+(z+1)*(N.subdivisions+1),t=S+1+z*(N.subdivisions+1),n=S+z*(N.subdivisions+1),q=S+(z+1)*(N.subdivisions+1),i=V[3*A+1]>=N.minHeight,E=V[3*t+1]>=N.minHeight,p=V[3*n+1]>=N.minHeight;i&&E&&p&&(U.push(A),U.push(t),U.push(n));V[3*q+1]>=N.minHeight&&i&&p&&(U.push(q),U.push(A),U.push(n))}q.c.ComputeNormals(V,U,n);const C=new q.c;return C.indices=U,C.sN=V,C.MN=n,C.mU=i,C}function J(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const V=new z(N,arguments.length>2?arguments[2]:void 0);V._setReady(!1),V._subdivisionsX=U.subdivisionsX||U.subdivisions||1,V._subdivisionsY=U.subdivisionsY||U.subdivisions||1,V._width=U.width||1,V._height=U.height||1,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ;return B(U).XN(V,U.updatable),V._setReady(!0),V}function d(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new n.b(N,V);return C(U).XN(A,U.updatable),A}function r(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=V.width||10,q=V.height||10,i=V.subdivisions||1,p=V.minHeight||0,k=V.maxHeight||1,B=V.colorFilter||new t.rU(.3,.59,.11),C=V.alphaFilter||0,J=V.updatable,d=V.onReady;A=A||E.e.LastCreatedScene;const r=new z(N,A);let v;r._subdivisionsX=i,r._subdivisionsY=i,r._width=n,r._height=q,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,r._setReady(!1),V.passHeightBufferInCallback&&(v=new Float32Array((i+1)*(i+1)));const h=(N,U,V)=>{x({width:n,height:q,subdivisions:i,minHeight:p,maxHeight:k,colorFilter:B,buffer:N,bufferWidth:U,bufferHeight:V,alphaFilter:C,heightBuffer:v}).XN(r,J),d&&d(r,v),r._setReady(!0)};if("string"===typeof U){const N=N=>{var U;const V=N.width,t=N.height;if(A.S)return;const n=null===(U=A)||void 0===U?void 0:U.getEngine().resizeImageBitmap(N,V,t);h(n,V,t)};S.Tools.LoadImage(U,N,V.onError?V.onError:()=>{},A.offlineProvider)}else h(U.data,U.width,U.height);return r}q.c.CreateGround=B,q.c.CreateTiledGround=C,q.c.CreateGroundFromHeightMap=x,n.b.CreateGround=(N,U,V,A,t,n)=>J(N,{width:U,height:V,subdivisions:A,updatable:n},t),n.b.CreateTiledGround=(N,U,V,A,t,n,q,i,z)=>d(N,{xmin:U,zmin:V,xmax:A,zmax:t,subdivisions:n,precision:q,updatable:z},i),n.b.CreateGroundFromHeightMap=(N,U,V,A,t,n,q,i,z,S,E)=>r(N,U,{width:V,height:A,subdivisions:t,minHeight:n,maxHeight:q,updatable:z,onReady:S,alphaFilter:E},i)},14232:(N,U,V)=>{"use strict";V.d(U,{b:()=>B,d:()=>p,h:()=>k});var A=V(12383),t=V(12799),n=V(12781),q=V(12898),i=V(12453),z=V(12193);function S(N){const U=[],V=[],A=N.lines,t=N.aN,q=[];let i=0;for(let n=0;n<A.length;n++){const N=A[n];for(let A=0;A<N.length;A++){const{x:z,y:S,z:E}=N[A];if(V.push(z,S,E),t){const N=t[n],{r:U,g:V,b:i,a:z}=N[A];q.push(U,V,i,z)}A>0&&(U.push(i-1),U.push(i)),i++}}const z=new n.c;return z.indices=U,z.sN=V,t&&(z.aN=q),z}function E(N){const U=N.dashSize||3,V=N.gapSize||1,t=N.dashNb||200,q=N.points,i=[],z=[],S=A.CU.Zero();let E=0,p=0,k=0,B=0,C=0,x=0,J=0;for(J=0;J<q.length-1;J++)q[J+1].subtractToRef(q[J],S),E+=S.length();for(k=E/t,B=U*k/(U+V),J=0;J<q.length-1;J++){q[J+1].subtractToRef(q[J],S),p=Math.floor(S.length()/k),S.normalize();for(let N=0;N<p;N++)C=k*N,i.push(q[J].x+C*S.x,q[J].y+C*S.y,q[J].z+C*S.z),i.push(q[J].x+(C+B)*S.x,q[J].y+(C+B)*S.y,q[J].z+(C+B)*S.z),z.push(x,x+1),x+=2}const d=new n.c;return d.sN=i,d.indices=z,d}function p(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=U.instance,t=U.lines,n=U.aN;if(A){const N=A.getVerticesData(i.f.PositionKind);let U,V;n&&(U=A.getVerticesData(i.f.ColorKind));let q=0,z=0;for(let A=0;A<t.length;A++){const i=t[A];for(let t=0;t<i.length;t++)N[q]=i[t].x,N[q+1]=i[t].y,N[q+2]=i[t].z,n&&U&&(V=n[A],U[z]=V[t].r,U[z+1]=V[t].g,U[z+2]=V[t].b,U[z+3]=V[t].a,z+=4),q+=3}return A.updateVerticesData(i.f.PositionKind,N,!1,!1),n&&U&&A.updateVerticesData(i.f.ColorKind,U,!1,!1),A.refreshBoundingInfo(),A}const z=!!n,E=new q.d(N,V,null,void 0,void 0,z,U.useVertexAlpha,U.material);return S(U).XN(E,U.updatable),E}function k(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=U.aN?[U.aN]:null;return p(N,{lines:[U.points],updatable:U.updatable,instance:U.instance,aN:A,useVertexAlpha:U.useVertexAlpha,material:U.material},V)}function B(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=U.points,i=U.instance,S=U.gapSize||1,p=U.dashSize||3;if(i){const N=N=>{const U=A.CU.Zero(),V=N.length/6;let t=0,q=0,z=0,S=0,E=0,p=0,k=0,B=0;for(k=0;k<n.length-1;k++)n[k+1].subtractToRef(n[k],U),t+=U.length();z=t/V;const C=i._creationDataStorage.dashSize;for(S=C*z/(C+i._creationDataStorage.gapSize),k=0;k<n.length-1;k++)for(n[k+1].subtractToRef(n[k],U),q=Math.floor(U.length()/z),U.normalize(),B=0;B<q&&p<N.length;)E=z*B,N[p]=n[k].x+E*U.x,N[p+1]=n[k].y+E*U.y,N[p+2]=n[k].z+E*U.z,N[p+3]=n[k].x+(E+S)*U.x,N[p+4]=n[k].y+(E+S)*U.y,N[p+5]=n[k].z+(E+S)*U.z,p+=6,B++;for(;p<N.length;)N[p]=n[k].x,N[p+1]=n[k].y,N[p+2]=n[k].z,p+=3};return(U.dashNb||U.dashSize||U.gapSize||U.useVertexAlpha||U.material)&&z.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),i.updateMeshPositions(N,!1),i}const k=new q.d(N,V,null,void 0,void 0,void 0,U.useVertexAlpha,U.material);return E(U).XN(k,U.updatable),k._creationDataStorage=new t.d,k._creationDataStorage.dashSize=p,k._creationDataStorage.gapSize=S,k}n.c.CreateLineSystem=S,n.c.CreateDashedLines=E,t.b.hS=function(N,U){return k(N,{points:U,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},t.b.CreateDashedLines=function(N,U,V,A,t){return B(N,{points:U,dashSize:V,gapSize:A,dashNb:t,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13623:(N,U,V)=>{"use strict";V.d(U,{e:()=>i,i:()=>z});var A=V(12799),t=V(12781),n=V(12436);function q(N){const U=[],V=[],A=[],q=[],i=void 0!==N.width?N.width:void 0!==N.size?N.size:1,z=void 0!==N.height?N.height:void 0!==N.size?N.size:1,S=0===N.sideOrientation?0:N.sideOrientation||t.c.DEFAULTSIDE,E=i/2,p=z/2;V.push(-E,-p,0),A.push(0,0,-1),q.push(0,n.c?1:0),V.push(E,-p,0),A.push(0,0,-1),q.push(1,n.c?1:0),V.push(E,p,0),A.push(0,0,-1),q.push(1,n.c?0:1),V.push(-E,p,0),A.push(0,0,-1),q.push(0,n.c?0:1),U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),t.c._ComputeSides(S,V,U,A,q,N.frontUVs,N.backUVs);const k=new t.c;return k.indices=U,k.sN=V,k.MN=A,k.mU=q,k}function i(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new A.b(N,V);U.sideOrientation=A.b._GetDefaultSideOrientation(U.sideOrientation),t._originalBuilderSideOrientation=U.sideOrientation;return q(U).XN(t,U.updatable),U.sourcePlane&&(t.translate(U.sourcePlane.normal,-U.sourcePlane.d),t.setDirection(U.sourcePlane.normal.scale(-1))),t}const z={YS:i};t.c.YS=q,A.b.YS=(N,U,V,A,t)=>i(N,{size:U,width:U,height:U,sideOrientation:t,updatable:A},V)},13714:(N,U,V)=>{"use strict";V.d(U,{d:()=>z});var A=V(12383),t=V(12799),n=V(12781),q=V(12436);function i(N){const U=0|(N.segments||32),V=N.diameterX||N.diameter||1,t=N.diameterY||N.diameter||1,i=N.diameterZ||N.diameter||1,z=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,S=N.slice&&N.slice<=0?1:N.slice||1,E=0===N.sideOrientation?0:N.sideOrientation||n.c.DEFAULTSIDE,p=!!N.dedupTopBottomIndices,k=new A.CU(V/2,t/2,i/2),B=2+U,C=2*B,x=[],J=[],d=[],r=[];for(let n=0;n<=B;n++){const N=n/B,U=N*Math.PI*S;for(let V=0;V<=C;V++){const t=V/C,n=t*Math.PI*2*z,i=A.Matrix.RotationZ(-U),S=A.Matrix.RotationY(n),E=A.CU.TransformCoordinates(A.CU.Up(),i),p=A.CU.TransformCoordinates(E,S),B=p.multiply(k),x=p.divide(k).normalize();J.push(B.x,B.y,B.z),d.push(x.x,x.y,x.z),r.push(t,q.c?1-N:N)}if(n>0){const N=J.length/3;for(let U=N-2*(C+1);U+C+2<N;U++)p?(n>1&&(x.push(U),x.push(U+1),x.push(U+C+1)),(n<B||S<1)&&(x.push(U+C+1),x.push(U+1),x.push(U+C+2))):(x.push(U),x.push(U+1),x.push(U+C+1),x.push(U+C+1),x.push(U+1),x.push(U+C+2))}}n.c._ComputeSides(E,J,x,d,r,N.frontUVs,N.backUVs);const v=new n.c;return v.indices=x,v.sN=J,v.MN=d,v.mU=r,v}function z(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return i(U).XN(A,U.updatable),A}n.c.CreateSphere=i,t.b.CreateSphere=(N,U,V,A,t,n)=>z(N,{segments:U,diameterX:V,diameterY:V,diameterZ:V,sideOrientation:n,updatable:t},A)},14530:(N,U,V)=>{"use strict";V.d(U,{b:()=>i});var A=V(12916),t=V(14012),n=V(12928),q=V(12781);class i{static get Configuration(){return{get decoder(){return t.c.DefaultConfiguration},set decoder(N){t.c.DefaultConfiguration=N}}}static set Configuration(N){t.c.DefaultConfiguration=N.decoder}static get DecoderAvailable(){return(0,A.m)(t.c.DefaultConfiguration)}static get Default(){return i._Default??(i._Default=new i),i._Default}static ResetDefault(N){i._Default&&(N||i._Default.dispose(),i._Default=null)}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DefaultNumWorkers;const U="number"===typeof N?{...t.c.DefaultConfiguration,numWorkers:N}:{...t.c.DefaultConfiguration,...N};this._decoder=new t.c(U)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(N,U,V){return this._decoder.decodeMeshToMeshDataAsync(N,U,V)}async decodeMeshToGeometryAsync(N,U,V,A){return await this._decoder.decodeMeshToGeometryAsync(N,U,V,A)}async _decodeMeshToGeometryForGltfAsync(N,U,V,A,t,n){return await this._decoder._decodeMeshToGeometryForGltfAsync(N,U,V,A,t,n)}async decodeMeshAsync(N,U){const V=await this._decoder.decodeMeshToMeshDataAsync(N,U),A=new q.c;V.indices&&(A.indices=V.indices);for(const t of V.attributes){const N=n.b.GetFloatData(t.data,t.size,n.b.GetDataType(t.data),t.byteOffset,t.byteStride,t.normalized,V.totalVertices);A.set(N,t.kind)}return A}}i.DefaultNumWorkers=(0,A.i)(),i._Default=null},14012:(N,U,V)=>{"use strict";V.d(U,{c:()=>S});var A=V(12916),t=V(12179),n=V(12811),q=V(12928),i=V(12193),z=V(12923);class S extends A.e{static get DefaultAvailable(){return(0,A.m)(S.DefaultConfiguration)}static get Default(){return S._Default??(S._Default=new S),S._Default}static ResetDefault(N){S._Default&&(N||S._Default.dispose(),S._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(N,U){return{module:await(U||DracoDecoderModule)({wasmBinary:N})}}_getWorkerContent(){return`${z.e}(${z.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.DefaultConfiguration)}decodeMeshToMeshDataAsync(N,U,V){const A=N instanceof ArrayBuffer?new Int8Array(N):new Int8Array(N.buffer,N.byteOffset,N.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async N=>await new Promise(((t,n)=>{N.push(((N,q)=>{let z=null;const S=[],E=U=>{N.removeEventListener("error",E),N.removeEventListener("message",p),n(U),q()},p=U=>{const A=U.data;switch(A.id){case"indices":z=A.data;break;case"attribute":S.push({kind:A.kind,data:A.data,size:A.size,byteOffset:A.byteOffset,byteStride:A.byteStride,normalized:(n=A.kind,k=A.normalized,V&&void 0!==V[n]?(k!==V[n]&&i.b.Warn(`Normalized flag from Draco data (${k}) does not match normalized flag from glTF accessor (${V[n]}). Using flag from glTF accessor.`),V[n]):k)});break;case"decodeMeshDone":N.removeEventListener("error",E),N.removeEventListener("message",p),t({indices:z,attributes:S,totalVertices:A.totalVertices}),q()}var n,k};N.addEventListener("error",E),N.addEventListener("message",p);const k=A.slice();N.postMessage({id:"decodeMesh",dataView:k,attributes:U},[k.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((N=>{let V=null;const t=[],n=(0,z.e)(N.module,A,U,(N=>{V=N}),((N,U,V,A,n,q)=>{t.push({kind:N,data:U,size:V,byteOffset:A,byteStride:n,normalized:q})}));return{indices:V,attributes:t,totalVertices:n}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(N,U,V,A){const t=await this.decodeMeshToMeshDataAsync(V,A),i=new n.c(N,U);t.indices&&i.setIndices(t.indices);for(const n of t.attributes)i.setVerticesBuffer(new q.b(U.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),t.totalVertices);return i}async _decodeMeshToGeometryForGltfAsync(N,U,V,A,t,i){const z=await this.decodeMeshToMeshDataAsync(V,A,t),S=new n.c(N,U);i&&(S._boundingInfo=i,S.useBoundingInfoFromGeometry=!0),z.indices&&S.setIndices(z.indices);for(const n of z.attributes)S.setVerticesBuffer(new q.b(U.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),z.totalVertices);return S}}S.DefaultConfiguration={wasmUrl:`${t.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${t.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${t.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},S._Default=null},14223:(N,U,V)=>{"use strict";V.d(U,{e:()=>iN});var A=V(12383),t=V(12799),n=V(12453),q=V(12781),i=V(12436);function z(N){let U=N.pathArray;const V=N.closeArray||!1,A=N.closePath||!1,t=N.invertUV||!1,z=Math.floor(U[0].length/2);let S=N.offset||z;S=S>z?z:Math.floor(S);const E=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,p=N.mU,k=N.aN,B=[],C=[],x=[],J=[],d=[],r=[],v=[],h=[];let c;const H=[],Y=[];let W,s,M;if(U.length<2){const N=[],V=[];for(s=0;s<U[0].length-S;s++)N.push(U[0][s]),V.push(U[0][s+S]);U=[N,V]}let a=0;const mN=A?1:0,w=V?1:0;let X,e,Q,u,L,I;for(c=U[0].length,W=0;W<U.length+w;W++){for(v[W]=0,d[W]=[0],X=W===U.length?U[0]:U[W],e=X.length,c=c<e?c:e,M=0;M<e;)B.push(X[M].x,X[M].y,X[M].z),M>0&&(Q=X[M].xU(X[M-1]).length(),u=Q+v[W],d[W].push(u),v[W]=u),M++;A&&(M--,B.push(X[0].x,X[0].y,X[0].z),Q=X[M].xU(X[0]).length(),u=Q+v[W],d[W].push(u),v[W]=u),H[W]=e+mN,Y[W]=a,a+=e+mN}let o,R,D=null,G=null;for(s=0;s<c+mN;s++)for(h[s]=0,r[s]=[0],W=0;W<U.length-1+w;W++)L=U[W],I=W===U.length-1?U[0]:U[W+1],s===c?(D=L[0],G=I[0]):(D=L[s],G=I[s]),Q=G.xU(D).length(),u=Q+h[s],r[s].push(u),h[s]=u;if(p)for(W=0;W<p.length;W++)J.push(p[W].x,i.c?1-p[W].y:p[W].y);else for(W=0;W<U.length+w;W++)for(s=0;s<c+mN;s++)o=0!=v[W]?d[W][s]/v[W]:0,R=0!=h[s]?r[s][W]/h[s]:0,t?J.push(R,o):J.push(o,i.c?1-R:R);W=0;let g=0,l=H[W]-1,K=H[W+1]-1,j=l<K?l:K,F=Y[1]-Y[0];const P=H.length-1;for(;g<=j&&W<P;)C.push(g,g+F,g+1),C.push(g+F+1,g+1,g+F),g+=1,g===j&&(W++,F=Y[W+1]-Y[W],l=H[W]-1,K=H[W+1]-1,g=Y[W],j=l<K?l+g:K+g);if(q.c.ComputeNormals(B,C,x),A){let N=0,V=0;for(W=0;W<U.length;W++){N=3*Y[W],V=W+1<U.length?3*(Y[W+1]-1):x.length-3,x[N]=.5*(x[N]+x[V]),x[N+1]=.5*(x[N+1]+x[V+1]),x[N+2]=.5*(x[N+2]+x[V+2]);const A=Math.sqrt(x[N]*x[N]+x[N+1]*x[N+1]+x[N+2]*x[N+2]);x[N]/=A,x[N+1]/=A,x[N+2]/=A,x[V]=x[N],x[V+1]=x[N+1],x[V+2]=x[N+2]}}if(V){let N=3*Y[0],V=3*Y[U.length];for(s=0;s<c+mN;s++){x[N]=.5*(x[N]+x[V]),x[N+1]=.5*(x[N+1]+x[V+1]),x[N+2]=.5*(x[N+2]+x[V+2]);const U=Math.sqrt(x[N]*x[N]+x[N+1]*x[N+1]+x[N+2]*x[N+2]);x[N]/=U,x[N+1]/=U,x[N+2]/=U,x[V]=x[N],x[V+1]=x[N+1],x[V+2]=x[N+2],N+=3,V+=3}}q.c._ComputeSides(E,B,C,x,J,N.frontUVs,N.backUVs);let T=null;if(k){T=new Float32Array(4*k.length);for(let N=0;N<k.length;N++)T[4*N]=k[N].r,T[4*N+1]=k[N].g,T[4*N+2]=k[N].b,T[4*N+3]=k[N].a}const f=new q.c,O=new Float32Array(B),Z=new Float32Array(x),b=new Float32Array(J);return f.indices=C,f.sN=O,f.MN=Z,f.mU=b,T&&f.set(T,n.f.ColorKind),A&&(f._idx=Y),f}function S(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=U.pathArray,E=U.closeArray,p=U.closePath,k=t.b._GetDefaultSideOrientation(U.sideOrientation),B=U.instance,C=U.updatable;if(B){const N=A.TmpVectors.CU[0].Hi(Number.MAX_VALUE),V=A.TmpVectors.CU[1].Hi(-Number.MAX_VALUE),z=U=>{let A=S[0].length;const n=B;let q=0;const i=n._originalBuilderSideOrientation===t.b.DOUBLESIDE?2:1;for(let t=1;t<=i;++t)for(let i=0;i<S.length;++i){const t=S[i],z=t.length;A=A<z?A:z;for(let n=0;n<A;++n){const A=t[n];U[q]=A.x,U[q+1]=A.y,U[q+2]=A.z,N.minimizeInPlaceFromFloats(A.x,A.y,A.z),V.maximizeInPlaceFromFloats(A.x,A.y,A.z),q+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const N=t[0];U[q]=N.x,U[q+1]=N.y,U[q+2]=N.z,q+=3}}},E=B.getVerticesData(n.f.PositionKind);if(z(E),B.hasBoundingInfo?B.getBoundingInfo().reConstruct(N,V,B._worldMatrix):B.buildBoundingInfo(N,V,B._worldMatrix),B.updateVerticesData(n.f.PositionKind,E,!1,!1),U.aN){const N=B.getVerticesData(n.f.ColorKind);for(let V=0,A=0;V<U.aN.length;V++,A+=4){const t=U.aN[V];N[A]=t.r,N[A+1]=t.g,N[A+2]=t.b,N[A+3]=t.a}B.updateVerticesData(n.f.ColorKind,N,!1,!1)}if(U.mU){const N=B.getVerticesData(n.f.UVKind);for(let V=0;V<U.mU.length;V++)N[2*V]=U.mU[V].x,N[2*V+1]=i.c?1-U.mU[V].y:U.mU[V].y;B.updateVerticesData(n.f.UVKind,N,!1,!1)}if(!B.areNormalsFrozen||B.isFacetDataEnabled){const N=B.di(),U=B.getVerticesData(n.f.NormalKind),V=B.isFacetDataEnabled?B.getFacetDataParameters():null;if(q.c.ComputeNormals(E,N,U,V),B._creationDataStorage&&B._creationDataStorage.closePath){let N=0,V=0;for(let A=0;A<S.length;A++)N=3*B._creationDataStorage.idx[A],V=A+1<S.length?3*(B._creationDataStorage.idx[A+1]-1):U.length-3,U[N]=.5*(U[N]+U[V]),U[N+1]=.5*(U[N+1]+U[V+1]),U[N+2]=.5*(U[N+2]+U[V+2]),U[V]=U[N],U[V+1]=U[N+1],U[V+2]=U[N+2]}B.areNormalsFrozen||B.updateVerticesData(n.f.NormalKind,U,!1,!1)}return B}{const A=new t.b(N,V);A._originalBuilderSideOrientation=k,A._creationDataStorage=new t.d;const n=z(U);return p&&(A._creationDataStorage.idx=n._idx),A._creationDataStorage.closePath=p,A._creationDataStorage.closeArray=E,n.XN(A,C),A}}q.c.CreateRibbon=z,t.b.CreateRibbon=function(N,U){return S(N,{pathArray:U,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var E=V(13728),p=V(13570),k=V(12426);function B(N){const U=N.pattern||t.b.NO_FLIP,V=N.tileWidth||N.tileSize||1,A=N.tileHeight||N.tileSize||1,n=N.alignHorizontal||0,i=N.alignVertical||0,z=N.width||N.size||1,S=Math.floor(z/V);let E=z-S*V;const p=N.height||N.size||1,k=Math.floor(p/A);let B=p-k*A;const C=V*S/2,x=A*k/2;let J=0,d=0,r=0,v=0,h=0,c=0;if(E>0||B>0){switch(r=-C,v=-x,h=C,c=x,n){case t.b.CENTER:E/=2,r-=E,h+=E;break;case t.b.LEFT:h+=E,J=-E/2;break;case t.b.RIGHT:r-=E,J=E/2}switch(i){case t.b.CENTER:B/=2,v-=B,c+=B;break;case t.b.BOTTOM:c+=B,d=-B/2;break;case t.b.TOP:v-=B,d=B/2}}const H=[],Y=[],W=[];W[0]=[0,0,1,0,1,1,0,1],W[1]=[0,0,1,0,1,1,0,1],U!==t.b.ROTATE_TILE&&U!==t.b.ROTATE_ROW||(W[1]=[1,1,0,1,0,0,1,0]),U!==t.b.FLIP_TILE&&U!==t.b.FLIP_ROW||(W[1]=[1,0,0,0,0,1,1,1]),U!==t.b.FLIP_N_ROTATE_TILE&&U!==t.b.FLIP_N_ROTATE_ROW||(W[1]=[0,1,1,1,1,0,0,0]);let s=[];const M=[],a=[];let mN=0;for(let q=0;q<k;q++)for(let N=0;N<S;N++)H.push(N*V-C+J,q*A-x+d,0),H.push((N+1)*V-C+J,q*A-x+d,0),H.push((N+1)*V-C+J,(q+1)*A-x+d,0),H.push(N*V-C+J,(q+1)*A-x+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),s=U===t.b.FLIP_TILE||U===t.b.ROTATE_TILE||U===t.b.FLIP_N_ROTATE_TILE?s.concat(W[(N%2+q%2)%2]):U===t.b.FLIP_ROW||U===t.b.ROTATE_ROW||U===t.b.FLIP_N_ROTATE_ROW?s.concat(W[q%2]):s.concat(W[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),mN+=4;if(E>0||B>0){const N=B>0&&(i===t.b.CENTER||i===t.b.TOP),q=B>0&&(i===t.b.CENTER||i===t.b.BOTTOM),z=E>0&&(n===t.b.CENTER||n===t.b.RIGHT),p=E>0&&(n===t.b.CENTER||n===t.b.LEFT);let W,w,X,e,Q=[];if(N&&z&&(H.push(r+J,v+d,0),H.push(-C+J,v+d,0),H.push(-C+J,v+B+d,0),H.push(r+J,v+B+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,W=1-E/V,w=1-B/A,X=1,e=1,Q=[W,w,X,w,X,e,W,e],U===t.b.ROTATE_ROW&&(Q=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),U===t.b.FLIP_ROW&&(Q=[1-W,w,1-X,w,1-X,e,1-W,e]),U===t.b.FLIP_N_ROTATE_ROW&&(Q=[W,1-w,X,1-w,X,1-e,W,1-e]),s=s.concat(Q),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&p&&(H.push(C+J,v+d,0),H.push(h+J,v+d,0),H.push(h+J,v+B+d,0),H.push(C+J,v+B+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,W=0,w=1-B/A,X=E/V,e=1,Q=[W,w,X,w,X,e,W,e],(U===t.b.ROTATE_ROW||U===t.b.ROTATE_TILE&&S%2===0)&&(Q=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),(U===t.b.FLIP_ROW||U===t.b.FLIP_TILE&&S%2===0)&&(Q=[1-W,w,1-X,w,1-X,e,1-W,e]),(U===t.b.FLIP_N_ROTATE_ROW||U===t.b.FLIP_N_ROTATE_TILE&&S%2===0)&&(Q=[W,1-w,X,1-w,X,1-e,W,1-e]),s=s.concat(Q),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&z&&(H.push(r+J,x+d,0),H.push(-C+J,x+d,0),H.push(-C+J,c+d,0),H.push(r+J,c+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,W=1-E/V,w=0,X=1,e=B/A,Q=[W,w,X,w,X,e,W,e],(U===t.b.ROTATE_ROW&&k%2===1||U===t.b.ROTATE_TILE&&k%1===0)&&(Q=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),(U===t.b.FLIP_ROW&&k%2===1||U===t.b.FLIP_TILE&&k%2===0)&&(Q=[1-W,w,1-X,w,1-X,e,1-W,e]),(U===t.b.FLIP_N_ROTATE_ROW&&k%2===1||U===t.b.FLIP_N_ROTATE_TILE&&k%2===0)&&(Q=[W,1-w,X,1-w,X,1-e,W,1-e]),s=s.concat(Q),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&p&&(H.push(C+J,x+d,0),H.push(h+J,x+d,0),H.push(h+J,c+d,0),H.push(C+J,c+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,W=0,w=0,X=E/V,e=B/A,Q=[W,w,X,w,X,e,W,e],(U===t.b.ROTATE_ROW&&k%2===1||U===t.b.ROTATE_TILE&&(k+S)%2===1)&&(Q=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),(U===t.b.FLIP_ROW&&k%2===1||U===t.b.FLIP_TILE&&(k+S)%2===1)&&(Q=[1-W,w,1-X,w,1-X,e,1-W,e]),(U===t.b.FLIP_N_ROTATE_ROW&&k%2===1||U===t.b.FLIP_N_ROTATE_TILE&&(k+S)%2===1)&&(Q=[W,1-w,X,1-w,X,1-e,W,1-e]),s=s.concat(Q),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N){const N=[];W=0,w=1-B/A,X=1,e=1,N[0]=[W,w,X,w,X,e,W,e],N[1]=[W,w,X,w,X,e,W,e],U!==t.b.ROTATE_TILE&&U!==t.b.ROTATE_ROW||(N[1]=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),U!==t.b.FLIP_TILE&&U!==t.b.FLIP_ROW||(N[1]=[1-W,w,1-X,w,1-X,e,1-W,e]),U!==t.b.FLIP_N_ROTATE_TILE&&U!==t.b.FLIP_N_ROTATE_ROW||(N[1]=[W,1-w,X,1-w,X,1-e,W,1-e]);for(let A=0;A<S;A++)H.push(A*V-C+J,v+d,0),H.push((A+1)*V-C+J,v+d,0),H.push((A+1)*V-C+J,v+B+d,0),H.push(A*V-C+J,v+B+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,s=U===t.b.FLIP_TILE||U===t.b.ROTATE_TILE||U===t.b.FLIP_N_ROTATE_TILE?s.concat(N[(A+1)%2]):U===t.b.FLIP_ROW||U===t.b.ROTATE_ROW||U===t.b.FLIP_N_ROTATE_ROW?s.concat(N[1]):s.concat(N[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const N=[];W=0,w=0,X=1,e=B/A,N[0]=[W,w,X,w,X,e,W,e],N[1]=[W,w,X,w,X,e,W,e],U!==t.b.ROTATE_TILE&&U!==t.b.ROTATE_ROW||(N[1]=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),U!==t.b.FLIP_TILE&&U!==t.b.FLIP_ROW||(N[1]=[1-W,w,1-X,w,1-X,e,1-W,e]),U!==t.b.FLIP_N_ROTATE_TILE&&U!==t.b.FLIP_N_ROTATE_ROW||(N[1]=[W,1-w,X,1-w,X,1-e,W,1-e]);for(let A=0;A<S;A++)H.push(A*V-C+J,c-B+d,0),H.push((A+1)*V-C+J,c-B+d,0),H.push((A+1)*V-C+J,c+d,0),H.push(A*V-C+J,c+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,s=U===t.b.FLIP_TILE||U===t.b.ROTATE_TILE||U===t.b.FLIP_N_ROTATE_TILE?s.concat(N[(A+k)%2]):U===t.b.FLIP_ROW||U===t.b.ROTATE_ROW||U===t.b.FLIP_N_ROTATE_ROW?s.concat(N[k%2]):s.concat(N[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(z){const N=[];W=1-E/V,w=0,X=1,e=1,N[0]=[W,w,X,w,X,e,W,e],N[1]=[W,w,X,w,X,e,W,e],U!==t.b.ROTATE_TILE&&U!==t.b.ROTATE_ROW||(N[1]=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),U!==t.b.FLIP_TILE&&U!==t.b.FLIP_ROW||(N[1]=[1-W,w,1-X,w,1-X,e,1-W,e]),U!==t.b.FLIP_N_ROTATE_TILE&&U!==t.b.FLIP_N_ROTATE_ROW||(N[1]=[W,1-w,X,1-w,X,1-e,W,1-e]);for(let V=0;V<k;V++)H.push(r+J,V*A-x+d,0),H.push(r+E+J,V*A-x+d,0),H.push(r+E+J,(V+1)*A-x+d,0),H.push(r+J,(V+1)*A-x+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,s=U===t.b.FLIP_TILE||U===t.b.ROTATE_TILE||U===t.b.FLIP_N_ROTATE_TILE?s.concat(N[(V+1)%2]):U===t.b.FLIP_ROW||U===t.b.ROTATE_ROW||U===t.b.FLIP_N_ROTATE_ROW?s.concat(N[V%2]):s.concat(N[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const N=[];W=0,w=0,X=E/A,e=1,N[0]=[W,w,X,w,X,e,W,e],N[1]=[W,w,X,w,X,e,W,e],U!==t.b.ROTATE_TILE&&U!==t.b.ROTATE_ROW||(N[1]=[1-W,1-w,1-X,1-w,1-X,1-e,1-W,1-e]),U!==t.b.FLIP_TILE&&U!==t.b.FLIP_ROW||(N[1]=[1-W,w,1-X,w,1-X,e,1-W,e]),U!==t.b.FLIP_N_ROTATE_TILE&&U!==t.b.FLIP_N_ROTATE_ROW||(N[1]=[W,1-w,X,1-w,X,1-e,W,1-e]);for(let V=0;V<k;V++)H.push(h-E+J,V*A-x+d,0),H.push(h+J,V*A-x+d,0),H.push(h+J,(V+1)*A-x+d,0),H.push(h-E+J,(V+1)*A-x+d,0),a.push(mN,mN+1,mN+3,mN+1,mN+2,mN+3),mN+=4,s=U===t.b.FLIP_TILE||U===t.b.ROTATE_TILE||U===t.b.FLIP_N_ROTATE_TILE?s.concat(N[(V+S)%2]):U===t.b.FLIP_ROW||U===t.b.ROTATE_ROW||U===t.b.FLIP_N_ROTATE_ROW?s.concat(N[V%2]):s.concat(N[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const w=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE;q.c._ComputeSides(w,H,a,Y,s,N.frontUVs,N.backUVs);const X=new q.c;X.indices=a,X.sN=H,X.MN=Y,X.mU=s;const e=w===q.c.DOUBLESIDE?M.concat(M):M;return X.aN=e,X}function C(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return B(U).XN(A,U.updatable),A}function x(N){const U=N.faceUV||new Array(6),V=N.faceColors,n=N.pattern||t.b.NO_FLIP,z=N.width||N.size||1,S=N.height||N.size||1,E=N.depth||N.size||1,p=N.tileWidth||N.tileSize||1,C=N.tileHeight||N.tileSize||1,x=N.alignHorizontal||0,J=N.alignVertical||0,d=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE;for(let t=0;t<6;t++)void 0===U[t]&&(U[t]=new A.Vector4(0,0,1,1)),V&&void 0===V[t]&&(V[t]=new k.Yi(1,1,1,1));const r=z/2,v=S/2,h=E/2,c=[];for(let A=0;A<2;A++)c[A]=B({pattern:n,tileWidth:p,tileHeight:C,width:z,height:S,alignVertical:J,alignHorizontal:x,sideOrientation:d});for(let A=2;A<4;A++)c[A]=B({pattern:n,tileWidth:p,tileHeight:C,width:E,height:S,alignVertical:J,alignHorizontal:x,sideOrientation:d});let H=J;J===t.b.BOTTOM?H=t.b.TOP:J===t.b.TOP&&(H=t.b.BOTTOM);for(let A=4;A<6;A++)c[A]=B({pattern:n,tileWidth:p,tileHeight:C,width:z,height:E,alignVertical:H,alignHorizontal:x,sideOrientation:d});let Y=[],W=[],s=[],M=[];const a=[],mN=[],w=[],X=[];let e=0,Q=0;for(let t=0;t<6;t++){const N=c[t].sN.length;mN[t]=[],w[t]=[];for(let U=0;U<N/3;U++)mN[t].push(new A.CU(c[t].sN[3*U],c[t].sN[3*U+1],c[t].sN[3*U+2])),w[t].push(new A.CU(c[t].MN[3*U],c[t].MN[3*U+1],c[t].MN[3*U+2]));e=c[t].mU.length,X[t]=[];for(let V=0;V<e;V+=2)X[t][V]=U[t].x+(U[t].z-U[t].x)*c[t].mU[V],X[t][V+1]=U[t].y+(U[t].w-U[t].y)*c[t].mU[V+1],i.c&&(X[t][V+1]=1-X[t][V+1]);if(s=s.concat(X[t]),M=M.concat(c[t].indices.map((N=>N+Q))),Q+=mN[t].length,V)for(let U=0;U<4;U++)a.push(V[t].r,V[t].g,V[t].b,V[t].a)}const u=new A.CU(0,0,h),L=A.Matrix.RotationY(Math.PI);Y=mN[0].map((N=>A.CU.TransformNormal(N,L).add(u))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[]),W=w[0].map((N=>A.CU.TransformNormal(N,L))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[]),Y=Y.concat(mN[1].map((N=>N.xU(u))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[])),W=W.concat(w[1].map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[]));const I=new A.CU(r,0,0),o=A.Matrix.RotationY(-Math.PI/2);Y=Y.concat(mN[2].map((N=>A.CU.TransformNormal(N,o).add(I))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[])),W=W.concat(w[2].map((N=>A.CU.TransformNormal(N,o))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[]));const R=A.Matrix.RotationY(Math.PI/2);Y=Y.concat(mN[3].map((N=>A.CU.TransformNormal(N,R).xU(I))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[])),W=W.concat(w[3].map((N=>A.CU.TransformNormal(N,R))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[]));const D=new A.CU(0,v,0),G=A.Matrix.RotationX(Math.PI/2);Y=Y.concat(mN[4].map((N=>A.CU.TransformNormal(N,G).add(D))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[])),W=W.concat(w[4].map((N=>A.CU.TransformNormal(N,G))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[]));const g=A.Matrix.RotationX(-Math.PI/2);Y=Y.concat(mN[5].map((N=>A.CU.TransformNormal(N,g).xU(D))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[])),W=W.concat(w[5].map((N=>A.CU.TransformNormal(N,g))).map((N=>[N.x,N.y,N.z])).reduce(((N,U)=>N.concat(U)),[])),q.c._ComputeSides(d,Y,M,W,s);const l=new q.c;if(l.indices=M,l.sN=Y,l.MN=W,l.mU=s,V){const N=d===q.c.DOUBLESIDE?a.concat(a):a;l.aN=N}return l}function J(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return x(U).XN(A,U.updatable),A}q.c.CreateTiledPlane=B;q.c.CreateTiledBox=x;var d=V(13714),r=V(12601),v=V(12565);function h(N){const U=N.height||2;let V=0===N.diameterTop?0:N.diameterTop||N.diameter||1,n=0===N.diameterBottom?0:N.diameterBottom||N.diameter||1;V=V||1e-5,n=n||1e-5;const z=0|(N.tessellation||24),S=0|(N.subdivisions||1),E=!!N.hasRings,p=!!N.enclose,B=0===N.cap?0:N.cap||t.b.CAP_ALL,C=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,x=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,J=N.faceUV||new Array(3),d=N.faceColors,r=2+(1+(1!==C&&p?2:0))*(E?S:1);let h;for(h=0;h<r;h++)d&&void 0===d[h]&&(d[h]=new k.Yi(1,1,1,1));for(h=0;h<r;h++)J&&void 0===J[h]&&(J[h]=new A.Vector4(0,0,1,1));const c=[],H=[],Y=[],W=[],s=[],M=2*Math.PI*C/z;let a,mN,w;const X=(n-V)/2/U,e=A.CU.Zero(),Q=A.CU.Zero(),u=A.CU.Zero(),L=A.CU.Zero(),I=A.CU.Zero(),o=v.d.Y;let R,D,G,g=1,l=1,K=0,j=0;for(R=0;R<=S;R++)for(mN=R/S,w=(mN*(V-n)+n)/2,g=E&&0!==R&&R!==S?2:1,G=0;G<g;G++){for(E&&(l+=G),p&&(l+=2*G),D=0;D<=z;D++)a=D*M,e.x=Math.cos(-a)*w,e.y=-U/2+mN*U,e.z=Math.sin(-a)*w,0===V&&R===S?(Q.x=Y[Y.length-3*(z+1)],Q.y=Y[Y.length-3*(z+1)+1],Q.z=Y[Y.length-3*(z+1)+2]):(Q.x=e.x,Q.z=e.z,Q.y=Math.sqrt(Q.x*Q.x+Q.z*Q.z)*X,Q.normalize()),0===D&&(u.A(e),L.A(Q)),H.push(e.x,e.y,e.z),Y.push(Q.x,Q.y,Q.z),j=E?K!==l?J[l].y:J[l].w:J[l].y+(J[l].w-J[l].y)*mN,W.push(J[l].x+(J[l].z-J[l].x)*D/z,i.c?1-j:j),d&&s.push(d[l].r,d[l].g,d[l].b,d[l].a);1!==C&&p&&(H.push(e.x,e.y,e.z),H.push(0,e.y,0),H.push(0,e.y,0),H.push(u.x,u.y,u.z),A.CU.CrossToRef(o,Q,I),I.normalize(),Y.push(I.x,I.y,I.z,I.x,I.y,I.z),A.CU.CrossToRef(L,o,I),I.normalize(),Y.push(I.x,I.y,I.z,I.x,I.y,I.z),j=E?K!==l?J[l+1].y:J[l+1].w:J[l+1].y+(J[l+1].w-J[l+1].y)*mN,W.push(J[l+1].x,i.c?1-j:j),W.push(J[l+1].z,i.c?1-j:j),j=E?K!==l?J[l+2].y:J[l+2].w:J[l+2].y+(J[l+2].w-J[l+2].y)*mN,W.push(J[l+2].x,i.c?1-j:j),W.push(J[l+2].z,i.c?1-j:j),d&&(s.push(d[l+1].r,d[l+1].g,d[l+1].b,d[l+1].a),s.push(d[l+1].r,d[l+1].g,d[l+1].b,d[l+1].a),s.push(d[l+2].r,d[l+2].g,d[l+2].b,d[l+2].a),s.push(d[l+2].r,d[l+2].g,d[l+2].b,d[l+2].a))),K!==l&&(K=l)}const F=1!==C&&p?z+4:z;for(R=0,l=0;l<S;l++){let N=0,U=0,V=0,A=0;for(D=0;D<z;D++)N=R*(F+1)+D,U=(R+1)*(F+1)+D,V=R*(F+1)+(D+1),A=(R+1)*(F+1)+(D+1),c.push(N,U,V),c.push(A,V,U);1!==C&&p&&(c.push(N+2,U+2,V+2),c.push(A+2,V+2,U+2),c.push(N+4,U+4,V+4),c.push(A+4,V+4,U+4)),R=E?R+2:R+1}const P=N=>{const t=N?V/2:n/2;if(0===t)return;let q,S,E;const p=N?J[r-1]:J[0];let k=null;d&&(k=N?d[r-1]:d[0]);const B=H.length/3,x=N?U/2:-U/2,v=new A.CU(0,x,0);H.push(v.x,v.y,v.z),Y.push(0,N?1:-1,0);const h=p.y+.5*(p.w-p.y);W.push(p.x+.5*(p.z-p.x),i.c?1-h:h),k&&s.push(k.r,k.g,k.b,k.a);const M=new A.Vector2(.5,.5);for(E=0;E<=z;E++){q=2*Math.PI*E*C/z;const U=Math.cos(-q),V=Math.sin(-q);S=new A.CU(U*t,x,V*t);const n=new A.Vector2(U*M.x+.5,V*M.y+.5);H.push(S.x,S.y,S.z),Y.push(0,N?1:-1,0);const B=p.y+(p.w-p.y)*n.y;W.push(p.x+(p.z-p.x)*n.x,i.c?1-B:B),k&&s.push(k.r,k.g,k.b,k.a)}for(E=0;E<z;E++)N?(c.push(B),c.push(B+(E+2)),c.push(B+(E+1))):(c.push(B),c.push(B+(E+1)),c.push(B+(E+2)))};B!==t.b.CAP_START&&B!==t.b.CAP_ALL||P(!1),B!==t.b.CAP_END&&B!==t.b.CAP_ALL||P(!0),q.c._ComputeSides(x,H,c,Y,W,N.frontUVs,N.backUVs);const T=new q.c;return T.indices=c,T.sN=H,T.MN=Y,T.mU=W,d&&(T.aN=s),T}function c(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return h(U).XN(A,U.updatable),A}function H(N){const U=[],V=[],t=[],n=[],z=N.diameter||1,S=N.thickness||.5,E=0|(N.tessellation||16),p=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,k=E+1;for(let q=0;q<=E;q++){const N=q/E,p=q*Math.PI*2/E-Math.PI/2,B=A.Matrix.Translation(z/2,0,0).multiply(A.Matrix.RotationY(p));for(let z=0;z<=E;z++){const p=1-z/E,C=z*Math.PI*2/E+Math.PI,x=Math.cos(C),J=Math.sin(C);let d=new A.CU(x,J,0),r=d.scale(S/2);const v=new A.Vector2(N,p);r=A.CU.TransformCoordinates(r,B),d=A.CU.TransformNormal(d,B),V.push(r.x,r.y,r.z),t.push(d.x,d.y,d.z),n.push(v.x,i.c?1-v.y:v.y);const h=(q+1)%k,c=(z+1)%k;U.push(q*k+z),U.push(q*k+c),U.push(h*k+z),U.push(q*k+c),U.push(h*k+c),U.push(h*k+z)}}q.c._ComputeSides(p,V,U,t,n,N.frontUVs,N.backUVs);const B=new q.c;return B.indices=U,B.sN=V,B.MN=t,B.mU=n,B}function Y(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return H(U).XN(A,U.updatable),A}q.c.CreateCylinder=h,t.b.CreateCylinder=(N,U,V,A,n,q,i,z,S)=>{void 0!==i&&i instanceof r.e||(void 0!==i&&(S=z||t.b.DEFAULTSIDE,z=i),i=q,q=1);return c(N,{height:U,diameterTop:V,diameterBottom:A,tessellation:n,subdivisions:q,sideOrientation:S,updatable:z},i)};function W(N){const U=[],V=[],t=[],n=[],z=N.radius||2,S=N.tube||.5,E=N.radialSegments||32,p=N.tubularSegments||32,k=N.p||2,B=N.q||3,C=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,x=N=>{const U=Math.cos(N),V=Math.sin(N),t=B/k*N,n=Math.cos(t),q=z*(2+n)*.5*U,i=z*(2+n)*V*.5,S=z*Math.sin(t)*.5;return new A.CU(q,i,S)};let J,d;for(J=0;J<=E;J++){const N=J%E/E*2*k*Math.PI,U=x(N),t=x(N+.01),q=t.xU(U);let z=t.add(U);const B=A.CU.Cross(q,z);for(z=A.CU.Cross(B,q),B.normalize(),z.normalize(),d=0;d<p;d++){const N=d%p/p*2*Math.PI,A=-S*Math.cos(N),t=S*Math.sin(N);V.push(U.x+A*z.x+t*B.x),V.push(U.y+A*z.y+t*B.y),V.push(U.z+A*z.z+t*B.z),n.push(J/E),n.push(i.c?1-d/p:d/p)}}for(J=0;J<E;J++)for(d=0;d<p;d++){const N=(d+1)%p,V=J*p+d,A=(J+1)*p+d,t=(J+1)*p+N,n=J*p+N;U.push(n),U.push(A),U.push(V),U.push(n),U.push(t),U.push(A)}q.c.ComputeNormals(V,U,t),q.c._ComputeSides(C,V,U,t,n,N.frontUVs,N.backUVs);const r=new q.c;return r.indices=U,r.sN=V,r.MN=t,r.mU=n,r}function s(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return W(U).XN(A,U.updatable),A}q.c.CreateTorus=H,t.b.CreateTorus=(N,U,V,A,t,n,q)=>Y(N,{diameter:U,thickness:V,tessellation:A,sideOrientation:q,updatable:n},t);q.c.CreateTorusKnot=W,t.b.CreateTorusKnot=(N,U,V,A,t,n,q,i,z,S)=>s(N,{radius:U,tube:V,radialSegments:A,tubularSegments:t,p:n,q:q,sideOrientation:S,updatable:z},i);var M=V(14232),a=V(12907),mN=V(12576);function w(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=U.path,n=U.shape,q=U.scale||1,i=U.rotation||0,z=0===U.cap?0:U.cap||t.b.NO_CAP,S=U.updatable,E=t.b._GetDefaultSideOrientation(U.sideOrientation),p=U.instance||null,k=U.invertUV||!1,B=U.closeShape||!1,C=U.closePath||!1,x=U.capFunction||null;return e(N,n,A,q,i,null,null,C,B,z,!1,V,!!S,E,p,k,U.frontUVs||null,U.backUVs||null,U.firstNormal||null,!!U.adjustFrame,x)}function X(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=U.path,n=U.shape,q=U.scaleFunction||(()=>1),i=U.rotationFunction||(()=>0),z=U.closePath||U.ribbonCloseArray||!1,S=U.closeShape||U.ribbonClosePath||!1,E=0===U.cap?0:U.cap||t.b.NO_CAP,p=U.updatable,k=U.firstNormal||null,B=U.adjustFrame||!1,C=t.b._GetDefaultSideOrientation(U.sideOrientation),x=U.instance,J=U.invertUV||!1,d=U.capFunction||null;return e(N,n,A,null,null,q,i,z,S,E,!0,V,!!p,C,x||null,J,U.frontUVs||null,U.backUVs||null,k,B,d||null)}function e(N,U,V,n,q,i,z,E,p,k,B,C,x,J,d,r,v,h,c,H,Y){const W=(N,U,V,n,q,i,z,S,E,p,k)=>{const B=V.getTangents(),C=V.getNormals(),x=V.getBinormals(),J=V.getDistances();if(k)for(let t=0;t<B.length;t++)if(0==B[t].x&&0==B[t].y&&0==B[t].z&&B[t].A(B[t-1]),0==C[t].x&&0==C[t].y&&0==C[t].z&&C[t].A(C[t-1]),0==x[t].x&&0==x[t].y&&0==x[t].z&&x[t].A(x[t-1]),t>0){let N=B[t-1];A.CU.Dot(N,B[t])<0&&B[t].scaleInPlace(-1),N=C[t-1],A.CU.Dot(N,C[t])<0&&C[t].scaleInPlace(-1),N=x[t-1],A.CU.Dot(N,x[t])<0&&x[t].scaleInPlace(-1)}let d=0;const r=p&&S?S:()=>null!==i?i:0,v=p&&z?z:()=>null!==q?q:1;let h=E===t.b.NO_CAP||E===t.b.CAP_END?0:2;const c=A.TmpVectors.Matrix[0];for(let t=0;t<U.length;t++){const V=[],q=r(t,J[t]),i=v(t,J[t]);A.Matrix.RotationAxisToRef(B[t],d,c);for(let n=0;n<N.length;n++){const q=B[t].scale(N[n].z).add(C[t].scale(N[n].x)).add(x[t].scale(N[n].y)),z=A.CU.Zero();A.CU.TransformCoordinatesToRef(q,c,z),z.scaleInPlace(i).addInPlace(U[t]),V[n]=z}n[h]=V,d+=q,h++}const H=Y||(N=>{const U=Array(),V=A.CU.Zero();let t;for(t=0;t<N.length;t++)V.addInPlace(N[t]);for(V.scaleInPlace(1/N.length),t=0;t<N.length;t++)U.push(V);return U});switch(E){case t.b.NO_CAP:break;case t.b.CAP_START:n[0]=H(n[2]),n[1]=n[2];break;case t.b.CAP_END:n[h]=n[h-1],n[h+1]=H(n[h-1]);break;case t.b.CAP_ALL:n[0]=H(n[2]),n[1]=n[2],n[h]=n[h-1],n[h+1]=H(n[h-1])}return n};let s,M;if(d){const N=d._creationDataStorage;return s=c?N.path3D.update(V,c):N.path3D.update(V),M=W(U,V,N.path3D,N.pathArray,n,q,i,z,N.cap,B,H),d=S("",{pathArray:M,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:d},C||void 0)}s=c?new mN.n(V,c):new mN.n(V);M=W(U,V,s,new Array,n,q,i,z,k=k<0||k>3?0:k,B,H);const a=S(N,{pathArray:M,closeArray:E,closePath:p,updatable:x,sideOrientation:J,invertUV:r,frontUVs:v||void 0,backUVs:h||void 0},C);return a._creationDataStorage.pathArray=M,a._creationDataStorage.path3D=s,a._creationDataStorage.cap=k,a}function Q(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=U.arc?U.arc<=0||U.arc>1?1:U.arc:1,q=void 0===U.closed||U.closed,i=U.shape,z=U.radius||1,E=U.tessellation||64,p=U.clip||0,k=U.updatable,B=t.b._GetDefaultSideOrientation(U.sideOrientation),C=U.cap||t.b.NO_CAP,x=2*Math.PI,J=[],d=U.invertUV||!1;let r=0,v=0;const h=x/E*n;let c,H;for(r=0;r<=E-p;r++){for(H=[],C!=t.b.CAP_START&&C!=t.b.CAP_ALL||(H.push(new A.CU(0,i[0].y,0)),H.push(new A.CU(Math.cos(r*h)*i[0].x*z,i[0].y,Math.sin(r*h)*i[0].x*z))),v=0;v<i.length;v++)c=new A.CU(Math.cos(r*h)*i[v].x*z,i[v].y,Math.sin(r*h)*i[v].x*z),H.push(c);C!=t.b.CAP_END&&C!=t.b.CAP_ALL||(H.push(new A.CU(Math.cos(r*h)*i[i.length-1].x*z,i[i.length-1].y,Math.sin(r*h)*i[i.length-1].x*z)),H.push(new A.CU(0,i[i.length-1].y,0))),J.push(H)}return S(N,{pathArray:J,closeArray:q,sideOrientation:B,updatable:k,invertUV:d,frontUVs:U.frontUVs,backUVs:U.backUVs},V)}t.b.ExtrudeShape=function(N,U,V,A,n,q){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0,E=arguments.length>9?arguments[9]:void 0;return w(N,{shape:U,path:V,scale:A,rotation:n,cap:0===q?0:q||t.b.NO_CAP,sideOrientation:S,instance:E,updatable:z},i)},t.b.ExtrudeShapeCustom=(N,U,V,A,n,q,i,z,S,E,p,k)=>X(N,{shape:U,path:V,scaleFunction:A,rotationFunction:n,ribbonCloseArray:q,ribbonClosePath:i,cap:0===z?0:z||t.b.NO_CAP,sideOrientation:p,instance:k,updatable:E},S);t.b.CreateLathe=(N,U,V,A,t,n,q)=>Q(N,{shape:U,radius:V,tessellation:A,sideOrientation:q,updatable:n},t);var u=V(13623),L=V(13576);function I(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=U.path;let q=U.instance,i=1;void 0!==U.radius?i=U.radius:q&&(i=q._creationDataStorage.radius);const z=U.tessellation||64,E=U.radiusFunction||null;let p=U.cap||t.b.NO_CAP;const k=U.invertUV||!1,B=U.updatable,C=t.b._GetDefaultSideOrientation(U.sideOrientation);U.arc=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1;const x=(N,U,V,n,q,i,z,S)=>{const E=U.getTangents(),p=U.getNormals(),k=U.getDistances(),B=2*Math.PI/q*S,C=i||(()=>n);let x,J,d,r;const v=A.TmpVectors.Matrix[0];let h=z===t.b.NO_CAP||z===t.b.CAP_END?0:2;for(let t=0;t<N.length;t++){J=C(t,k[t]),x=Array(),d=p[t];for(let U=0;U<q;U++)A.Matrix.RotationAxisToRef(E[t],B*U,v),r=x[U]?x[U]:A.CU.Zero(),A.CU.TransformCoordinatesToRef(d,v,r),r.scaleInPlace(J).addInPlace(N[t]),x[U]=r;V[h]=x,h++}const c=(U,V)=>{const A=Array();for(let t=0;t<U;t++)A.push(N[V]);return A};switch(z){case t.b.NO_CAP:break;case t.b.CAP_START:V[0]=c(q,0),V[1]=V[2].slice(0);break;case t.b.CAP_END:V[h]=V[h-1].slice(0),V[h+1]=c(q,N.length-1);break;case t.b.CAP_ALL:V[0]=c(q,0),V[1]=V[2].slice(0),V[h]=V[h-1].slice(0),V[h+1]=c(q,N.length-1)}return V};let J,d;if(q){const N=q._creationDataStorage,V=U.arc||N.arc;return J=N.path3D.update(n),d=x(n,J,N.pathArray,i,N.tessellation,E,N.cap,V),q=S("",{pathArray:d,instance:q}),N.path3D=J,N.pathArray=d,N.arc=V,N.radius=i,q}J=new mN.n(n);p=p<0||p>3?0:p,d=x(n,J,new Array,i,z,E,p,U.arc);const r=S(N,{pathArray:d,closePath:!0,closeArray:!1,updatable:B,sideOrientation:C,invertUV:k,frontUVs:U.frontUVs,backUVs:U.backUVs},V);return r._creationDataStorage.pathArray=d,r._creationDataStorage.path3D=J,r._creationDataStorage.tessellation=z,r._creationDataStorage.cap=p,r._creationDataStorage.arc=U.arc,r._creationDataStorage.radius=i,r}function o(N){const U=[];U[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},U[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},U[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},U[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},U[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},U[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},U[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},U[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},U[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},U[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},U[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},U[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},U[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},U[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},U[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const V=N.type&&(N.type<0||N.type>=U.length)?0:N.type||0,t=N.size,n=N.sizeX||t||1,z=N.sizeY||t||1,S=N.sizeZ||t||1,E=N.custom||U[V],p=E.face.length,B=N.faceUV||new Array(p),C=N.faceColors,x=void 0===N.flat||N.flat,J=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,d=[],r=[],v=[],h=[],c=[];let H=0,Y=0;const W=[];let s,M,a,mN,w,X,e=0,Q=0;if(x)for(Q=0;Q<p;Q++)C&&void 0===C[Q]&&(C[Q]=new k.Yi(1,1,1,1)),B&&void 0===B[Q]&&(B[Q]=new A.Vector4(0,0,1,1));if(x)for(Q=0;Q<p;Q++){const N=E.face[Q].length;for(a=2*Math.PI/N,mN=.5*Math.tan(a/2),w=.5,e=0;e<N;e++)d.push(E.vertex[E.face[Q][e]][0]*n,E.vertex[E.face[Q][e]][1]*z,E.vertex[E.face[Q][e]][2]*S),W.push(H),H++,s=B[Q].x+(B[Q].z-B[Q].x)*(.5+mN),M=B[Q].y+(B[Q].w-B[Q].y)*(w-.5),h.push(s,i.c?1-M:M),X=mN*Math.cos(a)-w*Math.sin(a),w=mN*Math.sin(a)+w*Math.cos(a),mN=X,C&&c.push(C[Q].r,C[Q].g,C[Q].b,C[Q].a);for(e=0;e<N-2;e++)r.push(W[0+Y],W[e+2+Y],W[e+1+Y]);Y+=N}else{for(e=0;e<E.vertex.length;e++)d.push(E.vertex[e][0]*n,E.vertex[e][1]*z,E.vertex[e][2]*S),h.push(0,i.c?1:0);for(Q=0;Q<p;Q++)for(e=0;e<E.face[Q].length-2;e++)r.push(E.face[Q][0],E.face[Q][e+2],E.face[Q][e+1])}q.c.ComputeNormals(d,r,v),q.c._ComputeSides(J,d,r,v,h,N.frontUVs,N.backUVs);const u=new q.c;return u.sN=d,u.indices=r,u.MN=v,u.mU=h,C&&x&&(u.aN=c),u}function R(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return o(U).XN(A,U.updatable),A}t.b.CreateTube=(N,U,V,A,t,n,q,i,z,S)=>I(N,{path:U,radius:V,tessellation:A,radiusFunction:t,arc:1,cap:n,updatable:i,sideOrientation:z,instance:S},q);function D(N){const U=N.sideOrientation||q.c.DEFAULTSIDE,V=N.radius||1,t=void 0===N.flat||N.flat,n=0|(N.subdivisions||4),z=N.radiusX||V,S=N.radiusY||V,E=N.radiusZ||V,p=(1+Math.sqrt(5))/2,k=[-1,p,-0,1,p,0,-1,-p,0,1,-p,0,0,-1,-p,0,1,-p,0,-1,p,0,1,p,p,0,1,p,0,-1,-p,0,1,-p,0,-1],B=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],C=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],x=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],J=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],d=[],r=[],v=[],h=[];let c=0;const H=new Array(3),Y=new Array(3);let W;for(W=0;W<3;W++)H[W]=A.CU.Zero(),Y[W]=A.Vector2.Zero();for(let q=0;q<20;q++){for(W=0;W<3;W++){const N=B[3*q+W];H[W].hi(k[3*C[N]],k[3*C[N]+1],k[3*C[N]+2]),H[W].normalize(),Y[W].hi(.134765625*x[2*N]+.05859375+-.0390625*J[q],.2333984375*x[2*N+1]+.025390625+.01953125*J[q])}const N=(N,U,V,q)=>{const p=A.CU.Lerp(H[0],H[2],U/n),k=A.CU.Lerp(H[1],H[2],U/n),B=n===U?H[2]:A.CU.Lerp(p,k,N/(n-U));let C;if(B.normalize(),t){const N=A.CU.Lerp(H[0],H[2],q/n),U=A.CU.Lerp(H[1],H[2],q/n);C=A.CU.Lerp(N,U,V/(n-q))}else C=new A.CU(B.x,B.y,B.z);C.x/=z,C.y/=S,C.z/=E,C.normalize();const x=A.Vector2.Lerp(Y[0],Y[2],U/n),J=A.Vector2.Lerp(Y[1],Y[2],U/n),W=n===U?Y[2]:A.Vector2.Lerp(x,J,N/(n-U));r.push(B.x*z,B.y*S,B.z*E),v.push(C.x,C.y,C.z),h.push(W.x,i.c?1-W.y:W.y),d.push(c),c++};for(let U=0;U<n;U++)for(let V=0;V+U<n;V++)N(V,U,V+1/3,U+1/3),N(V+1,U,V+1/3,U+1/3),N(V,U+1,V+1/3,U+1/3),V+U+1<n&&(N(V+1,U,V+2/3,U+2/3),N(V+1,U+1,V+2/3,U+2/3),N(V,U+1,V+2/3,U+2/3))}q.c._ComputeSides(U,r,d,v,h,N.frontUVs,N.backUVs);const s=new q.c;return s.indices=d,s.sN=r,s.MN=v,s.mU=h,s}function G(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new t.b(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),A._originalBuilderSideOrientation=U.sideOrientation;return D(U).XN(A,U.updatable),A}q.c.CreatePolyhedron=o,t.b.CreatePolyhedron=(N,U,V)=>R(N,U,V);q.c.CreateIcoSphere=D,t.b.CreateIcoSphere=(N,U,V)=>G(N,U,V);var g=V(12395);const l=new A.CU(1,0,0),K=new A.CU(-1,0,0),j=new A.CU(0,1,0),F=new A.CU(0,-1,0),P=new A.CU(0,0,1),T=new A.CU(0,0,-1);class f{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.CU.Zero(),U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.CU.Up(),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.Vector2.Zero(),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=N,this.normal=U,this.uv=V,this.vertexIdx=t,this.vertexIdxForBones=n,this.localPositionOverride=q,this.localNormalOverride=i,this.matrixIndicesOverride=z,this.matrixWeightsOverride=S}clone(){var N,U,V,A;return new f(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(N=this.localPositionOverride)||void 0===N?void 0:N.slice(),null===(U=this.localNormalOverride)||void 0===U?void 0:U.slice(),null===(V=this.matrixIndicesOverride)||void 0===V?void 0:V.slice(),null===(A=this.matrixWeightsOverride)||void 0===A?void 0:A.slice())}}function O(N,U,V){var z,S,E,p,k;const B=!!U.skeleton,C=!(null===(z=U.morphTargetManager)||void 0===z||!z.numTargets),x=V.localMode||B,J=U.di(),d=B||C?U.oi(!0,!0):U.getVerticesData(n.f.PositionKind),r=B||C?U.getNormalsData(!0,!0):U.getVerticesData(n.f.NormalKind),v=x?B?U.getVerticesData(n.f.PositionKind):d:null,h=x?B?U.getVerticesData(n.f.NormalKind):r:null,c=U.getVerticesData(n.f.UVKind),H=B?U.getVerticesData(n.f.MatricesIndicesKind):null,Y=B?U.getVerticesData(n.f.MatricesWeightsKind):null,W=B?U.getVerticesData(n.f.MatricesIndicesExtraKind):null,s=B?U.getVerticesData(n.f.MatricesWeightsExtraKind):null,M=V.position||A.CU.Zero();let a=V.normal||A.CU.Up();const mN=V.size||A.CU.One(),w=V.angle||0;if(!a){const N=new A.CU(0,0,1),V=U.YN().activeCamera,t=A.CU.TransformCoordinates(N,V.getWorldMatrix());a=V.globalPosition.xU(t)}const X=-Math.atan2(a.z,a.x)-Math.PI/2,e=Math.sqrt(a.x*a.x+a.z*a.z),Q=Math.atan2(a.y,e),u=new q.c;u.indices=[],u.sN=[],u.MN=[],u.mU=[],u.matricesIndices=B?[]:null,u.matricesWeights=B?[]:null,u.matricesIndicesExtra=W?[]:null,u.matricesWeightsExtra=s?[]:null;let L=0;const I=(N,U)=>{const t=new f;if(!J||!d||!r)return t;const n=J[N];if(t.vertexIdx=3*n,t.vertexIdxForBones=4*n,t.position=new A.CU(d[3*n],d[3*n+1],d[3*n+2]),A.CU.TransformCoordinatesToRef(t.position,U,t.position),t.normal=new A.CU(r[3*n],r[3*n+1],r[3*n+2]),A.CU.TransformNormalToRef(t.normal,U,t.normal),V.captureUVS&&c){const N=c[2*n+1];t.uv=new A.Vector2(c[2*n],i.c?1-N:N)}return t},o=[0,0,0,0],R=(N,U)=>{if(0===N.length)return N;const V=.5*Math.abs(A.CU.Dot(mN,U)),t=(N,U,V,A)=>{for(let t=0;t<A;++t)if(N[V+t]===U)return V+t;return-1},n=(N,n)=>{const q=A.CU.GetClipFactor(N.position,n.position,U,V);let i=o,z=o;if(H&&Y){const U=N.matrixIndicesOverride?0:N.vertexIdxForBones,V=N.matrixIndicesOverride??H,A=N.matrixWeightsOverride??Y,S=n.matrixIndicesOverride?0:n.vertexIdxForBones,E=n.matrixIndicesOverride??H,p=n.matrixWeightsOverride??Y;i=[0,0,0,0],z=[0,0,0,0];let k=0;for(let N=0;N<4;++N)if(A[U+N]>0){const n=t(E,V[U+N],S,4);i[k]=V[U+N],z[k]=(0,g.Lerp)(A[U+N],n>=0?p[n]:0,q),k++}for(let N=0;N<4&&k<4;++N){const A=E[S+N];-1===t(V,A,U,4)&&(i[k]=A,z[k]=(0,g.Lerp)(0,p[S+N],q),k++)}const B=z[0]+z[1]+z[2]+z[3];z[0]/=B,z[1]/=B,z[2]/=B,z[3]/=B}const S=N.localPositionOverride?N.localPositionOverride[0]:(null===v||void 0===v?void 0:v[N.vertexIdx])??0,E=N.localPositionOverride?N.localPositionOverride[1]:(null===v||void 0===v?void 0:v[N.vertexIdx+1])??0,p=N.localPositionOverride?N.localPositionOverride[2]:(null===v||void 0===v?void 0:v[N.vertexIdx+2])??0,k=n.localPositionOverride?n.localPositionOverride[0]:(null===v||void 0===v?void 0:v[n.vertexIdx])??0,B=n.localPositionOverride?n.localPositionOverride[1]:(null===v||void 0===v?void 0:v[n.vertexIdx+1])??0,C=n.localPositionOverride?n.localPositionOverride[2]:(null===v||void 0===v?void 0:v[n.vertexIdx+2])??0,x=N.localNormalOverride?N.localNormalOverride[0]:(null===h||void 0===h?void 0:h[N.vertexIdx])??0,J=N.localNormalOverride?N.localNormalOverride[1]:(null===h||void 0===h?void 0:h[N.vertexIdx+1])??0,d=N.localNormalOverride?N.localNormalOverride[2]:(null===h||void 0===h?void 0:h[N.vertexIdx+2])??0,r=x+((n.localNormalOverride?n.localNormalOverride[0]:(null===h||void 0===h?void 0:h[n.vertexIdx])??0)-x)*q,c=J+((n.localNormalOverride?n.localNormalOverride[1]:(null===h||void 0===h?void 0:h[n.vertexIdx+1])??0)-J)*q,W=d+((n.localNormalOverride?n.localNormalOverride[2]:(null===h||void 0===h?void 0:h[n.vertexIdx+2])??0)-d)*q,s=Math.sqrt(r*r+c*c+W*W);return new f(A.CU.Lerp(N.position,n.position,q),A.CU.Lerp(N.normal,n.normal,q).normalize(),A.Vector2.Lerp(N.uv,n.uv,q),-1,-1,v?[S+(k-S)*q,E+(B-E)*q,p+(C-p)*q]:null,h?[r/s,c/s,W/s]:null,i,z)};let q=null;N.length>3&&(q=[]);for(let i=0;i<N.length;i+=3){let t=0,z=null,S=null,E=null,p=null;const k=A.CU.Dot(N[i].position,U)-V>0,B=A.CU.Dot(N[i+1].position,U)-V>0,C=A.CU.Dot(N[i+2].position,U)-V>0;switch(t=(k?1:0)+(B?1:0)+(C?1:0),t){case 0:N.length>3?(q.push(N[i]),q.push(N[i+1]),q.push(N[i+2])):q=N;break;case 1:if(q=q??new Array,k&&(z=N[i+1],S=N[i+2],E=n(N[i],z),p=n(N[i],S)),B){z=N[i],S=N[i+2],E=n(N[i+1],z),p=n(N[i+1],S),q.push(E),q.push(S.clone()),q.push(z.clone()),q.push(S.clone()),q.push(E.clone()),q.push(p);break}C&&(z=N[i],S=N[i+1],E=n(N[i+2],z),p=n(N[i+2],S)),z&&S&&E&&p&&(q.push(z.clone()),q.push(S.clone()),q.push(E),q.push(p),q.push(E.clone()),q.push(S.clone()));break;case 2:q=q??new Array,k||(z=N[i].clone(),S=n(z,N[i+1]),E=n(z,N[i+2]),q.push(z),q.push(S),q.push(E)),B||(z=N[i+1].clone(),S=n(z,N[i+2]),E=n(z,N[i]),q.push(z),q.push(S),q.push(E)),C||(z=N[i+2].clone(),S=n(z,N[i]),E=n(z,N[i+1]),q.push(z),q.push(S),q.push(E))}}return q},D=U instanceof t.b?U:null,G=null===D||void 0===D?void 0:D._thinInstanceDataStorage.matrixData,O=(null===D||void 0===D?void 0:D.si)||1,Z=A.TmpVectors.Matrix[0];Z.A(A.Matrix.IdentityReadOnly);for(let t=0;t<O;++t){if(null!==D&&void 0!==D&&D.hasThinInstances&&G){const N=16*t;Z.setRowFromFloats(0,G[N+0],G[N+1],G[N+2],G[N+3]),Z.setRowFromFloats(1,G[N+4],G[N+5],G[N+6],G[N+7]),Z.setRowFromFloats(2,G[N+8],G[N+9],G[N+10],G[N+11]),Z.setRowFromFloats(3,G[N+12],G[N+13],G[N+14],G[N+15])}const N=A.Matrix.RotationYawPitchRoll(X,Q,w).multiply(A.Matrix.Translation(M.x,M.y,M.z)),n=A.Matrix.Invert(N),q=U.getWorldMatrix(),z=Z.multiply(q).multiply(n),S=new Array(3);for(let U=0;U<J.length;U+=3){let N=S;if(N[0]=I(U,z),N[1]=I(U+1,z),N[2]=I(U+2,z),!(V.cullBackFaces&&-N[0].normal.z<=0&&-N[1].normal.z<=0&&-N[2].normal.z<=0)&&(N=R(N,l),N&&(N=R(N,K),N&&(N=R(N,j),N&&(N=R(N,F),N&&(N=R(N,P),N&&(N=R(N,T),N)))))))for(let U=0;U<N.length;U++){const A=N[U];if(u.indices.push(L),x?(A.localPositionOverride?(u.sN[3*L]=A.localPositionOverride[0],u.sN[3*L+1]=A.localPositionOverride[1],u.sN[3*L+2]=A.localPositionOverride[2]):v&&(u.sN[3*L]=v[A.vertexIdx],u.sN[3*L+1]=v[A.vertexIdx+1],u.sN[3*L+2]=v[A.vertexIdx+2]),A.localNormalOverride?(u.MN[3*L]=A.localNormalOverride[0],u.MN[3*L+1]=A.localNormalOverride[1],u.MN[3*L+2]=A.localNormalOverride[2]):h&&(u.MN[3*L]=h[A.vertexIdx],u.MN[3*L+1]=h[A.vertexIdx+1],u.MN[3*L+2]=h[A.vertexIdx+2])):(A.position.toArray(u.sN,3*L),A.normal.toArray(u.MN,3*L)),u.matricesIndices&&u.matricesWeights&&(A.matrixIndicesOverride?(u.matricesIndices[4*L]=A.matrixIndicesOverride[0],u.matricesIndices[4*L+1]=A.matrixIndicesOverride[1],u.matricesIndices[4*L+2]=A.matrixIndicesOverride[2],u.matricesIndices[4*L+3]=A.matrixIndicesOverride[3]):(H&&(u.matricesIndices[4*L]=H[A.vertexIdxForBones],u.matricesIndices[4*L+1]=H[A.vertexIdxForBones+1],u.matricesIndices[4*L+2]=H[A.vertexIdxForBones+2],u.matricesIndices[4*L+3]=H[A.vertexIdxForBones+3]),W&&u.matricesIndicesExtra&&(u.matricesIndicesExtra[4*L]=W[A.vertexIdxForBones],u.matricesIndicesExtra[4*L+1]=W[A.vertexIdxForBones+1],u.matricesIndicesExtra[4*L+2]=W[A.vertexIdxForBones+2],u.matricesIndicesExtra[4*L+3]=W[A.vertexIdxForBones+3])),A.matrixWeightsOverride?(u.matricesWeights[4*L]=A.matrixWeightsOverride[0],u.matricesWeights[4*L+1]=A.matrixWeightsOverride[1],u.matricesWeights[4*L+2]=A.matrixWeightsOverride[2],u.matricesWeights[4*L+3]=A.matrixWeightsOverride[3]):(Y&&(u.matricesWeights[4*L]=Y[A.vertexIdxForBones],u.matricesWeights[4*L+1]=Y[A.vertexIdxForBones+1],u.matricesWeights[4*L+2]=Y[A.vertexIdxForBones+2],u.matricesWeights[4*L+3]=Y[A.vertexIdxForBones+3]),s&&u.matricesWeightsExtra&&(u.matricesWeightsExtra[4*L]=s[A.vertexIdxForBones],u.matricesWeightsExtra[4*L+1]=s[A.vertexIdxForBones+1],u.matricesWeightsExtra[4*L+2]=s[A.vertexIdxForBones+2],u.matricesWeightsExtra[4*L+3]=s[A.vertexIdxForBones+3]))),V.captureUVS)A.uv.toArray(u.mU,2*L);else{u.mU.push(.5+A.position.x/mN.x);const N=.5+A.position.y/mN.y;u.mU.push(i.c?1-N:N)}L++}}}0===u.indices.length&&(u.indices=null),0===u.sN.length&&(u.sN=null),0===u.MN.length&&(u.MN=null),0===u.mU.length&&(u.mU=null),0===(null===(S=u.matricesIndices)||void 0===S?void 0:S.length)&&(u.matricesIndices=null),0===(null===(E=u.matricesWeights)||void 0===E?void 0:E.length)&&(u.matricesWeights=null),0===(null===(p=u.matricesIndicesExtra)||void 0===p?void 0:p.length)&&(u.matricesIndicesExtra=null),0===(null===(k=u.matricesWeightsExtra)||void 0===k?void 0:k.length)&&(u.matricesWeightsExtra=null);const b=new t.b(N,U.YN());return u.XN(b),x?(b.skeleton=U.skeleton,b.parent=U):(b.position=M.clone(),b.rotation=new A.CU(Q,X,w)),b.xi(!0),b.refreshBoundingInfo(!0,!0),b}function Z(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const U=0|Math.max(N.subdivisions?N.subdivisions:2,1),V=0|Math.max(N.tessellation?N.tessellation:16,3),t=Math.max(N.height?N.height:1,0),n=Math.max(N.radius?N.radius:.25,0),z=0|Math.max(N.capSubdivisions?N.capSubdivisions:6,1),S=V,E=U,p=Math.max(N.radiusTop?N.radiusTop:n,0),k=Math.max(N.radiusBottom?N.radiusBottom:n,0),B=t-(p+k),C=2*Math.PI,x=Math.max(N.topCapSubdivisions?N.topCapSubdivisions:z,1),J=Math.max(N.bottomCapSubdivisions?N.bottomCapSubdivisions:z,1),d=Math.acos((k-p)/t);let r=[];const v=[],h=[],c=[];let H=0;const Y=[],W=.5*B,s=.5*Math.PI;let M,a;const mN=A.CU.Zero(),w=A.CU.Zero(),X=Math.cos(d),e=Math.sin(d),Q=new A.Vector2(p*e,W+p*X).xU(new A.Vector2(k*e,k*X-W)).length(),u=p*d+Q+k*(s-d);let L=0;for(a=0;a<=x;a++){const N=[],U=s-d*(a/x);L+=p*d/x;const V=Math.cos(U),A=Math.sin(U),t=V*p;for(M=0;M<=S;M++){const U=M/S,n=U*C+0,q=Math.sin(n),z=Math.cos(n);w.x=t*q,w.y=W+A*p,w.z=t*z,v.push(w.x,w.y,w.z),mN.set(V*q,A,V*z),h.push(mN.x,mN.y,mN.z),c.push(U,i.c?L/u:1-L/u),N.push(H),H++}Y.push(N)}const I=t-p-k+X*p-X*k,o=e*(k-p)/I;for(a=1;a<=E;a++){const N=[];L+=Q/E;const U=e*(a*(k-p)/E+p);for(M=0;M<=S;M++){const V=M/S,A=V*C+0,t=Math.sin(A),n=Math.cos(A);w.x=U*t,w.y=W+X*p-a*I/E,w.z=U*n,v.push(w.x,w.y,w.z),mN.set(t,o,n).normalize(),h.push(mN.x,mN.y,mN.z),c.push(V,i.c?L/u:1-L/u),N.push(H),H++}Y.push(N)}for(a=1;a<=J;a++){const N=[],U=s-d-(Math.PI-d)*(a/J);L+=k*d/J;const V=Math.cos(U),A=Math.sin(U),t=V*k;for(M=0;M<=S;M++){const U=M/S,n=U*C+0,q=Math.sin(n),z=Math.cos(n);w.x=t*q,w.y=A*k-W,w.z=t*z,v.push(w.x,w.y,w.z),mN.set(V*q,A,V*z),h.push(mN.x,mN.y,mN.z),c.push(U,i.c?L/u:1-L/u),N.push(H),H++}Y.push(N)}for(M=0;M<S;M++)for(a=0;a<x+E+J;a++){const N=Y[a][M],U=Y[a+1][M],V=Y[a+1][M+1],A=Y[a][M+1];r.push(N),r.push(U),r.push(A),r.push(U),r.push(V),r.push(A)}if(r=r.reverse(),N.orientation&&!N.orientation.equals(A.CU.Up())){const U=new A.Matrix;N.orientation.clone().scale(.5*Math.PI).cross(A.CU.Up()).toQuaternion().toRotationMatrix(U);const V=A.CU.Zero();for(let N=0;N<v.length;N+=3)V.set(v[N],v[N+1],v[N+2]),A.CU.TransformCoordinatesToRef(V.clone(),U,V),v[N]=V.x,v[N+1]=V.y,v[N+2]=V.z}const R=new q.c;return R.sN=v,R.MN=h,R.mU=c,R.indices=r,R}function b(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:A.CU.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new t.b(N,V);return Z(U).XN(n,U.updatable),n}t.b.CreateDecal=(N,U,V,A,t,n)=>O(N,U,{position:V,normal:A,size:t,angle:n});t.b.CreateCapsule=(N,U,V)=>b(N,U,V),q.c.CreateCapsule=Z;var y=V(12193),NN=V(12389);class UN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=N,this.y=U,N!==Math.floor(N)&&(N=Math.floor(N),y.b.Warn("x is not an integer, floor(x) used")),U!==Math.floor(U)&&(U=Math.floor(U),y.b.Warn("y is not an integer, floor(y) used"))}clone(){return new UN(this.x,this.y)}rotate60About(N){const U=this.x;return this.x=N.x+N.y-this.y,this.y=U+this.y-N.x,this}rotateNeg60About(N){const U=this.x;return this.x=U+this.y-N.y,this.y=N.x+N.y-U,this}rotate120(N,U){N!==Math.floor(N)&&(N=Math.floor(N),y.b.Warn("m not an integer only floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),y.b.Warn("n not an integer only floor(n) used"));const V=this.x;return this.x=N-V-this.y,this.y=U+V,this}rotateNeg120(N,U){N!==Math.floor(N)&&(N=Math.floor(N),y.b.Warn("m is not an integer, floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),y.b.Warn("n is not an integer,   floor(n) used"));const V=this.x;return this.x=this.y-U,this.y=N+U-V-this.y,this}toCartesianOrigin(N,U){const V=A.CU.Zero();return V.x=N.x+2*this.x*U+this.y*U,V.y=N.y+Math.sqrt(3)*this.y*U,V}static Zero(){return new UN(0,0)}}class VN{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new AN("icosahedron","Regular",[[0,NN.f,-1],[-NN.f,1,0],[-1,0,-NN.f],[1,0,-NN.f],[NN.f,1,0],[0,NN.f,1],[-1,0,NN.f],[-NN.f,-1,0],[0,-NN.f,-1],[NN.f,-1,0],[1,0,NN.f],[0,-NN.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let N=12;const U={},V=this.m,A=this.n;let t,n,q,i,z,S=V,E=1,p=0;0!==A&&(S=(0,g.HighestCommonFactor)(V,A)),E=V/S,p=A/S;const k=UN.Zero(),B=new UN(V,A),C=new UN(-A,V+A),x=UN.Zero(),J=UN.Zero(),d=UN.Zero();let r,v,h,c,H=[];const Y=[],W=this.vertByDist,s=(V,A,t,n)=>{r=V+"|"+t,v=A+"|"+n,r in U||v in U?r in U&&!(v in U)?U[v]=U[r]:v in U&&!(r in U)&&(U[r]=U[v]):(U[r]=N,U[v]=N,N++),W[t][0]>2?Y[U[r]]=[-W[t][0],W[t][1],U[r]]:Y[U[r]]=[H[W[t][0]],W[t][1],U[r]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let M=0;M<20;M++){if(H=this.IDATA.face[M],q=H[2],i=H[1],z=H[0],h=k.x+"|"+k.y,r=M+"|"+h,r in U||(U[r]=q,Y[q]=[H[W[h][0]],W[h][1]]),h=B.x+"|"+B.y,r=M+"|"+h,r in U||(U[r]=i,Y[i]=[H[W[h][0]],W[h][1]]),h=C.x+"|"+C.y,r=M+"|"+h,r in U||(U[r]=z,Y[z]=[H[W[h][0]],W[h][1]]),t=this.IDATA.edgematch[M][0],n=this.IDATA.edgematch[M][1],"B"===n)for(let N=1;N<S;N++)J.x=V-N*(E+p),J.y=A+N*E,d.x=-N*p,d.y=N*(E+p),h=J.x+"|"+J.y,c=d.x+"|"+d.y,s(M,t,h,c);if("O"===n)for(let N=1;N<S;N++)d.x=-N*p,d.y=N*(E+p),x.x=N*E,x.y=N*p,h=d.x+"|"+d.y,c=x.x+"|"+x.y,s(M,t,h,c);if(t=this.IDATA.edgematch[M][2],n=this.IDATA.edgematch[M][3],n&&"A"===n)for(let N=1;N<S;N++)x.x=N*E,x.y=N*p,J.x=V-(S-N)*(E+p),J.y=A+(S-N)*E,h=x.x+"|"+x.y,c=J.x+"|"+J.y,s(M,t,h,c);for(let V=0;V<this.vertices.length;V++)h=this.vertices[V].x+"|"+this.vertices[V].y,r=M+"|"+h,r in U||(U[r]=N++,W[h][0]>2?Y[U[r]]=[-W[h][0],W[h][1],U[r]]:Y[U[r]]=[H[W[h][0]],W[h][1],U[r]])}this.closestTo=Y,this.vecToidx=U}calcCoeffs(){const N=this.m,U=this.n,V=Math.sqrt(3)/3,A=N*N+U*U+N*U;this.coau=(N+U)/A,this.cobu=-U/A,this.coav=-V*(N-U)/A,this.cobv=V*(2*N+U)/A}createInnerFacets(){const N=this.m,U=this.n;for(let V=0;V<U+N+1;V++)for(let N=this.min[V];N<this.max[V]+1;N++)N<this.max[V]&&N<this.max[V+1]+1&&this.innerFacets.push(["|"+N+"|"+V,"|"+N+"|"+(V+1),"|"+(N+1)+"|"+V]),V>0&&N<this.max[V-1]&&N+1<this.max[V]+1&&this.innerFacets.push(["|"+N+"|"+V,"|"+(N+1)+"|"+V,"|"+(N+1)+"|"+(V-1)])}edgeVecsABOB(){const N=this.m,U=this.n,V=new UN(-U,N+U);for(let A=1;A<N+U;A++){const N=new UN(this.min[A],A),U=new UN(this.min[A-1],A-1),t=new UN(this.min[A+1],A+1),n=N.clone(),q=U.clone(),i=t.clone();n.rotate60About(V),q.rotate60About(V),i.rotate60About(V);const z=new UN(this.max[n.y],n.y),S=new UN(this.max[n.y-1],n.y-1),E=new UN(this.max[n.y-1]-1,n.y-1);n.x===z.x&&n.y===z.y||(n.x!==S.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,S,E]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,E,z])):n.y===i.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,U,S]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([N,S,t])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,U,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,S,z])))}}mapABOBtoOBOA(){const N=new UN(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const V=[];for(let A=0;A<3;A++)N.x=this.isoVecsABOB[U][A].x,N.y=this.isoVecsABOB[U][A].y,0===this.vertexTypes[U][A]&&N.rotateNeg120(this.m,this.n),V.push(N.clone());this.isoVecsOBOA.push(V)}}mapABOBtoBAOA(){const N=new UN(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const V=[];for(let A=0;A<3;A++)N.x=this.isoVecsABOB[U][A].x,N.y=this.isoVecsABOB[U][A].y,1===this.vertexTypes[U][A]&&N.rotate120(this.m,this.n),V.push(N.clone());this.isoVecsBAOA.push(V)}}MapToFace(N,U){const V=this.IDATA.face[N],t=V[2],n=V[1],q=V[0],i=A.CU.vU(this.IDATA.vertex[t]),z=A.CU.vU(this.IDATA.vertex[n]),S=A.CU.vU(this.IDATA.vertex[q]),E=z.xU(i),p=S.xU(i),k=E.scale(this.coau).add(p.scale(this.cobu)),B=E.scale(this.coav).add(p.scale(this.cobv)),C=[];let x,J=A.TmpVectors.CU[0];for(let A=0;A<this.cartesian.length;A++)J=k.scale(this.cartesian[A].x).add(B.scale(this.cartesian[A].y)).add(i),C[A]=[J.x,J.y,J.z],x=N+"|"+this.vertices[A].x+"|"+this.vertices[A].y,U.vertex[this.vecToidx[x]]=[J.x,J.y,J.z]}build(N,U){const V=[],A=UN.Zero(),t=new UN(N,U),n=new UN(-U,N+U);V.push(A,t,n);for(let h=U;h<N+1;h++)for(let U=0;U<N+1-h;U++)V.push(new UN(U,h));if(U>0){const A=(0,g.HighestCommonFactor)(N,U),t=N/A,n=U/A;for(let i=1;i<A;i++)V.push(new UN(i*t,i*n)),V.push(new UN(-i*n,i*(t+n))),V.push(new UN(N-i*(t+n),U+i*t));const q=N/U;for(let i=1;i<U;i++)for(let A=0;A<i*q;A++)V.push(new UN(A,i)),V.push(new UN(A,i).rotate120(N,U)),V.push(new UN(A,i).rotateNeg120(N,U))}V.sort(((N,U)=>N.x-U.x)),V.sort(((N,U)=>N.y-U.y));const q=new Array(N+U+1),i=new Array(N+U+1);for(let h=0;h<q.length;h++)q[h]=1/0,i[h]=-1/0;let z=0,S=0;const E=V.length;for(let h=0;h<E;h++)S=V[h].x,z=V[h].y,q[z]=Math.min(S,q[z]),i[z]=Math.max(S,i[z]);const p=(V,A)=>{const t=V.clone();return"A"===A&&t.rotateNeg120(N,U),"B"===A&&t.rotate120(N,U),t.x<0?t.y:t.x+t.y},k=[],B=[],C=[],x=[],J={},d=[];let r=-1,v=-1;for(let h=0;h<E;h++)k[h]=V[h].toCartesianOrigin(new UN(0,0),.5),B[h]=p(V[h],"O"),C[h]=p(V[h],"A"),x[h]=p(V[h],"B"),B[h]===C[h]&&C[h]===x[h]?(r=3,v=B[h]):B[h]===C[h]?(r=4,v=B[h]):C[h]===x[h]?(r=5,v=C[h]):x[h]===B[h]&&(r=6,v=B[h]),B[h]<C[h]&&B[h]<x[h]&&(r=2,v=B[h]),C[h]<B[h]&&C[h]<x[h]&&(r=1,v=C[h]),x[h]<C[h]&&x[h]<B[h]&&(r=0,v=x[h]),d.push([r,v,V[h].x,V[h].y]);d.sort(((N,U)=>N[2]-U[2])),d.sort(((N,U)=>N[3]-U[3])),d.sort(((N,U)=>N[1]-U[1])),d.sort(((N,U)=>N[0]-U[0]));for(let h=0;h<d.length;h++)J[d[h][2]+"|"+d[h][3]]=[d[h][0],d[h][1],h];return this.m=N,this.n=U,this.vertices=V,this.vertByDist=J,this.cartesian=k,this.min=q,this.max=i,this}}class AN{constructor(N,U,V,A){this.name=N,this.category=U,this.vertex=V,this.face=A}}class tN extends AN{innerToData(N,U){for(let V=0;V<U.innerFacets.length;V++)this.face.push(U.innerFacets[V].map((V=>U.vecToidx[N+V])))}mapABOBtoDATA(N,U){const V=U.IDATA.edgematch[N][0];for(let A=0;A<U.isoVecsABOB.length;A++){const t=[];for(let n=0;n<3;n++)0===U.vertexTypes[A][n]?t.push(N+"|"+U.isoVecsABOB[A][n].x+"|"+U.isoVecsABOB[A][n].y):t.push(V+"|"+U.isoVecsABOB[A][n].x+"|"+U.isoVecsABOB[A][n].y);this.face.push([U.vecToidx[t[0]],U.vecToidx[t[1]],U.vecToidx[t[2]]])}}mapOBOAtoDATA(N,U){const V=U.IDATA.edgematch[N][0];for(let A=0;A<U.isoVecsOBOA.length;A++){const t=[];for(let n=0;n<3;n++)1===U.vertexTypes[A][n]?t.push(N+"|"+U.isoVecsOBOA[A][n].x+"|"+U.isoVecsOBOA[A][n].y):t.push(V+"|"+U.isoVecsOBOA[A][n].x+"|"+U.isoVecsOBOA[A][n].y);this.face.push([U.vecToidx[t[0]],U.vecToidx[t[1]],U.vecToidx[t[2]]])}}mapBAOAtoDATA(N,U){const V=U.IDATA.edgematch[N][2];for(let A=0;A<U.isoVecsBAOA.length;A++){const t=[];for(let n=0;n<3;n++)1===U.vertexTypes[A][n]?t.push(N+"|"+U.isoVecsBAOA[A][n].x+"|"+U.isoVecsBAOA[A][n].y):t.push(V+"|"+U.isoVecsBAOA[A][n].x+"|"+U.isoVecsBAOA[A][n].y);this.face.push([U.vecToidx[t[0]],U.vecToidx[t[1]],U.vecToidx[t[2]]])}}orderData(N){const U=[];for(let n=0;n<13;n++)U[n]=[];const V=N.closestTo;for(let n=0;n<V.length;n++)V[n][0]>-1?V[n][1]>0&&U[V[n][0]].push([n,V[n][1]]):U[12].push([n,V[n][0]]);const A=[];for(let n=0;n<12;n++)A[n]=n;let t=12;for(let n=0;n<12;n++){U[n].sort(((N,U)=>N[1]-U[1]));for(let N=0;N<U[n].length;N++)A[U[n][N][0]]=t++}for(let n=0;n<U[12].length;n++)A[U[12][n][0]]=t++;for(let n=0;n<this.vertex.length;n++)this.vertex[n].push(A[n]);this.vertex.sort(((N,U)=>N[3]-U[3]));for(let n=0;n<this.vertex.length;n++)this.vertex[n].pop();for(let n=0;n<this.face.length;n++)for(let N=0;N<this.face[n].length;N++)this.face[n][N]=A[this.face[n][N]];this.sharedNodes=U[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(N,U){const V=[],A=[];let t=U.pop();A.push(t);let n=this.face[t].indexOf(N);n=(n+2)%3;let q=this.face[t][n];V.push(q);let i=0;for(;U.length>0;)t=U[i],this.face[t].indexOf(q)>-1?(n=(this.face[t].indexOf(q)+1)%3,q=this.face[t][n],V.push(q),A.push(t),U.splice(i,1),i=0):i++;return this.adjacentFaces.push(V),A}toGoldbergPolyhedronData(){const N=new AN("GeoDual","Goldberg",[],[]);N.name="GD dual";const U=this.vertex.length,V=new Array(U);for(let z=0;z<U;z++)V[z]=[];for(let z=0;z<this.face.length;z++)for(let N=0;N<3;N++)V[this.face[z][N]].push(z);let A=0,t=0,n=0,q=[],i=[];this.adjacentFaces=[];for(let z=0;z<V.length;z++){N.face[z]=this.setOrder(z,V[z].concat([]));for(const U of V[z]){A=0,t=0,n=0,q=this.face[U];for(let N=0;N<3;N++)i=this.vertex[q[N]],A+=i[0],t+=i[1],n+=i[2];N.vertex[U]=[A/3,t/3,n/3]}}return N}static BuildGeodesicData(N){const U=new tN("Geodesic-m-n","Geodesic",[[0,NN.f,-1],[-NN.f,1,0],[-1,0,-NN.f],[1,0,-NN.f],[NN.f,1,0],[0,NN.f,1],[-1,0,NN.f],[-NN.f,-1,0],[0,-NN.f,-1],[NN.f,-1,0],[1,0,NN.f],[0,-NN.f,1]],[]);N.setIndices(),N.calcCoeffs(),N.createInnerFacets(),N.edgeVecsABOB(),N.mapABOBtoOBOA(),N.mapABOBtoBAOA();for(let V=0;V<N.IDATA.face.length;V++)N.MapToFace(V,U),U.innerToData(V,N),"B"===N.IDATA.edgematch[V][1]&&U.mapABOBtoDATA(V,N),"O"===N.IDATA.edgematch[V][1]&&U.mapOBOAtoDATA(V,N),"A"===N.IDATA.edgematch[V][3]&&U.mapBAOAtoDATA(V,N);U.orderData(N);return U.vertex=U.vertex.map((function(N){const U=N[0],V=N[1],A=N[2],t=Math.sqrt(U*U+V*V+A*A);return N[0]*=1/t,N[1]*=1/t,N[2]*=1/t,N})),U}}t.b._GoldbergMeshParser=(N,U)=>nN.Parse(N,U);class nN extends t.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(N,U){return void 0===U?(N>this.goldbergData.nbUnsharedFaces-1&&(y.b.Warn("Maximum number of unshared faces used"),N=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+N):(N>11&&(y.b.Warn("Last pole used"),N=11),U>this.goldbergData.nbFacesAtPole-1&&(y.b.Warn("Maximum number of faces at a pole used"),U=this.goldbergData.nbFacesAtPole-1),12+N*this.goldbergData.nbFacesAtPole+U)}_changeGoldbergFaceColors(N){for(let V=0;V<N.length;V++){const U=N[V][0],A=N[V][1],t=N[V][2];for(let N=U;N<A+1;N++)this.goldbergData.faceColors[N]=t}const U=[];for(let V=0;V<12;V++)for(let N=0;N<5;N++)U.push(this.goldbergData.faceColors[V].r,this.goldbergData.faceColors[V].g,this.goldbergData.faceColors[V].b,this.goldbergData.faceColors[V].a);for(let V=12;V<this.goldbergData.faceColors.length;V++)for(let N=0;N<6;N++)U.push(this.goldbergData.faceColors[V].r,this.goldbergData.faceColors[V].g,this.goldbergData.faceColors[V].b,this.goldbergData.faceColors[V].a);return U}setGoldbergFaceColors(N){const U=this._changeGoldbergFaceColors(N);this.LN(n.f.ColorKind,U)}updateGoldbergFaceColors(N){const U=this._changeGoldbergFaceColors(N);this.updateVerticesData(n.f.ColorKind,U)}_changeGoldbergFaceUVs(N){const U=this.getVerticesData(n.f.UVKind);for(let V=0;V<N.length;V++){const A=N[V][0],t=N[V][1],n=N[V][2],q=N[V][3],i=N[V][4],z=[],S=[];let E,p;for(let N=0;N<5;N++)E=n.x+q*Math.cos(i+N*Math.PI/2.5),p=n.y+q*Math.sin(i+N*Math.PI/2.5),E<0&&(E=0),E>1&&(E=1),z.push(E,p);for(let N=0;N<6;N++)E=n.x+q*Math.cos(i+N*Math.PI/3),p=n.y+q*Math.sin(i+N*Math.PI/3),E<0&&(E=0),E>1&&(E=1),S.push(E,p);for(let N=A;N<Math.min(12,t+1);N++)for(let V=0;V<5;V++)U[10*N+2*V]=z[2*V],U[10*N+2*V+1]=z[2*V+1];for(let N=Math.max(12,A);N<t+1;N++)for(let V=0;V<6;V++)U[12*N-24+2*V]=S[2*V],U[12*N-23+2*V]=S[2*V+1]}return U}setGoldbergFaceUVs(N){const U=this._changeGoldbergFaceUVs(N);this.LN(n.f.UVKind,U)}updateGoldbergFaceUVs(N){const U=this._changeGoldbergFaceUVs(N);this.updateVerticesData(n.f.UVKind,U)}placeOnGoldbergFaceAt(N,U,V){const t=A.CU.RotationFromAxis(this.goldbergData.faceXaxis[U],this.goldbergData.faceYaxis[U],this.goldbergData.faceZaxis[U]);N.rotation=t,N.position=this.goldbergData.faceCenters[U].add(this.goldbergData.faceXaxis[U].scale(V.x)).add(this.goldbergData.faceYaxis[U].scale(V.y)).add(this.goldbergData.faceZaxis[U].scale(V.z))}serialize(N){super.serialize(N),N.type="GoldbergMesh";const U={};if(U.adjacentFaces=this.goldbergData.adjacentFaces,U.nbSharedFaces=this.goldbergData.nbSharedFaces,U.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,U.nbFaces=this.goldbergData.nbFaces,U.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){U.faceColors=[];for(const N of this.goldbergData.faceColors)U.faceColors.push(N.pi())}if(this.goldbergData.faceCenters){U.faceCenters=[];for(const N of this.goldbergData.faceCenters)U.faceCenters.push(N.pi())}if(this.goldbergData.faceZaxis){U.faceZaxis=[];for(const N of this.goldbergData.faceZaxis)U.faceZaxis.push(N.pi())}if(this.goldbergData.faceYaxis){U.faceYaxis=[];for(const N of this.goldbergData.faceYaxis)U.faceYaxis.push(N.pi())}if(this.goldbergData.faceXaxis){U.faceXaxis=[];for(const N of this.goldbergData.faceXaxis)U.faceXaxis.push(N.pi())}N.goldbergData=U}static Parse(N,U){const V=N.goldbergData;V.faceColors=V.faceColors.map((N=>k.Yi.vU(N))),V.faceCenters=V.faceCenters.map((N=>A.CU.vU(N))),V.faceZaxis=V.faceZaxis.map((N=>A.CU.vU(N))),V.faceXaxis=V.faceXaxis.map((N=>A.CU.vU(N))),V.faceYaxis=V.faceYaxis.map((N=>A.CU.vU(N)));const t=new nN(N.name,U);return t.goldbergData=V,t}}var qN=V(12905);const iN={CreateBox:p.c,CreateTiledBox:J,CreateSphere:d.d,CreateDisc:E.b,CreateIcoSphere:G,CreateRibbon:S,CreateCylinder:c,CreateTorus:Y,CreateTorusKnot:s,CreateLineSystem:M.d,hS:M.h,CreateDashedLines:M.b,ExtrudeShape:w,ExtrudeShapeCustom:X,CreateLathe:Q,CreateTiledPlane:C,YS:u.e,CreateGround:L.e,CreateTiledGround:L.g,CreateGroundFromHeightMap:L.d,CreatePolygon:a.d,ExtrudePolygon:a.g,CreateTube:I,CreatePolyhedron:R,CreateGeodesic:function(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=U.m||1;A!==Math.floor(A)&&(A=Math.floor(A),y.b.Warn("m not an integer only floor(m) used"));let t=U.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),y.b.Warn("n not an integer only floor(n) used")),t>A){const N=t;t=A,A=N,y.b.Warn("n > m therefore m and n swapped")}const n=new VN;return n.build(A,t),R(N,{custom:tN.BuildGeodesicData(n),size:U.size,sizeX:U.sizeX,sizeY:U.sizeY,sizeZ:U.sizeZ,faceUV:U.faceUV,faceColors:U.faceColors,flat:U.flat,updatable:U.updatable,sideOrientation:U.sideOrientation,frontUVs:U.frontUVs,backUVs:U.backUVs},V)},CreateGoldberg:function(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=U.size,z=U.sizeX||n||1,S=U.sizeY||n||1,E=U.sizeZ||n||1;let p=U.m||1;p!==Math.floor(p)&&(p=Math.floor(p),y.b.Warn("m not an integer only floor(m) used"));let B=U.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),y.b.Warn("n not an integer only floor(n) used")),B>p){const N=B;B=p,p=N,y.b.Warn("n > m therefore m and n swapped")}const C=new VN;C.build(p,B);const x=tN.BuildGeodesicData(C),J=x.toGoldbergPolyhedronData(),d=new nN(N,V);U.sideOrientation=t.b._GetDefaultSideOrientation(U.sideOrientation),d._originalBuilderSideOrientation=U.sideOrientation;(function(N,U){const V=N.size,t=N.sizeX||V||1,n=N.sizeY||V||1,z=N.sizeZ||V||1,S=0===N.sideOrientation?0:N.sideOrientation||q.c.DEFAULTSIDE,E=[],p=[],k=[],B=[];let C=1/0,x=-1/0,J=1/0,d=-1/0;for(let A=0;A<U.vertex.length;A++)C=Math.min(C,U.vertex[A][0]*t),x=Math.max(x,U.vertex[A][0]*t),J=Math.min(J,U.vertex[A][1]*n),d=Math.max(d,U.vertex[A][1]*n);let r=0;for(let q=0;q<U.face.length;q++){const N=U.face[q],V=A.CU.vU(U.vertex[N[0]]),S=A.CU.vU(U.vertex[N[2]]),v=A.CU.vU(U.vertex[N[1]]),h=S.xU(V),c=v.xU(V),H=A.CU.Cross(c,h).normalize();for(let A=0;A<N.length;A++){k.push(H.x,H.y,H.z);const V=U.vertex[N[A]];E.push(V[0]*t,V[1]*n,V[2]*z);const q=(V[1]*n-J)/(d-J);B.push((V[0]*t-C)/(x-C),i.c?1-q:q)}for(let U=0;U<N.length-2;U++)p.push(r,r+U+2,r+U+1);r+=N.length}q.c._ComputeSides(S,E,p,k,B);const v=new q.c;return v.sN=E,v.indices=p,v.MN=k,v.mU=B,v})(U,J).XN(d,U.updatable),d.goldbergData.nbSharedFaces=x.sharedNodes,d.goldbergData.nbUnsharedFaces=x.poleNodes,d.goldbergData.adjacentFaces=x.adjacentFaces,d.goldbergData.nbFaces=d.goldbergData.nbSharedFaces+d.goldbergData.nbUnsharedFaces,d.goldbergData.nbFacesAtPole=(d.goldbergData.nbUnsharedFaces-12)/12;for(let t=0;t<x.vertex.length;t++)d.goldbergData.faceCenters.push(A.CU.vU(x.vertex[t])),d.goldbergData.faceCenters[t].x*=z,d.goldbergData.faceCenters[t].y*=S,d.goldbergData.faceCenters[t].z*=E,d.goldbergData.faceColors.push(new k.Yi(1,1,1,1));for(let t=0;t<J.face.length;t++){const N=J.face[t],U=A.CU.vU(J.vertex[N[0]]),V=A.CU.vU(J.vertex[N[2]]),n=A.CU.vU(J.vertex[N[1]]),q=V.xU(U),i=n.xU(U),z=A.CU.Cross(i,q).normalize(),S=A.CU.Cross(i,z).normalize();d.goldbergData.faceXaxis.push(i.normalize()),d.goldbergData.faceYaxis.push(z),d.goldbergData.faceZaxis.push(S)}return d},CreateDecal:O,CreateCapsule:b,CreateText:qN.e}},13634:(N,U,V)=>{"use strict";V.d(U,{e:()=>iU});var A=V(12383),t=V(12732);class n extends t.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var q=V(12426),i=(V(12548),V(12344));class z{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(N){this._targetStopDuration!==N&&(this._targetStopDuration=N)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(N){this._noiseTexture!==N&&(this._noiseTexture=N,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(N){this._animationSheetEnabled!==N&&(this._animationSheetEnabled=N)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(N){this._isAnimationSheetEnabled!=N&&(this._isAnimationSheetEnabled=N,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){this._useLogarithmicDepth=N&&this.YN().getEngine().getCaps().fragmentDepthSupported}YN(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(N){switch(N){case z.BLENDMODE_MULTIPLYADD:return;case z.BLENDMODE_ADD:N=1;break;case z.BLENDMODE_ONEONE:N=6;break;case z.BLENDMODE_STANDARD:N=2;break;case z.BLENDMODE_MULTIPLY:N=4;break;case z.BLENDMODE_SUBTRACT:N=3}this._engine.setAlphaMode(N)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:A.CU.Zero()}set direction1(N){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=N)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:A.CU.Zero()}set direction2(N){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=N)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:A.CU.Zero()}set minEmitBox(N){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=N)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:A.CU.Zero()}set maxEmitBox(N){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=N)}get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(N){this._isBillboardBased!==N&&(this._isBillboardBased=N,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N)}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(!N&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=N)}_reset(){}_removeGradientAndTexture(N,U,V){if(!U)return this;let A=0;for(const t of U){if(t.gradient===N){U.splice(A,1);break}A++}return V&&V.dispose(),this}constructor(N){this.animations=[],this.renderingGroupId=0,this.AU=A.CU.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new A.CU(10,10,10),this.onAnimationEnd=null,this.blendMode=z.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new A.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.dS=new A.CU(0,0,0),this._useLogarithmicDepth=!1,this.gravity=A.CU.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new q.Yi(1,1,1,1),this.color2=new q.Yi(1,1,1,1),this.colorDead=new q.Yi(0,0,0,1),this.textureMask=new q.Yi(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new n,this.id=N,this.name=N}createPointEmitter(N,U){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new A.CU(0,1,0),arguments.length>2&&void 0!==arguments[2]||new A.CU(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new A.CU(0,1,0),arguments.length>4&&void 0!==arguments[4]||new A.CU(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new A.CU(0,1,0),arguments.length>3&&void 0!==arguments[3]||new A.CU(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(N,U,V,A){throw new Error("Method not implemented.")}}z.BLENDMODE_ONEONE=0,z.BLENDMODE_STANDARD=1,z.BLENDMODE_ADD=2,z.BLENDMODE_MULTIPLY=3,z.BLENDMODE_MULTIPLYADD=4,z.BLENDMODE_SUBTRACT=-1,(0,i.e)("BABYLON.BaseParticleSystem",z);var S=V(12395),E=V(12197);class p{constructor(){this.direction1=new A.CU(0,1,0),this.direction2=new A.CU(0,1,0),this.minEmitBox=new A.CU(-.5,-.5,-.5),this.maxEmitBox=new A.CU(.5,.5,.5)}startDirectionFunction(N,U,V,t){const n=(0,S.RandomRange)(this.direction1.x,this.direction2.x),q=(0,S.RandomRange)(this.direction1.y,this.direction2.y),i=(0,S.RandomRange)(this.direction1.z,this.direction2.z);if(t)return U.x=n,U.y=q,void(U.z=i);A.CU.TransformNormalFromFloatsToRef(n,q,i,N,U)}startPositionFunction(N,U,V,t){const n=(0,S.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),q=(0,S.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),i=(0,S.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(t)return U.x=n,U.y=q,void(U.z=i);A.CU.TransformCoordinatesFromFloatsToRef(n,q,i,N,U)}clone(){const N=new p;return E.e.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2),N.setVector3("minEmitBox",this.minEmitBox),N.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3),N.addUniform("minEmitBox",3),N.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.pi(),N.direction2=this.direction2.pi(),N.minEmitBox=this.minEmitBox.pi(),N.maxEmitBox=this.maxEmitBox.pi(),N}parse(N){A.CU.FromArrayToRef(N.direction1,0,this.direction1),A.CU.FromArrayToRef(N.direction2,0,this.direction2),A.CU.FromArrayToRef(N.minEmitBox,0,this.minEmitBox),A.CU.FromArrayToRef(N.maxEmitBox,0,this.maxEmitBox)}}class k{get radius(){return this._radius}set radius(N){this._radius=N,this._buildHeight()}get angle(){return this._angle}set angle(N){this._angle=N,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=V,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=U,this.radius=N}startDirectionFunction(N,U,V,t){t?A.TmpVectors.CU[0].A(V.Ti).normalize():V.position.subtractToRef(N.getTranslation(),A.TmpVectors.CU[0]).normalize();const n=(0,S.RandomRange)(0,this.directionRandomizer),q=(0,S.RandomRange)(0,this.directionRandomizer),i=(0,S.RandomRange)(0,this.directionRandomizer);U.x=A.TmpVectors.CU[0].x+n,U.y=A.TmpVectors.CU[0].y+q,U.z=A.TmpVectors.CU[0].z+i,U.normalize()}startPositionFunction(N,U,V,t){const n=(0,S.RandomRange)(0,2*Math.PI);let q;this.emitFromSpawnPointOnly?q=1e-4:(q=(0,S.RandomRange)(0,this.heightRange),q=1-q*q);let i=this._radius-(0,S.RandomRange)(0,this._radius*this.radiusRange);i*=q;const z=i*Math.sin(n),E=i*Math.cos(n),p=q*this._height;if(t)return U.x=z,U.y=p,void(U.z=E);A.CU.TransformCoordinatesFromFloatsToRef(z,p,E,N,U)}clone(){const N=new k(this._radius,this._angle,this.directionRandomizer);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat2("radius",this._radius,this.radiusRange),N.setFloat("coneAngle",this._angle),N.setFloat2("height",this._height,this.heightRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",2),N.addUniform("coneAngle",1),N.addUniform("height",2),N.addUniform("directionRandomizer",1)}getEffectDefines(){let N="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(N+="\n#define CONEEMITTERSPAWNPOINT"),N}getClassName(){return"ConeParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this._radius,N.angle=this._angle,N.directionRandomizer=this.directionRandomizer,N.radiusRange=this.radiusRange,N.heightRange=this.heightRange,N.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,N}parse(N){this.radius=N.radius,this.angle=N.angle,this.directionRandomizer=N.directionRandomizer,this.radiusRange=void 0!==N.radiusRange?N.radiusRange:1,this.heightRange=void 0!==N.radiusRange?N.heightRange:1,this.emitFromSpawnPointOnly=void 0!==N.emitFromSpawnPointOnly&&N.emitFromSpawnPointOnly}}class B extends k{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0);super(N,U),this.direction1=V,this.direction2=t}startDirectionFunction(N,U){const V=(0,S.RandomRange)(this.direction1.x,this.direction2.x),t=(0,S.RandomRange)(this.direction1.y,this.direction2.y),n=(0,S.RandomRange)(this.direction1.z,this.direction2.z);A.CU.TransformNormalFromFloatsToRef(V,t,n,N,U)}clone(){const N=new B(this.radius,this.angle,this.direction1,this.direction2);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.pi(),N.direction2=this.direction2.pi(),N}parse(N){super.parse(N),this.direction1.A(N.direction1),this.direction2.A(N.direction2)}}class C{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=N,this.height=U,this.radiusRange=V,this.directionRandomizer=t,this._tempVector=A.CU.Zero()}startDirectionFunction(N,U,V,t,n){V.position.subtractToRef(N.getTranslation(),this._tempVector),this._tempVector.normalize(),A.CU.TransformNormalToRef(this._tempVector,n,this._tempVector);const q=(0,S.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let i=Math.atan2(this._tempVector.x,this._tempVector.z);i+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=q,this._tempVector.x=Math.sin(i),this._tempVector.z=Math.cos(i),this._tempVector.normalize(),t?U.A(this._tempVector):A.CU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N,U)}startPositionFunction(N,U,V,t){const n=(0,S.RandomRange)(-this.height/2,this.height/2),q=(0,S.RandomRange)(0,2*Math.PI),i=(0,S.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),z=Math.sqrt(i)*this.radius,E=z*Math.cos(q),p=z*Math.sin(q);t?U.hi(E,n,p):A.CU.TransformCoordinatesFromFloatsToRef(E,n,p,N,U)}clone(){const N=new C(this.radius,this.directionRandomizer);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.height=this.height,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.height=N.height,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class x extends C{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.CU(0,1,0);super(N,U,V),this.direction1=t,this.direction2=n}startDirectionFunction(N,U,V,t){const n=(0,S.RandomRange)(this.direction1.x,this.direction2.x),q=(0,S.RandomRange)(this.direction1.y,this.direction2.y),i=(0,S.RandomRange)(this.direction1.z,this.direction2.z);t?U.hi(n,q,i):A.CU.TransformNormalFromFloatsToRef(n,q,i,N,U)}clone(){const N=new x(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.pi(),N.direction2=this.direction2.pi(),N}parse(N){super.parse(N),A.CU.FromArrayToRef(N.direction1,0,this.direction1),A.CU.FromArrayToRef(N.direction2,0,this.direction2)}}class J{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=U,this.directionRandomizer=V}startDirectionFunction(N,U,V,t){const n=V.position.xU(N.getTranslation()).normalize(),q=(0,S.RandomRange)(0,this.directionRandomizer),i=(0,S.RandomRange)(0,this.directionRandomizer),z=(0,S.RandomRange)(0,this.directionRandomizer);n.x+=q,n.y+=i,n.z+=z,n.normalize(),t?U.A(n):A.CU.TransformNormalFromFloatsToRef(n.x,n.y,n.z,N,U)}startPositionFunction(N,U,V,t){const n=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),q=(0,S.RandomRange)(0,1),i=(0,S.RandomRange)(0,2*Math.PI),z=Math.acos(2*q-1),E=n*Math.cos(i)*Math.sin(z),p=n*Math.cos(z),k=n*Math.sin(i)*Math.sin(z);t?U.hi(E,Math.abs(p),k):A.CU.TransformCoordinatesFromFloatsToRef(E,Math.abs(p),k,N,U)}clone(){const N=new J(this.radius,this.directionRandomizer);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class d{constructor(){this.direction1=new A.CU(0,1,0),this.direction2=new A.CU(0,1,0)}startDirectionFunction(N,U,V,t){const n=(0,S.RandomRange)(this.direction1.x,this.direction2.x),q=(0,S.RandomRange)(this.direction1.y,this.direction2.y),i=(0,S.RandomRange)(this.direction1.z,this.direction2.z);t?U.hi(n,q,i):A.CU.TransformNormalFromFloatsToRef(n,q,i,N,U)}startPositionFunction(N,U,V,t){t?U.hi(0,0,0):A.CU.TransformCoordinatesFromFloatsToRef(0,0,0,N,U)}clone(){const N=new d;return E.e.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.pi(),N.direction2=this.direction2.pi(),N}parse(N){A.CU.FromArrayToRef(N.direction1,0,this.direction1),A.CU.FromArrayToRef(N.direction2,0,this.direction2)}}class r{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=U,this.directionRandomizer=V}startDirectionFunction(N,U,V,t){const n=V.position.xU(N.getTranslation()).normalize(),q=(0,S.RandomRange)(0,this.directionRandomizer),i=(0,S.RandomRange)(0,this.directionRandomizer),z=(0,S.RandomRange)(0,this.directionRandomizer);n.x+=q,n.y+=i,n.z+=z,n.normalize(),t?U.A(n):A.CU.TransformNormalFromFloatsToRef(n.x,n.y,n.z,N,U)}startPositionFunction(N,U,V,t){const n=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),q=(0,S.RandomRange)(0,1),i=(0,S.RandomRange)(0,2*Math.PI),z=Math.acos(2*q-1),E=n*Math.cos(i)*Math.sin(z),p=n*Math.cos(z),k=n*Math.sin(i)*Math.sin(z);t?U.hi(E,p,k):A.CU.TransformCoordinatesFromFloatsToRef(E,p,k,N,U)}clone(){const N=new r(this.radius,this.directionRandomizer);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class v extends r{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.CU(0,1,0),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0);super(N),this.direction1=U,this.direction2=V}startDirectionFunction(N,U){const V=(0,S.RandomRange)(this.direction1.x,this.direction2.x),t=(0,S.RandomRange)(this.direction1.y,this.direction2.y),n=(0,S.RandomRange)(this.direction1.z,this.direction2.z);A.CU.TransformNormalFromFloatsToRef(V,t,n,N,U)}clone(){const N=new v(this.radius,this.direction1,this.direction2);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.pi(),N.direction2=this.direction2.pi(),N}parse(N){super.parse(N),this.direction1.A(N.direction1),this.direction2.A(N.direction2)}}class h{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(N,U,V,t){const n=A.TmpVectors.CU[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,V,n);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,V,n);const N=A.TmpVectors.CU[1];n.subtractToRef(V.position,N),N.scaleToRef(1/V.lifeTime,n)}else n.set(0,0,0);t?U.A(n):A.CU.TransformNormalToRef(n,N,U)}startPositionFunction(N,U,V,t){const n=A.TmpVectors.CU[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,V,n):n.set(0,0,0),t?U.A(n):A.CU.TransformCoordinatesToRef(n,N,U)}clone(){const N=new h;return E.e.DeepCopy(this,N),N}applyToShader(N){}buildUniformLayout(N){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.particlePositionGenerator=this.particlePositionGenerator,N.particleDestinationGenerator=this.particleDestinationGenerator,N}parse(N){N.particlePositionGenerator&&(this.particlePositionGenerator=N.particlePositionGenerator),N.particleDestinationGenerator&&(this.particleDestinationGenerator=N.particleDestinationGenerator)}}var c=V(12453);class H{get mesh(){return this._mesh}set mesh(N){this._mesh!==N&&(this._mesh=N,N?(this._indices=N.di(),this._positions=N.getVerticesData(c.f.PositionKind),this._normals=N.getVerticesData(c.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=A.CU.Zero(),this._mesh=null,this.direction1=new A.CU(0,1,0),this.direction2=new A.CU(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=N}startDirectionFunction(N,U,V,t){if(this.useMeshNormalsForDirection&&this._normals)return void A.CU.TransformNormalToRef(this._storedNormal,N,U);const n=(0,S.RandomRange)(this.direction1.x,this.direction2.x),q=(0,S.RandomRange)(this.direction1.y,this.direction2.y),i=(0,S.RandomRange)(this.direction1.z,this.direction2.z);t?U.hi(n,q,i):A.CU.TransformNormalFromFloatsToRef(n,q,i,N,U)}startPositionFunction(N,U,V,t){if(!this._indices||!this._positions)return;const n=3*(Math.random()*(this._indices.length/3)|0),q=Math.random(),i=Math.random()*(1-q),z=1-q-i,S=this._indices[n],E=this._indices[n+1],p=this._indices[n+2],k=A.TmpVectors.CU[0],B=A.TmpVectors.CU[1],C=A.TmpVectors.CU[2],x=A.TmpVectors.CU[3];A.CU.FromArrayToRef(this._positions,3*S,k),A.CU.FromArrayToRef(this._positions,3*E,B),A.CU.FromArrayToRef(this._positions,3*p,C),x.x=q*k.x+i*B.x+z*C.x,x.y=q*k.y+i*B.y+z*C.y,x.z=q*k.z+i*B.z+z*C.z,t?U.hi(x.x,x.y,x.z):A.CU.TransformCoordinatesFromFloatsToRef(x.x,x.y,x.z,N,U),this.useMeshNormalsForDirection&&this._normals&&(A.CU.FromArrayToRef(this._normals,3*S,k),A.CU.FromArrayToRef(this._normals,3*E,B),A.CU.FromArrayToRef(this._normals,3*p,C),this._storedNormal.x=q*k.x+i*B.x+z*C.x,this._storedNormal.y=q*k.y+i*B.y+z*C.y,this._storedNormal.z=q*k.z+i*B.z+z*C.z)}clone(){const N=new H(this.mesh);return E.e.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var N;const U={};return U.type=this.getClassName(),U.direction1=this.direction1.pi(),U.direction2=this.direction2.pi(),U.meshId=null===(N=this.mesh)||void 0===N?void 0:N.id,U.useMeshNormalsForDirection=this.useMeshNormalsForDirection,U}parse(N,U){A.CU.FromArrayToRef(N.direction1,0,this.direction1),A.CU.FromArrayToRef(N.direction2,0,this.direction2),N.meshId&&U&&(this.mesh=U.getLastMeshById(N.meshId)),this.useMeshNormalsForDirection=N.useMeshNormalsForDirection}}class Y{_isUbo(N){return void 0!==N.addUniform}constructor(N){this._isUbo(N)?(this.setMatrix3x3=N.updateMatrix3x3.bind(N),this.setMatrix2x2=N.updateMatrix2x2.bind(N),this.setFloat=N.updateFloat.bind(N),this.setFloat2=N.updateFloat2.bind(N),this.setFloat3=N.updateFloat3.bind(N),this.setFloat4=N.updateFloat4.bind(N),this.setFloatArray=N.updateFloatArray.bind(N),this.setArray=N.updateArray.bind(N),this.setIntArray=N.updateIntArray.bind(N),this.setMatrix=N.Ci.bind(N),this.setMatrices=N.updateMatrices.bind(N),this.setVector3=N.updateVector3.bind(N),this.setVector4=N.updateVector4.bind(N),this.setColor3=N.updateColor3.bind(N),this.setColor4=N.updateColor4.bind(N),this.setDirectColor4=N.updateDirectColor4.bind(N),this.setInt=N.updateInt.bind(N),this.setInt2=N.updateInt2.bind(N),this.setInt3=N.updateInt3.bind(N),this.setInt4=N.updateInt4.bind(N)):(this.setMatrix3x3=N.setMatrix3x3.bind(N),this.setMatrix2x2=N.setMatrix2x2.bind(N),this.setFloat=N.setFloat.bind(N),this.setFloat2=N.setFloat2.bind(N),this.setFloat3=N.setFloat3.bind(N),this.setFloat4=N.setFloat4.bind(N),this.setFloatArray=N.setFloatArray.bind(N),this.setArray=N.setArray.bind(N),this.setIntArray=N.setIntArray.bind(N),this.setMatrix=N.setMatrix.bind(N),this.setMatrices=N.setMatrices.bind(N),this.setVector3=N.setVector3.bind(N),this.setVector4=N.setVector4.bind(N),this.setColor3=N.setColor3.bind(N),this.setColor4=N.setColor4.bind(N),this.setDirectColor4=N.setDirectColor4.bind(N),this.setInt=N.setInt.bind(N),this.setInt2=N.setInt2.bind(N),this.setInt3=N.setInt3.bind(N),this.setInt4=N.setInt4.bind(N))}}var W=V(12288);const s="gpuUpdateParticlesPixelShader",M="#version 300 es\nvoid main() {discard;}\n";W.b.ShadersStore[s]||(W.b.ShadersStore[s]=M);const a="gpuUpdateParticlesVertexShader",mN="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";W.b.ShadersStore[a]||(W.b.ShadersStore[a]=mN);(0,i.e)("BABYLON.WebGL2ParticleSystem",class{constructor(N,U){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=N,this._engine=U,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var N;return(null===(N=this._updateEffect)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof h&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=N,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Y(this._updateEffect)}createVertexBuffers(N,U){this._updateVAO.push(this._createUpdateVAO(N)),this._renderVAO.push(this._engine.recordVertexArrayObject(U,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=U}createParticleBuffer(N){return N}bindDrawBuffers(N,U,V){V?this._engine.bindBuffers(this._renderVertexBuffers,V,U):this._engine.bindVertexArrayObject(this._renderVAO[N],null)}preUpdateParticleBuffer(){const N=this._engine;if(this._engine.enableEffect(this._updateEffect),!N.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(N,U,V){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[N],null);const A=this._engine;A.bindTransformFeedbackBuffer(U.getBuffer()),A.setRasterizerState(!1),A.beginTransformFeedback(!0),A.drawArraysType(3,0,V),A.endTransformFeedback(),A.setRasterizerState(!0),A.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let N=0;N<this._updateVAO.length;N++)this._engine.releaseVertexArrayObject(this._updateVAO[N]);this._updateVAO.length=0;for(let N=0;N<this._renderVAO.length;N++)this._engine.releaseVertexArrayObject(this._renderVAO[N]);this._renderVAO.length=0}_createUpdateVAO(N){const U={};U.position=N.createVertexBuffer("position",0,3);let V=3;U.age=N.createVertexBuffer("age",V,1),V+=1,U.size=N.createVertexBuffer("size",V,3),V+=3,U.life=N.createVertexBuffer("life",V,1),V+=1,U.seed=N.createVertexBuffer("seed",V,4),V+=4,U.direction=N.createVertexBuffer("direction",V,3),V+=3,this._parent.particleEmitterType instanceof h&&(U.initialPosition=N.createVertexBuffer("initialPosition",V,3),V+=3),this._parent._colorGradientsTexture||(U.color=N.createVertexBuffer("color",V,4),V+=4),this._parent._isBillboardBased||(U.initialDirection=N.createVertexBuffer("initialDirection",V,3),V+=3),this._parent.noiseTexture&&(U.noiseCoordinates1=N.createVertexBuffer("noiseCoordinates1",V,3),V+=3,U.noiseCoordinates2=N.createVertexBuffer("noiseCoordinates2",V,3),V+=3),this._parent._angularSpeedGradientsTexture?(U.angle=N.createVertexBuffer("angle",V,1),V+=1):(U.angle=N.createVertexBuffer("angle",V,2),V+=2),this._parent._isAnimationSheetEnabled&&(U.cellIndex=N.createVertexBuffer("cellIndex",V,1),V+=1,this._parent.spriteRandomStartCell&&(U.cellStartOffset=N.createVertexBuffer("cellStartOffset",V,1),V+=1));const A=this._engine.recordVertexArrayObject(U,null,this._updateEffect);return this._engine.bindArrayBuffer(null),A}});class w{constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3?arguments[3]:void 0;this._engine=N,this._label=A,this._engine._storageBuffers.push(this),this._create(U,V)}_create(N,U){this._bufferSize=N,this._creationFlags=U,this._buffer=this._engine.createStorageBuffer(N,U,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(N,U,V){this._buffer&&this._engine.updateStorageBuffer(this._buffer,N,U,V)}async read(N,U,V,A){return await this._engine.readFromStorageBuffer(this._buffer,N,U,V,A)}dispose(){const N=this._engine._storageBuffers,U=N.indexOf(this);-1!==U&&(N[U]=N[N.length-1],N.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var X=V(12367),e=V(12369),Q=V(12413),u=V(12364),L=V(12650),I=V(12193),o=V(12328),R=V(12579);class D{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.d}_addDuration(N,U){N<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==N?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(U,!1),this._gpuTimeInFrameId=N):this.counter.addCount(U,!1))}}var G=V(12264);class g{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=N,this._engine=U,this.uniqueId=L.c.UniqueId,U.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new D),this._engine.getCaps().supportComputeShaders?A.bindingsMapping?(this._context=U.createComputeContext(),this._shaderPath=V,this._options={bindingsMapping:{},defines:[],...A}):I.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):I.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(N,U){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const A=this._bindings[N];this._bindings[N]={type:V?0:4,object:U,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!A||A.object!==U||A.type!==this._bindings[N].type)}setStorageTexture(N,U){const V=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==U),this._bindings[N]={type:1,object:U,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setExternalTexture(N,U){const V=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==U),this._bindings[N]={type:6,object:U,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setVideoTexture(N,U){return!!U.externalTexture&&(this.setExternalTexture(N,U.externalTexture),!0)}setUniformBuffer(N,U){const V=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==U),this._bindings[N]={type:g._BufferIsDataBuffer(U)?7:2,object:U,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setStorageBuffer(N,U){const V=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==U),this._bindings[N]={type:g._BufferIsDataBuffer(U)?7:3,object:U,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setTextureSampler(N,U){const V=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!V||!U.compareSampler(V.object)),this._bindings[N]={type:5,object:U,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}isReady(){let N=this._effect;for(const t in this._bindings){const N=this._bindings[t],U=N.type,V=N.object;switch(U){case 0:case 4:case 1:if(!V.isReady())return!1;break;case 6:if(!V.isReady())return!1;break}}const U=[],V=this._shaderPath;if(this._options.defines)for(let t=0;t<this._options.defines.length;t++)U.push(this._options.defines[t]);const A=U.join("\n");return this._cachedDefines!==A&&(this._cachedDefines=A,N=this._engine.createComputeEffect(V,{defines:A,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=N),!!N.isReady()}dispatch(N,U,V){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,N,U,V,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const V=g._BufferIsDataBuffer(N)?N:N.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,V,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const U in this._bindings){const V=this._bindings[U];if(!this._options.bindingsMapping[U])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+U+"'");switch(V.type){case 0:{const A=this._samplers[U],t=V.object;var N;if(!A||!t._texture||!A.compareSampler(t._texture))this._samplers[U]=(new o.e).setParameters(t.wrapU,t.wrapV,t.wrapR,t.anisotropicFilteringLevel,t._texture.samplingMode,null===(N=t._texture)||void 0===N?void 0:N._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const N=V.object;N.getBuffer()!==V.buffer&&(V.buffer=N.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((t=>{(0,G.f)((()=>this.dispatch(N,U,V)),t,void 0,A)}))}serialize(){const N=Q.d.Serialize(this);N.options=this._options,N.shaderPath=this._shaderPath,N.qk={},N.textures={};for(const U in this._bindings){const V=this._bindings[U],A=V.object;switch(V.type){case 0:case 4:case 1:{const t=A.serialize();t&&(N.textures[U]=t,N.qk[U]={type:V.type});break}}}return N}static Parse(N,U,V){const A=Q.d.Parse((()=>new g(N.name,U.getEngine(),N.shaderPath,N.options)),N,U,V);for(const t in N.textures){const n=N.qk[t],q=u.e.Parse(N.textures[t],U,V);0===n.type?A.setTexture(t,q):4===n.type?A.setTexture(t,q,!1):A.setStorageTexture(t,q)}return A}static _BufferIsDataBuffer(N){return void 0!==N.underlyingResource}}(0,X.b)([(0,e.N)()],g.prototype,"name",void 0),(0,X.b)([(0,e.N)()],g.prototype,"fastMode",void 0),(0,i.e)("BABYLON.ComputeShader",g);var l=V(12615);const K="gpuUpdateParticlesComputeShader",j="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";W.b.ShadersStoreWGSL[K]||(W.b.ShadersStoreWGSL[K]=j);(0,i.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(N,U){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=N,this._engine=U}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var N;return(null===(N=this._updateComputeShader)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){var U;const V={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(V.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(V.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(V.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(V.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(V.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(V.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(V.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new g("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:V,defines:N.split("\n")}),null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=new l.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Y(this._simParamsComputeShader)}createVertexBuffers(N,U){this._renderVertexBuffers.push(U)}createParticleBuffer(N){const U=new w(this._engine,4*N.length,11,"ComputeShaderParticleSystemBuffer");return U.update(N),this._bufferComputeShader.push(U),U.getBuffer()}bindDrawBuffers(N,U,V){this._engine.bindBuffers(this._renderVertexBuffers[N],V,U)}preUpdateParticleBuffer(){}updateParticleBuffer(N,U,V){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[N]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^N]),this._updateComputeShader.dispatch(Math.ceil(V/64))}releaseBuffers(){var N;for(let U=0;U<this._bufferComputeShader.length;++U)this._bufferComputeShader[U].dispose();this._bufferComputeShader.length=0,null===(N=this._simParamsComputeShader)||void 0===N||N.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class F{constructor(N,U,V){this.gradient=N,this.color1=U,this.color2=V}getColorToRef(N){this.color2?q.Yi.LerpToRef(this.color1,this.color2,Math.random(),N):N.A(this.color1)}}class P{constructor(N,U){this.gradient=N,this.color=U}}class T{constructor(N,U,V){this.gradient=N,this.factor1=U,this.factor2=V}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class f{static GetCurrentGradient(N,U,V){if(U[0].gradient>N)return void V(U[0],U[0],1);for(let t=0;t<U.length-1;t++){const A=U[t],n=U[t+1];if(N>=A.gradient&&N<=n.gradient){return void V(A,n,(N-A.gradient)/(n.gradient-A.gradient))}}const A=U.length-1;V(U[A],U[A],1)}}var O=V(12182),Z=V(12828),b=V(12223);class y{constructor(N){this.particleSystem=N,this.position=A.CU.Zero(),this.direction=A.CU.Zero(),this.color=new q.Yi(0,0,0,0),this.colorStep=new q.Yi(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new A.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new q.Yi(0,0,0,0),this._currentColor2=new q.Yi(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=y._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let N=this.age,U=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===U?(U=1,N=this._randomCellOffset):N+=this._randomCellOffset);const V=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let A;A=this._initialSpriteCellLoop?(0,S.Clamp)(N*U%this.lifeTime/this.lifeTime):(0,S.Clamp)(N*U/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+A*V|0}_inheritParticleInfoToSubEmitter(N){if(N.particleSystem.AU.position){const U=N.particleSystem.AU;if(U.position.A(this.position),N.inheritDirection){const N=A.TmpVectors.CU[0];this.direction.normalizeToRef(N),U.setDirection(N,0,Math.PI/2)}}else{N.particleSystem.AU.A(this.position)}this.direction.scaleToRef(N.inheritedVelocityAmount/2,A.TmpVectors.CU[0]),N.particleSystem._inheritedVelocityOffset.A(A.TmpVectors.CU[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const N of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(N)}_reset(){this.age=0,this.id=y._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(N){N.position.A(this.position),this._initialDirection?N._initialDirection?N._initialDirection.A(this._initialDirection):N._initialDirection=this._initialDirection.clone():N._initialDirection=null,N.direction.A(this.direction),this.Ti&&(N.Ti?N.Ti.A(this.Ti):N.Ti=this.Ti.clone()),N.color.A(this.color),N.colorStep.A(this.colorStep),N.lifeTime=this.lifeTime,N.age=this.age,N._randomCellOffset=this._randomCellOffset,N.size=this.size,N.scale.A(this.scale),N.angle=this.angle,N.angularSpeed=this.angularSpeed,N.particleSystem=this.particleSystem,N.cellIndex=this.cellIndex,N.id=this.id,N._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(N._currentColorGradient=this._currentColorGradient,N._currentColor1.A(this._currentColor1),N._currentColor2.A(this._currentColor2)),this._currentSizeGradient&&(N._currentSizeGradient=this._currentSizeGradient,N._currentSize1=this._currentSize1,N._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(N._currentAngularSpeedGradient=this._currentAngularSpeedGradient,N._currentAngularSpeed1=this._currentAngularSpeed1,N._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(N._currentVelocityGradient=this._currentVelocityGradient,N._currentVelocity1=this._currentVelocity1,N._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(N._currentLimitVelocityGradient=this._currentLimitVelocityGradient,N._currentLimitVelocity1=this._currentLimitVelocity1,N._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(N._currentDragGradient=this._currentDragGradient,N._currentDrag1=this._currentDrag1,N._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(N._initialStartSpriteCellId=this._initialStartSpriteCellId,N._initialEndSpriteCellId=this._initialEndSpriteCellId,N._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(N.remapData&&this.remapData?N.remapData.A(this.remapData):N.remapData=new A.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.A(this._randomNoiseCoordinates1),N._randomNoiseCoordinates2.A(this._randomNoiseCoordinates2)):(N._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),N._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}y._Count=0;var NN=V(12500),UN=(V(12542),V(12717)),VN=V(12713),AN=V(12613);function tN(N,U){const V=(0,S.RandomRange)(0,1);q.Yi.LerpToRef(U.color1,U.color2,V,N.color),U.colorDead.subtractToRef(N.color,U._colorDiff),U._colorDiff.scaleToRef(1/N.lifeTime,N.colorStep)}function nN(N,U){N._currentColorGradient=U._colorGradients[0],N._currentColorGradient.getColorToRef(N.color),N._currentColor1.A(N.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(N._currentColor2):N._currentColor2.A(N.color)}function qN(N,U){const V=U._colorGradients;f.GetCurrentGradient(U._ratio,V,((U,V,A)=>{U!==N._currentColorGradient&&(N._currentColor1.A(N._currentColor2),V.getColorToRef(N._currentColor2),N._currentColorGradient=U),q.Yi.LerpToRef(N._currentColor1,N._currentColor2,A,N.color)}))}function iN(N,U){N.colorStep.scaleToRef(U._scaledUpdateSpeed,U._scaledColorStep),N.color.addInPlace(U._scaledColorStep),N.color.a<0&&(N.color.a=0)}function zN(N,U){f.GetCurrentGradient(U._ratio,U._angularSpeedGradients,((U,V,A)=>{U!==N._currentAngularSpeedGradient&&(N._currentAngularSpeed1=N._currentAngularSpeed2,N._currentAngularSpeed2=V.getFactor(),N._currentAngularSpeedGradient=U),N.angularSpeed=(0,S.Lerp)(N._currentAngularSpeed1,N._currentAngularSpeed2,A)}))}function SN(N,U){N.angle+=N.angularSpeed*U._scaledUpdateSpeed}function EN(N,U){U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,N.direction,N,U.isLocal,U._emitterInverseWorldMatrix)}function pN(N,U){U.startDirectionFunction(U._emitterWorldMatrix,N.direction,N,U.isLocal)}function kN(N,U){N._currentVelocityGradient=U._velocityGradients[0],N._currentVelocity1=N._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?N._currentVelocity2=U._velocityGradients[1].getFactor():N._currentVelocity2=N._currentVelocity1}function BN(N,U){N._currentLimitVelocityGradient=U._limitVelocityGradients[0],N._currentLimitVelocity1=N._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?N._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():N._currentLimitVelocity2=N._currentLimitVelocity1}function CN(N,U){f.GetCurrentGradient(U._ratio,U._velocityGradients,((V,A,t)=>{V!==N._currentVelocityGradient&&(N._currentVelocity1=N._currentVelocity2,N._currentVelocity2=A.getFactor(),N._currentVelocityGradient=V),U._directionScale*=(0,S.Lerp)(N._currentVelocity1,N._currentVelocity2,t)}))}function xN(N,U){f.GetCurrentGradient(U._ratio,U._limitVelocityGradients,((V,A,t)=>{V!==N._currentLimitVelocityGradient&&(N._currentLimitVelocity1=N._currentLimitVelocity2,N._currentLimitVelocity2=A.getFactor(),N._currentLimitVelocityGradient=V);const n=(0,S.Lerp)(N._currentLimitVelocity1,N._currentLimitVelocity2,t);N.direction.length()>n&&N.direction.scaleInPlace(U.limitVelocityDamping)}))}function JN(N,U){N.direction.scaleToRef(U._directionScale,U._scaledDirection)}function dN(N,U){U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,N.position,N,U.isLocal)}function rN(N,U){U.startPositionFunction(U._emitterWorldMatrix,N.position,N,U.isLocal)}function vN(N,U){N.Ti?N.Ti.A(N.position):N.Ti=N.position.clone(),A.CU.TransformCoordinatesToRef(N.Ti,U._emitterWorldMatrix,N.position)}function hN(N,U){U.isLocal&&N.Ti?(N.Ti.addInPlace(U._scaledDirection),A.CU.TransformCoordinatesToRef(N.Ti,U._emitterWorldMatrix,N.position)):N.position.addInPlace(U._scaledDirection)}function cN(N,U){N._currentDragGradient=U._dragGradients[0],N._currentDrag1=N._currentDragGradient.getFactor(),U._dragGradients.length>1?N._currentDrag2=U._dragGradients[1].getFactor():N._currentDrag2=N._currentDrag1}function HN(N,U){f.GetCurrentGradient(U._ratio,U._dragGradients,((V,A,t)=>{V!==N._currentDragGradient&&(N._currentDrag1=N._currentDrag2,N._currentDrag2=A.getFactor(),N._currentDragGradient=V);const n=(0,S.Lerp)(N._currentDrag1,N._currentDrag2,t);U._scaledDirection.scaleInPlace(1-n)}))}function YN(N,U){N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.hi(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2.hi(Math.random(),Math.random(),Math.random())):(N._randomNoiseCoordinates1=new A.CU(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2=new A.CU(Math.random(),Math.random(),Math.random()))}function WN(N,U){const V=U._noiseTextureData,t=U._noiseTextureSize;if(V&&t&&N._randomNoiseCoordinates1){const n=U._fetchR(N._randomNoiseCoordinates1.x,N._randomNoiseCoordinates1.y,t.width,t.height,V),q=U._fetchR(N._randomNoiseCoordinates1.z,N._randomNoiseCoordinates2.x,t.width,t.height,V),i=U._fetchR(N._randomNoiseCoordinates2.y,N._randomNoiseCoordinates2.z,t.width,t.height,V),z=A.TmpVectors.CU[0],S=A.TmpVectors.CU[1];z.hi((2*n-1)*U.noiseStrength.x,(2*q-1)*U.noiseStrength.y,(2*i-1)*U.noiseStrength.z),z.scaleToRef(U._tempScaledUpdateSpeed,S),N.direction.addInPlace(S)}}function sN(N,U){U.gravity.scaleToRef(U._tempScaledUpdateSpeed,U._scaledGravity),N.direction.addInPlace(U._scaledGravity)}function MN(N,U){N.size=(0,S.RandomRange)(U.minSize,U.maxSize),N.scale.hi((0,S.RandomRange)(U.minScaleX,U.maxScaleX),(0,S.RandomRange)(U.minScaleY,U.maxScaleY))}function aN(N,U){N._currentSizeGradient=U._sizeGradients[0],N._currentSize1=N._currentSizeGradient.getFactor(),N.size=N._currentSize1,U._sizeGradients.length>1?N._currentSize2=U._sizeGradients[1].getFactor():N._currentSize2=N._currentSize1,N.scale.hi((0,S.RandomRange)(U.minScaleX,U.maxScaleX),(0,S.RandomRange)(U.minScaleY,U.maxScaleY))}function mU(N,U){const V=U._actualFrame/U.targetStopDuration;f.GetCurrentGradient(V,U._startSizeGradients,((V,A,t)=>{V!==U._currentStartSizeGradient&&(U._currentStartSize1=U._currentStartSize2,U._currentStartSize2=A.getFactor(),U._currentStartSizeGradient=V);const n=(0,S.Lerp)(U._currentStartSize1,U._currentStartSize2,t);N.scale.scaleInPlace(n)}))}function wN(N,U){f.GetCurrentGradient(U._ratio,U._sizeGradients,((U,V,A)=>{U!==N._currentSizeGradient&&(N._currentSize1=N._currentSize2,N._currentSize2=V.getFactor(),N._currentSizeGradient=U),N.size=(0,S.Lerp)(N._currentSize1,N._currentSize2,A)}))}function XN(N,U){N.remapData=new A.Vector4(0,1,0,1)}function eN(N,U){U._colorRemapGradients&&U._colorRemapGradients.length>0&&f.GetCurrentGradient(U._ratio,U._colorRemapGradients,((U,V,A)=>{const t=(0,S.Lerp)(U.factor1,V.factor1,A),n=(0,S.Lerp)(U.factor2,V.factor2,A);N.remapData.x=t,N.remapData.y=n-t})),U._alphaRemapGradients&&U._alphaRemapGradients.length>0&&f.GetCurrentGradient(U._ratio,U._alphaRemapGradients,((U,V,A)=>{const t=(0,S.Lerp)(U.factor1,V.factor1,A),n=(0,S.Lerp)(U.factor2,V.factor2,A);N.remapData.z=t,N.remapData.w=n-t}))}function QN(N,U){const V=(0,S.Clamp)(U._actualFrame/U.targetStopDuration);f.GetCurrentGradient(V,U._lifeTimeGradients,((U,A)=>{const t=U,n=A,q=t.getFactor(),i=n.getFactor(),z=(V-t.gradient)/(n.gradient-t.gradient);N.lifeTime=(0,S.Lerp)(q,i,z)})),U._emitPower=(0,S.RandomRange)(U.minEmitPower,U.maxEmitPower)}function uN(N,U){N.lifeTime=(0,S.RandomRange)(U.minLifeTime,U.maxLifeTime),U._emitPower=(0,S.RandomRange)(U.minEmitPower,U.maxEmitPower)}function LN(N,U){0===U._emitPower?(N._initialDirection?N._initialDirection.A(N.direction):N._initialDirection=N.direction.clone(),N.direction.set(0,0,0)):(N._initialDirection=null,N.direction.scaleInPlace(U._emitPower)),N.direction.addInPlace(U._inheritedVelocityOffset)}function IN(N,U){N.angularSpeed=(0,S.RandomRange)(U.minAngularSpeed,U.maxAngularSpeed),N.angle=(0,S.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function oN(N,U){N._currentAngularSpeedGradient=U._angularSpeedGradients[0],N.angularSpeed=N._currentAngularSpeedGradient.getFactor(),N._currentAngularSpeed1=N.angularSpeed,U._angularSpeedGradients.length>1?N._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():N._currentAngularSpeed2=N._currentAngularSpeed1,N.angle=(0,S.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function RN(N,U){N._initialStartSpriteCellId=U.startSpriteCellID,N._initialEndSpriteCellId=U.endSpriteCellID,N._initialSpriteCellLoop=U.spriteCellLoop}function DN(N,U){N.previousItem=U.previousItem,N.nextItem=U,U.previousItem&&(U.previousItem.nextItem=N),U.previousItem=N}function GN(N,U){N.previousItem=U,N.nextItem=U.nextItem,U.nextItem&&(U.nextItem.previousItem=N),U.nextItem=N}function gN(N,U){let V=U;for(;V.nextItem;)V=V.nextItem;N.previousItem=V,N.nextItem=V.nextItem,V.nextItem=N}function lN(N){N.previousItem&&(N.previousItem.nextItem=N.nextItem),N.nextItem&&(N.nextItem.previousItem=N.previousItem)}class KN extends z{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(N){this._startDirectionFunction!==N&&(this._startDirectionFunction=N,this._directionProcessing.process=N?pN:EN)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(N){this._startPositionFunction!==N&&(this._startPositionFunction=N,this._positionCreation.process=N?rN:dN)}set onDispose(N){this._onDisposeObserver&&this.Ai.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ai.add(N)}get S(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(N){this._useRampGradients!==N&&(this._useRampGradients=N,this._resetEffect(),N?(this._rampCreation={process:XN,previousItem:null,nextItem:null},GN(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:eN,previousItem:null,nextItem:null},GN(this._remapGradientProcessing,this._gravityProcessing)):(lN(this._rampCreation),lN(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(N){this._isLocal!==N&&(this._isLocal=N,N?(this._isLocalCreation={process:vN,previousItem:null,nextItem:null},GN(this._isLocalCreation,this._positionCreation)):lN(this._isLocalCreation))}get particles(){return this.Uk}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(N){this._animationSheetEnabled!==N&&(this._animationSheetEnabled=N,N?(this._sheetCreation={process:RN,previousItem:null,nextItem:null},GN(this._sheetCreation,this._colorCreation)):lN(this._sheetCreation),this._reset())}getActiveCount(){return this.Uk.length}getClassName(){return"ei"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var N;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[U])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new NN.b(this._engine),this._customWrappers[U].effect=N,this._customWrappers[U].drawContext&&(this._customWrappers[U].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new O.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(N){if(this.noiseTexture!==N){if(this._noiseTexture=N,!N)return lN(this._noiseCreation),void lN(this._noiseProcessing);this._noiseCreation={process:YN,previousItem:null,nextItem:null},GN(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:WN,previousItem:null,nextItem:null},GN(this._noiseProcessing,this._positionProcessing)}}constructor(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(N),this._emitterInverseWorldMatrix=A.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new A.CU,this.Ai=new O.d,this.onStoppedObservable=new O.d,this.onStartedObservable=new O.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Uk=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new q.Yi(0,0,0,0),this._colorDiff=new q.Yi(0,0,0,0),this._scaledDirection=A.CU.Zero(),this._scaledGravity=A.CU.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=N=>{},this.recycleParticle=N=>{const U=this.Uk.pop();U!==N&&U.copyTo(N),this._stockParticles.push(U)},this._createParticle=()=>{let N;return 0!==this._stockParticles.length?(N=this._stockParticles.pop(),N._reset()):N=new y(this),this._prepareParticle(N),N},this.paused=!1,this._shadersLoaded=!1,this._capacity=U,this._epsilon=i,V&&"Scene"!==V.getClassName()?(this._engine=V,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=V||b.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.yp.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:uN,previousItem:null,nextItem:null},this._positionCreation={process:dN,previousItem:null,nextItem:null},GN(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:EN,previousItem:null,nextItem:null},GN(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:LN,previousItem:null,nextItem:null},GN(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:MN,previousItem:null,nextItem:null},GN(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:IN,previousItem:null,nextItem:null},GN(this._angleCreation,this._sizeCreation),this._colorCreation={process:tN,previousItem:null,nextItem:null},GN(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,z||(this._colorProcessing={process:iN,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:SN,previousItem:null,nextItem:null},GN(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:JN,previousItem:null,nextItem:null},GN(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:hN,previousItem:null,nextItem:null},GN(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:sN,previousItem:null,nextItem:null},GN(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=n,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new NN.b(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new p,this.updateFunction=N=>{var U;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(U=this.noiseTexture.getContent())||void 0===U||U.then((N=>{this._noiseTextureData=N})));const V=N===this.Uk;for(let A=0;A<N.length;A++){const U=N[A];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const t=U.age;if(U.age+=this._tempScaledUpdateSpeed,U.age>U.lifeTime){const N=U.age-t,V=U.lifeTime-t;this._tempScaledUpdateSpeed=V*this._tempScaledUpdateSpeed/N,U.age=U.lifeTime}this._ratio=U.age/U.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let n=this._updateQueueStart;for(;n;)n.process(U,this),n=n.nextItem;if(this._isAnimationSheetEnabled&&!z&&U.updateCellIndex(),U._inheritParticleInfoToSubEmitters(),U.age>=U.lifeTime){if(this._emitFromParticle(U),U._attachedSubEmitters){for(const N of U._attachedSubEmitters)N.particleSystem.disposeOnStop=!0,N.particleSystem.stop();U._attachedSubEmitters=null}this.recycleParticle(U),V&&A--}else;}}}serialize(N){throw new Error("Method not implemented.")}clone(N,U){throw new Error("Method not implemented.")}_addFactorGradient(N,U,V,A){const t=new T(U,V,A);N.push(t),N.sort(((N,U)=>N.gradient<U.gradient?-1:N.gradient>U.gradient?1:0))}_removeFactorGradient(N,U){if(!N)return;let V=0;for(const A of N){if(A.gradient===U){N.splice(V,1);break}V++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=QN:this._lifeTimeCreation.process=uN}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:mU,previousItem:null,nextItem:null},GN(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(lN(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(N){this.targetStopDuration!==N&&(this._targetStopDuration=N,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(N,U,V){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,N,U,V),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(N){return this._removeFactorGradient(this._lifeTimeGradients,N),this._syncLifeTimeCreation(),this}addSizeGradient(N,U,V){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=aN,this._sizeGradientProcessing={process:wN,previousItem:null,nextItem:null},DN(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,N,U,V),this}removeSizeGradient(N){var U;return this._removeFactorGradient(this._sizeGradients,N),0===(null===(U=this._sizeGradients)||void 0===U?void 0:U.length)&&(lN(this._sizeGradientProcessing),this._sizeCreation.process=MN),this}addColorRemapGradient(N,U,V){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,N,U,V),this}removeColorRemapGradient(N){return this._removeFactorGradient(this._colorRemapGradients,N),this}addAlphaRemapGradient(N,U,V){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,N,U,V),this}removeAlphaRemapGradient(N){return this._removeFactorGradient(this._alphaRemapGradients,N),this}addAngularSpeedGradient(N,U,V){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oN,this._angularSpeedGradientProcessing={process:zN,previousItem:null,nextItem:null},DN(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,N,U,V),this}removeAngularSpeedGradient(N){var U;return this._removeFactorGradient(this._angularSpeedGradients,N),0===(null===(U=this._angularSpeedGradients)||void 0===U?void 0:U.length)&&(this._angleCreation.process=IN,lN(this._angularSpeedGradientProcessing)),this}addVelocityGradient(N,U,V){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:kN,previousItem:null,nextItem:null},GN(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:CN,previousItem:null,nextItem:null},DN(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,N,U,V),this}removeVelocityGradient(N){var U;return this._removeFactorGradient(this._velocityGradients,N),0===(null===(U=this._velocityGradients)||void 0===U?void 0:U.length)&&(lN(this._velocityCreation),lN(this._velocityGradientProcessing)),this}addLimitVelocityGradient(N,U,V){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:BN,previousItem:null,nextItem:null},GN(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:xN,previousItem:null,nextItem:null},GN(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,N,U,V),this}removeLimitVelocityGradient(N){var U;return this._removeFactorGradient(this._limitVelocityGradients,N),0===(null===(U=this._limitVelocityGradients)||void 0===U?void 0:U.length)&&(lN(this._limitVelocityCreation),lN(this._limitVelocityGradientProcessing)),this}addDragGradient(N,U,V){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:cN,previousItem:null,nextItem:null},DN(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:HN,previousItem:null,nextItem:null},DN(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,N,U,V),this}removeDragGradient(N){var U;return this._removeFactorGradient(this._dragGradients,N),0===(null===(U=this._dragGradients)||void 0===U?void 0:U.length)&&(lN(this._dragCreation),lN(this._dragGradientProcessing)),this}addEmitRateGradient(N,U,V){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,N,U,V),this}removeEmitRateGradient(N){return this._removeFactorGradient(this._emitRateGradients,N),this}addStartSizeGradient(N,U,V){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,N,U,V),this._syncStartSizeCreation(),this}removeStartSizeGradient(N){return this._removeFactorGradient(this._startSizeGradients,N),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const N=new Uint8Array(4*this._rawTextureWidth),U=q.TmpColors.rU[0];for(let V=0;V<this._rawTextureWidth;V++){const A=V/this._rawTextureWidth;f.GetCurrentGradient(A,this._rampGradients,((A,t,n)=>{q.rU.LerpToRef(A.color,t.color,n,U),N[4*V]=255*U.r,N[4*V+1]=255*U.g,N[4*V+2]=255*U.b,N[4*V+3]=255}))}this._rampGradientsTexture=Z.b.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((N,U)=>N.gradient<U.gradient?-1:N.gradient>U.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(N,U){this._rampGradients||(this._rampGradients=[]);const V=new P(N,U);return this._rampGradients.push(V),this._syncRampGradientTexture(),this}removeRampGradient(N){return this._removeGradientAndTexture(N,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(N,U,V){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=nN,this._colorProcessing.process=qN);const A=new F(N,U,V);return this._colorGradients.push(A),this._colorGradients.sort(((N,U)=>N.gradient<U.gradient?-1:N.gradient>U.gradient?1:0)),this}removeColorGradient(N){if(!this._colorGradients)return this;let U=0;for(const V of this._colorGradients){if(V.gradient===N){this._colorGradients.splice(U,1);break}U++}return 0===this._colorGradients.length&&(this._colorCreation.process=tN,this._colorProcessing.process=iN),this}resetDrawCache(){if(this._drawWrappers){for(const N of this._drawWrappers)if(N)for(const U of N)null===U||void 0===U||U.dispose();this._drawWrappers=[]}}_fetchR(N,U,V,A,t){return t[4*(((N=.5*Math.abs(N)+.5)*V%V|0)+((U=.5*Math.abs(U)+.5)*A%A|0)*V)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const N=this._engine,U=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*U),this._vertexBuffer=new c.d(N,this._vertexData,!0,U);let V=0;const A=this._vertexBuffer.createVertexBuffer(c.f.PositionKind,V,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.f.PositionKind]=A,V+=3;const t=this._vertexBuffer.createVertexBuffer(c.f.ColorKind,V,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.f.ColorKind]=t,V+=4;const n=this._vertexBuffer.createVertexBuffer("angle",V,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=n,V+=1;const q=this._vertexBuffer.createVertexBuffer("size",V,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=q,V+=2,this._isAnimationSheetEnabled){const N=this._vertexBuffer.createVertexBuffer("cellIndex",V,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=N,V+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const N=this._vertexBuffer.createVertexBuffer("direction",V,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=N,V+=3}if(this._useRampGradients){const N=this._vertexBuffer.createVertexBuffer("remapData",V,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=N,V+=4}let i;if(this._useInstancing){const U=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new c.d(N,U,!1,2),i=this._spriteBuffer.createVertexBuffer("offset",0,2)}else i=this._vertexBuffer.createVertexBuffer("offset",V,2,this._vertexBufferSize,this._useInstancing),V+=2;this._vertexBuffers.offset=i,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const N=[],U=[];let V=0;for(let A=0;A<this._capacity;A++)N.push(V),N.push(V+1),N.push(V+2),N.push(V),N.push(V+2),N.push(V+3),U.push(V,V+1,V+1,V+2,V+2,V+3,V+3,V,V,V+3),V+=4;this._indexBuffer=this._engine.createIndexBuffer(N),this._linesIndexBuffer=this._engine.createIndexBuffer(U)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(N)setTimeout((()=>{this.start(0)}),N);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var U;-1!==(null===(U=this.AU)||void 0===U?void 0:U.getClassName().indexOf("Mesh"))&&this.AU.xi(!0);const N=this.noiseTexture;if(N&&N.onGeneratedObservable)N.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),N.render()}))}));else for(let U=0;U<this.preWarmCycles;U++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(N))}_postStop(N){}reset(){this._stockParticles.length=0,this.Uk.length=0}_appendParticleVertex(N,U,V,t){let n=N*this._vertexBufferSize;if(this._vertexData[n++]=U.position.x+this.dS.x,this._vertexData[n++]=U.position.y+this.dS.y,this._vertexData[n++]=U.position.z+this.dS.z,this._vertexData[n++]=U.color.r,this._vertexData[n++]=U.color.g,this._vertexData[n++]=U.color.b,this._vertexData[n++]=U.color.a,this._vertexData[n++]=U.angle,this._vertexData[n++]=U.scale.x*U.size,this._vertexData[n++]=U.scale.y*U.size,this._isAnimationSheetEnabled&&(this._vertexData[n++]=U.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[n++]=U.direction.x,this._vertexData[n++]=U.direction.y,this._vertexData[n++]=U.direction.z);else if(U._initialDirection){let N=U._initialDirection;this.isLocal&&(A.CU.TransformNormalToRef(N,this._emitterWorldMatrix,A.TmpVectors.CU[0]),N=A.TmpVectors.CU[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[n++]=N.x,this._vertexData[n++]=N.y,this._vertexData[n++]=N.z}else{let N=U.direction;this.isLocal&&(A.CU.TransformNormalToRef(N,this._emitterWorldMatrix,A.TmpVectors.CU[0]),N=A.TmpVectors.CU[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[n++]=N.x,this._vertexData[n++]=N.y,this._vertexData[n++]=N.z}this._useRampGradients&&U.remapData&&(this._vertexData[n++]=U.remapData.x,this._vertexData[n++]=U.remapData.y,this._vertexData[n++]=U.remapData.z,this._vertexData[n++]=U.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===V?V=this._epsilon:1===V&&(V=1-this._epsilon),0===t?t=this._epsilon:1===t&&(t=1-this._epsilon)),this._vertexData[n++]=V,this._vertexData[n++]=t)}_prepareParticle(N){}_createNewOnes(N){let U;for(let V=0;V<N&&this.Uk.length!==this._capacity;V++){U=this._createParticle(),this.Uk.push(U);let N=this._createQueueStart;for(;N;)N.process(U,this),N=N.nextItem;U._inheritParticleInfoToSubEmitters()}}_update(N){if(this._alive=this.Uk.length>0,this.AU.position){const N=this.AU;this._emitterWorldMatrix=N.getWorldMatrix()}else{const N=this.AU;this._emitterWorldMatrix=A.Matrix.Translation(N.x,N.y,N.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Uk),this._createNewOnes(N)}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=[c.f.PositionKind,c.f.ColorKind,"angle","offset","size"];return N&&A.push("cellIndex"),U||A.push("direction"),V&&A.push("remapData"),A}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,UN.b)(A),N&&A.push("particlesInfos"),U&&A.push("logarithmicDepthConstant"),V&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(N,U){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UN.k)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&N.push("#define FOG")),this._isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),U===z.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&N.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case 2:N.push("#define BILLBOARDY");break;case 8:case 9:N.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&N.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:N.push("#define BILLBOARDMODE_ALL")}V&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,U,V){U.push(...KN._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),N.push(...KN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),V.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,AN.f)(N,this._imageProcessingConfigurationDefines),(0,AN.e)(V,this._imageProcessingConfigurationDefines))}_getWrapper(N){const U=this._getCustomDrawWrapper(N);if(null!==U&&void 0!==U&&U.effect)return U;const V=[];this.fillDefines(V,N);const A=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let t=this._drawWrappers[A];t||(t=this._drawWrappers[A]=[]);let n=t[N];n||(n=new NN.b(this._engine),n.drawContext&&(n.drawContext.useInstancing=this._useInstancing),t[N]=n);const q=V.join("\n");if(n.defines!==q){const N=[],U=[],V=[];this.fillUniformsAttributesAndSamplerNames(U,N,V),n.setEffect(this._engine.createEffect("particles",N,U,V,q,void 0,void 0,void 0,void 0,this._shaderLanguage),q)}return n}animate(){var N;let U,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!V&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(V?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this.manualEmitCount>-1)U=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let N=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const U=this._actualFrame/this.targetStopDuration;f.GetCurrentGradient(U,this._emitRateGradients,((U,V,A)=>{U!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=V.getFactor(),this._currentEmitRateGradient=U),N=(0,S.Lerp)(this._currentEmitRate1,this._currentEmitRate2,A)}))}U=N*this._scaledUpdateSpeed|0,this._newPartsExcess+=N*this._scaledUpdateSpeed-U}if(this._newPartsExcess>1&&(U+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?U=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(U),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!V){let N=0;for(let U=0;U<this.Uk.length;U++){const V=this.Uk[U];this._appendParticleVertices(N,V),N+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Uk.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(N,U){this._appendParticleVertex(N++,U,0,0),this._useInstancing||(this._appendParticleVertex(N++,U,1,0),this._appendParticleVertex(N++,U,1,1),this._appendParticleVertex(N++,U,0,1))}rebuild(){var N;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(N=this._spriteBuffer)||void 0===N||N._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!KN.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(V.bind(V,13823)),Promise.resolve().then(V.bind(V,13780))])):await Promise.all([Promise.resolve().then(V.bind(V,13763)),Promise.resolve().then(V.bind(V,13752))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.AU||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==z.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(z.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(z.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(N){const U=this._getWrapper(N),V=U.effect,t=this._engine;t.enableEffect(U);const n=this.defaultViewMatrix??this._scene.getViewMatrix();if(V.setTexture("diffuseSampler",this.particleTexture),V.setMatrix("view",n),V.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();V.setFloat3("particlesInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,this.spriteCellWidth/N.width)}if(V.setVector2("translationPivot",this.translationPivot),V.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;V.setVector3("eyePosition",N.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),V.setTexture("rampSampler",this._rampGradientsTexture));const q=V.defines;var i,z,S,E,p,k;(this._scene&&((0,UN.d)(V,this,this._scene),this.applyFog&&(0,VN.f)(this._scene,void 0,V)),q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(n.invertToRef(A.TmpVectors.Matrix[0]),V.setMatrix("invView",A.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?t.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,V):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,V)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?t.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBuffer:this._indexBuffer,V):t.bindBuffers(this._vertexBuffers,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null,V);(this.useLogarithmicDepth&&this._scene&&(0,VN.k)(q,V,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(V),this._setEngineBasedOnBlendMode(N),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(V),this._useInstancing)?null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?t.drawElementsType(6,0,10,this.Uk.length):t.drawArraysType(7,0,4,this.Uk.length):null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?t.drawElementsType(1,0,10*this.Uk.length):t.drawElementsType(0,0,6*this.Uk.length);return this.Uk.length}render(){if(!this.isReady()||!this.Uk.length)return 0;const N=this._engine;N.setState&&(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0));let U=0;return U=this.blendMode===z.BLENDMODE_MULTIPLYADD?this._render(z.BLENDMODE_MULTIPLY)+this._render(z.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),U}_onDispose(){}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(U,V),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const N=this._scene.yp.indexOf(this);N>-1&&this._scene.yp.splice(N,1),this._scene._activeParticleSystems.dispose()}this.Ai.notifyObservers(this),this.Ai.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}KN.ForceGLSL=!1;var jN,FN=V(12209);!function(N){N[N.ATTACHED=0]="ATTACHED",N[N.END=1]="END"}(jN||(jN={}));class PN{constructor(N){if(this.particleSystem=N,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!N.AU||!N.AU.dispose){const U=(0,i.d)("BABYLON.AbstractMesh");N.AU=new U("SubemitterSystemEmitter",N.YN()),N._disposeEmitterOnDispose=!0}}clone(){let N=this.particleSystem.AU;if(N){if(N instanceof A.CU)N=N.clone();else if(-1!==N.getClassName().indexOf("Mesh")){N=new((0,i.d)("BABYLON.Mesh"))("",N.YN()),N.isVisible=!1}}else N=new A.CU;const U=new PN(this.particleSystem.clone(this.particleSystem.name,N));return U.particleSystem.name+="Clone",U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem._disposeEmitterOnDispose=!0,U.particleSystem.disposeOnStop=!0,U}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem=this.particleSystem.serialize(N),U}static _ParseParticleSystem(N,U,V){throw(0,FN.d)("ParseParticle")}static Parse(N,U,V){const A=N.particleSystem,t=new PN(PN._ParseParticleSystem(A,U,V,!0));return t.type=N.type,t.inheritDirection=N.inheritDirection,t.inheritedVelocityAmount=N.inheritedVelocityAmount,t.particleSystem._isSubEmitter=!0,t}dispose(){this.particleSystem.dispose()}}var TN=V(12272);function fN(N,U){const V=new d;return V.direction1=N,V.direction2=U,V}function ON(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ZN(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function bN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.CU(0,1,0),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0);return new v(N,U,V)}function yN(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function NU(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.CU(0,1,0);return new x(N,U,V,t,n)}function UU(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new k(N,U)}function VU(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0);return new B(N,U,V,t)}const AU=A.CU.Zero(),tU=A.CU.Zero(),nU=A.CU.Zero();class qU{constructor(){this.strength=0,this.position=A.CU.Zero()}_processParticle(N,U){this.position.subtractToRef(N.position,AU);const V=AU.lengthSquared()+1;AU.normalize().scaleToRef(this.strength/V,tU),tU.scaleToRef(U._tempScaledUpdateSpeed,nU),N.direction.addInPlace(nU)}serialize(){return{position:this.position.pi(),strength:this.strength}}}class iU extends KN{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=N=>{if(!this._subEmitters||0===this._subEmitters.length)return;const U=Math.floor(Math.random()*this._subEmitters.length);for(const V of this._subEmitters[U])if(1===V.type){const U=V.clone();N._inheritParticleInfoToSubEmitter(U),U.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(U.particleSystem),U.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(N,U){const V=fN(N,U);return this.particleEmitterType=V,V}get flowMap(){return this._flowMap}set flowMap(N){this._flowMap!==N&&(this._flowMap=N,this._flowMapUpdate&&(lN(this._flowMapUpdate),this._flowMapUpdate=null),N&&(this._flowMapUpdate={process:N=>{var U;const V=null===(U=this.YN())||void 0===U?void 0:U.getTransformMatrix();this._flowMap._processParticle(N,this.flowMapStrength*this._tempScaledUpdateSpeed,V)},previousItem:null,nextItem:null},GN(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(N){this._attractors.push(N),1===this._attractors.length&&(this._attractorUpdate={process:N=>{for(const U of this._attractors)U._processParticle(N,this)},previousItem:null,nextItem:null},GN(this._attractorUpdate,this._directionProcessing))}removeAttractor(N){const U=this._attractors.indexOf(N);-1!==U&&this._attractors.splice(U,1),0===this._attractors.length&&lN(this._attractorUpdate)}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(N)}createHemisphericEmitter(){const N=ON(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=ZN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=bN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.CU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=yN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=NU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.CU(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=VU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,U,V,A){const t=new p;return this.particleEmitterType=t,this.direction1=N,this.direction2=U,this.minEmitBox=V,this.maxEmitBox=A,t}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const N of this.subEmitters)N instanceof iU?this._subEmitters.push([new PN(N)]):N instanceof PN?this._subEmitters.push([N]):N instanceof Array&&this._subEmitters.push(N)}_stopSubEmitters(){if(this.activeSubSystems){for(const N of this.activeSubSystems)N.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const N=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==N&&this._rootParticleSystem.activeSubSystems.splice(N,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(N){N&&this._stopSubEmitters()}_prepareParticle(N){if(this._subEmitters&&this._subEmitters.length>0){const U=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];N._attachedSubEmitters=[];for(const V of U)if(0===V.type){const U=V.clone();N._attachedSubEmitters.push(U),U.particleSystem.start()}}}_onDispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),N&&this.particles)for(const V of this.particles)if(V._attachedSubEmitters)for(let N=V._attachedSubEmitters.length-1;N>=0;N-=1)V._attachedSubEmitters[N].dispose();if(U&&this.activeSubSystems)for(let V=this.activeSubSystems.length-1;V>=0;V-=1)this.activeSubSystems[V].dispose();if(this._subEmitters&&this._subEmitters.length){for(let N=0;N<this._subEmitters.length;N++)for(const U of this._subEmitters[N])U.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.AU&&this.AU.dispose&&this.AU.dispose(!0)}static _Parse(N,U,V,t){let n;n=V instanceof TN.c?null:V;const z=(0,i.d)("BABYLON.Texture");if(z&&n&&(N.texture?U.particleTexture=z.Parse(N.texture,n,t):N.textureName&&(U.particleTexture=new z(t+N.textureName,n,!1,void 0===N.invertY||N.invertY),U.particleTexture.name=N.textureName)),N.emitterId||0===N.emitterId||void 0!==N.AU?N.emitterId&&n?U.AU=n.getLastMeshById(N.emitterId):U.AU=A.CU.vU(N.AU):U.AU=A.CU.Zero(),U.isLocal=!!N.isLocal,void 0!==N.renderingGroupId&&(U.renderingGroupId=N.renderingGroupId),void 0!==N.isBillboardBased&&(U.isBillboardBased=N.isBillboardBased),void 0!==N.billboardMode&&(U.billboardMode=N.billboardMode),void 0!==N.useLogarithmicDepth&&(U.useLogarithmicDepth=N.useLogarithmicDepth),N.animations){for(let V=0;V<N.animations.length;V++){const A=N.animations[V],t=(0,i.d)("BABYLON.Animation");t&&U.animations.push(t.Parse(A))}U.beginAnimationOnStart=N.beginAnimationOnStart,U.beginAnimationFrom=N.beginAnimationFrom,U.beginAnimationTo=N.beginAnimationTo,U.beginAnimationLoop=N.beginAnimationLoop}if(N.autoAnimate&&n&&n.beginAnimation(U,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),U.startDelay=0|N.startDelay,U.minAngularSpeed=N.minAngularSpeed,U.maxAngularSpeed=N.maxAngularSpeed,U.minSize=N.minSize,U.maxSize=N.maxSize,N.minScaleX&&(U.minScaleX=N.minScaleX,U.maxScaleX=N.maxScaleX,U.minScaleY=N.minScaleY,U.maxScaleY=N.maxScaleY),void 0!==N.preWarmCycles&&(U.preWarmCycles=N.preWarmCycles,U.preWarmStepOffset=N.preWarmStepOffset),void 0!==N.minInitialRotation&&(U.minInitialRotation=N.minInitialRotation,U.maxInitialRotation=N.maxInitialRotation),U.minLifeTime=N.minLifeTime,U.maxLifeTime=N.maxLifeTime,U.minEmitPower=N.minEmitPower,U.maxEmitPower=N.maxEmitPower,U.emitRate=N.emitRate,U.gravity=A.CU.vU(N.gravity),N.noiseStrength&&(U.noiseStrength=A.CU.vU(N.noiseStrength)),U.color1=q.Yi.vU(N.color1),U.color2=q.Yi.vU(N.color2),U.colorDead=q.Yi.vU(N.colorDead),U.updateSpeed=N.updateSpeed,U.targetStopDuration=N.targetStopDuration,U.blendMode=N.blendMode,N.colorGradients)for(const A of N.colorGradients)U.addColorGradient(A.gradient,q.Yi.vU(A.color1),A.color2?q.Yi.vU(A.color2):void 0);if(N.rampGradients){for(const V of N.rampGradients)U.addRampGradient(V.gradient,q.rU.vU(V.color));U.useRampGradients=N.useRampGradients}if(N.colorRemapGradients)for(const A of N.colorRemapGradients)U.addColorRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.alphaRemapGradients)for(const A of N.alphaRemapGradients)U.addAlphaRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.sizeGradients)for(const A of N.sizeGradients)U.addSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.angularSpeedGradients)for(const A of N.angularSpeedGradients)U.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.velocityGradients)for(const A of N.velocityGradients)U.addVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.dragGradients)for(const A of N.dragGradients)U.addDragGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.emitRateGradients)for(const A of N.emitRateGradients)U.addEmitRateGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.startSizeGradients)for(const A of N.startSizeGradients)U.addStartSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.lifeTimeGradients)for(const A of N.lifeTimeGradients)U.addLifeTimeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.limitVelocityGradients){for(const V of N.limitVelocityGradients)U.addLimitVelocityGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);U.limitVelocityDamping=N.limitVelocityDamping}if(N.noiseTexture&&n){const V=(0,i.d)("BABYLON.ProceduralTexture");U.noiseTexture=V.Parse(N.noiseTexture,n,t)}let S;if(N.particleEmitterType){switch(N.particleEmitterType.type){case"SphereParticleEmitter":S=new r;break;case"SphereDirectedParticleEmitter":S=new v;break;case"ConeEmitter":case"ConeParticleEmitter":S=new k;break;case"ConeDirectedParticleEmitter":S=new B;break;case"CylinderParticleEmitter":S=new C;break;case"CylinderDirectedParticleEmitter":S=new x;break;case"HemisphericParticleEmitter":S=new J;break;case"PointParticleEmitter":S=new d;break;case"MeshParticleEmitter":S=new H;break;case"CustomParticleEmitter":S=new h;break;default:S=new p}S.parse(N.particleEmitterType,n)}else S=new p,S.parse(N,n);U.particleEmitterType=S,U.startSpriteCellID=N.startSpriteCellID,U.endSpriteCellID=N.endSpriteCellID,U.spriteCellLoop=N.spriteCellLoop??!0,U.spriteCellWidth=N.spriteCellWidth,U.spriteCellHeight=N.spriteCellHeight,U.spriteCellChangeSpeed=N.spriteCellChangeSpeed,U.spriteRandomStartCell=N.spriteRandomStartCell,U.disposeOnStop=N.disposeOnStop??!1,U.manualEmitCount=N.manualEmitCount??-1}static Parse(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0;const i=N.name;let z,S,E=null,p=null;if(U instanceof TN.c?z=U:(S=U,z=S.getEngine()),N.customShader&&z.createEffectForParticles){p=N.customShader;const U=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"";E=z.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,U)}const k=new iU(i,n||N.SV,U,E,N.isAnimationSheetEnabled);if(k.customShader=p,k._rootUrl=V,N.id&&(k.id=N.id),N.subEmitters){k.subEmitters=[];for(const A of N.subEmitters){const N=[];for(const t of A)N.push(PN.Parse(t,U,V));k.subEmitters.push(N)}}if(N.attractors)for(const q of N.attractors){const N=new qU;N.position=A.CU.vU(q.position),N.strength=q.strength,k.addAttractor(N)}return iU._Parse(N,k,U,V),N.textureMask&&(k.textureMask=q.Yi.vU(N.textureMask)),N.dS&&(k.dS=A.CU.vU(N.dS)),N.preventAutoStart&&(k.preventAutoStart=N.preventAutoStart),t||k.preventAutoStart||k.start(),k}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};if(iU._Serialize(U,this,N),U.textureMask=this.textureMask.pi(),U.customShader=this.customShader,U.preventAutoStart=this.preventAutoStart,U.dS=this.dS.pi(),this.subEmitters){U.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const V of this._subEmitters){const A=[];for(const U of V)A.push(U.serialize(N));U.subEmitters.push(A)}}if(this._attractors&&this._attractors.length){U.attractors=[];for(const N of this._attractors)U.attractors.push(N.serialize())}return U}static _Serialize(N,U,V){if(N.name=U.name,N.id=U.id,N.SV=U.getCapacity(),N.disposeOnStop=U.disposeOnStop,N.manualEmitCount=U.manualEmitCount,U.AU.position){const V=U.AU;N.emitterId=V.id}else{const V=U.AU;N.AU=V.pi()}U.particleEmitterType&&(N.particleEmitterType=U.particleEmitterType.serialize()),U.particleTexture&&(V?N.texture=U.particleTexture.serialize():(N.textureName=U.particleTexture.name,N.invertY=!!U.particleTexture._invertY)),N.isLocal=U.isLocal,Q.d.AppendSerializedAnimations(U,N),N.beginAnimationOnStart=U.beginAnimationOnStart,N.beginAnimationFrom=U.beginAnimationFrom,N.beginAnimationTo=U.beginAnimationTo,N.beginAnimationLoop=U.beginAnimationLoop,N.startDelay=U.startDelay,N.renderingGroupId=U.renderingGroupId,N.isBillboardBased=U.isBillboardBased,N.billboardMode=U.billboardMode,N.minAngularSpeed=U.minAngularSpeed,N.maxAngularSpeed=U.maxAngularSpeed,N.minSize=U.minSize,N.maxSize=U.maxSize,N.minScaleX=U.minScaleX,N.maxScaleX=U.maxScaleX,N.minScaleY=U.minScaleY,N.maxScaleY=U.maxScaleY,N.minEmitPower=U.minEmitPower,N.maxEmitPower=U.maxEmitPower,N.minLifeTime=U.minLifeTime,N.maxLifeTime=U.maxLifeTime,N.emitRate=U.emitRate,N.gravity=U.gravity.pi(),N.noiseStrength=U.noiseStrength.pi(),N.color1=U.color1.pi(),N.color2=U.color2.pi(),N.colorDead=U.colorDead.pi(),N.updateSpeed=U.updateSpeed,N.targetStopDuration=U.targetStopDuration,N.blendMode=U.blendMode,N.preWarmCycles=U.preWarmCycles,N.preWarmStepOffset=U.preWarmStepOffset,N.minInitialRotation=U.minInitialRotation,N.maxInitialRotation=U.maxInitialRotation,N.startSpriteCellID=U.startSpriteCellID,N.spriteCellLoop=U.spriteCellLoop,N.endSpriteCellID=U.endSpriteCellID,N.spriteCellChangeSpeed=U.spriteCellChangeSpeed,N.spriteCellWidth=U.spriteCellWidth,N.spriteCellHeight=U.spriteCellHeight,N.spriteRandomStartCell=U.spriteRandomStartCell,N.isAnimationSheetEnabled=U.isAnimationSheetEnabled,N.useLogarithmicDepth=U.useLogarithmicDepth;const A=U.getColorGradients();if(A){N.colorGradients=[];for(const U of A){const V={gradient:U.gradient,color1:U.color1.pi()};U.color2?V.color2=U.color2.pi():V.color2=U.color1.pi(),N.colorGradients.push(V)}}const t=U.getRampGradients();if(t){N.rampGradients=[];for(const U of t){const V={gradient:U.gradient,color:U.color.pi()};N.rampGradients.push(V)}N.useRampGradients=U.useRampGradients}const n=U.getColorRemapGradients();if(n){N.colorRemapGradients=[];for(const U of n){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.colorRemapGradients.push(V)}}const q=U.getAlphaRemapGradients();if(q){N.alphaRemapGradients=[];for(const U of q){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.alphaRemapGradients.push(V)}}const i=U.getSizeGradients();if(i){N.sizeGradients=[];for(const U of i){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.sizeGradients.push(V)}}const z=U.getAngularSpeedGradients();if(z){N.angularSpeedGradients=[];for(const U of z){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.angularSpeedGradients.push(V)}}const S=U.getVelocityGradients();if(S){N.velocityGradients=[];for(const U of S){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.velocityGradients.push(V)}}const E=U.getDragGradients();if(E){N.dragGradients=[];for(const U of E){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.dragGradients.push(V)}}const p=U.getEmitRateGradients();if(p){N.emitRateGradients=[];for(const U of p){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.emitRateGradients.push(V)}}const k=U.getStartSizeGradients();if(k){N.startSizeGradients=[];for(const U of k){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.startSizeGradients.push(V)}}const B=U.getLifeTimeGradients();if(B){N.lifeTimeGradients=[];for(const U of B){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.lifeTimeGradients.push(V)}}const C=U.getLimitVelocityGradients();if(C){N.limitVelocityGradients=[];for(const U of C){const V={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?V.factor2=U.factor2:V.factor2=U.factor1,N.limitVelocityGradients.push(V)}N.limitVelocityDamping=U.limitVelocityDamping}U.noiseTexture&&(N.noiseTexture=U.noiseTexture.serialize())}clone(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let t=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){t=this.customShader;const N=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",U=n.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,N);A[0]?A[0].effect=U:this.setCustomEffect(U,0)}const q=this.serialize(V),i=iU.Parse(q,this._scene||this._engine,this._rootUrl);return i.name=N,i.customShader=t,i._customWrappers=A,void 0===U&&(U=this.AU),this.noiseTexture&&(i.noiseTexture=this.noiseTexture.clone()),i.AU=U,this.preventAutoStart||i.start(),i}}iU.BILLBOARDMODE_Y=2,iU.BILLBOARDMODE_ALL=7,iU.BILLBOARDMODE_STRETCHED=8,iU.BILLBOARDMODE_STRETCHED_LOCAL=9,PN._ParseParticleSystem=iU.Parse;var zU=V(12604),SU=V(12601),EU=V(12512);EU.e.prototype.createTransformFeedback=function(){const N=this._gl.createTransformFeedback();if(!N)throw new Error("Unable to create Transform Feedback");return N},EU.e.prototype.deleteTransformFeedback=function(N){this._gl.deleteTransformFeedback(N)},EU.e.prototype.bindTransformFeedback=function(N){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,N)},EU.e.prototype.beginTransformFeedback=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(N?this._gl.POINTS:this._gl.TRIANGLES)},EU.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},EU.e.prototype.setTranformFeedbackVaryings=function(N,U){this._gl.transformFeedbackVaryings(N,U,this._gl.INTERLEAVED_ATTRIBS)},EU.e.prototype.bindTransformFeedbackBuffer=function(N){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N?N.underlyingResource:null)},EU.e.prototype.readTransformFeedbackBuffer=function(N){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N)};const pU="clipPlaneFragmentDeclaration2",kU="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";W.b.IncludesShadersStore[pU]||(W.b.IncludesShadersStore[pU]=kU);V(13640),V(13649),V(13657),V(13659),V(13661),V(13665),V(13674),V(13680);const BU="gpuRenderParticlesPixelShader",CU="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";W.b.ShadersStore[BU]||(W.b.ShadersStore[BU]=CU);const xU="clipPlaneVertexDeclaration2",JU="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";W.b.IncludesShadersStore[xU]||(W.b.IncludesShadersStore[xU]=JU);V(13689),V(13697),V(13706),V(13708);const dU="gpuRenderParticlesVertexShader",rU="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";W.b.ShadersStore[dU]||(W.b.ShadersStore[dU]=rU);class vU extends z{static get IsSupported(){if(!b.e.LastCreatedEngine)return!1;const N=b.e.LastCreatedEngine.getCaps();return N.supportTransformFeedbacks||N.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(N){this._maxActiveParticleCount=Math.min(N,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(N){this.maxActiveParticleCount=N}createPointEmitter(N,U){const V=fN(N,U);return this.particleEmitterType=V,V}createHemisphericEmitter(){const N=ON(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=ZN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=bN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.CU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=yN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=NU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.CU(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=VU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.CU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.CU(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,U,V,A){const t=new p;return this.particleEmitterType=t,this.direction1=N,this.direction2=U,this.minEmitBox=V,this.maxEmitBox=A,t}get flowMap(){return this._flowMap}set flowMap(N){this._flowMap!==N&&(this._flowMap=N)}isReady(){if(!this.AU||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==iU.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(iU.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(iU.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";N?setTimeout((()=>{this.start(0)}),N):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var N;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[U])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new NN.b(this._engine),this._customWrappers[U].effect=N}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new O.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(N,U,V){return super._removeGradientAndTexture(N,U,V),this._releaseBuffers(),this}addColorGradient(N,U){this._colorGradients||(this._colorGradients=[]);const V=new F(N,U);return this._colorGradients.push(V),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(N&&this._colorGradients.sort(((N,U)=>N.gradient<U.gradient?-1:N.gradient>U.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(N){return this._removeGradientAndTexture(N,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const U in this._drawWrappers){var N;null===(N=this._drawWrappers[U].drawContext)||void 0===N||N.reset()}}_addFactorGradient(N,U,V){const A=new T(U,V);N.push(A),this._releaseBuffers()}addSizeGradient(N,U){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,U),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(N){return this._removeGradientAndTexture(N,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(N,U){if(!N)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&N.sort(((N,U)=>N.gradient<U.gradient?-1:N.gradient>U.gradient?1:0));const V=this;V[U]&&(V[U].dispose(),V[U]=null)}addAngularSpeedGradient(N,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,U),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(N){return this._removeGradientAndTexture(N,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(N,U){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,U),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(N){return this._removeGradientAndTexture(N,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(N,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,U),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(N){return this._removeGradientAndTexture(N,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(N,U){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,U),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(N){return this._removeGradientAndTexture(N,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(N){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(N),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ai=new O.d,this.onStoppedObservable=new O.d,this.onStartedObservable=new O.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,V&&"Scene"!==V.getClassName()?(this._engine=V,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=V||b.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.yp.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,i.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,i.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,i.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,i.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new NN.b(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers={0:new NN.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(U=U??{}).randomTextureSize||delete U.randomTextureSize;const q={SV:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...U},z=U;isFinite(z)&&(q.SV=z),this._capacity=q.SV,this._maxActiveParticleCount=q.SV,this._currentActiveCount=0,this._isAnimationSheetEnabled=n,this.particleEmitterType=new p;const S=Math.min(this._engine.getCaps().maxTextureSize,q.randomTextureSize);let E=[];for(let A=0;A<S;++A)E.push(Math.random()),E.push(Math.random()),E.push(Math.random()),E.push(Math.random());this._randomTexture=new Z.b(new Float32Array(E),S,1,5,V,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,E=[];for(let A=0;A<S;++A)E.push(Math.random()),E.push(Math.random()),E.push(Math.random()),E.push(Math.random());this._randomTexture2=new Z.b(new Float32Array(E),S,1,5,V,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=S}_reset(){this._releaseBuffers()}_createVertexBuffers(N,U,V){const A={};A.position=U.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let t=3;A.age=U.createVertexBuffer("age",t,1,this._attributesStrideSize,!0),t+=1,A.size=U.createVertexBuffer("size",t,3,this._attributesStrideSize,!0),t+=3,A.life=U.createVertexBuffer("life",t,1,this._attributesStrideSize,!0),t+=1,t+=4,this.billboardMode===iU.BILLBOARDMODE_STRETCHED&&(A.direction=U.createVertexBuffer("direction",t,3,this._attributesStrideSize,!0)),t+=3,this._platform.alignDataInBuffer&&(t+=1),this.particleEmitterType instanceof h&&(t+=3,this._platform.alignDataInBuffer&&(t+=1)),this._colorGradientsTexture||(A.color=U.createVertexBuffer("color",t,4,this._attributesStrideSize,!0),t+=4),this._isBillboardBased||(A.initialDirection=U.createVertexBuffer("initialDirection",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),this.noiseTexture&&(A.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1),A.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),A.angle=U.createVertexBuffer("angle",t,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?t++:t+=2,this._isAnimationSheetEnabled&&(A.cellIndex=U.createVertexBuffer("cellIndex",t,1,this._attributesStrideSize,!0),t+=1,this.spriteRandomStartCell&&(A.cellStartOffset=U.createVertexBuffer("cellStartOffset",t,1,this._attributesStrideSize,!0),t+=1)),A.offset=V.createVertexBuffer("offset",0,2),A.uv=V.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(A),this._platform.createVertexBuffers(N,A),this.resetDrawCache()}_initialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!N)return;const U=this._engine,V=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof h&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const t=this.particleEmitterType instanceof h,n=A.TmpVectors.CU[0];let q=0;for(let A=0;A<this._capacity;A++)if(V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),t?(this.particleEmitterType.particleDestinationGenerator(A,null,n),V.push(n.x),V.push(n.y),V.push(n.z)):(V.push(0),V.push(0),V.push(0)),this._platform.alignDataInBuffer&&V.push(0),q+=16,t&&(this.particleEmitterType.particlePositionGenerator(A,null,n),V.push(n.x),V.push(n.y),V.push(n.z),this._platform.alignDataInBuffer&&V.push(0),q+=4),this._colorGradientsTexture||(V.push(0),V.push(0),V.push(0),V.push(0),q+=4),this.isBillboardBased||(V.push(0),V.push(0),V.push(0),this._platform.alignDataInBuffer&&V.push(0),q+=4),this.noiseTexture&&(V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),this._platform.alignDataInBuffer&&V.push(0),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),this._platform.alignDataInBuffer&&V.push(0),q+=8),V.push(0),q+=1,this._angularSpeedGradientsTexture||(V.push(0),q+=1),this._isAnimationSheetEnabled&&(V.push(0),q+=1,this.spriteRandomStartCell&&(V.push(0),q+=1)),this._platform.alignDataInBuffer){let N=3-(q+3&3);for(q+=N;N-- >0;)V.push(0)}const i=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),z=this._platform.createParticleBuffer(V),S=this._platform.createParticleBuffer(V);this._buffer0=new c.d(U,z,!1,this._attributesStrideSize),this._buffer1=new c.d(U,S,!1,this._attributesStrideSize),this._spriteBuffer=new c.d(U,i,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let N=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(N+="\n#define BILLBOARD"),this._colorGradientsTexture&&(N+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(N+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(N+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(N+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(N+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(N+="\n#define DRAGGRADIENTS"),this._flowMap&&(N+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(N+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(N+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(N+="\n#define NOISE"),this.isLocal&&(N+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===N||(this._cachedUpdateDefines=N,this._updateBuffer=this._platform.createUpdateBuffer(N)),this._platform.isUpdateBufferReady()}_getWrapper(N){const U=this._getCustomDrawWrapper(N);if(null!==U&&void 0!==U&&U.effect)return U;const V=[];this.fillDefines(V,N);let A=this._drawWrappers[N];A||(A=new NN.b(this._engine),A.drawContext&&(A.drawContext.useInstancing=!0),this._drawWrappers[N]=A);const t=V.join("\n");if(A.defines!==t){const N=[],U=[],V=[];this.fillUniformsAttributesAndSamplerNames(U,N,V),A.setEffect(this._engine.createEffect("gpuRenderParticles",N,U,V,t),t)}return A}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=[c.f.PositionKind,"age","life","size","angle"];return N||t.push(c.f.ColorKind),U&&t.push("cellIndex"),V||t.push("initialDirection"),A&&t.push("direction"),t.push("offset",c.f.UVKind),t}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["emitterWM","dS","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,UN.b)(A),N&&A.push("sheetInfos"),U&&A.push("logarithmicDepthConstant"),V&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UN.k)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==SU.e.FOGMODE_NONE&&N.push("#define FOG")),U===iU.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this.isLocal&&N.push("#define LOCAL"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case iU.BILLBOARDMODE_Y:N.push("#define BILLBOARDY");break;case iU.BILLBOARDMODE_STRETCHED:N.push("#define BILLBOARDSTRETCHED");break;case iU.BILLBOARDMODE_ALL:N.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&N.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),V&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,U,V){U.push(...vU._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===iU.BILLBOARDMODE_STRETCHED)),N.push(...vU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),V.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(zU.d.PrepareUniforms(N,this._imageProcessingConfigurationDefines),zU.d.PrepareSamplers(V,this._imageProcessingConfigurationDefines))}animate(){var N;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(U?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(N,U){const V=this[U];if(!N||!N.length||V)return;const A=new Float32Array(this._rawTextureWidth);for(let t=0;t<this._rawTextureWidth;t++){const U=t/this._rawTextureWidth;f.GetCurrentGradient(U,N,((N,U,V)=>{A[t]=(0,S.Lerp)(N.factor1,U.factor1,V)}))}this[U]=Z.b.CreateRTexture(A,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[U].name=U.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const N=new Uint8Array(4*this._rawTextureWidth),U=q.TmpColors.Yi[0];for(let V=0;V<this._rawTextureWidth;V++){const A=V/this._rawTextureWidth;f.GetCurrentGradient(A,this._colorGradients,((A,t,n)=>{q.Yi.LerpToRef(A.color1,t.color1,n,U),N[4*V]=255*U.r,N[4*V+1]=255*U.g,N[4*V+2]=255*U.b,N[4*V+3]=255*U.a}))}this._colorGradientsTexture=Z.b.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(N,U){var V,t,n,q;const i=this._getWrapper(N),z=i.effect;this._engine.enableEffect(i);const S=(null===(V=this._scene)||void 0===V?void 0:V.getViewMatrix())||A.Matrix.IdentityReadOnly;if(z.setMatrix("view",S),z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),z.setTexture("diffuseSampler",this.particleTexture),z.setVector2("translationPivot",this.translationPivot),z.setVector3("dS",this.dS),this.isLocal&&z.setMatrix("emitterWM",U),this._colorGradientsTexture?z.setTexture("colorGradientSampler",this._colorGradientsTexture):z.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();z.setFloat3("sheetInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,N.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;z.setVector3("eyePosition",N.globalPosition)}const E=z.defines;if(this._scene&&((0,UN.d)(z,this,this._scene),this.applyFog&&(0,VN.f)(this._scene,void 0,z)),E.indexOf("#define BILLBOARDMODE_ALL")>=0){const N=S.clone();N.invert(),z.setMatrix("invView",N)}return this.useLogarithmicDepth&&this._scene&&(0,VN.k)(E,z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(z),this._setEngineBasedOnBlendMode(N),this._platform.bindDrawBuffers(this._targetIndex,z,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(z),null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(N){if(!this.AU||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!N)if(this.AU.position){N=this.AU.getWorldMatrix()}else{const U=this.AU;N=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(U.x,U.y,U.z,N)}const U=this._engine,V=U.getDepthWrite();if(U.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const N=this.YN();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",N.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",N),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const t=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=t,U.setDepthWrite(V)}render(){let N,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!U&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let N=0;N<this.preWarmCycles;N++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const N=0|this._accumulatedCount;this._accumulatedCount-=N,this._currentActiveCount+=N}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.AU.position){N=this.AU.getWorldMatrix()}else{const U=this.AU;N=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(U.x,U.y,U.z,N)}const t=this._engine;this.updateInAnimate||this._update(N);let n=0;return U||V||(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0),n=this.blendMode===iU.BLENDMODE_MULTIPLYADD?this._render(iU.BLENDMODE_MULTIPLY,N)+this._render(iU.BLENDMODE_ADD,N):this._render(this.blendMode,N),this._engine.setAlphaMode(0)),n}rebuild(){const N=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(N,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,N()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const U in this._drawWrappers){this._drawWrappers[U].dispose()}if(this._drawWrappers={},this._scene){const N=this._scene.yp.indexOf(this);N>-1&&this._scene.yp.splice(N,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let U=0;U<this._renderVertexBuffers.length;++U){const N=this._renderVertexBuffers[U];for(const U in N)N[U].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ai.notifyObservers(this),this.Ai.clear()}clone(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let t=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){t=this.customShader;const N=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";A[0]=n.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,N,void 0,void 0,void 0,this)}const q=this.serialize(V),i=vU.Parse(q,this._scene||this._engine,this._rootUrl);return i.name=N,i.customShader=t,i._customWrappers=A,void 0===U&&(U=this.AU),this.noiseTexture&&(i.noiseTexture=this.noiseTexture.clone()),i.AU=U,i}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return iU._Serialize(U,this,N),U.activeParticleCount=this.activeParticleCount,U.randomTextureSize=this._randomTextureSize,U.customShader=this.customShader,U}static Parse(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const n=N.name;let q,i;U instanceof TN.c?q=U:(i=U,q=i.getEngine());const z=new vU(n,{SV:t||N.SV,randomTextureSize:N.randomTextureSize},U,null,N.isAnimationSheetEnabled);if(z._rootUrl=V,N.customShader&&q.createEffectForParticles){const U=N.customShader,V=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",A=q.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,V,void 0,void 0,void 0,z);z.setCustomEffect(A,0),z.customShader=U}return N.id&&(z.id=N.id),N.activeParticleCount&&(z.activeParticleCount=N.activeParticleCount),iU._Parse(N,z,U,V),N.preventAutoStart&&(z.preventAutoStart=N.preventAutoStart),A||z.preventAutoStart||z.start(),z}}var hU=V(12179),cU=V(13714),HU=V(12725);class YU{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(N){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const U of this.systems)U.AU=N;this._emitterNode=N}setEmitterAsSphere(N,U,V){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:N,renderingGroupId:U};const A=(0,cU.d)("emitterSphere",{diameter:N.diameter,segments:N.segments},V);A.renderingGroupId=U;const t=new HU.dU("emitterSphereMaterial",V);t.emissiveColor=N.color,A.material=t;for(const n of this.systems)n.AU=A;this._emitterNode=A}start(N){for(const U of this.systems)N&&(U.AU=N),U.start()}dispose(){for(const N of this.systems)N.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={systems:[]};for(const V of this.systems)U.systems.push(V.serialize(N));return this._emitterNode&&(U.AU=this._emitterCreationOptions),U}static Parse(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;const t=new YU,n=this.BaseAssetsUrl+"/textures/";U=U||b.e.LastCreatedScene;for(const q of N.systems)t.systems.push(V?vU.Parse(q,U,n,!0,A):iU.Parse(q,U,n,!0,A));if(N.AU){const V=N.AU.options;if("Sphere"===N.AU.kind)t.setEmitterAsSphere({diameter:V.diameter,segments:V.segments,color:q.rU.vU(V.color)},N.AU.renderingGroupId,U)}return t}}YU.BaseAssetsUrl="https://assets.babylonjs.com/particles";var WU=V(12218);class sU{static CreateDefault(N){let U,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,A=arguments.length>2?arguments[2]:void 0;U=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new vU("default system",{SV:V},A):new iU("default system",V,A),U.AU=N;const t=hU.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return U.particleTexture=new u.e(t,U.YN()),U.createConeEmitter(.1,Math.PI/4),U.color1=new q.Yi(1,1,1,1),U.color2=new q.Yi(1,1,1,1),U.colorDead=new q.Yi(1,1,1,0),U.minSize=.1,U.maxSize=.1,U.minEmitPower=2,U.maxEmitPower=2,U.updateSpeed=1/60,U.emitRate=30,U}static CreateAsync(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;U||(U=b.e.LastCreatedScene);const t={};return U.addPendingData(t),new Promise(((n,q)=>{if(V&&!vU.IsSupported)return U.removePendingData(t),q("Particle system with GPU is not supported.");hU.Tools.LoadFile(`${sU.BaseAssetsUrl}/systems/${N}.json`,(N=>{U.removePendingData(t);const q=JSON.parse(N.toString());return n(YU.Parse(q,U,V,A))}),void 0,void 0,void 0,(()=>(U.removePendingData(t),q(`An error occurred with the creation of your particle system. Check if your type '${N}' exists.`))))}))}static ExportSet(N){const U=new YU;for(const V of N)U.systems.push(V);return U}static ParseFromFileAsync(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0;return new Promise(((q,i)=>{const z=new WU.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const U=JSON.parse(z.responseText);let i;i=A?vU.Parse(U,V,t,!1,n):iU.Parse(U,V,t,!1,n),N&&(i.name=N),q(i)}else i("Unable to load the particle system")})),z.open("GET",U),z.send()}))}static ParseFromSnippetAsync(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0;if("_BLANK"===N){const N=this.CreateDefault(null);return N.start(),Promise.resolve(N)}return new Promise(((n,q)=>{const i=new WU.b;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const q=JSON.parse(JSON.parse(i.responseText).jsonPayload),z=JSON.parse(q.particleSystem);let S;S=V?vU.Parse(z,U,A,!1,t):iU.Parse(z,U,A,!1,t),S.snippetId=N,n(S)}else q("Unable to load the snippet "+N)})),i.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),i.send()}))}}sU.BaseAssetsUrl=YU.BaseAssetsUrl,sU.SnippetUrl="https://snippet.babylonjs.com",sU.CreateFromSnippetAsync=sU.ParseFromSnippetAsync;var MU=V(12799),aU=V(12620),mV=V(13721);(0,mV.d)(aU.e.NAME_PARTICLESYSTEM,((N,U,V,A)=>{const t=(0,mV.f)(aU.e.NAME_PARTICLESYSTEM);if(t&&void 0!==N.yp&&null!==N.yp)for(let n=0,q=N.yp.length;n<q;n++){const q=N.yp[n];V.yp.push(t(q,U,A))}})),(0,mV.b)(aU.e.NAME_PARTICLESYSTEM,((N,U,V)=>{if(N.activeParticleCount){return vU.Parse(N,U,V)}return iU.Parse(N,U,V)})),TN.c.prototype.createEffectForParticles=function(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,z=arguments.length>7?arguments[7]:void 0,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,E=arguments.length>9?arguments[9]:void 0,p=[],k=[];const B=[];return z?z.fillUniformsAttributesAndSamplerNames(k,p,B):(p=iU._GetAttributeNamesOrOptions(),k=iU._GetEffectCreationOptions()),-1===t.indexOf(" BILLBOARD")&&(t+="\n#define BILLBOARD\n"),null!==z&&void 0!==z&&z.isAnimationSheetEnabled&&-1===t.indexOf(" ANIMATESHEET")&&(t+="\n#define ANIMATESHEET\n"),-1===A.indexOf("diffuseSampler")&&A.push("diffuseSampler"),this.createEffect({vertex:E??(null===z||void 0===z?void 0:z.vertexShaderName)??"particles",fragmentElement:N},p,k.concat(U),B.concat(A),t,n,q,i,void 0,S,(async()=>{0===S?await Promise.resolve().then(V.bind(V,13763)):await Promise.resolve().then(V.bind(V,13823))}))},MU.b.prototype.getEmittedParticleSystems=function(){const N=[];for(let U=0;U<this.YN().yp.length;U++){const V=this.YN().yp[U];V.AU===this&&N.push(V)}return N},MU.b.prototype.getHierarchyEmittedParticleSystems=function(){const N=[],U=this.getDescendants();U.push(this);for(let V=0;V<this.YN().yp.length;V++){const A=this.YN().yp[V],t=A.AU;t.position&&-1!==U.indexOf(t)&&N.push(A)}return N};V(12692),V(12703),V(12772);V(12781),V(13728),V(12565),V(12679),V(12823);V(12562);var wU;V(13734),V(12402);!function(N){N[N.Color=2]="Color",N[N.UV=1]="UV",N[N.Random=0]="Random",N[N.Stated=3]="Stated"}(wU||(wU={}));var XU=V(12593);const eU=new A.CU(0,0,0),QU=new A.CU(0,0,0),uU=new A.CU(0,0,0);class LU{constructor(N,U,V){this.width=N,this.height=U,this.data=V}processFlowable(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2?arguments[2]:void 0;if(!V)return;V instanceof A.Matrix?A.CU.TransformCoordinatesToRef(N.position,V,uU):(uU.x=V.x,uU.y=V.y,uU.z=V.z);const t=.5*uU.x+.5,n=1-(.5*uU.y+.5),q=Math.floor(t*this.width),i=Math.floor(n*this.height);if(q<0||q>=this.width||i<0||i>=this.height)return;const z=4*(i*this.width+q),S=this.data[z]/255*2-1,E=this.data[z+1]/255*2-1,p=this.data[z+2]/255*2-1,k=this.data[z+3]/255;eU.set(S,E,p),eU.scaleToRef(U*k,QU),N.direction.addInPlace(QU)}_processParticle(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2?arguments[2]:void 0;this.processFlowable(N,U,V)}static async FromUrlAsync(N){return await new Promise(((U,V)=>{const A=document.createElement("canvas"),t=A.getContext("2d");let n=null;const q=new Image;q.crossOrigin="anonymous",q.src=N,q.onerror=U=>{V(new Error(`Failed to load image: ${N} : ${U}`))},q.onload=()=>{A.width=q.width,A.height=q.height,t.drawImage(q,0,0),n=t.getImageData(0,0,A.width,A.height),U(new LU(A.width,A.height,n.data))}}))}static async ExtractFromTextureAsync(N){return await new Promise(((U,V)=>{if(!N.isReady())return void N.onLoadObservable.addOnce((async()=>{try{const V=await this.ExtractFromTextureAsync(N);U(V)}catch(A){V(A)}}));const A=N.getSize();XU.h.GetTextureDataAsync(N,A.width,A.height).then((N=>{U(new LU(A.width,A.height,new Uint8ClampedArray(N)))})).catch(V)}))}}var IU,oU,RU,DU,GU,gU,lU,KU,jU;!function(N){N[N.Int=1]="Int",N[N.Float=2]="Float",N[N.Vector2=4]="Vector2",N[N.CU=8]="CU",N[N.Matrix=16]="Matrix",N[N.Particle=32]="Particle",N[N.Texture=64]="Texture",N[N.Yi=128]="Yi",N[N.FloatGradient=256]="FloatGradient",N[N.Vector2Gradient=512]="Vector2Gradient",N[N.Vector3Gradient=1024]="Vector3Gradient",N[N.Color4Gradient=2048]="Color4Gradient",N[N.System=4096]="System",N[N.AutoDetect=8192]="AutoDetect",N[N.BasedOnInput=16384]="BasedOnInput",N[N.Undefined=32768]="Undefined",N[N.All=65535]="All"}(IU||(IU={})),function(N){N[N.Compatible=0]="Compatible",N[N.TypeIncompatible=1]="TypeIncompatible",N[N.HierarchyIssue=2]="HierarchyIssue"}(oU||(oU={})),function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(RU||(RU={}));class FU{get direction(){return this._direction}get type(){if(this._type===IU.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===IU.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(N){this._type=N}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((N=>N.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(N,U,V){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=IU.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new O.d,this.onDisconnectionObservable=new O.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=U,this.name=N,this._direction=V}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(N){var U;return this.isConnected?null!==(U=this._connectedPoint)&&void 0!==U&&U._storedFunction?this._connectedPoint._storedFunction(N):this._connectedPoint._storedValue:this.value}canConnectTo(N){return 0===this.checkCompatibilityState(N)}checkCompatibilityState(N){const U=this._ownerBlock,V=N.ownerBlock;if(this.type!==N.type&&N.innerType!==IU.AutoDetect)return N.acceptedConnectionPointTypes&&-1!==N.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(N.excludedConnectionPointTypes&&-1!==N.excludedConnectionPointTypes.indexOf(this.type))return 1;let A=V,t=U;return 0===this.direction&&(A=U,t=V),A.isAnAncestorOf(t)?2:0}connectTo(N){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(N))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${N.ownerBlock.name}".${N.name}`;return this._endpoints.push(N),N._connectedPoint=this,this.onConnectionObservable.notifyObservers(N),N.onConnectionObservable.notifyObservers(this),this}disconnectFrom(N){const U=this._endpoints.indexOf(N);return-1===U||(this._endpoints.splice(U,1),N._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(N),N.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(N){let U=1;for(;U<IU.All;)N&U||this.excludedConnectionPointTypes.push(U),U<<=1}serialize(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U={};return U.name=this.name,U.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.pi?(U.valueType="BABYLON."+this.value.getClassName(),U.value=this.value.pi()):(U.valueType="number",U.value=this.value)),N&&this.connectedPoint&&(U.inputName=this.name,U.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,U.targetConnectionName=this.connectedPoint.name,U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),U}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class PU{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(N){this._name=N}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(N){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new O.d,this.Ai=new O.d,this.onInputChangedObservable=new O.d,this.visibleOnFrame=!1,this._name=N,this.uniqueId=L.c.UniqueId}_inputRename(N){return N}_outputRename(N){return N}isAnAncestorOf(N){for(const U of this._outputs)if(U.hasEndpoints)for(const V of U.endpoints){if(V.ownerBlock===N)return!0;if(V.ownerBlock.isAnAncestorOf(N))return!0}return!1}isAnAncestorOfType(N){if(this.getClassName()===N)return!0;for(const U of this._outputs)if(U.hasEndpoints)for(const V of U.endpoints)if(V.ownerBlock.isAnAncestorOfType(N))return!0;return!1}getInputByName(N){const U=this._inputs.filter((U=>U.name===N));return U.length?U[0]:null}_linkConnectionTypes(N,U){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[U]._acceptedConnectionPointType=this._inputs[N]:(this._inputs[N]._linkedConnectionSource=this._inputs[U],this._inputs[N]._isMainLinkSource=!0),this._inputs[U]._linkedConnectionSource=this._inputs[N]}registerInput(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;const q=new FU(N,this,0);return q.type=U,q.isOptional=V,q.defaultValue=A,q.value=A,q.valueMin=t,q.valueMax=n,this._inputs.push(q),this.onInputChangedObservable.notifyObservers(q),this}registerOutput(N,U,V){return(V=V??new FU(N,this,1)).type=U,this._outputs.push(V),this}_build(N){}_customBuildStep(N){}build(N){if(this._buildId===N.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((N=>N.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=N.buildId;for(const U of this._inputs){if(!U.connectedPoint){U.isOptional||N.notConnectedNonOptionalInputs.push(U);continue}const V=U.connectedPoint.ownerBlock;V&&V!==this&&!V.isSystem&&V.build(N)}return this._customBuildStep(N),N.verbose&&I.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(N),this.onBuildObservable.notifyObservers(this),!1}serialize(){const N={};N.customType="BABYLON."+this.getClassName(),N.id=this.uniqueId,N.name=this.name,N.visibleOnFrame=this.visibleOnFrame,N.inputs=[],N.outputs=[];for(const U of this.inputs)N.inputs.push(U.serialize());for(const U of this.outputs)N.outputs.push(U.serialize(!1));return N}_deserialize(N){this._name=N.name,this.comments=N.comments,this.visibleOnFrame=!!N.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(N)}_deserializePortDisplayNamesAndExposedOnFrame(N){const U=N.inputs,V=N.outputs;if(U)for(const A of U){const N=this.inputs.find((N=>N.name===A.name));if(!N)return;if(A.displayName&&(N.displayName=A.displayName),A.isExposedOnFrame&&(N.isExposedOnFrame=A.isExposedOnFrame,N.exposedPortPosition=A.exposedPortPosition),void 0!==A.value&&null!==A.value)if("number"===A.valueType)N.value=A.value;else{const U=(0,i.d)(A.valueType);U&&(N.value=U.vU(A.value))}}if(V)for(let A=0;A<V.length;A++){const N=V[A];N.displayName&&(this.outputs[A].displayName=N.displayName),N.isExposedOnFrame&&(this.outputs[A].isExposedOnFrame=N.isExposedOnFrame,this.outputs[A].exposedPortPosition=N.exposedPortPosition)}}clone(){const N=this.serialize(),U=(0,i.d)(N.customType);if(U){const V=new U;return V._deserialize(N),V}return null}dispose(){this.Ai.notifyObservers(this),this.Ai.clear();for(const N of this.inputs)N.dispose();for(const N of this.outputs)N.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function TU(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",A=arguments.length>3?arguments[3]:void 0;return(t,n)=>{let q=t._propStore;q||(q=[],t._propStore=q),q.push({propertyName:n,displayName:N,type:U,groupName:V,options:A??{},className:t.getClassName()})}}(0,X.b)([(0,e.N)("comment")],PU.prototype,"comments",void 0),function(N){N[N.Boolean=0]="Boolean",N[N.Float=1]="Float",N[N.Int=2]="Int",N[N.Vector2=3]="Vector2",N[N.List=4]="List",N[N.Yi=5]="Yi",N[N.SamplingMode=6]="SamplingMode",N[N.TextureFormat=7]="TextureFormat",N[N.TextureType=8]="TextureType"}(DU||(DU={})),function(N){N[N.None=0]="None",N[N.Position=1]="Position",N[N.Direction=2]="Direction",N[N.Age=3]="Age",N[N.Lifetime=4]="Lifetime",N[N.Color=5]="Color",N[N.ScaledDirection=6]="ScaledDirection",N[N.Scale=7]="Scale",N[N.AgeGradient=8]="AgeGradient",N[N.Angle=9]="Angle",N[N.SpriteCellIndex=16]="SpriteCellIndex",N[N.SpriteCellStart=17]="SpriteCellStart",N[N.SpriteCellEnd=18]="SpriteCellEnd"}(GU||(GU={})),function(N){N[N.None=0]="None",N[N.Time=1]="Time",N[N.Delta=2]="Delta",N[N.Emitter=3]="Emitter"}(gU||(gU={}));class fU{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let N="";for(const U of this.notConnectedNonOptionalInputs)N+=`input ${U.name} from block ${U.ownerBlock.name}[${U.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(N)throw"Build of Node Particle System Set failed:\n"+N}adapt(N,U){const V=N.getConnectedValue(this)||0;if(N.type===U)return V;switch(U){case IU.Vector2:return new A.Vector2(V,V);case IU.CU:return new A.CU(V,V,V);case IU.Yi:return new q.Yi(V,V,V,V)}return null}getContextualValue(N){if(!this.particleContext||!this.systemContext)return null;switch(N){case GU.Position:return this.particleContext.position;case GU.Direction:return this.particleContext.direction;case GU.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case GU.Color:return this.particleContext.color;case GU.Age:return this.particleContext.age;case GU.Lifetime:return this.particleContext.lifeTime;case GU.Angle:return this.particleContext.angle;case GU.Scale:return this.particleContext.scale;case GU.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case GU.SpriteCellEnd:return this.systemContext.endSpriteCellID;case GU.SpriteCellIndex:return this.particleContext.cellIndex;case GU.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.AU.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.AU.absolutePosition:this.systemContext.AU:null}getSystemValue(N){if(!this.particleContext||!this.systemContext)return null;switch(N){case gU.Time:return this.systemContext._actualFrame;case gU.Delta:return this.systemContext._scaledUpdateSpeed;case gU.Emitter:if(this.isEmitterTransformNode){return this.systemContext.AU.absolutePosition}return this.systemContext.AU}return null}}function OU(N,U,V){const A=new fU;A.JU=U;const t=N.createSystem(A);return t.canStart=()=>!0,t.AU=V.clone(),t.disposeOnStop=!0,t.start(),t}class ZU extends PU{constructor(N){super(N),this.blendMode=z.BLENDMODE_ONEONE,this.SV=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",IU.Particle),this.registerInput("texture",IU.Texture),this.registerInput("onStart",IU.System,!0),this.registerInput("onEnd",IU.System,!0),this.registerOutput("system",IU.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(N){N.SV=this.SV,N.buildId=this._buildId++,this.build(N);const U=this.particle.getConnectedValue(N);return U.particleTexture=this.texture.getConnectedValue(N),U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.name=this.name,U._nodeGenerated=!0,U._targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,this.system._storedValue=this,U.canStart=()=>!this.doNoStart,U.onStartedObservable.add((V=>{const A=this.onStart.getConnectedValue(N);A&&V.onStartedObservable.addOnce((()=>{N.systemContext=U;const V=OU(A,N.JU,N.emitterPosition);this.Ai.addOnce((()=>{V.dispose()}))}));const t=this.onEnd.getConnectedValue(N);t&&V.onStoppedObservable.addOnce((()=>{N.systemContext=U;const V=OU(t,N.JU,N.emitterPosition);this.Ai.addOnce((()=>{V.dispose()}))}))})),this.Ai.addOnce((()=>{U.dispose()})),U}serialize(){const N=super.serialize();return N.SV=this.SV,N.emitRate=this.emitRate,N.blendMode=this.blendMode,N.doNoStart=this.doNoStart,N.targetStopDuration=this.targetStopDuration,N.startDelay=this.startDelay,N}_deserialize(N){super._deserialize(N),this.SV=N.SV,this.emitRate=N.emitRate,this.doNoStart=!!N.doNoStart,void 0!==N.blendMode&&(this.blendMode=N.blendMode),void 0!==N.targetStopDuration&&(this.targetStopDuration=N.targetStopDuration),void 0!==N.startDelay&&(this.startDelay=N.startDelay)}}(0,X.b)([TU("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:z.BLENDMODE_ONEONE},{label:"Standard",value:z.BLENDMODE_STANDARD},{label:"Add",value:z.BLENDMODE_ADD},{label:"Multiply",value:z.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:z.BLENDMODE_MULTIPLYADD}]})],ZU.prototype,"blendMode",void 0),(0,X.b)([TU("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],ZU.prototype,"SV",void 0),(0,X.b)([TU("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZU.prototype,"emitRate",void 0),(0,X.b)([TU("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZU.prototype,"targetStopDuration",void 0),(0,X.b)([TU("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZU.prototype,"startDelay",void 0),(0,X.b)([TU("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ZU.prototype,"doNoStart",void 0),(0,i.e)("BABYLON.SystemBlock",ZU);class bU extends PU{get type(){if(this._type===IU.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=IU.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=IU.Vector2,this._type;case"CU":return this._type=IU.CU,this._type;case"Yi":return this._type=IU.Yi,this._type;case"Matrix":return this._type=IU.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===GU.None&&this._systemSource!==gU.None}get systemSource(){return this._systemSource}set systemSource(N){if(this._systemSource=N,N!==gU.None){switch(this._contextualSource=GU.None,this._type=IU.Float,N){case gU.Time:case gU.Delta:this._type=IU.Float;break;case gU.Emitter:this._type=IU.CU}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==GU.None}get contextualValue(){return this._contextualSource}set contextualValue(N){if(this._contextualSource=N,N!==GU.None){switch(this._systemSource=gU.None,N){case GU.Scale:this._type=IU.Vector2;break;case GU.Position:case GU.Direction:case GU.ScaledDirection:this._type=IU.CU;break;case GU.Color:this._type=IU.Yi;break;case GU.Age:case GU.Lifetime:case GU.Angle:case GU.AgeGradient:this._type=IU.Float;break;case GU.SpriteCellEnd:case GU.SpriteCellStart:case GU.SpriteCellIndex:this._type=IU.Int}this.output&&(this.output.type=this._type)}}constructor(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IU.AutoDetect;super(N),this._type=IU.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new O.d,this._systemSource=gU.None,this._contextualSource=GU.None,this._type=U,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",U)}get value(){return this._storedValue}set value(N){this.type===IU.Float&&this.min!==this.max&&(N=Math.max(this.min,N),N=Math.min(this.max,N)),this._storedValue=N,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(N){this._valueCallback=N}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case IU.Int:case IU.Float:this.value=0;break;case IU.Vector2:this.value=A.Vector2.Zero();break;case IU.CU:this.value=A.CU.Zero();break;case IU.Yi:this.value=new q.Yi(1,1,1,1);break;case IU.Matrix:this.value=A.Matrix.Identity()}}_build(N){super._build(N),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=N=>N.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=N=>N.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const N=super.serialize();return N.type=this.type,N.contextualValue=this.contextualValue,N.systemSource=this.systemSource,N.min=this.min,N.max=this.max,N.groupInInspector=this.groupInInspector,N.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.pi?(N.valueType="BABYLON."+this._storedValue.getClassName(),N.value=this._storedValue.pi()):(N.valueType="number",N.value=this._storedValue)),N}_deserialize(N){if(super._deserialize(N),this._type=N.type,this.contextualValue=N.contextualValue,this.systemSource=N.systemSource||gU.None,this.min=N.min||0,this.max=N.max||0,this.groupInInspector=N.groupInInspector||"",void 0!==N.displayInInspector&&(this.displayInInspector=N.displayInInspector),N.valueType)if("number"===N.valueType)this._storedValue=N.value;else{const U=(0,i.d)(N.valueType);U&&(this._storedValue=U.vU(N.value))}}}(0,i.e)("BABYLON.ParticleInputBlock",bU);class yU extends PU{get url(){return this._url}set url(N){this._url!==N&&(this._cachedData=null,this._url=N,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(N){this._textureDataUrl!==N&&(this._cachedData=null,this._textureDataUrl=N,this._url="",this._sourceTexture=null)}set sourceTexture(N){this._sourceTexture!==N&&(this._cachedData=null,this._sourceTexture=N,this._url="",this._textureDataUrl="")}constructor(N){super(N),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",IU.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const N=this.texture._storedValue;return await new Promise(((U,V)=>{if(!N.isReady())return void N.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),U(this._cachedData)}catch(N){V(N)}}));const A=N.getSize();XU.h.GetTextureDataAsync(N,A.width,A.height).then((V=>{this._cachedData={width:A.width,height:A.height,data:new Uint8ClampedArray(V)},N.dispose(),U(this._cachedData)})).catch(V)}))}_build(N){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new u.e(this._textureDataUrl,N.JU):this.texture._storedValue=new u.e(this._url,N.JU):this.texture._storedValue=null}serialize(){const N=super.serialize();return N.url=this.url,N.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(N.textureDataUrl=this.textureDataUrl),N}_deserialize(N){super._deserialize(N),this.url=N.url,this.serializedCachedData=!!N.serializedCachedData,N.textureDataUrl&&(this.textureDataUrl=N.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,i.e)("BABYLON.ParticleTextureSourceBlock",yU);class NV extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("position",IU.CU),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(N){const U=this.particle.getConnectedValue(N);if(this.output._storedValue=U,!this.position.isConnected)return;const V={process:V=>{N.particleContext=V,N.systemContext=U,V.position.A(this.position.getConnectedValue(N))},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V}}(0,i.e)("BABYLON.UpdatePositionBlock",NV),function(N){N[N.Add=0]="Add",N[N.Subtract=1]="Subtract",N[N.Multiply=2]="Multiply",N[N.Divide=3]="Divide",N[N.Max=4]="Max",N[N.Min=5]="Min"}(lU||(lU={}));class UV extends PU{constructor(N){super(N),this.operation=lU.Add,this.registerInput("left",IU.AutoDetect),this.registerInput("right",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this.output._typeConnectionSource=this.left;const U=[IU.Matrix,IU.Particle,IU.Texture,IU.System,IU.FloatGradient,IU.Color4Gradient,IU.Vector2Gradient,IU.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...U),this.right.excludedConnectionPointTypes.push(...U),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(N){let U;const V=this.left,t=this.right;if(!V.isConnected||!t.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const n=V.type===IU.Float||V.type===IU.Int,i=t.type===IU.Float||t.type===IU.Int,z=n&&i;switch(this.operation){case lU.Add:U=z?N=>V.getConnectedValue(N)+t.getConnectedValue(N):n?N=>N.adapt(V,t.type).add(t.getConnectedValue(N)):N=>V.getConnectedValue(N).add(N.adapt(t,V.type));break;case lU.Subtract:U=z?N=>V.getConnectedValue(N)-t.getConnectedValue(N):n?N=>N.adapt(V,t.type).xU(t.getConnectedValue(N)):N=>V.getConnectedValue(N).xU(N.adapt(t,V.type));break;case lU.Multiply:U=z?N=>V.getConnectedValue(N)*t.getConnectedValue(N):n?N=>N.adapt(V,t.type).multiply(t.getConnectedValue(N)):N=>V.getConnectedValue(N).multiply(N.adapt(t,V.type));break;case lU.Divide:U=z?N=>V.getConnectedValue(N)/t.getConnectedValue(N):n?N=>N.adapt(V,t.type).divide(t.getConnectedValue(N)):N=>V.getConnectedValue(N).divide(N.adapt(t,V.type));break;case lU.Min:if(z)U=N=>Math.min(V.getConnectedValue(N),t.getConnectedValue(N));else{const[N,i]=n?[t,V]:[V,t];switch(N.type){case IU.Vector2:U=U=>A.Vector2.Minimize(N.getConnectedValue(U),U.adapt(i,N.type));break;case IU.CU:U=U=>A.CU.Minimize(N.getConnectedValue(U),U.adapt(i,N.type));break;case IU.Yi:U=U=>{const V=N.getConnectedValue(U),{r:A,g:t,b:n,a:z}=U.adapt(i,N.type);return new q.Yi(Math.min(V.r,A),Math.min(V.g,t),Math.min(V.b,n),Math.min(V.a,z))}}}break;case lU.Max:if(!z){const[N,i]=n?[t,V]:[V,t];switch(N.type){case IU.Vector2:U=U=>A.Vector2.Maximize(N.getConnectedValue(U),U.adapt(i,N.type));break;case IU.CU:U=U=>A.CU.Maximize(N.getConnectedValue(U),U.adapt(i,N.type));break;case IU.Yi:U=U=>{const V=N.getConnectedValue(U),{r:A,g:t,b:n,a:z}=U.adapt(i,N.type);return new q.Yi(Math.max(V.r,A),Math.min(V.g,t),Math.min(V.b,n),Math.min(V.a,z))}}break}U=N=>Math.max(V.getConnectedValue(N),t.getConnectedValue(N))}this.output._storedFunction=N=>V.type===IU.Int?0|U(N):U(N)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===IU.Int||this.left.type===IU.Float&&this.right.type!==IU.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[N,U]of[[this.left,this.right],[this.right,this.left]])N.acceptedConnectionPointTypes=[IU.Int,IU.Float],U.isConnected&&(N.acceptedConnectionPointTypes.push(U.type),U.type!==IU.Int&&U.type!==IU.Float||N.acceptedConnectionPointTypes.push(IU.Vector2,IU.CU,IU.Yi))}dispose(){super.dispose();for(const N of this._connectionObservers)N.remove();this._connectionObservers.length=0}serialize(){const N=super.serialize();return N.operation=this.operation,N}_deserialize(N){super._deserialize(N),this.operation=N.operation}}(0,X.b)([TU("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:lU.Add},{label:"Subtract",value:lU.Subtract},{label:"Multiply",value:lU.Multiply},{label:"Divide",value:lU.Divide},{label:"Max",value:lU.Max},{label:"Min",value:lU.Min}]})],UV.prototype,"operation",void 0),(0,i.e)("BABYLON.ParticleMathBlock",UV);class VV extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("direction1",IU.CU,!0,new A.CU(0,1,0)),this.registerInput("direction2",IU.CU,!0,new A.CU(0,1,0)),this.registerInput("minEmitBox",IU.CU,!0,new A.CU(-.5,-.5,-.5)),this.registerInput("maxEmitBox",IU.CU,!0,new A.CU(.5,.5,.5)),this.registerOutput("output",IU.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(N){const U=this.particle.getConnectedValue(N);U._directionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.direction1.getConnectedValue(N),n=this.direction2.getConnectedValue(N),q=(0,S.RandomRange)(t.x,n.x),i=(0,S.RandomRange)(t.y,n.y),z=(0,S.RandomRange)(t.z,n.z);N.isEmitterTransformNode?A.CU.TransformNormalFromFloatsToRef(q,i,z,N.emitterWorldMatrix,V.direction):V.direction.hi(q,i,z)},U._positionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.minEmitBox.getConnectedValue(N),n=this.maxEmitBox.getConnectedValue(N),q=(0,S.RandomRange)(t.x,n.x),i=(0,S.RandomRange)(t.y,n.y),z=(0,S.RandomRange)(t.z,n.z);N.isEmitterTransformNode?A.CU.TransformCoordinatesFromFloatsToRef(q,i,z,N.emitterWorldMatrix,V.position):(V.position.hi(q,i,z),V.position.addInPlace(N.emitterPosition))},this.output._storedValue=U}}(0,i.e)("BABYLON.BoxShapeBlock",VV);class AV extends PU{constructor(N){super(N),this.registerInput("emitPower",IU.Float,!0,1),this.registerInput("lifeTime",IU.Float,!0,1),this.registerInput("color",IU.Yi,!0,new q.Yi(1,1,1,1)),this.registerInput("scale",IU.Vector2,!0,new A.Vector2(1,1)),this.registerInput("angle",IU.Float,!0,0),this.registerOutput("particle",IU.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(N){const U=new iU(this.name,N.SV,N.JU,null,!1,void 0,!0);U.particleEmitterType=new d,U._lifeTimeCreation.process=(U,V)=>{N.particleContext=U,U.lifeTime=this.lifeTime.getConnectedValue(N),V._emitPower=this.emitPower.getConnectedValue(N)},U._colorCreation.process=U=>{N.particleContext=U,U.color.A(this.color.getConnectedValue(N))},U._sizeCreation.process=U=>{N.particleContext=U,U.size=1,U.scale.A(this.scale.getConnectedValue(N))},U._angleCreation.process=U=>{N.particleContext=U,U.angle=this.angle.getConnectedValue(N)},this.particle._storedValue=U}}(0,i.e)("BABYLON.CreateParticleBlock",AV);class tV{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const N=[];for(const U of this.attachedBlocks)U.isInput&&N.push(U);return N}constructor(N){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new O.d,this.name=N}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(N)&&this.attachedBlocks.push(N);for(const V of N.inputs){const A=V.connectedPoint;if(A){const V=A.ownerBlock;V!==N&&this._initializeBlock(V,U)}}}async buildAsync(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((V=>{const A=new YU;for(const N of this._systemBlocks)this._initializeBlock(N);for(const t of this.systemBlocks){const V=new fU;V.buildId=this._buildId++,V.JU=N,V.verbose=U;const n=t.createSystem(V);V.emitErrors(),A.systems.push(n)}this.onBuildObservable.notifyObservers(this),V(A)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const N=new ZU("Particle system"),U=new NV("Update position");U.output.connectTo(N.particle);const V=new bU("Position");V.contextualValue=GU.Position;const A=new bU("Scaled direction");A.contextualValue=GU.ScaledDirection;const t=new UV("Add");t.operation=lU.Add,V.output.connectTo(t.left),A.output.connectTo(t.right),t.output.connectTo(U.position);const n=new AV("Create particle"),q=new VV("Box shape");n.particle.connectTo(q.particle),q.output.connectTo(U.particle);const i=new yU("Texture");i.texture.connectTo(N.texture),i.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(N)}removeBlock(N){const U=this.attachedBlocks.indexOf(N);if(U>-1&&this.attachedBlocks.splice(U,1),N.isSystem){const U=this._systemBlocks.indexOf(N);U>-1&&this._systemBlocks.splice(U,1)}}parseSerializedObject(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U||this.clear();const V={};for(const A of N.dE){const N=(0,i.d)(A.customType);if(N){const U=new N;U._deserialize(A),V[A.id]=U,this.attachedBlocks.push(U),U.isSystem&&this._systemBlocks.push(U)}}for(const A of this.attachedBlocks)if(A.isTeleportOut){const N=A,U=N._tempEntryPointUniqueId;if(U){const A=V[U];A&&A.attachToEndpoint(N)}}for(let A=0;A<N.dE.length;A++){const t=N.dE[A],n=V[t.id];n&&(n.inputs.length&&t.inputs.some((N=>N.targetConnectionName))&&!U||this._restoreConnections(n,N,V))}if(N.locations||N.editorData&&N.editorData.locations){const A=N.locations||N.editorData.locations;for(const N of A)V[N.It]&&(N.It=V[N.It].uniqueId);U&&this.editorData&&this.editorData.locations&&A.concat(this.editorData.locations),N.locations?this.editorData={locations:A}:(this.editorData=N.editorData,this.editorData.locations=A);const t=[];for(const N in V)t[N]=V[N].uniqueId;this.editorData.map=t}this.comment=N.comment}_restoreConnections(N,U,V){for(const A of N.outputs)for(const t of U.dE){const n=V[t.id];if(n)for(const q of t.inputs)if(V[q.targetBlockId]!==N||q.targetConnectionName!==A.name);else{const N=n.getInputByName(q.inputName);if(!N||N.isConnected)continue;A.connectTo(N,!0),this._restoreConnections(n,U,V)}}}serialize(N){const U=N?{}:Q.d.Serialize(this);U.editorData=JSON.parse(JSON.stringify(this.editorData));let V=[];N?V=N:U.customType="BABYLON.NodeParticleSystemSet",U.dE=[];for(const A of V)U.dE.push(A.serialize());if(!N)for(const A of this.attachedBlocks)-1===V.indexOf(A)&&U.dE.push(A.serialize());return U}dispose(){for(const N of this.attachedBlocks)N.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(N){const U=new tV(N);return U.setToDefault(),U}static Parse(N){const U=Q.d.Parse((()=>new tV(N.name)),N,null);return U.parseSerializedObject(N),U}static ParseFromSnippetAsync(N,U){return"_BLANK"===N?Promise.resolve(tV.CreateDefault("blank")):new Promise(((V,A)=>{const t=new WU.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const q=JSON.parse(JSON.parse(t.responseText).jsonPayload),i=JSON.parse(q.nodeParticle);U||(U=Q.d.Parse((()=>new tV(N)),i,null)),U.parseSerializedObject(i),U.snippetId=N;try{V(U)}catch(n){A(n)}}else A("Unable to load the snippet "+N)})),t.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),t.send()}))}}tV.EditorURL=`${hU.Tools._DefaultCdnUrl}/v${TN.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,tV.SnippetUrl="https://snippet.babylonjs.com",(0,X.b)([(0,e.N)()],tV.prototype,"name",void 0),(0,X.b)([(0,e.N)("comment")],tV.prototype,"comment",void 0),function(N){N[N.None=0]="None",N[N.PerParticle=1]="PerParticle",N[N.PerSystem=2]="PerSystem"}(KU||(KU={}));class nV extends PU{constructor(N){super(N),this._currentLockId=-2,this.lockMode=KU.PerParticle,this.registerInput("min",IU.AutoDetect,!0,0),this.registerInput("max",IU.AutoDetect,!0,1),this.registerOutput("output",IU.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(IU.Float|IU.Int|IU.Vector2|IU.CU|IU.Yi),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(IU.Float|IU.Int|IU.Vector2|IU.CU|IU.Yi),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=IU.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let N=null;switch(this._currentLockId=-2,this.min.type){case IU.AutoDetect:case IU.Int:case IU.Float:N=N=>{const U=this.min.getConnectedValue(N)||0,V=this.max.getConnectedValue(N)||1;return U+Math.random()*(V-U)};break;case IU.Vector2:N=N=>{const U=this.min.getConnectedValue(N)||A.Vector2.Zero(),V=this.max.getConnectedValue(N)||A.Vector2.One();return new A.Vector2(U.x+Math.random()*(V.x-U.x),U.y+Math.random()*(V.y-U.y))};break;case IU.CU:N=N=>{const U=this.min.getConnectedValue(N)||A.CU.Zero(),V=this.max.getConnectedValue(N)||A.CU.One();return new A.CU(U.x+Math.random()*(V.x-U.x),U.y+Math.random()*(V.y-U.y),U.z+Math.random()*(V.z-U.z))};break;case IU.Yi:N=N=>{const U=this.min.getConnectedValue(N)||new q.Yi(0,0,0,0),V=this.max.getConnectedValue(N)||new q.Yi(1,1,1,1);return new q.Yi(U.x+Math.random()*(V.x-U.x),U.y+Math.random()*(V.y-U.y),U.z+Math.random()*(V.z-U.z),U.w+Math.random()*(V.w-U.w))}}this.output._storedFunction=U=>{var V;let A=0;switch(this.lockMode){case KU.PerParticle:A=(null===(V=U.particleContext)||void 0===V?void 0:V.id)||-1;break;case KU.PerSystem:A=U.buildId||0}return this._currentLockId!==A&&(this.lockMode!==KU.None&&(this._currentLockId=A),this.output._storedValue=N(U)),this.output._storedValue}}serialize(){const N=super.serialize();return N.lockMode=this.lockMode,N}_deserialize(N){super._deserialize(N),this.lockMode=N.lockMode}}(0,X.b)([TU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:KU.None},{label:"Per particle",value:KU.PerParticle},{label:"Per system",value:KU.PerSystem}]})],nV.prototype,"lockMode",void 0),(0,i.e)("BABYLON.ParticleRandomBlock",nV);class qV extends PU{constructor(N){super(N),this._currentLockId=-2,this.lockMode=KU.PerParticle,this.registerInput("min",IU.AutoDetect),this.registerInput("max",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const U=[IU.Matrix,IU.Particle,IU.Texture,IU.System,IU.FloatGradient,IU.Color4Gradient,IU.Vector2Gradient,IU.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...U),this.max.excludedConnectionPointTypes.push(...U)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let N=null;switch(this._currentLockId=-2,this.min.type){case IU.Float:case IU.Int:N=N=>{const U=this.min.getConnectedValue(N),V=this.max.getConnectedValue(N);return Math.random()*(V-U)+U};break;case IU.Vector2:N=N=>{const U=this.min.getConnectedValue(N),V=this.max.getConnectedValue(N);return new A.Vector2(Math.random()*(V.x-U.x)+U.x,Math.random()*(V.y-U.y)+U.y)};break;case IU.CU:N=N=>{const U=this.min.getConnectedValue(N),V=this.max.getConnectedValue(N);return new A.CU(Math.random()*(V.x-U.x)+U.x,Math.random()*(V.y-U.y)+U.y,Math.random()*(V.z-U.z)+U.z)};break;case IU.Yi:N=N=>{const U=this.min.getConnectedValue(N),V=this.max.getConnectedValue(N);return new q.Yi(Math.random()*(V.r-U.r)+U.r,Math.random()*(V.g-U.g)+U.g,Math.random()*(V.b-U.b)+U.b,Math.random()*(V.a-U.a)+U.a)}}this.output._storedFunction=U=>{var V;let A=0;switch(this.lockMode){case KU.PerParticle:A=(null===(V=U.particleContext)||void 0===V?void 0:V.id)||-1;break;case KU.PerSystem:A=U.buildId||0}return this._currentLockId!==A&&(this.lockMode!==KU.None&&(this._currentLockId=A),this.output._storedValue=N(U)),this.output._storedValue}}serialize(){const N=super.serialize();return N.lockMode=this.lockMode,N}_deserialize(N){super._deserialize(N),void 0!==N.lockMode&&(this.lockMode=N.lockMode)}}(0,X.b)([TU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:KU.None},{label:"Per particle",value:KU.PerParticle},{label:"Per system",value:KU.PerSystem}]})],qV.prototype,"lockMode",void 0),(0,i.e)("BABYLON.RandomRangeBlock",qV);(0,i.e)("BABYLON.ParticleLerpBlock",class extends PU{constructor(N){super(N),this.registerInput("left",IU.AutoDetect),this.registerInput("right",IU.AutoDetect),this.registerInput("gradient",IU.Float,!0,0,0,1),this.registerOutput("output",IU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(IU.Float|IU.Int|IU.Vector2|IU.CU|IU.Yi)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=(N,U,V)=>(1-N)*U+N*V;this.output._storedFunction=U=>{const V=this.left.getConnectedValue(U),t=this.right.getConnectedValue(U),n=this.gradient.getConnectedValue(U);switch(this.left.type){case IU.Int:case IU.Float:return N(n,V,t);case IU.Vector2:return new A.Vector2(N(n,V.x,t.x),N(n,V.y,t.y));case IU.CU:return new A.CU(N(n,V.x,t.x),N(n,V.y,t.y),N(n,V.z,t.z));case IU.Yi:return new q.Yi(N(n,V.r,t.r),N(n,V.g,t.g),N(n,V.b,t.b),N(n,V.a,t.a))}return 0}}});(0,i.e)("BABYLON.UpdateDirectionBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("direction",IU.CU),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(N){const U=this.particle.getConnectedValue(N);if(this.output._storedValue=U,!this.direction.isConnected)return;const V={process:V=>{N.particleContext=V,N.systemContext=U,V.direction.A(this.direction.getConnectedValue(N))},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V}});(0,i.e)("BABYLON.UpdateColorBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("color",IU.Yi),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(N){const U=this.particle.getConnectedValue(N);if(this.output._storedValue=U,!this.color.isConnected)return;const V={process:V=>{N.particleContext=V,N.systemContext=U,V.color.A(this.color.getConnectedValue(N))},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V}});(0,i.e)("BABYLON.UpdateScaleBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("scale",IU.Vector2),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(N){const U=this.particle.getConnectedValue(N);if(this.output._storedValue=U,!this.scale.isConnected)return;const V={process:V=>{N.particleContext=V,N.systemContext=U,V.scale.A(this.scale.getConnectedValue(N))},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V}});(0,i.e)("BABYLON.UpdateAngleBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("angle",IU.Float),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(N){const U=this.particle.getConnectedValue(N);if(this.output._storedValue=U,!this.angle.isConnected)return;const V={process:V=>{N.particleContext=V,N.systemContext=U,V.angle=this.angle.getConnectedValue(N)},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V}});(0,i.e)("BABYLON.BasicPositionUpdateBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(N){const U=this.particle.getConnectedValue(N),V={process:V=>{N.particleContext=V,N.systemContext=U,V.direction.scaleToRef(U._directionScale,U._scaledDirection),V.position.addInPlace(U._scaledDirection)},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V,this.output._storedValue=U}});(0,i.e)("BABYLON.BasicSpriteUpdateBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(N){const U=this.particle.getConnectedValue(N),V={process:V=>{N.particleContext=V,N.systemContext=U,V.updateCellIndex()},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V,this.output._storedValue=U}});(0,i.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("cellIndex",IU.Int),this.registerOutput("output",IU.Particle),this.cellIndex.acceptedConnectionPointTypes=[IU.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(N){const U=this.particle.getConnectedValue(N);if(this.output._storedValue=U,!this.cellIndex.isConnected)return;const V={process:V=>{N.particleContext=V,N.systemContext=U,V.cellIndex=Math.floor(this.cellIndex.getConnectedValue(N))},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V}});class iV extends PU{constructor(N){super(N),this.strength=1,this.registerInput("particle",IU.Particle),this.registerInput("flowMap",IU.Texture),this.registerOutput("output",IU.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(N){var U;const V=this.particle.getConnectedValue(N),A=N.JU;let t;(null===(U=this.flowMap.connectedPoint)||void 0===U?void 0:U.ownerBlock).extractTextureContentAsync().then((N=>{N&&(t=new LU(N.width,N.height,N.data))}));const n={process:N=>{const U=A.getTransformMatrix();t&&t._processParticle(N,this.strength*V._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null};V._updateQueueStart?gN(n,V._updateQueueStart):V._updateQueueStart=n,this.output._storedValue=V}serialize(){const N=super.serialize();return N.strength=this.strength,N}_deserialize(N){super._deserialize(N),this.strength=N.strength}}(0,X.b)([TU("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iV.prototype,"strength",void 0),(0,i.e)("BABYLON.UpdateFlowMapBlock",iV);(0,i.e)("BABYLON.SphereShapeBlock",class extends PU{constructor(N){super(N),this.registerInput("input",IU.Particle),this.registerInput("radius",IU.Float,!0,1),this.registerInput("radiusRange",IU.Float,!0,1,0,1),this.registerInput("directionRandomizer",IU.Float,!0,0,0,1),this.registerOutput("output",IU.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(N){const U=this.input.getConnectedValue(N);U._directionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.directionRandomizer.getConnectedValue(N),n=V.position.xU(N.emitterPosition).normalize(),q=(0,S.RandomRange)(0,t),i=(0,S.RandomRange)(0,t),z=(0,S.RandomRange)(0,t);n.x+=q,n.y+=i,n.z+=z,n.normalize(),N.isEmitterTransformNode?A.CU.TransformNormalFromFloatsToRef(q,i,z,N.emitterWorldMatrix,V.direction):V.direction.hi(q,i,z)},U._positionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.radius.getConnectedValue(N),n=this.radiusRange.getConnectedValue(N),q=t-(0,S.RandomRange)(0,t*n),i=(0,S.RandomRange)(0,1),z=(0,S.RandomRange)(0,2*Math.PI),E=Math.acos(2*i-1),p=q*Math.cos(z)*Math.sin(E),k=q*Math.cos(E),B=q*Math.sin(z)*Math.sin(E);N.isEmitterTransformNode?A.CU.TransformCoordinatesFromFloatsToRef(p,k,B,N.emitterWorldMatrix,V.position):(V.position.hi(p,k,B),V.position.addInPlace(N.emitterPosition))},this.output._storedValue=U}});(0,i.e)("BABYLON.PointShapeBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("direction1",IU.CU,!0,new A.CU(0,1,0)),this.registerInput("direction2",IU.CU,!0,new A.CU(0,1,0)),this.registerOutput("output",IU.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){const U=this.particle.getConnectedValue(N);U._directionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.direction1.getConnectedValue(N),n=this.direction2.getConnectedValue(N),q=(0,S.RandomRange)(t.x,n.x),i=(0,S.RandomRange)(t.y,n.y),z=(0,S.RandomRange)(t.z,n.z);N.isEmitterTransformNode?A.CU.TransformNormalFromFloatsToRef(q,i,z,N.emitterWorldMatrix,V.direction):V.direction.hi(q,i,z)},U._positionCreation.process=V=>{N.systemContext=U,N.isEmitterTransformNode?A.CU.TransformCoordinatesFromFloatsToRef(0,0,0,N.emitterWorldMatrix,V.position):V.position.A(N.emitterPosition)},this.output._storedValue=U}});(0,i.e)("BABYLON.CustomShapeBlock",class extends PU{constructor(N){super(N),this.registerInput("particle",IU.Particle),this.registerInput("position",IU.CU,!0,new A.CU(0,0,0)),this.registerInput("direction",IU.CU,!0,new A.CU(0,1,0)),this.registerOutput("output",IU.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){const U=this.particle.getConnectedValue(N);U._directionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.direction.getConnectedValue(N);N.isEmitterTransformNode?A.CU.TransformNormalToRef(t,N.emitterWorldMatrix,V.direction):V.direction.A(t)},U._positionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.position.getConnectedValue(N);N.isEmitterTransformNode?A.CU.TransformCoordinatesToRef(t,N.emitterWorldMatrix,V.position):(V.position.A(t),V.position.addInPlace(N.emitterPosition))},this.output._storedValue=U}});(0,i.e)("BABYLON.CylinderShapeBlock",class extends PU{constructor(N){super(N),this._tempVector=A.CU.Zero(),this.registerInput("particle",IU.Particle),this.registerInput("radius",IU.Float,!0,1),this.registerInput("height",IU.Float,!0,1,0),this.registerInput("radiusRange",IU.Float,!0,1,0,1),this.registerInput("directionRandomizer",IU.Float,!0,0,0,1),this.registerOutput("output",IU.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(N){const U=this.particle.getConnectedValue(N);U._directionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.directionRandomizer.getConnectedValue(N);V.position.subtractToRef(N.emitterPosition,this._tempVector),this._tempVector.normalize(),N.isEmitterTransformNode&&A.CU.TransformNormalToRef(this._tempVector,N.emitterInverseWorldMatrix,this._tempVector);const n=(0,S.RandomRange)(-t/2,t/2);let q=Math.atan2(this._tempVector.x,this._tempVector.z);q+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*t,this._tempVector.y=n,this._tempVector.x=Math.sin(q),this._tempVector.z=Math.cos(q),this._tempVector.normalize(),N.isEmitterTransformNode?A.CU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N.emitterWorldMatrix,V.direction):V.direction.A(this._tempVector)},U._positionCreation.process=V=>{N.particleContext=V,N.systemContext=U;const t=this.height.getConnectedValue(N),n=this.radiusRange.getConnectedValue(N),q=this.radius.getConnectedValue(N),i=(0,S.RandomRange)(-t/2,t/2),z=(0,S.RandomRange)(0,2*Math.PI),E=(0,S.RandomRange)((1-n)*(1-n),1),p=Math.sqrt(E)*q,k=p*Math.cos(z),B=p*Math.sin(z);N.isEmitterTransformNode?A.CU.TransformCoordinatesFromFloatsToRef(k,i,B,N.emitterWorldMatrix,V.position):(V.position.hi(k,i,B),V.position.addInPlace(N.emitterPosition))},this.output._storedValue=U}});class zV extends PU{constructor(N){super(N),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",IU.Particle),this.registerOutput("output",IU.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);const U=this.particle.getConnectedValue(N);U._isAnimationSheetEnabled=!0,U.spriteCellWidth=this.width,U.spriteCellHeight=this.height,U.startSpriteCellID=this.start,U.endSpriteCellID=this.end,U.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=U}serialize(){const N=super.serialize();return N.width=this.width,N.height=this.height,N.start=this.start,N.end=this.end,N.randomStartCell=this.randomStartCell,N}_deserialize(N){super._deserialize(N),this.width=N.width,this.height=N.height,this.start=N.start,this.end=N.end,this.randomStartCell=N.randomStartCell}}(0,X.b)([TU("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zV.prototype,"start",void 0),(0,X.b)([TU("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zV.prototype,"end",void 0),(0,X.b)([TU("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zV.prototype,"width",void 0),(0,X.b)([TU("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zV.prototype,"height",void 0),(0,X.b)([TU("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],zV.prototype,"loop",void 0),(0,X.b)([TU("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],zV.prototype,"randomStartCell",void 0),(0,i.e)("BABYLON.SetupSpriteSheetBlock",zV);class SV extends PU{constructor(N){super(N),this.reference=0,this.registerInput("value",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=N=>{switch(N){case IU.Float:return IU.FloatGradient;case IU.Vector2:return IU.Vector2Gradient;case IU.CU:return IU.Vector3Gradient;case IU.Yi:return IU.Color4Gradient}return N},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(IU.Float|IU.Vector2|IU.CU|IU.Yi)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=N=>null}serialize(){const N=super.serialize();return N.reference=this.reference,N}_deserialize(N){super._deserialize(N),this.reference=N.reference}}(0,X.b)([TU("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],SV.prototype,"reference",void 0),(0,i.e)("BABYLON.ParticleGradientValueBlock",SV);(0,i.e)("BABYLON.ParticleGradientBlock",class extends PU{constructor(N){super(N),this._entryCount=1,this.registerInput("gradient",IU.Float,!0,1,0,1),this.registerInput("value0",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=N=>{switch(N){case IU.FloatGradient:return IU.Float;case IU.Vector2Gradient:return IU.Vector2;case IU.Vector3Gradient:return IU.CU;case IU.Color4Gradient:return IU.Yi}return N},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(IU.FloatGradient|IU.Vector2Gradient|IU.Vector3Gradient|IU.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(N){this._inputs[N].onConnectionObservable.add((()=>{this._entryCount>N||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),IU.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const N=[];for(let V=1;V<this._inputs.length;V++){var U;if(this._inputs[V].isConnected)N.push(null===(U=this._inputs[V].connectedPoint)||void 0===U?void 0:U.ownerBlock)}N.sort(((N,U)=>N.reference-U.reference)),this.output._storedFunction=U=>{const V=this.gradient.getConnectedValue(U);if(1===N.length)return N[0].value.getConnectedValue(U);let t=null;for(let n=N.length-1;n>=0;n--){const i=N[n];if(i.reference<=V){const N=i.value.getConnectedValue(U);if(t){const n=t.value.getConnectedValue(U),z=t.reference,E=i.reference,p=Math.max(0,Math.min(1,(V-E)/(z-E)));switch(this.output.type){case IU.Float:return(0,S.Lerp)(N,n,p);case IU.Vector2:return A.Vector2.Lerp(N,n,p);case IU.CU:return A.CU.Lerp(N,n,p);case IU.Yi:return q.Yi.Lerp(N,n,p)}}return N}t=i}return 0}}});(0,i.e)("BABYLON.ParticleConverterBlock",class extends PU{constructor(N){super(N),this.registerInput("color ",IU.Yi,!0),this.registerInput("xyz ",IU.CU,!0),this.registerInput("xy ",IU.Vector2,!0),this.registerInput("zw ",IU.Vector2,!0),this.registerInput("x ",IU.Float,!0),this.registerInput("y ",IU.Float,!0),this.registerInput("z ",IU.Float,!0),this.registerInput("w ",IU.Float,!0),this.registerOutput("color",IU.Yi),this.registerOutput("xyz",IU.CU),this.registerOutput("xy",IU.Vector2),this.registerOutput("zw",IU.Vector2),this.registerOutput("x",IU.Float),this.registerOutput("y",IU.Float),this.registerOutput("z",IU.Float),this.registerOutput("w",IU.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(N){return"color "===N?"colorIn":"xyz "===N?"xyzIn":"xy "===N?"xyIn":"zw "===N?"zwIn":"x "===N?"xIn":"y "===N?"yIn":"z "===N?"zIn":"w "===N?"wIn":N}_outputRename(N){switch(N){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return N}}_build(N){super._build(N);const U=this.xIn,V=this.yIn,t=this.zIn,n=this.wIn,i=this.xyIn,z=this.zwIn,S=this.xyzIn,E=this.colorIn,p=this.colorOut,k=this.xyzOut,B=this.xyOut,C=this.zwOut,x=this.xOut,J=this.yOut,d=this.zOut,r=this.wOut,v=N=>{if(E.isConnected)return E.getConnectedValue(N);let A=0,p=0,k=0,B=0;if(U.isConnected&&(A=U.getConnectedValue(N)),V.isConnected&&(p=V.getConnectedValue(N)),t.isConnected&&(k=t.getConnectedValue(N)),n.isConnected&&(B=n.getConnectedValue(N)),i.isConnected){const U=i.getConnectedValue(N);U&&(A=U.x,p=U.y)}if(z.isConnected){const U=z.getConnectedValue(N);U&&(k=U.x,B=U.y)}if(S.isConnected){const U=S.getConnectedValue(N);U&&(A=U.x,p=U.y,k=U.z)}return new q.Yi(A,p,k,B)};p._storedFunction=N=>v(N),k._storedFunction=N=>{const U=v(N);return new A.CU(U.r,U.g,U.b)},B._storedFunction=N=>{const U=v(N);return new A.Vector2(U.r,U.g)},C._storedFunction=N=>{const U=v(N);return new A.Vector2(U.b,U.a)},x._storedFunction=N=>v(N).r,J._storedFunction=N=>v(N).g,d._storedFunction=N=>v(N).b,r._storedFunction=N=>v(N).a}}),function(N){N[N.Cos=0]="Cos",N[N.Sin=1]="Sin",N[N.Abs=2]="Abs",N[N.Exp=3]="Exp",N[N.Exp2=4]="Exp2",N[N.Round=5]="Round",N[N.Floor=6]="Floor",N[N.Ceiling=7]="Ceiling",N[N.Sqrt=8]="Sqrt",N[N.Log=9]="Log",N[N.Tan=10]="Tan",N[N.ArcTan=11]="ArcTan",N[N.ArcCos=12]="ArcCos",N[N.ArcSin=13]="ArcSin",N[N.Sign=14]="Sign",N[N.Negate=15]="Negate",N[N.OneMinus=16]="OneMinus",N[N.Reciprocal=17]="Reciprocal",N[N.ToDegrees=18]="ToDegrees",N[N.ToRadians=19]="ToRadians",N[N.Fract=20]="Fract"}(jU||(jU={}));class EV extends PU{constructor(N){super(N),this.operation=jU.Cos,this.registerInput("input",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(IU.Float|IU.Int|IU.Vector2|IU.CU|IU.Yi)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);let U=null;switch(this.operation){case jU.Cos:U=N=>Math.cos(N);break;case jU.Sin:U=N=>Math.sin(N);break;case jU.Abs:U=N=>Math.abs(N);break;case jU.Exp:U=N=>Math.exp(N);break;case jU.Exp2:U=N=>Math.pow(2,N);break;case jU.Round:U=N=>Math.round(N);break;case jU.Floor:U=N=>Math.floor(N);break;case jU.Ceiling:U=N=>Math.ceil(N);break;case jU.Sqrt:U=N=>Math.sqrt(N);break;case jU.Log:U=N=>Math.log(N);break;case jU.Tan:U=N=>Math.tan(N);break;case jU.ArcTan:U=N=>Math.atan(N);break;case jU.ArcCos:U=N=>Math.acos(N);break;case jU.ArcSin:U=N=>Math.asin(N);break;case jU.Sign:U=N=>Math.sign(N);break;case jU.Negate:U=N=>-N;break;case jU.OneMinus:U=N=>1-N;break;case jU.Reciprocal:U=N=>1/N;break;case jU.ToRadians:U=N=>N*Math.PI/180;break;case jU.ToDegrees:U=N=>180*N/Math.PI;break;case jU.Fract:U=N=>N>=0?N-Math.floor(N):N-Math.ceil(N)}if(!U)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case IU.Int:case IU.Float:this.output._storedFunction=N=>{const V=this.input.getConnectedValue(N);return U(V)};break;case IU.Vector2:this.output._storedFunction=N=>{const V=this.input.getConnectedValue(N);return new A.Vector2(U(V.x),U(V.y))};break;case IU.CU:this.output._storedFunction=N=>{const V=this.input.getConnectedValue(N);return new A.CU(U(V.x),U(V.y),U(V.z))};break;case IU.Yi:this.output._storedFunction=N=>{const V=this.input.getConnectedValue(N);return new q.Yi(U(V.r),U(V.g),U(V.b),U(V.a))}}return this}serialize(){const N=super.serialize();return N.operation=this.operation,N}_deserialize(N){super._deserialize(N),this.operation=N.operation}}(0,X.b)([TU("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:jU.Cos},{label:"Sin",value:jU.Sin},{label:"Abs",value:jU.Abs},{label:"Exp",value:jU.Exp},{label:"Exp2",value:jU.Exp2},{label:"Round",value:jU.Round},{label:"Floor",value:jU.Floor},{label:"Ceiling",value:jU.Ceiling},{label:"Sqrt",value:jU.Sqrt},{label:"Log",value:jU.Log},{label:"Tan",value:jU.Tan},{label:"ArcTan",value:jU.ArcTan},{label:"ArcCos",value:jU.ArcCos},{label:"ArcSin",value:jU.ArcSin},{label:"Sign",value:jU.Sign},{label:"Negate",value:jU.Negate},{label:"OneMinus",value:jU.OneMinus},{label:"Reciprocal",value:jU.Reciprocal},{label:"ToDegrees",value:jU.ToDegrees},{label:"ToRadians",value:jU.ToRadians},{label:"Fract",value:jU.Fract}]})],EV.prototype,"operation",void 0),(0,i.e)("BABYLON.ParticleTrigonometryBlock",EV);var pV,kV=V(13743);class BV extends PU{constructor(N){super(N),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(IU.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(IU.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(IU.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(IU.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(IU.System),this._inputs[0].excludedConnectionPointTypes.push(IU.Particle),this._inputs[0].excludedConnectionPointTypes.push(IU.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const U=N=>{const U=this.input.getConnectedValue(N);if(this.log.length>=this.stackSize)return U;if(null===U||void 0===U)return this.log.push(["null",""]),U;switch(this.input.type){case IU.Vector2:this.log.push([(0,kV.k)(U,4),U.toString()]);break;case IU.CU:this.log.push([(0,kV.m)(U,4),U.toString()]);break;case IU.Yi:this.log.push([`{R: ${U.r.toFixed(4)} G: ${U.g.toFixed(4)} B: ${U.b.toFixed(4)} A: ${U.a.toFixed(4)}}`,U.toString()]);break;default:this.log.push([U.toString(),U.toString()])}return U};this.output.isConnected?this.output._storedFunction=U:this.output._storedValue=U(N)}serialize(){const N=super.serialize();return N.stackSize=this.stackSize,N}_deserialize(N){super._deserialize(N),this.stackSize=N.stackSize}}(0,X.b)([TU("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],BV.prototype,"stackSize",void 0),(0,i.e)("BABYLON.ParticleDebugBlock",BV);(0,i.e)("BABYLON.ParticleElbowBlock",class extends PU{constructor(N){super(N),this.registerInput("input",IU.AutoDetect),this.registerOutput("output",IU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);const U=this._outputs[0],V=this._inputs[0];U._storedFunction=N=>V.getConnectedValue(N)}});(0,i.e)("BABYLON.ParticleTeleportInBlock",class extends PU{get endpoints(){return this._endpoints}constructor(N){super(N),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",IU.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(N){if(this.getClassName()===N)return!0;for(const U of this.endpoints)if(U.isAnAncestorOfType(N))return!0;return!1}isAnAncestorOf(N){for(const U of this.endpoints){if(U===N)return!0;if(U.isAnAncestorOf(N))return!0}return!1}attachToEndpoint(N){N.detach(),this._endpoints.push(N),N._entryPoint=this,N._outputs[0]._typeConnectionSource=this._inputs[0],N._tempEntryPointUniqueId=null,N.name="> "+this.name}detachFromEndpoint(N){const U=this._endpoints.indexOf(N);-1!==U&&(this._endpoints.splice(U,1),N._outputs[0]._typeConnectionSource=null,N._entryPoint=null)}_build(){for(const N of this._endpoints)N.output._storedFunction=N=>this.input.getConnectedValue(N)}});(0,i.e)("BABYLON.ParticleTeleportOutBlock",class extends PU{constructor(N){super(N),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",IU.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(N){this.entryPoint&&this.entryPoint.build(N)}clone(){const N=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(N),N}serialize(){var N;const U=super.serialize();return U.entryPoint=(null===(N=this.entryPoint)||void 0===N?void 0:N.uniqueId)??"",U}_deserialize(N){super._deserialize(N),this._tempEntryPointUniqueId=N.entryPoint}}),function(N){N[N.Equal=0]="Equal",N[N.NotEqual=1]="NotEqual",N[N.LessThan=2]="LessThan",N[N.GreaterThan=3]="GreaterThan",N[N.LessOrEqual=4]="LessOrEqual",N[N.GreaterOrEqual=5]="GreaterOrEqual",N[N.Xor=6]="Xor",N[N.Or=7]="Or",N[N.And=8]="And"}(pV||(pV={}));class CV extends PU{constructor(N){super(N),this.test=pV.Equal,this.epsilon=0,this.registerInput("left",IU.Float),this.registerInput("right",IU.Float,!0,0),this.registerInput("ifTrue",IU.AutoDetect,!0,1),this.registerInput("ifFalse",IU.AutoDetect,!0,0),this.registerOutput("output",IU.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=IU.Float,this._inputs[0].acceptedConnectionPointTypes.push(IU.Int),this._inputs[1].acceptedConnectionPointTypes.push(IU.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const N=N=>{const U=this.left.getConnectedValue(N),V=this.right.getConnectedValue(N);let A=!1;switch(this.test){case pV.Equal:A=(0,S.WithinEpsilon)(U,V,this.epsilon);break;case pV.NotEqual:A=!(0,S.WithinEpsilon)(U,V,this.epsilon);break;case pV.LessThan:A=U<V+this.epsilon;break;case pV.GreaterThan:A=U>V-this.epsilon;break;case pV.LessOrEqual:A=U<=V+this.epsilon;break;case pV.GreaterOrEqual:A=U>=V-this.epsilon;break;case pV.Xor:A=!!U&&!V||!U&&!!V;break;case pV.Or:A=!!U||!!V;break;case pV.And:A=!!U&&!!V}return A};this.output._storedFunction=U=>N(U)?this.ifTrue.getConnectedValue(U):this.ifFalse.getConnectedValue(U)}serialize(){const N=super.serialize();return N.test=this.test,N.epsilon=this.epsilon,N}_deserialize(N){super._deserialize(N),this.test=N.test,void 0!==N.epsilon&&(this.epsilon=N.epsilon)}}(0,X.b)([TU("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:pV.Equal},{label:"NotEqual",value:pV.NotEqual},{label:"LessThan",value:pV.LessThan},{label:"GreaterThan",value:pV.GreaterThan},{label:"LessOrEqual",value:pV.LessOrEqual},{label:"GreaterOrEqual",value:pV.GreaterOrEqual},{label:"Xor",value:pV.Xor},{label:"Or",value:pV.Or},{label:"And",value:pV.And}]})],CV.prototype,"test",void 0),(0,X.b)([TU("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CV.prototype,"epsilon",void 0),(0,i.e)("BABYLON.ParticleConditionBlock",CV);class xV extends PU{constructor(N){super(N),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",IU.Particle),this.registerInput("condition",IU.Float,!0,0),this.registerInput("system",IU.System),this.registerOutput("output",IU.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){this._triggerCount=0;const U=this.input.getConnectedValue(N),V={process:V=>{if(N.particleContext=V,N.systemContext=U,0!==this.condition.getConnectedValue(N)&&(0===this.limit||this._triggerCount<this.limit)){const A=(new Date).getTime();if(this._previousOne&&A-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=A;const t=this.system.getConnectedValue(N);if(t){const A=OU(t,N.JU,V.position);A.Ai.addOnce((()=>{this._triggerCount--})),U.Ai.addOnce((()=>{A.dispose()}))}}},previousItem:null,nextItem:null};U._updateQueueStart?gN(V,U._updateQueueStart):U._updateQueueStart=V,this.output._storedValue=U}serialize(){const N=super.serialize();return N.limit=this.limit,N.delay=this.delay,N}_deserialize(N){super._deserialize(N),void 0!==N.limit&&(this.limit=N.limit),void 0!==N.delay&&(this.delay=N.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,X.b)([TU("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xV.prototype,"limit",void 0),(0,X.b)([TU("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xV.prototype,"delay",void 0),(0,i.e)("BABYLON.ParticleTriggerBlock",xV);V(13752),V(13763),V(13780),V(13823)},13804:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13784:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13838:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneVertex",n="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13828:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13815:(N,U,V)=>{"use strict";var A=V(12288);const t="fogFragment",n="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13802:(N,U,V)=>{"use strict";var A=V(12288);const t="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13846:(N,U,V)=>{"use strict";var A=V(12288);const t="fogVertex",n="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13836:(N,U,V)=>{"use strict";var A=V(12288);const t="fogVertexDeclaration",n="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13792:(N,U,V)=>{"use strict";var A=V(12288);const t="helperFunctions",n="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13788:(N,U,V)=>{"use strict";var A=V(12288);const t="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13794:(N,U,V)=>{"use strict";var A=V(12288);const t="imageProcessingFunctions",n="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13790:(N,U,V)=>{"use strict";var A=V(12288);const t="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13806:(N,U,V)=>{"use strict";var A=V(12288);const t="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13850:(N,U,V)=>{"use strict";var A=V(12288);const t="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";A.b.IncludesShadersStoreWGSL[t]||(A.b.IncludesShadersStoreWGSL[t]=n)},13780:(N,U,V)=>{"use strict";V.r(U),V.d(U,{particlesPixelShaderWGSL:()=>q});var A=V(12288);V(13784),V(13788),V(13790),V(13792),V(13794),V(13802),V(13804),V(13806),V(13815);const t="particlesPixelShader",n="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.b.ShadersStoreWGSL[t]||(A.b.ShadersStoreWGSL[t]=n);const q={name:t,shader:n}},13823:(N,U,V)=>{"use strict";V.r(U),V.d(U,{particlesVertexShaderWGSL:()=>q});var A=V(12288);V(13828),V(13836),V(13790),V(13838),V(13846),V(13850);const t="particlesVertexShader",n="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.b.ShadersStoreWGSL[t]||(A.b.ShadersStoreWGSL[t]=n);const q={name:t,shader:n}},13665:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13758:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13697:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneVertex",n="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13771:(N,U,V)=>{"use strict";var A=V(12288);const t="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13680:(N,U,V)=>{"use strict";var A=V(12288);const t="fogFragment",n="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13661:(N,U,V)=>{"use strict";var A=V(12288);const t="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13706:(N,U,V)=>{"use strict";var A=V(12288);const t="fogVertex",n="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13689:(N,U,V)=>{"use strict";var A=V(12288);const t="fogVertexDeclaration",n="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13657:(N,U,V)=>{"use strict";var A=V(12288);const t="helperFunctions",n="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13640:(N,U,V)=>{"use strict";var A=V(12288);const t="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13659:(N,U,V)=>{"use strict";var A=V(12288);const t="imageProcessingFunctions",n="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13649:(N,U,V)=>{"use strict";var A=V(12288);const t="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13674:(N,U,V)=>{"use strict";var A=V(12288);const t="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13708:(N,U,V)=>{"use strict";var A=V(12288);const t="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";A.b.IncludesShadersStore[t]||(A.b.IncludesShadersStore[t]=n)},13752:(N,U,V)=>{"use strict";V.r(U),V.d(U,{particlesPixelShader:()=>q});var A=V(12288);V(13758),V(13640),V(13649),V(13657),V(13659),V(13661),V(13665),V(13674),V(13680);const t="particlesPixelShader",n="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.b.ShadersStore[t]||(A.b.ShadersStore[t]=n);const q={name:t,shader:n}},13763:(N,U,V)=>{"use strict";V.r(U),V.d(U,{particlesVertexShader:()=>q});var A=V(12288);V(13771),V(13689),V(13649),V(13697),V(13706),V(13708);const t="particlesVertexShader",n="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.b.ShadersStore[t]||(A.b.ShadersStore[t]=n);const q={name:t,shader:n}},14097:(N,U,V)=>{"use strict";V.r(U),V.d(U,{FlowGraphGLTFDataProvider:()=>n});var A=V(14058),t=V(14036);class n extends A.c{constructor(N){var U,V;super();const A=N.glTF,n=(null===(U=A.animations)||void 0===U?void 0:U.map((N=>N._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",t.b,n);const q=(null===(V=A.nodes)||void 0===V?void 0:V.map((N=>N._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",t.b,q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13979:(N,U,V)=>{"use strict";V.d(U,{b:()=>J,e:()=>C,g:()=>B,j:()=>x});var A=V(12383),t=V(12834),n=V(12426),q=V(13985);const i=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class z{constructor(N,U){this._gltf=N,this._infoTree=U}convert(N){let U,V=this._gltf,A=this._infoTree;if(!N.startsWith("/"))throw new Error("Path must start with a /");const t=N.split("/");if(t.shift(),t[t.length-1].includes(".length")){const N=t[t.length-1].split(".");t.pop(),t.push(...N)}let n=!1;for(const z of t){const t="length"===z;if(t&&!A.__array__)throw new Error(`Path ${N} is invalid`);if(A.__ignoreObjectTree__&&(n=!0),A.__array__&&!t)A=A.__array__;else if(A=A[z],!A)throw new Error(`Path ${N} is invalid`);if(!n)if(void 0===V){if(!i.find((U=>U.regex.test(N))))throw new Error(`Path ${N} is invalid`)}else if(!t){var q;V=null===(q=V)||void 0===q?void 0:q[z]}(A.__target__||t)&&(U=V)}return{object:U,info:A}}}function S(N,U,V,A){const t=E(N,U);return A?t[V][A]:t[V]}function E(N,U,V){var A,n;return null===(A=N._data)||void 0===A||null===(n=A[(null===V||void 0===V?void 0:V.fillMode)??t.b.MATERIAL_TriangleFillMode])||void 0===n?void 0:n.babylonMaterial}function p(N,U){return{offset:{componentsCount:2,type:"Vector2",get:(V,t,n)=>{const q=S(V,n,N,U);return new A.Vector2(null===q||void 0===q?void 0:q.uOffset,null===q||void 0===q?void 0:q.vOffset)},getTarget:E,set:(V,A,t,n)=>{const q=S(A,n,N,U);q.uOffset=V.x,q.vOffset=V.y},getPropertyName:[()=>`${N}${U?"."+U:""}.uOffset`,()=>`${N}${U?"."+U:""}.vOffset`]},rotation:{type:"number",get:(V,A,t)=>{var n;return null===(n=S(V,t,N,U))||void 0===n?void 0:n.wAng},getTarget:E,set:(V,A,t,n)=>S(A,n,N,U).wAng=V,getPropertyName:[()=>`${N}${U?"."+U:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(V,t,n)=>{const q=S(V,n,N,U);return new A.Vector2(null===q||void 0===q?void 0:q.uScale,null===q||void 0===q?void 0:q.vScale)},getTarget:E,set:(V,A,t,n)=>{const q=S(A,n,N,U);q.uScale=V.x,q.vScale=V.y},getPropertyName:[()=>`${N}${U?"."+U:""}.uScale`,()=>`${N}${U?"."+U:""}.vScale`]}}}const k={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:N=>{var U,V;return new A.Vector2((null===(U=N._babylonCamera)||void 0===U?void 0:U.orthoLeft)??0,(null===(V=N._babylonCamera)||void 0===V?void 0:V.orthoRight)??0)},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.orthoLeft=N.x,U._babylonCamera.orthoRight=N.y)},getTarget:N=>N,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:N=>{var U,V;return new A.Vector2((null===(U=N._babylonCamera)||void 0===U?void 0:U.orthoBottom)??0,(null===(V=N._babylonCamera)||void 0===V?void 0:V.orthoTop)??0)},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.orthoBottom=N.x,U._babylonCamera.orthoTop=N.y)},getTarget:N=>N,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:N=>{var U;return null===(U=N._babylonCamera)||void 0===U?void 0:U.maxZ},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=N)},getTarget:N=>N,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:N=>{var U;return null===(U=N._babylonCamera)||void 0===U?void 0:U.Bi},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.Bi=N)},getTarget:N=>N,getPropertyName:[()=>"Bi"]}},perspective:{aspectRatio:{type:"number",get:N=>{var U;return null===(U=N._babylonCamera)||void 0===U?void 0:U.getEngine().getAspectRatio(N._babylonCamera)},getTarget:N=>N,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:N=>{var U;return null===(U=N._babylonCamera)||void 0===U?void 0:U.fov},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.fov=N)},getTarget:N=>N,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:N=>{var U;return null===(U=N._babylonCamera)||void 0===U?void 0:U.maxZ},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=N)},getTarget:N=>N,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:N=>{var U;return null===(U=N._babylonCamera)||void 0===U?void 0:U.Bi},set:(N,U)=>{U._babylonCamera&&(U._babylonCamera.Bi=N)},getTarget:N=>N,getPropertyName:[()=>"Bi"]}}}},nodes:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"CU",get:N=>{var U;return null===(U=N._babylonTransformNode)||void 0===U?void 0:U.position},set:(N,U)=>{var V;return null===(V=U._babylonTransformNode)||void 0===V?void 0:V.position.A(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:N=>{var U;return null===(U=N._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion},set:(N,U)=>{var V,A;return null===(V=U._babylonTransformNode)||void 0===V||null===(A=V.rotationQuaternion)||void 0===A?void 0:A.A(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"CU",get:N=>{var U;return null===(U=N._babylonTransformNode)||void 0===U?void 0:U.ci},set:(N,U)=>{var V;return null===(V=U._babylonTransformNode)||void 0===V?void 0:V.ci.A(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"ci"]},weights:{length:{type:"number",get:N=>N._numMorphTargets,getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(N,U)=>{var V,A;return void 0!==U?null===(V=N._primitiveBabylonMeshes)||void 0===V||null===(A=V[0].morphTargetManager)||void 0===A?void 0:A.getTarget(U).influence:void 0},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(N,U)=>[0],getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:N=>{var U,V,t;return A.Matrix.Compose(null===(U=N._babylonTransformNode)||void 0===U?void 0:U.ci,null===(V=N._babylonTransformNode)||void 0===V?void 0:V.rotationQuaternion,null===(t=N._babylonTransformNode)||void 0===t?void 0:t.position)},getTarget:N=>N._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:N=>{var U,V,t,n;const q=A.Matrix.Identity();let i=N.parent;for(;i&&i.parent;)i=i.parent;const z=(null===(U=N._babylonTransformNode)||void 0===U?void 0:U.position._isDirty)||(null===(V=N._babylonTransformNode)||void 0===V||null===(t=V.rotationQuaternion)||void 0===t?void 0:t._isDirty)||(null===(n=N._babylonTransformNode)||void 0===n?void 0:n.ci._isDirty);if(i){var S;const U=null===(S=i._babylonTransformNode)||void 0===S?void 0:S.xi(!0).invert();var E,p;if(U)null===(E=N._babylonTransformNode)||void 0===E||null===(p=E.xi(z))||void 0===p||p.multiplyToRef(U,q)}else N._babylonTransformNode&&q.A(N._babylonTransformNode.xi(z));return q},getTarget:N=>N._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:N=>{var U,V;return null===(U=N._babylonTransformNode)||void 0===U||null===(V=U.getChildren((N=>N instanceof q.e),!0)[0])||void 0===V?void 0:V.Mi},getTarget:N=>{var U;return null===(U=N._babylonTransformNode)||void 0===U?void 0:U.getChildren((N=>N instanceof q.e),!0)[0]},set:(N,U)=>{if(U._babylonTransformNode){const V=U._babylonTransformNode.getChildren((N=>N instanceof q.e),!0)[0];V&&(V.Mi=N)}}},color:{type:"rU",get:N=>{var U,V;return null===(U=N._babylonTransformNode)||void 0===U||null===(V=U.getChildren((N=>N instanceof q.e),!0)[0])||void 0===V?void 0:V.ai},getTarget:N=>{var U;return null===(U=N._babylonTransformNode)||void 0===U?void 0:U.getChildren((N=>N instanceof q.e),!0)[0]},set:(N,U)=>{if(U._babylonTransformNode){const V=U._babylonTransformNode.getChildren((N=>N instanceof q.e),!0)[0];V&&(V.ai=N)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"rU",get:(N,U,V)=>E(N,U,V).emissiveColor,set:(N,U,V,A)=>E(U,V,A).emissiveColor.A(N),getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:p("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(N,U,V)=>{var A;return null===(A=S(N,V,"bumpTexture"))||void 0===A?void 0:A.level},set:(N,U,V,A)=>{const t=S(U,A,"bumpTexture");t&&(t.level=N)},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:p("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(N,U,V)=>E(N,U,V).ambientTextureStrength,set:(N,U,V,A)=>{const t=E(U,V,A);t&&(t.ambientTextureStrength=N)},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:p("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Yi",get:(N,U,V)=>{const A=E(N,U,V);return n.Yi.FromColor3(A.albedoColor,A.alpha)},set:(N,U,V,A)=>{const t=E(U,V,A);t.albedoColor.set(N.r,N.g,N.b),t.alpha=N.a},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:p("albedoTexture")}},metallicFactor:{type:"number",get:(N,U,V)=>E(N,U,V).metallic,set:(N,U,V,A)=>{const t=E(U,V,A);t&&(t.metallic=N)},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(N,U,V)=>E(N,U,V).roughness,set:(N,U,V,A)=>{const t=E(U,V,A);t&&(t.roughness=N)},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:p("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(N,U,V)=>E(N,U,V).anisotropy.Mi,set:(N,U,V,A)=>{E(U,V,A).anisotropy.Mi=N},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(N,U,V)=>E(N,U,V).anisotropy.angle,set:(N,U,V,A)=>{E(U,V,A).anisotropy.angle=N},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:p("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(N,U,V)=>E(N,U,V).clearCoat.Mi,set:(N,U,V,A)=>{E(U,V,A).clearCoat.Mi=N},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(N,U,V)=>E(N,U,V).clearCoat.roughness,set:(N,U,V,A)=>{E(U,V,A).clearCoat.roughness=N},getTarget:(N,U,V)=>E(N,U,V),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:p("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(N,U,V)=>{var A;return null===(A=E(N,U,V).clearCoat.bumpTexture)||void 0===A?void 0:A.level},getTarget:E,set:(N,U,V,A)=>E(U,V,A).clearCoat.bumpTexture.level=N},extensions:{KHR_texture_transform:p("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:p("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(N,U,V)=>E(N,U,V).subSurface.dispersion,getTarget:E,set:(N,U,V,A)=>E(U,V,A).subSurface.dispersion=N}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(N,U,V)=>E(N,U,V).emissiveIntensity,getTarget:E,set:(N,U,V,A)=>E(U,V,A).emissiveIntensity=N}},KHR_materials_ior:{ior:{type:"number",get:(N,U,V)=>E(N,U,V).indexOfRefraction,getTarget:E,set:(N,U,V,A)=>E(U,V,A).indexOfRefraction=N}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(N,U,V)=>E(N,U,V).iridescence.Mi,getTarget:E,set:(N,U,V,A)=>E(U,V,A).iridescence.Mi=N},iridescenceIor:{type:"number",get:(N,U,V)=>E(N,U,V).iridescence.indexOfRefraction,getTarget:E,set:(N,U,V,A)=>E(U,V,A).iridescence.indexOfRefraction=N},iridescenceTexture:{extensions:{KHR_texture_transform:p("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(N,U,V)=>E(N,U,V).iridescence.maximumThickness,getTarget:E,set:(N,U,V,A)=>E(U,V,A).iridescence.maximumThickness=N},iridescenceThicknessMinimum:{type:"number",get:(N,U,V)=>E(N,U,V).iridescence.minimumThickness,getTarget:E,set:(N,U,V,A)=>E(U,V,A).iridescence.minimumThickness=N},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:p("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"rU",get:(N,U,V)=>E(N,U,V).sheen.color,getTarget:E,set:(N,U,V,A)=>E(U,V,A).sheen.color.A(N)},sheenColorTexture:{extensions:{KHR_texture_transform:p("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(N,U,V)=>E(N,U,V).sheen.Mi,getTarget:E,set:(N,U,V,A)=>E(U,V,A).sheen.Mi=N},sheenRoughnessTexture:{extensions:{KHR_texture_transform:p("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(N,U,V)=>E(N,U,V).metallicF0Factor,getTarget:E,set:(N,U,V,A)=>E(U,V,A).metallicF0Factor=N,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"rU",get:(N,U,V)=>E(N,U,V).metallicReflectanceColor,getTarget:E,set:(N,U,V,A)=>E(U,V,A).metallicReflectanceColor.A(N),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:p("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:p("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(N,U,V)=>E(N,U,V).subSurface.refractionIntensity,getTarget:E,set:(N,U,V,A)=>E(U,V,A).subSurface.refractionIntensity=N,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:p("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(N,U,V)=>E(N,U,V).subSurface.translucencyIntensity,getTarget:E,set:(N,U,V,A)=>E(U,V,A).subSurface.translucencyIntensity=N},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:p("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"rU",get:(N,U,V)=>E(N,U,V).subSurface.translucencyColor,getTarget:E,set:(N,U,V,A)=>{var t;return N&&(null===(t=E(U,V,A).subSurface.translucencyColor)||void 0===t?void 0:t.A(N))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:p("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"rU",get:(N,U,V)=>E(N,U,V).subSurface.tintColor,getTarget:E,set:(N,U,V,A)=>E(U,V,A).subSurface.tintColor.A(N)},attenuationDistance:{type:"number",get:(N,U,V)=>E(N,U,V).subSurface.tintColorAtDistance,getTarget:E,set:(N,U,V,A)=>E(U,V,A).subSurface.tintColorAtDistance=N},thicknessFactor:{type:"number",get:(N,U,V)=>E(N,U,V).subSurface.maximumThickness,getTarget:E,set:(N,U,V,A)=>E(U,V,A).subSurface.maximumThickness=N},thicknessTexture:{extensions:{KHR_texture_transform:p("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonLight)),getPropertyName:[N=>"length"]},__array__:{__target__:!0,color:{type:"rU",get:N=>{var U;return null===(U=N._babylonLight)||void 0===U?void 0:U.ai},set:(N,U)=>{var V;return null===(V=U._babylonLight)||void 0===V?void 0:V.ai.A(N)},getTarget:N=>N._babylonLight,getPropertyName:[N=>"diffuse"]},Mi:{type:"number",get:N=>{var U;return null===(U=N._babylonLight)||void 0===U?void 0:U.Mi},set:(N,U)=>U._babylonLight?U._babylonLight.Mi=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"intensity"]},range:{type:"number",get:N=>{var U;return null===(U=N._babylonLight)||void 0===U?void 0:U.range},set:(N,U)=>U._babylonLight?U._babylonLight.range=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"range"]},spot:{innerConeAngle:{type:"number",get:N=>{var U;return null===(U=N._babylonLight)||void 0===U?void 0:U.innerAngle},set:(N,U)=>U._babylonLight?U._babylonLight.innerAngle=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"innerConeAngle"]},outerConeAngle:{type:"number",get:N=>{var U;return null===(U=N._babylonLight)||void 0===U?void 0:U.angle},set:(N,U)=>U._babylonLight?U._babylonLight.angle=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonLight)),getPropertyName:[N=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonTexture)),getPropertyName:[N=>"length"]},__array__:{__target__:!0,Mi:{type:"number",get:N=>{var U;return null===(U=N._babylonTexture)||void 0===U?void 0:U.level},set:(N,U)=>{U._babylonTexture&&(U._babylonTexture.level=N)},getTarget:N=>N._babylonTexture},rotation:{type:"Quaternion",get:N=>{var U;return N._babylonTexture&&A.Quaternion.FromRotationMatrix(null===(U=N._babylonTexture)||void 0===U?void 0:U.getReflectionTextureMatrix())},set:(N,U)=>{var V;U._babylonTexture&&(null!==(V=U._babylonTexture.YN())&&void 0!==V&&V.useRightHandedSystem||(N=A.Quaternion.Inverse(N)),A.Matrix.FromQuaternionToRef(N,U._babylonTexture.getReflectionTextureMatrix()))},getTarget:N=>N._babylonTexture}}}}},animations:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>{var U;return null===(U=N.primitives[0]._instanceData)||void 0===U?void 0:U.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function B(N){return new z(N,k)}function C(N){const U=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let V=k;for(const A of U)A&&(V=V[A]);if(V&&V.type&&V.get)return V}function x(N,U){const V=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let A=k;for(const t of V)t&&(A=A[t]);A&&A.type&&A.get&&(A.interpolation=U)}function J(N,U){const V=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let A=k;for(const t of V)if(t){if(!A[t]){if("?"===t){A.__ignoreObjectTree__=!0;continue}A[t]={},"__array__"===t&&(A[t].__target__=!0)}A=A[t]}Object.assign(A,U)}},13991:(N,U,V)=>{"use strict";V.r(U),V.d(U,{AnimationPropertyInfo:()=>S,TransformNodeAnimationPropertyInfo:()=>E,WeightAnimationPropertyInfo:()=>p,getQuaternion:()=>i,getVector3:()=>q,getWeights:()=>z});var A=V(12876),t=V(12383),n=V(13979);function q(N,U,V,A){return t.CU.vU(U,V).scaleInPlace(A)}function i(N,U,V,A){return t.Quaternion.vU(U,V).scaleInPlace(A)}function z(N,U,V,A){const t=new Array(N._numMorphTargets);for(let n=0;n<t.length;n++)t[n]=U[V++]*A;return t}class S{constructor(N,U,V,A){this.type=N,this.name=U,this.getValue=V,this.getStride=A}_buildAnimation(N,U,V){const t=new A.e(N,this.name,U,this.type);return t.setKeys(V),t}}class E extends S{buildAnimations(N,U,V,A){const t=[];return t.push({babylonAnimatable:N._babylonTransformNode,babylonAnimation:this._buildAnimation(U,V,A)}),t}}class p extends S{buildAnimations(N,U,V,t){const n=[];if(N._numMorphTargets)for(let q=0;q<N._numMorphTargets;q++){const i=new A.e(`${U}_${q}`,this.name,V,this.type);if(i.setKeys(t.map((N=>({frame:N.frame,inTangent:N.inTangent?N.inTangent[q]:void 0,value:N.value[q],outTangent:N.outTangent?N.outTangent[q]:void 0,interpolation:N.interpolation})))),N._primitiveBabylonMeshes)for(const U of N._primitiveBabylonMeshes)if(U.morphTargetManager){const N=U.morphTargetManager.getTarget(q),V=i.clone();N.animations.push(V),n.push({babylonAnimatable:N,babylonAnimation:V})}}return n}}(0,n.j)("/nodes/{}/translation",[new E(A.e.ANIMATIONTYPE_VECTOR3,"position",q,(()=>3))]),(0,n.j)("/nodes/{}/rotation",[new E(A.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",i,(()=>4))]),(0,n.j)("/nodes/{}/scale",[new E(A.e.ANIMATIONTYPE_VECTOR3,"ci",q,(()=>3))]),(0,n.j)("/nodes/{}/weights",[new p(A.e.ANIMATIONTYPE_FLOAT,"influence",z,(N=>N._numMorphTargets))])},13950:(N,U,V)=>{"use strict";class A{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((N,U)=>{this._resolve=N,this._reject=U}))}}var t=V(12383),n=V(12426),q=V(12179),i=V(12803),z=V(13953),S=V(13961),E=V(12182),p=V(12828),k=V(12876),B=V(12883),C=V(12223),x=V(12193),J=V(12197);class d{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(N){this._useTextureToStoreBoneMatrices=N,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(N,U,V){this.name=N,this.id=U,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=t.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new E.d,this.bones=[],this._scene=V||C.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const A=this._scene.getEngine().getCaps();this._canUseTextureForBones=A.textureFloat&&A.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((N=>!N.getParent()))}getTransformMatrices(N){if(this.needInitialSkinMatrix){if(!N)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return N._bonesTransformMatrices||this.prepare(!0),N._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(N){return this.needInitialSkinMatrix&&N._transformMatrixTexture?N._transformMatrixTexture:this._transformMatrixTexture}YN(){return this._scene}toString(N){let U=`Name: ${this.name}, nBones: ${this.bones.length}`;if(U+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,N){U+=", Ranges: {";let N=!0;for(const V in this._ranges)N&&(U+=", ",N=!1),U+=V;U+="}"}return U}getBoneIndexByName(N){for(let U=0,V=this.bones.length;U<V;U++)if(this.bones[U].name===N)return U;return-1}createAnimationRange(N,U,V){if(!this._ranges[N]){this._ranges[N]=new B.d(N,U,V);for(let A=0,t=this.bones.length;A<t;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].createRange(N,U,V)}}deleteAnimationRange(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let V=0,A=this.bones.length;V<A;V++)this.bones[V].animations[0]&&this.bones[V].animations[0].deleteRange(N,U);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}getAnimationRanges(){const N=[];let U;for(U in this._ranges)N.push(this._ranges[U]);return N}copyAnimationRange(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[U]||!N.getAnimationRange(U))return!1;let A=!0;const t=this._getHighestAnimationFrame()+1,n={},q=N.bones;let i,z;for(z=0,i=q.length;z<i;z++)n[q[z].name]=q[z];this.bones.length!==q.length&&(x.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${q.length}`),A=!1);const S=V&&this.dimensionsAtRest&&N.dimensionsAtRest?this.dimensionsAtRest.divide(N.dimensionsAtRest):null;for(z=0,i=this.bones.length;z<i;z++){const N=this.bones[z].name,q=n[N];q?A=A&&this.bones[z].copyAnimationRange(q,U,t,V,S):(x.b.Warn("copyAnimationRange: not same rig, missing source bone "+N),A=!1)}const E=N.getAnimationRange(U);return E&&(this._ranges[U]=new B.d(U,E.from+t,E.to+t)),A}returnToRest(){for(const N of this.bones)-1!==N._index&&N.returnToRest()}_getHighestAnimationFrame(){let N=0;for(let U=0,V=this.bones.length;U<V;U++)if(this.bones[U].animations[0]){const V=this.bones[U].animations[0].getHighestFrame();N<V&&(N=V)}return N}beginAnimation(N,U,V,A){const t=this.getAnimationRange(N);return t?this._scene.beginAnimation(this,t.from,t.to,U,V,A):null}static MakeAnimationAdditive(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;const A=N.getAnimationRange(V);if(!A)return null;const t=N._scene.getAllAnimatablesByTarget(N);let n=null;for(let i=0;i<t.length;i++){const N=t[i];if(N.fromFrame===(null===A||void 0===A?void 0:A.from)&&N.toFrame===(null===A||void 0===A?void 0:A.to)){n=N;break}}const q=N.getAnimatables();for(let i=0;i<q.length;i++){const N=q[i].animations;if(N)for(let A=0;A<N.length;A++)k.e.MakeAnimationAdditive(N[A],U,V)}return n&&(n.isAdditive=!0),N}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(N){this._meshesWithPoseMatrix.push(N)}_unregisterMeshWithPoseMatrix(N){const U=this._meshesWithPoseMatrix.indexOf(N);U>-1&&this._meshesWithPoseMatrix.splice(U,1)}_computeTransformMatrices(N,U){this.onBeforeComputeObservable.notifyObservers(this);for(let V=0;V<this.bones.length;V++){const A=this.bones[V];A._childUpdateId++;const t=A.getParent();if(t?A.getLocalMatrix().multiplyToRef(t.getFinalMatrix(),A.getFinalMatrix()):U?A.getLocalMatrix().multiplyToRef(U,A.getFinalMatrix()):A.getFinalMatrix().A(A.getLocalMatrix()),-1!==A._index){const U=null===A._index?V:A._index;A.getAbsoluteInverseBindMatrix().multiplyToArray(A.getFinalMatrix(),N,16*U)}}this._identity.copyToArray(N,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const N=this.YN().getRenderId();if(this._currentRenderId===N)return;this._currentRenderId=N}if(this._numBonesWithLinkedTransformNode>0)for(const N of this.bones)if(N._linkedTransformNode){const U=N._linkedTransformNode;N.position=U.position,U.rotationQuaternion?N.rotationQuaternion=U.rotationQuaternion:N.rotation=U.rotation,N.ci=U.ci}if(this.needInitialSkinMatrix)for(const N of this._meshesWithPoseMatrix){const U=N.getPoseMatrix();let V=this._isDirty;if(N._bonesTransformMatrices&&N._bonesTransformMatrices.length===16*(this.bones.length+1)||(N._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),V=!0),V){if(this._synchronizedWithMesh!==N){this._synchronizedWithMesh=N;for(const N of this.bones)if(!N.getParent()){N.getBindMatrix().multiplyToRef(U,t.TmpVectors.Matrix[1]),N._updateAbsoluteBindMatrices(t.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const U=4*(this.bones.length+1);N._transformMatrixTexture&&N._transformMatrixTexture.getSize().width===U||(N._transformMatrixTexture&&N._transformMatrixTexture.dispose(),N._transformMatrixTexture=p.b.CreateRGBATexture(N._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(N._bonesTransformMatrices,U),this.isUsingTextureForMatrices&&N._transformMatrixTexture&&N._transformMatrixTexture.update(N._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=p.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let N=0;N<this.bones.length;N++)this._animatables.push(this.bones[N])}return this._animatables}clone(N,U){const V=new d(N,U||N,this._scene);V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){const N=this.bones[A];let U=null;const t=N.getParent();if(t){const N=this.bones.indexOf(t);U=V.bones[N]}const n=new S.d(N.name,V,U,N.getBindMatrix().clone(),N.getRestMatrix().clone());n._index=N._index,N._linkedTransformNode&&n.linkTransformNode(N._linkedTransformNode),J.e.DeepCopy(N.animations,n.animations)}if(this._ranges){V._ranges={};for(const N in this._ranges){const U=this._ranges[N];U&&(V._ranges[N]=U.clone())}}return this._isDirty=!0,V.prepare(!0),V}enableBlending(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const U of this.bones)for(const V of U.animations)V.enableBlending=!0,V.blendingSpeed=N}dispose(){if(this._meshesWithPoseMatrix.length=0,this.YN().stopAnimation(this),this.YN().removeSkeleton(this),this._parentContainer){const N=this._parentContainer.skeletons.indexOf(this);N>-1&&this._parentContainer.skeletons.splice(N,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const N={};N.name=this.name,N.id=this.id,this.dimensionsAtRest&&(N.dimensionsAtRest=this.dimensionsAtRest.pi()),N.bones=[],N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let V=0;V<this.bones.length;V++){var U;const A=this.bones[V],t=A.getParent(),n={parentBoneIndex:t?this.bones.indexOf(t):-1,index:A.getIndex(),name:A.name,id:A.id,matrix:A.getBindMatrix().pi(),rest:A.getRestMatrix().pi(),linkedTransformNodeId:null===(U=A.getTransformNode())||void 0===U?void 0:U.id};N.bones.push(n),A.length&&(n.length=A.length),A.metadata&&(n.metadata=A.metadata),A.animations&&A.animations.length>0&&(n.animation=A.animations[0].serialize()),N.ranges=[];for(const U in this._ranges){const V=this._ranges[U];if(!V)continue;const A={};A.name=U,A.from=V.from,A.to=V.to,N.ranges.push(A)}}return N}static Parse(N,U){const V=new d(N.name,N.id,U);let A;for(N.dimensionsAtRest&&(V.dimensionsAtRest=t.CU.vU(N.dimensionsAtRest)),V.needInitialSkinMatrix=N.needInitialSkinMatrix,A=0;A<N.bones.length;A++){const U=N.bones[A],n=N.bones[A].index;let q=null;U.parentBoneIndex>-1&&(q=V.bones[U.parentBoneIndex]);const i=U.rest?t.Matrix.vU(U.rest):null,z=new S.d(U.name,V,q,t.Matrix.vU(U.matrix),i,null,n);void 0!==U.id&&null!==U.id&&(z.id=U.id),U.length&&(z.length=U.length),U.metadata&&(z.metadata=U.metadata),U.animation&&z.animations.push(k.e.Parse(U.animation)),void 0!==U.linkedTransformNodeId&&null!==U.linkedTransformNodeId&&(V._hasWaitingData=!0,z._waitingTransformNodeId=U.linkedTransformNodeId)}if(N.ranges)for(A=0;A<N.ranges.length;A++){const U=N.ranges[A];V.createAnimationRange(U.name,U.from,U.to)}return V}computeAbsoluteMatrices(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||N)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(N)}getPoseMatrix(){let N=null;return this._meshesWithPoseMatrix.length>0&&(N=this._meshesWithPoseMatrix[0].getPoseMatrix()),N}sortBones(){const N=[],U=new Array(this.bones.length);for(let V=0;V<this.bones.length;V++)this._sortBones(V,N,U);this.bones=N}_sortBones(N,U,V){if(V[N])return;V[N]=!0;const A=this.bones[N];if(!A)return;void 0===A._index&&(A._index=N);const t=A.getParent();t&&this._sortBones(this.bones.indexOf(t),U,V),U.push(A)}setCurrentPoseAsRest(){for(const N of this.bones)N.setCurrentPoseAsRest()}}var r=V(12672),v=V(12844),h=V(12364),c=V(12762),H=V(12453),Y=V(12811),W=V(12772),s=V(12799),M=V(12886),a=V(12481),mN=V(13913);class w{set areUpdatesFrozen(N){N?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new a.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,N||(N=C.e.LastCreatedScene),this._scene=N,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const N=this._scene.getEngine().getCaps();this._canUseTextureForTargets=N.canUseGLVertexID&&N.textureFloat&&N.maxVertexTextureImageUnits>0&&N.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return w.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?w.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(N){this._numMaxInfluencers!==N&&(this._numMaxInfluencers=N,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(N){this._useTextureToStoreTargets!==N&&(this._useTextureToStoreTargets=N,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var N;return w.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(N=this._scene)&&void 0!==N&&N.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(N){return this._activeTargets.data[N]}getTarget(N){return this._targets[N]}getTargetByName(N){for(const U of this._targets)if(U.name===N)return U;return null}addTarget(N){this._targets.push(N),this._targetInfluenceChangedObservers.push(N.onInfluenceChanged.add((N=>{this.areUpdatesFrozen&&N&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(N)}))),this._targetDataLayoutChangedObservers.push(N._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(N){const U=this._targets.indexOf(N);U>=0&&(this._targets.splice(U,1),N.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(U,1)[0]),N._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(U,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(N)}_bind(N){N.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),N.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),N.setTexture("morphTargets",this._targetStoreTexture),N.setInt("morphTargetCount",this.numInfluencers)}clone(){const N=new w(this._scene);for(const U of this._targets)N.addTarget(U.clone());return N.enablePositionMorphing=this.enablePositionMorphing,N.enableNormalMorphing=this.enableNormalMorphing,N.enableTangentMorphing=this.enableTangentMorphing,N.enableUVMorphing=this.enableUVMorphing,N.enableUV2Morphing=this.enableUV2Morphing,N.enableColorMorphing=this.enableColorMorphing,N}serialize(){const N={};N.id=this.uniqueId,N.targets=[];for(const U of this._targets)N.targets.push(U.serialize());return N}_syncActiveTargets(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const U=!!this._targetStoreTexture,V=this.isUsingTextureForTargets;(this._mustSynchronize||U!==V)&&(this._mustSynchronize=!1,this.synchronize());let A=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let t=-1;for(const n of this._targets)if(t++,0!==n.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=w.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(n),this._morphTargetTextureIndices[A]=t,this._tempInfluences[A++]=n.influence}this._morphTargetTextureIndices.length!==A&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,A)),this._influences&&this._influences.length===A||(this._influences=new Float32Array(A));for(let n=0;n<A;n++)this._influences[n]=this._tempInfluences[n];if(N&&this._scene)for(const n of this._scene.meshes)n.morphTargetManager===this&&(V?n._markSubMeshesAsAttributesDirty():n._syncGeometryWithMorphTargetManager())}synchronize(){var N;if(!this._scene||this.areUpdatesFrozen)return;const U=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(N=this._targetStoreTexture)||void 0===N||N.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>U.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const V of this._targets){this._supportsPositions=this._supportsPositions&&V.hasPositions,this._supportsNormals=this._supportsNormals&&V.hasNormals,this._supportsTangents=this._supportsTangents&&V.hasTangents,this._supportsUVs=this._supportsUVs&&V.hasUVs,this._supportsUV2s=this._supportsUV2s&&V.hasUV2s,this._supportsColors=this._supportsColors&&V.hasColors;const N=V.vertexCount;if(0===this._vertexCount)this._vertexCount=N;else if(this._vertexCount!==N)return void x.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${V.name}": ${N}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const N=U.getCaps().maxTextureSize;this._textureWidth>N&&(this._textureHeight=Math.ceil(this._textureWidth/N),this._textureWidth=N);const V=this._targets.length,A=new Float32Array(V*this._textureWidth*this._textureHeight*4);let t=0;for(let U=0;U<V;U++){const N=this._targets[U],V=N.getPositions(),n=N.getNormals(),q=N.getUVs(),i=N.getTangents(),z=N.getUV2s(),S=N.getColors();t=U*this._textureWidth*this._textureHeight*4;for(let U=0;U<this._vertexCount;U++)this._supportsPositions&&V&&(A[t]=V[3*U],A[t+1]=V[3*U+1],A[t+2]=V[3*U+2],t+=4),this._supportsNormals&&n&&(A[t]=n[3*U],A[t+1]=n[3*U+1],A[t+2]=n[3*U+2],t+=4),this._supportsUVs&&q&&(A[t]=q[2*U],A[t+1]=q[2*U+1],t+=4),this._supportsTangents&&i&&(A[t]=i[3*U],A[t+1]=i[3*U+1],A[t+2]=i[3*U+2],t+=4),this._supportsUV2s&&z&&(A[t]=z[2*U],A[t+1]=z[2*U+1],t+=4),this._supportsColors&&S&&(A[t]=S[4*U],A[t+1]=S[4*U+1],A[t+2]=S[4*U+2],A[t+3]=S[4*U+3],t+=4)}this._targetStoreTexture=mN.b.CreateRGBATexture(A,this._textureWidth,this._textureHeight,V,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const V of this._scene.meshes)V.morphTargetManager===this&&V._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const N=this._parentContainer.morphTargetManagers.indexOf(this);N>-1&&this._parentContainer.morphTargetManagers.splice(N,1),this._parentContainer=null}for(const N of this._targets)this._scene.stopAnimation(N)}}static Parse(N,U){const V=new w(U);for(const A of N.targets)V.addTarget(M.b.Parse(A,U));return V}}w.EnableTextureStorage=!0,w.MaxActiveMorphTargetsInVertexAttributeMode=8,w.ConstantTargetCountForTextureMode=0;var X=V(13967),e=V(12232),Q=V(12692);const u=new Map,L=u;function I(N,U,V){o(N)&&x.b.Warn(`Extension with the name '${N}' already exists`),u.set(N,{isGLTFExtension:U,factory:V})}function o(N){return u.delete(N)}var R=V(13979),D=V(12933),G=V(12466);class g{static Get(N,U,V){if(!U||void 0==V||!U[V])throw new Error(`${N}: Failed to find index (${V})`);return U[V]}static TryGet(N,U){return N&&void 0!=U&&N[U]?N[U]:null}static Assign(N){if(N)for(let U=0;U<N.length;U++)N[U].index=U}}function l(N){if(N.min&&N.max){const U=N.min,V=N.max,A=t.TmpVectors.CU[0].hi(U[0],U[1],U[2]),n=t.TmpVectors.CU[1].hi(V[0],V[1],V[2]);if(N.normalized&&5126!==N.componentType){let U=1;switch(N.componentType){case 5120:U=127;break;case 5121:U=255;break;case 5122:U=32767;break;case 5123:U=65535}const V=1/U;A.scaleInPlace(V),n.scaleInPlace(V)}return new Q.d(A,n)}return null}class K{static RegisterExtension(N,U){I(N,!1,U)}static UnregisterExtension(N){return o(N)}get ii(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(N){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=N}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((N=>N.dispose&&N.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(N,U,V,A,t,n){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=U,this._assetContainer=V,this._loadData(A);let n=null;if(N){const U={};if(this._gltf.nodes)for(const N of this._gltf.nodes)N.name&&(U[N.name]=N.index);n=(N instanceof Array?N:[N]).map((N=>{const V=U[N];if(void 0===V)throw new Error(`Failed to find node '${N}'`);return V}))}return await this._loadAsync(t,q,n,(()=>({meshes:this._getMeshes(),yp:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=N,this._loadData(U),await this._loadAsync(V,t,null,(()=>{}))}async _loadAsync(N,U,V,A){return await Promise.resolve().then((async()=>{this._rootUrl=N,this._uniqueRootUrl=!N.startsWith("file:")&&U?N:`${N}${Date.now()}/`,this._fileName=U,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const t=`${X.i[X.i.LOADING]} => ${X.i[X.i.READY]}`,n=`${X.i[X.i.LOADING]} => ${X.i[X.i.COMPLETE]}`;this._parent._startPerformanceCounter(t),this._parent._startPerformanceCounter(n),this._parent._setState(X.i.LOADING),this._extensionsOnLoading();const i=new Array;if(!this.parent.loadOnlyMaterials)if(V)i.push(this.loadSceneAsync("/nodes",{nodes:V,index:-1}));else if(void 0!=this._gltf.JU||this._gltf.scenes&&this._gltf.scenes[0]){const N=g.Get("/scene",this._gltf.scenes,this._gltf.JU||0);i.push(this.loadSceneAsync(`/scenes/${N.index}`,N))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let N=0;N<this._gltf.materials.length;++N){const U=this._gltf.materials[N],V="/materials/"+N,A=r.d.TriangleFillMode;i.push(this._loadMaterialAsync(V,U,null,A,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync());const z=Promise.all(i).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Fi(!0);for(const N of this._babylonScene.materials){const U=N;void 0!==U.maxSimultaneousLights&&(U.maxSimultaneousLights=Math.max(U.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(X.i.READY),this._skipStartAnimationStep||this._startAnimations(),A()}));return await z.then((N=>(this._parent._endPerformanceCounter(t),q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(n),this._parent._setState(X.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(N=>{this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()}))})),N)))})).catch((N=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()),N}))}_loadData(N){if(this._gltf=N.json,this._setupData(),N.bin){const U=this._gltf.buffers;if(U&&U[0]&&!U[0].uri){const V=U[0];(V.byteLength<N.bin.byteLength-3||V.byteLength>N.bin.byteLength)&&x.b.Warn(`Binary buffer length (${V.byteLength}) from JSON does not match chunk length (${N.bin.byteLength})`),this._bin=N.bin}else x.b.Warn("Unexpected BIN chunk")}}_setupData(){if(g.Assign(this._gltf.accessors),g.Assign(this._gltf.animations),g.Assign(this._gltf.buffers),g.Assign(this._gltf.bufferViews),g.Assign(this._gltf.cameras),g.Assign(this._gltf.images),g.Assign(this._gltf.materials),g.Assign(this._gltf.meshes),g.Assign(this._gltf.nodes),g.Assign(this._gltf.samplers),g.Assign(this._gltf.scenes),g.Assign(this._gltf.skins),g.Assign(this._gltf.textures),this._gltf.nodes){const N={};for(const V of this._gltf.nodes)if(V.children)for(const U of V.children)N[U]=V.index;const U=this._createRootNode();for(const V of this._gltf.nodes){const A=N[V.index];V.parent=void 0===A?U:this._gltf.nodes[A]}}}async _loadExtensionsAsync(){const N=[];if(L.forEach(((U,V)=>{var A;!1===(null===(A=this.parent.extensionOptions[V])||void 0===A?void 0:A.enabled)?U.isGLTFExtension&&this.isExtensionUsed(V)&&x.b.Warn(`Extension ${V} is used but has been explicitly disabled.`):U.isGLTFExtension&&!this.isExtensionUsed(V)||N.push((async()=>{const N=await U.factory(this);return N.name!==V&&x.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${N.name} !== ${V}`),this._parent.onExtensionLoadedObservable.notifyObservers(N),N})())})),this._extensions.push(...await Promise.all(N)),this._extensions.sort(((N,U)=>(N.order||Number.MAX_VALUE)-(U.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const V of this._gltf.extensionsRequired){if(!this._extensions.some((N=>N.name===V&&N.enabled))){var U;if(!1===(null===(U=this.parent.extensionOptions[V])||void 0===U?void 0:U.enabled))throw new Error(`Required extension ${V} is disabled`);throw new Error(`Required extension ${V} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new s.b("__root__",this._babylonScene);this._rootBabylonMesh=N,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Fi(!1);const U={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case X.g.AUTO:this._babylonScene.useRightHandedSystem||(U.rotation=[0,1,0,0],U.scale=[1,1,-1],K._LoadTransform(U,this._rootBabylonMesh));break;case X.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(N),U}loadSceneAsync(N,U){const V=this._extensionsLoadSceneAsync(N,U);if(V)return V;const A=new Array;if(this.logOpen(`${N} ${U.name||""}`),U.nodes)for(const t of U.nodes){const U=g.Get(`${N}/nodes/${t}`,this._gltf.nodes,t);A.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(N=>{N.parent=this._rootBabylonMesh})))}for(const t of this._postSceneLoadActions)t();return A.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(A).then((()=>{}))}_forEachPrimitive(N,U){if(N._primitiveBabylonMeshes)for(const V of N._primitiveBabylonMeshes)U(V)}_getGeometries(){const N=[],U=this._gltf.nodes;if(U)for(const V of U)this._forEachPrimitive(V,(U=>{const V=U.Ji;V&&-1===N.indexOf(V)&&N.push(V)}));return N}_getMeshes(){const N=[];this._rootBabylonMesh instanceof W.e&&N.push(this._rootBabylonMesh);const U=this._gltf.nodes;if(U)for(const V of U)this._forEachPrimitive(V,(U=>{N.push(U)}));return N}_getTransformNodes(){const N=[],U=this._gltf.nodes;if(U)for(const V of U)V._babylonTransformNode&&"pz"===V._babylonTransformNode.getClassName()&&N.push(V._babylonTransformNode),V._babylonTransformNodeForSkin&&N.push(V._babylonTransformNodeForSkin);return N}_getSkeletons(){const N=[],U=this._gltf.skins;if(U)for(const V of U)V._data&&N.push(V._data.babylonSkeleton);return N}_getAnimationGroups(){const N=[],U=this._gltf.animations;if(U)for(const V of U)V._babylonAnimationGroup&&N.push(V._babylonAnimationGroup);return N}_startAnimations(){switch(this._parent.animationStartMode){case X.f.NONE:break;case X.f.FIRST:{const N=this._getAnimationGroups();0!==N.length&&N[0].start(!0);break}case X.f.ALL:{const N=this._getAnimationGroups();for(const U of N)U.start(!0);break}default:return void x.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadNodeAsync(N,U,V);if(A)return A;if(U._babylonTransformNode)throw new Error(`${N}: Invalid recursive node hierarchy`);const t=new Array;this.logOpen(`${N} ${U.name||""}`);const n=A=>{if(K.AddPointerMetadata(A,N),K._LoadTransform(U,A),void 0!=U.camera){const V=g.Get(`${N}/camera`,this._gltf.cameras,U.camera);t.push(this.loadCameraAsync(`/cameras/${V.index}`,V,(N=>{N.parent=A,this._babylonScene.useRightHandedSystem||(A.ci.x=-1)})))}if(U.children)for(const V of U.children){const U=g.Get(`${N}/children/${V}`,this._gltf.nodes,V);t.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(N=>{N.parent=A})))}V(A)},q=void 0!=U.mesh,i=this._parent.loadSkins&&void 0!=U.skin;if(!q||i){const N=U.name||`node${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new c.b(N,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==U.mesh?U._babylonTransformNode=V:U._babylonTransformNodeForSkin=V,n(V)}if(q)if(i){const V=g.Get(`${N}/mesh`,this._gltf.meshes,U.mesh);t.push(this._loadMeshAsync(`/meshes/${V.index}`,U,V,(V=>{const A=U._babylonTransformNodeForSkin;V.metadata=(0,D.d)(A.metadata,V.metadata||{});const n=g.Get(`${N}/skin`,this._gltf.skins,U.skin);t.push(this._loadSkinAsync(`/skins/${n.index}`,U,n,(N=>{this._forEachPrimitive(U,(U=>{U.skeleton=N})),this._postSceneLoadActions.push((()=>{if(void 0!=n.skeleton){const N=g.Get(`/skins/${n.index}/skeleton`,this._gltf.nodes,n.skeleton).parent;U.index===N.index?V.parent=A.parent:V.parent=N._babylonTransformNode}else V.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:A,skinnedNode:V})}))})))})))}else{const V=g.Get(`${N}/mesh`,this._gltf.meshes,U.mesh);t.push(this._loadMeshAsync(`/meshes/${V.index}`,U,V,n))}return this.logClose(),Promise.all(t).then((()=>(this._forEachPrimitive(U,(N=>{const U=N;!U.isAnInstance&&U.Ji&&U.Ji.useBoundingInfoFromGeometry?N.QN():N.refreshBoundingInfo(!0,!0)})),U._babylonTransformNode)))}_loadMeshAsync(N,U,V,A){const t=V.primitives;if(!t||!t.length)throw new Error(`${N}: Primitives are missing`);void 0==t[0].index&&g.Assign(t);const n=new Array;this.logOpen(`${N} ${V.name||""}`);const q=U.name||`node${U.index}`;if(1===t.length){const A=V.primitives[0];n.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${A.index}`,q,U,V,A,(N=>{U._babylonTransformNode=N,U._primitiveBabylonMeshes=[N]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,U._babylonTransformNode=new c.b(q,this._babylonScene),U._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._primitiveBabylonMeshes=[];for(const A of t)n.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${A.index}`,`${q}_primitive${A.index}`,U,V,A,(N=>{N.parent=U._babylonTransformNode,U._primitiveBabylonMeshes.push(N)})))}return A(U._babylonTransformNode),this.logClose(),Promise.all(n).then((()=>U._babylonTransformNode))}_loadMeshPrimitiveAsync(N,U,V,A,t,n){const q=this._extensionsLoadMeshPrimitiveAsync(N,U,V,A,t,n);if(q)return q;this.logOpen(`${N}`);const i=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==V.skin&&!A.primitives[0].targets;let z,S;if(i&&t._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,z=t._instanceData.babylonSourceMesh.createInstance(U),z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S=t._instanceData.promise;else{const n=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new s.b(U,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.sideOrientation=this._babylonScene.useRightHandedSystem?r.d.CounterClockWiseSideOrientation:r.d.ClockWiseSideOrientation,this._createMorphTargets(N,V,A,t,q),n.push(this._loadVertexDataAsync(N,t,q).then((async U=>await this._loadMorphTargetsAsync(N,t,q,U).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,U.XN(q),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const E=K._GetDrawMode(N,t.mode);if(void 0==t.material){let N=this._defaultBabylonMaterialData[E];N||(N=this._createDefaultMaterial("__GLTFLoader._default",E),this._parent.onMaterialLoadedObservable.notifyObservers(N),this._defaultBabylonMaterialData[E]=N),q.material=N}else if(!this.parent.skipMaterials){const U=g.Get(`${N}/material`,this._gltf.materials,t.material);n.push(this._loadMaterialAsync(`/materials/${U.index}`,U,q,E,(N=>{q.material=N})))}S=Promise.all(n),i&&(t._instanceData={babylonSourceMesh:q,promise:S}),z=q}return K.AddPointerMetadata(z,N),this._parent.onMeshLoadedObservable.notifyObservers(z),n(z),this.logClose(),S.then((()=>z))}_loadVertexDataAsync(N,U,V){const A=this._extensionsLoadVertexDataAsync(N,U,V);if(A)return A;const t=U.attributes;if(!t)throw new Error(`${N}: Attributes are missing`);const n=new Array,q=new Y.c(V.name,this._babylonScene);if(void 0==U.indices)V.isUnIndexed=!0;else{const V=g.Get(`${N}/indices`,this._gltf.accessors,U.indices);n.push(this._loadIndicesAccessorAsync(`/accessors/${V.index}`,V).then((N=>{q.setIndices(N)})))}const i=(U,A,i)=>{if(void 0==t[U])return;V._delayInfo=V._delayInfo||[],-1===V._delayInfo.indexOf(A)&&V._delayInfo.push(A);const z=g.Get(`${N}/attributes/${U}`,this._gltf.accessors,t[U]);n.push(this._loadVertexAccessorAsync(`/accessors/${z.index}`,z,A).then((N=>{if(N.getKind()===H.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!V.skeleton){const N=l(z);N&&(q._boundingInfo=N,q.useBoundingInfoFromGeometry=!0)}q.setVerticesBuffer(N,z.count)}))),A==H.f.MatricesIndicesExtraKind&&(V.numBoneInfluencers=8),i&&i(z)};return i("POSITION",H.f.PositionKind),i("NORMAL",H.f.NormalKind),i("TANGENT",H.f.TangentKind),i("TEXCOORD_0",H.f.UVKind),i("TEXCOORD_1",H.f.UV2Kind),i("TEXCOORD_2",H.f.UV3Kind),i("TEXCOORD_3",H.f.UV4Kind),i("TEXCOORD_4",H.f.UV5Kind),i("TEXCOORD_5",H.f.UV6Kind),i("JOINTS_0",H.f.MatricesIndicesKind),i("WEIGHTS_0",H.f.MatricesWeightsKind),i("JOINTS_1",H.f.MatricesIndicesExtraKind),i("WEIGHTS_1",H.f.MatricesWeightsExtraKind),i("COLOR_0",H.f.ColorKind,(N=>{"VEC4"===N.type&&(V.hasVertexAlpha=!0)})),Promise.all(n).then((()=>q))}_createMorphTargets(N,U,V,A,t){if(!A.targets||!this._parent.loadMorphTargets)return;if(void 0==U._numMorphTargets)U._numMorphTargets=A.targets.length;else if(A.targets.length!==U._numMorphTargets)throw new Error(`${N}: Primitives do not have the same number of targets`);const n=V.extras?V.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,t.morphTargetManager=new w(this._babylonScene),t.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.morphTargetManager.areUpdatesFrozen=!0;for(let q=0;q<A.targets.length;q++){const N=U.weights?U.weights[q]:V.weights?V.weights[q]:0,A=n?n[q]:`morphTarget${q}`;t.morphTargetManager.addTarget(new M.b(A,N,t.YN()))}}_loadMorphTargetsAsync(N,U,V,A){if(!U.targets||!this._parent.loadMorphTargets)return Promise.resolve();const t=new Array,n=V.morphTargetManager;for(let q=0;q<n.numTargets;q++){const V=n.getTarget(q);t.push(this._loadMorphTargetVertexDataAsync(`${N}/targets/${q}`,A,U.targets[q],V))}return Promise.all(t).then((()=>{n.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(N,U,V,A){const t=new Array,n=(A,n,q)=>{if(void 0==V[A])return;const i=U.getVertexBuffer(n);if(!i)return;const z=g.Get(`${N}/${A}`,this._gltf.accessors,V[A]);t.push(this._loadFloatAccessorAsync(`/accessors/${z.index}`,z).then((N=>{q(i,N)})))};return n("POSITION",H.f.PositionKind,((N,U)=>{const V=new Float32Array(U.length);N.forEach(U.length,((N,A)=>{V[A]=U[A]+N})),A.setPositions(V)})),n("NORMAL",H.f.NormalKind,((N,U)=>{const V=new Float32Array(U.length);N.forEach(V.length,((N,A)=>{V[A]=U[A]+N})),A.setNormals(V)})),n("TANGENT",H.f.TangentKind,((N,U)=>{const V=new Float32Array(U.length/3*4);let t=0;N.forEach(U.length/3*4,((N,A)=>{(A+1)%4!==0&&(V[t]=U[t]+N,t++)})),A.setTangents(V)})),n("TEXCOORD_0",H.f.UVKind,((N,U)=>{const V=new Float32Array(U.length);N.forEach(U.length,((N,A)=>{V[A]=U[A]+N})),A.setUVs(V)})),n("TEXCOORD_1",H.f.UV2Kind,((N,U)=>{const V=new Float32Array(U.length);N.forEach(U.length,((N,A)=>{V[A]=U[A]+N})),A.setUV2s(V)})),n("COLOR_0",H.f.ColorKind,((U,V)=>{let t=null;const n=U.getSize();if(3===n){t=new Float32Array(V.length/3*4),U.forEach(V.length,((N,U)=>{const A=Math.floor(U/3),n=U%3;t[4*A+n]=V[3*A+n]+N}));for(let N=0;N<V.length/3;++N)t[4*N+3]=1}else{if(4!==n)throw new Error(`${N}: Invalid number of components (${n}) for COLOR_0 attribute`);t=new Float32Array(V.length),U.forEach(V.length,((N,U)=>{t[U]=V[U]+N}))}A.setColors(t)})),await Promise.all(t).then((()=>{}))}static _LoadTransform(N,U){if(void 0!=N.skin)return;let V=t.CU.Zero(),A=t.Quaternion.Identity(),n=t.CU.One();if(N.matrix){t.Matrix.vU(N.matrix).decompose(n,A,V)}else N.translation&&(V=t.CU.vU(N.translation)),N.rotation&&(A=t.Quaternion.vU(N.rotation)),N.scale&&(n=t.CU.vU(N.scale));U.position=V,U.rotationQuaternion=A,U.ci=n}_loadSkinAsync(N,U,V,A){if(!this._parent.loadSkins)return Promise.resolve();const t=this._extensionsLoadSkinAsync(N,U,V);if(t)return t;if(V._data)return A(V._data.babylonSkeleton),V._data.promise;const n=`skeleton${V.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new d(V.name||n,n,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(N,V,q);const i=this._loadSkinInverseBindMatricesDataAsync(N,V).then((N=>{this._updateBoneMatrices(q,N)}));return V._data={babylonSkeleton:q,promise:i},A(q),i}_loadBones(N,U,V){if(void 0==U.skeleton||this._parent.alwaysComputeSkeletonRootNode){const V=this._findSkeletonRootNode(`${N}/joints`,U.joints);if(V)if(void 0===U.skeleton)U.skeleton=V.index;else{const A=(N,U)=>{for(;U.parent;U=U.parent)if(U.parent===N)return!0;return!1},t=g.Get(`${N}/skeleton`,this._gltf.nodes,U.skeleton);t===V||A(t,V)||(x.b.Warn(`${N}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),U.skeleton=V.index)}else x.b.Warn(`${N}: Failed to find common root`)}const A={};for(const t of U.joints){const n=g.Get(`${N}/joints/${t}`,this._gltf.nodes,t);this._loadBone(n,U,V,A)}}_findSkeletonRootNode(N,U){if(0===U.length)return null;const V={};for(const t of U){const U=[];let A=g.Get(`${N}/${t}`,this._gltf.nodes,t);for(;-1!==A.index;)U.unshift(A),A=A.parent;V[t]=U}let A=null;for(let t=0;;++t){let N=V[U[0]];if(t>=N.length)return A;const n=N[t];for(let q=1;q<U.length;++q)if(N=V[U[q]],t>=N.length||n!==N[t])return A;A=n}}_loadBone(N,U,V,A){N._isJoint=!0;let t=A[N.index];if(t)return t;let n=null;N.index!==U.skeleton&&(N.parent&&-1!==N.parent.index?n=this._loadBone(N.parent,U,V,A):void 0!==U.skeleton&&x.b.Warn(`/skins/${U.index}/skeleton: Skeleton node is not a common root`));const q=U.joints.indexOf(N.index);return t=new S.d(N.name||`joint${N.index}`,V,n,this._getNodeMatrix(N),null,null,q),A[N.index]=t,this._postSceneLoadActions.push((()=>{t.linkTransformNode(N._babylonTransformNode)})),t}_loadSkinInverseBindMatricesDataAsync(N,U){if(void 0==U.inverseBindMatrices)return Promise.resolve(null);const V=g.Get(`${N}/inverseBindMatrices`,this._gltf.accessors,U.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${V.index}`,V)}_updateBoneMatrices(N,U){for(const V of N.bones){const N=t.Matrix.Identity(),A=V._index;U&&-1!==A&&(t.Matrix.FromArrayToRef(U,16*A,N),N.invertToRef(N));const n=V.getParent();n&&N.multiplyToRef(n.getAbsoluteInverseBindMatrix(),N),V.Ci(N,!1,!1),V._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(N){return N.matrix?t.Matrix.vU(N.matrix):t.Matrix.Compose(N.scale?t.CU.vU(N.scale):t.CU.One(),N.rotation?t.Quaternion.vU(N.rotation):t.Quaternion.Identity(),N.translation?t.CU.vU(N.translation):t.CU.Zero())}loadCameraAsync(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadCameraAsync(N,U,V);if(A)return A;const n=new Array;this.logOpen(`${N} ${U.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new z.b(U.name||`camera${U.index}`,t.CU.Zero(),this._babylonScene,!1);switch(q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonCamera=q,q.setTarget(new t.CU(0,0,-1)),U.type){case"perspective":{const V=U.perspective;if(!V)throw new Error(`${N}: Camera perspective properties are missing`);q.fov=V.yfov,q.Bi=V.znear,q.maxZ=V.zfar||0;break}case"orthographic":if(!U.orthographic)throw new Error(`${N}: Camera orthographic properties are missing`);q.mode=i.b.ORTHOGRAPHIC_CAMERA,q.orthoLeft=-U.orthographic.xmag,q.orthoRight=U.orthographic.xmag,q.orthoBottom=-U.orthographic.ymag,q.orthoTop=U.orthographic.ymag,q.Bi=U.orthographic.znear,q.maxZ=U.orthographic.zfar;break;default:throw new Error(`${N}: Invalid camera type (${U.type})`)}return K.AddPointerMetadata(q,N),this._parent.onCameraLoadedObservable.notifyObservers(q),V(q),this.logClose(),Promise.all(n).then((()=>q))}_loadAnimationsAsync(){const N=this._gltf.animations;if(!N)return Promise.resolve();const U=new Array;for(let V=0;V<N.length;V++){const A=N[V];U.push(this.loadAnimationAsync(`/animations/${A.index}`,A).then((N=>{0===N.targetedAnimations.length&&N.dispose()})))}return Promise.all(U).then((()=>{}))}loadAnimationAsync(N,U){const A=this._extensionsLoadAnimationAsync(N,U);return A||V.e(78).then(V.bind(V,15517)).then((V=>{let{AnimationGroup:A}=V;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new A(U.name||`animation${U.index}`,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonAnimationGroup=t;const n=new Array;g.Assign(U.channels),g.Assign(U.samplers);for(const q of U.channels)n.push(this._loadAnimationChannelAsync(`${N}/channels/${q.index}`,N,U,q,((N,U)=>{N.animations=N.animations||[],N.animations.push(U),t.addTargetedAnimation(U,N)})));return Promise.all(n).then((()=>(t.normalize(0),t)))}))}async _loadAnimationChannelAsync(N,U,A,t,n){const q=this._extensionsLoadAnimationChannelAsync(N,U,A,t,n);if(q)return await q;if(void 0==t.target.node)return await Promise.resolve();const i=g.Get(`${N}/target/node`,this._gltf.nodes,t.target.node),z=t.target.path,S="weights"===z;if(S&&!i._numMorphTargets||!S&&!i._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!S&&!i._isJoint)return await Promise.resolve();let E;switch(await Promise.resolve().then(V.bind(V,13991)),z){case"translation":var p;E=null===(p=(0,R.e)("/nodes/{}/translation"))||void 0===p?void 0:p.interpolation;break;case"rotation":var k;E=null===(k=(0,R.e)("/nodes/{}/rotation"))||void 0===k?void 0:k.interpolation;break;case"scale":var B;E=null===(B=(0,R.e)("/nodes/{}/scale"))||void 0===B?void 0:B.interpolation;break;case"weights":var C;E=null===(C=(0,R.e)("/nodes/{}/weights"))||void 0===C?void 0:C.interpolation;break;default:throw new Error(`${N}/target/path: Invalid value (${t.target.path})`)}if(!E)throw new Error(`${N}/target/path: Could not find interpolation properties for target path (${t.target.path})`);const x={object:i,info:E};return await this._loadAnimationChannelFromTargetInfoAsync(N,U,A,t,x,n)}_loadAnimationChannelFromTargetInfoAsync(N,U,V,A,t,n){const q=this.parent.targetFps,i=1/q,z=g.Get(`${N}/sampler`,V.samplers,A.sampler);return this._loadAnimationSamplerAsync(`${U}/samplers/${A.sampler}`,z).then((N=>{let U=0;const z=t.object,S=t.info;for(const t of S){const S=t.getStride(z),E=N.input,p=N.output,k=new Array(E.length);let B=0;switch(N.interpolation){case"STEP":for(let N=0;N<E.length;N++){const U=t.getValue(z,p,B,1);B+=S,k[N]={frame:E[N]*q,value:U,interpolation:1}}break;case"CUBICSPLINE":for(let N=0;N<E.length;N++){const U=t.getValue(z,p,B,i);B+=S;const V=t.getValue(z,p,B,1);B+=S;const A=t.getValue(z,p,B,i);B+=S,k[N]={frame:E[N]*q,inTangent:U,value:V,outTangent:A}}break;case"LINEAR":for(let N=0;N<E.length;N++){const U=t.getValue(z,p,B,1);B+=S,k[N]={frame:E[N]*q,value:U}}}if(B>0){const N=`${V.name||`animation${V.index}`}_channel${A.index}_${U}`,i=t.buildAnimations(z,N,q,k);for(const V of i)U++,n(V.babylonAnimatable,V.babylonAnimation)}}}))}_loadAnimationSamplerAsync(N,U){if(U._data)return U._data;const V=U.interpolation||"LINEAR";switch(V){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${N}/interpolation: Invalid value (${U.interpolation})`)}const A=g.Get(`${N}/input`,this._gltf.accessors,U.input),t=g.Get(`${N}/output`,this._gltf.accessors,U.output);return U._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${A.index}`,A),this._loadFloatAccessorAsync(`/accessors/${t.index}`,t)]).then((N=>{let[U,A]=N;return{input:U,interpolation:V,output:A}})),U._data}loadBufferAsync(N,U,V,A){const t=this._extensionsLoadBufferAsync(N,U,V,A);if(t)return t;if(!U._data)if(U.uri)U._data=this.loadUriAsync(`${N}/uri`,U,U.uri);else{if(!this._bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);U._data=this._bin.readAsync(0,U.byteLength)}return U._data.then((U=>{try{return new Uint8Array(U.buffer,U.byteOffset+V,A)}catch(t){throw new Error(`${N}: ${t.message}`)}}))}loadBufferViewAsync(N,U){const V=this._extensionsLoadBufferViewAsync(N,U);if(V)return V;if(U._data)return U._data;const A=g.Get(`${N}/buffer`,this._gltf.buffers,U.buffer);return U._data=this.loadBufferAsync(`/buffers/${A.index}`,A,U.byteOffset||0,U.byteLength),U._data}_loadAccessorAsync(N,U,V){if(U._data)return U._data;const A=K._GetNumComponents(N,U.type),t=A*H.f.GetTypeByteLength(U.componentType),n=A*U.count;if(void 0==U.bufferView)U._data=Promise.resolve(new V(n));else{const q=g.Get(`${N}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((i=>{if(5126!==U.componentType||U.normalized||q.byteStride&&q.byteStride!==t){const N=new V(n);return H.f.ForEach(i,U.byteOffset||0,q.byteStride||t,A,U.componentType,N.length,U.normalized||!1,((U,V)=>{N[V]=U})),N}return K._GetTypedArray(N,U.componentType,i,U.byteOffset,n)}))}if(U.sparse){const n=U.sparse;U._data=U._data.then((q=>{const i=q,z=g.Get(`${N}/sparse/indices/bufferView`,this._gltf.bufferViews,n.indices.bufferView),S=g.Get(`${N}/sparse/values/bufferView`,this._gltf.bufferViews,n.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${z.index}`,z),this.loadBufferViewAsync(`/bufferViews/${S.index}`,S)]).then((q=>{let[z,S]=q;const E=K._GetTypedArray(`${N}/sparse/indices`,n.indices.componentType,z,n.indices.byteOffset,n.count),p=A*n.count;let k;if(5126!==U.componentType||U.normalized){const q=K._GetTypedArray(`${N}/sparse/values`,U.componentType,S,n.values.byteOffset,p);k=new V(p),H.f.ForEach(q,0,t,A,U.componentType,k.length,U.normalized||!1,((N,U)=>{k[U]=N}))}else k=K._GetTypedArray(`${N}/sparse/values`,U.componentType,S,n.values.byteOffset,p);let B=0;for(let N=0;N<E.length;N++){let U=E[N]*A;for(let N=0;N<A;N++)i[U++]=k[B++]}return i}))}))}return U._data}_loadFloatAccessorAsync(N,U){return this._loadAccessorAsync(N,U,Float32Array)}_loadIndicesAccessorAsync(N,U){if("SCALAR"!==U.type)throw new Error(`${N}/type: Invalid value ${U.type}`);if(5121!==U.componentType&&5123!==U.componentType&&5125!==U.componentType)throw new Error(`${N}/componentType: Invalid value ${U.componentType}`);if(U._data)return U._data;if(U.sparse){const V=K._GetTypedArrayConstructor(`${N}/componentType`,U.componentType);U._data=this._loadAccessorAsync(N,U,V)}else{const V=g.Get(`${N}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>K._GetTypedArray(N,U.componentType,V,U.byteOffset,U.count)))}return U._data}_loadVertexBufferViewAsync(N){if(N._babylonBuffer)return N._babylonBuffer;const U=this._babylonScene.getEngine();return N._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>new H.d(U,N,!1))),N._babylonBuffer}_loadVertexAccessorAsync(N,U,V){var A;if(null!==(A=U._babylonVertexBuffer)&&void 0!==A&&A[V])return U._babylonVertexBuffer[V];U._babylonVertexBuffer||(U._babylonVertexBuffer={});const t=this._babylonScene.getEngine();if(U.sparse||void 0==U.bufferView)U._babylonVertexBuffer[V]=this._loadFloatAccessorAsync(N,U).then((N=>new H.f(t,N,V,!1)));else{const A=g.Get(`${N}/bufferView`,this._gltf.bufferViews,U.bufferView);U._babylonVertexBuffer[V]=this._loadVertexBufferViewAsync(A).then((n=>{const q=K._GetNumComponents(N,U.type);return new H.f(t,n,V,!1,void 0,A.byteStride,void 0,U.byteOffset,q,U.componentType,U.normalized,!0,void 0,!0)}))}return U._babylonVertexBuffer[V]}_loadMaterialMetallicRoughnessPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return U&&(U.baseColorFactor?(V.albedoColor=n.rU.vU(U.baseColorFactor),V.alpha=U.baseColorFactor[3]):V.albedoColor=n.rU.White(),V.metallic=void 0==U.metallicFactor?1:U.metallicFactor,V.roughness=void 0==U.roughnessFactor?1:U.roughnessFactor,U.baseColorTexture&&A.push(this.loadTextureInfoAsync(`${N}/baseColorTexture`,U.baseColorTexture,(N=>{N.name=`${V.name} (Base Color)`,V.albedoTexture=N}))),U.metallicRoughnessTexture&&(U.metallicRoughnessTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${N}/metallicRoughnessTexture`,U.metallicRoughnessTexture,(N=>{N.name=`${V.name} (Metallic Roughness)`,V.metallicTexture=N}))),V.useMetallnessFromMetallicTextureBlue=!0,V.useRoughnessFromMetallicTextureGreen=!0,V.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(A).then((()=>{}))}_loadMaterialAsync(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const n=this._extensionsLoadMaterialAsync(N,U,V,A,t);if(n)return n;U._data=U._data||{};let q=U._data[A];if(!q){this.logOpen(`${N} ${U.name||""}`);const V=this.createMaterial(N,U,A);q={babylonMaterial:V,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(N,U,V)},U._data[A]=q,K.AddPointerMetadata(V,N),this._parent.onMaterialLoadedObservable.notifyObservers(V),this.logClose()}return V&&(q.babylonMeshes.push(V),V.Ai.addOnce((()=>{const N=q.babylonMeshes.indexOf(V);-1!==N&&q.babylonMeshes.splice(N,1)}))),t(q.babylonMaterial),q.promise.then((()=>q.babylonMaterial))}_createDefaultMaterial(N,U){this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new v.b(N,this._babylonScene);return V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.fillMode=U,V.enableSpecularAntiAliasing=!0,V.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,V.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,V.transparencyMode=v.b.PBRMATERIAL_OPAQUE,V.metallic=1,V.roughness=1,V}createMaterial(N,U,V){const A=this._extensionsCreateMaterial(N,U,V);if(A)return A;const t=U.name||`material${U.index}`;return this._createDefaultMaterial(t,V)}loadMaterialPropertiesAsync(N,U,V){const A=this._extensionsLoadMaterialPropertiesAsync(N,U,V);if(A)return A;const t=new Array;return t.push(this.loadMaterialBasePropertiesAsync(N,U,V)),U.pbrMetallicRoughness&&t.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${N}/pbrMetallicRoughness`,U.pbrMetallicRoughness,V)),this.loadMaterialAlphaProperties(N,U,V),Promise.all(t).then((()=>{}))}loadMaterialBasePropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return V.emissiveColor=U.emissiveFactor?n.rU.vU(U.emissiveFactor):new n.rU(0,0,0),U.doubleSided&&(V.ri=!1,V.twoSidedLighting=!0),U.normalTexture&&(U.normalTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${N}/normalTexture`,U.normalTexture,(N=>{N.name=`${V.name} (Normal)`,V.bumpTexture=N}))),V.invertNormalMapX=!this._babylonScene.useRightHandedSystem,V.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=U.normalTexture.scale&&V.bumpTexture&&(V.bumpTexture.level=U.normalTexture.scale),V.forceIrradianceInFragment=!0),U.occlusionTexture&&(U.occlusionTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${N}/occlusionTexture`,U.occlusionTexture,(N=>{N.name=`${V.name} (Occlusion)`,V.ambientTexture=N}))),V.useAmbientInGrayScale=!0,void 0!=U.occlusionTexture.strength&&(V.ambientTextureStrength=U.occlusionTexture.strength)),U.emissiveTexture&&A.push(this.loadTextureInfoAsync(`${N}/emissiveTexture`,U.emissiveTexture,(N=>{N.name=`${V.name} (Emissive)`,V.emissiveTexture=N}))),Promise.all(A).then((()=>{}))}loadMaterialAlphaProperties(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);switch(U.alphaMode||"OPAQUE"){case"OPAQUE":V.transparencyMode=v.b.PBRMATERIAL_OPAQUE,V.alpha=1;break;case"MASK":V.transparencyMode=v.b.PBRMATERIAL_ALPHATEST,V.alphaCutOff=void 0==U.alphaCutoff?.5:U.alphaCutoff,V.albedoTexture&&(V.albedoTexture.ki=!0);break;case"BLEND":V.transparencyMode=v.b.PBRMATERIAL_ALPHABLEND,V.albedoTexture&&(V.albedoTexture.ki=!0,V.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${N}/alphaMode: Invalid value (${U.alphaMode})`)}}loadTextureInfoAsync(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureInfoAsync(N,U,V);if(A)return A;if(this.logOpen(`${N}`),U.texCoord>=6)throw new Error(`${N}/texCoord: Invalid value (${U.texCoord})`);const t=g.Get(`${N}/index`,this._gltf.textures,U.index);t._textureInfo=U;const n=this._loadTextureAsync(`/textures/${U.index}`,t,(A=>{A.coordinatesIndex=U.texCoord||0,K.AddPointerMetadata(A,N),this._parent.onTextureLoadedObservable.notifyObservers(A),V(A)}));return this.logClose(),n}_loadTextureAsync(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureAsync(N,U,V);if(A)return A;this.logOpen(`${N} ${U.name||""}`);const t=void 0==U.sampler?K.DefaultSampler:g.Get(`${N}/sampler`,this._gltf.samplers,U.sampler),n=g.Get(`${N}/source`,this._gltf.images,U.source),q=this._createTextureAsync(N,t,n,V,void 0,!U._textureInfo.nonColorData);return this.logClose(),q}_createTextureAsync(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},n=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const i=this._loadSampler(`/samplers/${U.index}`,U),z=new Array,S=new A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,T:()=>{this._disposed||S.resolve()},onError:(U,V)=>{this._disposed||S.reject(new Error(`${N}: ${V&&V.message?V.message:U||"Failed to load texture"}`))},mimeType:V.mimeType??(0,e.i)(V.uri??""),loaderOptions:n,useSRGBBuffer:!!q&&this._parent.useSRGBBuffers},p=new h.e(null,this._babylonScene,E);return p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.push(S.promise),z.push(this.loadImageAsync(`/images/${V.index}`,V).then((N=>{const U=V.uri||`${this._fileName}#image${V.index}`,A=`data:${this._uniqueRootUrl}${U}`;p.updateURL(A,N);const t=p.getInternalTexture();t&&(t.label=V.name)}))),p.wrapU=i.wrapU,p.wrapV=i.wrapV,t(p),this._parent.useGltfTextureNames&&(p.name=V.name||V.uri||`image${V.index}`),Promise.all(z).then((()=>p))}_loadSampler(N,U){return U._data||(U._data={noMipMaps:9728===U.minFilter||9729===U.minFilter,samplingMode:K._GetTextureSamplingMode(N,U),wrapU:K._GetTextureWrapMode(`${N}/wrapS`,U.wrapS),wrapV:K._GetTextureWrapMode(`${N}/wrapT`,U.wrapT)}),U._data}loadImageAsync(N,U){if(!U._data){if(this.logOpen(`${N} ${U.name||""}`),U.uri)U._data=this.loadUriAsync(`${N}/uri`,U,U.uri);else{const V=g.Get(`${N}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}this.logClose()}return U._data}loadUriAsync(N,U,V){const A=this._extensionsLoadUriAsync(N,U,V);if(A)return A;if(!K._ValidateUri(V))throw new Error(`${N}: '${V}' is invalid`);if((0,e.j)(V)){const U=new Uint8Array((0,e.d)(V));return this.log(`${N}: Decoded ${V.substring(0,64)}... (${U.length} bytes)`),Promise.resolve(U)}return this.log(`${N}: Loading ${V}`),this._parent.preprocessUrlAsync(this._rootUrl+V).then((U=>new Promise(((A,t)=>{this._parent._loadFile(this._babylonScene,U,(U=>{this._disposed||(this.log(`${N}: Loaded ${V} (${U.byteLength} bytes)`),A(new Uint8Array(U)))}),!0,(U=>{t(new e.n(`${N}: Failed to load '${V}'${U?": "+U.status+" "+U.statusText:""}`,U))}))}))))}static AddPointerMetadata(N,U){N.metadata=N.metadata||{};const V=N._internalMetadata=N._internalMetadata||{},A=V.ii=V.ii||{};(A.pointers=A.pointers||[]).push(U)}static _GetTextureWrapMode(N,U){switch(U=void 0==U?10497:U){case 33071:return h.e.CLAMP_ADDRESSMODE;case 33648:return h.e.MIRROR_ADDRESSMODE;case 10497:return h.e.WRAP_ADDRESSMODE;default:return x.b.Warn(`${N}: Invalid value (${U})`),h.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(N,U){const V=void 0==U.magFilter?9729:U.magFilter,A=void 0==U.minFilter?9987:U.minFilter;if(9729===V)switch(A){case 9728:return h.e.LINEAR_NEAREST;case 9729:return h.e.LINEAR_LINEAR;case 9984:return h.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return h.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return h.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return h.e.LINEAR_LINEAR_MIPLINEAR;default:return x.b.Warn(`${N}/minFilter: Invalid value (${A})`),h.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==V&&x.b.Warn(`${N}/magFilter: Invalid value (${V})`),A){case 9728:return h.e.NEAREST_NEAREST;case 9729:return h.e.NEAREST_LINEAR;case 9984:return h.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return h.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return h.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return h.e.NEAREST_LINEAR_MIPLINEAR;default:return x.b.Warn(`${N}/minFilter: Invalid value (${A})`),h.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(N,U){try{return(0,G.p)(U)}catch(V){throw new Error(`${N}: ${V.message}`)}}static _GetTypedArray(N,U,V,A,t){const n=V.buffer;A=V.byteOffset+(A||0);const q=K._GetTypedArrayConstructor(`${N}/componentType`,U),i=H.f.GetTypeByteLength(U);return A%i!==0?(x.b.Warn(`${N}: Copying buffer as byte offset (${A}) is not a multiple of component type byte length (${i})`),new q(n.slice(A,A+t*i),0)):new q(n,A,t)}static _GetNumComponents(N,U){switch(U){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${N}: Invalid type (${U})`)}static _ValidateUri(N){return q.Tools.IsBase64(N)||-1===N.indexOf("..")}static _GetDrawMode(N,U){switch(void 0==U&&(U=4),U){case 0:return r.d.PointListDrawMode;case 1:return r.d.LineListDrawMode;case 2:return r.d.LineLoopDrawMode;case 3:return r.d.LineStripDrawMode;case 4:return r.d.TriangleFillMode;case 5:return r.d.TriangleStripDrawMode;case 6:return r.d.TriangleFanDrawMode}throw new Error(`${N}: Invalid mesh primitive mode (${U})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const N=new Array;if(this._gltf.materials)for(const U of this._gltf.materials)if(U._data)for(const V in U._data){const A=U._data[V];for(const U of A.babylonMeshes){U.xi(!0);const V=A.babylonMaterial;N.push(V.forceCompilationAsync(U)),N.push(V.forceCompilationAsync(U,{useInstances:!0})),this._parent.useClipPlane&&(N.push(V.forceCompilationAsync(U,{clipPlane:!0})),N.push(V.forceCompilationAsync(U,{clipPlane:!0,useInstances:!0})))}}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const N=new Array,U=this._babylonScene.lights;for(const V of U){const U=V.getShadowGenerator();U&&N.push(U.forceCompilationAsync())}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(N){for(const U of this._extensions)U.enabled&&N(U)}_applyExtensions(N,U,V){for(const A of this._extensions)if(A.enabled){const t=`${A.name}.${U}`,n=N;n._activeLoaderExtensionFunctions=n._activeLoaderExtensionFunctions||{};const q=n._activeLoaderExtensionFunctions;if(!q[t]){q[t]=!0;try{const N=V(A);if(N)return N}finally{delete q[t]}}}return null}_extensionsOnLoading(){this._forEachExtensions((N=>N.onLoading&&N.onLoading()))}_extensionsOnReady(){this._forEachExtensions((N=>N.onReady&&N.onReady()))}_extensionsLoadSceneAsync(N,U){return this._applyExtensions(U,"loadScene",(V=>V.loadSceneAsync&&V.loadSceneAsync(N,U)))}_extensionsLoadNodeAsync(N,U,V){return this._applyExtensions(U,"loadNode",(A=>A.loadNodeAsync&&A.loadNodeAsync(N,U,V)))}_extensionsLoadCameraAsync(N,U,V){return this._applyExtensions(U,"loadCamera",(A=>A.loadCameraAsync&&A.loadCameraAsync(N,U,V)))}_extensionsLoadVertexDataAsync(N,U,V){return this._applyExtensions(U,"loadVertexData",(A=>A._loadVertexDataAsync&&A._loadVertexDataAsync(N,U,V)))}_extensionsLoadMeshPrimitiveAsync(N,U,V,A,t,n){return this._applyExtensions(t,"loadMeshPrimitive",(q=>q._loadMeshPrimitiveAsync&&q._loadMeshPrimitiveAsync(N,U,V,A,t,n)))}_extensionsLoadMaterialAsync(N,U,V,A,t){return this._applyExtensions(U,"loadMaterial",(n=>n._loadMaterialAsync&&n._loadMaterialAsync(N,U,V,A,t)))}_extensionsCreateMaterial(N,U,V){return this._applyExtensions(U,"createMaterial",(A=>A.createMaterial&&A.createMaterial(N,U,V)))}_extensionsLoadMaterialPropertiesAsync(N,U,V){return this._applyExtensions(U,"loadMaterialProperties",(A=>A.loadMaterialPropertiesAsync&&A.loadMaterialPropertiesAsync(N,U,V)))}_extensionsLoadTextureInfoAsync(N,U,V){return this._applyExtensions(U,"loadTextureInfo",(A=>A.loadTextureInfoAsync&&A.loadTextureInfoAsync(N,U,V)))}_extensionsLoadTextureAsync(N,U,V){return this._applyExtensions(U,"loadTexture",(A=>A._loadTextureAsync&&A._loadTextureAsync(N,U,V)))}_extensionsLoadAnimationAsync(N,U){return this._applyExtensions(U,"loadAnimation",(V=>V.loadAnimationAsync&&V.loadAnimationAsync(N,U)))}_extensionsLoadAnimationChannelAsync(N,U,V,A,t){return this._applyExtensions(V,"loadAnimationChannel",(n=>n._loadAnimationChannelAsync&&n._loadAnimationChannelAsync(N,U,V,A,t)))}_extensionsLoadSkinAsync(N,U,V){return this._applyExtensions(V,"loadSkin",(A=>A._loadSkinAsync&&A._loadSkinAsync(N,U,V)))}_extensionsLoadUriAsync(N,U,V){return this._applyExtensions(U,"loadUri",(A=>A._loadUriAsync&&A._loadUriAsync(N,U,V)))}_extensionsLoadBufferViewAsync(N,U){return this._applyExtensions(U,"loadBufferView",(V=>V.loadBufferViewAsync&&V.loadBufferViewAsync(N,U)))}_extensionsLoadBufferAsync(N,U,V,A){return this._applyExtensions(U,"loadBuffer",(t=>t.loadBufferAsync&&t.loadBufferAsync(N,U,V,A)))}static LoadExtensionAsync(N,U,V,A){if(!U.extensions)return null;const t=U.extensions[V];return t?A(`${N}/extensions/${V}`,t):null}static LoadExtraAsync(N,U,V,A){if(!U.extras)return null;const t=U.extras[V];return t?A(`${N}/extras/${V}`,t):null}isExtensionUsed(N){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(N)}logOpen(N){this._parent._logOpen(N)}logClose(){this._parent._logClose()}log(N){this._parent._log(N)}startPerformanceCounter(N){this._parent._startPerformanceCounter(N)}endPerformanceCounter(N){this._parent._endPerformanceCounter(N)}}K.DefaultSampler={index:-1},X.d._CreateGLTF2Loader=N=>new K(N);var j=V(13991),F=V(12559),P=V(12413),T=V(13996),f=V(14003);class O extends f.e{constructor(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",N),this._texture=N.getEngine().createRawCubeTexture(U,V,A,t,n,q,i,z)}update(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,N,U,V,A,t)}updateRGBDAsync(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,T.j)(this._texture,N,U,V,A).then((()=>{}))}clone(){return P.d.Clone((()=>{const N=this.YN(),U=this._texture,V=new O(N,U._bufferViewArray,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression);return 13===U.source&&V.updateRGBDAsync(U._bufferViewArrayArray,U._sphericalPolynomial,U._lodGenerationScale,U._lodGenerationOffset),V}),this)}}const Z="EXT_lights_image_based";class b{constructor(N){this.name=Z,this._loader=N,this.enabled=this._loader.isExtensionUsed(Z)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.ii.extensions;if(N&&N[this.name]){const U=N[this.name];this._lights=U.lights}}loadSceneAsync(N,U){return K.LoadExtensionAsync(N,U,this.name,(async(V,A)=>{this._loader._allMaterialsDirtyRequired=!0;const t=new Array;t.push(this._loader.loadSceneAsync(N,U)),this._loader.logOpen(`${V}`);const n=g.Get(`${V}/light`,this._lights,A.en);return t.push(this._loadLightAsync(`/extensions/${this.name}/lights/${A.en}`,n).then((N=>{this._loader.babylonScene.environmentTexture=N}))),this._loader.logClose(),await Promise.all(t).then((()=>{}))}))}_loadLightAsync(N,U){if(!U._loaded){const V=new Array;this._loader.logOpen(`${N}`);const A=new Array(U.specularImages.length);for(let t=0;t<U.specularImages.length;t++){const n=U.specularImages[t];A[t]=new Array(n.length);for(let U=0;U<n.length;U++){const q=`${N}/specularImages/${t}/${U}`;this._loader.logOpen(`${q}`);const i=n[U],z=g.Get(q,this._loader.ii.images,i);V.push(this._loader.loadImageAsync(`/images/${i}`,z).then((N=>{A[t][U]=N}))),this._loader.logClose()}}this._loader.logClose(),U._loaded=Promise.all(V).then((async()=>{const V=new O(this._loader.babylonScene,null,U.specularImageSize);if(V.name=U.name||"environment",U._babylonTexture=V,void 0!=U.Mi&&(V.level=U.Mi),U.rotation){let N=t.Quaternion.vU(U.rotation);this._loader.babylonScene.useRightHandedSystem||(N=t.Quaternion.Inverse(N)),t.Matrix.FromQuaternionToRef(N,V.getReflectionTextureMatrix())}if(!U.irradianceCoefficients)throw new Error(`${N}: Irradiance coefficients are missing`);const n=F.c.vU(U.irradianceCoefficients);n.scaleInPlace(U.Mi),n.convertIrradianceToLambertianRadiance();const q=F.d.FromHarmonics(n),i=(A.length-1)/Math.log2(U.specularImageSize);return await V.updateRGBDAsync(A,q,i)}))}return U._loaded.then((()=>U._babylonTexture))}}o(Z),I(Z,!0,(N=>new b(N)));V(12914);const y="EXT_mesh_gpu_instancing";class NN{constructor(N){this.name=y,this._loader=N,this.enabled=this._loader.isExtensionUsed(y)}dispose(){this._loader=null}loadNodeAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(N,A)=>{this._loader._disableInstancedMesh++;const n=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,V);if(this._loader._disableInstancedMesh--,!U._primitiveBabylonMeshes)return await n;const q=new Array;let i=0;const z=U=>{if(void 0==A.attributes[U])return void q.push(Promise.resolve(null));const V=g.Get(`${N}/attributes/${U}`,this._loader.ii.accessors,A.attributes[U]);if(q.push(this._loader._loadFloatAccessorAsync(`/accessors/${V.bufferView}`,V)),0===i)i=V.count;else if(i!==V.count)throw new Error(`${N}/attributes: Instance buffer accessors do not have the same count.`)};return z("TRANSLATION"),z("ROTATION"),z("SCALE"),await n.then((async N=>{const[V,A,n]=await Promise.all(q),z=new Float32Array(16*i);t.TmpVectors.CU[0].hi(0,0,0),t.TmpVectors.Quaternion[0].hi(0,0,0,1),t.TmpVectors.CU[1].hi(1,1,1);for(let U=0;U<i;++U)V&&t.CU.FromArrayToRef(V,3*U,t.TmpVectors.CU[0]),A&&t.Quaternion.FromArrayToRef(A,4*U,t.TmpVectors.Quaternion[0]),n&&t.CU.FromArrayToRef(n,3*U,t.TmpVectors.CU[1]),t.Matrix.ComposeToRef(t.TmpVectors.CU[1],t.TmpVectors.Quaternion[0],t.TmpVectors.CU[0],t.TmpVectors.Matrix[0]),t.TmpVectors.Matrix[0].copyToArray(z,16*U);for(const t of U._primitiveBabylonMeshes)t.vp("matrix",z,16,!0);return N}))}))}}o(y),I(y,!0,(N=>new NN(N)));let UN=0,VN=null;class AN{static get Default(){return AN._Default||(AN._Default=new AN),AN._Default}constructor(){const N=AN.Configuration.decoder;this._decoderModulePromise=q.Tools.LoadBabylonScriptAsync(N.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(N,U,V,A,t){await this._decoderModulePromise,0===UN&&(MeshoptDecoder.useWorkers(1),UN=1);const n=await MeshoptDecoder.decodeGltfBufferAsync(U,V,N,A,t);return null!==VN&&clearTimeout(VN),VN=setTimeout((()=>{MeshoptDecoder.useWorkers(0),UN=0,VN=null}),1e3),n}}AN.Configuration={decoder:{url:`${q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},AN._Default=null;const tN="EXT_meshopt_compression";class nN{constructor(N){this.name=tN,this.enabled=N.isExtensionUsed(tN),this._loader=N}dispose(){this._loader=null}loadBufferViewAsync(N,U){return K.LoadExtensionAsync(N,U,this.name,(async(V,A)=>{const t=U;if(t._meshOptData)return await t._meshOptData;const n=g.Get(`${N}/buffer`,this._loader.ii.buffers,A.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${n.index}`,n,A.byteOffset||0,A.byteLength).then((async N=>await AN.Default.decodeGltfBufferAsync(N,A.count,A.byteStride,A.mode,A.filter))),await t._meshOptData}))}}o(tN),I(tN,!0,(N=>new nN(N)));const qN="EXT_texture_webp";class iN{constructor(N){this.name=qN,this._loader=N,this.enabled=N.isExtensionUsed(qN)}dispose(){this._loader=null}_loadTextureAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=void 0==U.sampler?K.DefaultSampler:g.Get(`${N}/sampler`,this._loader.ii.samplers,U.sampler),q=g.Get(`${A}/source`,this._loader.ii.images,t.source);return await this._loader._createTextureAsync(N,n,q,(N=>{V(N)}),void 0,!U._textureInfo.nonColorData)}))}}o(qN),I(qN,!0,(N=>new iN(N)));const zN="EXT_texture_avif";class SN{constructor(N){this.name=zN,this._loader=N,this.enabled=N.isExtensionUsed(zN)}dispose(){this._loader=null}_loadTextureAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=void 0==U.sampler?K.DefaultSampler:g.Get(`${N}/sampler`,this._loader.ii.samplers,U.sampler),q=g.Get(`${A}/source`,this._loader.ii.images,t.source);return await this._loader._createTextureAsync(N,n,q,(N=>{V(N)}),void 0,!U._textureInfo.nonColorData)}))}}o(zN),I(zN,!0,(N=>new SN(N)));var EN=V(13985),pN=V(12895);const kN="EXT_lights_ies";class BN{constructor(N){this.name=kN,this._loader=N,this.enabled=this._loader.isExtensionUsed(kN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.ii.extensions;if(N&&N[this.name]){const U=N[this.name];this._lights=U.lights,g.Assign(this._lights)}}loadNodeAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,q)=>{let i,z;this._loader._allMaterialsDirtyRequired=!0;const S=await this._loader.loadNodeAsync(N,U,(N=>{z=g.Get(A,this._lights,q.en);const U=z.name||N.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,i=new EN.e(U,t.CU.Zero(),t.CU.Backward(),0,1,this._loader.babylonScene),i.angle=Math.PI/2,i.innerAngle=0,i._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,z._babylonLight=i,i.falloffType=pN.e.FALLOFF_GLTF,i.ai=q.color?n.rU.vU(q.color):n.rU.White(),i.Mi=q.multiplier||1,i.range=Number.MAX_VALUE,i.parent=N,this._loader._babylonLights.push(i),K.AddPointerMetadata(i,A),V(N)}));let E;if(z.uri)E=await this._loader.loadUriAsync(N,z,z.uri);else{const U=g.Get(`${N}/bufferView`,this._loader.ii.bufferViews,z.bufferView);E=await this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return i.iesProfileTexture=new h.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,E,!0,void 0,void 0,void 0,void 0,".ies"),S}))}}o(kN),I(kN,!0,(N=>new BN(N)));var CN=V(14012);const xN="KHR_draco_mesh_compression";class JN{constructor(N){this.name=xN,this.useNormalizedFlagFromAccessor=!0,this._loader=N,this.enabled=CN.c.DefaultAvailable&&this._loader.isExtensionUsed(xN)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{if(void 0!=U.mode&&4!==U.mode&&5!==U.mode)throw new Error(`${N}: Unsupported mode ${U.mode}`);const n={},q={},i=(N,A)=>{const i=t.attributes[N];if(void 0!=i&&(V._delayInfo=V._delayInfo||[],-1===V._delayInfo.indexOf(A)&&V._delayInfo.push(A),n[A]=i,this.useNormalizedFlagFromAccessor)){const V=g.TryGet(this._loader.ii.accessors,U.attributes[N]);V&&(q[A]=V.normalized||!1)}};i("POSITION",H.f.PositionKind),i("NORMAL",H.f.NormalKind),i("TANGENT",H.f.TangentKind),i("TEXCOORD_0",H.f.UVKind),i("TEXCOORD_1",H.f.UV2Kind),i("TEXCOORD_2",H.f.UV3Kind),i("TEXCOORD_3",H.f.UV4Kind),i("TEXCOORD_4",H.f.UV5Kind),i("TEXCOORD_5",H.f.UV6Kind),i("JOINTS_0",H.f.MatricesIndicesKind),i("WEIGHTS_0",H.f.MatricesWeightsKind),i("COLOR_0",H.f.ColorKind);const z=g.Get(A,this._loader.ii.bufferViews,t.bufferView);return z._dracoBabylonGeometry||(z._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((async A=>{const t=this.dracoDecoder||CN.c.Default,i=g.TryGet(this._loader.ii.accessors,U.attributes.POSITION),z=this._loader.parent.alwaysComputeBoundingBox||V.skeleton||!i?null:l(i);return await t._decodeMeshToGeometryForGltfAsync(V.name,this._loader.babylonScene,A,n,q,z).catch((U=>{throw new Error(`${N}: ${U.message}`)}))}))),await z._dracoBabylonGeometry}))}}o(xN),I(xN,!0,(N=>new JN(N)));var dN=V(14018),rN=V(12367),vN=V(12369),hN=V(12764),cN=V(12942),HN=V(12344);hN.c.AddNodeConstructor("Light_Type_0",((N,U)=>()=>new YN(N,t.CU.Zero(),U)));class YN extends cN.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(N){this._shadowAngle=N,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(N){const U=this.needCube();if(this._direction=N,this.needCube()!==U&&this._shadowGenerators){const N=this._shadowGenerators.values();for(let U=N.next();!0!==U.done;U=N.next()){U.value.recreateShadowMap()}}}constructor(N,U,V){super(N,V),this._shadowAngle=Math.PI/2,this.position=U}getClassName(){return"PointLight"}getTypeID(){return pN.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(N){if(this.direction)return super.getShadowDirection(N);switch(N){case 0:return new t.CU(1,0,0);case 1:return new t.CU(-1,0,0);case 2:return new t.CU(0,-1,0);case 3:return new t.CU(0,1,0);case 4:return new t.CU(0,0,1);case 5:return new t.CU(0,0,-1)}return t.CU.Zero()}_setDefaultShadowProjectionMatrix(N,U,V){const A=this.YN().activeCamera;if(!A)return;const n=void 0!==this.shadowMinZ?this.shadowMinZ:A.Bi,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,i=this.YN().getEngine().ln;t.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,i?q:n,i?n:q,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,i)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,U){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,U):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,U),this}transferToNodeMaterialEffect(N,U){return this.computeTransformedInformation()?N.setFloat3(U,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):N.setFloat3(U,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(N,U){N["POINTLIGHT"+U]=!0}}(0,rN.b)([(0,vN.N)()],YN.prototype,"shadowAngle",null),(0,HN.e)("BABYLON.PointLight",YN);const WN="KHR_lights_punctual";class sN{constructor(N){this.name=WN,this._loader=N,this.enabled=this._loader.isExtensionUsed(WN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.ii.extensions;if(N&&N[this.name]){const U=N[this.name];this._lights=U.lights,g.Assign(this._lights)}}loadNodeAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(N,U,(N=>{let U;const i=g.Get(A,this._lights,q.en),z=i.name||N.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,i.type){case"directional":{const N=new dN.c(z,t.CU.Backward(),this._loader.babylonScene);N.position.Hi(0),U=N;break}case"point":U=new YN(z,t.CU.Zero(),this._loader.babylonScene);break;case"spot":{const N=new EN.e(z,t.CU.Zero(),t.CU.Backward(),0,1,this._loader.babylonScene);N.angle=2*(i.spot&&i.spot.outerConeAngle||Math.PI/4),N.innerAngle=2*(i.spot&&i.spot.innerConeAngle||0),U=N;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${A}: Invalid light type (${i.type})`)}U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,i._babylonLight=U,U.falloffType=pN.e.FALLOFF_GLTF,U.ai=i.color?n.rU.vU(i.color):n.rU.White(),U.Mi=void 0==i.Mi?1:i.Mi,U.range=void 0==i.range?Number.MAX_VALUE:i.range,U.parent=N,this._loader._babylonLights.push(U),K.AddPointerMetadata(U,A),V(N)})))))}}o(WN),I(WN,!0,(N=>new sN(N)));const MN="KHR_materials_pbrSpecularGlossiness";class aN{constructor(N){this.name=MN,this.order=200,this._loader=N,this.enabled=this._loader.isExtensionUsed(MN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialBasePropertiesAsync(N,U,V)),n.push(this._loadSpecularGlossinessPropertiesAsync(A,t,V)),this._loader.loadMaterialAlphaProperties(N,U,V),await Promise.all(n).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return V.metallic=null,V.roughness=null,U.diffuseFactor?(V.albedoColor=n.rU.vU(U.diffuseFactor),V.alpha=U.diffuseFactor[3]):V.albedoColor=n.rU.White(),V.reflectivityColor=U.specularFactor?n.rU.vU(U.specularFactor):n.rU.White(),V.microSurface=void 0==U.glossinessFactor?1:U.glossinessFactor,U.diffuseTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTexture`,U.diffuseTexture,(N=>{N.name=`${V.name} (Diffuse)`,V.albedoTexture=N}))),U.specularGlossinessTexture&&(A.push(this._loader.loadTextureInfoAsync(`${N}/specularGlossinessTexture`,U.specularGlossinessTexture,(N=>{N.name=`${V.name} (Specular Glossiness)`,V.reflectivityTexture=N,V.reflectivityTexture.ki=!0}))),V.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(A).then((()=>{}))}}o(MN),I(MN,!0,(N=>new aN(N)));const mU="KHR_materials_unlit";class wN{constructor(N){this.name=mU,this.order=210,this._loader=N,this.enabled=this._loader.isExtensionUsed(mU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async()=>await this._loadUnlitPropertiesAsync(N,U,V)))}_loadUnlitPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;V.unlit=!0;const t=U.pbrMetallicRoughness;return t&&(t.baseColorFactor?(V.albedoColor=n.rU.vU(t.baseColorFactor),V.alpha=t.baseColorFactor[3]):V.albedoColor=n.rU.White(),t.baseColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/baseColorTexture`,t.baseColorTexture,(N=>{N.name=`${V.name} (Base Color)`,V.albedoTexture=N})))),U.doubleSided&&(V.ri=!1,V.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(N,U,V),Promise.all(A).then((()=>{}))}}o(mU),I(mU,!0,(N=>new wN(N)));const XN="KHR_materials_clearcoat";class eN{constructor(N){this.name=XN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(XN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadClearCoatPropertiesAsync(A,t,V)),await Promise.all(n)}))}_loadClearCoatPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return V.clearCoat.isEnabled=!0,V.clearCoat.useRoughnessFromMainTexture=!1,V.clearCoat.remapF0OnInterfaceChange=!1,void 0!=U.clearcoatFactor?V.clearCoat.Mi=U.clearcoatFactor:V.clearCoat.Mi=0,U.clearcoatTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatTexture`,U.clearcoatTexture,(N=>{N.name=`${V.name} (ClearCoat)`,V.clearCoat.texture=N}))),void 0!=U.clearcoatRoughnessFactor?V.clearCoat.roughness=U.clearcoatRoughnessFactor:V.clearCoat.roughness=0,U.clearcoatRoughnessTexture&&(U.clearcoatRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatRoughnessTexture`,U.clearcoatRoughnessTexture,(N=>{N.name=`${V.name} (ClearCoat Roughness)`,V.clearCoat.textureRoughness=N})))),U.clearcoatNormalTexture&&(U.clearcoatNormalTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatNormalTexture`,U.clearcoatNormalTexture,(N=>{N.name=`${V.name} (ClearCoat Normal)`,V.clearCoat.bumpTexture=N}))),V.invertNormalMapX=!V.YN().useRightHandedSystem,V.invertNormalMapY=V.YN().useRightHandedSystem,void 0!=U.clearcoatNormalTexture.scale&&(V.clearCoat.bumpTexture.level=U.clearcoatNormalTexture.scale)),Promise.all(A).then((()=>{}))}}o(XN),I(XN,!0,(N=>new eN(N)));const QN="KHR_materials_iridescence";class uN{constructor(N){this.name=QN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(QN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadIridescencePropertiesAsync(A,t,V)),await Promise.all(n).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return V.iridescence.isEnabled=!0,V.iridescence.Mi=U.iridescenceFactor??0,V.iridescence.indexOfRefraction=U.iridescenceIor??U.iridescenceIOR??1.3,V.iridescence.minimumThickness=U.iridescenceThicknessMinimum??100,V.iridescence.maximumThickness=U.iridescenceThicknessMaximum??400,U.iridescenceTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceTexture`,U.iridescenceTexture,(N=>{N.name=`${V.name} (Iridescence)`,V.iridescence.texture=N}))),U.iridescenceThicknessTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceThicknessTexture`,U.iridescenceThicknessTexture,(N=>{N.name=`${V.name} (Iridescence Thickness)`,V.iridescence.thicknessTexture=N}))),Promise.all(A).then((()=>{}))}}o(QN),I(QN,!0,(N=>new uN(N)));const LN="KHR_materials_anisotropy";class IN{constructor(N){this.name=LN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(LN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadIridescencePropertiesAsync(A,t,V)),await Promise.all(n)}))}async _loadIridescencePropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;V.anisotropy.isEnabled=!0,V.anisotropy.Mi=U.anisotropyStrength??0,V.anisotropy.angle=U.anisotropyRotation??0,U.anisotropyTexture&&(U.anisotropyTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/anisotropyTexture`,U.anisotropyTexture,(N=>{N.name=`${V.name} (Anisotropy Intensity)`,V.anisotropy.texture=N})))),await Promise.all(A)}}o(LN),I(LN,!0,(N=>new IN(N)));const oN="KHR_materials_emissive_strength";class RN{constructor(N){this.name=oN,this.order=170,this._loader=N,this.enabled=this._loader.isExtensionUsed(oN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>await this._loader.loadMaterialPropertiesAsync(N,U,V).then((()=>{this._loadEmissiveProperties(A,t,V)}))))}_loadEmissiveProperties(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);void 0!==U.emissiveStrength&&(V.emissiveIntensity=U.emissiveStrength)}}o(oN),I(oN,!0,(N=>new RN(N)));const DN="KHR_materials_sheen";class GN{constructor(N){this.name=DN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(DN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadSheenPropertiesAsync(A,t,V)),await Promise.all(n).then((()=>{}))}))}_loadSheenPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return V.sheen.isEnabled=!0,V.sheen.Mi=1,void 0!=U.sheenColorFactor?V.sheen.color=n.rU.vU(U.sheenColorFactor):V.sheen.color=n.rU.Black(),U.sheenColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/sheenColorTexture`,U.sheenColorTexture,(N=>{N.name=`${V.name} (Sheen Color)`,V.sheen.texture=N}))),void 0!==U.sheenRoughnessFactor?V.sheen.roughness=U.sheenRoughnessFactor:V.sheen.roughness=0,U.sheenRoughnessTexture&&(U.sheenRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/sheenRoughnessTexture`,U.sheenRoughnessTexture,(N=>{N.name=`${V.name} (Sheen Roughness)`,V.sheen.textureRoughness=N})))),V.sheen.albedoScaling=!0,V.sheen.useRoughnessFromMainTexture=!1,Promise.all(A).then((()=>{}))}}o(DN),I(DN,!0,(N=>new GN(N)));var gN=V(12834);const lN="KHR_materials_specular";class KN{constructor(N){this.name=lN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(lN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;if(n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadSpecularPropertiesAsync(A,t,V)),t.extensions&&t.extensions.EXT_materials_specular_edge_color&&V instanceof v.b){t.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(V.brdf.dielectricSpecularModel=gN.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,V.brdf.conductorSpecularModel=gN.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(n).then((()=>{}))}))}_loadSpecularPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return void 0!==U.specularFactor&&(V.metallicF0Factor=U.specularFactor),void 0!==U.specularColorFactor&&(V.metallicReflectanceColor=n.rU.vU(U.specularColorFactor)),U.specularTexture&&(U.specularTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/specularTexture`,U.specularTexture,(N=>{N.name=`${V.name} (Specular)`,V.metallicReflectanceTexture=N,V.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),U.specularColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/specularColorTexture`,U.specularColorTexture,(N=>{N.name=`${V.name} (Specular Color)`,V.reflectanceTexture=N}))),Promise.all(A).then((()=>{}))}}o(lN),I(lN,!0,(N=>new KN(N)));const jN="KHR_materials_ior";class FN{constructor(N){this.name=jN,this.order=180,this._loader=N,this.enabled=this._loader.isExtensionUsed(jN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadIorPropertiesAsync(A,t,V)),await Promise.all(n).then((()=>{}))}))}_loadIorPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);return void 0!==U.ior?V.indexOfRefraction=U.ior:V.indexOfRefraction=FN._DEFAULT_IOR,Promise.resolve()}}FN._DEFAULT_IOR=1.5,o(jN),I(jN,!0,(N=>new FN(N)));const PN="KHR_materials_variants";class TN{constructor(N){this.name=PN,this._loader=N,this.enabled=this._loader.isExtensionUsed(PN)}dispose(){this._loader=null}static GetAvailableVariants(N){const U=this._GetExtensionMetadata(N);return U?Object.keys(U.variants):[]}getAvailableVariants(N){return TN.GetAvailableVariants(N)}static SelectVariant(N,U){const V=this._GetExtensionMetadata(N);if(!V)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${PN} extension`);const A=N=>{const U=V.variants[N];if(U)for(const V of U)V.mesh.material=V.material};if(U instanceof Array)for(const t of U)A(t);else A(U);V.lastSelected=U}selectVariant(N,U){TN.SelectVariant(N,U)}static Reset(N){const U=this._GetExtensionMetadata(N);if(!U)throw new Error(`Cannot reset on a glTF mesh that does not have the ${PN} extension`);for(const V of U.original)V.mesh.material=V.material;U.lastSelected=null}reset(N){TN.Reset(N)}static GetLastSelectedVariant(N){const U=this._GetExtensionMetadata(N);if(!U)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${PN} extension`);return U.lastSelected}getLastSelectedVariant(N){return TN.GetLastSelectedVariant(N)}static _GetExtensionMetadata(N){var U,V;return(null===N||void 0===N||null===(U=N._internalMetadata)||void 0===U||null===(V=U.ii)||void 0===V?void 0:V[PN])||null}onLoading(){const N=this._loader.ii.extensions;if(N&&N[this.name]){const U=N[this.name];this._variants=U.variants}}onReady(){const N=this._loader.rootBabylonMesh;if(N){var U;const V=this._loader.parent.extensionOptions[PN];null!==V&&void 0!==V&&V.defaultVariant&&TN.SelectVariant(N,V.defaultVariant),null===V||void 0===V||null===(U=V.onLoaded)||void 0===U||U.call(V,{get variants(){return TN.GetAvailableVariants(N)},get selectedVariant(){const U=TN.GetLastSelectedVariant(N);return U?Array.isArray(U)?U[0]:U:TN.GetAvailableVariants(N)[0]},set selectedVariant(U){TN.SelectVariant(N,U)}})}}_loadMeshPrimitiveAsync(N,U,V,A,t,n){return K.LoadExtensionAsync(N,t,this.name,(async(q,i)=>{const z=new Array;return z.push(this._loader._loadMeshPrimitiveAsync(N,U,V,A,t,(U=>{if(n(U),U instanceof s.b){const V=K._GetDrawMode(N,t.mode),A=this._loader.rootBabylonMesh,n=A?A._internalMetadata=A._internalMetadata||{}:{},S=n.ii=n.ii||{},E=S[PN]=S[PN]||{lastSelected:null,original:[],variants:{}};E.original.push({mesh:U,material:U.material});for(let N=0;N<i.mappings.length;++N){const t=i.mappings[N],n=g.Get(`${q}/mappings/${N}/material`,this._loader.ii.materials,t.material);z.push(this._loader._loadMaterialAsync(`#/materials/${t.material}`,n,U,V,(N=>{for(let V=0;V<t.variants.length;++V){const n=t.variants[V],q=g.Get(`/extensions/${PN}/variants/${n}`,this._variants,n);E.variants[q.name]=E.variants[q.name]||[],E.variants[q.name].push({mesh:U,material:N}),U.onClonedObservable.add((N=>{const V=N;let t=null,n=V;do{if(n=n.parent,!n)return;t=TN._GetExtensionMetadata(n)}while(null===t);if(A&&t===TN._GetExtensionMetadata(A)){n._internalMetadata={};for(const N in A._internalMetadata)n._internalMetadata[N]=A._internalMetadata[N];n._internalMetadata.ii=[];for(const N in A._internalMetadata.ii)n._internalMetadata.ii[N]=A._internalMetadata.ii[N];n._internalMetadata.ii[PN]={lastSelected:null,original:[],variants:{}};for(const N of t.original)n._internalMetadata.ii[PN].original.push({mesh:N.mesh,material:N.material});for(const N in t.variants)if(Object.prototype.hasOwnProperty.call(t.variants,N)){n._internalMetadata.ii[PN].variants[N]=[];for(const U of t.variants[N])n._internalMetadata.ii[PN].variants[N].push({mesh:U.mesh,material:U.material})}t=n._internalMetadata.ii[PN]}for(const A of t.original)A.mesh===U&&(A.mesh=V);for(const A of t.variants[q.name])A.mesh===U&&(A.mesh=V)}))}})))}}}))),await Promise.all(z).then((N=>{let[U]=N;return U}))}))}}o(PN),I(PN,!0,(N=>new TN(N)));var fN=V(12445);class ON{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:gN.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(N,U){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...ON._GetDefaultOptions(),...N},this._scene=U,this._scene._transmissionHelper=this,this.onErrorObservable=new E.d,this._scene.Ai.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(N){if(!Object.keys(N).filter((U=>this._options[U]!==N[U])).length)return;const U={...this._options,...N},V=this._options;this._options=U,U.renderSize===V.renderSize&&U.renderTargetTextureType===V.renderTargetTextureType&&U.generateMipmaps===V.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=U.samples,this._opaqueRenderTarget.lodGenerationScale=U.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=U.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(N){return!!N&&!!(N instanceof v.b&&N.subSurface.isRefractionEnabled)}_addMesh(N){this._materialObservers[N.uniqueId]=N.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(N.material)?(N.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(N)&&this._transparentMeshesCache.push(N)):-1===this._opaqueMeshesCache.indexOf(N)&&this._opaqueMeshesCache.push(N)}))}_removeMesh(N){N.onMaterialChangedObservable.remove(this._materialObservers[N.uniqueId]),delete this._materialObservers[N.uniqueId];let U=this._transparentMeshesCache.indexOf(N);-1!==U&&this._transparentMeshesCache.splice(U,1),U=this._opaqueMeshesCache.indexOf(N),-1!==U&&this._opaqueMeshesCache.splice(U,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(N){const U=this._transparentMeshesCache.indexOf(N),V=this._opaqueMeshesCache.indexOf(N);this._shouldRenderAsTransmission(N.material)?(N.material instanceof v.b&&(N.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==V?(this._opaqueMeshesCache.splice(V,1),this._transparentMeshesCache.push(N)):-1===U&&this._transparentMeshesCache.push(N)):-1!==U?(this._transparentMeshesCache.splice(U,1),this._opaqueMeshesCache.push(N)):-1===V&&this._opaqueMeshesCache.push(N)}_isRenderTargetValid(){var N;return null!==(null===(N=this._opaqueRenderTarget)||void 0===N?void 0:N.getInternalTexture())}_setupRenderTargets(){var N;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new fN.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(N=this._options.clearColor)||void 0===N?void 0:N.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((N=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?N.clearColor.A(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(N.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const V of this._transparentMeshesCache)this._shouldRenderAsTransmission(V.material)&&(V.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ZN="KHR_materials_transmission";class bN{constructor(N){this.name=ZN,this.order=175,this._loader=N,this.enabled=this._loader.isExtensionUsed(ZN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadTransparentPropertiesAsync(A,U,V,t)),await Promise.all(n).then((()=>{}))}))}_loadTransparentPropertiesAsync(N,U,V,A){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const t=V;if(t.subSurface.isRefractionEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.useAlbedoToTintRefraction=!0,void 0===A.transmissionFactor)return t.subSurface.refractionIntensity=0,t.subSurface.isRefractionEnabled=!1,Promise.resolve();{var n;t.subSurface.refractionIntensity=A.transmissionFactor;const N=t.YN();if(t.subSurface.refractionIntensity&&!N._transmissionHelper)new ON({},t.YN());else if(t.subSurface.refractionIntensity&&(null===(n=N._transmissionHelper)||void 0===n||!n._isRenderTargetValid())){var q;null===(q=N._transmissionHelper)||void 0===q||q._setupRenderTargets()}}return t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,A.transmissionTexture?(A.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/transmissionTexture`,A.transmissionTexture,void 0).then((N=>{N.name=`${V.name} (Transmission)`,t.subSurface.refractionIntensityTexture=N,t.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(ZN),I(ZN,!0,(N=>new bN(N)));const yN="KHR_materials_diffuse_transmission";class NU{constructor(N){this.name=yN,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(yN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadTranslucentPropertiesAsync(A,U,V,t)),await Promise.all(n).then((()=>{}))}))}_loadTranslucentPropertiesAsync(N,U,V,A){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const t=V;if(t.subSurface.isTranslucencyEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,t.subSurface.useAlbedoToTintTranslucency=!1,void 0===A.diffuseTransmissionFactor)return t.subSurface.translucencyIntensity=0,t.subSurface.isTranslucencyEnabled=!1,Promise.resolve();t.subSurface.translucencyIntensity=A.diffuseTransmissionFactor;const q=new Array;return t.subSurface.useGltfStyleTextures=!0,A.diffuseTransmissionTexture&&(A.diffuseTransmissionTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionTexture`,A.diffuseTransmissionTexture).then((N=>{N.name=`${V.name} (Diffuse Transmission)`,t.subSurface.translucencyIntensityTexture=N})))),void 0!==A.diffuseTransmissionColorFactor?t.subSurface.translucencyColor=n.rU.vU(A.diffuseTransmissionColorFactor):t.subSurface.translucencyColor=n.rU.White(),A.diffuseTransmissionColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionColorTexture`,A.diffuseTransmissionColorTexture).then((N=>{N.name=`${V.name} (Diffuse Transmission Color)`,t.subSurface.translucencyColorTexture=N}))),Promise.all(q).then((()=>{}))}}o(yN),I(yN,!0,(N=>new NU(N)));const UU="KHR_materials_volume";class VU{constructor(N){this.name=UU,this.order=173,this._loader=N,this.enabled=this._loader.isExtensionUsed(UU),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadVolumePropertiesAsync(A,U,V,t)),await Promise.all(n).then((()=>{}))}))}_loadVolumePropertiesAsync(N,U,V,A){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);if(!V.subSurface.isRefractionEnabled&&!V.subSurface.isTranslucencyEnabled||!A.thicknessFactor)return Promise.resolve();V.subSurface.volumeIndexOfRefraction=V.indexOfRefraction;const t=void 0!==A.attenuationDistance?A.attenuationDistance:Number.MAX_VALUE;return V.subSurface.tintColorAtDistance=t,void 0!==A.attenuationColor&&3==A.attenuationColor.length&&V.subSurface.tintColor.hi(A.attenuationColor[0],A.attenuationColor[1],A.attenuationColor[2]),V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=A.thicknessFactor,V.subSurface.useThicknessAsDepth=!0,A.thicknessTexture?(A.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/thicknessTexture`,A.thicknessTexture).then((N=>{N.name=`${V.name} (Thickness)`,V.subSurface.thicknessTexture=N,V.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(UU),I(UU,!0,(N=>new VU(N)));const AU="KHR_materials_dispersion";class tU{constructor(N){this.name=AU,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(AU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadDispersionPropertiesAsync(A,U,V,t)),await Promise.all(n).then((()=>{}))}))}_loadDispersionPropertiesAsync(N,U,V,A){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);return V.subSurface.isRefractionEnabled&&A.dispersion?(V.subSurface.isDispersionEnabled=!0,V.subSurface.dispersion=A.dispersion,Promise.resolve()):Promise.resolve()}}o(AU),I(AU,!0,(N=>new tU(N)));const nU="EXT_materials_diffuse_roughness";class qU{constructor(N){this.name=nU,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(nU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(N,U,V)),n.push(this._loadDiffuseRoughnessPropertiesAsync(A,t,V)),await Promise.all(n).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(N,U,V){if(!(V instanceof v.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return V.brdf.baseDiffuseModel=gN.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=U.diffuseRoughnessFactor?V.baseDiffuseRoughness=U.diffuseRoughnessFactor:V.baseDiffuseRoughness=0,U.diffuseRoughnessTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/diffuseRoughnessTexture`,U.diffuseRoughnessTexture,(N=>{N.name=`${V.name} (Diffuse Roughness)`,V.baseDiffuseRoughnessTexture=N}))),Promise.all(A).then((()=>{}))}}o(nU),I(nU,!0,(N=>new qU(N)));const iU="KHR_mesh_quantization";class zU{constructor(N){this.name=iU,this.enabled=N.isExtensionUsed(iU)}dispose(){}}o(iU),I(iU,!0,(N=>new zU(N)));const SU="KHR_texture_basisu";class EU{constructor(N){this.name=SU,this._loader=N,this.enabled=N.isExtensionUsed(SU)}dispose(){this._loader=null}_loadTextureAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>{const n=void 0==U.sampler?K.DefaultSampler:g.Get(`${N}/sampler`,this._loader.ii.samplers,U.sampler),q=g.Get(`${A}/source`,this._loader.ii.images,t.source);return await this._loader._createTextureAsync(N,n,q,(N=>{V(N)}),U._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!U._textureInfo.nonColorData)}))}}o(SU),I(SU,!0,(N=>new EU(N)));const pU="KHR_texture_transform";class kU{constructor(N){this.name=pU,this._loader=N,this.enabled=this._loader.isExtensionUsed(pU)}dispose(){this._loader=null}loadTextureInfoAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(A,t)=>await this._loader.loadTextureInfoAsync(N,U,(N=>{if(!(N instanceof h.e))throw new Error(`${A}: Texture type not supported`);t.offset&&(N.uOffset=t.offset[0],N.vOffset=t.offset[1]),N.uRotationCenter=0,N.vRotationCenter=0,t.rotation&&(N.wAng=-t.rotation),t.scale&&(N.uScale=t.scale[0],N.vScale=t.scale[1]),void 0!=t.texCoord&&(N.coordinatesIndex=t.texCoord),V(N)}))))}}o(pU),I(pU,!0,(N=>new kU(N)));const BU="KHR_xmp_json_ld";class CU{constructor(N){this.name=BU,this.order=100,this._loader=N,this.enabled=this._loader.isExtensionUsed(BU)}dispose(){this._loader=null}onLoading(){var N,U,V;if(null===this._loader.rootBabylonMesh)return;const A=null===(N=this._loader.ii.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld,t=null===(U=this._loader.ii.asset)||void 0===U||null===(V=U.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld;if(A&&t){const N=+t.packet;A.packets&&N<A.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=A.packets[N])}}}function xU(N,U,V,A){return n.rU.vU(U,V).scale(A)}function JU(N,U,V,A){return U[V]*A}function dU(N,U,V,A){return-U[V]*A}function rU(N,U,V,A){return U[V+1]*A}function vU(N,U,V,A){return U[V]*A*2}function hU(N){return{scale:[new HU(k.e.ANIMATIONTYPE_FLOAT,`${N}.uScale`,JU,(()=>2)),new HU(k.e.ANIMATIONTYPE_FLOAT,`${N}.vScale`,rU,(()=>2))],offset:[new HU(k.e.ANIMATIONTYPE_FLOAT,`${N}.uOffset`,JU,(()=>2)),new HU(k.e.ANIMATIONTYPE_FLOAT,`${N}.vOffset`,rU,(()=>2))],rotation:[new HU(k.e.ANIMATIONTYPE_FLOAT,`${N}.wAng`,dU,(()=>1))]}}o(BU),I(BU,!0,(N=>new CU(N)));class cU extends j.AnimationPropertyInfo{buildAnimations(N,U,V,A){return[{babylonAnimatable:N._babylonCamera,babylonAnimation:this._buildAnimation(U,V,A)}]}}class HU extends j.AnimationPropertyInfo{buildAnimations(N,U,V,A){const t=[];for(const n in N._data)t.push({babylonAnimatable:N._data[n].babylonMaterial,babylonAnimation:this._buildAnimation(U,V,A)});return t}}class YU extends j.AnimationPropertyInfo{buildAnimations(N,U,V,A){return[{babylonAnimatable:N._babylonLight,babylonAnimation:this._buildAnimation(U,V,A)}]}}(0,R.j)("/cameras/{}/orthographic/xmag",[new cU(k.e.ANIMATIONTYPE_FLOAT,"orthoLeft",dU,(()=>1)),new cU(k.e.ANIMATIONTYPE_FLOAT,"orthoRight",rU,(()=>1))]),(0,R.j)("/cameras/{}/orthographic/ymag",[new cU(k.e.ANIMATIONTYPE_FLOAT,"orthoBottom",dU,(()=>1)),new cU(k.e.ANIMATIONTYPE_FLOAT,"orthoTop",rU,(()=>1))]),(0,R.j)("/cameras/{}/orthographic/zfar",[new cU(k.e.ANIMATIONTYPE_FLOAT,"maxZ",JU,(()=>1))]),(0,R.j)("/cameras/{}/orthographic/znear",[new cU(k.e.ANIMATIONTYPE_FLOAT,"Bi",JU,(()=>1))]),(0,R.j)("/cameras/{}/perspective/yfov",[new cU(k.e.ANIMATIONTYPE_FLOAT,"fov",JU,(()=>1))]),(0,R.j)("/cameras/{}/perspective/zfar",[new cU(k.e.ANIMATIONTYPE_FLOAT,"maxZ",JU,(()=>1))]),(0,R.j)("/cameras/{}/perspective/znear",[new cU(k.e.ANIMATIONTYPE_FLOAT,"Bi",JU,(()=>1))]),(0,R.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new HU(k.e.ANIMATIONTYPE_COLOR3,"albedoColor",xU,(()=>4)),new HU(k.e.ANIMATIONTYPE_FLOAT,"alpha",(function(N,U,V,A){return U[V+3]*A}),(()=>4))]),(0,R.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"metallic",JU,(()=>1))]),(0,R.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"roughness",JU,(()=>1))]);const WU=hU("albedoTexture");(0,R.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",WU.scale),(0,R.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",WU.offset),(0,R.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",WU.rotation);const sU=hU("metallicTexture");(0,R.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",sU.scale),(0,R.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",sU.offset),(0,R.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",sU.rotation),(0,R.j)("/materials/{}/emissiveFactor",[new HU(k.e.ANIMATIONTYPE_COLOR3,"emissiveColor",xU,(()=>3))]);const MU=hU("bumpTexture");(0,R.j)("/materials/{}/normalTexture/scale",[new HU(k.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",JU,(()=>1))]),(0,R.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",MU.scale),(0,R.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",MU.offset),(0,R.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",MU.rotation),(0,R.j)("/materials/{}/occlusionTexture/strength",[new HU(k.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",JU,(()=>1))]);const aU=hU("ambientTexture");(0,R.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",aU.scale),(0,R.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",aU.offset),(0,R.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",aU.rotation);const mV=hU("emissiveTexture");(0,R.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",mV.scale),(0,R.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",mV.offset),(0,R.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",mV.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new HU(k.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new HU(k.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",JU,(()=>1))]);const wU=hU("anisotropy.texture");(0,R.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",wU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",wU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",wU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",JU,(()=>1))]);const XU=hU("clearCoat.texture");(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",XU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",XU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",XU.rotation);const eU=hU("clearCoat.bumpTexture");(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new HU(k.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",eU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",eU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",eU.rotation);const QU=hU("clearCoat.textureRoughness");(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",QU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",QU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",QU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new HU(k.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new HU(k.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new HU(k.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new HU(k.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",JU,(()=>1))]);const uU=hU("iridescence.texture");(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",uU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",uU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",uU.rotation);const LU=hU("iridescence.thicknessTexture");(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",LU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",LU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",LU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new HU(k.e.ANIMATIONTYPE_COLOR3,"sheen.color",xU,(()=>3))]),(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",JU,(()=>1))]);const IU=hU("sheen.texture");(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",IU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",IU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",IU.rotation);const oU=hU("sheen.textureRoughness");(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",oU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",oU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",oU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new HU(k.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",xU,(()=>3))]);const RU=hU("metallicReflectanceTexture");(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",RU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",RU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",RU.rotation);const DU=hU("reflectanceTexture");(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",DU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",DU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",DU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",JU,(()=>1))]);const GU=hU("subSurface.refractionIntensityTexture");(0,R.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",GU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",GU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",GU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new HU(k.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",xU,(()=>3))]),(0,R.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new HU(k.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",JU,(()=>1))]),(0,R.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",JU,(()=>1))]);const gU=hU("subSurface.thicknessTexture");(0,R.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",gU.scale),(0,R.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",gU.offset),(0,R.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",gU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new HU(k.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",JU,(()=>1))]);const lU=hU("subSurface.translucencyIntensityTexture");(0,R.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",lU.scale),(0,R.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",lU.offset),(0,R.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",lU.rotation),(0,R.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new HU(k.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",xU,(()=>3))]);const KU=hU("subSurface.translucencyColorTexture");(0,R.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",KU.scale),(0,R.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",KU.offset),(0,R.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",KU.rotation),(0,R.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new YU(k.e.ANIMATIONTYPE_COLOR3,"diffuse",xU,(()=>3))]),(0,R.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new YU(k.e.ANIMATIONTYPE_FLOAT,"intensity",JU,(()=>1))]),(0,R.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new YU(k.e.ANIMATIONTYPE_FLOAT,"range",JU,(()=>1))]),(0,R.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new YU(k.e.ANIMATIONTYPE_FLOAT,"innerAngle",vU,(()=>1))]),(0,R.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new YU(k.e.ANIMATIONTYPE_FLOAT,"angle",vU,(()=>1))]),(0,R.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new YU(k.e.ANIMATIONTYPE_COLOR3,"diffuse",xU,(()=>3))]),(0,R.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new YU(k.e.ANIMATIONTYPE_FLOAT,"intensity",JU,(()=>1))]);const jU="KHR_animation_pointer";class FU{constructor(N){this.name=jU,this._loader=N,this._pathToObjectConverter=(0,R.g)(this._loader.ii)}get enabled(){return this._loader.isExtensionUsed(jU)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(N,U,V,A,t){var n;const q=null===(n=A.target.extensions)||void 0===n?void 0:n.KHR_animation_pointer;if(!q||!this._pathToObjectConverter)return null;"pointer"!==A.target.path&&x.b.Warn(`${N}/target/path: Value (${A.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=A.target.node&&x.b.Warn(`${N}/target/node: Value (${A.target.node}) must not be present when using the ${this.name} extension`);const i=`${N}/extensions/${this.name}`,z=q.pointer;if(!z)throw new Error(`${i}: Pointer is missing`);try{const n=this._pathToObjectConverter.convert(z);if(!n.info.interpolation)throw new Error(`${i}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(N,U,V,A,{object:n.object,info:n.info.interpolation},t)}catch(S){return x.b.Warn(`${i}/pointer: Invalid pointer (${z}) skipped`),null}}}o(jU),I(jU,!0,(N=>new FU(N)));class PU{constructor(N,U,V){this.frame=N,this.action=U,this.onlyOnce=V,this.isDone=!1}_clone(){return new PU(this.frame,this.action,this.onlyOnce)}}var TU=V(12209),fU=V(12272),OU=V(12264);class ZU{get loop(){return this._loop}set loop(N){N!==this._loop&&(this._loop=N,this.updateOptions({loop:N}))}get currentTime(){var N;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(N=fU.c.audioEngine)&&void 0!==N&&N.audioContext&&(this.isPlaying||this.isPaused)){const N=this.isPaused?0:fU.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+N}return 0}get spatialSound(){return this._spatialSound}set spatialSound(N){if(N==this._spatialSound)return;const U=this.isPlaying;this.pause(),N?(this._spatialSound=N,this._updateSpatialParameters()):this._disableSpatialSound(),U&&this.play()}constructor(N,U,V){var A;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new E.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=t.CU.Zero(),this._localDirection=new t.CU(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=N,V=V||C.e.LastCreatedScene)if(this._scene=V,ZU._SceneComponentInitialization(V),this._readyToPlayCallback=n,this._customAttenuationFunction=(N,U,V,A,t)=>U<V?N*(1-U/V):0,i&&(this.autoplay=i.autoplay||!1,this._loop=i.loop||!1,void 0!==i.volume&&(this._volume=i.volume),this._spatialSound=i.spatialSound??!1,this.maxDistance=i.maxDistance??100,this.useCustomAttenuation=i.useCustomAttenuation??!1,this.rolloffFactor=i.rolloffFactor||1,this.refDistance=i.refDistance||1,this.distanceModel=i.distanceModel||"linear",this._playbackRate=i.playbackRate||1,this._streaming=i.streaming??!1,this._length=i.length,this._offset=i.offset),null!==(A=fU.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&fU.c.audioEngine.audioContext){this._soundGain=fU.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let N=!0;if(U)try{"string"===typeof U?(this._urlType="String",this._url=U):U instanceof ArrayBuffer?this._urlType="ArrayBuffer":U instanceof HTMLMediaElement?this._urlType="MediaElement":U instanceof MediaStream?this._urlType="MediaStream":U instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(U)&&(this._urlType="Array");let V=[],A=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=fU.c.audioEngine.audioContext.createMediaElementSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=fU.c.audioEngine.audioContext.createMediaStreamSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":U.byteLength>0&&(A=!0,this._soundLoaded(U));break;case"AudioBuffer":this._audioBufferLoaded(U);break;case"String":V.push(U);case"Array":0===V.length&&(V=U);for(let N=0;N<V.length;N++){const U=V[N];if(A=i&&i.skipCodecCheck||-1!==U.indexOf(".mp3",U.length-4)&&fU.c.audioEngine.isMP3supported||-1!==U.indexOf(".ogg",U.length-4)&&fU.c.audioEngine.isOGGsupported||-1!==U.indexOf(".wav",U.length-4)||-1!==U.indexOf(".m4a",U.length-4)||-1!==U.indexOf(".mp4",U.length-4)||-1!==U.indexOf("blob:"),A){this._streaming?(this._htmlAudioElement=new Audio(U),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,q.Tools.SetCorsBehavior(U,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(U,(N=>{this._soundLoaded(N)}),void 0,!0,!0,(N=>{N&&x.b.Error("XHR "+N.status+" error on: "+U+"."),x.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:N=!1}N?A||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):x.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(z){x.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),fU.c.audioEngine&&!fU.c.audioEngine.WarnedWebAudioUnsupported&&(x.b.Error("Web Audio is not supported by your browser."),fU.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var N;null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(N){var U;null!==(U=fU.c.audioEngine)&&void 0!==U&&U.audioContext&&(this._audioBuffer=N,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(N){var U;null!==(U=fU.c.audioEngine)&&void 0!==U&&U.audioContext&&fU.c.audioEngine.audioContext.decodeAudioData(N,(N=>{this._audioBufferLoaded(N)}),(N=>{x.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+N)}))}setAudioBuffer(N){var U;null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this._audioBuffer=N,this._isReadyToPlay=!0)}updateOptions(N){N&&(this.loop=N.loop??this.loop,this.maxDistance=N.maxDistance??this.maxDistance,this.useCustomAttenuation=N.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=N.rolloffFactor??this.rolloffFactor,this.refDistance=N.refDistance??this.refDistance,this.distanceModel=N.distanceModel??this.distanceModel,this._playbackRate=N.playbackRate??this._playbackRate,this._length=N.length??void 0,this.spatialSound=N.spatialSound??this._spatialSound,this._setOffset(N.offset??void 0),this.setVolume(N.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var N;null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&fU.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??fU.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var N;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(N=this._soundPanner)||void 0===N||N.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var N;null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(N){var U;null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(N),this._isOutputConnected=!0)}setDirectionalCone(N,U,V){U<N?x.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=N,this._coneOuterAngle=U,this._coneOuterGain=V,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!=this._coneInnerAngle){var U;if(this._coneOuterAngle<N)return void x.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N,null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!=this._coneOuterAngle){var U;if(N<this._coneInnerAngle)return void x.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N,null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(N){var U;N.equals(this._position)||(this._position.A(N),null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(N){var U;this._localDirection=N,null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const N=this._connectedTransformNode.getWorldMatrix(),U=t.CU.TransformNormal(this._localDirection,N);U.normalize(),this._soundPanner.orientationX.value=U.x,this._soundPanner.orientationY.value=U.y,this._soundPanner.orientationZ.value=U.z}updateDistanceFromListener(){var N;if(null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const N=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.xU(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,N,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(N){this._customAttenuationFunction=N}play(N,U,V){var A;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(A=fU.c.audioEngine)&&void 0!==A&&A.audioContext)try{var t,n;this._clearTimeoutsAndObservers();let A=N?(null===(t=fU.c.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+N:null===(n=fU.c.audioEngine)||void 0===n?void 0:n.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=fU.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const N=()=>{var V;if(null!==(V=fU.c.audioEngine)&&void 0!==V&&V.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=U??0;const V=this._htmlAudioElement.play();void 0!==V&&V.catch((()=>{var U,V;(null===(U=fU.c.audioEngine)||void 0===U||U.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(V=fU.c.audioEngine)||void 0===V?void 0:V.onAudioUnlockedObservable.addOnce((()=>{N()})))}))}else{var A;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(A=fU.c.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{N()}))}};N()}}else{var q;const t=()=>{var t;if(null!==(t=fU.c.audioEngine)&&void 0!==t&&t.audioContext){var n;if(V=V||this._length,void 0!==U&&this._setOffset(U),this._soundSource){const N=this._soundSource;N.onended=()=>{N.disconnect()}}if(this._soundSource=null===(n=fU.c.audioEngine)||void 0===n?void 0:n.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==U&&(this._soundSource.loopStart=U),void 0!==V&&(this._soundSource.loopEnd=(0|U)+V),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},A=N?(null===(q=fU.c.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+N:fU.c.audioEngine.audioContext.currentTime;const t=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(A,t,this.loop?void 0:V)}}};"suspended"===(null===(q=fU.c.audioEngine)||void 0===q?void 0:q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var N;"suspended"===(null===(N=fU.c.audioEngine)||void 0===N?void 0:N.audioContext.state)?(fU.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=fU.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{t()})))):t()}),500):t()}this._startTime=A,this.isPlaying=!0,this.isPaused=!1}catch(i){x.b.Error("Error while trying to play audio: "+this.name+", "+i.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(N){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var V;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(V=this._streamingSource)||void 0===V||V.disconnect();this.isPlaying=!1}else if(null!==(U=fU.c.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource){const U=N?fU.c.audioEngine.audioContext.currentTime+N:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(U)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var N;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(N=fU.c.audioEngine)&&void 0!==N&&N.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=fU.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(N,U){var V;null!==(V=fU.c.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._soundGain&&(U&&fU.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(fU.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,fU.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(N,fU.c.audioEngine.audioContext.currentTime+U)):this._soundGain.gain.value=N),this._volume=N}setPlaybackRate(N){this._playbackRate=N,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(N){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=N,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=N=>this._onRegisterAfterWorldMatrixUpdate(N),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(N){var U;if(N.getBoundingInfo){const U=N.getBoundingInfo();this.setPosition(U.boundingSphere.centerWorld)}else this.setPosition(N.absolutePosition);null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const N=()=>{(0,OU.f)((()=>this._isReadyToPlay),(()=>{V._audioBuffer=this.getAudioBuffer(),V._isReadyToPlay=!0,V.autoplay&&V.play(0,this._offset,this._length)}),void 0,300)},U={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},V=new ZU(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,U);return this.useCustomAttenuation&&V.setAttenuationFunction(this._customAttenuationFunction),V.setPosition(this._position),V.setPlaybackRate(this._playbackRate),N(),V}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const N={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(N.connectedMeshId=this._connectedTransformNode.id),N.position=this._position.pi(),N.refDistance=this.refDistance,N.distanceModel=this.distanceModel,N.isDirectional=this._isDirectional,N.localDirectionToMesh=this._localDirection.pi(),N.coneInnerAngle=this._coneInnerAngle,N.coneOuterAngle=this._coneOuterAngle,N.coneOuterGain=this._coneOuterGain),N}static Parse(N,U,V,A){const n=N.name;let q;q=N.url?V+N.url:V+n;const i={autoplay:N.autoplay,loop:N.loop,volume:N.volume,spatialSound:N.spatialSound,maxDistance:N.maxDistance,rolloffFactor:N.rolloffFactor,refDistance:N.refDistance,distanceModel:N.distanceModel,playbackRate:N.playbackRate};let z;if(A){const N=()=>{(0,OU.f)((()=>A._isReadyToPlay),(()=>{z._audioBuffer=A.getAudioBuffer(),z._isReadyToPlay=!0,z.autoplay&&z.play(0,z._offset,z._length)}),void 0,300)};z=new ZU(n,new ArrayBuffer(0),U,null,i),N()}else z=new ZU(n,q,U,(()=>{U.removePendingData(z)}),i),U.addPendingData(z);if(N.position){const U=t.CU.vU(N.position);z.setPosition(U)}if(N.isDirectional&&(z.setDirectionalCone(N.coneInnerAngle||360,N.coneOuterAngle||360,N.coneOuterGain||0),N.localDirectionToMesh)){const U=t.CU.vU(N.localDirectionToMesh);z.setLocalDirectionToMesh(U)}if(N.connectedMeshId){const V=U.getMeshById(N.connectedMeshId);V&&z.attachToMesh(V)}return N.metadata&&(z.metadata=N.metadata),z}_setOffset(N){this._offset!==N&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=N)}_clearTimeoutsAndObservers(){var N;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(N=fU.c.audioEngine)||void 0===N||N.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}ZU._SceneComponentInitialization=N=>{throw(0,TU.d)("AudioSceneComponent")},(0,HN.e)("BABYLON.Sound",ZU);class bU{constructor(N,U,V){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],U.length!==V.length)throw new Error("Sounds length does not equal weights length");this.loop=N,this._weights=V;let A=0;for(const n of V)A+=n;const t=A>0?1/A:0;for(let n=0;n<this._weights.length;n++)this._weights[n]*=t;this._sounds=U;for(const n of this._sounds)n.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!==this._coneInnerAngle){if(this._coneOuterAngle<N)return void x.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N;for(const U of this._sounds)U.directionalConeInnerAngle=N}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!==this._coneOuterAngle){if(N<this._coneInnerAngle)return void x.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N;for(const U of this._sounds)U.directionalConeOuterAngle=N}}get volume(){return this._volume}set volume(N){if(N!==this._volume)for(const U of this._sounds)U.setVolume(N)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(N){if(!this.isPaused){this.stop();const N=Math.random();let U=0;for(let V=0;V<this._weights.length;V++)if(U+=this._weights[V],N<=U){this._currentIndex=V;break}}const U=this._sounds[this._currentIndex??0];U.isReady()?U.play(0,this.isPaused?void 0:N):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class yU{constructor(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(N=N||C.e.LastCreatedScene)&&(this._scene=N,this.soundCollection=[],this._options=U,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var N;null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&fU.c.audioEngine.audioContext&&(this._outputAudioNode=fU.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(fU.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(fU.c.audioEngine&&fU.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(N){var U;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&N.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==N.soundTrackId&&(-1===N.soundTrackId?this._scene.mainSoundTrack.removeSound(N):this._scene.soundTracks&&this._scene.soundTracks[N.soundTrackId].removeSound(N)),this.soundCollection.push(N),N.soundTrackId=this.id}removeSound(N){const U=this.soundCollection.indexOf(N);-1!==U&&this.soundCollection.splice(U,1)}setVolume(N){var U;null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=N)}switchPanningModelToHRTF(){var N;if(null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var N;if(null!==(N=fU.c.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToEqualPower()}connectToAnalyser(N){var U;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=N,null!==(U=fU.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,fU.c.audioEngine.masterGain))}}var NV=V(12620),UV=V(12601),VV=V(12188);fU.c.AudioEngineFactory=(N,U,V)=>new AV(N,U,V);class AV{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new E.d,this.onAudioLockedObservable=new E.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,VV.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const A=document.createElement("audio");this._hostElement=N,this._audioContext=U,this._audioDestination=V;try{A&&A.canPlayType&&(A.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||A.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{A&&A.canPlayType&&A.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){var N,U;if("running"===(null===(N=this._audioContext)||void 0===N?void 0:N.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(U=this._audioContext)||void 0===U||U.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{x.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var N;null===(N=this._audioContext)||void 0===N||N.addEventListener("statechange",(()=>{var N;this.unlocked&&"running"!==(null===(N=this._audioContext)||void 0===N?void 0:N.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var N;return null!==(N=this._audioContext)&&void 0!==N&&N.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(N){this.canUseWebAudio=!1,x.b.Error("Web Audio: "+N.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(N){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const N=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",U=document.createElement("style");U.appendChild(document.createTextNode(N)),document.getElementsByTagName("head")[0].appendChild(U),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var N;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(N=this._audioContext)||void 0===N||N.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(N){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=N)}connectToAnalyser(N){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=N,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var tV=V(12200);(0,V(13721).d)(NV.e.NAME_AUDIO,((N,U,V,A)=>{let t,n=[];if(V.Qk=V.Qk||[],void 0!==N.Qk&&null!==N.Qk)for(let i=0,z=N.Qk.length;i<z;i++){var q;const z=N.Qk[i];null!==(q=fU.c.audioEngine)&&void 0!==q&&q.canUseWebAudio?(z.url||(z.url=z.name),n[z.url]?V.Qk.push(ZU.Parse(z,U,A,n[z.url])):(t=ZU.Parse(z,U,A),n[z.url]=t,V.Qk.push(t))):V.Qk.push(new ZU(z.name,null,U))}n=[]})),Object.defineProperty(UV.e.prototype,"mainSoundTrack",{get:function(){let N=this._getComponent(NV.e.NAME_AUDIO);return N||(N=new nV(this),this.o(N)),this._mainSoundTrack||(this._mainSoundTrack=new yU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),UV.e.prototype.getSoundByName=function(N){let U;for(U=0;U<this.mainSoundTrack.soundCollection.length;U++)if(this.mainSoundTrack.soundCollection[U].name===N)return this.mainSoundTrack.soundCollection[U];if(this.soundTracks)for(let V=0;V<this.soundTracks.length;V++)for(U=0;U<this.soundTracks[V].soundCollection.length;U++)if(this.soundTracks[V].soundCollection[U].name===N)return this.soundTracks[V].soundCollection[U];return null},Object.defineProperty(UV.e.prototype,"audioEnabled",{get:function(){let N=this._getComponent(NV.e.NAME_AUDIO);return N||(N=new nV(this),this.o(N)),N.audioEnabled},set:function(N){let U=this._getComponent(NV.e.NAME_AUDIO);U||(U=new nV(this),this.o(U)),N?U.enableAudio():U.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(UV.e.prototype,"headphone",{get:function(){let N=this._getComponent(NV.e.NAME_AUDIO);return N||(N=new nV(this),this.o(N)),N.headphone},set:function(N){let U=this._getComponent(NV.e.NAME_AUDIO);U||(U=new nV(this),this.o(U)),N?U.switchAudioModeForHeadphones():U.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(UV.e.prototype,"audioListenerPositionProvider",{get:function(){let N=this._getComponent(NV.e.NAME_AUDIO);return N||(N=new nV(this),this.o(N)),N.audioListenerPositionProvider},set:function(N){let U=this._getComponent(NV.e.NAME_AUDIO);if(U||(U=new nV(this),this.o(U)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");U.audioListenerPositionProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(UV.e.prototype,"audioListenerRotationProvider",{get:function(){let N=this._getComponent(NV.e.NAME_AUDIO);return N||(N=new nV(this),this.o(N)),N.audioListenerRotationProvider},set:function(N){let U=this._getComponent(NV.e.NAME_AUDIO);if(U||(U=new nV(this),this.o(U)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");U.audioListenerRotationProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(UV.e.prototype,"audioPositioningRefreshRate",{get:function(){let N=this._getComponent(NV.e.NAME_AUDIO);return N||(N=new nV(this),this.o(N)),N.audioPositioningRefreshRate},set:function(N){let U=this._getComponent(NV.e.NAME_AUDIO);U||(U=new nV(this),this.o(U)),U.audioPositioningRefreshRate=N},enumerable:!0,configurable:!0});class nV{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(N){this.name=NV.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new t.CU,this._cachedCameraPosition=new t.CU,this._lastCheck=0,this._invertMatrixTemp=new t.Matrix,this._cameraDirectionTemp=new t.CU,(N=N||C.e.LastCreatedScene)&&(this.JU=N,N.soundTracks=[],N.Qk=[])}register(){this.JU._afterRenderStage.registerStep(NV.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(N){if(N.Qk=[],this.JU.soundTracks)for(let U=0;U<this.JU.soundTracks.length;U++){const V=this.JU.soundTracks[U];for(let U=0;U<V.soundCollection.length;U++)N.Qk.push(V.soundCollection[U].serialize())}}addFromContainer(N){if(N.Qk)for(const U of N.Qk)U.play(),U.autoplay=!0,this.JU.mainSoundTrack.addSound(U)}removeFromContainer(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(N.Qk)for(const V of N.Qk)V.stop(),V.autoplay=!1,this.JU.mainSoundTrack.removeSound(V),U&&V.dispose()}dispose(){const N=this.JU;if(N._mainSoundTrack&&N.mainSoundTrack.dispose(),N.soundTracks)for(let U=0;U<N.soundTracks.length;U++)N.soundTracks[U].dispose()}disableAudio(){const N=this.JU;let U;for(this._audioEnabled=!1,fU.c.audioEngine&&fU.c.audioEngine.audioContext&&fU.c.audioEngine.audioContext.suspend(),U=0;U<N.mainSoundTrack.soundCollection.length;U++)N.mainSoundTrack.soundCollection[U].pause();if(N.soundTracks)for(U=0;U<N.soundTracks.length;U++)for(let V=0;V<N.soundTracks[U].soundCollection.length;V++)N.soundTracks[U].soundCollection[V].pause()}enableAudio(){const N=this.JU;let U;for(this._audioEnabled=!0,fU.c.audioEngine&&fU.c.audioEngine.audioContext&&fU.c.audioEngine.audioContext.resume(),U=0;U<N.mainSoundTrack.soundCollection.length;U++)N.mainSoundTrack.soundCollection[U].isPaused&&N.mainSoundTrack.soundCollection[U].play();if(N.soundTracks)for(U=0;U<N.soundTracks.length;U++)for(let V=0;V<N.soundTracks[U].soundCollection.length;V++)N.soundTracks[U].soundCollection[V].isPaused&&N.soundTracks[U].soundCollection[V].play()}switchAudioModeForHeadphones(){const N=this.JU;if(this._headphone=!0,N.mainSoundTrack.switchPanningModelToHRTF(),N.soundTracks)for(let U=0;U<N.soundTracks.length;U++)N.soundTracks[U].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const N=this.JU;if(this._headphone=!1,N.mainSoundTrack.switchPanningModelToEqualPower(),N.soundTracks)for(let U=0;U<N.soundTracks.length;U++)N.soundTracks[U].switchPanningModelToEqualPower()}_afterRender(){const N=tV.b.Now;if(this._lastCheck&&N-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=N;const U=this.JU;if(!this._audioEnabled||!U._mainSoundTrack||!U.soundTracks||0===U._mainSoundTrack.soundCollection.length&&1===U.soundTracks.length)return;const V=fU.c.audioEngine;if(V&&V.audioContext){let N,A=U.activeCamera;if(U.activeCameras&&U.activeCameras.length>0&&(A=U.activeCameras[0]),this.audioListenerPositionProvider){const N=this.audioListenerPositionProvider();V.audioContext.listener.setPosition(N.x||0,N.y||0,N.z||0)}else A?this._cachedCameraPosition.equals(A.globalPosition)||(this._cachedCameraPosition.A(A.globalPosition),V.audioContext.listener.setPosition(A.globalPosition.x,A.globalPosition.y,A.globalPosition.z)):V.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const N=this.audioListenerRotationProvider();V.audioContext.listener.setOrientation(N.x||0,N.y||0,N.z||0,0,1,0)}else A?(A.rigCameras&&A.rigCameras.length>0&&(A=A.rigCameras[0]),A.getViewMatrix().invertToRef(this._invertMatrixTemp),t.CU.TransformNormalToRef(nV._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.A(this._cameraDirectionTemp),V.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):V.audioContext.listener.setOrientation(0,0,0,0,1,0);for(N=0;N<U.mainSoundTrack.soundCollection.length;N++){const V=U.mainSoundTrack.soundCollection[N];V.useCustomAttenuation&&V.updateDistanceFromListener()}if(U.soundTracks)for(N=0;N<U.soundTracks.length;N++)for(let V=0;V<U.soundTracks[N].soundCollection.length;V++){const A=U.soundTracks[N].soundCollection[V];A.useCustomAttenuation&&A.updateDistanceFromListener()}}}}nV._CameraDirection=new t.CU(0,0,-1),ZU._SceneComponentInitialization=N=>{let U=N._getComponent(NV.e.NAME_AUDIO);U||(U=new nV(N),N.o(U))};const qV="MSFT_audio_emitter";class iV{constructor(N){this.name=qV,this._loader=N,this.enabled=this._loader.isExtensionUsed(qV)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const N=this._loader.ii.extensions;if(N&&N[this.name]){const U=N[this.name];this._clips=U.clips,this._emitters=U.emitters,g.Assign(this._clips),g.Assign(this._emitters)}}loadSceneAsync(N,U){return K.LoadExtensionAsync(N,U,this.name,(async(V,A)=>{const t=new Array;t.push(this._loader.loadSceneAsync(N,U));for(const N of A.emitters){const U=g.Get(`${V}/emitters`,this._emitters,N);if(void 0!=U.refDistance||void 0!=U.maxDistance||void 0!=U.rolloffFactor||void 0!=U.distanceModel||void 0!=U.innerAngle||void 0!=U.outerAngle)throw new Error(`${V}: Direction or Distance properties are not allowed on emitters attached to a scene`);t.push(this._loadEmitterAsync(`${V}/emitters/${U.index}`,U))}await Promise.all(t)}))}loadNodeAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(N,A)=>{const n=new Array,i=await this._loader.loadNodeAsync(N,U,(U=>{for(const V of A.emitters){const A=g.Get(`${N}/emitters`,this._emitters,V);n.push(this._loadEmitterAsync(`${N}/emitters/${A.index}`,A).then((()=>{for(const N of A._babylonSounds)N.attachToMesh(U),void 0==A.innerAngle&&void 0==A.outerAngle||(N.setLocalDirectionToMesh(t.CU.Forward()),N.setDirectionalCone(2*q.Tools.ToDegrees(void 0==A.innerAngle?Math.PI:A.innerAngle),2*q.Tools.ToDegrees(void 0==A.outerAngle?Math.PI:A.outerAngle),0))})))}V(U)}));return await Promise.all(n),i}))}loadAnimationAsync(N,U){return K.LoadExtensionAsync(N,U,this.name,(async(V,A)=>{const t=await this._loader.loadAnimationAsync(N,U),n=new Array;g.Assign(A.events);for(const q of A.events)n.push(this._loadAnimationEventAsync(`${V}/events/${q.index}`,N,U,q,t));return await Promise.all(n),t}))}_loadClipAsync(N,U){if(U._objectURL)return U._objectURL;let V;if(U.uri)V=this._loader.loadUriAsync(N,U,U.uri);else{const A=g.Get(`${N}/bufferView`,this._loader.ii.bufferViews,U.bufferView);V=this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return U._objectURL=V.then((N=>URL.createObjectURL(new Blob([N],{type:U.mimeType})))),U._objectURL}_loadEmitterAsync(N,U){if(U._babylonSounds=U._babylonSounds||[],!U._babylonData){const N=new Array,V=U.name||`emitter${U.index}`,A={loop:!1,autoplay:!1,volume:void 0==U.volume?1:U.volume};for(let n=0;n<U.clips.length;n++){const t=`/extensions/${this.name}/clips`,q=g.Get(t,this._clips,U.clips[n].clip);N.push(this._loadClipAsync(`${t}/${U.clips[n].clip}`,q).then((N=>{const t=U._babylonSounds[n]=new ZU(V,N,this._loader.babylonScene,null,A);t.refDistance=U.refDistance||1,t.maxDistance=U.maxDistance||256,t.rolloffFactor=U.rolloffFactor||1,t.distanceModel=U.distanceModel||"exponential"})))}const t=Promise.all(N).then((()=>{const N=U.clips.map((N=>N.weight||1)),V=new bU(U.loop||!1,U._babylonSounds,N);U.innerAngle&&(V.directionalConeInnerAngle=2*q.Tools.ToDegrees(U.innerAngle)),U.outerAngle&&(V.directionalConeOuterAngle=2*q.Tools.ToDegrees(U.outerAngle)),U.volume&&(V.volume=U.volume),U._babylonData.sound=V}));U._babylonData={loaded:t}}return U._babylonData.loaded}_getEventAction(N,U,V,A,t){switch(V){case"play":return N=>{const V=(t||0)+(N-A);U.play(V)};case"stop":return()=>{U.stop()};case"pause":return()=>{U.pause()};default:throw new Error(`${N}: Unsupported action ${V}`)}}_loadAnimationEventAsync(N,U,V,A,t){if(0==t.targetedAnimations.length)return Promise.resolve();const n=t.targetedAnimations[0],q=A.AU,i=g.Get(`/extensions/${this.name}/emitters`,this._emitters,q);return this._loadEmitterAsync(N,i).then((()=>{const U=i._babylonData.sound;if(U){const V=new PU(A.time,this._getEventAction(N,U,A.action,A.time,A.startOffset));n.animation.addEvent(V),t.onAnimationGroupEndObservable.add((()=>{U.stop()})),t.onAnimationGroupPauseObservable.add((()=>{U.pause()}))}}))}}o(qV),I(qV,!0,(N=>new iV(N)));const zV="MSFT_lod";class SV{constructor(N){var U;this.name=zV,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new E.d,this.onMaterialLODsLoadedObservable=new E.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=N,this.maxLODsToLoad=(null===(U=this._loader.parent.extensionOptions[zV])||void 0===U?void 0:U.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(zV)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let N=0;N<this._nodePromiseLODs.length;N++){const U=Promise.all(this._nodePromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Node LOD ${N}`),this._loader.log(`Loaded node LOD ${N}`)),this.onNodeLODsLoadedObservable.notifyObservers(N),N!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${N+1}`),this._loadBufferLOD(this._nodeBufferLODs,N+1),this._nodeSignalLODs[N]&&this._nodeSignalLODs[N].resolve())}));this._loader._completePromises.push(U)}for(let N=0;N<this._materialPromiseLODs.length;N++){const U=Promise.all(this._materialPromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Material LOD ${N}`),this._loader.log(`Loaded material LOD ${N}`)),this.onMaterialLODsLoadedObservable.notifyObservers(N),N!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${N+1}`),this._loadBufferLOD(this._materialBufferLODs,N+1),this._materialSignalLODs[N]&&this._materialSignalLODs[N].resolve())}));this._loader._completePromises.push(U)}}loadSceneAsync(N,U){const V=this._loader.loadSceneAsync(N,U);return this._loadBufferLOD(this._bufferLODs,0),V}loadNodeAsync(N,U,V){return K.LoadExtensionAsync(N,U,this.name,(async(N,t)=>{let n;const q=this._getLODs(N,U,this._loader.ii.nodes,t.ids);this._loader.logOpen(`${N}`);for(let U=0;U<q.length;U++){const N=q[U];0!==U&&(this._nodeIndexLOD=U,this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new A);const t=N=>{V(N),N.Fi(!1)},i=this._loader.loadNodeAsync(`/nodes/${N.index}`,N,t).then((N=>{if(0!==U){const N=q[U-1];N._babylonTransformNode&&(this._disposeTransformNode(N._babylonTransformNode),delete N._babylonTransformNode)}return N.Fi(!0),N}));this._nodePromiseLODs[U]=this._nodePromiseLODs[U]||[],0===U?n=i:(this._nodeIndexLOD=null,this._nodePromiseLODs[U].push(i))}return this._loader.logClose(),await n}))}_loadMaterialAsync(N,U,V,A,t){return this._nodeIndexLOD?null:K.LoadExtensionAsync(N,U,this.name,(async(N,n)=>{let q;const i=this._getLODs(N,U,this._loader.ii.materials,n.ids);this._loader.logOpen(`${N}`);for(let U=0;U<i.length;U++){const N=i[U];0!==U&&(this._materialIndexLOD=U);const n=this._loader._loadMaterialAsync(`/materials/${N.index}`,N,V,A,(N=>{0===U&&t(N)})).then((N=>{if(0!==U){t(N);const V=i[U-1]._data;V[A]&&(this._disposeMaterials([V[A].babylonMaterial]),delete V[A])}return N}));this._materialPromiseLODs[U]=this._materialPromiseLODs[U]||[],0===U?q=n:(this._materialIndexLOD=null,this._materialPromiseLODs[U].push(n))}return this._loader.logClose(),await q}))}_loadUriAsync(N,U,V){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const t=this._nodeIndexLOD-1;return this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new A,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(N,U,V)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const t=this._materialIndexLOD-1;return this._materialSignalLODs[t]=this._materialSignalLODs[t]||new A,this._materialSignalLODs[t].promise.then((async()=>await this._loader.loadUriAsync(N,U,V)))}return null}loadBufferAsync(N,U,V,t){if(this._loader.parent.useRangeRequests&&!U.uri){if(!this._loader.bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);const U=async(N,U)=>{const n=V,q=n+t-1;let i=N[U];return i?(i.start=Math.min(i.start,n),i.end=Math.max(i.end,q)):(i={start:n,end:q,loaded:new A},N[U]=i),await i.loaded.promise.then((N=>new Uint8Array(N.buffer,N.byteOffset+V-i.start,t)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?U(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?U(this._materialBufferLODs,this._materialIndexLOD):U(this._bufferLODs,0)}return null}_loadBufferLOD(N,U){const V=N[U];V&&(this._loader.log(`Loading buffer range [${V.start}-${V.end}]`),this._loader.bin.readAsync(V.start,V.end-V.start+1).then((N=>{V.loaded.resolve(N)}),(N=>{V.loaded.reject(N)})))}_getLODs(N,U,V,A){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const t=[];for(let n=A.length-1;n>=0;n--)if(t.push(g.Get(`${N}/ids/${A[n]}`,V,A[n])),t.length===this.maxLODsToLoad)return t;return t.push(U),t}_disposeTransformNode(N){const U=[],V=N.material;V&&U.push(V);for(const t of N.getChildMeshes())t.material&&U.push(t.material);N.dispose();const A=U.filter((N=>this._loader.babylonScene.meshes.every((U=>U.material!=N))));this._disposeMaterials(A)}_disposeMaterials(N){const U={};for(const V of N){for(const N of V.getActiveTextures())U[N.uniqueId]=N;V.dispose()}for(const V in U)for(const N of this._loader.babylonScene.materials)N.hasTexture(U[V])&&delete U[V];for(const V in U)U[V].dispose()}}o(zV),I(zV,!0,(N=>new SV(N)));const EV="MSFT_minecraftMesh";class pV{constructor(N){this.name=EV,this._loader=N,this.enabled=this._loader.isExtensionUsed(EV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtraAsync(N,U,this.name,(async(A,t)=>{if(t){if(!(V instanceof v.b))throw new Error(`${A}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(N,U,V);return V.needAlphaBlending()&&(V.forceDepthWrite=!0,V.separateCullingPass=!0),V.ri=V.forceDepthWrite,V.twoSidedLighting=!0,await t}}))}}o(EV),I(EV,!0,(N=>new pV(N)));const kV="MSFT_sRGBFactors";class BV{constructor(N){this.name=kV,this._loader=N,this.enabled=this._loader.isExtensionUsed(kV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,U,V){return K.LoadExtraAsync(N,U,this.name,(async(A,t)=>{if(t){if(!(V instanceof v.b))throw new Error(`${A}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(N,U,V),n=V.YN().getEngine().useExactSrgbConversions;return V.albedoTexture||V.albedoColor.toLinearSpaceToRef(V.albedoColor,n),V.reflectivityTexture||V.reflectivityColor.toLinearSpaceToRef(V.reflectivityColor,n),await t}}))}}o(kV),I(kV,!0,(N=>new BV(N)));var CV=V(14022);const xV={};var JV=V(14078),dV=V(14051),rV=V(14026),vV=V(14036);function hV(N,U){for(const V of N)for(const N of V.dataOutputs)if(N.uniqueId===U)return N;throw new Error("Could not find data out connection with unique id "+U)}function cV(N,U){for(const V of N)if(V instanceof dV.b)for(const N of V.signalInputs)if(N.uniqueId===U)return N;throw new Error("Could not find signal in connection with unique id "+U)}async function HV(N,U){const A=await Promise.all(N.allBlocks.map((async N=>{const U=function(N){switch(N){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([V.e(78),V.e(79)]).then(V.bind(V,15523))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await V.e(80).then(V.bind(V,15532))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await V.e(81).then(V.bind(V,15540))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await V.e(82).then(V.bind(V,15546))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await V.e(83).then(V.bind(V,15551))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await V.e(84).then(V.bind(V,15560))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await V.e(85).then(V.bind(V,15568))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await V.e(86).then(V.bind(V,15570))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await V.e(87).then(V.bind(V,15575))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await V.e(90).then(V.bind(V,15609))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await V.e(90).then(V.bind(V,15609))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await V.e(90).then(V.bind(V,15609))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await V.e(90).then(V.bind(V,15609))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await V.e(95).then(V.bind(V,15612))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await V.e(96).then(V.bind(V,15619))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await V.e(97).then(V.bind(V,15621))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await V.e(98).then(V.bind(V,15630))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await V.e(99).then(V.bind(V,15635))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await V.e(100).then(V.bind(V,15639))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await V.e(101).then(V.bind(V,15647))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await V.e(102).then(V.bind(V,15652))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await V.e(103).then(V.bind(V,15658))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await V.e(104).then(V.bind(V,15662))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await V.e(105).then(V.bind(V,15670))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await V.e(106).then(V.bind(V,15677))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await V.e(107).then(V.bind(V,15685))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await V.e(108).then(V.bind(V,15688))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await V.e(109).then(V.bind(V,15690))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await V.e(110).then(V.bind(V,15693))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await V.e(111).then(V.bind(V,15700))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await V.e(112).then(V.bind(V,15703))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await V.e(113).then(V.bind(V,15706))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await V.e(92).then(V.bind(V,15711))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await V.e(114).then(V.bind(V,15717))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await V.e(115).then(V.bind(V,15724))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await V.e(116).then(V.bind(V,15726))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await V.e(93).then(V.bind(V,15729))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await V.e(88).then(V.bind(V,15579))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await V.e(94).then(V.bind(V,15732))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await V.e(89).then(V.bind(V,15605))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await V.e(90).then(V.bind(V,15609))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await V.e(90).then(V.bind(V,15609))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await V.e(91).then(V.bind(V,15738))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await V.e(91).then(V.bind(V,15738))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await V.e(91).then(V.bind(V,15738))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await V.e(91).then(V.bind(V,15738))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await V.e(91).then(V.bind(V,15738))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await V.e(91).then(V.bind(V,15738))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await V.e(117).then(V.bind(V,15741))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await V.e(118).then(V.bind(V,15747))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await V.e(119).then(V.bind(V,15751))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await V.e(120).then(V.bind(V,15758))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await V.e(121).then(V.bind(V,15760))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await V.e(122).then(V.bind(V,15767))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await V.e(123).then(V.bind(V,15774))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await V.e(124).then(V.bind(V,15779))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await V.e(125).then(V.bind(V,15788))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await V.e(126).then(V.bind(V,15790))).FlowGraphDataSwitchBlock;default:if(xV[N])return xV[N];throw new Error(`Unknown block name ${N}`)}}(N.className);return await U()})));return function(N,U,V){const A=U.coordinator.createGraph(),t=[],n=U.valueParseFunction??rV.c;for(let q=0;q<N.allBlocks.length;q++){const i=WV(N.allBlocks[q],{JU:U.coordinator.config.JU,pathConverter:U.pathConverter,assetsContainer:U.coordinator.config.JU,valueParseFunction:n},V[q]);t.push(i),i instanceof JV.e&&A.addEventBlock(i)}for(const q of t){for(const N of q.dataInputs)for(const U of N.connectedPointIds){const V=hV(t,U);N.connectTo(V)}if(q instanceof dV.b)for(const N of q.signalOutputs)for(const U of N.connectedPointIds){const V=cV(t,U);N.connectTo(V)}}for(const q of N.executionContexts)YV(q,{graph:A,valueParseFunction:n},N.rightHanded);return A}(N,U,A)}function YV(N,U,V){const A=U.graph.createContext();N.enableLogging&&(A.enableLogging=!0),A.treatDataAsRightHanded=V||!1;const t=U.valueParseFunction??rV.c;A.uniqueId=N.uniqueId;const n=A.YN();if(N._assetsContext){var q,i,z,S,E,p,k,B,C,x;const U=N._assetsContext,V={meshes:null===(q=U.meshes)||void 0===q?void 0:q.map((N=>n.getMeshById(N))),lights:null===(i=U.lights)||void 0===i?void 0:i.map((N=>n.getLightByName(N))),cameras:null===(z=U.cameras)||void 0===z?void 0:z.map((N=>n.getCameraByName(N))),materials:null===(S=U.materials)||void 0===S?void 0:S.map((N=>n.getMaterialById(N))),textures:null===(E=U.textures)||void 0===E?void 0:E.map((N=>n.getTextureByName(N))),animations:null===(p=U.animations)||void 0===p?void 0:p.map((N=>n.animations.find((U=>U.name===N)))),skeletons:null===(k=U.skeletons)||void 0===k?void 0:k.map((N=>n.getSkeletonByName(N))),yp:null===(B=U.yp)||void 0===B?void 0:B.map((N=>n.getParticleSystemById(N))),animationGroups:null===(C=U.animationGroups)||void 0===C?void 0:C.map((N=>n.getAnimationGroupByName(N))),transformNodes:null===(x=U.transformNodes)||void 0===x?void 0:x.map((N=>n.getTransformNodeById(N))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Qk:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};A.assetsContext=V}for(const J in N._userVariables){const U=t(J,N._userVariables,A.assetsContext,n);A.userVariables[J]=U}for(const J in N._connectionValues){const U=t(J,N._connectionValues,A.assetsContext,n);A._setConnectionValueByKey(J,U)}return A}function WV(N,U,V){const A={},t=U.valueParseFunction??rV.c;if(N.config)for(const q in N.config)A[q]=t(q,N.config,U.assetsContainer||U.JU,U.JU);if((0,rV.h)(N.className)){if(!U.pathConverter)throw new Error("Path converter is required for this block");A.pathConverter=U.pathConverter}const n=new V(A);n.uniqueId=N.uniqueId;for(let q=0;q<N.dataInputs.length;q++){const U=n.getDataInput(N.dataInputs[q].name);if(!U)throw new Error("Could not find data input with name "+N.dataInputs[q].name+" in block "+N.className);U.deserialize(N.dataInputs[q])}for(let q=0;q<N.dataOutputs.length;q++){const U=n.getDataOutput(N.dataOutputs[q].name);if(!U)throw new Error("Could not find data output with name "+N.dataOutputs[q].name+" in block "+N.className);U.deserialize(N.dataOutputs[q])}return n.metadata=N.metadata,n.deserialize&&n.deserialize(N),n}function sV(N){const[U,V]=N.split(":");return MV({op:U,extension:V})}function MV(N){var U;let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=N.extension?null===(U=mA[N.extension])||void 0===U?void 0:U[N.op]:wV[N.op];if(!A&&(x.b.Warn(`No mapping found for operation ${N.op} and extension ${N.extension||"KHR_interactivity"}`),V)){const U={},V={flows:{}};if(N.inputValueSockets){U.values={};for(const V in N.inputValueSockets)U.values[V]={name:V}}return N.outputValueSockets&&(V.values={},Object.keys(N.outputValueSockets).forEach((N=>{V.values[N]={name:N}}))),{dE:[],inputs:U,outputs:V}}return A}function aV(N,U,V){mA[U]||(mA[U]={}),mA[U][N]=V}const mA={BABYLON:{"flow/log":{dE:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},wV={"event/onStart":{dE:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{dE:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{dE:["FlowGraphSendCustomEventBlock"],extraProcessor(N,U,V,A,t){if("event/send"!==U.op||!N.configuration||1!==Object.keys(N.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=N.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const q=A.arrays.events[n],i=t[0];return i.config||(i.config={}),i.config.eventId=q.eventId,i.config.eventData=q.eventData,t}},"event/receive":{dE:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(N,U){var V;if(!N.configuration)return x.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const A=N.configuration.event;if(!A)return x.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const t=A.value[0];if("number"!==typeof t)return x.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(V=U.events)||void 0===V?void 0:V[t])?{valid:!0}:(x.b.Error(`Event with id ${t} not found`),{valid:!1,error:`Event with id ${t} not found`})},extraProcessor(N,U,V,A,t){if("event/receive"!==U.op||!N.configuration||1!==Object.keys(N.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=N.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const q=A.arrays.events[n],i=t[0];return i.config||(i.config={}),i.config.eventId=q.eventId,i.config.eventData=q.eventData,t}},"math/e":XV("FlowGraphEBlock"),"math/pi":XV("FlowGraphPIBlock"),"math/inf":XV("FlowGraphInfBlock"),"math/nan":XV("FlowGraphNaNBlock"),"math/abs":XV("FlowGraphAbsBlock"),"math/sign":XV("FlowGraphSignBlock"),"math/trunc":XV("FlowGraphTruncBlock"),"math/floor":XV("FlowGraphFloorBlock"),"math/ceil":XV("FlowGraphCeilBlock"),"math/round":{dE:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.roundHalfAwayFromZero=!0,t}},"math/fract":XV("FlowGraphFractBlock"),"math/neg":XV("FlowGraphNegationBlock"),"math/add":XV("FlowGraphAddBlock",["a","b"],!0),"math/sub":XV("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{dE:["FlowGraphMultiplyBlock"],extraProcessor(N,U,V,A,t){var n;(n=t[0]).config||(n.config={}),t[0].config.useMatrixPerComponent=!0,t[0].config.preventIntegerFloatArithmetic=!0;let q=-1;return Object.keys(N.values||{}).find((U=>{var V;return void 0!==(null===(V=N.values)||void 0===V?void 0:V[U].type)&&(q=N.values[U].type,!0)})),-1!==q&&(t[0].config.type=A.arrays.types[q].flowGraphType),t},validation:N=>N.values?eV(N):{valid:!0}},"math/div":XV("FlowGraphDivideBlock",["a","b"],!0),"math/rem":XV("FlowGraphModuloBlock",["a","b"]),"math/min":XV("FlowGraphMinBlock",["a","b"]),"math/max":XV("FlowGraphMaxBlock",["a","b"]),"math/clamp":XV("FlowGraphClampBlock",["a","b","c"]),"math/saturate":XV("FlowGraphSaturateBlock"),"math/mix":XV("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":XV("FlowGraphEqualityBlock",["a","b"]),"math/lt":XV("FlowGraphLessThanBlock",["a","b"]),"math/le":XV("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":XV("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":XV("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":XV("FlowGraphIsNaNBlock"),"math/isinf":XV("FlowGraphIsInfBlock"),"math/select":{dE:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{dE:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":XV("FlowGraphSinBlock"),"math/cos":XV("FlowGraphCosBlock"),"math/tan":XV("FlowGraphTanBlock"),"math/asin":XV("FlowGraphASinBlock"),"math/acos":XV("FlowGraphACosBlock"),"math/atan":XV("FlowGraphATanBlock"),"math/atan2":XV("FlowGraphATan2Block",["a","b"]),"math/sinh":XV("FlowGraphSinhBlock"),"math/cosh":XV("FlowGraphCoshBlock"),"math/tanh":XV("FlowGraphTanhBlock"),"math/asinh":XV("FlowGraphASinhBlock"),"math/acosh":XV("FlowGraphACoshBlock"),"math/atanh":XV("FlowGraphATanhBlock"),"math/exp":XV("FlowGraphExponentialBlock"),"math/log":XV("FlowGraphLogBlock"),"math/log2":XV("FlowGraphLog2Block"),"math/log10":XV("FlowGraphLog10Block"),"math/sqrt":XV("FlowGraphSquareRootBlock"),"math/cbrt":XV("FlowGraphCubeRootBlock"),"math/pow":XV("FlowGraphPowerBlock",["a","b"]),"math/length":XV("FlowGraphLengthBlock"),"math/normalize":XV("FlowGraphNormalizeBlock"),"math/dot":XV("FlowGraphDotBlock",["a","b"]),"math/cross":XV("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":XV("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":XV("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{dE:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{dE:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{dE:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{dE:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{dE:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{dE:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{dE:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":XV("FlowGraphTransposeBlock"),"math/determinant":XV("FlowGraphDeterminantBlock"),"math/inverse":XV("FlowGraphInvertMatrixBlock"),"math/matmul":XV("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{dE:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ci",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t,n){const q=t[0].dataInputs.find((N=>"rotationQuaternion"===N.name));if(!q)throw new Error("Rotation quaternion input not found");return n._connectionValues[q.uniqueId]&&(n._connectionValues[q.uniqueId].type="Quaternion"),t}},"math/matDecompose":{dE:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ci"}}}},"math/quatConjugate":XV("FlowGraphConjugateBlock",["a"]),"math/quatMul":{dE:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.type="Quaternion",t}},"math/quatAngleBetween":XV("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{dE:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":XV("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":XV("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{dE:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract2x2":{dE:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{dE:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract3x3":{dE:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{dE:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract4x4":{dE:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{dE:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t,n){var q,i;(i=t[0]).config||(i.config={});const z=t[0].dataInputs[0];return t[0].config.valueType=(null===(q=n._connectionValues[z.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",t}},"math/and":{dE:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t,n){var q,i,z;(z=t[0]).config||(z.config={});const S=t[0].dataInputs[0],E=t[0].dataInputs[1];return t[0].config.valueType=(null===(q=n._connectionValues[S.uniqueId])||void 0===q?void 0:q.type)??(null===(i=n._connectionValues[E.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",t}},"math/or":{dE:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t,n){var q,i,z;(z=t[0]).config||(z.config={});const S=t[0].dataInputs[0],E=t[0].dataInputs[1];return t[0].config.valueType=(null===(q=n._connectionValues[S.uniqueId])||void 0===q?void 0:q.type)??(null===(i=n._connectionValues[E.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",t}},"math/xor":{dE:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,U,V,A,t,n){var q,i,z;(z=t[0]).config||(z.config={});const S=t[0].dataInputs[0],E=t[0].dataInputs[1];return t[0].config.valueType=(null===(q=n._connectionValues[S.uniqueId])||void 0===q?void 0:q.type)??(null===(i=n._connectionValues[E.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",t}},"math/asr":XV("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":XV("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":XV("FlowGraphLeadingZerosBlock"),"math/ctz":XV("FlowGraphTrailingZerosBlock"),"math/popcnt":XV("FlowGraphOneBitsCounterBlock"),"math/rad":XV("FlowGraphDegToRadBlock"),"math/deg":XV("FlowGraphRadToDegBlock"),"type/boolToInt":XV("FlowGraphBooleanToInt"),"type/boolToFloat":XV("FlowGraphBooleanToFloat"),"type/intToBool":XV("FlowGraphIntToBoolean"),"type/intToFloat":XV("FlowGraphIntToFloat"),"type/floatToInt":XV("FlowGraphFloatToInt"),"type/floatToBool":XV("FlowGraphFloatToBoolean"),"flow/sequence":{dE:["FlowGraphSequenceBlock"],extraProcessor(N,U,V,A,t){const n=t[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(N.flows||[]).length,n.signalOutputs.forEach(((N,U)=>{N.name="out_"+U})),t}},"flow/branch":{dE:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{dE:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(N){if(N.configuration&&N.configuration.cases){const U=N.configuration.cases.value;if(!U.every((N=>"number"===typeof N&&/^-?\d+$/.test(N.toString()))))return x.b.Warn("Switch cases should be integers. Using empty array instead."),N.configuration.cases.value=[],{valid:!0};const V=new Set(U);N.configuration.cases.value=Array.from(V)}return{valid:!0}},extraProcessor(N,U,V,A,t){if("flow/switch"!==U.op||!N.flows||0===Object.keys(N.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return t[0].signalOutputs.forEach((N=>{"default"!==N.name&&(N.name="out_"+N.name)})),t}},"flow/while":{dE:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{dE:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(N,U,V,A,t){const n=t[0];return n.config||(n.config={}),n.config.incrementIndexWhenLoopDone=!0,t}},"flow/doN":{dE:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{dE:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(N,U,V,A,t){if("flow/multiGate"!==U.op||!N.flows||0===Object.keys(N.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const n=t[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(N.flows).length,n.signalOutputs.forEach(((N,U)=>{N.name="out_"+U})),t}},"flow/waitAll":{dE:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(N){var U,V;return"number"!==typeof(null===(U=N.configuration)||void 0===U||null===(V=U.inputFlows)||void 0===V?void 0:V.value[0])&&(N.configuration=N.configuration||{inputFlows:{value:[0]}},N.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{dE:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{dE:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{dE:["FlowGraphCancelDelayBlock"]},"variable/get":{dE:["FlowGraphGetVariableBlock"],validation(N){var U,V;return null!==(U=N.configuration)&&void 0!==U&&null!==(V=U.variable)&&void 0!==V&&V.value?{valid:!0}:(x.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(N,U)=>[U.getVariableName(N[0])]}}},"variable/set":{dE:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(N,U)=>[U.getVariableName(N[0])]}}},"variable/setMultiple":{dE:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(N,U)=>[N[0].map((N=>U.getVariableName(N)))]}},extraProcessor:(N,U,V,A,t)=>(t[0].dataInputs.forEach((N=>{N.name=A.getVariableName(+N.name)})),t)},"variable/interpolate":{dE:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(N,U)=>[U.getVariableName(N[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:N=>!0===N[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",JV:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",JV:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",JV:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",JV:"FlowGraphPlayAnimationBlock"},out:{name:"out",JV:"FlowGraphPlayAnimationBlock"},done:{name:"done",JV:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(N,U,V,A,t){var n,q,i;const z=t[0],S=null===(n=N.configuration)||void 0===n?void 0:n.variable.value[0];if("number"!==typeof S)throw x.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const E=A.arrays.staticVariables[S];"undefined"===typeof z.config.animationType.value&&(A.arrays.staticVariables,z.config.animationType.value=(0,vV.A)(E.type));const p=t[4];return p.config||(p.config={}),(q=p.config).variable||(q.variable={}),p.config.variable.value=A.getVariableName(S),(i=t[3]).config||(i.config={}),t}},"pointer/get":{dE:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",JV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",JV:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,U,V,A,t)=>(t.forEach((N=>{"FlowGraphJsonPointerParserBlock"===N.className&&(N.config||(N.config={}),N.config.outputValue=!0)})),t)},"pointer/set":{dE:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",JV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",JV:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,U,V,A,t)=>(t.forEach((N=>{"FlowGraphJsonPointerParserBlock"===N.className&&(N.config||(N.config={}),N.config.outputValue=!0)})),t)},"pointer/interpolate":{dE:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",JV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",JV:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",JV:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",JV:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",JV:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",JV:"FlowGraphPlayAnimationBlock"},out:{name:"out",JV:"FlowGraphPlayAnimationBlock"},done:{name:"done",JV:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,U,V,A,t)=>(t.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className?(U.config||(U.config={}),U.config.outputValue=!0):"FlowGraphInterpolationBlock"===U.className&&(U.config||(U.config={}),Object.keys(N.values||[]).forEach((V=>{var t;const n=null===(t=N.values)||void 0===t?void 0:t[V];if("value"===V&&n){const N=n.type;void 0!==N&&(U.config.animationType=A.arrays.types[N].flowGraphType)}})))})),t)},"animation/start":{dE:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",JV:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(N,U)=>[N[0]*U._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(N,U)=>[N[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,U,V,A,t,n,q){const i=t[t.length-1];return i.config||(i.config={}),i.config.glTF=q,t}},"animation/stop":{dE:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",JV:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,U,V,A,t,n,q){const i=t[t.length-1];return i.config||(i.config={}),i.config.glTF=q,t}},"animation/stopAt":{dE:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",JV:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(N,U)=>[N[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,U,V,A,t,n,q){const i=t[t.length-1];return i.config||(i.config={}),i.config.glTF=q,t}},"math/switch":{dE:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(N){if(N.configuration&&N.configuration.cases){const U=N.configuration.cases.value;if(!U.every((N=>"number"===typeof N&&/^-?\d+$/.test(N.toString()))))return x.b.Warn("Switch cases should be integers. Using empty array instead."),N.configuration.cases.value=[],{valid:!0};const V=new Set(U);N.configuration.cases.value=Array.from(V)}return{valid:!0}},extraProcessor(N,U,V,A,t){const n=t[0];return n.dataInputs.forEach((N=>{"default"!==N.name&&"case"!==N.name&&(N.name="in_"+N.name)})),n.config||(n.config={}),n.config.treatCasesAsIntegers=!0,t}},"debug/log":{dE:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function XV(N){let U=arguments.length>2?arguments[2]:void 0;return{dE:[N],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((N,U)=>(N[U]={name:U},N)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(N,V,A,t,n){var q;if(U){(q=n[0]).config||(q.config={}),n[0].config.preventIntegerFloatArithmetic=!0;let U=-1;Object.keys(N.values||{}).find((V=>{var A;return void 0!==(null===(A=N.values)||void 0===A?void 0:A[V].type)&&(U=N.values[V].type,!0)})),-1!==U&&(n[0].config.type=t.arrays.types[U].flowGraphType)}return n},validation:N=>U?eV(N):{valid:!0}}}function eV(N){if(N.values){const U=Object.keys(N.values).map((U=>N.values[U].type)).filter((N=>void 0!==N));if(!U.every((N=>N===U[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}wV["math/compose"]=wV["math/matCompose"],wV["math/decompose"]=wV["math/matDecompose"];var QV=V(12351);const uV={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"CU",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class LV{constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=N,this._gltf=U,this._animationTargetFps=V,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const N of this._interactivityGraph.types)this._types.push(uV[N.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const N of this._interactivityGraph.declarations){const U=MV(N);if(!U)throw x.b.Error(["No mapping found for declaration",N]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:U,fullOperationName:N.extension?N.op+":"+N.extension:N.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const N of this._interactivityGraph.variables){const U=this._parseVariable(N);this._staticVariables.push(U)}}_parseVariable(N,U){const V=this._types[N.type];if(!V)throw x.b.Error(["No type found for variable",N]),new Error("Error parsing variables");if(N.value&&N.value.length!==V.length)throw x.b.Error(["Invalid value length for variable",N,V]),new Error("Error parsing variables");const A=N.value||[];if(!A.length)switch(V.flowGraphType){case"boolean":A.push(!1);break;case"FlowGraphInteger":A.push(0);break;case"number":A.push(NaN);break;case"Vector2":A.push(NaN,NaN);break;case"CU":A.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":A.fill(NaN,0,4);break;case"Matrix":A.fill(NaN,0,16);break;case"Matrix3D":A.fill(NaN,0,9)}return"number"===V.elementType&&"string"===typeof A[0]&&(A[0]=parseFloat(A[0])),{type:V.flowGraphType,value:U?U(A,this):A}}_parseEvents(){if(this._interactivityGraph.events)for(const N of this._interactivityGraph.events){const U={eventId:N.id||"internalEvent_"+this._internalEventsCounter++};N.values&&(U.eventData=Object.keys(N.values).map((U=>{var V;const A=null===(V=N.values)||void 0===V?void 0:V[U];if(!A)throw x.b.Error(["No value found for event key",U]),new Error("Error parsing events");const t=this._types[A.type];if(!t)throw x.b.Error(["No type found for event value",A]),new Error("Error parsing events");const n="undefined"!==typeof A.value?this._parseVariable(A):void 0;return{id:U,type:t.flowGraphType,eventData:!0,value:n}}))),this._events.push(U)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const U of this._interactivityGraph.nodes){if("number"!==typeof U.declaration)throw x.b.Error(["No declaration found for node",U]),new Error("Error parsing nodes");const V=this._mappings[U.declaration];if(!V)throw x.b.Error(["No mapping found for node",U]),new Error("Error parsing nodes");if(V.flowGraphMapping.validation){const A=V.flowGraphMapping.validation(U,this._interactivityGraph,this._gltf);var N;if(!A.valid)throw new Error(`Error validating interactivity node ${null===(N=this._interactivityGraph.declarations)||void 0===N?void 0:N[U.declaration].op} - ${A.error}`)}const A=[];for(const N of V.flowGraphMapping.dE){const t=this._getEmptyBlock(N,V.fullOperationName);this._parseNodeConfiguration(U,t,V.flowGraphMapping,N),A.push(t)}this._nodes.push({dE:A,fullOperationName:V.fullOperationName})}}_getEmptyBlock(N,U){return{uniqueId:(0,QV.b)(),className:N,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:U,metadata:{}}}_parseNodeConfiguration(N,U,V,A){const t=U.config;if(N.configuration){const U=Object.keys(N.configuration);for(const i of U){var n,q;const U=null===(n=N.configuration)||void 0===n?void 0:n[i];if(!U)throw x.b.Error(["No value found for node configuration",i]),new Error("Error parsing node configuration");const z=null===(q=V.configuration)||void 0===q?void 0:q[i];if(z&&z.JV?z.JV===A:0===V.dE.indexOf(A)){const N=(null===z||void 0===z?void 0:z.name)||i;U&&"undefined"!==typeof U.value||"undefined"===typeof(null===z||void 0===z?void 0:z.defaultValue)?U.value.length>=0?t[N]={value:1===U.value.length?U.value[0]:U.value}:x.b.Warn(["Invalid value for node configuration",U]):t[N]={value:z.defaultValue},z&&z.dataTransformer&&(t[N].value=z.dataTransformer([t[N].value],this)[0])}}}}_parseNodeConnections(N){for(let H=0;H<this._nodes.length;H++){var U;const Y=null===(U=this._interactivityGraph.nodes)||void 0===U?void 0:U[H];if(!Y)throw x.b.Error(["No node found for interactivity node",this._nodes[H]]),new Error("Error parsing node connections");const W=this._nodes[H],s=this._mappings[Y.declaration];if(!s)throw x.b.Error(["No mapping found for node",Y]),new Error("Error parsing node connections");const M=Y.flows||{},a=Object.keys(M).sort();for(const N of a){var V,A,t,n;const U=M[N],S=null===(V=s.flowGraphMapping.outputs)||void 0===V||null===(A=V.flows)||void 0===A?void 0:A[N],E=(null===S||void 0===S?void 0:S.name)||N,p=this._createNewSocketConnection(E,!0);(S&&S.JV&&W.dE.find((N=>N.className===S.JV))||W.dE[0]).signalOutputs.push(p);const k=U.node,B=this._nodes[k];if(!B)throw x.b.Error(["No node found for input node id",k]),new Error("Error parsing node connections");const C=sV(B.fullOperationName);if(!C)throw x.b.Error(["No mapping found for input node",B]),new Error("Error parsing node connections");let J=null===(t=C.inputs)||void 0===t||null===(n=t.flows)||void 0===n?void 0:n[U.socket||"in"],d=!1;if(!J)for(const N in null===(q=C.inputs)||void 0===q?void 0:q.flows){var q,i,z;if(N.startsWith("[")&&N.endsWith("]"))d=!0,J=null===(i=C.inputs)||void 0===i||null===(z=i.flows)||void 0===z?void 0:z[N]}const r=J?d?J.name.replace("$1",U.socket||""):J.name:U.socket||"in",v=J&&J.JV&&B.dE.find((N=>N.className===J.JV))||B.dE[0];let h=v.signalInputs.find((N=>N.name===r));h||(h=this._createNewSocketConnection(r),v.signalInputs.push(h)),h.connectedPointIds.push(p.uniqueId),p.connectedPointIds.push(h.uniqueId)}const mN=Y.values||{},w=Object.keys(mN);for(const U of w){var S,E;const V=mN[U];let A=null===(S=s.flowGraphMapping.inputs)||void 0===S||null===(E=S.values)||void 0===E?void 0:E[U],t=!1;if(!A)for(const N in null===(p=s.flowGraphMapping.inputs)||void 0===p?void 0:p.values){var p,k,B;if(N.startsWith("[")&&N.endsWith("]"))t=!0,A=null===(k=s.flowGraphMapping.inputs)||void 0===k||null===(B=k.values)||void 0===B?void 0:B[N]}const n=A?t?A.name.replace("$1",U):A.name:U,q=this._createNewSocketConnection(n);if((A&&A.JV&&W.dE.find((N=>N.className===A.JV))||W.dE[0]).dataInputs.push(q),void 0!==V.value){const U=this._parseVariable(V,A&&A.dataTransformer);N._connectionValues[q.uniqueId]=U}else{if("undefined"===typeof V.node)throw x.b.Error(["Invalid value for value connection",V]),new Error("Error parsing node connections");{var C,J,d;const N=V.node,U=V.socket||"value",A=this._nodes[N];if(!A)throw x.b.Error(["No node found for output socket reference",V]),new Error("Error parsing node connections");const t=sV(A.fullOperationName);if(!t)throw x.b.Error(["No mapping found for output socket reference",V]),new Error("Error parsing node connections");let n=null===(C=t.outputs)||void 0===C||null===(J=C.values)||void 0===J?void 0:J[U],i=!1;if(!n)for(const V in null===(r=t.outputs)||void 0===r?void 0:r.values){var r,v,h;if(V.startsWith("[")&&V.endsWith("]"))i=!0,n=null===(v=t.outputs)||void 0===v||null===(h=v.values)||void 0===h?void 0:h[V]}const z=n?i?n.name.replace("$1",U):null===(d=n)||void 0===d?void 0:d.name:U,S=n&&n.JV&&A.dE.find((N=>N.className===n.JV))||A.dE[0];let E=S.dataOutputs.find((N=>N.name===z));E||(E=this._createNewSocketConnection(z,!0),S.dataOutputs.push(E)),q.connectedPointIds.push(E.uniqueId),E.connectedPointIds.push(q.uniqueId)}}}if(s.flowGraphMapping.interBlockConnectors)for(const N of s.flowGraphMapping.interBlockConnectors){const U=N.input,V=N.output,A=N.isVariable;this._connectFlowGraphNodes(U,V,W.dE[N.inputBlockIndex],W.dE[N.outputBlockIndex],A)}if(s.flowGraphMapping.extraProcessor){var c;const U=null===(c=this._interactivityGraph.declarations)||void 0===c?void 0:c[Y.declaration];if(!U)throw x.b.Error(["No declaration found for extra processor",Y]),new Error("Error parsing node connections");W.dE=s.flowGraphMapping.extraProcessor(Y,U,s.flowGraphMapping,this,W.dE,N,this._gltf)}}}_createNewSocketConnection(N,U){return{uniqueId:(0,QV.b)(),name:N,_connectionType:U?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(N,U,V,A,t){const n=t?V.dataInputs:V.signalInputs,q=t?A.dataOutputs:A.signalOutputs,i=n.find((U=>U.name===N))||this._createNewSocketConnection(N),z=q.find((N=>N.name===U))||this._createNewSocketConnection(U,!0);n.find((U=>U.name===N))||n.push(i),q.find((N=>N.name===U))||q.push(z),i.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(i.uniqueId)}getVariableName(N){return"staticVariable_"+N}serializeToFlowGraph(){const N={uniqueId:(0,QV.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(N);for(let U=0;U<this._staticVariables.length;U++){const V=this._staticVariables[U];N._userVariables[this.getVariableName(U)]=V}return{rightHanded:!0,allBlocks:this._nodes.reduce(((N,U)=>N.concat(U.dE)),[]),executionContexts:[N]}}}const IV="KHR_interactivity";class oV{constructor(N){this._loader=N,this.name=IV,this.enabled=this._loader.isExtensionUsed(IV),this._pathConverter=(0,R.g)(this._loader.ii),N._skipStartAnimationStep=!0;const U=N.babylonScene;U&&function(N){(0,R.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!N.activeCamera)return new t.Quaternion(NaN,NaN,NaN,NaN);const U=t.Quaternion.FromRotationMatrix(N.activeCamera.getWorldMatrix()).normalize();return N.useRightHandedSystem||(U.w*=-1,U.x*=-1),U},type:"Quaternion",getTarget:()=>N.activeCamera}),(0,R.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!N.activeCamera)return new t.CU(NaN,NaN,NaN);const U=N.activeCamera.getWorldMatrix().getTranslation();return N.useRightHandedSystem||(U.x*=-1),U},type:"CU",getTarget:()=>N.activeCamera}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:N=>{var U;return(null===(U=N._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)??!1},type:"boolean",getTarget:N=>N._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:N=>{var U;return((null===(U=N._babylonAnimationGroup)||void 0===U?void 0:U.from)??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:N=>{var U;return((null===(U=N._babylonAnimationGroup)||void 0===U?void 0:U.to)??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:N=>{var U;return((null===(U=N._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,R.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:N=>{var U;return((null===(U=N._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup})}(U)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var N;if(!this._loader.babylonScene||!this._pathConverter)return;const U=this._loader.babylonScene,V=null===(N=this._loader.ii.extensions)||void 0===N?void 0:N.KHR_interactivity;if(!V)return;const A=new CV.c({JU:U});A.dispatchEventsSynchronously=!1;const t=V.graphs.map((N=>new LV(N,this._loader.ii,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(t.map((async N=>await HV(N,{coordinator:A,pathConverter:this._pathConverter})))),A.start()}}var RV;RV=async()=>(await Promise.resolve().then(V.bind(V,14097))).FlowGraphGLTFDataProvider,xV[`${IV}/${"FlowGraphGLTFDataProvider"}`]=RV,o(IV),I(IV,!0,(N=>new oV(N)));const DV="KHR_node_visibility";(0,R.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:N=>{const U=N._babylonTransformNode;return!U||void 0===U.isVisible||U.isVisible},set:(N,U)=>{var V,A;null===(V=U._primitiveBabylonMeshes)||void 0===V||V.forEach((N=>{N.inheritVisibility=!0})),U._babylonTransformNode&&(U._babylonTransformNode.isVisible=N),null===(A=U._primitiveBabylonMeshes)||void 0===A||A.forEach((U=>{U.isVisible=N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class GV{constructor(N){this.name=DV,this._loader=N,this.enabled=N.isExtensionUsed(DV)}async onReady(){var N;null===(N=this._loader.ii.nodes)||void 0===N||N.forEach((N=>{var U,V,A,t;(null===(U=N._primitiveBabylonMeshes)||void 0===U||U.forEach((N=>{N.inheritVisibility=!0})),null!==(V=N.extensions)&&void 0!==V&&V.KHR_node_visibility)&&(!1===(null===(A=N.extensions)||void 0===A?void 0:A.KHR_node_visibility.visible)&&(N._babylonTransformNode&&(N._babylonTransformNode.isVisible=!1),null===(t=N._primitiveBabylonMeshes)||void 0===t||t.forEach((N=>{N.isVisible=!1}))))}))}dispose(){this._loader=null}}o(DV),I(DV,!0,(N=>new GV(N)));const gV="KHR_node_selectability";aV("event/onSelect",gV,{dE:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",JV:"FlowGraphGetVariableBlock",dataTransformer:N=>["pickedMesh_"+N[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",JV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,U,V,A,t,n,q){var i,z,S,E,p,k;const B=t[t.length-1];B.config=B.config||{},B.config.glTF=q;const C=null===(i=N.configuration)||void 0===i||null===(z=i.nodeIndex)||void 0===z?void 0:z.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const x="pickedMesh_"+C;return t[1].config.variable=x,n._userVariables[x]={className:"Mesh",id:null===q||void 0===q||null===(S=q.nodes)||void 0===S||null===(E=S[C]._babylonTransformNode)||void 0===E?void 0:E.id,uniqueId:null===q||void 0===q||null===(p=q.nodes)||void 0===p||null===(k=p[C]._babylonTransformNode)||void 0===k?void 0:k.uniqueId},t}}),(0,R.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:N=>{const U=N._babylonTransformNode;return!U||void 0===U.lz||U.lz},set:(N,U)=>{var V;null===(V=U._primitiveBabylonMeshes)||void 0===V||V.forEach((U=>{U.lz=N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"lz"],type:"boolean"});class lV{constructor(N){this.name=gV,this._loader=N,this.enabled=N.isExtensionUsed(gV)}async onReady(){var N;null===(N=this._loader.ii.nodes)||void 0===N||N.forEach((N=>{var U,V,A;null!==(U=N.extensions)&&void 0!==U&&U.KHR_node_selectability&&!1===(null===(V=N.extensions)||void 0===V?void 0:V.KHR_node_selectability.selectable)&&(null===(A=N._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((N=>{N.lz=!1})))}))}dispose(){this._loader=null}}o(gV),I(gV,!0,(N=>new lV(N)));const KV="KHR_node_hoverability",jV="targetMeshPointerOver_";aV("event/onHoverIn",KV,{dE:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",JV:"FlowGraphGetVariableBlock",dataTransformer:N=>[jV+N[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",JV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,U,V,A,t,n,q){var i,z,S,E,p,k;const B=t[t.length-1];B.config=B.config||{},B.config.glTF=q;const C=null===(i=N.configuration)||void 0===i||null===(z=i.nodeIndex)||void 0===z?void 0:z.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const x=jV+C;return t[1].config.variable=x,n._userVariables[x]={className:"Mesh",id:null===q||void 0===q||null===(S=q.nodes)||void 0===S||null===(E=S[C]._babylonTransformNode)||void 0===E?void 0:E.id,uniqueId:null===q||void 0===q||null===(p=q.nodes)||void 0===p||null===(k=p[C]._babylonTransformNode)||void 0===k?void 0:k.uniqueId},t}});const FV="targetMeshPointerOut_";aV("event/onHoverOut",KV,{dE:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",JV:"FlowGraphGetVariableBlock",dataTransformer:N=>[FV+N[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",JV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,U,V,A,t,n,q){var i,z,S,E,p,k;const B=t[t.length-1];B.config=B.config||{},B.config.glTF=q;const C=null===(i=N.configuration)||void 0===i||null===(z=i.nodeIndex)||void 0===z?void 0:z.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const x=FV+C;return t[1].config.variable=x,n._userVariables[x]={className:"Mesh",id:null===q||void 0===q||null===(S=q.nodes)||void 0===S||null===(E=S[C]._babylonTransformNode)||void 0===E?void 0:E.id,uniqueId:null===q||void 0===q||null===(p=q.nodes)||void 0===p||null===(k=p[C]._babylonTransformNode)||void 0===k?void 0:k.uniqueId},t}}),(0,R.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:N=>{const U=N._babylonTransformNode;return!U||void 0===U.pointerOverDisableMeshTesting||U.pointerOverDisableMeshTesting},set:(N,U)=>{var V;null===(V=U._primitiveBabylonMeshes)||void 0===V||V.forEach((U=>{U.pointerOverDisableMeshTesting=!N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class PV{constructor(N){this.name=KV,this._loader=N,this.enabled=N.isExtensionUsed(KV)}async onReady(){var N;null===(N=this._loader.ii.nodes)||void 0===N||N.forEach((N=>{var U,V,A;null!==(U=N.extensions)&&void 0!==U&&U.KHR_node_hoverability&&!1===(null===(V=N.extensions)||void 0===V?void 0:V.KHR_node_hoverability.hoverable)&&(null===(A=N._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((N=>{N.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}o(KV),I(KV,!0,(N=>new PV(N)));const TV="ExtrasAsMetadata";class fV{_assignExtras(N,U){if(U.extras&&Object.keys(U.extras).length>0){const V=N.metadata=N.metadata||{};(V.ii=V.ii||{}).extras=U.extras}}constructor(N){this.name=TV,this.enabled=!0,this._loader=N}dispose(){this._loader=null}loadNodeAsync(N,U,V){return this._loader.loadNodeAsync(N,U,(N=>{this._assignExtras(N,U),V(N)}))}loadCameraAsync(N,U,V){return this._loader.loadCameraAsync(N,U,(N=>{this._assignExtras(N,U),V(N)}))}createMaterial(N,U,V){const A=this._loader.createMaterial(N,U,V);return this._assignExtras(A,U),A}}o(TV),I(TV,!1,(N=>new fV(N)));V(14097)},13967:(N,U,V)=>{"use strict";V.d(U,{d:()=>e,f:()=>s,g:()=>W,i:()=>M});var A=V(12182),t=V(12179),n=V(13617),q=V(12799),i=V(12762),z=V(12772),S=V(12193),E=V(12223),p=V(12793),k=V(12895),B=V(12803),C=V(12420);class x{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.yp=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Qk=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(N){this._environmentTexture=N}getNodes(){let N=[];N=N.concat(this.meshes),N=N.concat(this.lights),N=N.concat(this.cameras),N=N.concat(this.transformNodes);for(const U of this.skeletons)N=N.concat(U.bones);return N}}class J extends x{}class d{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const N=this.rootNodes;for(const A of N)A.dispose();N.length=0;const U=this.skeletons;for(const A of U)A.dispose();U.length=0;const V=this.animationGroups;for(const A of V)A.dispose();V.length=0}}class r extends x{constructor(N){super(),this._wasAddedToScene=!1,(N=N||E.e.LastCreatedScene)&&(this.JU=N,this.proceduralTextures=[],N.Ai.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=N.getEngine().onContextRestoredObservable.add((()=>{for(const N of this.geometries)N._rebuild();for(const N of this.meshes)N._rebuild();for(const N of this.yp)N.rebuild();for(const N of this.textures)N._rebuild()})))}_topologicalSort(N){const U=new Map;for(const q of N)U.set(q.uniqueId,q);const V={dependsOn:new Map,dependedBy:new Map};for(const q of N){const N=q.uniqueId;V.dependsOn.set(N,new Set),V.dependedBy.set(N,new Set)}for(const q of N){const N=q.uniqueId,A=V.dependsOn.get(N);if(q instanceof p.b){const t=q.sourceMesh;U.has(t.uniqueId)&&(A.add(t.uniqueId),V.dependedBy.get(t.uniqueId).add(N))}const t=V.dependedBy.get(N);for(const n of q.getDescendants()){const A=n.uniqueId;if(U.has(A)){t.add(A);V.dependsOn.get(A).add(N)}}}const A=[],t=[];for(const q of N){const N=q.uniqueId;0===V.dependsOn.get(N).size&&(t.push(q),U.delete(N))}const n=t;for(;n.length>0;){const N=n.shift();A.push(N);const t=V.dependedBy.get(N.uniqueId);for(const A of Array.from(t.values())){const t=V.dependsOn.get(A);t.delete(N.uniqueId),0===t.size&&U.get(A)&&(n.push(U.get(A)),U.delete(A))}}return U.size>0&&(S.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),U.forEach((N=>{S.b.Error(N.name)}))),A}_addNodeAndDescendantsToList(N,U,V,A){if(V&&(!A||A(V))&&!U.has(V.uniqueId)){N.push(V),U.add(V.uniqueId);for(const t of V.getDescendants(!0))this._addNodeAndDescendantsToList(N,U,t,A)}}_isNodeInContainer(N){return N instanceof z.e&&-1!==this.meshes.indexOf(N)||(N instanceof i.b&&-1!==this.transformNodes.indexOf(N)||(N instanceof k.e&&-1!==this.lights.indexOf(N)||N instanceof B.b&&-1!==this.cameras.indexOf(N)))}_isValidHierarchy(){for(const N of this.meshes)if(N.parent&&!this._isNodeInContainer(N.parent))return S.b.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.transformNodes)if(N.parent&&!this._isNodeInContainer(N.parent))return S.b.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.lights)if(N.parent&&!this._isNodeInContainer(N.parent))return S.b.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.cameras)if(N.parent&&!this._isNodeInContainer(N.parent))return S.b.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||t.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const A={},n={},i=new d,z=[],S=[],E={doNotInstantiate:!0,...V},p=[],k=new Set;for(const t of this.transformNodes)null===t.parent&&this._addNodeAndDescendantsToList(p,k,t,E.predicate);for(const t of this.meshes)null===t.parent&&this._addNodeAndDescendantsToList(p,k,t,E.predicate);const B=this._topologicalSort(p),C=(V,t)=>{if(((U,V)=>{if(A[U.uniqueId]=V.uniqueId,n[V.uniqueId]=V,N&&(V.name=N(U.name)),V instanceof q.b){const N=V;if(N.morphTargetManager){const V=U.morphTargetManager;N.morphTargetManager=V.clone();for(let U=0;U<V.numTargets;U++){const t=V.getTarget(U),q=N.morphTargetManager.getTarget(U);A[t.uniqueId]=q.uniqueId,n[q.uniqueId]=q}}}})(V,t),V.parent){const N=A[V.parent.uniqueId],U=n[N];t.parent=U||V.parent}if(t.position&&V.position&&t.position.A(V.position),t.rotationQuaternion&&V.rotationQuaternion&&t.rotationQuaternion.A(V.rotationQuaternion),t.rotation&&V.rotation&&t.rotation.A(V.rotation),t.ci&&V.ci&&t.ci.A(V.ci),t.material){const q=t;if(q.material)if(U){const U=V.material;if(-1===S.indexOf(U)){let V=U.clone(N?N(U.name):"Clone of "+U.name);if(S.push(U),A[U.uniqueId]=V.uniqueId,n[V.uniqueId]=V,"MultiMaterial"===U.getClassName()){const t=U;for(const U of t.Wi)U&&(V=U.clone(N?N(U.name):"Clone of "+U.name),S.push(U),A[U.uniqueId]=V.uniqueId,n[V.uniqueId]=V);t.Wi=t.Wi.map((N=>N&&n[A[N.uniqueId]]))}}"InstancedMesh"!==q.getClassName()&&(q.material=n[A[U.uniqueId]])}else"MultiMaterial"===q.material.getClassName()?-1===this.JU.multiMaterials.indexOf(q.material)&&this.JU.addMultiMaterial(q.material):-1===this.JU.materials.indexOf(q.material)&&this.JU.addMaterial(q.material)}null===t.parent&&i.rootNodes.push(t)};for(const t of B)if("InstancedMesh"===t.getClassName()){const N=t,U=N.sourceMesh,V=A[U.uniqueId];C(N,("number"===typeof V?n[V]:U).createInstance(N.name))}else{let N=!0;"pz"===t.getClassName()||"Node"===t.getClassName()||t.skeleton||!t.getTotalVertices||0===t.getTotalVertices()?N=!1:E.doNotInstantiate&&(N="function"===typeof E.doNotInstantiate?!E.doNotInstantiate(t):!E.doNotInstantiate);const U=N?t.createInstance(`instance of ${t.name}`):t.clone(`Clone of ${t.name}`,null,!0);if(!U)throw new Error(`Could not clone or instantiate node on Asset Container ${t.name}`);C(t,U)}for(const t of this.skeletons){if(E.predicate&&!E.predicate(t))continue;const U=t.clone(N?N(t.name):"Clone of "+t.name);for(const N of this.meshes)if(N.skeleton===t&&!N.isAnInstance){const V=n[A[N.uniqueId]];if(!V||V.isAnInstance)continue;if(V.skeleton=U,-1!==z.indexOf(U))continue;z.push(U);for(const N of U.bones)N._linkedTransformNode&&(N._linkedTransformNode=n[A[N._linkedTransformNode.uniqueId]])}i.skeletons.push(U)}for(const t of this.animationGroups){if(E.predicate&&!E.predicate(t))continue;const U=t.clone(N?N(t.name):"Clone of "+t.name,(N=>n[A[N.uniqueId]]||N));i.animationGroups.push(U)}return i}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||t.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.JU.environmentTexture=this.environmentTexture);for(const N of this.JU._serializableComponents)N.addFromContainer(this);this.JU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=[];for(const V of this.cameras)N&&!N(V)||(this.JU.addCamera(V),U.push(V));for(const V of this.lights)N&&!N(V)||(this.JU.addLight(V),U.push(V));for(const V of this.meshes)N&&!N(V)||(this.JU.nE(V),U.push(V));for(const V of this.skeletons)N&&!N(V)||this.JU.addSkeleton(V);for(const V of this.animations)N&&!N(V)||this.JU.addAnimation(V);for(const V of this.animationGroups)N&&!N(V)||this.JU.addAnimationGroup(V);for(const V of this.multiMaterials)N&&!N(V)||this.JU.addMultiMaterial(V);for(const V of this.materials)N&&!N(V)||this.JU.addMaterial(V);for(const V of this.morphTargetManagers)N&&!N(V)||this.JU.addMorphTargetManager(V);for(const V of this.geometries)N&&!N(V)||this.JU.addGeometry(V);for(const V of this.transformNodes)N&&!N(V)||(this.JU.addTransformNode(V),U.push(V));for(const V of this.actionManagers)N&&!N(V)||this.JU.addActionManager(V);for(const V of this.textures)N&&!N(V)||this.JU.addTexture(V);for(const V of this.reflectionProbes)N&&!N(V)||this.JU.addReflectionProbe(V);for(const V of U)V.parent&&-1===this.JU.getNodes().indexOf(V.parent)&&(V.setParent?V.setParent(null):V.parent=null)}removeAllFromScene(){this._isValidHierarchy()||t.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.JU.environmentTexture&&(this.JU.environmentTexture=null);for(const N of this.JU._serializableComponents)N.removeFromContainer(this)}removeFromScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const U of this.cameras)N&&!N(U)||this.JU.removeCamera(U);for(const U of this.lights)N&&!N(U)||this.JU.removeLight(U);for(const U of this.meshes)N&&!N(U)||this.JU.tE(U,!0);for(const U of this.skeletons)N&&!N(U)||this.JU.removeSkeleton(U);for(const U of this.animations)N&&!N(U)||this.JU.removeAnimation(U);for(const U of this.animationGroups)N&&!N(U)||this.JU.removeAnimationGroup(U);for(const U of this.multiMaterials)N&&!N(U)||this.JU.removeMultiMaterial(U);for(const U of this.materials)N&&!N(U)||this.JU.removeMaterial(U);for(const U of this.morphTargetManagers)N&&!N(U)||this.JU.removeMorphTargetManager(U);for(const U of this.geometries)N&&!N(U)||this.JU.removeGeometry(U);for(const U of this.transformNodes)N&&!N(U)||this.JU.removeTransformNode(U);for(const U of this.actionManagers)N&&!N(U)||this.JU.removeActionManager(U);for(const U of this.textures)N&&!N(U)||this.JU.removeTexture(U);for(const U of this.reflectionProbes)N&&!N(U)||this.JU.removeReflectionProbe(U)}dispose(){const N=this.cameras.slice(0);for(const B of N)B.dispose();this.cameras.length=0;const U=this.lights.slice(0);for(const B of U)B.dispose();this.lights.length=0;const V=this.meshes.slice(0);for(const B of V)B.dispose();this.meshes.length=0;const A=this.skeletons.slice(0);for(const B of A)B.dispose();this.skeletons.length=0;const t=this.animationGroups.slice(0);for(const B of t)B.dispose();this.animationGroups.length=0;const n=this.multiMaterials.slice(0);for(const B of n)B.dispose();this.multiMaterials.length=0;const q=this.materials.slice(0);for(const B of q)B.dispose();this.materials.length=0;const i=this.geometries.slice(0);for(const B of i)B.dispose();this.geometries.length=0;const z=this.transformNodes.slice(0);for(const B of z)B.dispose();this.transformNodes.length=0;const S=this.actionManagers.slice(0);for(const B of S)B.dispose();this.actionManagers.length=0;const E=this.textures.slice(0);for(const B of E)B.dispose();this.textures.length=0;const p=this.reflectionProbes.slice(0);for(const B of p)B.dispose();this.reflectionProbes.length=0;const k=this.morphTargetManagers.slice(0);for(const B of k)B.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const B of this.JU._serializableComponents)B.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.JU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(N,U,V){if(N&&U)for(const A of N){let N=!0;if(V)for(const U of V)if(A===U){N=!1;break}N&&(U.push(A),A._parentContainer=this)}}moveAllFromScene(N){this._wasAddedToScene=!1,void 0===N&&(N=new J);for(const U in this)Object.prototype.hasOwnProperty.call(this,U)&&(this[U]=this[U]||("_environmentTexture"===U?null:[]),this._moveAssets(this.JU[U],this[U],N[U]));this.environmentTexture=this.JU.environmentTexture,this.removeAllFromScene()}createRootMesh(){const N=new q.b("assetContainerRootMesh",this.JU);for(const U of this.meshes)U.parent||N.addChild(U);return this.meshes.unshift(N),N}mergeAnimationsTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.e.LastCreatedScene,U=arguments.length>1?arguments[1]:void 0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!N)return S.b.Error("No scene available to merge animations to"),[];const A=V||(U=>{let V=null;const A=U.animations.length?U.animations[0].targetProperty:"",t=U.name.split(".").join("").split("_primitive")[0];switch(A){case"position":case"rotationQuaternion":V=N.getTransformNodeByName(U.name)||N.getTransformNodeByName(t);break;case"influence":V=N.getMorphTargetByName(U.name)||N.getMorphTargetByName(t);break;default:V=N.getNodeByName(U.name)||N.getNodeByName(t)}return V}),t=this.getNodes();for(const i of t){const N=A(i);if(null!==N){for(const U of i.animations){const V=N.animations.filter((N=>N.targetProperty===U.targetProperty));for(const U of V){const V=N.animations.indexOf(U,0);V>-1&&N.animations.splice(V,1)}}N.animations=N.animations.concat(i.animations)}}const n=[],q=this.animationGroups.slice();for(const i of q){n.push(i.clone(i.name,A));for(const N of i.animatables)N.stop()}for(const i of U){const U=A(i.target);U&&(N.beginAnimation(U,i.fromFrame,i.toFrame,i.loopAnimation,i.speedRatio,i.onAnimationEnd?i.onAnimationEnd:void 0,void 0,!0,void 0,i.onAnimationLoop?i.onAnimationLoop:void 0),N.stopAnimation(i.target))}return n}populateRootNodes(){this.rootNodes.length=0;for(const N of this.meshes)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.transformNodes)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.lights)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.cameras)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)}addAllAssetsToContainer(N){if(!N)return;const U=[],V=new Set;for(U.push(N);U.length>0;){const N=U.pop();if(N instanceof q.b?(N.Ji&&-1===this.geometries.indexOf(N.Ji)&&this.geometries.push(N.Ji),this.meshes.push(N)):N instanceof p.b?this.meshes.push(N):N instanceof i.b?this.transformNodes.push(N):N instanceof k.e?this.lights.push(N):N instanceof B.b&&this.cameras.push(N),N instanceof z.e){if(N.material&&-1===this.materials.indexOf(N.material)){this.materials.push(N.material);for(const U of N.material.getActiveTextures())-1===this.textures.indexOf(U)&&this.textures.push(U)}N.skeleton&&-1===this.skeletons.indexOf(N.skeleton)&&this.skeletons.push(N.skeleton),N.morphTargetManager&&-1===this.morphTargetManagers.indexOf(N.morphTargetManager)&&this.morphTargetManagers.push(N.morphTargetManager)}for(const A of N.getChildren())V.has(A)||U.push(A);V.add(N)}this.populateRootNodes()}_getByTags(N,U,V){if(void 0===U)return N;const A=[];for(const t in N){const n=N[t];C.c&&C.c.MatchesQuery(n,U)&&(!V||V(n))&&A.push(n)}return A}getMeshesByTags(N,U){return this._getByTags(this.meshes,N,U)}getCamerasByTags(N,U){return this._getByTags(this.cameras,N,U)}getLightsByTags(N,U){return this._getByTags(this.lights,N,U)}getMaterialsByTags(N,U){return this._getByTags(this.materials,N,U).concat(this._getByTags(this.multiMaterials,N,U))}getTransformNodesByTags(N,U){return this._getByTags(this.transformNodes,N,U)}}var v=V(12243);class h{constructor(N){this.byteOffset=0,this.buffer=N}async loadAsync(N){const U=await this.buffer.readAsync(this.byteOffset,N);this._dataView=new DataView(U.buffer,U.byteOffset,U.byteLength),this._dataByteOffset=0}readUint32(){const N=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,N}readUint8Array(N){const U=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,N);return this._dataByteOffset+=N,this.byteOffset+=N,U}readString(N){return(0,v.e)(this.readUint8Array(N))}skipBytes(N){this._dataByteOffset+=N,this.byteOffset+=N}}var c=V(13972);const H="Z2xURg",Y={name:"ii",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:N=>-1!==N.indexOf("asset")&&-1!==N.indexOf("version")||N.startsWith("data:base64,"+H)||N.startsWith("data:;base64,"+H)||N.startsWith("data:application/octet-stream;base64,"+H)||N.startsWith("data:model/gltf-binary;base64,"+H)};var W,s,M,a=V(12232),mN=V(12235);function w(N,U,V){try{return Promise.resolve(new Uint8Array(N,U,V))}catch(A){return Promise.reject(A)}}!function(N){N[N.AUTO=0]="AUTO",N[N.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(W||(W={})),function(N){N[N.NONE=0]="NONE",N[N.FIRST=1]="FIRST",N[N.ALL=2]="ALL"}(s||(s={})),function(N){N[N.LOADING=0]="LOADING",N[N.READY=1]="READY",N[N.COMPLETE=2]="COMPLETE"}(M||(M={}));class X{constructor(){this.coordinateSystemMode=W.AUTO,this.animationStartMode=s.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=N=>Promise.resolve(N),this.extensionOptions={}}A(N){N&&(this.onParsed=N.onParsed,this.coordinateSystemMode=N.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=N.animationStartMode??this.animationStartMode,this.loadNodeAnimations=N.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=N.loadSkins??this.loadSkins,this.loadMorphTargets=N.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=N.compileMaterials??this.compileMaterials,this.useClipPlane=N.useClipPlane??this.useClipPlane,this.compileShadowGenerators=N.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=N.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=N.useRangeRequests??this.useRangeRequests,this.createInstances=N.createInstances??this.createInstances,this.alwaysComputeBoundingBox=N.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=N.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=N.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=N.skipMaterials??this.skipMaterials,this.useSRGBBuffers=N.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=N.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=N.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=N.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=N.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=N.customRootNode,this.onMeshLoaded=N.onMeshLoaded,this.onSkinLoaded=N.onSkinLoaded,this.onTextureLoaded=N.onTextureLoaded,this.onMaterialLoaded=N.onMaterialLoaded,this.onCameraLoaded=N.onCameraLoaded,this.extensionOptions=N.extensionOptions??this.extensionOptions)}}class e extends X{constructor(N){super(),this.onParsedObservable=new A.d,this.onMeshLoadedObservable=new A.d,this.onSkinLoadedObservable=new A.d,this.onTextureLoadedObservable=new A.d,this.onMaterialLoadedObservable=new A.d,this.onCameraLoadedObservable=new A.d,this.onCompleteObservable=new A.d,this.onErrorObservable=new A.d,this.Ai=new A.d,this.onExtensionLoadedObservable=new A.d,this.validate=!1,this.onValidatedObservable=new A.d,this._loader=null,this._state=null,this._requests=new Array,this.name=Y.name,this.extensions=Y.extensions,this.onLoaderStateChangedObservable=new A.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.A(N)}set onParsed(N){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),N&&(this._onParsedObserver=this.onParsedObservable.add(N))}set onMeshLoaded(N){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),N&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(N))}set onSkinLoaded(N){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),N&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((U=>N(U.node,U.skinnedNode))))}set onTextureLoaded(N){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),N&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(N))}set onMaterialLoaded(N){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),N&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(N))}set onCameraLoaded(N){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),N&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(N))}set onComplete(N){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(N)}set onError(N){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(N)}set onDispose(N){this._onDisposeObserver&&this.Ai.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ai.add(N)}set onExtensionLoaded(N){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(N)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(N){this._loggingEnabled!==N&&(this._loggingEnabled=N,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(N){this._capturePerformanceCounters!==N&&(this._capturePerformanceCounters=N,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(N){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(N)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const N of this._requests)N.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=N=>Promise.resolve(N),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ai.notifyObservers(void 0),this.Ai.clear()}loadFile(N,U,V,n,q,i,z,E){if(ArrayBuffer.isView(U))return this._loadBinary(N,U,V,n,z,E),null;this._progressCallback=q;const p=U.name||t.Tools.GetFilename(U);if(i){if(this.useRangeRequests){this.validate&&S.b.Warn("glTF validation is not supported when range requests are enabled");const V={abort:()=>{},onCompleteObservable:new A.d},t={readAsync:(V,A)=>new Promise(((t,n)=>{this._loadFile(N,U,(N=>{t(new Uint8Array(N))}),!0,(N=>{n(N)}),(N=>{N.setRequestHeader("Range",`bytes=${V}-${V+A-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new h(t)).then((N=>{V.onCompleteObservable.notifyObservers(V),n(N)}),z?N=>z(void 0,N):void 0),V}return this._loadFile(N,U,(U=>{this._validate(N,new Uint8Array(U,0,U.byteLength),V,p),this._unpackBinaryAsync(new h({readAsync:(N,V)=>w(U,N,V),byteLength:U.byteLength})).then((N=>{n(N)}),z?N=>z(void 0,N):void 0)}),!0,z)}return this._loadFile(N,U,(U=>{try{this._validate(N,U,V,p),n({json:this._parseJson(U)})}catch{z&&z()}}),!1,z)}_loadBinary(N,U,V,A,t,n){this._validate(N,new Uint8Array(U.buffer,U.byteOffset,U.byteLength),V,n),this._unpackBinaryAsync(new h({readAsync:(N,V)=>function(N,U,V){try{if(U<0||U>=N.byteLength)throw new RangeError("Offset is out of range.");if(U+V>N.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(N.buffer,N.byteOffset+U,V))}catch(A){return Promise.reject(A)}}(U,N,V),byteLength:U.byteLength})).then((N=>{A(N)}),t?N=>t(void 0,N):void 0)}importMeshAsync(N,U,V,A,t,n){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(V),this._loader.importMeshAsync(N,U,null,V,A,t,n))))}loadAsync(N,U,V,A,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(U),this._loader.loadAsync(N,U,V,A,t))))}loadAssetContainerAsync(N,U,V,A,t){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(U);const n=new r(N),q=[];this.onMaterialLoadedObservable.add((N=>{q.push(N)}));const i=[];this.onTextureLoadedObservable.add((N=>{i.push(N)}));const z=[];this.onCameraLoadedObservable.add((N=>{z.push(N)}));const S=[];return this.onMeshLoadedObservable.add((N=>{N.morphTargetManager&&S.push(N.morphTargetManager)})),this._loader.importMeshAsync(null,N,n,U,V,A,t).then((N=>(Array.prototype.push.apply(n.geometries,N.geometries),Array.prototype.push.apply(n.meshes,N.meshes),Array.prototype.push.apply(n.yp,N.yp),Array.prototype.push.apply(n.skeletons,N.skeletons),Array.prototype.push.apply(n.animationGroups,N.animationGroups),Array.prototype.push.apply(n.materials,q),Array.prototype.push.apply(n.textures,i),Array.prototype.push.apply(n.lights,N.lights),Array.prototype.push.apply(n.transformNodes,N.transformNodes),Array.prototype.push.apply(n.cameras,z),Array.prototype.push.apply(n.morphTargetManagers,S),n)))}))}canDirectLoad(N){return Y.canDirectLoad(N)}directLoad(N,U){if(U.startsWith("base64,"+H)||U.startsWith(";base64,"+H)||U.startsWith("application/octet-stream;base64,"+H)||U.startsWith("model/gltf-binary;base64,"+H)){const V=(0,a.d)(U);return this._validate(N,new Uint8Array(V,0,V.byteLength)),this._unpackBinaryAsync(new h({readAsync:(N,U)=>w(V,N,U),byteLength:V.byteLength}))}return this._validate(N,U),Promise.resolve({json:this._parseJson(U)})}createPlugin(N){return new e(N[Y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((N,U)=>{this.onCompleteObservable.addOnce((()=>{N()})),this.onErrorObservable.addOnce((N=>{U(N)}))}))}_setState(N){this._state!==N&&(this._state=N,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(M[this._state]))}_loadFile(N,U,V,A,t,n){const q=N._loadFile(U,V,(N=>{this._onProgress(N,q)}),!0,A,t,n);return q.onCompleteObservable.add((()=>{q._lengthComputable=!0,q._total=q._loaded})),this._requests.push(q),q}_onProgress(N,U){if(!this._progressCallback)return;U._lengthComputable=N.lengthComputable,U._loaded=N.loaded,U._total=N.total;let V=!0,A=0,t=0;for(const n of this._requests){if(void 0===n._lengthComputable||void 0===n._loaded||void 0===n._total)return;V=V&&n._lengthComputable,A+=n._loaded,t+=n._total}this._progressCallback({lengthComputable:V,loaded:A,total:V?t:0})}_validate(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),c.c.ValidateAsync(U,V,A,(U=>this.preprocessUrlAsync(V+U).then((U=>N._loadFileAsync(U,void 0,!0,!0).then((N=>new Uint8Array(N,0,N.byteLength))))))).then((N=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(N),this.onValidatedObservable.clear()}),(N=>{this._endPerformanceCounter("Validate JSON"),t.Tools.Warn(`Failed to validate: ${N.message}`),this.onValidatedObservable.clear()})))}_getLoader(N){const U=N.json.asset||{};this._log(`Asset version: ${U.version}`),U.minVersion&&this._log(`Asset minimum version: ${U.minVersion}`),U.generator&&this._log(`Asset generator: ${U.generator}`);const V=e._parseVersion(U.version);if(!V)throw new Error("Invalid version: "+U.version);if(void 0!==U.minVersion){const N=e._parseVersion(U.minVersion);if(!N)throw new Error("Invalid minimum version: "+U.minVersion);if(e._compareVersion(N,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+U.minVersion)}const A={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[V.major];if(!A)throw new Error("Unsupported version: "+U.version);return A(this)}_parseJson(N){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${N.length}`);const U=JSON.parse(N);return this._endPerformanceCounter("Parse JSON"),U}_unpackBinaryAsync(N){return this._startPerformanceCounter("Unpack Binary"),N.loadAsync(20).then((()=>{const U=N.readUint32();if(1179937895!==U)throw new mN.j("Unexpected magic: "+U,mN.g.GLTFLoaderUnexpectedMagicError);const V=N.readUint32();this.loggingEnabled&&this._log(`Binary version: ${V}`);const A=N.readUint32();let t;switch(this.useRangeRequests||A===N.buffer.byteLength||S.b.Warn(`Length in header does not match actual data length: ${A} != ${N.buffer.byteLength}`),V){case 1:t=this._unpackBinaryV1Async(N,A);break;case 2:t=this._unpackBinaryV2Async(N,A);break;default:throw new Error("Unsupported version: "+V)}return this._endPerformanceCounter("Unpack Binary"),t}))}_unpackBinaryV1Async(N,U){const V=N.readUint32(),A=N.readUint32();if(0!==A)throw new Error(`Unexpected content format: ${A}`);const t=U-N.byteOffset,n={json:this._parseJson(N.readString(V)),bin:null};if(0!==t){const U=N.byteOffset;n.bin={readAsync:(V,A)=>N.buffer.readAsync(U+V,A),byteLength:t}}return Promise.resolve(n)}_unpackBinaryV2Async(N,U){const V=1313821514,A=5130562,t=N.readUint32();if(N.readUint32()!==V)throw new Error("First chunk format is not JSON");return N.byteOffset+t===U?N.loadAsync(t).then((()=>({json:this._parseJson(N.readString(t)),bin:null}))):N.loadAsync(t+8).then((()=>{const n={json:this._parseJson(N.readString(t)),bin:null},q=()=>{const t=N.readUint32();switch(N.readUint32()){case V:throw new Error("Unexpected JSON chunk");case A:{const U=N.byteOffset;n.bin={readAsync:(V,A)=>N.buffer.readAsync(U+V,A),byteLength:t},N.skipBytes(t);break}default:N.skipBytes(t)}return N.byteOffset!==U?N.loadAsync(8).then(q):Promise.resolve(n)};return q()}))}static _parseVersion(N){if("1.0"===N||"1.0.1"===N)return{major:1,minor:0};const U=(N+"").match(/^(\d+)\.(\d+)/);return U?{major:parseInt(U[1]),minor:parseInt(U[2])}:null}static _compareVersion(N,U){return N.major>U.major?1:N.major<U.major?-1:N.minor>U.minor?1:N.minor<U.minor?-1:0}_logOpen(N){this._log(N),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(N){const U=e._logSpaces.substring(0,2*this._logIndentLevel);S.b.Log(`${U}${N}`)}_logDisabled(N){}_startPerformanceCounterEnabled(N){t.Tools.StartPerformanceCounter(N)}_startPerformanceCounterDisabled(N){}_endPerformanceCounterEnabled(N){t.Tools.EndPerformanceCounter(N)}_endPerformanceCounterDisabled(N){}}e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",(0,n.c)(new e)},13972:(N,U,V)=>{"use strict";V.d(U,{c:()=>q});var A=V(12179);function t(N,U,V,A){const t={externalResourceFunction:A};return V&&(t.uri="file:"===U?V:U+V),ArrayBuffer.isView(N)?GLTFValidator.validateBytes(N,t):GLTFValidator.validateString(N,t)}function n(){const N=[];onmessage=U=>{const V=U.data;switch(V.id){case"init":importScripts(V.url);break;case"validate":t(V.data,V.rootUrl,V.fileName,(U=>new Promise(((V,A)=>{const t=N.length;N.push({resolve:V,reject:A}),postMessage({id:"getExternalResource",index:t,uri:U})})))).then((N=>{postMessage({id:"validate.resolve",value:N})}),(N=>{postMessage({id:"validate.reject",reason:N})}));break;case"getExternalResource.resolve":N[V.index].resolve(V.value);break;case"getExternalResource.reject":N[V.index].reject(V.reason)}}}class q{static ValidateAsync(N,U,V,q){return"function"===typeof Worker?new Promise(((i,z)=>{const S=`${t}(${n})()`,E=URL.createObjectURL(new Blob([S],{type:"application/javascript"})),p=new Worker(E),k=N=>{p.removeEventListener("error",k),p.removeEventListener("message",B),z(N)},B=N=>{const U=N.data;switch(U.id){case"getExternalResource":q(U.uri).then((N=>{p.postMessage({id:"getExternalResource.resolve",index:U.index,value:N},[N.buffer])}),(N=>{p.postMessage({id:"getExternalResource.reject",index:U.index,reason:N})}));break;case"validate.resolve":p.removeEventListener("error",k),p.removeEventListener("message",B),i(U.value),p.terminate();break;case"validate.reject":p.removeEventListener("error",k),p.removeEventListener("message",B),z(U.reason),p.terminate()}};if(p.addEventListener("error",k),p.addEventListener("message",B),p.postMessage({id:"init",url:A.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(N)){const A=N.slice();p.postMessage({id:"validate",data:A,rootUrl:U,fileName:V},[A.buffer])}else p.postMessage({id:"validate",data:N,rootUrl:U,fileName:V})})):(this._LoadScriptPromise||(this._LoadScriptPromise=A.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>t(N,U,V,q))))}}q.Configuration={url:`${A.Tools._DefaultCdnUrl}/gltf_validator.js`}},14523:(N,U,V)=>{"use strict";V.d(U,{e:()=>Y});var A=V(12367),t=V(12369),n=V(12413),q=V(12383),i=V(12732),z=V(12667),S=V(12453),E=V(12601),p=V(12344),k=V(12288);V(13758),V(13649),V(13661),V(13657),V(13665),V(13674),V(13680);const B="imageProcessingCompatibility",C="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";k.b.IncludesShadersStore[B]||(k.b.IncludesShadersStore[B]=C);const x="skyPixelShader",J="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";k.b.ShadersStore[x]||(k.b.ShadersStore[x]=J);V(13771),V(13689),V(13697),V(13708),V(13706);const d="skyVertexShader",r="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";k.b.ShadersStore[d]||(k.b.ShadersStore[d]=r);var v=V(12662),h=V(12717),c=V(12713);class H extends i.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Y extends z.c{constructor(N,U){super(N,U),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new q.CU(0,100,0),this.useSunPosition=!1,this.cameraOffset=q.CU.Zero(),this.up=q.CU.Up(),this.dithering=!1,this._cameraPosition=q.CU.Zero(),this._skyOrientation=new q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(N,U){const V=U._drawWrapper;if(this.isFrozen&&V.effect&&V._wasPreviouslyReady)return!0;U.materialDefines||(U.materialDefines=new H);const A=U.materialDefines,t=this.YN();if(this._isReadyForSubMesh(U))return!0;if((0,c.U)(N,t,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,A),(0,c.L)(N,A,!0,!1),A.IMAGEPROCESSINGPOSTPROCESS!==t.imageProcessingConfiguration.applyByPostProcess&&A.markAsMiscDirty(),A.DITHER!==this.dithering&&A.markAsMiscDirty(),A.isDirty){A.markAsProcessed(),t.resetCachedMaterial();const N=new v.e;A.FOG&&N.addFallback(1,"FOG"),A.IMAGEPROCESSINGPOSTPROCESS=t.imageProcessingConfiguration.applyByPostProcess,A.DITHER=this.dithering;const V=[S.f.PositionKind];A.VERTEXCOLOR&&V.push(S.f.ColorKind);const n="sky",q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,h.b)(q);const i=A.toString();U.setEffect(t.getEngine().createEffect(n,V,q,[],i,N,this.onCompiled,this.onError),A,this._materialContext)}return!(!U.effect||!U.effect.isReady())&&(A._renderId=t.getRenderId(),V._wasPreviouslyReady=!0,!0)}bindForSubMesh(N,U,V){const A=this.YN(),t=V.materialDefines;if(!t)return;const n=V.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(N),this._activeEffect.setMatrix("viewProjection",A.getTransformMatrix()),this._mustRebind(A,n,V)&&((0,h.d)(n,this,A),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,c.k)(t,n,A)),A.fogEnabled&&U.applyFog&&A.fogMode!==E.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",A.getViewMatrix()),(0,c.f)(A,U,this._activeEffect);const i=A.activeCamera;if(i){const N=i.getWorldMatrix();this._cameraPosition.x=N.m[12],this._cameraPosition.y=N.m[13],this._cameraPosition.z=N.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const N=Math.PI*(this.inclination-.5),U=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(U)*Math.cos(N),this.sunPosition.y=this.distance*Math.sin(-N),this.sunPosition.z=this.distance*Math.sin(U)*Math.cos(N),q.Quaternion.FromUnitVectorsToRef(q.CU.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(U,this._activeEffect,V)}getAnimatables(){return[]}dispose(N){super.dispose(N)}clone(N){return n.d.Clone((()=>new Y(N,this.YN())),this)}serialize(){const N=super.serialize();return N.customType="BABYLON.SkyMaterial",N}getClassName(){return"SkyMaterial"}static Parse(N,U,V){return n.d.Parse((()=>new Y(N.name,U)),N,U,V)}}(0,A.b)([(0,t.N)()],Y.prototype,"luminance",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"turbidity",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"rayleigh",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"mieCoefficient",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"mieDirectionalG",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"distance",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"inclination",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"azimuth",void 0),(0,A.b)([(0,t.J)()],Y.prototype,"sunPosition",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"useSunPosition",void 0),(0,A.b)([(0,t.J)()],Y.prototype,"cameraOffset",void 0),(0,A.b)([(0,t.J)()],Y.prototype,"up",void 0),(0,A.b)([(0,t.N)()],Y.prototype,"dithering",void 0),(0,p.e)("BABYLON.SkyMaterial",Y)},13018:(N,U,V)=>{"use strict";function A(N,U){U.headers=N.headers||{},U.statusMessage=N.statusText,U.statusCode=N.status,U.data=N.response}function t(N,U,V){return new Promise((function(t,n){V=V||{};var q,i,z,S=new XMLHttpRequest,E=V.body,p=V.headers||{};for(q in V.timeout&&(S.timeout=V.timeout),S.ontimeout=S.onerror=function(N){N.timeout="timeout"==N.type,n(N)},S.open(N,U.href||U),S.onload=function(){for(z=S.getAllResponseHeaders().trim().split(/[\r\n]+/),A(S,S);i=z.shift();)i=i.split(": "),S.headers[i.shift().toLowerCase()]=i.join(": ");if((i=S.headers["content-type"])&&~i.indexOf("application/json"))try{S.data=JSON.parse(S.data,V.reviver)}catch(N){return A(S,N),n(N)}(S.status>=400?n:t)(S)},typeof FormData<"u"&&E instanceof FormData||E&&"object"==typeof E&&(p["content-type"]="application/json",E=JSON.stringify(E)),S.withCredentials=!!V.withCredentials,p)S.setRequestHeader(q,p[q]);S.send(E)}))}V.r(U),V.d(U,{del:()=>z,get:()=>n,patch:()=>i,post:()=>q,put:()=>S,send:()=>t});var n=t.bind(t,"GET"),q=t.bind(t,"POST"),i=t.bind(t,"PATCH"),z=t.bind(t,"DELETE"),S=t.bind(t,"PUT")},14637:(N,U,V)=>{"use strict";V.d(U,{d:()=>p});const A=.5*(Math.sqrt(3)-1),t=(3-Math.sqrt(3))/6,n=1/3,q=1/6,i=(Math.sqrt(5)-1)/4,z=(5-Math.sqrt(5))/20,S=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),E=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const p=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const U="function"==typeof N?N:function(N){let U=0,V=0,A=0,t=1;const n=function(){let N=4022871197;return function(U){U=U.toString();for(let V=0;V<U.length;V++){N+=U.charCodeAt(V);let A=.02519603282416938*N;N=A>>>0,A-=N,A*=N,N=A>>>0,A-=N,N+=4294967296*A}return 2.3283064365386963e-10*(N>>>0)}}();U=n(" "),V=n(" "),A=n(" "),U-=n(N),U<0&&(U+=1);V-=n(N),V<0&&(V+=1);A-=n(N),A<0&&(A+=1);return function(){const N=2091639*U+2.3283064365386963e-10*t;return U=V,V=A,A=N-(t=0|N)}}(N);this.p=function(N){const U=new Uint8Array(256);for(let V=0;V<256;V++)U[V]=V;for(let V=0;V<255;V++){const A=V+~~(N()*(256-V)),t=U[V];U[V]=U[A],U[A]=t}return U}(U),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let V=0;V<512;V++)this.perm[V]=this.p[255&V],this.permMod12[V]=this.perm[V]%12}noise2D(N,U){const V=this.permMod12,n=this.perm;let q=0,i=0,z=0;const E=(N+U)*A,p=Math.floor(N+E),k=Math.floor(U+E),B=(p+k)*t,C=N-(p-B),x=U-(k-B);let J,d;C>x?(J=1,d=0):(J=0,d=1);const r=C-J+t,v=x-d+t,h=C-1+2*t,c=x-1+2*t,H=255&p,Y=255&k;let W=.5-C*C-x*x;if(W>=0){const N=3*V[H+n[Y]];W*=W,q=W*W*(S[N]*C+S[N+1]*x)}let s=.5-r*r-v*v;if(s>=0){const N=3*V[H+J+n[Y+d]];s*=s,i=s*s*(S[N]*r+S[N+1]*v)}let M=.5-h*h-c*c;if(M>=0){const N=3*V[H+1+n[Y+1]];M*=M,z=M*M*(S[N]*h+S[N+1]*c)}return 70*(q+i+z)}noise3D(N,U,V){const A=this.permMod12,t=this.perm;let i,z,E,p;const k=(N+U+V)*n,B=Math.floor(N+k),C=Math.floor(U+k),x=Math.floor(V+k),J=(B+C+x)*q,d=N-(B-J),r=U-(C-J),v=V-(x-J);let h,c,H,Y,W,s;d>=r?r>=v?(h=1,c=0,H=0,Y=1,W=1,s=0):d>=v?(h=1,c=0,H=0,Y=1,W=0,s=1):(h=0,c=0,H=1,Y=1,W=0,s=1):r<v?(h=0,c=0,H=1,Y=0,W=1,s=1):d<v?(h=0,c=1,H=0,Y=0,W=1,s=1):(h=0,c=1,H=0,Y=1,W=1,s=0);const M=d-h+q,a=r-c+q,mN=v-H+q,w=d-Y+2*q,X=r-W+2*q,e=v-s+2*q,Q=d-1+.5,u=r-1+.5,L=v-1+.5,I=255&B,o=255&C,R=255&x;let D=.6-d*d-r*r-v*v;if(D<0)i=0;else{const N=3*A[I+t[o+t[R]]];D*=D,i=D*D*(S[N]*d+S[N+1]*r+S[N+2]*v)}let G=.6-M*M-a*a-mN*mN;if(G<0)z=0;else{const N=3*A[I+h+t[o+c+t[R+H]]];G*=G,z=G*G*(S[N]*M+S[N+1]*a+S[N+2]*mN)}let g=.6-w*w-X*X-e*e;if(g<0)E=0;else{const N=3*A[I+Y+t[o+W+t[R+s]]];g*=g,E=g*g*(S[N]*w+S[N+1]*X+S[N+2]*e)}let l=.6-Q*Q-u*u-L*L;if(l<0)p=0;else{const N=3*A[I+1+t[o+1+t[R+1]]];l*=l,p=l*l*(S[N]*Q+S[N+1]*u+S[N+2]*L)}return 32*(i+z+E+p)}noise4D(N,U,V,A){const t=this.perm;let n,q,S,p,k;const B=(N+U+V+A)*i,C=Math.floor(N+B),x=Math.floor(U+B),J=Math.floor(V+B),d=Math.floor(A+B),r=(C+x+J+d)*z,v=N-(C-r),h=U-(x-r),c=V-(J-r),H=A-(d-r);let Y=0,W=0,s=0,M=0;v>h?Y++:W++,v>c?Y++:s++,v>H?Y++:M++,h>c?W++:s++,h>H?W++:M++,c>H?s++:M++;const a=Y>=3?1:0,mN=W>=3?1:0,w=s>=3?1:0,X=M>=3?1:0,e=Y>=2?1:0,Q=W>=2?1:0,u=s>=2?1:0,L=M>=2?1:0,I=Y>=1?1:0,o=W>=1?1:0,R=s>=1?1:0,D=M>=1?1:0,G=v-a+z,g=h-mN+z,l=c-w+z,K=H-X+z,j=v-e+2*z,F=h-Q+2*z,P=c-u+2*z,T=H-L+2*z,f=v-I+3*z,O=h-o+3*z,Z=c-R+3*z,b=H-D+3*z,y=v-1+4*z,NN=h-1+4*z,UN=c-1+4*z,VN=H-1+4*z,AN=255&C,tN=255&x,nN=255&J,qN=255&d;let iN=.6-v*v-h*h-c*c-H*H;if(iN<0)n=0;else{const N=t[AN+t[tN+t[nN+t[qN]]]]%32*4;iN*=iN,n=iN*iN*(E[N]*v+E[N+1]*h+E[N+2]*c+E[N+3]*H)}let zN=.6-G*G-g*g-l*l-K*K;if(zN<0)q=0;else{const N=t[AN+a+t[tN+mN+t[nN+w+t[qN+X]]]]%32*4;zN*=zN,q=zN*zN*(E[N]*G+E[N+1]*g+E[N+2]*l+E[N+3]*K)}let SN=.6-j*j-F*F-P*P-T*T;if(SN<0)S=0;else{const N=t[AN+e+t[tN+Q+t[nN+u+t[qN+L]]]]%32*4;SN*=SN,S=SN*SN*(E[N]*j+E[N+1]*F+E[N+2]*P+E[N+3]*T)}let EN=.6-f*f-O*O-Z*Z-b*b;if(EN<0)p=0;else{const N=t[AN+I+t[tN+o+t[nN+R+t[qN+D]]]]%32*4;EN*=EN,p=EN*EN*(E[N]*f+E[N+1]*O+E[N+2]*Z+E[N+3]*b)}let pN=.6-y*y-NN*NN-UN*UN-VN*VN;if(pN<0)k=0;else{const N=t[AN+1+t[tN+1+t[nN+1+t[qN+1]]]]%32*4;pN*=pN,k=pN*pN*(E[N]*y+E[N+1]*NN+E[N+2]*UN+E[N+3]*VN)}return 27*(n+q+S+p+k)}}}}]);