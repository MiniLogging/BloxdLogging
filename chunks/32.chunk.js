/*! For license information please see 948nlq.32.8c2c50b4.chunk.js.LICENSE.txt */
(self.ksd6jhs1yr=self.ksd6jhs1yr||[]).push([[32],{14428:(C,c,d)=>{"use strict";var b=d(14436),X=d(14438),P=d(14441);d.g.__TYPEDARRAY_POOL||(d.g.__TYPEDARRAY_POOL={UINT8:X([32,0]),UINT16:X([32,0]),UINT32:X([32,0]),INT8:X([32,0]),INT16:X([32,0]),INT32:X([32,0]),FLOAT:X([32,0]),DOUBLE:X([32,0]),DATA:X([32,0]),UINT8C:X([32,0]),BUFFER:X([32,0])});var V="undefined"!==typeof Uint8ClampedArray,R=d.g.__TYPEDARRAY_POOL;R.UINT8C||(R.UINT8C=X([32,0])),R.BUFFER||(R.BUFFER=X([32,0]));var p=R.DATA,j=R.BUFFER;function g(C){if(C){var c=C.length||C.byteLength,d=b.log2(c);p[d].push(C)}}function k(C){C=b.nextPow2(C);var c=b.log2(C),d=p[c];return d.length>0?d.pop():new ArrayBuffer(C)}function Z(C){return new Uint8Array(k(C),0,C)}function U(C){return new Uint16Array(k(2*C),0,C)}function A(C){return new Uint32Array(k(4*C),0,C)}function u(C){return new Int8Array(k(C),0,C)}function q(C){return new Int16Array(k(2*C),0,C)}function B(C){return new Int32Array(k(4*C),0,C)}function t(C){return new Float32Array(k(4*C),0,C)}function e(C){return new Float64Array(k(8*C),0,C)}function n(C){return V?new Uint8ClampedArray(k(C),0,C):Z(C)}function W(C){return new DataView(k(C),0,C)}c.free=function(C){if(P(C))j[b.log2(C.length)].push(C);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(C)&&(C=C.buffer),!C)return;var c=C.length||C.byteLength,d=0|b.log2(c);p[d].push(C)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(C){g(C.buffer)},c.freeArrayBuffer=g,c.freeBuffer=function(C){j[b.log2(C.length)].push(C)},c.malloc=function(C,c){if(void 0===c||"arraybuffer"===c)return k(C);switch(c){case"uint8":return Z(C);case"uint16":return U(C);case"uint32":return A(C);case"int8":return u(C);case"int16":return q(C);case"int32":return B(C);case"float":case"float32":return t(C);case"double":case"float64":return e(C);case"uint8_clamped":return n(C);case"buffer":throw"Buffer not supported";case"data":case"dataview":return W(C);default:return null}return null},c.mallocArrayBuffer=k,c.mallocUint8=Z,c.mallocUint16=U,c.mallocUint32=A,c.mallocInt8=u,c.mallocInt16=q,c.mallocInt32=B,c.mallocFloat32=c.mallocFloat=t,c.mallocFloat64=c.mallocDouble=e,c.mallocUint8Clamped=n,c.mallocDataView=W,c.clearCache=function(){for(var C=0;C<32;++C)R.UINT8[C].length=0,R.UINT16[C].length=0,R.UINT32[C].length=0,R.INT8[C].length=0,R.INT16[C].length=0,R.INT32[C].length=0,R.FLOAT[C].length=0,R.DOUBLE[C].length=0,R.UINT8C[C].length=0,p[C].length=0,j[C].length=0}},14518:(C,c,d)=>{C.exports=X;var b=d(13226);function X(C,c){if(!(this instanceof X))return new X(C,c);var d=b.create();b.add(d,C,c),this.base=b.min(b.create(),C,d),this.Lk=b.clone(c),this.max=b.max(b.create(),C,d),this.mag=b.length(this.Lk)}var P=X.prototype;P.width=function(){return this.Lk[0]},P.height=function(){return this.Lk[1]},P.depth=function(){return this.Lk[2]},P.x0=function(){return this.base[0]},P.y0=function(){return this.base[1]},P.z0=function(){return this.base[2]},P.x1=function(){return this.max[0]},P.y1=function(){return this.max[1]},P.z1=function(){return this.max[2]},P.translate=function(C){return b.add(this.max,this.max,C),b.add(this.base,this.base,C),this},P.setPosition=function(C){return b.add(this.max,C,this.Lk),b.i(this.base,C),this},P.expand=function(C){var c=b.create(),d=b.create();return b.max(c,C.max,this.max),b.min(d,C.base,this.base),b.Xd(c,c,d),new X(d,c)},P.intersects=function(C){return!(C.base[0]>this.max[0])&&(!(C.base[1]>this.max[1])&&(!(C.base[2]>this.max[2])&&(!(C.max[0]<this.base[0])&&(!(C.max[1]<this.base[1])&&!(C.max[2]<this.base[2])))))},P.touches=function(C){var c=this.union(C);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},P.union=function(C){if(!this.intersects(C))return null;var c=Math.max(C.base[0],this.base[0]),d=Math.max(C.base[1],this.base[1]),b=Math.max(C.base[2],this.base[2]);return new X([c,d,b],[Math.min(C.max[0],this.max[0])-c,Math.min(C.max[1],this.max[1])-d,Math.min(C.max[2],this.max[2])-b])}},14436:(C,c)=>{"use strict";function d(C){var c=32;return(C&=-C)&&c--,65535&C&&(c-=16),16711935&C&&(c-=8),252645135&C&&(c-=4),858993459&C&&(c-=2),1431655765&C&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(C){return(C>0)-(C<0)},c.abs=function(C){var c=C>>31;return(C^c)-c},c.min=function(C,c){return c^(C^c)&-(C<c)},c.max=function(C,c){return C^(C^c)&-(C<c)},c.isPow2=function(C){return!(C&C-1)&&!!C},c.log2=function(C){var c,d;return c=(C>65535)<<4,c|=d=((C>>>=c)>255)<<3,c|=d=((C>>>=d)>15)<<2,(c|=d=((C>>>=d)>3)<<1)|(C>>>=d)>>1},c.log10=function(C){return C>=1e9?9:C>=1e8?8:C>=1e7?7:C>=1e6?6:C>=1e5?5:C>=1e4?4:C>=1e3?3:C>=100?2:C>=10?1:0},c.popCount=function(C){return 16843009*((C=(858993459&(C-=C>>>1&1431655765))+(C>>>2&858993459))+(C>>>4)&252645135)>>>24},c.countTrailingZeros=d,c.nextPow2=function(C){return C+=0===C,--C,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)+1},c.prevPow2=function(C){return C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)-(C>>>1)},c.parity=function(C){return C^=C>>>16,C^=C>>>8,C^=C>>>4,27030>>>(C&=15)&1};var b=new Array(256);!function(C){for(var c=0;c<256;++c){var d=c,b=c,X=7;for(d>>>=1;d;d>>>=1)b<<=1,b|=1&d,--X;C[c]=b<<X&255}}(b),c.reverse=function(C){return b[255&C]<<24|b[C>>>8&255]<<16|b[C>>>16&255]<<8|b[C>>>24&255]},c.interleave2=function(C,c){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C&=65535)|C<<8))|C<<4))|C<<2))|C<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(C,c){return(C=65535&((C=16711935&((C=252645135&((C=858993459&((C=C>>>c&1431655765)|C>>>1))|C>>>2))|C>>>4))|C>>>16))<<16>>16},c.interleave3=function(C,c,d){return C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2),(C|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<2},c.deinterleave3=function(C,c){return(C=1023&((C=4278190335&((C=251719695&((C=3272356035&((C=C>>>c&1227133513)|C>>>2))|C>>>4))|C>>>8))|C>>>16))<<22>>22},c.nextCombination=function(C){var c=C|C-1;return c+1|(~c&-~c)-1>>>d(C)+1}},14423:(C,c,d)=>{"use strict";C.exports=function(C,c,d){switch(arguments.length){case 1:return b=[],j(X=C,X,g,!0),b;case 2:return"function"===typeof c?j(C,C,c,!0):function(C,c){return b=[],j(C,c,g,!1),b}(C,c);case 3:return j(C,c,d,!1);default:throw new Error("box-intersect: Invalid arguments")}var X};var b,X=d(14428),P=d(14450),V=d(14463);function R(C,c){for(var d=0;d<C;++d)if(!(c[d]<=c[d+C]))return!0;return!1}function p(C,c,d,b){for(var X=0,P=0,V=0,p=C.length;V<p;++V){var j=C[V];if(!R(c,j)){for(var g=0;g<2*c;++g)d[X++]=j[g];b[P++]=V}}return P}function j(C,c,d,b){var R=C.length,j=c.length;if(!(R<=0||j<=0)){var g=C[0].length>>>1;if(!(g<=0)){var k,Z=X.mallocDouble(2*g*R),U=X.mallocInt32(R);if((R=p(C,g,Z,U))>0){if(1===g&&b)P.init(R),k=P.sweepComplete(g,d,0,R,Z,U,0,R,Z,U);else{var A=X.mallocDouble(2*g*j),u=X.mallocInt32(j);(j=p(c,g,A,u))>0&&(P.init(R+j),k=1===g?P.sweepBipartite(g,d,0,R,Z,U,0,j,A,u):V(g,d,b,R,Z,U,j,A,u),X.free(A),X.free(u))}X.free(Z),X.free(U)}return k}}}function g(C,c){b.push([C,c])}},14468:(C,c)=>{"use strict";var d="d",b="ax",X="fp",P="es",V="rs",R="re",p="rb",j="bs",g="be",k="bb",Z=[d,b,"vv",V,R,p,"ri",j,g,k,"bi"];function U(C){var c="bruteForce"+(C?"Full":"Partial"),b=[],V=Z.slice();C||V.splice(3,0,X);var R=["function "+c+"("+V.join()+"){"];function p(c,X){var V=function(C,c,b){var X="bruteForce"+(C?"Red":"Blue")+(c?"Flip":"")+(b?"Full":""),V=["function ",X,"(",Z.join(),"){","var ",P,"=2*",d,";"],R="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",p="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(b?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return C?V.push(R,"Q",":",p):V.push(p,"Q",":",R),b?V.push("if(y1<x0||x1<y0)continue;"):c?V.push("if(y0<=x0||x1<y0)continue;"):V.push("if(y0<x0||x1<y0)continue;"),V.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?V.push("yi,xi"):V.push("xi,yi"),V.push(");if(rv!==void 0)return rv;}}}"),{name:X,code:V.join("")}}(c,X,C);b.push(V.code),R.push("return "+V.name+"("+Z.join()+");")}R.push("if(re-rs>be-bs){"),C?(p(!0,!1),R.push("}else{"),p(!1,!1)):(R.push("if(fp){"),p(!0,!0),R.push("}else{"),p(!0,!1),R.push("}}else{if(fp){"),p(!1,!0),R.push("}else{"),p(!1,!1),R.push("}")),R.push("}}return "+c);var j=b.join("")+R.join("");return new Function(j)()}c.partial=U(!1),c.full=U(!0)},14463:(C,c,d)=>{"use strict";C.exports=function(C,c,d,P,g,i,h,L,f){!function(C,c){var d=8*X.log2(c+1)*(C+1)|0,P=X.nextPow2(n*d);E.length<P&&(b.free(E),E=b.mallocInt32(P));var V=X.nextPow2(W*d);N.length<V&&(b.free(N),N=b.mallocDouble(V))}(C,P+h);var T,z=0,w=2*C;r(z++,0,0,P,0,h,d?16:0,-1/0,1/0),d||r(z++,0,0,h,0,P,1,-1/0,1/0);for(;z>0;){var J=(z-=1)*n,y=E[J],x=E[J+1],H=E[J+2],v=E[J+3],D=E[J+4],s=E[J+5],mC=z*W,Q=N[mC],I=N[mC+1],o=1&s,F=!!(16&s),Y=g,l=i,S=L,G=f;if(o&&(Y=L,l=f,S=g,G=i),!(2&s&&x>=(H=q(C,y,x,H,Y,l,I)))&&!(4&s&&(x=B(C,y,x,H,Y,l,Q))>=H)){var a=H-x,O=D-v;if(F){if(C*a*(a+O)<U){if(void 0!==(T=p.scanComplete(C,y,c,x,H,Y,l,v,D,S,G)))return T;continue}}else{if(C*Math.min(a,O)<k){if(void 0!==(T=V(C,y,c,o,x,H,Y,l,v,D,S,G)))return T;continue}if(C*a*O<Z){if(void 0!==(T=p.scanBipartite(C,y,c,o,x,H,Y,l,v,D,S,G)))return T;continue}}var CC=A(C,y,x,H,Y,l,Q,I);if(x<CC)if(C*(CC-x)<k){if(void 0!==(T=R(C,y+1,c,x,CC,Y,l,v,D,S,G)))return T}else if(y===C-2){if(void 0!==(T=o?p.sweepBipartite(C,c,v,D,S,G,x,CC,Y,l):p.sweepBipartite(C,c,x,CC,Y,l,v,D,S,G)))return T}else r(z++,y+1,x,CC,v,D,o,-1/0,1/0),r(z++,y+1,v,D,x,CC,1^o,-1/0,1/0);if(CC<H){var cC=j(C,y,v,D,S,G),dC=S[w*cC+y],bC=u(C,y,cC,D,S,G,dC);if(bC<D&&r(z++,y,CC,H,bC,D,(4|o)+(F?16:0),dC,I),v<cC&&r(z++,y,CC,H,v,cC,(2|o)+(F?16:0),Q,dC),cC+1===bC){if(void 0!==(T=F?K(C,y,c,CC,H,Y,l,cC,S,G[cC]):M(C,y,c,o,CC,H,Y,l,cC,S,G[cC])))return T}else if(cC<bC){var XC;if(F){if(CC<(XC=t(C,y,CC,H,Y,l,dC))){var PC=u(C,y,CC,XC,Y,l,dC);if(y===C-2){if(CC<PC&&void 0!==(T=p.sweepComplete(C,c,CC,PC,Y,l,cC,bC,S,G)))return T;if(PC<XC&&void 0!==(T=p.sweepBipartite(C,c,PC,XC,Y,l,cC,bC,S,G)))return T}else CC<PC&&r(z++,y+1,CC,PC,cC,bC,16,-1/0,1/0),PC<XC&&(r(z++,y+1,PC,XC,cC,bC,0,-1/0,1/0),r(z++,y+1,cC,bC,PC,XC,1,-1/0,1/0))}}else CC<(XC=o?e(C,y,CC,H,Y,l,dC):t(C,y,CC,H,Y,l,dC))&&(y===C-2?T=o?p.sweepBipartite(C,c,cC,bC,S,G,CC,XC,Y,l):p.sweepBipartite(C,c,CC,XC,Y,l,cC,bC,S,G):(r(z++,y+1,CC,XC,cC,bC,o,-1/0,1/0),r(z++,y+1,cC,bC,CC,XC,1^o,-1/0,1/0)))}}}}};var b=d(14428),X=d(14436),P=d(14468),V=P.partial,R=P.full,p=d(14450),j=d(14472),g=d(14480),k=128,Z=1<<22,U=1<<22,A=g("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),u=g("lo===p0",["p0"]),q=g("lo<p0",["p0"]),B=g("hi<=p0",["p0"]),t=g("lo<=p0&&p0<=hi",["p0"]),e=g("lo<p0&&p0<=hi",["p0"]),n=6,W=2,E=b.mallocInt32(1024),N=b.mallocDouble(1024);function r(C,c,d,b,X,P,V,R,p){var j=n*C;E[j]=c,E[j+1]=d,E[j+2]=b,E[j+3]=X,E[j+4]=P,E[j+5]=V;var g=W*C;N[g]=R,N[g+1]=p}function M(C,c,d,b,X,P,V,R,p,j,g){var k=2*C,Z=p*k,U=j[Z+c];C:for(var A=X,u=X*k;A<P;++A,u+=k){var q=V[u+c],B=V[u+c+C];if(!(U<q||B<U)&&(!b||U!==q)){for(var t,e=R[A],n=c+1;n<C;++n){q=V[u+n],B=V[u+n+C];var W=j[Z+n],E=j[Z+n+C];if(B<W||E<q)continue C}if(void 0!==(t=b?d(g,e):d(e,g)))return t}}}function K(C,c,d,b,X,P,V,R,p,j){var g=2*C,k=R*g,Z=p[k+c];C:for(var U=b,A=b*g;U<X;++U,A+=g){var u=V[U];if(u!==j){var q=P[A+c],B=P[A+c+C];if(!(Z<q||B<Z)){for(var t=c+1;t<C;++t){q=P[A+t],B=P[A+t+C];var e=p[k+t],n=p[k+t+C];if(B<e||n<q)continue C}var W=d(u,j);if(void 0!==W)return W}}}}},14472:(C,c,d)=>{"use strict";C.exports=function(C,c,d,V,R,p){if(V<=d+1)return d;var j=d,g=V,k=V+d>>>1,Z=2*C,U=k,A=R[Z*k+c];for(;j<g;){if(g-j<X){P(C,c,j,g,R,p),A=R[Z*k+c];break}var u=g-j,q=Math.random()*u+j|0,B=R[Z*q+c],t=Math.random()*u+j|0,e=R[Z*t+c],n=Math.random()*u+j|0,W=R[Z*n+c];B<=e?W>=e?(U=t,A=e):B>=W?(U=q,A=B):(U=n,A=W):e>=W?(U=t,A=e):W>=B?(U=q,A=B):(U=n,A=W);for(var E=Z*(g-1),N=Z*U,r=0;r<Z;++r,++E,++N){var M=R[E];R[E]=R[N],R[N]=M}var K=p[g-1];p[g-1]=p[U],p[U]=K;for(E=Z*(g-1),N=Z*(U=b(C,c,j,g-1,R,p,A)),r=0;r<Z;++r,++E,++N){M=R[E];R[E]=R[N],R[N]=M}K=p[g-1];if(p[g-1]=p[U],p[U]=K,k<U){for(g=U-1;j<g&&R[Z*(g-1)+c]===A;)g-=1;g+=1}else{if(!(U<k))break;for(j=U+1;j<g&&R[Z*j+c]===A;)j+=1}}return b(C,c,d,k,R,p,R[Z*k+c])};var b=d(14480)("lo<p0",["p0"]),X=8;function P(C,c,d,b,X,P){for(var V=2*C,R=V*(d+1)+c,p=d+1;p<b;++p,R+=V)for(var j=X[R],g=p,k=V*(p-1);g>d&&X[k+c]>j;--g,k-=V){for(var Z=k,U=k+V,A=0;A<V;++A,++Z,++U){var u=X[Z];X[Z]=X[U],X[U]=u}var q=P[g];P[g]=P[g-1],P[g-1]=q}}},14480:C=>{"use strict";C.exports=function(C,d){var b="abcdef".split("").concat(d),X=[];C.indexOf("lo")>=0&&X.push("lo=e[k+n]");C.indexOf("hi")>=0&&X.push("hi=e[k+o]");return b.push(c.replace("_",X.join()).replace("$",C)),Function.apply(void 0,b)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14454:C=>{"use strict";C.exports=function(C,b){b<=4*c?d(0,b-1,C):j(0,b-1,C)};var c=32;function d(C,c,d){for(var b=2*(C+1),X=C+1;X<=c;++X){for(var P=d[b++],V=d[b++],R=X,p=b-2;R-- >C;){var j=d[p-2],g=d[p-1];if(j<P)break;if(j===P&&g<V)break;d[p]=j,d[p+1]=g,p-=2}d[p]=P,d[p+1]=V}}function b(C,c,d){c*=2;var b=d[C*=2],X=d[C+1];d[C]=d[c],d[C+1]=d[c+1],d[c]=b,d[c+1]=X}function X(C,c,d){c*=2,d[C*=2]=d[c],d[C+1]=d[c+1]}function P(C,c,d,b){c*=2,d*=2;var X=b[C*=2],P=b[C+1];b[C]=b[c],b[C+1]=b[c+1],b[c]=b[d],b[c+1]=b[d+1],b[d]=X,b[d+1]=P}function V(C,c,d,b,X){c*=2,X[C*=2]=X[c],X[c]=d,X[C+1]=X[c+1],X[c+1]=b}function R(C,c,d){c*=2;var b=d[C*=2],X=d[c];return!(b<X)&&(b!==X||d[C+1]>d[c+1])}function p(C,c,d,b){var X=b[C*=2];return X<c||X===c&&b[C+1]<d}function j(C,g,k){var Z=(g-C+1)/6|0,U=C+Z,A=g-Z,u=C+g>>1,q=u-Z,B=u+Z,t=U,e=q,n=u,W=B,E=A,N=C+1,r=g-1,M=0;R(t,e,k)&&(M=t,t=e,e=M),R(W,E,k)&&(M=W,W=E,E=M),R(t,n,k)&&(M=t,t=n,n=M),R(e,n,k)&&(M=e,e=n,n=M),R(t,W,k)&&(M=t,t=W,W=M),R(n,W,k)&&(M=n,n=W,W=M),R(e,E,k)&&(M=e,e=E,E=M),R(e,n,k)&&(M=e,e=n,n=M),R(W,E,k)&&(M=W,W=E,E=M);for(var K=k[2*e],i=k[2*e+1],h=k[2*W],L=k[2*W+1],f=2*t,T=2*n,z=2*E,w=2*U,J=2*u,y=2*A,x=0;x<2;++x){var H=k[f+x],v=k[T+x],D=k[z+x];k[w+x]=H,k[J+x]=v,k[y+x]=D}X(q,C,k),X(B,g,k);for(var s=N;s<=r;++s)if(p(s,K,i,k))s!==N&&b(s,N,k),++N;else if(!p(s,h,L,k))for(;;){if(p(r,h,L,k)){p(r,K,i,k)?(P(s,N,r,k),++N,--r):(b(s,r,k),--r);break}if(--r<s)break}V(C,N-1,K,i,k),V(g,r+1,h,L,k),N-2-C<=c?d(C,N-2,k):j(C,N-2,k),g-(r+2)<=c?d(r+2,g,k):j(r+2,g,k),r-N<=c?d(N,r,k):j(N,r,k)}},14450:(C,c,d)=>{"use strict";C.exports={init:function(C){var c=X.nextPow2(C);p.length<c&&(b.free(p),p=b.mallocInt32(c));j.length<c&&(b.free(j),j=b.mallocInt32(c));g.length<c&&(b.free(g),g=b.mallocInt32(c));k.length<c&&(b.free(k),k=b.mallocInt32(c));Z.length<c&&(b.free(Z),Z=b.mallocInt32(c));U.length<c&&(b.free(U),U=b.mallocInt32(c));var d=8*c;A.length<d&&(b.free(A),A=b.mallocDouble(d))},sweepBipartite:function(C,c,d,b,X,R,Z,U,B,t){for(var e=0,n=2*C,W=C-1,E=n-1,N=d;N<b;++N){var r=R[N],M=n*N;A[e++]=X[M+W],A[e++]=-(r+1),A[e++]=X[M+E],A[e++]=r}for(N=Z;N<U;++N){r=t[N]+V;var K=n*N;A[e++]=B[K+W],A[e++]=-r,A[e++]=B[K+E],A[e++]=r}var i=e>>>1;P(A,i);var h=0,L=0;for(N=0;N<i;++N){var f=0|A[2*N+1];if(f>=V)u(g,k,L--,f=f-V|0);else if(f>=0)u(p,j,h--,f);else if(f<=-V){f=-f-V|0;for(var T=0;T<h;++T){if(void 0!==(z=c(p[T],f)))return z}q(g,k,L++,f)}else{f=-f-1|0;for(T=0;T<L;++T){var z;if(void 0!==(z=c(f,g[T])))return z}q(p,j,h++,f)}}},sweepComplete:function(C,c,d,b,X,V,R,B,t,e){for(var n=0,W=2*C,E=C-1,N=W-1,r=d;r<b;++r){var M=V[r]+1<<1,K=W*r;A[n++]=X[K+E],A[n++]=-M,A[n++]=X[K+N],A[n++]=M}for(r=R;r<B;++r){M=e[r]+1<<1;var i=W*r;A[n++]=t[i+E],A[n++]=1|-M,A[n++]=t[i+N],A[n++]=1|M}var h=n>>>1;P(A,h);var L=0,f=0,T=0;for(r=0;r<h;++r){var z=0|A[2*r+1],w=1&z;if(r<h-1&&z>>1===A[2*r+3]>>1&&(w=2,r+=1),z<0){for(var J=-(z>>1)-1,y=0;y<T;++y){if(void 0!==(x=c(Z[y],J)))return x}if(0!==w)for(y=0;y<L;++y){if(void 0!==(x=c(p[y],J)))return x}if(1!==w)for(y=0;y<f;++y){var x;if(void 0!==(x=c(g[y],J)))return x}0===w?q(p,j,L++,J):1===w?q(g,k,f++,J):2===w&&q(Z,U,T++,J)}else{J=(z>>1)-1;0===w?u(p,j,L--,J):1===w?u(g,k,f--,J):2===w&&u(Z,U,T--,J)}}},scanBipartite:function(C,c,d,b,X,R,g,k,Z,U,B,t){var e=0,n=2*C,W=c,E=c+C,N=1,r=1;b?r=V:N=V;for(var M=X;M<R;++M){var K=M+N,i=n*M;A[e++]=g[i+W],A[e++]=-K,A[e++]=g[i+E],A[e++]=K}for(M=Z;M<U;++M){K=M+r;var h=n*M;A[e++]=B[h+W],A[e++]=-K}var L=e>>>1;P(A,L);var f=0;for(M=0;M<L;++M){var T=0|A[2*M+1];if(T<0){var z=!1;if((K=-T)>=V?(z=!b,K-=V):(z=!!b,K-=1),z)q(p,j,f++,K);else{var w=t[K],J=n*K,y=B[J+c+1],x=B[J+c+1+C];C:for(var H=0;H<f;++H){var v=p[H],D=n*v;if(!(x<g[D+c+1]||g[D+c+1+C]<y)){for(var s=c+2;s<C;++s)if(B[J+s+C]<g[D+s]||g[D+s+C]<B[J+s])continue C;var mC,Q=k[v];if(void 0!==(mC=b?d(w,Q):d(Q,w)))return mC}}}}else u(p,j,f--,T-N)}},scanComplete:function(C,c,d,b,X,R,j,g,k,Z,U){for(var u=0,q=2*C,B=c,t=c+C,e=b;e<X;++e){var n=e+V,W=q*e;A[u++]=R[W+B],A[u++]=-n,A[u++]=R[W+t],A[u++]=n}for(e=g;e<k;++e){n=e+1;var E=q*e;A[u++]=Z[E+B],A[u++]=-n}var N=u>>>1;P(A,N);var r=0;for(e=0;e<N;++e){var M=0|A[2*e+1];if(M<0){if((n=-M)>=V)p[r++]=n-V;else{var K=U[n-=1],i=q*n,h=Z[i+c+1],L=Z[i+c+1+C];C:for(var f=0;f<r;++f){var T=p[f],z=j[T];if(z===K)break;var w=q*T;if(!(L<R[w+c+1]||R[w+c+1+C]<h)){for(var J=c+2;J<C;++J)if(Z[i+J+C]<R[w+J]||R[w+J+C]<Z[i+J])continue C;var y=d(z,K);if(void 0!==y)return y}}}}else{for(n=M-V,f=r-1;f>=0;--f)if(p[f]===n){for(J=f+1;J<r;++J)p[J-1]=p[J];break}--r}}}};var b=d(14428),X=d(14436),P=d(14454),V=1<<28,R=1024,p=b.mallocInt32(R),j=b.mallocInt32(R),g=b.mallocInt32(R),k=b.mallocInt32(R),Z=b.mallocInt32(R),U=b.mallocInt32(R),A=b.mallocDouble(8192);function u(C,c,d,b){var X=c[b],P=C[d-1];C[X]=P,c[P]=X}function q(C,c,d,b){C[d]=b,c[b]=d}},14438:C=>{"use strict";function c(C,d,b){var X=0|C[b];if(X<=0)return[];var P,V=new Array(X);if(b===C.length-1)for(P=0;P<X;++P)V[P]=d;else for(P=0;P<X;++P)V[P]=c(C,d,b+1);return V}C.exports=function(C,d){switch("undefined"===typeof d&&(d=0),typeof C){case"number":if(C>0)return function(C,c){var d,b;for(d=new Array(C),b=0;b<C;++b)d[b]=c;return d}(0|C,d);break;case"object":if("number"===typeof C.length)return c(C,d,0)}return[]}},14400:(C,c,d)=>{C.exports=function(){var C=this;this.components={},this.comps=this.components;var c=this.components,d=1,X={},P=[],V=[],R={timeout:!1,removals:[],multiComps:[]};function p(C,d){var b=c[d],P=X[d],V=P.hash[C];V&&(P.remove(C),b.Pc&&(b.multi?(V.forEach((c=>{c&&b.Pc(C,c)})),V.length=0):b.Pc(C,V)),R.removals.push(P),j())}function j(){R.timeout||(R.timeout=!0,setTimeout(g,1))}function g(){R.timeout=!1,k()}function k(){R.multiComps.length&&function(C){for(var c=0;c<C.length;c++){var{entID:d,data:b}=C[c],X=b.hash[d];if(X){for(var P=0;P<X.length;P++)X[P]||(X.splice(P,1),P--);0===X.length&&(b.remove(d),R.removals.push(b))}}C.length=0}(R.multiComps),R.removals.length&&function(C){for(var c=0;c<C.length;c++){C[c].flush()}C.length=0}(R.removals)}this.FZ=X,this._systems=P,this._renderSystems=V,this.zk=function(c){var b=d++;return Array.isArray(c)&&c.forEach((c=>C.aj(b,c))),b},this.deleteEntity=function(c){return Object.keys(X).forEach((C=>{X[C].hash[c]&&p(c,C)})),C},this.Sk=function(C){if(!C)throw new Error("Missing component definition");var d=C.name;if(!d)throw new Error("Component definition must have a name property.");if("string"!==typeof d)throw new Error("Component name must be a string.");if(""===d)throw new Error("Component name must be a non-empty string.");if(X[d])throw new Error(`Component ${d} already exists.`);var R={};return R.name=d,R.multi=!!C.multi,R.order=isNaN(C.order)?99:C.order,R.stateConstructor=C.stateConstructor||null,R.state=C.state||{},R.IV=C.IV||null,R.Pc=C.Pc||null,R.system=C.system||null,R.dj=C.dj||null,c[d]=R,X[d]=new b,X[d]._pendingMultiCleanup=!1,X[d]._multiCleanupIDs=R.multi?[]:null,R.system&&(P.push(d),P.sort(((C,d)=>c[C].order-c[d].order))),R.dj&&(V.push(d),V.sort(((C,d)=>c[C].order-c[d].order))),d},this.overwriteComponent=function(C,d){var b=c[C];if(!b)throw new Error(`Unknown component: ${C}`);if(!d)throw new Error("Missing component definition");if(b.name!==d.name)throw new Error("Overwriting component must use the same name property.");var R={};R.name=C,R.multi=!!d.multi,R.order=isNaN(d.order)?99:d.order,R.state=d.state||{},R.IV=d.IV||null,R.Pc=d.Pc||null,R.system=d.system||null,R.dj=d.dj||null,c[C]=R,X[C]._pendingMultiCleanup=!1,X[C]._multiCleanupIDs=R.multi?[]:null;var p=P.indexOf(C);R.system&&p<0&&P.push(C),!R.system&&p>=0&&P.splice(p,1),P.sort(((C,d)=>c[C].order-c[d].order));var j=V.indexOf(C);R.dj&&j<0&&V.push(C),!R.dj&&j>=0&&V.splice(j,1),V.sort(((C,d)=>c[C].order-c[d].order));var g=R.state;return this.Ak(C).forEach((C=>{for(var c in g)c in C||(C[c]=g[c]);R.IV&&R.IV(C.Cj,C)})),C},this.deleteComponent=function(d){var b=X[d];if(!b)throw new Error(`Unknown component: ${d}`);b.flush(),b.list.forEach((C=>{C&&p(C.Cj||C[0].Cj,d)}));var R=P.indexOf(d),j=V.indexOf(d);return R>-1&&P.splice(R,1),j>-1&&V.splice(j,1),X[d].dispose(),delete X[d],delete c[d],C},this.aj=function(C,d,b){var P,V=c[d],R=X[d];if(!R)throw new Error(`Unknown component: ${d}.`);if(R.hash[C]&&!V.multi)throw new Error(`Entity ${C} already has component: ${d}.`);if(V.stateConstructor){if(!(P=new V.stateConstructor).hasOwnProperty("Cj"))throw new Error(`Component ${V.name} stateConstructor type does not have property __id`)}else P=Object.assign({},{Cj:C},V.state,b);if(P.Cj=C,V.multi){var p=R.hash[C];p||(p=[],R.add(C,p)),p.push(P)}else R.add(C,P);return V.IV&&V.IV(C,P),this},this.ug=function(C,c){var d=X[c];if(!d)throw new Error(`Unknown component: ${c}.`);return!!d.hash[C]},this.Vg=function(c,d){if(!X[d])throw new Error(`Unknown component: ${d}.`);return p(c,d),C},this.getState=function(C,c){var d=X[c];if(!d)throw new Error(`Unknown component: ${c}.`);return d.hash[C]},this.Ak=function(C){var c=X[C];if(!c)throw new Error(`Unknown component: ${C}.`);return k(),c.list},this.wA=function(C){if(!X[C])throw new Error(`Unknown component: ${C}.`);var c=X[C].hash;return C=>c[C]},this.xA=function(C){if(!X[C])throw new Error(`Unknown component: ${C}.`);var c=X[C].hash;return C=>!!c[C]},this.ap=function(d){k();for(var b=0;b<P.length;b++){var V=P[b],R=c[V],p=X[V];R.system(d,p.list),k()}return C},this.render=function(d){k();for(var b=0;b<V.length;b++){var P=V[b],R=c[P],p=X[P];R.dj(d,p.list),k()}return C},this.removeMultiComponent=function(d,b,P){var V=c[b],p=X[b];if(!p)throw new Error(`Unknown component: ${b}.`);if(!V.multi)throw new Error("removeMultiComponent called on non-multi component");return function(C,c,d,b){var X=d.hash[C];if(X){var P=X[b];P&&(X[b]=null,c.Pc&&c.Pc(C,P),R.multiComps.push({entID:C,data:d}),j())}}(d,V,p,P),C}};var b=d(14405)},14405:C=>{function c(C,c){var d=C._map[c];if(delete C.hash[c],delete C._map[c],d===C.list.length-1)C.list.pop();else{var b=C.list.pop();if(C.list[d]=b,null===b||null===b[0]){var X=C.list.length;for(var P in C._map)if(C._map[P]===X)return void(C._map[P]=d)}else{var V=b.Cj||b[0].Cj;C._map[V]=d}}}C.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(C,c){if("number"===typeof this._map[C]){var d=this._map[C];this.hash[C]=c,this.list[d]=c}else this._map[C]=this.list.length,this.hash[C]=c,this.list.push(c)}remove(C){var c=this._map[C];this.hash[C]=null,this.list[c]=null,this._pendingRemovals.push(C)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var C=0;C<this._pendingRemovals.length;C++){var d=this._pendingRemovals[C];null===this.hash[d]&&c(this,d)}this._pendingRemovals.length=0}}},14355:C=>{"use strict";var c,d="object"===typeof Reflect?Reflect:null,b=function(C,c,d){return Function.prototype.apply.call(C,c,d)};c=d&&"function"===typeof d.ownKeys?d.ownKeys:Object.getOwnPropertySymbols?function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:function(C){return Object.getOwnPropertyNames(C)};var X=Number.isNaN||function(C){return C!==C};function P(){P.init.call(this)}C.exports=P,C.exports.once=function(C,c){return new Promise((function(d,b){function X(d){C.removeListener(c,P),b(d)}function P(){"function"===typeof C.removeListener&&C.removeListener("error",X),d([].slice.call(arguments))}u(C,c,P,{once:!0}),"error"!==c&&function(C,c,d){"function"===typeof C.on&&u(C,"error",c,d)}(C,X,{once:!0})}))},P.EventEmitter=P,P.prototype._events=void 0,P.prototype._eventsCount=0,P.prototype._maxListeners=void 0;var V=10;function R(C){if("function"!==typeof C)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}function p(C){return void 0===C._maxListeners?P.defaultMaxListeners:C._maxListeners}function j(C,c,d,b){var X,P,V,j;if(R(d),void 0===(P=C._events)?(P=C._events=Object.create(null),C._eventsCount=0):(void 0!==P.newListener&&(C.emit("newListener",c,d.listener?d.listener:d),P=C._events),V=P[c]),void 0===V)V=P[c]=d,++C._eventsCount;else if("function"===typeof V?V=P[c]=b?[d,V]:[V,d]:b?V.unshift(d):V.push(d),(X=p(C))>0&&V.length>X&&!V.warned){V.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+V.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.bc=C,g.type=c,g.count=V.length,j=g,console&&console.warn&&console.warn(j)}return C}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(C,c,d){var b={fired:!1,wrapFn:void 0,target:C,type:c,listener:d},X=g.bind(b);return X.listener=d,b.wrapFn=X,X}function Z(C,c,d){var b=C._events;if(void 0===b)return[];var X=b[c];return void 0===X?[]:"function"===typeof X?d?[X.listener||X]:[X]:d?function(C){for(var c=new Array(C.length),d=0;d<c.length;++d)c[d]=C[d].listener||C[d];return c}(X):A(X,X.length)}function U(C){var c=this._events;if(void 0!==c){var d=c[C];if("function"===typeof d)return 1;if(void 0!==d)return d.length}return 0}function A(C,c){for(var d=new Array(c),b=0;b<c;++b)d[b]=C[b];return d}function u(C,c,d,b){if("function"===typeof C.on)b.once?C.once(c,d):C.on(c,d);else{if("function"!==typeof C.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C);C.addEventListener(c,(function X(P){b.once&&C.removeEventListener(c,X),d(P)}))}}Object.defineProperty(P,"defaultMaxListeners",{enumerable:!0,get:function(){return V},set:function(C){if("number"!==typeof C||C<0||X(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");V=C}}),P.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},P.prototype.setMaxListeners=function(C){if("number"!==typeof C||C<0||X(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this},P.prototype.getMaxListeners=function(){return p(this)},P.prototype.emit=function(C){for(var c=[],d=1;d<arguments.length;d++)c.push(arguments[d]);var X="error"===C,P=this._events;if(void 0!==P)X=X&&void 0===P.error;else if(!X)return!1;if(X){var V;if(c.length>0&&(V=c[0]),V instanceof Error)throw V;var R=new Error("Unhandled error."+(V?" ("+V.message+")":""));throw R.context=V,R}var p=P[C];if(void 0===p)return!1;if("function"===typeof p)b(p,this,c);else{var j=p.length,g=A(p,j);for(d=0;d<j;++d)b(g[d],this,c)}return!0},P.prototype.addListener=function(C,c){return j(this,C,c,!1)},P.prototype.on=P.prototype.addListener,P.prototype.prependListener=function(C,c){return j(this,C,c,!0)},P.prototype.once=function(C,c){return R(c),this.on(C,k(this,C,c)),this},P.prototype.prependOnceListener=function(C,c){return R(c),this.prependListener(C,k(this,C,c)),this},P.prototype.removeListener=function(C,c){var d,b,X,P,V;if(R(c),void 0===(b=this._events))return this;if(void 0===(d=b[C]))return this;if(d===c||d.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete b[C],b.removeListener&&this.emit("removeListener",C,d.listener||c));else if("function"!==typeof d){for(X=-1,P=d.length-1;P>=0;P--)if(d[P]===c||d[P].listener===c){V=d[P].listener,X=P;break}if(X<0)return this;0===X?d.shift():function(C,c){for(;c+1<C.length;c++)C[c]=C[c+1];C.pop()}(d,X),1===d.length&&(b[C]=d[0]),void 0!==b.removeListener&&this.emit("removeListener",C,V||c)}return this},P.prototype.off=P.prototype.removeListener,P.prototype.Xc=function(C){var c,d,b;if(void 0===(d=this._events))return this;if(void 0===d.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==d[C]&&(0===--this._eventsCount?this._events=Object.create(null):delete d[C]),this;if(0===arguments.length){var X,P=Object.keys(d);for(b=0;b<P.length;++b)"removeListener"!==(X=P[b])&&this.Xc(X);return this.Xc("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=d[C]))this.removeListener(C,c);else if(void 0!==c)for(b=c.length-1;b>=0;b--)this.removeListener(C,c[b]);return this},P.prototype.listeners=function(C){return Z(this,C,!0)},P.prototype.rawListeners=function(C){return Z(this,C,!1)},P.listenerCount=function(C,c){return"function"===typeof C.listenerCount?C.listenerCount(c):U.call(C,c)},P.prototype.listenerCount=U,P.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},14651:C=>{"use strict";C.exports=function(C,c,d,b,X,P){var V=+c[0],R=+c[1],p=+c[2],j=+d[0],g=+d[1],k=+d[2],Z=Math.sqrt(j*j+g*g+k*k);if(0===Z)throw new Error("Can't raycast along a zero vector");return function(C,c,d,b,X,P,V,R,p,j){for(var g=0,k=Math.floor,Z=0|k(c),U=0|k(d),A=0|k(b),u=X>0?1:-1,q=P>0?1:-1,B=V>0?1:-1,t=Math.abs(1/X),e=Math.abs(1/P),n=Math.abs(1/V),W=t<1/0?t*(u>0?Z+1-c:c-Z):1/0,E=e<1/0?e*(q>0?U+1-d:d-U):1/0,N=n<1/0?n*(B>0?A+1-b:b-A):1/0,r=-1;g<=R;){var M=C(Z,U,A);if(M)return p&&(p[0]=c+g*X,p[1]=d+g*P,p[2]=b+g*V),j&&(j[0]=j[1]=j[2]=0,0===r&&(j[0]=-u),1===r&&(j[1]=-q),2===r&&(j[2]=-B)),M;W<E?W<N?(Z+=u,g=W,W+=t,r=0):(A+=B,g=N,N+=n,r=2):E<N?(U+=q,g=E,E+=e,r=1):(A+=B,g=N,N+=n,r=2)}return p&&(p[0]=c+g*X,p[1]=d+g*P,p[2]=b+g*V),j&&(j[0]=j[1]=j[2]=0),0}(C,V,R,p,j/=Z,g/=Z,k/=Z,b="undefined"===typeof b?64:+b,X,P)}},14680:(C,c,d)=>{"use strict";d.d(c,{d:()=>P});var b=d(14355);function X(){this.JU=!1,this.stopPropagation=!1,this.yU=!1,this.disabled=!1}class P{constructor(C,c){this.version="0.7.0";var d=Object.assign({},new X,c||{});this.element=C||document,this.JU=!!d.JU,this.stopPropagation=!!d.stopPropagation,this.yU=!!d.yU,this.disabled=!!d.disabled,this.filterEvents=(C,c)=>!0,this.down=new b.EventEmitter,this.up=new b.EventEmitter,this.state={},this.pk={dx:0,dy:0,rA:0,Rk:0,MA:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?R(this):document.addEventListener("DOMContentLoaded",(C=>{R(this)}),{once:!0})}bind(C){for(var c=arguments.length,d=new Array(c>1?c-1:0),b=1;b<c;b++)d[b-1]=arguments[b];d.forEach((c=>{var d=this._keyBindmap[c]||[];d.includes(C)||(d.push(C),this._keyBindmap[c]=d)})),this.state[C]=!!this.state[C],this.pressCount[C]=this.pressCount[C]||0,this.releaseCount[C]=this.releaseCount[C]||0}unbind(C){for(var c in this._keyBindmap){var d=this._keyBindmap[c],b=d.indexOf(C);b>-1&&d.splice(b,1)}}getBindings(){var C={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((d=>{C[d]=C[d]||[],C[d].push(c)}))}return C}ap(){V(this.pk),V(this.pressCount),V(this.releaseCount)}}function V(C){for(var c in C)C[c]=0}function R(C){window.addEventListener("keydown",A.bind(null,C,!0),!1),window.addEventListener("keyup",A.bind(null,C,!1),!1);var c={passive:!0};C.element.addEventListener("touchstart",k.bind(void 0,C),{passive:!1}),C.element.addEventListener("touchend",U.bind(void 0,C),c),C.element.addEventListener("mousedown",u.bind(null,C,!0),c),window.document.addEventListener("mouseup",u.bind(null,C,!1),c),C.element.addEventListener("touchmove",q.bind(null,C),c),C.element.addEventListener("mousemove",q.bind(null,C),c),window.PointerEvent,C.element.addEventListener("wheel",B.bind(null,C),c),C.element.addEventListener("contextmenu",t.bind(null,C),!1),window.addEventListener("blur",e.bind(null,C),!1)}var p=0,j=0,g=null;function k(C,c){c.preventDefault(),Z(c)}function Z(C){let c=!1;for(let d=0;d<C.touches.length;++d)if(C.touches[d].identifier===g){c=!0;break}if(!c){const c=C.changedTouches[0];p=c.clientX,j=c.clientY,g=c.identifier}}function U(C,c){for(var d=c.changedTouches,b=0;b<d.length;++b)d[b].identifier===g&&(g=null)}function A(C,c,d){n(d.code,c,C,d)}function u(C,c,d){if("pointerId"in d)if(c){if(null!==C._touches.currID)return;C._touches.currID=d.pointerId}else{if(C._touches.currID!==d.pointerId)return;C._touches.currID=null}return n("Mouse"+("button"in d?d.button+1:1),c,C,d),!1}function q(C,c){var d=c.movementX||c.mozMovementX||0,b=c.movementY||c.mozMovementY||0;if(c.touches&&0===(d|b)){var X=function(C){Z(C);for(let c=0;c<C.changedTouches.length;++c)if(C.changedTouches[c].identifier==g){const d=C.changedTouches[c],b=[d.clientX-p,d.clientY-j];return p=d.clientX,j=d.clientY,b}return console.error(`Did not find touch id ${g}`),[0,0]}(c);d=X[0],b=X[1]}C.pk.dx+=d,C.pk.dy+=b}function B(C,c){var d=1;switch(c.deltaMode){case 0:d=1;break;case 1:d=12;break;case 2:d=C.element.clientHeight||window.innerHeight}C.pk.rA+=(c.deltaX||0)*d,C.pk.Rk+=(c.deltaY||0)*d,C.pk.MA+=(c.deltaZ||0)*d}function t(C,c){if(!C.yU)return c.preventDefault(),!1}function e(C){for(var c in C._keyStates)C._keyStates[c]&&(/^Mouse\d/.test(c)||n(c,!1,C,{code:c,note:"w39w37km3u",preventDefault:()=>{},stopPropagation:()=>{}}))}function n(C,c,d,b){var X=d._keyBindmap[C];X&&(W(d._keyStates[C],c)&&(d._keyStates[C]=c,X.forEach((C=>{(!d.filterEvents||d.filterEvents(b,C))&&function(C,c,d,b){var X=c?d.pressCount:d.releaseCount;X[C]=(X[C]||0)+1;var P=d._bindPressCount[C]||0;(P+=c?1:-1)<0&&(P=0);d._bindPressCount[C]=P;var V=d.state[C];if(W(V,P)){d.state[C]=P>0;var R=c?d.down:d.up;d.disabled||R.emit(C,b)}}(C,c,d,b)}))),"button"in b||(d.JU&&!b.defaultPrevented&&b.preventDefault(),d.stopPropagation&&b.stopPropagation()))}function W(C,c){return C?!c:c}},13300:C=>{C.exports=function(C,c,d){return C[0]=c[0]+d[0],C[1]=c[1]+d[1],C[2]=c[2]+d[2],C}},13250:(C,c,d)=>{C.exports=function(C,c){var d=b(C[0],C[1],C[2]),V=b(c[0],c[1],c[2]);X(d,d),X(V,V);var R=P(d,V);return R>1?0:Math.acos(R)};var b=d(13254),X=d(13257),P=d(13266)},13363:C=>{C.exports=function(C,c){return C[0]=Math.ceil(c[0]),C[1]=Math.ceil(c[1]),C[2]=Math.ceil(c[2]),C}},13247:C=>{C.exports=function(C){var c=new Float32Array(3);return c[0]=C[0],c[1]=C[1],c[2]=C[2],c}},13271:C=>{C.exports=function(C,c){return C[0]=c[0],C[1]=c[1],C[2]=c[2],C}},13241:C=>{C.exports=function(){var C=new Float32Array(3);return C[0]=0,C[1]=0,C[2]=0,C}},13442:C=>{C.exports=function(C,c,d){var b=c[0],X=c[1],P=c[2],V=d[0],R=d[1],p=d[2];return C[0]=X*p-P*R,C[1]=P*V-b*p,C[2]=b*R-X*V,C}},13388:(C,c,d)=>{C.exports=d(13384)},13384:C=>{C.exports=function(C,c){var d=c[0]-C[0],b=c[1]-C[1],X=c[2]-C[2];return Math.sqrt(d*d+b*b+X*X)}},13339:(C,c,d)=>{C.exports=d(13331)},13331:C=>{C.exports=function(C,c,d){return C[0]=c[0]/d[0],C[1]=c[1]/d[1],C[2]=c[2]/d[2],C}},13266:C=>{C.exports=function(C,c){return C[0]*c[0]+C[1]*c[1]+C[2]*c[2]}},13235:C=>{C.exports=1e-6},13288:(C,c,d)=>{C.exports=function(C,c){var d=C[0],X=C[1],P=C[2],V=c[0],R=c[1],p=c[2];return Math.abs(d-V)<=b*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(X-R)<=b*Math.max(1,Math.abs(X),Math.abs(R))&&Math.abs(P-p)<=b*Math.max(1,Math.abs(P),Math.abs(p))};var b=d(13235)},13294:C=>{C.exports=function(C,c){return C[0]===c[0]&&C[1]===c[1]&&C[2]===c[2]}},13355:C=>{C.exports=function(C,c){return C[0]=Math.floor(c[0]),C[1]=Math.floor(c[1]),C[2]=Math.floor(c[2]),C}},13491:(C,c,d)=>{C.exports=function(C,c,d,X,P,V){var R,p;c||(c=3);d||(d=0);p=X?Math.min(X*c+d,C.length):C.length;for(R=d;R<p;R+=c)b[0]=C[R],b[1]=C[R+1],b[2]=C[R+2],P(b,b,V),C[R]=b[0],C[R+1]=b[1],C[R+2]=b[2];return C};var b=d(13241)()},13254:C=>{C.exports=function(C,c,d){var b=new Float32Array(3);return b[0]=C,b[1]=c,b[2]=d,b}},13226:(C,c,d)=>{C.exports={EPSILON:d(13235),create:d(13241),clone:d(13247),angle:d(13250),mj:d(13254),i:d(13271),set:d(13279),equals:d(13288),exactEquals:d(13294),add:d(13300),Xd:d(13309),sub:d(13317),multiply:d(13326),mul:d(13329),divide:d(13331),div:d(13339),min:d(13341),max:d(13350),floor:d(13355),ceil:d(13363),round:d(13371),scale:d(13377),Qp:d(13379),distance:d(13384),j:d(13388),squaredDistance:d(13394),sqrDist:d(13401),length:d(13408),len:d(13413),squaredLength:d(13422),Ip:d(13426),negate:d(13434),inverse:d(13439),normalize:d(13257),dot:d(13266),cross:d(13442),vp:d(13447),random:d(13456),transformMat4:d(13458),transformMat3:d(13460),transformQuat:d(13464),op:d(13471),Fp:d(13478),Yp:d(13486),forEach:d(13491)}},13439:C=>{C.exports=function(C,c){return C[0]=1/c[0],C[1]=1/c[1],C[2]=1/c[2],C}},13413:(C,c,d)=>{C.exports=d(13408)},13408:C=>{C.exports=function(C){var c=C[0],d=C[1],b=C[2];return Math.sqrt(c*c+d*d+b*b)}},13447:C=>{C.exports=function(C,c,d,b){var X=c[0],P=c[1],V=c[2];return C[0]=X+b*(d[0]-X),C[1]=P+b*(d[1]-P),C[2]=V+b*(d[2]-V),C}},13350:C=>{C.exports=function(C,c,d){return C[0]=Math.max(c[0],d[0]),C[1]=Math.max(c[1],d[1]),C[2]=Math.max(c[2],d[2]),C}},13341:C=>{C.exports=function(C,c,d){return C[0]=Math.min(c[0],d[0]),C[1]=Math.min(c[1],d[1]),C[2]=Math.min(c[2],d[2]),C}},13329:(C,c,d)=>{C.exports=d(13326)},13326:C=>{C.exports=function(C,c,d){return C[0]=c[0]*d[0],C[1]=c[1]*d[1],C[2]=c[2]*d[2],C}},13434:C=>{C.exports=function(C,c){return C[0]=-c[0],C[1]=-c[1],C[2]=-c[2],C}},13257:C=>{C.exports=function(C,c){var d=c[0],b=c[1],X=c[2],P=d*d+b*b+X*X;P>0&&(P=1/Math.sqrt(P),C[0]=c[0]*P,C[1]=c[1]*P,C[2]=c[2]*P);return C}},13456:C=>{C.exports=function(C,c){c=c||1;var d=2*Math.random()*Math.PI,b=2*Math.random()-1,X=Math.sqrt(1-b*b)*c;return C[0]=Math.cos(d)*X,C[1]=Math.sin(d)*X,C[2]=b*c,C}},13471:C=>{C.exports=function(C,c,d,b){var X=d[1],P=d[2],V=c[1]-X,R=c[2]-P,p=Math.sin(b),j=Math.cos(b);return C[0]=c[0],C[1]=X+V*j-R*p,C[2]=P+V*p+R*j,C}},13478:C=>{C.exports=function(C,c,d,b){var X=d[0],P=d[2],V=c[0]-X,R=c[2]-P,p=Math.sin(b),j=Math.cos(b);return C[0]=X+R*p+V*j,C[1]=c[1],C[2]=P+R*j-V*p,C}},13486:C=>{C.exports=function(C,c,d,b){var X=d[0],P=d[1],V=c[0]-X,R=c[1]-P,p=Math.sin(b),j=Math.cos(b);return C[0]=X+V*j-R*p,C[1]=P+V*p+R*j,C[2]=c[2],C}},13371:C=>{C.exports=function(C,c){return C[0]=Math.round(c[0]),C[1]=Math.round(c[1]),C[2]=Math.round(c[2]),C}},13377:C=>{C.exports=function(C,c,d){return C[0]=c[0]*d,C[1]=c[1]*d,C[2]=c[2]*d,C}},13379:C=>{C.exports=function(C,c,d,b){return C[0]=c[0]+d[0]*b,C[1]=c[1]+d[1]*b,C[2]=c[2]+d[2]*b,C}},13279:C=>{C.exports=function(C,c,d,b){return C[0]=c,C[1]=d,C[2]=b,C}},13401:(C,c,d)=>{C.exports=d(13394)},13426:(C,c,d)=>{C.exports=d(13422)},13394:C=>{C.exports=function(C,c){var d=c[0]-C[0],b=c[1]-C[1],X=c[2]-C[2];return d*d+b*b+X*X}},13422:C=>{C.exports=function(C){var c=C[0],d=C[1],b=C[2];return c*c+d*d+b*b}},13317:(C,c,d)=>{C.exports=d(13309)},13309:C=>{C.exports=function(C,c,d){return C[0]=c[0]-d[0],C[1]=c[1]-d[1],C[2]=c[2]-d[2],C}},13460:C=>{C.exports=function(C,c,d){var b=c[0],X=c[1],P=c[2];return C[0]=b*d[0]+X*d[3]+P*d[6],C[1]=b*d[1]+X*d[4]+P*d[7],C[2]=b*d[2]+X*d[5]+P*d[8],C}},13458:C=>{C.exports=function(C,c,d){var b=c[0],X=c[1],P=c[2],V=d[3]*b+d[7]*X+d[11]*P+d[15];return V=V||1,C[0]=(d[0]*b+d[4]*X+d[8]*P+d[12])/V,C[1]=(d[1]*b+d[5]*X+d[9]*P+d[13])/V,C[2]=(d[2]*b+d[6]*X+d[10]*P+d[14])/V,C}},13464:C=>{C.exports=function(C,c,d){var b=c[0],X=c[1],P=c[2],V=d[0],R=d[1],p=d[2],j=d[3],g=j*b+R*P-p*X,k=j*X+p*b-V*P,Z=j*P+V*X-R*b,U=-V*b-R*X-p*P;return C[0]=g*j+U*-V+k*-p-Z*-R,C[1]=k*j+U*-R+Z*-V-g*-p,C[2]=Z*j+U*-p+g*-R-k*-V,C}},14381:C=>{"use strict";C.exports=function(C){for(var c=new Array(C),d=0;d<C;++d)c[d]=d;return c}},14441:C=>{C.exports=function(C){return null!=C&&null!=C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}},14654:(C,c,d)=>{"use strict";d.d(c,{c:()=>b});class b{constructor(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.BZ=!1,this.tZ=!1,this.uZ=30,this.qZ=0,this.KZ=!1,this.fullscreen=!1,this.nZ=function(C){},this.WZ=function(){},this.rZ=function(){},this.Vc=function(){},this.EZ=function(C){},this.onFullscreenChanged=function(C){},j((()=>{!function(C,c){C._nowObject=performance||Date,C._lastTick=0,C._renderAccum=0,C._rt=0,C._frameCB=R.bind(null,C),requestAnimationFrame(C._frameCB),c>0&&(C._intervalCB=V.bind(null,C),C._interval=setInterval(C._intervalCB,Math.max(c,1e3/C.uZ/2)))}(this,c),function(C,c){if(!c)return;var d=!1,b=!1;document.addEventListener("pointerlockchange",(b=>{d=document.pointerLockElement===c,C.EZ(d)})),document.addEventListener("fullscreenchange",(d=>{b=document.fullscreenElement===c,C.onFullscreenChanged(b)})),Object.defineProperty(C,"KZ",{get:()=>d,set:C=>{C&&!d?p(c):d&&!C&&function(C){C.exitPointerLock&&C.exitPointerLock()}(document)}}),Object.defineProperty(C,"fullscreen",{get:()=>b,set:C=>{C&&!b?c.requestFullscreen():b&&!C&&document.exitFullscreen()}}),c.addEventListener("click",(X=>{C.BZ&&!d&&p(c),C.tZ&&!b&&c.requestFullscreen()}));var X=()=>C.Vc();if(window.ResizeObserver){new ResizeObserver(X).observe(c)}else window.addEventListener("resize",X)}(this,C),this.rZ()}))}}var X=3,P=20;function V(C){for(var c=1e3/C.uZ,d=C._nowObject.now()+P,b=0;C._nowObject.now()>=C._lastTick+c&&C._nowObject.now()<d&&++b<=X;)C.nZ(c),C._lastTick+=c;var V=5*(c+5),R=C._nowObject.now();if(R-C._lastTick>V)for(;R>=C._lastTick+c;)C._lastTick+=c}function R(C){requestAnimationFrame(C._frameCB),V(C);var c=C._nowObject.now(),d=c-C._rt;if(C._rt=c,C.qZ>0){C._renderAccum+=d;var b=1e3/C.qZ;if(C._renderAccum<b)return;C._renderAccum=Math.min(C._renderAccum-b,b)}var X=1e3/C.uZ,P=(c-C._lastTick)/X;C.WZ(d,P,X)}function p(C){C.requestPointerLock&&C.requestPointerLock()}var j=C=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),C()};document.addEventListener("readystatechange",c)}else setTimeout(C,1)}},14379:(C,c,d)=>{var b=d(14381),X=d(14389),P="undefined"!==typeof Float64Array;function V(C,c){return C[0]-c[0]}function R(){var C,c=this.stride,d=new Array(c.length);for(C=0;C<d.length;++C)d[C]=[Math.abs(c[C]),C];d.sort(V);var b=new Array(d.length);for(C=0;C<b.length;++C)b[C]=d[C][1];return b}function p(C,c){var d=["View",c,"d",C].join("");c<0&&(d="View_Nil"+C);var X="generic"===C;if(-1===c){var P="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+C+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}";return new Function(P)()}if(0===c){P="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+C+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}";return new Function("TrivialArray",P)(j[C][0])}P=["'use strict'"];var V=b(c),p=V.map((function(C){return"i"+C})),g="this.offset+"+V.map((function(C){return"this.stride["+C+"]*i"+C})).join("+"),k=V.map((function(C){return"b"+C})).join(","),Z=V.map((function(C){return"c"+C})).join(",");P.push("function "+d+"(a,"+k+","+Z+",d){this.data=a","this.shape=["+k+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+C+"'","proto.dimension="+c),P.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+V.map((function(C){return"this.shape["+C+"]"})).join("*"),"}})"),1===c?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),c<4?(P.push("function "+d+"_order(){"),2===c?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+d+"_set("+p.join(",")+",v){"),X?P.push("return this.data.set("+g+",v)}"):P.push("return this.data["+g+"]=v}"),P.push("proto.get=function "+d+"_get("+p.join(",")+"){"),X?P.push("return this.data.get("+g+")}"):P.push("return this.data["+g+"]}"),P.push("proto.index=function "+d+"_index(",p.join(),"){return "+g+"}"),P.push("proto.hi=function "+d+"_hi("+p.join(",")+"){return new "+d+"(this.data,"+V.map((function(C){return["(typeof i",C,"!=='number'||i",C,"<0)?this.shape[",C,"]:i",C,"|0"].join("")})).join(",")+","+V.map((function(C){return"this.stride["+C+"]"})).join(",")+",this.offset)}");var U=V.map((function(C){return"a"+C+"=this.shape["+C+"]"})),A=V.map((function(C){return"c"+C+"=this.stride["+C+"]"}));P.push("proto.lo=function "+d+"_lo("+p.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+A.join(","));for(var u=0;u<c;++u)P.push("if(typeof i"+u+"==='number'&&i"+u+">=0){d=i"+u+"|0;b+=c"+u+"*d;a"+u+"-=d}");P.push("return new "+d+"(this.data,"+V.map((function(C){return"a"+C})).join(",")+","+V.map((function(C){return"c"+C})).join(",")+",b)}"),P.push("proto.step=function "+d+"_step("+p.join(",")+"){var "+V.map((function(C){return"a"+C+"=this.shape["+C+"]"})).join(",")+","+V.map((function(C){return"b"+C+"=this.stride["+C+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(u=0;u<c;++u)P.push("if(typeof i"+u+"==='number'){d=i"+u+"|0;if(d<0){c+=b"+u+"*(a"+u+"-1);a"+u+"=ceil(-a"+u+"/d)}else{a"+u+"=ceil(a"+u+"/d)}b"+u+"*=d}");P.push("return new "+d+"(this.data,"+V.map((function(C){return"a"+C})).join(",")+","+V.map((function(C){return"b"+C})).join(",")+",c)}");var q=new Array(c),B=new Array(c);for(u=0;u<c;++u)q[u]="a[i"+u+"]",B[u]="b[i"+u+"]";P.push("proto.transpose=function "+d+"_transpose("+p+"){"+p.map((function(C,c){return C+"=("+C+"===undefined?"+c+":"+C+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+q.join(",")+","+B.join(",")+",this.offset)}"),P.push("proto.pick=function "+d+"_pick("+p+"){var a=[],b=[],c=this.offset");for(u=0;u<c;++u)P.push("if(typeof i"+u+"==='number'&&i"+u+">=0){c=(c+this.stride["+u+"]*i"+u+")|0}else{a.push(this.shape["+u+"]);b.push(this.stride["+u+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+V.map((function(C){return"shape["+C+"]"})).join(",")+","+V.map((function(C){return"stride["+C+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(j[C],R)}var j={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};C.exports=function(C,c,d,b){if(void 0===C)return(0,j.array[0])([]);"number"===typeof C&&(C=[C]),void 0===c&&(c=[C.length]);var V=c.length;if(void 0===d){d=new Array(V);for(var R=V-1,g=1;R>=0;--R)d[R]=g,g*=c[R]}if(void 0===b){b=0;for(R=0;R<V;++R)d[R]<0&&(b-=(c[R]-1)*d[R])}for(var k=function(C){if(X(C))return"buffer";if(P)switch(Object.prototype.toString.call(C)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(C)?"array":"generic"}(C),Z=j[k];Z.length<=V+1;)Z.push(p(k,Z.length-1));return(0,Z[V+1])(C,c,d,b)}},14389:C=>{function c(C){return!!C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}C.exports=function(C){return null!=C&&(c(C)||function(C){return"function"===typeof C.readFloatLE&&"function"===typeof C.slice&&c(C.slice(0,0))}(C)||!!C._isBuffer)}},14524:C=>{"use strict";var c=[],d=[],b=[],X=[],P=[],V=[],R=[],p=[],j=[],g=[],k=[],Z=[];C.exports=function(C,U,A,u,q,B){for(var t=R,e=j,n=g,W=Z,E=0;E<3;E++)t[E]=+A[E],n[E]=+U.max[E],e[E]=+U.base[E];B||(B=1e-10);var N=function(C,R,j,g,Z,U){var A=c,u=d,q=b,B=X,t=P,e=V,n=p,W=Math.floor,E=0,N=0,r=0,M=0,K=0;if(i(),0===r)return 0;for(M=f();N<=r;){if(h(M)&&L())return E;M=f()}for(E+=r,K=0;K<3;K++)g[K]+=j[K],Z[K]+=j[K];return E;function i(){if(N=0,0!==(r=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2])))for(var C=0;C<3;C++){var c=j[C]>=0;B[C]=c?1:-1;var d=c?Z[C]:g[C];A[C]=c?g[C]:Z[C],u[C]=T(d,B[C]),q[C]=z(A[C],B[C]),n[C]=j[C]/r,t[C]=Math.abs(1/n[C]);var b=c?u[C]+1-d:d-u[C];e[C]=t[C]<1/0?t[C]*b:1/0}}function h(c){for(var d=B[0],b=0===c?u[0]:q[0],X=u[0]+d,P=B[1],V=1===c?u[1]:q[1],R=u[1]+P,p=B[2],j=2===c?u[2]:q[2],g=u[2]+p,k=b;k!=X;k+=d)for(var Z=V;Z!=R;Z+=P)for(var U=j;U!=g;U+=p)if(C(k,Z,U))return!0;return!1}function L(){E+=N;var C=B[M],c=N/r,d=k;for(K=0;K<3;K++){var b=j[K]*c;g[K]+=b,Z[K]+=b,d[K]=j[K]-b}if(C>0?Z[M]=Math.round(Z[M]):g[M]=Math.round(g[M]),R(E,M,C,d))return!0;for(K=0;K<3;K++)j[K]=d[K];return i(),0===r}function f(){var C=e[0]<e[1]?e[0]<e[2]?0:2:e[1]<e[2]?1:2,c=e[C]-N;for(N=e[C],u[C]+=B[C],e[C]+=t[C],K=0;K<3;K++)A[K]+=c*n[K],q[K]=z(A[K],B[K]);return C}function T(C,c){return W(C-c*U)}function z(C,c){return W(C+c*U)}}(C,u,t,e,n,B);if(!q){for(E=0;E<3;E++)W[E]=A[E]>0?n[E]-U.max[E]:e[E]-U.base[E];U.translate(W)}return N}},14683:(C,c,d)=>{"use strict";d.d(c,{e:()=>k});var b=d(14518),X=d(13226);class P{constructor(C,c,d,P,V,R,p){this.Uk=new b(C.base,C.Lk),this.PP=c,this.friction=d,this.restitution=P,this.Tp=V,this.oA=R,this.zp=!!p,this.hk=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Tu=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Hg=X.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=X.create(),this._impulses=X.create(),this._sleepFrameCount=10}loadFromCopy(C){X.i(this.Uk.base,C.Uk.base),X.i(this.Uk.Lk,C.Uk.Lk),X.i(this.Uk.max,C.Uk.max),this.Uk.mag=C.Uk.mag,this.PP=C.PP,this.friction=C.friction,this.restitution=C.restitution,this.Tp=C.Tp,this.oA=C.oA,this.zp=C.zp,this.hk=C.hk,this.fluidDrag=C.fluidDrag,this.Tu=C.Tu,this.preventFallOffEdge=C.preventFallOffEdge,this.rolledBackLastTick=C.rolledBackLastTick,X.i(this.Hg,C.Hg),X.i(this.resting,C.resting),this.inFluid=C.inFluid,this._ratioInFluid=C._ratioInFluid,X.i(this._forces,C._forces),X.i(this._impulses,C._impulses),this._sleepFrameCount=C._sleepFrameCount}setPosition(C){V(C),X.Xd(C,C,this.Uk.base),this.Uk.translate(C),this.Qg()}Rc(){return X.clone(this.Uk.base)}applyForce(C){V(C),X.add(this._forces,this._forces,C),this.Qg()}applyImpulse(C){V(C),X.add(this._impulses,this._impulses,C),this.Qg()}Qg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var V=C=>{};var R=d(14518),p=d(13226),j=d(14524);function g(){this.hk=.1,this.fluidDrag=.4,this.Hp=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function k(C,c,d){C=Object.assign(new g,C),this.gravity=C.gravity||[0,-10,0],this.hk=C.hk||.1,this.Hp=C.Hp||2,this.fluidDrag=C.fluidDrag||.4,this.minBounceImpulse=C.minBounceImpulse,this.bodies=[],this.AA=C.AA,this.testSolid=c,this.testFluid=d}k.prototype.OA=function(C,c,d,b,X,V){C=C||new R([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=1),"undefined"==typeof b&&(b=0),"undefined"==typeof X&&(X=1);var p=new P(C,c,d,b,X,V);return this.bodies.push(p),p},k.prototype.Cu=function(C){var c=this.bodies.indexOf(C);c<0||(this.bodies.splice(c,1),C.Uk=C.oA=null)};var Z=p.create(),U=p.create(),A=p.create(),u=p.create(),q=p.create(),B=p.create(),t=p.create(),e=new R([0,0,0],[1,1,1]),n=new P(e,1,1,0,1,(()=>{}),!1);function W(C,c,d){return c=d,c*=1-(1-C.ratioInFluid)**2}k.prototype.ap=function(C){C/=1e3;var c=H(0,p.squaredLength(this.gravity));this.bodies.forEach((d=>function(C,c,d,b){p.i(q,c.resting),C.AA&&n.loadFromCopy(c);if(c.PP<=0)return p.set(c.Hg,0,0,0),p.set(c._forces,0,0,0),void p.set(c._impulses,0,0,0);var X=b||0===c.Tp;if(function(C,c,d,b){if(c._sleepFrameCount>0)return!1;if(b)return!0;var X=!1,P=.5*d*d*c.Tp;return p.scale(x,C.gravity,P),j(C.testSolid,c.Uk,x,(function(){return X=!0,!0}),!0),X}(C,c,d,X))return;c._sleepFrameCount--,function(C,c){var d=c.Uk,b=Math.floor(d.base[0]),X=Math.floor(d.base[2]),P=Math.floor(d.base[1]),V=Math.floor(d.max[1]);if(!C.testFluid(b,P,X))return c.inFluid=!1,void(c.ratioInFluid=0);var R=1,j=P+1;for(;j<=V&&C.testFluid(b,j,X);)R++,j++;var g=(P+R-d.base[1])/d.Lk[1];g>1&&(g=1);var k=d.Lk[0]*d.Lk[1]*d.Lk[2]*g,Z=N;p.scale(Z,C.gravity,-C.Hp*k*c.Tp),c.applyForce(Z),c.inFluid=!0,c.ratioInFluid=g}(C,c),D(c._forces),D(c._impulses),D(c.Hg),D(c.resting),p.scale(Z,c._forces,1/c.PP),p.Qp(Z,Z,C.gravity,c.Tp),p.scale(U,c._impulses,1/c.PP),p.Qp(U,U,Z,d),p.add(c.Hg,c.Hg,U),c.friction&&(r(C,0,c,U,d),r(C,1,c,U,d),r(C,2,c,U,d));var P=c.fluidDrag>=0?c.fluidDrag:C.fluidDrag,V=c.hk>=0?c.hk:C.hk,R=V,g=V;c.inFluid&&(R=W(c,R,c.fluidDragHoriz>=0?c.fluidDragHoriz:P),g=W(c,g,c.fluidDragVert>=0?c.fluidDragVert:P));R=Math.max(1-R*d/c.PP,0),g=Math.max(1-g*d/c.PP,0),p.set(E,R,g,R),p.multiply(c.Hg,c.Hg,E),p.scale(A,c.Hg,d),p.set(c._forces,0,0,0),p.set(c._impulses,0,0,0),c.zp&&v(i,c.Uk);p.i(B,A),p.set(t,0,0,0),c.preventFallOffEdge&&function(C,c,d,b){if(!c.resting[1]||d[1]>0)return;var X=w;v(X,c.Uk);for(var P=0;P<3;P+=2){p.set(z,0,0,0),z[P]=d[P];var V=!0;(V=(V=(V=(V=V&&!y(C,X.base[0]+z[0]+1e-5,X.base[1],X.base[2]+z[2]+1e-5))&&!y(C,X.max[0]+z[0]-1e-5,X.base[1],X.base[2]+z[2]+1e-5))&&!y(C,X.base[0]+z[0]+1e-5,X.base[1],X.max[2]+z[2]-1e-5))&&!y(C,X.max[0]+z[0]-1e-5,X.base[1],X.max[2]+z[2]-1e-5))?(b[P]=d[P]>0?1:-1,d[P]=0):0===P&&(p.set(J,d[0],0,0),K(C,X,J,b,c.slideOnCollision))}}(C,c,A,t);K(C,c.Uk,A,c.resting,c.slideOnCollision),c.zp&&function(C,c,d,b){if(c.resting[1]>=0&&!c.inFluid)return;var X=0!==c.resting[0],P=0!==c.resting[2];if(!X&&!P)return;var V=Math.abs(b[0]/b[2]),R=4;if(!X&&V>R)return;if(!P&&V<1/R)return;p.add(L,d.base,b);var g=C.testSolid;j(g,d,b,(function(C,c,d,b){if(1!==c)return!0;b[c]=0}));var k=d.base[1],Z=c.inFluid?1.951:1.001,U=Math.floor(k+Z)-k;p.set(f,0,U,0);var A=!1;if(j(g,d,f,(function(C,c,d,b){return A=!0,!0})),A)return;p.Xd(T,L,d.base),T[1]=0,K(C,d,T,h,!0);var u=H(d.base[0],L[0]),q=H(d.base[2],L[2]);if(X&&!u&&(!q||!P))return;if(P&&(!u||!X)&&!q)return;var B=!0;if(B=B&&!y(C,d.base[0]+1e-5,d.base[1],d.base[2]+1e-5),B=B&&!y(C,d.max[0]-1e-5,d.base[1],d.base[2]+1e-5),B=B&&!y(C,d.base[0]+1e-5,d.base[1],d.max[2]-1e-5),B=B&&!y(C,d.max[0]-1e-5,d.base[1],d.max[2]-1e-5),B)return;v(c.Uk,d),c.resting[0]=h[0],c.resting[2]=h[2],c.Tu&&c.Tu()}(C,c,i,B);for(var k=0;k<3;++k)c.resting[k]=c.resting[k]||t[k],u[k]=0,c.resting[k]&&(q[k]||(u[k]=-c.Hg[k]),c.Hg[k]=0);var e=p.length(u);e>.001&&(p.scale(u,u,c.PP),c.oA&&c.oA(u),c.restitution>0&&e>C.minBounceImpulse&&(p.scale(u,u,c.restitution),c.applyImpulse(u)));var M=p.squaredLength(c.Hg);M>1e-5&&c.Qg();C.AA&&C.AA(c)?(c.loadFromCopy(n),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,d,C,c)))};var E=p.create([0,0,0]);var N=p.create();function r(C,c,d,b,X){var P=d.resting[c],V=b[c];if(!d.alwaysApplyHorizFriction||1!==c){if(0===P)return;if(P*V<=0)return}p.i(M,d.Hg),M[c]=0;var R=p.length(M);if(!H(R,0)){var j=Math.abs(d.friction*C.gravity[c]*X),g=R>j?(R-j)/R:0;d.Hg[(c+1)%3]*=g,d.Hg[(c+2)%3]*=g}}var M=p.create();function K(C,c,d,b,X){return p.set(b,0,0,0),j(C.testSolid,c,d,(function(C,c,d,P){b[c]=d,P[c]=0,X||(P[0]=0,P[1]=0,P[2]=0)}))}var i=new R([],[]),h=p.create(),L=p.create(),f=p.create(),T=p.create();var z=p.create(),w=new R([],[]),J=p.create();function y(C,c,d,b){return C.testSolid(Math.floor(c),Math.floor(d-1),Math.floor(b))}var x=p.create();function H(C,c){return Math.abs(C-c)<1e-5}function v(C,c){for(var d=0;d<3;d++)C.base[d]=c.base[d],C.max[d]=c.max[d],C.Lk[d]=c.Lk[d]}var D=function(C){}},13102:function(C,c){!function(C){"use strict";var c=function(C,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,c){C.__proto__=c}||function(C,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(C[d]=c[d])},c(C,d)};function d(C,d){if("function"!==typeof d&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function b(){this.constructor=C}c(C,d),C.prototype=null===d?Object.create(d):(b.prototype=d.prototype,new b)}function b(C,c,d,b){var X,P=arguments.length,V=P<3?c:null===b?b=Object.getOwnPropertyDescriptor(c,d):b;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)V=Reflect.decorate(C,c,d,b);else for(var R=C.length-1;R>=0;R--)(X=C[R])&&(V=(P<3?X(V):P>3?X(c,d,V):X(c,d))||V);return P>3&&V&&Object.defineProperty(c,d,V),V}function X(C,c,d){if(d||2===arguments.length)for(var b,X=0,P=c.length;X<P;X++)!b&&X in c||(b||(b=Array.prototype.slice.call(c,0,X)),b[X]=c[X]);return C.concat(b||Array.prototype.slice.call(c))}var P,V=255,R=213;C.OPERATION=void 0,(P=C.OPERATION||(C.OPERATION={}))[P.ADD=128]="ADD",P[P.REPLACE=0]="REPLACE",P[P.DELETE=64]="DELETE",P[P.DELETE_AND_ADD=192]="DELETE_AND_ADD",P[P.TOUCH=1]="TOUCH",P[P.CLEAR=10]="CLEAR";var p=function(){function c(C,c,d){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=C,this.setParent(c,d)}return c.prototype.setParent=function(C,c,d){var b=this;if(this.indexes||(this.indexes=this.ref instanceof TC?this.ref._definition.indexes:{}),this.parent=C,this.parentIndex=d,c)if(this.root=c,this.ref instanceof TC){var X=this.ref._definition;for(var P in X.schema){var V=this.ref[P];if(V&&V.$changes){var R=X.indexes[P];V.$changes.setParent(this.ref,c,R)}}}else"object"===typeof this.ref&&this.ref.forEach((function(C,c){if(C instanceof TC){var d=C.$changes,X=b.ref.$changes.indexes[c];d.setParent(b.ref,b.root,X)}}))},c.prototype.operation=function(C){this.changes.set(--this.currentCustomOperation,C)},c.prototype.change=function(c,d){void 0===d&&(d=C.OPERATION.ADD);var b="number"===typeof c?c:this.indexes[c];this.assertValidIndex(b,c);var X=this.changes.get(b);X&&X.op!==C.OPERATION.DELETE&&X.op!==C.OPERATION.TOUCH||this.changes.set(b,{op:X&&X.op===C.OPERATION.DELETE?C.OPERATION.DELETE_AND_ADD:d,index:b}),this.allChanges.add(b),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var d="number"===typeof c?c:this.indexes[c];this.assertValidIndex(d,c),this.changes.has(d)||this.changes.set(d,{op:C.OPERATION.TOUCH,index:d}),this.allChanges.add(d),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(C){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[C]];var c,d=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(d)[0]},c.prototype.getChildrenFilter=function(){var C=this.parent._definition.childFilters;return C&&C[this.parentIndex]},c.prototype.getValue=function(C){return this.ref.getByIndex(C)},c.prototype.delete=function(c){var d="number"===typeof c?c:this.indexes[c];if(void 0!==d){var b=this.getValue(d);this.changes.set(d,{op:C.OPERATION.DELETE,index:d}),this.allChanges.delete(d),delete this.caches[d],b&&b.$changes&&(b.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(d,")"))},c.prototype.discard=function(c,d){var b=this;void 0===c&&(c=!1),void 0===d&&(d=!1),this.ref instanceof TC||this.changes.forEach((function(c){if(c.op===C.OPERATION.DELETE){var d=b.ref.getIndex(c.index);delete b.indexes[d]}})),this.changes.clear(),this.changed=c,d&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var C=this;this.changes.forEach((function(c){var d=C.getValue(c.index);d&&d.$changes&&d.$changes.discardAll()})),this.discard()},c.prototype.cache=function(C,c){this.caches[C]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(C,c){if(void 0===C)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function j(C,c,d,b){return C[c]||(C[c]=[]),C[c].push(d),null===b||void 0===b||b.forEach((function(C,c){return d(C,c)})),function(){return k(C[c],C[c].indexOf(d))}}function g(c){var d=this,b="string"!==typeof this.$changes.getType();this.$items.forEach((function(X,P){c.push({refId:d.$changes.refId,op:C.OPERATION.DELETE,field:P,value:void 0,previousValue:X}),b&&d.$changes.root.removeRef(X.$changes.refId)}))}function k(C,c){if(-1===c||c>=C.length)return!1;for(var d=C.length-1,b=c;b<d;b++)C[b]=C[b+1];return C.length=d,!0}var Z=function(C,c){var d=C.toString(),b=c.toString();return d<b?-1:d>b?1:0};function U(C){return C.$proxy=!0,C=new Proxy(C,{get:function(C,c){return"symbol"===typeof c||isNaN(c)?C[c]:C.at(c)},set:function(C,c,d){if("symbol"===typeof c||isNaN(c))C[c]=d;else{var b=Array.from(C.$items.keys()),X=parseInt(b[c]||c);void 0===d||null===d?C.deleteAt(X):C.setAt(X,d)}return!0},deleteProperty:function(C,c){return"number"===typeof c?C.deleteAt(c):delete C[c],!0}})}var A=function(){function c(){for(var C=[],c=0;c<arguments.length;c++)C[c]=arguments[c];this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,C)}return c.prototype.IV=function(c,d){return void 0===d&&(d=!0),j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,c,d?this.$items:void 0)},c.prototype.Pc=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,c)},c.is=function(C){return Array.isArray(C)||void 0!==C.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(C){0===C?this.clear():this.splice(C,this.length-C)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var C,c=this,d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];return d.forEach((function(d){C=c.$refId++,c.setAt(C,d)})),C},c.prototype.pop=function(){var C=Array.from(this.$indexes.values()).pop();if(void 0!==C){this.$changes.delete(C),this.$indexes.delete(C);var c=this.$items.get(C);return this.$items.delete(C),c}},c.prototype.at=function(C){var c=Array.from(this.$items.keys())[C];return this.$items.get(c)},c.prototype.setAt=function(c,d){var b,X;if(void 0!==d&&null!==d){if(this.$items.get(c)!==d){void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,c);var P=null!==(X=null===(b=this.$changes.indexes[c])||void 0===b?void 0:b.op)&&void 0!==X?X:C.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,d),this.$changes.change(c,P)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(C){var c=Array.from(this.$items.keys())[C];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(C){return this.$changes.delete(C),this.$indexes.delete(C),this.$items.delete(C)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&g.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var C,d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];return new(c.bind.apply(c,X([void 0],(C=Array.from(this.$items.values())).concat.apply(C,d),!1)))},c.prototype.join=function(C){return Array.from(this.$items.values()).join(C)},c.prototype.reverse=function(){var C=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(d,b){C.setAt(c[b],d)})),this},c.prototype.shift=function(){var C=Array.from(this.$items.keys()).shift();if(void 0!==C){var c=this.$items.get(C);return this.$deleteAt(C),c}},c.prototype.slice=function(C,d){var b=new c;return b.push.apply(b,Array.from(this.$items.values()).slice(C,d)),b},c.prototype.sort=function(C){var c=this;void 0===C&&(C=Z);var d=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(C).forEach((function(C,b){c.setAt(d[b],C)})),this},c.prototype.splice=function(C,c){void 0===c&&(c=this.length-C);for(var d=Array.from(this.$items.keys()),b=[],X=C;X<C+c;X++)b.push(this.$items.get(d[X])),this.$deleteAt(d[X]);return b},c.prototype.unshift=function(){for(var C=this,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var b=this.length,X=c.length,P=Array.from(this.$items.values());return c.forEach((function(c,d){C.setAt(d,c)})),P.forEach((function(c,d){C.setAt(X+d,c)})),b+X},c.prototype.indexOf=function(C,c){return Array.from(this.$items.values()).indexOf(C,c)},c.prototype.lastIndexOf=function(C,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(C,c)},c.prototype.every=function(C,c){return Array.from(this.$items.values()).every(C,c)},c.prototype.some=function(C,c){return Array.from(this.$items.values()).some(C,c)},c.prototype.forEach=function(C,c){Array.from(this.$items.values()).forEach(C,c)},c.prototype.map=function(C,c){return Array.from(this.$items.values()).map(C,c)},c.prototype.filter=function(C,c){return Array.from(this.$items.values()).filter(C,c)},c.prototype.reduce=function(C,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(C,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(C,c){return Array.from(this.$items.values()).find(C,c)},c.prototype.findIndex=function(C,c){return Array.from(this.$items.values()).findIndex(C,c)},c.prototype.fill=function(C,c,d){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(C,c,d){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(C,c){return Array.from(this.$items.values()).includes(C,c)},c.prototype.flatMap=function(C,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(C){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var C=Array.from(this.$items.values());return C.findLast.apply(C,arguments)},c.prototype.findLastIndex=function(){var C=Array.from(this.$items.values());return C.findLastIndex.apply(C,arguments)},c.prototype.setIndex=function(C,c){this.$indexes.set(C,c)},c.prototype.getIndex=function(C){return this.$indexes.get(C)},c.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},c.prototype.deleteByIndex=function(C){var c=this.$indexes.get(C);this.$items.delete(c),this.$indexes.delete(C)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(C){return"function"===typeof C.toJSON?C.toJSON():C}))},c.prototype.clone=function(C){return C?new(c.bind.apply(c,X([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,X([void 0],this.map((function(C){return C.$changes?C.clone():C})),!1)))},c}();function u(C){return C.$proxy=!0,C=new Proxy(C,{get:function(C,c){return"symbol"!==typeof c&&"undefined"===typeof C[c]?C.get(c):C[c]},set:function(C,c,d){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"IV"!==c&&"Pc"!==c&&"onChange"!==c?C.set(c,d):C[c]=d,!0},deleteProperty:function(C,c){return C.delete(c),!0}})}var q=function(){function c(C){var d=this;if(this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C)if(C instanceof Map||C instanceof c)C.forEach((function(C,c){return d.set(c,C)}));else for(var b in C)this.set(b,C[b])}return c.prototype.IV=function(c,d){return void 0===d&&(d=!0),j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,c,d?this.$items:void 0)},c.prototype.Pc=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,c)},c.is=function(C){return void 0!==C.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,d){if(void 0===d||null===d)throw new Error("MapSchema#set('".concat(c,"', ").concat(d,"): trying to set ").concat(d," value on '").concat(c,"'."));c=c.toString();var b="undefined"!==typeof this.$changes.indexes[c],X=b?this.$changes.indexes[c]:this.$refId++,P=b?C.OPERATION.REPLACE:C.OPERATION.ADD,V=void 0!==d.$changes;if(V&&d.$changes.setParent(this,this.$changes.root,X),b){if(!V&&this.$items.get(c)===d)return;V&&this.$items.get(c)!==d&&(P=C.OPERATION.ADD)}else this.$changes.indexes[c]=X,this.$indexes.set(X,c);return this.$items.set(c,d),this.$changes.change(c,P),this},c.prototype.get=function(C){return this.$items.get(C)},c.prototype.delete=function(C){return this.$changes.delete(C),this.$items.delete(C)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&g.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(C){return this.$items.has(C)},c.prototype.forEach=function(C){this.$items.forEach(C)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(C,c){this.$indexes.set(C,c)},c.prototype.getIndex=function(C){return this.$indexes.get(C)},c.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},c.prototype.deleteByIndex=function(C){var c=this.$indexes.get(C);this.$items.delete(c),this.$indexes.delete(C)},c.prototype.toJSON=function(){var C={};return this.forEach((function(c,d){C[d]="function"===typeof c.toJSON?c.toJSON():c})),C},c.prototype.clone=function(C){var d;return C?d=Object.assign(new c,this):(d=new c,this.forEach((function(C,c){C.$changes?d.set(c,C.clone()):d.set(c,C)}))),d},c}(),B={};function t(C,c){B[C]=c}function e(C){return B[C]}var n=function(){function C(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return C.create=function(c){var d=new C;return d.schema=Object.assign({},c&&c.schema||{}),d.indexes=Object.assign({},c&&c.indexes||{}),d.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),d.descriptors=Object.assign({},c&&c.descriptors||{}),d.deprecated=Object.assign({},c&&c.deprecated||{}),d},C.prototype.addField=function(C,c){var d=this.getNextFieldIndex();this.fieldsByIndex[d]=C,this.indexes[C]=d,this.schema[C]=Array.isArray(c)?{array:c[0]}:c},C.prototype.hasField=function(C){return void 0!==this.indexes[C]},C.prototype.addFilter=function(C,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[C]]=c,this.indexesWithFilters.push(this.indexes[C]),!0},C.prototype.addChildrenFilter=function(C,c){var d=this.indexes[C],b=this.schema[C];if(e(Object.keys(b)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[d]=c,!0;console.warn("@filterChildren: field '".concat(C,"' can't have children. Ignoring filter."))},C.prototype.getChildrenFilter=function(C){return this.childFilters&&this.childFilters[this.indexes[C]]},C.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},C}();function W(C){return C._context&&C._context.useFilters}var E=function(){function C(){this.types={},this.schemas=new Map,this.useFilters=!1}return C.prototype.has=function(C){return this.schemas.has(C)},C.prototype.get=function(C){return this.types[C]},C.prototype.add=function(C,c){void 0===c&&(c=this.schemas.size),C._definition=n.create(C._definition),C._typeid=c,this.types[c]=C,this.schemas.set(C,c)},C.create=function(c){return void 0===c&&(c={}),function(d){return c.context||(c.context=new C),r(d,c)}},C}(),N=new E;function r(C,c){return void 0===c&&(c={}),function(d,b){var P=c.context||N,V=d.constructor;if(V._context=P,!C)throw new Error("".concat(V.name,': @type() reference provided for "').concat(b,"\" is undefined. Make sure you don't have any circular dependencies."));P.has(V)||P.add(V);var R=V._definition;if(R.addField(b,C),R.descriptors[b]){if(R.deprecated[b])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(b,"' definition on '").concat(V.name,"'.\nCheck @type() annotation"))}catch(B){var p=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(p))}}var j=A.is(C),g=!j&&q.is(C);if("string"!==typeof C&&!TC.is(C)){var k=Object.values(C)[0];"string"===typeof k||P.has(k)||P.add(k)}if(c.manual)R.descriptors[b]={enumerable:!0,configurable:!0,writable:!0};else{var Z="_".concat(b);R.descriptors[Z]={enumerable:!1,configurable:!1,writable:!0},R.descriptors[b]={get:function(){return this[Z]},set:function(C){C!==this[Z]&&(void 0!==C&&null!==C?(!j||C instanceof A||(C=new(A.bind.apply(A,X([void 0],C,!1)))),!g||C instanceof q||(C=new q(C)),void 0===C.$proxy&&(g?C=u(C):j&&(C=U(C))),this.$changes.change(b),C.$changes&&C.$changes.setParent(this,this.$changes.root,this._definition.indexes[b])):this[Z]&&this.$changes.delete(b),this[Z]=C)},enumerable:!0,configurable:!0}}}}function M(C){return function(c,d){var b=c.constructor;b._definition.addFilter(d,C)&&(b._context.useFilters=!0)}}function K(C){return function(c,d){var b=c.constructor;b._definition.addChildrenFilter(d,C)&&(b._context.useFilters=!0)}}function i(C){return void 0===C&&(C=!0),function(c,d){var b=c.constructor._definition;b.deprecated[d]=!0,C&&(b.descriptors[d]={get:function(){throw new Error("".concat(d," is deprecated."))},set:function(C){},enumerable:!1,configurable:!0})}}function h(C,c,d){for(var b in void 0===d&&(d={}),d.context||(d.context=C._context||d.context||N),c)r(c[b],d)(C.prototype,b);return C}function L(C){for(var c=0,d=0,b=0,X=C.length;b<X;b++)(c=C.charCodeAt(b))<128?d+=1:c<2048?d+=2:c<55296||c>=57344?d+=3:(b++,d+=4);return d}function f(C,c,d){for(var b=0,X=0,P=d.length;X<P;X++)(b=d.charCodeAt(X))<128?C[c++]=b:b<2048?(C[c++]=192|b>>6,C[c++]=128|63&b):b<55296||b>=57344?(C[c++]=224|b>>12,C[c++]=128|b>>6&63,C[c++]=128|63&b):(X++,b=65536+((1023&b)<<10|1023&d.charCodeAt(X)),C[c++]=240|b>>18,C[c++]=128|b>>12&63,C[c++]=128|b>>6&63,C[c++]=128|63&b)}function T(C,c){C.push(255&c)}function z(C,c){C.push(255&c)}function w(C,c){C.push(255&c),C.push(c>>8&255)}function J(C,c){C.push(255&c),C.push(c>>8&255)}function y(C,c){C.push(255&c),C.push(c>>8&255),C.push(c>>16&255),C.push(c>>24&255)}function x(C,c){var d=c>>24,b=c>>16,X=c>>8,P=c;C.push(255&P),C.push(255&X),C.push(255&b),C.push(255&d)}function H(C,c){var d=Math.floor(c/Math.pow(2,32));x(C,c>>>0),x(C,d)}function v(C,c){var d=c/Math.pow(2,32)|0;x(C,c>>>0),x(C,d)}function D(C,c){o(C,c)}function s(C,c){F(C,c)}var mC=new Int32Array(2),Q=new Float32Array(mC.buffer),I=new Float64Array(mC.buffer);function o(C,c){Q[0]=c,y(C,mC[0])}function F(C,c){I[0]=c,y(C,mC[0]),y(C,mC[1])}function Y(C,c){return z(C,c?1:0)}function l(C,c){c||(c="");var d=L(c),b=0;if(d<32)C.push(160|d),b=1;else if(d<256)C.push(217),z(C,d),b=2;else if(d<65536)C.push(218),J(C,d),b=3;else{if(!(d<4294967296))throw new Error("String too long");C.push(219),x(C,d),b=5}return f(C,C.length,c),b+d}function S(C,c){return isNaN(c)?S(C,0):isFinite(c)?c!==(0|c)?(C.push(203),F(C,c),9):c>=0?c<128?(z(C,c),1):c<256?(C.push(204),z(C,c),2):c<65536?(C.push(205),J(C,c),3):c<4294967296?(C.push(206),x(C,c),5):(C.push(207),v(C,c),9):c>=-32?(C.push(224|c+32),1):c>=-128?(C.push(208),T(C,c),2):c>=-32768?(C.push(209),w(C,c),3):c>=-2147483648?(C.push(210),y(C,c),5):(C.push(211),H(C,c),9):S(C,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var G=Object.freeze({__proto__:null,utf8Write:f,int8:T,uint8:z,int16:w,uint16:J,int32:y,uint32:x,int64:H,uint64:v,float32:D,float64:s,writeFloat32:o,writeFloat64:F,boolean:Y,string:l,number:S});function a(C,c,d){for(var b="",X=0,P=c,V=c+d;P<V;P++){var R=C[P];0!==(128&R)?192!==(224&R)?224!==(240&R)?240!==(248&R)?console.error("Invalid byte "+R.toString(16)):(X=(7&R)<<18|(63&C[++P])<<12|(63&C[++P])<<6|63&C[++P])>=65536?(X-=65536,b+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):b+=String.fromCharCode(X):b+=String.fromCharCode((15&R)<<12|(63&C[++P])<<6|63&C[++P]):b+=String.fromCharCode((31&R)<<6|63&C[++P]):b+=String.fromCharCode(R)}return b}function O(C,c){return CC(C,c)<<24>>24}function CC(C,c){return C[c.offset++]}function cC(C,c){return dC(C,c)<<16>>16}function dC(C,c){return C[c.offset++]|C[c.offset++]<<8}function bC(C,c){return C[c.offset++]|C[c.offset++]<<8|C[c.offset++]<<16|C[c.offset++]<<24}function XC(C,c){return bC(C,c)>>>0}function PC(C,c){return ZC(C,c)}function VC(C,c){return UC(C,c)}function RC(C,c){var d=XC(C,c);return bC(C,c)*Math.pow(2,32)+d}function pC(C,c){var d=XC(C,c);return XC(C,c)*Math.pow(2,32)+d}var jC=new Int32Array(2),gC=new Float32Array(jC.buffer),kC=new Float64Array(jC.buffer);function ZC(C,c){return jC[0]=bC(C,c),gC[0]}function UC(C,c){return jC[0]=bC(C,c),jC[1]=bC(C,c),kC[0]}function AC(C,c){return CC(C,c)>0}function uC(C,c){var d,b=C[c.offset++];b<192?d=31&b:217===b?d=CC(C,c):218===b?d=dC(C,c):219===b&&(d=XC(C,c));var X=a(C,c.offset,d);return c.offset+=d,X}function qC(C,c){var d=C[c.offset];return d<192&&d>160||217===d||218===d||219===d}function BC(C,c){var d=C[c.offset++];return d<128?d:202===d?ZC(C,c):203===d?UC(C,c):204===d?CC(C,c):205===d?dC(C,c):206===d?XC(C,c):207===d?pC(C,c):208===d?O(C,c):209===d?cC(C,c):210===d?bC(C,c):211===d?RC(C,c):d>223?-1*(255-d+1):void 0}function tC(C,c){var d=C[c.offset];return d<128||d>=202&&d<=211}function eC(C,c){return C[c.offset]<160}function nC(C,c){return C[c.offset-1]===V&&(C[c.offset]<128||C[c.offset]>=202&&C[c.offset]<=211)}var WC=Object.freeze({__proto__:null,int8:O,uint8:CC,int16:cC,uint16:dC,int32:bC,uint32:XC,float32:PC,float64:VC,int64:RC,uint64:pC,readFloat32:ZC,readFloat64:UC,boolean:AC,string:uC,stringCheck:qC,number:BC,numberCheck:tC,arrayCheck:eC,switchStructureCheck:nC}),EC=function(){function c(C){var c=this;this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C&&C.forEach((function(C){return c.add(C)}))}return c.prototype.IV=function(c,d){return void 0===d&&(d=!0),j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,c,d?this.$items:void 0)},c.prototype.Pc=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,c)},c.is=function(C){return void 0!==C.collection},c.prototype.add=function(C){var c=this.$refId++;return void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,C),this.$changes.change(c),c},c.prototype.at=function(C){var c=Array.from(this.$items.keys())[C];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(C){for(var c,d,b=this.$items.entries();(d=b.next())&&!d.done;)if(C===d.value[1]){c=d.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&g.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(C){return Array.from(this.$items.values()).some((function(c){return c===C}))},c.prototype.forEach=function(C){var c=this;this.$items.forEach((function(d,b,X){return C(d,b,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(C,c){this.$indexes.set(C,c)},c.prototype.getIndex=function(C){return this.$indexes.get(C)},c.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},c.prototype.deleteByIndex=function(C){var c=this.$indexes.get(C);this.$items.delete(c),this.$indexes.delete(C)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var C=[];return this.forEach((function(c,d){C.push("function"===typeof c.toJSON?c.toJSON():c)})),C},c.prototype.clone=function(C){var d;return C?d=Object.assign(new c,this):(d=new c,this.forEach((function(C){C.$changes?d.add(C.clone()):d.add(C)}))),d},c}(),NC=function(){function c(C){var c=this;this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C&&C.forEach((function(C){return c.add(C)}))}return c.prototype.IV=function(c,d){return void 0===d&&(d=!0),j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,c,d?this.$items:void 0)},c.prototype.Pc=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,c)},c.is=function(C){return void 0!==C.set},c.prototype.add=function(c){var d,b;if(this.has(c))return!1;var X=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,X);var P=null!==(b=null===(d=this.$changes.indexes[X])||void 0===d?void 0:d.op)&&void 0!==b?b:C.OPERATION.ADD;return this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,c),this.$changes.change(X,P),X},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(C){for(var c,d,b=this.$items.entries();(d=b.next())&&!d.done;)if(C===d.value[1]){c=d.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&g.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(C){for(var c,d=this.$items.values(),b=!1;(c=d.next())&&!c.done;)if(C===c.value){b=!0;break}return b},c.prototype.forEach=function(C){var c=this;this.$items.forEach((function(d,b,X){return C(d,b,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(C,c){this.$indexes.set(C,c)},c.prototype.getIndex=function(C){return this.$indexes.get(C)},c.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},c.prototype.deleteByIndex=function(C){var c=this.$indexes.get(C);this.$items.delete(c),this.$indexes.delete(C)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var C=[];return this.forEach((function(c,d){C.push("function"===typeof c.toJSON?c.toJSON():c)})),C},c.prototype.clone=function(C){var d;return C?d=Object.assign(new c,this):(d=new c,this.forEach((function(C){C.$changes?d.add(C.clone()):d.add(C)}))),d},c}(),rC=function(){function C(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return C.prototype.addRefId=function(C){this.refIds.has(C)||(this.refIds.add(C),this.containerIndexes.set(C,new Set))},C.get=function(c){return void 0===c.$filterState&&(c.$filterState=new C),c.$filterState},C}(),MC=function(){function C(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return C.prototype.getNextUniqueId=function(){return this.nextUniqueId++},C.prototype.addRef=function(C,c,d){void 0===d&&(d=!0),this.refs.set(C,c),d&&(this.refCounts[C]=(this.refCounts[C]||0)+1)},C.prototype.removeRef=function(C){this.refCounts[C]=this.refCounts[C]-1,this.deletedRefs.add(C)},C.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},C.prototype.garbageCollectDeletedRefs=function(){var C=this;this.deletedRefs.forEach((function(c){if(!(C.refCounts[c]>0)){var d=C.refs.get(c);if(d instanceof TC)for(var b in d._definition.schema)"string"!==typeof d._definition.schema[b]&&d[b]&&d[b].$changes&&C.removeRef(d[b].$changes.refId);else{var X=d.$changes.parent._definition,P=X.schema[X.fieldsByIndex[d.$changes.parentIndex]];"function"===typeof Object.values(P)[0]&&Array.from(d.values()).forEach((function(c){return C.removeRef(c.$changes.refId)}))}C.refs.delete(c),delete C.refCounts[c]}})),this.deletedRefs.clear()},C}(),KC=function(C){function c(){return null!==C&&C.apply(this,arguments)||this}return d(c,C),c}(Error);function iC(C,c,d,b){var X,P=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":X="number",isNaN(C)&&console.log('trying to encode "NaN" in '.concat(d.constructor.name,"#").concat(b));break;case"string":X="string",P=!0;break;case"boolean":return}if(typeof C!==X&&(!P||P&&null!==C)){var V="'".concat(JSON.stringify(C),"'").concat(C&&C.constructor&&" (".concat(C.constructor.name,")")||"");throw new KC("a '".concat(X,"' was expected, but ").concat(V," was provided in ").concat(d.constructor.name,"#").concat(b))}}function hC(C,c,d,b){if(!(C instanceof c))throw new KC("a '".concat(c.name,"' was expected, but '").concat(C.constructor.name,"' was provided in ").concat(d.constructor.name,"#").concat(b))}function LC(C,c,d,b,X){iC(d,C,b,X);var P=G[C];if(!P)throw new KC("a '".concat(C,"' was expected, but ").concat(d," was provided in ").concat(b.constructor.name,"#").concat(X));P(c,d)}function fC(C,c,d){return WC[C](c,d)}var TC=function(){function c(){for(var C=[],c=0;c<arguments.length;c++)C[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new p(this,void 0,new MC),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var d=this._definition.descriptors;d&&Object.defineProperties(this,d),C[0]&&this.assign(C[0])}return c.onError=function(C){console.error(C)},c.is=function(C){return C._definition&&void 0!==C._definition.schema},c.prototype.onChange=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,c)},c.prototype.Pc=function(c){return j(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,c)},c.prototype.assign=function(C){return Object.assign(this,C),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(C,c){this.$changes.change(C,c)},c.prototype.listen=function(C,c,d){var b=this;return void 0===d&&(d=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[C]||(this.$callbacks[C]=[]),this.$callbacks[C].push(c),d&&void 0!==this[C]&&c(this[C],void 0),function(){return k(b.$callbacks[C],b.$callbacks[C].indexOf(c))}},c.prototype.decode=function(d,b,X){var P;void 0===b&&(b={offset:0}),void 0===X&&(X=this);var R=[],p=this.$changes.root,j=d.length,g=0;for(p.refs.set(g,this);b.offset<j;){var k=d[b.offset++];if(k!=V){var Z=X.$changes,U=void 0!==X._definition,u=U?k>>6<<6:k;if(u!==C.OPERATION.CLEAR){var B=U?k%(u||255):BC(d,b),t=U?X._definition.fieldsByIndex[B]:"",n=Z.getType(B),W=void 0,E=void 0,N=void 0;if(U?E=X["_".concat(t)]:(E=X.getByIndex(B),(u&C.OPERATION.ADD)===C.OPERATION.ADD?(N=X instanceof q?uC(d,b):B,X.setIndex(B,N)):N=X.getIndex(B)),(u&C.OPERATION.DELETE)===C.OPERATION.DELETE&&(u!==C.OPERATION.DELETE_AND_ADD&&X.deleteByIndex(B),E&&E.$changes&&p.removeRef(E.$changes.refId),W=null),void 0!==t){if(u===C.OPERATION.DELETE);else if(c.is(n)){var r=BC(d,b);if(W=p.refs.get(r),u!==C.OPERATION.REPLACE){var M=this.getSchemaType(d,b,n);W||((W=this.createTypeInstance(M)).$changes.refId=r,E&&(W.$callbacks=E.$callbacks,E.$changes.refId&&r!==E.$changes.refId&&p.removeRef(E.$changes.refId))),p.addRef(r,W,W!==E)}}else if("string"===typeof n)W=fC(n,d,b);else{var K=e(Object.keys(n)[0]),i=BC(d,b),h=p.refs.has(i)?E||p.refs.get(i):new K.constructor;if((W=h.clone(!0)).$changes.refId=i,E&&(W.$callbacks=E.$callbacks,E.$changes.refId&&i!==E.$changes.refId)){p.removeRef(E.$changes.refId);for(var L=E.entries(),f=void 0;(f=L.next())&&!f.done;){var T=(P=f.value)[0],z=P[1];R.push({refId:i,op:C.OPERATION.DELETE,field:T,value:void 0,previousValue:z})}}p.addRef(i,W,h!==E)}if(null!==W&&void 0!==W)if(W.$changes&&W.$changes.setParent(Z.ref,Z.root,B),X instanceof c)X[t]=W;else if(X instanceof q)T=N,X.$items.set(T,W),X.$changes.allChanges.add(B);else if(X instanceof A)X.setAt(B,W);else if(X instanceof EC){var w=X.add(W);X.setIndex(B,w)}else X instanceof NC&&!1!==(w=X.add(W))&&X.setIndex(B,w);E!==W&&R.push({refId:g,op:u,field:t,dynamicIndex:N,value:W,previousValue:E})}else{console.warn("@colyseus/schema: definition mismatch");for(var J={offset:b.offset};b.offset<j&&(!nC(d,b)||(J.offset=b.offset+1,!p.refs.has(BC(d,J))));)b.offset++}}else X.clear(R)}else{g=BC(d,b);var y=p.refs.get(g);if(!y)throw new Error('"refId" not found: '.concat(g));X=y}}return this._triggerChanges(R),p.garbageCollectDeletedRefs(),R},c.prototype.encode=function(d,b,X){void 0===d&&(d=!1),void 0===b&&(b=[]),void 0===X&&(X=!1);for(var P=this.$changes,R=new WeakSet,p=[P],j=1,g=0;g<j;g++){var k=p[g],Z=k.ref,U=Z instanceof c;k.ensureRefId(),R.add(k),k!==P&&(k.changed||d)&&(z(b,V),S(b,k.refId));for(var A=d?Array.from(k.allChanges):Array.from(k.changes.values()),u=0,B=A.length;u<B;u++){var t=d?{op:C.OPERATION.ADD,index:A[u]}:A[u],n=t.index,W=U?Z._definition.fieldsByIndex&&Z._definition.fieldsByIndex[n]:n,E=b.length;if(t.op!==C.OPERATION.TOUCH)if(U)z(b,n|t.op);else{if(z(b,t.op),t.op===C.OPERATION.CLEAR)continue;S(b,n)}if(U||(t.op&C.OPERATION.ADD)!=C.OPERATION.ADD||Z instanceof q&&l(b,k.ref.$indexes.get(n)),t.op!==C.OPERATION.DELETE){var N=k.getType(n),r=k.getValue(n);if(r&&r.$changes&&!R.has(r.$changes)&&(p.push(r.$changes),r.$changes.ensureRefId(),j++),t.op!==C.OPERATION.TOUCH){if(c.is(N))hC(r,N,Z,W),S(b,r.$changes.refId),(t.op&C.OPERATION.ADD)===C.OPERATION.ADD&&this.tryEncodeTypeId(b,N,r.constructor);else if("string"===typeof N)LC(N,b,r,Z,W);else{var M=e(Object.keys(N)[0]);hC(Z["_".concat(W)],M.constructor,Z,W),S(b,r.$changes.refId)}X&&k.cache(n,b.slice(E))}}}d||X||k.discard()}return b},c.prototype.encodeAll=function(C){return this.encode(!0,[],C)},c.prototype.applyFilters=function(d,b){var X,P;void 0===b&&(b=!1);for(var R=this,p=new Set,j=rC.get(d),g=[this.$changes],k=1,Z=[],U=function(U){var A=g[U];if(p.has(A.refId))return"continue";var u=A.ref,B=u instanceof c;z(Z,V),S(Z,A.refId);var t=j.refIds.has(A),e=b||!t;j.addRefId(A);var n=j.containerIndexes.get(A),W=e?Array.from(A.allChanges):Array.from(A.changes.values());!b&&B&&u._definition.indexesWithFilters&&u._definition.indexesWithFilters.forEach((function(c){!n.has(c)&&A.allChanges.has(c)&&(e?W.push(c):W.push({op:C.OPERATION.ADD,index:c}))}));for(var E=0,N=W.length;E<N;E++){var r=e?{op:C.OPERATION.ADD,index:W[E]}:W[E];if(r.op!==C.OPERATION.CLEAR){var M=r.index;if(r.op!==C.OPERATION.DELETE){var K=A.getValue(M),i=A.getType(M);if(B){if((h=u._definition.filters&&u._definition.filters[M])&&!h.call(u,d,K,R)){K&&K.$changes&&p.add(K.$changes.refId);continue}}else{var h,L=A.parent;if((h=A.getChildrenFilter())&&!h.call(L,d,u.$indexes.get(M),K,R)){K&&K.$changes&&p.add(K.$changes.refId);continue}}if(K.$changes&&(g.push(K.$changes),k++),r.op!==C.OPERATION.TOUCH)if(r.op===C.OPERATION.ADD||B)Z.push.apply(Z,null!==(X=A.caches[M])&&void 0!==X?X:[]),n.add(M);else if(n.has(M))Z.push.apply(Z,null!==(P=A.caches[M])&&void 0!==P?P:[]);else{if(n.add(M),z(Z,C.OPERATION.ADD),S(Z,M),u instanceof q){var f=A.ref.$indexes.get(M);l(Z,f)}K.$changes?S(Z,K.$changes.refId):G[i](Z,K)}else K.$changes&&!B&&(z(Z,C.OPERATION.ADD),S(Z,M),u instanceof q&&(f=A.ref.$indexes.get(M),l(Z,f)),S(Z,K.$changes.refId))}else B?z(Z,r.op|M):(z(Z,r.op),S(Z,M))}else z(Z,r.op)}},A=0;A<k;A++)U(A);return Z},c.prototype.clone=function(){var C,c=new this.constructor,d=this._definition.schema;for(var b in d)"object"===typeof this[b]&&"function"===typeof(null===(C=this[b])||void 0===C?void 0:C.clone)?c[b]=this[b].clone():c[b]=this[b];return c},c.prototype.toJSON=function(){var C=this._definition.schema,c=this._definition.deprecated,d={};for(var b in C)c[b]||null===this[b]||"undefined"===typeof this[b]||(d[b]="function"===typeof this[b].toJSON?this[b].toJSON():this["_".concat(b)]);return d},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(C){return this[this._definition.fieldsByIndex[C]]},c.prototype.deleteByIndex=function(C){this[this._definition.fieldsByIndex[C]]=void 0},c.prototype.tryEncodeTypeId=function(C,c,d){c._typeid!==d._typeid&&(z(C,R),S(C,d._typeid))},c.prototype.getSchemaType=function(C,c,d){var b;return C[c.offset]===R&&(c.offset++,b=this.constructor._context.get(BC(C,c))),b||d},c.prototype.createTypeInstance=function(C){var c=new C;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(d){for(var b,X,P,V,R,p,j,g,k,Z=new Set,U=this.$changes.root.refs,A=function(A){var u=d[A],q=u.refId,B=U.get(q),t=B.$callbacks;if((u.op&C.OPERATION.DELETE)===C.OPERATION.DELETE&&u.previousValue instanceof c&&(null===(X=null===(b=u.previousValue.$callbacks)||void 0===b?void 0:b[C.OPERATION.DELETE])||void 0===X||X.forEach((function(C){return C()}))),!t)return"continue";if(B instanceof c){if(!Z.has(q))try{null===(P=null===t||void 0===t?void 0:t[C.OPERATION.REPLACE])||void 0===P||P.forEach((function(C){return C()}))}catch(e){c.onError(e)}try{t.hasOwnProperty(u.field)&&(null===(V=t[u.field])||void 0===V||V.forEach((function(C){return C(u.value,u.previousValue)})))}catch(e){c.onError(e)}}else u.op===C.OPERATION.ADD&&void 0===u.previousValue?null===(R=t[C.OPERATION.ADD])||void 0===R||R.forEach((function(C){var c;return C(u.value,null!==(c=u.dynamicIndex)&&void 0!==c?c:u.field)})):u.op===C.OPERATION.DELETE?void 0!==u.previousValue&&(null===(p=t[C.OPERATION.DELETE])||void 0===p||p.forEach((function(C){var c;return C(u.previousValue,null!==(c=u.dynamicIndex)&&void 0!==c?c:u.field)}))):u.op===C.OPERATION.DELETE_AND_ADD&&(void 0!==u.previousValue&&(null===(j=t[C.OPERATION.DELETE])||void 0===j||j.forEach((function(C){var c;return C(u.previousValue,null!==(c=u.dynamicIndex)&&void 0!==c?c:u.field)}))),null===(g=t[C.OPERATION.ADD])||void 0===g||g.forEach((function(C){var c;return C(u.value,null!==(c=u.dynamicIndex)&&void 0!==c?c:u.field)}))),u.value!==u.previousValue&&(null===(k=t[C.OPERATION.REPLACE])||void 0===k||k.forEach((function(C){var c;return C(u.value,null!==(c=u.dynamicIndex)&&void 0!==c?c:u.field)})));Z.add(q)},u=0;u<d.length;u++)A(u)},c._definition=n.create(),c}();function zC(C){for(var c=[C.$changes],d=1,b={},X=b,P=function(C){var d=c[C];d.changes.forEach((function(C){var c=d.ref,b=C.index,P=c._definition?c._definition.fieldsByIndex[b]:c.$indexes.get(b);X[P]=d.getValue(b)}))},V=0;V<d;V++)P(V);return b}var wC={context:new E},JC=function(C){function c(){return null!==C&&C.apply(this,arguments)||this}return d(c,C),b([r("string",wC)],c.prototype,"name",void 0),b([r("string",wC)],c.prototype,"type",void 0),b([r("number",wC)],c.prototype,"referencedType",void 0),c}(TC),yC=function(C){function c(){var c=null!==C&&C.apply(this,arguments)||this;return c.fields=new A,c}return d(c,C),b([r("number",wC)],c.prototype,"id",void 0),b([r([JC],wC)],c.prototype,"fields",void 0),c}(TC),xC=function(C){function c(){var c=null!==C&&C.apply(this,arguments)||this;return c.types=new A,c}return d(c,C),c.encode=function(C){var d=C.constructor,b=new c;b.rootType=d._typeid;var X=function(C,c){for(var d in c){var X=new JC;X.name=d;var P=void 0;if("string"===typeof c[d])P=c[d];else{var V=c[d],R=void 0;TC.is(V)?(P="ref",R=c[d]):"string"===typeof V[P=Object.keys(V)[0]]?P+=":"+V[P]:R=V[P],X.referencedType=R?R._typeid:-1}X.type=P,C.fields.push(X)}b.types.push(C)},P=d._context.types;for(var V in P){var R=new yC;R.id=Number(V),X(R,P[V]._definition.schema)}return b.encodeAll()},c.decode=function(C,b){var X=new E,P=new c;P.decode(C,b);var V=P.types.reduce((function(C,c){var b=function(C){function c(){return null!==C&&C.apply(this,arguments)||this}return d(c,C),c}(TC),P=c.id;return C[P]=b,X.add(b,P),C}),{});P.types.forEach((function(C){var c=V[C.id];C.fields.forEach((function(C){var d;if(void 0!==C.referencedType){var b=C.type,P=V[C.referencedType];if(!P){var R=C.type.split(":");b=R[0],P=R[1]}"ref"===b?r(P,{context:X})(c.prototype,C.name):r(((d={})[b]=P,d),{context:X})(c.prototype,C.name)}else r(C.type,{context:X})(c.prototype,C.name)}))}));var R=V[P.rootType],p=new R;for(var j in R._definition.schema){var g=R._definition.schema[j];"string"!==typeof g&&(p[j]="function"===typeof g?new g:new(e(Object.keys(g)[0]).constructor))}return p},b([r([yC],wC)],c.prototype,"types",void 0),b([r("number",wC)],c.prototype,"rootType",void 0),c}(TC);t("map",{constructor:q}),t("array",{constructor:A}),t("set",{constructor:NC}),t("collection",{constructor:EC}),C.ArraySchema=A,C.CollectionSchema=EC,C.Context=E,C.MapSchema=q,C.Reflection=xC,C.ReflectionField=JC,C.ReflectionType=yC,C.Schema=TC,C.SchemaDefinition=n,C.SetSchema=NC,C.decode=WC,C.defineTypes=h,C.deprecated=i,C.dumpChanges=zC,C.encode=G,C.filter=M,C.filterChildren=K,C.hasFilter=W,C.registerType=t,C.type=r,Object.defineProperty(C,"__esModule",{value:!0})}(c)},14567:C=>{"use strict";C.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14560:(C,c,d)=>{var b=d(14567),X=d(14574),P=Object.hasOwnProperty,V=Object.create(null);for(var R in b)P.call(b,R)&&(V[b[R]]=R);var p=C.exports={to:{},get:{}};function j(C,c,d){return Math.min(Math.max(c,C),d)}function g(C){var c=Math.round(C).toString(16).toUpperCase();return c.length<2?"0"+c:c}p.get=function(C){var c,d;switch(C.substring(0,3).toLowerCase()){case"hsl":c=p.get.hsl(C),d="hsl";break;case"hwb":c=p.get.hwb(C),d="hwb";break;default:c=p.get.rgb(C),d="rgb"}return c?{model:d,value:c}:null},p.get.rgb=function(C){if(!C)return null;var c,d,X,V=[0,0,0,1];if(c=C.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(X=c[2],c=c[1],d=0;d<3;d++){var R=2*d;V[d]=parseInt(c.slice(R,R+2),16)}X&&(V[3]=parseInt(X,16)/255)}else if(c=C.match(/^#([a-f0-9]{3,4})$/i)){for(X=(c=c[1])[3],d=0;d<3;d++)V[d]=parseInt(c[d]+c[d],16);X&&(V[3]=parseInt(X+X,16)/255)}else if(c=C.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(d=0;d<3;d++)V[d]=parseInt(c[d+1],0);c[4]&&(c[5]?V[3]=.01*parseFloat(c[4]):V[3]=parseFloat(c[4]))}else{if(!(c=C.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=C.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:P.call(b,c[1])?((V=b[c[1]])[3]=1,V):null:null;for(d=0;d<3;d++)V[d]=Math.round(2.55*parseFloat(c[d+1]));c[4]&&(c[5]?V[3]=.01*parseFloat(c[4]):V[3]=parseFloat(c[4]))}for(d=0;d<3;d++)V[d]=j(V[d],0,255);return V[3]=j(V[3],0,1),V},p.get.hsl=function(C){if(!C)return null;var c=C.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var d=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,j(parseFloat(c[2]),0,100),j(parseFloat(c[3]),0,100),j(isNaN(d)?1:d,0,1)]}return null},p.get.hwb=function(C){if(!C)return null;var c=C.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var d=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,j(parseFloat(c[2]),0,100),j(parseFloat(c[3]),0,100),j(isNaN(d)?1:d,0,1)]}return null},p.to.hex=function(){var C=X(arguments);return"#"+g(C[0])+g(C[1])+g(C[2])+(C[3]<1?g(Math.round(255*C[3])):"")},p.to.rgb=function(){var C=X(arguments);return C.length<4||1===C[3]?"rgb("+Math.round(C[0])+", "+Math.round(C[1])+", "+Math.round(C[2])+")":"rgba("+Math.round(C[0])+", "+Math.round(C[1])+", "+Math.round(C[2])+", "+C[3]+")"},p.to.rgb.percent=function(){var C=X(arguments),c=Math.round(C[0]/255*100),d=Math.round(C[1]/255*100),b=Math.round(C[2]/255*100);return C.length<4||1===C[3]?"rgb("+c+"%, "+d+"%, "+b+"%)":"rgba("+c+"%, "+d+"%, "+b+"%, "+C[3]+")"},p.to.hsl=function(){var C=X(arguments);return C.length<4||1===C[3]?"hsl("+C[0]+", "+C[1]+"%, "+C[2]+"%)":"hsla("+C[0]+", "+C[1]+"%, "+C[2]+"%, "+C[3]+")"},p.to.hwb=function(){var C=X(arguments),c="";return C.length>=4&&1!==C[3]&&(c=", "+C[3]),"hwb("+C[0]+", "+C[1]+"%, "+C[2]+"%"+c+")"},p.to.keyword=function(C){return V[C.slice(0,3)]}},14555:(C,c,d)=>{const b=d(14560),X=d(14584),P=["keyword","gray","hex"],V={};for(const U of Object.keys(X))V[[...X[U].labels].sort().join("")]=U;const R={};function p(C,c){if(!(this instanceof p))return new p(C,c);if(c&&c in P&&(c=null),c&&!(c in X))throw new Error("Unknown model: "+c);let d,j;if(null==C)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(C instanceof p)this.model=C.model,this.color=[...C.color],this.valpha=C.valpha;else if("string"===typeof C){const c=b.get(C);if(null===c)throw new Error("Unable to parse color from string: "+C);this.model=c.model,j=X[this.model].channels,this.color=c.value.slice(0,j),this.valpha="number"===typeof c.value[j]?c.value[j]:1}else if(C.length>0){this.model=c||"rgb",j=X[this.model].channels;const d=Array.prototype.slice.call(C,0,j);this.color=Z(d,j),this.valpha="number"===typeof C[j]?C[j]:1}else if("number"===typeof C)this.model="rgb",this.color=[C>>16&255,C>>8&255,255&C],this.valpha=1;else{this.valpha=1;const c=Object.keys(C);"alpha"in C&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof C.alpha?C.alpha:0);const b=c.sort().join("");if(!(b in V))throw new Error("Unable to parse color from object: "+JSON.stringify(C));this.model=V[b];const{labels:P}=X[this.model],R=[];for(d=0;d<P.length;d++)R.push(C[P[d]]);this.color=Z(R)}if(R[this.model])for(j=X[this.model].channels,d=0;d<j;d++){const C=R[this.model][d];C&&(this.color[d]=C(this.color[d]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}p.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(C){let c=this.model in b.to?this:this.rgb();c=c.round("number"===typeof C?C:1);const d=1===c.valpha?c.color:[...c.color,this.valpha];return b.to[c.model](d)},percentString(C){const c=this.rgb().round("number"===typeof C?C:1),d=1===c.valpha?c.color:[...c.color,this.valpha];return b.to.rgb.percent(d)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const C={},{channels:c}=X[this.model],{labels:d}=X[this.model];for(let b=0;b<c;b++)C[d[b]]=this.color[b];return 1!==this.valpha&&(C.alpha=this.valpha),C},unitArray(){const C=this.rgb().color;return C[0]/=255,C[1]/=255,C[2]/=255,1!==this.valpha&&C.push(this.valpha),C},unitObject(){const C=this.rgb().object();return C.r/=255,C.g/=255,C.b/=255,1!==this.valpha&&(C.alpha=this.valpha),C},round(C){return C=Math.max(C||0,0),new p([...this.color.map(j(C)),this.valpha],this.model)},alpha(C){return void 0!==C?new p([...this.color,Math.max(0,Math.min(1,C))],this.model):this.valpha},red:g("rgb",0,k(255)),green:g("rgb",1,k(255)),blue:g("rgb",2,k(255)),hue:g(["hsl","hsv","hsl","hwb","hcg"],0,(C=>(C%360+360)%360)),saturationl:g("hsl",1,k(100)),lightness:g("hsl",2,k(100)),saturationv:g("hsv",1,k(100)),value:g("hsv",2,k(100)),chroma:g("hcg",1,k(100)),gray:g("hcg",2,k(100)),white:g("hwb",1,k(100)),wblack:g("hwb",2,k(100)),cyan:g("cmyk",0,k(100)),magenta:g("cmyk",1,k(100)),yellow:g("cmyk",2,k(100)),black:g("cmyk",3,k(100)),x:g("xyz",0,k(95.047)),y:g("xyz",1,k(100)),z:g("xyz",2,k(108.833)),l:g("lab",0,k(100)),a:g("lab",1),b:g("lab",2),keyword(C){return void 0!==C?new p(C):X[this.model].keyword(this.color)},hex(C){return void 0!==C?new p(C):b.to.hex(this.rgb().round().color)},hexa(C){if(void 0!==C)return new p(C);const c=this.rgb().round().color;let d=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===d.length&&(d="0"+d),b.to.hex(c)+d},rgbNumber(){const C=this.rgb().color;return(255&C[0])<<16|(255&C[1])<<8|255&C[2]},luminosity(){const C=this.rgb().color,c=[];for(const[d,b]of C.entries()){const C=b/255;c[d]=C<=.04045?C/12.92:((C+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(C){const c=this.luminosity(),d=C.luminosity();return c>d?(c+.05)/(d+.05):(d+.05)/(c+.05)},level(C){const c=this.contrast(C);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const C=this.rgb().color;return(2126*C[0]+7152*C[1]+722*C[2])/1e4<128},isLight(){return!this.isDark()},negate(){const C=this.rgb();for(let c=0;c<3;c++)C.color[c]=255-C.color[c];return C},lighten(C){const c=this.hsl();return c.color[2]+=c.color[2]*C,c},darken(C){const c=this.hsl();return c.color[2]-=c.color[2]*C,c},saturate(C){const c=this.hsl();return c.color[1]+=c.color[1]*C,c},desaturate(C){const c=this.hsl();return c.color[1]-=c.color[1]*C,c},whiten(C){const c=this.hwb();return c.color[1]+=c.color[1]*C,c},blacken(C){const c=this.hwb();return c.color[2]+=c.color[2]*C,c},grayscale(){const C=this.rgb().color,c=.3*C[0]+.59*C[1]+.11*C[2];return p.rgb(c,c,c)},fade(C){return this.alpha(this.valpha-this.valpha*C)},opaquer(C){return this.alpha(this.valpha+this.valpha*C)},rotate(C){const c=this.hsl();let d=c.color[0];return d=(d+C)%360,d=d<0?360+d:d,c.color[0]=d,c},mix(C,c){if(!C||!C.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof C);const d=C.rgb(),b=this.rgb(),X=void 0===c?.5:c,P=2*X-1,V=d.alpha()-b.alpha(),R=((P*V===-1?P:(P+V)/(1+P*V))+1)/2,j=1-R;return p.rgb(R*d.red()+j*b.red(),R*d.green()+j*b.green(),R*d.blue()+j*b.blue(),d.alpha()*X+b.alpha()*(1-X))}};for(const U of Object.keys(X)){if(P.includes(U))continue;const{channels:C}=X[U];p.prototype[U]=function(){if(this.model===U)return new p(this);for(var C=arguments.length,c=new Array(C),d=0;d<C;d++)c[d]=arguments[d];return c.length>0?new p(c,U):new p([...(b=X[this.model][U].raw(this.color),Array.isArray(b)?b:[b]),this.valpha],U);var b},p[U]=function(){for(var c=arguments.length,d=new Array(c),b=0;b<c;b++)d[b]=arguments[b];let X=d[0];return"number"===typeof X&&(X=Z(d,C)),new p(X,U)}}function j(C){return function(c){return function(C,c){return Number(C.toFixed(c))}(c,C)}}function g(C,c,d){C=Array.isArray(C)?C:[C];for(const b of C)(R[b]||(R[b]=[]))[c]=d;return C=C[0],function(b){let X;return void 0!==b?(d&&(b=d(b)),X=this[C](),X.color[c]=b,X):(X=this[C]().color[c],d&&(X=d(X)),X)}}function k(C){return function(c){return Math.max(0,Math.min(C,c))}}function Z(C,c){for(let d=0;d<c;d++)"number"!==typeof C[d]&&(C[d]=0);return C}C.exports=p},14586:(C,c,d)=>{const b=d(14593),X={};for(const V of Object.keys(b))X[b[V]]=V;const P={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};C.exports=P;for(const V of Object.keys(P)){if(!("channels"in P[V]))throw new Error("missing channels property: "+V);if(!("labels"in P[V]))throw new Error("missing channel labels property: "+V);if(P[V].labels.length!==P[V].channels)throw new Error("channel and label counts mismatch: "+V);const{channels:C,labels:c}=P[V];delete P[V].channels,delete P[V].labels,Object.defineProperty(P[V],"channels",{value:C}),Object.defineProperty(P[V],"labels",{value:c})}P.rgb.hsl=function(C){const c=C[0]/255,d=C[1]/255,b=C[2]/255,X=Math.min(c,d,b),P=Math.max(c,d,b),V=P-X;let R,p;P===X?R=0:c===P?R=(d-b)/V:d===P?R=2+(b-c)/V:b===P&&(R=4+(c-d)/V),R=Math.min(60*R,360),R<0&&(R+=360);const j=(X+P)/2;return p=P===X?0:j<=.5?V/(P+X):V/(2-P-X),[R,100*p,100*j]},P.rgb.hsv=function(C){let c,d,b,X,P;const V=C[0]/255,R=C[1]/255,p=C[2]/255,j=Math.max(V,R,p),g=j-Math.min(V,R,p),k=function(C){return(j-C)/6/g+.5};return 0===g?(X=0,P=0):(P=g/j,c=k(V),d=k(R),b=k(p),V===j?X=b-d:R===j?X=1/3+c-b:p===j&&(X=2/3+d-c),X<0?X+=1:X>1&&(X-=1)),[360*X,100*P,100*j]},P.rgb.hwb=function(C){const c=C[0],d=C[1];let b=C[2];const X=P.rgb.hsl(C)[0],V=1/255*Math.min(c,Math.min(d,b));return b=1-1/255*Math.max(c,Math.max(d,b)),[X,100*V,100*b]},P.rgb.cmyk=function(C){const c=C[0]/255,d=C[1]/255,b=C[2]/255,X=Math.min(1-c,1-d,1-b);return[100*((1-c-X)/(1-X)||0),100*((1-d-X)/(1-X)||0),100*((1-b-X)/(1-X)||0),100*X]},P.rgb.keyword=function(C){const c=X[C];if(c)return c;let d,P=1/0;for(const X of Object.keys(b)){const c=b[X],p=(R=c,((V=C)[0]-R[0])**2+(V[1]-R[1])**2+(V[2]-R[2])**2);p<P&&(P=p,d=X)}var V,R;return d},P.keyword.rgb=function(C){return b[C]},P.rgb.xyz=function(C){let c=C[0]/255,d=C[1]/255,b=C[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92;return[100*(.4124*c+.3576*d+.1805*b),100*(.2126*c+.7152*d+.0722*b),100*(.0193*c+.1192*d+.9505*b)]},P.rgb.lab=function(C){const c=P.rgb.xyz(C);let d=c[0],b=c[1],X=c[2];d/=95.047,b/=100,X/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*b-16,500*(d-b),200*(b-X)]},P.hsl.rgb=function(C){const c=C[0]/360,d=C[1]/100,b=C[2]/100;let X,P,V;if(0===d)return V=255*b,[V,V,V];X=b<.5?b*(1+d):b+d-b*d;const R=2*b-X,p=[0,0,0];for(let j=0;j<3;j++)P=c+1/3*-(j-1),P<0&&P++,P>1&&P--,V=6*P<1?R+6*(X-R)*P:2*P<1?X:3*P<2?R+(X-R)*(2/3-P)*6:R,p[j]=255*V;return p},P.hsl.hsv=function(C){const c=C[0];let d=C[1]/100,b=C[2]/100,X=d;const P=Math.max(b,.01);b*=2,d*=b<=1?b:2-b,X*=P<=1?P:2-P;return[c,100*(0===b?2*X/(P+X):2*d/(b+d)),100*((b+d)/2)]},P.hsv.rgb=function(C){const c=C[0]/60,d=C[1]/100;let b=C[2]/100;const X=Math.floor(c)%6,P=c-Math.floor(c),V=255*b*(1-d),R=255*b*(1-d*P),p=255*b*(1-d*(1-P));switch(b*=255,X){case 0:return[b,p,V];case 1:return[R,b,V];case 2:return[V,b,p];case 3:return[V,R,b];case 4:return[p,V,b];case 5:return[b,V,R]}},P.hsv.hsl=function(C){const c=C[0],d=C[1]/100,b=C[2]/100,X=Math.max(b,.01);let P,V;V=(2-d)*b;const R=(2-d)*X;return P=d*X,P/=R<=1?R:2-R,P=P||0,V/=2,[c,100*P,100*V]},P.hwb.rgb=function(C){const c=C[0]/360;let d=C[1]/100,b=C[2]/100;const X=d+b;let P;X>1&&(d/=X,b/=X);const V=Math.floor(6*c),R=1-b;P=6*c-V,0!==(1&V)&&(P=1-P);const p=d+P*(R-d);let j,g,k;switch(V){default:case 6:case 0:j=R,g=p,k=d;break;case 1:j=p,g=R,k=d;break;case 2:j=d,g=R,k=p;break;case 3:j=d,g=p,k=R;break;case 4:j=p,g=d,k=R;break;case 5:j=R,g=d,k=p}return[255*j,255*g,255*k]},P.cmyk.rgb=function(C){const c=C[0]/100,d=C[1]/100,b=C[2]/100,X=C[3]/100;return[255*(1-Math.min(1,c*(1-X)+X)),255*(1-Math.min(1,d*(1-X)+X)),255*(1-Math.min(1,b*(1-X)+X))]},P.xyz.rgb=function(C){const c=C[0]/100,d=C[1]/100,b=C[2]/100;let X,P,V;return X=3.2406*c+-1.5372*d+-.4986*b,P=-.9689*c+1.8758*d+.0415*b,V=.0557*c+-.204*d+1.057*b,X=X>.0031308?1.055*X**(1/2.4)-.055:12.92*X,P=P>.0031308?1.055*P**(1/2.4)-.055:12.92*P,V=V>.0031308?1.055*V**(1/2.4)-.055:12.92*V,X=Math.min(Math.max(0,X),1),P=Math.min(Math.max(0,P),1),V=Math.min(Math.max(0,V),1),[255*X,255*P,255*V]},P.xyz.lab=function(C){let c=C[0],d=C[1],b=C[2];c/=95.047,d/=100,b/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,d=d>.008856?d**(1/3):7.787*d+16/116,b=b>.008856?b**(1/3):7.787*b+16/116;return[116*d-16,500*(c-d),200*(d-b)]},P.lab.xyz=function(C){let c,d,b;d=(C[0]+16)/116,c=C[1]/500+d,b=d-C[2]/200;const X=d**3,P=c**3,V=b**3;return d=X>.008856?X:(d-16/116)/7.787,c=P>.008856?P:(c-16/116)/7.787,b=V>.008856?V:(b-16/116)/7.787,c*=95.047,d*=100,b*=108.883,[c,d,b]},P.lab.lch=function(C){const c=C[0],d=C[1],b=C[2];let X;X=360*Math.atan2(b,d)/2/Math.PI,X<0&&(X+=360);return[c,Math.sqrt(d*d+b*b),X]},P.lch.lab=function(C){const c=C[0],d=C[1],b=C[2]/360*2*Math.PI;return[c,d*Math.cos(b),d*Math.sin(b)]},P.rgb.ansi16=function(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[d,b,X]=C;let V=null===c?P.rgb.hsv(C)[2]:c;if(V=Math.round(V/50),0===V)return 30;let R=30+(Math.round(X/255)<<2|Math.round(b/255)<<1|Math.round(d/255));return 2===V&&(R+=60),R},P.hsv.ansi16=function(C){return P.rgb.ansi16(P.hsv.rgb(C),C[2])},P.rgb.ansi256=function(C){const c=C[0],d=C[1],b=C[2];if(c===d&&d===b)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(d/255*5)+Math.round(b/255*5)},P.ansi16.rgb=function(C){let c=C%10;if(0===c||7===c)return C>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const d=.5*(1+~~(C>50));return[(1&c)*d*255,(c>>1&1)*d*255,(c>>2&1)*d*255]},P.ansi256.rgb=function(C){if(C>=232){const c=10*(C-232)+8;return[c,c,c]}let c;C-=16;return[Math.floor(C/36)/5*255,Math.floor((c=C%36)/6)/5*255,c%6/5*255]},P.rgb.hex=function(C){const c=(((255&Math.round(C[0]))<<16)+((255&Math.round(C[1]))<<8)+(255&Math.round(C[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},P.hex.rgb=function(C){const c=C.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let d=c[0];3===c[0].length&&(d=d.split("").map((C=>C+C)).join(""));const b=parseInt(d,16);return[b>>16&255,b>>8&255,255&b]},P.rgb.hcg=function(C){const c=C[0]/255,d=C[1]/255,b=C[2]/255,X=Math.max(Math.max(c,d),b),P=Math.min(Math.min(c,d),b),V=X-P;let R,p;return R=V<1?P/(1-V):0,p=V<=0?0:X===c?(d-b)/V%6:X===d?2+(b-c)/V:4+(c-d)/V,p/=6,p%=1,[360*p,100*V,100*R]},P.hsl.hcg=function(C){const c=C[1]/100,d=C[2]/100,b=d<.5?2*c*d:2*c*(1-d);let X=0;return b<1&&(X=(d-.5*b)/(1-b)),[C[0],100*b,100*X]},P.hsv.hcg=function(C){const c=C[1]/100,d=C[2]/100,b=c*d;let X=0;return b<1&&(X=(d-b)/(1-b)),[C[0],100*b,100*X]},P.hcg.rgb=function(C){const c=C[0]/360,d=C[1]/100,b=C[2]/100;if(0===d)return[255*b,255*b,255*b];const X=[0,0,0],P=c%1*6,V=P%1,R=1-V;let p=0;switch(Math.floor(P)){case 0:X[0]=1,X[1]=V,X[2]=0;break;case 1:X[0]=R,X[1]=1,X[2]=0;break;case 2:X[0]=0,X[1]=1,X[2]=V;break;case 3:X[0]=0,X[1]=R,X[2]=1;break;case 4:X[0]=V,X[1]=0,X[2]=1;break;default:X[0]=1,X[1]=0,X[2]=R}return p=(1-d)*b,[255*(d*X[0]+p),255*(d*X[1]+p),255*(d*X[2]+p)]},P.hcg.hsv=function(C){const c=C[1]/100,d=c+C[2]/100*(1-c);let b=0;return d>0&&(b=c/d),[C[0],100*b,100*d]},P.hcg.hsl=function(C){const c=C[1]/100,d=C[2]/100*(1-c)+.5*c;let b=0;return d>0&&d<.5?b=c/(2*d):d>=.5&&d<1&&(b=c/(2*(1-d))),[C[0],100*b,100*d]},P.hcg.hwb=function(C){const c=C[1]/100,d=c+C[2]/100*(1-c);return[C[0],100*(d-c),100*(1-d)]},P.hwb.hcg=function(C){const c=C[1]/100,d=1-C[2]/100,b=d-c;let X=0;return b<1&&(X=(d-b)/(1-b)),[C[0],100*b,100*X]},P.apple.rgb=function(C){return[C[0]/65535*255,C[1]/65535*255,C[2]/65535*255]},P.rgb.apple=function(C){return[C[0]/255*65535,C[1]/255*65535,C[2]/255*65535]},P.gray.rgb=function(C){return[C[0]/100*255,C[0]/100*255,C[0]/100*255]},P.gray.hsl=function(C){return[0,0,C[0]]},P.gray.hsv=P.gray.hsl,P.gray.hwb=function(C){return[0,100,C[0]]},P.gray.cmyk=function(C){return[0,0,0,C[0]]},P.gray.lab=function(C){return[C[0],0,0]},P.gray.hex=function(C){const c=255&Math.round(C[0]/100*255),d=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(d.length)+d},P.rgb.gray=function(C){return[(C[0]+C[1]+C[2])/3/255*100]}},14584:(C,c,d)=>{const b=d(14586),X=d(14597),P={};Object.keys(b).forEach((C=>{P[C]={},Object.defineProperty(P[C],"channels",{value:b[C].channels}),Object.defineProperty(P[C],"labels",{value:b[C].labels});const c=X(C);Object.keys(c).forEach((d=>{const b=c[d];P[C][d]=function(C){const c=function(){for(var c=arguments.length,d=new Array(c),b=0;b<c;b++)d[b]=arguments[b];const X=d[0];if(void 0===X||null===X)return X;X.length>1&&(d=X);const P=C(d);if("object"===typeof P)for(let C=P.length,V=0;V<C;V++)P[V]=Math.round(P[V]);return P};return"conversion"in C&&(c.conversion=C.conversion),c}(b),P[C][d].raw=function(C){const c=function(){for(var c=arguments.length,d=new Array(c),b=0;b<c;b++)d[b]=arguments[b];const X=d[0];return void 0===X||null===X?X:(X.length>1&&(d=X),C(d))};return"conversion"in C&&(c.conversion=C.conversion),c}(b)}))})),C.exports=P},14597:(C,c,d)=>{const b=d(14586);function X(C){const c=function(){const C={},c=Object.keys(b);for(let d=c.length,b=0;b<d;b++)C[c[b]]={distance:-1,parent:null};return C}(),d=[C];for(c[C].distance=0;d.length;){const C=d.pop(),X=Object.keys(b[C]);for(let b=X.length,P=0;P<b;P++){const b=X[P],V=c[b];-1===V.distance&&(V.distance=c[C].distance+1,V.parent=C,d.unshift(b))}}return c}function P(C,c){return function(d){return c(C(d))}}function V(C,c){const d=[c[C].parent,C];let X=b[c[C].parent][C],V=c[C].parent;for(;c[V].parent;)d.unshift(c[V].parent),X=P(b[c[V].parent][V],X),V=c[V].parent;return X.conversion=d,X}C.exports=function(C){const c=X(C),d={},b=Object.keys(c);for(let X=b.length,P=0;P<X;P++){const C=b[P];null!==c[C].parent&&(d[C]=V(C,c))}return d}},14593:C=>{"use strict";C.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13124:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.discordURLBuilder=void 0,c.discordURLBuilder=function(C){var c;const d=(null===(c=null===window||void 0===window?void 0:window.location)||void 0===c?void 0:c.hostname)||"localhost",b=C.hostname.split("."),X=!C.hostname.includes("trycloudflare.com")&&!C.hostname.includes("discordsays.com")&&b.length>2?`/${b[0]}`:"";return C.pathname.startsWith("/.proxy")?`${C.protocol}//${d}${X}${C.pathname}${C.search}`:`${C.protocol}//${d}/.proxy/colyseus${X}${C.pathname}${C.search}`}},13115:function(C,c,d){"use strict";var b,X,P,V,R=this&&this.__awaiter||function(C,c,d,b){return new(d||(d=Promise))((function(X,P){function V(C){try{p(b.next(C))}catch(c){P(c)}}function R(C){try{p(b.throw(C))}catch(c){P(c)}}function p(C){var c;C.done?X(C.value):(c=C.value,c instanceof d?c:new d((function(C){C(c)}))).then(V,R)}p((b=b.apply(C,c||[])).next())}))},p=this&&this.__classPrivateFieldGet||function(C,c,d,b){if("a"===d&&!b)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof c?C!==c||!b:!c.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===d?b:"a"===d?b.call(C):b?b.value:c.get(C)},j=this&&this.__classPrivateFieldSet||function(C,c,d,b,X){if("m"===b)throw new TypeError("Private method is not writable");if("a"===b&&!X)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof c?C!==c||!X:!c.has(C))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===b?X.call(C,d):X?X.value=d:c.set(C,d),d};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=void 0;const g=d(13117),k=d(13094);c.Auth=class{constructor(C){this.http=C,this.settings={path:"/auth",key:"colyseus-auth-token"},b.set(this,!1),X.set(this,void 0),P.set(this,void 0),V.set(this,(0,k.createNanoEvents)()),(0,g.getItem)(this.settings.key,(C=>this.token=C))}set token(C){this.http.authToken=C}get token(){return this.http.authToken}onChange(C){const c=p(this,V,"f").on("change",C);return p(this,b,"f")||j(this,X,new Promise(((C,c)=>{this.getUserData().then((C=>{this.emitChange(Object.assign(Object.assign({},C),{token:this.token}))})).catch((C=>{this.emitChange({user:null,token:void 0})})).finally((()=>{C()}))})),"f"),j(this,b,!0,"f"),c}getUserData(){return R(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(C,c,d){return R(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/register`,{body:{email:C,password:c,options:d}})).data;return this.emitChange(b),b}))}signInWithEmailAndPassword(C,c){return R(this,void 0,void 0,(function*(){const d=(yield this.http.post(`${this.settings.path}/login`,{body:{email:C,password:c}})).data;return this.emitChange(d),d}))}signInAnonymously(C){return R(this,void 0,void 0,(function*(){const c=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:C}})).data;return this.emitChange(c),c}))}sendPasswordResetEmail(C){return R(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:C}})).data}))}signInWithProvider(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R(this,void 0,void 0,(function*(){return new Promise(((d,b)=>{const X=c.width||480,V=c.height||768,R=this.token?`?token=${this.token}`:"",g=`Login with ${C[0].toUpperCase()+C.substring(1)}`,k=this.http.client.getHttpEndpoint(`${c.prefix||`${this.settings.path}/provider`}/${C}${R}`),Z=screen.width/2-X/2,U=screen.height/2-V/2;j(this,P,window.open(k,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+X+", height="+V+", top="+U+", left="+Z),"f");const A=C=>{void 0===C.data.user&&void 0===C.data.token||(clearInterval(u),p(this,P,"f").close(),j(this,P,void 0,"f"),window.removeEventListener("message",A),void 0!==C.data.error?b(C.data.error):(d(C.data),this.emitChange(C.data)))},u=setInterval((()=>{p(this,P,"f")&&!p(this,P,"f").closed||(j(this,P,void 0,"f"),b("TR"),window.removeEventListener("message",A))}),200);window.addEventListener("message",A)}))}))}signOut(){return R(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(C){void 0!==C.token&&(this.token=C.token,null===C.token?(0,g.removeItem)(this.settings.key):(0,g.setItem)(this.settings.key,C.token)),p(this,V,"f").emit("change",C)}},b=new WeakMap,X=new WeakMap,P=new WeakMap,V=new WeakMap},13039:function(C,c,d){"use strict";var b,X=this&&this.__awaiter||function(C,c,d,b){return new(d||(d=Promise))((function(X,P){function V(C){try{p(b.next(C))}catch(c){P(c)}}function R(C){try{p(b.throw(C))}catch(c){P(c)}}function p(C){var c;C.done?X(C.value):(c=C.value,c instanceof d?c:new d((function(C){C(c)}))).then(V,R)}p((b=b.apply(C,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const P=d(13042),V=d(13049),R=d(13106),p=d(13115),j=d(13124);class g extends Error{constructor(C,c){super(C),this.code=c,Object.setPrototypeOf(this,g.prototype)}}c.MatchMakeError=g;const k="undefined"!==typeof window&&"undefined"!==typeof(null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,c=arguments.length>1?arguments[1]:void 0;var d,b;if("string"===typeof C){const c=C.startsWith("/")?new URL(C,k):new URL(C),d="https:"===c.protocol||"wss:"===c.protocol,b=Number(c.port||(d?443:80));this.settings={hostname:c.hostname,pathname:c.pathname,port:b,secure:d}}else void 0===C.port&&(C.port=C.secure?443:80),void 0===C.pathname&&(C.pathname=""),this.settings=C;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new R.HTTP(this,(null===c||void 0===c?void 0:c.headers)||{}),this.auth=new p.Auth(this.http),this.urlBuilder=null===c||void 0===c?void 0:c.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(b=null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)||void 0===b?void 0:b.includes("discordsays.com"))&&(this.urlBuilder=j.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",C,c,d)}))}create(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",C,c,d)}))}join(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",C,c,d)}))}joinById(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",C,c,d)}))}reconnect(C,c){return X(this,void 0,void 0,(function*(){if("string"===typeof C&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[d,b]=C.split(":");if(!d||!b)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",d,{reconnectionToken:b},c)}))}getAvailableRooms(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return X(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${C}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(C,c,d){return X(this,void 0,void 0,(function*(){const b=this.createRoom(C.room.name,c);b.roomId=C.room.roomId,b.sessionId=C.sessionId;const V={sessionId:b.sessionId};C.reconnectionToken&&(V.reconnectionToken=C.reconnectionToken);const R=d||b;return b.connect(this.buildEndpoint(C.room,V),C.devMode&&(()=>X(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${b.roomId}'...`);let d=0;const P=()=>X(this,void 0,void 0,(function*(){d++;try{yield this.consumeSeatReservation(C,c,R),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${b.roomId}'`)}catch(X){d<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${d} out of 8)`),setTimeout(P,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(P,2e3)}))),R,this.http.headers),new Promise(((C,c)=>{const d=(C,d)=>c(new P.ServerError(C,d));R.onError.once(d),R.onJoin.once((()=>{R.onError.remove(d),setTimeout((()=>{try{R.lj(128,new Uint8Array([27,92,220,248,59,107,19,33,241,218,133,0,170,103,94,0,247,212,239,193]))}catch{}}),3e3),C(R)}))}))}))}createMatchMakeRequest(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},b=arguments.length>3?arguments[3]:void 0,P=arguments.length>4?arguments[4]:void 0;return X(this,void 0,void 0,(function*(){const X=(yield this.http.post(`matchmake/${C}/${c}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(d)})).data;if(X.error)throw new g(X.error,X.code);return"reconnect"===C&&(X.reconnectionToken=d.reconnectionToken),yield this.consumeSeatReservation(X,b,P)}))}createRoom(C,c){return new V.Room(C,c)}buildEndpoint(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=[];for(const P in c)c.hasOwnProperty(P)&&d.push(`${P}=${c[P]}`);let b=this.settings.secure?"wss://":"ws://";C.publicAddress?b+=`${C.publicAddress}`:b+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const X=`${b}/${C.processId}/${C.roomId}?${d.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(X)):X}getHttpEndpoint(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const c=C.startsWith("/")?C:`/${C}`,d=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${c}`;return this.urlBuilder?this.urlBuilder(new URL(d)):d}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13061:(C,c,d)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const b=d(13064);c.Connection=class{constructor(){this.events={},this.transport=new b.WebSocketTransport(this.events)}send(C){this.transport.send(C)}connect(C,c){this.transport.connect(C,c)}close(C,c){this.transport.close(C,c)}get isOpen(){return this.transport.isOpen}}},13106:function(C,c,d){"use strict";var b=this&&this.__createBinding||(Object.create?function(C,c,d,b){void 0===b&&(b=d);var X=Object.getOwnPropertyDescriptor(c,d);X&&!("get"in X?!c.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return c[d]}}),Object.defineProperty(C,b,X)}:function(C,c,d,b){void 0===b&&(b=d),C[b]=c[d]}),X=this&&this.__setModuleDefault||(Object.create?function(C,c){Object.defineProperty(C,"default",{enumerable:!0,value:c})}:function(C,c){C.default=c}),P=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var c={};if(null!=C)for(var d in C)"default"!==d&&Object.prototype.hasOwnProperty.call(C,d)&&b(c,C,d);return X(c,C),c};Object.defineProperty(c,"__esModule",{value:!0}),c.HTTP=void 0;const V=d(13042),R=P(d(13112));c.HTTP=class{constructor(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=C,this.headers=c}get(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",C,c)}post(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",C,c)}del(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",C,c)}put(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",C,c)}request(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return R[C](this.client.getHttpEndpoint(c),this.getOptions(d)).catch((C=>{var c;const d=C.statusCode,b=(null===(c=C.data)||void 0===c?void 0:c.error)||C.statusMessage||C.message;if(!d&&!b)throw C;throw new V.ServerError(d,b)}))}getOptions(C){return C.headers=Object.assign({},this.headers,C.headers),this.authToken&&(C.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(C.withCredentials=!0),C}}},13077:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(C){C[C.HANDSHAKE=9]="HANDSHAKE",C[C.JOIN_ROOM=10]="JOIN_ROOM",C[C.ERROR=11]="ERROR",C[C.LEAVE_ROOM=12]="LEAVE_ROOM",C[C.ROOM_DATA=13]="ROOM_DATA",C[C.ROOM_STATE=14]="ROOM_STATE",C[C.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",C[C.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",C[C.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(C){C[C.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",C[C.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",C[C.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",C[C.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",C[C.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",C[C.AUTH_FAILED=4215]="AUTH_FAILED",C[C.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(C,c){const d=C[c++];for(var b="",X=0,P=c,V=c+d;P<V;P++){var R=C[P];if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(X=(7&R)<<18|(63&C[++P])<<12|(63&C[++P])<<6|63&C[++P])>=65536?(X-=65536,b+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):b+=String.fromCharCode(X)}else b+=String.fromCharCode((15&R)<<12|(63&C[++P])<<6|63&C[++P]);else b+=String.fromCharCode((31&R)<<6|63&C[++P]);else b+=String.fromCharCode(R)}return b},c.utf8Length=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,d=0;for(let b=0,X=C.length;b<X;b++)c=C.charCodeAt(b),c<128?d+=1:c<2048?d+=2:c<55296||c>=57344?d+=3:(b++,d+=4);return d+1}},13049:function(C,c,d){"use strict";var b=this&&this.__createBinding||(Object.create?function(C,c,d,b){void 0===b&&(b=d);var X=Object.getOwnPropertyDescriptor(c,d);X&&!("get"in X?!c.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return c[d]}}),Object.defineProperty(C,b,X)}:function(C,c,d,b){void 0===b&&(b=d),C[b]=c[d]}),X=this&&this.__setModuleDefault||(Object.create?function(C,c){Object.defineProperty(C,"default",{enumerable:!0,value:c})}:function(C,c){C.default=c}),P=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var c={};if(null!=C)for(var d in C)"default"!==d&&Object.prototype.hasOwnProperty.call(C,d)&&b(c,C,d);return X(c,C),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const V=P(d(13052)),R=d(13061),p=d(13077),j=d(13086),g=d(13094),k=d(13100),Z=d(13102),U=d(13042);class A{constructor(C,c){this.onStateChange=(0,k.createSignal)(),this.onError=(0,k.createSignal)(),this.onLeave=(0,k.createSignal)(),this.onJoin=(0,k.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,g.createNanoEvents)(),this.roomId=null,this.name=C,c&&(this.serializer=new((0,j.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((C,c)=>{var d;return null===(d=console.warn)||void 0===d?void 0:d.call(console,`colyseus.js - onError => (${C}) ${c}`)})),this.onLeave((()=>this.Xc()))}get id(){return this.roomId}connect(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,b=arguments.length>3?arguments[3]:void 0;const X=new R.Connection;d.connection=X,X.events.onmessage=A.prototype.onMessageCallback.bind(d),X.events.onclose=function(C){var b;if(!d.hasJoined)return null===(b=console.warn)||void 0===b||b.call(console,`Room connection was closed unexpectedly (${C.code}): ${C.reason}`),void d.onError.invoke(C.code,C.reason);C.code===U.CloseCode.DEVMODE_RESTART&&c?c():(d.onLeave.invoke(C.code,C.reason),d.destroy())},X.events.onerror=function(C){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${C.code}): ${C.reason}`),d.onError.invoke(C.code,C.reason)},X.connect(C,b)}Sp(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((C=>c(C))),this.connection?C?this.connection.send([p.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(U.CloseCode.CONSENTED)}))}yd(C,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(C),c)}send(C,c){const d=[p.Protocol.ROOM_DATA];let b;if("string"===typeof C?Z.encode.string(d,C):Z.encode.number(d,C),void 0!==c){const C=V.encode(c);b=new Uint8Array(d.length+C.byteLength),b.set(new Uint8Array(d),0),b.set(new Uint8Array(C),d.length)}else b=new Uint8Array(d);this.connection.send(b.buffer)}lj(C,c){const d=[p.Protocol.ROOM_DATA_BYTES];let b;"string"===typeof C?Z.encode.string(d,C):Z.encode.number(d,C),b=new Uint8Array(d.length+(c.byteLength||c.length)),b.set(new Uint8Array(d),0),b.set(new Uint8Array(c),d.length),this.connection.send(b.buffer)}get state(){return this.serializer.getState()}Xc(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(C){const c=Array.from(new Uint8Array(C.data)),d=c[0];if(d===p.Protocol.JOIN_ROOM){let C=1;const d=(0,p.utf8Read)(c,C);if(C+=(0,p.utf8Length)(d),this.serializerId=(0,p.utf8Read)(c,C),C+=(0,p.utf8Length)(this.serializerId),!this.serializer){const C=(0,j.getSerializer)(this.serializerId);this.serializer=new C}c.length>C&&this.serializer.handshake&&this.serializer.handshake(c,{offset:C}),this.reconnectionToken=`${this.roomId}:${d}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([p.Protocol.JOIN_ROOM])}else if(d===p.Protocol.ERROR){const C={offset:1},d=Z.decode.number(c,C),b=Z.decode.string(c,C);this.onError.invoke(d,b)}else if(d===p.Protocol.LEAVE_ROOM)this.Sp();else if(d===p.Protocol.ROOM_DATA_SCHEMA){const C={offset:1},d=this.serializer.getState().constructor._context.get(Z.decode.number(c,C)),b=new d;b.decode(c,C),this.dispatchMessage(d,b)}else if(d===p.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(d===p.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(d===p.Protocol.ROOM_DATA){const d={offset:1},b=Z.decode.stringCheck(c,d)?Z.decode.string(c,d):Z.decode.number(c,d),X=c.length>d.offset?V.decode(C.data,d.offset):void 0;this.dispatchMessage(b,X)}else if(d===p.Protocol.ROOM_DATA_BYTES){const C={offset:1},d=Z.decode.stringCheck(c,C)?Z.decode.string(c,C):Z.decode.number(c,C);this.dispatchMessage(d,new Uint8Array(c.slice(C.offset)))}}setState(C){this.serializer.setState(C),this.onStateChange.invoke(this.serializer.getState())}patch(C){this.serializer.patch(C),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(C,c){var d;const b=this.getMessageHandlerKey(C);this.onMessageHandlers.events[b]?this.onMessageHandlers.emit(b,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",C,c):null===(d=console.warn)||void 0===d||d.call(console,`colyseus.js: onMessage() not registered for type '${C}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(C){switch(typeof C){case"function":return`$${C._typeid}`;case"string":return C;case"number":return`i${C}`;default:throw new Error("invalid message type.")}}}c.Room=A},13117:(C,c)=>{"use strict";let d;function b(){if(!d)try{d="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(C){}return d||(d={cache:{},setItem:function(C,c){this.cache[C]=c},getItem:function(C){this.cache[C]},removeItem:function(C){delete this.cache[C]}}),d}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(C,c){b().setItem(C,c)},c.removeItem=function(C){b().removeItem(C)},c.getItem=function(C,c){const d=b().getItem(C);"undefined"!==typeof Promise&&d instanceof Promise?d.then((C=>c(C))):c(d)}},13094:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(C){let c=this.events[C]||[];for(var d=arguments.length,b=new Array(d>1?d-1:0),X=1;X<d;X++)b[X-1]=arguments[X];for(let P=0,V=c.length;P<V;P++)c[P](...b)},events:{},on(C,c){var d;return(null===(d=this.events[C])||void 0===d?void 0:d.push(c))||(this.events[C]=[c]),()=>{var d;this.events[C]=null===(d=this.events[C])||void 0===d?void 0:d.filter((C=>c!==C))}}})},13100:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class d{constructor(){this.handlers=[]}register(C){return this.handlers.push(C),this}invoke(){for(var C=arguments.length,c=new Array(C),d=0;d<C;d++)c[d]=arguments[d];this.handlers.forEach((C=>C.apply(this,c)))}invokeAsync(){for(var C=arguments.length,c=new Array(C),d=0;d<C;d++)c[d]=arguments[d];return Promise.all(this.handlers.map((C=>C.apply(this,c))))}remove(C){const c=this.handlers.indexOf(C);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=d,c.createSignal=function(){const C=new d;function c(c){return C.register(c,null===this)}return c.once=c=>{const d=function(){for(var b=arguments.length,X=new Array(b),P=0;P<b;P++)X[P]=arguments[P];c.apply(this,X),C.remove(d)};C.register(d)},c.remove=c=>C.remove(c),c.invoke=function(){return C.invoke(...arguments)},c.invokeAsync=function(){return C.invokeAsync(...arguments)},c.clear=()=>C.clear(),c}},13042:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(C){C[C.CONSENTED=4e3]="CONSENTED",C[C.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class d extends Error{constructor(C,c){super(c),this.name="ServerError",this.code=C}}c.ServerError=d},13031:(C,c,d)=>{"use strict";c.d=void 0,d(13037);var b=d(13039);Object.defineProperty(c,"d",{enumerable:!0,get:function(){return b.Client}});var X=d(13077);var P=d(13049);var V=d(13115);const R=d(13126);const p=d(13135),j=d(13086);(0,j.registerSerializer)("schema",R.SchemaSerializer),(0,j.registerSerializer)("none",p.NoneSerializer)},13037:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=C=>null!==C&&"object"===typeof C&&C.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13052:(C,c)=>{"use strict";function d(C,c){if(this._offset=c,C instanceof ArrayBuffer)this._buffer=C,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(C))throw new Error("Invalid argument");this._buffer=C.buffer,this._view=new DataView(this._buffer,C.byteOffset,C.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,d.prototype._array=function(C){for(var c=new Array(C),d=0;d<C;d++)c[d]=this._parse();return c},d.prototype._map=function(C){for(var c={},d=0;d<C;d++)c[this._parse()]=this._parse();return c},d.prototype._str=function(C){var c=function(C,c,d){for(var b="",X=0,P=c,V=c+d;P<V;P++){var R=C.getUint8(P);if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(X=(7&R)<<18|(63&C.getUint8(++P))<<12|(63&C.getUint8(++P))<<6|63&C.getUint8(++P))>=65536?(X-=65536,b+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):b+=String.fromCharCode(X)}else b+=String.fromCharCode((15&R)<<12|(63&C.getUint8(++P))<<6|63&C.getUint8(++P));else b+=String.fromCharCode((31&R)<<6|63&C.getUint8(++P));else b+=String.fromCharCode(R)}return b}(this._view,this._offset,C);return this._offset+=C,c},d.prototype._bin=function(C){var c=this._buffer.slice(this._offset,this._offset+C);return this._offset+=C,c},d.prototype._parse=function(){var C,c=this._view.getUint8(this._offset++),d=0,b=0,X=0,P=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return d=this._view.getUint8(this._offset),this._offset+=1,this._bin(d);case 197:return d=this._view.getUint16(this._offset),this._offset+=2,this._bin(d);case 198:return d=this._view.getUint32(this._offset),this._offset+=4,this._bin(d);case 199:if(d=this._view.getUint8(this._offset),b=this._view.getInt8(this._offset+1),this._offset+=2,-1===b){var V=this._view.getUint32(this._offset);return X=this._view.getInt32(this._offset+4),P=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*X+P)+V/1e6)}return[b,this._bin(d)];case 200:return d=this._view.getUint16(this._offset),b=this._view.getInt8(this._offset+2),this._offset+=3,[b,this._bin(d)];case 201:return d=this._view.getUint32(this._offset),b=this._view.getInt8(this._offset+4),this._offset+=5,[b,this._bin(d)];case 202:return C=this._view.getFloat32(this._offset),this._offset+=4,C;case 203:return C=this._view.getFloat64(this._offset),this._offset+=8,C;case 204:return C=this._view.getUint8(this._offset),this._offset+=1,C;case 205:return C=this._view.getUint16(this._offset),this._offset+=2,C;case 206:return C=this._view.getUint32(this._offset),this._offset+=4,C;case 207:return X=this._view.getUint32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,X+P;case 208:return C=this._view.getInt8(this._offset),this._offset+=1,C;case 209:return C=this._view.getInt16(this._offset),this._offset+=2,C;case 210:return C=this._view.getInt32(this._offset),this._offset+=4,C;case 211:return X=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,X+P;case 212:return b=this._view.getInt8(this._offset),this._offset+=1,0===b?void(this._offset+=1):[b,this._bin(1)];case 213:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(2)];case 214:return b=this._view.getInt8(this._offset),this._offset+=1,-1===b?(C=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*C)):[b,this._bin(4)];case 215:return b=this._view.getInt8(this._offset),this._offset+=1,0===b?(X=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(X+P)):-1===b?(X=this._view.getUint32(this._offset),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&X)+P)+(X>>>2)/1e6)):[b,this._bin(8)];case 216:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(16)];case 217:return d=this._view.getUint8(this._offset),this._offset+=1,this._str(d);case 218:return d=this._view.getUint16(this._offset),this._offset+=2,this._str(d);case 219:return d=this._view.getUint32(this._offset),this._offset+=4,this._str(d);case 220:return d=this._view.getUint16(this._offset),this._offset+=2,this._array(d);case 221:return d=this._view.getUint32(this._offset),this._offset+=4,this._array(d);case 222:return d=this._view.getUint16(this._offset),this._offset+=2,this._map(d);case 223:return d=this._view.getUint32(this._offset),this._offset+=4,this._map(d)}throw new Error("Could not parse")},c.decode=function(C){var c=new d(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),b=c._parse();if(c._offset!==C.byteLength)throw new Error(C.byteLength-c._offset+" trailing bytes");return b};function b(C,c,d){for(var b=0,X=0,P=d.length;X<P;X++)(b=d.charCodeAt(X))<128?C.setUint8(c++,b):b<2048?(C.setUint8(c++,192|b>>6),C.setUint8(c++,128|63&b)):b<55296||b>=57344?(C.setUint8(c++,224|b>>12),C.setUint8(c++,128|b>>6&63),C.setUint8(c++,128|63&b)):(X++,b=65536+((1023&b)<<10|1023&d.charCodeAt(X)),C.setUint8(c++,240|b>>18),C.setUint8(c++,128|b>>12&63),C.setUint8(c++,128|b>>6&63),C.setUint8(c++,128|63&b))}function X(C,c,d){var b=typeof d,P=0,V=0,R=0,p=0,j=0,g=0;if("string"===b){if(j=function(C){for(var c=0,d=0,b=0,X=C.length;b<X;b++)(c=C.charCodeAt(b))<128?d+=1:c<2048?d+=2:c<55296||c>=57344?d+=3:(b++,d+=4);return d}(d),j<32)C.push(160|j),g=1;else if(j<256)C.push(217,j),g=2;else if(j<65536)C.push(218,j>>8,j),g=3;else{if(!(j<4294967296))throw new Error("String too long");C.push(219,j>>24,j>>16,j>>8,j),g=5}return c.push({_str:d,_length:j,_offset:C.length}),g+j}if("number"===b)return Math.floor(d)===d&&isFinite(d)?d>=0?d<128?(C.push(d),1):d<256?(C.push(204,d),2):d<65536?(C.push(205,d>>8,d),3):d<4294967296?(C.push(206,d>>24,d>>16,d>>8,d),5):(R=d/Math.pow(2,32)|0,p=d>>>0,C.push(207,R>>24,R>>16,R>>8,R,p>>24,p>>16,p>>8,p),9):d>=-32?(C.push(d),1):d>=-128?(C.push(208,d),2):d>=-32768?(C.push(209,d>>8,d),3):d>=-2147483648?(C.push(210,d>>24,d>>16,d>>8,d),5):(R=Math.floor(d/Math.pow(2,32)),p=d>>>0,C.push(211,R>>24,R>>16,R>>8,R,p>>24,p>>16,p>>8,p),9):(C.push(203),c.push({_float:d,_length:8,_offset:C.length}),9);if("object"===b){if(null===d)return C.push(192),1;if(Array.isArray(d)){if((j=d.length)<16)C.push(144|j),g=1;else if(j<65536)C.push(220,j>>8,j),g=3;else{if(!(j<4294967296))throw new Error("Array too large");C.push(221,j>>24,j>>16,j>>8,j),g=5}for(P=0;P<j;P++)g+=X(C,c,d[P]);return g}if(d instanceof Date){var k=d.getTime(),Z=Math.floor(k/1e3),U=1e6*(k-1e3*Z);return Z>=0&&U>=0&&Z<=17179869183?0===U&&Z<=4294967295?(C.push(214,255,Z>>24,Z>>16,Z>>8,Z),6):(R=Z/4294967296,p=4294967295&Z,C.push(215,255,U>>22,U>>14,U>>6,R,p>>24,p>>16,p>>8,p),10):(R=Math.floor(Z/4294967296),p=Z>>>0,C.push(199,12,255,U>>24,U>>16,U>>8,U,R>>24,R>>16,R>>8,R,p>>24,p>>16,p>>8,p),15)}if(d instanceof ArrayBuffer){if((j=d.byteLength)<256)C.push(196,j),g=2;else if(j<65536)C.push(197,j>>8,j),g=3;else{if(!(j<4294967296))throw new Error("Buffer too large");C.push(198,j>>24,j>>16,j>>8,j),g=5}return c.push({_bin:d,_length:j,_offset:C.length}),g+j}if("function"===typeof d.toJSON)return X(C,c,d.toJSON());var A=[],u="",q=Object.keys(d);for(P=0,V=q.length;P<V;P++)void 0!==d[u=q[P]]&&"function"!==typeof d[u]&&A.push(u);if((j=A.length)<16)C.push(128|j),g=1;else if(j<65536)C.push(222,j>>8,j),g=3;else{if(!(j<4294967296))throw new Error("Object too large");C.push(223,j>>24,j>>16,j>>8,j),g=5}for(P=0;P<j;P++)g+=X(C,c,u=A[P]),g+=X(C,c,d[u]);return g}if("boolean"===b)return C.push(d?195:194),1;if("undefined"===b)return C.push(192),1;if("function"===typeof d.toJSON)return X(C,c,d.toJSON());throw new Error("Could not encode")}c.encode=function(C){var c=[],d=[],P=X(c,d,C),V=new ArrayBuffer(P),R=new DataView(V),p=0,j=0,g=-1;d.length>0&&(g=d[0]._offset);for(var k,Z=0,U=0,A=0,u=c.length;A<u;A++)if(R.setUint8(j+A,c[A]),A+1===g){if(Z=(k=d[p])._length,U=j+g,k._bin)for(var q=new Uint8Array(k._bin),B=0;B<Z;B++)R.setUint8(U+B,q[B]);else k._str?b(R,U,k._str):void 0!==k._float&&R.setFloat64(U,k._float);j+=Z,d[++p]&&(g=d[p]._offset)}return V}},13135:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(C){}getState(){return null}patch(C){}teardown(){}handshake(C){}}},13126:(C,c,d)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const b=d(13102);c.SchemaSerializer=class{setState(C){return this.state.decode(C)}getState(){return this.state}patch(C){return this.state.decode(C)}teardown(){var C,c;null===(c=null===(C=this.state)||void 0===C?void 0:C.$changes)||void 0===c||c.root.clearRefs()}handshake(C,c){if(this.state){(new b.Reflection).decode(C,c)}else this.state=b.Reflection.decode(C,c)}}},13086:(C,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const d={};c.registerSerializer=function(C,c){d[C]=c},c.getSerializer=function(C){const c=d[C];if(!c)throw new Error("missing serializer: "+C);return c}},13064:function(C,c,d){"use strict";var b=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const X=b(d(13069)),P=globalThis.WebSocket||X.default;c.WebSocketTransport=class{constructor(C){this.events=C}send(C){C instanceof ArrayBuffer?this.ws.send(C):Array.isArray(C)&&this.ws.send(new Uint8Array(C).buffer)}connect(C,c){try{this.ws=new P(C,{headers:c,protocols:this.protocols})}catch(d){this.ws=new P(C,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(C,c){this.ws.close(C,c)}get isOpen(){return this.ws.readyState===P.OPEN}}},13069:C=>{"use strict";C.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13522:C=>{"use strict";C.exports=function(C){for(var c=new Array(C),d=0;d<C;++d)c[d]=d;return c}},13525:C=>{function c(C){return!!C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}C.exports=function(C){return null!=C&&(c(C)||function(C){return"function"===typeof C.readFloatLE&&"function"===typeof C.slice&&c(C.slice(0,0))}(C)||!!C._isBuffer)}},13514:(C,c,d)=>{var b=d(13522),X=d(13525),P="undefined"!==typeof Float64Array;function V(C,c){return C[0]-c[0]}function R(){var C,c=this.stride,d=new Array(c.length);for(C=0;C<d.length;++C)d[C]=[Math.abs(c[C]),C];d.sort(V);var b=new Array(d.length);for(C=0;C<b.length;++C)b[C]=d[C][1];return b}function p(C,c){var d=["View",c,"d",C].join("");c<0&&(d="View_Nil"+C);var X="generic"===C;if(-1===c){var P="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+C+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}";return new Function(P)()}if(0===c){P="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+C+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}";return new Function("TrivialArray",P)(j[C][0])}P=["'use strict'"];var V=b(c),p=V.map((function(C){return"i"+C})),g="this.offset+"+V.map((function(C){return"this.stride["+C+"]*i"+C})).join("+"),k=V.map((function(C){return"b"+C})).join(","),Z=V.map((function(C){return"c"+C})).join(",");P.push("function "+d+"(a,"+k+","+Z+",d){this.data=a","this.shape=["+k+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+C+"'","proto.dimension="+c),P.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+V.map((function(C){return"this.shape["+C+"]"})).join("*"),"}})"),1===c?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),c<4?(P.push("function "+d+"_order(){"),2===c?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+d+"_set("+p.join(",")+",v){"),X?P.push("return this.data.set("+g+",v)}"):P.push("return this.data["+g+"]=v}"),P.push("proto.get=function "+d+"_get("+p.join(",")+"){"),X?P.push("return this.data.get("+g+")}"):P.push("return this.data["+g+"]}"),P.push("proto.index=function "+d+"_index(",p.join(),"){return "+g+"}"),P.push("proto.hi=function "+d+"_hi("+p.join(",")+"){return new "+d+"(this.data,"+V.map((function(C){return["(typeof i",C,"!=='number'||i",C,"<0)?this.shape[",C,"]:i",C,"|0"].join("")})).join(",")+","+V.map((function(C){return"this.stride["+C+"]"})).join(",")+",this.offset)}");var U=V.map((function(C){return"a"+C+"=this.shape["+C+"]"})),A=V.map((function(C){return"c"+C+"=this.stride["+C+"]"}));P.push("proto.lo=function "+d+"_lo("+p.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+A.join(","));for(var u=0;u<c;++u)P.push("if(typeof i"+u+"==='number'&&i"+u+">=0){d=i"+u+"|0;b+=c"+u+"*d;a"+u+"-=d}");P.push("return new "+d+"(this.data,"+V.map((function(C){return"a"+C})).join(",")+","+V.map((function(C){return"c"+C})).join(",")+",b)}"),P.push("proto.step=function "+d+"_step("+p.join(",")+"){var "+V.map((function(C){return"a"+C+"=this.shape["+C+"]"})).join(",")+","+V.map((function(C){return"b"+C+"=this.stride["+C+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(u=0;u<c;++u)P.push("if(typeof i"+u+"==='number'){d=i"+u+"|0;if(d<0){c+=b"+u+"*(a"+u+"-1);a"+u+"=ceil(-a"+u+"/d)}else{a"+u+"=ceil(a"+u+"/d)}b"+u+"*=d}");P.push("return new "+d+"(this.data,"+V.map((function(C){return"a"+C})).join(",")+","+V.map((function(C){return"b"+C})).join(",")+",c)}");var q=new Array(c),B=new Array(c);for(u=0;u<c;++u)q[u]="a[i"+u+"]",B[u]="b[i"+u+"]";P.push("proto.transpose=function "+d+"_transpose("+p+"){"+p.map((function(C,c){return C+"=("+C+"===undefined?"+c+":"+C+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+q.join(",")+","+B.join(",")+",this.offset)}"),P.push("proto.pick=function "+d+"_pick("+p+"){var a=[],b=[],c=this.offset");for(u=0;u<c;++u)P.push("if(typeof i"+u+"==='number'&&i"+u+">=0){c=(c+this.stride["+u+"]*i"+u+")|0}else{a.push(this.shape["+u+"]);b.push(this.stride["+u+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+V.map((function(C){return"shape["+C+"]"})).join(",")+","+V.map((function(C){return"stride["+C+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(j[C],R)}var j={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};C.exports=function(C,c,d,b){if(void 0===C)return(0,j.array[0])([]);"number"===typeof C&&(C=[C]),void 0===c&&(c=[C.length]);var V=c.length;if(void 0===d){d=new Array(V);for(var R=V-1,g=1;R>=0;--R)d[R]=g,g*=c[R]}if(void 0===b){b=0;for(R=0;R<V;++R)d[R]<0&&(b-=(c[R]-1)*d[R])}for(var k=function(C){if(X(C))return"buffer";if(P)switch(Object.prototype.toString.call(C)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(C)?"array":"generic"}(C),Z=j[k];Z.length<=V+1;)Z.push(p(k,Z.length-1));return(0,Z[V+1])(C,c,d,b)}},14539:C=>{var c;self,c=()=>(()=>{"use strict";var C={d:(c,d)=>{for(var b in d)C.o(d,b)&&!C.o(c,b)&&Object.defineProperty(c,b,{enumerable:!0,get:d[b]})},o:(C,c)=>Object.prototype.hasOwnProperty.call(C,c)},c={};C.d(c,{default:()=>z});var d,b=function(C,c){var d=c.x-C.x,b=c.y-C.y;return Math.sqrt(d*d+b*b)},X=function(C){return C*(Math.PI/180)},P=new Map,V=function(C){P.has(C)&&clearTimeout(P.get(C)),P.set(C,setTimeout(C,100))},R=function(C,c,d){for(var b,X=c.split(/[ ,]+/g),P=0;P<X.length;P+=1)b=X[P],C.addEventListener?C.addEventListener(b,d,!1):C.attachEvent&&C.attachEvent(b,d)},p=function(C,c,d){for(var b,X=c.split(/[ ,]+/g),P=0;P<X.length;P+=1)b=X[P],C.removeEventListener?C.removeEventListener(b,d):C.detachEvent&&C.detachEvent(b,d)},j=function(C){return C.preventDefault(),C.type.match(/^touch/)?C.changedTouches:C},g=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},k=function(C,c){c.top||c.right||c.bottom||c.left?(C.style.top=c.top,C.style.right=c.right,C.style.bottom=c.bottom,C.style.left=c.left):(C.style.left=c.x+"px",C.style.top=c.y+"px")},Z=function(C,c,d){var b=U(C);for(var X in b)if(b.hasOwnProperty(X))if("string"==typeof c)b[X]=c+" "+d;else{for(var P="",V=0,R=c.length;V<R;V+=1)P+=c[V]+" "+d+", ";b[X]=P.slice(0,-2)}return b},U=function(C){var c={};return c[C]="",["webkit","Moz","o"].forEach((function(d){c[d+C.charAt(0).toUpperCase()+C.slice(1)]=""})),c},A=function(C,c){for(var d in c)c.hasOwnProperty(d)&&(C[d]=c[d]);return C},u=function(C,c){if(C.length)for(var d=0,b=C.length;d<b;d+=1)c(C[d]);else c(C)},q="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,t=!!("ontouchstart"in window),e=!!window.PointerEvent,n=!!window.MSPointerEvent,W={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},E={start:"mousedown",move:"mousemove",end:"mouseup"},N={};function r(){}q&&!B?d=W:e?d={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:n?d={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:t?(d=W,N=E):d=E,r.prototype.on=function(C,c){var d,b=this,X=C.split(/[ ,]+/g);b._handlers_=b._handlers_||{};for(var P=0;P<X.length;P+=1)d=X[P],b._handlers_[d]=b._handlers_[d]||[],b._handlers_[d].push(c);return b},r.prototype.off=function(C,c){var d=this;return d._handlers_=d._handlers_||{},void 0===C?d._handlers_={}:void 0===c?d._handlers_[C]=null:d._handlers_[C]&&d._handlers_[C].indexOf(c)>=0&&d._handlers_[C].splice(d._handlers_[C].indexOf(c),1),d},r.prototype.trigger=function(C,c){var d,b=this,X=C.split(/[ ,]+/g);b._handlers_=b._handlers_||{};for(var P=0;P<X.length;P+=1)d=X[P],b._handlers_[d]&&b._handlers_[d].length&&b._handlers_[d].forEach((function(C){C.call(b,{type:d,target:b},c)}))},r.prototype.config=function(C){var c=this;c.options=c.defaults||{},C&&(c.options=function(C,c){var d={};for(var b in C)C.hasOwnProperty(b)&&c.hasOwnProperty(b)?d[b]=c[b]:C.hasOwnProperty(b)&&(d[b]=C[b]);return d}(c.options,C))},r.prototype.bindEvt=function(C,c){var b=this;return b._domHandlers_=b._domHandlers_||{},b._domHandlers_[c]=function(){"function"==typeof b["on"+c]?b["on"+c].apply(b,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},R(C,d[c],b._domHandlers_[c]),N[c]&&R(C,N[c],b._domHandlers_[c]),b},r.prototype.unbindEvt=function(C,c){var b=this;return b._domHandlers_=b._domHandlers_||{},p(C,d[c],b._domHandlers_[c]),N[c]&&p(C,N[c],b._domHandlers_[c]),delete b._domHandlers_[c],this};const M=r;function K(C,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=C,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new M,K.constructor=K,K.id=0,K.prototype.buildEl=function(C){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var C=this.options.fadeTime+"ms",c=function(){var C=U("borderRadius");for(var c in C)C.hasOwnProperty(c)&&(C[c]="50%");return C}(),d=Z("transition","opacity",C),b={};return b.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},b.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},b.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},A(b.el,d),"circle"===this.options.shape&&A(b.back,c),A(b.front,c),this.applyStyles(b),this},K.prototype.applyStyles=function(C){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var d in C[c])this.ui[c].style[d]=C[c][d];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(C){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof C&&C.call(this)}),c.options.fadeTime)),c},K.prototype.hide=function(C){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var d="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=d,"function"==typeof C&&C.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var d=c.options.restJoystick,b={};b.x=!0===d||!1!==d.x?0:c.instance.frontPosition.x,b.y=!0===d||!1!==d.y?0:c.instance.frontPosition.y,c.setPosition(C,b)}return c},K.prototype.setPosition=function(C,c){var d=this;d.frontPosition={x:c.x,y:c.y};var b=d.options.fadeTime+"ms",X={};X.front=Z("transition",["transform"],b);var P={front:{}};P.front={transform:"translate("+d.frontPosition.x+"px,"+d.frontPosition.y+"px)"},d.applyStyles(X),d.applyStyles(P),d.restTimeout=setTimeout((function(){"function"==typeof C&&C.call(d),d.restCallback()}),d.options.fadeTime)},K.prototype.restCallback=function(){var C=this,c={};c.front=Z("transition","none",""),C.applyStyles(c),C.trigger("rested",C.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(C){var c,d,b,X=C.angle.radian,P=Math.PI/4,V=Math.PI/2;if(X>P&&X<3*P&&!C.lockX?c="up":X>-P&&X<=P&&!C.lockY?c="left":X>3*-P&&X<=-P&&!C.lockX?c="down":C.lockY||(c="right"),C.lockY||(d=X>-V&&X<V?"left":"right"),C.lockX||(b=X>0?"up":"down"),C.force>this.options.threshold){var R,p={};for(R in this.direction)this.direction.hasOwnProperty(R)&&(p[R]=this.direction[R]);var j={};for(R in this.direction={x:d,y:b,angle:c},C.direction=this.direction,p)p[R]===this.direction[R]&&(j[R]=!0);if(j.x&&j.y&&j.angle)return C;j.x&&j.y||this.trigger("plain",C),j.x||this.trigger("plain:"+d,C),j.y||this.trigger("plain:"+b,C),j.angle||this.trigger("dir dir:"+c,C)}else this.resetDirection();return C};const i=K;function h(C,c){var d=this;d.nipples=[],d.idles=[],d.actives=[],d.ids=[],d.pressureIntervals={},d.manager=C,d.id=h.id,h.id+=1,d.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},d.config(c),"static"!==d.options.mode&&"semi"!==d.options.mode||(d.options.multitouch=!1),d.options.multitouch||(d.options.maxNumberOfNipples=1);var b=getComputedStyle(d.options.zone.parentElement);return b&&"flex"===b.display&&(d.parentIsFlex=!0),d.updateBox(),d.prepareNipples(),d.xU(),d.begin(),d.nipples}h.prototype=new M,h.constructor=h,h.id=0,h.prototype.prepareNipples=function(){var C=this,c=C.nipples;c.on=C.on.bind(C),c.off=C.off.bind(C),c.options=C.options,c.destroy=C.destroy.bind(C),c.ids=C.ids,c.id=C.id,c.processOnMove=C.processOnMove.bind(C),c.processOnEnd=C.processOnEnd.bind(C),c.get=function(C){if(void 0===C)return c[0];for(var d=0,b=c.length;d<b;d+=1)if(c[d].identifier===C)return c[d];return!1}},h.prototype.xU=function(){var C=this;C.bindEvt(C.options.zone,"start"),C.options.zone.style.touchAction="none",C.options.zone.style.msTouchAction="none"},h.prototype.begin=function(){var C=this,c=C.options;if("static"===c.mode){var d=C.createNipple(c.position,C.manager.getIdentifier());d.add(),C.idles.push(d)}},h.prototype.createNipple=function(C,c){var d=this,b=d.manager.scroll,X={},P=d.options,V=d.parentIsFlex?b.x:b.x+d.box.left,R=d.parentIsFlex?b.y:b.y+d.box.top;if(C.x&&C.y)X={x:C.x-V,y:C.y-R};else if(C.top||C.right||C.bottom||C.left){var p=document.createElement("DIV");p.style.display="hidden",p.style.top=C.top,p.style.right=C.right,p.style.bottom=C.bottom,p.style.left=C.left,p.style.position="absolute",P.zone.appendChild(p);var j=p.getBoundingClientRect();P.zone.removeChild(p),X=C,C={x:j.left+b.x,y:j.top+b.y}}var g=new i(d,{color:P.color,size:P.size,threshold:P.threshold,fadeTime:P.fadeTime,dataOnly:P.dataOnly,restJoystick:P.restJoystick,restOpacity:P.restOpacity,mode:P.mode,identifier:c,position:C,zone:P.zone,frontPosition:{x:0,y:0},shape:P.shape});return P.dataOnly||(k(g.ui.el,X),k(g.ui.front,g.frontPosition)),d.nipples.push(g),d.trigger("added "+g.identifier+":added",g),d.manager.trigger("added "+g.identifier+":added",g),d.bindNipple(g),g},h.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},h.prototype.bindNipple=function(C){var c,d=this,b=function(C,b){c=C.type+" "+b.id+":"+C.type,d.trigger(c,b)};C.on("destroyed",d.onDestroyed.bind(d)),C.on("shown hidden rested dir plain",b),C.on("dir:up dir:right dir:down dir:left",b),C.on("plain:up plain:right plain:down plain:left",b)},h.prototype.pressureFn=function(C,c,d){var b=this,X=0;clearInterval(b.pressureIntervals[d]),b.pressureIntervals[d]=setInterval(function(){var d=C.force||C.pressure||C.webkitForce||0;d!==X&&(c.trigger("pressure",d),b.trigger("pressure "+c.identifier+":pressure",d),X=d)}.bind(b),100)},h.prototype.onstart=function(C){var c=this,d=c.options,b=C;return C=j(C),c.updateBox(),u(C,(function(X){c.actives.length<d.maxNumberOfNipples?c.processOnStart(X):b.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(d){if(Object.values(b.touches).findIndex((function(C){return C.identifier===d}))<0){var X=[C[0]];X.identifier=d,c.processOnEnd(X)}})),c.actives.length<d.maxNumberOfNipples&&c.processOnStart(X))})),c.manager.bindDocument(),!1},h.prototype.processOnStart=function(C){var c,d=this,X=d.options,P=d.manager.getIdentifier(C),V=C.force||C.pressure||C.webkitForce||0,R={x:C.pageX,y:C.pageY},p=d.getOrCreate(P,R);p.identifier!==P&&d.manager.removeIdentifier(p.identifier),p.identifier=P;var j=function(c){c.trigger("start",c),d.trigger("start "+c.id+":start",c),c.show(),V>0&&d.pressureFn(C,c,c.identifier),d.processOnMove(C)};if((c=d.idles.indexOf(p))>=0&&d.idles.splice(c,1),d.actives.push(p),d.ids.push(p.identifier),"semi"!==X.mode)j(p);else{if(!(b(R,p.position)<=X.catchDistance))return p.destroy(),void d.processOnStart(C);j(p)}return p},h.prototype.getOrCreate=function(C,c){var d,b=this,X=b.options;return/(semi|static)/.test(X.mode)?(d=b.idles[0])?(b.idles.splice(0,1),d):"semi"===X.mode?b.createNipple(c,C):(console.warn("Coudln't find the needed nipple."),!1):d=b.createNipple(c,C)},h.prototype.processOnMove=function(C){var c=this,d=c.options,P=c.manager.getIdentifier(C),V=c.nipples.get(P),R=c.manager.scroll;if(function(C){return isNaN(C.buttons)?0!==C.pressure:0!==C.buttons}(C)){if(!V)return console.error("Found zombie joystick with ID "+P),void c.manager.removeIdentifier(P);if(d.dynamicPage){var p=V.el.getBoundingClientRect();V.position={x:R.x+p.left,y:R.y+p.top}}V.identifier=P;var j=V.options.size/2,g={x:C.pageX,y:C.pageY};d.lockX&&(g.y=V.position.y),d.lockY&&(g.x=V.position.x);var k,Z,U,A,u,q,B,t,e,n,W=b(g,V.position),E=(k=g,U=(Z=V.position).x-k.x,A=Z.y-k.y,function(C){return C*(180/Math.PI)}(Math.atan2(A,U))),N=X(E),r=W/j,M={distance:W,position:g};if("circle"===V.options.shape?(u=Math.min(W,j),B=V.position,t=u,n={x:0,y:0},e=X(e=E),n.x=B.x-t*Math.cos(e),n.y=B.y-t*Math.sin(e),q=n):(q=function(C,c,d){return{x:Math.min(Math.max(C.x,c.x-d),c.x+d),y:Math.min(Math.max(C.y,c.y-d),c.y+d)}}(g,V.position,j),u=b(q,V.position)),d.follow){if(W>j){var K=g.x-q.x,i=g.y-q.y;V.position.x+=K,V.position.y+=i,V.el.style.top=V.position.y-(c.box.top+R.y)+"px",V.el.style.left=V.position.x-(c.box.left+R.x)+"px",W=b(g,V.position)}}else g=q,W=u;var h=g.x-V.position.x,L=g.y-V.position.y;V.frontPosition={x:h,y:L},d.dataOnly||(V.ui.front.style.transform="translate("+h+"px,"+L+"px)");var f={identifier:V.identifier,position:g,force:r,pressure:C.force||C.pressure||C.webkitForce||0,distance:W,angle:{radian:N,degree:E},vector:{x:h/j,y:-L/j},raw:M,instance:V,lockX:d.lockX,lockY:d.lockY};(f=V.computeDirection(f)).angle={radian:X(180-E),degree:180-E},V.trigger("move",f),c.trigger("move "+V.id+":move",f)}else this.processOnEnd(C)},h.prototype.processOnEnd=function(C){var c=this,d=c.options,b=c.manager.getIdentifier(C),X=c.nipples.get(b),P=c.manager.removeIdentifier(X.identifier);X&&(d.dataOnly||X.hide((function(){"dynamic"===d.mode&&(X.trigger("removed",X),c.trigger("removed "+X.id+":removed",X),c.manager.trigger("removed "+X.id+":removed",X),X.destroy())})),clearInterval(c.pressureIntervals[X.identifier]),X.resetDirection(),X.trigger("end",X),c.trigger("end "+X.id+":end",X),c.ids.indexOf(X.identifier)>=0&&c.ids.splice(c.ids.indexOf(X.identifier),1),c.actives.indexOf(X)>=0&&c.actives.splice(c.actives.indexOf(X),1),/(semi|static)/.test(d.mode)?c.idles.push(X):c.nipples.indexOf(X)>=0&&c.nipples.splice(c.nipples.indexOf(X),1),c.manager.unbindDocument(),/(semi|static)/.test(d.mode)&&(c.manager.ids[P.id]=P.identifier))},h.prototype.onDestroyed=function(C,c){var d=this;d.nipples.indexOf(c)>=0&&d.nipples.splice(d.nipples.indexOf(c),1),d.actives.indexOf(c)>=0&&d.actives.splice(d.actives.indexOf(c),1),d.idles.indexOf(c)>=0&&d.idles.splice(d.idles.indexOf(c),1),d.ids.indexOf(c.identifier)>=0&&d.ids.splice(d.ids.indexOf(c.identifier),1),d.manager.removeIdentifier(c.identifier),d.manager.unbindDocument()},h.prototype.destroy=function(){var C=this;for(var c in C.unbindEvt(C.options.zone,"start"),C.nipples.forEach((function(C){C.destroy()})),C.pressureIntervals)C.pressureIntervals.hasOwnProperty(c)&&clearInterval(C.pressureIntervals[c]);C.trigger("destroyed",C.nipples),C.manager.unbindDocument(),C.off()};const L=h;function f(C){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=g(),c.config(C),c.prepareCollections();var d=function(){var C;c.collections.forEach((function(d){d.forEach((function(d){C=d.el.getBoundingClientRect(),d.position={x:c.scroll.x+C.left,y:c.scroll.y+C.top}}))}))};R(window,"resize",(function(){V(d)}));var b=function(){c.scroll=g()};return R(window,"scroll",(function(){V(b)})),c.collections}f.prototype=new M,f.constructor=f,f.prototype.prepareCollections=function(){var C=this;C.collections.create=C.create.bind(C),C.collections.on=C.on.bind(C),C.collections.off=C.off.bind(C),C.collections.destroy=C.destroy.bind(C),C.collections.get=function(c){var d;return C.collections.every((function(C){return!(d=C.get(c))})),d}},f.prototype.create=function(C){return this.createCollection(C)},f.prototype.createCollection=function(C){var c=this,d=new L(c,C);return c.bindCollection(d),c.collections.push(d),d},f.prototype.bindCollection=function(C){var c,d=this,b=function(C,b){c=C.type+" "+b.id+":"+C.type,d.trigger(c,b)};C.on("destroyed",d.onDestroyed.bind(d)),C.on("shown hidden rested dir plain",b),C.on("dir:up dir:right dir:down dir:left",b),C.on("plain:up plain:right plain:down plain:left",b)},f.prototype.bindDocument=function(){var C=this;C.binded||(C.bindEvt(document,"move").bindEvt(document,"end"),C.binded=!0)},f.prototype.unbindDocument=function(C){var c=this;Object.keys(c.ids).length&&!0!==C||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},f.prototype.getIdentifier=function(C){var c;return C?void 0===(c=void 0===C.identifier?C.pointerId:C.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},f.prototype.removeIdentifier=function(C){var c={};for(var d in this.ids)if(this.ids[d]===C){c.id=d,c.identifier=this.ids[d],delete this.ids[d];break}return c},f.prototype.onmove=function(C){return this.onAny("move",C),!1},f.prototype.onend=function(C){return this.onAny("end",C),!1},f.prototype.oncancel=function(C){return this.onAny("end",C),!1},f.prototype.onAny=function(C,c){var d,b=this,X="processOn"+C.charAt(0).toUpperCase()+C.slice(1);c=j(c);var P=function(C,c,d){d.ids.indexOf(c)>=0&&(d[X](C),C._found_=!0)};return u(c,(function(C){d=b.getIdentifier(C),u(b.collections,P.bind(null,C,d)),C._found_||b.removeIdentifier(d)})),!1},f.prototype.destroy=function(){var C=this;C.unbindDocument(!0),C.ids={},C.index=0,C.collections.forEach((function(C){C.destroy()})),C.off()},f.prototype.onDestroyed=function(C,c){var d=this;if(d.collections.indexOf(c)<0)return!1;d.collections.splice(d.collections.indexOf(c),1)};var T=new f;const z={create:function(C){return T.create(C)},factory:T};return c.default})(),C.exports=c()},13541:(C,c,d)=>{"use strict";const{Deflate:b,deflate:X,deflateRaw:P,gzip:V}=d(13549),{Inflate:R,inflate:p,inflateRaw:j,ungzip:g}=d(13595),k=d(13579);C.exports.Deflate=b,C.exports.deflate=X,C.exports.deflateRaw=P,C.exports.gzip=V,C.exports.Inflate=R,C.exports.inflate=p,C.exports.inflateRaw=j,C.exports.ungzip=g,C.exports.constants=k},13549:(C,c,d)=>{"use strict";const b=d(13556),X=d(13586),P=d(13591),V=d(13573),R=d(13593),p=Object.prototype.toString,{Z_NO_FLUSH:j,Z_SYNC_FLUSH:g,Z_FULL_FLUSH:k,Z_FINISH:Z,Z_OK:U,Z_STREAM_END:A,Z_DEFAULT_COMPRESSION:u,Z_DEFAULT_STRATEGY:q,Z_DEFLATED:B}=d(13579);function t(C){this.options=X.assign({level:u,method:B,HC:16384,windowBits:15,memLevel:8,strategy:q},C||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.hc="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let d=b.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(d!==U)throw new Error(V[d]);if(c.header&&b.deflateSetHeader(this.strm,c.header),c.dictionary){let C;if(C="string"===typeof c.dictionary?P.string2buf(c.dictionary):"[object ArrayBuffer]"===p.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,d=b.deflateSetDictionary(this.strm,C),d!==U)throw new Error(V[d]);this._dict_set=!0}}function e(C,c){const d=new t(c);if(d.push(C,!0),d.err)throw d.hc||V[d.err];return d.result}t.prototype.push=function(C,c){const d=this.strm,X=this.options.HC;let V,R;if(this.ended)return!1;for(R=c===~~c?c:!0===c?Z:j,"string"===typeof C?d.input=P.string2buf(C):"[object ArrayBuffer]"===p.call(C)?d.input=new Uint8Array(C):d.input=C,d.next_in=0,d.avail_in=d.input.length;;)if(0===d.avail_out&&(d.output=new Uint8Array(X),d.next_out=0,d.avail_out=X),(R===g||R===k)&&d.avail_out<=6)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else{if(V=b.deflate(d,R),V===A)return d.next_out>0&&this.onData(d.output.subarray(0,d.next_out)),V=b.deflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===U;if(0!==d.avail_out){if(R>0&&d.next_out>0)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else if(0===d.avail_in)break}else this.onData(d.output)}return!0},t.prototype.onData=function(C){this.chunks.push(C)},t.prototype.onEnd=function(C){C===U&&(this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.hc=this.strm.hc},C.exports.Deflate=t,C.exports.deflate=e,C.exports.deflateRaw=function(C,c){return(c=c||{}).raw=!0,e(C,c)},C.exports.gzip=function(C,c){return(c=c||{}).gzip=!0,e(C,c)},C.exports.constants=d(13579)},13595:(C,c,d)=>{"use strict";const b=d(13603),X=d(13586),P=d(13591),V=d(13573),R=d(13593),p=d(13620),j=Object.prototype.toString,{Z_NO_FLUSH:g,Z_FINISH:k,Z_OK:Z,Z_STREAM_END:U,Z_NEED_DICT:A,Z_STREAM_ERROR:u,Z_DATA_ERROR:q,Z_MEM_ERROR:B}=d(13579);function t(C){this.options=X.assign({HC:65536,windowBits:15,to:""},C||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||C&&C.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.hc="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let d=b.inflateInit2(this.strm,c.windowBits);if(d!==Z)throw new Error(V[d]);if(this.header=new p,b.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=P.string2buf(c.dictionary):"[object ArrayBuffer]"===j.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(d=b.inflateSetDictionary(this.strm,c.dictionary),d!==Z)))throw new Error(V[d])}function e(C,c){const d=new t(c);if(d.push(C),d.err)throw d.hc||V[d.err];return d.result}t.prototype.push=function(C,c){const d=this.strm,X=this.options.HC,V=this.options.dictionary;let R,p,t;if(this.ended)return!1;for(p=c===~~c?c:!0===c?k:g,"[object ArrayBuffer]"===j.call(C)?d.input=new Uint8Array(C):d.input=C,d.next_in=0,d.avail_in=d.input.length;;){for(0===d.avail_out&&(d.output=new Uint8Array(X),d.next_out=0,d.avail_out=X),R=b.inflate(d,p),R===A&&V&&(R=b.inflateSetDictionary(d,V),R===Z?R=b.inflate(d,p):R===q&&(R=A));d.avail_in>0&&R===U&&d.state.wrap>0&&0!==C[d.next_in];)b.inflateReset(d),R=b.inflate(d,p);switch(R){case u:case q:case A:case B:return this.onEnd(R),this.ended=!0,!1}if(t=d.avail_out,d.next_out&&(0===d.avail_out||R===U))if("string"===this.options.to){let C=P.utf8border(d.output,d.next_out),c=d.next_out-C,b=P.buf2string(d.output,C);d.next_out=c,d.avail_out=X-c,c&&d.output.set(d.output.subarray(C,C+c),0),this.onData(b)}else this.onData(d.output.length===d.next_out?d.output:d.output.subarray(0,d.next_out));if(R!==Z||0!==t){if(R===U)return R=b.inflateEnd(this.strm),this.onEnd(R),this.ended=!0,!0;if(0===d.avail_in)break}}return!0},t.prototype.onData=function(C){this.chunks.push(C)},t.prototype.onEnd=function(C){C===Z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.hc=this.strm.hc},C.exports.Inflate=t,C.exports.inflate=e,C.exports.inflateRaw=function(C,c){return(c=c||{}).raw=!0,e(C,c)},C.exports.ungzip=e,C.exports.constants=d(13579)},13586:C=>{"use strict";const c=(C,c)=>Object.prototype.hasOwnProperty.call(C,c);C.exports.assign=function(C){const d=Array.prototype.slice.call(arguments,1);for(;d.length;){const b=d.shift();if(b){if("object"!==typeof b)throw new TypeError(b+"must be non-object");for(const d in b)c(b,d)&&(C[d]=b[d])}}return C},C.exports.flattenChunks=C=>{let c=0;for(let b=0,X=C.length;b<X;b++)c+=C[b].length;const d=new Uint8Array(c);for(let b=0,X=0,P=C.length;b<P;b++){let c=C[b];d.set(c,X),X+=c.length}return d}},13591:C=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(b){c=!1}const d=new Uint8Array(256);for(let X=0;X<256;X++)d[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;d[254]=d[254]=1,C.exports.string2buf=C=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(C);let c,d,b,X,P,V=C.length,R=0;for(X=0;X<V;X++)d=C.charCodeAt(X),55296===(64512&d)&&X+1<V&&(b=C.charCodeAt(X+1),56320===(64512&b)&&(d=65536+(d-55296<<10)+(b-56320),X++)),R+=d<128?1:d<2048?2:d<65536?3:4;for(c=new Uint8Array(R),P=0,X=0;P<R;X++)d=C.charCodeAt(X),55296===(64512&d)&&X+1<V&&(b=C.charCodeAt(X+1),56320===(64512&b)&&(d=65536+(d-55296<<10)+(b-56320),X++)),d<128?c[P++]=d:d<2048?(c[P++]=192|d>>>6,c[P++]=128|63&d):d<65536?(c[P++]=224|d>>>12,c[P++]=128|d>>>6&63,c[P++]=128|63&d):(c[P++]=240|d>>>18,c[P++]=128|d>>>12&63,c[P++]=128|d>>>6&63,c[P++]=128|63&d);return c};C.exports.buf2string=(C,b)=>{const X=b||C.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(C.subarray(0,b));let P,V;const R=new Array(2*X);for(V=0,P=0;P<X;){let c=C[P++];if(c<128){R[V++]=c;continue}let b=d[c];if(b>4)R[V++]=65533,P+=b-1;else{for(c&=2===b?31:3===b?15:7;b>1&&P<X;)c=c<<6|63&C[P++],b--;b>1?R[V++]=65533:c<65536?R[V++]=c:(c-=65536,R[V++]=55296|c>>10&1023,R[V++]=56320|1023&c)}}return((C,d)=>{if(d<65534&&C.subarray&&c)return String.fromCharCode.apply(null,C.length===d?C:C.subarray(0,d));let b="";for(let c=0;c<d;c++)b+=String.fromCharCode(C[c]);return b})(R,V)},C.exports.utf8border=(C,c)=>{(c=c||C.length)>C.length&&(c=C.length);let b=c-1;for(;b>=0&&128===(192&C[b]);)b--;return b<0||0===b?c:b+d[C[b]]>c?b:c}},13564:C=>{"use strict";C.exports=(C,c,d,b)=>{let X=65535&C,P=C>>>16&65535,V=0;for(;0!==d;){V=d>2e3?2e3:d,d-=V;do{X=X+c[b++]|0,P=P+X|0}while(--V);X%=65521,P%=65521}return X|P<<16}},13579:C=>{"use strict";C.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13566:C=>{"use strict";const c=new Uint32Array((()=>{let C,c=[];for(var d=0;d<256;d++){C=d;for(var b=0;b<8;b++)C=1&C?3988292384^C>>>1:C>>>1;c[d]=C}return c})());C.exports=(C,d,b,X)=>{const P=c,V=X+b;C^=-1;for(let c=X;c<V;c++)C=C>>>8^P[255&(C^d[c])];return~C}},13556:(C,c,d)=>{"use strict";const{_tr_init:b,_tr_stored_block:X,_tr_flush_block:P,_tr_tally:V,_tr_align:R}=d(13562),p=d(13564),j=d(13566),g=d(13573),{Z_NO_FLUSH:k,Z_PARTIAL_FLUSH:Z,Z_FULL_FLUSH:U,Z_FINISH:A,Z_BLOCK:u,Z_OK:q,Z_STREAM_END:B,Z_STREAM_ERROR:t,Z_DATA_ERROR:e,Z_BUF_ERROR:n,Z_DEFAULT_COMPRESSION:W,Z_FILTERED:E,Z_HUFFMAN_ONLY:N,Z_RLE:r,Z_FIXED:M,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:i,Z_DEFLATED:h}=d(13579),L=258,f=262,T=103,z=113,w=666,J=(C,c)=>(C.hc=g[c],c),y=C=>(C<<1)-(C>4?9:0),x=C=>{let c=C.length;for(;--c>=0;)C[c]=0};let H=(C,c,d)=>(c<<C.hash_shift^d)&C.hash_mask;const v=C=>{const c=C.state;let d=c.pending;d>C.avail_out&&(d=C.avail_out),0!==d&&(C.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+d),C.next_out),C.next_out+=d,c.pending_out+=d,C.total_out+=d,C.avail_out-=d,c.pending-=d,0===c.pending&&(c.pending_out=0))},D=(C,c)=>{P(C,C.block_start>=0?C.block_start:-1,C.strstart-C.block_start,c),C.block_start=C.strstart,v(C.strm)},s=(C,c)=>{C.pending_buf[C.pending++]=c},mC=(C,c)=>{C.pending_buf[C.pending++]=c>>>8&255,C.pending_buf[C.pending++]=255&c},Q=(C,c,d,b)=>{let X=C.avail_in;return X>b&&(X=b),0===X?0:(C.avail_in-=X,c.set(C.input.subarray(C.next_in,C.next_in+X),d),1===C.state.wrap?C.adler=p(C.adler,c,X,d):2===C.state.wrap&&(C.adler=j(C.adler,c,X,d)),C.next_in+=X,C.total_in+=X,X)},I=(C,c)=>{let d,b,X=C.max_chain_length,P=C.strstart,V=C.prev_length,R=C.nice_match;const p=C.strstart>C.w_size-f?C.strstart-(C.w_size-f):0,j=C.window,g=C.w_mask,k=C.prev,Z=C.strstart+L;let U=j[P+V-1],A=j[P+V];C.prev_length>=C.good_match&&(X>>=2),R>C.lookahead&&(R=C.lookahead);do{if(d=c,j[d+V]===A&&j[d+V-1]===U&&j[d]===j[P]&&j[++d]===j[P+1]){P+=2,d++;do{}while(j[++P]===j[++d]&&j[++P]===j[++d]&&j[++P]===j[++d]&&j[++P]===j[++d]&&j[++P]===j[++d]&&j[++P]===j[++d]&&j[++P]===j[++d]&&j[++P]===j[++d]&&P<Z);if(b=L-(Z-P),P=Z-L,b>V){if(C.match_start=c,V=b,b>=R)break;U=j[P+V-1],A=j[P+V]}}}while((c=k[c&g])>p&&0!==--X);return V<=C.lookahead?V:C.lookahead},o=C=>{const c=C.w_size;let d,b,X,P,V;do{if(P=C.window_size-C.lookahead-C.strstart,C.strstart>=c+(c-f)){C.window.set(C.window.subarray(c,c+c),0),C.match_start-=c,C.strstart-=c,C.block_start-=c,b=C.hash_size,d=b;do{X=C.head[--d],C.head[d]=X>=c?X-c:0}while(--b);b=c,d=b;do{X=C.prev[--d],C.prev[d]=X>=c?X-c:0}while(--b);P+=c}if(0===C.strm.avail_in)break;if(b=Q(C.strm,C.window,C.strstart+C.lookahead,P),C.lookahead+=b,C.lookahead+C.insert>=3)for(V=C.strstart-C.insert,C.ins_h=C.window[V],C.ins_h=H(C,C.ins_h,C.window[V+1]);C.insert&&(C.ins_h=H(C,C.ins_h,C.window[V+3-1]),C.prev[V&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=V,V++,C.insert--,!(C.lookahead+C.insert<3)););}while(C.lookahead<f&&0!==C.strm.avail_in)},F=(C,c)=>{let d,b;for(;;){if(C.lookahead<f){if(o(C),C.lookahead<f&&c===k)return 1;if(0===C.lookahead)break}if(d=0,C.lookahead>=3&&(C.ins_h=H(C,C.ins_h,C.window[C.strstart+3-1]),d=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),0!==d&&C.strstart-d<=C.w_size-f&&(C.match_length=I(C,d)),C.match_length>=3)if(b=V(C,C.strstart-C.match_start,C.match_length-3),C.lookahead-=C.match_length,C.match_length<=C.max_lazy_match&&C.lookahead>=3){C.match_length--;do{C.strstart++,C.ins_h=H(C,C.ins_h,C.window[C.strstart+3-1]),d=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart}while(0!==--C.match_length);C.strstart++}else C.strstart+=C.match_length,C.match_length=0,C.ins_h=C.window[C.strstart],C.ins_h=H(C,C.ins_h,C.window[C.strstart+1]);else b=V(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++;if(b&&(D(C,!1),0===C.strm.avail_out))return 1}return C.insert=C.strstart<2?C.strstart:2,c===A?(D(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(D(C,!1),0===C.strm.avail_out)?1:2},Y=(C,c)=>{let d,b,X;for(;;){if(C.lookahead<f){if(o(C),C.lookahead<f&&c===k)return 1;if(0===C.lookahead)break}if(d=0,C.lookahead>=3&&(C.ins_h=H(C,C.ins_h,C.window[C.strstart+3-1]),d=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),C.prev_length=C.match_length,C.prev_match=C.match_start,C.match_length=2,0!==d&&C.prev_length<C.max_lazy_match&&C.strstart-d<=C.w_size-f&&(C.match_length=I(C,d),C.match_length<=5&&(C.strategy===E||3===C.match_length&&C.strstart-C.match_start>4096)&&(C.match_length=2)),C.prev_length>=3&&C.match_length<=C.prev_length){X=C.strstart+C.lookahead-3,b=V(C,C.strstart-1-C.prev_match,C.prev_length-3),C.lookahead-=C.prev_length-1,C.prev_length-=2;do{++C.strstart<=X&&(C.ins_h=H(C,C.ins_h,C.window[C.strstart+3-1]),d=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart)}while(0!==--C.prev_length);if(C.match_available=0,C.match_length=2,C.strstart++,b&&(D(C,!1),0===C.strm.avail_out))return 1}else if(C.match_available){if(b=V(C,0,C.window[C.strstart-1]),b&&D(C,!1),C.strstart++,C.lookahead--,0===C.strm.avail_out)return 1}else C.match_available=1,C.strstart++,C.lookahead--}return C.match_available&&(b=V(C,0,C.window[C.strstart-1]),C.match_available=0),C.insert=C.strstart<2?C.strstart:2,c===A?(D(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(D(C,!1),0===C.strm.avail_out)?1:2};function l(C,c,d,b,X){this.good_length=C,this.max_lazy=c,this.nice_length=d,this.max_chain=b,this.func=X}const S=[new l(0,0,0,0,((C,c)=>{let d=65535;for(d>C.pending_buf_size-5&&(d=C.pending_buf_size-5);;){if(C.lookahead<=1){if(o(C),0===C.lookahead&&c===k)return 1;if(0===C.lookahead)break}C.strstart+=C.lookahead,C.lookahead=0;const b=C.block_start+d;if((0===C.strstart||C.strstart>=b)&&(C.lookahead=C.strstart-b,C.strstart=b,D(C,!1),0===C.strm.avail_out))return 1;if(C.strstart-C.block_start>=C.w_size-f&&(D(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,c===A?(D(C,!0),0===C.strm.avail_out?3:4):(C.strstart>C.block_start&&(D(C,!1),C.strm.avail_out),1)})),new l(4,4,8,4,F),new l(4,5,16,8,F),new l(4,6,32,32,F),new l(4,4,16,16,Y),new l(8,16,32,32,Y),new l(8,16,128,128,Y),new l(8,32,128,256,Y),new l(32,128,258,1024,Y),new l(32,258,258,4096,Y)];function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const a=C=>{if(!C||!C.state)return J(C,t);C.total_in=C.total_out=0,C.data_type=i;const c=C.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:z,C.adler=2===c.wrap?0:1,c.last_flush=k,b(c),q},O=C=>{const c=a(C);var d;return c===q&&((d=C.state).window_size=2*d.w_size,x(d.head),d.max_lazy_match=S[d.level].max_lazy,d.good_match=S[d.level].good_length,d.nice_match=S[d.level].nice_length,d.max_chain_length=S[d.level].max_chain,d.strstart=0,d.block_start=0,d.lookahead=0,d.insert=0,d.match_length=d.prev_length=2,d.match_available=0,d.ins_h=0),c},CC=(C,c,d,b,X,P)=>{if(!C)return t;let V=1;if(c===W&&(c=6),b<0?(V=0,b=-b):b>15&&(V=2,b-=16),X<1||X>9||d!==h||b<8||b>15||c<0||c>9||P<0||P>M)return J(C,t);8===b&&(b=9);const R=new G;return C.state=R,R.strm=C,R.wrap=V,R.gzhead=null,R.w_bits=b,R.w_size=1<<R.w_bits,R.w_mask=R.w_size-1,R.hash_bits=X+7,R.hash_size=1<<R.hash_bits,R.hash_mask=R.hash_size-1,R.hash_shift=~~((R.hash_bits+3-1)/3),R.window=new Uint8Array(2*R.w_size),R.head=new Uint16Array(R.hash_size),R.prev=new Uint16Array(R.w_size),R.lit_bufsize=1<<X+6,R.pending_buf_size=4*R.lit_bufsize,R.pending_buf=new Uint8Array(R.pending_buf_size),R.d_buf=1*R.lit_bufsize,R.l_buf=3*R.lit_bufsize,R.level=c,R.strategy=P,R.method=d,O(C)};C.exports.deflateInit=(C,c)=>CC(C,c,h,15,8,K),C.exports.deflateInit2=CC,C.exports.deflateReset=O,C.exports.deflateResetKeep=a,C.exports.deflateSetHeader=(C,c)=>C&&C.state?2!==C.state.wrap?t:(C.state.gzhead=c,q):t,C.exports.deflate=(C,c)=>{let d,b;if(!C||!C.state||c>u||c<0)return C?J(C,t):t;const P=C.state;if(!C.output||!C.input&&0!==C.avail_in||P.status===w&&c!==A)return J(C,0===C.avail_out?n:t);P.strm=C;const p=P.last_flush;if(P.last_flush=c,42===P.status)if(2===P.wrap)C.adler=0,s(P,31),s(P,139),s(P,8),P.gzhead?(s(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),s(P,255&P.gzhead.time),s(P,P.gzhead.time>>8&255),s(P,P.gzhead.time>>16&255),s(P,P.gzhead.time>>24&255),s(P,9===P.level?2:P.strategy>=N||P.level<2?4:0),s(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(s(P,255&P.gzhead.extra.length),s(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(C.adler=j(C.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(s(P,0),s(P,0),s(P,0),s(P,0),s(P,0),s(P,9===P.level?2:P.strategy>=N||P.level<2?4:0),s(P,3),P.status=z);else{let c=h+(P.w_bits-8<<4)<<8,d=-1;d=P.strategy>=N||P.level<2?0:P.level<6?1:6===P.level?2:3,c|=d<<6,0!==P.strstart&&(c|=32),c+=31-c%31,P.status=z,mC(P,c),0!==P.strstart&&(mC(P,C.adler>>>16),mC(P,65535&C.adler)),C.adler=1}if(69===P.status)if(P.gzhead.extra){for(d=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>d&&(C.adler=j(C.adler,P.pending_buf,P.pending-d,d)),v(C),d=P.pending,P.pending!==P.pending_buf_size));)s(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>d&&(C.adler=j(C.adler,P.pending_buf,P.pending-d,d)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(73===P.status)if(P.gzhead.name){d=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>d&&(C.adler=j(C.adler,P.pending_buf,P.pending-d,d)),v(C),d=P.pending,P.pending===P.pending_buf_size)){b=1;break}b=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,s(P,b)}while(0!==b);P.gzhead.hcrc&&P.pending>d&&(C.adler=j(C.adler,P.pending_buf,P.pending-d,d)),0===b&&(P.gzindex=0,P.status=91)}else P.status=91;if(91===P.status)if(P.gzhead.comment){d=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>d&&(C.adler=j(C.adler,P.pending_buf,P.pending-d,d)),v(C),d=P.pending,P.pending===P.pending_buf_size)){b=1;break}b=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,s(P,b)}while(0!==b);P.gzhead.hcrc&&P.pending>d&&(C.adler=j(C.adler,P.pending_buf,P.pending-d,d)),0===b&&(P.status=T)}else P.status=T;if(P.status===T&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&v(C),P.pending+2<=P.pending_buf_size&&(s(P,255&C.adler),s(P,C.adler>>8&255),C.adler=0,P.status=z)):P.status=z),0!==P.pending){if(v(C),0===C.avail_out)return P.last_flush=-1,q}else if(0===C.avail_in&&y(c)<=y(p)&&c!==A)return J(C,n);if(P.status===w&&0!==C.avail_in)return J(C,n);if(0!==C.avail_in||0!==P.lookahead||c!==k&&P.status!==w){let d=P.strategy===N?((C,c)=>{let d;for(;;){if(0===C.lookahead&&(o(C),0===C.lookahead)){if(c===k)return 1;break}if(C.match_length=0,d=V(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++,d&&(D(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,c===A?(D(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(D(C,!1),0===C.strm.avail_out)?1:2})(P,c):P.strategy===r?((C,c)=>{let d,b,X,P;const R=C.window;for(;;){if(C.lookahead<=L){if(o(C),C.lookahead<=L&&c===k)return 1;if(0===C.lookahead)break}if(C.match_length=0,C.lookahead>=3&&C.strstart>0&&(X=C.strstart-1,b=R[X],b===R[++X]&&b===R[++X]&&b===R[++X])){P=C.strstart+L;do{}while(b===R[++X]&&b===R[++X]&&b===R[++X]&&b===R[++X]&&b===R[++X]&&b===R[++X]&&b===R[++X]&&b===R[++X]&&X<P);C.match_length=L-(P-X),C.match_length>C.lookahead&&(C.match_length=C.lookahead)}if(C.match_length>=3?(d=V(C,1,C.match_length-3),C.lookahead-=C.match_length,C.strstart+=C.match_length,C.match_length=0):(d=V(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++),d&&(D(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,c===A?(D(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(D(C,!1),0===C.strm.avail_out)?1:2})(P,c):S[P.level].func(P,c);if(3!==d&&4!==d||(P.status=w),1===d||3===d)return 0===C.avail_out&&(P.last_flush=-1),q;if(2===d&&(c===Z?R(P):c!==u&&(X(P,0,0,!1),c===U&&(x(P.head),0===P.lookahead&&(P.strstart=0,P.block_start=0,P.insert=0))),v(C),0===C.avail_out))return P.last_flush=-1,q}return c!==A?q:P.wrap<=0?B:(2===P.wrap?(s(P,255&C.adler),s(P,C.adler>>8&255),s(P,C.adler>>16&255),s(P,C.adler>>24&255),s(P,255&C.total_in),s(P,C.total_in>>8&255),s(P,C.total_in>>16&255),s(P,C.total_in>>24&255)):(mC(P,C.adler>>>16),mC(P,65535&C.adler)),v(C),P.wrap>0&&(P.wrap=-P.wrap),0!==P.pending?q:B)},C.exports.deflateEnd=C=>{if(!C||!C.state)return t;const c=C.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==T&&c!==z&&c!==w?J(C,t):(C.state=null,c===z?J(C,e):q)},C.exports.deflateSetDictionary=(C,c)=>{let d=c.length;if(!C||!C.state)return t;const b=C.state,X=b.wrap;if(2===X||1===X&&42!==b.status||b.lookahead)return t;if(1===X&&(C.adler=p(C.adler,c,d,0)),b.wrap=0,d>=b.w_size){0===X&&(x(b.head),b.strstart=0,b.block_start=0,b.insert=0);let C=new Uint8Array(b.w_size);C.set(c.subarray(d-b.w_size,d),0),c=C,d=b.w_size}const P=C.avail_in,V=C.next_in,R=C.input;for(C.avail_in=d,C.next_in=0,C.input=c,o(b);b.lookahead>=3;){let C=b.strstart,c=b.lookahead-2;do{b.ins_h=H(b,b.ins_h,b.window[C+3-1]),b.prev[C&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=C,C++}while(--c);b.strstart=C,b.lookahead=2,o(b)}return b.strstart+=b.lookahead,b.block_start=b.strstart,b.insert=b.lookahead,b.lookahead=0,b.match_length=b.prev_length=2,b.match_available=0,C.next_in=V,C.input=R,C.avail_in=P,b.wrap=X,q},C.exports.deflateInfo="pako deflate (from Nodeca project)"},13620:C=>{"use strict";C.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13606:C=>{"use strict";C.exports=function(C,c){let d,b,X,P,V,R,p,j,g,k,Z,U,A,u,q,B,t,e,n,W,E,N,r,M;const K=C.state;d=C.next_in,r=C.input,b=d+(C.avail_in-5),X=C.next_out,M=C.output,P=X-(c-C.avail_out),V=X+(C.avail_out-257),R=K.dmax,p=K.wsize,j=K.whave,g=K.wnext,k=K.window,Z=K.hold,U=K.bits,A=K.lencode,u=K.distcode,q=(1<<K.lenbits)-1,B=(1<<K.distbits)-1;C:do{U<15&&(Z+=r[d++]<<U,U+=8,Z+=r[d++]<<U,U+=8),t=A[Z&q];c:for(;;){if(e=t>>>24,Z>>>=e,U-=e,e=t>>>16&255,0===e)M[X++]=65535&t;else{if(!(16&e)){if(0===(64&e)){t=A[(65535&t)+(Z&(1<<e)-1)];continue c}if(32&e){K.mode=12;break C}C.hc="invalid literal/length code",K.mode=30;break C}n=65535&t,e&=15,e&&(U<e&&(Z+=r[d++]<<U,U+=8),n+=Z&(1<<e)-1,Z>>>=e,U-=e),U<15&&(Z+=r[d++]<<U,U+=8,Z+=r[d++]<<U,U+=8),t=u[Z&B];d:for(;;){if(e=t>>>24,Z>>>=e,U-=e,e=t>>>16&255,!(16&e)){if(0===(64&e)){t=u[(65535&t)+(Z&(1<<e)-1)];continue d}C.hc="invalid distance code",K.mode=30;break C}if(W=65535&t,e&=15,U<e&&(Z+=r[d++]<<U,U+=8,U<e&&(Z+=r[d++]<<U,U+=8)),W+=Z&(1<<e)-1,W>R){C.hc="invalid distance too far back",K.mode=30;break C}if(Z>>>=e,U-=e,e=X-P,W>e){if(e=W-e,e>j&&K.sane){C.hc="invalid distance too far back",K.mode=30;break C}if(E=0,N=k,0===g){if(E+=p-e,e<n){n-=e;do{M[X++]=k[E++]}while(--e);E=X-W,N=M}}else if(g<e){if(E+=p+g-e,e-=g,e<n){n-=e;do{M[X++]=k[E++]}while(--e);if(E=0,g<n){e=g,n-=e;do{M[X++]=k[E++]}while(--e);E=X-W,N=M}}}else if(E+=g-e,e<n){n-=e;do{M[X++]=k[E++]}while(--e);E=X-W,N=M}for(;n>2;)M[X++]=N[E++],M[X++]=N[E++],M[X++]=N[E++],n-=3;n&&(M[X++]=N[E++],n>1&&(M[X++]=N[E++]))}else{E=X-W;do{M[X++]=M[E++],M[X++]=M[E++],M[X++]=M[E++],n-=3}while(n>2);n&&(M[X++]=M[E++],n>1&&(M[X++]=M[E++]))}break}}break}}while(d<b&&X<V);n=U>>3,d-=n,U-=n<<3,Z&=(1<<U)-1,C.next_in=d,C.next_out=X,C.avail_in=d<b?b-d+5:5-(d-b),C.avail_out=X<V?V-X+257:257-(X-V),K.hold=Z,K.bits=U}},13603:(C,c,d)=>{"use strict";const b=d(13564),X=d(13566),P=d(13606),V=d(13612),{Z_FINISH:R,Z_BLOCK:p,Z_TREES:j,Z_OK:g,Z_STREAM_END:k,Z_NEED_DICT:Z,Z_STREAM_ERROR:U,Z_DATA_ERROR:A,Z_MEM_ERROR:u,Z_BUF_ERROR:q,Z_DEFLATED:B}=d(13579),t=12,e=30,n=C=>(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24);function W(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const E=C=>{if(!C||!C.state)return U;const c=C.state;return C.total_in=C.total_out=c.total=0,C.hc="",c.wrap&&(C.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,g},N=C=>{if(!C||!C.state)return U;const c=C.state;return c.wsize=0,c.whave=0,c.wnext=0,E(C)},r=(C,c)=>{let d;if(!C||!C.state)return U;const b=C.state;return c<0?(d=0,c=-c):(d=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?U:(null!==b.window&&b.wbits!==c&&(b.window=null),b.wrap=d,b.wbits=c,N(C))},M=(C,c)=>{if(!C)return U;const d=new W;C.state=d,d.window=null;const b=r(C,c);return b!==g&&(C.state=null),b};let K,i,h=!0;const L=C=>{if(h){K=new Int32Array(512),i=new Int32Array(32);let c=0;for(;c<144;)C.lens[c++]=8;for(;c<256;)C.lens[c++]=9;for(;c<280;)C.lens[c++]=7;for(;c<288;)C.lens[c++]=8;for(V(1,C.lens,0,288,K,0,C.work,{bits:9}),c=0;c<32;)C.lens[c++]=5;V(2,C.lens,0,32,i,0,C.work,{bits:5}),h=!1}C.lencode=K,C.lenbits=9,C.distcode=i,C.distbits=5},f=(C,c,d,b)=>{let X;const P=C.state;return null===P.window&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new Uint8Array(P.wsize)),b>=P.wsize?(P.window.set(c.subarray(d-P.wsize,d),0),P.wnext=0,P.whave=P.wsize):(X=P.wsize-P.wnext,X>b&&(X=b),P.window.set(c.subarray(d-b,d-b+X),P.wnext),(b-=X)?(P.window.set(c.subarray(d-b,d),0),P.wnext=b,P.whave=P.wsize):(P.wnext+=X,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=X))),0};C.exports.inflateReset=N,C.exports.inflateReset2=r,C.exports.inflateResetKeep=E,C.exports.inflateInit=C=>M(C,15),C.exports.inflateInit2=M,C.exports.inflate=(C,c)=>{let d,W,E,N,r,M,K,i,h,T,z,w,J,y,x,H,v,D,s,mC,Q,I,o=0;const F=new Uint8Array(4);let Y,l;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!C||!C.state||!C.output||!C.input&&0!==C.avail_in)return U;d=C.state,d.mode===t&&(d.mode=13),r=C.next_out,E=C.output,K=C.avail_out,N=C.next_in,W=C.input,M=C.avail_in,i=d.hold,h=d.bits,T=M,z=K,I=g;C:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=13;break}for(;h<16;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(2&d.wrap&&35615===i){d.check=0,F[0]=255&i,F[1]=i>>>8&255,d.check=X(d.check,F,2,0),i=0,h=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&i)<<8)+(i>>8))%31){C.hc="incorrect header check",d.mode=e;break}if((15&i)!==B){C.hc="unknown compression method",d.mode=e;break}if(i>>>=4,h-=4,Q=8+(15&i),0===d.wbits)d.wbits=Q;else if(Q>d.wbits){C.hc="invalid window size",d.mode=e;break}d.dmax=1<<d.wbits,C.adler=d.check=1,d.mode=512&i?10:t,i=0,h=0;break;case 2:for(;h<16;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(d.flags=i,(255&d.flags)!==B){C.hc="unknown compression method",d.mode=e;break}if(57344&d.flags){C.hc="unknown header flags set",d.mode=e;break}d.head&&(d.head.text=i>>8&1),512&d.flags&&(F[0]=255&i,F[1]=i>>>8&255,d.check=X(d.check,F,2,0)),i=0,h=0,d.mode=3;case 3:for(;h<32;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}d.head&&(d.head.time=i),512&d.flags&&(F[0]=255&i,F[1]=i>>>8&255,F[2]=i>>>16&255,F[3]=i>>>24&255,d.check=X(d.check,F,4,0)),i=0,h=0,d.mode=4;case 4:for(;h<16;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}d.head&&(d.head.xflags=255&i,d.head.os=i>>8),512&d.flags&&(F[0]=255&i,F[1]=i>>>8&255,d.check=X(d.check,F,2,0)),i=0,h=0,d.mode=5;case 5:if(1024&d.flags){for(;h<16;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}d.length=i,d.head&&(d.head.extra_len=i),512&d.flags&&(F[0]=255&i,F[1]=i>>>8&255,d.check=X(d.check,F,2,0)),i=0,h=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(w=d.length,w>M&&(w=M),w&&(d.head&&(Q=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Uint8Array(d.head.extra_len)),d.head.extra.set(W.subarray(N,N+w),Q)),512&d.flags&&(d.check=X(d.check,W,w,N)),M-=w,N+=w,d.length-=w),d.length))break C;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(0===M)break C;w=0;do{Q=W[N+w++],d.head&&Q&&d.length<65536&&(d.head.name+=String.fromCharCode(Q))}while(Q&&w<M);if(512&d.flags&&(d.check=X(d.check,W,w,N)),M-=w,N+=w,Q)break C}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(0===M)break C;w=0;do{Q=W[N+w++],d.head&&Q&&d.length<65536&&(d.head.comment+=String.fromCharCode(Q))}while(Q&&w<M);if(512&d.flags&&(d.check=X(d.check,W,w,N)),M-=w,N+=w,Q)break C}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;h<16;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(i!==(65535&d.check)){C.hc="header crc mismatch",d.mode=e;break}i=0,h=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),C.adler=d.check=0,d.mode=t;break;case 10:for(;h<32;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}C.adler=d.check=n(i),i=0,h=0,d.mode=11;case 11:if(0===d.havedict)return C.next_out=r,C.avail_out=K,C.next_in=N,C.avail_in=M,d.hold=i,d.bits=h,Z;C.adler=d.check=1,d.mode=t;case t:if(c===p||c===j)break C;case 13:if(d.last){i>>>=7&h,h-=7&h,d.mode=27;break}for(;h<3;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}switch(d.last=1&i,i>>>=1,h-=1,3&i){case 0:d.mode=14;break;case 1:if(L(d),d.mode=20,c===j){i>>>=2,h-=2;break C}break;case 2:d.mode=17;break;case 3:C.hc="invalid block type",d.mode=e}i>>>=2,h-=2;break;case 14:for(i>>>=7&h,h-=7&h;h<32;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if((65535&i)!==(i>>>16^65535)){C.hc="invalid stored block lengths",d.mode=e;break}if(d.length=65535&i,i=0,h=0,d.mode=15,c===j)break C;case 15:d.mode=16;case 16:if(w=d.length,w){if(w>M&&(w=M),w>K&&(w=K),0===w)break C;E.set(W.subarray(N,N+w),r),M-=w,N+=w,K-=w,r+=w,d.length-=w;break}d.mode=t;break;case 17:for(;h<14;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(d.nlen=257+(31&i),i>>>=5,h-=5,d.ndist=1+(31&i),i>>>=5,h-=5,d.ncode=4+(15&i),i>>>=4,h-=4,d.nlen>286||d.ndist>30){C.hc="too many length or distance symbols",d.mode=e;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;h<3;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}d.lens[S[d.have++]]=7&i,i>>>=3,h-=3}for(;d.have<19;)d.lens[S[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,Y={bits:d.lenbits},I=V(0,d.lens,0,19,d.lencode,0,d.work,Y),d.lenbits=Y.bits,I){C.hc="invalid code lengths set",d.mode=e;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;o=d.lencode[i&(1<<d.lenbits)-1],x=o>>>24,H=o>>>16&255,v=65535&o,!(x<=h);){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(v<16)i>>>=x,h-=x,d.lens[d.have++]=v;else{if(16===v){for(l=x+2;h<l;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(i>>>=x,h-=x,0===d.have){C.hc="invalid bit length repeat",d.mode=e;break}Q=d.lens[d.have-1],w=3+(3&i),i>>>=2,h-=2}else if(17===v){for(l=x+3;h<l;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}i>>>=x,h-=x,Q=0,w=3+(7&i),i>>>=3,h-=3}else{for(l=x+7;h<l;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}i>>>=x,h-=x,Q=0,w=11+(127&i),i>>>=7,h-=7}if(d.have+w>d.nlen+d.ndist){C.hc="invalid bit length repeat",d.mode=e;break}for(;w--;)d.lens[d.have++]=Q}}if(d.mode===e)break;if(0===d.lens[256]){C.hc="invalid code -- missing end-of-block",d.mode=e;break}if(d.lenbits=9,Y={bits:d.lenbits},I=V(1,d.lens,0,d.nlen,d.lencode,0,d.work,Y),d.lenbits=Y.bits,I){C.hc="invalid literal/lengths set",d.mode=e;break}if(d.distbits=6,d.distcode=d.distdyn,Y={bits:d.distbits},I=V(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,Y),d.distbits=Y.bits,I){C.hc="invalid distances set",d.mode=e;break}if(d.mode=20,c===j)break C;case 20:d.mode=21;case 21:if(M>=6&&K>=258){C.next_out=r,C.avail_out=K,C.next_in=N,C.avail_in=M,d.hold=i,d.bits=h,P(C,z),r=C.next_out,E=C.output,K=C.avail_out,N=C.next_in,W=C.input,M=C.avail_in,i=d.hold,h=d.bits,d.mode===t&&(d.back=-1);break}for(d.back=0;o=d.lencode[i&(1<<d.lenbits)-1],x=o>>>24,H=o>>>16&255,v=65535&o,!(x<=h);){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(H&&0===(240&H)){for(D=x,s=H,mC=v;o=d.lencode[mC+((i&(1<<D+s)-1)>>D)],x=o>>>24,H=o>>>16&255,v=65535&o,!(D+x<=h);){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}i>>>=D,h-=D,d.back+=D}if(i>>>=x,h-=x,d.back+=x,d.length=v,0===H){d.mode=26;break}if(32&H){d.back=-1,d.mode=t;break}if(64&H){C.hc="invalid literal/length code",d.mode=e;break}d.extra=15&H,d.mode=22;case 22:if(d.extra){for(l=d.extra;h<l;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}d.length+=i&(1<<d.extra)-1,i>>>=d.extra,h-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;o=d.distcode[i&(1<<d.distbits)-1],x=o>>>24,H=o>>>16&255,v=65535&o,!(x<=h);){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(0===(240&H)){for(D=x,s=H,mC=v;o=d.distcode[mC+((i&(1<<D+s)-1)>>D)],x=o>>>24,H=o>>>16&255,v=65535&o,!(D+x<=h);){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}i>>>=D,h-=D,d.back+=D}if(i>>>=x,h-=x,d.back+=x,64&H){C.hc="invalid distance code",d.mode=e;break}d.offset=v,d.extra=15&H,d.mode=24;case 24:if(d.extra){for(l=d.extra;h<l;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}d.offset+=i&(1<<d.extra)-1,i>>>=d.extra,h-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){C.hc="invalid distance too far back",d.mode=e;break}d.mode=25;case 25:if(0===K)break C;if(w=z-K,d.offset>w){if(w=d.offset-w,w>d.whave&&d.sane){C.hc="invalid distance too far back",d.mode=e;break}w>d.wnext?(w-=d.wnext,J=d.wsize-w):J=d.wnext-w,w>d.length&&(w=d.length),y=d.window}else y=E,J=r-d.offset,w=d.length;w>K&&(w=K),K-=w,d.length-=w;do{E[r++]=y[J++]}while(--w);0===d.length&&(d.mode=21);break;case 26:if(0===K)break C;E[r++]=d.length,K--,d.mode=21;break;case 27:if(d.wrap){for(;h<32;){if(0===M)break C;M--,i|=W[N++]<<h,h+=8}if(z-=K,C.total_out+=z,d.total+=z,z&&(C.adler=d.check=d.flags?X(d.check,E,z,r-z):b(d.check,E,z,r-z)),z=K,(d.flags?i:n(i))!==d.check){C.hc="incorrect data check",d.mode=e;break}i=0,h=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;h<32;){if(0===M)break C;M--,i+=W[N++]<<h,h+=8}if(i!==(4294967295&d.total)){C.hc="incorrect length check",d.mode=e;break}i=0,h=0}d.mode=29;case 29:I=k;break C;case e:I=A;break C;case 31:return u;default:return U}return C.next_out=r,C.avail_out=K,C.next_in=N,C.avail_in=M,d.hold=i,d.bits=h,(d.wsize||z!==C.avail_out&&d.mode<e&&(d.mode<27||c!==R))&&f(C,C.output,C.next_out,z-C.avail_out)?(d.mode=31,u):(T-=C.avail_in,z-=C.avail_out,C.total_in+=T,C.total_out+=z,d.total+=z,d.wrap&&z&&(C.adler=d.check=d.flags?X(d.check,E,z,C.next_out-z):b(d.check,E,z,C.next_out-z)),C.data_type=d.bits+(d.last?64:0)+(d.mode===t?128:0)+(20===d.mode||15===d.mode?256:0),(0===T&&0===z||c===R)&&I===g&&(I=q),I)},C.exports.inflateEnd=C=>{if(!C||!C.state)return U;let c=C.state;return c.window&&(c.window=null),C.state=null,g},C.exports.inflateGetHeader=(C,c)=>{if(!C||!C.state)return U;const d=C.state;return 0===(2&d.wrap)?U:(d.head=c,c.done=!1,g)},C.exports.inflateSetDictionary=(C,c)=>{const d=c.length;let X,P,V;return C&&C.state?(X=C.state,0!==X.wrap&&11!==X.mode?U:11===X.mode&&(P=1,P=b(P,c,d,0),P!==X.check)?A:(V=f(C,c,d,d),V?(X.mode=31,u):(X.havedict=1,g))):U},C.exports.inflateInfo="pako inflate (from Nodeca project)"},13612:C=>{"use strict";const c=15,d=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),b=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),X=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),P=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);C.exports=(C,V,R,p,j,g,k,Z)=>{const U=Z.bits;let A,u,q,B,t,e,n=0,W=0,E=0,N=0,r=0,M=0,K=0,i=0,h=0,L=0,f=null,T=0;const z=new Uint16Array(16),w=new Uint16Array(16);let J,y,x,H=null,v=0;for(n=0;n<=c;n++)z[n]=0;for(W=0;W<p;W++)z[V[R+W]]++;for(r=U,N=c;N>=1&&0===z[N];N--);if(r>N&&(r=N),0===N)return j[g++]=20971520,j[g++]=20971520,Z.bits=1,0;for(E=1;E<N&&0===z[E];E++);for(r<E&&(r=E),i=1,n=1;n<=c;n++)if(i<<=1,i-=z[n],i<0)return-1;if(i>0&&(0===C||1!==N))return-1;for(w[1]=0,n=1;n<c;n++)w[n+1]=w[n]+z[n];for(W=0;W<p;W++)0!==V[R+W]&&(k[w[V[R+W]]++]=W);if(0===C?(f=H=k,e=19):1===C?(f=d,T-=257,H=b,v-=257,e=256):(f=X,H=P,e=-1),L=0,W=0,n=E,t=g,M=r,K=0,q=-1,h=1<<r,B=h-1,1===C&&h>852||2===C&&h>592)return 1;for(;;){J=n-K,k[W]<e?(y=0,x=k[W]):k[W]>e?(y=H[v+k[W]],x=f[T+k[W]]):(y=96,x=0),A=1<<n-K,u=1<<M,E=u;do{u-=A,j[t+(L>>K)+u]=J<<24|y<<16|x}while(0!==u);for(A=1<<n-1;L&A;)A>>=1;if(0!==A?(L&=A-1,L+=A):L=0,W++,0===--z[n]){if(n===N)break;n=V[R+k[W]]}if(n>r&&(L&B)!==q){for(0===K&&(K=r),t+=E,M=n-K,i=1<<M;M+K<N&&(i-=z[M+K],!(i<=0));)M++,i<<=1;if(h+=1<<M,1===C&&h>852||2===C&&h>592)return 1;q=L&B,j[q]=r<<24|M<<16|t-g}}return 0!==L&&(j[t+L]=n-K<<24|64<<16),Z.bits=r,0}},13573:C=>{"use strict";C.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13562:C=>{"use strict";function c(C){let c=C.length;for(;--c>=0;)C[c]=0}const d=256,b=286,X=30,P=15,V=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),p=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Array(576);c(g);const k=new Array(60);c(k);const Z=new Array(512);c(Z);const U=new Array(256);c(U);const A=new Array(29);c(A);const u=new Array(X);function q(C,c,d,b,X){this.static_tree=C,this.extra_bits=c,this.extra_base=d,this.elems=b,this.max_length=X,this.has_stree=C&&C.length}let B,t,e;function n(C,c){this.dyn_tree=C,this.max_code=0,this.stat_desc=c}c(u);const W=C=>C<256?Z[C]:Z[256+(C>>>7)],E=(C,c)=>{C.pending_buf[C.pending++]=255&c,C.pending_buf[C.pending++]=c>>>8&255},N=(C,c,d)=>{C.bi_valid>16-d?(C.bi_buf|=c<<C.bi_valid&65535,E(C,C.bi_buf),C.bi_buf=c>>16-C.bi_valid,C.bi_valid+=d-16):(C.bi_buf|=c<<C.bi_valid&65535,C.bi_valid+=d)},r=(C,c,d)=>{N(C,d[2*c],d[2*c+1])},M=(C,c)=>{let d=0;do{d|=1&C,C>>>=1,d<<=1}while(--c>0);return d>>>1},K=(C,c,d)=>{const b=new Array(16);let X,V,R=0;for(X=1;X<=P;X++)b[X]=R=R+d[X-1]<<1;for(V=0;V<=c;V++){let c=C[2*V+1];0!==c&&(C[2*V]=M(b[c]++,c))}},i=C=>{let c;for(c=0;c<b;c++)C.dyn_ltree[2*c]=0;for(c=0;c<X;c++)C.dyn_dtree[2*c]=0;for(c=0;c<19;c++)C.bl_tree[2*c]=0;C.dyn_ltree[512]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0},h=C=>{C.bi_valid>8?E(C,C.bi_buf):C.bi_valid>0&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0},L=(C,c,d,b)=>{const X=2*c,P=2*d;return C[X]<C[P]||C[X]===C[P]&&b[c]<=b[d]},f=(C,c,d)=>{const b=C.heap[d];let X=d<<1;for(;X<=C.heap_len&&(X<C.heap_len&&L(c,C.heap[X+1],C.heap[X],C.depth)&&X++,!L(c,b,C.heap[X],C.depth));)C.heap[d]=C.heap[X],d=X,X<<=1;C.heap[d]=b},T=(C,c,b)=>{let X,P,p,j,g=0;if(0!==C.last_lit)do{X=C.pending_buf[C.d_buf+2*g]<<8|C.pending_buf[C.d_buf+2*g+1],P=C.pending_buf[C.l_buf+g],g++,0===X?r(C,P,c):(p=U[P],r(C,p+d+1,c),j=V[p],0!==j&&(P-=A[p],N(C,P,j)),X--,p=W(X),r(C,p,b),j=R[p],0!==j&&(X-=u[p],N(C,X,j)))}while(g<C.last_lit);r(C,256,c)},z=(C,c)=>{const d=c.dyn_tree,b=c.stat_desc.static_tree,X=c.stat_desc.has_stree,V=c.stat_desc.elems;let R,p,j,g=-1;for(C.heap_len=0,C.heap_max=573,R=0;R<V;R++)0!==d[2*R]?(C.heap[++C.heap_len]=g=R,C.depth[R]=0):d[2*R+1]=0;for(;C.heap_len<2;)j=C.heap[++C.heap_len]=g<2?++g:0,d[2*j]=1,C.depth[j]=0,C.opt_len--,X&&(C.static_len-=b[2*j+1]);for(c.max_code=g,R=C.heap_len>>1;R>=1;R--)f(C,d,R);j=V;do{R=C.heap[1],C.heap[1]=C.heap[C.heap_len--],f(C,d,1),p=C.heap[1],C.heap[--C.heap_max]=R,C.heap[--C.heap_max]=p,d[2*j]=d[2*R]+d[2*p],C.depth[j]=(C.depth[R]>=C.depth[p]?C.depth[R]:C.depth[p])+1,d[2*R+1]=d[2*p+1]=j,C.heap[1]=j++,f(C,d,1)}while(C.heap_len>=2);C.heap[--C.heap_max]=C.heap[1],((C,c)=>{const d=c.dyn_tree,b=c.max_code,X=c.stat_desc.static_tree,V=c.stat_desc.has_stree,R=c.stat_desc.extra_bits,p=c.stat_desc.extra_base,j=c.stat_desc.max_length;let g,k,Z,U,A,u,q=0;for(U=0;U<=P;U++)C.bl_count[U]=0;for(d[2*C.heap[C.heap_max]+1]=0,g=C.heap_max+1;g<573;g++)k=C.heap[g],U=d[2*d[2*k+1]+1]+1,U>j&&(U=j,q++),d[2*k+1]=U,k>b||(C.bl_count[U]++,A=0,k>=p&&(A=R[k-p]),u=d[2*k],C.opt_len+=u*(U+A),V&&(C.static_len+=u*(X[2*k+1]+A)));if(0!==q){do{for(U=j-1;0===C.bl_count[U];)U--;C.bl_count[U]--,C.bl_count[U+1]+=2,C.bl_count[j]--,q-=2}while(q>0);for(U=j;0!==U;U--)for(k=C.bl_count[U];0!==k;)Z=C.heap[--g],Z>b||(d[2*Z+1]!==U&&(C.opt_len+=(U-d[2*Z+1])*d[2*Z],d[2*Z+1]=U),k--)}})(C,c),K(d,g,C.bl_count)},w=(C,c,d)=>{let b,X,P=-1,V=c[1],R=0,p=7,j=4;for(0===V&&(p=138,j=3),c[2*(d+1)+1]=65535,b=0;b<=d;b++)X=V,V=c[2*(b+1)+1],++R<p&&X===V||(R<j?C.bl_tree[2*X]+=R:0!==X?(X!==P&&C.bl_tree[2*X]++,C.bl_tree[32]++):R<=10?C.bl_tree[34]++:C.bl_tree[36]++,R=0,P=X,0===V?(p=138,j=3):X===V?(p=6,j=3):(p=7,j=4))},J=(C,c,d)=>{let b,X,P=-1,V=c[1],R=0,p=7,j=4;for(0===V&&(p=138,j=3),b=0;b<=d;b++)if(X=V,V=c[2*(b+1)+1],!(++R<p&&X===V)){if(R<j)do{r(C,X,C.bl_tree)}while(0!==--R);else 0!==X?(X!==P&&(r(C,X,C.bl_tree),R--),r(C,16,C.bl_tree),N(C,R-3,2)):R<=10?(r(C,17,C.bl_tree),N(C,R-3,3)):(r(C,18,C.bl_tree),N(C,R-11,7));R=0,P=X,0===V?(p=138,j=3):X===V?(p=6,j=3):(p=7,j=4)}};let y=!1;const x=(C,c,d,b)=>{N(C,0+(b?1:0),3),((C,c,d,b)=>{h(C),b&&(E(C,d),E(C,~d)),C.pending_buf.set(C.window.subarray(c,c+d),C.pending),C.pending+=d})(C,c,d,!0)};C.exports._tr_init=C=>{y||((()=>{let C,c,d,j,n;const W=new Array(16);for(d=0,j=0;j<28;j++)for(A[j]=d,C=0;C<1<<V[j];C++)U[d++]=j;for(U[d-1]=j,n=0,j=0;j<16;j++)for(u[j]=n,C=0;C<1<<R[j];C++)Z[n++]=j;for(n>>=7;j<X;j++)for(u[j]=n<<7,C=0;C<1<<R[j]-7;C++)Z[256+n++]=j;for(c=0;c<=P;c++)W[c]=0;for(C=0;C<=143;)g[2*C+1]=8,C++,W[8]++;for(;C<=255;)g[2*C+1]=9,C++,W[9]++;for(;C<=279;)g[2*C+1]=7,C++,W[7]++;for(;C<=287;)g[2*C+1]=8,C++,W[8]++;for(K(g,287,W),C=0;C<X;C++)k[2*C+1]=5,k[2*C]=M(C,5);B=new q(g,V,257,b,P),t=new q(k,R,0,X,P),e=new q(new Array(0),p,0,19,7)})(),y=!0),C.l_desc=new n(C.dyn_ltree,B),C.d_desc=new n(C.dyn_dtree,t),C.bl_desc=new n(C.bl_tree,e),C.bi_buf=0,C.bi_valid=0,i(C)},C.exports._tr_stored_block=x,C.exports._tr_flush_block=(C,c,b,X)=>{let P,V,R=0;C.level>0?(2===C.strm.data_type&&(C.strm.data_type=(C=>{let c,b=4093624447;for(c=0;c<=31;c++,b>>>=1)if(1&b&&0!==C.dyn_ltree[2*c])return 0;if(0!==C.dyn_ltree[18]||0!==C.dyn_ltree[20]||0!==C.dyn_ltree[26])return 1;for(c=32;c<d;c++)if(0!==C.dyn_ltree[2*c])return 1;return 0})(C)),z(C,C.l_desc),z(C,C.d_desc),R=(C=>{let c;for(w(C,C.dyn_ltree,C.l_desc.max_code),w(C,C.dyn_dtree,C.d_desc.max_code),z(C,C.bl_desc),c=18;c>=3&&0===C.bl_tree[2*j[c]+1];c--);return C.opt_len+=3*(c+1)+5+5+4,c})(C),P=C.opt_len+3+7>>>3,V=C.static_len+3+7>>>3,V<=P&&(P=V)):P=V=b+5,b+4<=P&&-1!==c?x(C,c,b,X):4===C.strategy||V===P?(N(C,2+(X?1:0),3),T(C,g,k)):(N(C,4+(X?1:0),3),((C,c,d,b)=>{let X;for(N(C,c-257,5),N(C,d-1,5),N(C,b-4,4),X=0;X<b;X++)N(C,C.bl_tree[2*j[X]+1],3);J(C,C.dyn_ltree,c-1),J(C,C.dyn_dtree,d-1)})(C,C.l_desc.max_code+1,C.d_desc.max_code+1,R+1),T(C,C.dyn_ltree,C.dyn_dtree)),i(C),X&&h(C)},C.exports._tr_tally=(C,c,b)=>(C.pending_buf[C.d_buf+2*C.last_lit]=c>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&c,C.pending_buf[C.l_buf+C.last_lit]=255&b,C.last_lit++,0===c?C.dyn_ltree[2*b]++:(C.matches++,c--,C.dyn_ltree[2*(U[b]+d+1)]++,C.dyn_dtree[2*W(c)]++),C.last_lit===C.lit_bufsize-1),C.exports._tr_align=C=>{N(C,2,3),r(C,256,g),(C=>{16===C.bi_valid?(E(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):C.bi_valid>=8&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)})(C)}},13593:C=>{"use strict";C.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.hc="",this.state=null,this.data_type=2,this.adler=0}},13219:C=>{function c(C,c,d){for(var b=C.length,X=-1/0,P=1/0,V=0;V<b;V++){var R=(d[0][V]-C[V])/c[V],p=(d[1][V]-C[V])/c[V];if(R>p){var j=R;R=p,p=j}if(p<X||R>P)return 1/0;R>X&&(X=R),p<P&&(P=p)}return X>P?1/0:X}C.exports=function(C,d,b,X){var P=c(d,b,X);if(P===1/0)C=null;else{C=C||[];for(var V=0;V<d.length;V++)C[V]=d[V]+b[V]*P}return C},C.exports.distance=c},14619:(C,c,d)=>{"use strict";d.d(c,{b:()=>V});var b=d(35);const X=b.useLayoutEffect;const P=function(C){var c=(0,b.useRef)(C);return X((function(){c.current=C})),c};var V=function(C){var c=P(C);(0,b.tc)((function(){var C=function(C){var d;if(null!=c.current&&(d=c.current(C)),C.defaultPrevented&&(C.returnValue=""),"string"===typeof d)return C.returnValue=d,d};return window.addEventListener("beforeunload",C),function(){window.removeEventListener("beforeunload",C)}}),[])}},14574:(C,c,d)=>{"use strict";var b=d(14581),X=Array.prototype.concat,P=Array.prototype.slice,V=C.exports=function(C){for(var c=[],d=0,V=C.length;d<V;d++){var R=C[d];b(R)?c=X.call(c,P.call(R)):c.push(R)}return c};V.wrap=function(C){return function(){return C(V(arguments))}}},14581:C=>{C.exports=function(C){return!(!C||"string"===typeof C)&&(C instanceof Array||Array.isArray(C)||C.length>=0&&(C.splice instanceof Function||Object.getOwnPropertyDescriptor(C,C.length-1)&&"String"!==C.constructor.name))}},13503:(C,c,d)=>{var b=d(13508);function X(C){for(var c,d,X=0,P=C.length,V=0;V<C.length;){for(c=C[V],d=0;V<P&&C[V]===c;)++V,++d;X+=b.log2(d)/7|0,X+=b.log2(c>>>0)/7|0,X+=2}return X}c.size=X,c.encode=function(C,c){c||(c=new Uint8Array(X(C)));for(var d,b,P=0,V=c.length,R=0;R<C.length;){for(d=C[R],b=0;R<C.length&&C[R]===d;)++R,++b;for(;P<V&&b>=128;)c[P++]=128+(127&b),b>>>=7;if(P>=V)throw new Error("RLE buffer overflow");for(c[P++]=b,d>>>=0;P<V&&d>=128;)c[P++]=128+(127&d),d>>>=7;if(P>=V)throw new Error("RLE buffer overflow");c[P++]=d}return c},c.decode=function(C,c){for(var d,b,X,P,V=c.length,R=C.length,p=0,j=0;j<R;){for(d=0,b=0;j<R&&C[j]>=128;)d+=(127&C[j++])<<b,b+=7;if(d+=C[j++]<<b,j>=R)throw new Error("RLE buffer underrun");if(p+d>V)throw new Error("Chunk buffer overflow");for(X=0,b=0;j<R&&C[j]>=128;)X+=(127&C[j++])<<b,b+=7;if(j>=R)throw new Error("RLE buffer underrun");for(X+=C[j++]<<b,P=0;P<d;++P)c[p++]=X}return c}},13508:(C,c)=>{"use strict";function d(C){var c=32;return(C&=-C)&&c--,65535&C&&(c-=16),16711935&C&&(c-=8),252645135&C&&(c-=4),858993459&C&&(c-=2),1431655765&C&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(C){return(C>0)-(C<0)},c.abs=function(C){var c=C>>31;return(C^c)-c},c.min=function(C,c){return c^(C^c)&-(C<c)},c.max=function(C,c){return C^(C^c)&-(C<c)},c.isPow2=function(C){return!(C&C-1)&&!!C},c.log2=function(C){var c,d;return c=(C>65535)<<4,c|=d=((C>>>=c)>255)<<3,c|=d=((C>>>=d)>15)<<2,(c|=d=((C>>>=d)>3)<<1)|(C>>>=d)>>1},c.log10=function(C){return C>=1e9?9:C>=1e8?8:C>=1e7?7:C>=1e6?6:C>=1e5?5:C>=1e4?4:C>=1e3?3:C>=100?2:C>=10?1:0},c.popCount=function(C){return 16843009*((C=(858993459&(C-=C>>>1&1431655765))+(C>>>2&858993459))+(C>>>4)&252645135)>>>24},c.countTrailingZeros=d,c.nextPow2=function(C){return C+=0===C,--C,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)+1},c.prevPow2=function(C){return C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)-(C>>>1)},c.parity=function(C){return C^=C>>>16,C^=C>>>8,C^=C>>>4,27030>>>(C&=15)&1};var b=new Array(256);!function(C){for(var c=0;c<256;++c){var d=c,b=c,X=7;for(d>>>=1;d;d>>>=1)b<<=1,b|=1&d,--X;C[c]=b<<X&255}}(b),c.reverse=function(C){return b[255&C]<<24|b[C>>>8&255]<<16|b[C>>>16&255]<<8|b[C>>>24&255]},c.interleave2=function(C,c){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C&=65535)|C<<8))|C<<4))|C<<2))|C<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(C,c){return(C=65535&((C=16711935&((C=252645135&((C=858993459&((C=C>>>c&1431655765)|C>>>1))|C>>>2))|C>>>4))|C>>>16))<<16>>16},c.interleave3=function(C,c,d){return C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2),(C|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<2},c.deinterleave3=function(C,c){return(C=1023&((C=4278190335&((C=251719695&((C=3272356035&((C=C>>>c&1227133513)|C>>>2))|C>>>4))|C>>>8))|C>>>16))<<22>>22},c.nextCombination=function(C){var c=C|C-1;return c+1|(~c&-~c)-1>>>d(C)+1}},13536:C=>{"use strict";C.exports=function(C,c,d,b){var X=self||window;try{try{var P;try{P=new X.Blob([C])}catch(j){(P=new(X.BlobBuilder||X.WebKitBlobBuilder||X.MozBlobBuilder||X.MSBlobBuilder)).append(C),P=P.getBlob()}var V=X.URL||X.webkitURL,R=V.createObjectURL(P),p=new X[c](R,d);return V.revokeObjectURL(R),p}catch(j){return new X[c]("data:application/javascript,".concat(encodeURIComponent(C)),d)}}catch(j){if(!b)throw Error("Inline worker is not supported");return new X[c](b,d)}}},13206:(C,c,d)=>{"use strict";function b(C,c,d,b,X){var P={};return Object.keys(b).forEach((function(C){P[C]=b[C]})),P.enumerable=!!P.enumerable,P.configurable=!!P.configurable,("value"in P||P.initializer)&&(P.writable=!0),P=d.slice().reverse().reduce((function(d,b){return b(C,c,d)||d}),P),X&&void 0!==P.initializer&&(P.value=P.initializer?P.initializer.call(X):void 0,P.initializer=void 0),void 0===P.initializer&&(Object.defineProperty(C,c,P),P=null),P}d.d(c,{e:()=>b})},13197:(C,c,d)=>{"use strict";function b(C,c,d,b){d&&Object.defineProperty(C,c,{enumerable:d.enumerable,configurable:d.configurable,writable:d.writable,value:d.initializer?d.initializer.call(b):void 0})}d.d(c,{c:()=>b})},14607:(C,c,d)=>{"use strict";d.d(c,{d:()=>V,h:()=>k,j:()=>R,k:()=>P,m:()=>p,q:()=>X,t:()=>j,u:()=>g});var b=d(12614);class X{constructor(){this._easingMode=X.EASINGMODE_EASEIN}setEasingMode(C){const c=Math.min(Math.max(C,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(C){throw new Error("You must implement this method")}ease(C){switch(this._easingMode){case X.EASINGMODE_EASEIN:return this.easeInCore(C);case X.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-C)}return C>=.5?.5*(1-this.easeInCore(2*(1-C)))+.5:.5*this.easeInCore(2*C)}}X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2;class P extends X{easeInCore(C){return C=Math.max(0,Math.min(1,C)),1-Math.sqrt(1-C*C)}}class V extends X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=C}easeInCore(C){const c=Math.max(0,this.amplitude);return Math.pow(C,3)-C*c*Math.sin(3.141592653589793*C)}}class R extends X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=C,this.bounciness=c}easeInCore(C){const c=Math.max(0,this.bounces);let d=this.bounciness;d<=1&&(d=1.001);const b=Math.pow(d,c),X=1-d,P=(1-b)/X+.5*b,V=C*P,R=Math.log(-V*(1-d)+1)/Math.log(d),p=Math.floor(R),j=p+1,g=(1-Math.pow(d,p))/(X*P),k=.5*(g+(1-Math.pow(d,j))/(X*P)),Z=C-k,U=k-g;return-Math.pow(1/d,c-p)/(U*U)*(Z-U)*(Z+U)}}class p extends X{easeInCore(C){return C*C*C}}class j extends X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=C,this.springiness=c}easeInCore(C){let c;const d=Math.max(0,this.oscillations),b=Math.max(0,this.springiness);return c=0==b?C:(Math.exp(b*C)-1)/(Math.exp(b)-1),c*Math.sin((6.283185307179586*d+1.5707963267948966)*C)}}class g extends X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=C}easeInCore(C){return this.exponent<=0?C:(Math.exp(this.exponent*C)-1)/(Math.exp(this.exponent)-1)}}class k extends X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=C,this.y1=c,this.x2=d,this.y2=b}easeInCore(C){return b.e.Interpolate(C,this.x1,this.y1,this.x2,this.y2)}}},14056:(C,c,d)=>{"use strict";d.d(c,{c:()=>V});var b=d(12403),X=d(12416),P=d(12816);class V extends P.e{get _matrix(){return this._compose(),this.OU}set _matrix(C){(C.updateFlag!==this.OU.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.OU.V(C),this._markAsDirtyAndDecompose())}constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(C,c.NC(),!1),this.name=C,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.OU=(null===X||void 0===X?void 0:X.clone())??b.Matrix.Identity(),this._restMatrix=P??this.OU.clone(),this._bindMatrix=V??this.OU.clone(),this._index=R,this._absoluteMatrix=new b.Matrix,this._absoluteBindMatrix=new b.Matrix,this._absoluteInverseBindMatrix=new b.Matrix,this._finalMatrix=new b.Matrix,c.bones.push(this),this.setParent(d,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(C){this.setParent(C)}setParent(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==C){if(this.parent){const C=this.parent.children.indexOf(this);-1!==C&&this.parent.children.splice(C,1)}this._parentNode=C,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.Wk()}}getLocalMatrix(){return this._compose(),this.OU}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(C){this._restMatrix.V(C)}setRestPose(C){this.setRestMatrix(C)}getBindPose(){return this.getBindMatrix()}setBindMatrix(C){this.fc(C)}setBindPose(C){this.setBindMatrix(C)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const C=b.TmpVectors.dd[0],c=b.TmpVectors.Quaternion[0],d=b.TmpVectors.dd[1];this.getRestMatrix().decompose(C,c,d),this._linkedTransformNode.position.V(d),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??b.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.V(c),this._linkedTransformNode.xc.V(C)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(C){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=C,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.pj}set position(C){this._decompose(),this.pj.V(C),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(C){this.setRotation(C)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(C){this.setRotationQuaternion(C)}get xc(){return this.getScale()}set xc(C){this.setScale(C)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=b.dd.Zero(),this._localRotation=b.Quaternion.Zero(),this.pj=b.dd.Zero()),this.OU.decompose(this._localScaling,this._localRotation,this.pj))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,b.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.pj,this.OU)):this._needToCompose=!1)}fc(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.V(C),c&&this._updateAbsoluteBindMatrices(),d?this._matrix=C:this.Wk()}_updateAbsoluteBindMatrices(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(C||(C=this._bindMatrix),this.parent?C.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.V(C),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let d=0;d<this.children.length;d++)this.children[d]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Wk(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Wk(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Wk(),this._needToDecompose=!0}_updatePosition(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const P=this.getLocalMatrix();if(0==c)X?(P.addAtIndex(12,C.x),P.addAtIndex(13,C.y),P.addAtIndex(14,C.z)):P.setTranslationFromFloats(C.x,C.y,C.z);else{let c=null;d&&(c=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=V._TmpMats[0],p=V._TmpVecs[0];this.parent?d&&c?(R.V(this.parent.getAbsoluteMatrix()),R.multiplyToRef(c,R)):R.V(this.parent.getAbsoluteMatrix()):b.Matrix.IdentityToRef(R),X&&R.setTranslationFromFloats(0,0,0),R.invert(),b.dd.TransformCoordinatesToRef(C,R,p),X?(P.addAtIndex(12,p.x),P.addAtIndex(13,p.y),P.addAtIndex(14,p.z)):P.setTranslationFromFloats(p.x,p.y,p.z)}this._markAsDirtyAndDecompose()}translate(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this._updatePosition(C,c,d,!0)}setPosition(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this._updatePosition(C,c,d,!1)}setAbsolutePosition(C,c){this.setPosition(C,1,c)}scale(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const P=this.getLocalMatrix(),R=V._TmpMats[0];b.Matrix.ScalingToRef(C,c,d,R),R.multiplyToRef(P,P),R.invert();for(const b of this.children){const X=b.getLocalMatrix();X.multiplyToRef(R,X),X.multiplyAtIndex(12,C),X.multiplyAtIndex(13,c),X.multiplyAtIndex(14,d),b._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),X)for(const b of this.children)b.scale(C,c,d,X)}setScale(C){this._decompose(),this._localScaling.V(C),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(C){this._decompose(),C.V(this._localScaling)}setYawPitchRoll(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4?arguments[4]:void 0;if(0===X){const R=V._TmpQuat;return b.Quaternion.RotationYawPitchRollToRef(C,c,d,R),void this.setRotationQuaternion(R,X,P)}const R=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,P))return;const p=V._TmpMats[1];b.Matrix.RotationYawPitchRollToRef(C,c,d,p),R.multiplyToRef(p,p),this._rotateWithMatrix(p,X,P)}rotate(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;const P=V._TmpMats[0];P.setTranslationFromFloats(0,0,0),b.Matrix.RotationAxisToRef(C,c,P),this._rotateWithMatrix(P,d,X)}setAxisAngle(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;if(0===d){const P=V._TmpQuat;return b.Quaternion.RotationAxisToRef(C,c,P),void this.setRotationQuaternion(P,d,X)}const P=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(P,X))return;const R=V._TmpMats[1];b.Matrix.RotationAxisToRef(C,c,R),P.multiplyToRef(R,R),this._rotateWithMatrix(R,d,X)}setRotation(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(C.y,C.x,C.z,c,d)}setRotationQuaternion(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.V(C),void this._markAsDirtyAndCompose();const X=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,d))return;const P=V._TmpMats[1];b.Matrix.FromQuaternionToRef(C,P),X.multiplyToRef(P,P),this._rotateWithMatrix(P,c,d)}setRotationMatrix(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(0===c){const X=V._TmpQuat;return b.Quaternion.FromRotationMatrixToRef(C,X),void this.setRotationQuaternion(X,c,d)}const X=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,d))return;const P=V._TmpMats[1];P.V(C),X.multiplyToRef(C,P),this._rotateWithMatrix(P,c,d)}_rotateWithMatrix(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;const b=this.getLocalMatrix(),X=b.m[12],P=b.m[13],R=b.m[14],p=this.getParent(),j=V._TmpMats[3],g=V._TmpMats[4];p&&1==c?(d?(j.V(d.getWorldMatrix()),p.getAbsoluteMatrix().multiplyToRef(j,j)):j.V(p.getAbsoluteMatrix()),g.V(j),g.invert(),b.multiplyToRef(j,b),b.multiplyToRef(C,b),b.multiplyToRef(g,b)):1==c&&d?(j.V(d.getWorldMatrix()),g.V(j),g.invert(),b.multiplyToRef(j,b),b.multiplyToRef(C,b),b.multiplyToRef(g,b)):b.multiplyToRef(C,b),b.setTranslationFromFloats(X,P,R),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(C,c){const d=V._TmpMats[2];return C.V(this.getAbsoluteMatrix()),c?(C.multiplyToRef(c.getWorldMatrix(),C),b.Matrix.ScalingToRef(c.xc.x,c.xc.y,c.xc.z,d)):b.Matrix.IdentityToRef(d),C.invert(),!isNaN(C.m[0])&&(d.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyToRef(d,C),!0)}Rc(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=b.dd.Zero();return this.getPositionToRef(C,c,d),d}getPositionToRef(){let C=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const C=this.getLocalMatrix();c.x=C.m[12],c.y=C.m[13],c.z=C.m[14]}else{let d=null;C&&(d=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let b=V._TmpMats[0];C&&d?(b.V(this.getAbsoluteMatrix()),b.multiplyToRef(d,b)):b=this.getAbsoluteMatrix(),c.x=b.m[12],c.y=b.m[13],c.z=b.m[14]}}getAbsolutePosition(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=b.dd.Zero();return this.getPositionToRef(1,C,c),c}getAbsolutePositionToRef(C,c){this.getPositionToRef(1,C,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.OU.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.V(this.OU);const C=this._skeleton.getPoseMatrix();C&&this._absoluteMatrix.multiplyToRef(C,this._absoluteMatrix)}const C=this.children,c=C.length;for(let d=0;d<c;d++)C[d].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}yj(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=b.dd.Zero();return this.getDirectionToRef(C,c,d),d}getDirectionToRef(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,X=null;c&&(X=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=V._TmpMats[0];P.V(this.getAbsoluteMatrix()),c&&X&&P.multiplyToRef(X,P),b.dd.TransformNormalToRef(C,P,d),d.normalize()}getRotation(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=b.dd.Zero();return this.getRotationToRef(C,c,d),d}getRotationToRef(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;const b=V._TmpQuat;this.getRotationQuaternionToRef(C,c,b),b.toEulerAnglesToRef(d)}getRotationQuaternion(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=b.Quaternion.Identity();return this.getRotationQuaternionToRef(C,c,d),d}getRotationQuaternionToRef(){let C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.V(this._localRotation);else{const d=V._TmpMats[0],b=this.getAbsoluteMatrix();C?b.multiplyToRef(C.getWorldMatrix(),d):d.V(b),d.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyAtIndex(1,this._scalingDeterminant),d.multiplyAtIndex(2,this._scalingDeterminant),d.decompose(void 0,c,void 0)}}getRotationMatrix(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const d=b.Matrix.Identity();return this.getRotationMatrixToRef(C,c,d),d}getRotationMatrixToRef(){let C=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const d=V._TmpMats[0],b=this.getAbsoluteMatrix();C?b.multiplyToRef(C.getWorldMatrix(),d):d.V(b),d.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyAtIndex(1,this._scalingDeterminant),d.multiplyAtIndex(2,this._scalingDeterminant),d.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=b.dd.Zero();return this.getAbsolutePositionFromLocalToRef(C,c,d),d}getAbsolutePositionFromLocalToRef(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,X=null;c&&(X=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=V._TmpMats[0];P.V(this.getAbsoluteMatrix()),c&&X&&P.multiplyToRef(X,P),b.dd.TransformCoordinatesToRef(C,P,d)}getLocalPositionFromAbsolute(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=b.dd.Zero();return this.getLocalPositionFromAbsoluteToRef(C,c,d),d}getLocalPositionFromAbsoluteToRef(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,X=null;c&&(X=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=V._TmpMats[0];P.V(this.getAbsoluteMatrix()),c&&X&&P.multiplyToRef(X,P),P.invert(),b.dd.TransformCoordinatesToRef(C,P,d)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const C=this._skeleton.bones.indexOf(this);if(-1!==C&&this._skeleton.bones.splice(C,1),this._parentNode&&this._parentNode.children){const C=this._parentNode.children,c=C.indexOf(this);-1!==c&&C.splice(c,1)}super.dispose()}}V._TmpVecs=(0,X.c)(2,b.dd.Zero),V._TmpQuat=b.Quaternion.Identity(),V._TmpMats=(0,X.c)(5,b.Matrix.Identity)},14602:(C,c,d)=>{"use strict";d.d(c,{d:()=>z});var b=d(12384),X=d(12388),P=d(12221),V=d(12403),R=d(12418),p=d(12816),j=d(12848),g=d(12676),k=d(12241),Z=d(12412);class U{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(C){this._zoomStopsAnimation=C}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(C){this._idleRotationSpeed=C}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(C){this._idleRotationWaitTime=C}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(C){this._idleRotationSpinupTime=C}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(C){this._attachedCamera=C;const c=this._attachedCamera.NC();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((C=>{C.type!==g.c.POINTERDOWN?C.type===g.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const C=k.e.Now;let c=0;null!=this._lastFrameTime&&(c=C-this._lastFrameTime),this._lastFrameTime=C,this._applyUserInteraction();const d=C-this._lastInteractionTime-this._idleRotationWaitTime,b=Math.max(Math.min(d/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*b,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const C=this._attachedCamera.NC();this._onPrePointerObservableObserver&&C.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(C){this._lastInteractionTime=C??k.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let C=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(C=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?C:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=k.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var A=d(14607),u=d(12924);class q{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(C){if(this._autoTransitionRange===C)return;this._autoTransitionRange=C;const c=this._attachedCamera;c&&(C?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((C=>{if(C&&(C.Tc(!0),C.getBoundingInfo)){const c=C.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(C){this._attachedCamera=C,this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(C){return!!this._attachedCamera&&(this._attachedCamera.radius===C&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(C){if(!this._attachedCamera)return;this._radiusBounceTransition||(q.EasingFunction.setEasingMode(q.EasingMode),this._radiusBounceTransition=u.b.CreateAnimation("radius",u.b.ANIMATIONTYPE_FLOAT,60,q.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=u.b.TransitionTo("radius",this._attachedCamera.radius+C,this._attachedCamera,this._attachedCamera.NC(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}q.EasingFunction=new A.d(.3),q.EasingMode=A.q.EASINGMODE_EASEOUT;class B{constructor(){this.onTargetFramingAnimationEndObservable=new P.b,this._mode=B.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(C){this._mode=C}get mode(){return this._mode}set radiusScale(C){this._radiusScale=C}get radiusScale(){return this._radiusScale}set positionScale(C){this._positionScale=C}get positionScale(){return this._positionScale}set defaultElevation(C){this._defaultElevation=C}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(C){this._elevationReturnTime=C}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(C){this._elevationReturnWaitTime=C}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(C){this._zoomStopsAnimation=C}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(C){this._framingTime=C}get framingTime(){return this._framingTime}init(){}attach(C){this._attachedCamera=C;const c=this._attachedCamera.NC();B.EasingFunction.setEasingMode(B.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((C=>{C.type!==g.c.POINTERDOWN?C.type===g.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=C.onMeshTargetChangedObservable.add((C=>{C&&C.getBoundingInfo&&this.zoomOnMesh(C,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const C=this._attachedCamera.NC();this._onPrePointerObservableObserver&&C.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.Tc(!0);const b=C.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(b.minimumWorld,b.maximumWorld,c,d)}zoomOnMeshHierarchy(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.Tc(!0);const b=C.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(b.min,b.max,c,d)}zoomOnMeshesHierarchy(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new V.dd(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new V.dd(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let P=0;P<C.length;P++){const c=C[P].getHierarchyBoundingVectors(!0);V.dd.CheckExtends(c.min,b,X),V.dd.CheckExtends(c.max,b,X)}this.zoomOnBoundingInfo(b,X,c,d)}zoomOnBoundingInfo(C,c){let d,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const P=C.y,R=P+(c.y-P)*this._positionScale,p=c.Xd(C).scale(.5);if(!isFinite(R))return!1;if(b)d=new V.dd(0,R,0);else{const c=C.add(p);d=new V.dd(c.x,R,c.z)}this._vectorTransition||(this._vectorTransition=u.b.CreateAnimation("target",u.b.ANIMATIONTYPE_VECTOR3,60,B.EasingFunction)),this._betaIsAnimating=!0;let j=u.b.TransitionTo("target",d,this._attachedCamera,this._attachedCamera.NC(),60,this._vectorTransition,this._framingTime);j&&this._animatables.push(j);let g=0;if(this._mode===B.FitFrustumSidesMode){const d=this._calculateLowerRadiusFromModelBoundingSphere(C,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=p.length()+this._attachedCamera.Lc),g=d}else this._mode===B.IgnoreBoundsSizeMode&&(g=this._calculateLowerRadiusFromModelBoundingSphere(C,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Lc));if(this.autoCorrectCameraLimitsAndSensibility){const d=c.Xd(C).length();this._attachedCamera.panningSensibility=5e3/d,this._attachedCamera.wheelPrecision=100/g}return this._radiusTransition||(this._radiusTransition=u.b.CreateAnimation("radius",u.b.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),j=u.b.TransitionTo("radius",g,this._attachedCamera,this._attachedCamera.NC(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),X&&X(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),j&&this._animatables.push(j),!0}_calculateLowerRadiusFromModelBoundingSphere(C,c){const d=this._attachedCamera;if(!d)return 0;let b=d._calculateLowerRadiusFromModelBoundingSphere(C,c,this._radiusScale);return d.lowerRadiusLimit&&this._mode===B.IgnoreBoundsSizeMode&&(b=b<d.lowerRadiusLimit?d.lowerRadiusLimit:b),d.upperRadiusLimit&&(b=b>d.upperRadiusLimit?d.upperRadiusLimit:b),b}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const C=k.e.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,d=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>d&&C>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=u.b.CreateAnimation("beta",u.b.ANIMATIONTYPE_FLOAT,60,B.EasingFunction));const C=u.b.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.NC(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));C&&this._animatables.push(C)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=k.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}B.EasingFunction=new A.u,B.EasingMode=A.q.EASINGMODE_EASEINOUT,B.IgnoreBoundsSizeMode=0,B.FitFrustumSidesMode=1;var t=d(12857),e=d(12891),n=d(14047),W=d(12219);class E{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(C){C=W.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),d=c.getInputElement();let b=0,X=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=P=>{var V,R;const p=P.event,j="touch"===p.pointerType;if(P.type!==g.c.POINTERMOVE&&-1===this.buttons.indexOf(p.button))return;const k=p.target;if(this._altKey=p.altKey,this._ctrlKey=p.ctrlKey,this._metaKey=p.metaKey,this._shiftKey=p.shiftKey,this._buttonsPressed=p.buttons,c.isPointerLock){const C=p.movementX,c=p.movementY;this.onTouch(null,C,c),this._pointA=null,this._pointB=null}else{if(P.type!==g.c.POINTERDOWN&&P.type!==g.c.POINTERDOUBLETAP&&j&&(null===(V=this._pointA)||void 0===V?void 0:V.pointerId)!==p.pointerId&&(null===(R=this._pointB)||void 0===R?void 0:R.pointerId)!==p.pointerId)return;if(P.type!==g.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!j)if(P.type===g.c.POINTERDOUBLETAP)this.onDoubleTap(p.pointerType);else if(P.type!==g.c.POINTERUP||this._currentMousePointerIdDown!==p.pointerId&&!j){if(P.type===g.c.POINTERMOVE)if(C||p.preventDefault(),this._pointA&&null===this._pointB){const C=p.clientX-this._pointA.x,c=p.clientY-this._pointA.y;this._pointA.x=p.clientX,this._pointA.y=p.clientY,this.onTouch(this._pointA,C,c)}else if(this._pointA&&this._pointB){const C=this._pointA.pointerId===p.pointerId?this._pointA:this._pointB;C.x=p.clientX,C.y=p.clientY;const c=this._pointA.x-this._pointB.x,d=this._pointA.y-this._pointB.y,V=c*c+d*d,R={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:p.pointerId,type:P.type};this.onMultiTouch(this._pointA,this._pointB,b,V,X,R),X=R,b=V}}else{try{null===k||void 0===k||k.releasePointerCapture(p.pointerId)}catch(Z){}j||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==p.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==p.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==b||X)&&(this.onMultiTouch(this._pointA,this._pointB,b,0,X,null),b=0,X=null),this._currentMousePointerIdDown=-1,this.onButtonUp(p),C||p.preventDefault()}else{try{null===k||void 0===k||k.setPointerCapture(p.pointerId)}catch(Z){}if(null===this._pointA)this._pointA={x:p.clientX,y:p.clientY,pointerId:p.pointerId,type:p.pointerType};else{if(null!==this._pointB)return;this._pointB={x:p.clientX,y:p.clientY,pointerId:p.pointerId,type:p.pointerType}}-1!==this._currentMousePointerIdDown||j||(this._currentMousePointerIdDown=p.pointerId),this.onButtonDown(p),C||(p.preventDefault(),d&&d.focus())}}},this._observer=this.camera.NC()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE|g.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,b=0,X=null,this.onLostFocus()},this._contextMenuBind=C=>this.onContextMenu(C),d&&d.addEventListener("contextmenu",this._contextMenuBind,!1);const P=this.camera.NC().getEngine().getHostWindow();P&&W.Tools.RegisterTopRootEvents(P,[{name:"blur",handler:this._onLostFocus}])}gU(){if(this._onLostFocus){const C=this.camera.NC().getEngine().getHostWindow();C&&W.Tools.UnregisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.NC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const C=this.camera.NC().getEngine().getInputElement();C&&C.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(C){}onTouch(C,c,d){}onMultiTouch(C,c,d,b,X,P){}onContextMenu(C){C.preventDefault()}onButtonDown(C){}onButtonUp(C){}onLostFocus(){}}(0,b.e)([(0,X.P)()],E.prototype,"buttons",void 0);class N extends E{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(C,c){if(0!==this.panningSensibility&&C&&c){const d=c.x-C.x,b=c.y-C.y;this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility}}_computePinchZoom(C,c){const d=this.camera.radius||N.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=d*Math.sqrt(C)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-C)*d*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-C)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(C,c,d){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=d/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(C,c,d,b,X,P){0===d&&null===X||0===b&&null===P||(this.multiTouchPanAndZoom?(this._computePinchZoom(d,b),this._computeMultiTouchPanning(X,P)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(b)-Math.sqrt(d))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(d,b),this._isPinching=!0):this._computeMultiTouchPanning(X,P)):this.multiTouchPanning?this._computeMultiTouchPanning(X,P):this.pinchZoom&&this._computePinchZoom(d,b))}onButtonDown(C){this._isPanClick=C.button===this.camera._panningMouseButton}onButtonUp(C){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}N.MinimumRadiusForPinch=.001,(0,b.e)([(0,X.P)()],N.prototype,"buttons",void 0),(0,b.e)([(0,X.P)()],N.prototype,"angularSensibilityX",void 0),(0,b.e)([(0,X.P)()],N.prototype,"angularSensibilityY",void 0),(0,b.e)([(0,X.P)()],N.prototype,"pinchPrecision",void 0),(0,b.e)([(0,X.P)()],N.prototype,"pinchDeltaPercentage",void 0),(0,b.e)([(0,X.P)()],N.prototype,"useNaturalPinchZoom",void 0),(0,b.e)([(0,X.P)()],N.prototype,"pinchZoom",void 0),(0,b.e)([(0,X.P)()],N.prototype,"panningSensibility",void 0),(0,b.e)([(0,X.P)()],N.prototype,"multiTouchPanning",void 0),(0,b.e)([(0,X.P)()],N.prototype,"multiTouchPanAndZoom",void 0),n.e.ArcRotateCameraPointersInput=N;var r=d(12679);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(C){C=W.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.NC(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const d=c.event;if(!d.metaKey)if(c.type===r.d.KEYDOWN){if(this._ctrlPressed=d.ctrlKey,this._altPressed=d.altKey,-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysReset.indexOf(d.keyCode)){-1===this._keys.indexOf(d.keyCode)&&this._keys.push(d.keyCode),d.preventDefault&&(C||d.preventDefault())}}else if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysReset.indexOf(d.keyCode)){const c=this._keys.indexOf(d.keyCode);c>=0&&this._keys.splice(c,1),d.preventDefault&&(C||d.preventDefault())}})))}gU(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const C=this.camera;for(let c=0;c<this._keys.length;c++){const d=this._keys[c];-1!==this.keysLeft.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningX-=1/this.panningSensibility:C.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?C.inertialRadiusOffset+=1/this.zoomingSensibility:C.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningX+=1/this.panningSensibility:C.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?C.inertialRadiusOffset-=1/this.zoomingSensibility:C.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(d)&&C.useInputToRestoreState&&C.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,b.e)([(0,X.P)()],M.prototype,"keysUp",void 0),(0,b.e)([(0,X.P)()],M.prototype,"keysDown",void 0),(0,b.e)([(0,X.P)()],M.prototype,"keysLeft",void 0),(0,b.e)([(0,X.P)()],M.prototype,"keysRight",void 0),(0,b.e)([(0,X.P)()],M.prototype,"keysReset",void 0),(0,b.e)([(0,X.P)()],M.prototype,"panningSensibility",void 0),(0,b.e)([(0,X.P)()],M.prototype,"zoomingSensibility",void 0),(0,b.e)([(0,X.P)()],M.prototype,"useAltToZoom",void 0),(0,b.e)([(0,X.P)()],M.prototype,"angularSpeed",void 0),n.e.ArcRotateCameraKeyboardMoveInput=M;var K=d(12442),i=d(12688);class h{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new V.dd(0,0,0),this._globalOffset=new V.dd(0,0,0),this._inertialPanning=V.dd.Zero()}_computeDeltaFromMouseWheelLegacyEvent(C,c){let d=0;const b=.01*C*this.wheelDeltaPercentage*c;return d=C>0?b/(1+this.wheelDeltaPercentage):b*(1+this.wheelDeltaPercentage),d}attachControl(C){C=W.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==g.c.POINTERWHEEL)return;const d=c.event;let b=0;const X=d.deltaMode===i.b.DOM_DELTA_LINE?40:1,P=-d.deltaY*X;if(this.customComputeDeltaFromMouseWheel)b=this.customComputeDeltaFromMouseWheel(P,this,d);else if(this.wheelDeltaPercentage){if(b=this._computeDeltaFromMouseWheelLegacyEvent(P,this.camera.radius),b>0){let C=this.camera.radius,c=this.camera.inertialRadiusOffset+b;for(let d=0;d<20&&!(C<=c)&&!(Math.abs(c*this.camera.inertia)<.001);d++)C-=c,c*=this.camera.inertia;C=(0,R.Clamp)(C,0,Number.MAX_VALUE),b=this._computeDeltaFromMouseWheelLegacyEvent(P,C)}}else b=P/(40*this.wheelPrecision);b&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(b)):this.camera.inertialRadiusOffset+=b),d.preventDefault&&(C||d.preventDefault())},this._observer=this.camera.NC()._inputManager._addCameraPointerObserver(this._wheel,g.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Hc(0)}gU(){this._observer&&(this.camera.NC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const C=this.camera;0+C.inertialAlphaOffset+C.inertialBetaOffset+C.inertialRadiusOffset&&(this._updateHitPlane(),C.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(C.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const C=this.camera,c=C.target.Xd(C.position);this._hitPlane=K.c.FromPositionAndNormal(C.target,c)}_getPosition(){const C=this.camera,c=C.NC(),d=c.createPickingRay(c.pointerX,c.pointerY,V.Matrix.Identity(),C,!1);0===C.targetScreenOffset.x&&0===C.targetScreenOffset.y||(this._viewOffset.set(C.targetScreenOffset.x,C.targetScreenOffset.y,0),C.getViewMatrix().invertToRef(C._cameraTransformMatrix),this._globalOffset=V.dd.TransformNormal(this._viewOffset,C._cameraTransformMatrix),d.origin.addInPlace(this._globalOffset));let b=0;return this._hitPlane&&(b=d.intersectsPlane(this._hitPlane)??0),d.origin.addInPlace(d.direction.scaleInPlace(b))}_zoomToMouse(C){const c=this.camera,d=1-c.inertia;if(c.lowerRadiusLimit){const b=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+C)/d<b&&(C=(c.radius-b)*d-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const b=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+C)/d>b&&(C=(c.radius-b)*d-c.inertialRadiusOffset)}const b=C/d/c.radius,X=this._getPosition(),P=V.TmpVectors.dd[6];X.subtractToRef(c.target,P),P.scaleInPlace(b),P.scaleInPlace(d),this._inertialPanning.addInPlace(P),c.inertialRadiusOffset+=C}_zeroIfClose(C){Math.abs(C.x)<Z.d&&(C.x=0),Math.abs(C.y)<Z.d&&(C.y=0),Math.abs(C.z)<Z.d&&(C.z=0)}}(0,b.e)([(0,X.P)()],h.prototype,"wheelPrecision",void 0),(0,b.e)([(0,X.P)()],h.prototype,"zoomToMouseLocation",void 0),(0,b.e)([(0,X.P)()],h.prototype,"wheelDeltaPercentage",void 0),n.e.ArcRotateCameraMouseWheelInput=h;class L extends n.g{constructor(C){super(C)}addMouseWheel(){return this.add(new h),this}addPointers(){return this.add(new N),this}addKeyboard(){return this.add(new M),this}}var f=d(12345);function T(C,c){return isNaN(C)?c:C}p.e.AddNodeConstructor("ArcRotateCamera",((C,c)=>()=>new z(C,0,0,1,V.dd.Zero(),c)));class z extends e.b{get target(){return this._target}set target(C){this.setTarget(C)}get targetHost(){return this._targetHost}set targetHost(C){C&&this.setTarget(C)}getTarget(){return this.target}get position(){return this._position}set position(C){this.setPosition(C)}set upVector(C){this._upToYMatrix||(this._yToUpMatrix=new V.Matrix,this._upToYMatrix=new V.Matrix,this._upVector=V.dd.Zero()),C.normalize(),this._upVector.V(C),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){V.Matrix.RotationAlignToRef(V.dd.UpReadOnly,this._upVector,this._yToUpMatrix),V.Matrix.RotationAlignToRef(this._upVector,V.dd.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const C=this.inputs.attached.pointers;return C?C.angularSensibilityX:0}set angularSensibilityX(C){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=C)}get angularSensibilityY(){const C=this.inputs.attached.pointers;return C?C.angularSensibilityY:0}set angularSensibilityY(C){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=C)}get pinchPrecision(){const C=this.inputs.attached.pointers;return C?C.pinchPrecision:0}set pinchPrecision(C){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=C)}get pinchDeltaPercentage(){const C=this.inputs.attached.pointers;return C?C.pinchDeltaPercentage:0}set pinchDeltaPercentage(C){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=C)}get useNaturalPinchZoom(){const C=this.inputs.attached.pointers;return!!C&&C.useNaturalPinchZoom}set useNaturalPinchZoom(C){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=C)}get panningSensibility(){const C=this.inputs.attached.pointers;return C?C.panningSensibility:0}set panningSensibility(C){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=C)}get keysUp(){const C=this.inputs.attached.keyboard;return C?C.keysUp:[]}set keysUp(C){const c=this.inputs.attached.keyboard;c&&(c.keysUp=C)}get keysDown(){const C=this.inputs.attached.keyboard;return C?C.keysDown:[]}set keysDown(C){const c=this.inputs.attached.keyboard;c&&(c.keysDown=C)}get keysLeft(){const C=this.inputs.attached.keyboard;return C?C.keysLeft:[]}set keysLeft(C){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=C)}get keysRight(){const C=this.inputs.attached.keyboard;return C?C.keysRight:[]}set keysRight(C){const c=this.inputs.attached.keyboard;c&&(c.keysRight=C)}get wheelPrecision(){const C=this.inputs.attached.mousewheel;return C?C.wheelPrecision:0}set wheelPrecision(C){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=C)}get zoomToMouseLocation(){const C=this.inputs.attached.mousewheel;return!!C&&C.zoomToMouseLocation}set zoomToMouseLocation(C){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=C)}get wheelDeltaPercentage(){const C=this.inputs.attached.mousewheel;return C?C.wheelDeltaPercentage:0}set wheelDeltaPercentage(C){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=C)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(C){C!==this.useBouncingBehavior&&(C?(this._bouncingBehavior=new q,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(C){C!==this.useFramingBehavior&&(C?(this._framingBehavior=new B,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(C){C!==this.useAutoRotationBehavior&&(C?(this._autoRotationBehavior=new U,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(C,c,d,b,X,R){var p;let j=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(C,V.dd.Zero(),R,j),p=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=V.dd.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=V.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new V.Matrix,this.panningAxis=new V.dd(1,1,0),this._transformedDirection=new V.dd,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new P.b,this.checkCollisions=!1,this.collisionRadius=new V.dd(.5,.5,.5),this._previousPosition=V.dd.Zero(),this._collisionVelocity=V.dd.Zero(),this._newPosition=V.dd.Zero(),this._computationVector=V.dd.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new V.dd(NaN,NaN,NaN),this._goalTargetScreenOffset=new V.Vector2(NaN,NaN),this._onCollisionPositionChange=function(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d?(p.setPosition(c),p.oA&&p.oA(d)):p._previousPosition.V(p._position);const b=Math.cos(p.alpha),X=Math.sin(p.alpha),P=Math.cos(p.beta);let V=Math.sin(p.beta);0===V&&(V=1e-4);const R=p._getTargetPosition();p._computationVector.yc(p.radius*b*V,p.radius*P,p.radius*X*V),R.addToRef(p._computationVector,p._newPosition),p._position.V(p._newPosition);let j=p.upVector;p.allowUpsideDown&&p.beta<0&&(j=j.clone(),j=j.negate()),p._computeViewMatrix(p._position,R,j),p._viewMatrix.addAtIndex(12,p.targetScreenOffset.x),p._viewMatrix.addAtIndex(13,p.targetScreenOffset.y),p._collisionTriggered=!1},this._target=V.dd.Zero(),X&&this.setTarget(X),this.alpha=c,this.beta=d,this.radius=b,this.getViewMatrix(),this.inputs=new L(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new V.dd(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=V.Vector2.Zero()}_updateCache(C){C||super._updateCache(),this._cache._target.V(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.V(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const C=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?C.addToRef(this._targetBoundingCenter,this._target):this._target.V(C)}const C=this._getLockedTargetPosition();return C||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,P=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=P?this._currentInterpolationFactor=P:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=T(C,this._goalAlpha),this._goalBeta=T(c,this._goalBeta),this._goalRadius=T(d,this._goalRadius),this._goalTarget.set(T(b.x,this._goalTarget.x),T(b.y,this._goalTarget.y),T(b.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(T(X.x,this._goalTargetScreenOffset.x),T(X.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,R.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,R.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,R.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,R.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(C,c){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const X=arguments;c=W.Tools.BackCompatCameraNoPreventDefault(X),this._useCtrlForPanning=d,this._panningMouseButton=b,"boolean"===typeof X[0]&&(X.length>1&&(this._useCtrlForPanning=X[1]),X.length>2&&(this._panningMouseButton=X[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}gU(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let C=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){C=!0;const c=this.invertRotation?-1:1,d=this._calculateHandednessMultiplier();let b=this.inertialAlphaOffset*d;this.beta<0&&(b*=-1),this.alpha+=b*c,this.beta+=this.inertialBetaOffset*c,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){C=!0;const c=new V.dd(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.multiplyInPlace(this.panningAxis),V.dd.TransformNormalToRef(c,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const C=this.upVector,c=V.dd.CrossToRef(this._transformedDirection,C,this._transformedDirection);V.dd.CrossToRef(C,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);V.dd.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.V(this._transformedDirection)}else{if(this.parent){const C=V.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(C),C.transposeToRef(C),V.dd.TransformCoordinatesToRef(this._transformedDirection,C,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.d&&(this.inertialPanningY=0)}if(C)this.stopInterpolation();else if(this._isInterpolating){let C=!1;const c=this._scene.getEngine().getDeltaTime()/1e3,d=1-Math.pow(2,-c/this._currentInterpolationFactor),b=T(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const c=V.TmpVectors.dd[0].set(T(this._goalTarget.x,this._target.x),T(this._goalTarget.y,this._target.y),T(this._goalTarget.z,this._target.z));V.dd.LerpToRef(this.target,c,d,this._target),10*V.dd.Distance(this.target,c)/b<Z.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.V(c),this.setTarget(this.target,!1,!0,!0)):C=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const c=V.Quaternion.RotationAlphaBetaGammaToRef(T(this._goalAlpha,this.alpha),T(this._goalBeta,this.beta),0,V.TmpVectors.Quaternion[0]),b=V.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,V.TmpVectors.Quaternion[1]),X=V.Quaternion.SlerpToRef(b,c,d,V.TmpVectors.Quaternion[2]);X.normalize();const P=X.toAlphaBetaGammaToRef(V.TmpVectors.dd[0]);if(this.alpha=P.x,this.beta=P.y,X.isApprox(c,Z.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const C=c.toAlphaBetaGammaToRef(V.TmpVectors.dd[0]);this.alpha=C.x,this.beta=C.y}else C=!0}if(isNaN(this._goalRadius)||(this.radius+=(b-this.radius)*d,Math.abs(b/this.radius-1)<Z.d?(this._goalRadius=NaN,this.radius=b):C=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const c=V.TmpVectors.Vector2[0].set(T(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),T(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));V.Vector2.LerpToRef(this.targetScreenOffset,c,d,this.targetScreenOffset),V.Vector2.Distance(this.targetScreenOffset,c)<Z.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.V(c)):C=!0}this._isInterpolating=C}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||V.dd.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const C=this.alpha;var c,d;this.alpha=function(C){let c=Math.PI/2;return 0===C.x&&0===C.z||(c=Math.acos(C.x/Math.sqrt(Math.pow(C.x,2)+Math.pow(C.z,2)))),C.z<0&&(c=2*Math.PI-c),c}(this._computationVector),this.beta=(c=this._computationVector.y,d=this.radius,Math.acos(c/d));const b=Math.round((C-this.alpha)/(2*Math.PI));this.alpha+=2*b*Math.PI,this._checkLimits()}setPosition(C){this._position.equals(C)||(this._position.V(C),this.rebuildAnglesAndRadius())}setTarget(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(b=this.overrideCloneAlphaBetaRadius??b,C.Tc)c&&C.getBoundingInfo?this._targetBoundingCenter=C.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,C.Tc(),this._targetHost=C,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=C,b=this._getTargetPosition();if(b&&!d&&b.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}b||this.rebuildAnglesAndRadius()}_getViewMatrix(){const C=Math.cos(this.alpha),c=Math.sin(this.alpha),d=Math.cos(this.beta);let b=Math.sin(this.beta);0===b&&(b=1e-4),0===this.radius&&(this.radius=1e-4);const X=this._getTargetPosition();if(this._computationVector.yc(this.radius*C*b,this.radius*d,this.radius*c*b),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||V.dd.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),X.addToRef(this._computationVector,this._newPosition),this.NC().collisionsEnabled&&this.checkCollisions){const C=this.NC().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,C.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.V(this._newPosition);let C=this.upVector;this.allowUpsideDown&&b<0&&(C=C.negate()),this._computeViewMatrix(this._position,X,C),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.V(X),this._viewMatrix}zoomOn(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];C=C||this.NC().meshes;const d=j.b.MinMax(C);let b=this._calculateLowerRadiusFromModelBoundingSphere(d.min,d.max);if(b=Math.max(Math.min(b,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=b*this.zoomOnFactor,this.mode===t.d.ORTHOGRAPHIC_CAMERA){const C=this.NC().getEngine().getAspectRatio(this),c=b*this.zoomOnFactor/2;this.orthoLeft=-c*C,this.orthoRight=c*C,this.orthoBottom=-c,this.orthoTop=c}this.focusOn({min:d.min,max:d.max,distance:b},c)}focusOn(C){let c,d,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===C.min){const b=C||this.NC().meshes;c=j.b.MinMax(b),d=V.dd.Distance(c.min,c.max)}else{c=C,d=C.distance}this._target=j.b.Center(c),b||(this.maxZ=2*d)}createRigCamera(C,c){let d=0;switch(this.cameraRigMode){case t.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.d.RIG_MODE_VR:d=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case t.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:d=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const b=new z(C,this.alpha+d,this.beta,this.radius,this._target,this.NC());return b._cameraRigParams={},b.isRigCamera=!0,b.rigParent=this,b.upVector=this.upVector,b.mode=this.mode,b.orthoLeft=this.orthoLeft,b.orthoRight=this.orthoRight,b.orthoBottom=this.orthoBottom,b.orthoTop=this.orthoTop,b}_updateRigCameras(){const C=this._rigCameras[0],c=this._rigCameras[1];switch(C.beta=c.beta=this.beta,this.cameraRigMode){case t.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.d.RIG_MODE_VR:C.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case t.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const b=V.dd.Distance(C,c),X=this.NC().getEngine().getAspectRatio(this),P=Math.tan(this.fov/2),R=P*X,p=.5*b*d,j=p*Math.sqrt(1+1/(R*R)),g=p*Math.sqrt(1+1/(P*P));return Math.max(j,g)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,b.e)([(0,X.P)()],z.prototype,"alpha",void 0),(0,b.e)([(0,X.P)()],z.prototype,"beta",void 0),(0,b.e)([(0,X.P)()],z.prototype,"radius",void 0),(0,b.e)([(0,X.P)()],z.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,b.e)([(0,X.L)("target")],z.prototype,"_target",void 0),(0,b.e)([(0,X.A)("targetHost")],z.prototype,"_targetHost",void 0),(0,b.e)([(0,X.P)()],z.prototype,"inertialAlphaOffset",void 0),(0,b.e)([(0,X.P)()],z.prototype,"inertialBetaOffset",void 0),(0,b.e)([(0,X.P)()],z.prototype,"inertialRadiusOffset",void 0),(0,b.e)([(0,X.P)()],z.prototype,"lowerAlphaLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"upperAlphaLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"lowerBetaLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"upperBetaLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"lowerRadiusLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"upperRadiusLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"lowerTargetYLimit",void 0),(0,b.e)([(0,X.P)()],z.prototype,"inertialPanningX",void 0),(0,b.e)([(0,X.P)()],z.prototype,"inertialPanningY",void 0),(0,b.e)([(0,X.P)()],z.prototype,"pinchToPanMaxDistance",void 0),(0,b.e)([(0,X.P)()],z.prototype,"panningDistanceLimit",void 0),(0,b.e)([(0,X.L)()],z.prototype,"panningOriginTarget",void 0),(0,b.e)([(0,X.P)()],z.prototype,"panningInertia",void 0),(0,b.e)([(0,X.P)()],z.prototype,"zoomToMouseLocation",null),(0,b.e)([(0,X.P)()],z.prototype,"zoomOnFactor",void 0),(0,b.e)([(0,X.I)()],z.prototype,"targetScreenOffset",void 0),(0,b.e)([(0,X.P)()],z.prototype,"allowUpsideDown",void 0),(0,b.e)([(0,X.P)()],z.prototype,"useInputToRestoreState",void 0),(0,b.e)([(0,X.P)()],z.prototype,"restoreStateInterpolationFactor",void 0),(0,f.e)("BABYLON.ArcRotateCamera",z)},14047:(C,c,d)=>{"use strict";d.d(c,{e:()=>V,g:()=>R});var b=d(12233),X=d(12431),P=d(12857),V={};class R{constructor(C){this.attachedToElement=!1,this.attached={},this.camera=C,this.checkInputs=()=>{}}add(C){const c=C.getSimpleName();this.attached[c]?b.d.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=C,C.camera=this.camera,C.checkInputs&&(this.checkInputs=this._addCheckInputs(C.checkInputs.bind(C))),this.attachedToElement&&C.attachControl(this.noPreventDefault))}remove(C){for(const c in this.attached){const d=this.attached[c];if(d===C)return d.gU(),d.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(C){for(const c in this.attached){const d=this.attached[c];d.getClassName()===C&&(d.gU(),d.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(C){const c=this.checkInputs;return()=>{c(),C()}}attachInput(C){this.attachedToElement&&C.attachControl(this.noPreventDefault)}attachElement(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){C=!P.d.ForceAttachControlToAlwaysPreventDefault&&C,this.attachedToElement=!0,this.noPreventDefault=C;for(const c in this.attached)this.attached[c].attachControl(C)}}detachElement(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].gU(),C&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const C in this.attached){const c=this.attached[C];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(C){const c={};for(const d in this.attached){const C=this.attached[d],b=X.e.Serialize(C);c[C.getClassName()]=b}C.inputsmgr=c}parse(C){const c=C.inputsmgr;if(c){this.clear();for(const C in c){const d=V[C];if(d){const b=c[C],P=X.e.Parse((()=>new d),b,null);this.add(P)}}}else for(const d in this.attached){const c=V[this.attached[d].getClassName()];if(c){const b=X.e.Parse((()=>new c),C,null);this.remove(this.attached[d]),this.add(b)}}}}},14040:(C,c,d)=>{"use strict";d.d(c,{c:()=>E});var b=d(12384),X=d(12388),P=d(12403),V=d(12891),R=d(14047),p=d(12679),j=d(12219);class g{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(C){C=j.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.NC(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const d=c.event;if(!d.metaKey)if(c.type===p.d.KEYDOWN){if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysUpward.indexOf(d.keyCode)||-1!==this.keysDownward.indexOf(d.keyCode)||-1!==this.keysRotateLeft.indexOf(d.keyCode)||-1!==this.keysRotateRight.indexOf(d.keyCode)||-1!==this.keysRotateUp.indexOf(d.keyCode)||-1!==this.keysRotateDown.indexOf(d.keyCode)){-1===this._keys.indexOf(d.keyCode)&&this._keys.push(d.keyCode),C||d.preventDefault()}}else if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysUpward.indexOf(d.keyCode)||-1!==this.keysDownward.indexOf(d.keyCode)||-1!==this.keysRotateLeft.indexOf(d.keyCode)||-1!==this.keysRotateRight.indexOf(d.keyCode)||-1!==this.keysRotateUp.indexOf(d.keyCode)||-1!==this.keysRotateDown.indexOf(d.keyCode)){const c=this._keys.indexOf(d.keyCode);c>=0&&this._keys.splice(c,1),C||d.preventDefault()}})))}gU(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const C=this.camera;for(let c=0;c<this._keys.length;c++){const d=this._keys[c],b=C._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(d)?C._localDirection.yc(-b,0,0):-1!==this.keysUp.indexOf(d)?C._localDirection.yc(0,0,b):-1!==this.keysRight.indexOf(d)?C._localDirection.yc(b,0,0):-1!==this.keysDown.indexOf(d)?C._localDirection.yc(0,0,-b):-1!==this.keysUpward.indexOf(d)?C._localDirection.yc(0,b,0):-1!==this.keysDownward.indexOf(d)?C._localDirection.yc(0,-b,0):-1!==this.keysRotateLeft.indexOf(d)?(C._localDirection.yc(0,0,0),C.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(d)?(C._localDirection.yc(0,0,0),C.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(d)?(C._localDirection.yc(0,0,0),C.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(d)&&(C._localDirection.yc(0,0,0),C.cameraRotation.x+=this._getLocalRotation()),C.NC().useRightHandedSystem&&(C._localDirection.z*=-1),C.getViewMatrix().invertToRef(C._cameraTransformMatrix),P.dd.TransformNormalToRef(C._localDirection,C._cameraTransformMatrix,C._transformedDirection),C.cameraDirection.addInPlace(C._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const C=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*C}}(0,b.e)([(0,X.P)()],g.prototype,"keysUp",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysUpward",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysDown",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysDownward",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysLeft",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysRight",void 0),(0,b.e)([(0,X.P)()],g.prototype,"rotationSpeed",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysRotateLeft",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysRotateRight",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysRotateUp",void 0),(0,b.e)([(0,X.P)()],g.prototype,"keysRotateDown",void 0),R.e.FreeCameraKeyboardMoveInput=g;var k=d(12221),Z=d(12676);class U{constructor(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=C,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new k.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(C){C=j.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),d=c.getInputElement();this._pointerInput||(this._pointerInput=b=>{const X=b.event,P="touch"===X.pointerType;if(!this.touchEnabled&&P)return;if(b.type!==Z.c.POINTERMOVE&&-1===this.buttons.indexOf(X.button))return;const V=X.target;if(b.type===Z.c.POINTERDOWN){if(P&&-1!==this._activePointerId||!P&&-1!==this._currentActiveButton)return;this._activePointerId=X.pointerId;try{null===V||void 0===V||V.setPointerCapture(X.pointerId)}catch(R){}-1===this._currentActiveButton&&(this._currentActiveButton=X.button),this._previousPosition={x:X.clientX,y:X.clientY},C||(X.preventDefault(),d&&d.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(b.event)}else if(b.type===Z.c.POINTERUP){if(P&&this._activePointerId!==X.pointerId||!P&&this._currentActiveButton!==X.button)return;try{null===V||void 0===V||V.releasePointerCapture(X.pointerId)}catch(R){}this._currentActiveButton=-1,this._previousPosition=null,C||X.preventDefault(),this._activePointerId=-1}else if(b.type===Z.c.POINTERMOVE&&(this._activePointerId===X.pointerId||!P))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(b.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),d=(X.clientX-this._previousPosition.x)*c,b=X.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=d/this.angularSensibility,this.camera.cameraRotation.x+=b/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:d,offsetY:b}),this._previousPosition={x:X.clientX,y:X.clientY},C||X.preventDefault()}}),this._onMouseMove=d=>{if(!c.isPointerLock)return;const b=this.camera._calculateHandednessMultiplier(),X=d.movementX*b;this.camera.cameraRotation.y+=X/this.angularSensibility;const P=d.movementY;this.camera.cameraRotation.x+=P/this.angularSensibility,this._previousPosition=null,C||d.preventDefault()},this._observer=this.camera.NC()._inputManager._addCameraPointerObserver(this._pointerInput,Z.c.POINTERDOWN|Z.c.POINTERUP|Z.c.POINTERMOVE),d&&(this._contextMenuBind=C=>this.onContextMenu(C),d.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(C){C.preventDefault()}gU(){if(this._observer){if(this.camera.NC()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const C=this.camera.getEngine().getInputElement();C&&C.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,b.e)([(0,X.P)()],U.prototype,"buttons",void 0),(0,b.e)([(0,X.P)()],U.prototype,"angularSensibility",void 0),R.e.FreeCameraMouseInput=U;var A,u=d(12688);class q{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new k.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(C){C=j.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==Z.c.POINTERWHEEL)return;const d=c.event,b=d.deltaMode===u.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*b*d.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*b*d.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*b*d.deltaZ/this._normalize,d.preventDefault&&(C||d.preventDefault())},this._observer=this.camera.NC()._inputManager._addCameraPointerObserver(this._wheel,Z.c.POINTERWHEEL)}gU(){this._observer&&(this.camera.NC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,b.e)([(0,X.P)()],q.prototype,"wheelPrecisionX",void 0),(0,b.e)([(0,X.P)()],q.prototype,"wheelPrecisionY",void 0),(0,b.e)([(0,X.P)()],q.prototype,"wheelPrecisionZ",void 0),function(C){C[C.MoveRelative=0]="MoveRelative",C[C.RotateRelative=1]="RotateRelative",C[C.MoveScene=2]="MoveScene"}(A||(A={}));class B extends q{constructor(){super(...arguments),this._moveRelative=P.dd.Zero(),this._rotateRelative=P.dd.Zero(),this._moveScene=P.dd.Zero(),this._wheelXAction=A.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=A.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(C){null===C&&this._wheelXAction!==A.MoveRelative||(this._wheelXAction=A.MoveRelative,this._wheelXActionCoordinate=C)}get wheelXMoveRelative(){return this._wheelXAction!==A.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(C){null===C&&this._wheelYAction!==A.MoveRelative||(this._wheelYAction=A.MoveRelative,this._wheelYActionCoordinate=C)}get wheelYMoveRelative(){return this._wheelYAction!==A.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(C){null===C&&this._wheelZAction!==A.MoveRelative||(this._wheelZAction=A.MoveRelative,this._wheelZActionCoordinate=C)}get wheelZMoveRelative(){return this._wheelZAction!==A.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(C){null===C&&this._wheelXAction!==A.RotateRelative||(this._wheelXAction=A.RotateRelative,this._wheelXActionCoordinate=C)}get wheelXRotateRelative(){return this._wheelXAction!==A.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(C){null===C&&this._wheelYAction!==A.RotateRelative||(this._wheelYAction=A.RotateRelative,this._wheelYActionCoordinate=C)}get wheelYRotateRelative(){return this._wheelYAction!==A.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(C){null===C&&this._wheelZAction!==A.RotateRelative||(this._wheelZAction=A.RotateRelative,this._wheelZActionCoordinate=C)}get wheelZRotateRelative(){return this._wheelZAction!==A.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(C){null===C&&this._wheelXAction!==A.MoveScene||(this._wheelXAction=A.MoveScene,this._wheelXActionCoordinate=C)}get wheelXMoveScene(){return this._wheelXAction!==A.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(C){null===C&&this._wheelYAction!==A.MoveScene||(this._wheelYAction=A.MoveScene,this._wheelYActionCoordinate=C)}get wheelYMoveScene(){return this._wheelYAction!==A.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(C){null===C&&this._wheelZAction!==A.MoveScene||(this._wheelZAction=A.MoveScene,this._wheelZActionCoordinate=C)}get wheelZMoveScene(){return this._wheelZAction!==A.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Hc(0),this._rotateRelative.Hc(0),this._moveScene.Hc(0),this._updateCamera(),this.camera.NC().useRightHandedSystem&&(this._moveRelative.z*=-1);const C=P.Matrix.Zero();this.camera.getViewMatrix().invertToRef(C);const c=P.dd.Zero();P.dd.TransformNormalToRef(this._moveRelative,C,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(C,c,d){if(0===C)return;if(null===c||null===d)return;let b=null;switch(c){case A.MoveRelative:b=this._moveRelative;break;case A.RotateRelative:b=this._rotateRelative;break;case A.MoveScene:b=this._moveScene}switch(d){case 0:b.set(C,0,0);break;case 1:b.set(0,C,0);break;case 2:b.set(0,0,C)}}}(0,b.e)([(0,X.P)()],B.prototype,"wheelXMoveRelative",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelYMoveRelative",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelZMoveRelative",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelXRotateRelative",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelYRotateRelative",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelZRotateRelative",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelXMoveScene",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelYMoveScene",null),(0,b.e)([(0,X.P)()],B.prototype,"wheelZMoveScene",null),R.e.FreeCameraMouseWheelInput=B;class t{constructor(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=C,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=j.Tools.IsSafari()}attachControl(C){C=j.Tools.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=d=>{const b=d.event,X="mouse"===b.pointerType||this._isSafari&&"undefined"===typeof b.pointerType;if(this.allowMouse||!X)if(d.type===Z.c.POINTERDOWN){if(C||b.preventDefault(),this._pointerPressed.push(b.pointerId),1!==this._pointerPressed.length)return;c={x:b.clientX,y:b.clientY}}else if(d.type===Z.c.POINTERUP){C||b.preventDefault();const d=this._pointerPressed.indexOf(b.pointerId);if(-1===d)return;if(this._pointerPressed.splice(d,1),0!=d)return;c=null,this._offsetX=null,this._offsetY=null}else if(d.type===Z.c.POINTERMOVE){if(C||b.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(b.pointerId))return;this._offsetX=b.clientX-c.x,this._offsetY=-(b.clientY-c.y)}}),this._observer=this.camera.NC()._inputManager._addCameraPointerObserver(this._pointerInput,Z.c.POINTERDOWN|Z.c.POINTERUP|Z.c.POINTERMOVE),this._onLostFocus){const C=this.camera.getEngine().getInputElement();C&&C.addEventListener("blur",this._onLostFocus)}}gU(){if(this._pointerInput){if(this._observer&&(this.camera.NC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const C=this.camera.getEngine().getInputElement();C&&C.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const C=this.camera,c=C._calculateHandednessMultiplier();C.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)C.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=C._computeLocalCameraSpeed(),d=new P.dd(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);P.Matrix.RotationYawPitchRollToRef(C.rotation.y,C.rotation.x,0,C._cameraRotationMatrix),C.cameraDirection.addInPlace(P.dd.TransformCoordinates(d,C._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,b.e)([(0,X.P)()],t.prototype,"touchAngularSensibility",void 0),(0,b.e)([(0,X.P)()],t.prototype,"touchMoveSensibility",void 0),R.e.FreeCameraTouchInput=t;class e extends R.g{constructor(C){super(C),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new g),this}addMouse(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new U(C),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new t),this}clear(){super.clear(),this._mouseInput=null}}var n=d(12345),W=d(12283);class E extends V.b{get angularSensibility(){const C=this.inputs.attached.mouse;return C?C.angularSensibility:0}set angularSensibility(C){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=C)}get keysUp(){const C=this.inputs.attached.keyboard;return C?C.keysUp:[]}set keysUp(C){const c=this.inputs.attached.keyboard;c&&(c.keysUp=C)}get keysUpward(){const C=this.inputs.attached.keyboard;return C?C.keysUpward:[]}set keysUpward(C){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=C)}get keysDown(){const C=this.inputs.attached.keyboard;return C?C.keysDown:[]}set keysDown(C){const c=this.inputs.attached.keyboard;c&&(c.keysDown=C)}get keysDownward(){const C=this.inputs.attached.keyboard;return C?C.keysDownward:[]}set keysDownward(C){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=C)}get keysLeft(){const C=this.inputs.attached.keyboard;return C?C.keysLeft:[]}set keysLeft(C){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=C)}get keysRight(){const C=this.inputs.attached.keyboard;return C?C.keysRight:[]}set keysRight(C){const c=this.inputs.attached.keyboard;c&&(c.keysRight=C)}get keysRotateLeft(){const C=this.inputs.attached.keyboard;return C?C.keysRotateLeft:[]}set keysRotateLeft(C){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=C)}get keysRotateRight(){const C=this.inputs.attached.keyboard;return C?C.keysRotateRight:[]}set keysRotateRight(C){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=C)}get keysRotateUp(){const C=this.inputs.attached.keyboard;return C?C.keysRotateUp:[]}set keysRotateUp(C){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=C)}get keysRotateDown(){const C=this.inputs.attached.keyboard;return C?C.keysRotateDown:[]}set keysRotateDown(C){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=C)}constructor(C,c,d){var b;super(C,c,d,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),b=this,this.ellipsoid=new P.dd(.5,1,.5),this.ellipsoidOffset=new P.dd(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=P.dd.Zero(),this._diffPosition=P.dd.Zero(),this._newPosition=P.dd.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b._newPosition.V(c),b._newPosition.subtractToRef(b._oldPosition,b._diffPosition),b._diffPosition.length()>W.c.CollisionsEpsilon&&(b.position.addToRef(b._diffPosition,b._deferredPositionUpdate),b._deferOnly?b._deferredUpdated=!0:b.position.V(b._deferredPositionUpdate),b.oA&&d&&b.oA(d))},this.inputs=new e(this),this.inputs.addKeyboard().addMouse()}attachControl(C,c){c=j.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}gU(){this.inputs.detachElement(),this.cameraDirection=new P.dd(0,0,0),this.cameraRotation=new P.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(C){this._collisionMask=isNaN(C)?-1:C}_collideWithWorld(C){let c;c=this.parent?P.dd.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const d=this.NC().collisionCoordinator;this._collider||(this._collider=d.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let b=C;this.applyGravity&&(b=C.add(this.NC().gravity)),d.getNewPosition(this._oldPosition,b,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=P.dd.Zero(),this._transformedDirection=P.dd.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(C){this._needMoveForGravity=C}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.NC().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ac"}}(0,b.e)([(0,X.L)()],E.prototype,"ellipsoid",void 0),(0,b.e)([(0,X.L)()],E.prototype,"ellipsoidOffset",void 0),(0,b.e)([(0,X.P)()],E.prototype,"checkCollisions",void 0),(0,b.e)([(0,X.P)()],E.prototype,"applyGravity",void 0),(0,n.e)("BABYLON.FreeCamera",E)},14661:(C,c,d)=>{"use strict";d.d(c,{d:()=>P});var b=d(12496),X=d(14665);class P{constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=d,this.LZ=[],this._maxBlockCapacity=c||64,this._selectionContent=new b.e(1024),this._creationFunc=C}update(C,c,d){X.b._CreateBlocks(C,c,d,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Jk(C){for(let c=0;c<this.lk.length;c++){this.lk[c].addEntry(C)}}wk(C){for(let c=0;c<this.lk.length;c++){this.lk[c].removeEntry(C)}}select(C,c){this._selectionContent.reset();for(let d=0;d<this.lk.length;d++){this.lk[d].select(C,this._selectionContent,c)}return c?this._selectionContent.concat(this.LZ):this._selectionContent.concatWithNoDuplicate(this.LZ),this._selectionContent}intersects(C,c,d){this._selectionContent.reset();for(let b=0;b<this.lk.length;b++){this.lk[b].intersects(C,c,this._selectionContent,d)}return d?this._selectionContent.concat(this.LZ):this._selectionContent.concatWithNoDuplicate(this.LZ),this._selectionContent}intersectsRay(C){this._selectionContent.reset();for(let c=0;c<this.lk.length;c++){this.lk[c].intersectsRay(C,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.LZ),this._selectionContent}}P.CreationFuncForMeshes=(C,c)=>{const d=C.getBoundingInfo();!C.isBlocked&&d.boundingBox.intersectsMinMax(c.JZ,c.yZ)&&c.entries.push(C)},P.CreationFuncForSubMeshes=(C,c)=>{C.getBoundingInfo().boundingBox.intersectsMinMax(c.JZ,c.yZ)&&c.entries.push(C)}},14665:(C,c,d)=>{"use strict";d.d(c,{b:()=>P});var b=d(12403),X=d(12734);class P{constructor(C,c,d,b,X,P){this.entries=[],this.xZ=new Array,this._capacity=d,this._depth=b,this._maxDepth=X,this._creationFunc=P,this._minPoint=C,this._maxPoint=c,this.xZ.push(C.clone()),this.xZ.push(c.clone()),this.xZ.push(C.clone()),this.xZ[2].x=c.x,this.xZ.push(C.clone()),this.xZ[3].y=c.y,this.xZ.push(C.clone()),this.xZ[4].z=c.z,this.xZ.push(c.clone()),this.xZ[5].z=C.z,this.xZ.push(c.clone()),this.xZ[6].x=C.x,this.xZ.push(c.clone()),this.xZ[7].y=C.y}get wX(){return this._capacity}get JZ(){return this._minPoint}get yZ(){return this._maxPoint}addEntry(C){if(this.lk)for(let c=0;c<this.lk.length;c++){this.lk[c].addEntry(C)}else this._creationFunc(C,this),this.entries.length>this.wX&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(C){if(this.lk){for(let c=0;c<this.lk.length;c++){this.lk[c].removeEntry(C)}return}const c=this.entries.indexOf(C);c>-1&&this.entries.splice(c,1)}addEntries(C){for(let c=0;c<C.length;c++){const d=C[c];this.addEntry(d)}}select(C,c,d){if(X.e.IsInFrustum(this.xZ,C)){if(this.lk){for(let b=0;b<this.lk.length;b++){this.lk[b].select(C,c,d)}return}d?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(C,c,d,b){if(X.e.IntersectsSphere(this._minPoint,this._maxPoint,C,c)){if(this.lk){for(let X=0;X<this.lk.length;X++){this.lk[X].intersects(C,c,d,b)}return}b?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersectsRay(C,c){if(C.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.lk){for(let d=0;d<this.lk.length;d++){this.lk[d].intersectsRay(C,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){P._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(C,c,d,X,V,R,p,j){p.lk=new Array;const g=new b.dd((c.x-C.x)/2,(c.y-C.y)/2,(c.z-C.z)/2);for(let b=0;b<2;b++)for(let c=0;c<2;c++)for(let k=0;k<2;k++){const Z=C.add(g.multiplyByFloats(b,c,k)),U=C.add(g.multiplyByFloats(b+1,c+1,k+1)),A=new P(Z,U,X,V+1,R,j);A.addEntries(d),p.lk.push(A)}}}},14668:(C,c,d)=>{"use strict";d.d(c,{d:()=>g});var b=d(12637),X=d(12403),P=d(12821),V=d(13819),R=d(12670),p=d(14661),j=d(12255);b.e.prototype.createOrUpdateSelectionOctree=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,d=this._getComponent(R.d.NAME_OCTREE);d||(d=new g(this),this.gc(d)),this.iZ||(this.iZ=new p.d(p.d.CreationFuncForMeshes,C,c));const b=this.getWorldExtends();return this.iZ.update(b.min,b.max,this.meshes),this.iZ},Object.defineProperty(b.e.prototype,"selectionOctree",{get:function(){return this.iZ},enumerable:!0,configurable:!0}),P.c.prototype.createOrUpdateSubmeshesOctree=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const d=this.NC();let b=d._getComponent(R.d.NAME_OCTREE);b||(b=new g(d),d.gc(b)),this._submeshesOctree||(this._submeshesOctree=new p.d(p.d.CreationFuncForSubMeshes,C,c)),this.Tc(!0);const X=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(X.minimumWorld,X.maximumWorld,this.Nc),this._submeshesOctree};class g{constructor(C){this.name=R.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new V.d(X.dd.Zero(),new X.dd(1,1,1)),(C=C||j.c.LastCreatedScene)&&(this.Pd=C,this.Pd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Pd.getActiveSubMeshCandidates=C=>this.getActiveSubMeshCandidates(C),this.Pd.getCollidingSubMeshCandidates=(C,c)=>this.getCollidingSubMeshCandidates(C,c),this.Pd.getIntersectingSubMeshCandidates=(C,c)=>this.getIntersectingSubMeshCandidates(C,c))}register(){this.Pd.onMeshRemovedObservable.add((C=>{const c=this.Pd.selectionOctree;if(void 0!==c&&null!==c){const d=c.LZ.indexOf(C);-1!==d&&c.LZ.splice(d,1)}})),this.Pd.onMeshImportedObservable.add((C=>{const c=this.Pd.selectionOctree;void 0!==c&&null!==c&&c.Jk(C)}))}getActiveMeshCandidates(){var C;return(null===(C=this.Pd.iZ)||void 0===C?void 0:C.select(this.Pd.frustumPlanes))||this.Pd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(C){if(C._submeshesOctree&&C.useOctreeForRenderingSelection){return C._submeshesOctree.select(this.Pd.frustumPlanes)}return this.Pd._getDefaultSubMeshCandidates(C)}getIntersectingSubMeshCandidates(C,c){if(C._submeshesOctree&&C.useOctreeForPicking){V.d.TransformToRef(c,C.getWorldMatrix(),this._tempRay);return C._submeshesOctree.intersectsRay(this._tempRay)}return this.Pd._getDefaultSubMeshCandidates(C)}getCollidingSubMeshCandidates(C,c){if(C._submeshesOctree&&C.useOctreeForCollisions){const d=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return C._submeshesOctree.intersects(c._basePointWorld,d)}return this.Pd._getDefaultSubMeshCandidates(C)}rebuild(){}dispose(){}}},13819:(C,c,d)=>{"use strict";d.d(c,{d:()=>U});var b=d(12637),X=d(12857),P=d(12412),V=d(12403),R=d(12416),p=d(12724),j=d(12663),g=d(12255),k=d(12691);const Z={internalPickerForMesh:void 0};class U{constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.d;this.origin=C,this.direction=c,this.length=d,this.epsilon=b}clone(){return new U(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const b=U._TmpVector3[0].yc(C.x-d,C.y-d,C.z-d),X=U._TmpVector3[1].yc(c.x+d,c.y+d,c.z+d);let P,V,R,p,j=0,g=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<b.x||this.origin.x>X.x)return!1}else if(P=1/this.direction.x,V=(b.x-this.origin.x)*P,R=(X.x-this.origin.x)*P,R===-1/0&&(R=1/0),V>R&&(p=V,V=R,R=p),j=Math.max(V,j),g=Math.min(R,g),j>g)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<b.y||this.origin.y>X.y)return!1}else if(P=1/this.direction.y,V=(b.y-this.origin.y)*P,R=(X.y-this.origin.y)*P,R===-1/0&&(R=1/0),V>R&&(p=V,V=R,R=p),j=Math.max(V,j),g=Math.min(R,g),j>g)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<b.z||this.origin.z>X.z)return!1}else if(P=1/this.direction.z,V=(b.z-this.origin.z)*P,R=(X.z-this.origin.z)*P,R===-1/0&&(R=1/0),V>R&&(p=V,V=R,R=p),j=Math.max(V,j),g=Math.min(R,g),j>g)return!1;return!0}intersectsBox(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(C.minimum,C.maximum,c)}intersectsSphere(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=C.center.x-this.origin.x,b=C.center.y-this.origin.y,X=C.center.z-this.origin.z,P=d*d+b*b+X*X,V=C.radius+c,R=V*V;if(P<=R)return!0;const p=d*this.direction.x+b*this.direction.y+X*this.direction.z;if(p<0)return!1;return P-p*p<=R}intersectsTriangle(C,c,d){const b=U._TmpVector3[0],X=U._TmpVector3[1],P=U._TmpVector3[2],R=U._TmpVector3[3],j=U._TmpVector3[4];c.subtractToRef(C,b),d.subtractToRef(C,X),V.dd.CrossToRef(this.direction,X,P);const g=V.dd.Dot(b,P);if(0===g)return null;const k=1/g;this.origin.subtractToRef(C,R);const Z=V.dd.Dot(R,P)*k;if(Z<-this.epsilon||Z>1+this.epsilon)return null;V.dd.CrossToRef(R,b,j);const A=V.dd.Dot(this.direction,j)*k;if(A<-this.epsilon||Z+A>1+this.epsilon)return null;const u=V.dd.Dot(X,j)*k;return u>this.length?null:new p.d(1-Z-A,Z,u)}intersectsPlane(C){let c;const d=V.dd.Dot(C.normal,this.direction);if(Math.abs(d)<9.99999997475243e-7)return null;{const b=V.dd.Dot(C.normal,this.origin);return c=(-C.d-b)/d,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(C){case"y":{const C=(this.origin.y-c)/this.direction.y;return C>0?null:new V.dd(this.origin.x+this.direction.x*-C,c,this.origin.z+this.direction.z*-C)}case"x":{const C=(this.origin.x-c)/this.direction.x;return C>0?null:new V.dd(c,this.origin.y+this.direction.y*-C,this.origin.z+this.direction.z*-C)}case"z":{const C=(this.origin.z-c)/this.direction.z;return C>0?null:new V.dd(this.origin.x+this.direction.x*-C,this.origin.y+this.direction.y*-C,c)}default:return null}}intersectsMesh(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const R=V.TmpVectors.Matrix[0];return C.getWorldMatrix().invertToRef(R),this._tmpRay?U.TransformToRef(this,R,this._tmpRay):this._tmpRay=U.Transform(this,R),C.intersects(this._tmpRay,c,d,b,X,P)}intersectsMeshes(C,c,d){d?d.length=0:d=[];for(let b=0;b<C.length;b++){const X=this.intersectsMesh(C[b],c);X.hit&&d.push(X)}return d.sort(this._comparePickingInfo),d}_comparePickingInfo(C,c){return C.distance<c.distance?-1:C.distance>c.distance?1:0}intersectionSegment(C,c,d){const b=this.origin,X=V.TmpVectors.dd[0],P=V.TmpVectors.dd[1],R=V.TmpVectors.dd[2],p=V.TmpVectors.dd[3];c.subtractToRef(C,X),this.direction.scaleToRef(U._Rayl,R),b.addToRef(R,P),C.subtractToRef(b,p);const j=V.dd.Dot(X,X),g=V.dd.Dot(X,R),k=V.dd.Dot(R,R),Z=V.dd.Dot(X,p),A=V.dd.Dot(R,p),u=j*k-g*g;let q,B,t=u,e=u;u<U._Smallnum?(q=0,t=1,B=A,e=k):(q=g*A-k*Z,B=j*A-g*Z,q<0?(q=0,B=A,e=k):q>t&&(q=t,B=A+g,e=k)),B<0?(B=0,-Z<0?q=0:-Z>j?q=t:(q=-Z,t=j)):B>e&&(B=e,-Z+g<0?q=0:-Z+g>j?q=t:(q=-Z+g,t=j));const n=Math.abs(q)<U._Smallnum?0:q/t,W=Math.abs(B)<U._Smallnum?0:B/e,E=V.TmpVectors.dd[4];R.scaleToRef(W,E);const N=V.TmpVectors.dd[5];X.scaleToRef(n,N),N.addInPlace(p);const r=V.TmpVectors.dd[6];N.subtractToRef(E,r);return W>0&&W<=this.length&&r.lengthSquared()<d*d?N.length():-1}update(C,c,d,b,X,P,R){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){U._RayDistant||(U._RayDistant=U.Zero()),U._RayDistant.unprojectRayToRef(C,c,d,b,V.Matrix.IdentityReadOnly,P,R);const p=V.TmpVectors.Matrix[0];X.invertToRef(p),U.TransformToRef(U._RayDistant,p,this)}else this.unprojectRayToRef(C,c,d,b,X,P,R);return this}static Zero(){return new U(V.dd.Zero(),V.dd.Zero())}static CreateNew(C,c,d,b,X,P,V){return U.Zero().update(C,c,d,b,X,P,V)}static CreateNewFromTo(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.Matrix.IdentityReadOnly;const b=new U(new V.dd(0,0,0),new V.dd(0,0,0));return U.CreateFromToToRef(C,c,b,d)}static CreateFromToToRef(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.Matrix.IdentityReadOnly;d.origin.V(C);const X=c.subtractToRef(C,d.direction),P=Math.sqrt(X.x*X.x+X.y*X.y+X.z*X.z);return d.length=P,d.direction.normalize(),U.TransformToRef(d,b,d)}static Transform(C,c){const d=new U(new V.dd(0,0,0),new V.dd(0,0,0));return U.TransformToRef(C,c,d),d}static TransformToRef(C,c,d){V.dd.TransformCoordinatesToRef(C.origin,c,d.origin),V.dd.TransformNormalToRef(C.direction,c,d.direction),d.length=C.length,d.epsilon=C.epsilon;const b=d.direction,X=b.length();if(0!==X&&1!==X){const C=1/X;b.x*=C,b.y*=C,b.z*=C,d.length*=X}return d}unprojectRayToRef(C,c,d,b,X,P,R){const p=V.TmpVectors.Matrix[0];X.multiplyToRef(P,p),p.multiplyToRef(R,p),p.invert();const j=g.c.LastCreatedEngine,k=V.TmpVectors.dd[0];k.x=C/d*2-1,k.y=-(c/b*2-1),k.z=null!==j&&void 0!==j&&j.o?1:null!==j&&void 0!==j&&j.isNDCHalfZRange?0:-1;const Z=V.TmpVectors.dd[1].yc(k.x,k.y,1-1e-8),U=V.TmpVectors.dd[2],A=V.TmpVectors.dd[3];V.dd._UnprojectFromInvertedMatrixToRef(k,p,U),V.dd._UnprojectFromInvertedMatrixToRef(Z,p,A),this.origin.V(U),A.subtractToRef(U,this.direction),this.direction.normalize()}}function A(C,c,d,b,X){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=U.Zero();return u(C,c,d,b,V,X,P),V}function u(C,c,d,b,X,P){let R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const j=C.getEngine();if(!P&&!(P=C.activeCamera))return C;const g=P.viewport,k=j.getRenderHeight(),{x:Z,y:U,width:A,height:u}=g.toGlobal(j.getRenderWidth(),k),q=1/j.getHardwareScalingLevel();return c=c*q-Z,d=d*q-(k-U-u),X.update(c,d,A,u,b||V.Matrix.IdentityReadOnly,R?V.Matrix.IdentityReadOnly:P.getViewMatrix(),P.getProjectionMatrix(),p),C}function q(C,c,d,b,X){if(!j.c)return C;const P=C.getEngine();if(!X&&!(X=C.activeCamera))throw new Error("Active camera not set");const R=X.viewport,p=P.getRenderHeight(),{x:g,y:k,width:Z,height:U}=R.toGlobal(P.getRenderWidth(),p),A=V.Matrix.Identity(),u=1/P.getHardwareScalingLevel();return c=c*u-g,d=d*u-(p-k-U),b.update(c,d,Z,U,A,A,X.getProjectionMatrix()),C}function B(C,c,d,b,X,P,V,R){const p=c(b,d.enableDistantPicking),j=d.intersects(p,X,V,P,b,R);return j&&j.hit?!X&&null!=C&&j.distance>=C.distance?null:j:null}function t(C,c,d,b,X,P){let R=null;const p=!!(C.activeCameras&&C.activeCameras.length>1&&C.cameraToUseForPointers!==C.activeCamera),g=C.cameraToUseForPointers||C.activeCamera,k=Z.internalPickerForMesh||B;for(let j=0;j<C.meshes.length;j++){const Z=C.meshes[j];if(d){if(!d(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.dg)continue;const U=p&&Z.isWorldMatrixCameraDependent(),A=Z.Tc(U,g);if(Z.hasThinInstances&&Z.ag){const C=k(R,c,Z,A,!0,!0,P);if(C){if(X)return C;const p=V.TmpVectors.Matrix[1],j=Z.thinInstanceGetWorldMatrices();for(let C=0;C<j.length;C++){if(d&&!d(Z,C))continue;j[C].multiplyToRef(A,p);const V=k(R,c,Z,p,b,X,P,!0);if(V&&(R=V,R.thinInstanceIndex=C,b))return R}}}else{const C=k(R,c,Z,A,b,X,P);if(C&&(R=C,b))return R}}return R||new j.c}function e(C,c,d,b){if(!j.c)return null;const X=[],P=!!(C.activeCameras&&C.activeCameras.length>1&&C.cameraToUseForPointers!==C.activeCamera),R=C.cameraToUseForPointers||C.activeCamera,p=Z.internalPickerForMesh||B;for(let j=0;j<C.meshes.length;j++){const g=C.meshes[j];if(d){if(!d(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.dg)continue;const k=P&&g.isWorldMatrixCameraDependent(),Z=g.Tc(k,R);if(g.hasThinInstances&&g.ag){if(p(null,c,g,Z,!0,!0,b)){const C=V.TmpVectors.Matrix[1],P=g.thinInstanceGetWorldMatrices();for(let V=0;V<P.length;V++){if(d&&!d(g,V))continue;P[V].multiplyToRef(Z,C);const R=p(null,c,g,C,!1,!1,b,!0);R&&(R.thinInstanceIndex=V,X.push(R))}}}else{const C=p(null,c,g,Z,!1,!1,b);C&&X.push(C)}}return X}function n(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,b=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;b||(b=C.getWorldMatrix()),c.length=d,X?c.origin.V(X):c.origin.V(C.position);const P=V.TmpVectors.dd[2];P.set(0,0,C._scene.useRightHandedSystem?-1:1);const R=V.TmpVectors.dd[3];return V.dd.TransformNormalToRef(P,b,R),V.dd.NormalizeToRef(R,c.direction),c}var W,E;U._TmpVector3=(0,R.c)(6,V.dd.Zero),U._RayDistant=U.Zero(),U._Smallnum=1e-8,U._Rayl=1e9,W=b.e,(E=X.d)&&(E.prototype.getForwardRay=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;return n(this,new U(V.dd.Zero(),V.dd.Zero(),C),C,c,d)},E.prototype.getForwardRayToRef=function(C){return n(this,C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),W&&(k.b._IsPickingAvailable=!0,W.prototype.createPickingRay=function(C,c,d,b){return A(this,C,c,d,b,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),b.e.prototype.createPickingRayToRef=function(C,c,d,b,X){return u(this,C,c,d,b,X,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},b.e.prototype.createPickingRayInCameraSpace=function(C,c,d){return function(C,c,d,b){const X=U.Zero();return q(C,c,d,X,b),X}(this,C,c,d)},b.e.prototype.createPickingRayInCameraSpaceToRef=function(C,c,d,b){return q(this,C,c,d,b)},b.e.prototype.pickWithBoundingInfo=function(C,c,d,b,X){return function(C,c,d,b,X,P){if(!j.c)return null;const R=t(C,(b=>(C._tempPickingRay||(C._tempPickingRay=U.Zero()),u(C,c,d,b,C._tempPickingRay,P||null),C._tempPickingRay)),b,X,!0);return R&&(R.ray=A(C,c,d,V.Matrix.Identity(),P||null)),R}(this,C,c,d,b,X)},b.e.prototype.AX=function(C,c,d,b,X,P){return function(C,c,d,b,X,P,R){const p=t(C,((b,X)=>(C._tempPickingRay||(C._tempPickingRay=U.Zero()),u(C,c,d,b,C._tempPickingRay,P||null,!1,X),C._tempPickingRay)),b,X,!1,R);return p&&(p.ray=A(C,c,d,V.Matrix.Identity(),P||null)),p}(this,C,c,d,b,X,P)},b.e.prototype.pickWithRay=function(C,c,d,b){return function(C,c,d,b,X){const P=t(C,(d=>(C._pickWithRayInverseMatrix||(C._pickWithRayInverseMatrix=V.Matrix.Identity()),d.invertToRef(C._pickWithRayInverseMatrix),C._cachedRayForTransform||(C._cachedRayForTransform=U.Zero()),U.TransformToRef(c,C._pickWithRayInverseMatrix,C._cachedRayForTransform),C._cachedRayForTransform)),d,b,!1,X);return P&&(P.ray=c),P}(this,C,c,d,b)},b.e.prototype.multiPick=function(C,c,d,b,X){return function(C,c,d,b,X,P){return e(C,(b=>A(C,c,d,b,X||null)),b,P)}(this,C,c,d,b,X)},b.e.prototype.multiPickWithRay=function(C,c,d){return function(C,c,d,b){return e(C,(d=>(C._pickWithRayInverseMatrix||(C._pickWithRayInverseMatrix=V.Matrix.Identity()),d.invertToRef(C._pickWithRayInverseMatrix),C._cachedRayForTransform||(C._cachedRayForTransform=U.Zero()),U.TransformToRef(c,C._pickWithRayInverseMatrix,C._cachedRayForTransform),C._cachedRayForTransform)),d,b)}(this,C,c,d)}},14092:(C,c,d)=>{"use strict";var b=d(12316),X=d(12233),P=d(12258),V=d(12352),R=d(12283),p=d(12329);R.c.prototype._partialLoadFile=function(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(C,(C=>{d[c]=C,d._internalCount++,6===d._internalCount&&b(d)}),void 0,void 0,!0,((C,c)=>{X&&C&&X(C.status+" "+C.statusText,c)}))},R.c.prototype._cascadeLoadFiles=function(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const X=[];X._internalCount=0;for(let P=0;P<6;P++)this._partialLoadFile(d[P],P,X,c,b)},R.c.prototype._cascadeLoadImgs=function(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5?arguments[5]:void 0;const V=[];V._internalCount=0;for(let R=0;R<6;R++)this._partialLoadImg(b[R],R,V,C,c,d,X,P)},R.c.prototype._partialLoadImg=function(C,c,d,b,X,R){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7?arguments[7]:void 0;const g=(0,V.c)();(0,P.t)(C,(C=>{d[c]=C,d._internalCount++,b&&b.removePendingData(g),6===d._internalCount&&R&&R(X,d)}),((C,c)=>{b&&b.removePendingData(g),p&&p(C,c)}),b?b.offlineProvider:null,j),b&&b.addPendingData(g)},R.c.prototype.createCubeTextureBase=function(C,c,d,P){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,q=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],t=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const e=A||new b.d(this,7);e.isCube=!0,e.url=C,e.generateMipMaps=!P,e._lodGenerationScale=Z,e._lodGenerationOffset=U,e._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!P),e!==A&&(e.label=C.substring(0,60)),this._doNotHandleContextLost||(e._extension=g,e._files=d,e._buffer=t);const n=C;this._transformTextureUrl&&!A&&(C=this._transformTextureUrl(C));const W=g??function(C){const c=C.split("?")[0],d=c.lastIndexOf(".");return d>-1?c.substring(d).toLowerCase():""}(C),E=(0,p.e)(W),N=(C,c)=>{e.dispose(),R?R(C,c):C&&X.d.Warn(C)},r=(b,R)=>{C===n?b&&N(b.status+" "+b.statusText,R):(X.d.Warn(`Failed to load ${C}, falling back to the ${n}`),this.createCubeTextureBase(n,c,d,!!P,V,N,j,g,k,Z,U,e,u,q,B,t))};if(E)E.then((b=>{const X=C=>{u&&u(e,C),b.loadCubeData(C,e,k,V,((C,c)=>{N(C,c)}))};t?X(t):d&&6===d.length?b.supportCascades?this._cascadeLoadFiles(c,(C=>X(C.map((C=>new Uint8Array(C))))),d,N):N("Textures type does not support cascades."):this._loadFile(C,(C=>X(new Uint8Array(C))),void 0,void 0,!0,r)}));else{if(!d||0===d.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,e,((C,c)=>{q&&q(C,c)}),d,N)}return this._internalTexturesCache.push(e),e}},14673:(C,c,d)=>{"use strict";d(12233);var b=d(12529);d(12316),d(12477),d(12311),d(12584),d(12542);b.b},14120:(C,c,d)=>{"use strict";d.d(c,{c:()=>X});var b=d(12345);class X{constructor(C){this.value=this._toInt(C)}_toInt(C){return 0|C}add(C){return new X(this.value+C.value)}Xd(C){return new X(this.value-C.value)}multiply(C){return new X(Math.imul(this.value,C.value))}divide(C){return new X(this.value/C.value)}getClassName(){return X.ClassName}equals(C){return this.value===C.value}static FromValue(C){return new X(C)}toString(){return this.value.toString()}}X.ClassName="FlowGraphInteger",(0,b.e)("FlowGraphInteger",X)},14135:(C,c,d)=>{"use strict";d.d(c,{c:()=>X,e:()=>P});var b=d(12403);class X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.qc=C}get m(){return this.qc}transformVector(C){return this.transformVectorToRef(C,new b.Vector2)}transformVectorToRef(C,c){return c.x=C.x*this.qc[0]+C.y*this.qc[1],c.y=C.x*this.qc[2]+C.y*this.qc[3],c}rc(){return this.toArray()}toArray(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<4;c++)C[c]=this.qc[c];return C}uX(C){for(let c=0;c<4;c++)this.qc[c]=C[c];return this}multiplyToRef(C,c){const d=C.qc,b=this.qc,X=c.qc;return X[0]=d[0]*b[0]+d[1]*b[2],X[1]=d[0]*b[1]+d[1]*b[3],X[2]=d[2]*b[0]+d[3]*b[2],X[3]=d[2]*b[1]+d[3]*b[3],c}multiply(C){return this.multiplyToRef(C,new X)}divideToRef(C,c){const d=this.qc,b=C.qc,X=c.qc;return X[0]=d[0]/b[0],X[1]=d[1]/b[1],X[2]=d[2]/b[2],X[3]=d[3]/b[3],c}divide(C){return this.divideToRef(C,new X)}addToRef(C,c){const d=this.qc,b=C.m,X=c.m;return X[0]=d[0]+b[0],X[1]=d[1]+b[1],X[2]=d[2]+b[2],X[3]=d[3]+b[3],c}add(C){return this.addToRef(C,new X)}subtractToRef(C,c){const d=this.qc,b=C.m,X=c.m;return X[0]=d[0]-b[0],X[1]=d[1]-b[1],X[2]=d[2]-b[2],X[3]=d[3]-b[3],c}Xd(C){return this.subtractToRef(C,new X)}transpose(){const C=this.qc;return new X([C[0],C[2],C[1],C[3]])}determinant(){const C=this.qc;return C[0]*C[3]-C[1]*C[2]}inverse(){const C=this.determinant();if(0===C)throw new Error("Matrix is not invertible");const c=this.qc,d=1/C;return new X([c[3]*d,-c[1]*d,-c[2]*d,c[0]*d])}equals(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=this.qc,b=C.m;return 0===c?d[0]===b[0]&&d[1]===b[1]&&d[2]===b[2]&&d[3]===b[3]:Math.abs(d[0]-b[0])<c&&Math.abs(d[1]-b[1])<c&&Math.abs(d[2]-b[2])<c&&Math.abs(d[3]-b[3])<c}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.qc.join(", ")})`}}class P{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.qc=C}get m(){return this.qc}transformVector(C){return this.transformVectorToRef(C,new b.dd)}transformVectorToRef(C,c){const d=this.qc;return c.x=C.x*d[0]+C.y*d[1]+C.z*d[2],c.y=C.x*d[3]+C.y*d[4]+C.z*d[5],c.z=C.x*d[6]+C.y*d[7]+C.z*d[8],c}multiplyToRef(C,c){const d=C.qc,b=this.qc,X=c.m;return X[0]=d[0]*b[0]+d[1]*b[3]+d[2]*b[6],X[1]=d[0]*b[1]+d[1]*b[4]+d[2]*b[7],X[2]=d[0]*b[2]+d[1]*b[5]+d[2]*b[8],X[3]=d[3]*b[0]+d[4]*b[3]+d[5]*b[6],X[4]=d[3]*b[1]+d[4]*b[4]+d[5]*b[7],X[5]=d[3]*b[2]+d[4]*b[5]+d[5]*b[8],X[6]=d[6]*b[0]+d[7]*b[3]+d[8]*b[6],X[7]=d[6]*b[1]+d[7]*b[4]+d[8]*b[7],X[8]=d[6]*b[2]+d[7]*b[5]+d[8]*b[8],c}multiply(C){return this.multiplyToRef(C,new P)}divideToRef(C,c){const d=this.qc,b=C.m,X=c.m;return X[0]=d[0]/b[0],X[1]=d[1]/b[1],X[2]=d[2]/b[2],X[3]=d[3]/b[3],X[4]=d[4]/b[4],X[5]=d[5]/b[5],X[6]=d[6]/b[6],X[7]=d[7]/b[7],X[8]=d[8]/b[8],c}divide(C){return this.divideToRef(C,new P)}addToRef(C,c){const d=this.qc,b=C.m,X=c.m;return X[0]=d[0]+b[0],X[1]=d[1]+b[1],X[2]=d[2]+b[2],X[3]=d[3]+b[3],X[4]=d[4]+b[4],X[5]=d[5]+b[5],X[6]=d[6]+b[6],X[7]=d[7]+b[7],X[8]=d[8]+b[8],c}add(C){return this.addToRef(C,new P)}subtractToRef(C,c){const d=this.qc,b=C.m,X=c.m;return X[0]=d[0]-b[0],X[1]=d[1]-b[1],X[2]=d[2]-b[2],X[3]=d[3]-b[3],X[4]=d[4]-b[4],X[5]=d[5]-b[5],X[6]=d[6]-b[6],X[7]=d[7]-b[7],X[8]=d[8]-b[8],c}Xd(C){return this.subtractToRef(C,new P)}toArray(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<9;c++)C[c]=this.qc[c];return C}rc(){return this.toArray()}uX(C){for(let c=0;c<9;c++)this.qc[c]=C[c];return this}transpose(){const C=this.qc;return new P([C[0],C[3],C[6],C[1],C[4],C[7],C[2],C[5],C[8]])}determinant(){const C=this.qc;return C[0]*(C[4]*C[8]-C[5]*C[7])-C[1]*(C[3]*C[8]-C[5]*C[6])+C[2]*(C[3]*C[7]-C[4]*C[6])}inverse(){const C=this.determinant();if(0===C)throw new Error("Matrix is not invertible");const c=this.qc,d=1/C;return new P([(c[4]*c[8]-c[5]*c[7])*d,(c[2]*c[7]-c[1]*c[8])*d,(c[1]*c[5]-c[2]*c[4])*d,(c[5]*c[6]-c[3]*c[8])*d,(c[0]*c[8]-c[2]*c[6])*d,(c[2]*c[3]-c[0]*c[5])*d,(c[3]*c[7]-c[4]*c[6])*d,(c[1]*c[6]-c[0]*c[7])*d,(c[0]*c[4]-c[1]*c[3])*d])}equals(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=this.qc,b=C.m;return 0===c?d[0]===b[0]&&d[1]===b[1]&&d[2]===b[2]&&d[3]===b[3]&&d[4]===b[4]&&d[5]===b[5]&&d[6]===b[6]&&d[7]===b[7]&&d[8]===b[8]:Math.abs(d[0]-b[0])<c&&Math.abs(d[1]-b[1])<c&&Math.abs(d[2]-b[2])<c&&Math.abs(d[3]-b[3])<c&&Math.abs(d[4]-b[4])<c&&Math.abs(d[5]-b[5])<c&&Math.abs(d[6]-b[6])<c&&Math.abs(d[7]-b[7])<c&&Math.abs(d[8]-b[8])<c}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.qc.join(", ")})`}}},14144:(C,c,d)=>{"use strict";var b;function X(C,c,d,b){switch(c){case"Animation":return b?C.animations.find((C=>C.uniqueId===d))??null:C.animations[d]??null;case"AnimationGroup":return b?C.animationGroups.find((C=>C.uniqueId===d))??null:C.animationGroups[d]??null;case"Mesh":return b?C.meshes.find((C=>C.uniqueId===d))??null:C.meshes[d]??null;case"Material":return b?C.materials.find((C=>C.uniqueId===d))??null:C.materials[d]??null;case"Qk":return b?C.cameras.find((C=>C.uniqueId===d))??null:C.cameras[d]??null;case"Light":return b?C.lights.find((C=>C.uniqueId===d))??null:C.lights[d]??null;default:return null}}d.d(c,{e:()=>X}),function(C){C.Animation="Animation",C.AnimationGroup="AnimationGroup",C.Mesh="Mesh",C.Material="Material",C.Qk="Qk",C.Light="Light"}(b||(b={}))},14178:(C,c,d)=>{"use strict";d.d(c,{c:()=>X});var b=d(14185);class X extends b.e{constructor(C,c){if(super(C),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),c)for(const d of c)this._eventsSignalOutputs[d]=this._registerSignalOutput(d+"Event")}_executeOnTick(C){}_startPendingTasks(C){C._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(C),this._resetAfterCanceled(C)),this._preparePendingTasks(C),C._addPendingBlock(this),this.out._activateSignal(C),C._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(C){C._deleteExecutionVariable(this,"_initialized"),C._removePendingBlock(this)}}},14158:(C,c,d)=>{"use strict";d.d(c,{e:()=>j});var b=d(12352),X=d(12345),P=d(14162),V=d(12221),R=d(14115);class p extends P.b{constructor(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:b.defaultValue,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(C,c,d),this.richType=b,this._defaultValue=X,this._optional=P,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new V.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(C){this._isDisabled!==C&&(this._isDisabled=C,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(C,c){c._getConnectionValue(this)!==C&&(c._setConnectionValue(this,C),this.onValueChangedObservable.notifyObservers(C))}resetToDefaultValue(C){C._setConnectionValue(this,this._defaultValue)}connectTo(C){this._isDisabled||super.connectTo(C)}_getValueOrDefault(C){const c=C._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(c):c}getValue(C){if(1===this.connectionType){C._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(C);const c=this._getValueOrDefault(C);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}const c=this.isConnected()?this._connectedPoint[0].getValue(C):this._getValueOrDefault(C);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.richType={},this.richType.serialize(C.richType),C.optional=this._optional,(0,R.h)("defaultValue",this._defaultValue,C)}}(0,X.e)("FlowGraphDataConnection",p);class j{constructor(C){var c;this.config=C,this.uniqueId=(0,b.c)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(C){}registerDataInput(C,c,d){const b=new p(C,0,this,c,d);return this.dataInputs.push(b),b}registerDataOutput(C,c,d){const b=new p(C,1,this,c,d);return this.dataOutputs.push(b),b}getDataInput(C){return this.dataInputs.find((c=>c.name===C))}getDataOutput(C){return this.dataOutputs.find((c=>c.name===C))}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.h;if(C.uniqueId=this.uniqueId,C.config={},this.config){const d=this.config,b=Object.keys(d);for(const X of b)c(X,d[X],C.config)}C.dataInputs=[],C.dataOutputs=[],C.className=this.getClassName();for(const d of this.dataInputs){const c={};d.serialize(c),C.dataInputs.push(c)}for(const d of this.dataOutputs){const c={};d.serialize(c),C.dataOutputs.push(c)}}deserialize(C){}_log(C,c,d){var b;null===(b=C.logger)||void 0===b||b.addLogItem({action:c,qX:d,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14162:(C,c,d)=>{"use strict";d.d(c,{b:()=>P});var b,X=d(12352);!function(C){C[C.Input=0]="Input",C[C.Output=1]="Output"}(b||(b={}));class P{constructor(C,c,d){this._ownerBlock=d,this._connectedPoint=[],this.uniqueId=(0,X.c)(),this.connectedPointIds=[],this.name=C,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(C){if(this._connectionType===C._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||C._isSingularConnection()&&C._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(C),C._connectedPoint.push(this)}disconnectFrom(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=this._connectedPoint.indexOf(C),b=C._connectedPoint.indexOf(this);-1!==d&&-1!==b&&(c&&this._connectedPoint.splice(d,1),C._connectedPoint.splice(b,1))}disconnectFromAll(){for(const C of this._connectedPoint)this.disconnectFrom(C,!1);this._connectedPoint.length=0}dispose(){for(const C of this._connectedPoint)this.disconnectFrom(C)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C.uniqueId=this.uniqueId,C.name=this.name,C._connectionType=this._connectionType,C.connectedPointIds=[],C.className=this.getClassName();for(const c of this._connectedPoint)C.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(C){this.uniqueId=C.uniqueId,this.name=C.name,this._connectionType=C._connectionType,this.connectedPointIds=C.connectedPointIds}}},14108:(C,c,d)=>{"use strict";d.d(c,{d:()=>e});var b,X=d(12221),P=d(12384),V=d(12388),R=d(12352),p=d(14115),j=d(14144),g=d(12233);!function(C){C.ExecuteBlock="ExecuteBlock",C.ExecuteEvent="ExecuteEvent",C.TriggerConnection="TriggerConnection",C.ContextVariableSet="ContextVariableSet",C.GlobalVariableSet="GlobalVariableSet",C.GlobalVariableDelete="GlobalVariableDelete",C.GlobalVariableGet="GlobalVariableGet",C.AddConnection="AddConnection",C.GetConnectionValue="GetConnectionValue",C.SetConnectionValue="SetConnectionValue",C.ActivateSignal="ActivateSignal",C.ContextVariableGet="ContextVariableGet"}(b||(b={}));class k{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(C){if(C.time||(C.time=Date.now()),this.log.push(C),this.logToConsole){var c;const d=null===(c=C.qX)||void 0===c?void 0:c.value;"object"===typeof d&&d.getClassName?g.d.Log(`[FGLog] ${C.className}:${C.uniqueId.split("-")[0]} ${C.action} - ${JSON.stringify(d.getClassName())}: ${d.toString()}`):g.d.Log(`[FGLog] ${C.className}:${C.uniqueId.split("-")[0]} ${C.action} - ${JSON.stringify(C.qX)}`)}}getItemsOfType(C){return this.log.filter((c=>c.action===C))}}class Z{get enableLogging(){return this._enableLogging}set enableLogging(C){this._enableLogging!==C&&(this._enableLogging=C,this._enableLogging?(this.logger=new k,this.logger.logToConsole=!0):this.logger=null)}constructor(C){this.uniqueId=(0,R.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new X.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=C,this.assetsContext=C.assetsContext??C.Pd}hasVariable(C){return C in this._userVariables}setVariable(C,c){var d;this._userVariables[C]=c,null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",qX:{name:C,value:c}})}getAsset(C,c){return(0,j.e)(this.assetsContext,C,c)}getVariable(C){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",qX:{name:C,value:this._userVariables[C]}}),this._userVariables[C]}get userVariables(){return this._userVariables}NC(){return this._configuration.Pd}_getUniqueIdPrefixedName(C,c){return`${C.uniqueId}_${c}`}_getGlobalContextVariable(C,c){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",qX:{name:C,defaultValue:c,possibleValue:this._globalContextVariables[C]}}),this._hasGlobalContextVariable(C)?this._globalContextVariables[C]:c}_setGlobalContextVariable(C,c){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",qX:{name:C,value:c}}),this._globalContextVariables[C]=c}_deleteGlobalContextVariable(C){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",qX:{name:C}}),delete this._globalContextVariables[C]}_hasGlobalContextVariable(C){return C in this._globalContextVariables}_setExecutionVariable(C,c,d){this._executionVariables[this._getUniqueIdPrefixedName(C,c)]=d}_getExecutionVariable(C,c,d){return this._hasExecutionVariable(C,c)?this._executionVariables[this._getUniqueIdPrefixedName(C,c)]:d}_deleteExecutionVariable(C,c){delete this._executionVariables[this._getUniqueIdPrefixedName(C,c)]}_hasExecutionVariable(C,c){return this._getUniqueIdPrefixedName(C,c)in this._executionVariables}_hasConnectionValue(C){return C.uniqueId in this._connectionValues}_setConnectionValue(C,c){var d;this._connectionValues[C.uniqueId]=c,null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",qX:{connectionPointId:C.uniqueId,value:c}})}_setConnectionValueByKey(C,c){this._connectionValues[C]=c}_getConnectionValue(C){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",qX:{connectionPointId:C.uniqueId,value:this._connectionValues[C.uniqueId]}}),this._connectionValues[C.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(C){this._pendingBlocks.includes(C)||(this._pendingBlocks.push(C),this._pendingBlocks.sort(((C,c)=>C.priority-c.priority)))}_removePendingBlock(C){const c=this._pendingBlocks.indexOf(C);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const C of this._pendingBlocks)C._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(C){var c;this.onNodeExecutedObservable.notifyObservers(C),null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:C.getClassName(),uniqueId:C.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(C){this._setGlobalContextVariable("timeSinceStart",C.timeSinceStart),this._setGlobalContextVariable("deltaTime",C.deltaTime);for(const d of this._pendingBlocks){var c;null===(c=d._executeOnTick)||void 0===c||c.call(d,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.h;C.uniqueId=this.uniqueId,C._userVariables={};for(const b in this._userVariables)c(b,this._userVariables[b],C._userVariables);C._connectionValues={};for(const b in this._connectionValues)c(b,this._connectionValues[b],C._connectionValues);var d;this.assetsContext!==this.NC()&&(C._assetsContext={meshes:this.assetsContext.meshes.map((C=>C.id)),materials:this.assetsContext.materials.map((C=>C.id)),textures:this.assetsContext.textures.map((C=>C.name)),animations:this.assetsContext.animations.map((C=>C.name)),lights:this.assetsContext.lights.map((C=>C.id)),cameras:this.assetsContext.cameras.map((C=>C.id)),gA:null===(d=this.assetsContext.gA)||void 0===d?void 0:d.map((C=>C.name)),skeletons:this.assetsContext.skeletons.map((C=>C.id)),LU:this.assetsContext.LU.map((C=>C.name)),geometries:this.assetsContext.geometries.map((C=>C.id)),multiMaterials:this.assetsContext.multiMaterials.map((C=>C.id)),transformNodes:this.assetsContext.transformNodes.map((C=>C.id))})}getClassName(){return"FlowGraphContext"}}(0,P.e)([(0,V.P)()],Z.prototype,"uniqueId",void 0);var U=d(14150),A=d(12676);class u{constructor(C){this.onEventTriggeredObservable=new X.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=C,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Uc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const C=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",qX:{timeSinceStart:this._startingTime,deltaTime:C}}),this._startingTime+=C})),this._meshPickedObserver=this._scene.onPointerObservable.add((C=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",qX:C})}),A.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((C=>{const c=C.pointerId,d=C.mesh,b=this._pointerUnderMeshState[c];!b&&d?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",qX:{pointerId:c,mesh:d}}):b&&!d?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",qX:{pointerId:c,mesh:b}}):b&&d&&b!==d&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",qX:{pointerId:c,mesh:b,over:d}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",qX:{pointerId:c,mesh:d,out:b}})),this._pointerUnderMeshState[c]=d}),A.c.POINTERMOVE)}dispose(){var C,c,d,b,X;null===(C=this._sceneDisposeObserver)||void 0===C||C.remove(),null===(c=this._sceneReadyObserver)||void 0===c||c.remove(),null===(d=this._sceneOnBeforeRenderObserver)||void 0===d||d.remove(),null===(b=this._meshPickedObserver)||void 0===b||b.remove(),null===(X=this._meshUnderPointerObserver)||void 0===X||X.remove(),this.onEventTriggeredObservable.clear()}}var q,B=d(14169);!function(C){C[C.Stopped=0]="Stopped",C[C.Started=1]="Started"}(q||(q={}));class t{get state(){return this._state}set state(C){this._state=C,this.onStateChangedObservable.notifyObservers(C)}constructor(C){this.onStateChangedObservable=new X.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=C.Pd,this._sceneEventCoordinator=new u(this._scene),this._coordinator=C.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((C=>{for(const c of this._executionContexts){const d=this._getContextualOrder(C.type,c);for(const b of d)if(!b._executeEvent(c,C.qX))break}switch(C.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const c of this._executionContexts)c._notifyOnTick(C.qX);break;case"SceneDispose":this.dispose()}}))}createContext(){const C=new Z({Pd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(C),C}getContext(C){return this._executionContexts[C]}addEventBlock(C){if("PointerOver"!==C.type&&"PointerOut"!==C.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==C.type&&this._eventBlocks[C.type].push(C),1===this.state)for(const c of this._executionContexts)C._startPendingTasks(c);else this.onStateChangedObservable.addOnce((c=>{if(1===c)for(const d of this._executionContexts)C._startPendingTasks(d)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((C=>{1===C&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const C of this._executionContexts)for(const c in this._eventBlocks){const d=this._getContextualOrder(c,C);for(const c of d)c._startPendingTasks(C)}}_getContextualOrder(C,c){const d=this._eventBlocks[C].sort(((C,c)=>c.initPriority-C.initPriority));if("MeshPick"===C){const C=[];for(const b of d){const X=b.asset.getValue(c);let P=0;for(;P<d.length;P++){const C=d[P].asset.getValue(c);if(X&&C&&(0,B.i)(X,C))break}C.splice(P,0,b)}return C}return d}dispose(){var C;if(0!==this.state){this.state=0;for(const C of this._executionContexts)C._clearPendingBlocks();this._executionContexts.length=0;for(const C in this._eventBlocks)this._eventBlocks[C].length=0;null===(C=this._eventObserver)||void 0===C||C.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(C){const c=[],d=new Set;for(const b in this._eventBlocks)for(const C of this._eventBlocks[b])c.push(C),d.add(C.uniqueId);for(;c.length>0;){const b=c.pop();C(b);for(const C of b.dataInputs)for(const b of C._connectedPoint)d.has(b._ownerBlock.uniqueId)||(c.push(b._ownerBlock),d.add(b._ownerBlock.uniqueId));if(b instanceof U.d)for(const C of b.signalOutputs)for(const b of C._connectedPoint)d.has(b._ownerBlock.uniqueId)||(c.push(b._ownerBlock),d.add(b._ownerBlock.uniqueId))}}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;C.allBlocks=[],this.visitAllBlocks((c=>{const d={};c.serialize(d),C.allBlocks.push(d)})),C.executionContexts=[];for(const d of this._executionContexts){const b={};d.serialize(b,c),C.executionContexts.push(b)}}}class e{constructor(C){this.config=C,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Pd.Uc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Pd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const C=this._executeOnNextFrame.slice(0);if(C.length)for(const c of C){this.notifyCustomEvent(c.id,c.data,!1);const C=this._executeOnNextFrame.findIndex((C=>C.uniqueId===c.uniqueId));-1!==C&&this._executeOnNextFrame.splice(C,1)}}));(e.SceneCoordinators.get(this.config.Pd)??[]).push(this)}createGraph(){const C=new t({Pd:this.config.Pd,coordinator:this});return this._flowGraphs.push(C),C}removeGraph(C){const c=this._flowGraphs.indexOf(C);-1!==c&&(C.dispose(),this._flowGraphs.splice(c,1))}start(){for(const C of this._flowGraphs)C.start()}dispose(){var C,c;for(const X of this._flowGraphs)X.dispose();this._flowGraphs.length=0,null===(C=this._disposeObserver)||void 0===C||C.remove(),null===(c=this._onBeforeRenderObserver)||void 0===c||c.remove();const d=e.SceneCoordinators.get(this.config.Pd)??[],b=d.indexOf(this);-1!==b&&d.splice(b,1)}serialize(C,c){C._flowGraphs=[];for(const d of this._flowGraphs){const b={};d.serialize(b,c),C._flowGraphs.push(b)}C.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(C){let c=this._customEventsMap.get(C);return c||(c=new X.b,this._customEventsMap.set(C,c)),c}notifyCustomEvent(C,c){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:C,data:c,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(C)){const c=this._eventExecutionCounter.get(C);if(this._eventExecutionCounter.set(C,c+1),c>=e.MaxEventTypeExecutionPerFrame)return void(c===e.MaxEventTypeExecutionPerFrame&&g.d.Warn(`FlowGraphCoordinator: Too many executions of event "${C}".`))}else this._eventExecutionCounter.set(C,1);const d=this._customEventsMap.get(C);d&&d.notifyObservers(c)}}e.MaxEventsPerType=30,e.MaxEventTypeExecutionPerFrame=30,e.SceneCoordinators=new Map},14172:(C,c,d)=>{"use strict";d.d(c,{b:()=>X});var b=d(14178);class X extends b.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(C){C._notifyExecuteNode(this),this.done._activateSignal(C)}}},14150:(C,c,d)=>{"use strict";d.d(c,{d:()=>R});var b=d(14158),X=d(14162),P=d(12345);class V extends X.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(C){super.connectTo(C),this._connectedPoint.sort(((C,c)=>c.priority-C.priority))}_activateSignal(C){var c;if(null===(c=C.logger)||void 0===c||c.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,qX:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)C._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(C,this),C._increaseExecutionId();else for(const d of this._connectedPoint)d._activateSignal(C)}}(0,P.e)("FlowGraphSignalConnection",V);class R extends b.e{constructor(C){super(C),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(C){const c=new V(C,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(C){const c=new V(C,1,this);return this.signalOutputs.push(c),c}_unregisterSignalInput(C){const c=this.signalInputs.findIndex((c=>c.name===C));-1!==c&&(this.signalInputs[c].dispose(),this.signalInputs.splice(c,1))}_unregisterSignalOutput(C){const c=this.signalOutputs.findIndex((c=>c.name===C));-1!==c&&(this.signalOutputs[c].dispose(),this.signalOutputs.splice(c,1))}_reportError(C,c){this.error.qX="string"===typeof c?new Error(c):c,this.error._activateSignal(C)}getSignalInput(C){return this.signalInputs.find((c=>c.name===C))}getSignalOutput(C){return this.signalOutputs.find((c=>c.name===C))}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.signalInputs=[],C.signalOutputs=[];for(const c of this.signalInputs){const d={};c.serialize(d),C.signalInputs.push(d)}for(const c of this.signalOutputs){const d={};c.serialize(d),C.signalOutputs.push(d)}}deserialize(C){for(let c=0;c<C.signalInputs.length;c++){const d=this.getSignalInput(C.signalInputs[c].name);if(!d)throw new Error("Could not find signal input with name "+C.signalInputs[c].name+" in block "+C.className);d.deserialize(C.signalInputs[c])}for(let c=0;c<C.signalOutputs.length;c++){const d=this.getSignalOutput(C.signalOutputs[c].name);if(!d)throw new Error("Could not find signal output with name "+C.signalOutputs[c].name+" in block "+C.className);d.deserialize(C.signalOutputs[c])}}getClassName(){return"FlowGraphExecutionBlock"}}},14185:(C,c,d)=>{"use strict";d.d(c,{e:()=>X});var b=d(14150);class X extends b.d{constructor(C){super(C),this.out=this._registerSignalOutput("out")}}},14126:(C,c,d)=>{"use strict";d.d(c,{B:()=>M,D:()=>K,H:()=>r,J:()=>N,b:()=>j,e:()=>Z,h:()=>E,l:()=>q,n:()=>B,o:()=>t,q:()=>k,r:()=>W,s:()=>g,v:()=>U,w:()=>A,y:()=>u});var b,X=d(12403),P=d(12438),V=d(14120),R=d(14135);!function(C){C.Any="any",C.String="string",C.Number="number",C.Boolean="boolean",C.Object="object",C.Integer="FlowGraphInteger",C.Vector2="Vector2",C.dd="dd",C.Vector4="Vector4",C.Quaternion="Quaternion",C.Matrix="Matrix",C.Matrix2D="Matrix2D",C.Matrix3D="Matrix3D",C.pd="pd",C.vc="vc"}(b||(b={}));class p{constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=C,this.defaultValue=c,this.animationType=d}serialize(C){C.typeName=this.typeName,C.defaultValue=this.defaultValue}}const j=new p("any",void 0),g=new p("string",""),k=new p("number",0,0),Z=new p("boolean",!1),U=new p("Vector2",X.Vector2.Zero(),5),A=new p("dd",X.dd.Zero(),1),u=new p("Vector4",X.Vector4.Zero()),q=new p("Matrix",X.Matrix.Identity(),3),B=new p("Matrix2D",new R.c),t=new p("Matrix3D",new R.e),e=new p("pd",P.pd.Black(),4),n=new p("vc",new P.vc(0,0,0,0),7),W=new p("Quaternion",X.Quaternion.Identity(),2);W.typeTransformer=C=>{if(C.getClassName){if("Vector4"===C.getClassName())return X.Quaternion.jd(C.rc());if("dd"===C.getClassName())return X.Quaternion.FromEulerVector(C);if("Matrix"===C.getClassName())return X.Quaternion.FromRotationMatrix(C)}return C};const E=new p("FlowGraphInteger",new V.c(0),0);function N(C){const c=C;switch(typeof C){case"string":return g;case"number":return k;case"boolean":return Z;case"object":if(c.getClassName)switch(c.getClassName()){case"Vector2":return U;case"dd":return A;case"Vector4":return u;case"Matrix":return q;case"pd":return e;case"vc":return n;case"Quaternion":return W;case"FlowGraphInteger":return E;case"Matrix2D":return B;case"Matrix3D":return t}return j;default:return j}}function r(C){switch(C){case"string":return g;case"number":return k;case"boolean":return Z;case"Vector2":return U;case"dd":return A;case"Vector4":return u;case"Matrix":return q;case"pd":return e;case"vc":return n;case"Quaternion":return W;case"FlowGraphInteger":return E;case"Matrix2D":return B;case"Matrix3D":return t;default:return j}}function M(C){switch(C){case"number":default:return 0;case"Vector2":return 5;case"dd":return 1;case"Matrix":return 3;case"pd":return 4;case"vc":return 7;case"Quaternion":return 2}}function K(C){switch(C){case 0:return k;case 5:return U;case 1:return A;case 3:return q;case 4:return e;case 7:return n;case 2:return W;default:return j}}},14115:(C,c,d)=>{"use strict";d.d(c,{d:()=>g,h:()=>j,j:()=>k});var b=d(12438),X=d(12403),P=d(14120),V=d(14126),R=d(14135);function p(C){return"Vector2"===C||"dd"===C||"Vector4"===C||"Quaternion"===C||"pd"===C||"vc"===C}function j(C,c,d){var b;const X=(null===c||void 0===c||null===(b=c.getClassName)||void 0===b?void 0:b.call(c))??"";if(p(X)||function(C){return"Matrix"===C||"Matrix2D"===C||"Matrix3D"===C}(X))d[C]={value:c.rc(),className:X};else if("FlowGraphInteger"===X)d[C]={value:c.value,className:X};else if(X&&(c.id||c.name))d[C]={id:c.id,name:c.name,className:X};else{if("object"===typeof c)throw new Error(`Could not serialize value ${c}`);d[C]=c}}function g(C,c,d,j){const k=c[C];let Z;const U=(null===k||void 0===k?void 0:k.type)??(null===k||void 0===k?void 0:k.className);if(function(C){return"Mesh"===C||"AbstractMesh"===C||"GroundMesh"===C||"InstanceMesh"===C||"LinesMesh"===C||"GoldbergMesh"===C||"GreasedLineMesh"===C||"TrailMesh"===C}(U)){let C=j.meshes.filter((C=>k.id?C.id===k.id:C.name===k.name));0===C.length&&(C=j.transformNodes.filter((C=>k.id?C.id===k.id:C.name===k.name))),Z=k.uniqueId?C.find((C=>C.uniqueId===k.uniqueId)):C[0]}else if(p(U))Z=function(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===C)return X.Vector2.jd(c);if("dd"===C)return d&&(c[2]*=-1),X.dd.jd(c);if("Vector4"===C)return X.Vector4.jd(c);if("Quaternion"===C)return d&&(c[2]*=-1,c[3]*=-1),X.Quaternion.jd(c);if("pd"===C)return new b.pd(c[0],c[1],c[2]);if("vc"===C)return new b.vc(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${C}`)}(U,k.value);else if(function(C){return"AnimationGroup"===C}(U)){const C=j.animationGroups.filter((C=>C.name===k.name));Z=1===C.length?C[0]:C.find((C=>C.uniqueId===k.uniqueId))}else Z="Matrix"===U?X.Matrix.jd(k.value):"Matrix2D"===U?new R.c(k.value):"Matrix3D"===U?new R.e(k.value):"FlowGraphInteger"===U?P.c.FromValue(k.value):"number"===U||"string"===U||"boolean"===U?k.value[0]:k&&void 0!==k.value?k.value:Array.isArray(k)?k.reduce(((C,c)=>c.eventData?(C[c.id]={type:(0,V.H)(c.type)},"undefined"!==typeof c.value&&(C[c.id].value=g("value",c,d,j)),C):C),{}):k;return Z}function k(C){return"FlowGraphJsonPointerParserBlock"===C}},14169:(C,c,d)=>{"use strict";function b(C,c){return!(!C.parent||C.parent!==c&&!b(C.parent,c))}function X(C){if(C.getClassName)return C.getClassName()}function P(C,c){return C===c&&("Vector2"===C||"dd"===C||"Vector4"===C||"Quaternion"===C)}function V(C,c){return C===c&&("Matrix"===C||"Matrix2D"===C||"Matrix3D"===C)}function R(C,c){return"FlowGraphInteger"===C&&"FlowGraphInteger"===c}function p(C,c){const d="number"===typeof C||"number"===typeof(null===C||void 0===C?void 0:C.value);return d&&!c?!isNaN(j(C)):d}function j(C){return"number"===typeof C?C:C.value}d.d(c,{b:()=>R,d:()=>V,g:()=>P,h:()=>X,i:()=>b,k:()=>j,n:()=>p})},13531:(C,c,d)=>{"use strict";d.r(c),d.d(c,{SceneInstrumentation:()=>P});var b=d(12219),X=d(12617);class P{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(C){C!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=C,C?(this._onBeforeActiveMeshesEvaluationObserver=this.Pd.onBeforeActiveMeshesEvaluationObservable.add((()=>{b.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Pd.onAfterActiveMeshesEvaluationObservable.add((()=>{b.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Pd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Pd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(C){C!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=C,C?(this._onBeforeRenderTargetsRenderObserver=this.Pd.onBeforeRenderTargetsRenderObservable.add((()=>{b.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Pd.onAfterRenderTargetsRenderObservable.add((()=>{b.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Pd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Pd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(C){C!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=C,C?(this._onBeforeParticlesRenderingObserver=this.Pd.onBeforeParticlesRenderingObservable.add((()=>{b.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Pd.onAfterParticlesRenderingObservable.add((()=>{b.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Pd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Pd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(C){C!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=C,this.Pd.spriteManagers&&(C?(this._onBeforeSpritesRenderingObserver=this.Pd.onBeforeSpritesRenderingObservable.add((()=>{b.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Pd.onAfterSpritesRenderingObservable.add((()=>{b.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Pd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Pd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(C){C!==this._capturePhysicsTime&&this.Pd.onBeforePhysicsObservable&&(this._capturePhysicsTime=C,C?(this._onBeforePhysicsObserver=this.Pd.onBeforePhysicsObservable.add((()=>{b.Tools.StartPerformanceCounter("Oc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Pd.onAfterPhysicsObservable.add((()=>{b.Tools.EndPerformanceCounter("Oc"),this._physicsTime.endMonitoring()}))):(this.Pd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Pd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(C){C!==this._captureAnimationsTime&&(this._captureAnimationsTime=C,C?this._onAfterAnimationsObserver=this.Pd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Pd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(C){this._captureFrameTime=C}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(C){this._captureInterFrameTime=C}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(C){C!==this._captureRenderTime&&(this._captureRenderTime=C,C?(this._onBeforeDrawPhaseObserver=this.Pd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),b.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Pd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),b.Tools.EndPerformanceCounter("Main render")}))):(this.Pd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Pd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(C){C!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=C,C?(this._onBeforeCameraRenderObserver=this.Pd.onBeforeCameraRenderObservable.add((C=>{this._cameraRenderTime.beginMonitoring(),b.Tools.StartPerformanceCounter(`Rendering camera ${C.name}`)})),this._onAfterCameraRenderObserver=this.Pd.onAfterCameraRenderObservable.add((C=>{this._cameraRenderTime.endMonitoring(!1),b.Tools.EndPerformanceCounter(`Rendering camera ${C.name}`)}))):(this.Pd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Pd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Pd.getEngine()._drawCalls}constructor(C){this.Pd=C,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new X.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new X.b,this._captureFrameTime=!1,this._frameTime=new X.b,this._captureRenderTime=!1,this._renderTime=new X.b,this._captureInterFrameTime=!1,this._interFrameTime=new X.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new X.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new X.b,this._capturePhysicsTime=!1,this._physicsTime=new X.b,this._captureAnimationsTime=!1,this._animationsTime=new X.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new X.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=C.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(b.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Pd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=C.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(b.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Zc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Zc(),this._captureParticlesRenderTime&&this._particlesRenderTime.Zc(),this._captureSpritesRenderTime&&this._spritesRenderTime.Zc(),this._captureRenderTime&&this._renderTime.Zc(),this._captureCameraRenderTime&&this._cameraRenderTime.Zc()}))}dispose(){this._disposed||(this.Pd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Pd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Pd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Pd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Pd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Pd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Pd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Pd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Pd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Pd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Pd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Pd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Pd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Pd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Pd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Pd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Pd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Pd=null,this._disposed=!0)}}},14103:(C,c,d)=>{"use strict";d.d(c,{c:()=>g});var b=d(12384),X=d(12388),P=d(12403),V=d(12816),R=d(12942),p=d(13018),j=d(12345);V.e.AddNodeConstructor("Light_Type_1",((C,c)=>()=>new g(C,P.dd.Zero(),c)));class g extends p.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(C){this._shadowFrustumSize=C,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(C){this._shadowOrthoScale=C,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(C){this._orthoLeft=C}get orthoRight(){return this._orthoRight}set orthoRight(C){this._orthoRight=C}get orthoTop(){return this._orthoTop}set orthoTop(C){this._orthoTop=C}get orthoBottom(){return this._orthoBottom}set orthoBottom(C){this._orthoBottom=C}constructor(C,c,d){super(C,d),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"Cd"}getTypeID(){return R.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(C,c,d){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(C):this._setDefaultAutoExtendShadowProjectionMatrix(C,c,d)}_setDefaultFixedFrustumShadowProjectionMatrix(C){const c=this.NC().activeCamera;c&&P.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.Lc,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,C,this.NC().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(C,c,d){const b=this.NC().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const C=P.dd.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let b=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let V=0;V<d.length;V++){const R=d[V];if(!R)continue;const p=R.getBoundingInfo().boundingBox;for(let d=0;d<p.vectorsWorld.length;d++)P.dd.TransformCoordinatesToRef(p.vectorsWorld[d],c,C),C.x<this._orthoLeft&&(this._orthoLeft=C.x),C.y<this._orthoBottom&&(this._orthoBottom=C.y),C.x>this._orthoRight&&(this._orthoRight=C.x),C.y>this._orthoTop&&(this._orthoTop=C.y),this.autoCalcShadowZBounds&&(C.z<b&&(b=C.z),C.z>X&&(X=C.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=b,this._shadowMaxZ=X)}const X=this._orthoRight-this._orthoLeft,V=this._orthoTop-this._orthoBottom,R=void 0!==this.shadowMinZ?this.shadowMinZ:(null===b||void 0===b?void 0:b.Lc)||0,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===b||void 0===b?void 0:b.maxZ)||1e4,j=this.NC().getEngine().o;P.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-X*this.shadowOrthoScale,this._orthoRight+X*this.shadowOrthoScale,this._orthoBottom-V*this.shadowOrthoScale,this._orthoTop+V*this.shadowOrthoScale,j?p:R,j?R:p,C,this.NC().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(C,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(C,c){return this.computeTransformedInformation()?(C.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(C.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(C){const c=this._scene.getEngine();return!c.o&&c.isNDCHalfZRange?0:1}getDepthMaxZ(C){const c=this._scene.getEngine();return c.o&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(C,c){C["DIRLIGHT"+c]=!0}}(0,b.e)([(0,X.P)()],g.prototype,"shadowFrustumSize",null),(0,b.e)([(0,X.P)()],g.prototype,"shadowOrthoScale",null),(0,b.e)([(0,X.P)()],g.prototype,"autoUpdateExtends",void 0),(0,b.e)([(0,X.P)()],g.prototype,"autoCalcShadowZBounds",void 0),(0,b.e)([(0,X.P)("orthoLeft")],g.prototype,"_orthoLeft",void 0),(0,b.e)([(0,X.P)("orthoRight")],g.prototype,"_orthoRight",void 0),(0,b.e)([(0,X.P)("orthoTop")],g.prototype,"_orthoTop",void 0),(0,b.e)([(0,X.P)("orthoBottom")],g.prototype,"_orthoBottom",void 0),(0,j.e)("BABYLON.DirectionalLight",g)},14610:(C,c,d)=>{"use strict";d.d(c,{d:()=>g});var b=d(12384),X=d(12388),P=d(12403),V=d(12438),R=d(12816),p=d(12942),j=d(12345);R.e.AddNodeConstructor("Light_Type_3",((C,c)=>()=>new g(C,P.dd.Zero(),c)));class g extends p.b{constructor(C,c,d){super(C,d),this.groundColor=new V.pd(0,0,0),this.direction=c||P.dd.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"bd"}setDirectionToTarget(C){return this.direction=P.dd.Normalize(C.Xd(P.dd.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(C,c){const d=P.dd.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",d.x,d.y,d.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Qc),c),this}transferToNodeMaterialEffect(C,c){const d=P.dd.Normalize(this.direction);return C.setFloat3(c,d.x,d.y,d.z),this}Tc(){return this._worldMatrix||(this._worldMatrix=P.Matrix.Identity()),this._worldMatrix}getTypeID(){return p.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(C,c){C["HEMILIGHT"+c]=!0}}(0,b.e)([(0,X.o)()],g.prototype,"groundColor",void 0),(0,b.e)([(0,X.L)()],g.prototype,"direction",void 0),(0,j.e)("BABYLON.HemisphericLight",g)},14073:(C,c,d)=>{"use strict";d.d(c,{b:()=>k});var b=d(12384),X=d(12388),P=d(12403),V=d(12816),R=d(12942),p=d(13018),j=d(12375),g=d(12345);V.e.AddNodeConstructor("Light_Type_2",((C,c)=>()=>new k(C,P.dd.Zero(),P.dd.Zero(),0,0,c)));class k extends p.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(C){this._iesProfileTexture!==C&&(this._iesProfileTexture=C,this._iesProfileTexture&&k._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(C){this._angle=C,this._cosHalfAngle=Math.cos(.5*C),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(C){this._innerAngle=C,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(C){this._shadowAngleScale=C,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(C){this._projectionTextureLightNear=C,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(C){this._projectionTextureLightFar=C,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(C){this._projectionTextureUpDirection=C,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(C){this._projectionTexture!==C&&(this._projectionTexture=C,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(k._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):k._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(C){return void 0!==C.onGeneratedObservable}static _IsTexture(C){return void 0!==C.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(C){this._projectionTextureProjectionLightMatrix=C,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(C,c,d,b,X,V){super(C,V),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=P.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=P.dd.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=P.dd.Zero(),this._projectionTextureViewLightMatrix=P.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=P.Matrix.Zero(),this._projectionTextureScalingMatrix=P.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=d,this.angle=b,this.exponent=X}getClassName(){return"SpotLight"}getTypeID(){return R.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(C){super._setDirection(C),this._projectionTextureViewLightDirty=!0}_setPosition(C){super._setPosition(C),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(C,c,d){const b=this.NC().activeCamera;if(!b)return;this._shadowAngleScale=this._shadowAngleScale||1;const X=this._shadowAngleScale*this._angle,V=void 0!==this.shadowMinZ?this.shadowMinZ:b.Lc,R=void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,p=this.NC().getEngine().o;P.Matrix.PerspectiveFovLHToRef(X,1,p?R:V,p?V:R,C,!0,this._scene.getEngine().isNDCHalfZRange,void 0,p)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),P.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const C=this.projectionTextureLightFar,c=this.projectionTextureLightNear,d=C/(C-c),b=-d*c,X=1/Math.tan(this._angle/2);P.Matrix.FromValuesToRef(X/1,0,0,0,0,X,0,0,0,0,d,1,0,0,b,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof j.b){const C=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;P.Matrix.FromValuesToRef(C,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(C,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),C.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),C.setTexture("projectionLightTexture"+c,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&C.setTexture("iesLightTexture"+c,this._iesProfileTexture),this}transferToEffect(C,c){let d;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),d=P.dd.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),d=P.dd.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",d.x,d.y,d.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(C,c){let d;return d=this.computeTransformedInformation()?P.dd.Normalize(this.transformedDirection):P.dd.Normalize(this.direction),this.NC().useRightHandedSystem?C.setFloat3(c,-d.x,-d.y,-d.z):C.setFloat3(c,d.x,d.y,d.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(C){const c=this._scene.getEngine(),d=void 0!==this.shadowMinZ?this.shadowMinZ:(null===C||void 0===C?void 0:C.Lc)??0;return c.o&&c.isNDCHalfZRange?d:this._scene.getEngine().isNDCHalfZRange?0:d}getDepthMaxZ(C){const c=this._scene.getEngine(),d=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===C||void 0===C?void 0:C.maxZ)??1e4;return c.o&&c.isNDCHalfZRange?0:d}prepareLightSpecificDefines(C,c){C["SPOTLIGHT"+c]=!0,C["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady()),C["IESLIGHTTEXTURE"+c]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,b.e)([(0,X.P)()],k.prototype,"angle",null),(0,b.e)([(0,X.P)()],k.prototype,"innerAngle",null),(0,b.e)([(0,X.P)()],k.prototype,"shadowAngleScale",null),(0,b.e)([(0,X.P)()],k.prototype,"exponent",void 0),(0,b.e)([(0,X.P)()],k.prototype,"projectionTextureLightNear",null),(0,b.e)([(0,X.P)()],k.prototype,"projectionTextureLightFar",null),(0,b.e)([(0,X.P)()],k.prototype,"projectionTextureUpDirection",null),(0,b.e)([(0,X.G)("projectedLightTexture")],k.prototype,"_projectionTexture",void 0),(0,g.e)("BABYLON.SpotLight",k)},13805:(C,c,d)=>{"use strict";d.d(c,{d:()=>V,g:()=>P,h:()=>R});const b={},X={};function P(C,c){b[C]=c}function V(C,c){X[C]=c}function R(C){return X[C]?X[C]:null}},13699:(C,c,d)=>{"use strict";d.d(c,{c:()=>N,f:()=>J});var b,X=d(12219),P=d(12221),V=d(12637),R=d(12255),p=d(12233),j=d(12870),g=d(12258),k=d(12261),Z=d(12352),U=d(12283),A=d(12248);!function(C){C[C.Clean=0]="Clean",C[C.Stop=1]="Stop",C[C.Sync=2]="Sync",C[C.NoSync=3]="NoSync"}(b||(b={}));const u=new P.b,q={};let B=!1;function t(){return q[".babylon"]}function e(C,c){const d=q[C];return d||(p.d.Warn("Unable to find a plugin to load "+C+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c?t():void 0)}function n(C,c,d){let b="Unable to load from "+(C.rawData?"binary data":C.url);return c?b+=`: ${c}`:d&&(b+=`: ${d}`),b}async function W(C,c,d,b,X,P,V,R,p){var j;const k="data:"===(Z=C.url).substring(0,5)?Z.substring(5):null;var Z;if(C.rawData&&!V)throw"When using ArrayBufferView to load data the file extension must be provided.";const B=k||V?"":function(C){const c=C.indexOf("?");-1!==c&&(C=C.substring(0,c));const d=C.lastIndexOf(".");return C.substring(d,C.length).toLowerCase()}(C.url);let n=V?e(V,!0):k?function(C){for(const c in q){const d=q[c].plugin;if(d.canDirectLoad&&d.canDirectLoad(C))return q[c]}return t()}(C.url):e(B,!1);if(!n&&B){if(C.url&&!C.url.startsWith("blob:")){const c=await async function(C,c){const d=c.method||"GET";return await new Promise(((b,X)=>{const P=new A.b;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const C={};if(c.responseHeaders)for(const d of c.responseHeaders)C[d]=P.getResponseHeader(d)||"";b({response:P.response,headerValues:C})}else X(`Unable to fetch data from ${C}. Error code: ${P.status}`)})),P.open(d,C),P.send()}))}(C.url,{method:"HEAD",responseHeaders:["Content-Type"]}),d=c.headerValues?c.headerValues["Content-Type"]:"";d&&(n=function(C){for(const c in q){const d=q[c];if(d.mimeType===C)return d}}(d))}n||(n=t())}if(!n)throw new Error(`No plugin or fallback for ${V??C.url}`);if(!1===(null===p||void 0===p||null===(j=p[n.plugin.name])||void 0===j?void 0:j.enabled))throw new Error(`The '${n.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(C.rawData&&!n.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(C=>{if(n.plugin.createPlugin){const c=n.plugin.createPlugin(p??{});return c instanceof Promise?(c.then(C).catch((C=>{X("Error instantiating plugin.",C)})),null):(C(c),c)}return C(n.plugin),n.plugin})((p=>{var j;if(!p)throw`The loader plugin corresponding to the '${V}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(u.notifyObservers(p),k&&(p.canDirectLoad&&p.canDirectLoad(C.url)||!(0,g.j)(C.url))){if(p.directLoad){const C=p.directLoad(c,k);C instanceof Promise?C.then((C=>{d(p,C)})).catch((C=>{X("Error in directLoad of _loadData: "+C,C)})):d(p,C)}else d(p,k);return}const Z=n.isBinary,A=(C,b)=>{c.Z?X("Scene has been disposed"):d(p,C,b)};let q=null,B=!1;null===(j=p.Uc)||void 0===j||j.add((()=>{B=!0,q&&(q.abort(),q=null),P()}));const t=()=>{if(B)return;const d=(C,c)=>{X(null===C||void 0===C?void 0:C.statusText,c)};if(!p.loadFile&&C.rawData)throw"Plugin does not support loading ArrayBufferView.";q=p.loadFile?p.loadFile(c,C.rawData||C.file||C.url,C.rootUrl,A,b,Z,d,R):c._loadFile(C.file||C.url,A,b,!0,Z,d)},e=c.getEngine();let W=e.enableOfflineSupport;if(W){let d=!1;for(const b of c.disableOfflineSupportExceptionRules)if(b.test(C.url)){d=!0;break}W=!d}W&&U.c.OfflineProviderFactory?c.offlineProvider=U.c.OfflineProviderFactory(C.url,t,e.disableManifestCheck):t()}))}function E(C,c){let d,b,P=null,V=null;if(c)if(c.name)d=`file:${c.name}`,b=c.name,P=c;else if(ArrayBuffer.isView(c))d="",b=(0,Z.c)(),V=c;else if(c.startsWith("data:"))d=c,b="";else if(C){const P=c;if("/"===P.substring(0,1))return X.Tools.Error("Wrong sceneFilename parameter"),null;d=C+P,b=P}else d=c,b=X.Tools.GetFilename(c),C=X.Tools.GetFolderPath(c);else d=C,b=X.Tools.GetFilename(C),C=X.Tools.GetFolderPath(C);return{url:d,rootUrl:C,name:b,file:P,rawData:V}}function N(C){if("string"===typeof C.extensions){const c=C.extensions;q[c.toLowerCase()]={plugin:C,isBinary:!1}}else{const c=C.extensions,d=Object.keys(c);for(const b of d)q[b.toLowerCase()]={plugin:C,isBinary:c[b].isBinary,mimeType:c[b].mimeType}}}async function r(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.c.LastCreatedScene,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!b)return p.d.Error("No scene available to import mesh to"),null;const U=E(c,d);if(!U)return null;const A={};b.addPendingData(A);const u=()=>{b.removePendingData(A)},q=(C,c)=>{const d=n(U,C,c);V?V(b,d,new k.l(d,k.h.SceneLoaderError,c)):p.d.Error(d),u()},B=P?C=>{try{P(C)}catch(c){q("Error in onProgress callback: "+c,c)}}:void 0,t=(C,c,d,P,V,R,p,j)=>{if(b.importedMeshesFiles.push(U.url),X)try{X(C,c,d,P,V,R,p,j)}catch(g){q("Error in onSuccess callback: "+g,g)}b.removePendingData(A)};return await W(U,b,((c,d,X)=>{if(c.rewriteRootURL&&(U.rootUrl=c.rewriteRootURL(U.rootUrl,X)),c.importMesh){const X=[],P=[],V=[];if(!c.importMesh(C,b,d,U.rootUrl,X,P,V,q))return;b.loadingPluginName=c.name,t(X,P,V,[],[],[],[],[])}else{c.importMeshAsync(C,b,d,U.rootUrl,B,U.name).then((C=>{b.loadingPluginName=c.name,t(C.meshes,C.LU,C.skeletons,C.animationGroups,C.transformNodes,C.geometries,C.lights,C.spriteManagers)})).catch((C=>{q(C.message,C)}))}}),B,q,u,j,g,Z)}async function M(C,c,d,b,X,P,V,R){return await new Promise(((p,j)=>{try{r(C,c,d,b,((C,c,d,b,X,P,V,R)=>{p({meshes:C,LU:c,skeletons:d,animationGroups:b,transformNodes:X,geometries:P,lights:V,spriteManagers:R})}),X,((C,c,d)=>{j(d||new Error(c))}),P,V,R).catch(j)}catch(k){j(k)}}))}async function K(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.c.LastCreatedEngine,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};d?await h(C,c,new V.e(d),b,P,p,j,g,k):X.Tools.Error("No engine available")}async function i(C,c,d,b,X,P,V){return await new Promise(((R,p)=>{K(C,c,d,(C=>{R(C)}),b,((C,c,d)=>{p(d||new Error(c))}),X,P,V)}))}async function h(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.c.LastCreatedScene,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!d)return p.d.Error("No scene available to append to"),null;const U=E(C,c);if(!U)return null;const A={};d.addPendingData(A);const u=()=>{d.removePendingData(A)};j.e.ShowLoadingScreen&&!B&&(B=!0,d.getEngine().displayLoadingUI(),d.executeWhenReady((()=>{d.getEngine().hideLoadingUI(),B=!1})));const q=(C,c)=>{const b=n(U,C,c);P?P(d,b,new k.l(b,k.h.SceneLoaderError,c)):p.d.Error(b),u()},t=X?C=>{try{X(C)}catch(c){q("Error in onProgress callback",c)}}:void 0,e=()=>{if(b)try{b(d)}catch(C){q("Error in onSuccess callback",C)}d.removePendingData(A)};return await W(U,d,((C,c)=>{if(C.load){if(!C.load(d,c,U.rootUrl,q))return;d.loadingPluginName=C.name,e()}else{C.loadAsync(d,c,U.rootUrl,t,U.name).then((()=>{d.loadingPluginName=C.name,e()})).catch((C=>{q(C.message,C)}))}}),t,q,u,V,g,Z)}async function L(C,c,d,b,X,P,V){return await new Promise(((R,p)=>{try{h(C,c,d,(C=>{R(C)}),b,((C,c,d)=>{p(d||new Error(c))}),X,P,V).catch(p)}catch(k){p(k)}}))}async function f(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.c.LastCreatedScene,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!d)return p.d.Error("No scene available to load asset container to"),null;const Z=E(C,c);if(!Z)return null;const U={};d.addPendingData(U);const A=()=>{d.removePendingData(U)},u=(C,c)=>{const b=n(Z,C,c);P?P(d,b,new k.l(b,k.h.SceneLoaderError,c)):p.d.Error(b),A()},q=X?C=>{try{X(C)}catch(c){u("Error in onProgress callback",c)}}:void 0,B=C=>{if(b)try{b(C)}catch(c){u("Error in onSuccess callback",c)}d.removePendingData(U)};return await W(Z,d,((C,c)=>{if(C.loadAssetContainer){const b=C.loadAssetContainer(d,c,Z.rootUrl,u);if(!b)return;b.populateRootNodes(),d.loadingPluginName=C.name,B(b)}else if(C.loadAssetContainerAsync){C.loadAssetContainerAsync(d,c,Z.rootUrl,q,Z.name).then((c=>{c.populateRootNodes(),d.loadingPluginName=C.name,B(c)})).catch((C=>{u(C.message,C)}))}else u("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),q,u,A,V,j,g)}async function T(C,c,d,b,X,P,V){return await new Promise(((R,p)=>{try{f(C,c,d,(C=>{R(C)}),b,((C,c,d)=>{p(d||new Error(c))}),X,P,V).catch(p)}catch(k){p(k)}}))}async function z(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.c.LastCreatedScene,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!d)return void p.d.Error("No scene available to load animations to");if(b){for(const b of d.animatables)b.reset();d.stopAllAnimations();const C=d.animationGroups.slice();for(const d of C)d.dispose();const c=d.getNodes();for(const d of c)d.animations&&(d.animations=[])}else switch(X){case 0:const C=d.animationGroups.slice();for(const c of C)c.dispose();break;case 1:for(const c of d.animationGroups)c.stop();break;case 2:for(const c of d.animationGroups)c.reset(),c.restart();break;case 3:break;default:return void p.d.Error("Unknown animation group loading mode value '"+X+"'")}const A=d.animatables.length;await f(C,c,d,(C=>{C.mergeAnimationsTo(d,d.animatables.slice(A),P),C.dispose(),d.onAnimationFileImportedObservable.notifyObservers(d),V&&V(d)}),j,g,k,Z,U)}async function w(C,c,d,b,X,P,V,R,p,j){return await new Promise(((g,Z)=>{try{z(C,c,d,b,X,P,(C=>{g(C)}),V,((C,c,d)=>{Z(d||new Error(c))}),R,p,j).catch(Z)}catch(k){Z(k)}}))}class J{static get ForceFullSceneLoadingForIncremental(){return j.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(C){j.e.ForceFullSceneLoadingForIncremental=C}static get ShowLoadingScreen(){return j.e.ShowLoadingScreen}static set ShowLoadingScreen(C){j.e.ShowLoadingScreen=C}static get loggingLevel(){return j.e.loggingLevel}static set loggingLevel(C){j.e.loggingLevel=C}static get CleanBoneMatrixWeights(){return j.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(C){j.e.CleanBoneMatrixWeights=C}static GetDefaultPlugin(){return t()}static GetPluginForExtension(C){var c;return null===(c=e(C,!0))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(C){return function(C){return!!q[C]}(C)}static RegisterPlugin(C){N(C)}static ImportMesh(C,c,d,b,X,P,V,p,j){r(C,c,d,b,X,P,V,p,j).catch((C=>null===V||void 0===V?void 0:V(R.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async ImportMeshAsync(C,c,d,b,X,P,V){return await M(C,c,d,b,X,P,V)}static Load(C,c,d,b,X,P,V,p){K(C,c,d,b,X,P,V,p).catch((C=>null===P||void 0===P?void 0:P(R.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async LoadAsync(C,c,d,b,X,P){return await i(C,c,d,b,X,P)}static Append(C,c,d,b,X,P,V,p){h(C,c,d,b,X,P,V,p).catch((C=>null===P||void 0===P?void 0:P(d??R.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async AppendAsync(C,c,d,b,X,P){return await L(C,c,d,b,X,P)}static LoadAssetContainer(C,c,d,b,X,P,V,p){f(C,c,d,b,X,P,V,p).catch((C=>null===P||void 0===P?void 0:P(d??R.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async LoadAssetContainerAsync(C,c,d,b,X,P){return await T(C,c,d,b,X,P)}static ImportAnimations(C,c,d,b,X,P,V,p,j,g,k){z(C,c,d,b,X,P,V,p,j,g,k).catch((C=>null===j||void 0===j?void 0:j(d??R.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async ImportAnimationsAsync(C,c,d,b,X,P,V,R,p,j,g){return await w(C,c,d,b,X,P,R,j,g)}}J.NO_LOGGING=0,J.MINIMAL_LOGGING=1,J.SUMMARY_LOGGING=2,J.DETAILED_LOGGING=3,J.OnPluginActivatedObservable=u},14087:(C,c,d)=>{"use strict";d.d(c,{b:()=>Z});var b=d(12384),X=d(12388),P=d(12219),V=d(12403),R=d(12426),p=d(12375),j=d(12345),g=d(12221),k=d(12431);d(14092);class Z extends R.e{set boundingBoxSize(C){if(this._boundingBoxSize&&this._boundingBoxSize.equals(C))return;this._boundingBoxSize=C;const c=this.NC();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(C){this._rotationY=C,this.setReflectionTextureMatrix(V.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(C,c,d){let b="";for(const X of C)b+=X;return new Z(b,c,null,d,C)}static CreateFromPrefilteredData(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const P=new Z(C,c,null,!1,null,null,null,void 0,!0,d,b);return c.useDelayedTextureLoading=X,P}constructor(C,c){var d;let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,t=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new g.b,this.boundingBoxPosition=V.dd.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new V.Matrix,this._buffer=null,this.name=C,this.url=C,this._noMipmap=X,this.Kc=!1,this.isCube=!0,this._textureMatrix=V.Matrix.Identity(),this.coordinatesMode=p.b.CUBIC_MODE;let e=null,n=null;null===b||Array.isArray(b)?(this._noMipmap=X,this._format=k,this._createPolynomials=A,e=b,this._loaderOptions=B,this._useSRGBBuffer=t,this._lodScale=u,this._lodOffset=q):(e=b.extensions??null,this._noMipmap=b.noMipmap??!1,P=b.files??null,n=b.buffer??null,this._format=b.format??5,Z=b.prefiltered??!1,U=b.forcedExtension??null,this._createPolynomials=b.createPolynomials??!1,this._lodScale=b.lodScale??.8,this._lodOffset=b.lodOffset??0,this._loaderOptions=b.loaderOptions,this._useSRGBBuffer=b.useSRGBBuffer,R=b.S??null,j=b.onError??null),(C||P)&&this.updateURL(C,U,R,Z,j,e,null===(d=this.NC())||void 0===d?void 0:d.useDelayedTextureLoading,P,n)}getClassName(){return"CubeTexture"}updateURL(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=C),this.url=C,c&&(this._forcedExtension=c);const j=C.lastIndexOf("."),g=c||(j>-1?C.substring(j).toLowerCase():""),k=0===g.indexOf(".dds"),Z=0===g.indexOf(".env"),U=0===g.indexOf(".basis");if(Z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=b,b&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),R)this._files=R;else if(U||Z||k||P||(P=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,P){for(let c=0;c<P.length;c++)this._files.push(C+P[c]);this._extensions=P}this._buffer=p,V?(this.delayLoadState=4,this._delayedOnLoad=d,this._delayedOnError=X):this._loadTexture(d,X)}delayLoad(C){4===this.delayLoadState&&(C&&(this._forcedExtension=C),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(C){var c,d;if(C.updateFlag===this._textureMatrix.updateFlag)return;C.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(d=this.NC())||void 0===d||d.markAllMaterialsAsDirty(1,(C=>-1!==C.getActiveTextures().indexOf(this))));if(this._textureMatrix=C,null===(c=this.NC())||void 0===c||!c.useRightHandedSystem)return;const b=V.TmpVectors.dd[0],X=V.TmpVectors.Quaternion[0],P=V.TmpVectors.dd[1];this._textureMatrix.decompose(b,X,P),X.z*=-1,X.w*=-1,V.Matrix.ComposeToRef(b,X,P,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var C;return null!==(C=this.NC())&&void 0!==C&&C.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=this.NC(),b=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const X=()=>{var c;(this.onLoadObservable.notifyObservers(this),b)&&(b.dispose(),null===(c=this.NC())||void 0===c||c.markAllMaterialsAsDirty(1));C&&C()},V=(C,d)=>{this._loadingError=!0,this._errorObject={message:C,exception:d},c&&c(C,d),p.b.OnTextureLoadErrorObservable.notifyObservers(this)};var R;this._texture?this._texture.isReady?P.Tools.SetImmediate((()=>X())):this._texture.onLoadedObservable.add((()=>X())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,d,this._lodScale,this._lodOffset,C,V,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,d,this._files,this._noMipmap,C,V,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(R=this._texture)||void 0===R||R.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(C,c,d){const b=k.e.Parse((()=>{let b=!1;return C.prefiltered&&(b=C.prefiltered),new Z(d+(C.url??C.name),c,C.extensions,!1,C.files||null,null,null,void 0,b,C.forcedExtension)}),C,c);if(C.boundingBoxPosition&&(b.boundingBoxPosition=V.dd.jd(C.boundingBoxPosition)),C.boundingBoxSize&&(b.boundingBoxSize=V.dd.jd(C.boundingBoxSize)),C.animations)for(let X=0;X<C.animations.length;X++){const c=C.animations[X],d=(0,j.b)("BABYLON.Animation");d&&b.animations.push(d.Parse(c))}return b}clone(){let C=0;const c=k.e.Clone((()=>{const c=new Z(this.url,this.NC()||this._getEngine(),this._extensions,this._noMipmap,this._files);return C=c.uniqueId,c}),this);return c.uniqueId=C,c}}(0,b.e)([(0,X.P)()],Z.prototype,"url",void 0),(0,b.e)([(0,X.L)()],Z.prototype,"boundingBoxPosition",void 0),(0,b.e)([(0,X.L)()],Z.prototype,"boundingBoxSize",null),(0,b.e)([(0,X.P)("rotationY")],Z.prototype,"rotationY",null),(0,b.e)([(0,X.P)("files")],Z.prototype,"_files",void 0),(0,b.e)([(0,X.P)("forcedExtension")],Z.prototype,"_forcedExtension",void 0),(0,b.e)([(0,X.P)("extensions")],Z.prototype,"_extensions",void 0),(0,b.e)([(0,X.z)("textureMatrix")],Z.prototype,"_textureMatrix",void 0),(0,b.e)([(0,X.z)("textureMatrixRefraction")],Z.prototype,"_textureMatrixRefraction",void 0),p.b._CubeTextureParser=Z.Parse,(0,j.e)("BABYLON.CubeTexture",Z)},14622:(C,c,d)=>{"use strict";d.d(c,{e:()=>p});var b=d(12233),X=d(12375),P=d(12361),V=d(12538),R=d(12316);V.ThinEngine.prototype.createDynamicTexture=function(C,c,d,b){const X=new R.d(this,4);return X.baseWidth=C,X.baseHeight=c,d&&(C=this.needPOTTextures?(0,P.g)(C,this._caps.maxTextureSize):C,c=this.needPOTTextures?(0,P.g)(c,this._caps.maxTextureSize):c),X.width=C,X.height=c,X.isReady=!1,X.generateMipMaps=d,X.samplingMode=b,this.updateTextureSamplingMode(b,X),this._internalTexturesCache.push(X),X},V.ThinEngine.prototype.updateDynamicTexture=function(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!C)return;const V=this._gl,R=V.TEXTURE_2D,p=this._bindTextureDirectly(R,C,!0,P);this._unpackFlipY(void 0===d?C.invertY:d),b&&V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const j=this._getWebGLTextureType(C.type),g=this._getInternalFormat(X||C.format),k=this._getRGBABufferInternalSizedFormat(C.type,g);V.texImage2D(R,0,k,g,j,c),C.generateMipMaps&&V.generateMipmap(R),p||this._bindTextureDirectly(R,null),b&&V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),X&&(C.format=X),C._dynamicTextureSource=c,C._premulAlpha=b,C.invertY=d||!1,C.isReady=!0};class p extends X.b{constructor(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,R=arguments.length>6?arguments[6]:void 0;const p=!d||d._isScene;super(null,p?d:null===d||void 0===d?void 0:d.Pd,p?!b:d,R,P,void 0,void 0,void 0,void 0,V),this.name=C,this.wrapU=X.b.CLAMP_ADDRESSMODE,this.wrapV=X.b.CLAMP_ADDRESSMODE,this._generateMipMaps=b;const j=this._getEngine();if(!j)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=j.createDynamicTexture(this._canvas.width,this._canvas.height,b,P);else{this._canvas=j.createCanvas(1,1),this._ownCanvas=!0;const C=c;C.width||0===C.width?this._texture=j.createDynamicTexture(C.width,C.height,b,P):this._texture=j.createDynamicTexture(c,c,b,P)}const g=this.getSize();this._canvas.width!==g.width&&(this._canvas.width=g.width),this._canvas.height!==g.height&&(this._canvas.height=g.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(C){this._canvas.width=C.width,this._canvas.height=C.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(C.width,C.height,this._generateMipMaps,this.samplingMode)}scale(C){const c=this.getSize();c.width*=C,c.height*=C,this._recreate(c)}scaleTo(C,c){const d=this.getSize();d.width=C,d.height=c,this._recreate(d)}getContext(){return this._context}clear(C){const c=this.getSize();C&&(this._context.fillStyle=C),this._context.clearRect(0,0,c.width,c.height)}update(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===C||C,c,this._format||void 0,void 0,d)}drawText(C,c,d,b,X,P,V){let R=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const p=this.getSize();if(P&&(this._context.fillStyle=P,this._context.fillRect(0,0,p.width,p.height)),this._context.font=b,null===c||void 0===c){const d=this._context.measureText(C);c=(p.width-d.width)/2}if(null===d||void 0===d){const C=parseInt(b.replace(/\D/g,""));d=p.height/2+C/3.65}this._context.fillStyle=X||"",this._context.fillText(C,c,d),R&&this.update(V)}dispose(){var C,c;(super.dispose(),this._ownCanvas)&&(null===(C=this._canvas)||void 0===C||null===(c=C.remove)||void 0===c||c.call(C));this._canvas=null,this._context=null}clone(){const C=this.NC();if(!C)return this;const c=this.getSize(),d=new p(this.name,c,C,this._generateMipMaps);return d.Kc=this.Kc,d.level=this.level,d.wrapU=this.wrapU,d.wrapV=this.wrapV,d}serialize(){const C=this.NC();C&&!C.isReady()&&b.d.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return p._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(C){return void 0!==C.toDataURL}_rebuild(){this.update()}}},13991:(C,c,d)=>{"use strict";d.d(c,{d:()=>X});var b=d(12375);class X extends b.b{get depth(){return this._depth}constructor(C,c,d,X,P,V){let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:b.b.TRILINEAR_SAMPLINGMODE,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10?arguments[10]:void 0;super(null,V,!R,p),this.format=P,this._texture=V.getEngine().createRawTexture2DArray(C,c,d,X,P,R,p,j,null,g,k),this._depth=X,this.is2DArray=!0}update(C){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,C,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(C,c,d,b,P){return new X(C,c,d,b,5,P,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13823:(C,c,d)=>{"use strict";d.d(c,{d:()=>R,e:()=>p,f:()=>P,h:()=>V});var b=d(12418),X=d(12403);function P(C,c){return`{X: ${C.x.toFixed(c)} Y: ${C.y.toFixed(c)}}`}function V(C,c){return`{X: ${C._x.toFixed(c)} Y: ${C._y.toFixed(c)} Z: ${C._z.toFixed(c)}}`}function R(C,c){return 2*Math.acos((0,b.Clamp)(X.Quaternion.Dot(C,c)))}function p(C,c){const d=new X.Quaternion;return function(C,c,d){const P=X.dd.Cross(C,c),V=Math.acos((0,b.Clamp)(X.dd.Dot(C,c),-1,1));X.Quaternion.RotationAxisToRef(P,V,d)}(C,c,d),d}},13646:(C,c,d)=>{"use strict";d.d(c,{e:()=>j});var b=d(12403),X=d(12438),P=d(12848),V=d(12828),R=d(12447);d(13648);function p(C){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const d=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],P=[];let p=[];const j=C.width||C.size||1,g=C.height||C.size||1,k=C.depth||C.size||1,Z=C.wrap||!1;let U=void 0===C.topBaseAt?1:C.topBaseAt,A=void 0===C.bottomBaseAt?0:C.bottomBaseAt;U=(U+4)%4,A=(A+4)%4;let u=[2,0,3,1][U],q=[2,0,1,3][A],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Z){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let C=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],d=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const b=[17,18,19,16],X=[22,23,20,21];for(;u>0;)C.unshift(C.pop()),b.unshift(b.pop()),u--;for(;q>0;)d.unshift(d.pop()),X.unshift(X.pop()),q--;C=C.flat(),d=d.flat(),B=B.concat(C).concat(d),c.push(b[0],b[2],b[3],b[0],b[1],b[2]),c.push(X[0],X[2],X[3],X[0],X[1],X[2])}const t=[j/2,g/2,k/2];p=B.reduce(((C,c,d)=>C.concat(c*t[d%3])),[]);const e=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,n=C.faceUV||new Array(6),W=C.faceColors,E=[];for(let V=0;V<6;V++)void 0===n[V]&&(n[V]=new b.Vector4(0,0,1,1)),W&&void 0===W[V]&&(W[V]=new X.vc(1,1,1,1));for(let b=0;b<6;b++)if(P.push(n[b].z,R.e?1-n[b].w:n[b].w),P.push(n[b].x,R.e?1-n[b].w:n[b].w),P.push(n[b].x,R.e?1-n[b].y:n[b].y),P.push(n[b].z,R.e?1-n[b].y:n[b].y),W)for(let C=0;C<4;C++)E.push(W[b].r,W[b].g,W[b].b,W[b].a);V.e._ComputeSides(e,p,c,d,P,C.frontUVs,C.backUVs);const N=new V.e;if(N.indices=c,N.MC=p,N.KC=d,N.hC=P,W){const C=e===V.e.DOUBLESIDE?E.concat(E):E;N.iC=C}return N}function j(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new P.b(C,d);c.sideOrientation=P.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return p(c).fC(b,c.updatable),b}V.e.CreateBox=p,P.b.CreateBox=function(C,c){return j(C,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13814:(C,c,d)=>{"use strict";d.d(c,{b:()=>R});var b=d(12848),X=d(12828),P=d(12447);function V(C){const c=[],d=[],b=[],V=[],R=C.radius||.5,p=C.tessellation||64,j=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,g=0===C.sideOrientation?0:C.sideOrientation||X.e.DEFAULTSIDE;c.push(0,0,0),V.push(.5,.5);const k=2*Math.PI*j,Z=1===j?k/p:k/(p-1);let U=0;for(let X=0;X<p;X++){const C=Math.cos(U),d=Math.sin(U),b=(C+1)/2,X=(1-d)/2;c.push(R*C,R*d,0),V.push(b,P.e?1-X:X),U+=Z}1===j&&(c.push(c[3],c[4],c[5]),V.push(V[2],P.e?1-V[3]:V[3]));const A=c.length/3;for(let X=1;X<A-1;X++)d.push(X+1,0,X);X.e.ComputeNormals(c,d,b),X.e._ComputeSides(g,c,d,b,V,C.frontUVs,C.backUVs);const u=new X.e;return u.indices=d,u.MC=c,u.KC=b,u.hC=V,u}function R(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new b.b(C,d);c.sideOrientation=b.b._GetDefaultSideOrientation(c.sideOrientation),X._originalBuilderSideOrientation=c.sideOrientation;return V(c).fC(X,c.updatable),X}X.e.CreateDisc=V,b.b.CreateDisc=function(C,c,d){return R(C,{radius:c,tessellation:d,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13648:(C,c,d)=>{"use strict";d.d(c,{g:()=>q,c:()=>t,h:()=>B});var b=d(12403),X=d(12438),P=d(12848),V=d(12828),R=d(12471);P.b._GroundMeshParser=(C,c)=>p.Parse(C,c);class p extends P.b{constructor(C,c){super(C,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=C,this._subdivisionsY=C,this.subdivide(C);const d=this;d.createOrUpdateSubmeshesOctree&&d.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(C,c){const d=this.getWorldMatrix(),X=b.TmpVectors.Matrix[5];d.invertToRef(X);const P=b.TmpVectors.dd[8];if(b.dd.TransformCoordinatesFromFloatsToRef(C,0,c,X,P),C=P.x,c=P.z,C<this._minX||C>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const V=this._getFacetAt(C,c),R=-(V.x*C+V.z*c+V.w)/V.y;return b.dd.TransformCoordinatesFromFloatsToRef(0,R,0,d,P),P.y}getNormalAtCoordinates(C,c){const d=new b.dd(0,1,0);return this.getNormalAtCoordinatesToRef(C,c,d),d}getNormalAtCoordinatesToRef(C,c,d){const X=this.getWorldMatrix(),P=b.TmpVectors.Matrix[5];X.invertToRef(P);const V=b.TmpVectors.dd[8];if(b.dd.TransformCoordinatesFromFloatsToRef(C,0,c,P,V),C=V.x,c=V.z,C<this._minX||C>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const R=this._getFacetAt(C,c);return b.dd.TransformNormalFromFloatsToRef(R.x,R.y,R.z,X,d),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(C,c){const d=Math.floor((C+this._maxX)*this._subdivisionsX/this._width),b=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),X=this._heightQuads[b*this._subdivisionsX+d];let P;return P=c<X.slope.x*C+X.slope.y?X.facet1:X.facet2,P}_initHeightQuads(){const C=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=[];for(let d=0;d<c;d++)for(let c=0;c<C;c++){const X={slope:b.Vector2.Zero(),facet1:new b.Vector4(0,0,0,0),facet2:new b.Vector4(0,0,0,0)};this._heightQuads[d*C+c]=X}return this}_computeHeightQuads(){const C=this.getVerticesData(R.g.PositionKind);if(!C)return this;const c=b.TmpVectors.dd[3],d=b.TmpVectors.dd[2],X=b.TmpVectors.dd[1],P=b.TmpVectors.dd[0],V=b.TmpVectors.dd[4],p=b.TmpVectors.dd[5],j=b.TmpVectors.dd[6],g=b.TmpVectors.dd[7],k=b.TmpVectors.dd[8];let Z=0,U=0,A=0,u=0,q=0,B=0,t=0;const e=this._subdivisionsX,n=this._subdivisionsY;for(let R=0;R<n;R++)for(let n=0;n<e;n++){Z=3*n,U=R*(e+1)*3,A=(R+1)*(e+1)*3,c.x=C[U+Z],c.y=C[U+Z+1],c.z=C[U+Z+2],d.x=C[U+Z+3],d.y=C[U+Z+4],d.z=C[U+Z+5],X.x=C[A+Z],X.y=C[A+Z+1],X.z=C[A+Z+2],P.x=C[A+Z+3],P.y=C[A+Z+4],P.z=C[A+Z+5],u=(P.z-c.z)/(P.x-c.x),q=c.z-u*c.x,d.subtractToRef(c,V),X.subtractToRef(c,p),P.subtractToRef(c,j),b.dd.CrossToRef(j,p,g),b.dd.CrossToRef(V,j,k),g.normalize(),k.normalize(),B=-(g.x*c.x+g.y*c.y+g.z*c.z),t=-(k.x*d.x+k.y*d.y+k.z*d.z);const W=this._heightQuads[R*e+n];W.slope.yc(u,q),W.facet1.yc(g.x,g.y,g.z,B),W.facet2.yc(k.x,k.y,k.z,t)}return this}serialize(C){super.serialize(C),C.subdivisionsX=this._subdivisionsX,C.subdivisionsY=this._subdivisionsY,C.minX=this._minX,C.maxX=this._maxX,C.Lc=this._minZ,C.maxZ=this._maxZ,C.width=this._width,C.height=this._height}static Parse(C,c){const d=new p(C.name,c);return d._subdivisionsX=C.subdivisionsX||1,d._subdivisionsY=C.subdivisionsY||1,d._minX=C.minX,d._maxX=C.maxX,d._minZ=C.Lc,d._maxZ=C.maxZ,d._width=C.width,d._height=C.height,d}}var j=d(12219),g=d(12255),k=d(12412),Z=d(12447);function U(C){const c=[],d=[],X=[],P=[];let R,p;const j=C.width||C.size||1,g=C.height||C.size||1,k=0|(C.subdivisionsX||C.subdivisions||1),U=0|(C.subdivisionsY||C.subdivisions||1);for(R=0;R<=U;R++)for(p=0;p<=k;p++){const C=new b.dd(p*j/k-j/2,0,(U-R)*g/U-g/2),c=new b.dd(0,1,0);d.push(C.x,C.y,C.z),X.push(c.x,c.y,c.z),P.push(p/k,Z.e?R/U:1-R/U)}for(R=0;R<U;R++)for(p=0;p<k;p++)c.push(p+1+(R+1)*(k+1)),c.push(p+1+R*(k+1)),c.push(p+R*(k+1)),c.push(p+(R+1)*(k+1)),c.push(p+1+(R+1)*(k+1)),c.push(p+R*(k+1));const A=new V.e;return A.indices=c,A.MC=d,A.KC=X,A.hC=P,A}function A(C){const c=void 0!==C.xmin&&null!==C.xmin?C.xmin:-1,d=void 0!==C.zmin&&null!==C.zmin?C.zmin:-1,X=void 0!==C.xmax&&null!==C.xmax?C.xmax:1,P=void 0!==C.zmax&&null!==C.zmax?C.zmax:1,R=C.subdivisions||{w:1,h:1},p=C.precision||{w:1,h:1},j=[],g=[],k=[],Z=[];let U,A,u,q;R.h=R.h<1?1:R.h,R.w=R.w<1?1:R.w,p.w=p.w<1?1:p.w,p.h=p.h<1?1:p.h;const B=(X-c)/R.w,t=(P-d)/R.h;function e(C,c,d,X){const P=g.length/3,V=p.w+1;for(U=0;U<p.h;U++)for(A=0;A<p.w;A++){const C=[P+A+U*V,P+(A+1)+U*V,P+(A+1)+(U+1)*V,P+A+(U+1)*V];j.push(C[1]),j.push(C[2]),j.push(C[3]),j.push(C[0]),j.push(C[1]),j.push(C[3])}const R=b.dd.Zero(),u=new b.dd(0,1,0);for(U=0;U<=p.h;U++)for(R.z=U*(X-c)/p.h+c,A=0;A<=p.w;A++)R.x=A*(d-C)/p.w+C,R.y=0,g.push(R.x,R.y,R.z),k.push(u.x,u.y,u.z),Z.push(A/p.w,U/p.h)}for(u=0;u<R.h;u++)for(q=0;q<R.w;q++)e(c+q*B,d+u*t,c+(q+1)*B,d+(u+1)*t);const n=new V.e;return n.indices=j,n.MC=g,n.KC=k,n.hC=Z,n}function u(C){const c=[],d=[],P=[],R=[];let p,j;const g=C.colorFilter||new X.pd(.3,.59,.11),Z=C.alphaFilter||0;let U=!1;if(C.minHeight>C.maxHeight){U=!0;const c=C.maxHeight;C.maxHeight=C.minHeight,C.minHeight=c}for(p=0;p<=C.subdivisions;p++)for(j=0;j<=C.subdivisions;j++){const c=new b.dd(j*C.width/C.subdivisions-C.width/2,0,(C.subdivisions-p)*C.height/C.subdivisions-C.height/2),X=4*(((c.x+C.width/2)/C.width*(C.bufferWidth-1)|0)+((1-(c.z+C.height/2)/C.height)*(C.bufferHeight-1)|0)*C.bufferWidth);let V=C.buffer[X]/255,A=C.buffer[X+1]/255,u=C.buffer[X+2]/255;const q=C.buffer[X+3]/255;U&&(V=1-V,A=1-A,u=1-u);const B=V*g.r+A*g.g+u*g.b;c.y=q>=Z?C.minHeight+(C.maxHeight-C.minHeight)*B:C.minHeight-k.d,C.heightBuffer&&(C.heightBuffer[p*(C.subdivisions+1)+j]=c.y),d.push(c.x,c.y,c.z),P.push(0,0,0),R.push(j/C.subdivisions,1-p/C.subdivisions)}for(p=0;p<C.subdivisions;p++)for(j=0;j<C.subdivisions;j++){const b=j+1+(p+1)*(C.subdivisions+1),X=j+1+p*(C.subdivisions+1),P=j+p*(C.subdivisions+1),V=j+(p+1)*(C.subdivisions+1),R=d[3*b+1]>=C.minHeight,g=d[3*X+1]>=C.minHeight,k=d[3*P+1]>=C.minHeight;R&&g&&k&&(c.push(b),c.push(X),c.push(P));d[3*V+1]>=C.minHeight&&R&&k&&(c.push(V),c.push(b),c.push(P))}V.e.ComputeNormals(d,c,P);const A=new V.e;return A.indices=c,A.MC=d,A.KC=P,A.hC=R,A}function q(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=new p(C,arguments.length>2?arguments[2]:void 0);d._setReady(!1),d._subdivisionsX=c.subdivisionsX||c.subdivisions||1,d._subdivisionsY=c.subdivisionsY||c.subdivisions||1,d._width=c.width||1,d._height=c.height||1,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ;return U(c).fC(d,c.updatable),d._setReady(!0),d}function B(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new P.b(C,d);return A(c).fC(b,c.updatable),b}function t(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const P=d.width||10,V=d.height||10,R=d.subdivisions||1,k=d.minHeight||0,Z=d.maxHeight||1,U=d.colorFilter||new X.pd(.3,.59,.11),A=d.alphaFilter||0,q=d.updatable,B=d.onReady;b=b||g.c.LastCreatedScene;const t=new p(C,b);let e;t._subdivisionsX=R,t._subdivisionsY=R,t._width=P,t._height=V,t._maxX=t._width/2,t._maxZ=t._height/2,t._minX=-t._maxX,t._minZ=-t._maxZ,t._setReady(!1),d.passHeightBufferInCallback&&(e=new Float32Array((R+1)*(R+1)));const n=(C,c,d)=>{u({width:P,height:V,subdivisions:R,minHeight:k,maxHeight:Z,colorFilter:U,buffer:C,bufferWidth:c,bufferHeight:d,alphaFilter:A,heightBuffer:e}).fC(t,q),B&&B(t,e),t._setReady(!0)};if("string"===typeof c){const C=C=>{var c;const d=C.width,X=C.height;if(b.Z)return;const P=null===(c=b)||void 0===c?void 0:c.getEngine().resizeImageBitmap(C,d,X);n(P,d,X)};j.Tools.LoadImage(c,C,d.onError?d.onError:()=>{},b.offlineProvider)}else n(c.data,c.width,c.height);return t}V.e.CreateGround=U,V.e.CreateTiledGround=A,V.e.CreateGroundFromHeightMap=u,P.b.CreateGround=(C,c,d,b,X,P)=>q(C,{width:c,height:d,subdivisions:b,updatable:P},X),P.b.CreateTiledGround=(C,c,d,b,X,P,V,R,p)=>B(C,{xmin:c,zmin:d,xmax:b,zmax:X,subdivisions:P,precision:V,updatable:p},R),P.b.CreateGroundFromHeightMap=(C,c,d,b,X,P,V,R,p,j,g)=>t(C,c,{width:d,height:b,subdivisions:X,minHeight:P,maxHeight:V,updatable:p,onReady:j,alphaFilter:g},R)},14316:(C,c,d)=>{"use strict";d.d(c,{b:()=>U,f:()=>k,i:()=>Z});var b=d(12403),X=d(12848),P=d(12828),V=d(12951),R=d(12471),p=d(12233);function j(C){const c=[],d=[],b=C.lines,X=C.iC,V=[];let R=0;for(let P=0;P<b.length;P++){const C=b[P];for(let b=0;b<C.length;b++){const{x:p,y:j,z:g}=C[b];if(d.push(p,j,g),X){const C=X[P],{r:c,g:d,b:R,a:p}=C[b];V.push(c,d,R,p)}b>0&&(c.push(R-1),c.push(R)),R++}}const p=new P.e;return p.indices=c,p.MC=d,X&&(p.iC=V),p}function g(C){const c=C.dashSize||3,d=C.gapSize||1,X=C.dashNb||200,V=C.points,R=[],p=[],j=b.dd.Zero();let g=0,k=0,Z=0,U=0,A=0,u=0,q=0;for(q=0;q<V.length-1;q++)V[q+1].subtractToRef(V[q],j),g+=j.length();for(Z=g/X,U=c*Z/(c+d),q=0;q<V.length-1;q++){V[q+1].subtractToRef(V[q],j),k=Math.floor(j.length()/Z),j.normalize();for(let C=0;C<k;C++)A=Z*C,R.push(V[q].x+A*j.x,V[q].y+A*j.y,V[q].z+A*j.z),R.push(V[q].x+(A+U)*j.x,V[q].y+(A+U)*j.y,V[q].z+(A+U)*j.z),p.push(u,u+1),u+=2}const B=new P.e;return B.MC=R,B.indices=p,B}function k(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=c.instance,X=c.lines,P=c.iC;if(b){const C=b.getVerticesData(R.g.PositionKind);let c,d;P&&(c=b.getVerticesData(R.g.ColorKind));let V=0,p=0;for(let b=0;b<X.length;b++){const R=X[b];for(let X=0;X<R.length;X++)C[V]=R[X].x,C[V+1]=R[X].y,C[V+2]=R[X].z,P&&c&&(d=P[b],c[p]=d[X].r,c[p+1]=d[X].g,c[p+2]=d[X].b,c[p+3]=d[X].a,p+=4),V+=3}return b.updateVerticesData(R.g.PositionKind,C,!1,!1),P&&c&&b.updateVerticesData(R.g.ColorKind,c,!1,!1),b.refreshBoundingInfo(),b}const p=!!P,g=new V.b(C,d,null,void 0,void 0,p,c.useVertexAlpha,c.material);return j(c).fC(g,c.updatable),g}function Z(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=c.iC?[c.iC]:null;return k(C,{lines:[c.points],updatable:c.updatable,instance:c.instance,iC:b,useVertexAlpha:c.useVertexAlpha,material:c.material},d)}function U(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.points,R=c.instance,j=c.gapSize||1,k=c.dashSize||3;if(R){const C=C=>{const c=b.dd.Zero(),d=C.length/6;let X=0,V=0,p=0,j=0,g=0,k=0,Z=0,U=0;for(Z=0;Z<P.length-1;Z++)P[Z+1].subtractToRef(P[Z],c),X+=c.length();p=X/d;const A=R._creationDataStorage.dashSize;for(j=A*p/(A+R._creationDataStorage.gapSize),Z=0;Z<P.length-1;Z++)for(P[Z+1].subtractToRef(P[Z],c),V=Math.floor(c.length()/p),c.normalize(),U=0;U<V&&k<C.length;)g=p*U,C[k]=P[Z].x+g*c.x,C[k+1]=P[Z].y+g*c.y,C[k+2]=P[Z].z+g*c.z,C[k+3]=P[Z].x+(g+j)*c.x,C[k+4]=P[Z].y+(g+j)*c.y,C[k+5]=P[Z].z+(g+j)*c.z,k+=6,U++;for(;k<C.length;)C[k]=P[Z].x,C[k+1]=P[Z].y,C[k+2]=P[Z].z,k+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&p.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),R.updateMeshPositions(C,!1),R}const Z=new V.b(C,d,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return g(c).fC(Z,c.updatable),Z._creationDataStorage=new X.d,Z._creationDataStorage.dashSize=k,Z._creationDataStorage.gapSize=j,Z}P.e.CreateLineSystem=j,P.e.CreateDashedLines=g,X.b.Gg=function(C,c){return Z(C,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},X.b.CreateDashedLines=function(C,c,d,b,X){return U(C,{points:c,dashSize:d,gapSize:b,dashNb:X,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13708:(C,c,d)=>{"use strict";d.d(c,{e:()=>R,f:()=>p});var b=d(12848),X=d(12828),P=d(12447);function V(C){const c=[],d=[],b=[],V=[],R=void 0!==C.width?C.width:void 0!==C.size?C.size:1,p=void 0!==C.height?C.height:void 0!==C.size?C.size:1,j=0===C.sideOrientation?0:C.sideOrientation||X.e.DEFAULTSIDE,g=R/2,k=p/2;d.push(-g,-k,0),b.push(0,0,-1),V.push(0,P.e?1:0),d.push(g,-k,0),b.push(0,0,-1),V.push(1,P.e?1:0),d.push(g,k,0),b.push(0,0,-1),V.push(1,P.e?0:1),d.push(-g,k,0),b.push(0,0,-1),V.push(0,P.e?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),X.e._ComputeSides(j,d,c,b,V,C.frontUVs,C.backUVs);const Z=new X.e;return Z.indices=c,Z.MC=d,Z.KC=b,Z.hC=V,Z}function R(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new b.b(C,d);c.sideOrientation=b.b._GetDefaultSideOrientation(c.sideOrientation),X._originalBuilderSideOrientation=c.sideOrientation;return V(c).fC(X,c.updatable),c.sourcePlane&&(X.translate(c.sourcePlane.normal,-c.sourcePlane.d),X.setDirection(c.sourcePlane.normal.scale(-1))),X}const p={Ck:R};X.e.Ck=V,b.b.Ck=(C,c,d,b,X)=>R(C,{size:c,width:c,height:c,sideOrientation:X,updatable:b},d)},13798:(C,c,d)=>{"use strict";d.d(c,{c:()=>p});var b=d(12403),X=d(12848),P=d(12828),V=d(12447);function R(C){const c=0|(C.segments||32),d=C.diameterX||C.diameter||1,X=C.diameterY||C.diameter||1,R=C.diameterZ||C.diameter||1,p=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,j=C.slice&&C.slice<=0?1:C.slice||1,g=0===C.sideOrientation?0:C.sideOrientation||P.e.DEFAULTSIDE,k=!!C.dedupTopBottomIndices,Z=new b.dd(d/2,X/2,R/2),U=2+c,A=2*U,u=[],q=[],B=[],t=[];for(let P=0;P<=U;P++){const C=P/U,c=C*Math.PI*j;for(let d=0;d<=A;d++){const X=d/A,P=X*Math.PI*2*p,R=b.Matrix.RotationZ(-c),j=b.Matrix.RotationY(P),g=b.dd.TransformCoordinates(b.dd.Up(),R),k=b.dd.TransformCoordinates(g,j),U=k.multiply(Z),u=k.divide(Z).normalize();q.push(U.x,U.y,U.z),B.push(u.x,u.y,u.z),t.push(X,V.e?1-C:C)}if(P>0){const C=q.length/3;for(let c=C-2*(A+1);c+A+2<C;c++)k?(P>1&&(u.push(c),u.push(c+1),u.push(c+A+1)),(P<U||j<1)&&(u.push(c+A+1),u.push(c+1),u.push(c+A+2))):(u.push(c),u.push(c+1),u.push(c+A+1),u.push(c+A+1),u.push(c+1),u.push(c+A+2))}}P.e._ComputeSides(g,q,u,B,t,C.frontUVs,C.backUVs);const e=new P.e;return e.indices=u,e.MC=q,e.KC=B,e.hC=t,e}function p(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return R(c).fC(b,c.updatable),b}P.e.CreateSphere=R,X.b.CreateSphere=(C,c,d,b,X,P)=>p(C,{segments:c,diameterX:d,diameterY:d,diameterZ:d,sideOrientation:P,updatable:X},b)},14634:(C,c,d)=>{"use strict";d.d(c,{e:()=>R});var b=d(12982),X=d(14097),P=d(13005),V=d(12828);class R{static get Configuration(){return{get decoder(){return X.c.DefaultConfiguration},set decoder(C){X.c.DefaultConfiguration=C}}}static set Configuration(C){X.c.DefaultConfiguration=C.decoder}static get DecoderAvailable(){return(0,b.i)(X.c.DefaultConfiguration)}static get Default(){return R._Default??(R._Default=new R),R._Default}static ResetDefault(C){R._Default&&(C||R._Default.dispose(),R._Default=null)}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultNumWorkers;const c="number"===typeof C?{...X.c.DefaultConfiguration,numWorkers:C}:{...X.c.DefaultConfiguration,...C};this._decoder=new X.c(c)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(C,c,d){return this._decoder.decodeMeshToMeshDataAsync(C,c,d)}async decodeMeshToGeometryAsync(C,c,d,b){return await this._decoder.decodeMeshToGeometryAsync(C,c,d,b)}async _decodeMeshToGeometryForGltfAsync(C,c,d,b,X,P){return await this._decoder._decodeMeshToGeometryForGltfAsync(C,c,d,b,X,P)}async decodeMeshAsync(C,c){const d=await this._decoder.decodeMeshToMeshDataAsync(C,c),b=new V.e;d.indices&&(b.indices=d.indices);for(const X of d.attributes){const C=P.d.GetFloatData(X.data,X.size,P.d.GetDataType(X.data),X.byteOffset,X.byteStride,X.normalized,d.totalVertices);b.set(C,X.kind)}return b}}R.DefaultNumWorkers=(0,b.f)(),R._Default=null},14097:(C,c,d)=>{"use strict";d.d(c,{c:()=>j});var b=d(12982),X=d(12219),P=d(12864),V=d(13005),R=d(12233),p=d(12996);class j extends b.e{static get DefaultAvailable(){return(0,b.i)(j.DefaultConfiguration)}static get Default(){return j._Default??(j._Default=new j),j._Default}static ResetDefault(C){j._Default&&(C||j._Default.dispose(),j._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(C,c){return{module:await(c||DracoDecoderModule)({wasmBinary:C})}}_getWorkerContent(){return`${p.e}(${p.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultConfiguration)}decodeMeshToMeshDataAsync(C,c,d){const b=C instanceof ArrayBuffer?new Int8Array(C):new Int8Array(C.buffer,C.byteOffset,C.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async C=>await new Promise(((X,P)=>{C.push(((C,V)=>{let p=null;const j=[],g=c=>{C.removeEventListener("error",g),C.removeEventListener("message",k),P(c),V()},k=c=>{const b=c.data;switch(b.id){case"indices":p=b.data;break;case"attribute":j.push({kind:b.kind,data:b.data,size:b.size,byteOffset:b.byteOffset,byteStride:b.byteStride,normalized:(P=b.kind,Z=b.normalized,d&&void 0!==d[P]?(Z!==d[P]&&R.d.Warn(`Normalized flag from Draco data (${Z}) does not match normalized flag from glTF accessor (${d[P]}). Using flag from glTF accessor.`),d[P]):Z)});break;case"decodeMeshDone":C.removeEventListener("error",g),C.removeEventListener("message",k),X({indices:p,attributes:j,totalVertices:b.totalVertices}),V()}var P,Z};C.addEventListener("error",g),C.addEventListener("message",k);const Z=b.slice();C.postMessage({id:"decodeMesh",dataView:Z,attributes:c},[Z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((C=>{let d=null;const X=[],P=(0,p.e)(C.module,b,c,(C=>{d=C}),((C,c,d,b,P,V)=>{X.push({kind:C,data:c,size:d,byteOffset:b,byteStride:P,normalized:V})}));return{indices:d,attributes:X,totalVertices:P}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(C,c,d,b){const X=await this.decodeMeshToMeshDataAsync(d,b),R=new P.c(C,c);X.indices&&R.setIndices(X.indices);for(const P of X.attributes)R.setVerticesBuffer(new V.d(c.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),X.totalVertices);return R}async _decodeMeshToGeometryForGltfAsync(C,c,d,b,X,R){const p=await this.decodeMeshToMeshDataAsync(d,b,X),j=new P.c(C,c);R&&(j._boundingInfo=R,j.useBoundingInfoFromGeometry=!0),p.indices&&j.setIndices(p.indices);for(const P of p.attributes)j.setVerticesBuffer(new V.d(c.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),p.totalVertices);return j}}j.DefaultConfiguration={wasmUrl:`${X.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${X.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${X.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},j._Default=null},14312:(C,c,d)=>{"use strict";d.d(c,{c:()=>RC});var b=d(12403),X=d(12848),P=d(12471),V=d(12828),R=d(12447);function p(C){let c=C.pathArray;const d=C.closeArray||!1,b=C.closePath||!1,X=C.invertUV||!1,p=Math.floor(c[0].length/2);let j=C.offset||p;j=j>p?p:Math.floor(j);const g=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,k=C.hC,Z=C.iC,U=[],A=[],u=[],q=[],B=[],t=[],e=[],n=[];let W;const E=[],N=[];let r,M,K;if(c.length<2){const C=[],d=[];for(M=0;M<c[0].length-j;M++)C.push(c[0][M]),d.push(c[0][M+j]);c=[C,d]}let i=0;const h=b?1:0,L=d?1:0;let f,T,z,w,J,y;for(W=c[0].length,r=0;r<c.length+L;r++){for(e[r]=0,B[r]=[0],f=r===c.length?c[0]:c[r],T=f.length,W=W<T?W:T,K=0;K<T;)U.push(f[K].x,f[K].y,f[K].z),K>0&&(z=f[K].Xd(f[K-1]).length(),w=z+e[r],B[r].push(w),e[r]=w),K++;b&&(K--,U.push(f[0].x,f[0].y,f[0].z),z=f[K].Xd(f[0]).length(),w=z+e[r],B[r].push(w),e[r]=w),E[r]=T+h,N[r]=i,i+=T+h}let x,H,v=null,D=null;for(M=0;M<W+h;M++)for(n[M]=0,t[M]=[0],r=0;r<c.length-1+L;r++)J=c[r],y=r===c.length-1?c[0]:c[r+1],M===W?(v=J[0],D=y[0]):(v=J[M],D=y[M]),z=D.Xd(v).length(),w=z+n[M],t[M].push(w),n[M]=w;if(k)for(r=0;r<k.length;r++)q.push(k[r].x,R.e?1-k[r].y:k[r].y);else for(r=0;r<c.length+L;r++)for(M=0;M<W+h;M++)x=0!=e[r]?B[r][M]/e[r]:0,H=0!=n[M]?t[M][r]/n[M]:0,X?q.push(H,x):q.push(x,R.e?1-H:H);r=0;let s=0,mC=E[r]-1,Q=E[r+1]-1,I=mC<Q?mC:Q,o=N[1]-N[0];const F=E.length-1;for(;s<=I&&r<F;)A.push(s,s+o,s+1),A.push(s+o+1,s+1,s+o),s+=1,s===I&&(r++,o=N[r+1]-N[r],mC=E[r]-1,Q=E[r+1]-1,s=N[r],I=mC<Q?mC+s:Q+s);if(V.e.ComputeNormals(U,A,u),b){let C=0,d=0;for(r=0;r<c.length;r++){C=3*N[r],d=r+1<c.length?3*(N[r+1]-1):u.length-3,u[C]=.5*(u[C]+u[d]),u[C+1]=.5*(u[C+1]+u[d+1]),u[C+2]=.5*(u[C+2]+u[d+2]);const b=Math.sqrt(u[C]*u[C]+u[C+1]*u[C+1]+u[C+2]*u[C+2]);u[C]/=b,u[C+1]/=b,u[C+2]/=b,u[d]=u[C],u[d+1]=u[C+1],u[d+2]=u[C+2]}}if(d){let C=3*N[0],d=3*N[c.length];for(M=0;M<W+h;M++){u[C]=.5*(u[C]+u[d]),u[C+1]=.5*(u[C+1]+u[d+1]),u[C+2]=.5*(u[C+2]+u[d+2]);const c=Math.sqrt(u[C]*u[C]+u[C+1]*u[C+1]+u[C+2]*u[C+2]);u[C]/=c,u[C+1]/=c,u[C+2]/=c,u[d]=u[C],u[d+1]=u[C+1],u[d+2]=u[C+2],C+=3,d+=3}}V.e._ComputeSides(g,U,A,u,q,C.frontUVs,C.backUVs);let Y=null;if(Z){Y=new Float32Array(4*Z.length);for(let C=0;C<Z.length;C++)Y[4*C]=Z[C].r,Y[4*C+1]=Z[C].g,Y[4*C+2]=Z[C].b,Y[4*C+3]=Z[C].a}const l=new V.e,S=new Float32Array(U),G=new Float32Array(u),a=new Float32Array(q);return l.indices=A,l.MC=S,l.KC=G,l.hC=a,Y&&l.set(Y,P.g.ColorKind),b&&(l._idx=N),l}function j(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=c.pathArray,g=c.closeArray,k=c.closePath,Z=X.b._GetDefaultSideOrientation(c.sideOrientation),U=c.instance,A=c.updatable;if(U){const C=b.TmpVectors.dd[0].Hc(Number.MAX_VALUE),d=b.TmpVectors.dd[1].Hc(-Number.MAX_VALUE),p=c=>{let b=j[0].length;const P=U;let V=0;const R=P._originalBuilderSideOrientation===X.b.DOUBLESIDE?2:1;for(let X=1;X<=R;++X)for(let R=0;R<j.length;++R){const X=j[R],p=X.length;b=b<p?b:p;for(let P=0;P<b;++P){const b=X[P];c[V]=b.x,c[V+1]=b.y,c[V+2]=b.z,C.minimizeInPlaceFromFloats(b.x,b.y,b.z),d.maximizeInPlaceFromFloats(b.x,b.y,b.z),V+=3}if(P._creationDataStorage&&P._creationDataStorage.closePath){const C=X[0];c[V]=C.x,c[V+1]=C.y,c[V+2]=C.z,V+=3}}},g=U.getVerticesData(P.g.PositionKind);if(p(g),U.hasBoundingInfo?U.getBoundingInfo().reConstruct(C,d,U._worldMatrix):U.buildBoundingInfo(C,d,U._worldMatrix),U.updateVerticesData(P.g.PositionKind,g,!1,!1),c.iC){const C=U.getVerticesData(P.g.ColorKind);for(let d=0,b=0;d<c.iC.length;d++,b+=4){const X=c.iC[d];C[b]=X.r,C[b+1]=X.g,C[b+2]=X.b,C[b+3]=X.a}U.updateVerticesData(P.g.ColorKind,C,!1,!1)}if(c.hC){const C=U.getVerticesData(P.g.UVKind);for(let d=0;d<c.hC.length;d++)C[2*d]=c.hC[d].x,C[2*d+1]=R.e?1-c.hC[d].y:c.hC[d].y;U.updateVerticesData(P.g.UVKind,C,!1,!1)}if(!U.areNormalsFrozen||U.isFacetDataEnabled){const C=U.wc(),c=U.getVerticesData(P.g.NormalKind),d=U.isFacetDataEnabled?U.getFacetDataParameters():null;if(V.e.ComputeNormals(g,C,c,d),U._creationDataStorage&&U._creationDataStorage.closePath){let C=0,d=0;for(let b=0;b<j.length;b++)C=3*U._creationDataStorage.idx[b],d=b+1<j.length?3*(U._creationDataStorage.idx[b+1]-1):c.length-3,c[C]=.5*(c[C]+c[d]),c[C+1]=.5*(c[C+1]+c[d+1]),c[C+2]=.5*(c[C+2]+c[d+2]),c[d]=c[C],c[d+1]=c[C+1],c[d+2]=c[C+2]}U.areNormalsFrozen||U.updateVerticesData(P.g.NormalKind,c,!1,!1)}return U}{const b=new X.b(C,d);b._originalBuilderSideOrientation=Z,b._creationDataStorage=new X.d;const P=p(c);return k&&(b._creationDataStorage.idx=P._idx),b._creationDataStorage.closePath=k,b._creationDataStorage.closeArray=g,P.fC(b,A),b}}V.e.CreateRibbon=p,X.b.CreateRibbon=function(C,c){return j(C,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var g=d(13814),k=d(13646),Z=d(12438);function U(C){const c=C.pattern||X.b.NO_FLIP,d=C.tileWidth||C.tileSize||1,b=C.tileHeight||C.tileSize||1,P=C.alignHorizontal||0,R=C.alignVertical||0,p=C.width||C.size||1,j=Math.floor(p/d);let g=p-j*d;const k=C.height||C.size||1,Z=Math.floor(k/b);let U=k-Z*b;const A=d*j/2,u=b*Z/2;let q=0,B=0,t=0,e=0,n=0,W=0;if(g>0||U>0){switch(t=-A,e=-u,n=A,W=u,P){case X.b.CENTER:g/=2,t-=g,n+=g;break;case X.b.LEFT:n+=g,q=-g/2;break;case X.b.RIGHT:t-=g,q=g/2}switch(R){case X.b.CENTER:U/=2,e-=U,W+=U;break;case X.b.BOTTOM:W+=U,B=-U/2;break;case X.b.TOP:e-=U,B=U/2}}const E=[],N=[],r=[];r[0]=[0,0,1,0,1,1,0,1],r[1]=[0,0,1,0,1,1,0,1],c!==X.b.ROTATE_TILE&&c!==X.b.ROTATE_ROW||(r[1]=[1,1,0,1,0,0,1,0]),c!==X.b.FLIP_TILE&&c!==X.b.FLIP_ROW||(r[1]=[1,0,0,0,0,1,1,1]),c!==X.b.FLIP_N_ROTATE_TILE&&c!==X.b.FLIP_N_ROTATE_ROW||(r[1]=[0,1,1,1,1,0,0,0]);let M=[];const K=[],i=[];let h=0;for(let V=0;V<Z;V++)for(let C=0;C<j;C++)E.push(C*d-A+q,V*b-u+B,0),E.push((C+1)*d-A+q,V*b-u+B,0),E.push((C+1)*d-A+q,(V+1)*b-u+B,0),E.push(C*d-A+q,(V+1)*b-u+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),M=c===X.b.FLIP_TILE||c===X.b.ROTATE_TILE||c===X.b.FLIP_N_ROTATE_TILE?M.concat(r[(C%2+V%2)%2]):c===X.b.FLIP_ROW||c===X.b.ROTATE_ROW||c===X.b.FLIP_N_ROTATE_ROW?M.concat(r[V%2]):M.concat(r[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),h+=4;if(g>0||U>0){const C=U>0&&(R===X.b.CENTER||R===X.b.TOP),V=U>0&&(R===X.b.CENTER||R===X.b.BOTTOM),p=g>0&&(P===X.b.CENTER||P===X.b.RIGHT),k=g>0&&(P===X.b.CENTER||P===X.b.LEFT);let r,L,f,T,z=[];if(C&&p&&(E.push(t+q,e+B,0),E.push(-A+q,e+B,0),E.push(-A+q,e+U+B,0),E.push(t+q,e+U+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,r=1-g/d,L=1-U/b,f=1,T=1,z=[r,L,f,L,f,T,r,T],c===X.b.ROTATE_ROW&&(z=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),c===X.b.FLIP_ROW&&(z=[1-r,L,1-f,L,1-f,T,1-r,T]),c===X.b.FLIP_N_ROTATE_ROW&&(z=[r,1-L,f,1-L,f,1-T,r,1-T]),M=M.concat(z),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C&&k&&(E.push(A+q,e+B,0),E.push(n+q,e+B,0),E.push(n+q,e+U+B,0),E.push(A+q,e+U+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,r=0,L=1-U/b,f=g/d,T=1,z=[r,L,f,L,f,T,r,T],(c===X.b.ROTATE_ROW||c===X.b.ROTATE_TILE&&j%2===0)&&(z=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),(c===X.b.FLIP_ROW||c===X.b.FLIP_TILE&&j%2===0)&&(z=[1-r,L,1-f,L,1-f,T,1-r,T]),(c===X.b.FLIP_N_ROTATE_ROW||c===X.b.FLIP_N_ROTATE_TILE&&j%2===0)&&(z=[r,1-L,f,1-L,f,1-T,r,1-T]),M=M.concat(z),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&p&&(E.push(t+q,u+B,0),E.push(-A+q,u+B,0),E.push(-A+q,W+B,0),E.push(t+q,W+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,r=1-g/d,L=0,f=1,T=U/b,z=[r,L,f,L,f,T,r,T],(c===X.b.ROTATE_ROW&&Z%2===1||c===X.b.ROTATE_TILE&&Z%1===0)&&(z=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),(c===X.b.FLIP_ROW&&Z%2===1||c===X.b.FLIP_TILE&&Z%2===0)&&(z=[1-r,L,1-f,L,1-f,T,1-r,T]),(c===X.b.FLIP_N_ROTATE_ROW&&Z%2===1||c===X.b.FLIP_N_ROTATE_TILE&&Z%2===0)&&(z=[r,1-L,f,1-L,f,1-T,r,1-T]),M=M.concat(z),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&k&&(E.push(A+q,u+B,0),E.push(n+q,u+B,0),E.push(n+q,W+B,0),E.push(A+q,W+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,r=0,L=0,f=g/d,T=U/b,z=[r,L,f,L,f,T,r,T],(c===X.b.ROTATE_ROW&&Z%2===1||c===X.b.ROTATE_TILE&&(Z+j)%2===1)&&(z=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),(c===X.b.FLIP_ROW&&Z%2===1||c===X.b.FLIP_TILE&&(Z+j)%2===1)&&(z=[1-r,L,1-f,L,1-f,T,1-r,T]),(c===X.b.FLIP_N_ROTATE_ROW&&Z%2===1||c===X.b.FLIP_N_ROTATE_TILE&&(Z+j)%2===1)&&(z=[r,1-L,f,1-L,f,1-T,r,1-T]),M=M.concat(z),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C){const C=[];r=0,L=1-U/b,f=1,T=1,C[0]=[r,L,f,L,f,T,r,T],C[1]=[r,L,f,L,f,T,r,T],c!==X.b.ROTATE_TILE&&c!==X.b.ROTATE_ROW||(C[1]=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),c!==X.b.FLIP_TILE&&c!==X.b.FLIP_ROW||(C[1]=[1-r,L,1-f,L,1-f,T,1-r,T]),c!==X.b.FLIP_N_ROTATE_TILE&&c!==X.b.FLIP_N_ROTATE_ROW||(C[1]=[r,1-L,f,1-L,f,1-T,r,1-T]);for(let b=0;b<j;b++)E.push(b*d-A+q,e+B,0),E.push((b+1)*d-A+q,e+B,0),E.push((b+1)*d-A+q,e+U+B,0),E.push(b*d-A+q,e+U+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=c===X.b.FLIP_TILE||c===X.b.ROTATE_TILE||c===X.b.FLIP_N_ROTATE_TILE?M.concat(C[(b+1)%2]):c===X.b.FLIP_ROW||c===X.b.ROTATE_ROW||c===X.b.FLIP_N_ROTATE_ROW?M.concat(C[1]):M.concat(C[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(V){const C=[];r=0,L=0,f=1,T=U/b,C[0]=[r,L,f,L,f,T,r,T],C[1]=[r,L,f,L,f,T,r,T],c!==X.b.ROTATE_TILE&&c!==X.b.ROTATE_ROW||(C[1]=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),c!==X.b.FLIP_TILE&&c!==X.b.FLIP_ROW||(C[1]=[1-r,L,1-f,L,1-f,T,1-r,T]),c!==X.b.FLIP_N_ROTATE_TILE&&c!==X.b.FLIP_N_ROTATE_ROW||(C[1]=[r,1-L,f,1-L,f,1-T,r,1-T]);for(let b=0;b<j;b++)E.push(b*d-A+q,W-U+B,0),E.push((b+1)*d-A+q,W-U+B,0),E.push((b+1)*d-A+q,W+B,0),E.push(b*d-A+q,W+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=c===X.b.FLIP_TILE||c===X.b.ROTATE_TILE||c===X.b.FLIP_N_ROTATE_TILE?M.concat(C[(b+Z)%2]):c===X.b.FLIP_ROW||c===X.b.ROTATE_ROW||c===X.b.FLIP_N_ROTATE_ROW?M.concat(C[Z%2]):M.concat(C[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const C=[];r=1-g/d,L=0,f=1,T=1,C[0]=[r,L,f,L,f,T,r,T],C[1]=[r,L,f,L,f,T,r,T],c!==X.b.ROTATE_TILE&&c!==X.b.ROTATE_ROW||(C[1]=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),c!==X.b.FLIP_TILE&&c!==X.b.FLIP_ROW||(C[1]=[1-r,L,1-f,L,1-f,T,1-r,T]),c!==X.b.FLIP_N_ROTATE_TILE&&c!==X.b.FLIP_N_ROTATE_ROW||(C[1]=[r,1-L,f,1-L,f,1-T,r,1-T]);for(let d=0;d<Z;d++)E.push(t+q,d*b-u+B,0),E.push(t+g+q,d*b-u+B,0),E.push(t+g+q,(d+1)*b-u+B,0),E.push(t+q,(d+1)*b-u+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=c===X.b.FLIP_TILE||c===X.b.ROTATE_TILE||c===X.b.FLIP_N_ROTATE_TILE?M.concat(C[(d+1)%2]):c===X.b.FLIP_ROW||c===X.b.ROTATE_ROW||c===X.b.FLIP_N_ROTATE_ROW?M.concat(C[d%2]):M.concat(C[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const C=[];r=0,L=0,f=g/b,T=1,C[0]=[r,L,f,L,f,T,r,T],C[1]=[r,L,f,L,f,T,r,T],c!==X.b.ROTATE_TILE&&c!==X.b.ROTATE_ROW||(C[1]=[1-r,1-L,1-f,1-L,1-f,1-T,1-r,1-T]),c!==X.b.FLIP_TILE&&c!==X.b.FLIP_ROW||(C[1]=[1-r,L,1-f,L,1-f,T,1-r,T]),c!==X.b.FLIP_N_ROTATE_TILE&&c!==X.b.FLIP_N_ROTATE_ROW||(C[1]=[r,1-L,f,1-L,f,1-T,r,1-T]);for(let d=0;d<Z;d++)E.push(n-g+q,d*b-u+B,0),E.push(n+q,d*b-u+B,0),E.push(n+q,(d+1)*b-u+B,0),E.push(n-g+q,(d+1)*b-u+B,0),i.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=c===X.b.FLIP_TILE||c===X.b.ROTATE_TILE||c===X.b.FLIP_N_ROTATE_TILE?M.concat(C[(d+j)%2]):c===X.b.FLIP_ROW||c===X.b.ROTATE_ROW||c===X.b.FLIP_N_ROTATE_ROW?M.concat(C[d%2]):M.concat(C[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const L=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE;V.e._ComputeSides(L,E,i,N,M,C.frontUVs,C.backUVs);const f=new V.e;f.indices=i,f.MC=E,f.KC=N,f.hC=M;const T=L===V.e.DOUBLESIDE?K.concat(K):K;return f.iC=T,f}function A(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return U(c).fC(b,c.updatable),b}function u(C){const c=C.faceUV||new Array(6),d=C.faceColors,P=C.pattern||X.b.NO_FLIP,p=C.width||C.size||1,j=C.height||C.size||1,g=C.depth||C.size||1,k=C.tileWidth||C.tileSize||1,A=C.tileHeight||C.tileSize||1,u=C.alignHorizontal||0,q=C.alignVertical||0,B=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE;for(let X=0;X<6;X++)void 0===c[X]&&(c[X]=new b.Vector4(0,0,1,1)),d&&void 0===d[X]&&(d[X]=new Z.vc(1,1,1,1));const t=p/2,e=j/2,n=g/2,W=[];for(let b=0;b<2;b++)W[b]=U({pattern:P,tileWidth:k,tileHeight:A,width:p,height:j,alignVertical:q,alignHorizontal:u,sideOrientation:B});for(let b=2;b<4;b++)W[b]=U({pattern:P,tileWidth:k,tileHeight:A,width:g,height:j,alignVertical:q,alignHorizontal:u,sideOrientation:B});let E=q;q===X.b.BOTTOM?E=X.b.TOP:q===X.b.TOP&&(E=X.b.BOTTOM);for(let b=4;b<6;b++)W[b]=U({pattern:P,tileWidth:k,tileHeight:A,width:p,height:g,alignVertical:E,alignHorizontal:u,sideOrientation:B});let N=[],r=[],M=[],K=[];const i=[],h=[],L=[],f=[];let T=0,z=0;for(let X=0;X<6;X++){const C=W[X].MC.length;h[X]=[],L[X]=[];for(let c=0;c<C/3;c++)h[X].push(new b.dd(W[X].MC[3*c],W[X].MC[3*c+1],W[X].MC[3*c+2])),L[X].push(new b.dd(W[X].KC[3*c],W[X].KC[3*c+1],W[X].KC[3*c+2]));T=W[X].hC.length,f[X]=[];for(let d=0;d<T;d+=2)f[X][d]=c[X].x+(c[X].z-c[X].x)*W[X].hC[d],f[X][d+1]=c[X].y+(c[X].w-c[X].y)*W[X].hC[d+1],R.e&&(f[X][d+1]=1-f[X][d+1]);if(M=M.concat(f[X]),K=K.concat(W[X].indices.map((C=>C+z))),z+=h[X].length,d)for(let c=0;c<4;c++)i.push(d[X].r,d[X].g,d[X].b,d[X].a)}const w=new b.dd(0,0,n),J=b.Matrix.RotationY(Math.PI);N=h[0].map((C=>b.dd.TransformNormal(C,J).add(w))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[]),r=L[0].map((C=>b.dd.TransformNormal(C,J))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[]),N=N.concat(h[1].map((C=>C.Xd(w))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[])),r=r.concat(L[1].map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[]));const y=new b.dd(t,0,0),x=b.Matrix.RotationY(-Math.PI/2);N=N.concat(h[2].map((C=>b.dd.TransformNormal(C,x).add(y))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[])),r=r.concat(L[2].map((C=>b.dd.TransformNormal(C,x))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[]));const H=b.Matrix.RotationY(Math.PI/2);N=N.concat(h[3].map((C=>b.dd.TransformNormal(C,H).Xd(y))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[])),r=r.concat(L[3].map((C=>b.dd.TransformNormal(C,H))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[]));const v=new b.dd(0,e,0),D=b.Matrix.RotationX(Math.PI/2);N=N.concat(h[4].map((C=>b.dd.TransformNormal(C,D).add(v))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[])),r=r.concat(L[4].map((C=>b.dd.TransformNormal(C,D))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[]));const s=b.Matrix.RotationX(-Math.PI/2);N=N.concat(h[5].map((C=>b.dd.TransformNormal(C,s).Xd(v))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[])),r=r.concat(L[5].map((C=>b.dd.TransformNormal(C,s))).map((C=>[C.x,C.y,C.z])).reduce(((C,c)=>C.concat(c)),[])),V.e._ComputeSides(B,N,K,r,M);const mC=new V.e;if(mC.indices=K,mC.MC=N,mC.KC=r,mC.hC=M,d){const C=B===V.e.DOUBLESIDE?i.concat(i):i;mC.iC=C}return mC}function q(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return u(c).fC(b,c.updatable),b}V.e.CreateTiledPlane=U;V.e.CreateTiledBox=u;var B=d(13798),t=d(12637),e=d(12604);function n(C){const c=C.height||2;let d=0===C.diameterTop?0:C.diameterTop||C.diameter||1,P=0===C.diameterBottom?0:C.diameterBottom||C.diameter||1;d=d||1e-5,P=P||1e-5;const p=0|(C.tessellation||24),j=0|(C.subdivisions||1),g=!!C.hasRings,k=!!C.enclose,U=0===C.cap?0:C.cap||X.b.CAP_ALL,A=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,u=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,q=C.faceUV||new Array(3),B=C.faceColors,t=2+(1+(1!==A&&k?2:0))*(g?j:1);let n;for(n=0;n<t;n++)B&&void 0===B[n]&&(B[n]=new Z.vc(1,1,1,1));for(n=0;n<t;n++)q&&void 0===q[n]&&(q[n]=new b.Vector4(0,0,1,1));const W=[],E=[],N=[],r=[],M=[],K=2*Math.PI*A/p;let i,h,L;const f=(P-d)/2/c,T=b.dd.Zero(),z=b.dd.Zero(),w=b.dd.Zero(),J=b.dd.Zero(),y=b.dd.Zero(),x=e.c.Y;let H,v,D,s=1,mC=1,Q=0,I=0;for(H=0;H<=j;H++)for(h=H/j,L=(h*(d-P)+P)/2,s=g&&0!==H&&H!==j?2:1,D=0;D<s;D++){for(g&&(mC+=D),k&&(mC+=2*D),v=0;v<=p;v++)i=v*K,T.x=Math.cos(-i)*L,T.y=-c/2+h*c,T.z=Math.sin(-i)*L,0===d&&H===j?(z.x=N[N.length-3*(p+1)],z.y=N[N.length-3*(p+1)+1],z.z=N[N.length-3*(p+1)+2]):(z.x=T.x,z.z=T.z,z.y=Math.sqrt(z.x*z.x+z.z*z.z)*f,z.normalize()),0===v&&(w.V(T),J.V(z)),E.push(T.x,T.y,T.z),N.push(z.x,z.y,z.z),I=g?Q!==mC?q[mC].y:q[mC].w:q[mC].y+(q[mC].w-q[mC].y)*h,r.push(q[mC].x+(q[mC].z-q[mC].x)*v/p,R.e?1-I:I),B&&M.push(B[mC].r,B[mC].g,B[mC].b,B[mC].a);1!==A&&k&&(E.push(T.x,T.y,T.z),E.push(0,T.y,0),E.push(0,T.y,0),E.push(w.x,w.y,w.z),b.dd.CrossToRef(x,z,y),y.normalize(),N.push(y.x,y.y,y.z,y.x,y.y,y.z),b.dd.CrossToRef(J,x,y),y.normalize(),N.push(y.x,y.y,y.z,y.x,y.y,y.z),I=g?Q!==mC?q[mC+1].y:q[mC+1].w:q[mC+1].y+(q[mC+1].w-q[mC+1].y)*h,r.push(q[mC+1].x,R.e?1-I:I),r.push(q[mC+1].z,R.e?1-I:I),I=g?Q!==mC?q[mC+2].y:q[mC+2].w:q[mC+2].y+(q[mC+2].w-q[mC+2].y)*h,r.push(q[mC+2].x,R.e?1-I:I),r.push(q[mC+2].z,R.e?1-I:I),B&&(M.push(B[mC+1].r,B[mC+1].g,B[mC+1].b,B[mC+1].a),M.push(B[mC+1].r,B[mC+1].g,B[mC+1].b,B[mC+1].a),M.push(B[mC+2].r,B[mC+2].g,B[mC+2].b,B[mC+2].a),M.push(B[mC+2].r,B[mC+2].g,B[mC+2].b,B[mC+2].a))),Q!==mC&&(Q=mC)}const o=1!==A&&k?p+4:p;for(H=0,mC=0;mC<j;mC++){let C=0,c=0,d=0,b=0;for(v=0;v<p;v++)C=H*(o+1)+v,c=(H+1)*(o+1)+v,d=H*(o+1)+(v+1),b=(H+1)*(o+1)+(v+1),W.push(C,c,d),W.push(b,d,c);1!==A&&k&&(W.push(C+2,c+2,d+2),W.push(b+2,d+2,c+2),W.push(C+4,c+4,d+4),W.push(b+4,d+4,c+4)),H=g?H+2:H+1}const F=C=>{const X=C?d/2:P/2;if(0===X)return;let V,j,g;const k=C?q[t-1]:q[0];let Z=null;B&&(Z=C?B[t-1]:B[0]);const U=E.length/3,u=C?c/2:-c/2,e=new b.dd(0,u,0);E.push(e.x,e.y,e.z),N.push(0,C?1:-1,0);const n=k.y+.5*(k.w-k.y);r.push(k.x+.5*(k.z-k.x),R.e?1-n:n),Z&&M.push(Z.r,Z.g,Z.b,Z.a);const K=new b.Vector2(.5,.5);for(g=0;g<=p;g++){V=2*Math.PI*g*A/p;const c=Math.cos(-V),d=Math.sin(-V);j=new b.dd(c*X,u,d*X);const P=new b.Vector2(c*K.x+.5,d*K.y+.5);E.push(j.x,j.y,j.z),N.push(0,C?1:-1,0);const U=k.y+(k.w-k.y)*P.y;r.push(k.x+(k.z-k.x)*P.x,R.e?1-U:U),Z&&M.push(Z.r,Z.g,Z.b,Z.a)}for(g=0;g<p;g++)C?(W.push(U),W.push(U+(g+2)),W.push(U+(g+1))):(W.push(U),W.push(U+(g+1)),W.push(U+(g+2)))};U!==X.b.CAP_START&&U!==X.b.CAP_ALL||F(!1),U!==X.b.CAP_END&&U!==X.b.CAP_ALL||F(!0),V.e._ComputeSides(u,E,W,N,r,C.frontUVs,C.backUVs);const Y=new V.e;return Y.indices=W,Y.MC=E,Y.KC=N,Y.hC=r,B&&(Y.iC=M),Y}function W(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return n(c).fC(b,c.updatable),b}function E(C){const c=[],d=[],X=[],P=[],p=C.diameter||1,j=C.thickness||.5,g=0|(C.tessellation||16),k=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,Z=g+1;for(let V=0;V<=g;V++){const C=V/g,k=V*Math.PI*2/g-Math.PI/2,U=b.Matrix.Translation(p/2,0,0).multiply(b.Matrix.RotationY(k));for(let p=0;p<=g;p++){const k=1-p/g,A=p*Math.PI*2/g+Math.PI,u=Math.cos(A),q=Math.sin(A);let B=new b.dd(u,q,0),t=B.scale(j/2);const e=new b.Vector2(C,k);t=b.dd.TransformCoordinates(t,U),B=b.dd.TransformNormal(B,U),d.push(t.x,t.y,t.z),X.push(B.x,B.y,B.z),P.push(e.x,R.e?1-e.y:e.y);const n=(V+1)%Z,W=(p+1)%Z;c.push(V*Z+p),c.push(V*Z+W),c.push(n*Z+p),c.push(V*Z+W),c.push(n*Z+W),c.push(n*Z+p)}}V.e._ComputeSides(k,d,c,X,P,C.frontUVs,C.backUVs);const U=new V.e;return U.indices=c,U.MC=d,U.KC=X,U.hC=P,U}function N(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return E(c).fC(b,c.updatable),b}V.e.CreateCylinder=n,X.b.CreateCylinder=(C,c,d,b,P,V,R,p,j)=>{void 0!==R&&R instanceof t.e||(void 0!==R&&(j=p||X.b.DEFAULTSIDE,p=R),R=V,V=1);return W(C,{height:c,diameterTop:d,diameterBottom:b,tessellation:P,subdivisions:V,sideOrientation:j,updatable:p},R)};function r(C){const c=[],d=[],X=[],P=[],p=C.radius||2,j=C.tube||.5,g=C.radialSegments||32,k=C.tubularSegments||32,Z=C.p||2,U=C.q||3,A=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,u=C=>{const c=Math.cos(C),d=Math.sin(C),X=U/Z*C,P=Math.cos(X),V=p*(2+P)*.5*c,R=p*(2+P)*d*.5,j=p*Math.sin(X)*.5;return new b.dd(V,R,j)};let q,B;for(q=0;q<=g;q++){const C=q%g/g*2*Z*Math.PI,c=u(C),X=u(C+.01),V=X.Xd(c);let p=X.add(c);const U=b.dd.Cross(V,p);for(p=b.dd.Cross(U,V),U.normalize(),p.normalize(),B=0;B<k;B++){const C=B%k/k*2*Math.PI,b=-j*Math.cos(C),X=j*Math.sin(C);d.push(c.x+b*p.x+X*U.x),d.push(c.y+b*p.y+X*U.y),d.push(c.z+b*p.z+X*U.z),P.push(q/g),P.push(R.e?1-B/k:B/k)}}for(q=0;q<g;q++)for(B=0;B<k;B++){const C=(B+1)%k,d=q*k+B,b=(q+1)*k+B,X=(q+1)*k+C,P=q*k+C;c.push(P),c.push(b),c.push(d),c.push(P),c.push(X),c.push(b)}V.e.ComputeNormals(d,c,X),V.e._ComputeSides(A,d,c,X,P,C.frontUVs,C.backUVs);const t=new V.e;return t.indices=c,t.MC=d,t.KC=X,t.hC=P,t}function M(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return r(c).fC(b,c.updatable),b}V.e.CreateTorus=E,X.b.CreateTorus=(C,c,d,b,X,P,V)=>N(C,{diameter:c,thickness:d,tessellation:b,sideOrientation:V,updatable:P},X);V.e.CreateTorusKnot=r,X.b.CreateTorusKnot=(C,c,d,b,X,P,V,R,p,j)=>M(C,{radius:c,tube:d,radialSegments:b,tubularSegments:X,p:P,q:V,sideOrientation:j,updatable:p},R);var K=d(14316),i=d(12964),h=d(12614);function L(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=c.path,P=c.shape,V=c.scale||1,R=c.rotation||0,p=0===c.cap?0:c.cap||X.b.NO_CAP,j=c.updatable,g=X.b._GetDefaultSideOrientation(c.sideOrientation),k=c.instance||null,Z=c.invertUV||!1,U=c.closeShape||!1,A=c.closePath||!1,u=c.capFunction||null;return T(C,P,b,V,R,null,null,A,U,p,!1,d,!!j,g,k,Z,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame,u)}function f(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=c.path,P=c.shape,V=c.scaleFunction||(()=>1),R=c.rotationFunction||(()=>0),p=c.closePath||c.ribbonCloseArray||!1,j=c.closeShape||c.ribbonClosePath||!1,g=0===c.cap?0:c.cap||X.b.NO_CAP,k=c.updatable,Z=c.firstNormal||null,U=c.adjustFrame||!1,A=X.b._GetDefaultSideOrientation(c.sideOrientation),u=c.instance,q=c.invertUV||!1,B=c.capFunction||null;return T(C,P,b,null,null,V,R,p,j,g,!0,d,!!k,A,u||null,q,c.frontUVs||null,c.backUVs||null,Z,U,B||null)}function T(C,c,d,P,V,R,p,g,k,Z,U,A,u,q,B,t,e,n,W,E,N){const r=(C,c,d,P,V,R,p,j,g,k,Z)=>{const U=d.getTangents(),A=d.getNormals(),u=d.getBinormals(),q=d.getDistances();if(Z)for(let X=0;X<U.length;X++)if(0==U[X].x&&0==U[X].y&&0==U[X].z&&U[X].V(U[X-1]),0==A[X].x&&0==A[X].y&&0==A[X].z&&A[X].V(A[X-1]),0==u[X].x&&0==u[X].y&&0==u[X].z&&u[X].V(u[X-1]),X>0){let C=U[X-1];b.dd.Dot(C,U[X])<0&&U[X].scaleInPlace(-1),C=A[X-1],b.dd.Dot(C,A[X])<0&&A[X].scaleInPlace(-1),C=u[X-1],b.dd.Dot(C,u[X])<0&&u[X].scaleInPlace(-1)}let B=0;const t=k&&j?j:()=>null!==R?R:0,e=k&&p?p:()=>null!==V?V:1;let n=g===X.b.NO_CAP||g===X.b.CAP_END?0:2;const W=b.TmpVectors.Matrix[0];for(let X=0;X<c.length;X++){const d=[],V=t(X,q[X]),R=e(X,q[X]);b.Matrix.RotationAxisToRef(U[X],B,W);for(let P=0;P<C.length;P++){const V=U[X].scale(C[P].z).add(A[X].scale(C[P].x)).add(u[X].scale(C[P].y)),p=b.dd.Zero();b.dd.TransformCoordinatesToRef(V,W,p),p.scaleInPlace(R).addInPlace(c[X]),d[P]=p}P[n]=d,B+=V,n++}const E=N||(C=>{const c=Array(),d=b.dd.Zero();let X;for(X=0;X<C.length;X++)d.addInPlace(C[X]);for(d.scaleInPlace(1/C.length),X=0;X<C.length;X++)c.push(d);return c});switch(g){case X.b.NO_CAP:break;case X.b.CAP_START:P[0]=E(P[2]),P[1]=P[2];break;case X.b.CAP_END:P[n]=P[n-1],P[n+1]=E(P[n-1]);break;case X.b.CAP_ALL:P[0]=E(P[2]),P[1]=P[2],P[n]=P[n-1],P[n+1]=E(P[n-1])}return P};let M,K;if(B){const C=B._creationDataStorage;return M=W?C.path3D.update(d,W):C.path3D.update(d),K=r(c,d,C.path3D,C.pathArray,P,V,R,p,C.cap,U,E),B=j("",{pathArray:K,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},A||void 0)}M=W?new h.k(d,W):new h.k(d);K=r(c,d,M,new Array,P,V,R,p,Z=Z<0||Z>3?0:Z,U,E);const i=j(C,{pathArray:K,closeArray:g,closePath:k,updatable:u,sideOrientation:q,invertUV:t,frontUVs:e||void 0,backUVs:n||void 0},A);return i._creationDataStorage.pathArray=K,i._creationDataStorage.path3D=M,i._creationDataStorage.cap=Z,i}function z(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,V=void 0===c.closed||c.closed,R=c.shape,p=c.radius||1,g=c.tessellation||64,k=c.clip||0,Z=c.updatable,U=X.b._GetDefaultSideOrientation(c.sideOrientation),A=c.cap||X.b.NO_CAP,u=2*Math.PI,q=[],B=c.invertUV||!1;let t=0,e=0;const n=u/g*P;let W,E;for(t=0;t<=g-k;t++){for(E=[],A!=X.b.CAP_START&&A!=X.b.CAP_ALL||(E.push(new b.dd(0,R[0].y,0)),E.push(new b.dd(Math.cos(t*n)*R[0].x*p,R[0].y,Math.sin(t*n)*R[0].x*p))),e=0;e<R.length;e++)W=new b.dd(Math.cos(t*n)*R[e].x*p,R[e].y,Math.sin(t*n)*R[e].x*p),E.push(W);A!=X.b.CAP_END&&A!=X.b.CAP_ALL||(E.push(new b.dd(Math.cos(t*n)*R[R.length-1].x*p,R[R.length-1].y,Math.sin(t*n)*R[R.length-1].x*p)),E.push(new b.dd(0,R[R.length-1].y,0))),q.push(E)}return j(C,{pathArray:q,closeArray:V,sideOrientation:U,updatable:Z,invertUV:B,frontUVs:c.frontUVs,backUVs:c.backUVs},d)}X.b.ExtrudeShape=function(C,c,d,b,P,V){let R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;return L(C,{shape:c,path:d,scale:b,rotation:P,cap:0===V?0:V||X.b.NO_CAP,sideOrientation:j,instance:g,updatable:p},R)},X.b.ExtrudeShapeCustom=(C,c,d,b,P,V,R,p,j,g,k,Z)=>f(C,{shape:c,path:d,scaleFunction:b,rotationFunction:P,ribbonCloseArray:V,ribbonClosePath:R,cap:0===p?0:p||X.b.NO_CAP,sideOrientation:k,instance:Z,updatable:g},j);X.b.CreateLathe=(C,c,d,b,X,P,V)=>z(C,{shape:c,radius:d,tessellation:b,sideOrientation:V,updatable:P},X);var w=d(13708),J=d(13648);function y(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.path;let V=c.instance,R=1;void 0!==c.radius?R=c.radius:V&&(R=V._creationDataStorage.radius);const p=c.tessellation||64,g=c.radiusFunction||null;let k=c.cap||X.b.NO_CAP;const Z=c.invertUV||!1,U=c.updatable,A=X.b._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const u=(C,c,d,P,V,R,p,j)=>{const g=c.getTangents(),k=c.getNormals(),Z=c.getDistances(),U=2*Math.PI/V*j,A=R||(()=>P);let u,q,B,t;const e=b.TmpVectors.Matrix[0];let n=p===X.b.NO_CAP||p===X.b.CAP_END?0:2;for(let X=0;X<C.length;X++){q=A(X,Z[X]),u=Array(),B=k[X];for(let c=0;c<V;c++)b.Matrix.RotationAxisToRef(g[X],U*c,e),t=u[c]?u[c]:b.dd.Zero(),b.dd.TransformCoordinatesToRef(B,e,t),t.scaleInPlace(q).addInPlace(C[X]),u[c]=t;d[n]=u,n++}const W=(c,d)=>{const b=Array();for(let X=0;X<c;X++)b.push(C[d]);return b};switch(p){case X.b.NO_CAP:break;case X.b.CAP_START:d[0]=W(V,0),d[1]=d[2].slice(0);break;case X.b.CAP_END:d[n]=d[n-1].slice(0),d[n+1]=W(V,C.length-1);break;case X.b.CAP_ALL:d[0]=W(V,0),d[1]=d[2].slice(0),d[n]=d[n-1].slice(0),d[n+1]=W(V,C.length-1)}return d};let q,B;if(V){const C=V._creationDataStorage,d=c.arc||C.arc;return q=C.path3D.update(P),B=u(P,q,C.pathArray,R,C.tessellation,g,C.cap,d),V=j("",{pathArray:B,instance:V}),C.path3D=q,C.pathArray=B,C.arc=d,C.radius=R,V}q=new h.k(P);k=k<0||k>3?0:k,B=u(P,q,new Array,R,p,g,k,c.arc);const t=j(C,{pathArray:B,closePath:!0,closeArray:!1,updatable:U,sideOrientation:A,invertUV:Z,frontUVs:c.frontUVs,backUVs:c.backUVs},d);return t._creationDataStorage.pathArray=B,t._creationDataStorage.path3D=q,t._creationDataStorage.tessellation=p,t._creationDataStorage.cap=k,t._creationDataStorage.arc=c.arc,t._creationDataStorage.radius=R,t}function x(C){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const d=C.type&&(C.type<0||C.type>=c.length)?0:C.type||0,X=C.size,P=C.sizeX||X||1,p=C.sizeY||X||1,j=C.sizeZ||X||1,g=C.custom||c[d],k=g.face.length,U=C.faceUV||new Array(k),A=C.faceColors,u=void 0===C.flat||C.flat,q=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,B=[],t=[],e=[],n=[],W=[];let E=0,N=0;const r=[];let M,K,i,h,L,f,T=0,z=0;if(u)for(z=0;z<k;z++)A&&void 0===A[z]&&(A[z]=new Z.vc(1,1,1,1)),U&&void 0===U[z]&&(U[z]=new b.Vector4(0,0,1,1));if(u)for(z=0;z<k;z++){const C=g.face[z].length;for(i=2*Math.PI/C,h=.5*Math.tan(i/2),L=.5,T=0;T<C;T++)B.push(g.vertex[g.face[z][T]][0]*P,g.vertex[g.face[z][T]][1]*p,g.vertex[g.face[z][T]][2]*j),r.push(E),E++,M=U[z].x+(U[z].z-U[z].x)*(.5+h),K=U[z].y+(U[z].w-U[z].y)*(L-.5),n.push(M,R.e?1-K:K),f=h*Math.cos(i)-L*Math.sin(i),L=h*Math.sin(i)+L*Math.cos(i),h=f,A&&W.push(A[z].r,A[z].g,A[z].b,A[z].a);for(T=0;T<C-2;T++)t.push(r[0+N],r[T+2+N],r[T+1+N]);N+=C}else{for(T=0;T<g.vertex.length;T++)B.push(g.vertex[T][0]*P,g.vertex[T][1]*p,g.vertex[T][2]*j),n.push(0,R.e?1:0);for(z=0;z<k;z++)for(T=0;T<g.face[z].length-2;T++)t.push(g.face[z][0],g.face[z][T+2],g.face[z][T+1])}V.e.ComputeNormals(B,t,e),V.e._ComputeSides(q,B,t,e,n,C.frontUVs,C.backUVs);const w=new V.e;return w.MC=B,w.indices=t,w.KC=e,w.hC=n,A&&u&&(w.iC=W),w}function H(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return x(c).fC(b,c.updatable),b}X.b.CreateTube=(C,c,d,b,X,P,V,R,p,j)=>y(C,{path:c,radius:d,tessellation:b,radiusFunction:X,arc:1,cap:P,updatable:R,sideOrientation:p,instance:j},V);function v(C){const c=C.sideOrientation||V.e.DEFAULTSIDE,d=C.radius||1,X=void 0===C.flat||C.flat,P=0|(C.subdivisions||4),p=C.radiusX||d,j=C.radiusY||d,g=C.radiusZ||d,k=(1+Math.sqrt(5))/2,Z=[-1,k,-0,1,k,0,-1,-k,0,1,-k,0,0,-1,-k,0,1,-k,0,-1,k,0,1,k,k,0,1,k,0,-1,-k,0,1,-k,0,-1],U=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],A=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],u=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],q=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],t=[],e=[],n=[];let W=0;const E=new Array(3),N=new Array(3);let r;for(r=0;r<3;r++)E[r]=b.dd.Zero(),N[r]=b.Vector2.Zero();for(let V=0;V<20;V++){for(r=0;r<3;r++){const C=U[3*V+r];E[r].yc(Z[3*A[C]],Z[3*A[C]+1],Z[3*A[C]+2]),E[r].normalize(),N[r].yc(.134765625*u[2*C]+.05859375+-.0390625*q[V],.2333984375*u[2*C+1]+.025390625+.01953125*q[V])}const C=(C,c,d,V)=>{const k=b.dd.Lerp(E[0],E[2],c/P),Z=b.dd.Lerp(E[1],E[2],c/P),U=P===c?E[2]:b.dd.Lerp(k,Z,C/(P-c));let A;if(U.normalize(),X){const C=b.dd.Lerp(E[0],E[2],V/P),c=b.dd.Lerp(E[1],E[2],V/P);A=b.dd.Lerp(C,c,d/(P-V))}else A=new b.dd(U.x,U.y,U.z);A.x/=p,A.y/=j,A.z/=g,A.normalize();const u=b.Vector2.Lerp(N[0],N[2],c/P),q=b.Vector2.Lerp(N[1],N[2],c/P),r=P===c?N[2]:b.Vector2.Lerp(u,q,C/(P-c));t.push(U.x*p,U.y*j,U.z*g),e.push(A.x,A.y,A.z),n.push(r.x,R.e?1-r.y:r.y),B.push(W),W++};for(let c=0;c<P;c++)for(let d=0;d+c<P;d++)C(d,c,d+1/3,c+1/3),C(d+1,c,d+1/3,c+1/3),C(d,c+1,d+1/3,c+1/3),d+c+1<P&&(C(d+1,c,d+2/3,c+2/3),C(d+1,c+1,d+2/3,c+2/3),C(d,c+1,d+2/3,c+2/3))}V.e._ComputeSides(c,t,B,e,n,C.frontUVs,C.backUVs);const M=new V.e;return M.indices=B,M.MC=t,M.KC=e,M.hC=n,M}function D(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new X.b(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),b._originalBuilderSideOrientation=c.sideOrientation;return v(c).fC(b,c.updatable),b}V.e.CreatePolyhedron=x,X.b.CreatePolyhedron=(C,c,d)=>H(C,c,d);V.e.CreateIcoSphere=v,X.b.CreateIcoSphere=(C,c,d)=>D(C,c,d);var s=d(12418);const mC=new b.dd(1,0,0),Q=new b.dd(-1,0,0),I=new b.dd(0,1,0),o=new b.dd(0,-1,0),F=new b.dd(0,0,1),Y=new b.dd(0,0,-1);class l{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.dd.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.dd.Up(),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.Vector2.Zero(),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=C,this.normal=c,this.uv=d,this.vertexIdx=X,this.vertexIdxForBones=P,this.localPositionOverride=V,this.localNormalOverride=R,this.matrixIndicesOverride=p,this.matrixWeightsOverride=j}clone(){var C,c,d,b;return new l(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(C=this.localPositionOverride)||void 0===C?void 0:C.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(d=this.matrixIndicesOverride)||void 0===d?void 0:d.slice(),null===(b=this.matrixWeightsOverride)||void 0===b?void 0:b.slice())}}function S(C,c,d){var p,j,g,k,Z;const U=!!c.skeleton,A=!(null===(p=c.morphTargetManager)||void 0===p||!p.numTargets),u=d.localMode||U,q=c.wc(),B=U||A?c.Up(!0,!0):c.getVerticesData(P.g.PositionKind),t=U||A?c.getNormalsData(!0,!0):c.getVerticesData(P.g.NormalKind),e=u?U?c.getVerticesData(P.g.PositionKind):B:null,n=u?U?c.getVerticesData(P.g.NormalKind):t:null,W=c.getVerticesData(P.g.UVKind),E=U?c.getVerticesData(P.g.MatricesIndicesKind):null,N=U?c.getVerticesData(P.g.MatricesWeightsKind):null,r=U?c.getVerticesData(P.g.MatricesIndicesExtraKind):null,M=U?c.getVerticesData(P.g.MatricesWeightsExtraKind):null,K=d.position||b.dd.Zero();let i=d.normal||b.dd.Up();const h=d.size||b.dd.One(),L=d.angle||0;if(!i){const C=new b.dd(0,0,1),d=c.NC().activeCamera,X=b.dd.TransformCoordinates(C,d.getWorldMatrix());i=d.globalPosition.Xd(X)}const f=-Math.atan2(i.z,i.x)-Math.PI/2,T=Math.sqrt(i.x*i.x+i.z*i.z),z=Math.atan2(i.y,T),w=new V.e;w.indices=[],w.MC=[],w.KC=[],w.hC=[],w.matricesIndices=U?[]:null,w.matricesWeights=U?[]:null,w.matricesIndicesExtra=r?[]:null,w.matricesWeightsExtra=M?[]:null;let J=0;const y=(C,c)=>{const X=new l;if(!q||!B||!t)return X;const P=q[C];if(X.vertexIdx=3*P,X.vertexIdxForBones=4*P,X.position=new b.dd(B[3*P],B[3*P+1],B[3*P+2]),b.dd.TransformCoordinatesToRef(X.position,c,X.position),X.normal=new b.dd(t[3*P],t[3*P+1],t[3*P+2]),b.dd.TransformNormalToRef(X.normal,c,X.normal),d.captureUVS&&W){const C=W[2*P+1];X.uv=new b.Vector2(W[2*P],R.e?1-C:C)}return X},x=[0,0,0,0],H=(C,c)=>{if(0===C.length)return C;const d=.5*Math.abs(b.dd.Dot(h,c)),X=(C,c,d,b)=>{for(let X=0;X<b;++X)if(C[d+X]===c)return d+X;return-1},P=(C,P)=>{const V=b.dd.GetClipFactor(C.position,P.position,c,d);let R=x,p=x;if(E&&N){const c=C.matrixIndicesOverride?0:C.vertexIdxForBones,d=C.matrixIndicesOverride??E,b=C.matrixWeightsOverride??N,j=P.matrixIndicesOverride?0:P.vertexIdxForBones,g=P.matrixIndicesOverride??E,k=P.matrixWeightsOverride??N;R=[0,0,0,0],p=[0,0,0,0];let Z=0;for(let C=0;C<4;++C)if(b[c+C]>0){const P=X(g,d[c+C],j,4);R[Z]=d[c+C],p[Z]=(0,s.Lerp)(b[c+C],P>=0?k[P]:0,V),Z++}for(let C=0;C<4&&Z<4;++C){const b=g[j+C];-1===X(d,b,c,4)&&(R[Z]=b,p[Z]=(0,s.Lerp)(0,k[j+C],V),Z++)}const U=p[0]+p[1]+p[2]+p[3];p[0]/=U,p[1]/=U,p[2]/=U,p[3]/=U}const j=C.localPositionOverride?C.localPositionOverride[0]:(null===e||void 0===e?void 0:e[C.vertexIdx])??0,g=C.localPositionOverride?C.localPositionOverride[1]:(null===e||void 0===e?void 0:e[C.vertexIdx+1])??0,k=C.localPositionOverride?C.localPositionOverride[2]:(null===e||void 0===e?void 0:e[C.vertexIdx+2])??0,Z=P.localPositionOverride?P.localPositionOverride[0]:(null===e||void 0===e?void 0:e[P.vertexIdx])??0,U=P.localPositionOverride?P.localPositionOverride[1]:(null===e||void 0===e?void 0:e[P.vertexIdx+1])??0,A=P.localPositionOverride?P.localPositionOverride[2]:(null===e||void 0===e?void 0:e[P.vertexIdx+2])??0,u=C.localNormalOverride?C.localNormalOverride[0]:(null===n||void 0===n?void 0:n[C.vertexIdx])??0,q=C.localNormalOverride?C.localNormalOverride[1]:(null===n||void 0===n?void 0:n[C.vertexIdx+1])??0,B=C.localNormalOverride?C.localNormalOverride[2]:(null===n||void 0===n?void 0:n[C.vertexIdx+2])??0,t=u+((P.localNormalOverride?P.localNormalOverride[0]:(null===n||void 0===n?void 0:n[P.vertexIdx])??0)-u)*V,W=q+((P.localNormalOverride?P.localNormalOverride[1]:(null===n||void 0===n?void 0:n[P.vertexIdx+1])??0)-q)*V,r=B+((P.localNormalOverride?P.localNormalOverride[2]:(null===n||void 0===n?void 0:n[P.vertexIdx+2])??0)-B)*V,M=Math.sqrt(t*t+W*W+r*r);return new l(b.dd.Lerp(C.position,P.position,V),b.dd.Lerp(C.normal,P.normal,V).normalize(),b.Vector2.Lerp(C.uv,P.uv,V),-1,-1,e?[j+(Z-j)*V,g+(U-g)*V,k+(A-k)*V]:null,n?[t/M,W/M,r/M]:null,R,p)};let V=null;C.length>3&&(V=[]);for(let R=0;R<C.length;R+=3){let X=0,p=null,j=null,g=null,k=null;const Z=b.dd.Dot(C[R].position,c)-d>0,U=b.dd.Dot(C[R+1].position,c)-d>0,A=b.dd.Dot(C[R+2].position,c)-d>0;switch(X=(Z?1:0)+(U?1:0)+(A?1:0),X){case 0:C.length>3?(V.push(C[R]),V.push(C[R+1]),V.push(C[R+2])):V=C;break;case 1:if(V=V??new Array,Z&&(p=C[R+1],j=C[R+2],g=P(C[R],p),k=P(C[R],j)),U){p=C[R],j=C[R+2],g=P(C[R+1],p),k=P(C[R+1],j),V.push(g),V.push(j.clone()),V.push(p.clone()),V.push(j.clone()),V.push(g.clone()),V.push(k);break}A&&(p=C[R],j=C[R+1],g=P(C[R+2],p),k=P(C[R+2],j)),p&&j&&g&&k&&(V.push(p.clone()),V.push(j.clone()),V.push(g),V.push(k),V.push(g.clone()),V.push(j.clone()));break;case 2:V=V??new Array,Z||(p=C[R].clone(),j=P(p,C[R+1]),g=P(p,C[R+2]),V.push(p),V.push(j),V.push(g)),U||(p=C[R+1].clone(),j=P(p,C[R+2]),g=P(p,C[R]),V.push(p),V.push(j),V.push(g)),A||(p=C[R+2].clone(),j=P(p,C[R]),g=P(p,C[R+1]),V.push(p),V.push(j),V.push(g))}}return V},v=c instanceof X.b?c:null,D=null===v||void 0===v?void 0:v._thinInstanceDataStorage.matrixData,S=(null===v||void 0===v?void 0:v.sc)||1,G=b.TmpVectors.Matrix[0];G.V(b.Matrix.IdentityReadOnly);for(let X=0;X<S;++X){if(null!==v&&void 0!==v&&v.hasThinInstances&&D){const C=16*X;G.setRowFromFloats(0,D[C+0],D[C+1],D[C+2],D[C+3]),G.setRowFromFloats(1,D[C+4],D[C+5],D[C+6],D[C+7]),G.setRowFromFloats(2,D[C+8],D[C+9],D[C+10],D[C+11]),G.setRowFromFloats(3,D[C+12],D[C+13],D[C+14],D[C+15])}const C=b.Matrix.RotationYawPitchRoll(f,z,L).multiply(b.Matrix.Translation(K.x,K.y,K.z)),P=b.Matrix.Invert(C),V=c.getWorldMatrix(),p=G.multiply(V).multiply(P),j=new Array(3);for(let c=0;c<q.length;c+=3){let C=j;if(C[0]=y(c,p),C[1]=y(c+1,p),C[2]=y(c+2,p),!(d.cullBackFaces&&-C[0].normal.z<=0&&-C[1].normal.z<=0&&-C[2].normal.z<=0)&&(C=H(C,mC),C&&(C=H(C,Q),C&&(C=H(C,I),C&&(C=H(C,o),C&&(C=H(C,F),C&&(C=H(C,Y),C)))))))for(let c=0;c<C.length;c++){const b=C[c];if(w.indices.push(J),u?(b.localPositionOverride?(w.MC[3*J]=b.localPositionOverride[0],w.MC[3*J+1]=b.localPositionOverride[1],w.MC[3*J+2]=b.localPositionOverride[2]):e&&(w.MC[3*J]=e[b.vertexIdx],w.MC[3*J+1]=e[b.vertexIdx+1],w.MC[3*J+2]=e[b.vertexIdx+2]),b.localNormalOverride?(w.KC[3*J]=b.localNormalOverride[0],w.KC[3*J+1]=b.localNormalOverride[1],w.KC[3*J+2]=b.localNormalOverride[2]):n&&(w.KC[3*J]=n[b.vertexIdx],w.KC[3*J+1]=n[b.vertexIdx+1],w.KC[3*J+2]=n[b.vertexIdx+2])):(b.position.toArray(w.MC,3*J),b.normal.toArray(w.KC,3*J)),w.matricesIndices&&w.matricesWeights&&(b.matrixIndicesOverride?(w.matricesIndices[4*J]=b.matrixIndicesOverride[0],w.matricesIndices[4*J+1]=b.matrixIndicesOverride[1],w.matricesIndices[4*J+2]=b.matrixIndicesOverride[2],w.matricesIndices[4*J+3]=b.matrixIndicesOverride[3]):(E&&(w.matricesIndices[4*J]=E[b.vertexIdxForBones],w.matricesIndices[4*J+1]=E[b.vertexIdxForBones+1],w.matricesIndices[4*J+2]=E[b.vertexIdxForBones+2],w.matricesIndices[4*J+3]=E[b.vertexIdxForBones+3]),r&&w.matricesIndicesExtra&&(w.matricesIndicesExtra[4*J]=r[b.vertexIdxForBones],w.matricesIndicesExtra[4*J+1]=r[b.vertexIdxForBones+1],w.matricesIndicesExtra[4*J+2]=r[b.vertexIdxForBones+2],w.matricesIndicesExtra[4*J+3]=r[b.vertexIdxForBones+3])),b.matrixWeightsOverride?(w.matricesWeights[4*J]=b.matrixWeightsOverride[0],w.matricesWeights[4*J+1]=b.matrixWeightsOverride[1],w.matricesWeights[4*J+2]=b.matrixWeightsOverride[2],w.matricesWeights[4*J+3]=b.matrixWeightsOverride[3]):(N&&(w.matricesWeights[4*J]=N[b.vertexIdxForBones],w.matricesWeights[4*J+1]=N[b.vertexIdxForBones+1],w.matricesWeights[4*J+2]=N[b.vertexIdxForBones+2],w.matricesWeights[4*J+3]=N[b.vertexIdxForBones+3]),M&&w.matricesWeightsExtra&&(w.matricesWeightsExtra[4*J]=M[b.vertexIdxForBones],w.matricesWeightsExtra[4*J+1]=M[b.vertexIdxForBones+1],w.matricesWeightsExtra[4*J+2]=M[b.vertexIdxForBones+2],w.matricesWeightsExtra[4*J+3]=M[b.vertexIdxForBones+3]))),d.captureUVS)b.uv.toArray(w.hC,2*J);else{w.hC.push(.5+b.position.x/h.x);const C=.5+b.position.y/h.y;w.hC.push(R.e?1-C:C)}J++}}}0===w.indices.length&&(w.indices=null),0===w.MC.length&&(w.MC=null),0===w.KC.length&&(w.KC=null),0===w.hC.length&&(w.hC=null),0===(null===(j=w.matricesIndices)||void 0===j?void 0:j.length)&&(w.matricesIndices=null),0===(null===(g=w.matricesWeights)||void 0===g?void 0:g.length)&&(w.matricesWeights=null),0===(null===(k=w.matricesIndicesExtra)||void 0===k?void 0:k.length)&&(w.matricesIndicesExtra=null),0===(null===(Z=w.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(w.matricesWeightsExtra=null);const a=new X.b(C,c.NC());return w.fC(a),u?(a.skeleton=c.skeleton,a.parent=c):(a.position=K.clone(),a.rotation=new b.dd(z,f,L)),a.Tc(!0),a.refreshBoundingInfo(!0,!0),a}function G(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(C.subdivisions?C.subdivisions:2,1),d=0|Math.max(C.tessellation?C.tessellation:16,3),X=Math.max(C.height?C.height:1,0),P=Math.max(C.radius?C.radius:.25,0),p=0|Math.max(C.capSubdivisions?C.capSubdivisions:6,1),j=d,g=c,k=Math.max(C.radiusTop?C.radiusTop:P,0),Z=Math.max(C.radiusBottom?C.radiusBottom:P,0),U=X-(k+Z),A=2*Math.PI,u=Math.max(C.topCapSubdivisions?C.topCapSubdivisions:p,1),q=Math.max(C.bottomCapSubdivisions?C.bottomCapSubdivisions:p,1),B=Math.acos((Z-k)/X);let t=[];const e=[],n=[],W=[];let E=0;const N=[],r=.5*U,M=.5*Math.PI;let K,i;const h=b.dd.Zero(),L=b.dd.Zero(),f=Math.cos(B),T=Math.sin(B),z=new b.Vector2(k*T,r+k*f).Xd(new b.Vector2(Z*T,Z*f-r)).length(),w=k*B+z+Z*(M-B);let J=0;for(i=0;i<=u;i++){const C=[],c=M-B*(i/u);J+=k*B/u;const d=Math.cos(c),b=Math.sin(c),X=d*k;for(K=0;K<=j;K++){const c=K/j,P=c*A+0,V=Math.sin(P),p=Math.cos(P);L.x=X*V,L.y=r+b*k,L.z=X*p,e.push(L.x,L.y,L.z),h.set(d*V,b,d*p),n.push(h.x,h.y,h.z),W.push(c,R.e?J/w:1-J/w),C.push(E),E++}N.push(C)}const y=X-k-Z+f*k-f*Z,x=T*(Z-k)/y;for(i=1;i<=g;i++){const C=[];J+=z/g;const c=T*(i*(Z-k)/g+k);for(K=0;K<=j;K++){const d=K/j,b=d*A+0,X=Math.sin(b),P=Math.cos(b);L.x=c*X,L.y=r+f*k-i*y/g,L.z=c*P,e.push(L.x,L.y,L.z),h.set(X,x,P).normalize(),n.push(h.x,h.y,h.z),W.push(d,R.e?J/w:1-J/w),C.push(E),E++}N.push(C)}for(i=1;i<=q;i++){const C=[],c=M-B-(Math.PI-B)*(i/q);J+=Z*B/q;const d=Math.cos(c),b=Math.sin(c),X=d*Z;for(K=0;K<=j;K++){const c=K/j,P=c*A+0,V=Math.sin(P),p=Math.cos(P);L.x=X*V,L.y=b*Z-r,L.z=X*p,e.push(L.x,L.y,L.z),h.set(d*V,b,d*p),n.push(h.x,h.y,h.z),W.push(c,R.e?J/w:1-J/w),C.push(E),E++}N.push(C)}for(K=0;K<j;K++)for(i=0;i<u+g+q;i++){const C=N[i][K],c=N[i+1][K],d=N[i+1][K+1],b=N[i][K+1];t.push(C),t.push(c),t.push(b),t.push(c),t.push(d),t.push(b)}if(t=t.reverse(),C.orientation&&!C.orientation.equals(b.dd.Up())){const c=new b.Matrix;C.orientation.clone().scale(.5*Math.PI).cross(b.dd.Up()).toQuaternion().toRotationMatrix(c);const d=b.dd.Zero();for(let C=0;C<e.length;C+=3)d.set(e[C],e[C+1],e[C+2]),b.dd.TransformCoordinatesToRef(d.clone(),c,d),e[C]=d.x,e[C+1]=d.y,e[C+2]=d.z}const H=new V.e;return H.MC=e,H.KC=n,H.hC=W,H.indices=t,H}function a(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:b.dd.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new X.b(C,d);return G(c).fC(P,c.updatable),P}X.b.CreateDecal=(C,c,d,b,X,P)=>S(C,c,{position:d,normal:b,size:X,angle:P});X.b.CreateCapsule=(C,c,d)=>a(C,c,d),V.e.CreateCapsule=G;var O=d(12233),CC=d(12412);class cC{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=C,this.y=c,C!==Math.floor(C)&&(C=Math.floor(C),O.d.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),O.d.Warn("y is not an integer, floor(y) used"))}clone(){return new cC(this.x,this.y)}rotate60About(C){const c=this.x;return this.x=C.x+C.y-this.y,this.y=c+this.y-C.x,this}rotateNeg60About(C){const c=this.x;return this.x=c+this.y-C.y,this.y=C.x+C.y-c,this}rotate120(C,c){C!==Math.floor(C)&&(C=Math.floor(C),O.d.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),O.d.Warn("n not an integer only floor(n) used"));const d=this.x;return this.x=C-d-this.y,this.y=c+d,this}rotateNeg120(C,c){C!==Math.floor(C)&&(C=Math.floor(C),O.d.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),O.d.Warn("n is not an integer,   floor(n) used"));const d=this.x;return this.x=this.y-c,this.y=C+c-d-this.y,this}toCartesianOrigin(C,c){const d=b.dd.Zero();return d.x=C.x+2*this.x*c+this.y*c,d.y=C.y+Math.sqrt(3)*this.y*c,d}static Zero(){return new cC(0,0)}}class dC{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new bC("icosahedron","Regular",[[0,CC.f,-1],[-CC.f,1,0],[-1,0,-CC.f],[1,0,-CC.f],[CC.f,1,0],[0,CC.f,1],[-1,0,CC.f],[-CC.f,-1,0],[0,-CC.f,-1],[CC.f,-1,0],[1,0,CC.f],[0,-CC.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let C=12;const c={},d=this.m,b=this.n;let X,P,V,R,p,j=d,g=1,k=0;0!==b&&(j=(0,s.HighestCommonFactor)(d,b)),g=d/j,k=b/j;const Z=cC.Zero(),U=new cC(d,b),A=new cC(-b,d+b),u=cC.Zero(),q=cC.Zero(),B=cC.Zero();let t,e,n,W,E=[];const N=[],r=this.vertByDist,M=(d,b,X,P)=>{t=d+"|"+X,e=b+"|"+P,t in c||e in c?t in c&&!(e in c)?c[e]=c[t]:e in c&&!(t in c)&&(c[t]=c[e]):(c[t]=C,c[e]=C,C++),r[X][0]>2?N[c[t]]=[-r[X][0],r[X][1],c[t]]:N[c[t]]=[E[r[X][0]],r[X][1],c[t]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(E=this.IDATA.face[K],V=E[2],R=E[1],p=E[0],n=Z.x+"|"+Z.y,t=K+"|"+n,t in c||(c[t]=V,N[V]=[E[r[n][0]],r[n][1]]),n=U.x+"|"+U.y,t=K+"|"+n,t in c||(c[t]=R,N[R]=[E[r[n][0]],r[n][1]]),n=A.x+"|"+A.y,t=K+"|"+n,t in c||(c[t]=p,N[p]=[E[r[n][0]],r[n][1]]),X=this.IDATA.edgematch[K][0],P=this.IDATA.edgematch[K][1],"B"===P)for(let C=1;C<j;C++)q.x=d-C*(g+k),q.y=b+C*g,B.x=-C*k,B.y=C*(g+k),n=q.x+"|"+q.y,W=B.x+"|"+B.y,M(K,X,n,W);if("O"===P)for(let C=1;C<j;C++)B.x=-C*k,B.y=C*(g+k),u.x=C*g,u.y=C*k,n=B.x+"|"+B.y,W=u.x+"|"+u.y,M(K,X,n,W);if(X=this.IDATA.edgematch[K][2],P=this.IDATA.edgematch[K][3],P&&"A"===P)for(let C=1;C<j;C++)u.x=C*g,u.y=C*k,q.x=d-(j-C)*(g+k),q.y=b+(j-C)*g,n=u.x+"|"+u.y,W=q.x+"|"+q.y,M(K,X,n,W);for(let d=0;d<this.vertices.length;d++)n=this.vertices[d].x+"|"+this.vertices[d].y,t=K+"|"+n,t in c||(c[t]=C++,r[n][0]>2?N[c[t]]=[-r[n][0],r[n][1],c[t]]:N[c[t]]=[E[r[n][0]],r[n][1],c[t]])}this.closestTo=N,this.vecToidx=c}calcCoeffs(){const C=this.m,c=this.n,d=Math.sqrt(3)/3,b=C*C+c*c+C*c;this.coau=(C+c)/b,this.cobu=-c/b,this.coav=-d*(C-c)/b,this.cobv=d*(2*C+c)/b}createInnerFacets(){const C=this.m,c=this.n;for(let d=0;d<c+C+1;d++)for(let C=this.min[d];C<this.max[d]+1;C++)C<this.max[d]&&C<this.max[d+1]+1&&this.innerFacets.push(["|"+C+"|"+d,"|"+C+"|"+(d+1),"|"+(C+1)+"|"+d]),d>0&&C<this.max[d-1]&&C+1<this.max[d]+1&&this.innerFacets.push(["|"+C+"|"+d,"|"+(C+1)+"|"+d,"|"+(C+1)+"|"+(d-1)])}edgeVecsABOB(){const C=this.m,c=this.n,d=new cC(-c,C+c);for(let b=1;b<C+c;b++){const C=new cC(this.min[b],b),c=new cC(this.min[b-1],b-1),X=new cC(this.min[b+1],b+1),P=C.clone(),V=c.clone(),R=X.clone();P.rotate60About(d),V.rotate60About(d),R.rotate60About(d);const p=new cC(this.max[P.y],P.y),j=new cC(this.max[P.y-1],P.y-1),g=new cC(this.max[P.y-1]-1,P.y-1);P.x===p.x&&P.y===p.y||(P.x!==j.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,j,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,g,p])):P.y===R.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([C,c,j]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([C,j,X])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([C,c,j]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,j,p])))}}mapABOBtoOBOA(){const C=new cC(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const d=[];for(let b=0;b<3;b++)C.x=this.isoVecsABOB[c][b].x,C.y=this.isoVecsABOB[c][b].y,0===this.vertexTypes[c][b]&&C.rotateNeg120(this.m,this.n),d.push(C.clone());this.isoVecsOBOA.push(d)}}mapABOBtoBAOA(){const C=new cC(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const d=[];for(let b=0;b<3;b++)C.x=this.isoVecsABOB[c][b].x,C.y=this.isoVecsABOB[c][b].y,1===this.vertexTypes[c][b]&&C.rotate120(this.m,this.n),d.push(C.clone());this.isoVecsBAOA.push(d)}}MapToFace(C,c){const d=this.IDATA.face[C],X=d[2],P=d[1],V=d[0],R=b.dd.jd(this.IDATA.vertex[X]),p=b.dd.jd(this.IDATA.vertex[P]),j=b.dd.jd(this.IDATA.vertex[V]),g=p.Xd(R),k=j.Xd(R),Z=g.scale(this.coau).add(k.scale(this.cobu)),U=g.scale(this.coav).add(k.scale(this.cobv)),A=[];let u,q=b.TmpVectors.dd[0];for(let b=0;b<this.cartesian.length;b++)q=Z.scale(this.cartesian[b].x).add(U.scale(this.cartesian[b].y)).add(R),A[b]=[q.x,q.y,q.z],u=C+"|"+this.vertices[b].x+"|"+this.vertices[b].y,c.vertex[this.vecToidx[u]]=[q.x,q.y,q.z]}build(C,c){const d=[],b=cC.Zero(),X=new cC(C,c),P=new cC(-c,C+c);d.push(b,X,P);for(let n=c;n<C+1;n++)for(let c=0;c<C+1-n;c++)d.push(new cC(c,n));if(c>0){const b=(0,s.HighestCommonFactor)(C,c),X=C/b,P=c/b;for(let R=1;R<b;R++)d.push(new cC(R*X,R*P)),d.push(new cC(-R*P,R*(X+P))),d.push(new cC(C-R*(X+P),c+R*X));const V=C/c;for(let R=1;R<c;R++)for(let b=0;b<R*V;b++)d.push(new cC(b,R)),d.push(new cC(b,R).rotate120(C,c)),d.push(new cC(b,R).rotateNeg120(C,c))}d.sort(((C,c)=>C.x-c.x)),d.sort(((C,c)=>C.y-c.y));const V=new Array(C+c+1),R=new Array(C+c+1);for(let n=0;n<V.length;n++)V[n]=1/0,R[n]=-1/0;let p=0,j=0;const g=d.length;for(let n=0;n<g;n++)j=d[n].x,p=d[n].y,V[p]=Math.min(j,V[p]),R[p]=Math.max(j,R[p]);const k=(d,b)=>{const X=d.clone();return"A"===b&&X.rotateNeg120(C,c),"B"===b&&X.rotate120(C,c),X.x<0?X.y:X.x+X.y},Z=[],U=[],A=[],u=[],q={},B=[];let t=-1,e=-1;for(let n=0;n<g;n++)Z[n]=d[n].toCartesianOrigin(new cC(0,0),.5),U[n]=k(d[n],"O"),A[n]=k(d[n],"A"),u[n]=k(d[n],"B"),U[n]===A[n]&&A[n]===u[n]?(t=3,e=U[n]):U[n]===A[n]?(t=4,e=U[n]):A[n]===u[n]?(t=5,e=A[n]):u[n]===U[n]&&(t=6,e=U[n]),U[n]<A[n]&&U[n]<u[n]&&(t=2,e=U[n]),A[n]<U[n]&&A[n]<u[n]&&(t=1,e=A[n]),u[n]<A[n]&&u[n]<U[n]&&(t=0,e=u[n]),B.push([t,e,d[n].x,d[n].y]);B.sort(((C,c)=>C[2]-c[2])),B.sort(((C,c)=>C[3]-c[3])),B.sort(((C,c)=>C[1]-c[1])),B.sort(((C,c)=>C[0]-c[0]));for(let n=0;n<B.length;n++)q[B[n][2]+"|"+B[n][3]]=[B[n][0],B[n][1],n];return this.m=C,this.n=c,this.vertices=d,this.vertByDist=q,this.cartesian=Z,this.min=V,this.max=R,this}}class bC{constructor(C,c,d,b){this.name=C,this.category=c,this.vertex=d,this.face=b}}class XC extends bC{innerToData(C,c){for(let d=0;d<c.innerFacets.length;d++)this.face.push(c.innerFacets[d].map((d=>c.vecToidx[C+d])))}mapABOBtoDATA(C,c){const d=c.IDATA.edgematch[C][0];for(let b=0;b<c.isoVecsABOB.length;b++){const X=[];for(let P=0;P<3;P++)0===c.vertexTypes[b][P]?X.push(C+"|"+c.isoVecsABOB[b][P].x+"|"+c.isoVecsABOB[b][P].y):X.push(d+"|"+c.isoVecsABOB[b][P].x+"|"+c.isoVecsABOB[b][P].y);this.face.push([c.vecToidx[X[0]],c.vecToidx[X[1]],c.vecToidx[X[2]]])}}mapOBOAtoDATA(C,c){const d=c.IDATA.edgematch[C][0];for(let b=0;b<c.isoVecsOBOA.length;b++){const X=[];for(let P=0;P<3;P++)1===c.vertexTypes[b][P]?X.push(C+"|"+c.isoVecsOBOA[b][P].x+"|"+c.isoVecsOBOA[b][P].y):X.push(d+"|"+c.isoVecsOBOA[b][P].x+"|"+c.isoVecsOBOA[b][P].y);this.face.push([c.vecToidx[X[0]],c.vecToidx[X[1]],c.vecToidx[X[2]]])}}mapBAOAtoDATA(C,c){const d=c.IDATA.edgematch[C][2];for(let b=0;b<c.isoVecsBAOA.length;b++){const X=[];for(let P=0;P<3;P++)1===c.vertexTypes[b][P]?X.push(C+"|"+c.isoVecsBAOA[b][P].x+"|"+c.isoVecsBAOA[b][P].y):X.push(d+"|"+c.isoVecsBAOA[b][P].x+"|"+c.isoVecsBAOA[b][P].y);this.face.push([c.vecToidx[X[0]],c.vecToidx[X[1]],c.vecToidx[X[2]]])}}orderData(C){const c=[];for(let P=0;P<13;P++)c[P]=[];const d=C.closestTo;for(let P=0;P<d.length;P++)d[P][0]>-1?d[P][1]>0&&c[d[P][0]].push([P,d[P][1]]):c[12].push([P,d[P][0]]);const b=[];for(let P=0;P<12;P++)b[P]=P;let X=12;for(let P=0;P<12;P++){c[P].sort(((C,c)=>C[1]-c[1]));for(let C=0;C<c[P].length;C++)b[c[P][C][0]]=X++}for(let P=0;P<c[12].length;P++)b[c[12][P][0]]=X++;for(let P=0;P<this.vertex.length;P++)this.vertex[P].push(b[P]);this.vertex.sort(((C,c)=>C[3]-c[3]));for(let P=0;P<this.vertex.length;P++)this.vertex[P].pop();for(let P=0;P<this.face.length;P++)for(let C=0;C<this.face[P].length;C++)this.face[P][C]=b[this.face[P][C]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(C,c){const d=[],b=[];let X=c.pop();b.push(X);let P=this.face[X].indexOf(C);P=(P+2)%3;let V=this.face[X][P];d.push(V);let R=0;for(;c.length>0;)X=c[R],this.face[X].indexOf(V)>-1?(P=(this.face[X].indexOf(V)+1)%3,V=this.face[X][P],d.push(V),b.push(X),c.splice(R,1),R=0):R++;return this.adjacentFaces.push(d),b}toGoldbergPolyhedronData(){const C=new bC("GeoDual","Goldberg",[],[]);C.name="GD dual";const c=this.vertex.length,d=new Array(c);for(let p=0;p<c;p++)d[p]=[];for(let p=0;p<this.face.length;p++)for(let C=0;C<3;C++)d[this.face[p][C]].push(p);let b=0,X=0,P=0,V=[],R=[];this.adjacentFaces=[];for(let p=0;p<d.length;p++){C.face[p]=this.setOrder(p,d[p].concat([]));for(const c of d[p]){b=0,X=0,P=0,V=this.face[c];for(let C=0;C<3;C++)R=this.vertex[V[C]],b+=R[0],X+=R[1],P+=R[2];C.vertex[c]=[b/3,X/3,P/3]}}return C}static BuildGeodesicData(C){const c=new XC("Geodesic-m-n","Geodesic",[[0,CC.f,-1],[-CC.f,1,0],[-1,0,-CC.f],[1,0,-CC.f],[CC.f,1,0],[0,CC.f,1],[-1,0,CC.f],[-CC.f,-1,0],[0,-CC.f,-1],[CC.f,-1,0],[1,0,CC.f],[0,-CC.f,1]],[]);C.setIndices(),C.calcCoeffs(),C.createInnerFacets(),C.edgeVecsABOB(),C.mapABOBtoOBOA(),C.mapABOBtoBAOA();for(let d=0;d<C.IDATA.face.length;d++)C.MapToFace(d,c),c.innerToData(d,C),"B"===C.IDATA.edgematch[d][1]&&c.mapABOBtoDATA(d,C),"O"===C.IDATA.edgematch[d][1]&&c.mapOBOAtoDATA(d,C),"A"===C.IDATA.edgematch[d][3]&&c.mapBAOAtoDATA(d,C);c.orderData(C);return c.vertex=c.vertex.map((function(C){const c=C[0],d=C[1],b=C[2],X=Math.sqrt(c*c+d*d+b*b);return C[0]*=1/X,C[1]*=1/X,C[2]*=1/X,C})),c}}X.b._GoldbergMeshParser=(C,c)=>PC.Parse(C,c);class PC extends X.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(C,c){return void 0===c?(C>this.goldbergData.nbUnsharedFaces-1&&(O.d.Warn("Maximum number of unshared faces used"),C=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+C):(C>11&&(O.d.Warn("Last pole used"),C=11),c>this.goldbergData.nbFacesAtPole-1&&(O.d.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+C*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(C){for(let d=0;d<C.length;d++){const c=C[d][0],b=C[d][1],X=C[d][2];for(let C=c;C<b+1;C++)this.goldbergData.faceColors[C]=X}const c=[];for(let d=0;d<12;d++)for(let C=0;C<5;C++)c.push(this.goldbergData.faceColors[d].r,this.goldbergData.faceColors[d].g,this.goldbergData.faceColors[d].b,this.goldbergData.faceColors[d].a);for(let d=12;d<this.goldbergData.faceColors.length;d++)for(let C=0;C<6;C++)c.push(this.goldbergData.faceColors[d].r,this.goldbergData.faceColors[d].g,this.goldbergData.faceColors[d].b,this.goldbergData.faceColors[d].a);return c}setGoldbergFaceColors(C){const c=this._changeGoldbergFaceColors(C);this.JC(P.g.ColorKind,c)}updateGoldbergFaceColors(C){const c=this._changeGoldbergFaceColors(C);this.updateVerticesData(P.g.ColorKind,c)}_changeGoldbergFaceUVs(C){const c=this.getVerticesData(P.g.UVKind);for(let d=0;d<C.length;d++){const b=C[d][0],X=C[d][1],P=C[d][2],V=C[d][3],R=C[d][4],p=[],j=[];let g,k;for(let C=0;C<5;C++)g=P.x+V*Math.cos(R+C*Math.PI/2.5),k=P.y+V*Math.sin(R+C*Math.PI/2.5),g<0&&(g=0),g>1&&(g=1),p.push(g,k);for(let C=0;C<6;C++)g=P.x+V*Math.cos(R+C*Math.PI/3),k=P.y+V*Math.sin(R+C*Math.PI/3),g<0&&(g=0),g>1&&(g=1),j.push(g,k);for(let C=b;C<Math.min(12,X+1);C++)for(let d=0;d<5;d++)c[10*C+2*d]=p[2*d],c[10*C+2*d+1]=p[2*d+1];for(let C=Math.max(12,b);C<X+1;C++)for(let d=0;d<6;d++)c[12*C-24+2*d]=j[2*d],c[12*C-23+2*d]=j[2*d+1]}return c}setGoldbergFaceUVs(C){const c=this._changeGoldbergFaceUVs(C);this.JC(P.g.UVKind,c)}updateGoldbergFaceUVs(C){const c=this._changeGoldbergFaceUVs(C);this.updateVerticesData(P.g.UVKind,c)}placeOnGoldbergFaceAt(C,c,d){const X=b.dd.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);C.rotation=X,C.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(d.x)).add(this.goldbergData.faceYaxis[c].scale(d.y)).add(this.goldbergData.faceZaxis[c].scale(d.z))}serialize(C){super.serialize(C),C.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const C of this.goldbergData.faceColors)c.faceColors.push(C.rc())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const C of this.goldbergData.faceCenters)c.faceCenters.push(C.rc())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const C of this.goldbergData.faceZaxis)c.faceZaxis.push(C.rc())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const C of this.goldbergData.faceYaxis)c.faceYaxis.push(C.rc())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const C of this.goldbergData.faceXaxis)c.faceXaxis.push(C.rc())}C.goldbergData=c}static Parse(C,c){const d=C.goldbergData;d.faceColors=d.faceColors.map((C=>Z.vc.jd(C))),d.faceCenters=d.faceCenters.map((C=>b.dd.jd(C))),d.faceZaxis=d.faceZaxis.map((C=>b.dd.jd(C))),d.faceXaxis=d.faceXaxis.map((C=>b.dd.jd(C))),d.faceYaxis=d.faceYaxis.map((C=>b.dd.jd(C)));const X=new PC(C.name,c);return X.goldbergData=d,X}}var VC=d(12956);const RC={CreateBox:k.e,CreateTiledBox:q,CreateSphere:B.c,CreateDisc:g.b,CreateIcoSphere:D,CreateRibbon:j,CreateCylinder:W,CreateTorus:N,CreateTorusKnot:M,CreateLineSystem:K.f,Gg:K.i,CreateDashedLines:K.b,ExtrudeShape:L,ExtrudeShapeCustom:f,CreateLathe:z,CreateTiledPlane:A,Ck:w.e,CreateGround:J.g,CreateTiledGround:J.h,CreateGroundFromHeightMap:J.c,CreatePolygon:i.c,ExtrudePolygon:i.e,CreateTube:y,CreatePolyhedron:H,CreateGeodesic:function(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=c.m||1;b!==Math.floor(b)&&(b=Math.floor(b),O.d.Warn("m not an integer only floor(m) used"));let X=c.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),O.d.Warn("n not an integer only floor(n) used")),X>b){const C=X;X=b,b=C,O.d.Warn("n > m therefore m and n swapped")}const P=new dC;return P.build(b,X),H(C,{custom:XC.BuildGeodesicData(P),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},d)},CreateGoldberg:function(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.size,p=c.sizeX||P||1,j=c.sizeY||P||1,g=c.sizeZ||P||1;let k=c.m||1;k!==Math.floor(k)&&(k=Math.floor(k),O.d.Warn("m not an integer only floor(m) used"));let U=c.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),O.d.Warn("n not an integer only floor(n) used")),U>k){const C=U;U=k,k=C,O.d.Warn("n > m therefore m and n swapped")}const A=new dC;A.build(k,U);const u=XC.BuildGeodesicData(A),q=u.toGoldbergPolyhedronData(),B=new PC(C,d);c.sideOrientation=X.b._GetDefaultSideOrientation(c.sideOrientation),B._originalBuilderSideOrientation=c.sideOrientation;(function(C,c){const d=C.size,X=C.sizeX||d||1,P=C.sizeY||d||1,p=C.sizeZ||d||1,j=0===C.sideOrientation?0:C.sideOrientation||V.e.DEFAULTSIDE,g=[],k=[],Z=[],U=[];let A=1/0,u=-1/0,q=1/0,B=-1/0;for(let b=0;b<c.vertex.length;b++)A=Math.min(A,c.vertex[b][0]*X),u=Math.max(u,c.vertex[b][0]*X),q=Math.min(q,c.vertex[b][1]*P),B=Math.max(B,c.vertex[b][1]*P);let t=0;for(let V=0;V<c.face.length;V++){const C=c.face[V],d=b.dd.jd(c.vertex[C[0]]),j=b.dd.jd(c.vertex[C[2]]),e=b.dd.jd(c.vertex[C[1]]),n=j.Xd(d),W=e.Xd(d),E=b.dd.Cross(W,n).normalize();for(let b=0;b<C.length;b++){Z.push(E.x,E.y,E.z);const d=c.vertex[C[b]];g.push(d[0]*X,d[1]*P,d[2]*p);const V=(d[1]*P-q)/(B-q);U.push((d[0]*X-A)/(u-A),R.e?1-V:V)}for(let c=0;c<C.length-2;c++)k.push(t,t+c+2,t+c+1);t+=C.length}V.e._ComputeSides(j,g,k,Z,U);const e=new V.e;return e.MC=g,e.indices=k,e.KC=Z,e.hC=U,e})(c,q).fC(B,c.updatable),B.goldbergData.nbSharedFaces=u.sharedNodes,B.goldbergData.nbUnsharedFaces=u.poleNodes,B.goldbergData.adjacentFaces=u.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let X=0;X<u.vertex.length;X++)B.goldbergData.faceCenters.push(b.dd.jd(u.vertex[X])),B.goldbergData.faceCenters[X].x*=p,B.goldbergData.faceCenters[X].y*=j,B.goldbergData.faceCenters[X].z*=g,B.goldbergData.faceColors.push(new Z.vc(1,1,1,1));for(let X=0;X<q.face.length;X++){const C=q.face[X],c=b.dd.jd(q.vertex[C[0]]),d=b.dd.jd(q.vertex[C[2]]),P=b.dd.jd(q.vertex[C[1]]),V=d.Xd(c),R=P.Xd(c),p=b.dd.Cross(R,V).normalize(),j=b.dd.Cross(R,p).normalize();B.goldbergData.faceXaxis.push(R.normalize()),B.goldbergData.faceYaxis.push(p),B.goldbergData.faceZaxis.push(j)}return B},CreateDecal:S,CreateCapsule:a,CreateText:VC.f}},13724:(C,c,d)=>{"use strict";d.d(c,{c:()=>Rc});var b=d(12403),X=d(12774);class P extends X.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var V=d(12438),R=(d(12570),d(12345));class p{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(C){this._targetStopDuration!==C&&(this._targetStopDuration=C)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(C){this._noiseTexture!==C&&(this._noiseTexture=C,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(C){this._animationSheetEnabled!==C&&(this._animationSheetEnabled=C)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(C){this._isAnimationSheetEnabled!=C&&(this._isAnimationSheetEnabled=C,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(C){this._useLogarithmicDepth=C&&this.NC().getEngine().getCaps().fragmentDepthSupported}NC(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(C){switch(C){case p.BLENDMODE_MULTIPLYADD:return;case p.BLENDMODE_ADD:C=1;break;case p.BLENDMODE_ONEONE:C=6;break;case p.BLENDMODE_STANDARD:C=2;break;case p.BLENDMODE_MULTIPLY:C=4;break;case p.BLENDMODE_SUBTRACT:C=3}this._engine.setAlphaMode(C)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:b.dd.Zero()}set direction1(C){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=C)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:b.dd.Zero()}set direction2(C){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=C)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:b.dd.Zero()}set minEmitBox(C){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=C)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:b.dd.Zero()}set maxEmitBox(C){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=C)}get billboardMode(){return this._billboardMode}set billboardMode(C){this._billboardMode!==C&&(this._billboardMode=C,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(C){this._isBillboardBased!==C&&(this._isBillboardBased=C,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(C){this._attachImageProcessingConfiguration(C)}_attachImageProcessingConfiguration(C){C!==this._imageProcessingConfiguration&&(!C&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=C)}_reset(){}_removeGradientAndTexture(C,c,d){if(!c)return this;let b=0;for(const X of c){if(X.gradient===C){c.splice(b,1);break}b++}return d&&d.dispose(),this}constructor(C){this.animations=[],this.renderingGroupId=0,this.bc=b.dd.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new b.dd(10,10,10),this.onAnimationEnd=null,this.blendMode=p.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new b.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Yg=new b.dd(0,0,0),this._useLogarithmicDepth=!1,this.gravity=b.dd.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new V.vc(1,1,1,1),this.color2=new V.vc(1,1,1,1),this.colorDead=new V.vc(0,0,0,1),this.textureMask=new V.vc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new P,this.id=C,this.name=C}createPointEmitter(C,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new b.dd(0,1,0),arguments.length>2&&void 0!==arguments[2]||new b.dd(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new b.dd(0,1,0),arguments.length>4&&void 0!==arguments[4]||new b.dd(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new b.dd(0,1,0),arguments.length>3&&void 0!==arguments[3]||new b.dd(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(C,c,d,b){throw new Error("Method not implemented.")}}p.BLENDMODE_ONEONE=0,p.BLENDMODE_STANDARD=1,p.BLENDMODE_ADD=2,p.BLENDMODE_MULTIPLY=3,p.BLENDMODE_MULTIPLYADD=4,p.BLENDMODE_SUBTRACT=-1,(0,R.e)("BABYLON.BaseParticleSystem",p);var j=d(12418),g=d(12235);class k{constructor(){this.direction1=new b.dd(0,1,0),this.direction2=new b.dd(0,1,0),this.minEmitBox=new b.dd(-.5,-.5,-.5),this.maxEmitBox=new b.dd(.5,.5,.5)}startDirectionFunction(C,c,d,X){const P=(0,j.RandomRange)(this.direction1.x,this.direction2.x),V=(0,j.RandomRange)(this.direction1.y,this.direction2.y),R=(0,j.RandomRange)(this.direction1.z,this.direction2.z);if(X)return c.x=P,c.y=V,void(c.z=R);b.dd.TransformNormalFromFloatsToRef(P,V,R,C,c)}startPositionFunction(C,c,d,X){const P=(0,j.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),V=(0,j.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),R=(0,j.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(X)return c.x=P,c.y=V,void(c.z=R);b.dd.TransformCoordinatesFromFloatsToRef(P,V,R,C,c)}clone(){const C=new k;return g.d.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2),C.setVector3("minEmitBox",this.minEmitBox),C.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3),C.addUniform("minEmitBox",3),C.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.direction1=this.direction1.rc(),C.direction2=this.direction2.rc(),C.minEmitBox=this.minEmitBox.rc(),C.maxEmitBox=this.maxEmitBox.rc(),C}parse(C){b.dd.FromArrayToRef(C.direction1,0,this.direction1),b.dd.FromArrayToRef(C.direction2,0,this.direction2),b.dd.FromArrayToRef(C.minEmitBox,0,this.minEmitBox),b.dd.FromArrayToRef(C.maxEmitBox,0,this.maxEmitBox)}}class Z{get radius(){return this._radius}set radius(C){this._radius=C,this._buildHeight()}get angle(){return this._angle}set angle(C){this._angle=C,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=d,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=C}startDirectionFunction(C,c,d,X){X?b.TmpVectors.dd[0].V(d.pj).normalize():d.position.subtractToRef(C.getTranslation(),b.TmpVectors.dd[0]).normalize();const P=(0,j.RandomRange)(0,this.directionRandomizer),V=(0,j.RandomRange)(0,this.directionRandomizer),R=(0,j.RandomRange)(0,this.directionRandomizer);c.x=b.TmpVectors.dd[0].x+P,c.y=b.TmpVectors.dd[0].y+V,c.z=b.TmpVectors.dd[0].z+R,c.normalize()}startPositionFunction(C,c,d,X){const P=(0,j.RandomRange)(0,2*Math.PI);let V;this.emitFromSpawnPointOnly?V=1e-4:(V=(0,j.RandomRange)(0,this.heightRange),V=1-V*V);let R=this._radius-(0,j.RandomRange)(0,this._radius*this.radiusRange);R*=V;const p=R*Math.sin(P),g=R*Math.cos(P),k=V*this._height;if(X)return c.x=p,c.y=k,void(c.z=g);b.dd.TransformCoordinatesFromFloatsToRef(p,k,g,C,c)}clone(){const C=new Z(this._radius,this._angle,this.directionRandomizer);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat2("radius",this._radius,this.radiusRange),C.setFloat("coneAngle",this._angle),C.setFloat2("height",this._height,this.heightRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",2),C.addUniform("coneAngle",1),C.addUniform("height",2),C.addUniform("directionRandomizer",1)}getEffectDefines(){let C="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(C+="\n#define CONEEMITTERSPAWNPOINT"),C}getClassName(){return"ConeParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this._radius,C.angle=this._angle,C.directionRandomizer=this.directionRandomizer,C.radiusRange=this.radiusRange,C.heightRange=this.heightRange,C.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,C}parse(C){this.radius=C.radius,this.angle=C.angle,this.directionRandomizer=C.directionRandomizer,this.radiusRange=void 0!==C.radiusRange?C.radiusRange:1,this.heightRange=void 0!==C.radiusRange?C.heightRange:1,this.emitFromSpawnPointOnly=void 0!==C.emitFromSpawnPointOnly&&C.emitFromSpawnPointOnly}}class U extends Z{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0);super(C,c),this.direction1=d,this.direction2=X}startDirectionFunction(C,c){const d=(0,j.RandomRange)(this.direction1.x,this.direction2.x),X=(0,j.RandomRange)(this.direction1.y,this.direction2.y),P=(0,j.RandomRange)(this.direction1.z,this.direction2.z);b.dd.TransformNormalFromFloatsToRef(d,X,P,C,c)}clone(){const C=new U(this.radius,this.angle,this.direction1,this.direction2);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.rc(),C.direction2=this.direction2.rc(),C}parse(C){super.parse(C),this.direction1.V(C.direction1),this.direction2.V(C.direction2)}}class A{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=C,this.height=c,this.radiusRange=d,this.directionRandomizer=X,this._tempVector=b.dd.Zero()}startDirectionFunction(C,c,d,X,P){d.position.subtractToRef(C.getTranslation(),this._tempVector),this._tempVector.normalize(),b.dd.TransformNormalToRef(this._tempVector,P,this._tempVector);const V=(0,j.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let R=Math.atan2(this._tempVector.x,this._tempVector.z);R+=(0,j.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=V,this._tempVector.x=Math.sin(R),this._tempVector.z=Math.cos(R),this._tempVector.normalize(),X?c.V(this._tempVector):b.dd.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,C,c)}startPositionFunction(C,c,d,X){const P=(0,j.RandomRange)(-this.height/2,this.height/2),V=(0,j.RandomRange)(0,2*Math.PI),R=(0,j.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),p=Math.sqrt(R)*this.radius,g=p*Math.cos(V),k=p*Math.sin(V);X?c.yc(g,P,k):b.dd.TransformCoordinatesFromFloatsToRef(g,P,k,C,c)}clone(){const C=new A(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("height",this.height),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("height",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this.radius,C.height=this.height,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.radius=C.radius,this.height=C.height,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class u extends A{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.dd(0,1,0);super(C,c,d),this.direction1=X,this.direction2=P}startDirectionFunction(C,c,d,X){const P=(0,j.RandomRange)(this.direction1.x,this.direction2.x),V=(0,j.RandomRange)(this.direction1.y,this.direction2.y),R=(0,j.RandomRange)(this.direction1.z,this.direction2.z);X?c.yc(P,V,R):b.dd.TransformNormalFromFloatsToRef(P,V,R,C,c)}clone(){const C=new u(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("height",this.height),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("height",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.rc(),C.direction2=this.direction2.rc(),C}parse(C){super.parse(C),b.dd.FromArrayToRef(C.direction1,0,this.direction1),b.dd.FromArrayToRef(C.direction2,0,this.direction2)}}class q{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=C,this.radiusRange=c,this.directionRandomizer=d}startDirectionFunction(C,c,d,X){const P=d.position.Xd(C.getTranslation()).normalize(),V=(0,j.RandomRange)(0,this.directionRandomizer),R=(0,j.RandomRange)(0,this.directionRandomizer),p=(0,j.RandomRange)(0,this.directionRandomizer);P.x+=V,P.y+=R,P.z+=p,P.normalize(),X?c.V(P):b.dd.TransformNormalFromFloatsToRef(P.x,P.y,P.z,C,c)}startPositionFunction(C,c,d,X){const P=this.radius-(0,j.RandomRange)(0,this.radius*this.radiusRange),V=(0,j.RandomRange)(0,1),R=(0,j.RandomRange)(0,2*Math.PI),p=Math.acos(2*V-1),g=P*Math.cos(R)*Math.sin(p),k=P*Math.cos(p),Z=P*Math.sin(R)*Math.sin(p);X?c.yc(g,Math.abs(k),Z):b.dd.TransformCoordinatesFromFloatsToRef(g,Math.abs(k),Z,C,c)}clone(){const C=new q(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this.radius,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.radius=C.radius,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class B{constructor(){this.direction1=new b.dd(0,1,0),this.direction2=new b.dd(0,1,0)}startDirectionFunction(C,c,d,X){const P=(0,j.RandomRange)(this.direction1.x,this.direction2.x),V=(0,j.RandomRange)(this.direction1.y,this.direction2.y),R=(0,j.RandomRange)(this.direction1.z,this.direction2.z);X?c.yc(P,V,R):b.dd.TransformNormalFromFloatsToRef(P,V,R,C,c)}startPositionFunction(C,c,d,X){X?c.yc(0,0,0):b.dd.TransformCoordinatesFromFloatsToRef(0,0,0,C,c)}clone(){const C=new B;return g.d.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.direction1=this.direction1.rc(),C.direction2=this.direction2.rc(),C}parse(C){b.dd.FromArrayToRef(C.direction1,0,this.direction1),b.dd.FromArrayToRef(C.direction2,0,this.direction2)}}class t{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=C,this.radiusRange=c,this.directionRandomizer=d}startDirectionFunction(C,c,d,X){const P=d.position.Xd(C.getTranslation()).normalize(),V=(0,j.RandomRange)(0,this.directionRandomizer),R=(0,j.RandomRange)(0,this.directionRandomizer),p=(0,j.RandomRange)(0,this.directionRandomizer);P.x+=V,P.y+=R,P.z+=p,P.normalize(),X?c.V(P):b.dd.TransformNormalFromFloatsToRef(P.x,P.y,P.z,C,c)}startPositionFunction(C,c,d,X){const P=this.radius-(0,j.RandomRange)(0,this.radius*this.radiusRange),V=(0,j.RandomRange)(0,1),R=(0,j.RandomRange)(0,2*Math.PI),p=Math.acos(2*V-1),g=P*Math.cos(R)*Math.sin(p),k=P*Math.cos(p),Z=P*Math.sin(R)*Math.sin(p);X?c.yc(g,k,Z):b.dd.TransformCoordinatesFromFloatsToRef(g,k,Z,C,c)}clone(){const C=new t(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this.radius,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.radius=C.radius,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class e extends t{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.dd(0,1,0),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0);super(C),this.direction1=c,this.direction2=d}startDirectionFunction(C,c){const d=(0,j.RandomRange)(this.direction1.x,this.direction2.x),X=(0,j.RandomRange)(this.direction1.y,this.direction2.y),P=(0,j.RandomRange)(this.direction1.z,this.direction2.z);b.dd.TransformNormalFromFloatsToRef(d,X,P,C,c)}clone(){const C=new e(this.radius,this.direction1,this.direction2);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.rc(),C.direction2=this.direction2.rc(),C}parse(C){super.parse(C),this.direction1.V(C.direction1),this.direction2.V(C.direction2)}}class n{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(C,c,d,X){const P=b.TmpVectors.dd[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,d,P);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,d,P);const C=b.TmpVectors.dd[1];P.subtractToRef(d.position,C),C.scaleToRef(1/d.lifeTime,P)}else P.set(0,0,0);X?c.V(P):b.dd.TransformNormalToRef(P,C,c)}startPositionFunction(C,c,d,X){const P=b.TmpVectors.dd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,d,P):P.set(0,0,0),X?c.V(P):b.dd.TransformCoordinatesToRef(P,C,c)}clone(){const C=new n;return g.d.DeepCopy(this,C),C}applyToShader(C){}buildUniformLayout(C){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.particlePositionGenerator=this.particlePositionGenerator,C.particleDestinationGenerator=this.particleDestinationGenerator,C}parse(C){C.particlePositionGenerator&&(this.particlePositionGenerator=C.particlePositionGenerator),C.particleDestinationGenerator&&(this.particleDestinationGenerator=C.particleDestinationGenerator)}}var W=d(12471);class E{get mesh(){return this._mesh}set mesh(C){this._mesh!==C&&(this._mesh=C,C?(this._indices=C.wc(),this._positions=C.getVerticesData(W.g.PositionKind),this._normals=C.getVerticesData(W.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=b.dd.Zero(),this._mesh=null,this.direction1=new b.dd(0,1,0),this.direction2=new b.dd(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=C}startDirectionFunction(C,c,d,X){if(this.useMeshNormalsForDirection&&this._normals)return void b.dd.TransformNormalToRef(this._storedNormal,C,c);const P=(0,j.RandomRange)(this.direction1.x,this.direction2.x),V=(0,j.RandomRange)(this.direction1.y,this.direction2.y),R=(0,j.RandomRange)(this.direction1.z,this.direction2.z);X?c.yc(P,V,R):b.dd.TransformNormalFromFloatsToRef(P,V,R,C,c)}startPositionFunction(C,c,d,X){if(!this._indices||!this._positions)return;const P=3*(Math.random()*(this._indices.length/3)|0),V=Math.random(),R=Math.random()*(1-V),p=1-V-R,j=this._indices[P],g=this._indices[P+1],k=this._indices[P+2],Z=b.TmpVectors.dd[0],U=b.TmpVectors.dd[1],A=b.TmpVectors.dd[2],u=b.TmpVectors.dd[3];b.dd.FromArrayToRef(this._positions,3*j,Z),b.dd.FromArrayToRef(this._positions,3*g,U),b.dd.FromArrayToRef(this._positions,3*k,A),u.x=V*Z.x+R*U.x+p*A.x,u.y=V*Z.y+R*U.y+p*A.y,u.z=V*Z.z+R*U.z+p*A.z,X?c.yc(u.x,u.y,u.z):b.dd.TransformCoordinatesFromFloatsToRef(u.x,u.y,u.z,C,c),this.useMeshNormalsForDirection&&this._normals&&(b.dd.FromArrayToRef(this._normals,3*j,Z),b.dd.FromArrayToRef(this._normals,3*g,U),b.dd.FromArrayToRef(this._normals,3*k,A),this._storedNormal.x=V*Z.x+R*U.x+p*A.x,this._storedNormal.y=V*Z.y+R*U.y+p*A.y,this._storedNormal.z=V*Z.z+R*U.z+p*A.z)}clone(){const C=new E(this.mesh);return g.d.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var C;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.rc(),c.direction2=this.direction2.rc(),c.meshId=null===(C=this.mesh)||void 0===C?void 0:C.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(C,c){b.dd.FromArrayToRef(C.direction1,0,this.direction1),b.dd.FromArrayToRef(C.direction2,0,this.direction2),C.meshId&&c&&(this.mesh=c.getLastMeshById(C.meshId)),this.useMeshNormalsForDirection=C.useMeshNormalsForDirection}}class N{_isUbo(C){return void 0!==C.addUniform}constructor(C){this._isUbo(C)?(this.setMatrix3x3=C.updateMatrix3x3.bind(C),this.setMatrix2x2=C.updateMatrix2x2.bind(C),this.setFloat=C.updateFloat.bind(C),this.setFloat2=C.updateFloat2.bind(C),this.setFloat3=C.updateFloat3.bind(C),this.setFloat4=C.updateFloat4.bind(C),this.setFloatArray=C.updateFloatArray.bind(C),this.setArray=C.updateArray.bind(C),this.setIntArray=C.updateIntArray.bind(C),this.setMatrix=C.fc.bind(C),this.setMatrices=C.updateMatrices.bind(C),this.setVector3=C.updateVector3.bind(C),this.setVector4=C.updateVector4.bind(C),this.setColor3=C.updateColor3.bind(C),this.setColor4=C.updateColor4.bind(C),this.setDirectColor4=C.updateDirectColor4.bind(C),this.setInt=C.updateInt.bind(C),this.setInt2=C.updateInt2.bind(C),this.setInt3=C.updateInt3.bind(C),this.setInt4=C.updateInt4.bind(C)):(this.setMatrix3x3=C.setMatrix3x3.bind(C),this.setMatrix2x2=C.setMatrix2x2.bind(C),this.setFloat=C.setFloat.bind(C),this.setFloat2=C.setFloat2.bind(C),this.setFloat3=C.setFloat3.bind(C),this.setFloat4=C.setFloat4.bind(C),this.setFloatArray=C.setFloatArray.bind(C),this.setArray=C.setArray.bind(C),this.setIntArray=C.setIntArray.bind(C),this.setMatrix=C.setMatrix.bind(C),this.setMatrices=C.setMatrices.bind(C),this.setVector3=C.setVector3.bind(C),this.setVector4=C.setVector4.bind(C),this.setColor3=C.setColor3.bind(C),this.setColor4=C.setColor4.bind(C),this.setDirectColor4=C.setDirectColor4.bind(C),this.setInt=C.setInt.bind(C),this.setInt2=C.setInt2.bind(C),this.setInt3=C.setInt3.bind(C),this.setInt4=C.setInt4.bind(C))}}var r=d(12292);const M="gpuUpdateParticlesPixelShader",K="#version 300 es\nvoid main() {discard;}\n";r.e.ShadersStore[M]||(r.e.ShadersStore[M]=K);const i="gpuUpdateParticlesVertexShader",h="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";r.e.ShadersStore[i]||(r.e.ShadersStore[i]=h);(0,R.e)("BABYLON.WebGL2ParticleSystem",class{constructor(C,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=C,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var C;return(null===(C=this._updateEffect)||void 0===C?void 0:C.isReady())??!1}createUpdateBuffer(C){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof n&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=C,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new N(this._updateEffect)}createVertexBuffers(C,c){this._updateVAO.push(this._createUpdateVAO(C)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(C){return C}bindDrawBuffers(C,c,d){d?this._engine.bindBuffers(this._renderVertexBuffers,d,c):this._engine.bindVertexArrayObject(this._renderVAO[C],null)}preUpdateParticleBuffer(){const C=this._engine;if(this._engine.enableEffect(this._updateEffect),!C.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(C,c,d){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[C],null);const b=this._engine;b.bindTransformFeedbackBuffer(c.getBuffer()),b.setRasterizerState(!1),b.beginTransformFeedback(!0),b.drawArraysType(3,0,d),b.endTransformFeedback(),b.setRasterizerState(!0),b.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let C=0;C<this._updateVAO.length;C++)this._engine.releaseVertexArrayObject(this._updateVAO[C]);this._updateVAO.length=0;for(let C=0;C<this._renderVAO.length;C++)this._engine.releaseVertexArrayObject(this._renderVAO[C]);this._renderVAO.length=0}_createUpdateVAO(C){const c={};c.position=C.createVertexBuffer("position",0,3);let d=3;c.age=C.createVertexBuffer("age",d,1),d+=1,c.size=C.createVertexBuffer("size",d,3),d+=3,c.life=C.createVertexBuffer("life",d,1),d+=1,c.seed=C.createVertexBuffer("seed",d,4),d+=4,c.direction=C.createVertexBuffer("direction",d,3),d+=3,this._parent.particleEmitterType instanceof n&&(c.initialPosition=C.createVertexBuffer("initialPosition",d,3),d+=3),this._parent._colorGradientsTexture||(c.color=C.createVertexBuffer("color",d,4),d+=4),this._parent._isBillboardBased||(c.initialDirection=C.createVertexBuffer("initialDirection",d,3),d+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=C.createVertexBuffer("noiseCoordinates1",d,3),d+=3,c.noiseCoordinates2=C.createVertexBuffer("noiseCoordinates2",d,3),d+=3),this._parent._angularSpeedGradientsTexture?(c.angle=C.createVertexBuffer("angle",d,1),d+=1):(c.angle=C.createVertexBuffer("angle",d,2),d+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=C.createVertexBuffer("cellIndex",d,1),d+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=C.createVertexBuffer("cellStartOffset",d,1),d+=1));const b=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),b}});class L{constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,b=arguments.length>3?arguments[3]:void 0;this._engine=C,this._label=b,this._engine._storageBuffers.push(this),this._create(c,d)}_create(C,c){this._bufferSize=C,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(C,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(C,c,d){this._buffer&&this._engine.updateStorageBuffer(this._buffer,C,c,d)}async read(C,c,d,b){return await this._engine.readFromStorageBuffer(this._buffer,C,c,d,b)}dispose(){const C=this._engine._storageBuffers,c=C.indexOf(this);-1!==c&&(C[c]=C[C.length-1],C.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var f=d(12384),T=d(12388),z=d(12431),w=d(12375),J=d(12695),y=d(12233),x=d(12320),H=d(12617);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new H.b}_addDuration(C,c){C<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==C?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=C):this.counter.addCount(c,!1))}}var D=d(12281);class s{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=C,this._engine=c,this.uniqueId=J.e.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?b.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=d,this._options={bindingsMapping:{},defines:[],...b}):y.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):y.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(C,c){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const b=this._bindings[C];this._bindings[C]={type:d?0:4,object:c,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!b||b.object!==c||b.type!==this._bindings[C].type)}setStorageTexture(C,c){const d=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==c),this._bindings[C]={type:1,object:c,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setExternalTexture(C,c){const d=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==c),this._bindings[C]={type:6,object:c,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setVideoTexture(C,c){return!!c.externalTexture&&(this.setExternalTexture(C,c.externalTexture),!0)}setUniformBuffer(C,c){const d=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==c),this._bindings[C]={type:s._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setStorageBuffer(C,c){const d=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==c),this._bindings[C]={type:s._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setTextureSampler(C,c){const d=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!d||!c.compareSampler(d.object)),this._bindings[C]={type:5,object:c,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}isReady(){let C=this._effect;for(const X in this._bindings){const C=this._bindings[X],c=C.type,d=C.object;switch(c){case 0:case 4:case 1:if(!d.isReady())return!1;break;case 6:if(!d.isReady())return!1;break}}const c=[],d=this._shaderPath;if(this._options.defines)for(let X=0;X<this._options.defines.length;X++)c.push(this._options.defines[X]);const b=c.join("\n");return this._cachedDefines!==b&&(this._cachedDefines=b,C=this._engine.createComputeEffect(d,{defines:b,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=C),!!C.isReady()}dispatch(C,c,d){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,C,c,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const d=s._BufferIsDataBuffer(C)?C:C.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,d,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const d=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(d.type){case 0:{const b=this._samplers[c],X=d.object;var C;if(!b||!X._texture||!b.compareSampler(X._texture))this._samplers[c]=(new x.e).setParameters(X.wrapU,X.wrapV,X.wrapR,X.anisotropicFilteringLevel,X._texture.samplingMode,null===(C=X._texture)||void 0===C?void 0:C._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const C=d.object;C.getBuffer()!==d.buffer&&(d.buffer=C.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((X=>{(0,D.f)((()=>this.dispatch(C,c,d)),X,void 0,b)}))}serialize(){const C=z.e.Serialize(this);C.options=this._options,C.shaderPath=this._shaderPath,C.xU={},C.textures={};for(const c in this._bindings){const d=this._bindings[c],b=d.object;switch(d.type){case 0:case 4:case 1:{const X=b.serialize();X&&(C.textures[c]=X,C.xU[c]={type:d.type});break}}}return C}static Parse(C,c,d){const b=z.e.Parse((()=>new s(C.name,c.getEngine(),C.shaderPath,C.options)),C,c,d);for(const X in C.textures){const P=C.xU[X],V=w.b.Parse(C.textures[X],c,d);0===P.type?b.setTexture(X,V):4===P.type?b.setTexture(X,V,!1):b.setStorageTexture(X,V)}return b}static _BufferIsDataBuffer(C){return void 0!==C.underlyingResource}}(0,f.e)([(0,T.P)()],s.prototype,"name",void 0),(0,f.e)([(0,T.P)()],s.prototype,"fastMode",void 0),(0,R.e)("BABYLON.ComputeShader",s);var mC=d(12660);const Q="gpuUpdateParticlesComputeShader",I="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";r.e.ShadersStoreWGSL[Q]||(r.e.ShadersStoreWGSL[Q]=I);(0,R.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(C,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=C,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var C;return(null===(C=this._updateComputeShader)||void 0===C?void 0:C.isReady())??!1}createUpdateBuffer(C){var c;const d={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(d.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(d.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(d.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(d.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(d.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(d.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(d.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new s("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:d,defines:C.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new mC.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new N(this._simParamsComputeShader)}createVertexBuffers(C,c){this._renderVertexBuffers.push(c)}createParticleBuffer(C){const c=new L(this._engine,4*C.length,11,"ComputeShaderParticleSystemBuffer");return c.update(C),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(C,c,d){this._engine.bindBuffers(this._renderVertexBuffers[C],d,c)}preUpdateParticleBuffer(){}updateParticleBuffer(C,c,d){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[C]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^C]),this._updateComputeShader.dispatch(Math.ceil(d/64))}releaseBuffers(){var C;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(C=this._simParamsComputeShader)||void 0===C||C.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class o{constructor(C,c,d){this.gradient=C,this.color1=c,this.color2=d}getColorToRef(C){this.color2?V.vc.LerpToRef(this.color1,this.color2,Math.random(),C):C.V(this.color1)}}class F{constructor(C,c){this.gradient=C,this.color=c}}class Y{constructor(C,c,d){this.gradient=C,this.factor1=c,this.factor2=d}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class l{static GetCurrentGradient(C,c,d){if(c[0].gradient>C)return void d(c[0],c[0],1);for(let X=0;X<c.length-1;X++){const b=c[X],P=c[X+1];if(C>=b.gradient&&C<=P.gradient){return void d(b,P,(C-b.gradient)/(P.gradient-b.gradient))}}const b=c.length-1;d(c[b],c[b],1)}}var S=d(12221),G=d(12883),a=d(12255);class O{constructor(C){this.particleSystem=C,this.position=b.dd.Zero(),this.direction=b.dd.Zero(),this.color=new V.vc(0,0,0,0),this.colorStep=new V.vc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new b.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new V.vc(0,0,0,0),this._currentColor2=new V.vc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=O._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let C=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,C=this._randomCellOffset):C+=this._randomCellOffset);const d=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let b;b=this._initialSpriteCellLoop?(0,j.Clamp)(C*c%this.lifeTime/this.lifeTime):(0,j.Clamp)(C*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+b*d|0}_inheritParticleInfoToSubEmitter(C){if(C.particleSystem.bc.position){const c=C.particleSystem.bc;if(c.position.V(this.position),C.inheritDirection){const C=b.TmpVectors.dd[0];this.direction.normalizeToRef(C),c.setDirection(C,0,Math.PI/2)}}else{C.particleSystem.bc.V(this.position)}this.direction.scaleToRef(C.inheritedVelocityAmount/2,b.TmpVectors.dd[0]),C.particleSystem._inheritedVelocityOffset.V(b.TmpVectors.dd[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const C of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(C)}_reset(){this.age=0,this.id=O._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(C){C.position.V(this.position),this._initialDirection?C._initialDirection?C._initialDirection.V(this._initialDirection):C._initialDirection=this._initialDirection.clone():C._initialDirection=null,C.direction.V(this.direction),this.pj&&(C.pj?C.pj.V(this.pj):C.pj=this.pj.clone()),C.color.V(this.color),C.colorStep.V(this.colorStep),C.lifeTime=this.lifeTime,C.age=this.age,C._randomCellOffset=this._randomCellOffset,C.size=this.size,C.scale.V(this.scale),C.angle=this.angle,C.angularSpeed=this.angularSpeed,C.particleSystem=this.particleSystem,C.cellIndex=this.cellIndex,C.id=this.id,C._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(C._currentColorGradient=this._currentColorGradient,C._currentColor1.V(this._currentColor1),C._currentColor2.V(this._currentColor2)),this._currentSizeGradient&&(C._currentSizeGradient=this._currentSizeGradient,C._currentSize1=this._currentSize1,C._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(C._currentAngularSpeedGradient=this._currentAngularSpeedGradient,C._currentAngularSpeed1=this._currentAngularSpeed1,C._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(C._currentVelocityGradient=this._currentVelocityGradient,C._currentVelocity1=this._currentVelocity1,C._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(C._currentLimitVelocityGradient=this._currentLimitVelocityGradient,C._currentLimitVelocity1=this._currentLimitVelocity1,C._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(C._currentDragGradient=this._currentDragGradient,C._currentDrag1=this._currentDrag1,C._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(C._initialStartSpriteCellId=this._initialStartSpriteCellId,C._initialEndSpriteCellId=this._initialEndSpriteCellId,C._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(C.remapData&&this.remapData?C.remapData.V(this.remapData):C.remapData=new b.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(C._randomNoiseCoordinates1?(C._randomNoiseCoordinates1.V(this._randomNoiseCoordinates1),C._randomNoiseCoordinates2.V(this._randomNoiseCoordinates2)):(C._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),C._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}O._Count=0;var CC=d(12514),cC=(d(12561),d(12756)),dC=d(12750),bC=d(12654);function XC(C,c){const d=(0,j.RandomRange)(0,1);V.vc.LerpToRef(c.color1,c.color2,d,C.color),c.colorDead.subtractToRef(C.color,c._colorDiff),c._colorDiff.scaleToRef(1/C.lifeTime,C.colorStep)}function PC(C,c){C._currentColorGradient=c._colorGradients[0],C._currentColorGradient.getColorToRef(C.color),C._currentColor1.V(C.color),c._colorGradients.length>1?c._colorGradients[1].getColorToRef(C._currentColor2):C._currentColor2.V(C.color)}function VC(C,c){const d=c._colorGradients;l.GetCurrentGradient(c._ratio,d,((c,d,b)=>{c!==C._currentColorGradient&&(C._currentColor1.V(C._currentColor2),d.getColorToRef(C._currentColor2),C._currentColorGradient=c),V.vc.LerpToRef(C._currentColor1,C._currentColor2,b,C.color)}))}function RC(C,c){C.colorStep.scaleToRef(c._scaledUpdateSpeed,c._scaledColorStep),C.color.addInPlace(c._scaledColorStep),C.color.a<0&&(C.color.a=0)}function pC(C,c){l.GetCurrentGradient(c._ratio,c._angularSpeedGradients,((c,d,b)=>{c!==C._currentAngularSpeedGradient&&(C._currentAngularSpeed1=C._currentAngularSpeed2,C._currentAngularSpeed2=d.getFactor(),C._currentAngularSpeedGradient=c),C.angularSpeed=(0,j.Lerp)(C._currentAngularSpeed1,C._currentAngularSpeed2,b)}))}function jC(C,c){C.angle+=C.angularSpeed*c._scaledUpdateSpeed}function gC(C,c){c.particleEmitterType.startDirectionFunction(c._emitterWorldMatrix,C.direction,C,c.isLocal,c._emitterInverseWorldMatrix)}function kC(C,c){c.startDirectionFunction(c._emitterWorldMatrix,C.direction,C,c.isLocal)}function ZC(C,c){C._currentVelocityGradient=c._velocityGradients[0],C._currentVelocity1=C._currentVelocityGradient.getFactor(),c._velocityGradients.length>1?C._currentVelocity2=c._velocityGradients[1].getFactor():C._currentVelocity2=C._currentVelocity1}function UC(C,c){C._currentLimitVelocityGradient=c._limitVelocityGradients[0],C._currentLimitVelocity1=C._currentLimitVelocityGradient.getFactor(),c._limitVelocityGradients.length>1?C._currentLimitVelocity2=c._limitVelocityGradients[1].getFactor():C._currentLimitVelocity2=C._currentLimitVelocity1}function AC(C,c){l.GetCurrentGradient(c._ratio,c._velocityGradients,((d,b,X)=>{d!==C._currentVelocityGradient&&(C._currentVelocity1=C._currentVelocity2,C._currentVelocity2=b.getFactor(),C._currentVelocityGradient=d),c._directionScale*=(0,j.Lerp)(C._currentVelocity1,C._currentVelocity2,X)}))}function uC(C,c){l.GetCurrentGradient(c._ratio,c._limitVelocityGradients,((d,b,X)=>{d!==C._currentLimitVelocityGradient&&(C._currentLimitVelocity1=C._currentLimitVelocity2,C._currentLimitVelocity2=b.getFactor(),C._currentLimitVelocityGradient=d);const P=(0,j.Lerp)(C._currentLimitVelocity1,C._currentLimitVelocity2,X);C.direction.length()>P&&C.direction.scaleInPlace(c.limitVelocityDamping)}))}function qC(C,c){C.direction.scaleToRef(c._directionScale,c._scaledDirection)}function BC(C,c){c.particleEmitterType.startPositionFunction(c._emitterWorldMatrix,C.position,C,c.isLocal)}function tC(C,c){c.startPositionFunction(c._emitterWorldMatrix,C.position,C,c.isLocal)}function eC(C,c){C.pj?C.pj.V(C.position):C.pj=C.position.clone(),b.dd.TransformCoordinatesToRef(C.pj,c._emitterWorldMatrix,C.position)}function nC(C,c){c.isLocal&&C.pj?(C.pj.addInPlace(c._scaledDirection),b.dd.TransformCoordinatesToRef(C.pj,c._emitterWorldMatrix,C.position)):C.position.addInPlace(c._scaledDirection)}function WC(C,c){C._currentDragGradient=c._dragGradients[0],C._currentDrag1=C._currentDragGradient.getFactor(),c._dragGradients.length>1?C._currentDrag2=c._dragGradients[1].getFactor():C._currentDrag2=C._currentDrag1}function EC(C,c){l.GetCurrentGradient(c._ratio,c._dragGradients,((d,b,X)=>{d!==C._currentDragGradient&&(C._currentDrag1=C._currentDrag2,C._currentDrag2=b.getFactor(),C._currentDragGradient=d);const P=(0,j.Lerp)(C._currentDrag1,C._currentDrag2,X);c._scaledDirection.scaleInPlace(1-P)}))}function NC(C,c){C._randomNoiseCoordinates1?(C._randomNoiseCoordinates1.yc(Math.random(),Math.random(),Math.random()),C._randomNoiseCoordinates2.yc(Math.random(),Math.random(),Math.random())):(C._randomNoiseCoordinates1=new b.dd(Math.random(),Math.random(),Math.random()),C._randomNoiseCoordinates2=new b.dd(Math.random(),Math.random(),Math.random()))}function rC(C,c){const d=c._noiseTextureData,X=c._noiseTextureSize;if(d&&X&&C._randomNoiseCoordinates1){const P=c._fetchR(C._randomNoiseCoordinates1.x,C._randomNoiseCoordinates1.y,X.width,X.height,d),V=c._fetchR(C._randomNoiseCoordinates1.z,C._randomNoiseCoordinates2.x,X.width,X.height,d),R=c._fetchR(C._randomNoiseCoordinates2.y,C._randomNoiseCoordinates2.z,X.width,X.height,d),p=b.TmpVectors.dd[0],j=b.TmpVectors.dd[1];p.yc((2*P-1)*c.noiseStrength.x,(2*V-1)*c.noiseStrength.y,(2*R-1)*c.noiseStrength.z),p.scaleToRef(c._tempScaledUpdateSpeed,j),C.direction.addInPlace(j)}}function MC(C,c){c.gravity.scaleToRef(c._tempScaledUpdateSpeed,c._scaledGravity),C.direction.addInPlace(c._scaledGravity)}function KC(C,c){C.size=(0,j.RandomRange)(c.minSize,c.maxSize),C.scale.yc((0,j.RandomRange)(c.minScaleX,c.maxScaleX),(0,j.RandomRange)(c.minScaleY,c.maxScaleY))}function iC(C,c){C._currentSizeGradient=c._sizeGradients[0],C._currentSize1=C._currentSizeGradient.getFactor(),C.size=C._currentSize1,c._sizeGradients.length>1?C._currentSize2=c._sizeGradients[1].getFactor():C._currentSize2=C._currentSize1,C.scale.yc((0,j.RandomRange)(c.minScaleX,c.maxScaleX),(0,j.RandomRange)(c.minScaleY,c.maxScaleY))}function hC(C,c){const d=c._actualFrame/c.targetStopDuration;l.GetCurrentGradient(d,c._startSizeGradients,((d,b,X)=>{d!==c._currentStartSizeGradient&&(c._currentStartSize1=c._currentStartSize2,c._currentStartSize2=b.getFactor(),c._currentStartSizeGradient=d);const P=(0,j.Lerp)(c._currentStartSize1,c._currentStartSize2,X);C.scale.scaleInPlace(P)}))}function LC(C,c){l.GetCurrentGradient(c._ratio,c._sizeGradients,((c,d,b)=>{c!==C._currentSizeGradient&&(C._currentSize1=C._currentSize2,C._currentSize2=d.getFactor(),C._currentSizeGradient=c),C.size=(0,j.Lerp)(C._currentSize1,C._currentSize2,b)}))}function fC(C,c){C.remapData=new b.Vector4(0,1,0,1)}function TC(C,c){c._colorRemapGradients&&c._colorRemapGradients.length>0&&l.GetCurrentGradient(c._ratio,c._colorRemapGradients,((c,d,b)=>{const X=(0,j.Lerp)(c.factor1,d.factor1,b),P=(0,j.Lerp)(c.factor2,d.factor2,b);C.remapData.x=X,C.remapData.y=P-X})),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&l.GetCurrentGradient(c._ratio,c._alphaRemapGradients,((c,d,b)=>{const X=(0,j.Lerp)(c.factor1,d.factor1,b),P=(0,j.Lerp)(c.factor2,d.factor2,b);C.remapData.z=X,C.remapData.w=P-X}))}function zC(C,c){const d=(0,j.Clamp)(c._actualFrame/c.targetStopDuration);l.GetCurrentGradient(d,c._lifeTimeGradients,((c,b)=>{const X=c,P=b,V=X.getFactor(),R=P.getFactor(),p=(d-X.gradient)/(P.gradient-X.gradient);C.lifeTime=(0,j.Lerp)(V,R,p)})),c._emitPower=(0,j.RandomRange)(c.minEmitPower,c.maxEmitPower)}function wC(C,c){C.lifeTime=(0,j.RandomRange)(c.minLifeTime,c.maxLifeTime),c._emitPower=(0,j.RandomRange)(c.minEmitPower,c.maxEmitPower)}function JC(C,c){0===c._emitPower?(C._initialDirection?C._initialDirection.V(C.direction):C._initialDirection=C.direction.clone(),C.direction.set(0,0,0)):(C._initialDirection=null,C.direction.scaleInPlace(c._emitPower)),C.direction.addInPlace(c._inheritedVelocityOffset)}function yC(C,c){C.angularSpeed=(0,j.RandomRange)(c.minAngularSpeed,c.maxAngularSpeed),C.angle=(0,j.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function xC(C,c){C._currentAngularSpeedGradient=c._angularSpeedGradients[0],C.angularSpeed=C._currentAngularSpeedGradient.getFactor(),C._currentAngularSpeed1=C.angularSpeed,c._angularSpeedGradients.length>1?C._currentAngularSpeed2=c._angularSpeedGradients[1].getFactor():C._currentAngularSpeed2=C._currentAngularSpeed1,C.angle=(0,j.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function HC(C,c){C._initialStartSpriteCellId=c.startSpriteCellID,C._initialEndSpriteCellId=c.endSpriteCellID,C._initialSpriteCellLoop=c.spriteCellLoop}function vC(C,c){C.previousItem=c.previousItem,C.nextItem=c,c.previousItem&&(c.previousItem.nextItem=C),c.previousItem=C}function DC(C,c){C.previousItem=c,C.nextItem=c.nextItem,c.nextItem&&(c.nextItem.previousItem=C),c.nextItem=C}function sC(C,c){let d=c;for(;d.nextItem;)d=d.nextItem;C.previousItem=d,C.nextItem=d.nextItem,d.nextItem=C}function mc(C){C.previousItem&&(C.previousItem.nextItem=C.nextItem),C.nextItem&&(C.nextItem.previousItem=C.previousItem)}class QC extends p{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(C){this._startDirectionFunction!==C&&(this._startDirectionFunction=C,this._directionProcessing.process=C?kC:gC)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(C){this._startPositionFunction!==C&&(this._startPositionFunction=C,this._positionCreation.process=C?tC:BC)}set onDispose(C){this._onDisposeObserver&&this.Uc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Uc.add(C)}get Z(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(C){this._useRampGradients!==C&&(this._useRampGradients=C,this._resetEffect(),C?(this._rampCreation={process:fC,previousItem:null,nextItem:null},DC(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:TC,previousItem:null,nextItem:null},DC(this._remapGradientProcessing,this._gravityProcessing)):(mc(this._rampCreation),mc(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(C){this._isLocal!==C&&(this._isLocal=C,C?(this._isLocalCreation={process:eC,previousItem:null,nextItem:null},DC(this._isLocalCreation,this._positionCreation)):mc(this._isLocalCreation))}get particles(){return this.TU}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(C){this._animationSheetEnabled!==C&&(this._animationSheetEnabled=C,C?(this._sheetCreation={process:HC,previousItem:null,nextItem:null},DC(this._sheetCreation,this._colorCreation)):mc(this._sheetCreation),this._reset())}getActiveCount(){return this.TU.length}getClassName(){return"oc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var C;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(C=this._customWrappers[c])||void 0===C?void 0:C.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[C]??this._customWrappers[0]}setCustomEffect(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new CC.b(this._engine),this._customWrappers[c].effect=C,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(C){if(this.noiseTexture!==C){if(this._noiseTexture=C,!C)return mc(this._noiseCreation),void mc(this._noiseProcessing);this._noiseCreation={process:NC,previousItem:null,nextItem:null},DC(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:rC,previousItem:null,nextItem:null},DC(this._noiseProcessing,this._positionProcessing)}}constructor(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(C),this._emitterInverseWorldMatrix=b.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new b.dd,this.Uc=new S.b,this.onStoppedObservable=new S.b,this.onStartedObservable=new S.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.TU=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new V.vc(0,0,0,0),this._colorDiff=new V.vc(0,0,0,0),this._scaledDirection=b.dd.Zero(),this._scaledGravity=b.dd.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=C=>{},this.recycleParticle=C=>{const c=this.TU.pop();c!==C&&c.copyTo(C),this._stockParticles.push(c)},this._createParticle=()=>{let C;return 0!==this._stockParticles.length?(C=this._stockParticles.pop(),C._reset()):C=new O(this),this._prepareParticle(C),C},this.paused=!1,this._shadersLoaded=!1,this._capacity=c,this._epsilon=R,d&&"Scene"!==d.getClassName()?(this._engine=d,this.defaultProjectionMatrix=b.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=d||a.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.LU.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:wC,previousItem:null,nextItem:null},this._positionCreation={process:BC,previousItem:null,nextItem:null},DC(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:gC,previousItem:null,nextItem:null},DC(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:JC,previousItem:null,nextItem:null},DC(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:KC,previousItem:null,nextItem:null},DC(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:yC,previousItem:null,nextItem:null},DC(this._angleCreation,this._sizeCreation),this._colorCreation={process:XC,previousItem:null,nextItem:null},DC(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,p||(this._colorProcessing={process:RC,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:jC,previousItem:null,nextItem:null},DC(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:qC,previousItem:null,nextItem:null},DC(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:nC,previousItem:null,nextItem:null},DC(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:MC,previousItem:null,nextItem:null},DC(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=P,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new CC.b(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new k,this.updateFunction=C=>{var c;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(c=this.noiseTexture.getContent())||void 0===c||c.then((C=>{this._noiseTextureData=C})));const d=C===this.TU;for(let b=0;b<C.length;b++){const c=C[b];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const X=c.age;if(c.age+=this._tempScaledUpdateSpeed,c.age>c.lifeTime){const C=c.age-X,d=c.lifeTime-X;this._tempScaledUpdateSpeed=d*this._tempScaledUpdateSpeed/C,c.age=c.lifeTime}this._ratio=c.age/c.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let P=this._updateQueueStart;for(;P;)P.process(c,this),P=P.nextItem;if(this._isAnimationSheetEnabled&&!p&&c.updateCellIndex(),c._inheritParticleInfoToSubEmitters(),c.age>=c.lifeTime){if(this._emitFromParticle(c),c._attachedSubEmitters){for(const C of c._attachedSubEmitters)C.particleSystem.disposeOnStop=!0,C.particleSystem.stop();c._attachedSubEmitters=null}this.recycleParticle(c),d&&b--}else;}}}serialize(C){throw new Error("Method not implemented.")}clone(C,c){throw new Error("Method not implemented.")}_addFactorGradient(C,c,d,b){const X=new Y(c,d,b);C.push(X),C.sort(((C,c)=>C.gradient<c.gradient?-1:C.gradient>c.gradient?1:0))}_removeFactorGradient(C,c){if(!C)return;let d=0;for(const b of C){if(b.gradient===c){C.splice(d,1);break}d++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=zC:this._lifeTimeCreation.process=wC}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:hC,previousItem:null,nextItem:null},DC(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(mc(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(C){this.targetStopDuration!==C&&(this._targetStopDuration=C,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(C,c,d){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,C,c,d),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(C){return this._removeFactorGradient(this._lifeTimeGradients,C),this._syncLifeTimeCreation(),this}addSizeGradient(C,c,d){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=iC,this._sizeGradientProcessing={process:LC,previousItem:null,nextItem:null},vC(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,C,c,d),this}removeSizeGradient(C){var c;return this._removeFactorGradient(this._sizeGradients,C),0===(null===(c=this._sizeGradients)||void 0===c?void 0:c.length)&&(mc(this._sizeGradientProcessing),this._sizeCreation.process=KC),this}addColorRemapGradient(C,c,d){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,C,c,d),this}removeColorRemapGradient(C){return this._removeFactorGradient(this._colorRemapGradients,C),this}addAlphaRemapGradient(C,c,d){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,C,c,d),this}removeAlphaRemapGradient(C){return this._removeFactorGradient(this._alphaRemapGradients,C),this}addAngularSpeedGradient(C,c,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=xC,this._angularSpeedGradientProcessing={process:pC,previousItem:null,nextItem:null},vC(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,C,c,d),this}removeAngularSpeedGradient(C){var c;return this._removeFactorGradient(this._angularSpeedGradients,C),0===(null===(c=this._angularSpeedGradients)||void 0===c?void 0:c.length)&&(this._angleCreation.process=yC,mc(this._angularSpeedGradientProcessing)),this}addVelocityGradient(C,c,d){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ZC,previousItem:null,nextItem:null},DC(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:AC,previousItem:null,nextItem:null},vC(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,C,c,d),this}removeVelocityGradient(C){var c;return this._removeFactorGradient(this._velocityGradients,C),0===(null===(c=this._velocityGradients)||void 0===c?void 0:c.length)&&(mc(this._velocityCreation),mc(this._velocityGradientProcessing)),this}addLimitVelocityGradient(C,c,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:UC,previousItem:null,nextItem:null},DC(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:uC,previousItem:null,nextItem:null},DC(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,C,c,d),this}removeLimitVelocityGradient(C){var c;return this._removeFactorGradient(this._limitVelocityGradients,C),0===(null===(c=this._limitVelocityGradients)||void 0===c?void 0:c.length)&&(mc(this._limitVelocityCreation),mc(this._limitVelocityGradientProcessing)),this}addDragGradient(C,c,d){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:WC,previousItem:null,nextItem:null},vC(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:EC,previousItem:null,nextItem:null},vC(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,C,c,d),this}removeDragGradient(C){var c;return this._removeFactorGradient(this._dragGradients,C),0===(null===(c=this._dragGradients)||void 0===c?void 0:c.length)&&(mc(this._dragCreation),mc(this._dragGradientProcessing)),this}addEmitRateGradient(C,c,d){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,C,c,d),this}removeEmitRateGradient(C){return this._removeFactorGradient(this._emitRateGradients,C),this}addStartSizeGradient(C,c,d){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,C,c,d),this._syncStartSizeCreation(),this}removeStartSizeGradient(C){return this._removeFactorGradient(this._startSizeGradients,C),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const C=new Uint8Array(4*this._rawTextureWidth),c=V.TmpColors.pd[0];for(let d=0;d<this._rawTextureWidth;d++){const b=d/this._rawTextureWidth;l.GetCurrentGradient(b,this._rampGradients,((b,X,P)=>{V.pd.LerpToRef(b.color,X.color,P,c),C[4*d]=255*c.r,C[4*d+1]=255*c.g,C[4*d+2]=255*c.b,C[4*d+3]=255}))}this._rampGradientsTexture=G.e.CreateRGBATexture(C,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((C,c)=>C.gradient<c.gradient?-1:C.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(C,c){this._rampGradients||(this._rampGradients=[]);const d=new F(C,c);return this._rampGradients.push(d),this._syncRampGradientTexture(),this}removeRampGradient(C){return this._removeGradientAndTexture(C,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(C,c,d){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=PC,this._colorProcessing.process=VC);const b=new o(C,c,d);return this._colorGradients.push(b),this._colorGradients.sort(((C,c)=>C.gradient<c.gradient?-1:C.gradient>c.gradient?1:0)),this}removeColorGradient(C){if(!this._colorGradients)return this;let c=0;for(const d of this._colorGradients){if(d.gradient===C){this._colorGradients.splice(c,1);break}c++}return 0===this._colorGradients.length&&(this._colorCreation.process=XC,this._colorProcessing.process=RC),this}resetDrawCache(){if(this._drawWrappers){for(const C of this._drawWrappers)if(C)for(const c of C)null===c||void 0===c||c.dispose();this._drawWrappers=[]}}_fetchR(C,c,d,b,X){return X[4*(((C=.5*Math.abs(C)+.5)*d%d|0)+((c=.5*Math.abs(c)+.5)*b%b|0)*d)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const C=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new W.d(C,this._vertexData,!0,c);let d=0;const b=this._vertexBuffer.createVertexBuffer(W.g.PositionKind,d,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[W.g.PositionKind]=b,d+=3;const X=this._vertexBuffer.createVertexBuffer(W.g.ColorKind,d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[W.g.ColorKind]=X,d+=4;const P=this._vertexBuffer.createVertexBuffer("angle",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=P,d+=1;const V=this._vertexBuffer.createVertexBuffer("size",d,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=V,d+=2,this._isAnimationSheetEnabled){const C=this._vertexBuffer.createVertexBuffer("cellIndex",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=C,d+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const C=this._vertexBuffer.createVertexBuffer("direction",d,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=C,d+=3}if(this._useRampGradients){const C=this._vertexBuffer.createVertexBuffer("remapData",d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=C,d+=4}let R;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new W.d(C,c,!1,2),R=this._spriteBuffer.createVertexBuffer("offset",0,2)}else R=this._vertexBuffer.createVertexBuffer("offset",d,2,this._vertexBufferSize,this._useInstancing),d+=2;this._vertexBuffers.offset=R,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const C=[],c=[];let d=0;for(let b=0;b<this._capacity;b++)C.push(d),C.push(d+1),C.push(d+2),C.push(d),C.push(d+2),C.push(d+3),c.push(d,d+1,d+1,d+2,d+2,d+3,d+3,d,d,d+3),d+=4;this._indexBuffer=this._engine.createIndexBuffer(C),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(C)setTimeout((()=>{this.start(0)}),C);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.bc)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.bc.Tc(!0);const C=this.noiseTexture;if(C&&C.onGeneratedObservable)C.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),C.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(C))}_postStop(C){}reset(){this._stockParticles.length=0,this.TU.length=0}_appendParticleVertex(C,c,d,X){let P=C*this._vertexBufferSize;if(this._vertexData[P++]=c.position.x+this.Yg.x,this._vertexData[P++]=c.position.y+this.Yg.y,this._vertexData[P++]=c.position.z+this.Yg.z,this._vertexData[P++]=c.color.r,this._vertexData[P++]=c.color.g,this._vertexData[P++]=c.color.b,this._vertexData[P++]=c.color.a,this._vertexData[P++]=c.angle,this._vertexData[P++]=c.scale.x*c.size,this._vertexData[P++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[P++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[P++]=c.direction.x,this._vertexData[P++]=c.direction.y,this._vertexData[P++]=c.direction.z);else if(c._initialDirection){let C=c._initialDirection;this.isLocal&&(b.dd.TransformNormalToRef(C,this._emitterWorldMatrix,b.TmpVectors.dd[0]),C=b.TmpVectors.dd[0]),0===C.x&&0===C.z&&(C.x=.001),this._vertexData[P++]=C.x,this._vertexData[P++]=C.y,this._vertexData[P++]=C.z}else{let C=c.direction;this.isLocal&&(b.dd.TransformNormalToRef(C,this._emitterWorldMatrix,b.TmpVectors.dd[0]),C=b.TmpVectors.dd[0]),0===C.x&&0===C.z&&(C.x=.001),this._vertexData[P++]=C.x,this._vertexData[P++]=C.y,this._vertexData[P++]=C.z}this._useRampGradients&&c.remapData&&(this._vertexData[P++]=c.remapData.x,this._vertexData[P++]=c.remapData.y,this._vertexData[P++]=c.remapData.z,this._vertexData[P++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),0===X?X=this._epsilon:1===X&&(X=1-this._epsilon)),this._vertexData[P++]=d,this._vertexData[P++]=X)}_prepareParticle(C){}_createNewOnes(C){let c;for(let d=0;d<C&&this.TU.length!==this._capacity;d++){c=this._createParticle(),this.TU.push(c);let C=this._createQueueStart;for(;C;)C.process(c,this),C=C.nextItem;c._inheritParticleInfoToSubEmitters()}}_update(C){if(this._alive=this.TU.length>0,this.bc.position){const C=this.bc;this._emitterWorldMatrix=C.getWorldMatrix()}else{const C=this.bc;this._emitterWorldMatrix=b.Matrix.Translation(C.x,C.y,C.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.TU),this._createNewOnes(C)}static _GetAttributeNamesOrOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=[W.g.PositionKind,W.g.ColorKind,"angle","offset","size"];return C&&b.push("cellIndex"),c||b.push("direction"),d&&b.push("remapData"),b}static _GetEffectCreationOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,cC.b)(b),C&&b.push("particlesInfos"),c&&b.push("logarithmicDepthConstant"),d&&(b.push("vFogInfos"),b.push("vFogColor")),b}fillDefines(C,c){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cC.j)(this,this._scene,C),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&C.push("#define FOG")),this._isAnimationSheetEnabled&&C.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&C.push("#define LOGARITHMICDEPTH"),c===p.BLENDMODE_MULTIPLY&&C.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&C.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(C.push("#define BILLBOARD"),this.billboardMode){case 2:C.push("#define BILLBOARDY");break;case 8:case 9:C.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&C.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:C.push("#define BILLBOARDMODE_ALL")}d&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),C.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(C,c,d){c.push(...QC._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),C.push(...QC._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),d.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,bC.d)(C,this._imageProcessingConfigurationDefines),(0,bC.b)(d,this._imageProcessingConfigurationDefines))}_getWrapper(C){const c=this._getCustomDrawWrapper(C);if(null!==c&&void 0!==c&&c.effect)return c;const d=[];this.fillDefines(d,C);const b=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let X=this._drawWrappers[b];X||(X=this._drawWrappers[b]=[]);let P=X[C];P||(P=new CC.b(this._engine),P.drawContext&&(P.drawContext.useInstancing=this._useInstancing),X[C]=P);const V=d.join("\n");if(P.defines!==V){const C=[],c=[],d=[];this.fillUniformsAttributesAndSamplerNames(c,C,d),P.setEffect(this._engine.createEffect("particles",C,c,d,V,void 0,void 0,void 0,void 0,this._shaderLanguage),V)}return P}animate(){var C;let c,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!d&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(d?this.preWarmStepOffset:(null===(C=this._scene)||void 0===C?void 0:C.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let C=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;l.GetCurrentGradient(c,this._emitRateGradients,((c,d,b)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=d.getFactor(),this._currentEmitRateGradient=c),C=(0,j.Lerp)(this._currentEmitRate1,this._currentEmitRate2,b)}))}c=C*this._scaledUpdateSpeed|0,this._newPartsExcess+=C*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!d){let C=0;for(let c=0;c<this.TU.length;c++){const d=this.TU[c];this._appendParticleVertices(C,d),C+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.TU.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(C,c){this._appendParticleVertex(C++,c,0,0),this._useInstancing||(this._appendParticleVertex(C++,c,1,0),this._appendParticleVertex(C++,c,1,1),this._appendParticleVertex(C++,c,0,1))}rebuild(){var C;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(C=this._spriteBuffer)||void 0===C||C._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!QC.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(d.bind(d,13900)),Promise.resolve().then(d.bind(d,13847))])):await Promise.all([Promise.resolve().then(d.bind(d,13841)),Promise.resolve().then(d.bind(d,13832))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.bc||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==p.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(p.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(p.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(C){const c=this._getWrapper(C),d=c.effect,X=this._engine;X.enableEffect(c);const P=this.defaultViewMatrix??this._scene.getViewMatrix();if(d.setTexture("diffuseSampler",this.particleTexture),d.setMatrix("view",P),d.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const C=this.particleTexture.getBaseSize();d.setFloat3("particlesInfos",this.spriteCellWidth/C.width,this.spriteCellHeight/C.height,this.spriteCellWidth/C.width)}if(d.setVector2("translationPivot",this.translationPivot),d.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const C=this._scene.activeCamera;d.setVector3("eyePosition",C.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),d.setTexture("rampSampler",this._rampGradientsTexture));const V=d.defines;var R,p,j,g,k,Z;(this._scene&&((0,cC.e)(d,this,this._scene),this.applyFog&&(0,dC.g)(this._scene,void 0,d)),V.indexOf("#define BILLBOARDMODE_ALL")>=0&&(P.invertToRef(b.TmpVectors.Matrix[0]),d.setMatrix("invView",b.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?X.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,d):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,d)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?X.bindBuffers(this._vertexBuffers,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBuffer:this._indexBuffer,d):X.bindBuffers(this._vertexBuffers,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:null,d);(this.useLogarithmicDepth&&this._scene&&(0,dC.o)(V,d,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(d),this._setEngineBasedOnBlendMode(C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(d),this._useInstancing)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?X.drawElementsType(6,0,10,this.TU.length):X.drawArraysType(7,0,4,this.TU.length):null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?X.drawElementsType(1,0,10*this.TU.length):X.drawElementsType(0,0,6*this.TU.length);return this.TU.length}render(){if(!this.isReady()||!this.TU.length)return 0;const C=this._engine;C.setState&&(C.setState(!1),this.forceDepthWrite&&C.setDepthWrite(!0));let c=0;return c=this.blendMode===p.BLENDMODE_MULTIPLYADD?this._render(p.BLENDMODE_MULTIPLY)+this._render(p.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),C&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),C&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,d),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const C=this._scene.LU.indexOf(this);C>-1&&this._scene.LU.splice(C,1),this._scene._activeParticleSystems.dispose()}this.Uc.notifyObservers(this),this.Uc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}QC.ForceGLSL=!1;var IC,oC=d(12243);!function(C){C[C.ATTACHED=0]="ATTACHED",C[C.END=1]="END"}(IC||(IC={}));class FC{constructor(C){if(this.particleSystem=C,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!C.bc||!C.bc.dispose){const c=(0,R.b)("BABYLON.AbstractMesh");C.bc=new c("SubemitterSystemEmitter",C.NC()),C._disposeEmitterOnDispose=!0}}clone(){let C=this.particleSystem.bc;if(C){if(C instanceof b.dd)C=C.clone();else if(-1!==C.getClassName().indexOf("Mesh")){C=new((0,R.b)("BABYLON.Mesh"))("",C.NC()),C.isVisible=!1}}else C=new b.dd;const c=new FC(this.particleSystem.clone(this.particleSystem.name,C));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(C),c}static _ParseParticleSystem(C,c,d){throw(0,oC.c)("ParseParticle")}static Parse(C,c,d){const b=C.particleSystem,X=new FC(FC._ParseParticleSystem(b,c,d,!0));return X.type=C.type,X.inheritDirection=C.inheritDirection,X.inheritedVelocityAmount=C.inheritedVelocityAmount,X.particleSystem._isSubEmitter=!0,X}dispose(){this.particleSystem.dispose()}}var YC=d(12283);function lC(C,c){const d=new B;return d.direction1=C,d.direction2=c,d}function SC(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function GC(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function aC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.dd(0,1,0),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0);return new e(C,c,d)}function OC(){return new A(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Cc(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.dd(0,1,0);return new u(C,c,d,X,P)}function cc(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Z(C,c)}function dc(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0);return new U(C,c,d,X)}const bc=b.dd.Zero(),Xc=b.dd.Zero(),Pc=b.dd.Zero();class Vc{constructor(){this.strength=0,this.position=b.dd.Zero()}_processParticle(C,c){this.position.subtractToRef(C.position,bc);const d=bc.lengthSquared()+1;bc.normalize().scaleToRef(this.strength/d,Xc),Xc.scaleToRef(c._tempScaledUpdateSpeed,Pc),C.direction.addInPlace(Pc)}serialize(){return{position:this.position.rc(),strength:this.strength}}}class Rc extends QC{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=C=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);for(const d of this._subEmitters[c])if(1===d.type){const c=d.clone();C._inheritParticleInfoToSubEmitter(c),c.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(c.particleSystem),c.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(C,c){const d=lC(C,c);return this.particleEmitterType=d,d}get flowMap(){return this._flowMap}set flowMap(C){this._flowMap!==C&&(this._flowMap=C,this._flowMapUpdate&&(mc(this._flowMapUpdate),this._flowMapUpdate=null),C&&(this._flowMapUpdate={process:C=>{var c;const d=null===(c=this.NC())||void 0===c?void 0:c.getTransformMatrix();this._flowMap._processParticle(C,this.flowMapStrength*this._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null},DC(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(C){this._attractors.push(C),1===this._attractors.length&&(this._attractorUpdate={process:C=>{for(const c of this._attractors)c._processParticle(C,this)},previousItem:null,nextItem:null},DC(this._attractorUpdate,this._directionProcessing))}removeAttractor(C){const c=this._attractors.indexOf(C);-1!==c&&this._attractors.splice(c,1),0===this._attractors.length&&mc(this._attractorUpdate)}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(C)}createHemisphericEmitter(){const C=SC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createSphereEmitter(){const C=GC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createDirectedSphereEmitter(){const C=aC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.dd(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0));return this.particleEmitterType=C,C}createCylinderEmitter(){const C=OC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=C,C}createDirectedCylinderEmitter(){const C=Cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.dd(0,1,0));return this.particleEmitterType=C,C}createConeEmitter(){const C=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=C,C}createDirectedConeEmitter(){const C=dc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0));return this.particleEmitterType=C,C}createBoxEmitter(C,c,d,b){const X=new k;return this.particleEmitterType=X,this.direction1=C,this.direction2=c,this.minEmitBox=d,this.maxEmitBox=b,X}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const C of this.subEmitters)C instanceof Rc?this._subEmitters.push([new FC(C)]):C instanceof FC?this._subEmitters.push([C]):C instanceof Array&&this._subEmitters.push(C)}_stopSubEmitters(){if(this.activeSubSystems){for(const C of this.activeSubSystems)C.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const C=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==C&&this._rootParticleSystem.activeSubSystems.splice(C,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(C){C&&this._stopSubEmitters()}_prepareParticle(C){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];C._attachedSubEmitters=[];for(const d of c)if(0===d.type){const c=d.clone();C._attachedSubEmitters.push(c),c.particleSystem.start()}}}_onDispose(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),C&&this.particles)for(const d of this.particles)if(d._attachedSubEmitters)for(let C=d._attachedSubEmitters.length-1;C>=0;C-=1)d._attachedSubEmitters[C].dispose();if(c&&this.activeSubSystems)for(let d=this.activeSubSystems.length-1;d>=0;d-=1)this.activeSubSystems[d].dispose();if(this._subEmitters&&this._subEmitters.length){for(let C=0;C<this._subEmitters.length;C++)for(const c of this._subEmitters[C])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.bc&&this.bc.dispose&&this.bc.dispose(!0)}static _Parse(C,c,d,X){let P;P=d instanceof YC.c?null:d;const p=(0,R.b)("BABYLON.Texture");if(p&&P&&(C.texture?c.particleTexture=p.Parse(C.texture,P,X):C.textureName&&(c.particleTexture=new p(X+C.textureName,P,!1,void 0===C.invertY||C.invertY),c.particleTexture.name=C.textureName)),C.emitterId||0===C.emitterId||void 0!==C.bc?C.emitterId&&P?c.bc=P.getLastMeshById(C.emitterId):c.bc=b.dd.jd(C.bc):c.bc=b.dd.Zero(),c.isLocal=!!C.isLocal,void 0!==C.renderingGroupId&&(c.renderingGroupId=C.renderingGroupId),void 0!==C.isBillboardBased&&(c.isBillboardBased=C.isBillboardBased),void 0!==C.billboardMode&&(c.billboardMode=C.billboardMode),void 0!==C.useLogarithmicDepth&&(c.useLogarithmicDepth=C.useLogarithmicDepth),C.animations){for(let d=0;d<C.animations.length;d++){const b=C.animations[d],X=(0,R.b)("BABYLON.Animation");X&&c.animations.push(X.Parse(b))}c.beginAnimationOnStart=C.beginAnimationOnStart,c.beginAnimationFrom=C.beginAnimationFrom,c.beginAnimationTo=C.beginAnimationTo,c.beginAnimationLoop=C.beginAnimationLoop}if(C.autoAnimate&&P&&P.beginAnimation(c,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),c.startDelay=0|C.startDelay,c.minAngularSpeed=C.minAngularSpeed,c.maxAngularSpeed=C.maxAngularSpeed,c.minSize=C.minSize,c.maxSize=C.maxSize,C.minScaleX&&(c.minScaleX=C.minScaleX,c.maxScaleX=C.maxScaleX,c.minScaleY=C.minScaleY,c.maxScaleY=C.maxScaleY),void 0!==C.preWarmCycles&&(c.preWarmCycles=C.preWarmCycles,c.preWarmStepOffset=C.preWarmStepOffset),void 0!==C.minInitialRotation&&(c.minInitialRotation=C.minInitialRotation,c.maxInitialRotation=C.maxInitialRotation),c.minLifeTime=C.minLifeTime,c.maxLifeTime=C.maxLifeTime,c.minEmitPower=C.minEmitPower,c.maxEmitPower=C.maxEmitPower,c.emitRate=C.emitRate,c.gravity=b.dd.jd(C.gravity),C.noiseStrength&&(c.noiseStrength=b.dd.jd(C.noiseStrength)),c.color1=V.vc.jd(C.color1),c.color2=V.vc.jd(C.color2),c.colorDead=V.vc.jd(C.colorDead),c.updateSpeed=C.updateSpeed,c.targetStopDuration=C.targetStopDuration,c.blendMode=C.blendMode,C.colorGradients)for(const b of C.colorGradients)c.addColorGradient(b.gradient,V.vc.jd(b.color1),b.color2?V.vc.jd(b.color2):void 0);if(C.rampGradients){for(const d of C.rampGradients)c.addRampGradient(d.gradient,V.pd.jd(d.color));c.useRampGradients=C.useRampGradients}if(C.colorRemapGradients)for(const b of C.colorRemapGradients)c.addColorRemapGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.alphaRemapGradients)for(const b of C.alphaRemapGradients)c.addAlphaRemapGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.sizeGradients)for(const b of C.sizeGradients)c.addSizeGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.angularSpeedGradients)for(const b of C.angularSpeedGradients)c.addAngularSpeedGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.velocityGradients)for(const b of C.velocityGradients)c.addVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.dragGradients)for(const b of C.dragGradients)c.addDragGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.emitRateGradients)for(const b of C.emitRateGradients)c.addEmitRateGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.startSizeGradients)for(const b of C.startSizeGradients)c.addStartSizeGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.lifeTimeGradients)for(const b of C.lifeTimeGradients)c.addLifeTimeGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(C.limitVelocityGradients){for(const d of C.limitVelocityGradients)c.addLimitVelocityGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);c.limitVelocityDamping=C.limitVelocityDamping}if(C.noiseTexture&&P){const d=(0,R.b)("BABYLON.ProceduralTexture");c.noiseTexture=d.Parse(C.noiseTexture,P,X)}let j;if(C.particleEmitterType){switch(C.particleEmitterType.type){case"SphereParticleEmitter":j=new t;break;case"SphereDirectedParticleEmitter":j=new e;break;case"ConeEmitter":case"ConeParticleEmitter":j=new Z;break;case"ConeDirectedParticleEmitter":j=new U;break;case"CylinderParticleEmitter":j=new A;break;case"CylinderDirectedParticleEmitter":j=new u;break;case"HemisphericParticleEmitter":j=new q;break;case"PointParticleEmitter":j=new B;break;case"MeshParticleEmitter":j=new E;break;case"CustomParticleEmitter":j=new n;break;default:j=new k}j.parse(C.particleEmitterType,P)}else j=new k,j.parse(C,P);c.particleEmitterType=j,c.startSpriteCellID=C.startSpriteCellID,c.endSpriteCellID=C.endSpriteCellID,c.spriteCellLoop=C.spriteCellLoop??!0,c.spriteCellWidth=C.spriteCellWidth,c.spriteCellHeight=C.spriteCellHeight,c.spriteCellChangeSpeed=C.spriteCellChangeSpeed,c.spriteRandomStartCell=C.spriteRandomStartCell,c.disposeOnStop=C.disposeOnStop??!1,c.manualEmitCount=C.manualEmitCount??-1}static Parse(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4?arguments[4]:void 0;const R=C.name;let p,j,g=null,k=null;if(c instanceof YC.c?p=c:(j=c,p=j.getEngine()),C.customShader&&p.createEffectForParticles){k=C.customShader;const c=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";g=p.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,c)}const Z=new Rc(R,P||C.wX,c,g,C.isAnimationSheetEnabled);if(Z.customShader=k,Z._rootUrl=d,C.id&&(Z.id=C.id),C.subEmitters){Z.subEmitters=[];for(const b of C.subEmitters){const C=[];for(const X of b)C.push(FC.Parse(X,c,d));Z.subEmitters.push(C)}}if(C.attractors)for(const V of C.attractors){const C=new Vc;C.position=b.dd.jd(V.position),C.strength=V.strength,Z.addAttractor(C)}return Rc._Parse(C,Z,c,d),C.textureMask&&(Z.textureMask=V.vc.jd(C.textureMask)),C.Yg&&(Z.Yg=b.dd.jd(C.Yg)),C.preventAutoStart&&(Z.preventAutoStart=C.preventAutoStart),X||Z.preventAutoStart||Z.start(),Z}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(Rc._Serialize(c,this,C),c.textureMask=this.textureMask.rc(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.Yg=this.Yg.rc(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const d of this._subEmitters){const b=[];for(const c of d)b.push(c.serialize(C));c.subEmitters.push(b)}}if(this._attractors&&this._attractors.length){c.attractors=[];for(const C of this._attractors)c.attractors.push(C.serialize())}return c}static _Serialize(C,c,d){if(C.name=c.name,C.id=c.id,C.wX=c.getCapacity(),C.disposeOnStop=c.disposeOnStop,C.manualEmitCount=c.manualEmitCount,c.bc.position){const d=c.bc;C.emitterId=d.id}else{const d=c.bc;C.bc=d.rc()}c.particleEmitterType&&(C.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(d?C.texture=c.particleTexture.serialize():(C.textureName=c.particleTexture.name,C.invertY=!!c.particleTexture._invertY)),C.isLocal=c.isLocal,z.e.AppendSerializedAnimations(c,C),C.beginAnimationOnStart=c.beginAnimationOnStart,C.beginAnimationFrom=c.beginAnimationFrom,C.beginAnimationTo=c.beginAnimationTo,C.beginAnimationLoop=c.beginAnimationLoop,C.startDelay=c.startDelay,C.renderingGroupId=c.renderingGroupId,C.isBillboardBased=c.isBillboardBased,C.billboardMode=c.billboardMode,C.minAngularSpeed=c.minAngularSpeed,C.maxAngularSpeed=c.maxAngularSpeed,C.minSize=c.minSize,C.maxSize=c.maxSize,C.minScaleX=c.minScaleX,C.maxScaleX=c.maxScaleX,C.minScaleY=c.minScaleY,C.maxScaleY=c.maxScaleY,C.minEmitPower=c.minEmitPower,C.maxEmitPower=c.maxEmitPower,C.minLifeTime=c.minLifeTime,C.maxLifeTime=c.maxLifeTime,C.emitRate=c.emitRate,C.gravity=c.gravity.rc(),C.noiseStrength=c.noiseStrength.rc(),C.color1=c.color1.rc(),C.color2=c.color2.rc(),C.colorDead=c.colorDead.rc(),C.updateSpeed=c.updateSpeed,C.targetStopDuration=c.targetStopDuration,C.blendMode=c.blendMode,C.preWarmCycles=c.preWarmCycles,C.preWarmStepOffset=c.preWarmStepOffset,C.minInitialRotation=c.minInitialRotation,C.maxInitialRotation=c.maxInitialRotation,C.startSpriteCellID=c.startSpriteCellID,C.spriteCellLoop=c.spriteCellLoop,C.endSpriteCellID=c.endSpriteCellID,C.spriteCellChangeSpeed=c.spriteCellChangeSpeed,C.spriteCellWidth=c.spriteCellWidth,C.spriteCellHeight=c.spriteCellHeight,C.spriteRandomStartCell=c.spriteRandomStartCell,C.isAnimationSheetEnabled=c.isAnimationSheetEnabled,C.useLogarithmicDepth=c.useLogarithmicDepth;const b=c.getColorGradients();if(b){C.colorGradients=[];for(const c of b){const d={gradient:c.gradient,color1:c.color1.rc()};c.color2?d.color2=c.color2.rc():d.color2=c.color1.rc(),C.colorGradients.push(d)}}const X=c.getRampGradients();if(X){C.rampGradients=[];for(const c of X){const d={gradient:c.gradient,color:c.color.rc()};C.rampGradients.push(d)}C.useRampGradients=c.useRampGradients}const P=c.getColorRemapGradients();if(P){C.colorRemapGradients=[];for(const c of P){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.colorRemapGradients.push(d)}}const V=c.getAlphaRemapGradients();if(V){C.alphaRemapGradients=[];for(const c of V){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.alphaRemapGradients.push(d)}}const R=c.getSizeGradients();if(R){C.sizeGradients=[];for(const c of R){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.sizeGradients.push(d)}}const p=c.getAngularSpeedGradients();if(p){C.angularSpeedGradients=[];for(const c of p){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.angularSpeedGradients.push(d)}}const j=c.getVelocityGradients();if(j){C.velocityGradients=[];for(const c of j){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.velocityGradients.push(d)}}const g=c.getDragGradients();if(g){C.dragGradients=[];for(const c of g){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.dragGradients.push(d)}}const k=c.getEmitRateGradients();if(k){C.emitRateGradients=[];for(const c of k){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.emitRateGradients.push(d)}}const Z=c.getStartSizeGradients();if(Z){C.startSizeGradients=[];for(const c of Z){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.startSizeGradients.push(d)}}const U=c.getLifeTimeGradients();if(U){C.lifeTimeGradients=[];for(const c of U){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.lifeTimeGradients.push(d)}}const A=c.getLimitVelocityGradients();if(A){C.limitVelocityGradients=[];for(const c of A){const d={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?d.factor2=c.factor2:d.factor2=c.factor1,C.limitVelocityGradients.push(d)}C.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(C.noiseTexture=c.noiseTexture.serialize())}clone(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b={...this._customWrappers};let X=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){X=this.customShader;const C=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",c=P.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,C);b[0]?b[0].effect=c:this.setCustomEffect(c,0)}const V=this.serialize(d),R=Rc.Parse(V,this._scene||this._engine,this._rootUrl);return R.name=C,R.customShader=X,R._customWrappers=b,void 0===c&&(c=this.bc),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.bc=c,this.preventAutoStart||R.start(),R}}Rc.BILLBOARDMODE_Y=2,Rc.BILLBOARDMODE_ALL=7,Rc.BILLBOARDMODE_STRETCHED=8,Rc.BILLBOARDMODE_STRETCHED_LOCAL=9,FC._ParseParticleSystem=Rc.Parse;var pc=d(12644),jc=d(12637),gc=d(12529);gc.b.prototype.createTransformFeedback=function(){const C=this._gl.createTransformFeedback();if(!C)throw new Error("Unable to create Transform Feedback");return C},gc.b.prototype.deleteTransformFeedback=function(C){this._gl.deleteTransformFeedback(C)},gc.b.prototype.bindTransformFeedback=function(C){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,C)},gc.b.prototype.beginTransformFeedback=function(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(C?this._gl.POINTS:this._gl.TRIANGLES)},gc.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},gc.b.prototype.setTranformFeedbackVaryings=function(C,c){this._gl.transformFeedbackVaryings(C,c,this._gl.INTERLEAVED_ATTRIBS)},gc.b.prototype.bindTransformFeedbackBuffer=function(C){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,C?C.underlyingResource:null)},gc.b.prototype.readTransformFeedbackBuffer=function(C){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,C)};const kc="clipPlaneFragmentDeclaration2",Zc="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";r.e.IncludesShadersStore[kc]||(r.e.IncludesShadersStore[kc]=Zc);d(13727),d(13731),d(13735),d(13742),d(13748),d(13754),d(13762),d(13765);const Uc="gpuRenderParticlesPixelShader",Ac="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";r.e.ShadersStore[Uc]||(r.e.ShadersStore[Uc]=Ac);const uc="clipPlaneVertexDeclaration2",qc="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";r.e.IncludesShadersStore[uc]||(r.e.IncludesShadersStore[uc]=qc);d(13770),d(13778),d(13786),d(13789);const Bc="gpuRenderParticlesVertexShader",tc="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";r.e.ShadersStore[Bc]||(r.e.ShadersStore[Bc]=tc);class ec extends p{static get IsSupported(){if(!a.c.LastCreatedEngine)return!1;const C=a.c.LastCreatedEngine.getCaps();return C.supportTransformFeedbacks||C.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(C){this._maxActiveParticleCount=Math.min(C,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(C){this.maxActiveParticleCount=C}createPointEmitter(C,c){const d=lC(C,c);return this.particleEmitterType=d,d}createHemisphericEmitter(){const C=SC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createSphereEmitter(){const C=GC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createDirectedSphereEmitter(){const C=aC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.dd(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0));return this.particleEmitterType=C,C}createCylinderEmitter(){const C=OC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=C,C}createDirectedCylinderEmitter(){const C=Cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.dd(0,1,0));return this.particleEmitterType=C,C}createConeEmitter(){const C=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=C,C}createDirectedConeEmitter(){const C=dc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.dd(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.dd(0,1,0));return this.particleEmitterType=C,C}createBoxEmitter(C,c,d,b){const X=new k;return this.particleEmitterType=X,this.direction1=C,this.direction2=c,this.minEmitBox=d,this.maxEmitBox=b,X}get flowMap(){return this._flowMap}set flowMap(C){this._flowMap!==C&&(this._flowMap=C)}isReady(){if(!this.bc||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Rc.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Rc.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Rc.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";C?setTimeout((()=>{this.start(0)}),C):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var C;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(C=this._customWrappers[c])||void 0===C?void 0:C.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[C]??this._customWrappers[0]}setCustomEffect(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new CC.b(this._engine),this._customWrappers[c].effect=C}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(C,c,d){return super._removeGradientAndTexture(C,c,d),this._releaseBuffers(),this}addColorGradient(C,c){this._colorGradients||(this._colorGradients=[]);const d=new o(C,c);return this._colorGradients.push(d),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(C&&this._colorGradients.sort(((C,c)=>C.gradient<c.gradient?-1:C.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(C){return this._removeGradientAndTexture(C,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var C;null===(C=this._drawWrappers[c].drawContext)||void 0===C||C.reset()}}_addFactorGradient(C,c,d){const b=new Y(c,d);C.push(b),this._releaseBuffers()}addSizeGradient(C,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,C,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(C){return this._removeGradientAndTexture(C,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(C,c){if(!C)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&C.sort(((C,c)=>C.gradient<c.gradient?-1:C.gradient>c.gradient?1:0));const d=this;d[c]&&(d[c].dispose(),d[c]=null)}addAngularSpeedGradient(C,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,C,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(C){return this._removeGradientAndTexture(C,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(C,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,C,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(C){return this._removeGradientAndTexture(C,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(C,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,C,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(C){return this._removeGradientAndTexture(C,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(C,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,C,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(C){return this._removeGradientAndTexture(C,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(C){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(C),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Uc=new S.b,this.onStoppedObservable=new S.b,this.onStartedObservable=new S.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,d&&"Scene"!==d.getClassName()?(this._engine=d,this.defaultProjectionMatrix=b.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=d||a.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.LU.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,R.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,R.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new CC.b(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers={0:new CC.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const V={wX:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},p=c;isFinite(p)&&(V.wX=p),this._capacity=V.wX,this._maxActiveParticleCount=V.wX,this._currentActiveCount=0,this._isAnimationSheetEnabled=P,this.particleEmitterType=new k;const j=Math.min(this._engine.getCaps().maxTextureSize,V.randomTextureSize);let g=[];for(let b=0;b<j;++b)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture=new G.e(new Float32Array(g),j,1,5,d,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,g=[];for(let b=0;b<j;++b)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture2=new G.e(new Float32Array(g),j,1,5,d,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=j}_reset(){this._releaseBuffers()}_createVertexBuffers(C,c,d){const b={};b.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let X=3;b.age=c.createVertexBuffer("age",X,1,this._attributesStrideSize,!0),X+=1,b.size=c.createVertexBuffer("size",X,3,this._attributesStrideSize,!0),X+=3,b.life=c.createVertexBuffer("life",X,1,this._attributesStrideSize,!0),X+=1,X+=4,this.billboardMode===Rc.BILLBOARDMODE_STRETCHED&&(b.direction=c.createVertexBuffer("direction",X,3,this._attributesStrideSize,!0)),X+=3,this._platform.alignDataInBuffer&&(X+=1),this.particleEmitterType instanceof n&&(X+=3,this._platform.alignDataInBuffer&&(X+=1)),this._colorGradientsTexture||(b.color=c.createVertexBuffer("color",X,4,this._attributesStrideSize,!0),X+=4),this._isBillboardBased||(b.initialDirection=c.createVertexBuffer("initialDirection",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),this.noiseTexture&&(b.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1),b.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),b.angle=c.createVertexBuffer("angle",X,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?X++:X+=2,this._isAnimationSheetEnabled&&(b.cellIndex=c.createVertexBuffer("cellIndex",X,1,this._attributesStrideSize,!0),X+=1,this.spriteRandomStartCell&&(b.cellStartOffset=c.createVertexBuffer("cellStartOffset",X,1,this._attributesStrideSize,!0),X+=1)),b.offset=d.createVertexBuffer("offset",0,2),b.uv=d.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(b),this._platform.createVertexBuffers(C,b),this.resetDrawCache()}_initialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!C)return;const c=this._engine,d=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof n&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const X=this.particleEmitterType instanceof n,P=b.TmpVectors.dd[0];let V=0;for(let b=0;b<this._capacity;b++)if(d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),X?(this.particleEmitterType.particleDestinationGenerator(b,null,P),d.push(P.x),d.push(P.y),d.push(P.z)):(d.push(0),d.push(0),d.push(0)),this._platform.alignDataInBuffer&&d.push(0),V+=16,X&&(this.particleEmitterType.particlePositionGenerator(b,null,P),d.push(P.x),d.push(P.y),d.push(P.z),this._platform.alignDataInBuffer&&d.push(0),V+=4),this._colorGradientsTexture||(d.push(0),d.push(0),d.push(0),d.push(0),V+=4),this.isBillboardBased||(d.push(0),d.push(0),d.push(0),this._platform.alignDataInBuffer&&d.push(0),V+=4),this.noiseTexture&&(d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),this._platform.alignDataInBuffer&&d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),this._platform.alignDataInBuffer&&d.push(0),V+=8),d.push(0),V+=1,this._angularSpeedGradientsTexture||(d.push(0),V+=1),this._isAnimationSheetEnabled&&(d.push(0),V+=1,this.spriteRandomStartCell&&(d.push(0),V+=1)),this._platform.alignDataInBuffer){let C=3-(V+3&3);for(V+=C;C-- >0;)d.push(0)}const R=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),p=this._platform.createParticleBuffer(d),j=this._platform.createParticleBuffer(d);this._buffer0=new W.d(c,p,!1,this._attributesStrideSize),this._buffer1=new W.d(c,j,!1,this._attributesStrideSize),this._spriteBuffer=new W.d(c,R,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let C=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(C+="\n#define BILLBOARD"),this._colorGradientsTexture&&(C+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(C+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(C+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(C+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(C+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(C+="\n#define DRAGGRADIENTS"),this._flowMap&&(C+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(C+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(C+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(C+="\n#define NOISE"),this.isLocal&&(C+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===C||(this._cachedUpdateDefines=C,this._updateBuffer=this._platform.createUpdateBuffer(C)),this._platform.isUpdateBufferReady()}_getWrapper(C){const c=this._getCustomDrawWrapper(C);if(null!==c&&void 0!==c&&c.effect)return c;const d=[];this.fillDefines(d,C);let b=this._drawWrappers[C];b||(b=new CC.b(this._engine),b.drawContext&&(b.drawContext.useInstancing=!0),this._drawWrappers[C]=b);const X=d.join("\n");if(b.defines!==X){const C=[],c=[],d=[];this.fillUniformsAttributesAndSamplerNames(c,C,d),b.setEffect(this._engine.createEffect("gpuRenderParticles",C,c,d,X),X)}return b}static _GetAttributeNamesOrOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const X=[W.g.PositionKind,"age","life","size","angle"];return C||X.push(W.g.ColorKind),c&&X.push("cellIndex"),d||X.push("initialDirection"),b&&X.push("direction"),X.push("offset",W.g.UVKind),X}static _GetEffectCreationOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=["emitterWM","Yg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,cC.b)(b),C&&b.push("sheetInfos"),c&&b.push("logarithmicDepthConstant"),d&&(b.push("vFogInfos"),b.push("vFogColor")),b}fillDefines(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cC.j)(this,this._scene,C),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==jc.e.FOGMODE_NONE&&C.push("#define FOG")),c===Rc.BLENDMODE_MULTIPLY&&C.push("#define BLENDMULTIPLYMODE"),this.isLocal&&C.push("#define LOCAL"),this.useLogarithmicDepth&&C.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(C.push("#define BILLBOARD"),this.billboardMode){case Rc.BILLBOARDMODE_Y:C.push("#define BILLBOARDY");break;case Rc.BILLBOARDMODE_STRETCHED:C.push("#define BILLBOARDSTRETCHED");break;case Rc.BILLBOARDMODE_ALL:C.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&C.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&C.push("#define ANIMATESHEET"),d&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),C.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(C,c,d){c.push(...ec._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Rc.BILLBOARDMODE_STRETCHED)),C.push(...ec._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),d.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(pc.e.PrepareUniforms(C,this._imageProcessingConfigurationDefines),pc.e.PrepareSamplers(d,this._imageProcessingConfigurationDefines))}animate(){var C;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(C=this._scene)||void 0===C?void 0:C.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(C,c){const d=this[c];if(!C||!C.length||d)return;const b=new Float32Array(this._rawTextureWidth);for(let X=0;X<this._rawTextureWidth;X++){const c=X/this._rawTextureWidth;l.GetCurrentGradient(c,C,((C,c,d)=>{b[X]=(0,j.Lerp)(C.factor1,c.factor1,d)}))}this[c]=G.e.CreateRTexture(b,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const C=new Uint8Array(4*this._rawTextureWidth),c=V.TmpColors.vc[0];for(let d=0;d<this._rawTextureWidth;d++){const b=d/this._rawTextureWidth;l.GetCurrentGradient(b,this._colorGradients,((b,X,P)=>{V.vc.LerpToRef(b.color1,X.color1,P,c),C[4*d]=255*c.r,C[4*d+1]=255*c.g,C[4*d+2]=255*c.b,C[4*d+3]=255*c.a}))}this._colorGradientsTexture=G.e.CreateRGBATexture(C,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(C,c){var d,X,P,V;const R=this._getWrapper(C),p=R.effect;this._engine.enableEffect(R);const j=(null===(d=this._scene)||void 0===d?void 0:d.getViewMatrix())||b.Matrix.IdentityReadOnly;if(p.setMatrix("view",j),p.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),p.setTexture("diffuseSampler",this.particleTexture),p.setVector2("translationPivot",this.translationPivot),p.setVector3("Yg",this.Yg),this.isLocal&&p.setMatrix("emitterWM",c),this._colorGradientsTexture?p.setTexture("colorGradientSampler",this._colorGradientsTexture):p.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const C=this.particleTexture.getBaseSize();p.setFloat3("sheetInfos",this.spriteCellWidth/C.width,this.spriteCellHeight/C.height,C.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const C=this._scene.activeCamera;p.setVector3("eyePosition",C.globalPosition)}const g=p.defines;if(this._scene&&((0,cC.e)(p,this,this._scene),this.applyFog&&(0,dC.g)(this._scene,void 0,p)),g.indexOf("#define BILLBOARDMODE_ALL")>=0){const C=j.clone();C.invert(),p.setMatrix("invView",C)}return this.useLogarithmicDepth&&this._scene&&(0,dC.o)(g,p,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),this._setEngineBasedOnBlendMode(C),this._platform.bindDrawBuffers(this._targetIndex,p,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(V=this._scene)&&void 0!==V&&V.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(C){if(!this.bc||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!C)if(this.bc.position){C=this.bc.getWorldMatrix()}else{const c=this.bc;C=b.TmpVectors.Matrix[0],b.Matrix.TranslationToRef(c.x,c.y,c.z,C)}const c=this._engine,d=c.getDepthWrite();if(c.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const C=this.NC();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",C.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",C),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const X=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=X,c.setDepthWrite(d)}render(){let C,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let C=0;C<this.preWarmCycles;C++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const C=0|this._accumulatedCount;this._accumulatedCount-=C,this._currentActiveCount+=C}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.bc.position){C=this.bc.getWorldMatrix()}else{const c=this.bc;C=b.TmpVectors.Matrix[0],b.Matrix.TranslationToRef(c.x,c.y,c.z,C)}const X=this._engine;this.updateInAnimate||this._update(C);let P=0;return c||d||(X.setState(!1),this.forceDepthWrite&&X.setDepthWrite(!0),P=this.blendMode===Rc.BLENDMODE_MULTIPLYADD?this._render(Rc.BLENDMODE_MULTIPLY,C)+this._render(Rc.BLENDMODE_ADD,C):this._render(this.blendMode,C),this._engine.setAlphaMode(0)),P}rebuild(){const C=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(C,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,C()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const C=this._scene.LU.indexOf(this);C>-1&&this._scene.LU.splice(C,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const C=this._renderVertexBuffers[c];for(const c in C)C[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),C&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),C&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Uc.notifyObservers(this),this.Uc.clear()}clone(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b={...this._customWrappers};let X=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){X=this.customShader;const C=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";b[0]=P.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,C,void 0,void 0,void 0,this)}const V=this.serialize(d),R=ec.Parse(V,this._scene||this._engine,this._rootUrl);return R.name=C,R.customShader=X,R._customWrappers=b,void 0===c&&(c=this.bc),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.bc=c,R}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return Rc._Serialize(c,this,C),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0;const P=C.name;let V,R;c instanceof YC.c?V=c:(R=c,V=R.getEngine());const p=new ec(P,{wX:X||C.wX,randomTextureSize:C.randomTextureSize},c,null,C.isAnimationSheetEnabled);if(p._rootUrl=d,C.customShader&&V.createEffectForParticles){const c=C.customShader,d=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",b=V.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,d,void 0,void 0,void 0,p);p.setCustomEffect(b,0),p.customShader=c}return C.id&&(p.id=C.id),C.activeParticleCount&&(p.activeParticleCount=C.activeParticleCount),Rc._Parse(C,p,c,d),C.preventAutoStart&&(p.preventAutoStart=C.preventAutoStart),b||p.preventAutoStart||p.start(),p}}var nc=d(12219),Wc=d(13798),Ec=d(12759);class Nc{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(C){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.bc=C;this._emitterNode=C}setEmitterAsSphere(C,c,d){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:C,renderingGroupId:c};const b=(0,Wc.c)("emitterSphere",{diameter:C.diameter,segments:C.segments},d);b.renderingGroupId=c;const X=new Ec.Rd("emitterSphereMaterial",d);X.emissiveColor=C.color,b.material=X;for(const P of this.systems)P.bc=b;this._emitterNode=b}start(C){for(const c of this.systems)C&&(c.bc=C),c.start()}dispose(){for(const C of this.systems)C.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const d of this.systems)c.systems.push(d.serialize(C));return this._emitterNode&&(c.bc=this._emitterCreationOptions),c}static Parse(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;const X=new Nc,P=this.BaseAssetsUrl+"/textures/";c=c||a.c.LastCreatedScene;for(const V of C.systems)X.systems.push(d?ec.Parse(V,c,P,!0,b):Rc.Parse(V,c,P,!0,b));if(C.bc){const d=C.bc.options;if("Sphere"===C.bc.kind)X.setEmitterAsSphere({diameter:d.diameter,segments:d.segments,color:V.pd.jd(d.color)},C.bc.renderingGroupId,c)}return X}}Nc.BaseAssetsUrl="https://assets.babylonjs.com/particles";var rc=d(12248);class Mc{static CreateDefault(C){let c,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,b=arguments.length>2?arguments[2]:void 0;c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ec("default system",{wX:d},b):new Rc("default system",d,b),c.bc=C;const X=nc.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return c.particleTexture=new w.b(X,c.NC()),c.createConeEmitter(.1,Math.PI/4),c.color1=new V.vc(1,1,1,1),c.color2=new V.vc(1,1,1,1),c.colorDead=new V.vc(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;c||(c=a.c.LastCreatedScene);const X={};return c.addPendingData(X),new Promise(((P,V)=>{if(d&&!ec.IsSupported)return c.removePendingData(X),V("Particle system with GPU is not supported.");nc.Tools.LoadFile(`${Mc.BaseAssetsUrl}/systems/${C}.json`,(C=>{c.removePendingData(X);const V=JSON.parse(C.toString());return P(Nc.Parse(V,c,d,b))}),void 0,void 0,void 0,(()=>(c.removePendingData(X),V(`An error occurred with the creation of your particle system. Check if your type '${C}' exists.`))))}))}static ExportSet(C){const c=new Nc;for(const d of C)c.systems.push(d);return c}static ParseFromFileAsync(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",P=arguments.length>5?arguments[5]:void 0;return new Promise(((V,R)=>{const p=new rc.b;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const c=JSON.parse(p.responseText);let R;R=b?ec.Parse(c,d,X,!1,P):Rc.Parse(c,d,X,!1,P),C&&(R.name=C),V(R)}else R("Unable to load the particle system")})),p.open("GET",c),p.send()}))}static ParseFromSnippetAsync(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",X=arguments.length>4?arguments[4]:void 0;if("_BLANK"===C){const C=this.CreateDefault(null);return C.start(),Promise.resolve(C)}return new Promise(((P,V)=>{const R=new rc.b;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const V=JSON.parse(JSON.parse(R.responseText).jsonPayload),p=JSON.parse(V.particleSystem);let j;j=d?ec.Parse(p,c,b,!1,X):Rc.Parse(p,c,b,!1,X),j.snippetId=C,P(j)}else V("Unable to load the snippet "+C)})),R.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),R.send()}))}}Mc.BaseAssetsUrl=Nc.BaseAssetsUrl,Mc.SnippetUrl="https://snippet.babylonjs.com",Mc.CreateFromSnippetAsync=Mc.ParseFromSnippetAsync;var Kc=d(12848),ic=d(12670),hc=d(13805);(0,hc.g)(ic.d.NAME_PARTICLESYSTEM,((C,c,d,b)=>{const X=(0,hc.h)(ic.d.NAME_PARTICLESYSTEM);if(X&&void 0!==C.LU&&null!==C.LU)for(let P=0,V=C.LU.length;P<V;P++){const V=C.LU[P];d.LU.push(X(V,c,b))}})),(0,hc.d)(ic.d.NAME_PARTICLESYSTEM,((C,c,d)=>{if(C.activeParticleCount){return ec.Parse(C,c,d)}return Rc.Parse(C,c,d)})),YC.c.prototype.createEffectForParticles=function(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",P=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0,R=arguments.length>6?arguments[6]:void 0,p=arguments.length>7?arguments[7]:void 0,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=arguments.length>9?arguments[9]:void 0,k=[],Z=[];const U=[];return p?p.fillUniformsAttributesAndSamplerNames(Z,k,U):(k=Rc._GetAttributeNamesOrOptions(),Z=Rc._GetEffectCreationOptions()),-1===X.indexOf(" BILLBOARD")&&(X+="\n#define BILLBOARD\n"),null!==p&&void 0!==p&&p.isAnimationSheetEnabled&&-1===X.indexOf(" ANIMATESHEET")&&(X+="\n#define ANIMATESHEET\n"),-1===b.indexOf("diffuseSampler")&&b.push("diffuseSampler"),this.createEffect({vertex:g??(null===p||void 0===p?void 0:p.vertexShaderName)??"particles",fragmentElement:C},k,Z.concat(c),U.concat(b),X,P,V,R,void 0,j,(async()=>{0===j?await Promise.resolve().then(d.bind(d,13841)):await Promise.resolve().then(d.bind(d,13900))}))},Kc.b.prototype.getEmittedParticleSystems=function(){const C=[];for(let c=0;c<this.NC().LU.length;c++){const d=this.NC().LU[c];d.bc===this&&C.push(d)}return C},Kc.b.prototype.getHierarchyEmittedParticleSystems=function(){const C=[],c=this.getDescendants();c.push(this);for(let d=0;d<this.NC().LU.length;d++){const b=this.NC().LU[d],X=b.bc;X.position&&-1!==c.indexOf(X)&&C.push(b)}return C};d(12731),d(12741),d(12821);d(12828),d(13814),d(12604),d(12718),d(12874);d(12600);var Lc;d(13819),d(12426);!function(C){C[C.Color=2]="Color",C[C.UV=1]="UV",C[C.Random=0]="Random",C[C.Stated=3]="Stated"}(Lc||(Lc={}));var fc=d(12628);const Tc=new b.dd(0,0,0),zc=new b.dd(0,0,0),wc=new b.dd(0,0,0);class Jc{constructor(C,c,d){this.width=C,this.height=c,this.data=d}processFlowable(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2?arguments[2]:void 0;if(!d)return;d instanceof b.Matrix?b.dd.TransformCoordinatesToRef(C.position,d,wc):(wc.x=d.x,wc.y=d.y,wc.z=d.z);const X=.5*wc.x+.5,P=1-(.5*wc.y+.5),V=Math.floor(X*this.width),R=Math.floor(P*this.height);if(V<0||V>=this.width||R<0||R>=this.height)return;const p=4*(R*this.width+V),j=this.data[p]/255*2-1,g=this.data[p+1]/255*2-1,k=this.data[p+2]/255*2-1,Z=this.data[p+3]/255;Tc.set(j,g,k),Tc.scaleToRef(c*Z,zc),C.direction.addInPlace(zc)}_processParticle(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2?arguments[2]:void 0;this.processFlowable(C,c,d)}static async FromUrlAsync(C){return await new Promise(((c,d)=>{const b=document.createElement("canvas"),X=b.getContext("2d");let P=null;const V=new Image;V.crossOrigin="anonymous",V.src=C,V.onerror=c=>{d(new Error(`Failed to load image: ${C} : ${c}`))},V.onload=()=>{b.width=V.width,b.height=V.height,X.drawImage(V,0,0),P=X.getImageData(0,0,b.width,b.height),c(new Jc(b.width,b.height,P.data))}}))}static async ExtractFromTextureAsync(C){return await new Promise(((c,d)=>{if(!C.isReady())return void C.onLoadObservable.addOnce((async()=>{try{const d=await this.ExtractFromTextureAsync(C);c(d)}catch(b){d(b)}}));const b=C.getSize();fc.f.GetTextureDataAsync(C,b.width,b.height).then((C=>{c(new Jc(b.width,b.height,new Uint8ClampedArray(C)))})).catch(d)}))}}var yc,xc,Hc,vc,Dc,sc,md,Qc,Ic;!function(C){C[C.Int=1]="Int",C[C.Float=2]="Float",C[C.Vector2=4]="Vector2",C[C.dd=8]="dd",C[C.Matrix=16]="Matrix",C[C.Particle=32]="Particle",C[C.Texture=64]="Texture",C[C.vc=128]="vc",C[C.FloatGradient=256]="FloatGradient",C[C.Vector2Gradient=512]="Vector2Gradient",C[C.Vector3Gradient=1024]="Vector3Gradient",C[C.Color4Gradient=2048]="Color4Gradient",C[C.System=4096]="System",C[C.AutoDetect=8192]="AutoDetect",C[C.BasedOnInput=16384]="BasedOnInput",C[C.Undefined=32768]="Undefined",C[C.All=65535]="All"}(yc||(yc={})),function(C){C[C.Compatible=0]="Compatible",C[C.TypeIncompatible=1]="TypeIncompatible",C[C.HierarchyIssue=2]="HierarchyIssue"}(xc||(xc={})),function(C){C[C.Input=0]="Input",C[C.Output=1]="Output"}(Hc||(Hc={}));class oc{get direction(){return this._direction}get type(){if(this._type===yc.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===yc.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(C){this._type=C}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((C=>C.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(C,c,d){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=yc.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new S.b,this.onDisconnectionObservable=new S.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=c,this.name=C,this._direction=d}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(C){var c;return this.isConnected?null!==(c=this._connectedPoint)&&void 0!==c&&c._storedFunction?this._connectedPoint._storedFunction(C):this._connectedPoint._storedValue:this.value}canConnectTo(C){return 0===this.checkCompatibilityState(C)}checkCompatibilityState(C){const c=this._ownerBlock,d=C.ownerBlock;if(this.type!==C.type&&C.innerType!==yc.AutoDetect)return C.acceptedConnectionPointTypes&&-1!==C.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(C.excludedConnectionPointTypes&&-1!==C.excludedConnectionPointTypes.indexOf(this.type))return 1;let b=d,X=c;return 0===this.direction&&(b=c,X=d),b.isAnAncestorOf(X)?2:0}connectTo(C){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(C))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${C.ownerBlock.name}".${C.name}`;return this._endpoints.push(C),C._connectedPoint=this,this.onConnectionObservable.notifyObservers(C),C.onConnectionObservable.notifyObservers(this),this}disconnectFrom(C){const c=this._endpoints.indexOf(C);return-1===c||(this._endpoints.splice(c,1),C._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(C),C.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(C){let c=1;for(;c<yc.All;)C&c||this.excludedConnectionPointTypes.push(c),c<<=1}serialize(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c={};return c.name=this.name,c.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.rc?(c.valueType="BABYLON."+this.value.getClassName(),c.value=this.value.rc()):(c.valueType="number",c.value=this.value)),C&&this.connectedPoint&&(c.inputName=this.name,c.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,c.targetConnectionName=this.connectedPoint.name,c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),c}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Fc{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(C){this._name=C}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(C){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new S.b,this.Uc=new S.b,this.onInputChangedObservable=new S.b,this.visibleOnFrame=!1,this._name=C,this.uniqueId=J.e.UniqueId}_inputRename(C){return C}_outputRename(C){return C}isAnAncestorOf(C){for(const c of this._outputs)if(c.hasEndpoints)for(const d of c.endpoints){if(d.ownerBlock===C)return!0;if(d.ownerBlock.isAnAncestorOf(C))return!0}return!1}isAnAncestorOfType(C){if(this.getClassName()===C)return!0;for(const c of this._outputs)if(c.hasEndpoints)for(const d of c.endpoints)if(d.ownerBlock.isAnAncestorOfType(C))return!0;return!1}getInputByName(C){const c=this._inputs.filter((c=>c.name===C));return c.length?c[0]:null}_linkConnectionTypes(C,c){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[c]._acceptedConnectionPointType=this._inputs[C]:(this._inputs[C]._linkedConnectionSource=this._inputs[c],this._inputs[C]._isMainLinkSource=!0),this._inputs[c]._linkedConnectionSource=this._inputs[C]}registerInput(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;const V=new oc(C,this,0);return V.type=c,V.isOptional=d,V.defaultValue=b,V.value=b,V.valueMin=X,V.valueMax=P,this._inputs.push(V),this.onInputChangedObservable.notifyObservers(V),this}registerOutput(C,c,d){return(d=d??new oc(C,this,1)).type=c,this._outputs.push(d),this}_build(C){}_customBuildStep(C){}build(C){if(this._buildId===C.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((C=>C.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=C.buildId;for(const c of this._inputs){if(!c.connectedPoint){c.isOptional||C.notConnectedNonOptionalInputs.push(c);continue}const d=c.connectedPoint.ownerBlock;d&&d!==this&&!d.isSystem&&d.build(C)}return this._customBuildStep(C),C.verbose&&y.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(C),this.onBuildObservable.notifyObservers(this),!1}serialize(){const C={};C.customType="BABYLON."+this.getClassName(),C.id=this.uniqueId,C.name=this.name,C.visibleOnFrame=this.visibleOnFrame,C.inputs=[],C.outputs=[];for(const c of this.inputs)C.inputs.push(c.serialize());for(const c of this.outputs)C.outputs.push(c.serialize(!1));return C}_deserialize(C){this._name=C.name,this.comments=C.comments,this.visibleOnFrame=!!C.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(C)}_deserializePortDisplayNamesAndExposedOnFrame(C){const c=C.inputs,d=C.outputs;if(c)for(const b of c){const C=this.inputs.find((C=>C.name===b.name));if(!C)return;if(b.displayName&&(C.displayName=b.displayName),b.isExposedOnFrame&&(C.isExposedOnFrame=b.isExposedOnFrame,C.exposedPortPosition=b.exposedPortPosition),void 0!==b.value&&null!==b.value)if("number"===b.valueType)C.value=b.value;else{const c=(0,R.b)(b.valueType);c&&(C.value=c.jd(b.value))}}if(d)for(let b=0;b<d.length;b++){const C=d[b];C.displayName&&(this.outputs[b].displayName=C.displayName),C.isExposedOnFrame&&(this.outputs[b].isExposedOnFrame=C.isExposedOnFrame,this.outputs[b].exposedPortPosition=C.exposedPortPosition)}}clone(){const C=this.serialize(),c=(0,R.b)(C.customType);if(c){const d=new c;return d._deserialize(C),d}return null}dispose(){this.Uc.notifyObservers(this),this.Uc.clear();for(const C of this.inputs)C.dispose();for(const C of this.outputs)C.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Yc(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",b=arguments.length>3?arguments[3]:void 0;return(X,P)=>{let V=X._propStore;V||(V=[],X._propStore=V),V.push({propertyName:P,displayName:C,type:c,groupName:d,options:b??{},className:X.getClassName()})}}(0,f.e)([(0,T.P)("comment")],Fc.prototype,"comments",void 0),function(C){C[C.Boolean=0]="Boolean",C[C.Float=1]="Float",C[C.Int=2]="Int",C[C.Vector2=3]="Vector2",C[C.List=4]="List",C[C.vc=5]="vc",C[C.SamplingMode=6]="SamplingMode",C[C.TextureFormat=7]="TextureFormat",C[C.TextureType=8]="TextureType"}(vc||(vc={})),function(C){C[C.None=0]="None",C[C.Position=1]="Position",C[C.Direction=2]="Direction",C[C.Age=3]="Age",C[C.Lifetime=4]="Lifetime",C[C.Color=5]="Color",C[C.ScaledDirection=6]="ScaledDirection",C[C.Scale=7]="Scale",C[C.AgeGradient=8]="AgeGradient",C[C.Angle=9]="Angle",C[C.SpriteCellIndex=16]="SpriteCellIndex",C[C.SpriteCellStart=17]="SpriteCellStart",C[C.SpriteCellEnd=18]="SpriteCellEnd"}(Dc||(Dc={})),function(C){C[C.None=0]="None",C[C.Time=1]="Time",C[C.Delta=2]="Delta",C[C.Emitter=3]="Emitter"}(sc||(sc={}));class lc{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let C="";for(const c of this.notConnectedNonOptionalInputs)C+=`input ${c.name} from block ${c.ownerBlock.name}[${c.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(C)throw"Build of Node Particle System Set failed:\n"+C}adapt(C,c){const d=C.getConnectedValue(this)||0;if(C.type===c)return d;switch(c){case yc.Vector2:return new b.Vector2(d,d);case yc.dd:return new b.dd(d,d,d);case yc.vc:return new V.vc(d,d,d,d)}return null}getContextualValue(C){if(!this.particleContext||!this.systemContext)return null;switch(C){case Dc.Position:return this.particleContext.position;case Dc.Direction:return this.particleContext.direction;case Dc.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Dc.Color:return this.particleContext.color;case Dc.Age:return this.particleContext.age;case Dc.Lifetime:return this.particleContext.lifeTime;case Dc.Angle:return this.particleContext.angle;case Dc.Scale:return this.particleContext.scale;case Dc.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Dc.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Dc.SpriteCellIndex:return this.particleContext.cellIndex;case Dc.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.bc.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.bc.absolutePosition:this.systemContext.bc:null}getSystemValue(C){if(!this.particleContext||!this.systemContext)return null;switch(C){case sc.Time:return this.systemContext._actualFrame;case sc.Delta:return this.systemContext._scaledUpdateSpeed;case sc.Emitter:if(this.isEmitterTransformNode){return this.systemContext.bc.absolutePosition}return this.systemContext.bc}return null}}function Sc(C,c,d){const b=new lc;b.Pd=c;const X=C.createSystem(b);return X.canStart=()=>!0,X.bc=d.clone(),X.disposeOnStop=!0,X.start(),X}class Gc extends Fc{constructor(C){super(C),this.blendMode=p.BLENDMODE_ONEONE,this.wX=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",yc.Particle),this.registerInput("texture",yc.Texture),this.registerInput("onStart",yc.System,!0),this.registerInput("onEnd",yc.System,!0),this.registerOutput("system",yc.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(C){C.wX=this.wX,C.buildId=this._buildId++,this.build(C);const c=this.particle.getConnectedValue(C);return c.particleTexture=this.texture.getConnectedValue(C),c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.name=this.name,c._nodeGenerated=!0,c._targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,this.system._storedValue=this,c.canStart=()=>!this.doNoStart,c.onStartedObservable.add((d=>{const b=this.onStart.getConnectedValue(C);b&&d.onStartedObservable.addOnce((()=>{C.systemContext=c;const d=Sc(b,C.Pd,C.emitterPosition);this.Uc.addOnce((()=>{d.dispose()}))}));const X=this.onEnd.getConnectedValue(C);X&&d.onStoppedObservable.addOnce((()=>{C.systemContext=c;const d=Sc(X,C.Pd,C.emitterPosition);this.Uc.addOnce((()=>{d.dispose()}))}))})),this.Uc.addOnce((()=>{c.dispose()})),c}serialize(){const C=super.serialize();return C.wX=this.wX,C.emitRate=this.emitRate,C.blendMode=this.blendMode,C.doNoStart=this.doNoStart,C.targetStopDuration=this.targetStopDuration,C.startDelay=this.startDelay,C}_deserialize(C){super._deserialize(C),this.wX=C.wX,this.emitRate=C.emitRate,this.doNoStart=!!C.doNoStart,void 0!==C.blendMode&&(this.blendMode=C.blendMode),void 0!==C.targetStopDuration&&(this.targetStopDuration=C.targetStopDuration),void 0!==C.startDelay&&(this.startDelay=C.startDelay)}}(0,f.e)([Yc("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:p.BLENDMODE_ONEONE},{label:"Standard",value:p.BLENDMODE_STANDARD},{label:"Add",value:p.BLENDMODE_ADD},{label:"Multiply",value:p.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:p.BLENDMODE_MULTIPLYADD}]})],Gc.prototype,"blendMode",void 0),(0,f.e)([Yc("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Gc.prototype,"wX",void 0),(0,f.e)([Yc("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gc.prototype,"emitRate",void 0),(0,f.e)([Yc("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gc.prototype,"targetStopDuration",void 0),(0,f.e)([Yc("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gc.prototype,"startDelay",void 0),(0,f.e)([Yc("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gc.prototype,"doNoStart",void 0),(0,R.e)("BABYLON.SystemBlock",Gc);class ac extends Fc{get type(){if(this._type===yc.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=yc.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=yc.Vector2,this._type;case"dd":return this._type=yc.dd,this._type;case"vc":return this._type=yc.vc,this._type;case"Matrix":return this._type=yc.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Dc.None&&this._systemSource!==sc.None}get systemSource(){return this._systemSource}set systemSource(C){if(this._systemSource=C,C!==sc.None){switch(this._contextualSource=Dc.None,this._type=yc.Float,C){case sc.Time:case sc.Delta:this._type=yc.Float;break;case sc.Emitter:this._type=yc.dd}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Dc.None}get contextualValue(){return this._contextualSource}set contextualValue(C){if(this._contextualSource=C,C!==Dc.None){switch(this._systemSource=sc.None,C){case Dc.Scale:this._type=yc.Vector2;break;case Dc.Position:case Dc.Direction:case Dc.ScaledDirection:this._type=yc.dd;break;case Dc.Color:this._type=yc.vc;break;case Dc.Age:case Dc.Lifetime:case Dc.Angle:case Dc.AgeGradient:this._type=yc.Float;break;case Dc.SpriteCellEnd:case Dc.SpriteCellStart:case Dc.SpriteCellIndex:this._type=yc.Int}this.output&&(this.output.type=this._type)}}constructor(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yc.AutoDetect;super(C),this._type=yc.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new S.b,this._systemSource=sc.None,this._contextualSource=Dc.None,this._type=c,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",c)}get value(){return this._storedValue}set value(C){this.type===yc.Float&&this.min!==this.max&&(C=Math.max(this.min,C),C=Math.min(this.max,C)),this._storedValue=C,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(C){this._valueCallback=C}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case yc.Int:case yc.Float:this.value=0;break;case yc.Vector2:this.value=b.Vector2.Zero();break;case yc.dd:this.value=b.dd.Zero();break;case yc.vc:this.value=new V.vc(1,1,1,1);break;case yc.Matrix:this.value=b.Matrix.Identity()}}_build(C){super._build(C),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=C=>C.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=C=>C.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const C=super.serialize();return C.type=this.type,C.contextualValue=this.contextualValue,C.systemSource=this.systemSource,C.min=this.min,C.max=this.max,C.groupInInspector=this.groupInInspector,C.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.rc?(C.valueType="BABYLON."+this._storedValue.getClassName(),C.value=this._storedValue.rc()):(C.valueType="number",C.value=this._storedValue)),C}_deserialize(C){if(super._deserialize(C),this._type=C.type,this.contextualValue=C.contextualValue,this.systemSource=C.systemSource||sc.None,this.min=C.min||0,this.max=C.max||0,this.groupInInspector=C.groupInInspector||"",void 0!==C.displayInInspector&&(this.displayInInspector=C.displayInInspector),C.valueType)if("number"===C.valueType)this._storedValue=C.value;else{const c=(0,R.b)(C.valueType);c&&(this._storedValue=c.jd(C.value))}}}(0,R.e)("BABYLON.ParticleInputBlock",ac);class Oc extends Fc{get url(){return this._url}set url(C){this._url!==C&&(this._cachedData=null,this._url=C,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(C){this._textureDataUrl!==C&&(this._cachedData=null,this._textureDataUrl=C,this._url="",this._sourceTexture=null)}set sourceTexture(C){this._sourceTexture!==C&&(this._cachedData=null,this._sourceTexture=C,this._url="",this._textureDataUrl="")}constructor(C){super(C),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",yc.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const C=this.texture._storedValue;return await new Promise(((c,d)=>{if(!C.isReady())return void C.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),c(this._cachedData)}catch(C){d(C)}}));const b=C.getSize();fc.f.GetTextureDataAsync(C,b.width,b.height).then((d=>{this._cachedData={width:b.width,height:b.height,data:new Uint8ClampedArray(d)},C.dispose(),c(this._cachedData)})).catch(d)}))}_build(C){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new w.b(this._textureDataUrl,C.Pd):this.texture._storedValue=new w.b(this._url,C.Pd):this.texture._storedValue=null}serialize(){const C=super.serialize();return C.url=this.url,C.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(C.textureDataUrl=this.textureDataUrl),C}_deserialize(C){super._deserialize(C),this.url=C.url,this.serializedCachedData=!!C.serializedCachedData,C.textureDataUrl&&(this.textureDataUrl=C.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,R.e)("BABYLON.ParticleTextureSourceBlock",Oc);class Cd extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("position",yc.dd),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(C){const c=this.particle.getConnectedValue(C);if(this.output._storedValue=c,!this.position.isConnected)return;const d={process:d=>{C.particleContext=d,C.systemContext=c,d.position.V(this.position.getConnectedValue(C))},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d}}(0,R.e)("BABYLON.UpdatePositionBlock",Cd),function(C){C[C.Add=0]="Add",C[C.Subtract=1]="Subtract",C[C.Multiply=2]="Multiply",C[C.Divide=3]="Divide",C[C.Max=4]="Max",C[C.Min=5]="Min"}(md||(md={}));class cd extends Fc{constructor(C){super(C),this.operation=md.Add,this.registerInput("left",yc.AutoDetect),this.registerInput("right",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this.output._typeConnectionSource=this.left;const c=[yc.Matrix,yc.Particle,yc.Texture,yc.System,yc.FloatGradient,yc.Color4Gradient,yc.Vector2Gradient,yc.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...c),this.right.excludedConnectionPointTypes.push(...c),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(C){let c;const d=this.left,X=this.right;if(!d.isConnected||!X.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const P=d.type===yc.Float||d.type===yc.Int,R=X.type===yc.Float||X.type===yc.Int,p=P&&R;switch(this.operation){case md.Add:c=p?C=>d.getConnectedValue(C)+X.getConnectedValue(C):P?C=>C.adapt(d,X.type).add(X.getConnectedValue(C)):C=>d.getConnectedValue(C).add(C.adapt(X,d.type));break;case md.Subtract:c=p?C=>d.getConnectedValue(C)-X.getConnectedValue(C):P?C=>C.adapt(d,X.type).Xd(X.getConnectedValue(C)):C=>d.getConnectedValue(C).Xd(C.adapt(X,d.type));break;case md.Multiply:c=p?C=>d.getConnectedValue(C)*X.getConnectedValue(C):P?C=>C.adapt(d,X.type).multiply(X.getConnectedValue(C)):C=>d.getConnectedValue(C).multiply(C.adapt(X,d.type));break;case md.Divide:c=p?C=>d.getConnectedValue(C)/X.getConnectedValue(C):P?C=>C.adapt(d,X.type).divide(X.getConnectedValue(C)):C=>d.getConnectedValue(C).divide(C.adapt(X,d.type));break;case md.Min:if(p)c=C=>Math.min(d.getConnectedValue(C),X.getConnectedValue(C));else{const[C,R]=P?[X,d]:[d,X];switch(C.type){case yc.Vector2:c=c=>b.Vector2.Minimize(C.getConnectedValue(c),c.adapt(R,C.type));break;case yc.dd:c=c=>b.dd.Minimize(C.getConnectedValue(c),c.adapt(R,C.type));break;case yc.vc:c=c=>{const d=C.getConnectedValue(c),{r:b,g:X,b:P,a:p}=c.adapt(R,C.type);return new V.vc(Math.min(d.r,b),Math.min(d.g,X),Math.min(d.b,P),Math.min(d.a,p))}}}break;case md.Max:if(!p){const[C,R]=P?[X,d]:[d,X];switch(C.type){case yc.Vector2:c=c=>b.Vector2.Maximize(C.getConnectedValue(c),c.adapt(R,C.type));break;case yc.dd:c=c=>b.dd.Maximize(C.getConnectedValue(c),c.adapt(R,C.type));break;case yc.vc:c=c=>{const d=C.getConnectedValue(c),{r:b,g:X,b:P,a:p}=c.adapt(R,C.type);return new V.vc(Math.max(d.r,b),Math.min(d.g,X),Math.min(d.b,P),Math.min(d.a,p))}}break}c=C=>Math.max(d.getConnectedValue(C),X.getConnectedValue(C))}this.output._storedFunction=C=>d.type===yc.Int?0|c(C):c(C)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===yc.Int||this.left.type===yc.Float&&this.right.type!==yc.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[C,c]of[[this.left,this.right],[this.right,this.left]])C.acceptedConnectionPointTypes=[yc.Int,yc.Float],c.isConnected&&(C.acceptedConnectionPointTypes.push(c.type),c.type!==yc.Int&&c.type!==yc.Float||C.acceptedConnectionPointTypes.push(yc.Vector2,yc.dd,yc.vc))}dispose(){super.dispose();for(const C of this._connectionObservers)C.remove();this._connectionObservers.length=0}serialize(){const C=super.serialize();return C.operation=this.operation,C}_deserialize(C){super._deserialize(C),this.operation=C.operation}}(0,f.e)([Yc("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:md.Add},{label:"Subtract",value:md.Subtract},{label:"Multiply",value:md.Multiply},{label:"Divide",value:md.Divide},{label:"Max",value:md.Max},{label:"Min",value:md.Min}]})],cd.prototype,"operation",void 0),(0,R.e)("BABYLON.ParticleMathBlock",cd);class dd extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("direction1",yc.dd,!0,new b.dd(0,1,0)),this.registerInput("direction2",yc.dd,!0,new b.dd(0,1,0)),this.registerInput("minEmitBox",yc.dd,!0,new b.dd(-.5,-.5,-.5)),this.registerInput("maxEmitBox",yc.dd,!0,new b.dd(.5,.5,.5)),this.registerOutput("output",yc.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(C){const c=this.particle.getConnectedValue(C);c._directionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.direction1.getConnectedValue(C),P=this.direction2.getConnectedValue(C),V=(0,j.RandomRange)(X.x,P.x),R=(0,j.RandomRange)(X.y,P.y),p=(0,j.RandomRange)(X.z,P.z);C.isEmitterTransformNode?b.dd.TransformNormalFromFloatsToRef(V,R,p,C.emitterWorldMatrix,d.direction):d.direction.yc(V,R,p)},c._positionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.minEmitBox.getConnectedValue(C),P=this.maxEmitBox.getConnectedValue(C),V=(0,j.RandomRange)(X.x,P.x),R=(0,j.RandomRange)(X.y,P.y),p=(0,j.RandomRange)(X.z,P.z);C.isEmitterTransformNode?b.dd.TransformCoordinatesFromFloatsToRef(V,R,p,C.emitterWorldMatrix,d.position):(d.position.yc(V,R,p),d.position.addInPlace(C.emitterPosition))},this.output._storedValue=c}}(0,R.e)("BABYLON.BoxShapeBlock",dd);class bd extends Fc{constructor(C){super(C),this.registerInput("emitPower",yc.Float,!0,1),this.registerInput("lifeTime",yc.Float,!0,1),this.registerInput("color",yc.vc,!0,new V.vc(1,1,1,1)),this.registerInput("scale",yc.Vector2,!0,new b.Vector2(1,1)),this.registerInput("angle",yc.Float,!0,0),this.registerOutput("particle",yc.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(C){const c=new Rc(this.name,C.wX,C.Pd,null,!1,void 0,!0);c.particleEmitterType=new B,c._lifeTimeCreation.process=(c,d)=>{C.particleContext=c,c.lifeTime=this.lifeTime.getConnectedValue(C),d._emitPower=this.emitPower.getConnectedValue(C)},c._colorCreation.process=c=>{C.particleContext=c,c.color.V(this.color.getConnectedValue(C))},c._sizeCreation.process=c=>{C.particleContext=c,c.size=1,c.scale.V(this.scale.getConnectedValue(C))},c._angleCreation.process=c=>{C.particleContext=c,c.angle=this.angle.getConnectedValue(C)},this.particle._storedValue=c}}(0,R.e)("BABYLON.CreateParticleBlock",bd);class Xd{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const C=[];for(const c of this.attachedBlocks)c.isInput&&C.push(c);return C}constructor(C){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new S.b,this.name=C}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(C)&&this.attachedBlocks.push(C);for(const d of C.inputs){const b=d.connectedPoint;if(b){const d=b.ownerBlock;d!==C&&this._initializeBlock(d,c)}}}async buildAsync(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((d=>{const b=new Nc;for(const C of this._systemBlocks)this._initializeBlock(C);for(const X of this.systemBlocks){const d=new lc;d.buildId=this._buildId++,d.Pd=C,d.verbose=c;const P=X.createSystem(d);d.emitErrors(),b.systems.push(P)}this.onBuildObservable.notifyObservers(this),d(b)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const C=new Gc("Particle system"),c=new Cd("Update position");c.output.connectTo(C.particle);const d=new ac("Position");d.contextualValue=Dc.Position;const b=new ac("Scaled direction");b.contextualValue=Dc.ScaledDirection;const X=new cd("Add");X.operation=md.Add,d.output.connectTo(X.left),b.output.connectTo(X.right),X.output.connectTo(c.position);const P=new bd("Create particle"),V=new dd("Box shape");P.particle.connectTo(V.particle),V.output.connectTo(c.particle);const R=new Oc("Texture");R.texture.connectTo(C.texture),R.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(C)}removeBlock(C){const c=this.attachedBlocks.indexOf(C);if(c>-1&&this.attachedBlocks.splice(c,1),C.isSystem){const c=this._systemBlocks.indexOf(C);c>-1&&this._systemBlocks.splice(c,1)}}parseSerializedObject(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c||this.clear();const d={};for(const b of C.lk){const C=(0,R.b)(b.customType);if(C){const c=new C;c._deserialize(b),d[b.id]=c,this.attachedBlocks.push(c),c.isSystem&&this._systemBlocks.push(c)}}for(const b of this.attachedBlocks)if(b.isTeleportOut){const C=b,c=C._tempEntryPointUniqueId;if(c){const b=d[c];b&&b.attachToEndpoint(C)}}for(let b=0;b<C.lk.length;b++){const X=C.lk[b],P=d[X.id];P&&(P.inputs.length&&X.inputs.some((C=>C.targetConnectionName))&&!c||this._restoreConnections(P,C,d))}if(C.locations||C.editorData&&C.editorData.locations){const b=C.locations||C.editorData.locations;for(const C of b)d[C.rP]&&(C.rP=d[C.rP].uniqueId);c&&this.editorData&&this.editorData.locations&&b.concat(this.editorData.locations),C.locations?this.editorData={locations:b}:(this.editorData=C.editorData,this.editorData.locations=b);const X=[];for(const C in d)X[C]=d[C].uniqueId;this.editorData.map=X}this.comment=C.comment}_restoreConnections(C,c,d){for(const b of C.outputs)for(const X of c.lk){const P=d[X.id];if(P)for(const V of X.inputs)if(d[V.targetBlockId]!==C||V.targetConnectionName!==b.name);else{const C=P.getInputByName(V.inputName);if(!C||C.isConnected)continue;b.connectTo(C,!0),this._restoreConnections(P,c,d)}}}serialize(C){const c=C?{}:z.e.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));let d=[];C?d=C:c.customType="BABYLON.NodeParticleSystemSet",c.lk=[];for(const b of d)c.lk.push(b.serialize());if(!C)for(const b of this.attachedBlocks)-1===d.indexOf(b)&&c.lk.push(b.serialize());return c}dispose(){for(const C of this.attachedBlocks)C.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(C){const c=new Xd(C);return c.setToDefault(),c}static Parse(C){const c=z.e.Parse((()=>new Xd(C.name)),C,null);return c.parseSerializedObject(C),c}static ParseFromSnippetAsync(C,c){return"_BLANK"===C?Promise.resolve(Xd.CreateDefault("blank")):new Promise(((d,b)=>{const X=new rc.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const V=JSON.parse(JSON.parse(X.responseText).jsonPayload),R=JSON.parse(V.nodeParticle);c||(c=z.e.Parse((()=>new Xd(C)),R,null)),c.parseSerializedObject(R),c.snippetId=C;try{d(c)}catch(P){b(P)}}else b("Unable to load the snippet "+C)})),X.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),X.send()}))}}Xd.EditorURL=`${nc.Tools._DefaultCdnUrl}/v${YC.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Xd.SnippetUrl="https://snippet.babylonjs.com",(0,f.e)([(0,T.P)()],Xd.prototype,"name",void 0),(0,f.e)([(0,T.P)("comment")],Xd.prototype,"comment",void 0),function(C){C[C.None=0]="None",C[C.PerParticle=1]="PerParticle",C[C.PerSystem=2]="PerSystem"}(Qc||(Qc={}));class Pd extends Fc{constructor(C){super(C),this._currentLockId=-2,this.lockMode=Qc.PerParticle,this.registerInput("min",yc.AutoDetect,!0,0),this.registerInput("max",yc.AutoDetect,!0,1),this.registerOutput("output",yc.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yc.Float|yc.Int|yc.Vector2|yc.dd|yc.vc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(yc.Float|yc.Int|yc.Vector2|yc.dd|yc.vc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=yc.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let C=null;switch(this._currentLockId=-2,this.min.type){case yc.AutoDetect:case yc.Int:case yc.Float:C=C=>{const c=this.min.getConnectedValue(C)||0,d=this.max.getConnectedValue(C)||1;return c+Math.random()*(d-c)};break;case yc.Vector2:C=C=>{const c=this.min.getConnectedValue(C)||b.Vector2.Zero(),d=this.max.getConnectedValue(C)||b.Vector2.One();return new b.Vector2(c.x+Math.random()*(d.x-c.x),c.y+Math.random()*(d.y-c.y))};break;case yc.dd:C=C=>{const c=this.min.getConnectedValue(C)||b.dd.Zero(),d=this.max.getConnectedValue(C)||b.dd.One();return new b.dd(c.x+Math.random()*(d.x-c.x),c.y+Math.random()*(d.y-c.y),c.z+Math.random()*(d.z-c.z))};break;case yc.vc:C=C=>{const c=this.min.getConnectedValue(C)||new V.vc(0,0,0,0),d=this.max.getConnectedValue(C)||new V.vc(1,1,1,1);return new V.vc(c.x+Math.random()*(d.x-c.x),c.y+Math.random()*(d.y-c.y),c.z+Math.random()*(d.z-c.z),c.w+Math.random()*(d.w-c.w))}}this.output._storedFunction=c=>{var d;let b=0;switch(this.lockMode){case Qc.PerParticle:b=(null===(d=c.particleContext)||void 0===d?void 0:d.id)||-1;break;case Qc.PerSystem:b=c.buildId||0}return this._currentLockId!==b&&(this.lockMode!==Qc.None&&(this._currentLockId=b),this.output._storedValue=C(c)),this.output._storedValue}}serialize(){const C=super.serialize();return C.lockMode=this.lockMode,C}_deserialize(C){super._deserialize(C),this.lockMode=C.lockMode}}(0,f.e)([Yc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Qc.None},{label:"Per particle",value:Qc.PerParticle},{label:"Per system",value:Qc.PerSystem}]})],Pd.prototype,"lockMode",void 0),(0,R.e)("BABYLON.ParticleRandomBlock",Pd);class Vd extends Fc{constructor(C){super(C),this._currentLockId=-2,this.lockMode=Qc.PerParticle,this.registerInput("min",yc.AutoDetect),this.registerInput("max",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const c=[yc.Matrix,yc.Particle,yc.Texture,yc.System,yc.FloatGradient,yc.Color4Gradient,yc.Vector2Gradient,yc.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...c),this.max.excludedConnectionPointTypes.push(...c)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let C=null;switch(this._currentLockId=-2,this.min.type){case yc.Float:case yc.Int:C=C=>{const c=this.min.getConnectedValue(C),d=this.max.getConnectedValue(C);return Math.random()*(d-c)+c};break;case yc.Vector2:C=C=>{const c=this.min.getConnectedValue(C),d=this.max.getConnectedValue(C);return new b.Vector2(Math.random()*(d.x-c.x)+c.x,Math.random()*(d.y-c.y)+c.y)};break;case yc.dd:C=C=>{const c=this.min.getConnectedValue(C),d=this.max.getConnectedValue(C);return new b.dd(Math.random()*(d.x-c.x)+c.x,Math.random()*(d.y-c.y)+c.y,Math.random()*(d.z-c.z)+c.z)};break;case yc.vc:C=C=>{const c=this.min.getConnectedValue(C),d=this.max.getConnectedValue(C);return new V.vc(Math.random()*(d.r-c.r)+c.r,Math.random()*(d.g-c.g)+c.g,Math.random()*(d.b-c.b)+c.b,Math.random()*(d.a-c.a)+c.a)}}this.output._storedFunction=c=>{var d;let b=0;switch(this.lockMode){case Qc.PerParticle:b=(null===(d=c.particleContext)||void 0===d?void 0:d.id)||-1;break;case Qc.PerSystem:b=c.buildId||0}return this._currentLockId!==b&&(this.lockMode!==Qc.None&&(this._currentLockId=b),this.output._storedValue=C(c)),this.output._storedValue}}serialize(){const C=super.serialize();return C.lockMode=this.lockMode,C}_deserialize(C){super._deserialize(C),void 0!==C.lockMode&&(this.lockMode=C.lockMode)}}(0,f.e)([Yc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Qc.None},{label:"Per particle",value:Qc.PerParticle},{label:"Per system",value:Qc.PerSystem}]})],Vd.prototype,"lockMode",void 0),(0,R.e)("BABYLON.RandomRangeBlock",Vd);(0,R.e)("BABYLON.ParticleLerpBlock",class extends Fc{constructor(C){super(C),this.registerInput("left",yc.AutoDetect),this.registerInput("right",yc.AutoDetect),this.registerInput("gradient",yc.Float,!0,0,0,1),this.registerOutput("output",yc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yc.Float|yc.Int|yc.Vector2|yc.dd|yc.vc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const C=(C,c,d)=>(1-C)*c+C*d;this.output._storedFunction=c=>{const d=this.left.getConnectedValue(c),X=this.right.getConnectedValue(c),P=this.gradient.getConnectedValue(c);switch(this.left.type){case yc.Int:case yc.Float:return C(P,d,X);case yc.Vector2:return new b.Vector2(C(P,d.x,X.x),C(P,d.y,X.y));case yc.dd:return new b.dd(C(P,d.x,X.x),C(P,d.y,X.y),C(P,d.z,X.z));case yc.vc:return new V.vc(C(P,d.r,X.r),C(P,d.g,X.g),C(P,d.b,X.b),C(P,d.a,X.a))}return 0}}});(0,R.e)("BABYLON.UpdateDirectionBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("direction",yc.dd),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(C){const c=this.particle.getConnectedValue(C);if(this.output._storedValue=c,!this.direction.isConnected)return;const d={process:d=>{C.particleContext=d,C.systemContext=c,d.direction.V(this.direction.getConnectedValue(C))},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d}});(0,R.e)("BABYLON.UpdateColorBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("color",yc.vc),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(C){const c=this.particle.getConnectedValue(C);if(this.output._storedValue=c,!this.color.isConnected)return;const d={process:d=>{C.particleContext=d,C.systemContext=c,d.color.V(this.color.getConnectedValue(C))},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d}});(0,R.e)("BABYLON.UpdateScaleBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("scale",yc.Vector2),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(C){const c=this.particle.getConnectedValue(C);if(this.output._storedValue=c,!this.scale.isConnected)return;const d={process:d=>{C.particleContext=d,C.systemContext=c,d.scale.V(this.scale.getConnectedValue(C))},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d}});(0,R.e)("BABYLON.UpdateAngleBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("angle",yc.Float),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(C){const c=this.particle.getConnectedValue(C);if(this.output._storedValue=c,!this.angle.isConnected)return;const d={process:d=>{C.particleContext=d,C.systemContext=c,d.angle=this.angle.getConnectedValue(C)},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d}});(0,R.e)("BABYLON.BasicPositionUpdateBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(C){const c=this.particle.getConnectedValue(C),d={process:d=>{C.particleContext=d,C.systemContext=c,d.direction.scaleToRef(c._directionScale,c._scaledDirection),d.position.addInPlace(c._scaledDirection)},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d,this.output._storedValue=c}});(0,R.e)("BABYLON.BasicSpriteUpdateBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(C){const c=this.particle.getConnectedValue(C),d={process:d=>{C.particleContext=d,C.systemContext=c,d.updateCellIndex()},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d,this.output._storedValue=c}});(0,R.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("cellIndex",yc.Int),this.registerOutput("output",yc.Particle),this.cellIndex.acceptedConnectionPointTypes=[yc.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(C){const c=this.particle.getConnectedValue(C);if(this.output._storedValue=c,!this.cellIndex.isConnected)return;const d={process:d=>{C.particleContext=d,C.systemContext=c,d.cellIndex=Math.floor(this.cellIndex.getConnectedValue(C))},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d}});class Rd extends Fc{constructor(C){super(C),this.strength=1,this.registerInput("particle",yc.Particle),this.registerInput("flowMap",yc.Texture),this.registerOutput("output",yc.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(C){var c;const d=this.particle.getConnectedValue(C),b=C.Pd;let X;(null===(c=this.flowMap.connectedPoint)||void 0===c?void 0:c.ownerBlock).extractTextureContentAsync().then((C=>{C&&(X=new Jc(C.width,C.height,C.data))}));const P={process:C=>{const c=b.getTransformMatrix();X&&X._processParticle(C,this.strength*d._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null};d._updateQueueStart?sC(P,d._updateQueueStart):d._updateQueueStart=P,this.output._storedValue=d}serialize(){const C=super.serialize();return C.strength=this.strength,C}_deserialize(C){super._deserialize(C),this.strength=C.strength}}(0,f.e)([Yc("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rd.prototype,"strength",void 0),(0,R.e)("BABYLON.UpdateFlowMapBlock",Rd);(0,R.e)("BABYLON.SphereShapeBlock",class extends Fc{constructor(C){super(C),this.registerInput("input",yc.Particle),this.registerInput("radius",yc.Float,!0,1),this.registerInput("radiusRange",yc.Float,!0,1,0,1),this.registerInput("directionRandomizer",yc.Float,!0,0,0,1),this.registerOutput("output",yc.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(C){const c=this.input.getConnectedValue(C);c._directionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.directionRandomizer.getConnectedValue(C),P=d.position.Xd(C.emitterPosition).normalize(),V=(0,j.RandomRange)(0,X),R=(0,j.RandomRange)(0,X),p=(0,j.RandomRange)(0,X);P.x+=V,P.y+=R,P.z+=p,P.normalize(),C.isEmitterTransformNode?b.dd.TransformNormalFromFloatsToRef(V,R,p,C.emitterWorldMatrix,d.direction):d.direction.yc(V,R,p)},c._positionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.radius.getConnectedValue(C),P=this.radiusRange.getConnectedValue(C),V=X-(0,j.RandomRange)(0,X*P),R=(0,j.RandomRange)(0,1),p=(0,j.RandomRange)(0,2*Math.PI),g=Math.acos(2*R-1),k=V*Math.cos(p)*Math.sin(g),Z=V*Math.cos(g),U=V*Math.sin(p)*Math.sin(g);C.isEmitterTransformNode?b.dd.TransformCoordinatesFromFloatsToRef(k,Z,U,C.emitterWorldMatrix,d.position):(d.position.yc(k,Z,U),d.position.addInPlace(C.emitterPosition))},this.output._storedValue=c}});(0,R.e)("BABYLON.PointShapeBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("direction1",yc.dd,!0,new b.dd(0,1,0)),this.registerInput("direction2",yc.dd,!0,new b.dd(0,1,0)),this.registerOutput("output",yc.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(C){const c=this.particle.getConnectedValue(C);c._directionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.direction1.getConnectedValue(C),P=this.direction2.getConnectedValue(C),V=(0,j.RandomRange)(X.x,P.x),R=(0,j.RandomRange)(X.y,P.y),p=(0,j.RandomRange)(X.z,P.z);C.isEmitterTransformNode?b.dd.TransformNormalFromFloatsToRef(V,R,p,C.emitterWorldMatrix,d.direction):d.direction.yc(V,R,p)},c._positionCreation.process=d=>{C.systemContext=c,C.isEmitterTransformNode?b.dd.TransformCoordinatesFromFloatsToRef(0,0,0,C.emitterWorldMatrix,d.position):d.position.V(C.emitterPosition)},this.output._storedValue=c}});(0,R.e)("BABYLON.CustomShapeBlock",class extends Fc{constructor(C){super(C),this.registerInput("particle",yc.Particle),this.registerInput("position",yc.dd,!0,new b.dd(0,0,0)),this.registerInput("direction",yc.dd,!0,new b.dd(0,1,0)),this.registerOutput("output",yc.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(C){const c=this.particle.getConnectedValue(C);c._directionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.direction.getConnectedValue(C);C.isEmitterTransformNode?b.dd.TransformNormalToRef(X,C.emitterWorldMatrix,d.direction):d.direction.V(X)},c._positionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.position.getConnectedValue(C);C.isEmitterTransformNode?b.dd.TransformCoordinatesToRef(X,C.emitterWorldMatrix,d.position):(d.position.V(X),d.position.addInPlace(C.emitterPosition))},this.output._storedValue=c}});(0,R.e)("BABYLON.CylinderShapeBlock",class extends Fc{constructor(C){super(C),this._tempVector=b.dd.Zero(),this.registerInput("particle",yc.Particle),this.registerInput("radius",yc.Float,!0,1),this.registerInput("height",yc.Float,!0,1,0),this.registerInput("radiusRange",yc.Float,!0,1,0,1),this.registerInput("directionRandomizer",yc.Float,!0,0,0,1),this.registerOutput("output",yc.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(C){const c=this.particle.getConnectedValue(C);c._directionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.directionRandomizer.getConnectedValue(C);d.position.subtractToRef(C.emitterPosition,this._tempVector),this._tempVector.normalize(),C.isEmitterTransformNode&&b.dd.TransformNormalToRef(this._tempVector,C.emitterInverseWorldMatrix,this._tempVector);const P=(0,j.RandomRange)(-X/2,X/2);let V=Math.atan2(this._tempVector.x,this._tempVector.z);V+=(0,j.RandomRange)(-Math.PI/2,Math.PI/2)*X,this._tempVector.y=P,this._tempVector.x=Math.sin(V),this._tempVector.z=Math.cos(V),this._tempVector.normalize(),C.isEmitterTransformNode?b.dd.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,C.emitterWorldMatrix,d.direction):d.direction.V(this._tempVector)},c._positionCreation.process=d=>{C.particleContext=d,C.systemContext=c;const X=this.height.getConnectedValue(C),P=this.radiusRange.getConnectedValue(C),V=this.radius.getConnectedValue(C),R=(0,j.RandomRange)(-X/2,X/2),p=(0,j.RandomRange)(0,2*Math.PI),g=(0,j.RandomRange)((1-P)*(1-P),1),k=Math.sqrt(g)*V,Z=k*Math.cos(p),U=k*Math.sin(p);C.isEmitterTransformNode?b.dd.TransformCoordinatesFromFloatsToRef(Z,R,U,C.emitterWorldMatrix,d.position):(d.position.yc(Z,R,U),d.position.addInPlace(C.emitterPosition))},this.output._storedValue=c}});class pd extends Fc{constructor(C){super(C),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",yc.Particle),this.registerOutput("output",yc.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){super._build(C);const c=this.particle.getConnectedValue(C);c._isAnimationSheetEnabled=!0,c.spriteCellWidth=this.width,c.spriteCellHeight=this.height,c.startSpriteCellID=this.start,c.endSpriteCellID=this.end,c.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=c}serialize(){const C=super.serialize();return C.width=this.width,C.height=this.height,C.start=this.start,C.end=this.end,C.randomStartCell=this.randomStartCell,C}_deserialize(C){super._deserialize(C),this.width=C.width,this.height=C.height,this.start=C.start,this.end=C.end,this.randomStartCell=C.randomStartCell}}(0,f.e)([Yc("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pd.prototype,"start",void 0),(0,f.e)([Yc("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pd.prototype,"end",void 0),(0,f.e)([Yc("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pd.prototype,"width",void 0),(0,f.e)([Yc("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pd.prototype,"height",void 0),(0,f.e)([Yc("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pd.prototype,"loop",void 0),(0,f.e)([Yc("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pd.prototype,"randomStartCell",void 0),(0,R.e)("BABYLON.SetupSpriteSheetBlock",pd);class jd extends Fc{constructor(C){super(C),this.reference=0,this.registerInput("value",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=C=>{switch(C){case yc.Float:return yc.FloatGradient;case yc.Vector2:return yc.Vector2Gradient;case yc.dd:return yc.Vector3Gradient;case yc.vc:return yc.Color4Gradient}return C},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yc.Float|yc.Vector2|yc.dd|yc.vc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=C=>null}serialize(){const C=super.serialize();return C.reference=this.reference,C}_deserialize(C){super._deserialize(C),this.reference=C.reference}}(0,f.e)([Yc("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],jd.prototype,"reference",void 0),(0,R.e)("BABYLON.ParticleGradientValueBlock",jd);(0,R.e)("BABYLON.ParticleGradientBlock",class extends Fc{constructor(C){super(C),this._entryCount=1,this.registerInput("gradient",yc.Float,!0,1,0,1),this.registerInput("value0",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=C=>{switch(C){case yc.FloatGradient:return yc.Float;case yc.Vector2Gradient:return yc.Vector2;case yc.Vector3Gradient:return yc.dd;case yc.Color4Gradient:return yc.vc}return C},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(yc.FloatGradient|yc.Vector2Gradient|yc.Vector3Gradient|yc.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(C){this._inputs[C].onConnectionObservable.add((()=>{this._entryCount>C||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),yc.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const C=[];for(let d=1;d<this._inputs.length;d++){var c;if(this._inputs[d].isConnected)C.push(null===(c=this._inputs[d].connectedPoint)||void 0===c?void 0:c.ownerBlock)}C.sort(((C,c)=>C.reference-c.reference)),this.output._storedFunction=c=>{const d=this.gradient.getConnectedValue(c);if(1===C.length)return C[0].value.getConnectedValue(c);let X=null;for(let P=C.length-1;P>=0;P--){const R=C[P];if(R.reference<=d){const C=R.value.getConnectedValue(c);if(X){const P=X.value.getConnectedValue(c),p=X.reference,g=R.reference,k=Math.max(0,Math.min(1,(d-g)/(p-g)));switch(this.output.type){case yc.Float:return(0,j.Lerp)(C,P,k);case yc.Vector2:return b.Vector2.Lerp(C,P,k);case yc.dd:return b.dd.Lerp(C,P,k);case yc.vc:return V.vc.Lerp(C,P,k)}}return C}X=R}return 0}}});(0,R.e)("BABYLON.ParticleConverterBlock",class extends Fc{constructor(C){super(C),this.registerInput("color ",yc.vc,!0),this.registerInput("xyz ",yc.dd,!0),this.registerInput("xy ",yc.Vector2,!0),this.registerInput("zw ",yc.Vector2,!0),this.registerInput("x ",yc.Float,!0),this.registerInput("y ",yc.Float,!0),this.registerInput("z ",yc.Float,!0),this.registerInput("w ",yc.Float,!0),this.registerOutput("color",yc.vc),this.registerOutput("xyz",yc.dd),this.registerOutput("xy",yc.Vector2),this.registerOutput("zw",yc.Vector2),this.registerOutput("x",yc.Float),this.registerOutput("y",yc.Float),this.registerOutput("z",yc.Float),this.registerOutput("w",yc.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(C){return"color "===C?"colorIn":"xyz "===C?"xyzIn":"xy "===C?"xyIn":"zw "===C?"zwIn":"x "===C?"xIn":"y "===C?"yIn":"z "===C?"zIn":"w "===C?"wIn":C}_outputRename(C){switch(C){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return C}}_build(C){super._build(C);const c=this.xIn,d=this.yIn,X=this.zIn,P=this.wIn,R=this.xyIn,p=this.zwIn,j=this.xyzIn,g=this.colorIn,k=this.colorOut,Z=this.xyzOut,U=this.xyOut,A=this.zwOut,u=this.xOut,q=this.yOut,B=this.zOut,t=this.wOut,e=C=>{if(g.isConnected)return g.getConnectedValue(C);let b=0,k=0,Z=0,U=0;if(c.isConnected&&(b=c.getConnectedValue(C)),d.isConnected&&(k=d.getConnectedValue(C)),X.isConnected&&(Z=X.getConnectedValue(C)),P.isConnected&&(U=P.getConnectedValue(C)),R.isConnected){const c=R.getConnectedValue(C);c&&(b=c.x,k=c.y)}if(p.isConnected){const c=p.getConnectedValue(C);c&&(Z=c.x,U=c.y)}if(j.isConnected){const c=j.getConnectedValue(C);c&&(b=c.x,k=c.y,Z=c.z)}return new V.vc(b,k,Z,U)};k._storedFunction=C=>e(C),Z._storedFunction=C=>{const c=e(C);return new b.dd(c.r,c.g,c.b)},U._storedFunction=C=>{const c=e(C);return new b.Vector2(c.r,c.g)},A._storedFunction=C=>{const c=e(C);return new b.Vector2(c.b,c.a)},u._storedFunction=C=>e(C).r,q._storedFunction=C=>e(C).g,B._storedFunction=C=>e(C).b,t._storedFunction=C=>e(C).a}}),function(C){C[C.Cos=0]="Cos",C[C.Sin=1]="Sin",C[C.Abs=2]="Abs",C[C.Exp=3]="Exp",C[C.Exp2=4]="Exp2",C[C.Round=5]="Round",C[C.Floor=6]="Floor",C[C.Ceiling=7]="Ceiling",C[C.Sqrt=8]="Sqrt",C[C.Log=9]="Log",C[C.Tan=10]="Tan",C[C.ArcTan=11]="ArcTan",C[C.ArcCos=12]="ArcCos",C[C.ArcSin=13]="ArcSin",C[C.Sign=14]="Sign",C[C.Negate=15]="Negate",C[C.OneMinus=16]="OneMinus",C[C.Reciprocal=17]="Reciprocal",C[C.ToDegrees=18]="ToDegrees",C[C.ToRadians=19]="ToRadians",C[C.Fract=20]="Fract"}(Ic||(Ic={}));class gd extends Fc{constructor(C){super(C),this.operation=Ic.Cos,this.registerInput("input",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yc.Float|yc.Int|yc.Vector2|yc.dd|yc.vc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){super._build(C);let c=null;switch(this.operation){case Ic.Cos:c=C=>Math.cos(C);break;case Ic.Sin:c=C=>Math.sin(C);break;case Ic.Abs:c=C=>Math.abs(C);break;case Ic.Exp:c=C=>Math.exp(C);break;case Ic.Exp2:c=C=>Math.pow(2,C);break;case Ic.Round:c=C=>Math.round(C);break;case Ic.Floor:c=C=>Math.floor(C);break;case Ic.Ceiling:c=C=>Math.ceil(C);break;case Ic.Sqrt:c=C=>Math.sqrt(C);break;case Ic.Log:c=C=>Math.log(C);break;case Ic.Tan:c=C=>Math.tan(C);break;case Ic.ArcTan:c=C=>Math.atan(C);break;case Ic.ArcCos:c=C=>Math.acos(C);break;case Ic.ArcSin:c=C=>Math.asin(C);break;case Ic.Sign:c=C=>Math.sign(C);break;case Ic.Negate:c=C=>-C;break;case Ic.OneMinus:c=C=>1-C;break;case Ic.Reciprocal:c=C=>1/C;break;case Ic.ToRadians:c=C=>C*Math.PI/180;break;case Ic.ToDegrees:c=C=>180*C/Math.PI;break;case Ic.Fract:c=C=>C>=0?C-Math.floor(C):C-Math.ceil(C)}if(!c)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case yc.Int:case yc.Float:this.output._storedFunction=C=>{const d=this.input.getConnectedValue(C);return c(d)};break;case yc.Vector2:this.output._storedFunction=C=>{const d=this.input.getConnectedValue(C);return new b.Vector2(c(d.x),c(d.y))};break;case yc.dd:this.output._storedFunction=C=>{const d=this.input.getConnectedValue(C);return new b.dd(c(d.x),c(d.y),c(d.z))};break;case yc.vc:this.output._storedFunction=C=>{const d=this.input.getConnectedValue(C);return new V.vc(c(d.r),c(d.g),c(d.b),c(d.a))}}return this}serialize(){const C=super.serialize();return C.operation=this.operation,C}_deserialize(C){super._deserialize(C),this.operation=C.operation}}(0,f.e)([Yc("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Ic.Cos},{label:"Sin",value:Ic.Sin},{label:"Abs",value:Ic.Abs},{label:"Exp",value:Ic.Exp},{label:"Exp2",value:Ic.Exp2},{label:"Round",value:Ic.Round},{label:"Floor",value:Ic.Floor},{label:"Ceiling",value:Ic.Ceiling},{label:"Sqrt",value:Ic.Sqrt},{label:"Log",value:Ic.Log},{label:"Tan",value:Ic.Tan},{label:"ArcTan",value:Ic.ArcTan},{label:"ArcCos",value:Ic.ArcCos},{label:"ArcSin",value:Ic.ArcSin},{label:"Sign",value:Ic.Sign},{label:"Negate",value:Ic.Negate},{label:"OneMinus",value:Ic.OneMinus},{label:"Reciprocal",value:Ic.Reciprocal},{label:"ToDegrees",value:Ic.ToDegrees},{label:"ToRadians",value:Ic.ToRadians},{label:"Fract",value:Ic.Fract}]})],gd.prototype,"operation",void 0),(0,R.e)("BABYLON.ParticleTrigonometryBlock",gd);var kd,Zd=d(13823);class Ud extends Fc{constructor(C){super(C),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(yc.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(yc.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(yc.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(yc.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(yc.System),this._inputs[0].excludedConnectionPointTypes.push(yc.Particle),this._inputs[0].excludedConnectionPointTypes.push(yc.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const c=C=>{const c=this.input.getConnectedValue(C);if(this.log.length>=this.stackSize)return c;if(null===c||void 0===c)return this.log.push(["null",""]),c;switch(this.input.type){case yc.Vector2:this.log.push([(0,Zd.f)(c,4),c.toString()]);break;case yc.dd:this.log.push([(0,Zd.h)(c,4),c.toString()]);break;case yc.vc:this.log.push([`{R: ${c.r.toFixed(4)} G: ${c.g.toFixed(4)} B: ${c.b.toFixed(4)} A: ${c.a.toFixed(4)}}`,c.toString()]);break;default:this.log.push([c.toString(),c.toString()])}return c};this.output.isConnected?this.output._storedFunction=c:this.output._storedValue=c(C)}serialize(){const C=super.serialize();return C.stackSize=this.stackSize,C}_deserialize(C){super._deserialize(C),this.stackSize=C.stackSize}}(0,f.e)([Yc("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Ud.prototype,"stackSize",void 0),(0,R.e)("BABYLON.ParticleDebugBlock",Ud);(0,R.e)("BABYLON.ParticleElbowBlock",class extends Fc{constructor(C){super(C),this.registerInput("input",yc.AutoDetect),this.registerOutput("output",yc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){super._build(C);const c=this._outputs[0],d=this._inputs[0];c._storedFunction=C=>d.getConnectedValue(C)}});(0,R.e)("BABYLON.ParticleTeleportInBlock",class extends Fc{get endpoints(){return this._endpoints}constructor(C){super(C),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",yc.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(C){if(this.getClassName()===C)return!0;for(const c of this.endpoints)if(c.isAnAncestorOfType(C))return!0;return!1}isAnAncestorOf(C){for(const c of this.endpoints){if(c===C)return!0;if(c.isAnAncestorOf(C))return!0}return!1}attachToEndpoint(C){C.detach(),this._endpoints.push(C),C._entryPoint=this,C._outputs[0]._typeConnectionSource=this._inputs[0],C._tempEntryPointUniqueId=null,C.name="> "+this.name}detachFromEndpoint(C){const c=this._endpoints.indexOf(C);-1!==c&&(this._endpoints.splice(c,1),C._outputs[0]._typeConnectionSource=null,C._entryPoint=null)}_build(){for(const C of this._endpoints)C.output._storedFunction=C=>this.input.getConnectedValue(C)}});(0,R.e)("BABYLON.ParticleTeleportOutBlock",class extends Fc{constructor(C){super(C),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",yc.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(C){this.entryPoint&&this.entryPoint.build(C)}clone(){const C=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(C),C}serialize(){var C;const c=super.serialize();return c.entryPoint=(null===(C=this.entryPoint)||void 0===C?void 0:C.uniqueId)??"",c}_deserialize(C){super._deserialize(C),this._tempEntryPointUniqueId=C.entryPoint}}),function(C){C[C.Equal=0]="Equal",C[C.NotEqual=1]="NotEqual",C[C.LessThan=2]="LessThan",C[C.GreaterThan=3]="GreaterThan",C[C.LessOrEqual=4]="LessOrEqual",C[C.GreaterOrEqual=5]="GreaterOrEqual",C[C.Xor=6]="Xor",C[C.Or=7]="Or",C[C.And=8]="And"}(kd||(kd={}));class Ad extends Fc{constructor(C){super(C),this.test=kd.Equal,this.epsilon=0,this.registerInput("left",yc.Float),this.registerInput("right",yc.Float,!0,0),this.registerInput("ifTrue",yc.AutoDetect,!0,1),this.registerInput("ifFalse",yc.AutoDetect,!0,0),this.registerOutput("output",yc.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=yc.Float,this._inputs[0].acceptedConnectionPointTypes.push(yc.Int),this._inputs[1].acceptedConnectionPointTypes.push(yc.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const C=C=>{const c=this.left.getConnectedValue(C),d=this.right.getConnectedValue(C);let b=!1;switch(this.test){case kd.Equal:b=(0,j.WithinEpsilon)(c,d,this.epsilon);break;case kd.NotEqual:b=!(0,j.WithinEpsilon)(c,d,this.epsilon);break;case kd.LessThan:b=c<d+this.epsilon;break;case kd.GreaterThan:b=c>d-this.epsilon;break;case kd.LessOrEqual:b=c<=d+this.epsilon;break;case kd.GreaterOrEqual:b=c>=d-this.epsilon;break;case kd.Xor:b=!!c&&!d||!c&&!!d;break;case kd.Or:b=!!c||!!d;break;case kd.And:b=!!c&&!!d}return b};this.output._storedFunction=c=>C(c)?this.ifTrue.getConnectedValue(c):this.ifFalse.getConnectedValue(c)}serialize(){const C=super.serialize();return C.test=this.test,C.epsilon=this.epsilon,C}_deserialize(C){super._deserialize(C),this.test=C.test,void 0!==C.epsilon&&(this.epsilon=C.epsilon)}}(0,f.e)([Yc("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:kd.Equal},{label:"NotEqual",value:kd.NotEqual},{label:"LessThan",value:kd.LessThan},{label:"GreaterThan",value:kd.GreaterThan},{label:"LessOrEqual",value:kd.LessOrEqual},{label:"GreaterOrEqual",value:kd.GreaterOrEqual},{label:"Xor",value:kd.Xor},{label:"Or",value:kd.Or},{label:"And",value:kd.And}]})],Ad.prototype,"test",void 0),(0,f.e)([Yc("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ad.prototype,"epsilon",void 0),(0,R.e)("BABYLON.ParticleConditionBlock",Ad);class ud extends Fc{constructor(C){super(C),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",yc.Particle),this.registerInput("condition",yc.Float,!0,0),this.registerInput("system",yc.System),this.registerOutput("output",yc.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(C){this._triggerCount=0;const c=this.input.getConnectedValue(C),d={process:d=>{if(C.particleContext=d,C.systemContext=c,0!==this.condition.getConnectedValue(C)&&(0===this.limit||this._triggerCount<this.limit)){const b=(new Date).getTime();if(this._previousOne&&b-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=b;const X=this.system.getConnectedValue(C);if(X){const b=Sc(X,C.Pd,d.position);b.Uc.addOnce((()=>{this._triggerCount--})),c.Uc.addOnce((()=>{b.dispose()}))}}},previousItem:null,nextItem:null};c._updateQueueStart?sC(d,c._updateQueueStart):c._updateQueueStart=d,this.output._storedValue=c}serialize(){const C=super.serialize();return C.limit=this.limit,C.delay=this.delay,C}_deserialize(C){super._deserialize(C),void 0!==C.limit&&(this.limit=C.limit),void 0!==C.delay&&(this.delay=C.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,f.e)([Yc("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ud.prototype,"limit",void 0),(0,f.e)([Yc("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ud.prototype,"delay",void 0),(0,R.e)("BABYLON.ParticleTriggerBlock",ud);d(13832),d(13841),d(13847),d(13900)},13887:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneFragment",P="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13856:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneFragmentDeclaration",P="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13914:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneVertex",P="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13906:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneVertexDeclaration",P="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13896:(C,c,d)=>{"use strict";var b=d(12292);const X="fogFragment",P="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13880:(C,c,d)=>{"use strict";var b=d(12292);const X="fogFragmentDeclaration",P="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13923:(C,c,d)=>{"use strict";var b=d(12292);const X="fogVertex",P="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13912:(C,c,d)=>{"use strict";var b=d(12292);const X="fogVertexDeclaration",P="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13869:(C,c,d)=>{"use strict";var b=d(12292);const X="helperFunctions",P="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13864:(C,c,d)=>{"use strict";var b=d(12292);const X="imageProcessingDeclaration",P="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13871:(C,c,d)=>{"use strict";var b=d(12292);const X="imageProcessingFunctions",P="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13866:(C,c,d)=>{"use strict";var b=d(12292);const X="logDepthDeclaration",P="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13892:(C,c,d)=>{"use strict";var b=d(12292);const X="logDepthFragment",P="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13925:(C,c,d)=>{"use strict";var b=d(12292);const X="logDepthVertex",P="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";b.e.IncludesShadersStoreWGSL[X]||(b.e.IncludesShadersStoreWGSL[X]=P)},13847:(C,c,d)=>{"use strict";d.r(c),d.d(c,{particlesPixelShaderWGSL:()=>V});var b=d(12292);d(13856),d(13864),d(13866),d(13869),d(13871),d(13880),d(13887),d(13892),d(13896);const X="particlesPixelShader",P="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";b.e.ShadersStoreWGSL[X]||(b.e.ShadersStoreWGSL[X]=P);const V={name:X,shader:P}},13900:(C,c,d)=>{"use strict";d.r(c),d.d(c,{particlesVertexShaderWGSL:()=>V});var b=d(12292);d(13906),d(13912),d(13866),d(13914),d(13923),d(13925);const X="particlesVertexShader",P="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";b.e.ShadersStoreWGSL[X]||(b.e.ShadersStoreWGSL[X]=P);const V={name:X,shader:P}},13754:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneFragment",P="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13839:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneFragmentDeclaration",P="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13778:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneVertex",P="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13843:(C,c,d)=>{"use strict";var b=d(12292);const X="clipPlaneVertexDeclaration",P="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13765:(C,c,d)=>{"use strict";var b=d(12292);const X="fogFragment",P="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13748:(C,c,d)=>{"use strict";var b=d(12292);const X="fogFragmentDeclaration",P="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13786:(C,c,d)=>{"use strict";var b=d(12292);const X="fogVertex",P="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13770:(C,c,d)=>{"use strict";var b=d(12292);const X="fogVertexDeclaration",P="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13735:(C,c,d)=>{"use strict";var b=d(12292);const X="helperFunctions",P="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13727:(C,c,d)=>{"use strict";var b=d(12292);const X="imageProcessingDeclaration",P="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13742:(C,c,d)=>{"use strict";var b=d(12292);const X="imageProcessingFunctions",P="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13731:(C,c,d)=>{"use strict";var b=d(12292);const X="logDepthDeclaration",P="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13762:(C,c,d)=>{"use strict";var b=d(12292);const X="logDepthFragment",P="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13789:(C,c,d)=>{"use strict";var b=d(12292);const X="logDepthVertex",P="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";b.e.IncludesShadersStore[X]||(b.e.IncludesShadersStore[X]=P)},13832:(C,c,d)=>{"use strict";d.r(c),d.d(c,{particlesPixelShader:()=>V});var b=d(12292);d(13839),d(13727),d(13731),d(13735),d(13742),d(13748),d(13754),d(13762),d(13765);const X="particlesPixelShader",P="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";b.e.ShadersStore[X]||(b.e.ShadersStore[X]=P);const V={name:X,shader:P}},13841:(C,c,d)=>{"use strict";d.r(c),d.d(c,{particlesVertexShader:()=>V});var b=d(12292);d(13843),d(13770),d(13731),d(13778),d(13786),d(13789);const X="particlesVertexShader",P="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";b.e.ShadersStore[X]||(b.e.ShadersStore[X]=P);const V={name:X,shader:P}},14191:(C,c,d)=>{"use strict";d.r(c),d.d(c,{FlowGraphGLTFDataProvider:()=>P});var b=d(14158),X=d(14126);class P extends b.e{constructor(C){var c,d;super();const b=C.glTF,P=(null===(c=b.animations)||void 0===c?void 0:c.map((C=>C._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",X.b,P);const V=(null===(d=b.nodes)||void 0===d?void 0:d.map((C=>C._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",X.b,V)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14067:(C,c,d)=>{"use strict";d.d(c,{d:()=>q,g:()=>A,k:()=>U,m:()=>u});var b=d(12403),X=d(12886),P=d(12438),V=d(14073);const R=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class p{constructor(C,c){this._gltf=C,this._infoTree=c}convert(C){let c,d=this._gltf,b=this._infoTree;if(!C.startsWith("/"))throw new Error("Path must start with a /");const X=C.split("/");if(X.shift(),X[X.length-1].includes(".length")){const C=X[X.length-1].split(".");X.pop(),X.push(...C)}let P=!1;for(const p of X){const X="length"===p;if(X&&!b.__array__)throw new Error(`Path ${C} is invalid`);if(b.__ignoreObjectTree__&&(P=!0),b.__array__&&!X)b=b.__array__;else if(b=b[p],!b)throw new Error(`Path ${C} is invalid`);if(!P)if(void 0===d){if(!R.find((c=>c.regex.test(C))))throw new Error(`Path ${C} is invalid`)}else if(!X){var V;d=null===(V=d)||void 0===V?void 0:V[p]}(b.__target__||X)&&(c=d)}return{object:c,info:b}}}function j(C,c,d,b){const X=g(C,c);return b?X[d][b]:X[d]}function g(C,c,d){var b,P;return null===(b=C._data)||void 0===b||null===(P=b[(null===d||void 0===d?void 0:d.fillMode)??X.d.MATERIAL_TriangleFillMode])||void 0===P?void 0:P.babylonMaterial}function k(C,c){return{offset:{componentsCount:2,type:"Vector2",get:(d,X,P)=>{const V=j(d,P,C,c);return new b.Vector2(null===V||void 0===V?void 0:V.uOffset,null===V||void 0===V?void 0:V.vOffset)},getTarget:g,set:(d,b,X,P)=>{const V=j(b,P,C,c);V.uOffset=d.x,V.vOffset=d.y},getPropertyName:[()=>`${C}${c?"."+c:""}.uOffset`,()=>`${C}${c?"."+c:""}.vOffset`]},rotation:{type:"number",get:(d,b,X)=>{var P;return null===(P=j(d,X,C,c))||void 0===P?void 0:P.wAng},getTarget:g,set:(d,b,X,P)=>j(b,P,C,c).wAng=d,getPropertyName:[()=>`${C}${c?"."+c:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(d,X,P)=>{const V=j(d,P,C,c);return new b.Vector2(null===V||void 0===V?void 0:V.uScale,null===V||void 0===V?void 0:V.vScale)},getTarget:g,set:(d,b,X,P)=>{const V=j(b,P,C,c);V.uScale=d.x,V.vScale=d.y},getPropertyName:[()=>`${C}${c?"."+c:""}.uScale`,()=>`${C}${c?"."+c:""}.vScale`]}}}const Z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:C=>{var c,d;return new b.Vector2((null===(c=C._babylonCamera)||void 0===c?void 0:c.orthoLeft)??0,(null===(d=C._babylonCamera)||void 0===d?void 0:d.orthoRight)??0)},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.orthoLeft=C.x,c._babylonCamera.orthoRight=C.y)},getTarget:C=>C,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:C=>{var c,d;return new b.Vector2((null===(c=C._babylonCamera)||void 0===c?void 0:c.orthoBottom)??0,(null===(d=C._babylonCamera)||void 0===d?void 0:d.orthoTop)??0)},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.orthoBottom=C.x,c._babylonCamera.orthoTop=C.y)},getTarget:C=>C,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:C=>{var c;return null===(c=C._babylonCamera)||void 0===c?void 0:c.maxZ},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=C)},getTarget:C=>C,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:C=>{var c;return null===(c=C._babylonCamera)||void 0===c?void 0:c.Lc},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.Lc=C)},getTarget:C=>C,getPropertyName:[()=>"Lc"]}},perspective:{aspectRatio:{type:"number",get:C=>{var c;return null===(c=C._babylonCamera)||void 0===c?void 0:c.getEngine().getAspectRatio(C._babylonCamera)},getTarget:C=>C,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:C=>{var c;return null===(c=C._babylonCamera)||void 0===c?void 0:c.fov},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.fov=C)},getTarget:C=>C,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:C=>{var c;return null===(c=C._babylonCamera)||void 0===c?void 0:c.maxZ},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=C)},getTarget:C=>C,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:C=>{var c;return null===(c=C._babylonCamera)||void 0===c?void 0:c.Lc},set:(C,c)=>{c._babylonCamera&&(c._babylonCamera.Lc=C)},getTarget:C=>C,getPropertyName:[()=>"Lc"]}}}},nodes:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"dd",get:C=>{var c;return null===(c=C._babylonTransformNode)||void 0===c?void 0:c.position},set:(C,c)=>{var d;return null===(d=c._babylonTransformNode)||void 0===d?void 0:d.position.V(C)},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:C=>{var c;return null===(c=C._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion},set:(C,c)=>{var d,b;return null===(d=c._babylonTransformNode)||void 0===d||null===(b=d.rotationQuaternion)||void 0===b?void 0:b.V(C)},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"dd",get:C=>{var c;return null===(c=C._babylonTransformNode)||void 0===c?void 0:c.xc},set:(C,c)=>{var d;return null===(d=c._babylonTransformNode)||void 0===d?void 0:d.xc.V(C)},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"xc"]},weights:{length:{type:"number",get:C=>C._numMorphTargets,getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(C,c)=>{var d,b;return void 0!==c?null===(d=C._primitiveBabylonMeshes)||void 0===d||null===(b=d[0].morphTargetManager)||void 0===b?void 0:b.getTarget(c).influence:void 0},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(C,c)=>[0],getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:C=>{var c,d,X;return b.Matrix.Compose(null===(c=C._babylonTransformNode)||void 0===c?void 0:c.xc,null===(d=C._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion,null===(X=C._babylonTransformNode)||void 0===X?void 0:X.position)},getTarget:C=>C._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:C=>{var c,d,X,P;const V=b.Matrix.Identity();let R=C.parent;for(;R&&R.parent;)R=R.parent;const p=(null===(c=C._babylonTransformNode)||void 0===c?void 0:c.position._isDirty)||(null===(d=C._babylonTransformNode)||void 0===d||null===(X=d.rotationQuaternion)||void 0===X?void 0:X._isDirty)||(null===(P=C._babylonTransformNode)||void 0===P?void 0:P.xc._isDirty);if(R){var j;const c=null===(j=R._babylonTransformNode)||void 0===j?void 0:j.Tc(!0).invert();var g,k;if(c)null===(g=C._babylonTransformNode)||void 0===g||null===(k=g.Tc(p))||void 0===k||k.multiplyToRef(c,V)}else C._babylonTransformNode&&V.V(C._babylonTransformNode.Tc(p));return V},getTarget:C=>C._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:C=>{var c,d;return null===(c=C._babylonTransformNode)||void 0===c||null===(d=c.getChildren((C=>C instanceof V.b),!0)[0])||void 0===d?void 0:d.Qc},getTarget:C=>{var c;return null===(c=C._babylonTransformNode)||void 0===c?void 0:c.getChildren((C=>C instanceof V.b),!0)[0]},set:(C,c)=>{if(c._babylonTransformNode){const d=c._babylonTransformNode.getChildren((C=>C instanceof V.b),!0)[0];d&&(d.Qc=C)}}},color:{type:"pd",get:C=>{var c,d;return null===(c=C._babylonTransformNode)||void 0===c||null===(d=c.getChildren((C=>C instanceof V.b),!0)[0])||void 0===d?void 0:d.Ic},getTarget:C=>{var c;return null===(c=C._babylonTransformNode)||void 0===c?void 0:c.getChildren((C=>C instanceof V.b),!0)[0]},set:(C,c)=>{if(c._babylonTransformNode){const d=c._babylonTransformNode.getChildren((C=>C instanceof V.b),!0)[0];d&&(d.Ic=C)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"pd",get:(C,c,d)=>g(C,c,d).emissiveColor,set:(C,c,d,b)=>g(c,d,b).emissiveColor.V(C),getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:k("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(C,c,d)=>{var b;return null===(b=j(C,d,"bumpTexture"))||void 0===b?void 0:b.level},set:(C,c,d,b)=>{const X=j(c,b,"bumpTexture");X&&(X.level=C)},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:k("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(C,c,d)=>g(C,c,d).ambientTextureStrength,set:(C,c,d,b)=>{const X=g(c,d,b);X&&(X.ambientTextureStrength=C)},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:k("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"vc",get:(C,c,d)=>{const b=g(C,c,d);return P.vc.FromColor3(b.albedoColor,b.alpha)},set:(C,c,d,b)=>{const X=g(c,d,b);X.albedoColor.set(C.r,C.g,C.b),X.alpha=C.a},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:k("albedoTexture")}},metallicFactor:{type:"number",get:(C,c,d)=>g(C,c,d).metallic,set:(C,c,d,b)=>{const X=g(c,d,b);X&&(X.metallic=C)},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(C,c,d)=>g(C,c,d).roughness,set:(C,c,d,b)=>{const X=g(c,d,b);X&&(X.roughness=C)},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:k("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(C,c,d)=>g(C,c,d).anisotropy.Qc,set:(C,c,d,b)=>{g(c,d,b).anisotropy.Qc=C},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(C,c,d)=>g(C,c,d).anisotropy.angle,set:(C,c,d,b)=>{g(c,d,b).anisotropy.angle=C},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:k("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(C,c,d)=>g(C,c,d).clearCoat.Qc,set:(C,c,d,b)=>{g(c,d,b).clearCoat.Qc=C},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(C,c,d)=>g(C,c,d).clearCoat.roughness,set:(C,c,d,b)=>{g(c,d,b).clearCoat.roughness=C},getTarget:(C,c,d)=>g(C,c,d),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:k("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(C,c,d)=>{var b;return null===(b=g(C,c,d).clearCoat.bumpTexture)||void 0===b?void 0:b.level},getTarget:g,set:(C,c,d,b)=>g(c,d,b).clearCoat.bumpTexture.level=C},extensions:{KHR_texture_transform:k("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:k("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(C,c,d)=>g(C,c,d).subSurface.dispersion,getTarget:g,set:(C,c,d,b)=>g(c,d,b).subSurface.dispersion=C}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(C,c,d)=>g(C,c,d).emissiveIntensity,getTarget:g,set:(C,c,d,b)=>g(c,d,b).emissiveIntensity=C}},KHR_materials_ior:{ior:{type:"number",get:(C,c,d)=>g(C,c,d).indexOfRefraction,getTarget:g,set:(C,c,d,b)=>g(c,d,b).indexOfRefraction=C}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(C,c,d)=>g(C,c,d).iridescence.Qc,getTarget:g,set:(C,c,d,b)=>g(c,d,b).iridescence.Qc=C},iridescenceIor:{type:"number",get:(C,c,d)=>g(C,c,d).iridescence.indexOfRefraction,getTarget:g,set:(C,c,d,b)=>g(c,d,b).iridescence.indexOfRefraction=C},iridescenceTexture:{extensions:{KHR_texture_transform:k("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(C,c,d)=>g(C,c,d).iridescence.maximumThickness,getTarget:g,set:(C,c,d,b)=>g(c,d,b).iridescence.maximumThickness=C},iridescenceThicknessMinimum:{type:"number",get:(C,c,d)=>g(C,c,d).iridescence.minimumThickness,getTarget:g,set:(C,c,d,b)=>g(c,d,b).iridescence.minimumThickness=C},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:k("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"pd",get:(C,c,d)=>g(C,c,d).sheen.color,getTarget:g,set:(C,c,d,b)=>g(c,d,b).sheen.color.V(C)},sheenColorTexture:{extensions:{KHR_texture_transform:k("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(C,c,d)=>g(C,c,d).sheen.Qc,getTarget:g,set:(C,c,d,b)=>g(c,d,b).sheen.Qc=C},sheenRoughnessTexture:{extensions:{KHR_texture_transform:k("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(C,c,d)=>g(C,c,d).metallicF0Factor,getTarget:g,set:(C,c,d,b)=>g(c,d,b).metallicF0Factor=C,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"pd",get:(C,c,d)=>g(C,c,d).metallicReflectanceColor,getTarget:g,set:(C,c,d,b)=>g(c,d,b).metallicReflectanceColor.V(C),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:k("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:k("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(C,c,d)=>g(C,c,d).subSurface.refractionIntensity,getTarget:g,set:(C,c,d,b)=>g(c,d,b).subSurface.refractionIntensity=C,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:k("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(C,c,d)=>g(C,c,d).subSurface.translucencyIntensity,getTarget:g,set:(C,c,d,b)=>g(c,d,b).subSurface.translucencyIntensity=C},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:k("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"pd",get:(C,c,d)=>g(C,c,d).subSurface.translucencyColor,getTarget:g,set:(C,c,d,b)=>{var X;return C&&(null===(X=g(c,d,b).subSurface.translucencyColor)||void 0===X?void 0:X.V(C))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:k("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"pd",get:(C,c,d)=>g(C,c,d).subSurface.tintColor,getTarget:g,set:(C,c,d,b)=>g(c,d,b).subSurface.tintColor.V(C)},attenuationDistance:{type:"number",get:(C,c,d)=>g(C,c,d).subSurface.tintColorAtDistance,getTarget:g,set:(C,c,d,b)=>g(c,d,b).subSurface.tintColorAtDistance=C},thicknessFactor:{type:"number",get:(C,c,d)=>g(C,c,d).subSurface.maximumThickness,getTarget:g,set:(C,c,d,b)=>g(c,d,b).subSurface.maximumThickness=C},thicknessTexture:{extensions:{KHR_texture_transform:k("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonLight)),getPropertyName:[C=>"length"]},__array__:{__target__:!0,color:{type:"pd",get:C=>{var c;return null===(c=C._babylonLight)||void 0===c?void 0:c.Ic},set:(C,c)=>{var d;return null===(d=c._babylonLight)||void 0===d?void 0:d.Ic.V(C)},getTarget:C=>C._babylonLight,getPropertyName:[C=>"diffuse"]},Qc:{type:"number",get:C=>{var c;return null===(c=C._babylonLight)||void 0===c?void 0:c.Qc},set:(C,c)=>c._babylonLight?c._babylonLight.Qc=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"intensity"]},range:{type:"number",get:C=>{var c;return null===(c=C._babylonLight)||void 0===c?void 0:c.range},set:(C,c)=>c._babylonLight?c._babylonLight.range=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"range"]},spot:{innerConeAngle:{type:"number",get:C=>{var c;return null===(c=C._babylonLight)||void 0===c?void 0:c.innerAngle},set:(C,c)=>c._babylonLight?c._babylonLight.innerAngle=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"innerConeAngle"]},outerConeAngle:{type:"number",get:C=>{var c;return null===(c=C._babylonLight)||void 0===c?void 0:c.angle},set:(C,c)=>c._babylonLight?c._babylonLight.angle=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonLight)),getPropertyName:[C=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonTexture)),getPropertyName:[C=>"length"]},__array__:{__target__:!0,Qc:{type:"number",get:C=>{var c;return null===(c=C._babylonTexture)||void 0===c?void 0:c.level},set:(C,c)=>{c._babylonTexture&&(c._babylonTexture.level=C)},getTarget:C=>C._babylonTexture},rotation:{type:"Quaternion",get:C=>{var c;return C._babylonTexture&&b.Quaternion.FromRotationMatrix(null===(c=C._babylonTexture)||void 0===c?void 0:c.getReflectionTextureMatrix())},set:(C,c)=>{var d;c._babylonTexture&&(null!==(d=c._babylonTexture.NC())&&void 0!==d&&d.useRightHandedSystem||(C=b.Quaternion.Inverse(C)),b.Matrix.FromQuaternionToRef(C,c._babylonTexture.getReflectionTextureMatrix()))},getTarget:C=>C._babylonTexture}}}}},animations:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>{var c;return null===(c=C.primitives[0]._instanceData)||void 0===c?void 0:c.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function U(C){return new p(C,Z)}function A(C){const c=C.split("/").map((C=>C.replace(/{}/g,"__array__")));let d=Z;for(const b of c)b&&(d=d[b]);if(d&&d.type&&d.get)return d}function u(C,c){const d=C.split("/").map((C=>C.replace(/{}/g,"__array__")));let b=Z;for(const X of d)X&&(b=b[X]);b&&b.type&&b.get&&(b.interpolation=c)}function q(C,c){const d=C.split("/").map((C=>C.replace(/{}/g,"__array__")));let b=Z;for(const X of d)if(X){if(!b[X]){if("?"===X){b.__ignoreObjectTree__=!0;continue}b[X]={},"__array__"===X&&(b[X].__target__=!0)}b=b[X]}Object.assign(b,c)}},14082:(C,c,d)=>{"use strict";d.r(c),d.d(c,{AnimationPropertyInfo:()=>j,TransformNodeAnimationPropertyInfo:()=>g,WeightAnimationPropertyInfo:()=>k,getQuaternion:()=>R,getVector3:()=>V,getWeights:()=>p});var b=d(12924),X=d(12403),P=d(14067);function V(C,c,d,b){return X.dd.jd(c,d).scaleInPlace(b)}function R(C,c,d,b){return X.Quaternion.jd(c,d).scaleInPlace(b)}function p(C,c,d,b){const X=new Array(C._numMorphTargets);for(let P=0;P<X.length;P++)X[P]=c[d++]*b;return X}class j{constructor(C,c,d,b){this.type=C,this.name=c,this.getValue=d,this.getStride=b}_buildAnimation(C,c,d){const X=new b.b(C,this.name,c,this.type);return X.setKeys(d),X}}class g extends j{buildAnimations(C,c,d,b){const X=[];return X.push({babylonAnimatable:C._babylonTransformNode,babylonAnimation:this._buildAnimation(c,d,b)}),X}}class k extends j{buildAnimations(C,c,d,X){const P=[];if(C._numMorphTargets)for(let V=0;V<C._numMorphTargets;V++){const R=new b.b(`${c}_${V}`,this.name,d,this.type);if(R.setKeys(X.map((C=>({frame:C.frame,inTangent:C.inTangent?C.inTangent[V]:void 0,value:C.value[V],outTangent:C.outTangent?C.outTangent[V]:void 0,interpolation:C.interpolation})))),C._primitiveBabylonMeshes)for(const c of C._primitiveBabylonMeshes)if(c.morphTargetManager){const C=c.morphTargetManager.getTarget(V),d=R.clone();C.animations.push(d),P.push({babylonAnimatable:C,babylonAnimation:d})}}return P}}(0,P.m)("/nodes/{}/translation",[new g(b.b.ANIMATIONTYPE_VECTOR3,"position",V,(()=>3))]),(0,P.m)("/nodes/{}/rotation",[new g(b.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",R,(()=>4))]),(0,P.m)("/nodes/{}/scale",[new g(b.b.ANIMATIONTYPE_VECTOR3,"xc",V,(()=>3))]),(0,P.m)("/nodes/{}/weights",[new k(b.b.ANIMATIONTYPE_FLOAT,"influence",p,(C=>C._numMorphTargets))])},14031:(C,c,d)=>{"use strict";class b{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((C,c)=>{this._resolve=C,this._reject=c}))}}var X=d(12403),P=d(12438),V=d(12219),R=d(12857),p=d(14040),j=d(14056),g=d(12221),k=d(12883),Z=d(12924),U=d(12932),A=d(12255),u=d(12233),q=d(12235);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(C){this._useTextureToStoreBoneMatrices=C,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(C){this._animationPropertiesOverride=C}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(C,c,d){this.name=C,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=X.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new g.b,this.bones=[],this._scene=d||A.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const b=this._scene.getEngine().getCaps();this._canUseTextureForBones=b.textureFloat&&b.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((C=>!C.getParent()))}getTransformMatrices(C){if(this.needInitialSkinMatrix){if(!C)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return C._bonesTransformMatrices||this.prepare(!0),C._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(C){return this.needInitialSkinMatrix&&C._transformMatrixTexture?C._transformMatrixTexture:this._transformMatrixTexture}NC(){return this._scene}toString(C){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,C){c+=", Ranges: {";let C=!0;for(const d in this._ranges)C&&(c+=", ",C=!1),c+=d;c+="}"}return c}getBoneIndexByName(C){for(let c=0,d=this.bones.length;c<d;c++)if(this.bones[c].name===C)return c;return-1}createAnimationRange(C,c,d){if(!this._ranges[C]){this._ranges[C]=new U.b(C,c,d);for(let b=0,X=this.bones.length;b<X;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].createRange(C,c,d)}}deleteAnimationRange(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let d=0,b=this.bones.length;d<b;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].deleteRange(C,c);this._ranges[C]=null}getAnimationRange(C){return this._ranges[C]||null}getAnimationRanges(){const C=[];let c;for(c in this._ranges)C.push(this._ranges[c]);return C}copyAnimationRange(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!C.getAnimationRange(c))return!1;let b=!0;const X=this._getHighestAnimationFrame()+1,P={},V=C.bones;let R,p;for(p=0,R=V.length;p<R;p++)P[V[p].name]=V[p];this.bones.length!==V.length&&(u.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${V.length}`),b=!1);const j=d&&this.dimensionsAtRest&&C.dimensionsAtRest?this.dimensionsAtRest.divide(C.dimensionsAtRest):null;for(p=0,R=this.bones.length;p<R;p++){const C=this.bones[p].name,V=P[C];V?b=b&&this.bones[p].copyAnimationRange(V,c,X,d,j):(u.d.Warn("copyAnimationRange: not same rig, missing source bone "+C),b=!1)}const g=C.getAnimationRange(c);return g&&(this._ranges[c]=new U.b(c,g.from+X,g.to+X)),b}returnToRest(){for(const C of this.bones)-1!==C._index&&C.returnToRest()}_getHighestAnimationFrame(){let C=0;for(let c=0,d=this.bones.length;c<d;c++)if(this.bones[c].animations[0]){const d=this.bones[c].animations[0].getHighestFrame();C<d&&(C=d)}return C}beginAnimation(C,c,d,b){const X=this.getAnimationRange(C);return X?this._scene.beginAnimation(this,X.from,X.to,c,d,b):null}static MakeAnimationAdditive(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;const b=C.getAnimationRange(d);if(!b)return null;const X=C._scene.getAllAnimatablesByTarget(C);let P=null;for(let R=0;R<X.length;R++){const C=X[R];if(C.fromFrame===(null===b||void 0===b?void 0:b.from)&&C.toFrame===(null===b||void 0===b?void 0:b.to)){P=C;break}}const V=C.getAnimatables();for(let R=0;R<V.length;R++){const C=V[R].animations;if(C)for(let b=0;b<C.length;b++)Z.b.MakeAnimationAdditive(C[b],c,d)}return P&&(P.isAdditive=!0),C}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(C){this._meshesWithPoseMatrix.push(C)}_unregisterMeshWithPoseMatrix(C){const c=this._meshesWithPoseMatrix.indexOf(C);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(C,c){this.onBeforeComputeObservable.notifyObservers(this);for(let d=0;d<this.bones.length;d++){const b=this.bones[d];b._childUpdateId++;const X=b.getParent();if(X?b.getLocalMatrix().multiplyToRef(X.getFinalMatrix(),b.getFinalMatrix()):c?b.getLocalMatrix().multiplyToRef(c,b.getFinalMatrix()):b.getFinalMatrix().V(b.getLocalMatrix()),-1!==b._index){const c=null===b._index?d:b._index;b.getAbsoluteInverseBindMatrix().multiplyToArray(b.getFinalMatrix(),C,16*c)}}this._identity.copyToArray(C,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const C=this.NC().getRenderId();if(this._currentRenderId===C)return;this._currentRenderId=C}if(this._numBonesWithLinkedTransformNode>0)for(const C of this.bones)if(C._linkedTransformNode){const c=C._linkedTransformNode;C.position=c.position,c.rotationQuaternion?C.rotationQuaternion=c.rotationQuaternion:C.rotation=c.rotation,C.xc=c.xc}if(this.needInitialSkinMatrix)for(const C of this._meshesWithPoseMatrix){const c=C.getPoseMatrix();let d=this._isDirty;if(C._bonesTransformMatrices&&C._bonesTransformMatrices.length===16*(this.bones.length+1)||(C._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),d=!0),d){if(this._synchronizedWithMesh!==C){this._synchronizedWithMesh=C;for(const C of this.bones)if(!C.getParent()){C.getBindMatrix().multiplyToRef(c,X.TmpVectors.Matrix[1]),C._updateAbsoluteBindMatrices(X.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);C._transformMatrixTexture&&C._transformMatrixTexture.getSize().width===c||(C._transformMatrixTexture&&C._transformMatrixTexture.dispose(),C._transformMatrixTexture=k.e.CreateRGBATexture(C._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(C._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&C._transformMatrixTexture&&C._transformMatrixTexture.update(C._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=k.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let C=0;C<this.bones.length;C++)this._animatables.push(this.bones[C])}return this._animatables}clone(C,c){const d=new B(C,c||C,this._scene);d.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){const C=this.bones[b];let c=null;const X=C.getParent();if(X){const C=this.bones.indexOf(X);c=d.bones[C]}const P=new j.c(C.name,d,c,C.getBindMatrix().clone(),C.getRestMatrix().clone());P._index=C._index,C._linkedTransformNode&&P.linkTransformNode(C._linkedTransformNode),q.d.DeepCopy(C.animations,P.animations)}if(this._ranges){d._ranges={};for(const C in this._ranges){const c=this._ranges[C];c&&(d._ranges[C]=c.clone())}}return this._isDirty=!0,d.prepare(!0),d}enableBlending(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const c of this.bones)for(const d of c.animations)d.enableBlending=!0,d.blendingSpeed=C}dispose(){if(this._meshesWithPoseMatrix.length=0,this.NC().stopAnimation(this),this.NC().removeSkeleton(this),this._parentContainer){const C=this._parentContainer.skeletons.indexOf(this);C>-1&&this._parentContainer.skeletons.splice(C,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const C={};C.name=this.name,C.id=this.id,this.dimensionsAtRest&&(C.dimensionsAtRest=this.dimensionsAtRest.rc()),C.bones=[],C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let d=0;d<this.bones.length;d++){var c;const b=this.bones[d],X=b.getParent(),P={parentBoneIndex:X?this.bones.indexOf(X):-1,index:b.getIndex(),name:b.name,id:b.id,matrix:b.getBindMatrix().rc(),rest:b.getRestMatrix().rc(),linkedTransformNodeId:null===(c=b.getTransformNode())||void 0===c?void 0:c.id};C.bones.push(P),b.length&&(P.length=b.length),b.metadata&&(P.metadata=b.metadata),b.animations&&b.animations.length>0&&(P.animation=b.animations[0].serialize()),C.ranges=[];for(const c in this._ranges){const d=this._ranges[c];if(!d)continue;const b={};b.name=c,b.from=d.from,b.to=d.to,C.ranges.push(b)}}return C}static Parse(C,c){const d=new B(C.name,C.id,c);let b;for(C.dimensionsAtRest&&(d.dimensionsAtRest=X.dd.jd(C.dimensionsAtRest)),d.needInitialSkinMatrix=C.needInitialSkinMatrix,b=0;b<C.bones.length;b++){const c=C.bones[b],P=C.bones[b].index;let V=null;c.parentBoneIndex>-1&&(V=d.bones[c.parentBoneIndex]);const R=c.rest?X.Matrix.jd(c.rest):null,p=new j.c(c.name,d,V,X.Matrix.jd(c.matrix),R,null,P);void 0!==c.id&&null!==c.id&&(p.id=c.id),c.length&&(p.length=c.length),c.metadata&&(p.metadata=c.metadata),c.animation&&p.animations.push(Z.b.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(d._hasWaitingData=!0,p._waitingTransformNodeId=c.linkedTransformNodeId)}if(C.ranges)for(b=0;b<C.ranges.length;b++){const c=C.ranges[b];d.createAnimationRange(c.name,c.from,c.to)}return d}computeAbsoluteMatrices(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||C)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(C)}getPoseMatrix(){let C=null;return this._meshesWithPoseMatrix.length>0&&(C=this._meshesWithPoseMatrix[0].getPoseMatrix()),C}sortBones(){const C=[],c=new Array(this.bones.length);for(let d=0;d<this.bones.length;d++)this._sortBones(d,C,c);this.bones=C}_sortBones(C,c,d){if(d[C])return;d[C]=!0;const b=this.bones[C];if(!b)return;void 0===b._index&&(b._index=C);const X=b.getParent();X&&this._sortBones(this.bones.indexOf(X),c,d),c.push(b)}setCurrentPoseAsRest(){for(const C of this.bones)C.setCurrentPoseAsRest()}}var t=d(12714),e=d(12893),n=d(12375),W=d(12807),E=d(12471),N=d(12864),r=d(12821),M=d(12848),K=d(12935),i=d(12496),h=d(13991);class L{set areUpdatesFrozen(C){C?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,C||(C=A.c.LastCreatedScene),this._scene=C,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const C=this._scene.getEngine().getCaps();this._canUseTextureForTargets=C.canUseGLVertexID&&C.textureFloat&&C.maxVertexTextureImageUnits>0&&C.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return L.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?L.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(C){this._numMaxInfluencers!==C&&(this._numMaxInfluencers=C,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(C){this._useTextureToStoreTargets!==C&&(this._useTextureToStoreTargets=C,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var C;return L.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(C=this._scene)&&void 0!==C&&C.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(C){return this._activeTargets.data[C]}getTarget(C){return this._targets[C]}getTargetByName(C){for(const c of this._targets)if(c.name===C)return c;return null}addTarget(C){this._targets.push(C),this._targetInfluenceChangedObservers.push(C.onInfluenceChanged.add((C=>{this.areUpdatesFrozen&&C&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(C)}))),this._targetDataLayoutChangedObservers.push(C._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(C){const c=this._targets.indexOf(C);c>=0&&(this._targets.splice(c,1),C.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),C._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(C)}_bind(C){C.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),C.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),C.setTexture("morphTargets",this._targetStoreTexture),C.setInt("morphTargetCount",this.numInfluencers)}clone(){const C=new L(this._scene);for(const c of this._targets)C.addTarget(c.clone());return C.enablePositionMorphing=this.enablePositionMorphing,C.enableNormalMorphing=this.enableNormalMorphing,C.enableTangentMorphing=this.enableTangentMorphing,C.enableUVMorphing=this.enableUVMorphing,C.enableUV2Morphing=this.enableUV2Morphing,C.enableColorMorphing=this.enableColorMorphing,C}serialize(){const C={};C.id=this.uniqueId,C.targets=[];for(const c of this._targets)C.targets.push(c.serialize());return C}_syncActiveTargets(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const c=!!this._targetStoreTexture,d=this.isUsingTextureForTargets;(this._mustSynchronize||c!==d)&&(this._mustSynchronize=!1,this.synchronize());let b=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let X=-1;for(const P of this._targets)if(X++,0!==P.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=L.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(P),this._morphTargetTextureIndices[b]=X,this._tempInfluences[b++]=P.influence}this._morphTargetTextureIndices.length!==b&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,b)),this._influences&&this._influences.length===b||(this._influences=new Float32Array(b));for(let P=0;P<b;P++)this._influences[P]=this._tempInfluences[P];if(C&&this._scene)for(const P of this._scene.meshes)P.morphTargetManager===this&&(d?P._markSubMeshesAsAttributesDirty():P._syncGeometryWithMorphTargetManager())}synchronize(){var C;if(!this._scene||this.areUpdatesFrozen)return;const c=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(C=this._targetStoreTexture)||void 0===C||C.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>c.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const d of this._targets){this._supportsPositions=this._supportsPositions&&d.hasPositions,this._supportsNormals=this._supportsNormals&&d.hasNormals,this._supportsTangents=this._supportsTangents&&d.hasTangents,this._supportsUVs=this._supportsUVs&&d.hasUVs,this._supportsUV2s=this._supportsUV2s&&d.hasUV2s,this._supportsColors=this._supportsColors&&d.hasColors;const C=d.vertexCount;if(0===this._vertexCount)this._vertexCount=C;else if(this._vertexCount!==C)return void u.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${d.name}": ${C}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const C=c.getCaps().maxTextureSize;this._textureWidth>C&&(this._textureHeight=Math.ceil(this._textureWidth/C),this._textureWidth=C);const d=this._targets.length,b=new Float32Array(d*this._textureWidth*this._textureHeight*4);let X=0;for(let c=0;c<d;c++){const C=this._targets[c],d=C.getPositions(),P=C.getNormals(),V=C.getUVs(),R=C.getTangents(),p=C.getUV2s(),j=C.getColors();X=c*this._textureWidth*this._textureHeight*4;for(let c=0;c<this._vertexCount;c++)this._supportsPositions&&d&&(b[X]=d[3*c],b[X+1]=d[3*c+1],b[X+2]=d[3*c+2],X+=4),this._supportsNormals&&P&&(b[X]=P[3*c],b[X+1]=P[3*c+1],b[X+2]=P[3*c+2],X+=4),this._supportsUVs&&V&&(b[X]=V[2*c],b[X+1]=V[2*c+1],X+=4),this._supportsTangents&&R&&(b[X]=R[3*c],b[X+1]=R[3*c+1],b[X+2]=R[3*c+2],X+=4),this._supportsUV2s&&p&&(b[X]=p[2*c],b[X+1]=p[2*c+1],X+=4),this._supportsColors&&j&&(b[X]=j[4*c],b[X+1]=j[4*c+1],b[X+2]=j[4*c+2],b[X+3]=j[4*c+3],X+=4)}this._targetStoreTexture=h.d.CreateRGBATexture(b,this._textureWidth,this._textureHeight,d,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const d of this._scene.meshes)d.morphTargetManager===this&&d._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const C=this._parentContainer.morphTargetManagers.indexOf(this);C>-1&&this._parentContainer.morphTargetManagers.splice(C,1),this._parentContainer=null}for(const C of this._targets)this._scene.stopAnimation(C)}}static Parse(C,c){const d=new L(c);for(const b of C.targets)d.addTarget(K.d.Parse(b,c));return d}}L.EnableTextureStorage=!0,L.MaxActiveMorphTargetsInVertexAttributeMode=8,L.ConstantTargetCountForTextureMode=0;var f=d(14060),T=d(12258),z=d(12731);const w=new Map,J=w;function y(C,c,d){x(C)&&u.d.Warn(`Extension with the name '${C}' already exists`),w.set(C,{isGLTFExtension:c,factory:d})}function x(C){return w.delete(C)}var H=d(14067),v=d(13010),D=d(12483);class s{static Get(C,c,d){if(!c||void 0==d||!c[d])throw new Error(`${C}: Failed to find index (${d})`);return c[d]}static TryGet(C,c){return C&&void 0!=c&&C[c]?C[c]:null}static Assign(C){if(C)for(let c=0;c<C.length;c++)C[c].index=c}}function mC(C){if(C.min&&C.max){const c=C.min,d=C.max,b=X.TmpVectors.dd[0].yc(c[0],c[1],c[2]),P=X.TmpVectors.dd[1].yc(d[0],d[1],d[2]);if(C.normalized&&5126!==C.componentType){let c=1;switch(C.componentType){case 5120:c=127;break;case 5121:c=255;break;case 5122:c=32767;break;case 5123:c=65535}const d=1/c;b.scaleInPlace(d),P.scaleInPlace(d)}return new z.b(b,P)}return null}class Q{static RegisterExtension(C,c){y(C,!1,c)}static UnregisterExtension(C){return x(C)}get ec(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(C){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=C}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((C=>C.dispose&&C.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(C,c,d,b,X,P){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=c,this._assetContainer=d,this._loadData(b);let P=null;if(C){const c={};if(this._gltf.nodes)for(const C of this._gltf.nodes)C.name&&(c[C.name]=C.index);P=(C instanceof Array?C:[C]).map((C=>{const d=c[C];if(void 0===d)throw new Error(`Failed to find node '${C}'`);return d}))}return await this._loadAsync(X,V,P,(()=>({meshes:this._getMeshes(),LU:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=C,this._loadData(c),await this._loadAsync(d,X,null,(()=>{}))}async _loadAsync(C,c,d,b){return await Promise.resolve().then((async()=>{this._rootUrl=C,this._uniqueRootUrl=!C.startsWith("file:")&&c?C:`${C}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const X=`${f.j[f.j.LOADING]} => ${f.j[f.j.READY]}`,P=`${f.j[f.j.LOADING]} => ${f.j[f.j.COMPLETE]}`;this._parent._startPerformanceCounter(X),this._parent._startPerformanceCounter(P),this._parent._setState(f.j.LOADING),this._extensionsOnLoading();const R=new Array;if(!this.parent.loadOnlyMaterials)if(d)R.push(this.loadSceneAsync("/nodes",{nodes:d,index:-1}));else if(void 0!=this._gltf.Pd||this._gltf.scenes&&this._gltf.scenes[0]){const C=s.Get("/scene",this._gltf.scenes,this._gltf.Pd||0);R.push(this.loadSceneAsync(`/scenes/${C.index}`,C))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let C=0;C<this._gltf.materials.length;++C){const c=this._gltf.materials[C],d="/materials/"+C,b=t.e.TriangleFillMode;R.push(this._loadMaterialAsync(d,c,null,b,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&R.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&R.push(this._compileShadowGeneratorsAsync());const p=Promise.all(R).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Vj(!0);for(const C of this._babylonScene.materials){const c=C;void 0!==c.maxSimultaneousLights&&(c.maxSimultaneousLights=Math.max(c.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(f.j.READY),this._skipStartAnimationStep||this._startAnimations(),b()}));return await p.then((C=>(this._parent._endPerformanceCounter(X),V.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(P),this._parent._setState(f.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(C=>{this._parent.onErrorObservable.notifyObservers(C),this._parent.onErrorObservable.clear(),this.dispose()}))})),C)))})).catch((C=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(C),this._parent.onErrorObservable.clear(),this.dispose()),C}))}_loadData(C){if(this._gltf=C.json,this._setupData(),C.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const d=c[0];(d.byteLength<C.bin.byteLength-3||d.byteLength>C.bin.byteLength)&&u.d.Warn(`Binary buffer length (${d.byteLength}) from JSON does not match chunk length (${C.bin.byteLength})`),this._bin=C.bin}else u.d.Warn("Unexpected BIN chunk")}}_setupData(){if(s.Assign(this._gltf.accessors),s.Assign(this._gltf.animations),s.Assign(this._gltf.buffers),s.Assign(this._gltf.bufferViews),s.Assign(this._gltf.cameras),s.Assign(this._gltf.images),s.Assign(this._gltf.materials),s.Assign(this._gltf.meshes),s.Assign(this._gltf.nodes),s.Assign(this._gltf.samplers),s.Assign(this._gltf.scenes),s.Assign(this._gltf.skins),s.Assign(this._gltf.textures),this._gltf.nodes){const C={};for(const d of this._gltf.nodes)if(d.children)for(const c of d.children)C[c]=d.index;const c=this._createRootNode();for(const d of this._gltf.nodes){const b=C[d.index];d.parent=void 0===b?c:this._gltf.nodes[b]}}}async _loadExtensionsAsync(){const C=[];if(J.forEach(((c,d)=>{var b;!1===(null===(b=this.parent.extensionOptions[d])||void 0===b?void 0:b.enabled)?c.isGLTFExtension&&this.isExtensionUsed(d)&&u.d.Warn(`Extension ${d} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(d)||C.push((async()=>{const C=await c.factory(this);return C.name!==d&&u.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${C.name} !== ${d}`),this._parent.onExtensionLoadedObservable.notifyObservers(C),C})())})),this._extensions.push(...await Promise.all(C)),this._extensions.sort(((C,c)=>(C.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const d of this._gltf.extensionsRequired){if(!this._extensions.some((C=>C.name===d&&C.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[d])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${d} is disabled`);throw new Error(`Required extension ${d} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new M.b("__root__",this._babylonScene);this._rootBabylonMesh=C,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Vj(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case f.f.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],Q._LoadTransform(c,this._rootBabylonMesh));break;case f.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(C),c}loadSceneAsync(C,c){const d=this._extensionsLoadSceneAsync(C,c);if(d)return d;const b=new Array;if(this.logOpen(`${C} ${c.name||""}`),c.nodes)for(const X of c.nodes){const c=s.Get(`${C}/nodes/${X}`,this._gltf.nodes,X);b.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(C=>{C.parent=this._rootBabylonMesh})))}for(const X of this._postSceneLoadActions)X();return b.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(b).then((()=>{}))}_forEachPrimitive(C,c){if(C._primitiveBabylonMeshes)for(const d of C._primitiveBabylonMeshes)c(d)}_getGeometries(){const C=[],c=this._gltf.nodes;if(c)for(const d of c)this._forEachPrimitive(d,(c=>{const d=c.zc;d&&-1===C.indexOf(d)&&C.push(d)}));return C}_getMeshes(){const C=[];this._rootBabylonMesh instanceof r.c&&C.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const d of c)this._forEachPrimitive(d,(c=>{C.push(c)}));return C}_getTransformNodes(){const C=[],c=this._gltf.nodes;if(c)for(const d of c)d._babylonTransformNode&&"Yc"===d._babylonTransformNode.getClassName()&&C.push(d._babylonTransformNode),d._babylonTransformNodeForSkin&&C.push(d._babylonTransformNodeForSkin);return C}_getSkeletons(){const C=[],c=this._gltf.skins;if(c)for(const d of c)d._data&&C.push(d._data.babylonSkeleton);return C}_getAnimationGroups(){const C=[],c=this._gltf.animations;if(c)for(const d of c)d._babylonAnimationGroup&&C.push(d._babylonAnimationGroup);return C}_startAnimations(){switch(this._parent.animationStartMode){case f.d.NONE:break;case f.d.FIRST:{const C=this._getAnimationGroups();0!==C.length&&C[0].start(!0);break}case f.d.ALL:{const C=this._getAnimationGroups();for(const c of C)c.start(!0);break}default:return void u.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadNodeAsync(C,c,d);if(b)return b;if(c._babylonTransformNode)throw new Error(`${C}: Invalid recursive node hierarchy`);const X=new Array;this.logOpen(`${C} ${c.name||""}`);const P=b=>{if(Q.AddPointerMetadata(b,C),Q._LoadTransform(c,b),void 0!=c.camera){const d=s.Get(`${C}/camera`,this._gltf.cameras,c.camera);X.push(this.loadCameraAsync(`/cameras/${d.index}`,d,(C=>{C.parent=b,this._babylonScene.useRightHandedSystem||(b.xc.x=-1)})))}if(c.children)for(const d of c.children){const c=s.Get(`${C}/children/${d}`,this._gltf.nodes,d);X.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(C=>{C.parent=b})))}d(b)},V=void 0!=c.mesh,R=this._parent.loadSkins&&void 0!=c.skin;if(!V||R){const C=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new W.e(C,this._babylonScene);d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=d:c._babylonTransformNodeForSkin=d,P(d)}if(V)if(R){const d=s.Get(`${C}/mesh`,this._gltf.meshes,c.mesh);X.push(this._loadMeshAsync(`/meshes/${d.index}`,c,d,(d=>{const b=c._babylonTransformNodeForSkin;d.metadata=(0,v.d)(b.metadata,d.metadata||{});const P=s.Get(`${C}/skin`,this._gltf.skins,c.skin);X.push(this._loadSkinAsync(`/skins/${P.index}`,c,P,(C=>{this._forEachPrimitive(c,(c=>{c.skeleton=C})),this._postSceneLoadActions.push((()=>{if(void 0!=P.skeleton){const C=s.Get(`/skins/${P.index}/skeleton`,this._gltf.nodes,P.skeleton).parent;c.index===C.index?d.parent=b.parent:d.parent=C._babylonTransformNode}else d.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:b,skinnedNode:d})}))})))})))}else{const d=s.Get(`${C}/mesh`,this._gltf.meshes,c.mesh);X.push(this._loadMeshAsync(`/meshes/${d.index}`,c,d,P))}return this.logClose(),Promise.all(X).then((()=>(this._forEachPrimitive(c,(C=>{const c=C;!c.isAnInstance&&c.zc&&c.zc.useBoundingInfoFromGeometry?C.zC():C.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(C,c,d,b){const X=d.primitives;if(!X||!X.length)throw new Error(`${C}: Primitives are missing`);void 0==X[0].index&&s.Assign(X);const P=new Array;this.logOpen(`${C} ${d.name||""}`);const V=c.name||`node${c.index}`;if(1===X.length){const b=d.primitives[0];P.push(this._loadMeshPrimitiveAsync(`${C}/primitives/${b.index}`,V,c,d,b,(C=>{c._babylonTransformNode=C,c._primitiveBabylonMeshes=[C]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new W.e(V,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const b of X)P.push(this._loadMeshPrimitiveAsync(`${C}/primitives/${b.index}`,`${V}_primitive${b.index}`,c,d,b,(C=>{C.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(C)})))}return b(c._babylonTransformNode),this.logClose(),Promise.all(P).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(C,c,d,b,X,P){const V=this._extensionsLoadMeshPrimitiveAsync(C,c,d,b,X,P);if(V)return V;this.logOpen(`${C}`);const R=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==d.skin&&!b.primitives[0].targets;let p,j;if(R&&X._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,p=X._instanceData.babylonSourceMesh.createInstance(c),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j=X._instanceData.promise;else{const P=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new M.b(c,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.sideOrientation=this._babylonScene.useRightHandedSystem?t.e.CounterClockWiseSideOrientation:t.e.ClockWiseSideOrientation,this._createMorphTargets(C,d,b,X,V),P.push(this._loadVertexDataAsync(C,X,V).then((async c=>await this._loadMorphTargetsAsync(C,X,V,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.fC(V),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const g=Q._GetDrawMode(C,X.mode);if(void 0==X.material){let C=this._defaultBabylonMaterialData[g];C||(C=this._createDefaultMaterial("__GLTFLoader._default",g),this._parent.onMaterialLoadedObservable.notifyObservers(C),this._defaultBabylonMaterialData[g]=C),V.material=C}else if(!this.parent.skipMaterials){const c=s.Get(`${C}/material`,this._gltf.materials,X.material);P.push(this._loadMaterialAsync(`/materials/${c.index}`,c,V,g,(C=>{V.material=C})))}j=Promise.all(P),R&&(X._instanceData={babylonSourceMesh:V,promise:j}),p=V}return Q.AddPointerMetadata(p,C),this._parent.onMeshLoadedObservable.notifyObservers(p),P(p),this.logClose(),j.then((()=>p))}_loadVertexDataAsync(C,c,d){const b=this._extensionsLoadVertexDataAsync(C,c,d);if(b)return b;const X=c.attributes;if(!X)throw new Error(`${C}: Attributes are missing`);const P=new Array,V=new N.c(d.name,this._babylonScene);if(void 0==c.indices)d.isUnIndexed=!0;else{const d=s.Get(`${C}/indices`,this._gltf.accessors,c.indices);P.push(this._loadIndicesAccessorAsync(`/accessors/${d.index}`,d).then((C=>{V.setIndices(C)})))}const R=(c,b,R)=>{if(void 0==X[c])return;d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(b)&&d._delayInfo.push(b);const p=s.Get(`${C}/attributes/${c}`,this._gltf.accessors,X[c]);P.push(this._loadVertexAccessorAsync(`/accessors/${p.index}`,p,b).then((C=>{if(C.getKind()===E.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!d.skeleton){const C=mC(p);C&&(V._boundingInfo=C,V.useBoundingInfoFromGeometry=!0)}V.setVerticesBuffer(C,p.count)}))),b==E.g.MatricesIndicesExtraKind&&(d.numBoneInfluencers=8),R&&R(p)};return R("POSITION",E.g.PositionKind),R("NORMAL",E.g.NormalKind),R("TANGENT",E.g.TangentKind),R("TEXCOORD_0",E.g.UVKind),R("TEXCOORD_1",E.g.UV2Kind),R("TEXCOORD_2",E.g.UV3Kind),R("TEXCOORD_3",E.g.UV4Kind),R("TEXCOORD_4",E.g.UV5Kind),R("TEXCOORD_5",E.g.UV6Kind),R("JOINTS_0",E.g.MatricesIndicesKind),R("WEIGHTS_0",E.g.MatricesWeightsKind),R("JOINTS_1",E.g.MatricesIndicesExtraKind),R("WEIGHTS_1",E.g.MatricesWeightsExtraKind),R("COLOR_0",E.g.ColorKind,(C=>{"VEC4"===C.type&&(d.hasVertexAlpha=!0)})),Promise.all(P).then((()=>V))}_createMorphTargets(C,c,d,b,X){if(!b.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=b.targets.length;else if(b.targets.length!==c._numMorphTargets)throw new Error(`${C}: Primitives do not have the same number of targets`);const P=d.extras?d.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,X.morphTargetManager=new L(this._babylonScene),X.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.morphTargetManager.areUpdatesFrozen=!0;for(let V=0;V<b.targets.length;V++){const C=c.weights?c.weights[V]:d.weights?d.weights[V]:0,b=P?P[V]:`morphTarget${V}`;X.morphTargetManager.addTarget(new K.d(b,C,X.NC()))}}_loadMorphTargetsAsync(C,c,d,b){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const X=new Array,P=d.morphTargetManager;for(let V=0;V<P.numTargets;V++){const d=P.getTarget(V);X.push(this._loadMorphTargetVertexDataAsync(`${C}/targets/${V}`,b,c.targets[V],d))}return Promise.all(X).then((()=>{P.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(C,c,d,b){const X=new Array,P=(b,P,V)=>{if(void 0==d[b])return;const R=c.getVertexBuffer(P);if(!R)return;const p=s.Get(`${C}/${b}`,this._gltf.accessors,d[b]);X.push(this._loadFloatAccessorAsync(`/accessors/${p.index}`,p).then((C=>{V(R,C)})))};return P("POSITION",E.g.PositionKind,((C,c)=>{const d=new Float32Array(c.length);C.forEach(c.length,((C,b)=>{d[b]=c[b]+C})),b.setPositions(d)})),P("NORMAL",E.g.NormalKind,((C,c)=>{const d=new Float32Array(c.length);C.forEach(d.length,((C,b)=>{d[b]=c[b]+C})),b.setNormals(d)})),P("TANGENT",E.g.TangentKind,((C,c)=>{const d=new Float32Array(c.length/3*4);let X=0;C.forEach(c.length/3*4,((C,b)=>{(b+1)%4!==0&&(d[X]=c[X]+C,X++)})),b.setTangents(d)})),P("TEXCOORD_0",E.g.UVKind,((C,c)=>{const d=new Float32Array(c.length);C.forEach(c.length,((C,b)=>{d[b]=c[b]+C})),b.setUVs(d)})),P("TEXCOORD_1",E.g.UV2Kind,((C,c)=>{const d=new Float32Array(c.length);C.forEach(c.length,((C,b)=>{d[b]=c[b]+C})),b.setUV2s(d)})),P("COLOR_0",E.g.ColorKind,((c,d)=>{let X=null;const P=c.getSize();if(3===P){X=new Float32Array(d.length/3*4),c.forEach(d.length,((C,c)=>{const b=Math.floor(c/3),P=c%3;X[4*b+P]=d[3*b+P]+C}));for(let C=0;C<d.length/3;++C)X[4*C+3]=1}else{if(4!==P)throw new Error(`${C}: Invalid number of components (${P}) for COLOR_0 attribute`);X=new Float32Array(d.length),c.forEach(d.length,((C,c)=>{X[c]=d[c]+C}))}b.setColors(X)})),await Promise.all(X).then((()=>{}))}static _LoadTransform(C,c){if(void 0!=C.skin)return;let d=X.dd.Zero(),b=X.Quaternion.Identity(),P=X.dd.One();if(C.matrix){X.Matrix.jd(C.matrix).decompose(P,b,d)}else C.translation&&(d=X.dd.jd(C.translation)),C.rotation&&(b=X.Quaternion.jd(C.rotation)),C.scale&&(P=X.dd.jd(C.scale));c.position=d,c.rotationQuaternion=b,c.xc=P}_loadSkinAsync(C,c,d,b){if(!this._parent.loadSkins)return Promise.resolve();const X=this._extensionsLoadSkinAsync(C,c,d);if(X)return X;if(d._data)return b(d._data.babylonSkeleton),d._data.promise;const P=`skeleton${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new B(d.name||P,P,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(C,d,V);const R=this._loadSkinInverseBindMatricesDataAsync(C,d).then((C=>{this._updateBoneMatrices(V,C)}));return d._data={babylonSkeleton:V,promise:R},b(V),R}_loadBones(C,c,d){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const d=this._findSkeletonRootNode(`${C}/joints`,c.joints);if(d)if(void 0===c.skeleton)c.skeleton=d.index;else{const b=(C,c)=>{for(;c.parent;c=c.parent)if(c.parent===C)return!0;return!1},X=s.Get(`${C}/skeleton`,this._gltf.nodes,c.skeleton);X===d||b(X,d)||(u.d.Warn(`${C}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=d.index)}else u.d.Warn(`${C}: Failed to find common root`)}const b={};for(const X of c.joints){const P=s.Get(`${C}/joints/${X}`,this._gltf.nodes,X);this._loadBone(P,c,d,b)}}_findSkeletonRootNode(C,c){if(0===c.length)return null;const d={};for(const X of c){const c=[];let b=s.Get(`${C}/${X}`,this._gltf.nodes,X);for(;-1!==b.index;)c.unshift(b),b=b.parent;d[X]=c}let b=null;for(let X=0;;++X){let C=d[c[0]];if(X>=C.length)return b;const P=C[X];for(let V=1;V<c.length;++V)if(C=d[c[V]],X>=C.length||P!==C[X])return b;b=P}}_loadBone(C,c,d,b){C._isJoint=!0;let X=b[C.index];if(X)return X;let P=null;C.index!==c.skeleton&&(C.parent&&-1!==C.parent.index?P=this._loadBone(C.parent,c,d,b):void 0!==c.skeleton&&u.d.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const V=c.joints.indexOf(C.index);return X=new j.c(C.name||`joint${C.index}`,d,P,this._getNodeMatrix(C),null,null,V),b[C.index]=X,this._postSceneLoadActions.push((()=>{X.linkTransformNode(C._babylonTransformNode)})),X}_loadSkinInverseBindMatricesDataAsync(C,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const d=s.Get(`${C}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${d.index}`,d)}_updateBoneMatrices(C,c){for(const d of C.bones){const C=X.Matrix.Identity(),b=d._index;c&&-1!==b&&(X.Matrix.FromArrayToRef(c,16*b,C),C.invertToRef(C));const P=d.getParent();P&&C.multiplyToRef(P.getAbsoluteInverseBindMatrix(),C),d.fc(C,!1,!1),d._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(C){return C.matrix?X.Matrix.jd(C.matrix):X.Matrix.Compose(C.scale?X.dd.jd(C.scale):X.dd.One(),C.rotation?X.Quaternion.jd(C.rotation):X.Quaternion.Identity(),C.translation?X.dd.jd(C.translation):X.dd.Zero())}loadCameraAsync(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadCameraAsync(C,c,d);if(b)return b;const P=new Array;this.logOpen(`${C} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new p.c(c.name||`camera${c.index}`,X.dd.Zero(),this._babylonScene,!1);switch(V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonCamera=V,V.setTarget(new X.dd(0,0,-1)),c.type){case"perspective":{const d=c.perspective;if(!d)throw new Error(`${C}: Camera perspective properties are missing`);V.fov=d.yfov,V.Lc=d.znear,V.maxZ=d.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${C}: Camera orthographic properties are missing`);V.mode=R.d.ORTHOGRAPHIC_CAMERA,V.orthoLeft=-c.orthographic.xmag,V.orthoRight=c.orthographic.xmag,V.orthoBottom=-c.orthographic.ymag,V.orthoTop=c.orthographic.ymag,V.Lc=c.orthographic.znear,V.maxZ=c.orthographic.zfar;break;default:throw new Error(`${C}: Invalid camera type (${c.type})`)}return Q.AddPointerMetadata(V,C),this._parent.onCameraLoadedObservable.notifyObservers(V),d(V),this.logClose(),Promise.all(P).then((()=>V))}_loadAnimationsAsync(){const C=this._gltf.animations;if(!C)return Promise.resolve();const c=new Array;for(let d=0;d<C.length;d++){const b=C[d];c.push(this.loadAnimationAsync(`/animations/${b.index}`,b).then((C=>{0===C.targetedAnimations.length&&C.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(C,c){const b=this._extensionsLoadAnimationAsync(C,c);return b||d.e(78).then(d.bind(d,15563)).then((d=>{let{AnimationGroup:b}=d;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new b(c.name||`animation${c.index}`,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=X;const P=new Array;s.Assign(c.channels),s.Assign(c.samplers);for(const V of c.channels)P.push(this._loadAnimationChannelAsync(`${C}/channels/${V.index}`,C,c,V,((C,c)=>{C.animations=C.animations||[],C.animations.push(c),X.addTargetedAnimation(c,C)})));return Promise.all(P).then((()=>(X.normalize(0),X)))}))}async _loadAnimationChannelAsync(C,c,b,X,P){const V=this._extensionsLoadAnimationChannelAsync(C,c,b,X,P);if(V)return await V;if(void 0==X.target.node)return await Promise.resolve();const R=s.Get(`${C}/target/node`,this._gltf.nodes,X.target.node),p=X.target.path,j="weights"===p;if(j&&!R._numMorphTargets||!j&&!R._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!j&&!R._isJoint)return await Promise.resolve();let g;switch(await Promise.resolve().then(d.bind(d,14082)),p){case"translation":var k;g=null===(k=(0,H.g)("/nodes/{}/translation"))||void 0===k?void 0:k.interpolation;break;case"rotation":var Z;g=null===(Z=(0,H.g)("/nodes/{}/rotation"))||void 0===Z?void 0:Z.interpolation;break;case"scale":var U;g=null===(U=(0,H.g)("/nodes/{}/scale"))||void 0===U?void 0:U.interpolation;break;case"weights":var A;g=null===(A=(0,H.g)("/nodes/{}/weights"))||void 0===A?void 0:A.interpolation;break;default:throw new Error(`${C}/target/path: Invalid value (${X.target.path})`)}if(!g)throw new Error(`${C}/target/path: Could not find interpolation properties for target path (${X.target.path})`);const u={object:R,info:g};return await this._loadAnimationChannelFromTargetInfoAsync(C,c,b,X,u,P)}_loadAnimationChannelFromTargetInfoAsync(C,c,d,b,X,P){const V=this.parent.targetFps,R=1/V,p=s.Get(`${C}/sampler`,d.samplers,b.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${b.sampler}`,p).then((C=>{let c=0;const p=X.object,j=X.info;for(const X of j){const j=X.getStride(p),g=C.input,k=C.output,Z=new Array(g.length);let U=0;switch(C.interpolation){case"STEP":for(let C=0;C<g.length;C++){const c=X.getValue(p,k,U,1);U+=j,Z[C]={frame:g[C]*V,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let C=0;C<g.length;C++){const c=X.getValue(p,k,U,R);U+=j;const d=X.getValue(p,k,U,1);U+=j;const b=X.getValue(p,k,U,R);U+=j,Z[C]={frame:g[C]*V,inTangent:c,value:d,outTangent:b}}break;case"LINEAR":for(let C=0;C<g.length;C++){const c=X.getValue(p,k,U,1);U+=j,Z[C]={frame:g[C]*V,value:c}}}if(U>0){const C=`${d.name||`animation${d.index}`}_channel${b.index}_${c}`,R=X.buildAnimations(p,C,V,Z);for(const d of R)c++,P(d.babylonAnimatable,d.babylonAnimation)}}}))}_loadAnimationSamplerAsync(C,c){if(c._data)return c._data;const d=c.interpolation||"LINEAR";switch(d){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${C}/interpolation: Invalid value (${c.interpolation})`)}const b=s.Get(`${C}/input`,this._gltf.accessors,c.input),X=s.Get(`${C}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${b.index}`,b),this._loadFloatAccessorAsync(`/accessors/${X.index}`,X)]).then((C=>{let[c,b]=C;return{input:c,interpolation:d,output:b}})),c._data}loadBufferAsync(C,c,d,b){const X=this._extensionsLoadBufferAsync(C,c,d,b);if(X)return X;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${C}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${C}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+d,b)}catch(X){throw new Error(`${C}: ${X.message}`)}}))}loadBufferViewAsync(C,c){const d=this._extensionsLoadBufferViewAsync(C,c);if(d)return d;if(c._data)return c._data;const b=s.Get(`${C}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${b.index}`,b,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(C,c,d){if(c._data)return c._data;const b=Q._GetNumComponents(C,c.type),X=b*E.g.GetTypeByteLength(c.componentType),P=b*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new d(P));else{const V=s.Get(`${C}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((R=>{if(5126!==c.componentType||c.normalized||V.byteStride&&V.byteStride!==X){const C=new d(P);return E.g.ForEach(R,c.byteOffset||0,V.byteStride||X,b,c.componentType,C.length,c.normalized||!1,((c,d)=>{C[d]=c})),C}return Q._GetTypedArray(C,c.componentType,R,c.byteOffset,P)}))}if(c.sparse){const P=c.sparse;c._data=c._data.then((V=>{const R=V,p=s.Get(`${C}/sparse/indices/bufferView`,this._gltf.bufferViews,P.indices.bufferView),j=s.Get(`${C}/sparse/values/bufferView`,this._gltf.bufferViews,P.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${p.index}`,p),this.loadBufferViewAsync(`/bufferViews/${j.index}`,j)]).then((V=>{let[p,j]=V;const g=Q._GetTypedArray(`${C}/sparse/indices`,P.indices.componentType,p,P.indices.byteOffset,P.count),k=b*P.count;let Z;if(5126!==c.componentType||c.normalized){const V=Q._GetTypedArray(`${C}/sparse/values`,c.componentType,j,P.values.byteOffset,k);Z=new d(k),E.g.ForEach(V,0,X,b,c.componentType,Z.length,c.normalized||!1,((C,c)=>{Z[c]=C}))}else Z=Q._GetTypedArray(`${C}/sparse/values`,c.componentType,j,P.values.byteOffset,k);let U=0;for(let C=0;C<g.length;C++){let c=g[C]*b;for(let C=0;C<b;C++)R[c++]=Z[U++]}return R}))}))}return c._data}_loadFloatAccessorAsync(C,c){return this._loadAccessorAsync(C,c,Float32Array)}_loadIndicesAccessorAsync(C,c){if("SCALAR"!==c.type)throw new Error(`${C}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${C}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const d=Q._GetTypedArrayConstructor(`${C}/componentType`,c.componentType);c._data=this._loadAccessorAsync(C,c,d)}else{const d=s.Get(`${C}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d).then((d=>Q._GetTypedArray(C,c.componentType,d,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(C){if(C._babylonBuffer)return C._babylonBuffer;const c=this._babylonScene.getEngine();return C._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>new E.d(c,C,!1))),C._babylonBuffer}_loadVertexAccessorAsync(C,c,d){var b;if(null!==(b=c._babylonVertexBuffer)&&void 0!==b&&b[d])return c._babylonVertexBuffer[d];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const X=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[d]=this._loadFloatAccessorAsync(C,c).then((C=>new E.g(X,C,d,!1)));else{const b=s.Get(`${C}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[d]=this._loadVertexBufferViewAsync(b).then((P=>{const V=Q._GetNumComponents(C,c.type);return new E.g(X,P,d,!1,void 0,b.byteStride,void 0,c.byteOffset,V,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[d]}_loadMaterialMetallicRoughnessPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return c&&(c.baseColorFactor?(d.albedoColor=P.pd.jd(c.baseColorFactor),d.alpha=c.baseColorFactor[3]):d.albedoColor=P.pd.White(),d.metallic=void 0==c.metallicFactor?1:c.metallicFactor,d.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&b.push(this.loadTextureInfoAsync(`${C}/baseColorTexture`,c.baseColorTexture,(C=>{C.name=`${d.name} (Base Color)`,d.albedoTexture=C}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,b.push(this.loadTextureInfoAsync(`${C}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(C=>{C.name=`${d.name} (Metallic Roughness)`,d.metallicTexture=C}))),d.useMetallnessFromMetallicTextureBlue=!0,d.useRoughnessFromMetallicTextureGreen=!0,d.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(b).then((()=>{}))}_loadMaterialAsync(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const P=this._extensionsLoadMaterialAsync(C,c,d,b,X);if(P)return P;c._data=c._data||{};let V=c._data[b];if(!V){this.logOpen(`${C} ${c.name||""}`);const d=this.createMaterial(C,c,b);V={babylonMaterial:d,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(C,c,d)},c._data[b]=V,Q.AddPointerMetadata(d,C),this._parent.onMaterialLoadedObservable.notifyObservers(d),this.logClose()}return d&&(V.babylonMeshes.push(d),d.Uc.addOnce((()=>{const C=V.babylonMeshes.indexOf(d);-1!==C&&V.babylonMeshes.splice(C,1)}))),X(V.babylonMaterial),V.promise.then((()=>V.babylonMaterial))}_createDefaultMaterial(C,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new e.c(C,this._babylonScene);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.fillMode=c,d.enableSpecularAntiAliasing=!0,d.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,d.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,d.transparencyMode=e.c.PBRMATERIAL_OPAQUE,d.metallic=1,d.roughness=1,d}createMaterial(C,c,d){const b=this._extensionsCreateMaterial(C,c,d);if(b)return b;const X=c.name||`material${c.index}`;return this._createDefaultMaterial(X,d)}loadMaterialPropertiesAsync(C,c,d){const b=this._extensionsLoadMaterialPropertiesAsync(C,c,d);if(b)return b;const X=new Array;return X.push(this.loadMaterialBasePropertiesAsync(C,c,d)),c.pbrMetallicRoughness&&X.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${C}/pbrMetallicRoughness`,c.pbrMetallicRoughness,d)),this.loadMaterialAlphaProperties(C,c,d),Promise.all(X).then((()=>{}))}loadMaterialBasePropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return d.emissiveColor=c.emissiveFactor?P.pd.jd(c.emissiveFactor):new P.pd(0,0,0),c.doubleSided&&(d.Jc=!1,d.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,b.push(this.loadTextureInfoAsync(`${C}/normalTexture`,c.normalTexture,(C=>{C.name=`${d.name} (Normal)`,d.bumpTexture=C}))),d.invertNormalMapX=!this._babylonScene.useRightHandedSystem,d.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&d.bumpTexture&&(d.bumpTexture.level=c.normalTexture.scale),d.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,b.push(this.loadTextureInfoAsync(`${C}/occlusionTexture`,c.occlusionTexture,(C=>{C.name=`${d.name} (Occlusion)`,d.ambientTexture=C}))),d.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(d.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&b.push(this.loadTextureInfoAsync(`${C}/emissiveTexture`,c.emissiveTexture,(C=>{C.name=`${d.name} (Emissive)`,d.emissiveTexture=C}))),Promise.all(b).then((()=>{}))}loadMaterialAlphaProperties(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":d.transparencyMode=e.c.PBRMATERIAL_OPAQUE,d.alpha=1;break;case"MASK":d.transparencyMode=e.c.PBRMATERIAL_ALPHATEST,d.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,d.albedoTexture&&(d.albedoTexture.Kc=!0);break;case"BLEND":d.transparencyMode=e.c.PBRMATERIAL_ALPHABLEND,d.albedoTexture&&(d.albedoTexture.Kc=!0,d.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${C}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadTextureInfoAsync(C,c,d);if(b)return b;if(this.logOpen(`${C}`),c.texCoord>=6)throw new Error(`${C}/texCoord: Invalid value (${c.texCoord})`);const X=s.Get(`${C}/index`,this._gltf.textures,c.index);X._textureInfo=c;const P=this._loadTextureAsync(`/textures/${c.index}`,X,(b=>{b.coordinatesIndex=c.texCoord||0,Q.AddPointerMetadata(b,C),this._parent.onTextureLoadedObservable.notifyObservers(b),d(b)}));return this.logClose(),P}_loadTextureAsync(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadTextureAsync(C,c,d);if(b)return b;this.logOpen(`${C} ${c.name||""}`);const X=void 0==c.sampler?Q.DefaultSampler:s.Get(`${C}/sampler`,this._gltf.samplers,c.sampler),P=s.Get(`${C}/source`,this._gltf.images,c.source),V=this._createTextureAsync(C,X,P,d,void 0,!c._textureInfo.nonColorData);return this.logClose(),V}_createTextureAsync(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},P=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0;const R=this._loadSampler(`/samplers/${c.index}`,c),p=new Array,j=new b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g={noMipmap:R.noMipMaps,invertY:!1,samplingMode:R.samplingMode,S:()=>{this._disposed||j.resolve()},onError:(c,d)=>{this._disposed||j.reject(new Error(`${C}: ${d&&d.message?d.message:c||"Failed to load texture"}`))},mimeType:d.mimeType??(0,T.h)(d.uri??""),loaderOptions:P,useSRGBBuffer:!!V&&this._parent.useSRGBBuffers},k=new n.b(null,this._babylonScene,g);return k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.push(j.promise),p.push(this.loadImageAsync(`/images/${d.index}`,d).then((C=>{const c=d.uri||`${this._fileName}#image${d.index}`,b=`data:${this._uniqueRootUrl}${c}`;k.updateURL(b,C);const X=k.getInternalTexture();X&&(X.label=d.name)}))),k.wrapU=R.wrapU,k.wrapV=R.wrapV,X(k),this._parent.useGltfTextureNames&&(k.name=d.name||d.uri||`image${d.index}`),Promise.all(p).then((()=>k))}_loadSampler(C,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:Q._GetTextureSamplingMode(C,c),wrapU:Q._GetTextureWrapMode(`${C}/wrapS`,c.wrapS),wrapV:Q._GetTextureWrapMode(`${C}/wrapT`,c.wrapT)}),c._data}loadImageAsync(C,c){if(!c._data){if(this.logOpen(`${C} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${C}/uri`,c,c.uri);else{const d=s.Get(`${C}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}this.logClose()}return c._data}loadUriAsync(C,c,d){const b=this._extensionsLoadUriAsync(C,c,d);if(b)return b;if(!Q._ValidateUri(d))throw new Error(`${C}: '${d}' is invalid`);if((0,T.j)(d)){const c=new Uint8Array((0,T.b)(d));return this.log(`${C}: Decoded ${d.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${C}: Loading ${d}`),this._parent.preprocessUrlAsync(this._rootUrl+d).then((c=>new Promise(((b,X)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${C}: Loaded ${d} (${c.byteLength} bytes)`),b(new Uint8Array(c)))}),!0,(c=>{X(new T.l(`${C}: Failed to load '${d}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(C,c){C.metadata=C.metadata||{};const d=C._internalMetadata=C._internalMetadata||{},b=d.ec=d.ec||{};(b.pointers=b.pointers||[]).push(c)}static _GetTextureWrapMode(C,c){switch(c=void 0==c?10497:c){case 33071:return n.b.CLAMP_ADDRESSMODE;case 33648:return n.b.MIRROR_ADDRESSMODE;case 10497:return n.b.WRAP_ADDRESSMODE;default:return u.d.Warn(`${C}: Invalid value (${c})`),n.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(C,c){const d=void 0==c.magFilter?9729:c.magFilter,b=void 0==c.minFilter?9987:c.minFilter;if(9729===d)switch(b){case 9728:return n.b.LINEAR_NEAREST;case 9729:return n.b.LINEAR_LINEAR;case 9984:return n.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return n.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return n.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return n.b.LINEAR_LINEAR_MIPLINEAR;default:return u.d.Warn(`${C}/minFilter: Invalid value (${b})`),n.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==d&&u.d.Warn(`${C}/magFilter: Invalid value (${d})`),b){case 9728:return n.b.NEAREST_NEAREST;case 9729:return n.b.NEAREST_LINEAR;case 9984:return n.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return n.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return n.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return n.b.NEAREST_LINEAR_MIPLINEAR;default:return u.d.Warn(`${C}/minFilter: Invalid value (${b})`),n.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(C,c){try{return(0,D.r)(c)}catch(d){throw new Error(`${C}: ${d.message}`)}}static _GetTypedArray(C,c,d,b,X){const P=d.buffer;b=d.byteOffset+(b||0);const V=Q._GetTypedArrayConstructor(`${C}/componentType`,c),R=E.g.GetTypeByteLength(c);return b%R!==0?(u.d.Warn(`${C}: Copying buffer as byte offset (${b}) is not a multiple of component type byte length (${R})`),new V(P.slice(b,b+X*R),0)):new V(P,b,X)}static _GetNumComponents(C,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${C}: Invalid type (${c})`)}static _ValidateUri(C){return V.Tools.IsBase64(C)||-1===C.indexOf("..")}static _GetDrawMode(C,c){switch(void 0==c&&(c=4),c){case 0:return t.e.PointListDrawMode;case 1:return t.e.LineListDrawMode;case 2:return t.e.LineLoopDrawMode;case 3:return t.e.LineStripDrawMode;case 4:return t.e.TriangleFillMode;case 5:return t.e.TriangleStripDrawMode;case 6:return t.e.TriangleFanDrawMode}throw new Error(`${C}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const C=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const d in c._data){const b=c._data[d];for(const c of b.babylonMeshes){c.Tc(!0);const d=b.babylonMaterial;C.push(d.forceCompilationAsync(c)),C.push(d.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(C.push(d.forceCompilationAsync(c,{clipPlane:!0})),C.push(d.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(C).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const C=new Array,c=this._babylonScene.lights;for(const d of c){const c=d.getShadowGenerator();c&&C.push(c.forceCompilationAsync())}return Promise.all(C).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(C){for(const c of this._extensions)c.enabled&&C(c)}_applyExtensions(C,c,d){for(const b of this._extensions)if(b.enabled){const X=`${b.name}.${c}`,P=C;P._activeLoaderExtensionFunctions=P._activeLoaderExtensionFunctions||{};const V=P._activeLoaderExtensionFunctions;if(!V[X]){V[X]=!0;try{const C=d(b);if(C)return C}finally{delete V[X]}}}return null}_extensionsOnLoading(){this._forEachExtensions((C=>C.onLoading&&C.onLoading()))}_extensionsOnReady(){this._forEachExtensions((C=>C.onReady&&C.onReady()))}_extensionsLoadSceneAsync(C,c){return this._applyExtensions(c,"loadScene",(d=>d.loadSceneAsync&&d.loadSceneAsync(C,c)))}_extensionsLoadNodeAsync(C,c,d){return this._applyExtensions(c,"loadNode",(b=>b.loadNodeAsync&&b.loadNodeAsync(C,c,d)))}_extensionsLoadCameraAsync(C,c,d){return this._applyExtensions(c,"loadCamera",(b=>b.loadCameraAsync&&b.loadCameraAsync(C,c,d)))}_extensionsLoadVertexDataAsync(C,c,d){return this._applyExtensions(c,"loadVertexData",(b=>b._loadVertexDataAsync&&b._loadVertexDataAsync(C,c,d)))}_extensionsLoadMeshPrimitiveAsync(C,c,d,b,X,P){return this._applyExtensions(X,"loadMeshPrimitive",(V=>V._loadMeshPrimitiveAsync&&V._loadMeshPrimitiveAsync(C,c,d,b,X,P)))}_extensionsLoadMaterialAsync(C,c,d,b,X){return this._applyExtensions(c,"loadMaterial",(P=>P._loadMaterialAsync&&P._loadMaterialAsync(C,c,d,b,X)))}_extensionsCreateMaterial(C,c,d){return this._applyExtensions(c,"createMaterial",(b=>b.createMaterial&&b.createMaterial(C,c,d)))}_extensionsLoadMaterialPropertiesAsync(C,c,d){return this._applyExtensions(c,"loadMaterialProperties",(b=>b.loadMaterialPropertiesAsync&&b.loadMaterialPropertiesAsync(C,c,d)))}_extensionsLoadTextureInfoAsync(C,c,d){return this._applyExtensions(c,"loadTextureInfo",(b=>b.loadTextureInfoAsync&&b.loadTextureInfoAsync(C,c,d)))}_extensionsLoadTextureAsync(C,c,d){return this._applyExtensions(c,"loadTexture",(b=>b._loadTextureAsync&&b._loadTextureAsync(C,c,d)))}_extensionsLoadAnimationAsync(C,c){return this._applyExtensions(c,"loadAnimation",(d=>d.loadAnimationAsync&&d.loadAnimationAsync(C,c)))}_extensionsLoadAnimationChannelAsync(C,c,d,b,X){return this._applyExtensions(d,"loadAnimationChannel",(P=>P._loadAnimationChannelAsync&&P._loadAnimationChannelAsync(C,c,d,b,X)))}_extensionsLoadSkinAsync(C,c,d){return this._applyExtensions(d,"loadSkin",(b=>b._loadSkinAsync&&b._loadSkinAsync(C,c,d)))}_extensionsLoadUriAsync(C,c,d){return this._applyExtensions(c,"loadUri",(b=>b._loadUriAsync&&b._loadUriAsync(C,c,d)))}_extensionsLoadBufferViewAsync(C,c){return this._applyExtensions(c,"loadBufferView",(d=>d.loadBufferViewAsync&&d.loadBufferViewAsync(C,c)))}_extensionsLoadBufferAsync(C,c,d,b){return this._applyExtensions(c,"loadBuffer",(X=>X.loadBufferAsync&&X.loadBufferAsync(C,c,d,b)))}static LoadExtensionAsync(C,c,d,b){if(!c.extensions)return null;const X=c.extensions[d];return X?b(`${C}/extensions/${d}`,X):null}static LoadExtraAsync(C,c,d,b){if(!c.extras)return null;const X=c.extras[d];return X?b(`${C}/extras/${d}`,X):null}isExtensionUsed(C){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(C)}logOpen(C){this._parent._logOpen(C)}logClose(){this._parent._logClose()}log(C){this._parent._log(C)}startPerformanceCounter(C){this._parent._startPerformanceCounter(C)}endPerformanceCounter(C){this._parent._endPerformanceCounter(C)}}Q.DefaultSampler={index:-1},f.c._CreateGLTF2Loader=C=>new Q(C);var I=d(14082),o=d(12595),F=d(12431),Y=d(14084),l=d(14087);class S extends l.b{constructor(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",C),this._texture=C.getEngine().createRawCubeTexture(c,d,b,X,P,V,R,p)}update(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,C,c,d,b,X)}updateRGBDAsync(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,Y.k)(this._texture,C,c,d,b).then((()=>{}))}clone(){return F.e.Clone((()=>{const C=this.NC(),c=this._texture,d=new S(C,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&d.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),d}),this)}}const G="EXT_lights_image_based";class a{constructor(C){this.name=G,this._loader=C,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.ec.extensions;if(C&&C[this.name]){const c=C[this.name];this._lights=c.lights}}loadSceneAsync(C,c){return Q.LoadExtensionAsync(C,c,this.name,(async(d,b)=>{this._loader._allMaterialsDirtyRequired=!0;const X=new Array;X.push(this._loader.loadSceneAsync(C,c)),this._loader.logOpen(`${d}`);const P=s.Get(`${d}/light`,this._lights,b.jc);return X.push(this._loadLightAsync(`/extensions/${this.name}/lights/${b.jc}`,P).then((C=>{this._loader.babylonScene.environmentTexture=C}))),this._loader.logClose(),await Promise.all(X).then((()=>{}))}))}_loadLightAsync(C,c){if(!c._loaded){const d=new Array;this._loader.logOpen(`${C}`);const b=new Array(c.specularImages.length);for(let X=0;X<c.specularImages.length;X++){const P=c.specularImages[X];b[X]=new Array(P.length);for(let c=0;c<P.length;c++){const V=`${C}/specularImages/${X}/${c}`;this._loader.logOpen(`${V}`);const R=P[c],p=s.Get(V,this._loader.ec.images,R);d.push(this._loader.loadImageAsync(`/images/${R}`,p).then((C=>{b[X][c]=C}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(d).then((async()=>{const d=new S(this._loader.babylonScene,null,c.specularImageSize);if(d.name=c.name||"environment",c._babylonTexture=d,void 0!=c.Qc&&(d.level=c.Qc),c.rotation){let C=X.Quaternion.jd(c.rotation);this._loader.babylonScene.useRightHandedSystem||(C=X.Quaternion.Inverse(C)),X.Matrix.FromQuaternionToRef(C,d.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${C}: Irradiance coefficients are missing`);const P=o.d.jd(c.irradianceCoefficients);P.scaleInPlace(c.Qc),P.convertIrradianceToLambertianRadiance();const V=o.e.FromHarmonics(P),R=(b.length-1)/Math.log2(c.specularImageSize);return await d.updateRGBDAsync(b,V,R)}))}return c._loaded.then((()=>c._babylonTexture))}}x(G),y(G,!0,(C=>new a(C)));d(12973);const O="EXT_mesh_gpu_instancing";class CC{constructor(C){this.name=O,this._loader=C,this.enabled=this._loader.isExtensionUsed(O)}dispose(){this._loader=null}loadNodeAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(C,b)=>{this._loader._disableInstancedMesh++;const P=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,d);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return await P;const V=new Array;let R=0;const p=c=>{if(void 0==b.attributes[c])return void V.push(Promise.resolve(null));const d=s.Get(`${C}/attributes/${c}`,this._loader.ec.accessors,b.attributes[c]);if(V.push(this._loader._loadFloatAccessorAsync(`/accessors/${d.bufferView}`,d)),0===R)R=d.count;else if(R!==d.count)throw new Error(`${C}/attributes: Instance buffer accessors do not have the same count.`)};return p("TRANSLATION"),p("ROTATION"),p("SCALE"),await P.then((async C=>{const[d,b,P]=await Promise.all(V),p=new Float32Array(16*R);X.TmpVectors.dd[0].yc(0,0,0),X.TmpVectors.Quaternion[0].yc(0,0,0,1),X.TmpVectors.dd[1].yc(1,1,1);for(let c=0;c<R;++c)d&&X.dd.FromArrayToRef(d,3*c,X.TmpVectors.dd[0]),b&&X.Quaternion.FromArrayToRef(b,4*c,X.TmpVectors.Quaternion[0]),P&&X.dd.FromArrayToRef(P,3*c,X.TmpVectors.dd[1]),X.Matrix.ComposeToRef(X.TmpVectors.dd[1],X.TmpVectors.Quaternion[0],X.TmpVectors.dd[0],X.TmpVectors.Matrix[0]),X.TmpVectors.Matrix[0].copyToArray(p,16*c);for(const X of c._primitiveBabylonMeshes)X.GZ("matrix",p,16,!0);return C}))}))}}x(O),y(O,!0,(C=>new CC(C)));let cC=0,dC=null;class bC{static get Default(){return bC._Default||(bC._Default=new bC),bC._Default}constructor(){const C=bC.Configuration.decoder;this._decoderModulePromise=V.Tools.LoadBabylonScriptAsync(C.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(C,c,d,b,X){await this._decoderModulePromise,0===cC&&(MeshoptDecoder.useWorkers(1),cC=1);const P=await MeshoptDecoder.decodeGltfBufferAsync(c,d,C,b,X);return null!==dC&&clearTimeout(dC),dC=setTimeout((()=>{MeshoptDecoder.useWorkers(0),cC=0,dC=null}),1e3),P}}bC.Configuration={decoder:{url:`${V.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},bC._Default=null;const XC="EXT_meshopt_compression";class PC{constructor(C){this.name=XC,this.enabled=C.isExtensionUsed(XC),this._loader=C}dispose(){this._loader=null}loadBufferViewAsync(C,c){return Q.LoadExtensionAsync(C,c,this.name,(async(d,b)=>{const X=c;if(X._meshOptData)return await X._meshOptData;const P=s.Get(`${C}/buffer`,this._loader.ec.buffers,b.buffer);return X._meshOptData=this._loader.loadBufferAsync(`/buffers/${P.index}`,P,b.byteOffset||0,b.byteLength).then((async C=>await bC.Default.decodeGltfBufferAsync(C,b.count,b.byteStride,b.mode,b.filter))),await X._meshOptData}))}}x(XC),y(XC,!0,(C=>new PC(C)));const VC="EXT_texture_webp";class RC{constructor(C){this.name=VC,this._loader=C,this.enabled=C.isExtensionUsed(VC)}dispose(){this._loader=null}_loadTextureAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=void 0==c.sampler?Q.DefaultSampler:s.Get(`${C}/sampler`,this._loader.ec.samplers,c.sampler),V=s.Get(`${b}/source`,this._loader.ec.images,X.source);return await this._loader._createTextureAsync(C,P,V,(C=>{d(C)}),void 0,!c._textureInfo.nonColorData)}))}}x(VC),y(VC,!0,(C=>new RC(C)));const pC="EXT_texture_avif";class jC{constructor(C){this.name=pC,this._loader=C,this.enabled=C.isExtensionUsed(pC)}dispose(){this._loader=null}_loadTextureAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=void 0==c.sampler?Q.DefaultSampler:s.Get(`${C}/sampler`,this._loader.ec.samplers,c.sampler),V=s.Get(`${b}/source`,this._loader.ec.images,X.source);return await this._loader._createTextureAsync(C,P,V,(C=>{d(C)}),void 0,!c._textureInfo.nonColorData)}))}}x(pC),y(pC,!0,(C=>new jC(C)));var gC=d(14073),kC=d(12942);const ZC="EXT_lights_ies";class UC{constructor(C){this.name=ZC,this._loader=C,this.enabled=this._loader.isExtensionUsed(ZC)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.ec.extensions;if(C&&C[this.name]){const c=C[this.name];this._lights=c.lights,s.Assign(this._lights)}}loadNodeAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,V)=>{let R,p;this._loader._allMaterialsDirtyRequired=!0;const j=await this._loader.loadNodeAsync(C,c,(C=>{p=s.Get(b,this._lights,V.jc);const c=p.name||C.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R=new gC.b(c,X.dd.Zero(),X.dd.Backward(),0,1,this._loader.babylonScene),R.angle=Math.PI/2,R.innerAngle=0,R._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,p._babylonLight=R,R.falloffType=kC.b.FALLOFF_GLTF,R.Ic=V.color?P.pd.jd(V.color):P.pd.White(),R.Qc=V.multiplier||1,R.range=Number.MAX_VALUE,R.parent=C,this._loader._babylonLights.push(R),Q.AddPointerMetadata(R,b),d(C)}));let g;if(p.uri)g=await this._loader.loadUriAsync(C,p,p.uri);else{const c=s.Get(`${C}/bufferView`,this._loader.ec.bufferViews,p.bufferView);g=await this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return R.iesProfileTexture=new n.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,g,!0,void 0,void 0,void 0,void 0,".ies"),j}))}}x(ZC),y(ZC,!0,(C=>new UC(C)));var AC=d(14097);const uC="KHR_draco_mesh_compression";class qC{constructor(C){this.name=uC,this.useNormalizedFlagFromAccessor=!0,this._loader=C,this.enabled=AC.c.DefaultAvailable&&this._loader.isExtensionUsed(uC)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${C}: Unsupported mode ${c.mode}`);const P={},V={},R=(C,b)=>{const R=X.attributes[C];if(void 0!=R&&(d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(b)&&d._delayInfo.push(b),P[b]=R,this.useNormalizedFlagFromAccessor)){const d=s.TryGet(this._loader.ec.accessors,c.attributes[C]);d&&(V[b]=d.normalized||!1)}};R("POSITION",E.g.PositionKind),R("NORMAL",E.g.NormalKind),R("TANGENT",E.g.TangentKind),R("TEXCOORD_0",E.g.UVKind),R("TEXCOORD_1",E.g.UV2Kind),R("TEXCOORD_2",E.g.UV3Kind),R("TEXCOORD_3",E.g.UV4Kind),R("TEXCOORD_4",E.g.UV5Kind),R("TEXCOORD_5",E.g.UV6Kind),R("JOINTS_0",E.g.MatricesIndicesKind),R("WEIGHTS_0",E.g.MatricesWeightsKind),R("COLOR_0",E.g.ColorKind);const p=s.Get(b,this._loader.ec.bufferViews,X.bufferView);return p._dracoBabylonGeometry||(p._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((async b=>{const X=this.dracoDecoder||AC.c.Default,R=s.TryGet(this._loader.ec.accessors,c.attributes.POSITION),p=this._loader.parent.alwaysComputeBoundingBox||d.skeleton||!R?null:mC(R);return await X._decodeMeshToGeometryForGltfAsync(d.name,this._loader.babylonScene,b,P,V,p).catch((c=>{throw new Error(`${C}: ${c.message}`)}))}))),await p._dracoBabylonGeometry}))}}x(uC),y(uC,!0,(C=>new qC(C)));var BC=d(14103),tC=d(12384),eC=d(12388),nC=d(12816),WC=d(13018),EC=d(12345);nC.e.AddNodeConstructor("Light_Type_0",((C,c)=>()=>new NC(C,X.dd.Zero(),c)));class NC extends WC.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(C){this._shadowAngle=C,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(C){const c=this.needCube();if(this._direction=C,this.needCube()!==c&&this._shadowGenerators){const C=this._shadowGenerators.values();for(let c=C.next();!0!==c.done;c=C.next()){c.value.recreateShadowMap()}}}constructor(C,c,d){super(C,d),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return kC.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(C){if(this.direction)return super.getShadowDirection(C);switch(C){case 0:return new X.dd(1,0,0);case 1:return new X.dd(-1,0,0);case 2:return new X.dd(0,-1,0);case 3:return new X.dd(0,1,0);case 4:return new X.dd(0,0,1);case 5:return new X.dd(0,0,-1)}return X.dd.Zero()}_setDefaultShadowProjectionMatrix(C,c,d){const b=this.NC().activeCamera;if(!b)return;const P=void 0!==this.shadowMinZ?this.shadowMinZ:b.Lc,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,R=this.NC().getEngine().o;X.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,R?V:P,R?P:V,C,!0,this._scene.getEngine().isNDCHalfZRange,void 0,R)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(C,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(C,c){return this.computeTransformedInformation()?C.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):C.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(C,c){C["POINTLIGHT"+c]=!0}}(0,tC.e)([(0,eC.P)()],NC.prototype,"shadowAngle",null),(0,EC.e)("BABYLON.PointLight",NC);const rC="KHR_lights_punctual";class MC{constructor(C){this.name=rC,this._loader=C,this.enabled=this._loader.isExtensionUsed(rC)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.ec.extensions;if(C&&C[this.name]){const c=C[this.name];this._lights=c.lights,s.Assign(this._lights)}}loadNodeAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,V)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(C,c,(C=>{let c;const R=s.Get(b,this._lights,V.jc),p=R.name||C.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R.type){case"directional":{const C=new BC.c(p,X.dd.Backward(),this._loader.babylonScene);C.position.Hc(0),c=C;break}case"point":c=new NC(p,X.dd.Zero(),this._loader.babylonScene);break;case"spot":{const C=new gC.b(p,X.dd.Zero(),X.dd.Backward(),0,1,this._loader.babylonScene);C.angle=2*(R.spot&&R.spot.outerConeAngle||Math.PI/4),C.innerAngle=2*(R.spot&&R.spot.innerConeAngle||0),c=C;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${b}: Invalid light type (${R.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,R._babylonLight=c,c.falloffType=kC.b.FALLOFF_GLTF,c.Ic=R.color?P.pd.jd(R.color):P.pd.White(),c.Qc=void 0==R.Qc?1:R.Qc,c.range=void 0==R.range?Number.MAX_VALUE:R.range,c.parent=C,this._loader._babylonLights.push(c),Q.AddPointerMetadata(c,b),d(C)})))))}}x(rC),y(rC,!0,(C=>new MC(C)));const KC="KHR_materials_pbrSpecularGlossiness";class iC{constructor(C){this.name=KC,this.order=200,this._loader=C,this.enabled=this._loader.isExtensionUsed(KC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialBasePropertiesAsync(C,c,d)),P.push(this._loadSpecularGlossinessPropertiesAsync(b,X,d)),this._loader.loadMaterialAlphaProperties(C,c,d),await Promise.all(P).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return d.metallic=null,d.roughness=null,c.diffuseFactor?(d.albedoColor=P.pd.jd(c.diffuseFactor),d.alpha=c.diffuseFactor[3]):d.albedoColor=P.pd.White(),d.reflectivityColor=c.specularFactor?P.pd.jd(c.specularFactor):P.pd.White(),d.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTexture`,c.diffuseTexture,(C=>{C.name=`${d.name} (Diffuse)`,d.albedoTexture=C}))),c.specularGlossinessTexture&&(b.push(this._loader.loadTextureInfoAsync(`${C}/specularGlossinessTexture`,c.specularGlossinessTexture,(C=>{C.name=`${d.name} (Specular Glossiness)`,d.reflectivityTexture=C,d.reflectivityTexture.Kc=!0}))),d.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(b).then((()=>{}))}}x(KC),y(KC,!0,(C=>new iC(C)));const hC="KHR_materials_unlit";class LC{constructor(C){this.name=hC,this.order=210,this._loader=C,this.enabled=this._loader.isExtensionUsed(hC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async()=>await this._loadUnlitPropertiesAsync(C,c,d)))}_loadUnlitPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;d.unlit=!0;const X=c.pbrMetallicRoughness;return X&&(X.baseColorFactor?(d.albedoColor=P.pd.jd(X.baseColorFactor),d.alpha=X.baseColorFactor[3]):d.albedoColor=P.pd.White(),X.baseColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/baseColorTexture`,X.baseColorTexture,(C=>{C.name=`${d.name} (Base Color)`,d.albedoTexture=C})))),c.doubleSided&&(d.Jc=!1,d.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(C,c,d),Promise.all(b).then((()=>{}))}}x(hC),y(hC,!0,(C=>new LC(C)));const fC="KHR_materials_clearcoat";class TC{constructor(C){this.name=fC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(fC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadClearCoatPropertiesAsync(b,X,d)),await Promise.all(P)}))}_loadClearCoatPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return d.clearCoat.isEnabled=!0,d.clearCoat.useRoughnessFromMainTexture=!1,d.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?d.clearCoat.Qc=c.clearcoatFactor:d.clearCoat.Qc=0,c.clearcoatTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatTexture`,c.clearcoatTexture,(C=>{C.name=`${d.name} (ClearCoat)`,d.clearCoat.texture=C}))),void 0!=c.clearcoatRoughnessFactor?d.clearCoat.roughness=c.clearcoatRoughnessFactor:d.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(C=>{C.name=`${d.name} (ClearCoat Roughness)`,d.clearCoat.textureRoughness=C})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(C=>{C.name=`${d.name} (ClearCoat Normal)`,d.clearCoat.bumpTexture=C}))),d.invertNormalMapX=!d.NC().useRightHandedSystem,d.invertNormalMapY=d.NC().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(d.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(b).then((()=>{}))}}x(fC),y(fC,!0,(C=>new TC(C)));const zC="KHR_materials_iridescence";class wC{constructor(C){this.name=zC,this.order=195,this._loader=C,this.enabled=this._loader.isExtensionUsed(zC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadIridescencePropertiesAsync(b,X,d)),await Promise.all(P).then((()=>{}))}))}_loadIridescencePropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return d.iridescence.isEnabled=!0,d.iridescence.Qc=c.iridescenceFactor??0,d.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,d.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,d.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/iridescenceTexture`,c.iridescenceTexture,(C=>{C.name=`${d.name} (Iridescence)`,d.iridescence.texture=C}))),c.iridescenceThicknessTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(C=>{C.name=`${d.name} (Iridescence Thickness)`,d.iridescence.thicknessTexture=C}))),Promise.all(b).then((()=>{}))}}x(zC),y(zC,!0,(C=>new wC(C)));const JC="KHR_materials_anisotropy";class yC{constructor(C){this.name=JC,this.order=195,this._loader=C,this.enabled=this._loader.isExtensionUsed(JC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadIridescencePropertiesAsync(b,X,d)),await Promise.all(P)}))}async _loadIridescencePropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;d.anisotropy.isEnabled=!0,d.anisotropy.Qc=c.anisotropyStrength??0,d.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${C}/anisotropyTexture`,c.anisotropyTexture,(C=>{C.name=`${d.name} (Anisotropy Intensity)`,d.anisotropy.texture=C})))),await Promise.all(b)}}x(JC),y(JC,!0,(C=>new yC(C)));const xC="KHR_materials_emissive_strength";class HC{constructor(C){this.name=xC,this.order=170,this._loader=C,this.enabled=this._loader.isExtensionUsed(xC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>await this._loader.loadMaterialPropertiesAsync(C,c,d).then((()=>{this._loadEmissiveProperties(b,X,d)}))))}_loadEmissiveProperties(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);void 0!==c.emissiveStrength&&(d.emissiveIntensity=c.emissiveStrength)}}x(xC),y(xC,!0,(C=>new HC(C)));const vC="KHR_materials_sheen";class DC{constructor(C){this.name=vC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(vC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadSheenPropertiesAsync(b,X,d)),await Promise.all(P).then((()=>{}))}))}_loadSheenPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return d.sheen.isEnabled=!0,d.sheen.Qc=1,void 0!=c.sheenColorFactor?d.sheen.color=P.pd.jd(c.sheenColorFactor):d.sheen.color=P.pd.Black(),c.sheenColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/sheenColorTexture`,c.sheenColorTexture,(C=>{C.name=`${d.name} (Sheen Color)`,d.sheen.texture=C}))),void 0!==c.sheenRoughnessFactor?d.sheen.roughness=c.sheenRoughnessFactor:d.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${C}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(C=>{C.name=`${d.name} (Sheen Roughness)`,d.sheen.textureRoughness=C})))),d.sheen.albedoScaling=!0,d.sheen.useRoughnessFromMainTexture=!1,Promise.all(b).then((()=>{}))}}x(vC),y(vC,!0,(C=>new DC(C)));var sC=d(12886);const mc="KHR_materials_specular";class QC{constructor(C){this.name=mc,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(mc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;if(P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadSpecularPropertiesAsync(b,X,d)),X.extensions&&X.extensions.EXT_materials_specular_edge_color&&d instanceof e.c){X.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(d.brdf.dielectricSpecularModel=sC.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,d.brdf.conductorSpecularModel=sC.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(P).then((()=>{}))}))}_loadSpecularPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return void 0!==c.specularFactor&&(d.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(d.metallicReflectanceColor=P.pd.jd(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${C}/specularTexture`,c.specularTexture,(C=>{C.name=`${d.name} (Specular)`,d.metallicReflectanceTexture=C,d.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/specularColorTexture`,c.specularColorTexture,(C=>{C.name=`${d.name} (Specular Color)`,d.reflectanceTexture=C}))),Promise.all(b).then((()=>{}))}}x(mc),y(mc,!0,(C=>new QC(C)));const IC="KHR_materials_ior";class oC{constructor(C){this.name=IC,this.order=180,this._loader=C,this.enabled=this._loader.isExtensionUsed(IC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadIorPropertiesAsync(b,X,d)),await Promise.all(P).then((()=>{}))}))}_loadIorPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);return void 0!==c.ior?d.indexOfRefraction=c.ior:d.indexOfRefraction=oC._DEFAULT_IOR,Promise.resolve()}}oC._DEFAULT_IOR=1.5,x(IC),y(IC,!0,(C=>new oC(C)));const FC="KHR_materials_variants";class YC{constructor(C){this.name=FC,this._loader=C,this.enabled=this._loader.isExtensionUsed(FC)}dispose(){this._loader=null}static GetAvailableVariants(C){const c=this._GetExtensionMetadata(C);return c?Object.keys(c.variants):[]}getAvailableVariants(C){return YC.GetAvailableVariants(C)}static SelectVariant(C,c){const d=this._GetExtensionMetadata(C);if(!d)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${FC} extension`);const b=C=>{const c=d.variants[C];if(c)for(const d of c)d.mesh.material=d.material};if(c instanceof Array)for(const X of c)b(X);else b(c);d.lastSelected=c}selectVariant(C,c){YC.SelectVariant(C,c)}static Reset(C){const c=this._GetExtensionMetadata(C);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${FC} extension`);for(const d of c.original)d.mesh.material=d.material;c.lastSelected=null}reset(C){YC.Reset(C)}static GetLastSelectedVariant(C){const c=this._GetExtensionMetadata(C);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${FC} extension`);return c.lastSelected}getLastSelectedVariant(C){return YC.GetLastSelectedVariant(C)}static _GetExtensionMetadata(C){var c,d;return(null===C||void 0===C||null===(c=C._internalMetadata)||void 0===c||null===(d=c.ec)||void 0===d?void 0:d[FC])||null}onLoading(){const C=this._loader.ec.extensions;if(C&&C[this.name]){const c=C[this.name];this._variants=c.variants}}onReady(){const C=this._loader.rootBabylonMesh;if(C){var c;const d=this._loader.parent.extensionOptions[FC];null!==d&&void 0!==d&&d.defaultVariant&&YC.SelectVariant(C,d.defaultVariant),null===d||void 0===d||null===(c=d.onLoaded)||void 0===c||c.call(d,{get variants(){return YC.GetAvailableVariants(C)},get selectedVariant(){const c=YC.GetLastSelectedVariant(C);return c?Array.isArray(c)?c[0]:c:YC.GetAvailableVariants(C)[0]},set selectedVariant(c){YC.SelectVariant(C,c)}})}}_loadMeshPrimitiveAsync(C,c,d,b,X,P){return Q.LoadExtensionAsync(C,X,this.name,(async(V,R)=>{const p=new Array;return p.push(this._loader._loadMeshPrimitiveAsync(C,c,d,b,X,(c=>{if(P(c),c instanceof M.b){const d=Q._GetDrawMode(C,X.mode),b=this._loader.rootBabylonMesh,P=b?b._internalMetadata=b._internalMetadata||{}:{},j=P.ec=P.ec||{},g=j[FC]=j[FC]||{lastSelected:null,original:[],variants:{}};g.original.push({mesh:c,material:c.material});for(let C=0;C<R.mappings.length;++C){const X=R.mappings[C],P=s.Get(`${V}/mappings/${C}/material`,this._loader.ec.materials,X.material);p.push(this._loader._loadMaterialAsync(`#/materials/${X.material}`,P,c,d,(C=>{for(let d=0;d<X.variants.length;++d){const P=X.variants[d],V=s.Get(`/extensions/${FC}/variants/${P}`,this._variants,P);g.variants[V.name]=g.variants[V.name]||[],g.variants[V.name].push({mesh:c,material:C}),c.onClonedObservable.add((C=>{const d=C;let X=null,P=d;do{if(P=P.parent,!P)return;X=YC._GetExtensionMetadata(P)}while(null===X);if(b&&X===YC._GetExtensionMetadata(b)){P._internalMetadata={};for(const C in b._internalMetadata)P._internalMetadata[C]=b._internalMetadata[C];P._internalMetadata.ec=[];for(const C in b._internalMetadata.ec)P._internalMetadata.ec[C]=b._internalMetadata.ec[C];P._internalMetadata.ec[FC]={lastSelected:null,original:[],variants:{}};for(const C of X.original)P._internalMetadata.ec[FC].original.push({mesh:C.mesh,material:C.material});for(const C in X.variants)if(Object.prototype.hasOwnProperty.call(X.variants,C)){P._internalMetadata.ec[FC].variants[C]=[];for(const c of X.variants[C])P._internalMetadata.ec[FC].variants[C].push({mesh:c.mesh,material:c.material})}X=P._internalMetadata.ec[FC]}for(const b of X.original)b.mesh===c&&(b.mesh=d);for(const b of X.variants[V.name])b.mesh===c&&(b.mesh=d)}))}})))}}}))),await Promise.all(p).then((C=>{let[c]=C;return c}))}))}}x(FC),y(FC,!0,(C=>new YC(C)));var lC=d(12456);class SC{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:sC.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(C,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...SC._GetDefaultOptions(),...C},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new g.b,this._scene.Uc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(C){if(!Object.keys(C).filter((c=>this._options[c]!==C[c])).length)return;const c={...this._options,...C},d=this._options;this._options=c,c.renderSize===d.renderSize&&c.renderTargetTextureType===d.renderTargetTextureType&&c.generateMipmaps===d.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(C){return!!C&&!!(C instanceof e.c&&C.subSurface.isRefractionEnabled)}_addMesh(C){this._materialObservers[C.uniqueId]=C.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),V.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(C.material)?(C.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(C)&&this._transparentMeshesCache.push(C)):-1===this._opaqueMeshesCache.indexOf(C)&&this._opaqueMeshesCache.push(C)}))}_removeMesh(C){C.onMaterialChangedObservable.remove(this._materialObservers[C.uniqueId]),delete this._materialObservers[C.uniqueId];let c=this._transparentMeshesCache.indexOf(C);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(C),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(C){const c=this._transparentMeshesCache.indexOf(C),d=this._opaqueMeshesCache.indexOf(C);this._shouldRenderAsTransmission(C.material)?(C.material instanceof e.c&&(C.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==d?(this._opaqueMeshesCache.splice(d,1),this._transparentMeshesCache.push(C)):-1===c&&this._transparentMeshesCache.push(C)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(C)):-1===d&&this._opaqueMeshesCache.push(C)}_isRenderTargetValid(){var C;return null!==(null===(C=this._opaqueRenderTarget)||void 0===C?void 0:C.getInternalTexture())}_setupRenderTargets(){var C;let c;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new lC.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(C=this._options.clearColor)||void 0===C?void 0:C.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((C=>{c=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?C.clearColor.V(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(C.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=c}));for(const d of this._transparentMeshesCache)this._shouldRenderAsTransmission(d.material)&&(d.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const GC="KHR_materials_transmission";class aC{constructor(C){this.name=GC,this.order=175,this._loader=C,this.enabled=this._loader.isExtensionUsed(GC),this.enabled&&(C.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadTransparentPropertiesAsync(b,c,d,X)),await Promise.all(P).then((()=>{}))}))}_loadTransparentPropertiesAsync(C,c,d,b){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const X=d;if(X.subSurface.isRefractionEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.useAlbedoToTintRefraction=!0,void 0===b.transmissionFactor)return X.subSurface.refractionIntensity=0,X.subSurface.isRefractionEnabled=!1,Promise.resolve();{var P;X.subSurface.refractionIntensity=b.transmissionFactor;const C=X.NC();if(X.subSurface.refractionIntensity&&!C._transmissionHelper)new SC({},X.NC());else if(X.subSurface.refractionIntensity&&(null===(P=C._transmissionHelper)||void 0===P||!P._isRenderTargetValid())){var V;null===(V=C._transmissionHelper)||void 0===V||V._setupRenderTargets()}}return X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,b.transmissionTexture?(b.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${C}/transmissionTexture`,b.transmissionTexture,void 0).then((C=>{C.name=`${d.name} (Transmission)`,X.subSurface.refractionIntensityTexture=C,X.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(GC),y(GC,!0,(C=>new aC(C)));const OC="KHR_materials_diffuse_transmission";class Cc{constructor(C){this.name=OC,this.order=174,this._loader=C,this.enabled=this._loader.isExtensionUsed(OC),this.enabled&&(C.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadTranslucentPropertiesAsync(b,c,d,X)),await Promise.all(P).then((()=>{}))}))}_loadTranslucentPropertiesAsync(C,c,d,b){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const X=d;if(X.subSurface.isTranslucencyEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,X.subSurface.useAlbedoToTintTranslucency=!1,void 0===b.diffuseTransmissionFactor)return X.subSurface.translucencyIntensity=0,X.subSurface.isTranslucencyEnabled=!1,Promise.resolve();X.subSurface.translucencyIntensity=b.diffuseTransmissionFactor;const V=new Array;return X.subSurface.useGltfStyleTextures=!0,b.diffuseTransmissionTexture&&(b.diffuseTransmissionTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTransmissionTexture`,b.diffuseTransmissionTexture).then((C=>{C.name=`${d.name} (Diffuse Transmission)`,X.subSurface.translucencyIntensityTexture=C})))),void 0!==b.diffuseTransmissionColorFactor?X.subSurface.translucencyColor=P.pd.jd(b.diffuseTransmissionColorFactor):X.subSurface.translucencyColor=P.pd.White(),b.diffuseTransmissionColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTransmissionColorTexture`,b.diffuseTransmissionColorTexture).then((C=>{C.name=`${d.name} (Diffuse Transmission Color)`,X.subSurface.translucencyColorTexture=C}))),Promise.all(V).then((()=>{}))}}x(OC),y(OC,!0,(C=>new Cc(C)));const cc="KHR_materials_volume";class dc{constructor(C){this.name=cc,this.order=173,this._loader=C,this.enabled=this._loader.isExtensionUsed(cc),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadVolumePropertiesAsync(b,c,d,X)),await Promise.all(P).then((()=>{}))}))}_loadVolumePropertiesAsync(C,c,d,b){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);if(!d.subSurface.isRefractionEnabled&&!d.subSurface.isTranslucencyEnabled||!b.thicknessFactor)return Promise.resolve();d.subSurface.volumeIndexOfRefraction=d.indexOfRefraction;const X=void 0!==b.attenuationDistance?b.attenuationDistance:Number.MAX_VALUE;return d.subSurface.tintColorAtDistance=X,void 0!==b.attenuationColor&&3==b.attenuationColor.length&&d.subSurface.tintColor.yc(b.attenuationColor[0],b.attenuationColor[1],b.attenuationColor[2]),d.subSurface.minimumThickness=0,d.subSurface.maximumThickness=b.thicknessFactor,d.subSurface.useThicknessAsDepth=!0,b.thicknessTexture?(b.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${C}/thicknessTexture`,b.thicknessTexture).then((C=>{C.name=`${d.name} (Thickness)`,d.subSurface.thicknessTexture=C,d.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(cc),y(cc,!0,(C=>new dc(C)));const bc="KHR_materials_dispersion";class Xc{constructor(C){this.name=bc,this.order=174,this._loader=C,this.enabled=this._loader.isExtensionUsed(bc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadDispersionPropertiesAsync(b,c,d,X)),await Promise.all(P).then((()=>{}))}))}_loadDispersionPropertiesAsync(C,c,d,b){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);return d.subSurface.isRefractionEnabled&&b.dispersion?(d.subSurface.isDispersionEnabled=!0,d.subSurface.dispersion=b.dispersion,Promise.resolve()):Promise.resolve()}}x(bc),y(bc,!0,(C=>new Xc(C)));const Pc="EXT_materials_diffuse_roughness";class Vc{constructor(C){this.name=Pc,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(Pc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(C,c,d)),P.push(this._loadDiffuseRoughnessPropertiesAsync(b,X,d)),await Promise.all(P).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(C,c,d){if(!(d instanceof e.c))throw new Error(`${C}: Material type not supported`);const b=new Array;return d.brdf.baseDiffuseModel=sC.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=c.diffuseRoughnessFactor?d.baseDiffuseRoughness=c.diffuseRoughnessFactor:d.baseDiffuseRoughness=0,c.diffuseRoughnessTexture&&b.push(this._loader.loadTextureInfoAsync(`${C}/diffuseRoughnessTexture`,c.diffuseRoughnessTexture,(C=>{C.name=`${d.name} (Diffuse Roughness)`,d.baseDiffuseRoughnessTexture=C}))),Promise.all(b).then((()=>{}))}}x(Pc),y(Pc,!0,(C=>new Vc(C)));const Rc="KHR_mesh_quantization";class pc{constructor(C){this.name=Rc,this.enabled=C.isExtensionUsed(Rc)}dispose(){}}x(Rc),y(Rc,!0,(C=>new pc(C)));const jc="KHR_texture_basisu";class gc{constructor(C){this.name=jc,this._loader=C,this.enabled=C.isExtensionUsed(jc)}dispose(){this._loader=null}_loadTextureAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>{const P=void 0==c.sampler?Q.DefaultSampler:s.Get(`${C}/sampler`,this._loader.ec.samplers,c.sampler),V=s.Get(`${b}/source`,this._loader.ec.images,X.source);return await this._loader._createTextureAsync(C,P,V,(C=>{d(C)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}x(jc),y(jc,!0,(C=>new gc(C)));const kc="KHR_texture_transform";class Zc{constructor(C){this.name=kc,this._loader=C,this.enabled=this._loader.isExtensionUsed(kc)}dispose(){this._loader=null}loadTextureInfoAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(b,X)=>await this._loader.loadTextureInfoAsync(C,c,(C=>{if(!(C instanceof n.b))throw new Error(`${b}: Texture type not supported`);X.offset&&(C.uOffset=X.offset[0],C.vOffset=X.offset[1]),C.uRotationCenter=0,C.vRotationCenter=0,X.rotation&&(C.wAng=-X.rotation),X.scale&&(C.uScale=X.scale[0],C.vScale=X.scale[1]),void 0!=X.texCoord&&(C.coordinatesIndex=X.texCoord),d(C)}))))}}x(kc),y(kc,!0,(C=>new Zc(C)));const Uc="KHR_xmp_json_ld";class Ac{constructor(C){this.name=Uc,this.order=100,this._loader=C,this.enabled=this._loader.isExtensionUsed(Uc)}dispose(){this._loader=null}onLoading(){var C,c,d;if(null===this._loader.rootBabylonMesh)return;const b=null===(C=this._loader.ec.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld,X=null===(c=this._loader.ec.asset)||void 0===c||null===(d=c.extensions)||void 0===d?void 0:d.KHR_xmp_json_ld;if(b&&X){const C=+X.packet;b.packets&&C<b.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=b.packets[C])}}}function uc(C,c,d,b){return P.pd.jd(c,d).scale(b)}function qc(C,c,d,b){return c[d]*b}function Bc(C,c,d,b){return-c[d]*b}function tc(C,c,d,b){return c[d+1]*b}function ec(C,c,d,b){return c[d]*b*2}function nc(C){return{scale:[new Ec(Z.b.ANIMATIONTYPE_FLOAT,`${C}.uScale`,qc,(()=>2)),new Ec(Z.b.ANIMATIONTYPE_FLOAT,`${C}.vScale`,tc,(()=>2))],offset:[new Ec(Z.b.ANIMATIONTYPE_FLOAT,`${C}.uOffset`,qc,(()=>2)),new Ec(Z.b.ANIMATIONTYPE_FLOAT,`${C}.vOffset`,tc,(()=>2))],rotation:[new Ec(Z.b.ANIMATIONTYPE_FLOAT,`${C}.wAng`,Bc,(()=>1))]}}x(Uc),y(Uc,!0,(C=>new Ac(C)));class Wc extends I.AnimationPropertyInfo{buildAnimations(C,c,d,b){return[{babylonAnimatable:C._babylonCamera,babylonAnimation:this._buildAnimation(c,d,b)}]}}class Ec extends I.AnimationPropertyInfo{buildAnimations(C,c,d,b){const X=[];for(const P in C._data)X.push({babylonAnimatable:C._data[P].babylonMaterial,babylonAnimation:this._buildAnimation(c,d,b)});return X}}class Nc extends I.AnimationPropertyInfo{buildAnimations(C,c,d,b){return[{babylonAnimatable:C._babylonLight,babylonAnimation:this._buildAnimation(c,d,b)}]}}(0,H.m)("/cameras/{}/orthographic/xmag",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Bc,(()=>1)),new Wc(Z.b.ANIMATIONTYPE_FLOAT,"orthoRight",tc,(()=>1))]),(0,H.m)("/cameras/{}/orthographic/ymag",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Bc,(()=>1)),new Wc(Z.b.ANIMATIONTYPE_FLOAT,"orthoTop",tc,(()=>1))]),(0,H.m)("/cameras/{}/orthographic/zfar",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"maxZ",qc,(()=>1))]),(0,H.m)("/cameras/{}/orthographic/znear",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"Lc",qc,(()=>1))]),(0,H.m)("/cameras/{}/perspective/yfov",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"fov",qc,(()=>1))]),(0,H.m)("/cameras/{}/perspective/zfar",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"maxZ",qc,(()=>1))]),(0,H.m)("/cameras/{}/perspective/znear",[new Wc(Z.b.ANIMATIONTYPE_FLOAT,"Lc",qc,(()=>1))]),(0,H.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Ec(Z.b.ANIMATIONTYPE_COLOR3,"albedoColor",uc,(()=>4)),new Ec(Z.b.ANIMATIONTYPE_FLOAT,"alpha",(function(C,c,d,b){return c[d+3]*b}),(()=>4))]),(0,H.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"metallic",qc,(()=>1))]),(0,H.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"roughness",qc,(()=>1))]);const rc=nc("albedoTexture");(0,H.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",rc.scale),(0,H.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",rc.offset),(0,H.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",rc.rotation);const Mc=nc("metallicTexture");(0,H.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Mc.scale),(0,H.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Mc.offset),(0,H.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Mc.rotation),(0,H.m)("/materials/{}/emissiveFactor",[new Ec(Z.b.ANIMATIONTYPE_COLOR3,"emissiveColor",uc,(()=>3))]);const Kc=nc("bumpTexture");(0,H.m)("/materials/{}/normalTexture/scale",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",qc,(()=>1))]),(0,H.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Kc.scale),(0,H.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Kc.offset),(0,H.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Kc.rotation),(0,H.m)("/materials/{}/occlusionTexture/strength",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",qc,(()=>1))]);const ic=nc("ambientTexture");(0,H.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",ic.scale),(0,H.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",ic.offset),(0,H.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",ic.rotation);const hc=nc("emissiveTexture");(0,H.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",hc.scale),(0,H.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",hc.offset),(0,H.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",hc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",qc,(()=>1))]);const Lc=nc("anisotropy.texture");(0,H.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Lc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Lc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Lc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",qc,(()=>1))]);const fc=nc("clearCoat.texture");(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",fc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",fc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",fc.rotation);const Tc=nc("clearCoat.bumpTexture");(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Tc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Tc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Tc.rotation);const zc=nc("clearCoat.textureRoughness");(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",zc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",zc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",zc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",qc,(()=>1))]);const wc=nc("iridescence.texture");(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",wc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",wc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",wc.rotation);const Jc=nc("iridescence.thicknessTexture");(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Jc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Jc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Jc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Ec(Z.b.ANIMATIONTYPE_COLOR3,"sheen.color",uc,(()=>3))]),(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",qc,(()=>1))]);const yc=nc("sheen.texture");(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",yc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",yc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",yc.rotation);const xc=nc("sheen.textureRoughness");(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",xc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",xc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",xc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Ec(Z.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",uc,(()=>3))]);const Hc=nc("metallicReflectanceTexture");(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Hc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Hc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Hc.rotation);const vc=nc("reflectanceTexture");(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",vc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",vc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",vc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",qc,(()=>1))]);const Dc=nc("subSurface.refractionIntensityTexture");(0,H.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Dc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Dc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Dc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Ec(Z.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",uc,(()=>3))]),(0,H.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",qc,(()=>1))]),(0,H.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",qc,(()=>1))]);const sc=nc("subSurface.thicknessTexture");(0,H.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",sc.scale),(0,H.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",sc.offset),(0,H.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",sc.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Ec(Z.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",qc,(()=>1))]);const md=nc("subSurface.translucencyIntensityTexture");(0,H.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",md.scale),(0,H.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",md.offset),(0,H.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",md.rotation),(0,H.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Ec(Z.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",uc,(()=>3))]);const Qc=nc("subSurface.translucencyColorTexture");(0,H.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Qc.scale),(0,H.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Qc.offset),(0,H.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Qc.rotation),(0,H.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new Nc(Z.b.ANIMATIONTYPE_COLOR3,"diffuse",uc,(()=>3))]),(0,H.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Nc(Z.b.ANIMATIONTYPE_FLOAT,"intensity",qc,(()=>1))]),(0,H.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new Nc(Z.b.ANIMATIONTYPE_FLOAT,"range",qc,(()=>1))]),(0,H.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Nc(Z.b.ANIMATIONTYPE_FLOAT,"innerAngle",ec,(()=>1))]),(0,H.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Nc(Z.b.ANIMATIONTYPE_FLOAT,"angle",ec,(()=>1))]),(0,H.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new Nc(Z.b.ANIMATIONTYPE_COLOR3,"diffuse",uc,(()=>3))]),(0,H.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Nc(Z.b.ANIMATIONTYPE_FLOAT,"intensity",qc,(()=>1))]);const Ic="KHR_animation_pointer";class oc{constructor(C){this.name=Ic,this._loader=C,this._pathToObjectConverter=(0,H.k)(this._loader.ec)}get enabled(){return this._loader.isExtensionUsed(Ic)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(C,c,d,b,X){var P;const V=null===(P=b.target.extensions)||void 0===P?void 0:P.KHR_animation_pointer;if(!V||!this._pathToObjectConverter)return null;"pointer"!==b.target.path&&u.d.Warn(`${C}/target/path: Value (${b.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=b.target.node&&u.d.Warn(`${C}/target/node: Value (${b.target.node}) must not be present when using the ${this.name} extension`);const R=`${C}/extensions/${this.name}`,p=V.pointer;if(!p)throw new Error(`${R}: Pointer is missing`);try{const P=this._pathToObjectConverter.convert(p);if(!P.info.interpolation)throw new Error(`${R}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(C,c,d,b,{object:P.object,info:P.info.interpolation},X)}catch(j){return u.d.Warn(`${R}/pointer: Invalid pointer (${p}) skipped`),null}}}x(Ic),y(Ic,!0,(C=>new oc(C)));class Fc{constructor(C,c,d){this.frame=C,this.action=c,this.onlyOnce=d,this.isDone=!1}_clone(){return new Fc(this.frame,this.action,this.onlyOnce)}}var Yc=d(12243),lc=d(12283),Sc=d(12281);class Gc{get loop(){return this._loop}set loop(C){C!==this._loop&&(this._loop=C,this.updateOptions({loop:C}))}get currentTime(){var C;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(C=lc.c.audioEngine)&&void 0!==C&&C.audioContext&&(this.isPlaying||this.isPaused)){const C=this.isPaused?0:lc.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+C}return 0}get spatialSound(){return this._spatialSound}set spatialSound(C){if(C==this._spatialSound)return;const c=this.isPlaying;this.pause(),C?(this._spatialSound=C,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(C,c,d){var b;let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new g.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=X.dd.Zero(),this._localDirection=new X.dd(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=C,d=d||A.c.LastCreatedScene)if(this._scene=d,Gc._SceneComponentInitialization(d),this._readyToPlayCallback=P,this._customAttenuationFunction=(C,c,d,b,X)=>c<d?C*(1-c/d):0,R&&(this.autoplay=R.autoplay||!1,this._loop=R.loop||!1,void 0!==R.volume&&(this._volume=R.volume),this._spatialSound=R.spatialSound??!1,this.maxDistance=R.maxDistance??100,this.useCustomAttenuation=R.useCustomAttenuation??!1,this.rolloffFactor=R.rolloffFactor||1,this.refDistance=R.refDistance||1,this.distanceModel=R.distanceModel||"linear",this._playbackRate=R.playbackRate||1,this._streaming=R.streaming??!1,this._length=R.length,this._offset=R.offset),null!==(b=lc.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&lc.c.audioEngine.audioContext){this._soundGain=lc.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let C=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let d=[],b=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lc.c.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lc.c.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(b=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":d.push(c);case"Array":0===d.length&&(d=c);for(let C=0;C<d.length;C++){const c=d[C];if(b=R&&R.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&lc.c.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&lc.c.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),b){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,V.Tools.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(C=>{this._soundLoaded(C)}),void 0,!0,!0,(C=>{C&&u.d.Error("XHR "+C.status+" error on: "+c+"."),u.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:C=!1}C?b||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):u.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(p){u.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),lc.c.audioEngine&&!lc.c.audioEngine.WarnedWebAudioUnsupported&&(u.d.Error("Web Audio is not supported by your browser."),lc.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var C;null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(C){var c;null!==(c=lc.c.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=C,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(C){var c;null!==(c=lc.c.audioEngine)&&void 0!==c&&c.audioContext&&lc.c.audioEngine.audioContext.decodeAudioData(C,(C=>{this._audioBufferLoaded(C)}),(C=>{u.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+C)}))}setAudioBuffer(C){var c;null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=C,this._isReadyToPlay=!0)}updateOptions(C){C&&(this.loop=C.loop??this.loop,this.maxDistance=C.maxDistance??this.maxDistance,this.useCustomAttenuation=C.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=C.rolloffFactor??this.rolloffFactor,this.refDistance=C.refDistance??this.refDistance,this.distanceModel=C.distanceModel??this.distanceModel,this._playbackRate=C.playbackRate??this._playbackRate,this._length=C.length??void 0,this.spatialSound=C.spatialSound??this._spatialSound,this._setOffset(C.offset??void 0),this.setVolume(C.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var C;null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&lc.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??lc.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var C;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(C=this._soundPanner)||void 0===C||C.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var C;null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(C){var c;null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(C),this._isOutputConnected=!0)}setDirectionalCone(C,c,d){c<C?u.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=C,this._coneOuterAngle=c,this._coneOuterGain=d,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(C){if(C!=this._coneInnerAngle){var c;if(this._coneOuterAngle<C)return void u.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=C,null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(C){if(C!=this._coneOuterAngle){var c;if(C<this._coneInnerAngle)return void u.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=C,null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(C){var c;C.equals(this._position)||(this._position.V(C),null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(C){var c;this._localDirection=C,null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const C=this._connectedTransformNode.getWorldMatrix(),c=X.dd.TransformNormal(this._localDirection,C);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var C;if(null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const C=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Xd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,C,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(C){this._customAttenuationFunction=C}play(C,c,d){var b;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(b=lc.c.audioEngine)&&void 0!==b&&b.audioContext)try{var X,P;this._clearTimeoutsAndObservers();let b=C?(null===(X=lc.c.audioEngine)||void 0===X?void 0:X.audioContext.currentTime)+C:null===(P=lc.c.audioEngine)||void 0===P?void 0:P.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=lc.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const C=()=>{var d;if(null!==(d=lc.c.audioEngine)&&void 0!==d&&d.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const d=this._htmlAudioElement.play();void 0!==d&&d.catch((()=>{var c,d;(null===(c=lc.c.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(d=lc.c.audioEngine)||void 0===d?void 0:d.onAudioUnlockedObservable.addOnce((()=>{C()})))}))}else{var b;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(b=lc.c.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{C()}))}};C()}}else{var V;const X=()=>{var X;if(null!==(X=lc.c.audioEngine)&&void 0!==X&&X.audioContext){var P;if(d=d||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const C=this._soundSource;C.onended=()=>{C.disconnect()}}if(this._soundSource=null===(P=lc.c.audioEngine)||void 0===P?void 0:P.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var V;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==d&&(this._soundSource.loopEnd=(0|c)+d),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},b=C?(null===(V=lc.c.audioEngine)||void 0===V?void 0:V.audioContext.currentTime)+C:lc.c.audioEngine.audioContext.currentTime;const X=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(b,X,this.loop?void 0:d)}}};"suspended"===(null===(V=lc.c.audioEngine)||void 0===V?void 0:V.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var C;"suspended"===(null===(C=lc.c.audioEngine)||void 0===C?void 0:C.audioContext.state)?(lc.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=lc.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{X()})))):X()}),500):X()}this._startTime=b,this.isPlaying=!0,this.isPaused=!1}catch(R){u.d.Error("Error while trying to play audio: "+this.name+", "+R.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(C){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1}else if(null!==(c=lc.c.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=C?lc.c.audioEngine.audioContext.currentTime+C:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var C;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(C=lc.c.audioEngine)&&void 0!==C&&C.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=lc.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(C,c){var d;null!==(d=lc.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._soundGain&&(c&&lc.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(lc.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,lc.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(C,lc.c.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=C),this._volume=C}setPlaybackRate(C){this._playbackRate=C,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(C){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=C,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=C=>this._onRegisterAfterWorldMatrixUpdate(C),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(C){var c;if(C.getBoundingInfo){const c=C.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(C.absolutePosition);null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const C=()=>{(0,Sc.f)((()=>this._isReadyToPlay),(()=>{d._audioBuffer=this.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,this._offset,this._length)}),void 0,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},d=new Gc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&d.setAttenuationFunction(this._customAttenuationFunction),d.setPosition(this._position),d.setPlaybackRate(this._playbackRate),C(),d}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const C={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(C.connectedMeshId=this._connectedTransformNode.id),C.position=this._position.rc(),C.refDistance=this.refDistance,C.distanceModel=this.distanceModel,C.isDirectional=this._isDirectional,C.localDirectionToMesh=this._localDirection.rc(),C.coneInnerAngle=this._coneInnerAngle,C.coneOuterAngle=this._coneOuterAngle,C.coneOuterGain=this._coneOuterGain),C}static Parse(C,c,d,b){const P=C.name;let V;V=C.url?d+C.url:d+P;const R={autoplay:C.autoplay,loop:C.loop,volume:C.volume,spatialSound:C.spatialSound,maxDistance:C.maxDistance,rolloffFactor:C.rolloffFactor,refDistance:C.refDistance,distanceModel:C.distanceModel,playbackRate:C.playbackRate};let p;if(b){const C=()=>{(0,Sc.f)((()=>b._isReadyToPlay),(()=>{p._audioBuffer=b.getAudioBuffer(),p._isReadyToPlay=!0,p.autoplay&&p.play(0,p._offset,p._length)}),void 0,300)};p=new Gc(P,new ArrayBuffer(0),c,null,R),C()}else p=new Gc(P,V,c,(()=>{c.removePendingData(p)}),R),c.addPendingData(p);if(C.position){const c=X.dd.jd(C.position);p.setPosition(c)}if(C.isDirectional&&(p.setDirectionalCone(C.coneInnerAngle||360,C.coneOuterAngle||360,C.coneOuterGain||0),C.localDirectionToMesh)){const c=X.dd.jd(C.localDirectionToMesh);p.setLocalDirectionToMesh(c)}if(C.connectedMeshId){const d=c.getMeshById(C.connectedMeshId);d&&p.attachToMesh(d)}return C.metadata&&(p.metadata=C.metadata),p}_setOffset(C){this._offset!==C&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=C)}_clearTimeoutsAndObservers(){var C;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(C=lc.c.audioEngine)||void 0===C||C.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Gc._SceneComponentInitialization=C=>{throw(0,Yc.c)("AudioSceneComponent")},(0,EC.e)("BABYLON.Sound",Gc);class ac{constructor(C,c,d){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==d.length)throw new Error("Sounds length does not equal weights length");this.loop=C,this._weights=d;let b=0;for(const P of d)b+=P;const X=b>0?1/b:0;for(let P=0;P<this._weights.length;P++)this._weights[P]*=X;this._sounds=c;for(const P of this._sounds)P.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(C){if(C!==this._coneInnerAngle){if(this._coneOuterAngle<C)return void u.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=C;for(const c of this._sounds)c.directionalConeInnerAngle=C}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(C){if(C!==this._coneOuterAngle){if(C<this._coneInnerAngle)return void u.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=C;for(const c of this._sounds)c.directionalConeOuterAngle=C}}get volume(){return this._volume}set volume(C){if(C!==this._volume)for(const c of this._sounds)c.setVolume(C)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(C){if(!this.isPaused){this.stop();const C=Math.random();let c=0;for(let d=0;d<this._weights.length;d++)if(c+=this._weights[d],C<=c){this._currentIndex=d;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:C):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Oc{constructor(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(C=C||A.c.LastCreatedScene)&&(this._scene=C,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var C;null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&lc.c.audioEngine.audioContext&&(this._outputAudioNode=lc.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(lc.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(lc.c.audioEngine&&lc.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(C){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&C.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==C.soundTrackId&&(-1===C.soundTrackId?this._scene.mainSoundTrack.removeSound(C):this._scene.soundTracks&&this._scene.soundTracks[C.soundTrackId].removeSound(C)),this.soundCollection.push(C),C.soundTrackId=this.id}removeSound(C){const c=this.soundCollection.indexOf(C);-1!==c&&this.soundCollection.splice(c,1)}setVolume(C){var c;null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=C)}switchPanningModelToHRTF(){var C;if(null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var C;if(null!==(C=lc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(C){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=C,null!==(c=lc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,lc.c.audioEngine.masterGain))}}var Cd=d(12670),cd=d(12637),dd=d(12227);lc.c.AudioEngineFactory=(C,c,d)=>new bd(C,c,d);class bd{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new g.b,this.onAudioLockedObservable=new g.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,dd.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const b=document.createElement("audio");this._hostElement=C,this._audioContext=c,this._audioDestination=d;try{b&&b.canPlayType&&(b.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||b.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(X){}try{b&&b.canPlayType&&b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(X){}}lock(){this._triggerSuspendedState()}unlock(){var C,c;if("running"===(null===(C=this._audioContext)||void 0===C?void 0:C.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{u.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var C;null===(C=this._audioContext)||void 0===C||C.addEventListener("statechange",(()=>{var C;this.unlocked&&"running"!==(null===(C=this._audioContext)||void 0===C?void 0:C.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var C;return null!==(C=this._audioContext)&&void 0!==C&&C.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(C){this.canUseWebAudio=!1,u.d.Error("Web Audio: "+C.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(C){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const C=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(C)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var C;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(C=this._audioContext)||void 0===C||C.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(C){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=C)}connectToAnalyser(C){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=C,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Xd=d(12241);(0,d(13805).g)(Cd.d.NAME_AUDIO,((C,c,d,b)=>{let X,P=[];if(d.gA=d.gA||[],void 0!==C.gA&&null!==C.gA)for(let R=0,p=C.gA.length;R<p;R++){var V;const p=C.gA[R];null!==(V=lc.c.audioEngine)&&void 0!==V&&V.canUseWebAudio?(p.url||(p.url=p.name),P[p.url]?d.gA.push(Gc.Parse(p,c,b,P[p.url])):(X=Gc.Parse(p,c,b),P[p.url]=X,d.gA.push(X))):d.gA.push(new Gc(p.name,null,c))}P=[]})),Object.defineProperty(cd.e.prototype,"mainSoundTrack",{get:function(){let C=this._getComponent(Cd.d.NAME_AUDIO);return C||(C=new Pd(this),this.gc(C)),this._mainSoundTrack||(this._mainSoundTrack=new Oc(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),cd.e.prototype.getSoundByName=function(C){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===C)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let d=0;d<this.soundTracks.length;d++)for(c=0;c<this.soundTracks[d].soundCollection.length;c++)if(this.soundTracks[d].soundCollection[c].name===C)return this.soundTracks[d].soundCollection[c];return null},Object.defineProperty(cd.e.prototype,"audioEnabled",{get:function(){let C=this._getComponent(Cd.d.NAME_AUDIO);return C||(C=new Pd(this),this.gc(C)),C.audioEnabled},set:function(C){let c=this._getComponent(Cd.d.NAME_AUDIO);c||(c=new Pd(this),this.gc(c)),C?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(cd.e.prototype,"headphone",{get:function(){let C=this._getComponent(Cd.d.NAME_AUDIO);return C||(C=new Pd(this),this.gc(C)),C.headphone},set:function(C){let c=this._getComponent(Cd.d.NAME_AUDIO);c||(c=new Pd(this),this.gc(c)),C?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(cd.e.prototype,"audioListenerPositionProvider",{get:function(){let C=this._getComponent(Cd.d.NAME_AUDIO);return C||(C=new Pd(this),this.gc(C)),C.audioListenerPositionProvider},set:function(C){let c=this._getComponent(Cd.d.NAME_AUDIO);if(c||(c=new Pd(this),this.gc(c)),C&&"function"!==typeof C)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=C},enumerable:!0,configurable:!0}),Object.defineProperty(cd.e.prototype,"audioListenerRotationProvider",{get:function(){let C=this._getComponent(Cd.d.NAME_AUDIO);return C||(C=new Pd(this),this.gc(C)),C.audioListenerRotationProvider},set:function(C){let c=this._getComponent(Cd.d.NAME_AUDIO);if(c||(c=new Pd(this),this.gc(c)),C&&"function"!==typeof C)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=C},enumerable:!0,configurable:!0}),Object.defineProperty(cd.e.prototype,"audioPositioningRefreshRate",{get:function(){let C=this._getComponent(Cd.d.NAME_AUDIO);return C||(C=new Pd(this),this.gc(C)),C.audioPositioningRefreshRate},set:function(C){let c=this._getComponent(Cd.d.NAME_AUDIO);c||(c=new Pd(this),this.gc(c)),c.audioPositioningRefreshRate=C},enumerable:!0,configurable:!0});class Pd{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(C){this.name=Cd.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new X.dd,this._cachedCameraPosition=new X.dd,this._lastCheck=0,this._invertMatrixTemp=new X.Matrix,this._cameraDirectionTemp=new X.dd,(C=C||A.c.LastCreatedScene)&&(this.Pd=C,C.soundTracks=[],C.gA=[])}register(){this.Pd._afterRenderStage.registerStep(Cd.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(C){if(C.gA=[],this.Pd.soundTracks)for(let c=0;c<this.Pd.soundTracks.length;c++){const d=this.Pd.soundTracks[c];for(let c=0;c<d.soundCollection.length;c++)C.gA.push(d.soundCollection[c].serialize())}}addFromContainer(C){if(C.gA)for(const c of C.gA)c.play(),c.autoplay=!0,this.Pd.mainSoundTrack.addSound(c)}removeFromContainer(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(C.gA)for(const d of C.gA)d.stop(),d.autoplay=!1,this.Pd.mainSoundTrack.removeSound(d),c&&d.dispose()}dispose(){const C=this.Pd;if(C._mainSoundTrack&&C.mainSoundTrack.dispose(),C.soundTracks)for(let c=0;c<C.soundTracks.length;c++)C.soundTracks[c].dispose()}disableAudio(){const C=this.Pd;let c;for(this._audioEnabled=!1,lc.c.audioEngine&&lc.c.audioEngine.audioContext&&lc.c.audioEngine.audioContext.suspend(),c=0;c<C.mainSoundTrack.soundCollection.length;c++)C.mainSoundTrack.soundCollection[c].pause();if(C.soundTracks)for(c=0;c<C.soundTracks.length;c++)for(let d=0;d<C.soundTracks[c].soundCollection.length;d++)C.soundTracks[c].soundCollection[d].pause()}enableAudio(){const C=this.Pd;let c;for(this._audioEnabled=!0,lc.c.audioEngine&&lc.c.audioEngine.audioContext&&lc.c.audioEngine.audioContext.resume(),c=0;c<C.mainSoundTrack.soundCollection.length;c++)C.mainSoundTrack.soundCollection[c].isPaused&&C.mainSoundTrack.soundCollection[c].play();if(C.soundTracks)for(c=0;c<C.soundTracks.length;c++)for(let d=0;d<C.soundTracks[c].soundCollection.length;d++)C.soundTracks[c].soundCollection[d].isPaused&&C.soundTracks[c].soundCollection[d].play()}switchAudioModeForHeadphones(){const C=this.Pd;if(this._headphone=!0,C.mainSoundTrack.switchPanningModelToHRTF(),C.soundTracks)for(let c=0;c<C.soundTracks.length;c++)C.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const C=this.Pd;if(this._headphone=!1,C.mainSoundTrack.switchPanningModelToEqualPower(),C.soundTracks)for(let c=0;c<C.soundTracks.length;c++)C.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const C=Xd.e.Now;if(this._lastCheck&&C-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=C;const c=this.Pd;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const d=lc.c.audioEngine;if(d&&d.audioContext){let C,b=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(b=c.activeCameras[0]),this.audioListenerPositionProvider){const C=this.audioListenerPositionProvider();d.audioContext.listener.setPosition(C.x||0,C.y||0,C.z||0)}else b?this._cachedCameraPosition.equals(b.globalPosition)||(this._cachedCameraPosition.V(b.globalPosition),d.audioContext.listener.setPosition(b.globalPosition.x,b.globalPosition.y,b.globalPosition.z)):d.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const C=this.audioListenerRotationProvider();d.audioContext.listener.setOrientation(C.x||0,C.y||0,C.z||0,0,1,0)}else b?(b.rigCameras&&b.rigCameras.length>0&&(b=b.rigCameras[0]),b.getViewMatrix().invertToRef(this._invertMatrixTemp),X.dd.TransformNormalToRef(Pd._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.V(this._cameraDirectionTemp),d.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):d.audioContext.listener.setOrientation(0,0,0,0,1,0);for(C=0;C<c.mainSoundTrack.soundCollection.length;C++){const d=c.mainSoundTrack.soundCollection[C];d.useCustomAttenuation&&d.updateDistanceFromListener()}if(c.soundTracks)for(C=0;C<c.soundTracks.length;C++)for(let d=0;d<c.soundTracks[C].soundCollection.length;d++){const b=c.soundTracks[C].soundCollection[d];b.useCustomAttenuation&&b.updateDistanceFromListener()}}}}Pd._CameraDirection=new X.dd(0,0,-1),Gc._SceneComponentInitialization=C=>{let c=C._getComponent(Cd.d.NAME_AUDIO);c||(c=new Pd(C),C.gc(c))};const Vd="MSFT_audio_emitter";class Rd{constructor(C){this.name=Vd,this._loader=C,this.enabled=this._loader.isExtensionUsed(Vd)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const C=this._loader.ec.extensions;if(C&&C[this.name]){const c=C[this.name];this._clips=c.clips,this._emitters=c.emitters,s.Assign(this._clips),s.Assign(this._emitters)}}loadSceneAsync(C,c){return Q.LoadExtensionAsync(C,c,this.name,(async(d,b)=>{const X=new Array;X.push(this._loader.loadSceneAsync(C,c));for(const C of b.emitters){const c=s.Get(`${d}/emitters`,this._emitters,C);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${d}: Direction or Distance properties are not allowed on emitters attached to a scene`);X.push(this._loadEmitterAsync(`${d}/emitters/${c.index}`,c))}await Promise.all(X)}))}loadNodeAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(C,b)=>{const P=new Array,R=await this._loader.loadNodeAsync(C,c,(c=>{for(const d of b.emitters){const b=s.Get(`${C}/emitters`,this._emitters,d);P.push(this._loadEmitterAsync(`${C}/emitters/${b.index}`,b).then((()=>{for(const C of b._babylonSounds)C.attachToMesh(c),void 0==b.innerAngle&&void 0==b.outerAngle||(C.setLocalDirectionToMesh(X.dd.Forward()),C.setDirectionalCone(2*V.Tools.ToDegrees(void 0==b.innerAngle?Math.PI:b.innerAngle),2*V.Tools.ToDegrees(void 0==b.outerAngle?Math.PI:b.outerAngle),0))})))}d(c)}));return await Promise.all(P),R}))}loadAnimationAsync(C,c){return Q.LoadExtensionAsync(C,c,this.name,(async(d,b)=>{const X=await this._loader.loadAnimationAsync(C,c),P=new Array;s.Assign(b.events);for(const V of b.events)P.push(this._loadAnimationEventAsync(`${d}/events/${V.index}`,C,c,V,X));return await Promise.all(P),X}))}_loadClipAsync(C,c){if(c._objectURL)return c._objectURL;let d;if(c.uri)d=this._loader.loadUriAsync(C,c,c.uri);else{const b=s.Get(`${C}/bufferView`,this._loader.ec.bufferViews,c.bufferView);d=this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return c._objectURL=d.then((C=>URL.createObjectURL(new Blob([C],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(C,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const C=new Array,d=c.name||`emitter${c.index}`,b={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let P=0;P<c.clips.length;P++){const X=`/extensions/${this.name}/clips`,V=s.Get(X,this._clips,c.clips[P].clip);C.push(this._loadClipAsync(`${X}/${c.clips[P].clip}`,V).then((C=>{const X=c._babylonSounds[P]=new Gc(d,C,this._loader.babylonScene,null,b);X.refDistance=c.refDistance||1,X.maxDistance=c.maxDistance||256,X.rolloffFactor=c.rolloffFactor||1,X.distanceModel=c.distanceModel||"exponential"})))}const X=Promise.all(C).then((()=>{const C=c.clips.map((C=>C.weight||1)),d=new ac(c.loop||!1,c._babylonSounds,C);c.innerAngle&&(d.directionalConeInnerAngle=2*V.Tools.ToDegrees(c.innerAngle)),c.outerAngle&&(d.directionalConeOuterAngle=2*V.Tools.ToDegrees(c.outerAngle)),c.volume&&(d.volume=c.volume),c._babylonData.sound=d}));c._babylonData={loaded:X}}return c._babylonData.loaded}_getEventAction(C,c,d,b,X){switch(d){case"play":return C=>{const d=(X||0)+(C-b);c.play(d)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${C}: Unsupported action ${d}`)}}_loadAnimationEventAsync(C,c,d,b,X){if(0==X.targetedAnimations.length)return Promise.resolve();const P=X.targetedAnimations[0],V=b.bc,R=s.Get(`/extensions/${this.name}/emitters`,this._emitters,V);return this._loadEmitterAsync(C,R).then((()=>{const c=R._babylonData.sound;if(c){const d=new Fc(b.time,this._getEventAction(C,c,b.action,b.time,b.startOffset));P.animation.addEvent(d),X.onAnimationGroupEndObservable.add((()=>{c.stop()})),X.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}x(Vd),y(Vd,!0,(C=>new Rd(C)));const pd="MSFT_lod";class jd{constructor(C){var c;this.name=pd,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new g.b,this.onMaterialLODsLoadedObservable=new g.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=C,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[pd])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(pd)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let C=0;C<this._nodePromiseLODs.length;C++){const c=Promise.all(this._nodePromiseLODs[C]).then((()=>{0!==C&&(this._loader.endPerformanceCounter(`Node LOD ${C}`),this._loader.log(`Loaded node LOD ${C}`)),this.onNodeLODsLoadedObservable.notifyObservers(C),C!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${C+1}`),this._loadBufferLOD(this._nodeBufferLODs,C+1),this._nodeSignalLODs[C]&&this._nodeSignalLODs[C].resolve())}));this._loader._completePromises.push(c)}for(let C=0;C<this._materialPromiseLODs.length;C++){const c=Promise.all(this._materialPromiseLODs[C]).then((()=>{0!==C&&(this._loader.endPerformanceCounter(`Material LOD ${C}`),this._loader.log(`Loaded material LOD ${C}`)),this.onMaterialLODsLoadedObservable.notifyObservers(C),C!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${C+1}`),this._loadBufferLOD(this._materialBufferLODs,C+1),this._materialSignalLODs[C]&&this._materialSignalLODs[C].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(C,c){const d=this._loader.loadSceneAsync(C,c);return this._loadBufferLOD(this._bufferLODs,0),d}loadNodeAsync(C,c,d){return Q.LoadExtensionAsync(C,c,this.name,(async(C,X)=>{let P;const V=this._getLODs(C,c,this._loader.ec.nodes,X.ids);this._loader.logOpen(`${C}`);for(let c=0;c<V.length;c++){const C=V[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new b);const X=C=>{d(C),C.Vj(!1)},R=this._loader.loadNodeAsync(`/nodes/${C.index}`,C,X).then((C=>{if(0!==c){const C=V[c-1];C._babylonTransformNode&&(this._disposeTransformNode(C._babylonTransformNode),delete C._babylonTransformNode)}return C.Vj(!0),C}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?P=R:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(R))}return this._loader.logClose(),await P}))}_loadMaterialAsync(C,c,d,b,X){return this._nodeIndexLOD?null:Q.LoadExtensionAsync(C,c,this.name,(async(C,P)=>{let V;const R=this._getLODs(C,c,this._loader.ec.materials,P.ids);this._loader.logOpen(`${C}`);for(let c=0;c<R.length;c++){const C=R[c];0!==c&&(this._materialIndexLOD=c);const P=this._loader._loadMaterialAsync(`/materials/${C.index}`,C,d,b,(C=>{0===c&&X(C)})).then((C=>{if(0!==c){X(C);const d=R[c-1]._data;d[b]&&(this._disposeMaterials([d[b].babylonMaterial]),delete d[b])}return C}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?V=P:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(P))}return this._loader.logClose(),await V}))}_loadUriAsync(C,c,d){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const X=this._nodeIndexLOD-1;return this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new b,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(C,c,d)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const X=this._materialIndexLOD-1;return this._materialSignalLODs[X]=this._materialSignalLODs[X]||new b,this._materialSignalLODs[X].promise.then((async()=>await this._loader.loadUriAsync(C,c,d)))}return null}loadBufferAsync(C,c,d,X){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${C}: Uri is missing or the binary glTF is missing its binary chunk`);const c=async(C,c)=>{const P=d,V=P+X-1;let R=C[c];return R?(R.start=Math.min(R.start,P),R.end=Math.max(R.end,V)):(R={start:P,end:V,loaded:new b},C[c]=R),await R.loaded.promise.then((C=>new Uint8Array(C.buffer,C.byteOffset+d-R.start,X)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(C,c){const d=C[c];d&&(this._loader.log(`Loading buffer range [${d.start}-${d.end}]`),this._loader.bin.readAsync(d.start,d.end-d.start+1).then((C=>{d.loaded.resolve(C)}),(C=>{d.loaded.reject(C)})))}_getLODs(C,c,d,b){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const X=[];for(let P=b.length-1;P>=0;P--)if(X.push(s.Get(`${C}/ids/${b[P]}`,d,b[P])),X.length===this.maxLODsToLoad)return X;return X.push(c),X}_disposeTransformNode(C){const c=[],d=C.material;d&&c.push(d);for(const X of C.getChildMeshes())X.material&&c.push(X.material);C.dispose();const b=c.filter((C=>this._loader.babylonScene.meshes.every((c=>c.material!=C))));this._disposeMaterials(b)}_disposeMaterials(C){const c={};for(const d of C){for(const C of d.getActiveTextures())c[C.uniqueId]=C;d.dispose()}for(const d in c)for(const C of this._loader.babylonScene.materials)C.hasTexture(c[d])&&delete c[d];for(const d in c)c[d].dispose()}}x(pd),y(pd,!0,(C=>new jd(C)));const gd="MSFT_minecraftMesh";class kd{constructor(C){this.name=gd,this._loader=C,this.enabled=this._loader.isExtensionUsed(gd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtraAsync(C,c,this.name,(async(b,X)=>{if(X){if(!(d instanceof e.c))throw new Error(`${b}: Material type not supported`);const X=this._loader.loadMaterialPropertiesAsync(C,c,d);return d.needAlphaBlending()&&(d.forceDepthWrite=!0,d.separateCullingPass=!0),d.Jc=d.forceDepthWrite,d.twoSidedLighting=!0,await X}}))}}x(gd),y(gd,!0,(C=>new kd(C)));const Zd="MSFT_sRGBFactors";class Ud{constructor(C){this.name=Zd,this._loader=C,this.enabled=this._loader.isExtensionUsed(Zd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,c,d){return Q.LoadExtraAsync(C,c,this.name,(async(b,X)=>{if(X){if(!(d instanceof e.c))throw new Error(`${b}: Material type not supported`);const X=this._loader.loadMaterialPropertiesAsync(C,c,d),P=d.NC().getEngine().useExactSrgbConversions;return d.albedoTexture||d.albedoColor.toLinearSpaceToRef(d.albedoColor,P),d.reflectivityTexture||d.reflectivityColor.toLinearSpaceToRef(d.reflectivityColor,P),await X}}))}}x(Zd),y(Zd,!0,(C=>new Ud(C)));var Ad=d(14108);const ud={};var qd=d(14172),Bd=d(14150),td=d(14115),ed=d(14126);function nd(C,c){for(const d of C)for(const C of d.dataOutputs)if(C.uniqueId===c)return C;throw new Error("Could not find data out connection with unique id "+c)}function Wd(C,c){for(const d of C)if(d instanceof Bd.d)for(const C of d.signalInputs)if(C.uniqueId===c)return C;throw new Error("Could not find signal in connection with unique id "+c)}async function Ed(C,c){const b=await Promise.all(C.allBlocks.map((async C=>{const c=function(C){switch(C){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([d.e(78),d.e(79)]).then(d.bind(d,15569))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await d.e(80).then(d.bind(d,15571))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await d.e(81).then(d.bind(d,15575))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await d.e(82).then(d.bind(d,15579))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await d.e(83).then(d.bind(d,15585))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await d.e(84).then(d.bind(d,15588))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await d.e(85).then(d.bind(d,15594))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await d.e(86).then(d.bind(d,15597))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await d.e(87).then(d.bind(d,15599))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await d.e(90).then(d.bind(d,15632))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await d.e(90).then(d.bind(d,15632))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await d.e(90).then(d.bind(d,15632))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await d.e(90).then(d.bind(d,15632))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await d.e(95).then(d.bind(d,15639))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await d.e(96).then(d.bind(d,15642))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await d.e(97).then(d.bind(d,15649))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await d.e(98).then(d.bind(d,15656))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await d.e(99).then(d.bind(d,15662))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await d.e(100).then(d.bind(d,15665))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await d.e(101).then(d.bind(d,15670))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await d.e(102).then(d.bind(d,15676))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await d.e(103).then(d.bind(d,15680))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await d.e(104).then(d.bind(d,15684))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await d.e(105).then(d.bind(d,15687))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await d.e(106).then(d.bind(d,15692))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await d.e(107).then(d.bind(d,15694))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await d.e(108).then(d.bind(d,15700))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await d.e(109).then(d.bind(d,15702))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await d.e(110).then(d.bind(d,15709))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await d.e(111).then(d.bind(d,15716))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await d.e(112).then(d.bind(d,15725))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await d.e(113).then(d.bind(d,15731))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await d.e(92).then(d.bind(d,15739))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await d.e(114).then(d.bind(d,15745))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await d.e(115).then(d.bind(d,15753))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await d.e(116).then(d.bind(d,15762))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await d.e(93).then(d.bind(d,15769))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await d.e(88).then(d.bind(d,15605))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await d.e(94).then(d.bind(d,15771))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await d.e(89).then(d.bind(d,15624))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await d.e(90).then(d.bind(d,15632))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await d.e(90).then(d.bind(d,15632))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await d.e(91).then(d.bind(d,15776))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await d.e(91).then(d.bind(d,15776))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await d.e(91).then(d.bind(d,15776))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await d.e(91).then(d.bind(d,15776))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await d.e(91).then(d.bind(d,15776))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await d.e(91).then(d.bind(d,15776))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await d.e(117).then(d.bind(d,15780))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await d.e(118).then(d.bind(d,15786))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await d.e(119).then(d.bind(d,15795))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await d.e(120).then(d.bind(d,15801))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await d.e(121).then(d.bind(d,15808))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await d.e(122).then(d.bind(d,15810))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await d.e(123).then(d.bind(d,15812))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await d.e(124).then(d.bind(d,15814))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await d.e(125).then(d.bind(d,15820))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await d.e(126).then(d.bind(d,15825))).FlowGraphDataSwitchBlock;default:if(ud[C])return ud[C];throw new Error(`Unknown block name ${C}`)}}(C.className);return await c()})));return function(C,c,d){const b=c.coordinator.createGraph(),X=[],P=c.valueParseFunction??td.d;for(let V=0;V<C.allBlocks.length;V++){const R=rd(C.allBlocks[V],{Pd:c.coordinator.config.Pd,pathConverter:c.pathConverter,assetsContainer:c.coordinator.config.Pd,valueParseFunction:P},d[V]);X.push(R),R instanceof qd.b&&b.addEventBlock(R)}for(const V of X){for(const C of V.dataInputs)for(const c of C.connectedPointIds){const d=nd(X,c);C.connectTo(d)}if(V instanceof Bd.d)for(const C of V.signalOutputs)for(const c of C.connectedPointIds){const d=Wd(X,c);C.connectTo(d)}}for(const V of C.executionContexts)Nd(V,{graph:b,valueParseFunction:P},C.rightHanded);return b}(C,c,b)}function Nd(C,c,d){const b=c.graph.createContext();C.enableLogging&&(b.enableLogging=!0),b.treatDataAsRightHanded=d||!1;const X=c.valueParseFunction??td.d;b.uniqueId=C.uniqueId;const P=b.NC();if(C._assetsContext){var V,R,p,j,g,k,Z,U,A,u;const c=C._assetsContext,d={meshes:null===(V=c.meshes)||void 0===V?void 0:V.map((C=>P.getMeshById(C))),lights:null===(R=c.lights)||void 0===R?void 0:R.map((C=>P.getLightByName(C))),cameras:null===(p=c.cameras)||void 0===p?void 0:p.map((C=>P.getCameraByName(C))),materials:null===(j=c.materials)||void 0===j?void 0:j.map((C=>P.getMaterialById(C))),textures:null===(g=c.textures)||void 0===g?void 0:g.map((C=>P.getTextureByName(C))),animations:null===(k=c.animations)||void 0===k?void 0:k.map((C=>P.animations.find((c=>c.name===C)))),skeletons:null===(Z=c.skeletons)||void 0===Z?void 0:Z.map((C=>P.getSkeletonByName(C))),LU:null===(U=c.LU)||void 0===U?void 0:U.map((C=>P.getParticleSystemById(C))),animationGroups:null===(A=c.animationGroups)||void 0===A?void 0:A.map((C=>P.getAnimationGroupByName(C))),transformNodes:null===(u=c.transformNodes)||void 0===u?void 0:u.map((C=>P.getTransformNodeById(C))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],gA:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};b.assetsContext=d}for(const q in C._userVariables){const c=X(q,C._userVariables,b.assetsContext,P);b.userVariables[q]=c}for(const q in C._connectionValues){const c=X(q,C._connectionValues,b.assetsContext,P);b._setConnectionValueByKey(q,c)}return b}function rd(C,c,d){const b={},X=c.valueParseFunction??td.d;if(C.config)for(const V in C.config)b[V]=X(V,C.config,c.assetsContainer||c.Pd,c.Pd);if((0,td.j)(C.className)){if(!c.pathConverter)throw new Error("Path converter is required for this block");b.pathConverter=c.pathConverter}const P=new d(b);P.uniqueId=C.uniqueId;for(let V=0;V<C.dataInputs.length;V++){const c=P.getDataInput(C.dataInputs[V].name);if(!c)throw new Error("Could not find data input with name "+C.dataInputs[V].name+" in block "+C.className);c.deserialize(C.dataInputs[V])}for(let V=0;V<C.dataOutputs.length;V++){const c=P.getDataOutput(C.dataOutputs[V].name);if(!c)throw new Error("Could not find data output with name "+C.dataOutputs[V].name+" in block "+C.className);c.deserialize(C.dataOutputs[V])}return P.metadata=C.metadata,P.deserialize&&P.deserialize(C),P}function Md(C){const[c,d]=C.split(":");return Kd({op:c,extension:d})}function Kd(C){var c;let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=C.extension?null===(c=hd[C.extension])||void 0===c?void 0:c[C.op]:Ld[C.op];if(!b&&(u.d.Warn(`No mapping found for operation ${C.op} and extension ${C.extension||"KHR_interactivity"}`),d)){const c={},d={flows:{}};if(C.inputValueSockets){c.values={};for(const d in C.inputValueSockets)c.values[d]={name:d}}return C.outputValueSockets&&(d.values={},Object.keys(C.outputValueSockets).forEach((C=>{d.values[C]={name:C}}))),{lk:[],inputs:c,outputs:d}}return b}function id(C,c,d){hd[c]||(hd[c]={}),hd[c][C]=d}const hd={BABYLON:{"flow/log":{lk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ld={"event/onStart":{lk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{lk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{lk:["FlowGraphSendCustomEventBlock"],extraProcessor(C,c,d,b,X){if("event/send"!==c.op||!C.configuration||1!==Object.keys(C.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const P=C.configuration.event.value[0];if("number"!==typeof P)throw new Error("Event id should be a number");const V=b.arrays.events[P],R=X[0];return R.config||(R.config={}),R.config.eventId=V.eventId,R.config.eventData=V.eventData,X}},"event/receive":{lk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(C,c){var d;if(!C.configuration)return u.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const b=C.configuration.event;if(!b)return u.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const X=b.value[0];if("number"!==typeof X)return u.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(d=c.events)||void 0===d?void 0:d[X])?{valid:!0}:(u.d.Error(`Event with id ${X} not found`),{valid:!1,error:`Event with id ${X} not found`})},extraProcessor(C,c,d,b,X){if("event/receive"!==c.op||!C.configuration||1!==Object.keys(C.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const P=C.configuration.event.value[0];if("number"!==typeof P)throw new Error("Event id should be a number");const V=b.arrays.events[P],R=X[0];return R.config||(R.config={}),R.config.eventId=V.eventId,R.config.eventData=V.eventData,X}},"math/e":fd("FlowGraphEBlock"),"math/pi":fd("FlowGraphPIBlock"),"math/inf":fd("FlowGraphInfBlock"),"math/nan":fd("FlowGraphNaNBlock"),"math/abs":fd("FlowGraphAbsBlock"),"math/sign":fd("FlowGraphSignBlock"),"math/trunc":fd("FlowGraphTruncBlock"),"math/floor":fd("FlowGraphFloorBlock"),"math/ceil":fd("FlowGraphCeilBlock"),"math/round":{lk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X){var P;return(P=X[0]).config||(P.config={}),X[0].config.roundHalfAwayFromZero=!0,X}},"math/fract":fd("FlowGraphFractBlock"),"math/neg":fd("FlowGraphNegationBlock"),"math/add":fd("FlowGraphAddBlock",["a","b"],!0),"math/sub":fd("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{lk:["FlowGraphMultiplyBlock"],extraProcessor(C,c,d,b,X){var P;(P=X[0]).config||(P.config={}),X[0].config.useMatrixPerComponent=!0,X[0].config.preventIntegerFloatArithmetic=!0;let V=-1;return Object.keys(C.values||{}).find((c=>{var d;return void 0!==(null===(d=C.values)||void 0===d?void 0:d[c].type)&&(V=C.values[c].type,!0)})),-1!==V&&(X[0].config.type=b.arrays.types[V].flowGraphType),X},validation:C=>C.values?Td(C):{valid:!0}},"math/div":fd("FlowGraphDivideBlock",["a","b"],!0),"math/rem":fd("FlowGraphModuloBlock",["a","b"]),"math/min":fd("FlowGraphMinBlock",["a","b"]),"math/max":fd("FlowGraphMaxBlock",["a","b"]),"math/clamp":fd("FlowGraphClampBlock",["a","b","c"]),"math/saturate":fd("FlowGraphSaturateBlock"),"math/mix":fd("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":fd("FlowGraphEqualityBlock",["a","b"]),"math/lt":fd("FlowGraphLessThanBlock",["a","b"]),"math/le":fd("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":fd("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":fd("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":fd("FlowGraphIsNaNBlock"),"math/isinf":fd("FlowGraphIsInfBlock"),"math/select":{lk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{lk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":fd("FlowGraphSinBlock"),"math/cos":fd("FlowGraphCosBlock"),"math/tan":fd("FlowGraphTanBlock"),"math/asin":fd("FlowGraphASinBlock"),"math/acos":fd("FlowGraphACosBlock"),"math/atan":fd("FlowGraphATanBlock"),"math/atan2":fd("FlowGraphATan2Block",["a","b"]),"math/sinh":fd("FlowGraphSinhBlock"),"math/cosh":fd("FlowGraphCoshBlock"),"math/tanh":fd("FlowGraphTanhBlock"),"math/asinh":fd("FlowGraphASinhBlock"),"math/acosh":fd("FlowGraphACoshBlock"),"math/atanh":fd("FlowGraphATanhBlock"),"math/exp":fd("FlowGraphExponentialBlock"),"math/log":fd("FlowGraphLogBlock"),"math/log2":fd("FlowGraphLog2Block"),"math/log10":fd("FlowGraphLog10Block"),"math/sqrt":fd("FlowGraphSquareRootBlock"),"math/cbrt":fd("FlowGraphCubeRootBlock"),"math/pow":fd("FlowGraphPowerBlock",["a","b"]),"math/length":fd("FlowGraphLengthBlock"),"math/normalize":fd("FlowGraphNormalizeBlock"),"math/dot":fd("FlowGraphDotBlock",["a","b"]),"math/cross":fd("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":fd("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":fd("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{lk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{lk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{lk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{lk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{lk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{lk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{lk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":fd("FlowGraphTransposeBlock"),"math/determinant":fd("FlowGraphDeterminantBlock"),"math/inverse":fd("FlowGraphInvertMatrixBlock"),"math/matmul":fd("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{lk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"xc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X,P){const V=X[0].dataInputs.find((C=>"rotationQuaternion"===C.name));if(!V)throw new Error("Rotation quaternion input not found");return P._connectionValues[V.uniqueId]&&(P._connectionValues[V.uniqueId].type="Quaternion"),X}},"math/matDecompose":{lk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"xc"}}}},"math/quatConjugate":fd("FlowGraphConjugateBlock",["a"]),"math/quatMul":{lk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X){var P;return(P=X[0]).config||(P.config={}),X[0].config.type="Quaternion",X}},"math/quatAngleBetween":fd("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{lk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":fd("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":fd("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{lk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X){var P;return(P=X[0]).config||(P.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract2x2":{lk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{lk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X){var P;return(P=X[0]).config||(P.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract3x3":{lk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{lk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X){var P;return(P=X[0]).config||(P.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract4x4":{lk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{lk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X,P){var V,R;(R=X[0]).config||(R.config={});const p=X[0].dataInputs[0];return X[0].config.valueType=(null===(V=P._connectionValues[p.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",X}},"math/and":{lk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X,P){var V,R,p;(p=X[0]).config||(p.config={});const j=X[0].dataInputs[0],g=X[0].dataInputs[1];return X[0].config.valueType=(null===(V=P._connectionValues[j.uniqueId])||void 0===V?void 0:V.type)??(null===(R=P._connectionValues[g.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",X}},"math/or":{lk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X,P){var V,R,p;(p=X[0]).config||(p.config={});const j=X[0].dataInputs[0],g=X[0].dataInputs[1];return X[0].config.valueType=(null===(V=P._connectionValues[j.uniqueId])||void 0===V?void 0:V.type)??(null===(R=P._connectionValues[g.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",X}},"math/xor":{lk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,c,d,b,X,P){var V,R,p;(p=X[0]).config||(p.config={});const j=X[0].dataInputs[0],g=X[0].dataInputs[1];return X[0].config.valueType=(null===(V=P._connectionValues[j.uniqueId])||void 0===V?void 0:V.type)??(null===(R=P._connectionValues[g.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",X}},"math/asr":fd("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":fd("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":fd("FlowGraphLeadingZerosBlock"),"math/ctz":fd("FlowGraphTrailingZerosBlock"),"math/popcnt":fd("FlowGraphOneBitsCounterBlock"),"math/rad":fd("FlowGraphDegToRadBlock"),"math/deg":fd("FlowGraphRadToDegBlock"),"type/boolToInt":fd("FlowGraphBooleanToInt"),"type/boolToFloat":fd("FlowGraphBooleanToFloat"),"type/intToBool":fd("FlowGraphIntToBoolean"),"type/intToFloat":fd("FlowGraphIntToFloat"),"type/floatToInt":fd("FlowGraphFloatToInt"),"type/floatToBool":fd("FlowGraphFloatToBoolean"),"flow/sequence":{lk:["FlowGraphSequenceBlock"],extraProcessor(C,c,d,b,X){const P=X[0];return P.config||(P.config={}),P.config.outputSignalCount=Object.keys(C.flows||[]).length,P.signalOutputs.forEach(((C,c)=>{C.name="out_"+c})),X}},"flow/branch":{lk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{lk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(C){if(C.configuration&&C.configuration.cases){const c=C.configuration.cases.value;if(!c.every((C=>"number"===typeof C&&/^-?\d+$/.test(C.toString()))))return u.d.Warn("Switch cases should be integers. Using empty array instead."),C.configuration.cases.value=[],{valid:!0};const d=new Set(c);C.configuration.cases.value=Array.from(d)}return{valid:!0}},extraProcessor(C,c,d,b,X){if("flow/switch"!==c.op||!C.flows||0===Object.keys(C.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return X[0].signalOutputs.forEach((C=>{"default"!==C.name&&(C.name="out_"+C.name)})),X}},"flow/while":{lk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{lk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(C,c,d,b,X){const P=X[0];return P.config||(P.config={}),P.config.incrementIndexWhenLoopDone=!0,X}},"flow/doN":{lk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{lk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(C,c,d,b,X){if("flow/multiGate"!==c.op||!C.flows||0===Object.keys(C.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const P=X[0];return P.config||(P.config={}),P.config.outputSignalCount=Object.keys(C.flows).length,P.signalOutputs.forEach(((C,c)=>{C.name="out_"+c})),X}},"flow/waitAll":{lk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(C){var c,d;return"number"!==typeof(null===(c=C.configuration)||void 0===c||null===(d=c.inputFlows)||void 0===d?void 0:d.value[0])&&(C.configuration=C.configuration||{inputFlows:{value:[0]}},C.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{lk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{lk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{lk:["FlowGraphCancelDelayBlock"]},"variable/get":{lk:["FlowGraphGetVariableBlock"],validation(C){var c,d;return null!==(c=C.configuration)&&void 0!==c&&null!==(d=c.variable)&&void 0!==d&&d.value?{valid:!0}:(u.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(C,c)=>[c.getVariableName(C[0])]}}},"variable/set":{lk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(C,c)=>[c.getVariableName(C[0])]}}},"variable/setMultiple":{lk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(C,c)=>[C[0].map((C=>c.getVariableName(C)))]}},extraProcessor:(C,c,d,b,X)=>(X[0].dataInputs.forEach((C=>{C.name=b.getVariableName(+C.name)})),X)},"variable/interpolate":{lk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(C,c)=>[c.getVariableName(C[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:C=>!0===C[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",tX:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",tX:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",tX:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",tX:"FlowGraphPlayAnimationBlock"},out:{name:"out",tX:"FlowGraphPlayAnimationBlock"},done:{name:"done",tX:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(C,c,d,b,X){var P,V,R;const p=X[0],j=null===(P=C.configuration)||void 0===P?void 0:P.variable.value[0];if("number"!==typeof j)throw u.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const g=b.arrays.staticVariables[j];"undefined"===typeof p.config.animationType.value&&(b.arrays.staticVariables,p.config.animationType.value=(0,ed.B)(g.type));const k=X[4];return k.config||(k.config={}),(V=k.config).variable||(V.variable={}),k.config.variable.value=b.getVariableName(j),(R=X[3]).config||(R.config={}),X}},"pointer/get":{lk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",tX:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",tX:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(C,c,d,b,X)=>(X.forEach((C=>{"FlowGraphJsonPointerParserBlock"===C.className&&(C.config||(C.config={}),C.config.outputValue=!0)})),X)},"pointer/set":{lk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",tX:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",tX:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(C,c,d,b,X)=>(X.forEach((C=>{"FlowGraphJsonPointerParserBlock"===C.className&&(C.config||(C.config={}),C.config.outputValue=!0)})),X)},"pointer/interpolate":{lk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",tX:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",tX:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",tX:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",tX:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",tX:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",tX:"FlowGraphPlayAnimationBlock"},out:{name:"out",tX:"FlowGraphPlayAnimationBlock"},done:{name:"done",tX:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(C,c,d,b,X)=>(X.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className?(c.config||(c.config={}),c.config.outputValue=!0):"FlowGraphInterpolationBlock"===c.className&&(c.config||(c.config={}),Object.keys(C.values||[]).forEach((d=>{var X;const P=null===(X=C.values)||void 0===X?void 0:X[d];if("value"===d&&P){const C=P.type;void 0!==C&&(c.config.animationType=b.arrays.types[C].flowGraphType)}})))})),X)},"animation/start":{lk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",tX:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(C,c)=>[C[0]*c._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(C,c)=>[C[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(C,c,d,b,X,P,V){const R=X[X.length-1];return R.config||(R.config={}),R.config.glTF=V,X}},"animation/stop":{lk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",tX:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(C,c,d,b,X,P,V){const R=X[X.length-1];return R.config||(R.config={}),R.config.glTF=V,X}},"animation/stopAt":{lk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",tX:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(C,c)=>[C[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(C,c,d,b,X,P,V){const R=X[X.length-1];return R.config||(R.config={}),R.config.glTF=V,X}},"math/switch":{lk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(C){if(C.configuration&&C.configuration.cases){const c=C.configuration.cases.value;if(!c.every((C=>"number"===typeof C&&/^-?\d+$/.test(C.toString()))))return u.d.Warn("Switch cases should be integers. Using empty array instead."),C.configuration.cases.value=[],{valid:!0};const d=new Set(c);C.configuration.cases.value=Array.from(d)}return{valid:!0}},extraProcessor(C,c,d,b,X){const P=X[0];return P.dataInputs.forEach((C=>{"default"!==C.name&&"case"!==C.name&&(C.name="in_"+C.name)})),P.config||(P.config={}),P.config.treatCasesAsIntegers=!0,X}},"debug/log":{lk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function fd(C){let c=arguments.length>2?arguments[2]:void 0;return{lk:[C],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((C,c)=>(C[c]={name:c},C)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(C,d,b,X,P){var V;if(c){(V=P[0]).config||(V.config={}),P[0].config.preventIntegerFloatArithmetic=!0;let c=-1;Object.keys(C.values||{}).find((d=>{var b;return void 0!==(null===(b=C.values)||void 0===b?void 0:b[d].type)&&(c=C.values[d].type,!0)})),-1!==c&&(P[0].config.type=X.arrays.types[c].flowGraphType)}return P},validation:C=>c?Td(C):{valid:!0}}}function Td(C){if(C.values){const c=Object.keys(C.values).map((c=>C.values[c].type)).filter((C=>void 0!==C));if(!c.every((C=>C===c[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ld["math/compose"]=Ld["math/matCompose"],Ld["math/decompose"]=Ld["math/matDecompose"];var zd=d(12352);const wd={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"dd",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Jd{constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=C,this._gltf=c,this._animationTargetFps=d,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const C of this._interactivityGraph.types)this._types.push(wd[C.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const C of this._interactivityGraph.declarations){const c=Kd(C);if(!c)throw u.d.Error(["No mapping found for declaration",C]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:c,fullOperationName:C.extension?C.op+":"+C.extension:C.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const C of this._interactivityGraph.variables){const c=this._parseVariable(C);this._staticVariables.push(c)}}_parseVariable(C,c){const d=this._types[C.type];if(!d)throw u.d.Error(["No type found for variable",C]),new Error("Error parsing variables");if(C.value&&C.value.length!==d.length)throw u.d.Error(["Invalid value length for variable",C,d]),new Error("Error parsing variables");const b=C.value||[];if(!b.length)switch(d.flowGraphType){case"boolean":b.push(!1);break;case"FlowGraphInteger":b.push(0);break;case"number":b.push(NaN);break;case"Vector2":b.push(NaN,NaN);break;case"dd":b.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":b.fill(NaN,0,4);break;case"Matrix":b.fill(NaN,0,16);break;case"Matrix3D":b.fill(NaN,0,9)}return"number"===d.elementType&&"string"===typeof b[0]&&(b[0]=parseFloat(b[0])),{type:d.flowGraphType,value:c?c(b,this):b}}_parseEvents(){if(this._interactivityGraph.events)for(const C of this._interactivityGraph.events){const c={eventId:C.id||"internalEvent_"+this._internalEventsCounter++};C.values&&(c.eventData=Object.keys(C.values).map((c=>{var d;const b=null===(d=C.values)||void 0===d?void 0:d[c];if(!b)throw u.d.Error(["No value found for event key",c]),new Error("Error parsing events");const X=this._types[b.type];if(!X)throw u.d.Error(["No type found for event value",b]),new Error("Error parsing events");const P="undefined"!==typeof b.value?this._parseVariable(b):void 0;return{id:c,type:X.flowGraphType,eventData:!0,value:P}}))),this._events.push(c)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const c of this._interactivityGraph.nodes){if("number"!==typeof c.declaration)throw u.d.Error(["No declaration found for node",c]),new Error("Error parsing nodes");const d=this._mappings[c.declaration];if(!d)throw u.d.Error(["No mapping found for node",c]),new Error("Error parsing nodes");if(d.flowGraphMapping.validation){const b=d.flowGraphMapping.validation(c,this._interactivityGraph,this._gltf);var C;if(!b.valid)throw new Error(`Error validating interactivity node ${null===(C=this._interactivityGraph.declarations)||void 0===C?void 0:C[c.declaration].op} - ${b.error}`)}const b=[];for(const C of d.flowGraphMapping.lk){const X=this._getEmptyBlock(C,d.fullOperationName);this._parseNodeConfiguration(c,X,d.flowGraphMapping,C),b.push(X)}this._nodes.push({lk:b,fullOperationName:d.fullOperationName})}}_getEmptyBlock(C,c){return{uniqueId:(0,zd.c)(),className:C,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:c,metadata:{}}}_parseNodeConfiguration(C,c,d,b){const X=c.config;if(C.configuration){const c=Object.keys(C.configuration);for(const R of c){var P,V;const c=null===(P=C.configuration)||void 0===P?void 0:P[R];if(!c)throw u.d.Error(["No value found for node configuration",R]),new Error("Error parsing node configuration");const p=null===(V=d.configuration)||void 0===V?void 0:V[R];if(p&&p.tX?p.tX===b:0===d.lk.indexOf(b)){const C=(null===p||void 0===p?void 0:p.name)||R;c&&"undefined"!==typeof c.value||"undefined"===typeof(null===p||void 0===p?void 0:p.defaultValue)?c.value.length>=0?X[C]={value:1===c.value.length?c.value[0]:c.value}:u.d.Warn(["Invalid value for node configuration",c]):X[C]={value:p.defaultValue},p&&p.dataTransformer&&(X[C].value=p.dataTransformer([X[C].value],this)[0])}}}}_parseNodeConnections(C){for(let E=0;E<this._nodes.length;E++){var c;const N=null===(c=this._interactivityGraph.nodes)||void 0===c?void 0:c[E];if(!N)throw u.d.Error(["No node found for interactivity node",this._nodes[E]]),new Error("Error parsing node connections");const r=this._nodes[E],M=this._mappings[N.declaration];if(!M)throw u.d.Error(["No mapping found for node",N]),new Error("Error parsing node connections");const K=N.flows||{},i=Object.keys(K).sort();for(const C of i){var d,b,X,P;const c=K[C],j=null===(d=M.flowGraphMapping.outputs)||void 0===d||null===(b=d.flows)||void 0===b?void 0:b[C],g=(null===j||void 0===j?void 0:j.name)||C,k=this._createNewSocketConnection(g,!0);(j&&j.tX&&r.lk.find((C=>C.className===j.tX))||r.lk[0]).signalOutputs.push(k);const Z=c.node,U=this._nodes[Z];if(!U)throw u.d.Error(["No node found for input node id",Z]),new Error("Error parsing node connections");const A=Md(U.fullOperationName);if(!A)throw u.d.Error(["No mapping found for input node",U]),new Error("Error parsing node connections");let q=null===(X=A.inputs)||void 0===X||null===(P=X.flows)||void 0===P?void 0:P[c.socket||"in"],B=!1;if(!q)for(const C in null===(V=A.inputs)||void 0===V?void 0:V.flows){var V,R,p;if(C.startsWith("[")&&C.endsWith("]"))B=!0,q=null===(R=A.inputs)||void 0===R||null===(p=R.flows)||void 0===p?void 0:p[C]}const t=q?B?q.name.replace("$1",c.socket||""):q.name:c.socket||"in",e=q&&q.tX&&U.lk.find((C=>C.className===q.tX))||U.lk[0];let n=e.signalInputs.find((C=>C.name===t));n||(n=this._createNewSocketConnection(t),e.signalInputs.push(n)),n.connectedPointIds.push(k.uniqueId),k.connectedPointIds.push(n.uniqueId)}const h=N.values||{},L=Object.keys(h);for(const c of L){var j,g;const d=h[c];let b=null===(j=M.flowGraphMapping.inputs)||void 0===j||null===(g=j.values)||void 0===g?void 0:g[c],X=!1;if(!b)for(const C in null===(k=M.flowGraphMapping.inputs)||void 0===k?void 0:k.values){var k,Z,U;if(C.startsWith("[")&&C.endsWith("]"))X=!0,b=null===(Z=M.flowGraphMapping.inputs)||void 0===Z||null===(U=Z.values)||void 0===U?void 0:U[C]}const P=b?X?b.name.replace("$1",c):b.name:c,V=this._createNewSocketConnection(P);if((b&&b.tX&&r.lk.find((C=>C.className===b.tX))||r.lk[0]).dataInputs.push(V),void 0!==d.value){const c=this._parseVariable(d,b&&b.dataTransformer);C._connectionValues[V.uniqueId]=c}else{if("undefined"===typeof d.node)throw u.d.Error(["Invalid value for value connection",d]),new Error("Error parsing node connections");{var A,q,B;const C=d.node,c=d.socket||"value",b=this._nodes[C];if(!b)throw u.d.Error(["No node found for output socket reference",d]),new Error("Error parsing node connections");const X=Md(b.fullOperationName);if(!X)throw u.d.Error(["No mapping found for output socket reference",d]),new Error("Error parsing node connections");let P=null===(A=X.outputs)||void 0===A||null===(q=A.values)||void 0===q?void 0:q[c],R=!1;if(!P)for(const d in null===(t=X.outputs)||void 0===t?void 0:t.values){var t,e,n;if(d.startsWith("[")&&d.endsWith("]"))R=!0,P=null===(e=X.outputs)||void 0===e||null===(n=e.values)||void 0===n?void 0:n[d]}const p=P?R?P.name.replace("$1",c):null===(B=P)||void 0===B?void 0:B.name:c,j=P&&P.tX&&b.lk.find((C=>C.className===P.tX))||b.lk[0];let g=j.dataOutputs.find((C=>C.name===p));g||(g=this._createNewSocketConnection(p,!0),j.dataOutputs.push(g)),V.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(V.uniqueId)}}}if(M.flowGraphMapping.interBlockConnectors)for(const C of M.flowGraphMapping.interBlockConnectors){const c=C.input,d=C.output,b=C.isVariable;this._connectFlowGraphNodes(c,d,r.lk[C.inputBlockIndex],r.lk[C.outputBlockIndex],b)}if(M.flowGraphMapping.extraProcessor){var W;const c=null===(W=this._interactivityGraph.declarations)||void 0===W?void 0:W[N.declaration];if(!c)throw u.d.Error(["No declaration found for extra processor",N]),new Error("Error parsing node connections");r.lk=M.flowGraphMapping.extraProcessor(N,c,M.flowGraphMapping,this,r.lk,C,this._gltf)}}}_createNewSocketConnection(C,c){return{uniqueId:(0,zd.c)(),name:C,_connectionType:c?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(C,c,d,b,X){const P=X?d.dataInputs:d.signalInputs,V=X?b.dataOutputs:b.signalOutputs,R=P.find((c=>c.name===C))||this._createNewSocketConnection(C),p=V.find((C=>C.name===c))||this._createNewSocketConnection(c,!0);P.find((c=>c.name===C))||P.push(R),V.find((C=>C.name===c))||V.push(p),R.connectedPointIds.push(p.uniqueId),p.connectedPointIds.push(R.uniqueId)}getVariableName(C){return"staticVariable_"+C}serializeToFlowGraph(){const C={uniqueId:(0,zd.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(C);for(let c=0;c<this._staticVariables.length;c++){const d=this._staticVariables[c];C._userVariables[this.getVariableName(c)]=d}return{rightHanded:!0,allBlocks:this._nodes.reduce(((C,c)=>C.concat(c.lk)),[]),executionContexts:[C]}}}const yd="KHR_interactivity";class xd{constructor(C){this._loader=C,this.name=yd,this.enabled=this._loader.isExtensionUsed(yd),this._pathConverter=(0,H.k)(this._loader.ec),C._skipStartAnimationStep=!0;const c=C.babylonScene;c&&function(C){(0,H.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!C.activeCamera)return new X.Quaternion(NaN,NaN,NaN,NaN);const c=X.Quaternion.FromRotationMatrix(C.activeCamera.getWorldMatrix()).normalize();return C.useRightHandedSystem||(c.w*=-1,c.x*=-1),c},type:"Quaternion",getTarget:()=>C.activeCamera}),(0,H.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!C.activeCamera)return new X.dd(NaN,NaN,NaN);const c=C.activeCamera.getWorldMatrix().getTranslation();return C.useRightHandedSystem||(c.x*=-1),c},type:"dd",getTarget:()=>C.activeCamera}),(0,H.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:C=>{var c;return(null===(c=C._babylonAnimationGroup)||void 0===c?void 0:c.isPlaying)??!1},type:"boolean",getTarget:C=>C._babylonAnimationGroup}),(0,H.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:C=>{var c;return((null===(c=C._babylonAnimationGroup)||void 0===c?void 0:c.from)??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup}),(0,H.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:C=>{var c;return((null===(c=C._babylonAnimationGroup)||void 0===c?void 0:c.to)??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup}),(0,H.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:C=>{var c;return((null===(c=C._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup}),(0,H.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:C=>{var c;return((null===(c=C._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup})}(c)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var C;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,d=null===(C=this._loader.ec.extensions)||void 0===C?void 0:C.KHR_interactivity;if(!d)return;const b=new Ad.d({Pd:c});b.dispatchEventsSynchronously=!1;const X=d.graphs.map((C=>new Jd(C,this._loader.ec,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(X.map((async C=>await Ed(C,{coordinator:b,pathConverter:this._pathConverter})))),b.start()}}var Hd;Hd=async()=>(await Promise.resolve().then(d.bind(d,14191))).FlowGraphGLTFDataProvider,ud[`${yd}/${"FlowGraphGLTFDataProvider"}`]=Hd,x(yd),y(yd,!0,(C=>new xd(C)));const vd="KHR_node_visibility";(0,H.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:C=>{const c=C._babylonTransformNode;return!c||void 0===c.isVisible||c.isVisible},set:(C,c)=>{var d,b;null===(d=c._primitiveBabylonMeshes)||void 0===d||d.forEach((C=>{C.inheritVisibility=!0})),c._babylonTransformNode&&(c._babylonTransformNode.isVisible=C),null===(b=c._primitiveBabylonMeshes)||void 0===b||b.forEach((c=>{c.isVisible=C}))},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Dd{constructor(C){this.name=vd,this._loader=C,this.enabled=C.isExtensionUsed(vd)}async onReady(){var C;null===(C=this._loader.ec.nodes)||void 0===C||C.forEach((C=>{var c,d,b,X;(null===(c=C._primitiveBabylonMeshes)||void 0===c||c.forEach((C=>{C.inheritVisibility=!0})),null!==(d=C.extensions)&&void 0!==d&&d.KHR_node_visibility)&&(!1===(null===(b=C.extensions)||void 0===b?void 0:b.KHR_node_visibility.visible)&&(C._babylonTransformNode&&(C._babylonTransformNode.isVisible=!1),null===(X=C._primitiveBabylonMeshes)||void 0===X||X.forEach((C=>{C.isVisible=!1}))))}))}dispose(){this._loader=null}}x(vd),y(vd,!0,(C=>new Dd(C)));const sd="KHR_node_selectability";id("event/onSelect",sd,{lk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",tX:"FlowGraphGetVariableBlock",dataTransformer:C=>["pickedMesh_"+C[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",tX:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(C,c,d,b,X,P,V){var R,p,j,g,k,Z;const U=X[X.length-1];U.config=U.config||{},U.config.glTF=V;const A=null===(R=C.configuration)||void 0===R||null===(p=R.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===A||"number"!==typeof A)throw new Error("nodeIndex not found in configuration");const u="pickedMesh_"+A;return X[1].config.variable=u,P._userVariables[u]={className:"Mesh",id:null===V||void 0===V||null===(j=V.nodes)||void 0===j||null===(g=j[A]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===V||void 0===V||null===(k=V.nodes)||void 0===k||null===(Z=k[A]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},X}}),(0,H.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:C=>{const c=C._babylonTransformNode;return!c||void 0===c.dg||c.dg},set:(C,c)=>{var d;null===(d=c._primitiveBabylonMeshes)||void 0===d||d.forEach((c=>{c.dg=C}))},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"dg"],type:"boolean"});class mb{constructor(C){this.name=sd,this._loader=C,this.enabled=C.isExtensionUsed(sd)}async onReady(){var C;null===(C=this._loader.ec.nodes)||void 0===C||C.forEach((C=>{var c,d,b;null!==(c=C.extensions)&&void 0!==c&&c.KHR_node_selectability&&!1===(null===(d=C.extensions)||void 0===d?void 0:d.KHR_node_selectability.selectable)&&(null===(b=C._babylonTransformNode)||void 0===b||b.getChildMeshes().forEach((C=>{C.dg=!1})))}))}dispose(){this._loader=null}}x(sd),y(sd,!0,(C=>new mb(C)));const Qd="KHR_node_hoverability",Id="targetMeshPointerOver_";id("event/onHoverIn",Qd,{lk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",tX:"FlowGraphGetVariableBlock",dataTransformer:C=>[Id+C[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",tX:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(C,c,d,b,X,P,V){var R,p,j,g,k,Z;const U=X[X.length-1];U.config=U.config||{},U.config.glTF=V;const A=null===(R=C.configuration)||void 0===R||null===(p=R.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===A||"number"!==typeof A)throw new Error("nodeIndex not found in configuration");const u=Id+A;return X[1].config.variable=u,P._userVariables[u]={className:"Mesh",id:null===V||void 0===V||null===(j=V.nodes)||void 0===j||null===(g=j[A]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===V||void 0===V||null===(k=V.nodes)||void 0===k||null===(Z=k[A]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},X}});const od="targetMeshPointerOut_";id("event/onHoverOut",Qd,{lk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",tX:"FlowGraphGetVariableBlock",dataTransformer:C=>[od+C[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",tX:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(C,c,d,b,X,P,V){var R,p,j,g,k,Z;const U=X[X.length-1];U.config=U.config||{},U.config.glTF=V;const A=null===(R=C.configuration)||void 0===R||null===(p=R.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===A||"number"!==typeof A)throw new Error("nodeIndex not found in configuration");const u=od+A;return X[1].config.variable=u,P._userVariables[u]={className:"Mesh",id:null===V||void 0===V||null===(j=V.nodes)||void 0===j||null===(g=j[A]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===V||void 0===V||null===(k=V.nodes)||void 0===k||null===(Z=k[A]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},X}}),(0,H.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:C=>{const c=C._babylonTransformNode;return!c||void 0===c.pointerOverDisableMeshTesting||c.pointerOverDisableMeshTesting},set:(C,c)=>{var d;null===(d=c._primitiveBabylonMeshes)||void 0===d||d.forEach((c=>{c.pointerOverDisableMeshTesting=!C}))},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Fd{constructor(C){this.name=Qd,this._loader=C,this.enabled=C.isExtensionUsed(Qd)}async onReady(){var C;null===(C=this._loader.ec.nodes)||void 0===C||C.forEach((C=>{var c,d,b;null!==(c=C.extensions)&&void 0!==c&&c.KHR_node_hoverability&&!1===(null===(d=C.extensions)||void 0===d?void 0:d.KHR_node_hoverability.hoverable)&&(null===(b=C._babylonTransformNode)||void 0===b||b.getChildMeshes().forEach((C=>{C.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}x(Qd),y(Qd,!0,(C=>new Fd(C)));const Yd="ExtrasAsMetadata";class ld{_assignExtras(C,c){if(c.extras&&Object.keys(c.extras).length>0){const d=C.metadata=C.metadata||{};(d.ec=d.ec||{}).extras=c.extras}}constructor(C){this.name=Yd,this.enabled=!0,this._loader=C}dispose(){this._loader=null}loadNodeAsync(C,c,d){return this._loader.loadNodeAsync(C,c,(C=>{this._assignExtras(C,c),d(C)}))}loadCameraAsync(C,c,d){return this._loader.loadCameraAsync(C,c,(C=>{this._assignExtras(C,c),d(C)}))}createMaterial(C,c,d){const b=this._loader.createMaterial(C,c,d);return this._assignExtras(b,c),b}}x(Yd),y(Yd,!1,(C=>new ld(C)));d(14191)},14060:(C,c,d)=>{"use strict";d.d(c,{c:()=>T,d:()=>M,f:()=>r,j:()=>K});var b=d(12221),X=d(12219),P=d(13699),V=d(12848),R=d(12807),p=d(12821),j=d(12233),g=d(12255),k=d(12839),Z=d(12942),U=d(12857),A=d(12433);class u{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.LU=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.gA=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(C){this._environmentTexture=C}getNodes(){let C=[];C=C.concat(this.meshes),C=C.concat(this.lights),C=C.concat(this.cameras),C=C.concat(this.transformNodes);for(const c of this.skeletons)C=C.concat(c.bones);return C}}class q extends u{}class B{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const C=this.rootNodes;for(const b of C)b.dispose();C.length=0;const c=this.skeletons;for(const b of c)b.dispose();c.length=0;const d=this.animationGroups;for(const b of d)b.dispose();d.length=0}}class t extends u{constructor(C){super(),this._wasAddedToScene=!1,(C=C||g.c.LastCreatedScene)&&(this.Pd=C,this.proceduralTextures=[],C.Uc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=C.getEngine().onContextRestoredObservable.add((()=>{for(const C of this.geometries)C._rebuild();for(const C of this.meshes)C._rebuild();for(const C of this.LU)C.rebuild();for(const C of this.textures)C._rebuild()})))}_topologicalSort(C){const c=new Map;for(const V of C)c.set(V.uniqueId,V);const d={dependsOn:new Map,dependedBy:new Map};for(const V of C){const C=V.uniqueId;d.dependsOn.set(C,new Set),d.dependedBy.set(C,new Set)}for(const V of C){const C=V.uniqueId,b=d.dependsOn.get(C);if(V instanceof k.e){const X=V.sourceMesh;c.has(X.uniqueId)&&(b.add(X.uniqueId),d.dependedBy.get(X.uniqueId).add(C))}const X=d.dependedBy.get(C);for(const P of V.getDescendants()){const b=P.uniqueId;if(c.has(b)){X.add(b);d.dependsOn.get(b).add(C)}}}const b=[],X=[];for(const V of C){const C=V.uniqueId;0===d.dependsOn.get(C).size&&(X.push(V),c.delete(C))}const P=X;for(;P.length>0;){const C=P.shift();b.push(C);const X=d.dependedBy.get(C.uniqueId);for(const b of Array.from(X.values())){const X=d.dependsOn.get(b);X.delete(C.uniqueId),0===X.size&&c.get(b)&&(P.push(c.get(b)),c.delete(b))}}return c.size>0&&(j.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((C=>{j.d.Error(C.name)}))),b}_addNodeAndDescendantsToList(C,c,d,b){if(d&&(!b||b(d))&&!c.has(d.uniqueId)){C.push(d),c.add(d.uniqueId);for(const X of d.getDescendants(!0))this._addNodeAndDescendantsToList(C,c,X,b)}}_isNodeInContainer(C){return C instanceof p.c&&-1!==this.meshes.indexOf(C)||(C instanceof R.e&&-1!==this.transformNodes.indexOf(C)||(C instanceof Z.b&&-1!==this.lights.indexOf(C)||C instanceof U.d&&-1!==this.cameras.indexOf(C)))}_isValidHierarchy(){for(const C of this.meshes)if(C.parent&&!this._isNodeInContainer(C.parent))return j.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.transformNodes)if(C.parent&&!this._isNodeInContainer(C.parent))return j.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.lights)if(C.parent&&!this._isNodeInContainer(C.parent))return j.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.cameras)if(C.parent&&!this._isNodeInContainer(C.parent))return j.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(C){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const b={},P={},R=new B,p=[],j=[],g={doNotInstantiate:!0,...d},k=[],Z=new Set;for(const X of this.transformNodes)null===X.parent&&this._addNodeAndDescendantsToList(k,Z,X,g.predicate);for(const X of this.meshes)null===X.parent&&this._addNodeAndDescendantsToList(k,Z,X,g.predicate);const U=this._topologicalSort(k),A=(d,X)=>{if(((c,d)=>{if(b[c.uniqueId]=d.uniqueId,P[d.uniqueId]=d,C&&(d.name=C(c.name)),d instanceof V.b){const C=d;if(C.morphTargetManager){const d=c.morphTargetManager;C.morphTargetManager=d.clone();for(let c=0;c<d.numTargets;c++){const X=d.getTarget(c),V=C.morphTargetManager.getTarget(c);b[X.uniqueId]=V.uniqueId,P[V.uniqueId]=V}}}})(d,X),d.parent){const C=b[d.parent.uniqueId],c=P[C];X.parent=c||d.parent}if(X.position&&d.position&&X.position.V(d.position),X.rotationQuaternion&&d.rotationQuaternion&&X.rotationQuaternion.V(d.rotationQuaternion),X.rotation&&d.rotation&&X.rotation.V(d.rotation),X.xc&&d.xc&&X.xc.V(d.xc),X.material){const V=X;if(V.material)if(c){const c=d.material;if(-1===j.indexOf(c)){let d=c.clone(C?C(c.name):"Clone of "+c.name);if(j.push(c),b[c.uniqueId]=d.uniqueId,P[d.uniqueId]=d,"MultiMaterial"===c.getClassName()){const X=c;for(const c of X.Dc)c&&(d=c.clone(C?C(c.name):"Clone of "+c.name),j.push(c),b[c.uniqueId]=d.uniqueId,P[d.uniqueId]=d);X.Dc=X.Dc.map((C=>C&&P[b[C.uniqueId]]))}}"InstancedMesh"!==V.getClassName()&&(V.material=P[b[c.uniqueId]])}else"MultiMaterial"===V.material.getClassName()?-1===this.Pd.multiMaterials.indexOf(V.material)&&this.Pd.addMultiMaterial(V.material):-1===this.Pd.materials.indexOf(V.material)&&this.Pd.addMaterial(V.material)}null===X.parent&&R.rootNodes.push(X)};for(const X of U)if("InstancedMesh"===X.getClassName()){const C=X,c=C.sourceMesh,d=b[c.uniqueId];A(C,("number"===typeof d?P[d]:c).createInstance(C.name))}else{let C=!0;"Yc"===X.getClassName()||"Node"===X.getClassName()||X.skeleton||!X.getTotalVertices||0===X.getTotalVertices()?C=!1:g.doNotInstantiate&&(C="function"===typeof g.doNotInstantiate?!g.doNotInstantiate(X):!g.doNotInstantiate);const c=C?X.createInstance(`instance of ${X.name}`):X.clone(`Clone of ${X.name}`,null,!0);if(!c)throw new Error(`Could not clone or instantiate node on Asset Container ${X.name}`);A(X,c)}for(const X of this.skeletons){if(g.predicate&&!g.predicate(X))continue;const c=X.clone(C?C(X.name):"Clone of "+X.name);for(const C of this.meshes)if(C.skeleton===X&&!C.isAnInstance){const d=P[b[C.uniqueId]];if(!d||d.isAnInstance)continue;if(d.skeleton=c,-1!==p.indexOf(c))continue;p.push(c);for(const C of c.bones)C._linkedTransformNode&&(C._linkedTransformNode=P[b[C._linkedTransformNode.uniqueId]])}R.skeletons.push(c)}for(const X of this.animationGroups){if(g.predicate&&!g.predicate(X))continue;const c=X.clone(C?C(X.name):"Clone of "+X.name,(C=>P[b[C.uniqueId]]||C));R.animationGroups.push(c)}return R}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Pd.environmentTexture=this.environmentTexture);for(const C of this.Pd._serializableComponents)C.addFromContainer(this);this.Pd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];for(const d of this.cameras)C&&!C(d)||(this.Pd.addCamera(d),c.push(d));for(const d of this.lights)C&&!C(d)||(this.Pd.addLight(d),c.push(d));for(const d of this.meshes)C&&!C(d)||(this.Pd.Jk(d),c.push(d));for(const d of this.skeletons)C&&!C(d)||this.Pd.addSkeleton(d);for(const d of this.animations)C&&!C(d)||this.Pd.addAnimation(d);for(const d of this.animationGroups)C&&!C(d)||this.Pd.addAnimationGroup(d);for(const d of this.multiMaterials)C&&!C(d)||this.Pd.addMultiMaterial(d);for(const d of this.materials)C&&!C(d)||this.Pd.addMaterial(d);for(const d of this.morphTargetManagers)C&&!C(d)||this.Pd.addMorphTargetManager(d);for(const d of this.geometries)C&&!C(d)||this.Pd.addGeometry(d);for(const d of this.transformNodes)C&&!C(d)||(this.Pd.addTransformNode(d),c.push(d));for(const d of this.actionManagers)C&&!C(d)||this.Pd.addActionManager(d);for(const d of this.textures)C&&!C(d)||this.Pd.addTexture(d);for(const d of this.reflectionProbes)C&&!C(d)||this.Pd.addReflectionProbe(d);for(const d of c)d.parent&&-1===this.Pd.getNodes().indexOf(d.parent)&&(d.setParent?d.setParent(null):d.parent=null)}removeAllFromScene(){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Pd.environmentTexture&&(this.Pd.environmentTexture=null);for(const C of this.Pd._serializableComponents)C.removeFromContainer(this)}removeFromScene(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const c of this.cameras)C&&!C(c)||this.Pd.removeCamera(c);for(const c of this.lights)C&&!C(c)||this.Pd.removeLight(c);for(const c of this.meshes)C&&!C(c)||this.Pd.wk(c,!0);for(const c of this.skeletons)C&&!C(c)||this.Pd.removeSkeleton(c);for(const c of this.animations)C&&!C(c)||this.Pd.removeAnimation(c);for(const c of this.animationGroups)C&&!C(c)||this.Pd.removeAnimationGroup(c);for(const c of this.multiMaterials)C&&!C(c)||this.Pd.removeMultiMaterial(c);for(const c of this.materials)C&&!C(c)||this.Pd.removeMaterial(c);for(const c of this.morphTargetManagers)C&&!C(c)||this.Pd.removeMorphTargetManager(c);for(const c of this.geometries)C&&!C(c)||this.Pd.removeGeometry(c);for(const c of this.transformNodes)C&&!C(c)||this.Pd.removeTransformNode(c);for(const c of this.actionManagers)C&&!C(c)||this.Pd.removeActionManager(c);for(const c of this.textures)C&&!C(c)||this.Pd.removeTexture(c);for(const c of this.reflectionProbes)C&&!C(c)||this.Pd.removeReflectionProbe(c)}dispose(){const C=this.cameras.slice(0);for(const U of C)U.dispose();this.cameras.length=0;const c=this.lights.slice(0);for(const U of c)U.dispose();this.lights.length=0;const d=this.meshes.slice(0);for(const U of d)U.dispose();this.meshes.length=0;const b=this.skeletons.slice(0);for(const U of b)U.dispose();this.skeletons.length=0;const X=this.animationGroups.slice(0);for(const U of X)U.dispose();this.animationGroups.length=0;const P=this.multiMaterials.slice(0);for(const U of P)U.dispose();this.multiMaterials.length=0;const V=this.materials.slice(0);for(const U of V)U.dispose();this.materials.length=0;const R=this.geometries.slice(0);for(const U of R)U.dispose();this.geometries.length=0;const p=this.transformNodes.slice(0);for(const U of p)U.dispose();this.transformNodes.length=0;const j=this.actionManagers.slice(0);for(const U of j)U.dispose();this.actionManagers.length=0;const g=this.textures.slice(0);for(const U of g)U.dispose();this.textures.length=0;const k=this.reflectionProbes.slice(0);for(const U of k)U.dispose();this.reflectionProbes.length=0;const Z=this.morphTargetManagers.slice(0);for(const U of Z)U.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const U of this.Pd._serializableComponents)U.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Pd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(C,c,d){if(C&&c)for(const b of C){let C=!0;if(d)for(const c of d)if(b===c){C=!1;break}C&&(c.push(b),b._parentContainer=this)}}moveAllFromScene(C){this._wasAddedToScene=!1,void 0===C&&(C=new q);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.Pd[c],this[c],C[c]));this.environmentTexture=this.Pd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const C=new V.b("assetContainerRootMesh",this.Pd);for(const c of this.meshes)c.parent||C.addChild(c);return this.meshes.unshift(C),C}mergeAnimationsTo(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!C)return j.d.Error("No scene available to merge animations to"),[];const b=d||(c=>{let d=null;const b=c.animations.length?c.animations[0].targetProperty:"",X=c.name.split(".").join("").split("_primitive")[0];switch(b){case"position":case"rotationQuaternion":d=C.getTransformNodeByName(c.name)||C.getTransformNodeByName(X);break;case"influence":d=C.getMorphTargetByName(c.name)||C.getMorphTargetByName(X);break;default:d=C.getNodeByName(c.name)||C.getNodeByName(X)}return d}),X=this.getNodes();for(const R of X){const C=b(R);if(null!==C){for(const c of R.animations){const d=C.animations.filter((C=>C.targetProperty===c.targetProperty));for(const c of d){const d=C.animations.indexOf(c,0);d>-1&&C.animations.splice(d,1)}}C.animations=C.animations.concat(R.animations)}}const P=[],V=this.animationGroups.slice();for(const R of V){P.push(R.clone(R.name,b));for(const C of R.animatables)C.stop()}for(const R of c){const c=b(R.target);c&&(C.beginAnimation(c,R.fromFrame,R.toFrame,R.loopAnimation,R.speedRatio,R.onAnimationEnd?R.onAnimationEnd:void 0,void 0,!0,void 0,R.onAnimationLoop?R.onAnimationLoop:void 0),C.stopAnimation(R.target))}return P}populateRootNodes(){this.rootNodes.length=0;for(const C of this.meshes)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C);for(const C of this.transformNodes)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C);for(const C of this.lights)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C);for(const C of this.cameras)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C)}addAllAssetsToContainer(C){if(!C)return;const c=[],d=new Set;for(c.push(C);c.length>0;){const C=c.pop();if(C instanceof V.b?(C.zc&&-1===this.geometries.indexOf(C.zc)&&this.geometries.push(C.zc),this.meshes.push(C)):C instanceof k.e?this.meshes.push(C):C instanceof R.e?this.transformNodes.push(C):C instanceof Z.b?this.lights.push(C):C instanceof U.d&&this.cameras.push(C),C instanceof p.c){if(C.material&&-1===this.materials.indexOf(C.material)){this.materials.push(C.material);for(const c of C.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}C.skeleton&&-1===this.skeletons.indexOf(C.skeleton)&&this.skeletons.push(C.skeleton),C.morphTargetManager&&-1===this.morphTargetManagers.indexOf(C.morphTargetManager)&&this.morphTargetManagers.push(C.morphTargetManager)}for(const b of C.getChildren())d.has(b)||c.push(b);d.add(C)}this.populateRootNodes()}_getByTags(C,c,d){if(void 0===c)return C;const b=[];for(const X in C){const P=C[X];A.b&&A.b.MatchesQuery(P,c)&&(!d||d(P))&&b.push(P)}return b}getMeshesByTags(C,c){return this._getByTags(this.meshes,C,c)}getCamerasByTags(C,c){return this._getByTags(this.cameras,C,c)}getLightsByTags(C,c){return this._getByTags(this.lights,C,c)}getMaterialsByTags(C,c){return this._getByTags(this.materials,C,c).concat(this._getByTags(this.multiMaterials,C,c))}getTransformNodesByTags(C,c){return this._getByTags(this.transformNodes,C,c)}}var e=d(12266);class n{constructor(C){this.byteOffset=0,this.buffer=C}async loadAsync(C){const c=await this.buffer.readAsync(this.byteOffset,C);this._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),this._dataByteOffset=0}readUint32(){const C=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,C}readUint8Array(C){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,C);return this._dataByteOffset+=C,this.byteOffset+=C,c}readString(C){return(0,e.f)(this.readUint8Array(C))}skipBytes(C){this._dataByteOffset+=C,this.byteOffset+=C}}var W=d(14063);const E="Z2xURg",N={name:"ec",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:C=>-1!==C.indexOf("asset")&&-1!==C.indexOf("version")||C.startsWith("data:base64,"+E)||C.startsWith("data:;base64,"+E)||C.startsWith("data:application/octet-stream;base64,"+E)||C.startsWith("data:model/gltf-binary;base64,"+E)};var r,M,K,i=d(12258),h=d(12261);function L(C,c,d){try{return Promise.resolve(new Uint8Array(C,c,d))}catch(b){return Promise.reject(b)}}!function(C){C[C.AUTO=0]="AUTO",C[C.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(r||(r={})),function(C){C[C.NONE=0]="NONE",C[C.FIRST=1]="FIRST",C[C.ALL=2]="ALL"}(M||(M={})),function(C){C[C.LOADING=0]="LOADING",C[C.READY=1]="READY",C[C.COMPLETE=2]="COMPLETE"}(K||(K={}));class f{constructor(){this.coordinateSystemMode=r.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=C=>Promise.resolve(C),this.extensionOptions={}}V(C){C&&(this.onParsed=C.onParsed,this.coordinateSystemMode=C.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=C.animationStartMode??this.animationStartMode,this.loadNodeAnimations=C.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=C.loadSkins??this.loadSkins,this.loadMorphTargets=C.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=C.compileMaterials??this.compileMaterials,this.useClipPlane=C.useClipPlane??this.useClipPlane,this.compileShadowGenerators=C.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=C.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=C.useRangeRequests??this.useRangeRequests,this.createInstances=C.createInstances??this.createInstances,this.alwaysComputeBoundingBox=C.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=C.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=C.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=C.skipMaterials??this.skipMaterials,this.useSRGBBuffers=C.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=C.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=C.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=C.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=C.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=C.customRootNode,this.onMeshLoaded=C.onMeshLoaded,this.onSkinLoaded=C.onSkinLoaded,this.onTextureLoaded=C.onTextureLoaded,this.onMaterialLoaded=C.onMaterialLoaded,this.onCameraLoaded=C.onCameraLoaded,this.extensionOptions=C.extensionOptions??this.extensionOptions)}}class T extends f{constructor(C){super(),this.onParsedObservable=new b.b,this.onMeshLoadedObservable=new b.b,this.onSkinLoadedObservable=new b.b,this.onTextureLoadedObservable=new b.b,this.onMaterialLoadedObservable=new b.b,this.onCameraLoadedObservable=new b.b,this.onCompleteObservable=new b.b,this.onErrorObservable=new b.b,this.Uc=new b.b,this.onExtensionLoadedObservable=new b.b,this.validate=!1,this.onValidatedObservable=new b.b,this._loader=null,this._state=null,this._requests=new Array,this.name=N.name,this.extensions=N.extensions,this.onLoaderStateChangedObservable=new b.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.V(C)}set onParsed(C){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),C&&(this._onParsedObserver=this.onParsedObservable.add(C))}set onMeshLoaded(C){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),C&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(C))}set onSkinLoaded(C){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),C&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>C(c.node,c.skinnedNode))))}set onTextureLoaded(C){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),C&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(C))}set onMaterialLoaded(C){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),C&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(C))}set onCameraLoaded(C){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),C&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(C))}set onComplete(C){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(C)}set onError(C){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(C)}set onDispose(C){this._onDisposeObserver&&this.Uc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Uc.add(C)}set onExtensionLoaded(C){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(C)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(C){this._loggingEnabled!==C&&(this._loggingEnabled=C,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(C){this._capturePerformanceCounters!==C&&(this._capturePerformanceCounters=C,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(C){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(C)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const C of this._requests)C.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=C=>Promise.resolve(C),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Uc.notifyObservers(void 0),this.Uc.clear()}loadFile(C,c,d,P,V,R,p,g){if(ArrayBuffer.isView(c))return this._loadBinary(C,c,d,P,p,g),null;this._progressCallback=V;const k=c.name||X.Tools.GetFilename(c);if(R){if(this.useRangeRequests){this.validate&&j.d.Warn("glTF validation is not supported when range requests are enabled");const d={abort:()=>{},onCompleteObservable:new b.b},X={readAsync:(d,b)=>new Promise(((X,P)=>{this._loadFile(C,c,(C=>{X(new Uint8Array(C))}),!0,(C=>{P(C)}),(C=>{C.setRequestHeader("Range",`bytes=${d}-${d+b-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new n(X)).then((C=>{d.onCompleteObservable.notifyObservers(d),P(C)}),p?C=>p(void 0,C):void 0),d}return this._loadFile(C,c,(c=>{this._validate(C,new Uint8Array(c,0,c.byteLength),d,k),this._unpackBinaryAsync(new n({readAsync:(C,d)=>L(c,C,d),byteLength:c.byteLength})).then((C=>{P(C)}),p?C=>p(void 0,C):void 0)}),!0,p)}return this._loadFile(C,c,(c=>{try{this._validate(C,c,d,k),P({json:this._parseJson(c)})}catch{p&&p()}}),!1,p)}_loadBinary(C,c,d,b,X,P){this._validate(C,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),d,P),this._unpackBinaryAsync(new n({readAsync:(C,d)=>function(C,c,d){try{if(c<0||c>=C.byteLength)throw new RangeError("Offset is out of range.");if(c+d>C.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(C.buffer,C.byteOffset+c,d))}catch(b){return Promise.reject(b)}}(c,C,d),byteLength:c.byteLength})).then((C=>{b(C)}),X?C=>X(void 0,C):void 0)}importMeshAsync(C,c,d,b,X,P){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${P||""}`),this._loader=this._getLoader(d),this._loader.importMeshAsync(C,c,null,d,b,X,P))))}loadAsync(C,c,d,b,X){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(C,c,d,b,X))))}loadAssetContainerAsync(C,c,d,b,X){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(c);const P=new t(C),V=[];this.onMaterialLoadedObservable.add((C=>{V.push(C)}));const R=[];this.onTextureLoadedObservable.add((C=>{R.push(C)}));const p=[];this.onCameraLoadedObservable.add((C=>{p.push(C)}));const j=[];return this.onMeshLoadedObservable.add((C=>{C.morphTargetManager&&j.push(C.morphTargetManager)})),this._loader.importMeshAsync(null,C,P,c,d,b,X).then((C=>(Array.prototype.push.apply(P.geometries,C.geometries),Array.prototype.push.apply(P.meshes,C.meshes),Array.prototype.push.apply(P.LU,C.LU),Array.prototype.push.apply(P.skeletons,C.skeletons),Array.prototype.push.apply(P.animationGroups,C.animationGroups),Array.prototype.push.apply(P.materials,V),Array.prototype.push.apply(P.textures,R),Array.prototype.push.apply(P.lights,C.lights),Array.prototype.push.apply(P.transformNodes,C.transformNodes),Array.prototype.push.apply(P.cameras,p),Array.prototype.push.apply(P.morphTargetManagers,j),P)))}))}canDirectLoad(C){return N.canDirectLoad(C)}directLoad(C,c){if(c.startsWith("base64,"+E)||c.startsWith(";base64,"+E)||c.startsWith("application/octet-stream;base64,"+E)||c.startsWith("model/gltf-binary;base64,"+E)){const d=(0,i.b)(c);return this._validate(C,new Uint8Array(d,0,d.byteLength)),this._unpackBinaryAsync(new n({readAsync:(C,c)=>L(d,C,c),byteLength:d.byteLength}))}return this._validate(C,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(C){return new T(C[N.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((C,c)=>{this.onCompleteObservable.addOnce((()=>{C()})),this.onErrorObservable.addOnce((C=>{c(C)}))}))}_setState(C){this._state!==C&&(this._state=C,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(K[this._state]))}_loadFile(C,c,d,b,X,P){const V=C._loadFile(c,d,(C=>{this._onProgress(C,V)}),!0,b,X,P);return V.onCompleteObservable.add((()=>{V._lengthComputable=!0,V._total=V._loaded})),this._requests.push(V),V}_onProgress(C,c){if(!this._progressCallback)return;c._lengthComputable=C.lengthComputable,c._loaded=C.loaded,c._total=C.total;let d=!0,b=0,X=0;for(const P of this._requests){if(void 0===P._lengthComputable||void 0===P._loaded||void 0===P._total)return;d=d&&P._lengthComputable,b+=P._loaded,X+=P._total}this._progressCallback({lengthComputable:d,loaded:b,total:d?X:0})}_validate(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),W.b.ValidateAsync(c,d,b,(c=>this.preprocessUrlAsync(d+c).then((c=>C._loadFileAsync(c,void 0,!0,!0).then((C=>new Uint8Array(C,0,C.byteLength))))))).then((C=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(C),this.onValidatedObservable.clear()}),(C=>{this._endPerformanceCounter("Validate JSON"),X.Tools.Warn(`Failed to validate: ${C.message}`),this.onValidatedObservable.clear()})))}_getLoader(C){const c=C.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const d=T._parseVersion(c.version);if(!d)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const C=T._parseVersion(c.minVersion);if(!C)throw new Error("Invalid minimum version: "+c.minVersion);if(T._compareVersion(C,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const b={1:T._CreateGLTF1Loader,2:T._CreateGLTF2Loader}[d.major];if(!b)throw new Error("Unsupported version: "+c.version);return b(this)}_parseJson(C){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${C.length}`);const c=JSON.parse(C);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(C){return this._startPerformanceCounter("Unpack Binary"),C.loadAsync(20).then((()=>{const c=C.readUint32();if(1179937895!==c)throw new h.l("Unexpected magic: "+c,h.h.GLTFLoaderUnexpectedMagicError);const d=C.readUint32();this.loggingEnabled&&this._log(`Binary version: ${d}`);const b=C.readUint32();let X;switch(this.useRangeRequests||b===C.buffer.byteLength||j.d.Warn(`Length in header does not match actual data length: ${b} != ${C.buffer.byteLength}`),d){case 1:X=this._unpackBinaryV1Async(C,b);break;case 2:X=this._unpackBinaryV2Async(C,b);break;default:throw new Error("Unsupported version: "+d)}return this._endPerformanceCounter("Unpack Binary"),X}))}_unpackBinaryV1Async(C,c){const d=C.readUint32(),b=C.readUint32();if(0!==b)throw new Error(`Unexpected content format: ${b}`);const X=c-C.byteOffset,P={json:this._parseJson(C.readString(d)),bin:null};if(0!==X){const c=C.byteOffset;P.bin={readAsync:(d,b)=>C.buffer.readAsync(c+d,b),byteLength:X}}return Promise.resolve(P)}_unpackBinaryV2Async(C,c){const d=1313821514,b=5130562,X=C.readUint32();if(C.readUint32()!==d)throw new Error("First chunk format is not JSON");return C.byteOffset+X===c?C.loadAsync(X).then((()=>({json:this._parseJson(C.readString(X)),bin:null}))):C.loadAsync(X+8).then((()=>{const P={json:this._parseJson(C.readString(X)),bin:null},V=()=>{const X=C.readUint32();switch(C.readUint32()){case d:throw new Error("Unexpected JSON chunk");case b:{const c=C.byteOffset;P.bin={readAsync:(d,b)=>C.buffer.readAsync(c+d,b),byteLength:X},C.skipBytes(X);break}default:C.skipBytes(X)}return C.byteOffset!==c?C.loadAsync(8).then(V):Promise.resolve(P)};return V()}))}static _parseVersion(C){if("1.0"===C||"1.0.1"===C)return{major:1,minor:0};const c=(C+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(C,c){return C.major>c.major?1:C.major<c.major?-1:C.minor>c.minor?1:C.minor<c.minor?-1:0}_logOpen(C){this._log(C),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(C){const c=T._logSpaces.substring(0,2*this._logIndentLevel);j.d.Log(`${c}${C}`)}_logDisabled(C){}_startPerformanceCounterEnabled(C){X.Tools.StartPerformanceCounter(C)}_startPerformanceCounterDisabled(C){}_endPerformanceCounterEnabled(C){X.Tools.EndPerformanceCounter(C)}_endPerformanceCounterDisabled(C){}}T.IncrementalLoading=!0,T.HomogeneousCoordinates=!1,T._logSpaces="                                ",(0,P.c)(new T)},14063:(C,c,d)=>{"use strict";d.d(c,{b:()=>V});var b=d(12219);function X(C,c,d,b){const X={externalResourceFunction:b};return d&&(X.uri="file:"===c?d:c+d),ArrayBuffer.isView(C)?GLTFValidator.validateBytes(C,X):GLTFValidator.validateString(C,X)}function P(){const C=[];onmessage=c=>{const d=c.data;switch(d.id){case"init":importScripts(d.url);break;case"validate":X(d.data,d.rootUrl,d.fileName,(c=>new Promise(((d,b)=>{const X=C.length;C.push({resolve:d,reject:b}),postMessage({id:"getExternalResource",index:X,uri:c})})))).then((C=>{postMessage({id:"validate.resolve",value:C})}),(C=>{postMessage({id:"validate.reject",reason:C})}));break;case"getExternalResource.resolve":C[d.index].resolve(d.value);break;case"getExternalResource.reject":C[d.index].reject(d.reason)}}}class V{static ValidateAsync(C,c,d,V){return"function"===typeof Worker?new Promise(((R,p)=>{const j=`${X}(${P})()`,g=URL.createObjectURL(new Blob([j],{type:"application/javascript"})),k=new Worker(g),Z=C=>{k.removeEventListener("error",Z),k.removeEventListener("message",U),p(C)},U=C=>{const c=C.data;switch(c.id){case"getExternalResource":V(c.uri).then((C=>{k.postMessage({id:"getExternalResource.resolve",index:c.index,value:C},[C.buffer])}),(C=>{k.postMessage({id:"getExternalResource.reject",index:c.index,reason:C})}));break;case"validate.resolve":k.removeEventListener("error",Z),k.removeEventListener("message",U),R(c.value),k.terminate();break;case"validate.reject":k.removeEventListener("error",Z),k.removeEventListener("message",U),p(c.reason),k.terminate()}};if(k.addEventListener("error",Z),k.addEventListener("message",U),k.postMessage({id:"init",url:b.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(C)){const b=C.slice();k.postMessage({id:"validate",data:b,rootUrl:c,fileName:d},[b.buffer])}else k.postMessage({id:"validate",data:C,rootUrl:c,fileName:d})})):(this._LoadScriptPromise||(this._LoadScriptPromise=b.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>X(C,c,d,V))))}}V.Configuration={url:`${b.Tools._DefaultCdnUrl}/gltf_validator.js`}},14625:(C,c,d)=>{"use strict";d.d(c,{b:()=>N});var b=d(12384),X=d(12388),P=d(12431),V=d(12403),R=d(12774),p=d(12710),j=d(12471),g=d(12637),k=d(12345),Z=d(12292);d(13839),d(13731),d(13748),d(13735),d(13754),d(13762),d(13765);const U="imageProcessingCompatibility",A="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Z.e.IncludesShadersStore[U]||(Z.e.IncludesShadersStore[U]=A);const u="skyPixelShader",q="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Z.e.ShadersStore[u]||(Z.e.ShadersStore[u]=q);d(13843),d(13770),d(13778),d(13789),d(13786);const B="skyVertexShader",t="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Z.e.ShadersStore[B]||(Z.e.ShadersStore[B]=t);var e=d(12704),n=d(12756),W=d(12750);class E extends R.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class N extends p.b{constructor(C,c){super(C,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new V.dd(0,100,0),this.useSunPosition=!1,this.cameraOffset=V.dd.Zero(),this.up=V.dd.Up(),this.dithering=!1,this._cameraPosition=V.dd.Zero(),this._skyOrientation=new V.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(C,c){const d=c._drawWrapper;if(this.isFrozen&&d.effect&&d._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new E);const b=c.materialDefines,X=this.NC();if(this._isReadyForSubMesh(c))return!0;if((0,W.R)(C,X,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,b),(0,W.I)(C,b,!0,!1),b.IMAGEPROCESSINGPOSTPROCESS!==X.imageProcessingConfiguration.applyByPostProcess&&b.markAsMiscDirty(),b.DITHER!==this.dithering&&b.markAsMiscDirty(),b.isDirty){b.markAsProcessed(),X.resetCachedMaterial();const C=new e.c;b.FOG&&C.addFallback(1,"FOG"),b.IMAGEPROCESSINGPOSTPROCESS=X.imageProcessingConfiguration.applyByPostProcess,b.DITHER=this.dithering;const d=[j.g.PositionKind];b.VERTEXCOLOR&&d.push(j.g.ColorKind);const P="sky",V=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,n.b)(V);const R=b.toString();c.setEffect(X.getEngine().createEffect(P,d,V,[],R,C,this.onCompiled,this.onError),b,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(b._renderId=X.getRenderId(),d._wasPreviouslyReady=!0,!0)}bindForSubMesh(C,c,d){const b=this.NC(),X=d.materialDefines;if(!X)return;const P=d.effect;if(!P)return;this._activeEffect=P,this.bindOnlyWorldMatrix(C),this._activeEffect.setMatrix("viewProjection",b.getTransformMatrix()),this._mustRebind(b,P,d)&&((0,n.e)(P,this,b),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,W.o)(X,P,b)),b.fogEnabled&&c.applyFog&&b.fogMode!==g.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",b.getViewMatrix()),(0,W.g)(b,c,this._activeEffect);const R=b.activeCamera;if(R){const C=R.getWorldMatrix();this._cameraPosition.x=C.m[12],this._cameraPosition.y=C.m[13],this._cameraPosition.z=C.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const C=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(C),this.sunPosition.y=this.distance*Math.sin(-C),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(C),V.Quaternion.FromUnitVectorsToRef(V.dd.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,d)}getAnimatables(){return[]}dispose(C){super.dispose(C)}clone(C){return P.e.Clone((()=>new N(C,this.NC())),this)}serialize(){const C=super.serialize();return C.customType="BABYLON.SkyMaterial",C}getClassName(){return"SkyMaterial"}static Parse(C,c,d){return P.e.Parse((()=>new N(C.name,c)),C,c,d)}}(0,b.e)([(0,X.P)()],N.prototype,"luminance",void 0),(0,b.e)([(0,X.P)()],N.prototype,"turbidity",void 0),(0,b.e)([(0,X.P)()],N.prototype,"rayleigh",void 0),(0,b.e)([(0,X.P)()],N.prototype,"mieCoefficient",void 0),(0,b.e)([(0,X.P)()],N.prototype,"mieDirectionalG",void 0),(0,b.e)([(0,X.P)()],N.prototype,"distance",void 0),(0,b.e)([(0,X.P)()],N.prototype,"inclination",void 0),(0,b.e)([(0,X.P)()],N.prototype,"azimuth",void 0),(0,b.e)([(0,X.L)()],N.prototype,"sunPosition",void 0),(0,b.e)([(0,X.P)()],N.prototype,"useSunPosition",void 0),(0,b.e)([(0,X.L)()],N.prototype,"cameraOffset",void 0),(0,b.e)([(0,X.L)()],N.prototype,"up",void 0),(0,b.e)([(0,X.P)()],N.prototype,"dithering",void 0),(0,k.e)("BABYLON.SkyMaterial",N)},13112:(C,c,d)=>{"use strict";function b(C,c){c.headers=C.headers||{},c.statusMessage=C.statusText,c.statusCode=C.status,c.data=C.response}function X(C,c,d){return new Promise((function(X,P){d=d||{};var V,R,p,j=new XMLHttpRequest,g=d.body,k=d.headers||{};for(V in d.timeout&&(j.timeout=d.timeout),j.ontimeout=j.onerror=function(C){C.timeout="timeout"==C.type,P(C)},j.open(C,c.href||c),j.onload=function(){for(p=j.getAllResponseHeaders().trim().split(/[\r\n]+/),b(j,j);R=p.shift();)R=R.split(": "),j.headers[R.shift().toLowerCase()]=R.join(": ");if((R=j.headers["content-type"])&&~R.indexOf("application/json"))try{j.data=JSON.parse(j.data,d.reviver)}catch(C){return b(j,C),P(C)}(j.status>=400?P:X)(j)},typeof FormData<"u"&&g instanceof FormData||g&&"object"==typeof g&&(k["content-type"]="application/json",g=JSON.stringify(g)),j.withCredentials=!!d.withCredentials,k)j.setRequestHeader(V,k[V]);j.send(g)}))}d.r(c),d.d(c,{del:()=>p,get:()=>P,patch:()=>R,post:()=>V,put:()=>j,send:()=>X});var P=X.bind(X,"GET"),V=X.bind(X,"POST"),R=X.bind(X,"PATCH"),p=X.bind(X,"DELETE"),j=X.bind(X,"PUT")},14735:(C,c,d)=>{"use strict";d.d(c,{d:()=>k});const b=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,P=1/3,V=1/6,R=(Math.sqrt(5)-1)/4,p=(5-Math.sqrt(5))/20,j=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),g=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const k=class{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof C?C:function(C){let c=0,d=0,b=0,X=1;const P=function(){let C=4022871197;return function(c){c=c.toString();for(let d=0;d<c.length;d++){C+=c.charCodeAt(d);let b=.02519603282416938*C;C=b>>>0,b-=C,b*=C,C=b>>>0,b-=C,C+=4294967296*b}return 2.3283064365386963e-10*(C>>>0)}}();c=P(" "),d=P(" "),b=P(" "),c-=P(C),c<0&&(c+=1);d-=P(C),d<0&&(d+=1);b-=P(C),b<0&&(b+=1);return function(){const C=2091639*c+2.3283064365386963e-10*X;return c=d,d=b,b=C-(X=0|C)}}(C);this.p=function(C){const c=new Uint8Array(256);for(let d=0;d<256;d++)c[d]=d;for(let d=0;d<255;d++){const b=d+~~(C()*(256-d)),X=c[d];c[d]=c[b],c[b]=X}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let d=0;d<512;d++)this.perm[d]=this.p[255&d],this.permMod12[d]=this.perm[d]%12}noise2D(C,c){const d=this.permMod12,P=this.perm;let V=0,R=0,p=0;const g=(C+c)*b,k=Math.floor(C+g),Z=Math.floor(c+g),U=(k+Z)*X,A=C-(k-U),u=c-(Z-U);let q,B;A>u?(q=1,B=0):(q=0,B=1);const t=A-q+X,e=u-B+X,n=A-1+2*X,W=u-1+2*X,E=255&k,N=255&Z;let r=.5-A*A-u*u;if(r>=0){const C=3*d[E+P[N]];r*=r,V=r*r*(j[C]*A+j[C+1]*u)}let M=.5-t*t-e*e;if(M>=0){const C=3*d[E+q+P[N+B]];M*=M,R=M*M*(j[C]*t+j[C+1]*e)}let K=.5-n*n-W*W;if(K>=0){const C=3*d[E+1+P[N+1]];K*=K,p=K*K*(j[C]*n+j[C+1]*W)}return 70*(V+R+p)}noise3D(C,c,d){const b=this.permMod12,X=this.perm;let R,p,g,k;const Z=(C+c+d)*P,U=Math.floor(C+Z),A=Math.floor(c+Z),u=Math.floor(d+Z),q=(U+A+u)*V,B=C-(U-q),t=c-(A-q),e=d-(u-q);let n,W,E,N,r,M;B>=t?t>=e?(n=1,W=0,E=0,N=1,r=1,M=0):B>=e?(n=1,W=0,E=0,N=1,r=0,M=1):(n=0,W=0,E=1,N=1,r=0,M=1):t<e?(n=0,W=0,E=1,N=0,r=1,M=1):B<e?(n=0,W=1,E=0,N=0,r=1,M=1):(n=0,W=1,E=0,N=1,r=1,M=0);const K=B-n+V,i=t-W+V,h=e-E+V,L=B-N+2*V,f=t-r+2*V,T=e-M+2*V,z=B-1+.5,w=t-1+.5,J=e-1+.5,y=255&U,x=255&A,H=255&u;let v=.6-B*B-t*t-e*e;if(v<0)R=0;else{const C=3*b[y+X[x+X[H]]];v*=v,R=v*v*(j[C]*B+j[C+1]*t+j[C+2]*e)}let D=.6-K*K-i*i-h*h;if(D<0)p=0;else{const C=3*b[y+n+X[x+W+X[H+E]]];D*=D,p=D*D*(j[C]*K+j[C+1]*i+j[C+2]*h)}let s=.6-L*L-f*f-T*T;if(s<0)g=0;else{const C=3*b[y+N+X[x+r+X[H+M]]];s*=s,g=s*s*(j[C]*L+j[C+1]*f+j[C+2]*T)}let mC=.6-z*z-w*w-J*J;if(mC<0)k=0;else{const C=3*b[y+1+X[x+1+X[H+1]]];mC*=mC,k=mC*mC*(j[C]*z+j[C+1]*w+j[C+2]*J)}return 32*(R+p+g+k)}noise4D(C,c,d,b){const X=this.perm;let P,V,j,k,Z;const U=(C+c+d+b)*R,A=Math.floor(C+U),u=Math.floor(c+U),q=Math.floor(d+U),B=Math.floor(b+U),t=(A+u+q+B)*p,e=C-(A-t),n=c-(u-t),W=d-(q-t),E=b-(B-t);let N=0,r=0,M=0,K=0;e>n?N++:r++,e>W?N++:M++,e>E?N++:K++,n>W?r++:M++,n>E?r++:K++,W>E?M++:K++;const i=N>=3?1:0,h=r>=3?1:0,L=M>=3?1:0,f=K>=3?1:0,T=N>=2?1:0,z=r>=2?1:0,w=M>=2?1:0,J=K>=2?1:0,y=N>=1?1:0,x=r>=1?1:0,H=M>=1?1:0,v=K>=1?1:0,D=e-i+p,s=n-h+p,mC=W-L+p,Q=E-f+p,I=e-T+2*p,o=n-z+2*p,F=W-w+2*p,Y=E-J+2*p,l=e-y+3*p,S=n-x+3*p,G=W-H+3*p,a=E-v+3*p,O=e-1+4*p,CC=n-1+4*p,cC=W-1+4*p,dC=E-1+4*p,bC=255&A,XC=255&u,PC=255&q,VC=255&B;let RC=.6-e*e-n*n-W*W-E*E;if(RC<0)P=0;else{const C=X[bC+X[XC+X[PC+X[VC]]]]%32*4;RC*=RC,P=RC*RC*(g[C]*e+g[C+1]*n+g[C+2]*W+g[C+3]*E)}let pC=.6-D*D-s*s-mC*mC-Q*Q;if(pC<0)V=0;else{const C=X[bC+i+X[XC+h+X[PC+L+X[VC+f]]]]%32*4;pC*=pC,V=pC*pC*(g[C]*D+g[C+1]*s+g[C+2]*mC+g[C+3]*Q)}let jC=.6-I*I-o*o-F*F-Y*Y;if(jC<0)j=0;else{const C=X[bC+T+X[XC+z+X[PC+w+X[VC+J]]]]%32*4;jC*=jC,j=jC*jC*(g[C]*I+g[C+1]*o+g[C+2]*F+g[C+3]*Y)}let gC=.6-l*l-S*S-G*G-a*a;if(gC<0)k=0;else{const C=X[bC+y+X[XC+x+X[PC+H+X[VC+v]]]]%32*4;gC*=gC,k=gC*gC*(g[C]*l+g[C+1]*S+g[C+2]*G+g[C+3]*a)}let kC=.6-O*O-CC*CC-cC*cC-dC*dC;if(kC<0)Z=0;else{const C=X[bC+1+X[XC+1+X[PC+1+X[VC+1]]]]%32*4;kC*=kC,Z=kC*kC*(g[C]*O+g[C+1]*CC+g[C+2]*cC+g[C+3]*dC)}return 27*(P+V+j+k+Z)}}}}]);