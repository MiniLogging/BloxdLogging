/*! For license information please see udno06.32.33eccf08.chunk.js.LICENSE.txt */
(self.z22hkk7o33f=self.z22hkk7o33f||[]).push([[32],{13551:function(U,G){!function(U){"use strict";var G=function(U,C){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,G){U.__proto__=G}||function(U,G){for(var C in G)Object.prototype.hasOwnProperty.call(G,C)&&(U[C]=G[C])},G(U,C)};function C(U,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function L(){this.constructor=U}G(U,C),U.prototype=null===C?Object.create(C):(L.prototype=C.prototype,new L)}function L(U,G,C,L){var X,l=arguments.length,t=l<3?G:null===L?L=Object.getOwnPropertyDescriptor(G,C):L;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)t=Reflect.decorate(U,G,C,L);else for(var E=U.length-1;E>=0;E--)(X=U[E])&&(t=(l<3?X(t):l>3?X(G,C,t):X(G,C))||t);return l>3&&t&&Object.defineProperty(G,C,t),t}function X(U,G,C){if(C||2===arguments.length)for(var L,X=0,l=G.length;X<l;X++)!L&&X in G||(L||(L=Array.prototype.slice.call(G,0,X)),L[X]=G[X]);return U.concat(L||Array.prototype.slice.call(G))}var l,t=255,E=213;U.OPERATION=void 0,(l=U.OPERATION||(U.OPERATION={}))[l.ADD=128]="ADD",l[l.REPLACE=0]="REPLACE",l[l.DELETE=64]="DELETE",l[l.DELETE_AND_ADD=192]="DELETE_AND_ADD",l[l.TOUCH=1]="TOUCH",l[l.CLEAR=10]="CLEAR";var K=function(){function G(U,G,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=U,this.setParent(G,C)}return G.prototype.setParent=function(U,G,C){var L=this;if(this.indexes||(this.indexes=this.ref instanceof qU?this.ref._definition.indexes:{}),this.parent=U,this.parentIndex=C,G)if(this.root=G,this.ref instanceof qU){var X=this.ref._definition;for(var l in X.schema){var t=this.ref[l];if(t&&t.$changes){var E=X.indexes[l];t.$changes.setParent(this.ref,G,E)}}}else"object"===typeof this.ref&&this.ref.forEach((function(U,G){if(U instanceof qU){var C=U.$changes,X=L.ref.$changes.indexes[G];C.setParent(L.ref,L.root,X)}}))},G.prototype.operation=function(U){this.changes.set(--this.currentCustomOperation,U)},G.prototype.change=function(G,C){void 0===C&&(C=U.OPERATION.ADD);var L="number"===typeof G?G:this.indexes[G];this.assertValidIndex(L,G);var X=this.changes.get(L);X&&X.op!==U.OPERATION.DELETE&&X.op!==U.OPERATION.TOUCH||this.changes.set(L,{op:X&&X.op===U.OPERATION.DELETE?U.OPERATION.DELETE_AND_ADD:C,index:L}),this.allChanges.add(L),this.changed=!0,this.touchParents()},G.prototype.touch=function(G){var C="number"===typeof G?G:this.indexes[G];this.assertValidIndex(C,G),this.changes.has(C)||this.changes.set(C,{op:U.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},G.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},G.prototype.getType=function(U){if(this.ref._definition)return(G=this.ref._definition).schema[G.fieldsByIndex[U]];var G,C=(G=this.parent._definition).schema[G.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},G.prototype.getChildrenFilter=function(){var U=this.parent._definition.childFilters;return U&&U[this.parentIndex]},G.prototype.getValue=function(U){return this.ref.getByIndex(U)},G.prototype.delete=function(G){var C="number"===typeof G?G:this.indexes[G];if(void 0!==C){var L=this.getValue(C);this.changes.set(C,{op:U.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],L&&L.$changes&&(L.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(G," (").concat(C,")"))},G.prototype.discard=function(G,C){var L=this;void 0===G&&(G=!1),void 0===C&&(C=!1),this.ref instanceof qU||this.changes.forEach((function(G){if(G.op===U.OPERATION.DELETE){var C=L.ref.getIndex(G.index);delete L.indexes[C]}})),this.changes.clear(),this.changed=G,C&&this.allChanges.clear(),this.currentCustomOperation=0},G.prototype.discardAll=function(){var U=this;this.changes.forEach((function(G){var C=U.getValue(G.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},G.prototype.cache=function(U,G){this.caches[U]=G},G.prototype.clone=function(){return new G(this.ref,this.parent,this.root)},G.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},G.prototype.assertValidIndex=function(U,G){if(void 0===U)throw new Error('ChangeTree: missing index for field "'.concat(G,'"'))},G}();function P(U,G,C,L){return U[G]||(U[G]=[]),U[G].push(C),null===L||void 0===L||L.forEach((function(U,G){return C(U,G)})),function(){return T(U[G],U[G].indexOf(C))}}function O(G){var C=this,L="string"!==typeof this.$changes.getType();this.$items.forEach((function(X,l){G.push({refId:C.$changes.refId,op:U.OPERATION.DELETE,field:l,value:void 0,previousValue:X}),L&&C.$changes.root.removeRef(X.$changes.refId)}))}function T(U,G){if(-1===G||G>=U.length)return!1;for(var C=U.length-1,L=G;L<C;L++)U[L]=U[L+1];return U.length=C,!0}var D=function(U,G){var C=U.toString(),L=G.toString();return C<L?-1:C>L?1:0};function y(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,G){return"symbol"===typeof G||isNaN(G)?U[G]:U.at(G)},set:function(U,G,C){if("symbol"===typeof G||isNaN(G))U[G]=C;else{var L=Array.from(U.$items.keys()),X=parseInt(L[G]||G);void 0===C||null===C?U.deleteAt(X):U.setAt(X,C)}return!0},deleteProperty:function(U,G){return"number"===typeof G?U.deleteAt(G):delete U[G],!0}})}var V=function(){function G(){for(var U=[],G=0;G<arguments.length;G++)U[G]=arguments[G];this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,U)}return G.prototype.PK=function(G,C){return void 0===C&&(C=!0),P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,G,C?this.$items:void 0)},G.prototype.XC=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,G)},G.is=function(U){return Array.isArray(U)||void 0!==U.array},Object.defineProperty(G.prototype,"length",{get:function(){return this.$items.size},set:function(U){0===U?this.clear():this.splice(U,this.length-U)},enumerable:!1,configurable:!0}),G.prototype.push=function(){for(var U,G=this,C=[],L=0;L<arguments.length;L++)C[L]=arguments[L];return C.forEach((function(C){U=G.$refId++,G.setAt(U,C)})),U},G.prototype.pop=function(){var U=Array.from(this.$indexes.values()).pop();if(void 0!==U){this.$changes.delete(U),this.$indexes.delete(U);var G=this.$items.get(U);return this.$items.delete(U),G}},G.prototype.at=function(U){var G=Array.from(this.$items.keys())[U];return this.$items.get(G)},G.prototype.setAt=function(G,C){var L,X;if(void 0!==C&&null!==C){if(this.$items.get(G)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,G);var l=null!==(X=null===(L=this.$changes.indexes[G])||void 0===L?void 0:L.op)&&void 0!==X?X:U.OPERATION.ADD;this.$changes.indexes[G]=G,this.$indexes.set(G,G),this.$items.set(G,C),this.$changes.change(G,l)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},G.prototype.deleteAt=function(U){var G=Array.from(this.$items.keys())[U];return void 0!==G&&this.$deleteAt(G)},G.prototype.$deleteAt=function(U){return this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U)},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&O.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.concat=function(){for(var U,C=[],L=0;L<arguments.length;L++)C[L]=arguments[L];return new(G.bind.apply(G,X([void 0],(U=Array.from(this.$items.values())).concat.apply(U,C),!1)))},G.prototype.join=function(U){return Array.from(this.$items.values()).join(U)},G.prototype.reverse=function(){var U=this,G=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,L){U.setAt(G[L],C)})),this},G.prototype.shift=function(){var U=Array.from(this.$items.keys()).shift();if(void 0!==U){var G=this.$items.get(U);return this.$deleteAt(U),G}},G.prototype.slice=function(U,C){var L=new G;return L.push.apply(L,Array.from(this.$items.values()).slice(U,C)),L},G.prototype.sort=function(U){var G=this;void 0===U&&(U=D);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(U).forEach((function(U,L){G.setAt(C[L],U)})),this},G.prototype.splice=function(U,G){void 0===G&&(G=this.length-U);for(var C=Array.from(this.$items.keys()),L=[],X=U;X<U+G;X++)L.push(this.$items.get(C[X])),this.$deleteAt(C[X]);return L},G.prototype.unshift=function(){for(var U=this,G=[],C=0;C<arguments.length;C++)G[C]=arguments[C];var L=this.length,X=G.length,l=Array.from(this.$items.values());return G.forEach((function(G,C){U.setAt(C,G)})),l.forEach((function(G,C){U.setAt(X+C,G)})),L+X},G.prototype.indexOf=function(U,G){return Array.from(this.$items.values()).indexOf(U,G)},G.prototype.lastIndexOf=function(U,G){return void 0===G&&(G=this.length-1),Array.from(this.$items.values()).lastIndexOf(U,G)},G.prototype.every=function(U,G){return Array.from(this.$items.values()).every(U,G)},G.prototype.some=function(U,G){return Array.from(this.$items.values()).some(U,G)},G.prototype.forEach=function(U,G){Array.from(this.$items.values()).forEach(U,G)},G.prototype.map=function(U,G){return Array.from(this.$items.values()).map(U,G)},G.prototype.filter=function(U,G){return Array.from(this.$items.values()).filter(U,G)},G.prototype.reduce=function(U,G){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},G.prototype.reduceRight=function(U,G){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},G.prototype.find=function(U,G){return Array.from(this.$items.values()).find(U,G)},G.prototype.findIndex=function(U,G){return Array.from(this.$items.values()).findIndex(U,G)},G.prototype.fill=function(U,G,C){throw new Error("ArraySchema#fill() not implemented")},G.prototype.copyWithin=function(U,G,C){throw new Error("ArraySchema#copyWithin() not implemented")},G.prototype.toString=function(){return this.$items.toString()},G.prototype.toLocaleString=function(){return this.$items.toLocaleString()},G.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(G,Symbol.species,{get:function(){return G},enumerable:!1,configurable:!0}),G.prototype.entries=function(){return this.$items.entries()},G.prototype.keys=function(){return this.$items.keys()},G.prototype.values=function(){return this.$items.values()},G.prototype.includes=function(U,G){return Array.from(this.$items.values()).includes(U,G)},G.prototype.flatMap=function(U,G){throw new Error("ArraySchema#flatMap() is not supported.")},G.prototype.flat=function(U){throw new Error("ArraySchema#flat() is not supported.")},G.prototype.findLast=function(){var U=Array.from(this.$items.values());return U.findLast.apply(U,arguments)},G.prototype.findLastIndex=function(){var U=Array.from(this.$items.values());return U.findLastIndex.apply(U,arguments)},G.prototype.setIndex=function(U,G){this.$indexes.set(U,G)},G.prototype.getIndex=function(U){return this.$indexes.get(U)},G.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},G.prototype.deleteByIndex=function(U){var G=this.$indexes.get(U);this.$items.delete(G),this.$indexes.delete(U)},G.prototype.toArray=function(){return Array.from(this.$items.values())},G.prototype.toJSON=function(){return this.toArray().map((function(U){return"function"===typeof U.toJSON?U.toJSON():U}))},G.prototype.clone=function(U){return U?new(G.bind.apply(G,X([void 0],Array.from(this.$items.values()),!1))):new(G.bind.apply(G,X([void 0],this.map((function(U){return U.$changes?U.clone():U})),!1)))},G}();function p(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,G){return"symbol"!==typeof G&&"undefined"===typeof U[G]?U.get(G):U[G]},set:function(U,G,C){return"symbol"!==typeof G&&-1===G.indexOf("$")&&"PK"!==G&&"XC"!==G&&"onChange"!==G?U.set(G,C):U[G]=C,!0},deleteProperty:function(U,G){return U.delete(G),!0}})}var I=function(){function G(U){var C=this;if(this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U)if(U instanceof Map||U instanceof G)U.forEach((function(U,G){return C.set(G,U)}));else for(var L in U)this.set(L,U[L])}return G.prototype.PK=function(G,C){return void 0===C&&(C=!0),P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,G,C?this.$items:void 0)},G.prototype.XC=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,G)},G.is=function(U){return void 0!==U.map},G.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(G.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(G,Symbol.species,{get:function(){return G},enumerable:!1,configurable:!0}),G.prototype.set=function(G,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(G,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(G,"'."));G=G.toString();var L="undefined"!==typeof this.$changes.indexes[G],X=L?this.$changes.indexes[G]:this.$refId++,l=L?U.OPERATION.REPLACE:U.OPERATION.ADD,t=void 0!==C.$changes;if(t&&C.$changes.setParent(this,this.$changes.root,X),L){if(!t&&this.$items.get(G)===C)return;t&&this.$items.get(G)!==C&&(l=U.OPERATION.ADD)}else this.$changes.indexes[G]=X,this.$indexes.set(X,G);return this.$items.set(G,C),this.$changes.change(G,l),this},G.prototype.get=function(U){return this.$items.get(U)},G.prototype.delete=function(U){return this.$changes.delete(U),this.$items.delete(U)},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&O.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.has=function(U){return this.$items.has(U)},G.prototype.forEach=function(U){this.$items.forEach(U)},G.prototype.entries=function(){return this.$items.entries()},G.prototype.keys=function(){return this.$items.keys()},G.prototype.values=function(){return this.$items.values()},Object.defineProperty(G.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),G.prototype.setIndex=function(U,G){this.$indexes.set(U,G)},G.prototype.getIndex=function(U){return this.$indexes.get(U)},G.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},G.prototype.deleteByIndex=function(U){var G=this.$indexes.get(U);this.$items.delete(G),this.$indexes.delete(U)},G.prototype.toJSON=function(){var U={};return this.forEach((function(G,C){U[C]="function"===typeof G.toJSON?G.toJSON():G})),U},G.prototype.clone=function(U){var C;return U?C=Object.assign(new G,this):(C=new G,this.forEach((function(U,G){U.$changes?C.set(G,U.clone()):C.set(G,U)}))),C},G}(),H={};function x(U,G){H[U]=G}function h(U){return H[U]}var N=function(){function U(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return U.create=function(G){var C=new U;return C.schema=Object.assign({},G&&G.schema||{}),C.indexes=Object.assign({},G&&G.indexes||{}),C.fieldsByIndex=Object.assign({},G&&G.fieldsByIndex||{}),C.descriptors=Object.assign({},G&&G.descriptors||{}),C.deprecated=Object.assign({},G&&G.deprecated||{}),C},U.prototype.addField=function(U,G){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=U,this.indexes[U]=C,this.schema[U]=Array.isArray(G)?{array:G[0]}:G},U.prototype.hasField=function(U){return void 0!==this.indexes[U]},U.prototype.addFilter=function(U,G){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[U]]=G,this.indexesWithFilters.push(this.indexes[U]),!0},U.prototype.addChildrenFilter=function(U,G){var C=this.indexes[U],L=this.schema[U];if(h(Object.keys(L)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=G,!0;console.warn("@filterChildren: field '".concat(U,"' can't have children. Ignoring filter."))},U.prototype.getChildrenFilter=function(U){return this.childFilters&&this.childFilters[this.indexes[U]]},U.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},U}();function b(U){return U._context&&U._context.useFilters}var o=function(){function U(){this.types={},this.schemas=new Map,this.useFilters=!1}return U.prototype.has=function(U){return this.schemas.has(U)},U.prototype.get=function(U){return this.types[U]},U.prototype.add=function(U,G){void 0===G&&(G=this.schemas.size),U._definition=N.create(U._definition),U._typeid=G,this.types[G]=U,this.schemas.set(U,G)},U.create=function(G){return void 0===G&&(G={}),function(C){return G.context||(G.context=new U),S(C,G)}},U}(),w=new o;function S(U,G){return void 0===G&&(G={}),function(C,L){var l=G.context||w,t=C.constructor;if(t._context=l,!U)throw new Error("".concat(t.name,': @type() reference provided for "').concat(L,"\" is undefined. Make sure you don't have any circular dependencies."));l.has(t)||l.add(t);var E=t._definition;if(E.addField(L,U),E.descriptors[L]){if(E.deprecated[L])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(L,"' definition on '").concat(t.name,"'.\nCheck @type() annotation"))}catch(H){var K=H.stack.split("\n")[4].trim();throw new Error("".concat(H.message," ").concat(K))}}var P=V.is(U),O=!P&&I.is(U);if("string"!==typeof U&&!qU.is(U)){var T=Object.values(U)[0];"string"===typeof T||l.has(T)||l.add(T)}if(G.manual)E.descriptors[L]={enumerable:!0,configurable:!0,writable:!0};else{var D="_".concat(L);E.descriptors[D]={enumerable:!1,configurable:!1,writable:!0},E.descriptors[L]={get:function(){return this[D]},set:function(U){U!==this[D]&&(void 0!==U&&null!==U?(!P||U instanceof V||(U=new(V.bind.apply(V,X([void 0],U,!1)))),!O||U instanceof I||(U=new I(U)),void 0===U.$proxy&&(O?U=p(U):P&&(U=y(U))),this.$changes.change(L),U.$changes&&U.$changes.setParent(this,this.$changes.root,this._definition.indexes[L])):this[D]&&this.$changes.delete(L),this[D]=U)},enumerable:!0,configurable:!0}}}}function v(U){return function(G,C){var L=G.constructor;L._definition.addFilter(C,U)&&(L._context.useFilters=!0)}}function u(U){return function(G,C){var L=G.constructor;L._definition.addChildrenFilter(C,U)&&(L._context.useFilters=!0)}}function d(U){return void 0===U&&(U=!0),function(G,C){var L=G.constructor._definition;L.deprecated[C]=!0,U&&(L.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(U){},enumerable:!1,configurable:!0})}}function g(U,G,C){for(var L in void 0===C&&(C={}),C.context||(C.context=U._context||C.context||w),G)S(G[L],C)(U.prototype,L);return U}function Z(U){for(var G=0,C=0,L=0,X=U.length;L<X;L++)(G=U.charCodeAt(L))<128?C+=1:G<2048?C+=2:G<55296||G>=57344?C+=3:(L++,C+=4);return C}function F(U,G,C){for(var L=0,X=0,l=C.length;X<l;X++)(L=C.charCodeAt(X))<128?U[G++]=L:L<2048?(U[G++]=192|L>>6,U[G++]=128|63&L):L<55296||L>=57344?(U[G++]=224|L>>12,U[G++]=128|L>>6&63,U[G++]=128|63&L):(X++,L=65536+((1023&L)<<10|1023&C.charCodeAt(X)),U[G++]=240|L>>18,U[G++]=128|L>>12&63,U[G++]=128|L>>6&63,U[G++]=128|63&L)}function q(U,G){U.push(255&G)}function a(U,G){U.push(255&G)}function k(U,G){U.push(255&G),U.push(G>>8&255)}function n(U,G){U.push(255&G),U.push(G>>8&255)}function Q(U,G){U.push(255&G),U.push(G>>8&255),U.push(G>>16&255),U.push(G>>24&255)}function mU(U,G){var C=G>>24,L=G>>16,X=G>>8,l=G;U.push(255&l),U.push(255&X),U.push(255&L),U.push(255&C)}function B(U,G){var C=Math.floor(G/Math.pow(2,32));mU(U,G>>>0),mU(U,C)}function M(U,G){var C=G/Math.pow(2,32)|0;mU(U,G>>>0),mU(U,C)}function z(U,G){e(U,G)}function s(U,G){i(U,G)}var j=new Int32Array(2),A=new Float32Array(j.buffer),Y=new Float64Array(j.buffer);function e(U,G){A[0]=G,Q(U,j[0])}function i(U,G){Y[0]=G,Q(U,j[0]),Q(U,j[1])}function c(U,G){return a(U,G?1:0)}function R(U,G){G||(G="");var C=Z(G),L=0;if(C<32)U.push(160|C),L=1;else if(C<256)U.push(217),a(U,C),L=2;else if(C<65536)U.push(218),n(U,C),L=3;else{if(!(C<4294967296))throw new Error("String too long");U.push(219),mU(U,C),L=5}return F(U,U.length,G),L+C}function W(U,G){return isNaN(G)?W(U,0):isFinite(G)?G!==(0|G)?(U.push(203),i(U,G),9):G>=0?G<128?(a(U,G),1):G<256?(U.push(204),a(U,G),2):G<65536?(U.push(205),n(U,G),3):G<4294967296?(U.push(206),mU(U,G),5):(U.push(207),M(U,G),9):G>=-32?(U.push(224|G+32),1):G>=-128?(U.push(208),q(U,G),2):G>=-32768?(U.push(209),k(U,G),3):G>=-2147483648?(U.push(210),Q(U,G),5):(U.push(211),B(U,G),9):W(U,G>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var f=Object.freeze({__proto__:null,utf8Write:F,int8:q,uint8:a,int16:k,uint16:n,int32:Q,uint32:mU,int64:B,uint64:M,float32:z,float64:s,writeFloat32:e,writeFloat64:i,boolean:c,string:R,number:W});function r(U,G,C){for(var L="",X=0,l=G,t=G+C;l<t;l++){var E=U[l];0!==(128&E)?192!==(224&E)?224!==(240&E)?240!==(248&E)?console.error("Invalid byte "+E.toString(16)):(X=(7&E)<<18|(63&U[++l])<<12|(63&U[++l])<<6|63&U[++l])>=65536?(X-=65536,L+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):L+=String.fromCharCode(X):L+=String.fromCharCode((15&E)<<12|(63&U[++l])<<6|63&U[++l]):L+=String.fromCharCode((31&E)<<6|63&U[++l]):L+=String.fromCharCode(E)}return L}function J(U,G){return UU(U,G)<<24>>24}function UU(U,G){return U[G.offset++]}function GU(U,G){return CU(U,G)<<16>>16}function CU(U,G){return U[G.offset++]|U[G.offset++]<<8}function LU(U,G){return U[G.offset++]|U[G.offset++]<<8|U[G.offset++]<<16|U[G.offset++]<<24}function XU(U,G){return LU(U,G)>>>0}function lU(U,G){return DU(U,G)}function tU(U,G){return yU(U,G)}function EU(U,G){var C=XU(U,G);return LU(U,G)*Math.pow(2,32)+C}function KU(U,G){var C=XU(U,G);return XU(U,G)*Math.pow(2,32)+C}var PU=new Int32Array(2),OU=new Float32Array(PU.buffer),TU=new Float64Array(PU.buffer);function DU(U,G){return PU[0]=LU(U,G),OU[0]}function yU(U,G){return PU[0]=LU(U,G),PU[1]=LU(U,G),TU[0]}function VU(U,G){return UU(U,G)>0}function pU(U,G){var C,L=U[G.offset++];L<192?C=31&L:217===L?C=UU(U,G):218===L?C=CU(U,G):219===L&&(C=XU(U,G));var X=r(U,G.offset,C);return G.offset+=C,X}function IU(U,G){var C=U[G.offset];return C<192&&C>160||217===C||218===C||219===C}function HU(U,G){var C=U[G.offset++];return C<128?C:202===C?DU(U,G):203===C?yU(U,G):204===C?UU(U,G):205===C?CU(U,G):206===C?XU(U,G):207===C?KU(U,G):208===C?J(U,G):209===C?GU(U,G):210===C?LU(U,G):211===C?EU(U,G):C>223?-1*(255-C+1):void 0}function xU(U,G){var C=U[G.offset];return C<128||C>=202&&C<=211}function hU(U,G){return U[G.offset]<160}function NU(U,G){return U[G.offset-1]===t&&(U[G.offset]<128||U[G.offset]>=202&&U[G.offset]<=211)}var bU=Object.freeze({__proto__:null,int8:J,uint8:UU,int16:GU,uint16:CU,int32:LU,uint32:XU,float32:lU,float64:tU,int64:EU,uint64:KU,readFloat32:DU,readFloat64:yU,boolean:VU,string:pU,stringCheck:IU,number:HU,numberCheck:xU,arrayCheck:hU,switchStructureCheck:NU}),oU=function(){function G(U){var G=this;this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return G.add(U)}))}return G.prototype.PK=function(G,C){return void 0===C&&(C=!0),P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,G,C?this.$items:void 0)},G.prototype.XC=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,G)},G.is=function(U){return void 0!==U.collection},G.prototype.add=function(U){var G=this.$refId++;return void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,G),this.$changes.indexes[G]=G,this.$indexes.set(G,G),this.$items.set(G,U),this.$changes.change(G),G},G.prototype.at=function(U){var G=Array.from(this.$items.keys())[U];return this.$items.get(G)},G.prototype.entries=function(){return this.$items.entries()},G.prototype.delete=function(U){for(var G,C,L=this.$items.entries();(C=L.next())&&!C.done;)if(U===C.value[1]){G=C.value[0];break}return void 0!==G&&(this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G))},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&O.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.has=function(U){return Array.from(this.$items.values()).some((function(G){return G===U}))},G.prototype.forEach=function(U){var G=this;this.$items.forEach((function(C,L,X){return U(C,L,G)}))},G.prototype.values=function(){return this.$items.values()},Object.defineProperty(G.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),G.prototype.setIndex=function(U,G){this.$indexes.set(U,G)},G.prototype.getIndex=function(U){return this.$indexes.get(U)},G.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},G.prototype.deleteByIndex=function(U){var G=this.$indexes.get(U);this.$items.delete(G),this.$indexes.delete(U)},G.prototype.toArray=function(){return Array.from(this.$items.values())},G.prototype.toJSON=function(){var U=[];return this.forEach((function(G,C){U.push("function"===typeof G.toJSON?G.toJSON():G)})),U},G.prototype.clone=function(U){var C;return U?C=Object.assign(new G,this):(C=new G,this.forEach((function(U){U.$changes?C.add(U.clone()):C.add(U)}))),C},G}(),wU=function(){function G(U){var G=this;this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return G.add(U)}))}return G.prototype.PK=function(G,C){return void 0===C&&(C=!0),P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,G,C?this.$items:void 0)},G.prototype.XC=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,G)},G.is=function(U){return void 0!==U.set},G.prototype.add=function(G){var C,L;if(this.has(G))return!1;var X=this.$refId++;void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,X);var l=null!==(L=null===(C=this.$changes.indexes[X])||void 0===C?void 0:C.op)&&void 0!==L?L:U.OPERATION.ADD;return this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,G),this.$changes.change(X,l),X},G.prototype.entries=function(){return this.$items.entries()},G.prototype.delete=function(U){for(var G,C,L=this.$items.entries();(C=L.next())&&!C.done;)if(U===C.value[1]){G=C.value[0];break}return void 0!==G&&(this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G))},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&O.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.has=function(U){for(var G,C=this.$items.values(),L=!1;(G=C.next())&&!G.done;)if(U===G.value){L=!0;break}return L},G.prototype.forEach=function(U){var G=this;this.$items.forEach((function(C,L,X){return U(C,L,G)}))},G.prototype.values=function(){return this.$items.values()},Object.defineProperty(G.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),G.prototype.setIndex=function(U,G){this.$indexes.set(U,G)},G.prototype.getIndex=function(U){return this.$indexes.get(U)},G.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},G.prototype.deleteByIndex=function(U){var G=this.$indexes.get(U);this.$items.delete(G),this.$indexes.delete(U)},G.prototype.toArray=function(){return Array.from(this.$items.values())},G.prototype.toJSON=function(){var U=[];return this.forEach((function(G,C){U.push("function"===typeof G.toJSON?G.toJSON():G)})),U},G.prototype.clone=function(U){var C;return U?C=Object.assign(new G,this):(C=new G,this.forEach((function(U){U.$changes?C.add(U.clone()):C.add(U)}))),C},G}(),SU=function(){function U(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return U.prototype.addRefId=function(U){this.refIds.has(U)||(this.refIds.add(U),this.containerIndexes.set(U,new Set))},U.get=function(G){return void 0===G.$filterState&&(G.$filterState=new U),G.$filterState},U}(),vU=function(){function U(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return U.prototype.getNextUniqueId=function(){return this.nextUniqueId++},U.prototype.addRef=function(U,G,C){void 0===C&&(C=!0),this.refs.set(U,G),C&&(this.refCounts[U]=(this.refCounts[U]||0)+1)},U.prototype.removeRef=function(U){this.refCounts[U]=this.refCounts[U]-1,this.deletedRefs.add(U)},U.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},U.prototype.garbageCollectDeletedRefs=function(){var U=this;this.deletedRefs.forEach((function(G){if(!(U.refCounts[G]>0)){var C=U.refs.get(G);if(C instanceof qU)for(var L in C._definition.schema)"string"!==typeof C._definition.schema[L]&&C[L]&&C[L].$changes&&U.removeRef(C[L].$changes.refId);else{var X=C.$changes.parent._definition,l=X.schema[X.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(l)[0]&&Array.from(C.values()).forEach((function(G){return U.removeRef(G.$changes.refId)}))}U.refs.delete(G),delete U.refCounts[G]}})),this.deletedRefs.clear()},U}(),uU=function(U){function G(){return null!==U&&U.apply(this,arguments)||this}return C(G,U),G}(Error);function dU(U,G,C,L){var X,l=!1;switch(G){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":X="number",isNaN(U)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(L));break;case"string":X="string",l=!0;break;case"boolean":return}if(typeof U!==X&&(!l||l&&null!==U)){var t="'".concat(JSON.stringify(U),"'").concat(U&&U.constructor&&" (".concat(U.constructor.name,")")||"");throw new uU("a '".concat(X,"' was expected, but ").concat(t," was provided in ").concat(C.constructor.name,"#").concat(L))}}function gU(U,G,C,L){if(!(U instanceof G))throw new uU("a '".concat(G.name,"' was expected, but '").concat(U.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(L))}function ZU(U,G,C,L,X){dU(C,U,L,X);var l=f[U];if(!l)throw new uU("a '".concat(U,"' was expected, but ").concat(C," was provided in ").concat(L.constructor.name,"#").concat(X));l(G,C)}function FU(U,G,C){return bU[U](G,C)}var qU=function(){function G(){for(var U=[],G=0;G<arguments.length;G++)U[G]=arguments[G];Object.defineProperties(this,{$changes:{value:new K(this,void 0,new vU),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),U[0]&&this.assign(U[0])}return G.onError=function(U){console.error(U)},G.is=function(U){return U._definition&&void 0!==U._definition.schema},G.prototype.onChange=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,G)},G.prototype.XC=function(G){return P(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,G)},G.prototype.assign=function(U){return Object.assign(this,U),this},Object.defineProperty(G.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),G.prototype.setDirty=function(U,G){this.$changes.change(U,G)},G.prototype.listen=function(U,G,C){var L=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[U]||(this.$callbacks[U]=[]),this.$callbacks[U].push(G),C&&void 0!==this[U]&&G(this[U],void 0),function(){return T(L.$callbacks[U],L.$callbacks[U].indexOf(G))}},G.prototype.decode=function(C,L,X){var l;void 0===L&&(L={offset:0}),void 0===X&&(X=this);var E=[],K=this.$changes.root,P=C.length,O=0;for(K.refs.set(O,this);L.offset<P;){var T=C[L.offset++];if(T!=t){var D=X.$changes,y=void 0!==X._definition,p=y?T>>6<<6:T;if(p!==U.OPERATION.CLEAR){var H=y?T%(p||255):HU(C,L),x=y?X._definition.fieldsByIndex[H]:"",N=D.getType(H),b=void 0,o=void 0,w=void 0;if(y?o=X["_".concat(x)]:(o=X.getByIndex(H),(p&U.OPERATION.ADD)===U.OPERATION.ADD?(w=X instanceof I?pU(C,L):H,X.setIndex(H,w)):w=X.getIndex(H)),(p&U.OPERATION.DELETE)===U.OPERATION.DELETE&&(p!==U.OPERATION.DELETE_AND_ADD&&X.deleteByIndex(H),o&&o.$changes&&K.removeRef(o.$changes.refId),b=null),void 0!==x){if(p===U.OPERATION.DELETE);else if(G.is(N)){var S=HU(C,L);if(b=K.refs.get(S),p!==U.OPERATION.REPLACE){var v=this.getSchemaType(C,L,N);b||((b=this.createTypeInstance(v)).$changes.refId=S,o&&(b.$callbacks=o.$callbacks,o.$changes.refId&&S!==o.$changes.refId&&K.removeRef(o.$changes.refId))),K.addRef(S,b,b!==o)}}else if("string"===typeof N)b=FU(N,C,L);else{var u=h(Object.keys(N)[0]),d=HU(C,L),g=K.refs.has(d)?o||K.refs.get(d):new u.constructor;if((b=g.clone(!0)).$changes.refId=d,o&&(b.$callbacks=o.$callbacks,o.$changes.refId&&d!==o.$changes.refId)){K.removeRef(o.$changes.refId);for(var Z=o.entries(),F=void 0;(F=Z.next())&&!F.done;){var q=(l=F.value)[0],a=l[1];E.push({refId:d,op:U.OPERATION.DELETE,field:q,value:void 0,previousValue:a})}}K.addRef(d,b,g!==o)}if(null!==b&&void 0!==b)if(b.$changes&&b.$changes.setParent(D.ref,D.root,H),X instanceof G)X[x]=b;else if(X instanceof I)q=w,X.$items.set(q,b),X.$changes.allChanges.add(H);else if(X instanceof V)X.setAt(H,b);else if(X instanceof oU){var k=X.add(b);X.setIndex(H,k)}else X instanceof wU&&!1!==(k=X.add(b))&&X.setIndex(H,k);o!==b&&E.push({refId:O,op:p,field:x,dynamicIndex:w,value:b,previousValue:o})}else{console.warn("@colyseus/schema: definition mismatch");for(var n={offset:L.offset};L.offset<P&&(!NU(C,L)||(n.offset=L.offset+1,!K.refs.has(HU(C,n))));)L.offset++}}else X.clear(E)}else{O=HU(C,L);var Q=K.refs.get(O);if(!Q)throw new Error('"refId" not found: '.concat(O));X=Q}}return this._triggerChanges(E),K.garbageCollectDeletedRefs(),E},G.prototype.encode=function(C,L,X){void 0===C&&(C=!1),void 0===L&&(L=[]),void 0===X&&(X=!1);for(var l=this.$changes,E=new WeakSet,K=[l],P=1,O=0;O<P;O++){var T=K[O],D=T.ref,y=D instanceof G;T.ensureRefId(),E.add(T),T!==l&&(T.changed||C)&&(a(L,t),W(L,T.refId));for(var V=C?Array.from(T.allChanges):Array.from(T.changes.values()),p=0,H=V.length;p<H;p++){var x=C?{op:U.OPERATION.ADD,index:V[p]}:V[p],N=x.index,b=y?D._definition.fieldsByIndex&&D._definition.fieldsByIndex[N]:N,o=L.length;if(x.op!==U.OPERATION.TOUCH)if(y)a(L,N|x.op);else{if(a(L,x.op),x.op===U.OPERATION.CLEAR)continue;W(L,N)}if(y||(x.op&U.OPERATION.ADD)!=U.OPERATION.ADD||D instanceof I&&R(L,T.ref.$indexes.get(N)),x.op!==U.OPERATION.DELETE){var w=T.getType(N),S=T.getValue(N);if(S&&S.$changes&&!E.has(S.$changes)&&(K.push(S.$changes),S.$changes.ensureRefId(),P++),x.op!==U.OPERATION.TOUCH){if(G.is(w))gU(S,w,D,b),W(L,S.$changes.refId),(x.op&U.OPERATION.ADD)===U.OPERATION.ADD&&this.tryEncodeTypeId(L,w,S.constructor);else if("string"===typeof w)ZU(w,L,S,D,b);else{var v=h(Object.keys(w)[0]);gU(D["_".concat(b)],v.constructor,D,b),W(L,S.$changes.refId)}X&&T.cache(N,L.slice(o))}}}C||X||T.discard()}return L},G.prototype.encodeAll=function(U){return this.encode(!0,[],U)},G.prototype.applyFilters=function(C,L){var X,l;void 0===L&&(L=!1);for(var E=this,K=new Set,P=SU.get(C),O=[this.$changes],T=1,D=[],y=function(y){var V=O[y];if(K.has(V.refId))return"continue";var p=V.ref,H=p instanceof G;a(D,t),W(D,V.refId);var x=P.refIds.has(V),h=L||!x;P.addRefId(V);var N=P.containerIndexes.get(V),b=h?Array.from(V.allChanges):Array.from(V.changes.values());!L&&H&&p._definition.indexesWithFilters&&p._definition.indexesWithFilters.forEach((function(G){!N.has(G)&&V.allChanges.has(G)&&(h?b.push(G):b.push({op:U.OPERATION.ADD,index:G}))}));for(var o=0,w=b.length;o<w;o++){var S=h?{op:U.OPERATION.ADD,index:b[o]}:b[o];if(S.op!==U.OPERATION.CLEAR){var v=S.index;if(S.op!==U.OPERATION.DELETE){var u=V.getValue(v),d=V.getType(v);if(H){if((g=p._definition.filters&&p._definition.filters[v])&&!g.call(p,C,u,E)){u&&u.$changes&&K.add(u.$changes.refId);continue}}else{var g,Z=V.parent;if((g=V.getChildrenFilter())&&!g.call(Z,C,p.$indexes.get(v),u,E)){u&&u.$changes&&K.add(u.$changes.refId);continue}}if(u.$changes&&(O.push(u.$changes),T++),S.op!==U.OPERATION.TOUCH)if(S.op===U.OPERATION.ADD||H)D.push.apply(D,null!==(X=V.caches[v])&&void 0!==X?X:[]),N.add(v);else if(N.has(v))D.push.apply(D,null!==(l=V.caches[v])&&void 0!==l?l:[]);else{if(N.add(v),a(D,U.OPERATION.ADD),W(D,v),p instanceof I){var F=V.ref.$indexes.get(v);R(D,F)}u.$changes?W(D,u.$changes.refId):f[d](D,u)}else u.$changes&&!H&&(a(D,U.OPERATION.ADD),W(D,v),p instanceof I&&(F=V.ref.$indexes.get(v),R(D,F)),W(D,u.$changes.refId))}else H?a(D,S.op|v):(a(D,S.op),W(D,v))}else a(D,S.op)}},V=0;V<T;V++)y(V);return D},G.prototype.clone=function(){var U,G=new this.constructor,C=this._definition.schema;for(var L in C)"object"===typeof this[L]&&"function"===typeof(null===(U=this[L])||void 0===U?void 0:U.clone)?G[L]=this[L].clone():G[L]=this[L];return G},G.prototype.toJSON=function(){var U=this._definition.schema,G=this._definition.deprecated,C={};for(var L in U)G[L]||null===this[L]||"undefined"===typeof this[L]||(C[L]="function"===typeof this[L].toJSON?this[L].toJSON():this["_".concat(L)]);return C},G.prototype.discardAllChanges=function(){this.$changes.discardAll()},G.prototype.getByIndex=function(U){return this[this._definition.fieldsByIndex[U]]},G.prototype.deleteByIndex=function(U){this[this._definition.fieldsByIndex[U]]=void 0},G.prototype.tryEncodeTypeId=function(U,G,C){G._typeid!==C._typeid&&(a(U,E),W(U,C._typeid))},G.prototype.getSchemaType=function(U,G,C){var L;return U[G.offset]===E&&(G.offset++,L=this.constructor._context.get(HU(U,G))),L||C},G.prototype.createTypeInstance=function(U){var G=new U;return G.$changes.root=this.$changes.root,G},G.prototype._triggerChanges=function(C){for(var L,X,l,t,E,K,P,O,T,D=new Set,y=this.$changes.root.refs,V=function(V){var p=C[V],I=p.refId,H=y.get(I),x=H.$callbacks;if((p.op&U.OPERATION.DELETE)===U.OPERATION.DELETE&&p.previousValue instanceof G&&(null===(X=null===(L=p.previousValue.$callbacks)||void 0===L?void 0:L[U.OPERATION.DELETE])||void 0===X||X.forEach((function(U){return U()}))),!x)return"continue";if(H instanceof G){if(!D.has(I))try{null===(l=null===x||void 0===x?void 0:x[U.OPERATION.REPLACE])||void 0===l||l.forEach((function(U){return U()}))}catch(h){G.onError(h)}try{x.hasOwnProperty(p.field)&&(null===(t=x[p.field])||void 0===t||t.forEach((function(U){return U(p.value,p.previousValue)})))}catch(h){G.onError(h)}}else p.op===U.OPERATION.ADD&&void 0===p.previousValue?null===(E=x[U.OPERATION.ADD])||void 0===E||E.forEach((function(U){var G;return U(p.value,null!==(G=p.dynamicIndex)&&void 0!==G?G:p.field)})):p.op===U.OPERATION.DELETE?void 0!==p.previousValue&&(null===(K=x[U.OPERATION.DELETE])||void 0===K||K.forEach((function(U){var G;return U(p.previousValue,null!==(G=p.dynamicIndex)&&void 0!==G?G:p.field)}))):p.op===U.OPERATION.DELETE_AND_ADD&&(void 0!==p.previousValue&&(null===(P=x[U.OPERATION.DELETE])||void 0===P||P.forEach((function(U){var G;return U(p.previousValue,null!==(G=p.dynamicIndex)&&void 0!==G?G:p.field)}))),null===(O=x[U.OPERATION.ADD])||void 0===O||O.forEach((function(U){var G;return U(p.value,null!==(G=p.dynamicIndex)&&void 0!==G?G:p.field)}))),p.value!==p.previousValue&&(null===(T=x[U.OPERATION.REPLACE])||void 0===T||T.forEach((function(U){var G;return U(p.value,null!==(G=p.dynamicIndex)&&void 0!==G?G:p.field)})));D.add(I)},p=0;p<C.length;p++)V(p)},G._definition=N.create(),G}();function aU(U){for(var G=[U.$changes],C=1,L={},X=L,l=function(U){var C=G[U];C.changes.forEach((function(U){var G=C.ref,L=U.index,l=G._definition?G._definition.fieldsByIndex[L]:G.$indexes.get(L);X[l]=C.getValue(L)}))},t=0;t<C;t++)l(t);return L}var kU={context:new o},nU=function(U){function G(){return null!==U&&U.apply(this,arguments)||this}return C(G,U),L([S("string",kU)],G.prototype,"name",void 0),L([S("string",kU)],G.prototype,"type",void 0),L([S("number",kU)],G.prototype,"referencedType",void 0),G}(qU),QU=function(U){function G(){var G=null!==U&&U.apply(this,arguments)||this;return G.fields=new V,G}return C(G,U),L([S("number",kU)],G.prototype,"id",void 0),L([S([nU],kU)],G.prototype,"fields",void 0),G}(qU),mG=function(U){function G(){var G=null!==U&&U.apply(this,arguments)||this;return G.types=new V,G}return C(G,U),G.encode=function(U){var C=U.constructor,L=new G;L.rootType=C._typeid;var X=function(U,G){for(var C in G){var X=new nU;X.name=C;var l=void 0;if("string"===typeof G[C])l=G[C];else{var t=G[C],E=void 0;qU.is(t)?(l="ref",E=G[C]):"string"===typeof t[l=Object.keys(t)[0]]?l+=":"+t[l]:E=t[l],X.referencedType=E?E._typeid:-1}X.type=l,U.fields.push(X)}L.types.push(U)},l=C._context.types;for(var t in l){var E=new QU;E.id=Number(t),X(E,l[t]._definition.schema)}return L.encodeAll()},G.decode=function(U,L){var X=new o,l=new G;l.decode(U,L);var t=l.types.reduce((function(U,G){var L=function(U){function G(){return null!==U&&U.apply(this,arguments)||this}return C(G,U),G}(qU),l=G.id;return U[l]=L,X.add(L,l),U}),{});l.types.forEach((function(U){var G=t[U.id];U.fields.forEach((function(U){var C;if(void 0!==U.referencedType){var L=U.type,l=t[U.referencedType];if(!l){var E=U.type.split(":");L=E[0],l=E[1]}"ref"===L?S(l,{context:X})(G.prototype,U.name):S(((C={})[L]=l,C),{context:X})(G.prototype,U.name)}else S(U.type,{context:X})(G.prototype,U.name)}))}));var E=t[l.rootType],K=new E;for(var P in E._definition.schema){var O=E._definition.schema[P];"string"!==typeof O&&(K[P]="function"===typeof O?new O:new(h(Object.keys(O)[0]).constructor))}return K},L([S([QU],kU)],G.prototype,"types",void 0),L([S("number",kU)],G.prototype,"rootType",void 0),G}(qU);x("map",{constructor:I}),x("array",{constructor:V}),x("set",{constructor:wU}),x("collection",{constructor:oU}),U.ArraySchema=V,U.CollectionSchema=oU,U.Context=o,U.MapSchema=I,U.Reflection=mG,U.ReflectionField=nU,U.ReflectionType=QU,U.Schema=qU,U.SchemaDefinition=N,U.SetSchema=wU,U.decode=bU,U.defineTypes=g,U.deprecated=d,U.dumpChanges=aU,U.encode=f,U.filter=v,U.filterChildren=u,U.hasFilter=b,U.registerType=x,U.type=S,Object.defineProperty(U,"__esModule",{value:!0})}(G)},14329:U=>{U.exports=function(U){return null!=U&&null!=U.constructor&&"function"===typeof U.constructor.isBuffer&&U.constructor.isBuffer(U)}},14320:(U,G,C)=>{"use strict";var L=C(14322),X=C(14325),l=C(14329);C.g.__TYPEDARRAY_POOL||(C.g.__TYPEDARRAY_POOL={UINT8:X([32,0]),UINT16:X([32,0]),UINT32:X([32,0]),INT8:X([32,0]),INT16:X([32,0]),INT32:X([32,0]),FLOAT:X([32,0]),DOUBLE:X([32,0]),DATA:X([32,0]),UINT8C:X([32,0]),BUFFER:X([32,0])});var t="undefined"!==typeof Uint8ClampedArray,E=C.g.__TYPEDARRAY_POOL;E.UINT8C||(E.UINT8C=X([32,0])),E.BUFFER||(E.BUFFER=X([32,0]));var K=E.DATA,P=E.BUFFER;function O(U){if(U){var G=U.length||U.byteLength,C=L.log2(G);K[C].push(U)}}function T(U){U=L.nextPow2(U);var G=L.log2(U),C=K[G];return C.length>0?C.pop():new ArrayBuffer(U)}function D(U){return new Uint8Array(T(U),0,U)}function y(U){return new Uint16Array(T(2*U),0,U)}function V(U){return new Uint32Array(T(4*U),0,U)}function p(U){return new Int8Array(T(U),0,U)}function I(U){return new Int16Array(T(2*U),0,U)}function H(U){return new Int32Array(T(4*U),0,U)}function x(U){return new Float32Array(T(4*U),0,U)}function h(U){return new Float64Array(T(8*U),0,U)}function N(U){return t?new Uint8ClampedArray(T(U),0,U):D(U)}function b(U){return new DataView(T(U),0,U)}G.free=function(U){if(l(U))P[L.log2(U.length)].push(U);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(U)&&(U=U.buffer),!U)return;var G=U.length||U.byteLength,C=0|L.log2(G);K[C].push(U)}},G.freeUint8=G.freeUint16=G.freeUint32=G.freeInt8=G.freeInt16=G.freeInt32=G.freeFloat32=G.freeFloat=G.freeFloat64=G.freeDouble=G.freeUint8Clamped=G.freeDataView=function(U){O(U.buffer)},G.freeArrayBuffer=O,G.freeBuffer=function(U){P[L.log2(U.length)].push(U)},G.malloc=function(U,G){if(void 0===G||"arraybuffer"===G)return T(U);switch(G){case"uint8":return D(U);case"uint16":return y(U);case"uint32":return V(U);case"int8":return p(U);case"int16":return I(U);case"int32":return H(U);case"float":case"float32":return x(U);case"double":case"float64":return h(U);case"uint8_clamped":return N(U);case"buffer":throw"Buffer not supported";case"data":case"dataview":return b(U);default:return null}return null},G.mallocArrayBuffer=T,G.mallocUint8=D,G.mallocUint16=y,G.mallocUint32=V,G.mallocInt8=p,G.mallocInt16=I,G.mallocInt32=H,G.mallocFloat32=G.mallocFloat=x,G.mallocFloat64=G.mallocDouble=h,G.mallocUint8Clamped=N,G.mallocDataView=b,G.clearCache=function(){for(var U=0;U<32;++U)E.UINT8[U].length=0,E.UINT16[U].length=0,E.UINT32[U].length=0,E.INT8[U].length=0,E.INT16[U].length=0,E.INT32[U].length=0,E.FLOAT[U].length=0,E.DOUBLE[U].length=0,E.UINT8C[U].length=0,K[U].length=0,P[U].length=0}},14400:(U,G,C)=>{U.exports=X;var L=C(135);function X(U,G){if(!(this instanceof X))return new X(U,G);var C=L.create();L.add(C,U,G),this.base=L.min(L.create(),U,C),this.SO=L.clone(G),this.max=L.max(L.create(),U,C),this.mag=L.length(this.SO)}var l=X.prototype;l.width=function(){return this.SO[0]},l.height=function(){return this.SO[1]},l.depth=function(){return this.SO[2]},l.x0=function(){return this.base[0]},l.y0=function(){return this.base[1]},l.z0=function(){return this.base[2]},l.x1=function(){return this.max[0]},l.y1=function(){return this.max[1]},l.z1=function(){return this.max[2]},l.translate=function(U){return L.add(this.max,this.max,U),L.add(this.base,this.base,U),this},l.setPosition=function(U){return L.add(this.max,U,this.SO),L.i(this.base,U),this},l.expand=function(U){var G=L.create(),C=L.create();return L.max(G,U.max,this.max),L.min(C,U.base,this.base),L.IG(G,G,C),new X(C,G)},l.intersects=function(U){return!(U.base[0]>this.max[0])&&(!(U.base[1]>this.max[1])&&(!(U.base[2]>this.max[2])&&(!(U.max[0]<this.base[0])&&(!(U.max[1]<this.base[1])&&!(U.max[2]<this.base[2])))))},l.touches=function(U){var G=this.union(U);return null!==G&&(0==G.width()||0==G.height()||0==G.depth())},l.union=function(U){if(!this.intersects(U))return null;var G=Math.max(U.base[0],this.base[0]),C=Math.max(U.base[1],this.base[1]),L=Math.max(U.base[2],this.base[2]);return new X([G,C,L],[Math.min(U.max[0],this.max[0])-G,Math.min(U.max[1],this.max[1])-C,Math.min(U.max[2],this.max[2])-L])}},14322:(U,G)=>{"use strict";function C(U){var G=32;return(U&=-U)&&G--,65535&U&&(G-=16),16711935&U&&(G-=8),252645135&U&&(G-=4),858993459&U&&(G-=2),1431655765&U&&(G-=1),G}G.INT_BITS=32,G.INT_MAX=2147483647,G.INT_MIN=-1<<31,G.sign=function(U){return(U>0)-(U<0)},G.abs=function(U){var G=U>>31;return(U^G)-G},G.min=function(U,G){return G^(U^G)&-(U<G)},G.max=function(U,G){return U^(U^G)&-(U<G)},G.isPow2=function(U){return!(U&U-1)&&!!U},G.log2=function(U){var G,C;return G=(U>65535)<<4,G|=C=((U>>>=G)>255)<<3,G|=C=((U>>>=C)>15)<<2,(G|=C=((U>>>=C)>3)<<1)|(U>>>=C)>>1},G.log10=function(U){return U>=1e9?9:U>=1e8?8:U>=1e7?7:U>=1e6?6:U>=1e5?5:U>=1e4?4:U>=1e3?3:U>=100?2:U>=10?1:0},G.popCount=function(U){return 16843009*((U=(858993459&(U-=U>>>1&1431655765))+(U>>>2&858993459))+(U>>>4)&252645135)>>>24},G.countTrailingZeros=C,G.nextPow2=function(U){return U+=0===U,--U,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)+1},G.prevPow2=function(U){return U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)-(U>>>1)},G.parity=function(U){return U^=U>>>16,U^=U>>>8,U^=U>>>4,27030>>>(U&=15)&1};var L=new Array(256);!function(U){for(var G=0;G<256;++G){var C=G,L=G,X=7;for(C>>>=1;C;C>>>=1)L<<=1,L|=1&C,--X;U[G]=L<<X&255}}(L),G.reverse=function(U){return L[255&U]<<24|L[U>>>8&255]<<16|L[U>>>16&255]<<8|L[U>>>24&255]},G.interleave2=function(U,G){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))|(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))<<1},G.deinterleave2=function(U,G){return(U=65535&((U=16711935&((U=252645135&((U=858993459&((U=U>>>G&1431655765)|U>>>1))|U>>>2))|U>>>4))|U>>>16))<<16>>16},G.interleave3=function(U,G,C){return U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2),(U|=(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},G.deinterleave3=function(U,G){return(U=1023&((U=4278190335&((U=251719695&((U=3272356035&((U=U>>>G&1227133513)|U>>>2))|U>>>4))|U>>>8))|U>>>16))<<22>>22},G.nextCombination=function(U){var G=U|U-1;return G+1|(~G&-~G)-1>>>C(U)+1}},14314:(U,G,C)=>{"use strict";U.exports=function(U,G,C){switch(arguments.length){case 1:return L=[],P(X=U,X,O,!0),L;case 2:return"function"===typeof G?P(U,U,G,!0):function(U,G){return L=[],P(U,G,O,!1),L}(U,G);case 3:return P(U,G,C,!1);default:throw new Error("box-intersect: Invalid arguments")}var X};var L,X=C(14320),l=C(14336),t=C(14343);function E(U,G){for(var C=0;C<U;++C)if(!(G[C]<=G[C+U]))return!0;return!1}function K(U,G,C,L){for(var X=0,l=0,t=0,K=U.length;t<K;++t){var P=U[t];if(!E(G,P)){for(var O=0;O<2*G;++O)C[X++]=P[O];L[l++]=t}}return l}function P(U,G,C,L){var E=U.length,P=G.length;if(!(E<=0||P<=0)){var O=U[0].length>>>1;if(!(O<=0)){var T,D=X.mallocDouble(2*O*E),y=X.mallocInt32(E);if((E=K(U,O,D,y))>0){if(1===O&&L)l.init(E),T=l.sweepComplete(O,C,0,E,D,y,0,E,D,y);else{var V=X.mallocDouble(2*O*P),p=X.mallocInt32(P);(P=K(G,O,V,p))>0&&(l.init(E+P),T=1===O?l.sweepBipartite(O,C,0,E,D,y,0,P,V,p):t(O,C,L,E,D,y,P,V,p),X.free(V),X.free(p))}X.free(D),X.free(y)}return T}}}function O(U,G){L.push([U,G])}},14345:(U,G)=>{"use strict";var C="d",L="ax",X="fp",l="es",t="rs",E="re",K="rb",P="bs",O="be",T="bb",D=[C,L,"vv",t,E,K,"ri",P,O,T,"bi"];function y(U){var G="bruteForce"+(U?"Full":"Partial"),L=[],t=D.slice();U||t.splice(3,0,X);var E=["function "+G+"("+t.join()+"){"];function K(G,X){var t=function(U,G,L){var X="bruteForce"+(U?"Red":"Blue")+(G?"Flip":"")+(L?"Full":""),t=["function ",X,"(",D.join(),"){","var ",l,"=2*",C,";"],E="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",K="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(L?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return U?t.push(E,"Q",":",K):t.push(K,"Q",":",E),L?t.push("if(y1<x0||x1<y0)continue;"):G?t.push("if(y0<=x0||x1<y0)continue;"):t.push("if(y0<x0||x1<y0)continue;"),t.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),G?t.push("yi,xi"):t.push("xi,yi"),t.push(");if(rv!==void 0)return rv;}}}"),{name:X,code:t.join("")}}(G,X,U);L.push(t.code),E.push("return "+t.name+"("+D.join()+");")}E.push("if(re-rs>be-bs){"),U?(K(!0,!1),E.push("}else{"),K(!1,!1)):(E.push("if(fp){"),K(!0,!0),E.push("}else{"),K(!0,!1),E.push("}}else{if(fp){"),K(!1,!0),E.push("}else{"),K(!1,!1),E.push("}")),E.push("}}return "+G);var P=L.join("")+E.join("");return new Function(P)()}G.partial=y(!1),G.full=y(!0)},14343:(U,G,C)=>{"use strict";U.exports=function(U,G,C,l,O,d,g,Z,F){!function(U,G){var C=8*X.log2(G+1)*(U+1)|0,l=X.nextPow2(N*C);o.length<l&&(L.free(o),o=L.mallocInt32(l));var t=X.nextPow2(b*C);w.length<t&&(L.free(w),w=L.mallocDouble(t))}(U,l+g);var q,a=0,k=2*U;S(a++,0,0,l,0,g,C?16:0,-1/0,1/0),C||S(a++,0,0,g,0,l,1,-1/0,1/0);for(;a>0;){var n=(a-=1)*N,Q=o[n],mU=o[n+1],B=o[n+2],M=o[n+3],z=o[n+4],s=o[n+5],j=a*b,A=w[j],Y=w[j+1],e=1&s,i=!!(16&s),c=O,R=d,W=Z,f=F;if(e&&(c=Z,R=F,W=O,f=d),!(2&s&&mU>=(B=I(U,Q,mU,B,c,R,Y)))&&!(4&s&&(mU=H(U,Q,mU,B,c,R,A))>=B)){var r=B-mU,J=z-M;if(i){if(U*r*(r+J)<y){if(void 0!==(q=K.scanComplete(U,Q,G,mU,B,c,R,M,z,W,f)))return q;continue}}else{if(U*Math.min(r,J)<T){if(void 0!==(q=t(U,Q,G,e,mU,B,c,R,M,z,W,f)))return q;continue}if(U*r*J<D){if(void 0!==(q=K.scanBipartite(U,Q,G,e,mU,B,c,R,M,z,W,f)))return q;continue}}var UU=V(U,Q,mU,B,c,R,A,Y);if(mU<UU)if(U*(UU-mU)<T){if(void 0!==(q=E(U,Q+1,G,mU,UU,c,R,M,z,W,f)))return q}else if(Q===U-2){if(void 0!==(q=e?K.sweepBipartite(U,G,M,z,W,f,mU,UU,c,R):K.sweepBipartite(U,G,mU,UU,c,R,M,z,W,f)))return q}else S(a++,Q+1,mU,UU,M,z,e,-1/0,1/0),S(a++,Q+1,M,z,mU,UU,1^e,-1/0,1/0);if(UU<B){var GU=P(U,Q,M,z,W,f),CU=W[k*GU+Q],LU=p(U,Q,GU,z,W,f,CU);if(LU<z&&S(a++,Q,UU,B,LU,z,(4|e)+(i?16:0),CU,Y),M<GU&&S(a++,Q,UU,B,M,GU,(2|e)+(i?16:0),A,CU),GU+1===LU){if(void 0!==(q=i?u(U,Q,G,UU,B,c,R,GU,W,f[GU]):v(U,Q,G,e,UU,B,c,R,GU,W,f[GU])))return q}else if(GU<LU){var XU;if(i){if(UU<(XU=x(U,Q,UU,B,c,R,CU))){var lU=p(U,Q,UU,XU,c,R,CU);if(Q===U-2){if(UU<lU&&void 0!==(q=K.sweepComplete(U,G,UU,lU,c,R,GU,LU,W,f)))return q;if(lU<XU&&void 0!==(q=K.sweepBipartite(U,G,lU,XU,c,R,GU,LU,W,f)))return q}else UU<lU&&S(a++,Q+1,UU,lU,GU,LU,16,-1/0,1/0),lU<XU&&(S(a++,Q+1,lU,XU,GU,LU,0,-1/0,1/0),S(a++,Q+1,GU,LU,lU,XU,1,-1/0,1/0))}}else UU<(XU=e?h(U,Q,UU,B,c,R,CU):x(U,Q,UU,B,c,R,CU))&&(Q===U-2?q=e?K.sweepBipartite(U,G,GU,LU,W,f,UU,XU,c,R):K.sweepBipartite(U,G,UU,XU,c,R,GU,LU,W,f):(S(a++,Q+1,UU,XU,GU,LU,e,-1/0,1/0),S(a++,Q+1,GU,LU,UU,XU,1^e,-1/0,1/0)))}}}}};var L=C(14320),X=C(14322),l=C(14345),t=l.partial,E=l.full,K=C(14336),P=C(14351),O=C(14360),T=128,D=1<<22,y=1<<22,V=O("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),p=O("lo===p0",["p0"]),I=O("lo<p0",["p0"]),H=O("hi<=p0",["p0"]),x=O("lo<=p0&&p0<=hi",["p0"]),h=O("lo<p0&&p0<=hi",["p0"]),N=6,b=2,o=L.mallocInt32(1024),w=L.mallocDouble(1024);function S(U,G,C,L,X,l,t,E,K){var P=N*U;o[P]=G,o[P+1]=C,o[P+2]=L,o[P+3]=X,o[P+4]=l,o[P+5]=t;var O=b*U;w[O]=E,w[O+1]=K}function v(U,G,C,L,X,l,t,E,K,P,O){var T=2*U,D=K*T,y=P[D+G];U:for(var V=X,p=X*T;V<l;++V,p+=T){var I=t[p+G],H=t[p+G+U];if(!(y<I||H<y)&&(!L||y!==I)){for(var x,h=E[V],N=G+1;N<U;++N){I=t[p+N],H=t[p+N+U];var b=P[D+N],o=P[D+N+U];if(H<b||o<I)continue U}if(void 0!==(x=L?C(O,h):C(h,O)))return x}}}function u(U,G,C,L,X,l,t,E,K,P){var O=2*U,T=E*O,D=K[T+G];U:for(var y=L,V=L*O;y<X;++y,V+=O){var p=t[y];if(p!==P){var I=l[V+G],H=l[V+G+U];if(!(D<I||H<D)){for(var x=G+1;x<U;++x){I=l[V+x],H=l[V+x+U];var h=K[T+x],N=K[T+x+U];if(H<h||N<I)continue U}var b=C(p,P);if(void 0!==b)return b}}}}},14351:(U,G,C)=>{"use strict";U.exports=function(U,G,C,t,E,K){if(t<=C+1)return C;var P=C,O=t,T=t+C>>>1,D=2*U,y=T,V=E[D*T+G];for(;P<O;){if(O-P<X){l(U,G,P,O,E,K),V=E[D*T+G];break}var p=O-P,I=Math.random()*p+P|0,H=E[D*I+G],x=Math.random()*p+P|0,h=E[D*x+G],N=Math.random()*p+P|0,b=E[D*N+G];H<=h?b>=h?(y=x,V=h):H>=b?(y=I,V=H):(y=N,V=b):h>=b?(y=x,V=h):b>=H?(y=I,V=H):(y=N,V=b);for(var o=D*(O-1),w=D*y,S=0;S<D;++S,++o,++w){var v=E[o];E[o]=E[w],E[w]=v}var u=K[O-1];K[O-1]=K[y],K[y]=u;for(o=D*(O-1),w=D*(y=L(U,G,P,O-1,E,K,V)),S=0;S<D;++S,++o,++w){v=E[o];E[o]=E[w],E[w]=v}u=K[O-1];if(K[O-1]=K[y],K[y]=u,T<y){for(O=y-1;P<O&&E[D*(O-1)+G]===V;)O-=1;O+=1}else{if(!(y<T))break;for(P=y+1;P<O&&E[D*P+G]===V;)P+=1}}return L(U,G,C,T,E,K,E[D*T+G])};var L=C(14360)("lo<p0",["p0"]),X=8;function l(U,G,C,L,X,l){for(var t=2*U,E=t*(C+1)+G,K=C+1;K<L;++K,E+=t)for(var P=X[E],O=K,T=t*(K-1);O>C&&X[T+G]>P;--O,T-=t){for(var D=T,y=T+t,V=0;V<t;++V,++D,++y){var p=X[D];X[D]=X[y],X[y]=p}var I=l[O];l[O]=l[O-1],l[O-1]=I}}},14360:U=>{"use strict";U.exports=function(U,C){var L="abcdef".split("").concat(C),X=[];U.indexOf("lo")>=0&&X.push("lo=e[k+n]");U.indexOf("hi")>=0&&X.push("hi=e[k+o]");return L.push(G.replace("_",X.join()).replace("$",U)),Function.apply(void 0,L)};var G="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14338:U=>{"use strict";U.exports=function(U,L){L<=4*G?C(0,L-1,U):P(0,L-1,U)};var G=32;function C(U,G,C){for(var L=2*(U+1),X=U+1;X<=G;++X){for(var l=C[L++],t=C[L++],E=X,K=L-2;E-- >U;){var P=C[K-2],O=C[K-1];if(P<l)break;if(P===l&&O<t)break;C[K]=P,C[K+1]=O,K-=2}C[K]=l,C[K+1]=t}}function L(U,G,C){G*=2;var L=C[U*=2],X=C[U+1];C[U]=C[G],C[U+1]=C[G+1],C[G]=L,C[G+1]=X}function X(U,G,C){G*=2,C[U*=2]=C[G],C[U+1]=C[G+1]}function l(U,G,C,L){G*=2,C*=2;var X=L[U*=2],l=L[U+1];L[U]=L[G],L[U+1]=L[G+1],L[G]=L[C],L[G+1]=L[C+1],L[C]=X,L[C+1]=l}function t(U,G,C,L,X){G*=2,X[U*=2]=X[G],X[G]=C,X[U+1]=X[G+1],X[G+1]=L}function E(U,G,C){G*=2;var L=C[U*=2],X=C[G];return!(L<X)&&(L!==X||C[U+1]>C[G+1])}function K(U,G,C,L){var X=L[U*=2];return X<G||X===G&&L[U+1]<C}function P(U,O,T){var D=(O-U+1)/6|0,y=U+D,V=O-D,p=U+O>>1,I=p-D,H=p+D,x=y,h=I,N=p,b=H,o=V,w=U+1,S=O-1,v=0;E(x,h,T)&&(v=x,x=h,h=v),E(b,o,T)&&(v=b,b=o,o=v),E(x,N,T)&&(v=x,x=N,N=v),E(h,N,T)&&(v=h,h=N,N=v),E(x,b,T)&&(v=x,x=b,b=v),E(N,b,T)&&(v=N,N=b,b=v),E(h,o,T)&&(v=h,h=o,o=v),E(h,N,T)&&(v=h,h=N,N=v),E(b,o,T)&&(v=b,b=o,o=v);for(var u=T[2*h],d=T[2*h+1],g=T[2*b],Z=T[2*b+1],F=2*x,q=2*N,a=2*o,k=2*y,n=2*p,Q=2*V,mU=0;mU<2;++mU){var B=T[F+mU],M=T[q+mU],z=T[a+mU];T[k+mU]=B,T[n+mU]=M,T[Q+mU]=z}X(I,U,T),X(H,O,T);for(var s=w;s<=S;++s)if(K(s,u,d,T))s!==w&&L(s,w,T),++w;else if(!K(s,g,Z,T))for(;;){if(K(S,g,Z,T)){K(S,u,d,T)?(l(s,w,S,T),++w,--S):(L(s,S,T),--S);break}if(--S<s)break}t(U,w-1,u,d,T),t(O,S+1,g,Z,T),w-2-U<=G?C(U,w-2,T):P(U,w-2,T),O-(S+2)<=G?C(S+2,O,T):P(S+2,O,T),S-w<=G?C(w,S,T):P(w,S,T)}},14336:(U,G,C)=>{"use strict";U.exports={init:function(U){var G=X.nextPow2(U);K.length<G&&(L.free(K),K=L.mallocInt32(G));P.length<G&&(L.free(P),P=L.mallocInt32(G));O.length<G&&(L.free(O),O=L.mallocInt32(G));T.length<G&&(L.free(T),T=L.mallocInt32(G));D.length<G&&(L.free(D),D=L.mallocInt32(G));y.length<G&&(L.free(y),y=L.mallocInt32(G));var C=8*G;V.length<C&&(L.free(V),V=L.mallocDouble(C))},sweepBipartite:function(U,G,C,L,X,E,D,y,H,x){for(var h=0,N=2*U,b=U-1,o=N-1,w=C;w<L;++w){var S=E[w],v=N*w;V[h++]=X[v+b],V[h++]=-(S+1),V[h++]=X[v+o],V[h++]=S}for(w=D;w<y;++w){S=x[w]+t;var u=N*w;V[h++]=H[u+b],V[h++]=-S,V[h++]=H[u+o],V[h++]=S}var d=h>>>1;l(V,d);var g=0,Z=0;for(w=0;w<d;++w){var F=0|V[2*w+1];if(F>=t)p(O,T,Z--,F=F-t|0);else if(F>=0)p(K,P,g--,F);else if(F<=-t){F=-F-t|0;for(var q=0;q<g;++q){if(void 0!==(a=G(K[q],F)))return a}I(O,T,Z++,F)}else{F=-F-1|0;for(q=0;q<Z;++q){var a;if(void 0!==(a=G(F,O[q])))return a}I(K,P,g++,F)}}},sweepComplete:function(U,G,C,L,X,t,E,H,x,h){for(var N=0,b=2*U,o=U-1,w=b-1,S=C;S<L;++S){var v=t[S]+1<<1,u=b*S;V[N++]=X[u+o],V[N++]=-v,V[N++]=X[u+w],V[N++]=v}for(S=E;S<H;++S){v=h[S]+1<<1;var d=b*S;V[N++]=x[d+o],V[N++]=1|-v,V[N++]=x[d+w],V[N++]=1|v}var g=N>>>1;l(V,g);var Z=0,F=0,q=0;for(S=0;S<g;++S){var a=0|V[2*S+1],k=1&a;if(S<g-1&&a>>1===V[2*S+3]>>1&&(k=2,S+=1),a<0){for(var n=-(a>>1)-1,Q=0;Q<q;++Q){if(void 0!==(mU=G(D[Q],n)))return mU}if(0!==k)for(Q=0;Q<Z;++Q){if(void 0!==(mU=G(K[Q],n)))return mU}if(1!==k)for(Q=0;Q<F;++Q){var mU;if(void 0!==(mU=G(O[Q],n)))return mU}0===k?I(K,P,Z++,n):1===k?I(O,T,F++,n):2===k&&I(D,y,q++,n)}else{n=(a>>1)-1;0===k?p(K,P,Z--,n):1===k?p(O,T,F--,n):2===k&&p(D,y,q--,n)}}},scanBipartite:function(U,G,C,L,X,E,O,T,D,y,H,x){var h=0,N=2*U,b=G,o=G+U,w=1,S=1;L?S=t:w=t;for(var v=X;v<E;++v){var u=v+w,d=N*v;V[h++]=O[d+b],V[h++]=-u,V[h++]=O[d+o],V[h++]=u}for(v=D;v<y;++v){u=v+S;var g=N*v;V[h++]=H[g+b],V[h++]=-u}var Z=h>>>1;l(V,Z);var F=0;for(v=0;v<Z;++v){var q=0|V[2*v+1];if(q<0){var a=!1;if((u=-q)>=t?(a=!L,u-=t):(a=!!L,u-=1),a)I(K,P,F++,u);else{var k=x[u],n=N*u,Q=H[n+G+1],mU=H[n+G+1+U];U:for(var B=0;B<F;++B){var M=K[B],z=N*M;if(!(mU<O[z+G+1]||O[z+G+1+U]<Q)){for(var s=G+2;s<U;++s)if(H[n+s+U]<O[z+s]||O[z+s+U]<H[n+s])continue U;var j,A=T[M];if(void 0!==(j=L?C(k,A):C(A,k)))return j}}}}else p(K,P,F--,q-w)}},scanComplete:function(U,G,C,L,X,E,P,O,T,D,y){for(var p=0,I=2*U,H=G,x=G+U,h=L;h<X;++h){var N=h+t,b=I*h;V[p++]=E[b+H],V[p++]=-N,V[p++]=E[b+x],V[p++]=N}for(h=O;h<T;++h){N=h+1;var o=I*h;V[p++]=D[o+H],V[p++]=-N}var w=p>>>1;l(V,w);var S=0;for(h=0;h<w;++h){var v=0|V[2*h+1];if(v<0){if((N=-v)>=t)K[S++]=N-t;else{var u=y[N-=1],d=I*N,g=D[d+G+1],Z=D[d+G+1+U];U:for(var F=0;F<S;++F){var q=K[F],a=P[q];if(a===u)break;var k=I*q;if(!(Z<E[k+G+1]||E[k+G+1+U]<g)){for(var n=G+2;n<U;++n)if(D[d+n+U]<E[k+n]||E[k+n+U]<D[d+n])continue U;var Q=C(a,u);if(void 0!==Q)return Q}}}}else{for(N=v-t,F=S-1;F>=0;--F)if(K[F]===N){for(n=F+1;n<S;++n)K[n-1]=K[n];break}--S}}}};var L=C(14320),X=C(14322),l=C(14338),t=1<<28,E=1024,K=L.mallocInt32(E),P=L.mallocInt32(E),O=L.mallocInt32(E),T=L.mallocInt32(E),D=L.mallocInt32(E),y=L.mallocInt32(E),V=L.mallocDouble(8192);function p(U,G,C,L){var X=G[L],l=U[C-1];U[X]=l,G[l]=X}function I(U,G,C,L){U[C]=L,G[L]=C}},14584:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14579:(U,G,C)=>{var L=C(14584),X=C(14586),l=Object.hasOwnProperty,t=Object.create(null);for(var E in L)l.call(L,E)&&(t[L[E]]=E);var K=U.exports={to:{},get:{}};function P(U,G,C){return Math.min(Math.max(G,U),C)}function O(U){var G=Math.round(U).toString(16).toUpperCase();return G.length<2?"0"+G:G}K.get=function(U){var G,C;switch(U.substring(0,3).toLowerCase()){case"hsl":G=K.get.hsl(U),C="hsl";break;case"hwb":G=K.get.hwb(U),C="hwb";break;default:G=K.get.rgb(U),C="rgb"}return G?{model:C,value:G}:null},K.get.rgb=function(U){if(!U)return null;var G,C,X,t=[0,0,0,1];if(G=U.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(X=G[2],G=G[1],C=0;C<3;C++){var E=2*C;t[C]=parseInt(G.slice(E,E+2),16)}X&&(t[3]=parseInt(X,16)/255)}else if(G=U.match(/^#([a-f0-9]{3,4})$/i)){for(X=(G=G[1])[3],C=0;C<3;C++)t[C]=parseInt(G[C]+G[C],16);X&&(t[3]=parseInt(X+X,16)/255)}else if(G=U.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)t[C]=parseInt(G[C+1],0);G[4]&&(G[5]?t[3]=.01*parseFloat(G[4]):t[3]=parseFloat(G[4]))}else{if(!(G=U.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(G=U.match(/^(\w+)$/))?"transparent"===G[1]?[0,0,0,0]:l.call(L,G[1])?((t=L[G[1]])[3]=1,t):null:null;for(C=0;C<3;C++)t[C]=Math.round(2.55*parseFloat(G[C+1]));G[4]&&(G[5]?t[3]=.01*parseFloat(G[4]):t[3]=parseFloat(G[4]))}for(C=0;C<3;C++)t[C]=P(t[C],0,255);return t[3]=P(t[3],0,1),t},K.get.hsl=function(U){if(!U)return null;var G=U.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(G){var C=parseFloat(G[4]);return[(parseFloat(G[1])%360+360)%360,P(parseFloat(G[2]),0,100),P(parseFloat(G[3]),0,100),P(isNaN(C)?1:C,0,1)]}return null},K.get.hwb=function(U){if(!U)return null;var G=U.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(G){var C=parseFloat(G[4]);return[(parseFloat(G[1])%360+360)%360,P(parseFloat(G[2]),0,100),P(parseFloat(G[3]),0,100),P(isNaN(C)?1:C,0,1)]}return null},K.to.hex=function(){var U=X(arguments);return"#"+O(U[0])+O(U[1])+O(U[2])+(U[3]<1?O(Math.round(255*U[3])):"")},K.to.rgb=function(){var U=X(arguments);return U.length<4||1===U[3]?"rgb("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+")":"rgba("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+", "+U[3]+")"},K.to.rgb.percent=function(){var U=X(arguments),G=Math.round(U[0]/255*100),C=Math.round(U[1]/255*100),L=Math.round(U[2]/255*100);return U.length<4||1===U[3]?"rgb("+G+"%, "+C+"%, "+L+"%)":"rgba("+G+"%, "+C+"%, "+L+"%, "+U[3]+")"},K.to.hsl=function(){var U=X(arguments);return U.length<4||1===U[3]?"hsl("+U[0]+", "+U[1]+"%, "+U[2]+"%)":"hsla("+U[0]+", "+U[1]+"%, "+U[2]+"%, "+U[3]+")"},K.to.hwb=function(){var U=X(arguments),G="";return U.length>=4&&1!==U[3]&&(G=", "+U[3]),"hwb("+U[0]+", "+U[1]+"%, "+U[2]+"%"+G+")"},K.to.keyword=function(U){return t[U.slice(0,3)]}},14572:(U,G,C)=>{const L=C(14579),X=C(14596),l=["keyword","gray","hex"],t={};for(const y of Object.keys(X))t[[...X[y].labels].sort().join("")]=y;const E={};function K(U,G){if(!(this instanceof K))return new K(U,G);if(G&&G in l&&(G=null),G&&!(G in X))throw new Error("Unknown model: "+G);let C,P;if(null==U)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(U instanceof K)this.model=U.model,this.color=[...U.color],this.valpha=U.valpha;else if("string"===typeof U){const G=L.get(U);if(null===G)throw new Error("Unable to parse color from string: "+U);this.model=G.model,P=X[this.model].channels,this.color=G.value.slice(0,P),this.valpha="number"===typeof G.value[P]?G.value[P]:1}else if(U.length>0){this.model=G||"rgb",P=X[this.model].channels;const C=Array.prototype.slice.call(U,0,P);this.color=D(C,P),this.valpha="number"===typeof U[P]?U[P]:1}else if("number"===typeof U)this.model="rgb",this.color=[U>>16&255,U>>8&255,255&U],this.valpha=1;else{this.valpha=1;const G=Object.keys(U);"alpha"in U&&(G.splice(G.indexOf("alpha"),1),this.valpha="number"===typeof U.alpha?U.alpha:0);const L=G.sort().join("");if(!(L in t))throw new Error("Unable to parse color from object: "+JSON.stringify(U));this.model=t[L];const{labels:l}=X[this.model],E=[];for(C=0;C<l.length;C++)E.push(U[l[C]]);this.color=D(E)}if(E[this.model])for(P=X[this.model].channels,C=0;C<P;C++){const U=E[this.model][C];U&&(this.color[C]=U(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}K.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(U){let G=this.model in L.to?this:this.rgb();G=G.round("number"===typeof U?U:1);const C=1===G.valpha?G.color:[...G.color,this.valpha];return L.to[G.model](C)},percentString(U){const G=this.rgb().round("number"===typeof U?U:1),C=1===G.valpha?G.color:[...G.color,this.valpha];return L.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const U={},{channels:G}=X[this.model],{labels:C}=X[this.model];for(let L=0;L<G;L++)U[C[L]]=this.color[L];return 1!==this.valpha&&(U.alpha=this.valpha),U},unitArray(){const U=this.rgb().color;return U[0]/=255,U[1]/=255,U[2]/=255,1!==this.valpha&&U.push(this.valpha),U},unitObject(){const U=this.rgb().object();return U.r/=255,U.g/=255,U.b/=255,1!==this.valpha&&(U.alpha=this.valpha),U},round(U){return U=Math.max(U||0,0),new K([...this.color.map(P(U)),this.valpha],this.model)},alpha(U){return void 0!==U?new K([...this.color,Math.max(0,Math.min(1,U))],this.model):this.valpha},red:O("rgb",0,T(255)),green:O("rgb",1,T(255)),blue:O("rgb",2,T(255)),hue:O(["hsl","hsv","hsl","hwb","hcg"],0,(U=>(U%360+360)%360)),saturationl:O("hsl",1,T(100)),lightness:O("hsl",2,T(100)),saturationv:O("hsv",1,T(100)),value:O("hsv",2,T(100)),chroma:O("hcg",1,T(100)),gray:O("hcg",2,T(100)),white:O("hwb",1,T(100)),wblack:O("hwb",2,T(100)),cyan:O("cmyk",0,T(100)),magenta:O("cmyk",1,T(100)),yellow:O("cmyk",2,T(100)),black:O("cmyk",3,T(100)),x:O("xyz",0,T(95.047)),y:O("xyz",1,T(100)),z:O("xyz",2,T(108.833)),l:O("lab",0,T(100)),a:O("lab",1),b:O("lab",2),keyword(U){return void 0!==U?new K(U):X[this.model].keyword(this.color)},hex(U){return void 0!==U?new K(U):L.to.hex(this.rgb().round().color)},hexa(U){if(void 0!==U)return new K(U);const G=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),L.to.hex(G)+C},rgbNumber(){const U=this.rgb().color;return(255&U[0])<<16|(255&U[1])<<8|255&U[2]},luminosity(){const U=this.rgb().color,G=[];for(const[C,L]of U.entries()){const U=L/255;G[C]=U<=.04045?U/12.92:((U+.055)/1.055)**2.4}return.2126*G[0]+.7152*G[1]+.0722*G[2]},contrast(U){const G=this.luminosity(),C=U.luminosity();return G>C?(G+.05)/(C+.05):(C+.05)/(G+.05)},level(U){const G=this.contrast(U);return G>=7?"AAA":G>=4.5?"AA":""},isDark(){const U=this.rgb().color;return(2126*U[0]+7152*U[1]+722*U[2])/1e4<128},isLight(){return!this.isDark()},negate(){const U=this.rgb();for(let G=0;G<3;G++)U.color[G]=255-U.color[G];return U},lighten(U){const G=this.hsl();return G.color[2]+=G.color[2]*U,G},darken(U){const G=this.hsl();return G.color[2]-=G.color[2]*U,G},saturate(U){const G=this.hsl();return G.color[1]+=G.color[1]*U,G},desaturate(U){const G=this.hsl();return G.color[1]-=G.color[1]*U,G},whiten(U){const G=this.hwb();return G.color[1]+=G.color[1]*U,G},blacken(U){const G=this.hwb();return G.color[2]+=G.color[2]*U,G},grayscale(){const U=this.rgb().color,G=.3*U[0]+.59*U[1]+.11*U[2];return K.rgb(G,G,G)},fade(U){return this.alpha(this.valpha-this.valpha*U)},opaquer(U){return this.alpha(this.valpha+this.valpha*U)},rotate(U){const G=this.hsl();let C=G.color[0];return C=(C+U)%360,C=C<0?360+C:C,G.color[0]=C,G},mix(U,G){if(!U||!U.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof U);const C=U.rgb(),L=this.rgb(),X=void 0===G?.5:G,l=2*X-1,t=C.alpha()-L.alpha(),E=((l*t===-1?l:(l+t)/(1+l*t))+1)/2,P=1-E;return K.rgb(E*C.red()+P*L.red(),E*C.green()+P*L.green(),E*C.blue()+P*L.blue(),C.alpha()*X+L.alpha()*(1-X))}};for(const y of Object.keys(X)){if(l.includes(y))continue;const{channels:U}=X[y];K.prototype[y]=function(){if(this.model===y)return new K(this);for(var U=arguments.length,G=new Array(U),C=0;C<U;C++)G[C]=arguments[C];return G.length>0?new K(G,y):new K([...(L=X[this.model][y].raw(this.color),Array.isArray(L)?L:[L]),this.valpha],y);var L},K[y]=function(){for(var G=arguments.length,C=new Array(G),L=0;L<G;L++)C[L]=arguments[L];let X=C[0];return"number"===typeof X&&(X=D(C,U)),new K(X,y)}}function P(U){return function(G){return function(U,G){return Number(U.toFixed(G))}(G,U)}}function O(U,G,C){U=Array.isArray(U)?U:[U];for(const L of U)(E[L]||(E[L]=[]))[G]=C;return U=U[0],function(L){let X;return void 0!==L?(C&&(L=C(L)),X=this[U](),X.color[G]=L,X):(X=this[U]().color[G],C&&(X=C(X)),X)}}function T(U){return function(G){return Math.max(0,Math.min(U,G))}}function D(U,G){for(let C=0;C<G;C++)"number"!==typeof U[C]&&(U[C]=0);return U}U.exports=K},14604:(U,G,C)=>{const L=C(14609),X={};for(const t of Object.keys(L))X[L[t]]=t;const l={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};U.exports=l;for(const t of Object.keys(l)){if(!("channels"in l[t]))throw new Error("missing channels property: "+t);if(!("labels"in l[t]))throw new Error("missing channel labels property: "+t);if(l[t].labels.length!==l[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:U,labels:G}=l[t];delete l[t].channels,delete l[t].labels,Object.defineProperty(l[t],"channels",{value:U}),Object.defineProperty(l[t],"labels",{value:G})}l.rgb.hsl=function(U){const G=U[0]/255,C=U[1]/255,L=U[2]/255,X=Math.min(G,C,L),l=Math.max(G,C,L),t=l-X;let E,K;l===X?E=0:G===l?E=(C-L)/t:C===l?E=2+(L-G)/t:L===l&&(E=4+(G-C)/t),E=Math.min(60*E,360),E<0&&(E+=360);const P=(X+l)/2;return K=l===X?0:P<=.5?t/(l+X):t/(2-l-X),[E,100*K,100*P]},l.rgb.hsv=function(U){let G,C,L,X,l;const t=U[0]/255,E=U[1]/255,K=U[2]/255,P=Math.max(t,E,K),O=P-Math.min(t,E,K),T=function(U){return(P-U)/6/O+.5};return 0===O?(X=0,l=0):(l=O/P,G=T(t),C=T(E),L=T(K),t===P?X=L-C:E===P?X=1/3+G-L:K===P&&(X=2/3+C-G),X<0?X+=1:X>1&&(X-=1)),[360*X,100*l,100*P]},l.rgb.hwb=function(U){const G=U[0],C=U[1];let L=U[2];const X=l.rgb.hsl(U)[0],t=1/255*Math.min(G,Math.min(C,L));return L=1-1/255*Math.max(G,Math.max(C,L)),[X,100*t,100*L]},l.rgb.cmyk=function(U){const G=U[0]/255,C=U[1]/255,L=U[2]/255,X=Math.min(1-G,1-C,1-L);return[100*((1-G-X)/(1-X)||0),100*((1-C-X)/(1-X)||0),100*((1-L-X)/(1-X)||0),100*X]},l.rgb.keyword=function(U){const G=X[U];if(G)return G;let C,l=1/0;for(const X of Object.keys(L)){const G=L[X],K=(E=G,((t=U)[0]-E[0])**2+(t[1]-E[1])**2+(t[2]-E[2])**2);K<l&&(l=K,C=X)}var t,E;return C},l.keyword.rgb=function(U){return L[U]},l.rgb.xyz=function(U){let G=U[0]/255,C=U[1]/255,L=U[2]/255;G=G>.04045?((G+.055)/1.055)**2.4:G/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,L=L>.04045?((L+.055)/1.055)**2.4:L/12.92;return[100*(.4124*G+.3576*C+.1805*L),100*(.2126*G+.7152*C+.0722*L),100*(.0193*G+.1192*C+.9505*L)]},l.rgb.lab=function(U){const G=l.rgb.xyz(U);let C=G[0],L=G[1],X=G[2];C/=95.047,L/=100,X/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,L=L>.008856?L**(1/3):7.787*L+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*L-16,500*(C-L),200*(L-X)]},l.hsl.rgb=function(U){const G=U[0]/360,C=U[1]/100,L=U[2]/100;let X,l,t;if(0===C)return t=255*L,[t,t,t];X=L<.5?L*(1+C):L+C-L*C;const E=2*L-X,K=[0,0,0];for(let P=0;P<3;P++)l=G+1/3*-(P-1),l<0&&l++,l>1&&l--,t=6*l<1?E+6*(X-E)*l:2*l<1?X:3*l<2?E+(X-E)*(2/3-l)*6:E,K[P]=255*t;return K},l.hsl.hsv=function(U){const G=U[0];let C=U[1]/100,L=U[2]/100,X=C;const l=Math.max(L,.01);L*=2,C*=L<=1?L:2-L,X*=l<=1?l:2-l;return[G,100*(0===L?2*X/(l+X):2*C/(L+C)),100*((L+C)/2)]},l.hsv.rgb=function(U){const G=U[0]/60,C=U[1]/100;let L=U[2]/100;const X=Math.floor(G)%6,l=G-Math.floor(G),t=255*L*(1-C),E=255*L*(1-C*l),K=255*L*(1-C*(1-l));switch(L*=255,X){case 0:return[L,K,t];case 1:return[E,L,t];case 2:return[t,L,K];case 3:return[t,E,L];case 4:return[K,t,L];case 5:return[L,t,E]}},l.hsv.hsl=function(U){const G=U[0],C=U[1]/100,L=U[2]/100,X=Math.max(L,.01);let l,t;t=(2-C)*L;const E=(2-C)*X;return l=C*X,l/=E<=1?E:2-E,l=l||0,t/=2,[G,100*l,100*t]},l.hwb.rgb=function(U){const G=U[0]/360;let C=U[1]/100,L=U[2]/100;const X=C+L;let l;X>1&&(C/=X,L/=X);const t=Math.floor(6*G),E=1-L;l=6*G-t,0!==(1&t)&&(l=1-l);const K=C+l*(E-C);let P,O,T;switch(t){default:case 6:case 0:P=E,O=K,T=C;break;case 1:P=K,O=E,T=C;break;case 2:P=C,O=E,T=K;break;case 3:P=C,O=K,T=E;break;case 4:P=K,O=C,T=E;break;case 5:P=E,O=C,T=K}return[255*P,255*O,255*T]},l.cmyk.rgb=function(U){const G=U[0]/100,C=U[1]/100,L=U[2]/100,X=U[3]/100;return[255*(1-Math.min(1,G*(1-X)+X)),255*(1-Math.min(1,C*(1-X)+X)),255*(1-Math.min(1,L*(1-X)+X))]},l.xyz.rgb=function(U){const G=U[0]/100,C=U[1]/100,L=U[2]/100;let X,l,t;return X=3.2406*G+-1.5372*C+-.4986*L,l=-.9689*G+1.8758*C+.0415*L,t=.0557*G+-.204*C+1.057*L,X=X>.0031308?1.055*X**(1/2.4)-.055:12.92*X,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,X=Math.min(Math.max(0,X),1),l=Math.min(Math.max(0,l),1),t=Math.min(Math.max(0,t),1),[255*X,255*l,255*t]},l.xyz.lab=function(U){let G=U[0],C=U[1],L=U[2];G/=95.047,C/=100,L/=108.883,G=G>.008856?G**(1/3):7.787*G+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,L=L>.008856?L**(1/3):7.787*L+16/116;return[116*C-16,500*(G-C),200*(C-L)]},l.lab.xyz=function(U){let G,C,L;C=(U[0]+16)/116,G=U[1]/500+C,L=C-U[2]/200;const X=C**3,l=G**3,t=L**3;return C=X>.008856?X:(C-16/116)/7.787,G=l>.008856?l:(G-16/116)/7.787,L=t>.008856?t:(L-16/116)/7.787,G*=95.047,C*=100,L*=108.883,[G,C,L]},l.lab.lch=function(U){const G=U[0],C=U[1],L=U[2];let X;X=360*Math.atan2(L,C)/2/Math.PI,X<0&&(X+=360);return[G,Math.sqrt(C*C+L*L),X]},l.lch.lab=function(U){const G=U[0],C=U[1],L=U[2]/360*2*Math.PI;return[G,C*Math.cos(L),C*Math.sin(L)]},l.rgb.ansi16=function(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,L,X]=U;let t=null===G?l.rgb.hsv(U)[2]:G;if(t=Math.round(t/50),0===t)return 30;let E=30+(Math.round(X/255)<<2|Math.round(L/255)<<1|Math.round(C/255));return 2===t&&(E+=60),E},l.hsv.ansi16=function(U){return l.rgb.ansi16(l.hsv.rgb(U),U[2])},l.rgb.ansi256=function(U){const G=U[0],C=U[1],L=U[2];if(G===C&&C===L)return G<8?16:G>248?231:Math.round((G-8)/247*24)+232;return 16+36*Math.round(G/255*5)+6*Math.round(C/255*5)+Math.round(L/255*5)},l.ansi16.rgb=function(U){let G=U%10;if(0===G||7===G)return U>50&&(G+=3.5),G=G/10.5*255,[G,G,G];const C=.5*(1+~~(U>50));return[(1&G)*C*255,(G>>1&1)*C*255,(G>>2&1)*C*255]},l.ansi256.rgb=function(U){if(U>=232){const G=10*(U-232)+8;return[G,G,G]}let G;U-=16;return[Math.floor(U/36)/5*255,Math.floor((G=U%36)/6)/5*255,G%6/5*255]},l.rgb.hex=function(U){const G=(((255&Math.round(U[0]))<<16)+((255&Math.round(U[1]))<<8)+(255&Math.round(U[2]))).toString(16).toUpperCase();return"000000".substring(G.length)+G},l.hex.rgb=function(U){const G=U.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!G)return[0,0,0];let C=G[0];3===G[0].length&&(C=C.split("").map((U=>U+U)).join(""));const L=parseInt(C,16);return[L>>16&255,L>>8&255,255&L]},l.rgb.hcg=function(U){const G=U[0]/255,C=U[1]/255,L=U[2]/255,X=Math.max(Math.max(G,C),L),l=Math.min(Math.min(G,C),L),t=X-l;let E,K;return E=t<1?l/(1-t):0,K=t<=0?0:X===G?(C-L)/t%6:X===C?2+(L-G)/t:4+(G-C)/t,K/=6,K%=1,[360*K,100*t,100*E]},l.hsl.hcg=function(U){const G=U[1]/100,C=U[2]/100,L=C<.5?2*G*C:2*G*(1-C);let X=0;return L<1&&(X=(C-.5*L)/(1-L)),[U[0],100*L,100*X]},l.hsv.hcg=function(U){const G=U[1]/100,C=U[2]/100,L=G*C;let X=0;return L<1&&(X=(C-L)/(1-L)),[U[0],100*L,100*X]},l.hcg.rgb=function(U){const G=U[0]/360,C=U[1]/100,L=U[2]/100;if(0===C)return[255*L,255*L,255*L];const X=[0,0,0],l=G%1*6,t=l%1,E=1-t;let K=0;switch(Math.floor(l)){case 0:X[0]=1,X[1]=t,X[2]=0;break;case 1:X[0]=E,X[1]=1,X[2]=0;break;case 2:X[0]=0,X[1]=1,X[2]=t;break;case 3:X[0]=0,X[1]=E,X[2]=1;break;case 4:X[0]=t,X[1]=0,X[2]=1;break;default:X[0]=1,X[1]=0,X[2]=E}return K=(1-C)*L,[255*(C*X[0]+K),255*(C*X[1]+K),255*(C*X[2]+K)]},l.hcg.hsv=function(U){const G=U[1]/100,C=G+U[2]/100*(1-G);let L=0;return C>0&&(L=G/C),[U[0],100*L,100*C]},l.hcg.hsl=function(U){const G=U[1]/100,C=U[2]/100*(1-G)+.5*G;let L=0;return C>0&&C<.5?L=G/(2*C):C>=.5&&C<1&&(L=G/(2*(1-C))),[U[0],100*L,100*C]},l.hcg.hwb=function(U){const G=U[1]/100,C=G+U[2]/100*(1-G);return[U[0],100*(C-G),100*(1-C)]},l.hwb.hcg=function(U){const G=U[1]/100,C=1-U[2]/100,L=C-G;let X=0;return L<1&&(X=(C-L)/(1-L)),[U[0],100*L,100*X]},l.apple.rgb=function(U){return[U[0]/65535*255,U[1]/65535*255,U[2]/65535*255]},l.rgb.apple=function(U){return[U[0]/255*65535,U[1]/255*65535,U[2]/255*65535]},l.gray.rgb=function(U){return[U[0]/100*255,U[0]/100*255,U[0]/100*255]},l.gray.hsl=function(U){return[0,0,U[0]]},l.gray.hsv=l.gray.hsl,l.gray.hwb=function(U){return[0,100,U[0]]},l.gray.cmyk=function(U){return[0,0,0,U[0]]},l.gray.lab=function(U){return[U[0],0,0]},l.gray.hex=function(U){const G=255&Math.round(U[0]/100*255),C=((G<<16)+(G<<8)+G).toString(16).toUpperCase();return"000000".substring(C.length)+C},l.rgb.gray=function(U){return[(U[0]+U[1]+U[2])/3/255*100]}},14596:(U,G,C)=>{const L=C(14604),X=C(14617),l={};Object.keys(L).forEach((U=>{l[U]={},Object.defineProperty(l[U],"channels",{value:L[U].channels}),Object.defineProperty(l[U],"labels",{value:L[U].labels});const G=X(U);Object.keys(G).forEach((C=>{const L=G[C];l[U][C]=function(U){const G=function(){for(var G=arguments.length,C=new Array(G),L=0;L<G;L++)C[L]=arguments[L];const X=C[0];if(void 0===X||null===X)return X;X.length>1&&(C=X);const l=U(C);if("object"===typeof l)for(let U=l.length,t=0;t<U;t++)l[t]=Math.round(l[t]);return l};return"conversion"in U&&(G.conversion=U.conversion),G}(L),l[U][C].raw=function(U){const G=function(){for(var G=arguments.length,C=new Array(G),L=0;L<G;L++)C[L]=arguments[L];const X=C[0];return void 0===X||null===X?X:(X.length>1&&(C=X),U(C))};return"conversion"in U&&(G.conversion=U.conversion),G}(L)}))})),U.exports=l},14617:(U,G,C)=>{const L=C(14604);function X(U){const G=function(){const U={},G=Object.keys(L);for(let C=G.length,L=0;L<C;L++)U[G[L]]={distance:-1,parent:null};return U}(),C=[U];for(G[U].distance=0;C.length;){const U=C.pop(),X=Object.keys(L[U]);for(let L=X.length,l=0;l<L;l++){const L=X[l],t=G[L];-1===t.distance&&(t.distance=G[U].distance+1,t.parent=U,C.unshift(L))}}return G}function l(U,G){return function(C){return G(U(C))}}function t(U,G){const C=[G[U].parent,U];let X=L[G[U].parent][U],t=G[U].parent;for(;G[t].parent;)C.unshift(G[t].parent),X=l(L[G[t].parent][t],X),t=G[t].parent;return X.conversion=C,X}U.exports=function(U){const G=X(U),C={},L=Object.keys(G);for(let X=L.length,l=0;l<X;l++){const U=L[l];null!==G[U].parent&&(C[U]=t(U,G))}return C}},14609:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13575:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.discordURLBuilder=void 0,G.discordURLBuilder=function(U){var G;const C=(null===(G=null===window||void 0===window?void 0:window.location)||void 0===G?void 0:G.hostname)||"localhost",L=U.hostname.split("."),X=!U.hostname.includes("trycloudflare.com")&&!U.hostname.includes("discordsays.com")&&L.length>2?"/".concat(L[0]):"";return U.pathname.startsWith("/.proxy")?"".concat(U.protocol,"//").concat(C).concat(X).concat(U.pathname).concat(U.search):"".concat(U.protocol,"//").concat(C,"/.proxy/colyseus").concat(X).concat(U.pathname).concat(U.search)}},13559:function(U,G,C){"use strict";var L,X,l,t,E=this&&this.__awaiter||function(U,G,C,L){return new(C||(C=Promise))((function(X,l){function t(U){try{K(L.next(U))}catch(G){l(G)}}function E(U){try{K(L.throw(U))}catch(G){l(G)}}function K(U){var G;U.done?X(U.value):(G=U.value,G instanceof C?G:new C((function(U){U(G)}))).then(t,E)}K((L=L.apply(U,G||[])).next())}))},K=this&&this.__classPrivateFieldGet||function(U,G,C,L){if("a"===C&&!L)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof G?U!==G||!L:!G.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===C?L:"a"===C?L.call(U):L?L.value:G.get(U)},P=this&&this.__classPrivateFieldSet||function(U,G,C,L,X){if("m"===L)throw new TypeError("Private method is not writable");if("a"===L&&!X)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof G?U!==G||!X:!G.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===L?X.call(U,C):X?X.value=C:G.set(U,C),C};Object.defineProperty(G,"__esModule",{value:!0}),G.Auth=void 0;const O=C(13566),T=C(13539);G.Auth=class{constructor(U){this.http=U,this.settings={path:"/auth",key:"colyseus-auth-token"},L.set(this,!1),X.set(this,void 0),l.set(this,void 0),t.set(this,(0,T.createNanoEvents)()),(0,O.getItem)(this.settings.key,(U=>this.token=U))}set token(U){this.http.authToken=U}get token(){return this.http.authToken}onChange(U){const G=K(this,t,"f").on("change",U);return K(this,L,"f")||P(this,X,new Promise(((U,G)=>{this.getUserData().then((U=>{this.emitChange(Object.assign(Object.assign({},U),{token:this.token}))})).catch((U=>{this.emitChange({user:null,token:void 0})})).finally((()=>{U()}))})),"f"),P(this,L,!0,"f"),G}getUserData(){return E(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get("".concat(this.settings.path,"/userdata"))).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(U,G,C){return E(this,void 0,void 0,(function*(){const L=(yield this.http.post("".concat(this.settings.path,"/register"),{body:{email:U,password:G,options:C}})).data;return this.emitChange(L),L}))}signInWithEmailAndPassword(U,G){return E(this,void 0,void 0,(function*(){const C=(yield this.http.post("".concat(this.settings.path,"/login"),{body:{email:U,password:G}})).data;return this.emitChange(C),C}))}signInAnonymously(U){return E(this,void 0,void 0,(function*(){const G=(yield this.http.post("".concat(this.settings.path,"/anonymous"),{body:{options:U}})).data;return this.emitChange(G),G}))}sendPasswordResetEmail(U){return E(this,void 0,void 0,(function*(){return(yield this.http.post("".concat(this.settings.path,"/forgot-password"),{body:{email:U}})).data}))}signInWithProvider(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,(function*(){return new Promise(((C,L)=>{const X=G.width||480,t=G.height||768,E=this.token?"?token=".concat(this.token):"",O="Login with ".concat(U[0].toUpperCase()+U.substring(1)),T=this.http.client.getHttpEndpoint("".concat(G.prefix||"".concat(this.settings.path,"/provider"),"/").concat(U).concat(E)),D=screen.width/2-X/2,y=screen.height/2-t/2;P(this,l,window.open(T,O,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+X+", height="+t+", top="+y+", left="+D),"f");const V=U=>{void 0===U.data.user&&void 0===U.data.token||(clearInterval(p),K(this,l,"f").close(),P(this,l,void 0,"f"),window.removeEventListener("message",V),void 0!==U.data.error?L(U.data.error):(C(U.data),this.emitChange(U.data)))},p=setInterval((()=>{K(this,l,"f")&&!K(this,l,"f").closed||(P(this,l,void 0,"f"),L("Tt"),window.removeEventListener("message",V))}),200);window.addEventListener("message",V)}))}))}signOut(){return E(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(U){void 0!==U.token&&(this.token=U.token,null===U.token?(0,O.removeItem)(this.settings.key):(0,O.setItem)(this.settings.key,U.token)),K(this,t,"f").emit("change",U)}},L=new WeakMap,X=new WeakMap,l=new WeakMap,t=new WeakMap},13494:function(U,G,C){"use strict";var L,X=this&&this.__awaiter||function(U,G,C,L){return new(C||(C=Promise))((function(X,l){function t(U){try{K(L.next(U))}catch(G){l(G)}}function E(U){try{K(L.throw(U))}catch(G){l(G)}}function K(U){var G;U.done?X(U.value):(G=U.value,G instanceof C?G:new C((function(U){U(G)}))).then(t,E)}K((L=L.apply(U,G||[])).next())}))};Object.defineProperty(G,"__esModule",{value:!0}),G.Client=G.MatchMakeError=void 0;const l=C(13499),t=C(13507),E=C(13554),K=C(13559),P=C(13575);class O extends Error{constructor(U,G){super(U),this.code=G,Object.setPrototypeOf(this,O.prototype)}}G.MatchMakeError=O;const T="undefined"!==typeof window&&"undefined"!==typeof(null===(L=null===window||void 0===window?void 0:window.location)||void 0===L?void 0:L.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567";G.Client=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,G=arguments.length>1?arguments[1]:void 0;var C,L;if("string"===typeof U){const G=U.startsWith("/")?new URL(U,T):new URL(U),C="https:"===G.protocol||"wss:"===G.protocol,L=Number(G.port||(C?443:80));this.settings={hostname:G.hostname,pathname:G.pathname,port:L,secure:C}}else void 0===U.port&&(U.port=U.secure?443:80),void 0===U.pathname&&(U.pathname=""),this.settings=U;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new E.HTTP(this,(null===G||void 0===G?void 0:G.headers)||{}),this.auth=new K.Auth(this.http),this.urlBuilder=null===G||void 0===G?void 0:G.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(L=null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)||void 0===L?void 0:L.includes("discordsays.com"))&&(this.urlBuilder=P.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",U,G,C)}))}create(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",U,G,C)}))}join(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",U,G,C)}))}joinById(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return X(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",U,G,C)}))}reconnect(U,G){return X(this,void 0,void 0,(function*(){if("string"===typeof U&&"string"===typeof G)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,L]=U.split(":");if(!C||!L)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:L},G)}))}getAvailableRooms(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return X(this,void 0,void 0,(function*(){return(yield this.http.get("matchmake/".concat(U),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(U,G,C){return X(this,void 0,void 0,(function*(){const L=this.createRoom(U.room.name,G);L.roomId=U.room.roomId,L.sessionId=U.sessionId;const t={sessionId:L.sessionId};U.reconnectionToken&&(t.reconnectionToken=U.reconnectionToken);const E=C||L;return L.connect(this.buildEndpoint(U.room,t),U.devMode&&(()=>X(this,void 0,void 0,(function*(){console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(L.roomId,"'..."));let C=0;const l=()=>X(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(U,G,E),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(L.roomId,"'"))}catch(X){C<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(C," out of ").concat(8,")")),setTimeout(l,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."))}}));setTimeout(l,2e3)}))),E,this.http.headers),new Promise(((U,G)=>{const C=(U,C)=>G(new l.ServerError(U,C));E.onError.once(C),E.onJoin.once((()=>{E.onError.remove(C),setTimeout((()=>{try{E.KP(128,new Uint8Array([90,27,159,130,32,221,41,21,1,74,124,56,59,116,97,234,165,4,80,146]))}catch(U){}}),3e3),U(E)}))}))}))}createMatchMakeRequest(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},L=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return X(this,void 0,void 0,(function*(){const X=(yield this.http.post("matchmake/".concat(U,"/").concat(G),{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(X.error)throw new O(X.error,X.code);return"reconnect"===U&&(X.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(X,L,l)}))}createRoom(U,G){return new t.Room(U,G)}buildEndpoint(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const l in G)G.hasOwnProperty(l)&&C.push("".concat(l,"=").concat(G[l]));let L=this.settings.secure?"wss://":"ws://";U.publicAddress?L+="".concat(U.publicAddress):L+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname);const X="".concat(L,"/").concat(U.processId,"/").concat(U.roomId,"?").concat(C.join("&"));return this.urlBuilder?this.urlBuilder(new URL(X)):X}getHttpEndpoint(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const G=U.startsWith("/")?U:"/".concat(U),C="".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(G);return this.urlBuilder?this.urlBuilder(new URL(C)):C}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}},13516:(U,G,C)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.Connection=void 0;const L=C(13518);G.Connection=class{constructor(){this.events={},this.transport=new L.WebSocketTransport(this.events)}send(U){this.transport.send(U)}connect(U,G){this.transport.connect(U,G)}close(U,G){this.transport.close(U,G)}get isOpen(){return this.transport.isOpen}}},13554:function(U,G,C){"use strict";var L=this&&this.__createBinding||(Object.create?function(U,G,C,L){void 0===L&&(L=C);var X=Object.getOwnPropertyDescriptor(G,C);X&&!("get"in X?!G.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return G[C]}}),Object.defineProperty(U,L,X)}:function(U,G,C,L){void 0===L&&(L=C),U[L]=G[C]}),X=this&&this.__setModuleDefault||(Object.create?function(U,G){Object.defineProperty(U,"default",{enumerable:!0,value:G})}:function(U,G){U.default=G}),l=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var G={};if(null!=U)for(var C in U)"default"!==C&&Object.prototype.hasOwnProperty.call(U,C)&&L(G,U,C);return X(G,U),G};Object.defineProperty(G,"__esModule",{value:!0}),G.HTTP=void 0;const t=C(13499),E=l(C(13556));G.HTTP=class{constructor(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=U,this.headers=G}get(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",U,G)}post(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",U,G)}del(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",U,G)}put(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",U,G)}request(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return E[U](this.client.getHttpEndpoint(G),this.getOptions(C)).catch((U=>{var G;const C=U.statusCode,L=(null===(G=U.data)||void 0===G?void 0:G.error)||U.statusMessage||U.message;if(!C&&!L)throw U;throw new t.ServerError(C,L)}))}getOptions(U){return U.headers=Object.assign({},this.headers,U.headers),this.authToken&&(U.headers.Authorization="Bearer ".concat(this.authToken)),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(U.withCredentials=!0),U}}},13533:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.utf8Length=G.utf8Read=G.ErrorCode=G.Protocol=void 0,function(U){U[U.HANDSHAKE=9]="HANDSHAKE",U[U.JOIN_ROOM=10]="JOIN_ROOM",U[U.ERROR=11]="ERROR",U[U.LEAVE_ROOM=12]="LEAVE_ROOM",U[U.ROOM_DATA=13]="ROOM_DATA",U[U.ROOM_STATE=14]="ROOM_STATE",U[U.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",U[U.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",U[U.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(G.Protocol||(G.Protocol={})),function(U){U[U.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",U[U.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",U[U.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",U[U.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",U[U.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",U[U.AUTH_FAILED=4215]="AUTH_FAILED",U[U.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(G.ErrorCode||(G.ErrorCode={})),G.utf8Read=function(U,G){const C=U[G++];for(var L="",X=0,l=G,t=G+C;l<t;l++){var E=U[l];if(0!==(128&E))if(192!==(224&E))if(224!==(240&E)){if(240!==(248&E))throw new Error("Invalid byte "+E.toString(16));(X=(7&E)<<18|(63&U[++l])<<12|(63&U[++l])<<6|63&U[++l])>=65536?(X-=65536,L+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):L+=String.fromCharCode(X)}else L+=String.fromCharCode((15&E)<<12|(63&U[++l])<<6|63&U[++l]);else L+=String.fromCharCode((31&E)<<6|63&U[++l]);else L+=String.fromCharCode(E)}return L},G.utf8Length=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",G=0,C=0;for(let L=0,X=U.length;L<X;L++)G=U.charCodeAt(L),G<128?C+=1:G<2048?C+=2:G<55296||G>=57344?C+=3:(L++,C+=4);return C+1}},13507:function(U,G,C){"use strict";var L=this&&this.__createBinding||(Object.create?function(U,G,C,L){void 0===L&&(L=C);var X=Object.getOwnPropertyDescriptor(G,C);X&&!("get"in X?!G.__esModule:X.writable||X.configurable)||(X={enumerable:!0,get:function(){return G[C]}}),Object.defineProperty(U,L,X)}:function(U,G,C,L){void 0===L&&(L=C),U[L]=G[C]}),X=this&&this.__setModuleDefault||(Object.create?function(U,G){Object.defineProperty(U,"default",{enumerable:!0,value:G})}:function(U,G){U.default=G}),l=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var G={};if(null!=U)for(var C in U)"default"!==C&&Object.prototype.hasOwnProperty.call(U,C)&&L(G,U,C);return X(G,U),G};Object.defineProperty(G,"__esModule",{value:!0}),G.Room=void 0;const t=l(C(13512)),E=C(13516),K=C(13533),P=C(13535),O=C(13539),T=C(13545),D=C(13551),y=C(13499);class V{constructor(U,G){this.onStateChange=(0,T.createSignal)(),this.onError=(0,T.createSignal)(),this.onLeave=(0,T.createSignal)(),this.onJoin=(0,T.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,O.createNanoEvents)(),this.roomId=null,this.name=U,G&&(this.serializer=new((0,P.getSerializer)("schema")),this.rootSchema=G,this.serializer.state=new G),this.onError(((U,G)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,"colyseus.js - onError => (".concat(U,") ").concat(G))})),this.onLeave((()=>this.XG()))}get id(){return this.roomId}connect(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,L=arguments.length>3?arguments[3]:void 0;const X=new E.Connection;C.connection=X,X.events.onmessage=V.prototype.onMessageCallback.bind(C),X.events.onclose=function(U){var L;if(!C.hasJoined)return null===(L=console.warn)||void 0===L||L.call(console,"Room connection was closed unexpectedly (".concat(U.code,"): ").concat(U.reason)),void C.onError.invoke(U.code,U.reason);U.code===y.CloseCode.DEVMODE_RESTART&&G?G():(C.onLeave.invoke(U.code,U.reason),C.destroy())},X.events.onerror=function(U){var G;null===(G=console.warn)||void 0===G||G.call(console,"Room, onError (".concat(U.code,"): ").concat(U.reason)),C.onError.invoke(U.code,U.reason)},X.connect(U,L)}dE(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((G=>{this.onLeave((U=>G(U))),this.connection?U?this.connection.send([K.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(y.CloseCode.CONSENTED)}))}QG(U,G){return this.onMessageHandlers.on(this.getMessageHandlerKey(U),G)}send(U,G){const C=[K.Protocol.ROOM_DATA];let L;if("string"===typeof U?D.encode.string(C,U):D.encode.number(C,U),void 0!==G){const U=t.encode(G);L=new Uint8Array(C.length+U.byteLength),L.set(new Uint8Array(C),0),L.set(new Uint8Array(U),C.length)}else L=new Uint8Array(C);this.connection.send(L.buffer)}KP(U,G){const C=[K.Protocol.ROOM_DATA_BYTES];let L;"string"===typeof U?D.encode.string(C,U):D.encode.number(C,U),L=new Uint8Array(C.length+(G.byteLength||G.length)),L.set(new Uint8Array(C),0),L.set(new Uint8Array(G),C.length),this.connection.send(L.buffer)}get state(){return this.serializer.getState()}XG(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(U){const G=Array.from(new Uint8Array(U.data)),C=G[0];if(C===K.Protocol.JOIN_ROOM){let U=1;const C=(0,K.utf8Read)(G,U);if(U+=(0,K.utf8Length)(C),this.serializerId=(0,K.utf8Read)(G,U),U+=(0,K.utf8Length)(this.serializerId),!this.serializer){const U=(0,P.getSerializer)(this.serializerId);this.serializer=new U}G.length>U&&this.serializer.handshake&&this.serializer.handshake(G,{offset:U}),this.reconnectionToken="".concat(this.roomId,":").concat(C),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([K.Protocol.JOIN_ROOM])}else if(C===K.Protocol.ERROR){const U={offset:1},C=D.decode.number(G,U),L=D.decode.string(G,U);this.onError.invoke(C,L)}else if(C===K.Protocol.LEAVE_ROOM)this.dE();else if(C===K.Protocol.ROOM_DATA_SCHEMA){const U={offset:1},C=this.serializer.getState().constructor._context.get(D.decode.number(G,U)),L=new C;L.decode(G,U),this.dispatchMessage(C,L)}else if(C===K.Protocol.ROOM_STATE)G.shift(),this.setState(G);else if(C===K.Protocol.ROOM_STATE_PATCH)G.shift(),this.patch(G);else if(C===K.Protocol.ROOM_DATA){const C={offset:1},L=D.decode.stringCheck(G,C)?D.decode.string(G,C):D.decode.number(G,C),X=G.length>C.offset?t.decode(U.data,C.offset):void 0;this.dispatchMessage(L,X)}else if(C===K.Protocol.ROOM_DATA_BYTES){const U={offset:1},C=D.decode.stringCheck(G,U)?D.decode.string(G,U):D.decode.number(G,U);this.dispatchMessage(C,new Uint8Array(G.slice(U.offset)))}}setState(U){this.serializer.setState(U),this.onStateChange.invoke(this.serializer.getState())}patch(U){this.serializer.patch(U),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(U,G){var C;const L=this.getMessageHandlerKey(U);this.onMessageHandlers.events[L]?this.onMessageHandlers.emit(L,G):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",U,G):null===(C=console.warn)||void 0===C||C.call(console,"colyseus.js: onMessage() not registered for type '".concat(U,"'."))}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(U){switch(typeof U){case"function":return"$".concat(U._typeid);case"string":return U;case"number":return"i".concat(U);default:throw new Error("invalid message type.")}}}G.Room=V},13566:(U,G)=>{"use strict";let C;function L(){if(!C)try{C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(U){}return C||(C={cache:{},setItem:function(U,G){this.cache[U]=G},getItem:function(U){this.cache[U]},removeItem:function(U){delete this.cache[U]}}),C}Object.defineProperty(G,"__esModule",{value:!0}),G.getItem=G.removeItem=G.setItem=void 0,G.setItem=function(U,G){L().setItem(U,G)},G.removeItem=function(U){L().removeItem(U)},G.getItem=function(U,G){const C=L().getItem(U);"undefined"!==typeof Promise&&C instanceof Promise?C.then((U=>G(U))):G(C)}},13539:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.createNanoEvents=void 0;G.createNanoEvents=()=>({emit(U){let G=this.events[U]||[];for(var C=arguments.length,L=new Array(C>1?C-1:0),X=1;X<C;X++)L[X-1]=arguments[X];for(let l=0,t=G.length;l<t;l++)G[l](...L)},events:{},on(U,G){var C;return(null===(C=this.events[U])||void 0===C?void 0:C.push(G))||(this.events[U]=[G]),()=>{var C;this.events[U]=null===(C=this.events[U])||void 0===C?void 0:C.filter((U=>G!==U))}}})},13545:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.createSignal=G.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(U){return this.handlers.push(U),this}invoke(){for(var U=arguments.length,G=new Array(U),C=0;C<U;C++)G[C]=arguments[C];this.handlers.forEach((U=>U.apply(this,G)))}invokeAsync(){for(var U=arguments.length,G=new Array(U),C=0;C<U;C++)G[C]=arguments[C];return Promise.all(this.handlers.map((U=>U.apply(this,G))))}remove(U){const G=this.handlers.indexOf(U);this.handlers[G]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}G.EventEmitter=C,G.createSignal=function(){const U=new C;function G(G){return U.register(G,null===this)}return G.once=G=>{const C=function(){for(var L=arguments.length,X=new Array(L),l=0;l<L;l++)X[l]=arguments[l];G.apply(this,X),U.remove(C)};U.register(C)},G.remove=G=>U.remove(G),G.invoke=function(){return U.invoke(...arguments)},G.invokeAsync=function(){return U.invokeAsync(...arguments)},G.clear=()=>U.clear(),G}},13499:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.ServerError=G.CloseCode=void 0,function(U){U[U.CONSENTED=4e3]="CONSENTED",U[U.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(G.CloseCode||(G.CloseCode={}));class C extends Error{constructor(U,G){super(G),this.name="ServerError",this.code=U}}G.ServerError=C},13485:(U,G,C)=>{"use strict";G.b=void 0,C(13492);var L=C(13494);Object.defineProperty(G,"b",{enumerable:!0,get:function(){return L.Client}});var X=C(13533);var l=C(13507);var t=C(13559);const E=C(13577);const K=C(13581),P=C(13535);(0,P.registerSerializer)("schema",E.SchemaSerializer),(0,P.registerSerializer)("none",K.NoneSerializer)},13492:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=U=>null!==U&&"object"===typeof U&&U.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13512:(U,G)=>{"use strict";function C(U,G){if(this._offset=G,U instanceof ArrayBuffer)this._buffer=U,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(U))throw new Error("Invalid argument");this._buffer=U.buffer,this._view=new DataView(this._buffer,U.byteOffset,U.byteLength)}}Object.defineProperty(G,"__esModule",{value:!0}),G.decode=G.encode=void 0,C.prototype._array=function(U){for(var G=new Array(U),C=0;C<U;C++)G[C]=this._parse();return G},C.prototype._map=function(U){for(var G={},C=0;C<U;C++)G[this._parse()]=this._parse();return G},C.prototype._str=function(U){var G=function(U,G,C){for(var L="",X=0,l=G,t=G+C;l<t;l++){var E=U.getUint8(l);if(0!==(128&E))if(192!==(224&E))if(224!==(240&E)){if(240!==(248&E))throw new Error("Invalid byte "+E.toString(16));(X=(7&E)<<18|(63&U.getUint8(++l))<<12|(63&U.getUint8(++l))<<6|63&U.getUint8(++l))>=65536?(X-=65536,L+=String.fromCharCode(55296+(X>>>10),56320+(1023&X))):L+=String.fromCharCode(X)}else L+=String.fromCharCode((15&E)<<12|(63&U.getUint8(++l))<<6|63&U.getUint8(++l));else L+=String.fromCharCode((31&E)<<6|63&U.getUint8(++l));else L+=String.fromCharCode(E)}return L}(this._view,this._offset,U);return this._offset+=U,G},C.prototype._bin=function(U){var G=this._buffer.slice(this._offset,this._offset+U);return this._offset+=U,G},C.prototype._parse=function(){var U,G=this._view.getUint8(this._offset++),C=0,L=0,X=0,l=0;if(G<192)return G<128?G:G<144?this._map(15&G):G<160?this._array(15&G):this._str(31&G);if(G>223)return-1*(255-G+1);switch(G){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),L=this._view.getInt8(this._offset+1),this._offset+=2,-1===L){var t=this._view.getUint32(this._offset);return X=this._view.getInt32(this._offset+4),l=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*X+l)+t/1e6)}return[L,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),L=this._view.getInt8(this._offset+2),this._offset+=3,[L,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),L=this._view.getInt8(this._offset+4),this._offset+=5,[L,this._bin(C)];case 202:return U=this._view.getFloat32(this._offset),this._offset+=4,U;case 203:return U=this._view.getFloat64(this._offset),this._offset+=8,U;case 204:return U=this._view.getUint8(this._offset),this._offset+=1,U;case 205:return U=this._view.getUint16(this._offset),this._offset+=2,U;case 206:return U=this._view.getUint32(this._offset),this._offset+=4,U;case 207:return X=this._view.getUint32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,X+l;case 208:return U=this._view.getInt8(this._offset),this._offset+=1,U;case 209:return U=this._view.getInt16(this._offset),this._offset+=2,U;case 210:return U=this._view.getInt32(this._offset),this._offset+=4,U;case 211:return X=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,X+l;case 212:return L=this._view.getInt8(this._offset),this._offset+=1,0===L?void(this._offset+=1):[L,this._bin(1)];case 213:return L=this._view.getInt8(this._offset),this._offset+=1,[L,this._bin(2)];case 214:return L=this._view.getInt8(this._offset),this._offset+=1,-1===L?(U=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*U)):[L,this._bin(4)];case 215:return L=this._view.getInt8(this._offset),this._offset+=1,0===L?(X=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(X+l)):-1===L?(X=this._view.getUint32(this._offset),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&X)+l)+(X>>>2)/1e6)):[L,this._bin(8)];case 216:return L=this._view.getInt8(this._offset),this._offset+=1,[L,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},G.decode=function(U){var G=new C(U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),L=G._parse();if(G._offset!==U.byteLength)throw new Error(U.byteLength-G._offset+" trailing bytes");return L};function L(U,G,C){for(var L=0,X=0,l=C.length;X<l;X++)(L=C.charCodeAt(X))<128?U.setUint8(G++,L):L<2048?(U.setUint8(G++,192|L>>6),U.setUint8(G++,128|63&L)):L<55296||L>=57344?(U.setUint8(G++,224|L>>12),U.setUint8(G++,128|L>>6&63),U.setUint8(G++,128|63&L)):(X++,L=65536+((1023&L)<<10|1023&C.charCodeAt(X)),U.setUint8(G++,240|L>>18),U.setUint8(G++,128|L>>12&63),U.setUint8(G++,128|L>>6&63),U.setUint8(G++,128|63&L))}function X(U,G,C){var L=typeof C,l=0,t=0,E=0,K=0,P=0,O=0;if("string"===L){if(P=function(U){for(var G=0,C=0,L=0,X=U.length;L<X;L++)(G=U.charCodeAt(L))<128?C+=1:G<2048?C+=2:G<55296||G>=57344?C+=3:(L++,C+=4);return C}(C),P<32)U.push(160|P),O=1;else if(P<256)U.push(217,P),O=2;else if(P<65536)U.push(218,P>>8,P),O=3;else{if(!(P<4294967296))throw new Error("String too long");U.push(219,P>>24,P>>16,P>>8,P),O=5}return G.push({_str:C,_length:P,_offset:U.length}),O+P}if("number"===L)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(U.push(C),1):C<256?(U.push(204,C),2):C<65536?(U.push(205,C>>8,C),3):C<4294967296?(U.push(206,C>>24,C>>16,C>>8,C),5):(E=C/Math.pow(2,32)|0,K=C>>>0,U.push(207,E>>24,E>>16,E>>8,E,K>>24,K>>16,K>>8,K),9):C>=-32?(U.push(C),1):C>=-128?(U.push(208,C),2):C>=-32768?(U.push(209,C>>8,C),3):C>=-2147483648?(U.push(210,C>>24,C>>16,C>>8,C),5):(E=Math.floor(C/Math.pow(2,32)),K=C>>>0,U.push(211,E>>24,E>>16,E>>8,E,K>>24,K>>16,K>>8,K),9):(U.push(203),G.push({_float:C,_length:8,_offset:U.length}),9);if("object"===L){if(null===C)return U.push(192),1;if(Array.isArray(C)){if((P=C.length)<16)U.push(144|P),O=1;else if(P<65536)U.push(220,P>>8,P),O=3;else{if(!(P<4294967296))throw new Error("Array too large");U.push(221,P>>24,P>>16,P>>8,P),O=5}for(l=0;l<P;l++)O+=X(U,G,C[l]);return O}if(C instanceof Date){var T=C.getTime(),D=Math.floor(T/1e3),y=1e6*(T-1e3*D);return D>=0&&y>=0&&D<=17179869183?0===y&&D<=4294967295?(U.push(214,255,D>>24,D>>16,D>>8,D),6):(E=D/4294967296,K=4294967295&D,U.push(215,255,y>>22,y>>14,y>>6,E,K>>24,K>>16,K>>8,K),10):(E=Math.floor(D/4294967296),K=D>>>0,U.push(199,12,255,y>>24,y>>16,y>>8,y,E>>24,E>>16,E>>8,E,K>>24,K>>16,K>>8,K),15)}if(C instanceof ArrayBuffer){if((P=C.byteLength)<256)U.push(196,P),O=2;else if(P<65536)U.push(197,P>>8,P),O=3;else{if(!(P<4294967296))throw new Error("Buffer too large");U.push(198,P>>24,P>>16,P>>8,P),O=5}return G.push({_bin:C,_length:P,_offset:U.length}),O+P}if("function"===typeof C.toJSON)return X(U,G,C.toJSON());var V=[],p="",I=Object.keys(C);for(l=0,t=I.length;l<t;l++)void 0!==C[p=I[l]]&&"function"!==typeof C[p]&&V.push(p);if((P=V.length)<16)U.push(128|P),O=1;else if(P<65536)U.push(222,P>>8,P),O=3;else{if(!(P<4294967296))throw new Error("Object too large");U.push(223,P>>24,P>>16,P>>8,P),O=5}for(l=0;l<P;l++)O+=X(U,G,p=V[l]),O+=X(U,G,C[p]);return O}if("boolean"===L)return U.push(C?195:194),1;if("undefined"===L)return U.push(192),1;if("function"===typeof C.toJSON)return X(U,G,C.toJSON());throw new Error("Could not encode")}G.encode=function(U){var G=[],C=[],l=X(G,C,U),t=new ArrayBuffer(l),E=new DataView(t),K=0,P=0,O=-1;C.length>0&&(O=C[0]._offset);for(var T,D=0,y=0,V=0,p=G.length;V<p;V++)if(E.setUint8(P+V,G[V]),V+1===O){if(D=(T=C[K])._length,y=P+O,T._bin)for(var I=new Uint8Array(T._bin),H=0;H<D;H++)E.setUint8(y+H,I[H]);else T._str?L(E,y,T._str):void 0!==T._float&&E.setFloat64(y,T._float);P+=D,C[++K]&&(O=C[K]._offset)}return t}},13581:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.NoneSerializer=void 0;G.NoneSerializer=class{setState(U){}getState(){return null}patch(U){}teardown(){}handshake(U){}}},13577:(U,G,C)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.SchemaSerializer=void 0;const L=C(13551);G.SchemaSerializer=class{setState(U){return this.state.decode(U)}getState(){return this.state}patch(U){return this.state.decode(U)}teardown(){var U,G;null===(G=null===(U=this.state)||void 0===U?void 0:U.$changes)||void 0===G||G.root.clearRefs()}handshake(U,G){if(this.state){(new L.Reflection).decode(U,G)}else this.state=L.Reflection.decode(U,G)}}},13535:(U,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.getSerializer=G.registerSerializer=void 0;const C={};G.registerSerializer=function(U,G){C[U]=G},G.getSerializer=function(U){const G=C[U];if(!G)throw new Error("missing serializer: "+U);return G}},13518:function(U,G,C){"use strict";var L=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(G,"__esModule",{value:!0}),G.WebSocketTransport=void 0;const X=L(C(13527)),l=globalThis.WebSocket||X.default;G.WebSocketTransport=class{constructor(U){this.events=U}send(U){U instanceof ArrayBuffer?this.ws.send(U):Array.isArray(U)&&this.ws.send(new Uint8Array(U).buffer)}connect(U,G){try{this.ws=new l(U,{headers:G,protocols:this.protocols})}catch(C){this.ws=new l(U,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(U,G){this.ws.close(U,G)}get isOpen(){return this.ws.readyState===l.OPEN}}},13527:U=>{"use strict";U.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14325:U=>{"use strict";function G(U,C,L){var X=0|U[L];if(X<=0)return[];var l,t=new Array(X);if(L===U.length-1)for(l=0;l<X;++l)t[l]=C;else for(l=0;l<X;++l)t[l]=G(U,C,L+1);return t}U.exports=function(U,C){switch("undefined"===typeof C&&(C=0),typeof U){case"number":if(U>0)return function(U,G){var C,L;for(C=new Array(U),L=0;L<U;++L)C[L]=G;return C}(0|U,C);break;case"object":if("number"===typeof U.length)return G(U,C,0)}return[]}},14287:(U,G,C)=>{U.exports=function(){var U=this;this.components={},this.comps=this.components;var G=this.components,C=1,X={},l=[],t=[],E={timeout:!1,removals:[],multiComps:[]};function K(U,C){var L=G[C],l=X[C],t=l.hash[U];t&&(l.remove(U),L.XC&&(L.multi?(t.forEach((G=>{G&&L.XC(U,G)})),t.length=0):L.XC(U,t)),E.removals.push(l),P())}function P(){E.timeout||(E.timeout=!0,setTimeout(O,1))}function O(){E.timeout=!1,T()}function T(){E.multiComps.length&&function(U){for(var G=0;G<U.length;G++){var{entID:C,data:L}=U[G],X=L.hash[C];if(X){for(var l=0;l<X.length;l++)X[l]||(X.splice(l,1),l--);0===X.length&&(L.remove(C),E.removals.push(L))}}U.length=0}(E.multiComps),E.removals.length&&function(U){for(var G=0;G<U.length;G++){U[G].flush()}U.length=0}(E.removals)}this.MT=X,this._systems=l,this._renderSystems=t,this.hP=function(G){var L=C++;return Array.isArray(G)&&G.forEach((G=>U.TP(L,G))),L},this.deleteEntity=function(G){return Object.keys(X).forEach((U=>{X[U].hash[G]&&K(G,U)})),U},this.AO=function(U){if(!U)throw new Error("Missing component definition");var C=U.name;if(!C)throw new Error("Component definition must have a name property.");if("string"!==typeof C)throw new Error("Component name must be a string.");if(""===C)throw new Error("Component name must be a non-empty string.");if(X[C])throw new Error("Component ".concat(C," already exists."));var E={};return E.name=C,E.multi=!!U.multi,E.order=isNaN(U.order)?99:U.order,E.stateConstructor=U.stateConstructor||null,E.state=U.state||{},E.PK=U.PK||null,E.XC=U.XC||null,E.system=U.system||null,E.IK=U.IK||null,G[C]=E,X[C]=new L,X[C]._pendingMultiCleanup=!1,X[C]._multiCleanupIDs=E.multi?[]:null,E.system&&(l.push(C),l.sort(((U,C)=>G[U].order-G[C].order))),E.IK&&(t.push(C),t.sort(((U,C)=>G[U].order-G[C].order))),C},this.overwriteComponent=function(U,C){var L=G[U];if(!L)throw new Error("Unknown component: ".concat(U));if(!C)throw new Error("Missing component definition");if(L.name!==C.name)throw new Error("Overwriting component must use the same name property.");var E={};E.name=U,E.multi=!!C.multi,E.order=isNaN(C.order)?99:C.order,E.state=C.state||{},E.PK=C.PK||null,E.XC=C.XC||null,E.system=C.system||null,E.IK=C.IK||null,G[U]=E,X[U]._pendingMultiCleanup=!1,X[U]._multiCleanupIDs=E.multi?[]:null;var K=l.indexOf(U);E.system&&K<0&&l.push(U),!E.system&&K>=0&&l.splice(K,1),l.sort(((U,C)=>G[U].order-G[C].order));var P=t.indexOf(U);E.IK&&P<0&&t.push(U),!E.IK&&P>=0&&t.splice(P,1),t.sort(((U,C)=>G[U].order-G[C].order));var O=E.state;return this.PO(U).forEach((U=>{for(var G in O)G in U||(U[G]=O[G]);E.PK&&E.PK(U.VK,U)})),U},this.deleteComponent=function(C){var L=X[C];if(!L)throw new Error("Unknown component: ".concat(C));L.flush(),L.list.forEach((U=>{U&&K(U.VK||U[0].VK,C)}));var E=l.indexOf(C),P=t.indexOf(C);return E>-1&&l.splice(E,1),P>-1&&t.splice(P,1),X[C].dispose(),delete X[C],delete G[C],U},this.TP=function(U,C,L){var l,t=G[C],E=X[C];if(!E)throw new Error("Unknown component: ".concat(C,"."));if(E.hash[U]&&!t.multi)throw new Error("Entity ".concat(U," already has component: ").concat(C,"."));if(t.stateConstructor){if(!(l=new t.stateConstructor).hasOwnProperty("VK"))throw new Error("Component ".concat(t.name," stateConstructor type does not have property __id"))}else l=Object.assign({},{VK:U},t.state,L);if(l.VK=U,t.multi){var K=E.hash[U];K||(K=[],E.add(U,K)),K.push(l)}else E.add(U,l);return t.PK&&t.PK(U,l),this},this.oP=function(U,G){var C=X[G];if(!C)throw new Error("Unknown component: ".concat(G,"."));return!!C.hash[U]},this.pP=function(G,C){if(!X[C])throw new Error("Unknown component: ".concat(C,"."));return K(G,C),U},this.getState=function(U,G){var C=X[G];if(!C)throw new Error("Unknown component: ".concat(G,"."));return C.hash[U]},this.PO=function(U){var G=X[U];if(!G)throw new Error("Unknown component: ".concat(U,"."));return T(),G.list},this.Zy=function(U){if(!X[U])throw new Error("Unknown component: ".concat(U,"."));var G=X[U].hash;return U=>G[U]},this.ky=function(U){if(!X[U])throw new Error("Unknown component: ".concat(U,"."));var G=X[U].hash;return U=>!!G[U]},this.ZE=function(C){T();for(var L=0;L<l.length;L++){var t=l[L],E=G[t],K=X[t];E.system(C,K.list),T()}return U},this.render=function(C){T();for(var L=0;L<t.length;L++){var l=t[L],E=G[l],K=X[l];E.IK(C,K.list),T()}return U},this.removeMultiComponent=function(C,L,l){var t=G[L],K=X[L];if(!K)throw new Error("Unknown component: ".concat(L,"."));if(!t.multi)throw new Error("removeMultiComponent called on non-multi component");return function(U,G,C,L){var X=C.hash[U];if(X){var l=X[L];l&&(X[L]=null,G.XC&&G.XC(U,l),E.multiComps.push({entID:U,data:C}),P())}}(C,t,K,l),U}};var L=C(14294)},14294:U=>{function G(U,G){var C=U._map[G];if(delete U.hash[G],delete U._map[G],C===U.list.length-1)U.list.pop();else{var L=U.list.pop();if(U.list[C]=L,null===L||null===L[0]){var X=U.list.length;for(var l in U._map)if(U._map[l]===X)return void(U._map[l]=C)}else{var t=L.VK||L[0].VK;U._map[t]=C}}}U.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(U,G){if("number"===typeof this._map[U]){var C=this._map[U];this.hash[U]=G,this.list[C]=G}else this._map[U]=this.list.length,this.hash[U]=G,this.list.push(G)}remove(U){var G=this._map[U];this.hash[U]=null,this.list[G]=null,this._pendingRemovals.push(U)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var U=0;U<this._pendingRemovals.length;U++){var C=this._pendingRemovals[U];null===this.hash[C]&&G(this,C)}this._pendingRemovals.length=0}}},14662:U=>{"use strict";U.exports=function(U,G,C,L,X,l){var t=+G[0],E=+G[1],K=+G[2],P=+C[0],O=+C[1],T=+C[2],D=Math.sqrt(P*P+O*O+T*T);if(0===D)throw new Error("Can't raycast along a zero vector");return function(U,G,C,L,X,l,t,E,K,P){for(var O=0,T=Math.floor,D=0|T(G),y=0|T(C),V=0|T(L),p=X>0?1:-1,I=l>0?1:-1,H=t>0?1:-1,x=Math.abs(1/X),h=Math.abs(1/l),N=Math.abs(1/t),b=x<1/0?x*(p>0?D+1-G:G-D):1/0,o=h<1/0?h*(I>0?y+1-C:C-y):1/0,w=N<1/0?N*(H>0?V+1-L:L-V):1/0,S=-1;O<=E;){var v=U(D,y,V);if(v)return K&&(K[0]=G+O*X,K[1]=C+O*l,K[2]=L+O*t),P&&(P[0]=P[1]=P[2]=0,0===S&&(P[0]=-p),1===S&&(P[1]=-I),2===S&&(P[2]=-H)),v;b<o?b<w?(D+=p,O=b,b+=x,S=0):(V+=H,O=w,w+=N,S=2):o<w?(y+=I,O=o,o+=h,S=1):(V+=H,O=w,w+=N,S=2)}return K&&(K[0]=G+O*X,K[1]=C+O*l,K[2]=L+O*t),P&&(P[0]=P[1]=P[2]=0),0}(U,t,E,K,P/=D,O/=D,T/=D,L="undefined"===typeof L?64:+L,X,l)}},14697:(U,G,C)=>{"use strict";C.d(G,{e:()=>l});var L=C(835);function X(){this.ZD=!1,this.stopPropagation=!1,this.FD=!1,this.disabled=!1}class l{constructor(U,G){this.version="0.7.0";var C=Object.assign({},new X,G||{});this.element=U||document,this.ZD=!!C.ZD,this.stopPropagation=!!C.stopPropagation,this.FD=!!C.FD,this.disabled=!!C.disabled,this.filterEvents=(U,G)=>!0,this.down=new L.EventEmitter,this.up=new L.EventEmitter,this.state={},this.XO={dx:0,dy:0,Ny:0,LO:0,by:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?E(this):document.addEventListener("DOMContentLoaded",(U=>{E(this)}),{once:!0})}bind(U){for(var G=arguments.length,C=new Array(G>1?G-1:0),L=1;L<G;L++)C[L-1]=arguments[L];C.forEach((G=>{var C=this._keyBindmap[G]||[];C.includes(U)||(C.push(U),this._keyBindmap[G]=C)})),this.state[U]=!!this.state[U],this.pressCount[U]=this.pressCount[U]||0,this.releaseCount[U]=this.releaseCount[U]||0}unbind(U){for(var G in this._keyBindmap){var C=this._keyBindmap[G],L=C.indexOf(U);L>-1&&C.splice(L,1)}}getBindings(){var U={};for(var G in this._keyBindmap){this._keyBindmap[G].forEach((C=>{U[C]=U[C]||[],U[C].push(G)}))}return U}ZE(){t(this.XO),t(this.pressCount),t(this.releaseCount)}}function t(U){for(var G in U)U[G]=0}function E(U){window.addEventListener("keydown",V.bind(null,U,!0),!1),window.addEventListener("keyup",V.bind(null,U,!1),!1);var G={passive:!0};U.element.addEventListener("touchstart",T.bind(void 0,U),{passive:!1}),U.element.addEventListener("touchend",y.bind(void 0,U),G),U.element.addEventListener("mousedown",p.bind(null,U,!0),G),window.document.addEventListener("mouseup",p.bind(null,U,!1),G),U.element.addEventListener("touchmove",I.bind(null,U),G),U.element.addEventListener("mousemove",I.bind(null,U),G),window.PointerEvent,U.element.addEventListener("wheel",H.bind(null,U),G),U.element.addEventListener("contextmenu",x.bind(null,U),!1),window.addEventListener("blur",h.bind(null,U),!1)}var K=0,P=0,O=null;function T(U,G){G.preventDefault(),D(G)}function D(U){let G=!1;for(let C=0;C<U.touches.length;++C)if(U.touches[C].identifier===O){G=!0;break}if(!G){const G=U.changedTouches[0];K=G.clientX,P=G.clientY,O=G.identifier}}function y(U,G){for(var C=G.changedTouches,L=0;L<C.length;++L)C[L].identifier===O&&(O=null)}function V(U,G,C){N(C.code,G,U,C)}function p(U,G,C){if("pointerId"in C)if(G){if(null!==U._touches.currID)return;U._touches.currID=C.pointerId}else{if(U._touches.currID!==C.pointerId)return;U._touches.currID=null}return N("Mouse"+("button"in C?C.button+1:1),G,U,C),!1}function I(U,G){var C=G.movementX||G.mozMovementX||0,L=G.movementY||G.mozMovementY||0;if(G.touches&&0===(C|L)){var X=function(U){D(U);for(let G=0;G<U.changedTouches.length;++G)if(U.changedTouches[G].identifier==O){const C=U.changedTouches[G],L=[C.clientX-K,C.clientY-P];return K=C.clientX,P=C.clientY,L}return console.error("Did not find touch id ".concat(O)),[0,0]}(G);C=X[0],L=X[1]}U.XO.dx+=C,U.XO.dy+=L}function H(U,G){var C=1;switch(G.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=U.element.clientHeight||window.innerHeight}U.XO.Ny+=(G.deltaX||0)*C,U.XO.LO+=(G.deltaY||0)*C,U.XO.by+=(G.deltaZ||0)*C}function x(U,G){if(!U.FD)return G.preventDefault(),!1}function h(U){for(var G in U._keyStates)U._keyStates[G]&&(/^Mouse\d/.test(G)||N(G,!1,U,{code:G,note:"0pmd26kjmfar",preventDefault:()=>{},stopPropagation:()=>{}}))}function N(U,G,C,L){var X=C._keyBindmap[U];X&&(b(C._keyStates[U],G)&&(C._keyStates[U]=G,X.forEach((U=>{(!C.filterEvents||C.filterEvents(L,U))&&function(U,G,C,L){var X=G?C.pressCount:C.releaseCount;X[U]=(X[U]||0)+1;var l=C._bindPressCount[U]||0;(l+=G?1:-1)<0&&(l=0);C._bindPressCount[U]=l;var t=C.state[U];if(b(t,l)){C.state[U]=l>0;var E=G?C.down:C.up;C.disabled||E.emit(U,L)}}(U,G,C,L)}))),"button"in L||(C.ZD&&!L.defaultPrevented&&L.preventDefault(),C.stopPropagation&&L.stopPropagation()))}function b(U,G){return U?!G:G}},14275:U=>{"use strict";U.exports=function(U){for(var G=new Array(U),C=0;C<U;++C)G[C]=C;return G}},14279:U=>{function G(U){return!!U.constructor&&"function"===typeof U.constructor.isBuffer&&U.constructor.isBuffer(U)}U.exports=function(U){return null!=U&&(G(U)||function(U){return"function"===typeof U.readFloatLE&&"function"===typeof U.slice&&G(U.slice(0,0))}(U)||!!U._isBuffer)}},14668:(U,G,C)=>{"use strict";C.d(G,{e:()=>L});class L{constructor(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.OT=!1,this.TT=!1,this.KT=30,this.PT=0,this.hT=!1,this.fullscreen=!1,this.yT=function(U){},this.VT=function(){},this.HT=function(){},this.XL=function(){},this.pT=function(U){},this.onFullscreenChanged=function(U){},P((()=>{!function(U,G){U._nowObject=performance||Date,U._lastTick=0,U._renderAccum=0,U._rt=0,U._frameCB=E.bind(null,U),requestAnimationFrame(U._frameCB),G>0&&(U._intervalCB=t.bind(null,U),U._interval=setInterval(U._intervalCB,Math.max(G,1e3/U.KT/2)))}(this,G),function(U,G){if(!G)return;var C=!1,L=!1;document.addEventListener("pointerlockchange",(L=>{C=document.pointerLockElement===G,U.pT(C)})),document.addEventListener("fullscreenchange",(C=>{L=document.fullscreenElement===G,U.onFullscreenChanged(L)})),Object.defineProperty(U,"hT",{get:()=>C,set:U=>{U&&!C?K(G):C&&!U&&function(U){U.exitPointerLock&&U.exitPointerLock()}(document)}}),Object.defineProperty(U,"fullscreen",{get:()=>L,set:U=>{U&&!L?G.requestFullscreen():L&&!U&&document.exitFullscreen()}}),G.addEventListener("click",(X=>{U.OT&&!C&&K(G),U.TT&&!L&&G.requestFullscreen()}));var X=()=>U.XL();if(window.ResizeObserver){new ResizeObserver(X).observe(G)}else window.addEventListener("resize",X)}(this,U),this.HT()}))}}var X=3,l=20;function t(U){for(var G=1e3/U.KT,C=U._nowObject.now()+l,L=0;U._nowObject.now()>=U._lastTick+G&&U._nowObject.now()<C&&++L<=X;)U.yT(G),U._lastTick+=G;var t=5*(G+5),E=U._nowObject.now();if(E-U._lastTick>t)for(;E>=U._lastTick+G;)U._lastTick+=G}function E(U){requestAnimationFrame(U._frameCB),t(U);var G=U._nowObject.now(),C=G-U._rt;if(U._rt=G,U.PT>0){U._renderAccum+=C;var L=1e3/U.PT;if(U._renderAccum<L)return;U._renderAccum=Math.min(U._renderAccum-L,L)}var X=1e3/U.KT,l=(G-U._lastTick)/X;U.VT(C,l,X)}function K(U){U.requestPointerLock&&U.requestPointerLock()}var P=U=>{if("loading"===document.readyState){var G=()=>{document.removeEventListener("readystatechange",G),U()};document.addEventListener("readystatechange",G)}else setTimeout(U,1)}},14269:(U,G,C)=>{var L=C(14275),X=C(14279),l="undefined"!==typeof Float64Array;function t(U,G){return U[0]-G[0]}function E(){var U,G=this.stride,C=new Array(G.length);for(U=0;U<C.length;++U)C[U]=[Math.abs(G[U]),U];C.sort(t);var L=new Array(C.length);for(U=0;U<L.length;++U)L[U]=C[U][1];return L}function K(U,G){var C=["View",G,"d",U].join("");G<0&&(C="View_Nil"+U);var X="generic"===U;if(-1===G){var l="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+U+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(l)()}if(0===G){l="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+U+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(X?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(X?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",l)(P[U][0])}l=["'use strict'"];var t=L(G),K=t.map((function(U){return"i"+U})),O="this.offset+"+t.map((function(U){return"this.stride["+U+"]*i"+U})).join("+"),T=t.map((function(U){return"b"+U})).join(","),D=t.map((function(U){return"c"+U})).join(",");l.push("function "+C+"(a,"+T+","+D+",d){this.data=a","this.shape=["+T+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+U+"'","proto.dimension="+G),l.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+t.map((function(U){return"this.shape["+U+"]"})).join("*"),"}})"),1===G?l.push("proto.order=[0]"):(l.push("Object.defineProperty(proto,'order',{get:"),G<4?(l.push("function "+C+"_order(){"),2===G?l.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===G&&l.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):l.push("ORDER})")),l.push("proto.set=function "+C+"_set("+K.join(",")+",v){"),X?l.push("return this.data.set("+O+",v)}"):l.push("return this.data["+O+"]=v}"),l.push("proto.get=function "+C+"_get("+K.join(",")+"){"),X?l.push("return this.data.get("+O+")}"):l.push("return this.data["+O+"]}"),l.push("proto.index=function "+C+"_index(",K.join(),"){return "+O+"}"),l.push("proto.hi=function "+C+"_hi("+K.join(",")+"){return new "+C+"(this.data,"+t.map((function(U){return["(typeof i",U,"!=='number'||i",U,"<0)?this.shape[",U,"]:i",U,"|0"].join("")})).join(",")+","+t.map((function(U){return"this.stride["+U+"]"})).join(",")+",this.offset)}");var y=t.map((function(U){return"a"+U+"=this.shape["+U+"]"})),V=t.map((function(U){return"c"+U+"=this.stride["+U+"]"}));l.push("proto.lo=function "+C+"_lo("+K.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+V.join(","));for(var p=0;p<G;++p)l.push("if(typeof i"+p+"==='number'&&i"+p+">=0){d=i"+p+"|0;b+=c"+p+"*d;a"+p+"-=d}");l.push("return new "+C+"(this.data,"+t.map((function(U){return"a"+U})).join(",")+","+t.map((function(U){return"c"+U})).join(",")+",b)}"),l.push("proto.step=function "+C+"_step("+K.join(",")+"){var "+t.map((function(U){return"a"+U+"=this.shape["+U+"]"})).join(",")+","+t.map((function(U){return"b"+U+"=this.stride["+U+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(p=0;p<G;++p)l.push("if(typeof i"+p+"==='number'){d=i"+p+"|0;if(d<0){c+=b"+p+"*(a"+p+"-1);a"+p+"=ceil(-a"+p+"/d)}else{a"+p+"=ceil(a"+p+"/d)}b"+p+"*=d}");l.push("return new "+C+"(this.data,"+t.map((function(U){return"a"+U})).join(",")+","+t.map((function(U){return"b"+U})).join(",")+",c)}");var I=new Array(G),H=new Array(G);for(p=0;p<G;++p)I[p]="a[i"+p+"]",H[p]="b[i"+p+"]";l.push("proto.transpose=function "+C+"_transpose("+K+"){"+K.map((function(U,G){return U+"=("+U+"===undefined?"+G+":"+U+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+I.join(",")+","+H.join(",")+",this.offset)}"),l.push("proto.pick=function "+C+"_pick("+K+"){var a=[],b=[],c=this.offset");for(p=0;p<G;++p)l.push("if(typeof i"+p+"==='number'&&i"+p+">=0){c=(c+this.stride["+p+"]*i"+p+")|0}else{a.push(this.shape["+p+"]);b.push(this.stride["+p+"])}");return l.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),l.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+t.map((function(U){return"shape["+U+"]"})).join(",")+","+t.map((function(U){return"stride["+U+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",l.join("\n"))(P[U],E)}var P={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};U.exports=function(U,G,C,L){if(void 0===U)return(0,P.array[0])([]);"number"===typeof U&&(U=[U]),void 0===G&&(G=[U.length]);var t=G.length;if(void 0===C){C=new Array(t);for(var E=t-1,O=1;E>=0;--E)C[E]=O,O*=G[E]}if(void 0===L){L=0;for(E=0;E<t;++E)C[E]<0&&(L-=(G[E]-1)*C[E])}for(var T=function(U){if(X(U))return"buffer";if(l)switch(Object.prototype.toString.call(U)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(U)?"array":"generic"}(U),D=P[T];D.length<=t+1;)D.push(K(T,D.length-1));return(0,D[t+1])(U,G,C,L)}},14415:U=>{var G;self,G=()=>(()=>{"use strict";var U={d:(G,C)=>{for(var L in C)U.o(C,L)&&!U.o(G,L)&&Object.defineProperty(G,L,{enumerable:!0,get:C[L]})},o:(U,G)=>Object.prototype.hasOwnProperty.call(U,G)},G={};U.d(G,{default:()=>a});var C,L=function(U,G){var C=G.x-U.x,L=G.y-U.y;return Math.sqrt(C*C+L*L)},X=function(U){return U*(Math.PI/180)},l=new Map,t=function(U){l.has(U)&&clearTimeout(l.get(U)),l.set(U,setTimeout(U,100))},E=function(U,G,C){for(var L,X=G.split(/[ ,]+/g),l=0;l<X.length;l+=1)L=X[l],U.addEventListener?U.addEventListener(L,C,!1):U.attachEvent&&U.attachEvent(L,C)},K=function(U,G,C){for(var L,X=G.split(/[ ,]+/g),l=0;l<X.length;l+=1)L=X[l],U.removeEventListener?U.removeEventListener(L,C):U.detachEvent&&U.detachEvent(L,C)},P=function(U){return U.preventDefault(),U.type.match(/^touch/)?U.changedTouches:U},O=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},T=function(U,G){G.top||G.right||G.bottom||G.left?(U.style.top=G.top,U.style.right=G.right,U.style.bottom=G.bottom,U.style.left=G.left):(U.style.left=G.x+"px",U.style.top=G.y+"px")},D=function(U,G,C){var L=y(U);for(var X in L)if(L.hasOwnProperty(X))if("string"==typeof G)L[X]=G+" "+C;else{for(var l="",t=0,E=G.length;t<E;t+=1)l+=G[t]+" "+C+", ";L[X]=l.slice(0,-2)}return L},y=function(U){var G={};return G[U]="",["webkit","Moz","o"].forEach((function(C){G[C+U.charAt(0).toUpperCase()+U.slice(1)]=""})),G},V=function(U,G){for(var C in G)G.hasOwnProperty(C)&&(U[C]=G[C]);return U},p=function(U,G){if(U.length)for(var C=0,L=U.length;C<L;C+=1)G(U[C]);else G(U)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,H=window.matchMedia("(any-hover: none)").matches,x=!!("ontouchstart"in window),h=!!window.PointerEvent,N=!!window.MSPointerEvent,b={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},o={start:"mousedown",move:"mousemove",end:"mouseup"},w={};function S(){}I&&!H?C=b:h?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:N?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:x?(C=b,w=o):C=o,S.prototype.on=function(U,G){var C,L=this,X=U.split(/[ ,]+/g);L._handlers_=L._handlers_||{};for(var l=0;l<X.length;l+=1)C=X[l],L._handlers_[C]=L._handlers_[C]||[],L._handlers_[C].push(G);return L},S.prototype.off=function(U,G){var C=this;return C._handlers_=C._handlers_||{},void 0===U?C._handlers_={}:void 0===G?C._handlers_[U]=null:C._handlers_[U]&&C._handlers_[U].indexOf(G)>=0&&C._handlers_[U].splice(C._handlers_[U].indexOf(G),1),C},S.prototype.trigger=function(U,G){var C,L=this,X=U.split(/[ ,]+/g);L._handlers_=L._handlers_||{};for(var l=0;l<X.length;l+=1)C=X[l],L._handlers_[C]&&L._handlers_[C].length&&L._handlers_[C].forEach((function(U){U.call(L,{type:C,target:L},G)}))},S.prototype.config=function(U){var G=this;G.options=G.defaults||{},U&&(G.options=function(U,G){var C={};for(var L in U)U.hasOwnProperty(L)&&G.hasOwnProperty(L)?C[L]=G[L]:U.hasOwnProperty(L)&&(C[L]=U[L]);return C}(G.options,U))},S.prototype.bindEvt=function(U,G){var L=this;return L._domHandlers_=L._domHandlers_||{},L._domHandlers_[G]=function(){"function"==typeof L["on"+G]?L["on"+G].apply(L,arguments):console.warn('[WARNING] : Missing "on'+G+'" handler.')},E(U,C[G],L._domHandlers_[G]),w[G]&&E(U,w[G],L._domHandlers_[G]),L},S.prototype.unbindEvt=function(U,G){var L=this;return L._domHandlers_=L._domHandlers_||{},K(U,C[G],L._domHandlers_[G]),w[G]&&K(U,w[G],L._domHandlers_[G]),delete L._domHandlers_[G],this};const v=S;function u(U,G){return this.identifier=G.identifier,this.position=G.position,this.frontPosition=G.frontPosition,this.collection=U,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(G),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=u.id,u.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}u.prototype=new v,u.constructor=u,u.id=0,u.prototype.buildEl=function(U){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},u.prototype.stylize=function(){if(this.options.dataOnly)return this;var U=this.options.fadeTime+"ms",G=function(){var U=y("borderRadius");for(var G in U)U.hasOwnProperty(G)&&(U[G]="50%");return U}(),C=D("transition","opacity",U),L={};return L.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},L.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},L.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},V(L.el,C),"circle"===this.options.shape&&V(L.back,G),V(L.front,G),this.applyStyles(L),this},u.prototype.applyStyles=function(U){for(var G in this.ui)if(this.ui.hasOwnProperty(G))for(var C in U[G])this.ui[G].style[C]=U[G][C];return this},u.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},u.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},u.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},u.prototype.show=function(U){var G=this;return G.options.dataOnly||(clearTimeout(G.removeTimeout),clearTimeout(G.showTimeout),clearTimeout(G.restTimeout),G.addToDom(),G.restCallback(),setTimeout((function(){G.ui.el.style.opacity=1}),0),G.showTimeout=setTimeout((function(){G.trigger("shown",G.instance),"function"==typeof U&&U.call(this)}),G.options.fadeTime)),G},u.prototype.hide=function(U){var G=this;if(G.options.dataOnly)return G;if(G.ui.el.style.opacity=G.options.restOpacity,clearTimeout(G.removeTimeout),clearTimeout(G.showTimeout),clearTimeout(G.restTimeout),G.removeTimeout=setTimeout((function(){var C="dynamic"===G.options.mode?"none":"block";G.ui.el.style.display=C,"function"==typeof U&&U.call(G),G.trigger("hidden",G.instance)}),G.options.fadeTime),G.options.restJoystick){var C=G.options.restJoystick,L={};L.x=!0===C||!1!==C.x?0:G.instance.frontPosition.x,L.y=!0===C||!1!==C.y?0:G.instance.frontPosition.y,G.setPosition(U,L)}return G},u.prototype.setPosition=function(U,G){var C=this;C.frontPosition={x:G.x,y:G.y};var L=C.options.fadeTime+"ms",X={};X.front=D("transition",["transform"],L);var l={front:{}};l.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(X),C.applyStyles(l),C.restTimeout=setTimeout((function(){"function"==typeof U&&U.call(C),C.restCallback()}),C.options.fadeTime)},u.prototype.restCallback=function(){var U=this,G={};G.front=D("transition","none",""),U.applyStyles(G),U.trigger("rested",U.instance)},u.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},u.prototype.computeDirection=function(U){var G,C,L,X=U.angle.radian,l=Math.PI/4,t=Math.PI/2;if(X>l&&X<3*l&&!U.lockX?G="up":X>-l&&X<=l&&!U.lockY?G="left":X>3*-l&&X<=-l&&!U.lockX?G="down":U.lockY||(G="right"),U.lockY||(C=X>-t&&X<t?"left":"right"),U.lockX||(L=X>0?"up":"down"),U.force>this.options.threshold){var E,K={};for(E in this.direction)this.direction.hasOwnProperty(E)&&(K[E]=this.direction[E]);var P={};for(E in this.direction={x:C,y:L,angle:G},U.direction=this.direction,K)K[E]===this.direction[E]&&(P[E]=!0);if(P.x&&P.y&&P.angle)return U;P.x&&P.y||this.trigger("plain",U),P.x||this.trigger("plain:"+C,U),P.y||this.trigger("plain:"+L,U),P.angle||this.trigger("dir dir:"+G,U)}else this.resetDirection();return U};const d=u;function g(U,G){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=U,C.id=g.id,g.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(G),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var L=getComputedStyle(C.options.zone.parentElement);return L&&"flex"===L.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.qD(),C.begin(),C.nipples}g.prototype=new v,g.constructor=g,g.id=0,g.prototype.prepareNipples=function(){var U=this,G=U.nipples;G.on=U.on.bind(U),G.off=U.off.bind(U),G.options=U.options,G.destroy=U.destroy.bind(U),G.ids=U.ids,G.id=U.id,G.processOnMove=U.processOnMove.bind(U),G.processOnEnd=U.processOnEnd.bind(U),G.get=function(U){if(void 0===U)return G[0];for(var C=0,L=G.length;C<L;C+=1)if(G[C].identifier===U)return G[C];return!1}},g.prototype.qD=function(){var U=this;U.bindEvt(U.options.zone,"start"),U.options.zone.style.touchAction="none",U.options.zone.style.msTouchAction="none"},g.prototype.begin=function(){var U=this,G=U.options;if("static"===G.mode){var C=U.createNipple(G.position,U.manager.getIdentifier());C.add(),U.idles.push(C)}},g.prototype.createNipple=function(U,G){var C=this,L=C.manager.scroll,X={},l=C.options,t=C.parentIsFlex?L.x:L.x+C.box.left,E=C.parentIsFlex?L.y:L.y+C.box.top;if(U.x&&U.y)X={x:U.x-t,y:U.y-E};else if(U.top||U.right||U.bottom||U.left){var K=document.createElement("DIV");K.style.display="hidden",K.style.top=U.top,K.style.right=U.right,K.style.bottom=U.bottom,K.style.left=U.left,K.style.position="absolute",l.zone.appendChild(K);var P=K.getBoundingClientRect();l.zone.removeChild(K),X=U,U={x:P.left+L.x,y:P.top+L.y}}var O=new d(C,{color:l.color,size:l.size,threshold:l.threshold,fadeTime:l.fadeTime,dataOnly:l.dataOnly,restJoystick:l.restJoystick,restOpacity:l.restOpacity,mode:l.mode,identifier:G,position:U,zone:l.zone,frontPosition:{x:0,y:0},shape:l.shape});return l.dataOnly||(T(O.ui.el,X),T(O.ui.front,O.frontPosition)),C.nipples.push(O),C.trigger("added "+O.identifier+":added",O),C.manager.trigger("added "+O.identifier+":added",O),C.bindNipple(O),O},g.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},g.prototype.bindNipple=function(U){var G,C=this,L=function(U,L){G=U.type+" "+L.id+":"+U.type,C.trigger(G,L)};U.on("destroyed",C.onDestroyed.bind(C)),U.on("shown hidden rested dir plain",L),U.on("dir:up dir:right dir:down dir:left",L),U.on("plain:up plain:right plain:down plain:left",L)},g.prototype.pressureFn=function(U,G,C){var L=this,X=0;clearInterval(L.pressureIntervals[C]),L.pressureIntervals[C]=setInterval(function(){var C=U.force||U.pressure||U.webkitForce||0;C!==X&&(G.trigger("pressure",C),L.trigger("pressure "+G.identifier+":pressure",C),X=C)}.bind(L),100)},g.prototype.onstart=function(U){var G=this,C=G.options,L=U;return U=P(U),G.updateBox(),p(U,(function(X){G.actives.length<C.maxNumberOfNipples?G.processOnStart(X):L.type.match(/^touch/)&&(Object.keys(G.manager.ids).forEach((function(C){if(Object.values(L.touches).findIndex((function(U){return U.identifier===C}))<0){var X=[U[0]];X.identifier=C,G.processOnEnd(X)}})),G.actives.length<C.maxNumberOfNipples&&G.processOnStart(X))})),G.manager.bindDocument(),!1},g.prototype.processOnStart=function(U){var G,C=this,X=C.options,l=C.manager.getIdentifier(U),t=U.force||U.pressure||U.webkitForce||0,E={x:U.pageX,y:U.pageY},K=C.getOrCreate(l,E);K.identifier!==l&&C.manager.removeIdentifier(K.identifier),K.identifier=l;var P=function(G){G.trigger("start",G),C.trigger("start "+G.id+":start",G),G.show(),t>0&&C.pressureFn(U,G,G.identifier),C.processOnMove(U)};if((G=C.idles.indexOf(K))>=0&&C.idles.splice(G,1),C.actives.push(K),C.ids.push(K.identifier),"semi"!==X.mode)P(K);else{if(!(L(E,K.position)<=X.catchDistance))return K.destroy(),void C.processOnStart(U);P(K)}return K},g.prototype.getOrCreate=function(U,G){var C,L=this,X=L.options;return/(semi|static)/.test(X.mode)?(C=L.idles[0])?(L.idles.splice(0,1),C):"semi"===X.mode?L.createNipple(G,U):(console.warn("Coudln't find the needed nipple."),!1):C=L.createNipple(G,U)},g.prototype.processOnMove=function(U){var G=this,C=G.options,l=G.manager.getIdentifier(U),t=G.nipples.get(l),E=G.manager.scroll;if(function(U){return isNaN(U.buttons)?0!==U.pressure:0!==U.buttons}(U)){if(!t)return console.error("Found zombie joystick with ID "+l),void G.manager.removeIdentifier(l);if(C.dynamicPage){var K=t.el.getBoundingClientRect();t.position={x:E.x+K.left,y:E.y+K.top}}t.identifier=l;var P=t.options.size/2,O={x:U.pageX,y:U.pageY};C.lockX&&(O.y=t.position.y),C.lockY&&(O.x=t.position.x);var T,D,y,V,p,I,H,x,h,N,b=L(O,t.position),o=(T=O,y=(D=t.position).x-T.x,V=D.y-T.y,function(U){return U*(180/Math.PI)}(Math.atan2(V,y))),w=X(o),S=b/P,v={distance:b,position:O};if("circle"===t.options.shape?(p=Math.min(b,P),H=t.position,x=p,N={x:0,y:0},h=X(h=o),N.x=H.x-x*Math.cos(h),N.y=H.y-x*Math.sin(h),I=N):(I=function(U,G,C){return{x:Math.min(Math.max(U.x,G.x-C),G.x+C),y:Math.min(Math.max(U.y,G.y-C),G.y+C)}}(O,t.position,P),p=L(I,t.position)),C.follow){if(b>P){var u=O.x-I.x,d=O.y-I.y;t.position.x+=u,t.position.y+=d,t.el.style.top=t.position.y-(G.box.top+E.y)+"px",t.el.style.left=t.position.x-(G.box.left+E.x)+"px",b=L(O,t.position)}}else O=I,b=p;var g=O.x-t.position.x,Z=O.y-t.position.y;t.frontPosition={x:g,y:Z},C.dataOnly||(t.ui.front.style.transform="translate("+g+"px,"+Z+"px)");var F={identifier:t.identifier,position:O,force:S,pressure:U.force||U.pressure||U.webkitForce||0,distance:b,angle:{radian:w,degree:o},vector:{x:g/P,y:-Z/P},raw:v,instance:t,lockX:C.lockX,lockY:C.lockY};(F=t.computeDirection(F)).angle={radian:X(180-o),degree:180-o},t.trigger("move",F),G.trigger("move "+t.id+":move",F)}else this.processOnEnd(U)},g.prototype.processOnEnd=function(U){var G=this,C=G.options,L=G.manager.getIdentifier(U),X=G.nipples.get(L),l=G.manager.removeIdentifier(X.identifier);X&&(C.dataOnly||X.hide((function(){"dynamic"===C.mode&&(X.trigger("removed",X),G.trigger("removed "+X.id+":removed",X),G.manager.trigger("removed "+X.id+":removed",X),X.destroy())})),clearInterval(G.pressureIntervals[X.identifier]),X.resetDirection(),X.trigger("end",X),G.trigger("end "+X.id+":end",X),G.ids.indexOf(X.identifier)>=0&&G.ids.splice(G.ids.indexOf(X.identifier),1),G.actives.indexOf(X)>=0&&G.actives.splice(G.actives.indexOf(X),1),/(semi|static)/.test(C.mode)?G.idles.push(X):G.nipples.indexOf(X)>=0&&G.nipples.splice(G.nipples.indexOf(X),1),G.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(G.manager.ids[l.id]=l.identifier))},g.prototype.onDestroyed=function(U,G){var C=this;C.nipples.indexOf(G)>=0&&C.nipples.splice(C.nipples.indexOf(G),1),C.actives.indexOf(G)>=0&&C.actives.splice(C.actives.indexOf(G),1),C.idles.indexOf(G)>=0&&C.idles.splice(C.idles.indexOf(G),1),C.ids.indexOf(G.identifier)>=0&&C.ids.splice(C.ids.indexOf(G.identifier),1),C.manager.removeIdentifier(G.identifier),C.manager.unbindDocument()},g.prototype.destroy=function(){var U=this;for(var G in U.unbindEvt(U.options.zone,"start"),U.nipples.forEach((function(U){U.destroy()})),U.pressureIntervals)U.pressureIntervals.hasOwnProperty(G)&&clearInterval(U.pressureIntervals[G]);U.trigger("destroyed",U.nipples),U.manager.unbindDocument(),U.off()};const Z=g;function F(U){var G=this;G.ids={},G.index=0,G.collections=[],G.scroll=O(),G.config(U),G.prepareCollections();var C=function(){var U;G.collections.forEach((function(C){C.forEach((function(C){U=C.el.getBoundingClientRect(),C.position={x:G.scroll.x+U.left,y:G.scroll.y+U.top}}))}))};E(window,"resize",(function(){t(C)}));var L=function(){G.scroll=O()};return E(window,"scroll",(function(){t(L)})),G.collections}F.prototype=new v,F.constructor=F,F.prototype.prepareCollections=function(){var U=this;U.collections.create=U.create.bind(U),U.collections.on=U.on.bind(U),U.collections.off=U.off.bind(U),U.collections.destroy=U.destroy.bind(U),U.collections.get=function(G){var C;return U.collections.every((function(U){return!(C=U.get(G))})),C}},F.prototype.create=function(U){return this.createCollection(U)},F.prototype.createCollection=function(U){var G=this,C=new Z(G,U);return G.bindCollection(C),G.collections.push(C),C},F.prototype.bindCollection=function(U){var G,C=this,L=function(U,L){G=U.type+" "+L.id+":"+U.type,C.trigger(G,L)};U.on("destroyed",C.onDestroyed.bind(C)),U.on("shown hidden rested dir plain",L),U.on("dir:up dir:right dir:down dir:left",L),U.on("plain:up plain:right plain:down plain:left",L)},F.prototype.bindDocument=function(){var U=this;U.binded||(U.bindEvt(document,"move").bindEvt(document,"end"),U.binded=!0)},F.prototype.unbindDocument=function(U){var G=this;Object.keys(G.ids).length&&!0!==U||(G.unbindEvt(document,"move").unbindEvt(document,"end"),G.binded=!1)},F.prototype.getIdentifier=function(U){var G;return U?void 0===(G=void 0===U.identifier?U.pointerId:U.identifier)&&(G=this.latest||0):G=this.index,void 0===this.ids[G]&&(this.ids[G]=this.index,this.index+=1),this.latest=G,this.ids[G]},F.prototype.removeIdentifier=function(U){var G={};for(var C in this.ids)if(this.ids[C]===U){G.id=C,G.identifier=this.ids[C],delete this.ids[C];break}return G},F.prototype.onmove=function(U){return this.onAny("move",U),!1},F.prototype.onend=function(U){return this.onAny("end",U),!1},F.prototype.oncancel=function(U){return this.onAny("end",U),!1},F.prototype.onAny=function(U,G){var C,L=this,X="processOn"+U.charAt(0).toUpperCase()+U.slice(1);G=P(G);var l=function(U,G,C){C.ids.indexOf(G)>=0&&(C[X](U),U._found_=!0)};return p(G,(function(U){C=L.getIdentifier(U),p(L.collections,l.bind(null,U,C)),U._found_||L.removeIdentifier(C)})),!1},F.prototype.destroy=function(){var U=this;U.unbindDocument(!0),U.ids={},U.index=0,U.collections.forEach((function(U){U.destroy()})),U.off()},F.prototype.onDestroyed=function(U,G){var C=this;if(C.collections.indexOf(G)<0)return!1;C.collections.splice(C.collections.indexOf(G),1)};var q=new F;const a={create:function(U){return q.create(U)},factory:q};return G.default})(),U.exports=G()},14454:(U,G,C)=>{"use strict";const{Deflate:L,deflate:X,deflateRaw:l,gzip:t}=C(14458),{Inflate:E,inflate:K,inflateRaw:P,ungzip:O}=C(14527),T=C(14500);U.exports.Deflate=L,U.exports.deflate=X,U.exports.deflateRaw=l,U.exports.gzip=t,U.exports.Inflate=E,U.exports.inflate=K,U.exports.inflateRaw=P,U.exports.ungzip=O,U.exports.constants=T},14458:(U,G,C)=>{"use strict";const L=C(14462),X=C(14504),l=C(14511),t=C(14494),E=C(14518),K=Object.prototype.toString,{Z_NO_FLUSH:P,Z_SYNC_FLUSH:O,Z_FULL_FLUSH:T,Z_FINISH:D,Z_OK:y,Z_STREAM_END:V,Z_DEFAULT_COMPRESSION:p,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:H}=C(14500);function x(U){this.options=X.assign({level:p,method:H,BU:16384,windowBits:15,memLevel:8,strategy:I},U||{});let G=this.options;G.raw&&G.windowBits>0?G.windowBits=-G.windowBits:G.gzip&&G.windowBits>0&&G.windowBits<16&&(G.windowBits+=16),this.err=0,this.PG="",this.ended=!1,this.chunks=[],this.strm=new E,this.strm.avail_out=0;let C=L.deflateInit2(this.strm,G.level,G.method,G.windowBits,G.memLevel,G.strategy);if(C!==y)throw new Error(t[C]);if(G.header&&L.deflateSetHeader(this.strm,G.header),G.dictionary){let U;if(U="string"===typeof G.dictionary?l.string2buf(G.dictionary):"[object ArrayBuffer]"===K.call(G.dictionary)?new Uint8Array(G.dictionary):G.dictionary,C=L.deflateSetDictionary(this.strm,U),C!==y)throw new Error(t[C]);this._dict_set=!0}}function h(U,G){const C=new x(G);if(C.push(U,!0),C.err)throw C.PG||t[C.err];return C.result}x.prototype.push=function(U,G){const C=this.strm,X=this.options.BU;let t,E;if(this.ended)return!1;for(E=G===~~G?G:!0===G?D:P,"string"===typeof U?C.input=l.string2buf(U):"[object ArrayBuffer]"===K.call(U)?C.input=new Uint8Array(U):C.input=U,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(X),C.next_out=0,C.avail_out=X),(E===O||E===T)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(t=L.deflate(C,E),t===V)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),t=L.deflateEnd(this.strm),this.onEnd(t),this.ended=!0,t===y;if(0!==C.avail_out){if(E>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},x.prototype.onData=function(U){this.chunks.push(U)},x.prototype.onEnd=function(U){U===y&&(this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.PG=this.strm.PG},U.exports.Deflate=x,U.exports.deflate=h,U.exports.deflateRaw=function(U,G){return(G=G||{}).raw=!0,h(U,G)},U.exports.gzip=function(U,G){return(G=G||{}).gzip=!0,h(U,G)},U.exports.constants=C(14500)},14527:(U,G,C)=>{"use strict";const L=C(14535),X=C(14504),l=C(14511),t=C(14494),E=C(14518),K=C(14556),P=Object.prototype.toString,{Z_NO_FLUSH:O,Z_FINISH:T,Z_OK:D,Z_STREAM_END:y,Z_NEED_DICT:V,Z_STREAM_ERROR:p,Z_DATA_ERROR:I,Z_MEM_ERROR:H}=C(14500);function x(U){this.options=X.assign({BU:65536,windowBits:15,to:""},U||{});const G=this.options;G.raw&&G.windowBits>=0&&G.windowBits<16&&(G.windowBits=-G.windowBits,0===G.windowBits&&(G.windowBits=-15)),!(G.windowBits>=0&&G.windowBits<16)||U&&U.windowBits||(G.windowBits+=32),G.windowBits>15&&G.windowBits<48&&0===(15&G.windowBits)&&(G.windowBits|=15),this.err=0,this.PG="",this.ended=!1,this.chunks=[],this.strm=new E,this.strm.avail_out=0;let C=L.inflateInit2(this.strm,G.windowBits);if(C!==D)throw new Error(t[C]);if(this.header=new K,L.inflateGetHeader(this.strm,this.header),G.dictionary&&("string"===typeof G.dictionary?G.dictionary=l.string2buf(G.dictionary):"[object ArrayBuffer]"===P.call(G.dictionary)&&(G.dictionary=new Uint8Array(G.dictionary)),G.raw&&(C=L.inflateSetDictionary(this.strm,G.dictionary),C!==D)))throw new Error(t[C])}function h(U,G){const C=new x(G);if(C.push(U),C.err)throw C.PG||t[C.err];return C.result}x.prototype.push=function(U,G){const C=this.strm,X=this.options.BU,t=this.options.dictionary;let E,K,x;if(this.ended)return!1;for(K=G===~~G?G:!0===G?T:O,"[object ArrayBuffer]"===P.call(U)?C.input=new Uint8Array(U):C.input=U,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(X),C.next_out=0,C.avail_out=X),E=L.inflate(C,K),E===V&&t&&(E=L.inflateSetDictionary(C,t),E===D?E=L.inflate(C,K):E===I&&(E=V));C.avail_in>0&&E===y&&C.state.wrap>0&&0!==U[C.next_in];)L.inflateReset(C),E=L.inflate(C,K);switch(E){case p:case I:case V:case H:return this.onEnd(E),this.ended=!0,!1}if(x=C.avail_out,C.next_out&&(0===C.avail_out||E===y))if("string"===this.options.to){let U=l.utf8border(C.output,C.next_out),G=C.next_out-U,L=l.buf2string(C.output,U);C.next_out=G,C.avail_out=X-G,G&&C.output.set(C.output.subarray(U,U+G),0),this.onData(L)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(E!==D||0!==x){if(E===y)return E=L.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},x.prototype.onData=function(U){this.chunks.push(U)},x.prototype.onEnd=function(U){U===D&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=X.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.PG=this.strm.PG},U.exports.Inflate=x,U.exports.inflate=h,U.exports.inflateRaw=function(U,G){return(G=G||{}).raw=!0,h(U,G)},U.exports.ungzip=h,U.exports.constants=C(14500)},14504:U=>{"use strict";const G=(U,G)=>Object.prototype.hasOwnProperty.call(U,G);U.exports.assign=function(U){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const L=C.shift();if(L){if("object"!==typeof L)throw new TypeError(L+"must be non-object");for(const C in L)G(L,C)&&(U[C]=L[C])}}return U},U.exports.flattenChunks=U=>{let G=0;for(let L=0,X=U.length;L<X;L++)G+=U[L].length;const C=new Uint8Array(G);for(let L=0,X=0,l=U.length;L<l;L++){let G=U[L];C.set(G,X),X+=G.length}return C}},14511:U=>{"use strict";let G=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(L){G=!1}const C=new Uint8Array(256);for(let X=0;X<256;X++)C[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;C[254]=C[254]=1,U.exports.string2buf=U=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(U);let G,C,L,X,l,t=U.length,E=0;for(X=0;X<t;X++)C=U.charCodeAt(X),55296===(64512&C)&&X+1<t&&(L=U.charCodeAt(X+1),56320===(64512&L)&&(C=65536+(C-55296<<10)+(L-56320),X++)),E+=C<128?1:C<2048?2:C<65536?3:4;for(G=new Uint8Array(E),l=0,X=0;l<E;X++)C=U.charCodeAt(X),55296===(64512&C)&&X+1<t&&(L=U.charCodeAt(X+1),56320===(64512&L)&&(C=65536+(C-55296<<10)+(L-56320),X++)),C<128?G[l++]=C:C<2048?(G[l++]=192|C>>>6,G[l++]=128|63&C):C<65536?(G[l++]=224|C>>>12,G[l++]=128|C>>>6&63,G[l++]=128|63&C):(G[l++]=240|C>>>18,G[l++]=128|C>>>12&63,G[l++]=128|C>>>6&63,G[l++]=128|63&C);return G};U.exports.buf2string=(U,L)=>{const X=L||U.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(U.subarray(0,L));let l,t;const E=new Array(2*X);for(t=0,l=0;l<X;){let G=U[l++];if(G<128){E[t++]=G;continue}let L=C[G];if(L>4)E[t++]=65533,l+=L-1;else{for(G&=2===L?31:3===L?15:7;L>1&&l<X;)G=G<<6|63&U[l++],L--;L>1?E[t++]=65533:G<65536?E[t++]=G:(G-=65536,E[t++]=55296|G>>10&1023,E[t++]=56320|1023&G)}}return((U,C)=>{if(C<65534&&U.subarray&&G)return String.fromCharCode.apply(null,U.length===C?U:U.subarray(0,C));let L="";for(let G=0;G<C;G++)L+=String.fromCharCode(U[G]);return L})(E,t)},U.exports.utf8border=(U,G)=>{(G=G||U.length)>U.length&&(G=U.length);let L=G-1;for(;L>=0&&128===(192&U[L]);)L--;return L<0||0===L?G:L+C[U[L]]>G?L:G}},14479:U=>{"use strict";U.exports=(U,G,C,L)=>{let X=65535&U,l=U>>>16&65535,t=0;for(;0!==C;){t=C>2e3?2e3:C,C-=t;do{X=X+G[L++]|0,l=l+X|0}while(--t);X%=65521,l%=65521}return X|l<<16}},14500:U=>{"use strict";U.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14485:U=>{"use strict";const G=new Uint32Array((()=>{let U,G=[];for(var C=0;C<256;C++){U=C;for(var L=0;L<8;L++)U=1&U?3988292384^U>>>1:U>>>1;G[C]=U}return G})());U.exports=(U,C,L,X)=>{const l=G,t=X+L;U^=-1;for(let G=X;G<t;G++)U=U>>>8^l[255&(U^C[G])];return~U}},14462:(U,G,C)=>{"use strict";const{_tr_init:L,_tr_stored_block:X,_tr_flush_block:l,_tr_tally:t,_tr_align:E}=C(14471),K=C(14479),P=C(14485),O=C(14494),{Z_NO_FLUSH:T,Z_PARTIAL_FLUSH:D,Z_FULL_FLUSH:y,Z_FINISH:V,Z_BLOCK:p,Z_OK:I,Z_STREAM_END:H,Z_STREAM_ERROR:x,Z_DATA_ERROR:h,Z_BUF_ERROR:N,Z_DEFAULT_COMPRESSION:b,Z_FILTERED:o,Z_HUFFMAN_ONLY:w,Z_RLE:S,Z_FIXED:v,Z_DEFAULT_STRATEGY:u,Z_UNKNOWN:d,Z_DEFLATED:g}=C(14500),Z=258,F=262,q=103,a=113,k=666,n=(U,G)=>(U.PG=O[G],G),Q=U=>(U<<1)-(U>4?9:0),mU=U=>{let G=U.length;for(;--G>=0;)U[G]=0};let B=(U,G,C)=>(G<<U.hash_shift^C)&U.hash_mask;const M=U=>{const G=U.state;let C=G.pending;C>U.avail_out&&(C=U.avail_out),0!==C&&(U.output.set(G.pending_buf.subarray(G.pending_out,G.pending_out+C),U.next_out),U.next_out+=C,G.pending_out+=C,U.total_out+=C,U.avail_out-=C,G.pending-=C,0===G.pending&&(G.pending_out=0))},z=(U,G)=>{l(U,U.block_start>=0?U.block_start:-1,U.strstart-U.block_start,G),U.block_start=U.strstart,M(U.strm)},s=(U,G)=>{U.pending_buf[U.pending++]=G},j=(U,G)=>{U.pending_buf[U.pending++]=G>>>8&255,U.pending_buf[U.pending++]=255&G},A=(U,G,C,L)=>{let X=U.avail_in;return X>L&&(X=L),0===X?0:(U.avail_in-=X,G.set(U.input.subarray(U.next_in,U.next_in+X),C),1===U.state.wrap?U.adler=K(U.adler,G,X,C):2===U.state.wrap&&(U.adler=P(U.adler,G,X,C)),U.next_in+=X,U.total_in+=X,X)},Y=(U,G)=>{let C,L,X=U.max_chain_length,l=U.strstart,t=U.prev_length,E=U.nice_match;const K=U.strstart>U.w_size-F?U.strstart-(U.w_size-F):0,P=U.window,O=U.w_mask,T=U.prev,D=U.strstart+Z;let y=P[l+t-1],V=P[l+t];U.prev_length>=U.good_match&&(X>>=2),E>U.lookahead&&(E=U.lookahead);do{if(C=G,P[C+t]===V&&P[C+t-1]===y&&P[C]===P[l]&&P[++C]===P[l+1]){l+=2,C++;do{}while(P[++l]===P[++C]&&P[++l]===P[++C]&&P[++l]===P[++C]&&P[++l]===P[++C]&&P[++l]===P[++C]&&P[++l]===P[++C]&&P[++l]===P[++C]&&P[++l]===P[++C]&&l<D);if(L=Z-(D-l),l=D-Z,L>t){if(U.match_start=G,t=L,L>=E)break;y=P[l+t-1],V=P[l+t]}}}while((G=T[G&O])>K&&0!==--X);return t<=U.lookahead?t:U.lookahead},e=U=>{const G=U.w_size;let C,L,X,l,t;do{if(l=U.window_size-U.lookahead-U.strstart,U.strstart>=G+(G-F)){U.window.set(U.window.subarray(G,G+G),0),U.match_start-=G,U.strstart-=G,U.block_start-=G,L=U.hash_size,C=L;do{X=U.head[--C],U.head[C]=X>=G?X-G:0}while(--L);L=G,C=L;do{X=U.prev[--C],U.prev[C]=X>=G?X-G:0}while(--L);l+=G}if(0===U.strm.avail_in)break;if(L=A(U.strm,U.window,U.strstart+U.lookahead,l),U.lookahead+=L,U.lookahead+U.insert>=3)for(t=U.strstart-U.insert,U.ins_h=U.window[t],U.ins_h=B(U,U.ins_h,U.window[t+1]);U.insert&&(U.ins_h=B(U,U.ins_h,U.window[t+3-1]),U.prev[t&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=t,t++,U.insert--,!(U.lookahead+U.insert<3)););}while(U.lookahead<F&&0!==U.strm.avail_in)},i=(U,G)=>{let C,L;for(;;){if(U.lookahead<F){if(e(U),U.lookahead<F&&G===T)return 1;if(0===U.lookahead)break}if(C=0,U.lookahead>=3&&(U.ins_h=B(U,U.ins_h,U.window[U.strstart+3-1]),C=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),0!==C&&U.strstart-C<=U.w_size-F&&(U.match_length=Y(U,C)),U.match_length>=3)if(L=t(U,U.strstart-U.match_start,U.match_length-3),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=3){U.match_length--;do{U.strstart++,U.ins_h=B(U,U.ins_h,U.window[U.strstart+3-1]),C=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart}while(0!==--U.match_length);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=B(U,U.ins_h,U.window[U.strstart+1]);else L=t(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(L&&(z(U,!1),0===U.strm.avail_out))return 1}return U.insert=U.strstart<2?U.strstart:2,G===V?(z(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(z(U,!1),0===U.strm.avail_out)?1:2},c=(U,G)=>{let C,L,X;for(;;){if(U.lookahead<F){if(e(U),U.lookahead<F&&G===T)return 1;if(0===U.lookahead)break}if(C=0,U.lookahead>=3&&(U.ins_h=B(U,U.ins_h,U.window[U.strstart+3-1]),C=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=2,0!==C&&U.prev_length<U.max_lazy_match&&U.strstart-C<=U.w_size-F&&(U.match_length=Y(U,C),U.match_length<=5&&(U.strategy===o||3===U.match_length&&U.strstart-U.match_start>4096)&&(U.match_length=2)),U.prev_length>=3&&U.match_length<=U.prev_length){X=U.strstart+U.lookahead-3,L=t(U,U.strstart-1-U.prev_match,U.prev_length-3),U.lookahead-=U.prev_length-1,U.prev_length-=2;do{++U.strstart<=X&&(U.ins_h=B(U,U.ins_h,U.window[U.strstart+3-1]),C=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart)}while(0!==--U.prev_length);if(U.match_available=0,U.match_length=2,U.strstart++,L&&(z(U,!1),0===U.strm.avail_out))return 1}else if(U.match_available){if(L=t(U,0,U.window[U.strstart-1]),L&&z(U,!1),U.strstart++,U.lookahead--,0===U.strm.avail_out)return 1}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(L=t(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<2?U.strstart:2,G===V?(z(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(z(U,!1),0===U.strm.avail_out)?1:2};function R(U,G,C,L,X){this.good_length=U,this.max_lazy=G,this.nice_length=C,this.max_chain=L,this.func=X}const W=[new R(0,0,0,0,((U,G)=>{let C=65535;for(C>U.pending_buf_size-5&&(C=U.pending_buf_size-5);;){if(U.lookahead<=1){if(e(U),0===U.lookahead&&G===T)return 1;if(0===U.lookahead)break}U.strstart+=U.lookahead,U.lookahead=0;const L=U.block_start+C;if((0===U.strstart||U.strstart>=L)&&(U.lookahead=U.strstart-L,U.strstart=L,z(U,!1),0===U.strm.avail_out))return 1;if(U.strstart-U.block_start>=U.w_size-F&&(z(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,G===V?(z(U,!0),0===U.strm.avail_out?3:4):(U.strstart>U.block_start&&(z(U,!1),U.strm.avail_out),1)})),new R(4,4,8,4,i),new R(4,5,16,8,i),new R(4,6,32,32,i),new R(4,4,16,16,c),new R(8,16,32,32,c),new R(8,16,128,128,c),new R(8,32,128,256,c),new R(32,128,258,1024,c),new R(32,258,258,4096,c)];function f(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),mU(this.dyn_ltree),mU(this.dyn_dtree),mU(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),mU(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),mU(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const r=U=>{if(!U||!U.state)return n(U,x);U.total_in=U.total_out=0,U.data_type=d;const G=U.state;return G.pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap?42:a,U.adler=2===G.wrap?0:1,G.last_flush=T,L(G),I},J=U=>{const G=r(U);var C;return G===I&&((C=U.state).window_size=2*C.w_size,mU(C.head),C.max_lazy_match=W[C.level].max_lazy,C.good_match=W[C.level].good_length,C.nice_match=W[C.level].nice_length,C.max_chain_length=W[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),G},UU=(U,G,C,L,X,l)=>{if(!U)return x;let t=1;if(G===b&&(G=6),L<0?(t=0,L=-L):L>15&&(t=2,L-=16),X<1||X>9||C!==g||L<8||L>15||G<0||G>9||l<0||l>v)return n(U,x);8===L&&(L=9);const E=new f;return U.state=E,E.strm=U,E.wrap=t,E.gzhead=null,E.w_bits=L,E.w_size=1<<E.w_bits,E.w_mask=E.w_size-1,E.hash_bits=X+7,E.hash_size=1<<E.hash_bits,E.hash_mask=E.hash_size-1,E.hash_shift=~~((E.hash_bits+3-1)/3),E.window=new Uint8Array(2*E.w_size),E.head=new Uint16Array(E.hash_size),E.prev=new Uint16Array(E.w_size),E.lit_bufsize=1<<X+6,E.pending_buf_size=4*E.lit_bufsize,E.pending_buf=new Uint8Array(E.pending_buf_size),E.d_buf=1*E.lit_bufsize,E.l_buf=3*E.lit_bufsize,E.level=G,E.strategy=l,E.method=C,J(U)};U.exports.deflateInit=(U,G)=>UU(U,G,g,15,8,u),U.exports.deflateInit2=UU,U.exports.deflateReset=J,U.exports.deflateResetKeep=r,U.exports.deflateSetHeader=(U,G)=>U&&U.state?2!==U.state.wrap?x:(U.state.gzhead=G,I):x,U.exports.deflate=(U,G)=>{let C,L;if(!U||!U.state||G>p||G<0)return U?n(U,x):x;const l=U.state;if(!U.output||!U.input&&0!==U.avail_in||l.status===k&&G!==V)return n(U,0===U.avail_out?N:x);l.strm=U;const K=l.last_flush;if(l.last_flush=G,42===l.status)if(2===l.wrap)U.adler=0,s(l,31),s(l,139),s(l,8),l.gzhead?(s(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),s(l,255&l.gzhead.time),s(l,l.gzhead.time>>8&255),s(l,l.gzhead.time>>16&255),s(l,l.gzhead.time>>24&255),s(l,9===l.level?2:l.strategy>=w||l.level<2?4:0),s(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(s(l,255&l.gzhead.extra.length),s(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(U.adler=P(U.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69):(s(l,0),s(l,0),s(l,0),s(l,0),s(l,0),s(l,9===l.level?2:l.strategy>=w||l.level<2?4:0),s(l,3),l.status=a);else{let G=g+(l.w_bits-8<<4)<<8,C=-1;C=l.strategy>=w||l.level<2?0:l.level<6?1:6===l.level?2:3,G|=C<<6,0!==l.strstart&&(G|=32),G+=31-G%31,l.status=a,j(l,G),0!==l.strstart&&(j(l,U.adler>>>16),j(l,65535&U.adler)),U.adler=1}if(69===l.status)if(l.gzhead.extra){for(C=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>C&&(U.adler=P(U.adler,l.pending_buf,l.pending-C,C)),M(U),C=l.pending,l.pending!==l.pending_buf_size));)s(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>C&&(U.adler=P(U.adler,l.pending_buf,l.pending-C,C)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=73)}else l.status=73;if(73===l.status)if(l.gzhead.name){C=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>C&&(U.adler=P(U.adler,l.pending_buf,l.pending-C,C)),M(U),C=l.pending,l.pending===l.pending_buf_size)){L=1;break}L=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,s(l,L)}while(0!==L);l.gzhead.hcrc&&l.pending>C&&(U.adler=P(U.adler,l.pending_buf,l.pending-C,C)),0===L&&(l.gzindex=0,l.status=91)}else l.status=91;if(91===l.status)if(l.gzhead.comment){C=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>C&&(U.adler=P(U.adler,l.pending_buf,l.pending-C,C)),M(U),C=l.pending,l.pending===l.pending_buf_size)){L=1;break}L=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,s(l,L)}while(0!==L);l.gzhead.hcrc&&l.pending>C&&(U.adler=P(U.adler,l.pending_buf,l.pending-C,C)),0===L&&(l.status=q)}else l.status=q;if(l.status===q&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&M(U),l.pending+2<=l.pending_buf_size&&(s(l,255&U.adler),s(l,U.adler>>8&255),U.adler=0,l.status=a)):l.status=a),0!==l.pending){if(M(U),0===U.avail_out)return l.last_flush=-1,I}else if(0===U.avail_in&&Q(G)<=Q(K)&&G!==V)return n(U,N);if(l.status===k&&0!==U.avail_in)return n(U,N);if(0!==U.avail_in||0!==l.lookahead||G!==T&&l.status!==k){let C=l.strategy===w?((U,G)=>{let C;for(;;){if(0===U.lookahead&&(e(U),0===U.lookahead)){if(G===T)return 1;break}if(U.match_length=0,C=t(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,C&&(z(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,G===V?(z(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(z(U,!1),0===U.strm.avail_out)?1:2})(l,G):l.strategy===S?((U,G)=>{let C,L,X,l;const E=U.window;for(;;){if(U.lookahead<=Z){if(e(U),U.lookahead<=Z&&G===T)return 1;if(0===U.lookahead)break}if(U.match_length=0,U.lookahead>=3&&U.strstart>0&&(X=U.strstart-1,L=E[X],L===E[++X]&&L===E[++X]&&L===E[++X])){l=U.strstart+Z;do{}while(L===E[++X]&&L===E[++X]&&L===E[++X]&&L===E[++X]&&L===E[++X]&&L===E[++X]&&L===E[++X]&&L===E[++X]&&X<l);U.match_length=Z-(l-X),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=3?(C=t(U,1,U.match_length-3),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(C=t(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),C&&(z(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,G===V?(z(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(z(U,!1),0===U.strm.avail_out)?1:2})(l,G):W[l.level].func(l,G);if(3!==C&&4!==C||(l.status=k),1===C||3===C)return 0===U.avail_out&&(l.last_flush=-1),I;if(2===C&&(G===D?E(l):G!==p&&(X(l,0,0,!1),G===y&&(mU(l.head),0===l.lookahead&&(l.strstart=0,l.block_start=0,l.insert=0))),M(U),0===U.avail_out))return l.last_flush=-1,I}return G!==V?I:l.wrap<=0?H:(2===l.wrap?(s(l,255&U.adler),s(l,U.adler>>8&255),s(l,U.adler>>16&255),s(l,U.adler>>24&255),s(l,255&U.total_in),s(l,U.total_in>>8&255),s(l,U.total_in>>16&255),s(l,U.total_in>>24&255)):(j(l,U.adler>>>16),j(l,65535&U.adler)),M(U),l.wrap>0&&(l.wrap=-l.wrap),0!==l.pending?I:H)},U.exports.deflateEnd=U=>{if(!U||!U.state)return x;const G=U.state.status;return 42!==G&&69!==G&&73!==G&&91!==G&&G!==q&&G!==a&&G!==k?n(U,x):(U.state=null,G===a?n(U,h):I)},U.exports.deflateSetDictionary=(U,G)=>{let C=G.length;if(!U||!U.state)return x;const L=U.state,X=L.wrap;if(2===X||1===X&&42!==L.status||L.lookahead)return x;if(1===X&&(U.adler=K(U.adler,G,C,0)),L.wrap=0,C>=L.w_size){0===X&&(mU(L.head),L.strstart=0,L.block_start=0,L.insert=0);let U=new Uint8Array(L.w_size);U.set(G.subarray(C-L.w_size,C),0),G=U,C=L.w_size}const l=U.avail_in,t=U.next_in,E=U.input;for(U.avail_in=C,U.next_in=0,U.input=G,e(L);L.lookahead>=3;){let U=L.strstart,G=L.lookahead-2;do{L.ins_h=B(L,L.ins_h,L.window[U+3-1]),L.prev[U&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=U,U++}while(--G);L.strstart=U,L.lookahead=2,e(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=2,L.match_available=0,U.next_in=t,U.input=E,U.avail_in=l,L.wrap=X,I},U.exports.deflateInfo="pako deflate (from Nodeca project)"},14556:U=>{"use strict";U.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14540:U=>{"use strict";U.exports=function(U,G){let C,L,X,l,t,E,K,P,O,T,D,y,V,p,I,H,x,h,N,b,o,w,S,v;const u=U.state;C=U.next_in,S=U.input,L=C+(U.avail_in-5),X=U.next_out,v=U.output,l=X-(G-U.avail_out),t=X+(U.avail_out-257),E=u.dmax,K=u.wsize,P=u.whave,O=u.wnext,T=u.window,D=u.hold,y=u.bits,V=u.lencode,p=u.distcode,I=(1<<u.lenbits)-1,H=(1<<u.distbits)-1;U:do{y<15&&(D+=S[C++]<<y,y+=8,D+=S[C++]<<y,y+=8),x=V[D&I];G:for(;;){if(h=x>>>24,D>>>=h,y-=h,h=x>>>16&255,0===h)v[X++]=65535&x;else{if(!(16&h)){if(0===(64&h)){x=V[(65535&x)+(D&(1<<h)-1)];continue G}if(32&h){u.mode=12;break U}U.PG="invalid literal/length code",u.mode=30;break U}N=65535&x,h&=15,h&&(y<h&&(D+=S[C++]<<y,y+=8),N+=D&(1<<h)-1,D>>>=h,y-=h),y<15&&(D+=S[C++]<<y,y+=8,D+=S[C++]<<y,y+=8),x=p[D&H];C:for(;;){if(h=x>>>24,D>>>=h,y-=h,h=x>>>16&255,!(16&h)){if(0===(64&h)){x=p[(65535&x)+(D&(1<<h)-1)];continue C}U.PG="invalid distance code",u.mode=30;break U}if(b=65535&x,h&=15,y<h&&(D+=S[C++]<<y,y+=8,y<h&&(D+=S[C++]<<y,y+=8)),b+=D&(1<<h)-1,b>E){U.PG="invalid distance too far back",u.mode=30;break U}if(D>>>=h,y-=h,h=X-l,b>h){if(h=b-h,h>P&&u.sane){U.PG="invalid distance too far back",u.mode=30;break U}if(o=0,w=T,0===O){if(o+=K-h,h<N){N-=h;do{v[X++]=T[o++]}while(--h);o=X-b,w=v}}else if(O<h){if(o+=K+O-h,h-=O,h<N){N-=h;do{v[X++]=T[o++]}while(--h);if(o=0,O<N){h=O,N-=h;do{v[X++]=T[o++]}while(--h);o=X-b,w=v}}}else if(o+=O-h,h<N){N-=h;do{v[X++]=T[o++]}while(--h);o=X-b,w=v}for(;N>2;)v[X++]=w[o++],v[X++]=w[o++],v[X++]=w[o++],N-=3;N&&(v[X++]=w[o++],N>1&&(v[X++]=w[o++]))}else{o=X-b;do{v[X++]=v[o++],v[X++]=v[o++],v[X++]=v[o++],N-=3}while(N>2);N&&(v[X++]=v[o++],N>1&&(v[X++]=v[o++]))}break}}break}}while(C<L&&X<t);N=y>>3,C-=N,y-=N<<3,D&=(1<<y)-1,U.next_in=C,U.next_out=X,U.avail_in=C<L?L-C+5:5-(C-L),U.avail_out=X<t?t-X+257:257-(X-t),u.hold=D,u.bits=y}},14535:(U,G,C)=>{"use strict";const L=C(14479),X=C(14485),l=C(14540),t=C(14548),{Z_FINISH:E,Z_BLOCK:K,Z_TREES:P,Z_OK:O,Z_STREAM_END:T,Z_NEED_DICT:D,Z_STREAM_ERROR:y,Z_DATA_ERROR:V,Z_MEM_ERROR:p,Z_BUF_ERROR:I,Z_DEFLATED:H}=C(14500),x=12,h=30,N=U=>(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24);function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const o=U=>{if(!U||!U.state)return y;const G=U.state;return U.total_in=U.total_out=G.total=0,U.PG="",G.wrap&&(U.adler=1&G.wrap),G.mode=1,G.last=0,G.havedict=0,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new Int32Array(852),G.distcode=G.distdyn=new Int32Array(592),G.sane=1,G.back=-1,O},w=U=>{if(!U||!U.state)return y;const G=U.state;return G.wsize=0,G.whave=0,G.wnext=0,o(U)},S=(U,G)=>{let C;if(!U||!U.state)return y;const L=U.state;return G<0?(C=0,G=-G):(C=1+(G>>4),G<48&&(G&=15)),G&&(G<8||G>15)?y:(null!==L.window&&L.wbits!==G&&(L.window=null),L.wrap=C,L.wbits=G,w(U))},v=(U,G)=>{if(!U)return y;const C=new b;U.state=C,C.window=null;const L=S(U,G);return L!==O&&(U.state=null),L};let u,d,g=!0;const Z=U=>{if(g){u=new Int32Array(512),d=new Int32Array(32);let G=0;for(;G<144;)U.lens[G++]=8;for(;G<256;)U.lens[G++]=9;for(;G<280;)U.lens[G++]=7;for(;G<288;)U.lens[G++]=8;for(t(1,U.lens,0,288,u,0,U.work,{bits:9}),G=0;G<32;)U.lens[G++]=5;t(2,U.lens,0,32,d,0,U.work,{bits:5}),g=!1}U.lencode=u,U.lenbits=9,U.distcode=d,U.distbits=5},F=(U,G,C,L)=>{let X;const l=U.state;return null===l.window&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),L>=l.wsize?(l.window.set(G.subarray(C-l.wsize,C),0),l.wnext=0,l.whave=l.wsize):(X=l.wsize-l.wnext,X>L&&(X=L),l.window.set(G.subarray(C-L,C-L+X),l.wnext),(L-=X)?(l.window.set(G.subarray(C-L,C),0),l.wnext=L,l.whave=l.wsize):(l.wnext+=X,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=X))),0};U.exports.inflateReset=w,U.exports.inflateReset2=S,U.exports.inflateResetKeep=o,U.exports.inflateInit=U=>v(U,15),U.exports.inflateInit2=v,U.exports.inflate=(U,G)=>{let C,b,o,w,S,v,u,d,g,q,a,k,n,Q,mU,B,M,z,s,j,A,Y,e=0;const i=new Uint8Array(4);let c,R;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!U||!U.state||!U.output||!U.input&&0!==U.avail_in)return y;C=U.state,C.mode===x&&(C.mode=13),S=U.next_out,o=U.output,u=U.avail_out,w=U.next_in,b=U.input,v=U.avail_in,d=C.hold,g=C.bits,q=v,a=u,Y=O;U:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;g<16;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(2&C.wrap&&35615===d){C.check=0,i[0]=255&d,i[1]=d>>>8&255,C.check=X(C.check,i,2,0),d=0,g=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&d)<<8)+(d>>8))%31){U.PG="incorrect header check",C.mode=h;break}if((15&d)!==H){U.PG="unknown compression method",C.mode=h;break}if(d>>>=4,g-=4,A=8+(15&d),0===C.wbits)C.wbits=A;else if(A>C.wbits){U.PG="invalid window size",C.mode=h;break}C.dmax=1<<C.wbits,U.adler=C.check=1,C.mode=512&d?10:x,d=0,g=0;break;case 2:for(;g<16;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(C.flags=d,(255&C.flags)!==H){U.PG="unknown compression method",C.mode=h;break}if(57344&C.flags){U.PG="unknown header flags set",C.mode=h;break}C.head&&(C.head.text=d>>8&1),512&C.flags&&(i[0]=255&d,i[1]=d>>>8&255,C.check=X(C.check,i,2,0)),d=0,g=0,C.mode=3;case 3:for(;g<32;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}C.head&&(C.head.time=d),512&C.flags&&(i[0]=255&d,i[1]=d>>>8&255,i[2]=d>>>16&255,i[3]=d>>>24&255,C.check=X(C.check,i,4,0)),d=0,g=0,C.mode=4;case 4:for(;g<16;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}C.head&&(C.head.xflags=255&d,C.head.os=d>>8),512&C.flags&&(i[0]=255&d,i[1]=d>>>8&255,C.check=X(C.check,i,2,0)),d=0,g=0,C.mode=5;case 5:if(1024&C.flags){for(;g<16;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}C.length=d,C.head&&(C.head.extra_len=d),512&C.flags&&(i[0]=255&d,i[1]=d>>>8&255,C.check=X(C.check,i,2,0)),d=0,g=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(k=C.length,k>v&&(k=v),k&&(C.head&&(A=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(b.subarray(w,w+k),A)),512&C.flags&&(C.check=X(C.check,b,k,w)),v-=k,w+=k,C.length-=k),C.length))break U;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===v)break U;k=0;do{A=b[w+k++],C.head&&A&&C.length<65536&&(C.head.name+=String.fromCharCode(A))}while(A&&k<v);if(512&C.flags&&(C.check=X(C.check,b,k,w)),v-=k,w+=k,A)break U}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===v)break U;k=0;do{A=b[w+k++],C.head&&A&&C.length<65536&&(C.head.comment+=String.fromCharCode(A))}while(A&&k<v);if(512&C.flags&&(C.check=X(C.check,b,k,w)),v-=k,w+=k,A)break U}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;g<16;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(d!==(65535&C.check)){U.PG="header crc mismatch",C.mode=h;break}d=0,g=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),U.adler=C.check=0,C.mode=x;break;case 10:for(;g<32;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}U.adler=C.check=N(d),d=0,g=0,C.mode=11;case 11:if(0===C.havedict)return U.next_out=S,U.avail_out=u,U.next_in=w,U.avail_in=v,C.hold=d,C.bits=g,D;U.adler=C.check=1,C.mode=x;case x:if(G===K||G===P)break U;case 13:if(C.last){d>>>=7&g,g-=7&g,C.mode=27;break}for(;g<3;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}switch(C.last=1&d,d>>>=1,g-=1,3&d){case 0:C.mode=14;break;case 1:if(Z(C),C.mode=20,G===P){d>>>=2,g-=2;break U}break;case 2:C.mode=17;break;case 3:U.PG="invalid block type",C.mode=h}d>>>=2,g-=2;break;case 14:for(d>>>=7&g,g-=7&g;g<32;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if((65535&d)!==(d>>>16^65535)){U.PG="invalid stored block lengths",C.mode=h;break}if(C.length=65535&d,d=0,g=0,C.mode=15,G===P)break U;case 15:C.mode=16;case 16:if(k=C.length,k){if(k>v&&(k=v),k>u&&(k=u),0===k)break U;o.set(b.subarray(w,w+k),S),v-=k,w+=k,u-=k,S+=k,C.length-=k;break}C.mode=x;break;case 17:for(;g<14;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(C.nlen=257+(31&d),d>>>=5,g-=5,C.ndist=1+(31&d),d>>>=5,g-=5,C.ncode=4+(15&d),d>>>=4,g-=4,C.nlen>286||C.ndist>30){U.PG="too many length or distance symbols",C.mode=h;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;g<3;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}C.lens[W[C.have++]]=7&d,d>>>=3,g-=3}for(;C.have<19;)C.lens[W[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,c={bits:C.lenbits},Y=t(0,C.lens,0,19,C.lencode,0,C.work,c),C.lenbits=c.bits,Y){U.PG="invalid code lengths set",C.mode=h;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;e=C.lencode[d&(1<<C.lenbits)-1],mU=e>>>24,B=e>>>16&255,M=65535&e,!(mU<=g);){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(M<16)d>>>=mU,g-=mU,C.lens[C.have++]=M;else{if(16===M){for(R=mU+2;g<R;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(d>>>=mU,g-=mU,0===C.have){U.PG="invalid bit length repeat",C.mode=h;break}A=C.lens[C.have-1],k=3+(3&d),d>>>=2,g-=2}else if(17===M){for(R=mU+3;g<R;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}d>>>=mU,g-=mU,A=0,k=3+(7&d),d>>>=3,g-=3}else{for(R=mU+7;g<R;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}d>>>=mU,g-=mU,A=0,k=11+(127&d),d>>>=7,g-=7}if(C.have+k>C.nlen+C.ndist){U.PG="invalid bit length repeat",C.mode=h;break}for(;k--;)C.lens[C.have++]=A}}if(C.mode===h)break;if(0===C.lens[256]){U.PG="invalid code -- missing end-of-block",C.mode=h;break}if(C.lenbits=9,c={bits:C.lenbits},Y=t(1,C.lens,0,C.nlen,C.lencode,0,C.work,c),C.lenbits=c.bits,Y){U.PG="invalid literal/lengths set",C.mode=h;break}if(C.distbits=6,C.distcode=C.distdyn,c={bits:C.distbits},Y=t(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,c),C.distbits=c.bits,Y){U.PG="invalid distances set",C.mode=h;break}if(C.mode=20,G===P)break U;case 20:C.mode=21;case 21:if(v>=6&&u>=258){U.next_out=S,U.avail_out=u,U.next_in=w,U.avail_in=v,C.hold=d,C.bits=g,l(U,a),S=U.next_out,o=U.output,u=U.avail_out,w=U.next_in,b=U.input,v=U.avail_in,d=C.hold,g=C.bits,C.mode===x&&(C.back=-1);break}for(C.back=0;e=C.lencode[d&(1<<C.lenbits)-1],mU=e>>>24,B=e>>>16&255,M=65535&e,!(mU<=g);){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(B&&0===(240&B)){for(z=mU,s=B,j=M;e=C.lencode[j+((d&(1<<z+s)-1)>>z)],mU=e>>>24,B=e>>>16&255,M=65535&e,!(z+mU<=g);){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}d>>>=z,g-=z,C.back+=z}if(d>>>=mU,g-=mU,C.back+=mU,C.length=M,0===B){C.mode=26;break}if(32&B){C.back=-1,C.mode=x;break}if(64&B){U.PG="invalid literal/length code",C.mode=h;break}C.extra=15&B,C.mode=22;case 22:if(C.extra){for(R=C.extra;g<R;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}C.length+=d&(1<<C.extra)-1,d>>>=C.extra,g-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;e=C.distcode[d&(1<<C.distbits)-1],mU=e>>>24,B=e>>>16&255,M=65535&e,!(mU<=g);){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(0===(240&B)){for(z=mU,s=B,j=M;e=C.distcode[j+((d&(1<<z+s)-1)>>z)],mU=e>>>24,B=e>>>16&255,M=65535&e,!(z+mU<=g);){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}d>>>=z,g-=z,C.back+=z}if(d>>>=mU,g-=mU,C.back+=mU,64&B){U.PG="invalid distance code",C.mode=h;break}C.offset=M,C.extra=15&B,C.mode=24;case 24:if(C.extra){for(R=C.extra;g<R;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}C.offset+=d&(1<<C.extra)-1,d>>>=C.extra,g-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){U.PG="invalid distance too far back",C.mode=h;break}C.mode=25;case 25:if(0===u)break U;if(k=a-u,C.offset>k){if(k=C.offset-k,k>C.whave&&C.sane){U.PG="invalid distance too far back",C.mode=h;break}k>C.wnext?(k-=C.wnext,n=C.wsize-k):n=C.wnext-k,k>C.length&&(k=C.length),Q=C.window}else Q=o,n=S-C.offset,k=C.length;k>u&&(k=u),u-=k,C.length-=k;do{o[S++]=Q[n++]}while(--k);0===C.length&&(C.mode=21);break;case 26:if(0===u)break U;o[S++]=C.length,u--,C.mode=21;break;case 27:if(C.wrap){for(;g<32;){if(0===v)break U;v--,d|=b[w++]<<g,g+=8}if(a-=u,U.total_out+=a,C.total+=a,a&&(U.adler=C.check=C.flags?X(C.check,o,a,S-a):L(C.check,o,a,S-a)),a=u,(C.flags?d:N(d))!==C.check){U.PG="incorrect data check",C.mode=h;break}d=0,g=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;g<32;){if(0===v)break U;v--,d+=b[w++]<<g,g+=8}if(d!==(4294967295&C.total)){U.PG="incorrect length check",C.mode=h;break}d=0,g=0}C.mode=29;case 29:Y=T;break U;case h:Y=V;break U;case 31:return p;default:return y}return U.next_out=S,U.avail_out=u,U.next_in=w,U.avail_in=v,C.hold=d,C.bits=g,(C.wsize||a!==U.avail_out&&C.mode<h&&(C.mode<27||G!==E))&&F(U,U.output,U.next_out,a-U.avail_out)?(C.mode=31,p):(q-=U.avail_in,a-=U.avail_out,U.total_in+=q,U.total_out+=a,C.total+=a,C.wrap&&a&&(U.adler=C.check=C.flags?X(C.check,o,a,U.next_out-a):L(C.check,o,a,U.next_out-a)),U.data_type=C.bits+(C.last?64:0)+(C.mode===x?128:0)+(20===C.mode||15===C.mode?256:0),(0===q&&0===a||G===E)&&Y===O&&(Y=I),Y)},U.exports.inflateEnd=U=>{if(!U||!U.state)return y;let G=U.state;return G.window&&(G.window=null),U.state=null,O},U.exports.inflateGetHeader=(U,G)=>{if(!U||!U.state)return y;const C=U.state;return 0===(2&C.wrap)?y:(C.head=G,G.done=!1,O)},U.exports.inflateSetDictionary=(U,G)=>{const C=G.length;let X,l,t;return U&&U.state?(X=U.state,0!==X.wrap&&11!==X.mode?y:11===X.mode&&(l=1,l=L(l,G,C,0),l!==X.check)?V:(t=F(U,G,C,C),t?(X.mode=31,p):(X.havedict=1,O))):y},U.exports.inflateInfo="pako inflate (from Nodeca project)"},14548:U=>{"use strict";const G=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),L=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),X=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),l=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);U.exports=(U,t,E,K,P,O,T,D)=>{const y=D.bits;let V,p,I,H,x,h,N=0,b=0,o=0,w=0,S=0,v=0,u=0,d=0,g=0,Z=0,F=null,q=0;const a=new Uint16Array(16),k=new Uint16Array(16);let n,Q,mU,B=null,M=0;for(N=0;N<=G;N++)a[N]=0;for(b=0;b<K;b++)a[t[E+b]]++;for(S=y,w=G;w>=1&&0===a[w];w--);if(S>w&&(S=w),0===w)return P[O++]=20971520,P[O++]=20971520,D.bits=1,0;for(o=1;o<w&&0===a[o];o++);for(S<o&&(S=o),d=1,N=1;N<=G;N++)if(d<<=1,d-=a[N],d<0)return-1;if(d>0&&(0===U||1!==w))return-1;for(k[1]=0,N=1;N<G;N++)k[N+1]=k[N]+a[N];for(b=0;b<K;b++)0!==t[E+b]&&(T[k[t[E+b]]++]=b);if(0===U?(F=B=T,h=19):1===U?(F=C,q-=257,B=L,M-=257,h=256):(F=X,B=l,h=-1),Z=0,b=0,N=o,x=O,v=S,u=0,I=-1,g=1<<S,H=g-1,1===U&&g>852||2===U&&g>592)return 1;for(;;){n=N-u,T[b]<h?(Q=0,mU=T[b]):T[b]>h?(Q=B[M+T[b]],mU=F[q+T[b]]):(Q=96,mU=0),V=1<<N-u,p=1<<v,o=p;do{p-=V,P[x+(Z>>u)+p]=n<<24|Q<<16|mU}while(0!==p);for(V=1<<N-1;Z&V;)V>>=1;if(0!==V?(Z&=V-1,Z+=V):Z=0,b++,0===--a[N]){if(N===w)break;N=t[E+T[b]]}if(N>S&&(Z&H)!==I){for(0===u&&(u=S),x+=o,v=N-u,d=1<<v;v+u<w&&(d-=a[v+u],!(d<=0));)v++,d<<=1;if(g+=1<<v,1===U&&g>852||2===U&&g>592)return 1;I=Z&H,P[I]=S<<24|v<<16|x-O}}return 0!==Z&&(P[x+Z]=N-u<<24|64<<16),D.bits=S,0}},14494:U=>{"use strict";U.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14471:U=>{"use strict";function G(U){let G=U.length;for(;--G>=0;)U[G]=0}const C=256,L=286,X=30,l=15,t=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),E=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),K=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O=new Array(576);G(O);const T=new Array(60);G(T);const D=new Array(512);G(D);const y=new Array(256);G(y);const V=new Array(29);G(V);const p=new Array(X);function I(U,G,C,L,X){this.static_tree=U,this.extra_bits=G,this.extra_base=C,this.elems=L,this.max_length=X,this.has_stree=U&&U.length}let H,x,h;function N(U,G){this.dyn_tree=U,this.max_code=0,this.stat_desc=G}G(p);const b=U=>U<256?D[U]:D[256+(U>>>7)],o=(U,G)=>{U.pending_buf[U.pending++]=255&G,U.pending_buf[U.pending++]=G>>>8&255},w=(U,G,C)=>{U.bi_valid>16-C?(U.bi_buf|=G<<U.bi_valid&65535,o(U,U.bi_buf),U.bi_buf=G>>16-U.bi_valid,U.bi_valid+=C-16):(U.bi_buf|=G<<U.bi_valid&65535,U.bi_valid+=C)},S=(U,G,C)=>{w(U,C[2*G],C[2*G+1])},v=(U,G)=>{let C=0;do{C|=1&U,U>>>=1,C<<=1}while(--G>0);return C>>>1},u=(U,G,C)=>{const L=new Array(16);let X,t,E=0;for(X=1;X<=l;X++)L[X]=E=E+C[X-1]<<1;for(t=0;t<=G;t++){let G=U[2*t+1];0!==G&&(U[2*t]=v(L[G]++,G))}},d=U=>{let G;for(G=0;G<L;G++)U.dyn_ltree[2*G]=0;for(G=0;G<X;G++)U.dyn_dtree[2*G]=0;for(G=0;G<19;G++)U.bl_tree[2*G]=0;U.dyn_ltree[512]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0},g=U=>{U.bi_valid>8?o(U,U.bi_buf):U.bi_valid>0&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0},Z=(U,G,C,L)=>{const X=2*G,l=2*C;return U[X]<U[l]||U[X]===U[l]&&L[G]<=L[C]},F=(U,G,C)=>{const L=U.heap[C];let X=C<<1;for(;X<=U.heap_len&&(X<U.heap_len&&Z(G,U.heap[X+1],U.heap[X],U.depth)&&X++,!Z(G,L,U.heap[X],U.depth));)U.heap[C]=U.heap[X],C=X,X<<=1;U.heap[C]=L},q=(U,G,L)=>{let X,l,K,P,O=0;if(0!==U.last_lit)do{X=U.pending_buf[U.d_buf+2*O]<<8|U.pending_buf[U.d_buf+2*O+1],l=U.pending_buf[U.l_buf+O],O++,0===X?S(U,l,G):(K=y[l],S(U,K+C+1,G),P=t[K],0!==P&&(l-=V[K],w(U,l,P)),X--,K=b(X),S(U,K,L),P=E[K],0!==P&&(X-=p[K],w(U,X,P)))}while(O<U.last_lit);S(U,256,G)},a=(U,G)=>{const C=G.dyn_tree,L=G.stat_desc.static_tree,X=G.stat_desc.has_stree,t=G.stat_desc.elems;let E,K,P,O=-1;for(U.heap_len=0,U.heap_max=573,E=0;E<t;E++)0!==C[2*E]?(U.heap[++U.heap_len]=O=E,U.depth[E]=0):C[2*E+1]=0;for(;U.heap_len<2;)P=U.heap[++U.heap_len]=O<2?++O:0,C[2*P]=1,U.depth[P]=0,U.opt_len--,X&&(U.static_len-=L[2*P+1]);for(G.max_code=O,E=U.heap_len>>1;E>=1;E--)F(U,C,E);P=t;do{E=U.heap[1],U.heap[1]=U.heap[U.heap_len--],F(U,C,1),K=U.heap[1],U.heap[--U.heap_max]=E,U.heap[--U.heap_max]=K,C[2*P]=C[2*E]+C[2*K],U.depth[P]=(U.depth[E]>=U.depth[K]?U.depth[E]:U.depth[K])+1,C[2*E+1]=C[2*K+1]=P,U.heap[1]=P++,F(U,C,1)}while(U.heap_len>=2);U.heap[--U.heap_max]=U.heap[1],((U,G)=>{const C=G.dyn_tree,L=G.max_code,X=G.stat_desc.static_tree,t=G.stat_desc.has_stree,E=G.stat_desc.extra_bits,K=G.stat_desc.extra_base,P=G.stat_desc.max_length;let O,T,D,y,V,p,I=0;for(y=0;y<=l;y++)U.bl_count[y]=0;for(C[2*U.heap[U.heap_max]+1]=0,O=U.heap_max+1;O<573;O++)T=U.heap[O],y=C[2*C[2*T+1]+1]+1,y>P&&(y=P,I++),C[2*T+1]=y,T>L||(U.bl_count[y]++,V=0,T>=K&&(V=E[T-K]),p=C[2*T],U.opt_len+=p*(y+V),t&&(U.static_len+=p*(X[2*T+1]+V)));if(0!==I){do{for(y=P-1;0===U.bl_count[y];)y--;U.bl_count[y]--,U.bl_count[y+1]+=2,U.bl_count[P]--,I-=2}while(I>0);for(y=P;0!==y;y--)for(T=U.bl_count[y];0!==T;)D=U.heap[--O],D>L||(C[2*D+1]!==y&&(U.opt_len+=(y-C[2*D+1])*C[2*D],C[2*D+1]=y),T--)}})(U,G),u(C,O,U.bl_count)},k=(U,G,C)=>{let L,X,l=-1,t=G[1],E=0,K=7,P=4;for(0===t&&(K=138,P=3),G[2*(C+1)+1]=65535,L=0;L<=C;L++)X=t,t=G[2*(L+1)+1],++E<K&&X===t||(E<P?U.bl_tree[2*X]+=E:0!==X?(X!==l&&U.bl_tree[2*X]++,U.bl_tree[32]++):E<=10?U.bl_tree[34]++:U.bl_tree[36]++,E=0,l=X,0===t?(K=138,P=3):X===t?(K=6,P=3):(K=7,P=4))},n=(U,G,C)=>{let L,X,l=-1,t=G[1],E=0,K=7,P=4;for(0===t&&(K=138,P=3),L=0;L<=C;L++)if(X=t,t=G[2*(L+1)+1],!(++E<K&&X===t)){if(E<P)do{S(U,X,U.bl_tree)}while(0!==--E);else 0!==X?(X!==l&&(S(U,X,U.bl_tree),E--),S(U,16,U.bl_tree),w(U,E-3,2)):E<=10?(S(U,17,U.bl_tree),w(U,E-3,3)):(S(U,18,U.bl_tree),w(U,E-11,7));E=0,l=X,0===t?(K=138,P=3):X===t?(K=6,P=3):(K=7,P=4)}};let Q=!1;const mU=(U,G,C,L)=>{w(U,0+(L?1:0),3),((U,G,C,L)=>{g(U),L&&(o(U,C),o(U,~C)),U.pending_buf.set(U.window.subarray(G,G+C),U.pending),U.pending+=C})(U,G,C,!0)};U.exports._tr_init=U=>{Q||((()=>{let U,G,C,P,N;const b=new Array(16);for(C=0,P=0;P<28;P++)for(V[P]=C,U=0;U<1<<t[P];U++)y[C++]=P;for(y[C-1]=P,N=0,P=0;P<16;P++)for(p[P]=N,U=0;U<1<<E[P];U++)D[N++]=P;for(N>>=7;P<X;P++)for(p[P]=N<<7,U=0;U<1<<E[P]-7;U++)D[256+N++]=P;for(G=0;G<=l;G++)b[G]=0;for(U=0;U<=143;)O[2*U+1]=8,U++,b[8]++;for(;U<=255;)O[2*U+1]=9,U++,b[9]++;for(;U<=279;)O[2*U+1]=7,U++,b[7]++;for(;U<=287;)O[2*U+1]=8,U++,b[8]++;for(u(O,287,b),U=0;U<X;U++)T[2*U+1]=5,T[2*U]=v(U,5);H=new I(O,t,257,L,l),x=new I(T,E,0,X,l),h=new I(new Array(0),K,0,19,7)})(),Q=!0),U.l_desc=new N(U.dyn_ltree,H),U.d_desc=new N(U.dyn_dtree,x),U.bl_desc=new N(U.bl_tree,h),U.bi_buf=0,U.bi_valid=0,d(U)},U.exports._tr_stored_block=mU,U.exports._tr_flush_block=(U,G,L,X)=>{let l,t,E=0;U.level>0?(2===U.strm.data_type&&(U.strm.data_type=(U=>{let G,L=4093624447;for(G=0;G<=31;G++,L>>>=1)if(1&L&&0!==U.dyn_ltree[2*G])return 0;if(0!==U.dyn_ltree[18]||0!==U.dyn_ltree[20]||0!==U.dyn_ltree[26])return 1;for(G=32;G<C;G++)if(0!==U.dyn_ltree[2*G])return 1;return 0})(U)),a(U,U.l_desc),a(U,U.d_desc),E=(U=>{let G;for(k(U,U.dyn_ltree,U.l_desc.max_code),k(U,U.dyn_dtree,U.d_desc.max_code),a(U,U.bl_desc),G=18;G>=3&&0===U.bl_tree[2*P[G]+1];G--);return U.opt_len+=3*(G+1)+5+5+4,G})(U),l=U.opt_len+3+7>>>3,t=U.static_len+3+7>>>3,t<=l&&(l=t)):l=t=L+5,L+4<=l&&-1!==G?mU(U,G,L,X):4===U.strategy||t===l?(w(U,2+(X?1:0),3),q(U,O,T)):(w(U,4+(X?1:0),3),((U,G,C,L)=>{let X;for(w(U,G-257,5),w(U,C-1,5),w(U,L-4,4),X=0;X<L;X++)w(U,U.bl_tree[2*P[X]+1],3);n(U,U.dyn_ltree,G-1),n(U,U.dyn_dtree,C-1)})(U,U.l_desc.max_code+1,U.d_desc.max_code+1,E+1),q(U,U.dyn_ltree,U.dyn_dtree)),d(U),X&&g(U)},U.exports._tr_tally=(U,G,L)=>(U.pending_buf[U.d_buf+2*U.last_lit]=G>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&G,U.pending_buf[U.l_buf+U.last_lit]=255&L,U.last_lit++,0===G?U.dyn_ltree[2*L]++:(U.matches++,G--,U.dyn_ltree[2*(y[L]+C+1)]++,U.dyn_dtree[2*b(G)]++),U.last_lit===U.lit_bufsize-1),U.exports._tr_align=U=>{w(U,2,3),S(U,256,O),(U=>{16===U.bi_valid?(o(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):U.bi_valid>=8&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)})(U)}},14518:U=>{"use strict";U.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.PG="",this.state=null,this.data_type=2,this.adler=0}},13662:U=>{function G(U,G,C){for(var L=U.length,X=-1/0,l=1/0,t=0;t<L;t++){var E=(C[0][t]-U[t])/G[t],K=(C[1][t]-U[t])/G[t];if(E>K){var P=E;E=K,K=P}if(K<X||E>l)return 1/0;E>X&&(X=E),K<l&&(l=K)}return X>l?1/0:X}U.exports=function(U,C,L,X){var l=G(C,L,X);if(l===1/0)U=null;else{U=U||[];for(var t=0;t<C.length;t++)U[t]=C[t]+L[t]*l}return U},U.exports.distance=G},14619:(U,G,C)=>{"use strict";C.d(G,{d:()=>t});var L=C(59);const X=L.useLayoutEffect;const l=function(U){var G=(0,L.useRef)(U);return X((function(){G.current=U})),G};var t=function(U){var G=l(U);(0,L.tG)((function(){var U=function(U){var C;if(null!=G.current&&(C=G.current(U)),U.defaultPrevented&&(U.returnValue=""),"string"===typeof C)return U.returnValue=C,C};return window.addEventListener("beforeunload",U),function(){window.removeEventListener("beforeunload",U)}}),[])}},14586:(U,G,C)=>{"use strict";var L=C(14590),X=Array.prototype.concat,l=Array.prototype.slice,t=U.exports=function(U){for(var G=[],C=0,t=U.length;C<t;C++){var E=U[C];L(E)?G=X.call(G,l.call(E)):G.push(E)}return G};t.wrap=function(U){return function(){return U(t(arguments))}}},14590:U=>{U.exports=function(U){return!(!U||"string"===typeof U)&&(U instanceof Array||Array.isArray(U)||U.length>=0&&(U.splice instanceof Function||Object.getOwnPropertyDescriptor(U,U.length-1)&&"String"!==U.constructor.name))}},14404:U=>{"use strict";var G=[],C=[],L=[],X=[],l=[],t=[],E=[],K=[],P=[],O=[],T=[],D=[];U.exports=function(U,y,V,p,I,H){for(var x=E,h=P,N=O,b=D,o=0;o<3;o++)x[o]=+V[o],N[o]=+y.max[o],h[o]=+y.base[o];H||(H=1e-10);var w=function(U,E,P,O,D,y){var V=G,p=C,I=L,H=X,x=l,h=t,N=K,b=Math.floor,o=0,w=0,S=0,v=0,u=0;if(d(),0===S)return 0;for(v=F();w<=S;){if(g(v)&&Z())return o;v=F()}for(o+=S,u=0;u<3;u++)O[u]+=P[u],D[u]+=P[u];return o;function d(){if(w=0,0!==(S=Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2])))for(var U=0;U<3;U++){var G=P[U]>=0;H[U]=G?1:-1;var C=G?D[U]:O[U];V[U]=G?O[U]:D[U],p[U]=q(C,H[U]),I[U]=a(V[U],H[U]),N[U]=P[U]/S,x[U]=Math.abs(1/N[U]);var L=G?p[U]+1-C:C-p[U];h[U]=x[U]<1/0?x[U]*L:1/0}}function g(G){for(var C=H[0],L=0===G?p[0]:I[0],X=p[0]+C,l=H[1],t=1===G?p[1]:I[1],E=p[1]+l,K=H[2],P=2===G?p[2]:I[2],O=p[2]+K,T=L;T!=X;T+=C)for(var D=t;D!=E;D+=l)for(var y=P;y!=O;y+=K)if(U(T,D,y))return!0;return!1}function Z(){o+=w;var U=H[v],G=w/S,C=T;for(u=0;u<3;u++){var L=P[u]*G;O[u]+=L,D[u]+=L,C[u]=P[u]-L}if(U>0?D[v]=Math.round(D[v]):O[v]=Math.round(O[v]),E(o,v,U,C))return!0;for(u=0;u<3;u++)P[u]=C[u];return d(),0===S}function F(){var U=h[0]<h[1]?h[0]<h[2]?0:2:h[1]<h[2]?1:2,G=h[U]-w;for(w=h[U],p[U]+=H[U],h[U]+=x[U],u=0;u<3;u++)V[u]+=G*N[u],I[u]=a(V[u],H[u]);return U}function q(U,G){return b(U-G*y)}function a(U,G){return b(U+G*y)}}(U,p,x,h,N,H);if(!I){for(o=0;o<3;o++)b[o]=V[o]>0?N[o]-y.max[o]:h[o]-y.base[o];y.translate(b)}return w}},14437:(U,G,C)=>{var L=C(14445);function X(U){for(var G,C,X=0,l=U.length,t=0;t<U.length;){for(G=U[t],C=0;t<l&&U[t]===G;)++t,++C;X+=L.log2(C)/7|0,X+=L.log2(G>>>0)/7|0,X+=2}return X}G.size=X,G.encode=function(U,G){G||(G=new Uint8Array(X(U)));for(var C,L,l=0,t=G.length,E=0;E<U.length;){for(C=U[E],L=0;E<U.length&&U[E]===C;)++E,++L;for(;l<t&&L>=128;)G[l++]=128+(127&L),L>>>=7;if(l>=t)throw new Error("RLE buffer overflow");for(G[l++]=L,C>>>=0;l<t&&C>=128;)G[l++]=128+(127&C),C>>>=7;if(l>=t)throw new Error("RLE buffer overflow");G[l++]=C}return G},G.decode=function(U,G){for(var C,L,X,l,t=G.length,E=U.length,K=0,P=0;P<E;){for(C=0,L=0;P<E&&U[P]>=128;)C+=(127&U[P++])<<L,L+=7;if(C+=U[P++]<<L,P>=E)throw new Error("RLE buffer underrun");if(K+C>t)throw new Error("Chunk buffer overflow");for(X=0,L=0;P<E&&U[P]>=128;)X+=(127&U[P++])<<L,L+=7;if(P>=E)throw new Error("RLE buffer underrun");for(X+=U[P++]<<L,l=0;l<C;++l)G[K++]=X}return G}},14445:(U,G)=>{"use strict";function C(U){var G=32;return(U&=-U)&&G--,65535&U&&(G-=16),16711935&U&&(G-=8),252645135&U&&(G-=4),858993459&U&&(G-=2),1431655765&U&&(G-=1),G}G.INT_BITS=32,G.INT_MAX=2147483647,G.INT_MIN=-1<<31,G.sign=function(U){return(U>0)-(U<0)},G.abs=function(U){var G=U>>31;return(U^G)-G},G.min=function(U,G){return G^(U^G)&-(U<G)},G.max=function(U,G){return U^(U^G)&-(U<G)},G.isPow2=function(U){return!(U&U-1)&&!!U},G.log2=function(U){var G,C;return G=(U>65535)<<4,G|=C=((U>>>=G)>255)<<3,G|=C=((U>>>=C)>15)<<2,(G|=C=((U>>>=C)>3)<<1)|(U>>>=C)>>1},G.log10=function(U){return U>=1e9?9:U>=1e8?8:U>=1e7?7:U>=1e6?6:U>=1e5?5:U>=1e4?4:U>=1e3?3:U>=100?2:U>=10?1:0},G.popCount=function(U){return 16843009*((U=(858993459&(U-=U>>>1&1431655765))+(U>>>2&858993459))+(U>>>4)&252645135)>>>24},G.countTrailingZeros=C,G.nextPow2=function(U){return U+=0===U,--U,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)+1},G.prevPow2=function(U){return U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)-(U>>>1)},G.parity=function(U){return U^=U>>>16,U^=U>>>8,U^=U>>>4,27030>>>(U&=15)&1};var L=new Array(256);!function(U){for(var G=0;G<256;++G){var C=G,L=G,X=7;for(C>>>=1;C;C>>>=1)L<<=1,L|=1&C,--X;U[G]=L<<X&255}}(L),G.reverse=function(U){return L[255&U]<<24|L[U>>>8&255]<<16|L[U>>>16&255]<<8|L[U>>>24&255]},G.interleave2=function(U,G){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))|(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))<<1},G.deinterleave2=function(U,G){return(U=65535&((U=16711935&((U=252645135&((U=858993459&((U=U>>>G&1431655765)|U>>>1))|U>>>2))|U>>>4))|U>>>16))<<16>>16},G.interleave3=function(U,G,C){return U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2),(U|=(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},G.deinterleave3=function(U,G){return(U=1023&((U=4278190335&((U=251719695&((U=3272356035&((U=U>>>G&1227133513)|U>>>2))|U>>>4))|U>>>8))|U>>>16))<<22>>22},G.nextCombination=function(U){var G=U|U-1;return G+1|(~G&-~G)-1>>>C(U)+1}},14702:(U,G,C)=>{"use strict";C.d(G,{e:()=>T});var L=C(14400),X=C(135);class l{constructor(U,G,C,l,t,E,K){this.KO=new L(U.base,U.SO),this.zL=G,this.friction=C,this.restitution=l,this.UE=t,this.Ay=E,this.GE=!!K,this.wO=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.qV=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.uP=X.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=X.create(),this._impulses=X.create(),this._sleepFrameCount=10}loadFromCopy(U){X.i(this.KO.base,U.KO.base),X.i(this.KO.SO,U.KO.SO),X.i(this.KO.max,U.KO.max),this.KO.mag=U.KO.mag,this.zL=U.zL,this.friction=U.friction,this.restitution=U.restitution,this.UE=U.UE,this.Ay=U.Ay,this.GE=U.GE,this.wO=U.wO,this.fluidDrag=U.fluidDrag,this.qV=U.qV,this.preventFallOffEdge=U.preventFallOffEdge,this.rolledBackLastTick=U.rolledBackLastTick,X.i(this.uP,U.uP),X.i(this.resting,U.resting),this.inFluid=U.inFluid,this._ratioInFluid=U._ratioInFluid,X.i(this._forces,U._forces),X.i(this._impulses,U._impulses),this._sleepFrameCount=U._sleepFrameCount}setPosition(U){t(U),X.IG(U,U,this.KO.base),this.KO.translate(U),this.dP()}IX(){return X.clone(this.KO.base)}applyForce(U){t(U),X.add(this._forces,this._forces,U),this.dP()}applyImpulse(U){t(U),X.add(this._impulses,this._impulses,U),this.dP()}dP(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var t=U=>{};var E=C(14400),K=C(135),P=C(14404);function O(){this.wO=.1,this.fluidDrag=.4,this.tE=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function T(U,G,C){U=Object.assign(new O,U),this.gravity=U.gravity||[0,-10,0],this.wO=U.wO||.1,this.tE=U.tE||2,this.fluidDrag=U.fluidDrag||.4,this.minBounceImpulse=U.minBounceImpulse,this.bodies=[],this.Py=U.Py,this.testSolid=G,this.testFluid=C}T.prototype.UV=function(U,G,C,L,X,t){U=U||new E([0,0,0],[1,1,1]),"undefined"==typeof G&&(G=1),"undefined"==typeof C&&(C=1),"undefined"==typeof L&&(L=0),"undefined"==typeof X&&(X=1);var K=new l(U,G,C,L,X,t);return this.bodies.push(K),K},T.prototype.GV=function(U){var G=this.bodies.indexOf(U);G<0||(this.bodies.splice(G,1),U.KO=U.Ay=null)};var D=K.create(),y=K.create(),V=K.create(),p=K.create(),I=K.create(),H=K.create(),x=K.create(),h=new E([0,0,0],[1,1,1]),N=new l(h,1,1,0,1,(()=>{}),!1);function b(U,G,C){return G=C,G*=1-(1-U.ratioInFluid)**2}T.prototype.ZE=function(U){U/=1e3;var G=B(0,K.squaredLength(this.gravity));this.bodies.forEach((C=>function(U,G,C,L){K.i(I,G.resting),U.Py&&N.loadFromCopy(G);if(G.zL<=0)return K.set(G.uP,0,0,0),K.set(G._forces,0,0,0),void K.set(G._impulses,0,0,0);var X=L||0===G.UE;if(function(U,G,C,L){if(G._sleepFrameCount>0)return!1;if(L)return!0;var X=!1,l=.5*C*C*G.UE;return K.scale(mU,U.gravity,l),P(U.testSolid,G.KO,mU,(function(){return X=!0,!0}),!0),X}(U,G,C,X))return;G._sleepFrameCount--,function(U,G){var C=G.KO,L=Math.floor(C.base[0]),X=Math.floor(C.base[2]),l=Math.floor(C.base[1]),t=Math.floor(C.max[1]);if(!U.testFluid(L,l,X))return G.inFluid=!1,void(G.ratioInFluid=0);var E=1,P=l+1;for(;P<=t&&U.testFluid(L,P,X);)E++,P++;var O=(l+E-C.base[1])/C.SO[1];O>1&&(O=1);var T=C.SO[0]*C.SO[1]*C.SO[2]*O,D=w;K.scale(D,U.gravity,-U.tE*T*G.UE),G.applyForce(D),G.inFluid=!0,G.ratioInFluid=O}(U,G),z(G._forces),z(G._impulses),z(G.uP),z(G.resting),K.scale(D,G._forces,1/G.zL),K.bE(D,D,U.gravity,G.UE),K.scale(y,G._impulses,1/G.zL),K.bE(y,y,D,C),K.add(G.uP,G.uP,y),G.friction&&(S(U,0,G,y,C),S(U,1,G,y,C),S(U,2,G,y,C));var l=G.fluidDrag>=0?G.fluidDrag:U.fluidDrag,t=G.wO>=0?G.wO:U.wO,E=t,O=t;G.inFluid&&(E=b(G,E,G.fluidDragHoriz>=0?G.fluidDragHoriz:l),O=b(G,O,G.fluidDragVert>=0?G.fluidDragVert:l));E=Math.max(1-E*C/G.zL,0),O=Math.max(1-O*C/G.zL,0),K.set(o,E,O,E),K.multiply(G.uP,G.uP,o),K.scale(V,G.uP,C),K.set(G._forces,0,0,0),K.set(G._impulses,0,0,0),G.GE&&M(d,G.KO);K.i(H,V),K.set(x,0,0,0),G.preventFallOffEdge&&function(U,G,C,L){if(!G.resting[1]||C[1]>0)return;var X=k;M(X,G.KO);for(var l=0;l<3;l+=2){K.set(a,0,0,0),a[l]=C[l];var t=!0;(t=(t=(t=(t=t&&!Q(U,X.base[0]+a[0]+1e-5,X.base[1],X.base[2]+a[2]+1e-5))&&!Q(U,X.max[0]+a[0]-1e-5,X.base[1],X.base[2]+a[2]+1e-5))&&!Q(U,X.base[0]+a[0]+1e-5,X.base[1],X.max[2]+a[2]-1e-5))&&!Q(U,X.max[0]+a[0]-1e-5,X.base[1],X.max[2]+a[2]-1e-5))?(L[l]=C[l]>0?1:-1,C[l]=0):0===l&&(K.set(n,C[0],0,0),u(U,X,n,L,G.slideOnCollision))}}(U,G,V,x);u(U,G.KO,V,G.resting,G.slideOnCollision),G.GE&&function(U,G,C,L){if(G.resting[1]>=0&&!G.inFluid)return;var X=0!==G.resting[0],l=0!==G.resting[2];if(!X&&!l)return;var t=Math.abs(L[0]/L[2]),E=4;if(!X&&t>E)return;if(!l&&t<1/E)return;K.add(Z,C.base,L);var O=U.testSolid;P(O,C,L,(function(U,G,C,L){if(1!==G)return!0;L[G]=0}));var T=C.base[1],D=G.inFluid?1.951:1.001,y=Math.floor(T+D)-T;K.set(F,0,y,0);var V=!1;if(P(O,C,F,(function(U,G,C,L){return V=!0,!0})),V)return;K.IG(q,Z,C.base),q[1]=0,u(U,C,q,g,!0);var p=B(C.base[0],Z[0]),I=B(C.base[2],Z[2]);if(X&&!p&&(!I||!l))return;if(l&&(!p||!X)&&!I)return;var H=!0;if(H=H&&!Q(U,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),H=H&&!Q(U,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),H=H&&!Q(U,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),H=H&&!Q(U,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),H)return;M(G.KO,C),G.resting[0]=g[0],G.resting[2]=g[2],G.qV&&G.qV()}(U,G,d,H);for(var T=0;T<3;++T)G.resting[T]=G.resting[T]||x[T],p[T]=0,G.resting[T]&&(I[T]||(p[T]=-G.uP[T]),G.uP[T]=0);var h=K.length(p);h>.001&&(K.scale(p,p,G.zL),G.Ay&&G.Ay(p),G.restitution>0&&h>U.minBounceImpulse&&(K.scale(p,p,G.restitution),G.applyImpulse(p)));var v=K.squaredLength(G.uP);v>1e-5&&G.dP();U.Py&&U.Py(G)?(G.loadFromCopy(N),G.rolledBackLastTick=!0):G.rolledBackLastTick=!1}(this,C,U,G)))};var o=K.create([0,0,0]);var w=K.create();function S(U,G,C,L,X){var l=C.resting[G],t=L[G];if(!C.alwaysApplyHorizFriction||1!==G){if(0===l)return;if(l*t<=0)return}K.i(v,C.uP),v[G]=0;var E=K.length(v);if(!B(E,0)){var P=Math.abs(C.friction*U.gravity[G]*X),O=E>P?(E-P)/E:0;C.uP[(G+1)%3]*=O,C.uP[(G+2)%3]*=O}}var v=K.create();function u(U,G,C,L,X){return K.set(L,0,0,0),P(U.testSolid,G,C,(function(U,G,C,l){L[G]=C,l[G]=0,X||(l[0]=0,l[1]=0,l[2]=0)}))}var d=new E([],[]),g=K.create(),Z=K.create(),F=K.create(),q=K.create();var a=K.create(),k=new E([],[]),n=K.create();function Q(U,G,C,L){return U.testSolid(Math.floor(G),Math.floor(C-1),Math.floor(L))}var mU=K.create();function B(U,G){return Math.abs(U-G)<1e-5}function M(U,G){for(var C=0;C<3;C++)U.base[C]=G.base[C],U.max[C]=G.max[C],U.SO[C]=G.SO[C]}var z=function(U){}},14452:U=>{"use strict";U.exports=function(U,G,C,L){var X=self||window;try{try{var l;try{l=new X.Blob([U])}catch(P){(l=new(X.BlobBuilder||X.WebKitBlobBuilder||X.MozBlobBuilder||X.MSBlobBuilder)).append(U),l=l.getBlob()}var t=X.URL||X.webkitURL,E=t.createObjectURL(l),K=new X[G](E,C);return t.revokeObjectURL(E),K}catch(P){return new X[G]("data:application/javascript,".concat(encodeURIComponent(U)),C)}}catch(P){if(!L)throw Error("Inline worker is not supported");return new X[G](L,C)}}},13643:(U,G,C)=>{"use strict";function L(U,G,C,L,X){var l={};return Object.keys(L).forEach((function(U){l[U]=L[U]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=C.slice().reverse().reduce((function(C,L){return L(U,G,C)||C}),l),X&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(X):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(U,G,l),l=null),l}C.d(G,{c:()=>L})},13634:(U,G,C)=>{"use strict";function L(U,G,C,L){C&&Object.defineProperty(U,G,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(L):void 0})}C.d(G,{e:()=>L})},14629:(U,G,C)=>{"use strict";C.d(G,{e:()=>t,i:()=>T,j:()=>E,m:()=>l,n:()=>K,o:()=>X,r:()=>P,t:()=>O});var L=C(13084);class X{constructor(){this._easingMode=X.EASINGMODE_EASEIN}setEasingMode(U){const G=Math.min(Math.max(U,0),2);this._easingMode=G}getEasingMode(){return this._easingMode}easeInCore(U){throw new Error("You must implement this method")}ease(U){switch(this._easingMode){case X.EASINGMODE_EASEIN:return this.easeInCore(U);case X.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-U)}return U>=.5?.5*(1-this.easeInCore(2*(1-U)))+.5:.5*this.easeInCore(2*U)}}X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2;class l extends X{easeInCore(U){return U=Math.max(0,Math.min(1,U)),1-Math.sqrt(1-U*U)}}class t extends X{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=U}easeInCore(U){const G=Math.max(0,this.amplitude);return Math.pow(U,3)-U*G*Math.sin(3.141592653589793*U)}}class E extends X{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=U,this.bounciness=G}easeInCore(U){const G=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const L=Math.pow(C,G),X=1-C,l=(1-L)/X+.5*L,t=U*l,E=Math.log(-t*(1-C)+1)/Math.log(C),K=Math.floor(E),P=K+1,O=(1-Math.pow(C,K))/(X*l),T=.5*(O+(1-Math.pow(C,P))/(X*l)),D=U-T,y=T-O;return-Math.pow(1/C,G-K)/(y*y)*(D-y)*(D+y)}}class K extends X{easeInCore(U){return U*U*U}}class P extends X{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=U,this.springiness=G}easeInCore(U){let G;const C=Math.max(0,this.oscillations),L=Math.max(0,this.springiness);return G=0==L?U:(Math.exp(L*U)-1)/(Math.exp(L)-1),G*Math.sin((6.283185307179586*C+1.5707963267948966)*U)}}class O extends X{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=U}easeInCore(U){return this.exponent<=0?U:(Math.exp(this.exponent*U)-1)/(Math.exp(this.exponent)-1)}}class T extends X{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=U,this.y1=G,this.x2=C,this.y2=L}easeInCore(U){return L.d.Interpolate(U,this.x1,this.y1,this.x2,this.y2)}}},14054:(U,G,C)=>{"use strict";C.d(G,{d:()=>t});var L=C(12896),X=C(12907),l=C(13274);class t extends l.e{get _matrix(){return this._compose(),this.cD}set _matrix(U){(U.updateFlag!==this.cD.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.cD.L(U),this._markAsDirtyAndDecompose())}constructor(U,G){var C;let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(U,G.wU(),!1),this.name=U,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=G,this.cD=null!==(C=null===l||void 0===l?void 0:l.clone())&&void 0!==C?C:L.Matrix.Identity(),this._restMatrix=null!==t&&void 0!==t?t:this.cD.clone(),this._bindMatrix=null!==E&&void 0!==E?E:this.cD.clone(),this._index=K,this._absoluteMatrix=new L.Matrix,this._absoluteBindMatrix=new L.Matrix,this._absoluteInverseBindMatrix=new L.Matrix,this._finalMatrix=new L.Matrix,G.bones.push(this),this.setParent(X,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(U){this.setParent(U)}setParent(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==U){if(this.parent){const U=this.parent.children.indexOf(this);-1!==U&&this.parent.children.splice(U,1)}this._parentNode=U,this.parent&&this.parent.children.push(this),G&&this._updateAbsoluteBindMatrices(),this.IO()}}getLocalMatrix(){return this._compose(),this.cD}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(U){this._restMatrix.L(U)}setRestPose(U){this.setRestMatrix(U)}getBindPose(){return this.getBindMatrix()}setBindMatrix(U){this.YE(U)}setBindPose(U){this.setBindMatrix(U)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){var U;const G=L.TmpVectors.pG[0],C=L.TmpVectors.Quaternion[0],X=L.TmpVectors.pG[1];this.getRestMatrix().decompose(G,C,X),this._linkedTransformNode.position.L(X),this._linkedTransformNode.rotationQuaternion=null!==(U=this._linkedTransformNode.rotationQuaternion)&&void 0!==U?U:L.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.L(C),this._linkedTransformNode.fE.L(G)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(U){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=U,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.oK}set position(U){this._decompose(),this.oK.L(U),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(U){this.setRotation(U)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(U){this.setRotationQuaternion(U)}get fE(){return this.getScale()}set fE(U){this.setScale(U)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=L.pG.Zero(),this._localRotation=L.Quaternion.Zero(),this.oK=L.pG.Zero()),this.cD.decompose(this._localScaling,this._localRotation,this.oK))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,L.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.oK,this.cD)):this._needToCompose=!1)}YE(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.L(U),G&&this._updateAbsoluteBindMatrices(),C?this._matrix=U:this.IO()}_updateAbsoluteBindMatrices(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U||(U=this._bindMatrix),this.parent?U.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.L(U),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),G)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}IO(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.IO(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.IO(),this._needToDecompose=!0}_updatePosition(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=this.getLocalMatrix();if(0==G)X?(l.addAtIndex(12,U.x),l.addAtIndex(13,U.y),l.addAtIndex(14,U.z)):l.setTranslationFromFloats(U.x,U.y,U.z);else{let G=null;C&&(G=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=t._TmpMats[0],K=t._TmpVecs[0];this.parent?C&&G?(E.L(this.parent.getAbsoluteMatrix()),E.multiplyToRef(G,E)):E.L(this.parent.getAbsoluteMatrix()):L.Matrix.IdentityToRef(E),X&&E.setTranslationFromFloats(0,0,0),E.invert(),L.pG.TransformCoordinatesToRef(U,E,K),X?(l.addAtIndex(12,K.x),l.addAtIndex(13,K.y),l.addAtIndex(14,K.z)):l.setTranslationFromFloats(K.x,K.y,K.z)}this._markAsDirtyAndDecompose()}translate(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,G,C,!0)}setPosition(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,G,C,!1)}setAbsolutePosition(U,G){this.setPosition(U,1,G)}scale(U,G,C){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=this.getLocalMatrix(),E=t._TmpMats[0];L.Matrix.ScalingToRef(U,G,C,E),E.multiplyToRef(l,l),E.invert();for(const L of this.children){const X=L.getLocalMatrix();X.multiplyToRef(E,X),X.multiplyAtIndex(12,U),X.multiplyAtIndex(13,G),X.multiplyAtIndex(14,C),L._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),X)for(const L of this.children)L.scale(U,G,C,X)}setScale(U){this._decompose(),this._localScaling.L(U),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(U){this._decompose(),U.L(this._localScaling)}setYawPitchRoll(U,G,C){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4?arguments[4]:void 0;if(0===X){const E=t._TmpQuat;return L.Quaternion.RotationYawPitchRollToRef(U,G,C,E),void this.setRotationQuaternion(E,X,l)}const E=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,l))return;const K=t._TmpMats[1];L.Matrix.RotationYawPitchRollToRef(U,G,C,K),E.multiplyToRef(K,K),this._rotateWithMatrix(K,X,l)}rotate(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;const l=t._TmpMats[0];l.setTranslationFromFloats(0,0,0),L.Matrix.RotationAxisToRef(U,G,l),this._rotateWithMatrix(l,C,X)}setAxisAngle(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3?arguments[3]:void 0;if(0===C){const l=t._TmpQuat;return L.Quaternion.RotationAxisToRef(U,G,l),void this.setRotationQuaternion(l,C,X)}const l=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,X))return;const E=t._TmpMats[1];L.Matrix.RotationAxisToRef(U,G,E),l.multiplyToRef(E,E),this._rotateWithMatrix(E,C,X)}setRotation(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(U.y,U.x,U.z,G,C)}setRotationQuaternion(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===G)return this._decompose(),this._localRotation.L(U),void this._markAsDirtyAndCompose();const X=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,C))return;const l=t._TmpMats[1];L.Matrix.FromQuaternionToRef(U,l),X.multiplyToRef(l,l),this._rotateWithMatrix(l,G,C)}setRotationMatrix(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===G){const X=t._TmpQuat;return L.Quaternion.FromRotationMatrixToRef(U,X),void this.setRotationQuaternion(X,G,C)}const X=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,C))return;const l=t._TmpMats[1];l.L(U),X.multiplyToRef(U,l),this._rotateWithMatrix(l,G,C)}_rotateWithMatrix(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const L=this.getLocalMatrix(),X=L.m[12],l=L.m[13],E=L.m[14],K=this.getParent(),P=t._TmpMats[3],O=t._TmpMats[4];K&&1==G?(C?(P.L(C.getWorldMatrix()),K.getAbsoluteMatrix().multiplyToRef(P,P)):P.L(K.getAbsoluteMatrix()),O.L(P),O.invert(),L.multiplyToRef(P,L),L.multiplyToRef(U,L),L.multiplyToRef(O,L)):1==G&&C?(P.L(C.getWorldMatrix()),O.L(P),O.invert(),L.multiplyToRef(P,L),L.multiplyToRef(U,L),L.multiplyToRef(O,L)):L.multiplyToRef(U,L),L.setTranslationFromFloats(X,l,E),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(U,G){const C=t._TmpMats[2];return U.L(this.getAbsoluteMatrix()),G?(U.multiplyToRef(G.getWorldMatrix(),U),L.Matrix.ScalingToRef(G.fE.x,G.fE.y,G.fE.z,C)):L.Matrix.IdentityToRef(C),U.invert(),!isNaN(U.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyToRef(C,U),!0)}IX(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=L.pG.Zero();return this.getPositionToRef(U,G,C),C}getPositionToRef(){let U=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const U=this.getLocalMatrix();G.x=U.m[12],G.y=U.m[13],G.z=U.m[14]}else{let C=null;U&&(C=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let L=t._TmpMats[0];U&&C?(L.L(this.getAbsoluteMatrix()),L.multiplyToRef(C,L)):L=this.getAbsoluteMatrix(),G.x=L.m[12],G.y=L.m[13],G.z=L.m[14]}}getAbsolutePosition(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const G=L.pG.Zero();return this.getPositionToRef(1,U,G),G}getAbsolutePositionToRef(U,G){this.getPositionToRef(1,U,G)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.cD.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.L(this.cD);const U=this._skeleton.getPoseMatrix();U&&this._absoluteMatrix.multiplyToRef(U,this._absoluteMatrix)}const U=this.children,G=U.length;for(let C=0;C<G;C++)U[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}WK(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=L.pG.Zero();return this.getDirectionToRef(U,G,C),C}getDirectionToRef(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,X=null;G&&(X=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=t._TmpMats[0];l.L(this.getAbsoluteMatrix()),G&&X&&l.multiplyToRef(X,l),L.pG.TransformNormalToRef(U,l,C),C.normalize()}getRotation(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=L.pG.Zero();return this.getRotationToRef(U,G,C),C}getRotationToRef(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const L=t._TmpQuat;this.getRotationQuaternionToRef(U,G,L),L.toEulerAnglesToRef(C)}getRotationQuaternion(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=L.Quaternion.Identity();return this.getRotationQuaternionToRef(U,G,C),C}getRotationQuaternionToRef(){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),G.L(this._localRotation);else{const C=t._TmpMats[0],L=this.getAbsoluteMatrix();U?L.multiplyToRef(U.getWorldMatrix(),C):C.L(L),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,G,void 0)}}getRotationMatrix(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1?arguments[1]:void 0;const C=L.Matrix.Identity();return this.getRotationMatrixToRef(U,G,C),C}getRotationMatrixToRef(){let U=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(G);else{const C=t._TmpMats[0],L=this.getAbsoluteMatrix();U?L.multiplyToRef(U.getWorldMatrix(),C):C.L(L),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(G)}}getAbsolutePositionFromLocal(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=L.pG.Zero();return this.getAbsolutePositionFromLocalToRef(U,G,C),C}getAbsolutePositionFromLocalToRef(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,X=null;G&&(X=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=t._TmpMats[0];l.L(this.getAbsoluteMatrix()),G&&X&&l.multiplyToRef(X,l),L.pG.TransformCoordinatesToRef(U,l,C)}getLocalPositionFromAbsolute(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=L.pG.Zero();return this.getLocalPositionFromAbsoluteToRef(U,G,C),C}getLocalPositionFromAbsoluteToRef(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,X=null;G&&(X=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=t._TmpMats[0];l.L(this.getAbsoluteMatrix()),G&&X&&l.multiplyToRef(X,l),l.invert(),L.pG.TransformCoordinatesToRef(U,l,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const U=this._skeleton.bones.indexOf(this);if(-1!==U&&this._skeleton.bones.splice(U,1),this._parentNode&&this._parentNode.children){const U=this._parentNode.children,G=U.indexOf(this);-1!==G&&U.splice(G,1)}super.dispose()}}t._TmpVecs=(0,X.e)(2,L.pG.Zero),t._TmpQuat=L.Quaternion.Identity(),t._TmpMats=(0,X.e)(5,L.Matrix.Identity)},14626:(U,G,C)=>{"use strict";C.d(G,{e:()=>a});var L=C(12876),X=C(12884),l=C(12721),t=C(12896),E=C(12911),K=C(13274),P=C(13306),O=C(13134),T=C(12739),D=C(12898);class y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(U){this._idleRotationSpeed=U}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(U){this._idleRotationWaitTime=U}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(U){this._idleRotationSpinupTime=U}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(U){this._attachedCamera=U;const G=this._attachedCamera.wU();this._onPrePointerObservableObserver=G.onPrePointerObservable.add((U=>{U.type!==O.e.POINTERDOWN?U.type===O.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const U=T.d.Now;let G=0;null!=this._lastFrameTime&&(G=U-this._lastFrameTime),this._lastFrameTime=U,this._applyUserInteraction();const C=U-this._lastInteractionTime-this._idleRotationWaitTime,L=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*L,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(G/1e3))}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.wU();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(U){this._lastInteractionTime=null!==U&&void 0!==U?U:T.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<D.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let U=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(U=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?U:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=T.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var V=C(14629),p=C(13392);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(U){if(this._autoTransitionRange===U)return;this._autoTransitionRange=U;const G=this._attachedCamera;G&&(U?this._onMeshTargetChangedObserver=G.onMeshTargetChangedObservable.add((U=>{if(U&&(U.eE(!0),U.getBoundingInfo)){const G=U.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*G,this.upperRadiusTransitionRange=.05*G}})):this._onMeshTargetChangedObserver&&G.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(U){this._attachedCamera=U,this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(U){return!!this._attachedCamera&&(this._attachedCamera.radius===U&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(U){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=p.d.CreateAnimation("radius",p.d.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const G=p.d.TransitionTo("radius",this._attachedCamera.radius+U,this._attachedCamera,this._attachedCamera.wU(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));G&&this._animatables.push(G)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new V.e(.3),I.EasingMode=V.o.EASINGMODE_EASEOUT;class H{constructor(){this.onTargetFramingAnimationEndObservable=new l.e,this._mode=H.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(U){this._mode=U}get mode(){return this._mode}set radiusScale(U){this._radiusScale=U}get radiusScale(){return this._radiusScale}set positionScale(U){this._positionScale=U}get positionScale(){return this._positionScale}set defaultElevation(U){this._defaultElevation=U}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(U){this._elevationReturnTime=U}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(U){this._elevationReturnWaitTime=U}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(U){this._framingTime=U}get framingTime(){return this._framingTime}init(){}attach(U){this._attachedCamera=U;const G=this._attachedCamera.wU();H.EasingFunction.setEasingMode(H.EasingMode),this._onPrePointerObservableObserver=G.onPrePointerObservable.add((U=>{U.type!==O.e.POINTERDOWN?U.type===O.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((U=>{U&&U.getBoundingInfo&&this.zoomOnMesh(U,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.wU();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.eE(!0);const L=U.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(L.minimumWorld,L.maximumWorld,G,C)}zoomOnMeshHierarchy(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.eE(!0);const L=U.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(L.min,L.max,G,C)}zoomOnMeshesHierarchy(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new t.pG(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new t.pG(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let l=0;l<U.length;l++){const G=U[l].getHierarchyBoundingVectors(!0);t.pG.CheckExtends(G.min,L,X),t.pG.CheckExtends(G.max,L,X)}this.zoomOnBoundingInfo(L,X,G,C)}zoomOnBoundingInfo(U,G){let C,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const l=U.y,E=l+(G.y-l)*this._positionScale,K=G.IG(U).scale(.5);if(!isFinite(E))return!1;if(L)C=new t.pG(0,E,0);else{const G=U.add(K);C=new t.pG(G.x,E,G.z)}this._vectorTransition||(this._vectorTransition=p.d.CreateAnimation("target",p.d.ANIMATIONTYPE_VECTOR3,60,H.EasingFunction)),this._betaIsAnimating=!0;let P=p.d.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.wU(),60,this._vectorTransition,this._framingTime);P&&this._animatables.push(P);let O=0;if(this._mode===H.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(U,G);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=K.length()+this._attachedCamera.AE),O=C}else this._mode===H.IgnoreBoundsSizeMode&&(O=this._calculateLowerRadiusFromModelBoundingSphere(U,G),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.AE));if(this.autoCorrectCameraLimitsAndSensibility){const C=G.IG(U).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/O}return this._radiusTransition||(this._radiusTransition=p.d.CreateAnimation("radius",p.d.ANIMATIONTYPE_FLOAT,60,H.EasingFunction)),P=p.d.TransitionTo("radius",O,this._attachedCamera,this._attachedCamera.wU(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),X&&X(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),P&&this._animatables.push(P),!0}_calculateLowerRadiusFromModelBoundingSphere(U,G){const C=this._attachedCamera;if(!C)return 0;let L=C._calculateLowerRadiusFromModelBoundingSphere(U,G,this._radiusScale);return C.lowerRadiusLimit&&this._mode===H.IgnoreBoundsSizeMode&&(L=L<C.lowerRadiusLimit?C.lowerRadiusLimit:L),C.upperRadiusLimit&&(L=L>C.upperRadiusLimit?C.upperRadiusLimit:L),L}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const U=T.d.Now-this._lastInteractionTime,G=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&U>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=p.d.CreateAnimation("beta",p.d.ANIMATIONTYPE_FLOAT,60,H.EasingFunction));const U=p.d.TransitionTo("beta",G,this._attachedCamera,this._attachedCamera.wU(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));U&&this._animatables.push(U)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=T.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}H.EasingFunction=new V.t,H.EasingMode=V.o.EASINGMODE_EASEINOUT,H.IgnoreBoundsSizeMode=0,H.FitFrustumSidesMode=1;var x=C(13310),h=C(13349),N=C(14050),b=C(12718);class o{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(U){U=b.Tools.BackCompatCameraNoPreventDefault(arguments);const G=this.camera.getEngine(),C=G.getInputElement();let L=0,X=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=l=>{var t,E;const K=l.event,P="touch"===K.pointerType;if(l.type!==O.e.POINTERMOVE&&-1===this.buttons.indexOf(K.button))return;const T=K.target;if(this._altKey=K.altKey,this._ctrlKey=K.ctrlKey,this._metaKey=K.metaKey,this._shiftKey=K.shiftKey,this._buttonsPressed=K.buttons,G.isPointerLock){const U=K.movementX,G=K.movementY;this.onTouch(null,U,G),this._pointA=null,this._pointB=null}else{if(l.type!==O.e.POINTERDOWN&&l.type!==O.e.POINTERDOUBLETAP&&P&&(null===(t=this._pointA)||void 0===t?void 0:t.pointerId)!==K.pointerId&&(null===(E=this._pointB)||void 0===E?void 0:E.pointerId)!==K.pointerId)return;if(l.type!==O.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!P)if(l.type===O.e.POINTERDOUBLETAP)this.onDoubleTap(K.pointerType);else if(l.type!==O.e.POINTERUP||this._currentMousePointerIdDown!==K.pointerId&&!P){if(l.type===O.e.POINTERMOVE)if(U||K.preventDefault(),this._pointA&&null===this._pointB){const U=K.clientX-this._pointA.x,G=K.clientY-this._pointA.y;this._pointA.x=K.clientX,this._pointA.y=K.clientY,this.onTouch(this._pointA,U,G)}else if(this._pointA&&this._pointB){const U=this._pointA.pointerId===K.pointerId?this._pointA:this._pointB;U.x=K.clientX,U.y=K.clientY;const G=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,t=G*G+C*C,E={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:K.pointerId,type:l.type};this.onMultiTouch(this._pointA,this._pointB,L,t,X,E),X=E,L=t}}else{try{null===T||void 0===T||T.releasePointerCapture(K.pointerId)}catch(D){}P||(this._pointB=null),G._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==K.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==K.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==L||X)&&(this.onMultiTouch(this._pointA,this._pointB,L,0,X,null),L=0,X=null),this._currentMousePointerIdDown=-1,this.onButtonUp(K),U||K.preventDefault()}else{try{null===T||void 0===T||T.setPointerCapture(K.pointerId)}catch(D){}if(null===this._pointA)this._pointA={x:K.clientX,y:K.clientY,pointerId:K.pointerId,type:K.pointerType};else{if(null!==this._pointB)return;this._pointB={x:K.clientX,y:K.clientY,pointerId:K.pointerId,type:K.pointerType}}-1!==this._currentMousePointerIdDown||P||(this._currentMousePointerIdDown=K.pointerId),this.onButtonDown(K),U||(K.preventDefault(),C&&C.focus())}}},this._observer=this.camera.wU()._inputManager._addCameraPointerObserver(this._pointerInput,O.e.POINTERDOWN|O.e.POINTERUP|O.e.POINTERMOVE|O.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,L=0,X=null,this.onLostFocus()},this._contextMenuBind=U=>this.onContextMenu(U),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const l=this.camera.wU().getEngine().getHostWindow();l&&b.Tools.RegisterTopRootEvents(l,[{name:"blur",handler:this._onLostFocus}])}XD(){if(this._onLostFocus){const U=this.camera.wU().getEngine().getHostWindow();U&&b.Tools.UnregisterTopRootEvents(U,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.wU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const U=this.camera.wU().getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(U){}onTouch(U,G,C){}onMultiTouch(U,G,C,L,X,l){}onContextMenu(U){U.preventDefault()}onButtonDown(U){}onButtonUp(U){}onLostFocus(){}}(0,L.d)([(0,X.H)()],o.prototype,"buttons",void 0);class w extends o{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(U,G){if(0!==this.panningSensibility&&U&&G){const C=G.x-U.x,L=G.y-U.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=L/this.panningSensibility}}_computePinchZoom(U,G){const C=this.camera.radius||w.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(U)/Math.sqrt(G):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(G-U)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(G-U)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(U,G,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-G/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=G/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(U,G,C,L,X,l){0===C&&null===X||0===L&&null===l||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,L),this._computeMultiTouchPanning(X,l)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(L)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,L),this._isPinching=!0):this._computeMultiTouchPanning(X,l)):this.multiTouchPanning?this._computeMultiTouchPanning(X,l):this.pinchZoom&&this._computePinchZoom(C,L))}onButtonDown(U){this._isPanClick=U.button===this.camera._panningMouseButton}onButtonUp(U){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}w.MinimumRadiusForPinch=.001,(0,L.d)([(0,X.H)()],w.prototype,"buttons",void 0),(0,L.d)([(0,X.H)()],w.prototype,"angularSensibilityX",void 0),(0,L.d)([(0,X.H)()],w.prototype,"angularSensibilityY",void 0),(0,L.d)([(0,X.H)()],w.prototype,"pinchPrecision",void 0),(0,L.d)([(0,X.H)()],w.prototype,"pinchDeltaPercentage",void 0),(0,L.d)([(0,X.H)()],w.prototype,"useNaturalPinchZoom",void 0),(0,L.d)([(0,X.H)()],w.prototype,"pinchZoom",void 0),(0,L.d)([(0,X.H)()],w.prototype,"panningSensibility",void 0),(0,L.d)([(0,X.H)()],w.prototype,"multiTouchPanning",void 0),(0,L.d)([(0,X.H)()],w.prototype,"multiTouchPanAndZoom",void 0),N.b.ArcRotateCameraPointersInput=w;var S=C(13138);class v{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(U){U=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.wU(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((G=>{const C=G.event;if(!C.metaKey)if(G.type===S.b.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(U||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const G=this._keys.indexOf(C.keyCode);G>=0&&this._keys.splice(G,1),C.preventDefault&&(U||C.preventDefault())}})))}XD(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let G=0;G<this._keys.length;G++){const C=this._keys[G];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX-=1/this.panningSensibility:U.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset+=1/this.zoomingSensibility:U.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX+=1/this.panningSensibility:U.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset-=1/this.zoomingSensibility:U.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&U.useInputToRestoreState&&U.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,L.d)([(0,X.H)()],v.prototype,"keysUp",void 0),(0,L.d)([(0,X.H)()],v.prototype,"keysDown",void 0),(0,L.d)([(0,X.H)()],v.prototype,"keysLeft",void 0),(0,L.d)([(0,X.H)()],v.prototype,"keysRight",void 0),(0,L.d)([(0,X.H)()],v.prototype,"keysReset",void 0),(0,L.d)([(0,X.H)()],v.prototype,"panningSensibility",void 0),(0,L.d)([(0,X.H)()],v.prototype,"zoomingSensibility",void 0),(0,L.d)([(0,X.H)()],v.prototype,"useAltToZoom",void 0),(0,L.d)([(0,X.H)()],v.prototype,"angularSpeed",void 0),N.b.ArcRotateCameraKeyboardMoveInput=v;var u=C(12940),d=C(13144);class g{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new t.pG(0,0,0),this._globalOffset=new t.pG(0,0,0),this._inertialPanning=t.pG.Zero()}_computeDeltaFromMouseWheelLegacyEvent(U,G){let C=0;const L=.01*U*this.wheelDeltaPercentage*G;return C=U>0?L/(1+this.wheelDeltaPercentage):L*(1+this.wheelDeltaPercentage),C}attachControl(U){U=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=G=>{if(G.type!==O.e.POINTERWHEEL)return;const C=G.event;let L=0;const X=C.deltaMode===d.e.DOM_DELTA_LINE?40:1,l=-C.deltaY*X;if(this.customComputeDeltaFromMouseWheel)L=this.customComputeDeltaFromMouseWheel(l,this,C);else if(this.wheelDeltaPercentage){if(L=this._computeDeltaFromMouseWheelLegacyEvent(l,this.camera.radius),L>0){let U=this.camera.radius,G=this.camera.inertialRadiusOffset+L;for(let C=0;C<20&&!(U<=G)&&!(Math.abs(G*this.camera.inertia)<.001);C++)U-=G,G*=this.camera.inertia;U=(0,E.Clamp)(U,0,Number.MAX_VALUE),L=this._computeDeltaFromMouseWheelLegacyEvent(l,U)}}else L=l/(40*this.wheelPrecision);L&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(L)):this.camera.inertialRadiusOffset+=L),C.preventDefault&&(U||C.preventDefault())},this._observer=this.camera.wU()._inputManager._addCameraPointerObserver(this._wheel,O.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.rE(0)}XD(){this._observer&&(this.camera.wU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const U=this.camera;0+U.inertialAlphaOffset+U.inertialBetaOffset+U.inertialRadiusOffset&&(this._updateHitPlane(),U.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(U.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const U=this.camera,G=U.target.IG(U.position);this._hitPlane=u.b.FromPositionAndNormal(U.target,G)}_getPosition(){const U=this.camera,G=U.wU(),C=G.createPickingRay(G.pointerX,G.pointerY,t.Matrix.Identity(),U,!1);0===U.targetScreenOffset.x&&0===U.targetScreenOffset.y||(this._viewOffset.set(U.targetScreenOffset.x,U.targetScreenOffset.y,0),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),this._globalOffset=t.pG.TransformNormal(this._viewOffset,U._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let L=0;var X;this._hitPlane&&(L=null!==(X=C.intersectsPlane(this._hitPlane))&&void 0!==X?X:0);return C.origin.addInPlace(C.direction.scaleInPlace(L))}_zoomToMouse(U){const G=this.camera,C=1-G.inertia;if(G.lowerRadiusLimit){var L;const X=null!==(L=G.lowerRadiusLimit)&&void 0!==L?L:0;G.radius-(G.inertialRadiusOffset+U)/C<X&&(U=(G.radius-X)*C-G.inertialRadiusOffset)}if(G.upperRadiusLimit){var X;const L=null!==(X=G.upperRadiusLimit)&&void 0!==X?X:0;G.radius-(G.inertialRadiusOffset+U)/C>L&&(U=(G.radius-L)*C-G.inertialRadiusOffset)}const l=U/C/G.radius,E=this._getPosition(),K=t.TmpVectors.pG[6];E.subtractToRef(G.target,K),K.scaleInPlace(l),K.scaleInPlace(C),this._inertialPanning.addInPlace(K),G.inertialRadiusOffset+=U}_zeroIfClose(U){Math.abs(U.x)<D.d&&(U.x=0),Math.abs(U.y)<D.d&&(U.y=0),Math.abs(U.z)<D.d&&(U.z=0)}}(0,L.d)([(0,X.H)()],g.prototype,"wheelPrecision",void 0),(0,L.d)([(0,X.H)()],g.prototype,"zoomToMouseLocation",void 0),(0,L.d)([(0,X.H)()],g.prototype,"wheelDeltaPercentage",void 0),N.b.ArcRotateCameraMouseWheelInput=g;class Z extends N.e{constructor(U){super(U)}addMouseWheel(){return this.add(new g),this}addPointers(){return this.add(new w),this}addKeyboard(){return this.add(new v),this}}var F=C(12850);function q(U,G){return isNaN(U)?G:U}K.e.AddNodeConstructor("ArcRotateCamera",((U,G)=>()=>new a(U,0,0,1,t.pG.Zero(),G)));class a extends h.b{get target(){return this._target}set target(U){this.setTarget(U)}get targetHost(){return this._targetHost}set targetHost(U){U&&this.setTarget(U)}getTarget(){return this.target}get position(){return this._position}set position(U){this.setPosition(U)}set upVector(U){this._upToYMatrix||(this._yToUpMatrix=new t.Matrix,this._upToYMatrix=new t.Matrix,this._upVector=t.pG.Zero()),U.normalize(),this._upVector.L(U),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){t.Matrix.RotationAlignToRef(t.pG.UpReadOnly,this._upVector,this._yToUpMatrix),t.Matrix.RotationAlignToRef(this._upVector,t.pG.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityX:0}set angularSensibilityX(U){const G=this.inputs.attached.pointers;G&&(G.angularSensibilityX=U)}get angularSensibilityY(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityY:0}set angularSensibilityY(U){const G=this.inputs.attached.pointers;G&&(G.angularSensibilityY=U)}get pinchPrecision(){const U=this.inputs.attached.pointers;return U?U.pinchPrecision:0}set pinchPrecision(U){const G=this.inputs.attached.pointers;G&&(G.pinchPrecision=U)}get pinchDeltaPercentage(){const U=this.inputs.attached.pointers;return U?U.pinchDeltaPercentage:0}set pinchDeltaPercentage(U){const G=this.inputs.attached.pointers;G&&(G.pinchDeltaPercentage=U)}get useNaturalPinchZoom(){const U=this.inputs.attached.pointers;return!!U&&U.useNaturalPinchZoom}set useNaturalPinchZoom(U){const G=this.inputs.attached.pointers;G&&(G.useNaturalPinchZoom=U)}get panningSensibility(){const U=this.inputs.attached.pointers;return U?U.panningSensibility:0}set panningSensibility(U){const G=this.inputs.attached.pointers;G&&(G.panningSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const G=this.inputs.attached.keyboard;G&&(G.keysUp=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const G=this.inputs.attached.keyboard;G&&(G.keysDown=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const G=this.inputs.attached.keyboard;G&&(G.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const G=this.inputs.attached.keyboard;G&&(G.keysRight=U)}get wheelPrecision(){const U=this.inputs.attached.mousewheel;return U?U.wheelPrecision:0}set wheelPrecision(U){const G=this.inputs.attached.mousewheel;G&&(G.wheelPrecision=U)}get zoomToMouseLocation(){const U=this.inputs.attached.mousewheel;return!!U&&U.zoomToMouseLocation}set zoomToMouseLocation(U){const G=this.inputs.attached.mousewheel;G&&(G.zoomToMouseLocation=U)}get wheelDeltaPercentage(){const U=this.inputs.attached.mousewheel;return U?U.wheelDeltaPercentage:0}set wheelDeltaPercentage(U){const G=this.inputs.attached.mousewheel;G&&(G.wheelDeltaPercentage=U)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(U){U!==this.useBouncingBehavior&&(U?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(U){U!==this.useFramingBehavior&&(U?(this._framingBehavior=new H,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(U){U!==this.useAutoRotationBehavior&&(U?(this._autoRotationBehavior=new y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(U,G,C,L,X,E){var K;let P=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(U,t.pG.Zero(),E,P),K=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=t.pG.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=t.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new t.Matrix,this.panningAxis=new t.pG(1,1,0),this._transformedDirection=new t.pG,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new l.e,this.checkCollisions=!1,this.collisionRadius=new t.pG(.5,.5,.5),this._previousPosition=t.pG.Zero(),this._collisionVelocity=t.pG.Zero(),this._newPosition=t.pG.Zero(),this._computationVector=t.pG.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new t.pG(NaN,NaN,NaN),this._goalTargetScreenOffset=new t.Vector2(NaN,NaN),this._onCollisionPositionChange=function(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(K.setPosition(G),K.Ay&&K.Ay(C)):K._previousPosition.L(K._position);const L=Math.cos(K.alpha),X=Math.sin(K.alpha),l=Math.cos(K.beta);let t=Math.sin(K.beta);0===t&&(t=1e-4);const E=K._getTargetPosition();K._computationVector.WE(K.radius*L*t,K.radius*l,K.radius*X*t),E.addToRef(K._computationVector,K._newPosition),K._position.L(K._newPosition);let P=K.upVector;K.allowUpsideDown&&K.beta<0&&(P=P.clone(),P=P.negate()),K._computeViewMatrix(K._position,E,P),K._viewMatrix.addAtIndex(12,K.targetScreenOffset.x),K._viewMatrix.addAtIndex(13,K.targetScreenOffset.y),K._collisionTriggered=!1},this._target=t.pG.Zero(),X&&this.setTarget(X),this.alpha=G,this.beta=C,this.radius=L,this.getViewMatrix(),this.inputs=new Z(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new t.pG(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=t.Vector2.Zero()}_updateCache(U){U||super._updateCache(),this._cache._target.L(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.L(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const U=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?U.addToRef(this._targetBoundingCenter,this._target):this._target.L(U)}const U=this._getLockedTargetPosition();return U||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>D.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){var U,G,C,L,X,l,t;let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,y=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=y?this._currentInterpolationFactor=y:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=q(K,this._goalAlpha),this._goalBeta=q(P,this._goalBeta),this._goalRadius=q(O,this._goalRadius),this._goalTarget.set(q(T.x,this._goalTarget.x),q(T.y,this._goalTarget.y),q(T.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(q(D.x,this._goalTargetScreenOffset.x),q(D.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,E.Clamp)(this._goalAlpha,null!==(U=this.lowerAlphaLimit)&&void 0!==U?U:-1/0,null!==(G=this.upperAlphaLimit)&&void 0!==G?G:1/0),this._goalBeta=(0,E.Clamp)(this._goalBeta,null!==(C=this.lowerBetaLimit)&&void 0!==C?C:-1/0,null!==(L=this.upperBetaLimit)&&void 0!==L?L:1/0),this._goalRadius=(0,E.Clamp)(this._goalRadius,null!==(X=this.lowerRadiusLimit)&&void 0!==X?X:-1/0,null!==(l=this.upperRadiusLimit)&&void 0!==l?l:1/0),this._goalTarget.y=(0,E.Clamp)(this._goalTarget.y,null!==(t=this.lowerTargetYLimit)&&void 0!==t?t:-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(U,G){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const X=arguments;G=b.Tools.BackCompatCameraNoPreventDefault(X),this._useCtrlForPanning=C,this._panningMouseButton=L,"boolean"===typeof X[0]&&(X.length>1&&(this._useCtrlForPanning=X[1]),X.length>2&&(this._panningMouseButton=X[2])),this.inputs.attachElement(G),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}XD(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let U=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){U=!0;const G=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let L=this.inertialAlphaOffset*C;this.beta<0&&(L*=-1),this.alpha+=L*G,this.beta+=this.inertialBetaOffset*G,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<D.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<D.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*D.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){U=!0;const G=new t.pG(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),G.multiplyInPlace(this.panningAxis),t.pG.TransformNormalToRef(G,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const U=this.upVector,G=t.pG.CrossToRef(this._transformedDirection,U,this._transformedDirection);t.pG.CrossToRef(U,G,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);t.pG.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.L(this._transformedDirection)}else{if(this.parent){const U=t.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(U),U.transposeToRef(U),t.pG.TransformCoordinatesToRef(this._transformedDirection,U,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*D.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*D.d&&(this.inertialPanningY=0)}if(U)this.stopInterpolation();else if(this._isInterpolating){let U=!1;const G=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-G/this._currentInterpolationFactor),L=q(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const G=t.TmpVectors.pG[0].set(q(this._goalTarget.x,this._target.x),q(this._goalTarget.y,this._target.y),q(this._goalTarget.z,this._target.z));t.pG.LerpToRef(this.target,G,C,this._target),10*t.pG.Distance(this.target,G)/L<D.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.L(G),this.setTarget(this.target,!1,!0,!0)):U=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const G=t.Quaternion.RotationAlphaBetaGammaToRef(q(this._goalAlpha,this.alpha),q(this._goalBeta,this.beta),0,t.TmpVectors.Quaternion[0]),L=t.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,t.TmpVectors.Quaternion[1]),X=t.Quaternion.SlerpToRef(L,G,C,t.TmpVectors.Quaternion[2]);X.normalize();const l=X.toAlphaBetaGammaToRef(t.TmpVectors.pG[0]);if(this.alpha=l.x,this.beta=l.y,X.isApprox(G,D.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const U=G.toAlphaBetaGammaToRef(t.TmpVectors.pG[0]);this.alpha=U.x,this.beta=U.y}else U=!0}if(isNaN(this._goalRadius)||(this.radius+=(L-this.radius)*C,Math.abs(L/this.radius-1)<D.d?(this._goalRadius=NaN,this.radius=L):U=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const G=t.TmpVectors.Vector2[0].set(q(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),q(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));t.Vector2.LerpToRef(this.targetScreenOffset,G,C,this.targetScreenOffset),t.Vector2.Distance(this.targetScreenOffset,G)<D.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.L(G)):U=!0}this._isInterpolating=U}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||t.pG.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const U=this.alpha;var G,C;this.alpha=function(U){let G=Math.PI/2;return 0===U.x&&0===U.z||(G=Math.acos(U.x/Math.sqrt(Math.pow(U.x,2)+Math.pow(U.z,2)))),U.z<0&&(G=2*Math.PI-G),G}(this._computationVector),this.beta=(G=this._computationVector.y,C=this.radius,Math.acos(G/C));const L=Math.round((U-this.alpha)/(2*Math.PI));this.alpha+=2*L*Math.PI,this._checkLimits()}setPosition(U){this._position.equals(U)||(this._position.L(U),this.rebuildAnglesAndRadius())}setTarget(U){var G;let C=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(X=null!==(G=this.overrideCloneAlphaBetaRadius)&&void 0!==G?G:X,U.eE)C&&U.getBoundingInfo?this._targetBoundingCenter=U.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,U.eE(),this._targetHost=U,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const G=U,C=this._getTargetPosition();if(C&&!L&&C.equals(G))return;this._targetHost=null,this._target=G,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}X||this.rebuildAnglesAndRadius()}_getViewMatrix(){const U=Math.cos(this.alpha),G=Math.sin(this.alpha),C=Math.cos(this.beta);let L=Math.sin(this.beta);0===L&&(L=1e-4),0===this.radius&&(this.radius=1e-4);const X=this._getTargetPosition();if(this._computationVector.WE(this.radius*U*L,this.radius*C,this.radius*G*L),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||t.pG.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),X.addToRef(this._computationVector,this._newPosition),this.wU().collisionsEnabled&&this.checkCollisions){const U=this.wU().collisionCoordinator;this._collider||(this._collider=U.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,U.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.L(this._newPosition);let U=this.upVector;this.allowUpsideDown&&L<0&&(U=U.negate()),this._computeViewMatrix(this._position,X,U),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.L(X),this._viewMatrix}zoomOn(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U=U||this.wU().meshes;const C=P.d.MinMax(U);let L=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(L=Math.max(Math.min(L,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=L*this.zoomOnFactor,this.mode===x.d.ORTHOGRAPHIC_CAMERA){const U=this.wU().getEngine().getAspectRatio(this),G=L*this.zoomOnFactor/2;this.orthoLeft=-G*U,this.orthoRight=G*U,this.orthoBottom=-G,this.orthoTop=G}this.focusOn({min:C.min,max:C.max,distance:L},G)}focusOn(U){let G,C,L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===U.min){const L=U||this.wU().meshes;G=P.d.MinMax(L),C=t.pG.Distance(G.min,G.max)}else{G=U,C=U.distance}this._target=P.d.Center(G),L||(this.maxZ=2*C)}createRigCamera(U,G){let C=0;switch(this.cameraRigMode){case x.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case x.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case x.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case x.d.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===G?1:-1);break;case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===G?-1:1)}const L=new a(U,this.alpha+C,this.beta,this.radius,this._target,this.wU());return L._cameraRigParams={},L.isRigCamera=!0,L.rigParent=this,L.upVector=this.upVector,L.mode=this.mode,L.orthoLeft=this.orthoLeft,L.orthoRight=this.orthoRight,L.orthoBottom=this.orthoBottom,L.orthoTop=this.orthoTop,L}_updateRigCameras(){const U=this._rigCameras[0],G=this._rigCameras[1];switch(U.beta=G.beta=this.beta,this.cameraRigMode){case x.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case x.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case x.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case x.d.RIG_MODE_VR:U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,G.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case x.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,G.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const L=t.pG.Distance(U,G),X=this.wU().getEngine().getAspectRatio(this),l=Math.tan(this.fov/2),E=l*X,K=.5*L*C,P=K*Math.sqrt(1+1/(E*E)),O=K*Math.sqrt(1+1/(l*l));return Math.max(P,O)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,L.d)([(0,X.H)()],a.prototype,"alpha",void 0),(0,L.d)([(0,X.H)()],a.prototype,"beta",void 0),(0,L.d)([(0,X.H)()],a.prototype,"radius",void 0),(0,L.d)([(0,X.H)()],a.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,L.d)([(0,X.E)("target")],a.prototype,"_target",void 0),(0,L.d)([(0,X.v)("targetHost")],a.prototype,"_targetHost",void 0),(0,L.d)([(0,X.H)()],a.prototype,"inertialAlphaOffset",void 0),(0,L.d)([(0,X.H)()],a.prototype,"inertialBetaOffset",void 0),(0,L.d)([(0,X.H)()],a.prototype,"inertialRadiusOffset",void 0),(0,L.d)([(0,X.H)()],a.prototype,"lowerAlphaLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"upperAlphaLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"lowerBetaLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"upperBetaLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"lowerRadiusLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"upperRadiusLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"lowerTargetYLimit",void 0),(0,L.d)([(0,X.H)()],a.prototype,"inertialPanningX",void 0),(0,L.d)([(0,X.H)()],a.prototype,"inertialPanningY",void 0),(0,L.d)([(0,X.H)()],a.prototype,"pinchToPanMaxDistance",void 0),(0,L.d)([(0,X.H)()],a.prototype,"panningDistanceLimit",void 0),(0,L.d)([(0,X.E)()],a.prototype,"panningOriginTarget",void 0),(0,L.d)([(0,X.H)()],a.prototype,"panningInertia",void 0),(0,L.d)([(0,X.H)()],a.prototype,"zoomToMouseLocation",null),(0,L.d)([(0,X.H)()],a.prototype,"zoomOnFactor",void 0),(0,L.d)([(0,X.C)()],a.prototype,"targetScreenOffset",void 0),(0,L.d)([(0,X.H)()],a.prototype,"allowUpsideDown",void 0),(0,L.d)([(0,X.H)()],a.prototype,"useInputToRestoreState",void 0),(0,L.d)([(0,X.H)()],a.prototype,"restoreStateInterpolationFactor",void 0),(0,F.e)("BABYLON.ArcRotateCamera",a)},14050:(U,G,C)=>{"use strict";C.d(G,{b:()=>t,e:()=>E});var L=C(12731),X=C(12928),l=C(13310),t={};class E{constructor(U){this.attachedToElement=!1,this.attached={},this.camera=U,this.checkInputs=()=>{}}add(U){const G=U.getSimpleName();this.attached[G]?L.d.Warn("camera input of type "+G+" already exists on camera"):(this.attached[G]=U,U.camera=this.camera,U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U))),this.attachedToElement&&U.attachControl(this.noPreventDefault))}remove(U){for(const G in this.attached){const C=this.attached[G];if(C===U)return C.XD(),C.camera=null,delete this.attached[G],void this.rebuildInputCheck()}}removeByType(U){for(const G in this.attached){const C=this.attached[G];C.getClassName()===U&&(C.XD(),C.camera=null,delete this.attached[G],this.rebuildInputCheck())}}_addCheckInputs(U){const G=this.checkInputs;return()=>{G(),U()}}attachInput(U){this.attachedToElement&&U.attachControl(this.noPreventDefault)}attachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){U=!l.d.ForceAttachControlToAlwaysPreventDefault&&U,this.attachedToElement=!0,this.noPreventDefault=U;for(const G in this.attached)this.attached[G].attachControl(U)}}detachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const G in this.attached)this.attached[G].XD(),U&&(this.attached[G].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const U in this.attached){const G=this.attached[U];G.checkInputs&&(this.checkInputs=this._addCheckInputs(G.checkInputs.bind(G)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(U){const G={};for(const C in this.attached){const U=this.attached[C],L=X.c.Serialize(U);G[U.getClassName()]=L}U.inputsmgr=G}parse(U){const G=U.inputsmgr;if(G){this.clear();for(const U in G){const C=t[U];if(C){const L=G[U],l=X.c.Parse((()=>new C),L,null);this.add(l)}}}else for(const C in this.attached){const G=t[this.attached[C].getClassName()];if(G){const L=X.c.Parse((()=>new G),U,null);this.remove(this.attached[C]),this.add(L)}}}}},14045:(U,G,C)=>{"use strict";C.d(G,{b:()=>o});var L=C(12876),X=C(12884),l=C(12896),t=C(13349),E=C(14050),K=C(13138),P=C(12718);class O{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(U){U=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.wU(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((G=>{const C=G.event;if(!C.metaKey)if(G.type===K.b.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),U||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const G=this._keys.indexOf(C.keyCode);G>=0&&this._keys.splice(G,1),U||C.preventDefault()}})))}XD(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let G=0;G<this._keys.length;G++){const C=this._keys[G],L=U._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?U._localDirection.WE(-L,0,0):-1!==this.keysUp.indexOf(C)?U._localDirection.WE(0,0,L):-1!==this.keysRight.indexOf(C)?U._localDirection.WE(L,0,0):-1!==this.keysDown.indexOf(C)?U._localDirection.WE(0,0,-L):-1!==this.keysUpward.indexOf(C)?U._localDirection.WE(0,L,0):-1!==this.keysDownward.indexOf(C)?U._localDirection.WE(0,-L,0):-1!==this.keysRotateLeft.indexOf(C)?(U._localDirection.WE(0,0,0),U.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(U._localDirection.WE(0,0,0),U.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(U._localDirection.WE(0,0,0),U.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(U._localDirection.WE(0,0,0),U.cameraRotation.x+=this._getLocalRotation()),U.wU().useRightHandedSystem&&(U._localDirection.z*=-1),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),l.pG.TransformNormalToRef(U._localDirection,U._cameraTransformMatrix,U._transformedDirection),U.cameraDirection.addInPlace(U._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const U=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*U}}(0,L.d)([(0,X.H)()],O.prototype,"keysUp",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysUpward",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysDown",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysDownward",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysLeft",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysRight",void 0),(0,L.d)([(0,X.H)()],O.prototype,"rotationSpeed",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysRotateLeft",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysRotateRight",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysRotateUp",void 0),(0,L.d)([(0,X.H)()],O.prototype,"keysRotateDown",void 0),E.b.FreeCameraKeyboardMoveInput=O;var T=C(12721),D=C(13134);class y{constructor(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=U,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new T.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(U){U=P.Tools.BackCompatCameraNoPreventDefault(arguments);const G=this.camera.getEngine(),C=G.getInputElement();this._pointerInput||(this._pointerInput=L=>{const X=L.event,l="touch"===X.pointerType;if(!this.touchEnabled&&l)return;if(L.type!==D.e.POINTERMOVE&&-1===this.buttons.indexOf(X.button))return;const t=X.target;if(L.type===D.e.POINTERDOWN){if(l&&-1!==this._activePointerId||!l&&-1!==this._currentActiveButton)return;this._activePointerId=X.pointerId;try{null===t||void 0===t||t.setPointerCapture(X.pointerId)}catch(E){}-1===this._currentActiveButton&&(this._currentActiveButton=X.button),this._previousPosition={x:X.clientX,y:X.clientY},U||(X.preventDefault(),C&&C.focus()),G.isPointerLock&&this._onMouseMove&&this._onMouseMove(L.event)}else if(L.type===D.e.POINTERUP){if(l&&this._activePointerId!==X.pointerId||!l&&this._currentActiveButton!==X.button)return;try{null===t||void 0===t||t.releasePointerCapture(X.pointerId)}catch(E){}this._currentActiveButton=-1,this._previousPosition=null,U||X.preventDefault(),this._activePointerId=-1}else if(L.type===D.e.POINTERMOVE&&(this._activePointerId===X.pointerId||!l))if(G.isPointerLock&&this._onMouseMove)this._onMouseMove(L.event);else if(this._previousPosition){const G=this.camera._calculateHandednessMultiplier(),C=(X.clientX-this._previousPosition.x)*G,L=X.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=L/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:L}),this._previousPosition={x:X.clientX,y:X.clientY},U||X.preventDefault()}}),this._onMouseMove=C=>{if(!G.isPointerLock)return;const L=this.camera._calculateHandednessMultiplier(),X=C.movementX*L;this.camera.cameraRotation.y+=X/this.angularSensibility;const l=C.movementY;this.camera.cameraRotation.x+=l/this.angularSensibility,this._previousPosition=null,U||C.preventDefault()},this._observer=this.camera.wU()._inputManager._addCameraPointerObserver(this._pointerInput,D.e.POINTERDOWN|D.e.POINTERUP|D.e.POINTERMOVE),C&&(this._contextMenuBind=U=>this.onContextMenu(U),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(U){U.preventDefault()}XD(){if(this._observer){if(this.camera.wU()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,L.d)([(0,X.H)()],y.prototype,"buttons",void 0),(0,L.d)([(0,X.H)()],y.prototype,"angularSensibility",void 0),E.b.FreeCameraMouseInput=y;var V,p=C(13144);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new T.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(U){U=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=G=>{if(G.type!==D.e.POINTERWHEEL)return;const C=G.event,L=C.deltaMode===p.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*L*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*L*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*L*C.deltaZ/this._normalize,C.preventDefault&&(U||C.preventDefault())},this._observer=this.camera.wU()._inputManager._addCameraPointerObserver(this._wheel,D.e.POINTERWHEEL)}XD(){this._observer&&(this.camera.wU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,L.d)([(0,X.H)()],I.prototype,"wheelPrecisionX",void 0),(0,L.d)([(0,X.H)()],I.prototype,"wheelPrecisionY",void 0),(0,L.d)([(0,X.H)()],I.prototype,"wheelPrecisionZ",void 0),function(U){U[U.MoveRelative=0]="MoveRelative",U[U.RotateRelative=1]="RotateRelative",U[U.MoveScene=2]="MoveScene"}(V||(V={}));class H extends I{constructor(){super(...arguments),this._moveRelative=l.pG.Zero(),this._rotateRelative=l.pG.Zero(),this._moveScene=l.pG.Zero(),this._wheelXAction=V.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=V.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(U){null===U&&this._wheelXAction!==V.MoveRelative||(this._wheelXAction=V.MoveRelative,this._wheelXActionCoordinate=U)}get wheelXMoveRelative(){return this._wheelXAction!==V.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(U){null===U&&this._wheelYAction!==V.MoveRelative||(this._wheelYAction=V.MoveRelative,this._wheelYActionCoordinate=U)}get wheelYMoveRelative(){return this._wheelYAction!==V.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(U){null===U&&this._wheelZAction!==V.MoveRelative||(this._wheelZAction=V.MoveRelative,this._wheelZActionCoordinate=U)}get wheelZMoveRelative(){return this._wheelZAction!==V.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(U){null===U&&this._wheelXAction!==V.RotateRelative||(this._wheelXAction=V.RotateRelative,this._wheelXActionCoordinate=U)}get wheelXRotateRelative(){return this._wheelXAction!==V.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(U){null===U&&this._wheelYAction!==V.RotateRelative||(this._wheelYAction=V.RotateRelative,this._wheelYActionCoordinate=U)}get wheelYRotateRelative(){return this._wheelYAction!==V.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(U){null===U&&this._wheelZAction!==V.RotateRelative||(this._wheelZAction=V.RotateRelative,this._wheelZActionCoordinate=U)}get wheelZRotateRelative(){return this._wheelZAction!==V.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(U){null===U&&this._wheelXAction!==V.MoveScene||(this._wheelXAction=V.MoveScene,this._wheelXActionCoordinate=U)}get wheelXMoveScene(){return this._wheelXAction!==V.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(U){null===U&&this._wheelYAction!==V.MoveScene||(this._wheelYAction=V.MoveScene,this._wheelYActionCoordinate=U)}get wheelYMoveScene(){return this._wheelYAction!==V.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(U){null===U&&this._wheelZAction!==V.MoveScene||(this._wheelZAction=V.MoveScene,this._wheelZActionCoordinate=U)}get wheelZMoveScene(){return this._wheelZAction!==V.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.rE(0),this._rotateRelative.rE(0),this._moveScene.rE(0),this._updateCamera(),this.camera.wU().useRightHandedSystem&&(this._moveRelative.z*=-1);const U=l.Matrix.Zero();this.camera.getViewMatrix().invertToRef(U);const G=l.pG.Zero();l.pG.TransformNormalToRef(this._moveRelative,U,G),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(G),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(U,G,C){if(0===U)return;if(null===G||null===C)return;let L=null;switch(G){case V.MoveRelative:L=this._moveRelative;break;case V.RotateRelative:L=this._rotateRelative;break;case V.MoveScene:L=this._moveScene}switch(C){case 0:L.set(U,0,0);break;case 1:L.set(0,U,0);break;case 2:L.set(0,0,U)}}}(0,L.d)([(0,X.H)()],H.prototype,"wheelXMoveRelative",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelYMoveRelative",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelZMoveRelative",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelXRotateRelative",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelYRotateRelative",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelZRotateRelative",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelXMoveScene",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelYMoveScene",null),(0,L.d)([(0,X.H)()],H.prototype,"wheelZMoveScene",null),E.b.FreeCameraMouseWheelInput=H;class x{constructor(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=U,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=P.Tools.IsSafari()}attachControl(U){U=P.Tools.BackCompatCameraNoPreventDefault(arguments);let G=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const L=C.event,X="mouse"===L.pointerType||this._isSafari&&"undefined"===typeof L.pointerType;if(this.allowMouse||!X)if(C.type===D.e.POINTERDOWN){if(U||L.preventDefault(),this._pointerPressed.push(L.pointerId),1!==this._pointerPressed.length)return;G={x:L.clientX,y:L.clientY}}else if(C.type===D.e.POINTERUP){U||L.preventDefault();const C=this._pointerPressed.indexOf(L.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;G=null,this._offsetX=null,this._offsetY=null}else if(C.type===D.e.POINTERMOVE){if(U||L.preventDefault(),!G)return;if(0!=this._pointerPressed.indexOf(L.pointerId))return;this._offsetX=L.clientX-G.x,this._offsetY=-(L.clientY-G.y)}}),this._observer=this.camera.wU()._inputManager._addCameraPointerObserver(this._pointerInput,D.e.POINTERDOWN|D.e.POINTERUP|D.e.POINTERMOVE),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.addEventListener("blur",this._onLostFocus)}}XD(){if(this._pointerInput){if(this._observer&&(this.camera.wU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const U=this.camera,G=U._calculateHandednessMultiplier();U.cameraRotation.y=G*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)U.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const G=U._computeLocalCameraSpeed(),C=new l.pG(0,0,0!==this.touchMoveSensibility?G*this._offsetY/this.touchMoveSensibility:0);l.Matrix.RotationYawPitchRollToRef(U.rotation.y,U.rotation.x,0,U._cameraRotationMatrix),U.cameraDirection.addInPlace(l.pG.TransformCoordinates(C,U._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,L.d)([(0,X.H)()],x.prototype,"touchAngularSensibility",void 0),(0,L.d)([(0,X.H)()],x.prototype,"touchMoveSensibility",void 0),E.b.FreeCameraTouchInput=x;class h extends E.e{constructor(U){super(U),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new O),this}addMouse(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new y(U),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new H,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new x),this}clear(){super.clear(),this._mouseInput=null}}var N=C(12850),b=C(12800);class o extends t.b{get angularSensibility(){const U=this.inputs.attached.mouse;return U?U.angularSensibility:0}set angularSensibility(U){const G=this.inputs.attached.mouse;G&&(G.angularSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const G=this.inputs.attached.keyboard;G&&(G.keysUp=U)}get keysUpward(){const U=this.inputs.attached.keyboard;return U?U.keysUpward:[]}set keysUpward(U){const G=this.inputs.attached.keyboard;G&&(G.keysUpward=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const G=this.inputs.attached.keyboard;G&&(G.keysDown=U)}get keysDownward(){const U=this.inputs.attached.keyboard;return U?U.keysDownward:[]}set keysDownward(U){const G=this.inputs.attached.keyboard;G&&(G.keysDownward=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const G=this.inputs.attached.keyboard;G&&(G.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const G=this.inputs.attached.keyboard;G&&(G.keysRight=U)}get keysRotateLeft(){const U=this.inputs.attached.keyboard;return U?U.keysRotateLeft:[]}set keysRotateLeft(U){const G=this.inputs.attached.keyboard;G&&(G.keysRotateLeft=U)}get keysRotateRight(){const U=this.inputs.attached.keyboard;return U?U.keysRotateRight:[]}set keysRotateRight(U){const G=this.inputs.attached.keyboard;G&&(G.keysRotateRight=U)}get keysRotateUp(){const U=this.inputs.attached.keyboard;return U?U.keysRotateUp:[]}set keysRotateUp(U){const G=this.inputs.attached.keyboard;G&&(G.keysRotateUp=U)}get keysRotateDown(){const U=this.inputs.attached.keyboard;return U?U.keysRotateDown:[]}set keysRotateDown(U){const G=this.inputs.attached.keyboard;G&&(G.keysRotateDown=U)}constructor(U,G,C){var L;super(U,G,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),L=this,this.ellipsoid=new l.pG(.5,1,.5),this.ellipsoidOffset=new l.pG(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=l.pG.Zero(),this._diffPosition=l.pG.Zero(),this._newPosition=l.pG.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L._newPosition.L(G),L._newPosition.subtractToRef(L._oldPosition,L._diffPosition),L._diffPosition.length()>b.b.CollisionsEpsilon&&(L.position.addToRef(L._diffPosition,L._deferredPositionUpdate),L._deferOnly?L._deferredUpdated=!0:L.position.L(L._deferredPositionUpdate),L.Ay&&C&&L.Ay(C))},this.inputs=new h(this),this.inputs.addKeyboard().addMouse()}attachControl(U,G){G=P.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(G)}XD(){this.inputs.detachElement(),this.cameraDirection=new l.pG(0,0,0),this.cameraRotation=new l.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(U){this._collisionMask=isNaN(U)?-1:U}_collideWithWorld(U){let G;G=this.parent?l.pG.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,G.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.wU().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let L=U;this.applyGravity&&(L=U.add(this.wU().gravity)),C.getNewPosition(this._oldPosition,L,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=l.pG.Zero(),this._transformedDirection=l.pG.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(U){this._needMoveForGravity=U}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.wU().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Np"}}(0,L.d)([(0,X.E)()],o.prototype,"ellipsoid",void 0),(0,L.d)([(0,X.E)()],o.prototype,"ellipsoidOffset",void 0),(0,L.d)([(0,X.H)()],o.prototype,"checkCollisions",void 0),(0,L.d)([(0,X.H)()],o.prototype,"applyGravity",void 0),(0,N.e)("BABYLON.FreeCamera",o)},14677:(U,G,C)=>{"use strict";C.d(G,{d:()=>l});var L=C(12982),X=C(14682);class l{constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.oT=[],this._maxBlockCapacity=G||64,this._selectionContent=new L.c(1024),this._creationFunc=U}update(U,G,C){X.e._CreateBlocks(U,G,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}FO(U){for(let G=0;G<this.MO.length;G++){this.MO[G].addEntry(U)}}ZO(U){for(let G=0;G<this.MO.length;G++){this.MO[G].removeEntry(U)}}select(U,G){this._selectionContent.reset();for(let C=0;C<this.MO.length;C++){this.MO[C].select(U,this._selectionContent,G)}return G?this._selectionContent.concat(this.oT):this._selectionContent.concatWithNoDuplicate(this.oT),this._selectionContent}intersects(U,G,C){this._selectionContent.reset();for(let L=0;L<this.MO.length;L++){this.MO[L].intersects(U,G,this._selectionContent,C)}return C?this._selectionContent.concat(this.oT):this._selectionContent.concatWithNoDuplicate(this.oT),this._selectionContent}intersectsRay(U){this._selectionContent.reset();for(let G=0;G<this.MO.length;G++){this.MO[G].intersectsRay(U,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.oT),this._selectionContent}}l.CreationFuncForMeshes=(U,G)=>{const C=U.getBoundingInfo();!U.isBlocked&&C.boundingBox.intersectsMinMax(G.dT,G.gT)&&G.entries.push(U)},l.CreationFuncForSubMeshes=(U,G)=>{U.getBoundingInfo().boundingBox.intersectsMinMax(G.dT,G.gT)&&G.entries.push(U)}},14682:(U,G,C)=>{"use strict";C.d(G,{e:()=>l});var L=C(12896),X=C(13200);class l{constructor(U,G,C,L,X,l){this.entries=[],this.ZT=new Array,this._capacity=C,this._depth=L,this._maxDepth=X,this._creationFunc=l,this._minPoint=U,this._maxPoint=G,this.ZT.push(U.clone()),this.ZT.push(G.clone()),this.ZT.push(U.clone()),this.ZT[2].x=G.x,this.ZT.push(U.clone()),this.ZT[3].y=G.y,this.ZT.push(U.clone()),this.ZT[4].z=G.z,this.ZT.push(G.clone()),this.ZT[5].z=U.z,this.ZT.push(G.clone()),this.ZT[6].x=U.x,this.ZT.push(G.clone()),this.ZT[7].y=U.y}get SG(){return this._capacity}get dT(){return this._minPoint}get gT(){return this._maxPoint}addEntry(U){if(this.MO)for(let G=0;G<this.MO.length;G++){this.MO[G].addEntry(U)}else this._creationFunc(U,this),this.entries.length>this.SG&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(U){if(this.MO){for(let G=0;G<this.MO.length;G++){this.MO[G].removeEntry(U)}return}const G=this.entries.indexOf(U);G>-1&&this.entries.splice(G,1)}addEntries(U){for(let G=0;G<U.length;G++){const C=U[G];this.addEntry(C)}}select(U,G,C){if(X.d.IsInFrustum(this.ZT,U)){if(this.MO){for(let L=0;L<this.MO.length;L++){this.MO[L].select(U,G,C)}return}C?G.concat(this.entries):G.concatWithNoDuplicate(this.entries)}}intersects(U,G,C,L){if(X.d.IntersectsSphere(this._minPoint,this._maxPoint,U,G)){if(this.MO){for(let X=0;X<this.MO.length;X++){this.MO[X].intersects(U,G,C,L)}return}L?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(U,G){if(U.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.MO){for(let C=0;C<this.MO.length;C++){this.MO[C].intersectsRay(U,G)}return}G.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){l._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(U,G,C,X,t,E,K,P){K.MO=new Array;const O=new L.pG((G.x-U.x)/2,(G.y-U.y)/2,(G.z-U.z)/2);for(let L=0;L<2;L++)for(let G=0;G<2;G++)for(let T=0;T<2;T++){const D=U.add(O.multiplyByFloats(L,G,T)),y=U.add(O.multiplyByFloats(L+1,G+1,T+1)),V=new l(D,y,X,t+1,E,P);V.addEntries(C),K.MO.push(V)}}}},14684:(U,G,C)=>{"use strict";C.d(G,{d:()=>O});var L=C(13097),X=C(12896),l=C(13280),t=C(13842),E=C(13128),K=C(14677),P=C(12763);L.e.prototype.createOrUpdateSelectionOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(E.d.NAME_OCTREE);C||(C=new O(this),this.o(C)),this.NT||(this.NT=new K.d(K.d.CreationFuncForMeshes,U,G));const L=this.getWorldExtends();return this.NT.update(L.min,L.max,this.meshes),this.NT},Object.defineProperty(L.e.prototype,"selectionOctree",{get:function(){return this.NT},enumerable:!0,configurable:!0}),l.c.prototype.createOrUpdateSubmeshesOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.wU();let L=C._getComponent(E.d.NAME_OCTREE);L||(L=new O(C),C.o(L)),this._submeshesOctree||(this._submeshesOctree=new K.d(K.d.CreationFuncForSubMeshes,U,G)),this.eE(!0);const X=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(X.minimumWorld,X.maximumWorld,this.zE),this._submeshesOctree};class O{constructor(U){this.name=E.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new t.c(X.pG.Zero(),new X.pG(1,1,1)),(U=U||P.d.LastCreatedScene)&&(this.HG=U,this.HG.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.HG.getActiveSubMeshCandidates=U=>this.getActiveSubMeshCandidates(U),this.HG.getCollidingSubMeshCandidates=(U,G)=>this.getCollidingSubMeshCandidates(U,G),this.HG.getIntersectingSubMeshCandidates=(U,G)=>this.getIntersectingSubMeshCandidates(U,G))}register(){this.HG.onMeshRemovedObservable.add((U=>{const G=this.HG.selectionOctree;if(void 0!==G&&null!==G){const C=G.oT.indexOf(U);-1!==C&&G.oT.splice(C,1)}})),this.HG.onMeshImportedObservable.add((U=>{const G=this.HG.selectionOctree;void 0!==G&&null!==G&&G.FO(U)}))}getActiveMeshCandidates(){var U;return(null===(U=this.HG.NT)||void 0===U?void 0:U.select(this.HG.frustumPlanes))||this.HG._getDefaultMeshCandidates()}getActiveSubMeshCandidates(U){if(U._submeshesOctree&&U.useOctreeForRenderingSelection){return U._submeshesOctree.select(this.HG.frustumPlanes)}return this.HG._getDefaultSubMeshCandidates(U)}getIntersectingSubMeshCandidates(U,G){if(U._submeshesOctree&&U.useOctreeForPicking){t.c.TransformToRef(G,U.getWorldMatrix(),this._tempRay);return U._submeshesOctree.intersectsRay(this._tempRay)}return this.HG._getDefaultSubMeshCandidates(U)}getCollidingSubMeshCandidates(U,G){if(U._submeshesOctree&&U.useOctreeForCollisions){const C=G._velocityWorldLength+Math.max(G._radius.x,G._radius.y,G._radius.z);return U._submeshesOctree.intersects(G._basePointWorld,C)}return this.HG._getDefaultSubMeshCandidates(U)}rebuild(){}dispose(){}}},13842:(U,G,C)=>{"use strict";C.d(G,{c:()=>y});var L=C(13097),X=C(13310),l=C(12898),t=C(12896),E=C(12907),K=C(13190),P=C(13121),O=C(12763),T=C(13147);const D={internalPickerForMesh:void 0};class y{constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.d;this.origin=U,this.direction=G,this.length=C,this.epsilon=L}clone(){return new y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const L=y._TmpVector3[0].WE(U.x-C,U.y-C,U.z-C),X=y._TmpVector3[1].WE(G.x+C,G.y+C,G.z+C);let l,t,E,K,P=0,O=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<L.x||this.origin.x>X.x)return!1}else if(l=1/this.direction.x,t=(L.x-this.origin.x)*l,E=(X.x-this.origin.x)*l,E===-1/0&&(E=1/0),t>E&&(K=t,t=E,E=K),P=Math.max(t,P),O=Math.min(E,O),P>O)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<L.y||this.origin.y>X.y)return!1}else if(l=1/this.direction.y,t=(L.y-this.origin.y)*l,E=(X.y-this.origin.y)*l,E===-1/0&&(E=1/0),t>E&&(K=t,t=E,E=K),P=Math.max(t,P),O=Math.min(E,O),P>O)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<L.z||this.origin.z>X.z)return!1}else if(l=1/this.direction.z,t=(L.z-this.origin.z)*l,E=(X.z-this.origin.z)*l,E===-1/0&&(E=1/0),t>E&&(K=t,t=E,E=K),P=Math.max(t,P),O=Math.min(E,O),P>O)return!1;return!0}intersectsBox(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(U.minimum,U.maximum,G)}intersectsSphere(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=U.center.x-this.origin.x,L=U.center.y-this.origin.y,X=U.center.z-this.origin.z,l=C*C+L*L+X*X,t=U.radius+G,E=t*t;if(l<=E)return!0;const K=C*this.direction.x+L*this.direction.y+X*this.direction.z;if(K<0)return!1;return l-K*K<=E}intersectsTriangle(U,G,C){const L=y._TmpVector3[0],X=y._TmpVector3[1],l=y._TmpVector3[2],E=y._TmpVector3[3],P=y._TmpVector3[4];G.subtractToRef(U,L),C.subtractToRef(U,X),t.pG.CrossToRef(this.direction,X,l);const O=t.pG.Dot(L,l);if(0===O)return null;const T=1/O;this.origin.subtractToRef(U,E);const D=t.pG.Dot(E,l)*T;if(D<-this.epsilon||D>1+this.epsilon)return null;t.pG.CrossToRef(E,L,P);const V=t.pG.Dot(this.direction,P)*T;if(V<-this.epsilon||D+V>1+this.epsilon)return null;const p=t.pG.Dot(X,P)*T;return p>this.length?null:new K.b(1-D-V,D,p)}intersectsPlane(U){let G;const C=t.pG.Dot(U.normal,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const L=t.pG.Dot(U.normal,this.origin);return G=(-U.d-L)/C,G<0?G<-9.99999997475243e-7?null:0:G}}intersectsAxis(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(U){case"y":{const U=(this.origin.y-G)/this.direction.y;return U>0?null:new t.pG(this.origin.x+this.direction.x*-U,G,this.origin.z+this.direction.z*-U)}case"x":{const U=(this.origin.x-G)/this.direction.x;return U>0?null:new t.pG(G,this.origin.y+this.direction.y*-U,this.origin.z+this.direction.z*-U)}case"z":{const U=(this.origin.z-G)/this.direction.z;return U>0?null:new t.pG(this.origin.x+this.direction.x*-U,this.origin.y+this.direction.y*-U,G)}default:return null}}intersectsMesh(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const E=t.TmpVectors.Matrix[0];return U.getWorldMatrix().invertToRef(E),this._tmpRay?y.TransformToRef(this,E,this._tmpRay):this._tmpRay=y.Transform(this,E),U.intersects(this._tmpRay,G,C,L,X,l)}intersectsMeshes(U,G,C){C?C.length=0:C=[];for(let L=0;L<U.length;L++){const X=this.intersectsMesh(U[L],G);X.hit&&C.push(X)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(U,G){return U.distance<G.distance?-1:U.distance>G.distance?1:0}intersectionSegment(U,G,C){const L=this.origin,X=t.TmpVectors.pG[0],l=t.TmpVectors.pG[1],E=t.TmpVectors.pG[2],K=t.TmpVectors.pG[3];G.subtractToRef(U,X),this.direction.scaleToRef(y._Rayl,E),L.addToRef(E,l),U.subtractToRef(L,K);const P=t.pG.Dot(X,X),O=t.pG.Dot(X,E),T=t.pG.Dot(E,E),D=t.pG.Dot(X,K),V=t.pG.Dot(E,K),p=P*T-O*O;let I,H,x=p,h=p;p<y._Smallnum?(I=0,x=1,H=V,h=T):(I=O*V-T*D,H=P*V-O*D,I<0?(I=0,H=V,h=T):I>x&&(I=x,H=V+O,h=T)),H<0?(H=0,-D<0?I=0:-D>P?I=x:(I=-D,x=P)):H>h&&(H=h,-D+O<0?I=0:-D+O>P?I=x:(I=-D+O,x=P));const N=Math.abs(I)<y._Smallnum?0:I/x,b=Math.abs(H)<y._Smallnum?0:H/h,o=t.TmpVectors.pG[4];E.scaleToRef(b,o);const w=t.TmpVectors.pG[5];X.scaleToRef(N,w),w.addInPlace(K);const S=t.TmpVectors.pG[6];w.subtractToRef(o,S);return b>0&&b<=this.length&&S.lengthSquared()<C*C?w.length():-1}update(U,G,C,L,X,l,E){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){y._RayDistant||(y._RayDistant=y.Zero()),y._RayDistant.unprojectRayToRef(U,G,C,L,t.Matrix.IdentityReadOnly,l,E);const K=t.TmpVectors.Matrix[0];X.invertToRef(K),y.TransformToRef(y._RayDistant,K,this)}else this.unprojectRayToRef(U,G,C,L,X,l,E);return this}static Zero(){return new y(t.pG.Zero(),t.pG.Zero())}static CreateNew(U,G,C,L,X,l,t){return y.Zero().update(U,G,C,L,X,l,t)}static CreateNewFromTo(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.Matrix.IdentityReadOnly;const L=new y(new t.pG(0,0,0),new t.pG(0,0,0));return y.CreateFromToToRef(U,G,L,C)}static CreateFromToToRef(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.Matrix.IdentityReadOnly;C.origin.L(U);const X=G.subtractToRef(U,C.direction),l=Math.sqrt(X.x*X.x+X.y*X.y+X.z*X.z);return C.length=l,C.direction.normalize(),y.TransformToRef(C,L,C)}static Transform(U,G){const C=new y(new t.pG(0,0,0),new t.pG(0,0,0));return y.TransformToRef(U,G,C),C}static TransformToRef(U,G,C){t.pG.TransformCoordinatesToRef(U.origin,G,C.origin),t.pG.TransformNormalToRef(U.direction,G,C.direction),C.length=U.length,C.epsilon=U.epsilon;const L=C.direction,X=L.length();if(0!==X&&1!==X){const U=1/X;L.x*=U,L.y*=U,L.z*=U,C.length*=X}return C}unprojectRayToRef(U,G,C,L,X,l,E){const K=t.TmpVectors.Matrix[0];X.multiplyToRef(l,K),K.multiplyToRef(E,K),K.invert();const P=O.d.LastCreatedEngine,T=t.TmpVectors.pG[0];T.x=U/C*2-1,T.y=-(G/L*2-1),T.z=null!==P&&void 0!==P&&P.gt?1:null!==P&&void 0!==P&&P.isNDCHalfZRange?0:-1;const D=t.TmpVectors.pG[1].WE(T.x,T.y,1-1e-8),y=t.TmpVectors.pG[2],V=t.TmpVectors.pG[3];t.pG._UnprojectFromInvertedMatrixToRef(T,K,y),t.pG._UnprojectFromInvertedMatrixToRef(D,K,V),this.origin.L(y),V.subtractToRef(y,this.direction),this.direction.normalize()}}function V(U,G,C,L,X){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const t=y.Zero();return p(U,G,C,L,t,X,l),t}function p(U,G,C,L,X,l){let E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const P=U.getEngine();if(!l&&!(l=U.activeCamera))return U;const O=l.viewport,T=P.getRenderHeight(),{x:D,y:y,width:V,height:p}=O.toGlobal(P.getRenderWidth(),T),I=1/P.getHardwareScalingLevel();return G=G*I-D,C=C*I-(T-y-p),X.update(G,C,V,p,L||t.Matrix.IdentityReadOnly,E?t.Matrix.IdentityReadOnly:l.getViewMatrix(),l.getProjectionMatrix(),K),U}function I(U,G,C,L,X){if(!P.d)return U;const l=U.getEngine();if(!X&&!(X=U.activeCamera))throw new Error("Active camera not set");const E=X.viewport,K=l.getRenderHeight(),{x:O,y:T,width:D,height:y}=E.toGlobal(l.getRenderWidth(),K),V=t.Matrix.Identity(),p=1/l.getHardwareScalingLevel();return G=G*p-O,C=C*p-(K-T-y),L.update(G,C,D,y,V,V,X.getProjectionMatrix()),U}function H(U,G,C,L,X,l,t,E){const K=G(L,C.enableDistantPicking),P=C.intersects(K,X,t,l,L,E);return P&&P.hit?!X&&null!=U&&P.distance>=U.distance?null:P:null}function x(U,G,C,L,X,l){let E=null;const K=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),O=U.cameraToUseForPointers||U.activeCamera,T=D.internalPickerForMesh||H;for(let P=0;P<U.meshes.length;P++){const D=U.meshes[P];if(C){if(!C(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.yP)continue;const y=K&&D.isWorldMatrixCameraDependent(),V=D.eE(y,O);if(D.hasThinInstances&&D.cP){const U=T(E,G,D,V,!0,!0,l);if(U){if(X)return U;const K=t.TmpVectors.Matrix[1],P=D.thinInstanceGetWorldMatrices();for(let U=0;U<P.length;U++){if(C&&!C(D,U))continue;P[U].multiplyToRef(V,K);const t=T(E,G,D,K,L,X,l,!0);if(t&&(E=t,E.thinInstanceIndex=U,L))return E}}}else{const U=T(E,G,D,V,L,X,l);if(U&&(E=U,L))return E}}return E||new P.d}function h(U,G,C,L){if(!P.d)return null;const X=[],l=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),E=U.cameraToUseForPointers||U.activeCamera,K=D.internalPickerForMesh||H;for(let P=0;P<U.meshes.length;P++){const O=U.meshes[P];if(C){if(!C(O,-1))continue}else if(!O.isEnabled()||!O.isVisible||!O.yP)continue;const T=l&&O.isWorldMatrixCameraDependent(),D=O.eE(T,E);if(O.hasThinInstances&&O.cP){if(K(null,G,O,D,!0,!0,L)){const U=t.TmpVectors.Matrix[1],l=O.thinInstanceGetWorldMatrices();for(let t=0;t<l.length;t++){if(C&&!C(O,t))continue;l[t].multiplyToRef(D,U);const E=K(null,G,O,U,!1,!1,L,!0);E&&(E.thinInstanceIndex=t,X.push(E))}}}else{const U=K(null,G,O,D,!1,!1,L);U&&X.push(U)}}return X}function N(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,L=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;L||(L=U.getWorldMatrix()),G.length=C,X?G.origin.L(X):G.origin.L(U.position);const l=t.TmpVectors.pG[2];l.set(0,0,U._scene.useRightHandedSystem?-1:1);const E=t.TmpVectors.pG[3];return t.pG.TransformNormalToRef(l,L,E),t.pG.NormalizeToRef(E,G.direction),G}var b,o;y._TmpVector3=(0,E.e)(6,t.pG.Zero),y._RayDistant=y.Zero(),y._Smallnum=1e-8,y._Rayl=1e9,b=L.e,(o=X.d)&&(o.prototype.getForwardRay=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,G=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return N(this,new y(t.pG.Zero(),t.pG.Zero(),U),U,G,C)},o.prototype.getForwardRayToRef=function(U){return N(this,U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),b&&(T.e._IsPickingAvailable=!0,b.prototype.createPickingRay=function(U,G,C,L){return V(this,U,G,C,L,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),L.e.prototype.createPickingRayToRef=function(U,G,C,L,X){return p(this,U,G,C,L,X,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},L.e.prototype.createPickingRayInCameraSpace=function(U,G,C){return function(U,G,C,L){const X=y.Zero();return I(U,G,C,X,L),X}(this,U,G,C)},L.e.prototype.createPickingRayInCameraSpaceToRef=function(U,G,C,L){return I(this,U,G,C,L)},L.e.prototype.pickWithBoundingInfo=function(U,G,C,L,X){return function(U,G,C,L,X,l){if(!P.d)return null;const E=x(U,(L=>(U._tempPickingRay||(U._tempPickingRay=y.Zero()),p(U,G,C,L,U._tempPickingRay,l||null),U._tempPickingRay)),L,X,!0);return E&&(E.ray=V(U,G,C,t.Matrix.Identity(),l||null)),E}(this,U,G,C,L,X)},L.e.prototype.HC=function(U,G,C,L,X,l){return function(U,G,C,L,X,l,E){const K=x(U,((L,X)=>(U._tempPickingRay||(U._tempPickingRay=y.Zero()),p(U,G,C,L,U._tempPickingRay,l||null,!1,X),U._tempPickingRay)),L,X,!1,E);return K&&(K.ray=V(U,G,C,t.Matrix.Identity(),l||null)),K}(this,U,G,C,L,X,l)},L.e.prototype.pickWithRay=function(U,G,C,L){return function(U,G,C,L,X){const l=x(U,(C=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=t.Matrix.Identity()),C.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=y.Zero()),y.TransformToRef(G,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),C,L,!1,X);return l&&(l.ray=G),l}(this,U,G,C,L)},L.e.prototype.multiPick=function(U,G,C,L,X){return function(U,G,C,L,X,l){return h(U,(L=>V(U,G,C,L,X||null)),L,l)}(this,U,G,C,L,X)},L.e.prototype.multiPickWithRay=function(U,G,C){return function(U,G,C,L){return h(U,(C=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=t.Matrix.Identity()),C.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=y.Zero()),y.TransformToRef(G,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),C,L)}(this,U,G,C)}},14107:(U,G,C)=>{"use strict";var L=C(12826),X=C(12731),l=C(12772),t=C(12853),E=C(12800),K=C(12837);E.b.prototype._partialLoadFile=function(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(U,(U=>{C[G]=U,C._internalCount++,6===C._internalCount&&L(C)}),void 0,void 0,!0,((U,G)=>{X&&U&&X(U.status+" "+U.statusText,G)}))},E.b.prototype._cascadeLoadFiles=function(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const X=[];X._internalCount=0;for(let l=0;l<6;l++)this._partialLoadFile(C[l],l,X,G,L)},E.b.prototype._cascadeLoadImgs=function(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5?arguments[5]:void 0;const t=[];t._internalCount=0;for(let E=0;E<6;E++)this._partialLoadImg(L[E],E,t,U,G,C,X,l)},E.b.prototype._partialLoadImg=function(U,G,C,L,X,E){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7?arguments[7]:void 0;const O=(0,t.c)();(0,l.t)(U,(U=>{C[G]=U,C._internalCount++,L&&L.removePendingData(O),6===C._internalCount&&E&&E(X,C)}),((U,G)=>{L&&L.removePendingData(O),K&&K(U,G)}),L?L.offlineProvider:null,P),L&&L.addPendingData(O)},E.b.prototype.createCubeTextureBase=function(U,G,C,l){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]&&arguments[8],D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,H=arguments.length>14&&void 0!==arguments[14]&&arguments[14],x=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const h=V||new L.b(this,7);h.isCube=!0,h.url=U,h.generateMipMaps=!l,h._lodGenerationScale=D,h._lodGenerationOffset=y,h._useSRGBBuffer=!!H&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!l),h!==V&&(h.label=U.substring(0,60)),this._doNotHandleContextLost||(h._extension=O,h._files=C,h._buffer=x);const N=U;this._transformTextureUrl&&!V&&(U=this._transformTextureUrl(U));const b=null!==O&&void 0!==O?O:function(U){const G=U.split("?")[0],C=G.lastIndexOf(".");return C>-1?G.substring(C).toLowerCase():""}(U),o=(0,K.b)(b),w=(U,G)=>{h.dispose(),E?E(U,G):U&&X.d.Warn(U)},S=(L,E)=>{U===N?L&&w(L.status+" "+L.statusText,E):(X.d.Warn("Failed to load ".concat(U,", falling back to the ").concat(N)),this.createCubeTextureBase(N,G,C,!!l,t,w,P,O,T,D,y,h,p,I,H,x))};if(o)o.then((L=>{const X=U=>{p&&p(h,U),L.loadCubeData(U,h,T,t,((U,G)=>{w(U,G)}))};x?X(x):C&&6===C.length?L.supportCascades?this._cascadeLoadFiles(G,(U=>X(U.map((U=>new Uint8Array(U))))),C,w):w("Textures type does not support cascades."):this._loadFile(U,(U=>X(new Uint8Array(U))),void 0,void 0,!0,S)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(G,h,((U,G)=>{I&&I(U,G)}),C,w)}return this._internalTexturesCache.push(h),h}},14690:(U,G,C)=>{"use strict";C(26),C(12731);var L=C(13014);C(12826),C(12966),C(12820),C(13050),C(13020);L.d},14130:(U,G,C)=>{"use strict";C.d(G,{c:()=>X});var L=C(12850);class X{constructor(U){this.value=this._toInt(U)}_toInt(U){return 0|U}add(U){return new X(this.value+U.value)}IG(U){return new X(this.value-U.value)}multiply(U){return new X(Math.imul(this.value,U.value))}divide(U){return new X(this.value/U.value)}getClassName(){return X.ClassName}equals(U){return this.value===U.value}static FromValue(U){return new X(U)}toString(){return this.value.toString()}}X.ClassName="FlowGraphInteger",(0,L.e)("FlowGraphInteger",X)},14137:(U,G,C)=>{"use strict";C.d(G,{e:()=>X,f:()=>l});var L=C(12896);class X{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.nE=U}get m(){return this.nE}transformVector(U){return this.transformVectorToRef(U,new L.Vector2)}transformVectorToRef(U,G){return G.x=U.x*this.nE[0]+U.y*this.nE[1],G.y=U.x*this.nE[2]+U.y*this.nE[3],G}sE(){return this.toArray()}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let G=0;G<4;G++)U[G]=this.nE[G];return U}xC(U){for(let G=0;G<4;G++)this.nE[G]=U[G];return this}multiplyToRef(U,G){const C=U.nE,L=this.nE,X=G.nE;return X[0]=C[0]*L[0]+C[1]*L[2],X[1]=C[0]*L[1]+C[1]*L[3],X[2]=C[2]*L[0]+C[3]*L[2],X[3]=C[2]*L[1]+C[3]*L[3],G}multiply(U){return this.multiplyToRef(U,new X)}divideToRef(U,G){const C=this.nE,L=U.nE,X=G.nE;return X[0]=C[0]/L[0],X[1]=C[1]/L[1],X[2]=C[2]/L[2],X[3]=C[3]/L[3],G}divide(U){return this.divideToRef(U,new X)}addToRef(U,G){const C=this.nE,L=U.m,X=G.m;return X[0]=C[0]+L[0],X[1]=C[1]+L[1],X[2]=C[2]+L[2],X[3]=C[3]+L[3],G}add(U){return this.addToRef(U,new X)}subtractToRef(U,G){const C=this.nE,L=U.m,X=G.m;return X[0]=C[0]-L[0],X[1]=C[1]-L[1],X[2]=C[2]-L[2],X[3]=C[3]-L[3],G}IG(U){return this.subtractToRef(U,new X)}transpose(){const U=this.nE;return new X([U[0],U[2],U[1],U[3]])}determinant(){const U=this.nE;return U[0]*U[3]-U[1]*U[2]}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const G=this.nE,C=1/U;return new X([G[3]*C,-G[1]*C,-G[2]*C,G[0]*C])}equals(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.nE,L=U.m;return 0===G?C[0]===L[0]&&C[1]===L[1]&&C[2]===L[2]&&C[3]===L[3]:Math.abs(C[0]-L[0])<G&&Math.abs(C[1]-L[1])<G&&Math.abs(C[2]-L[2])<G&&Math.abs(C[3]-L[3])<G}getClassName(){return"FlowGraphMatrix2D"}toString(){return"FlowGraphMatrix2D(".concat(this.nE.join(", "),")")}}class l{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.nE=U}get m(){return this.nE}transformVector(U){return this.transformVectorToRef(U,new L.pG)}transformVectorToRef(U,G){const C=this.nE;return G.x=U.x*C[0]+U.y*C[1]+U.z*C[2],G.y=U.x*C[3]+U.y*C[4]+U.z*C[5],G.z=U.x*C[6]+U.y*C[7]+U.z*C[8],G}multiplyToRef(U,G){const C=U.nE,L=this.nE,X=G.m;return X[0]=C[0]*L[0]+C[1]*L[3]+C[2]*L[6],X[1]=C[0]*L[1]+C[1]*L[4]+C[2]*L[7],X[2]=C[0]*L[2]+C[1]*L[5]+C[2]*L[8],X[3]=C[3]*L[0]+C[4]*L[3]+C[5]*L[6],X[4]=C[3]*L[1]+C[4]*L[4]+C[5]*L[7],X[5]=C[3]*L[2]+C[4]*L[5]+C[5]*L[8],X[6]=C[6]*L[0]+C[7]*L[3]+C[8]*L[6],X[7]=C[6]*L[1]+C[7]*L[4]+C[8]*L[7],X[8]=C[6]*L[2]+C[7]*L[5]+C[8]*L[8],G}multiply(U){return this.multiplyToRef(U,new l)}divideToRef(U,G){const C=this.nE,L=U.m,X=G.m;return X[0]=C[0]/L[0],X[1]=C[1]/L[1],X[2]=C[2]/L[2],X[3]=C[3]/L[3],X[4]=C[4]/L[4],X[5]=C[5]/L[5],X[6]=C[6]/L[6],X[7]=C[7]/L[7],X[8]=C[8]/L[8],G}divide(U){return this.divideToRef(U,new l)}addToRef(U,G){const C=this.nE,L=U.m,X=G.m;return X[0]=C[0]+L[0],X[1]=C[1]+L[1],X[2]=C[2]+L[2],X[3]=C[3]+L[3],X[4]=C[4]+L[4],X[5]=C[5]+L[5],X[6]=C[6]+L[6],X[7]=C[7]+L[7],X[8]=C[8]+L[8],G}add(U){return this.addToRef(U,new l)}subtractToRef(U,G){const C=this.nE,L=U.m,X=G.m;return X[0]=C[0]-L[0],X[1]=C[1]-L[1],X[2]=C[2]-L[2],X[3]=C[3]-L[3],X[4]=C[4]-L[4],X[5]=C[5]-L[5],X[6]=C[6]-L[6],X[7]=C[7]-L[7],X[8]=C[8]-L[8],G}IG(U){return this.subtractToRef(U,new l)}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let G=0;G<9;G++)U[G]=this.nE[G];return U}sE(){return this.toArray()}xC(U){for(let G=0;G<9;G++)this.nE[G]=U[G];return this}transpose(){const U=this.nE;return new l([U[0],U[3],U[6],U[1],U[4],U[7],U[2],U[5],U[8]])}determinant(){const U=this.nE;return U[0]*(U[4]*U[8]-U[5]*U[7])-U[1]*(U[3]*U[8]-U[5]*U[6])+U[2]*(U[3]*U[7]-U[4]*U[6])}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const G=this.nE,C=1/U;return new l([(G[4]*G[8]-G[5]*G[7])*C,(G[2]*G[7]-G[1]*G[8])*C,(G[1]*G[5]-G[2]*G[4])*C,(G[5]*G[6]-G[3]*G[8])*C,(G[0]*G[8]-G[2]*G[6])*C,(G[2]*G[3]-G[0]*G[5])*C,(G[3]*G[7]-G[4]*G[6])*C,(G[1]*G[6]-G[0]*G[7])*C,(G[0]*G[4]-G[1]*G[3])*C])}equals(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.nE,L=U.m;return 0===G?C[0]===L[0]&&C[1]===L[1]&&C[2]===L[2]&&C[3]===L[3]&&C[4]===L[4]&&C[5]===L[5]&&C[6]===L[6]&&C[7]===L[7]&&C[8]===L[8]:Math.abs(C[0]-L[0])<G&&Math.abs(C[1]-L[1])<G&&Math.abs(C[2]-L[2])<G&&Math.abs(C[3]-L[3])<G&&Math.abs(C[4]-L[4])<G&&Math.abs(C[5]-L[5])<G&&Math.abs(C[6]-L[6])<G&&Math.abs(C[7]-L[7])<G&&Math.abs(C[8]-L[8])<G}getClassName(){return"FlowGraphMatrix3D"}toString(){return"FlowGraphMatrix3D(".concat(this.nE.join(", "),")")}}},14140:(U,G,C)=>{"use strict";var L;function X(U,G,C,L){var X,l,t,E,K,P,O,T,D,y,V,p;switch(G){case"Animation":return L?null!==(X=U.animations.find((U=>U.uniqueId===C)))&&void 0!==X?X:null:null!==(l=U.animations[C])&&void 0!==l?l:null;case"AnimationGroup":return L?null!==(t=U.animationGroups.find((U=>U.uniqueId===C)))&&void 0!==t?t:null:null!==(E=U.animationGroups[C])&&void 0!==E?E:null;case"Mesh":return L?null!==(K=U.meshes.find((U=>U.uniqueId===C)))&&void 0!==K?K:null:null!==(P=U.meshes[C])&&void 0!==P?P:null;case"Material":return L?null!==(O=U.materials.find((U=>U.uniqueId===C)))&&void 0!==O?O:null:null!==(T=U.materials[C])&&void 0!==T?T:null;case"sO":return L?null!==(D=U.cameras.find((U=>U.uniqueId===C)))&&void 0!==D?D:null:null!==(y=U.cameras[C])&&void 0!==y?y:null;case"Light":return L?null!==(V=U.lights.find((U=>U.uniqueId===C)))&&void 0!==V?V:null:null!==(p=U.lights[C])&&void 0!==p?p:null;default:return null}}C.d(G,{c:()=>X}),function(U){U.Animation="Animation",U.AnimationGroup="AnimationGroup",U.Mesh="Mesh",U.Material="Material",U.sO="sO",U.Light="Light"}(L||(L={}))},14180:(U,G,C)=>{"use strict";C.d(G,{b:()=>X});var L=C(14188);class X extends L.d{constructor(U,G){if(super(U),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),G)for(const C of G)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(U){}_startPendingTasks(U){U._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(U),this._resetAfterCanceled(U)),this._preparePendingTasks(U),U._addPendingBlock(this),this.out._activateSignal(U),U._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(U){U._deleteExecutionVariable(this,"_initialized"),U._removePendingBlock(this)}}},14154:(U,G,C)=>{"use strict";C.d(G,{b:()=>P});var L=C(12853),X=C(12850),l=C(14159),t=C(12721),E=C(14126);class K extends l.d{constructor(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:L.defaultValue,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(U,G,C),this.richType=L,this._defaultValue=X,this._optional=l,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new t.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(U){this._isDisabled!==U&&(this._isDisabled=U,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(U,G){G._getConnectionValue(this)!==U&&(G._setConnectionValue(this,U),this.onValueChangedObservable.notifyObservers(U))}resetToDefaultValue(U){U._setConnectionValue(this,this._defaultValue)}connectTo(U){this._isDisabled||super.connectTo(U)}_getValueOrDefault(U){var G;const C=null!==(G=U._getConnectionValue(this))&&void 0!==G?G:this._defaultValue;return this.dataTransformer?this.dataTransformer(C):C}getValue(U){if(1===this.connectionType){U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(U);const G=this._getValueOrDefault(U);return this._lastValue=G,this.richType.typeTransformer?this.richType.typeTransformer(G):G}const G=this.isConnected()?this._connectedPoint[0].getValue(U):this._getValueOrDefault(U);return this._lastValue=G,this.richType.typeTransformer?this.richType.typeTransformer(G):G}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.richType={},this.richType.serialize(U.richType),U.optional=this._optional,(0,E.d)("defaultValue",this._defaultValue,U)}}(0,X.e)("FlowGraphDataConnection",K);class P{constructor(U){var G,C;this.config=U,this.uniqueId=(0,L.c)(),this.name=null!==(G=null===(C=this.config)||void 0===C?void 0:C.name)&&void 0!==G?G:this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(U){}registerDataInput(U,G,C){const L=new K(U,0,this,G,C);return this.dataInputs.push(L),L}registerDataOutput(U,G,C){const L=new K(U,1,this,G,C);return this.dataOutputs.push(L),L}getDataInput(U){return this.dataInputs.find((G=>G.name===U))}getDataOutput(U){return this.dataOutputs.find((G=>G.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.d;if(U.uniqueId=this.uniqueId,U.config={},this.config){const C=this.config,L=Object.keys(C);for(const X of L)G(X,C[X],U.config)}U.dataInputs=[],U.dataOutputs=[],U.className=this.getClassName();for(const C of this.dataInputs){const G={};C.serialize(G),U.dataInputs.push(G)}for(const C of this.dataOutputs){const G={};C.serialize(G),U.dataOutputs.push(G)}}deserialize(U){}_log(U,G,C){var L;null===(L=U.logger)||void 0===L||L.addLogItem({action:G,hC:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14159:(U,G,C)=>{"use strict";C.d(G,{d:()=>l});var L,X=C(12853);!function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(L||(L={}));class l{constructor(U,G,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,X.c)(),this.connectedPointIds=[],this.name=U,this._connectionType=G}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(U){if(this._connectionType===U._connectionType)throw new Error("Cannot connect two points of type ".concat(this.connectionType));if(this._isSingularConnection()&&this._connectedPoint.length>0||U._isSingularConnection()&&U._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(U),U._connectedPoint.push(this)}disconnectFrom(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(U),L=U._connectedPoint.indexOf(this);-1!==C&&-1!==L&&(G&&this._connectedPoint.splice(C,1),U._connectedPoint.splice(L,1))}disconnectFromAll(){for(const U of this._connectedPoint)this.disconnectFrom(U,!1);this._connectedPoint.length=0}dispose(){for(const U of this._connectedPoint)this.disconnectFrom(U)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U.uniqueId=this.uniqueId,U.name=this.name,U._connectionType=this._connectionType,U.connectedPointIds=[],U.className=this.getClassName();for(const G of this._connectedPoint)U.connectedPointIds.push(G.uniqueId)}getClassName(){return"FGConnection"}deserialize(U){this.uniqueId=U.uniqueId,this.name=U.name,this._connectionType=U._connectionType,this.connectedPointIds=U.connectedPointIds}}},14120:(U,G,C)=>{"use strict";C.d(G,{d:()=>h});var L,X=C(12721),l=C(12876),t=C(12884),E=C(12853),K=C(14126),P=C(14140),O=C(12731);!function(U){U.ExecuteBlock="ExecuteBlock",U.ExecuteEvent="ExecuteEvent",U.TriggerConnection="TriggerConnection",U.ContextVariableSet="ContextVariableSet",U.GlobalVariableSet="GlobalVariableSet",U.GlobalVariableDelete="GlobalVariableDelete",U.GlobalVariableGet="GlobalVariableGet",U.AddConnection="AddConnection",U.GetConnectionValue="GetConnectionValue",U.SetConnectionValue="SetConnectionValue",U.ActivateSignal="ActivateSignal",U.ContextVariableGet="ContextVariableGet"}(L||(L={}));class T{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(U){if(U.time||(U.time=Date.now()),this.log.push(U),this.logToConsole){var G;const C=null===(G=U.hC)||void 0===G?void 0:G.value;"object"===typeof C&&C.getClassName?O.d.Log("[FGLog] ".concat(U.className,":").concat(U.uniqueId.split("-")[0]," ").concat(U.action," - ").concat(JSON.stringify(C.getClassName()),": ").concat(C.toString())):O.d.Log("[FGLog] ".concat(U.className,":").concat(U.uniqueId.split("-")[0]," ").concat(U.action," - ").concat(JSON.stringify(U.hC)))}}getItemsOfType(U){return this.log.filter((G=>G.action===U))}}class D{get enableLogging(){return this._enableLogging}set enableLogging(U){this._enableLogging!==U&&(this._enableLogging=U,this._enableLogging?(this.logger=new T,this.logger.logToConsole=!0):this.logger=null)}constructor(U){var G;this.uniqueId=(0,E.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new X.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=U,this.assetsContext=null!==(G=U.assetsContext)&&void 0!==G?G:U.HG}hasVariable(U){return U in this._userVariables}setVariable(U,G){var C;this._userVariables[U]=G,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",hC:{name:U,value:G}})}getAsset(U,G){return(0,P.c)(this.assetsContext,U,G)}getVariable(U){var G;return null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",hC:{name:U,value:this._userVariables[U]}}),this._userVariables[U]}get userVariables(){return this._userVariables}wU(){return this._configuration.HG}_getUniqueIdPrefixedName(U,G){return"".concat(U.uniqueId,"_").concat(G)}_getGlobalContextVariable(U,G){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",hC:{name:U,defaultValue:G,possibleValue:this._globalContextVariables[U]}}),this._hasGlobalContextVariable(U)?this._globalContextVariables[U]:G}_setGlobalContextVariable(U,G){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",hC:{name:U,value:G}}),this._globalContextVariables[U]=G}_deleteGlobalContextVariable(U){var G;null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",hC:{name:U}}),delete this._globalContextVariables[U]}_hasGlobalContextVariable(U){return U in this._globalContextVariables}_setExecutionVariable(U,G,C){this._executionVariables[this._getUniqueIdPrefixedName(U,G)]=C}_getExecutionVariable(U,G,C){return this._hasExecutionVariable(U,G)?this._executionVariables[this._getUniqueIdPrefixedName(U,G)]:C}_deleteExecutionVariable(U,G){delete this._executionVariables[this._getUniqueIdPrefixedName(U,G)]}_hasExecutionVariable(U,G){return this._getUniqueIdPrefixedName(U,G)in this._executionVariables}_hasConnectionValue(U){return U.uniqueId in this._connectionValues}_setConnectionValue(U,G){var C;this._connectionValues[U.uniqueId]=G,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",hC:{connectionPointId:U.uniqueId,value:G}})}_setConnectionValueByKey(U,G){this._connectionValues[U]=G}_getConnectionValue(U){var G;return null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",hC:{connectionPointId:U.uniqueId,value:this._connectionValues[U.uniqueId]}}),this._connectionValues[U.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(U){this._pendingBlocks.includes(U)||(this._pendingBlocks.push(U),this._pendingBlocks.sort(((U,G)=>U.priority-G.priority)))}_removePendingBlock(U){const G=this._pendingBlocks.indexOf(U);-1!==G&&this._pendingBlocks.splice(G,1)}_clearPendingBlocks(){for(const U of this._pendingBlocks)U._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(U){var G;this.onNodeExecutedObservable.notifyObservers(U),null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:U.getClassName(),uniqueId:U.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(U){this._setGlobalContextVariable("timeSinceStart",U.timeSinceStart),this._setGlobalContextVariable("deltaTime",U.deltaTime);for(const C of this._pendingBlocks){var G;null===(G=C._executeOnTick)||void 0===G||G.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.d;U.uniqueId=this.uniqueId,U._userVariables={};for(const L in this._userVariables)G(L,this._userVariables[L],U._userVariables);U._connectionValues={};for(const L in this._connectionValues)G(L,this._connectionValues[L],U._connectionValues);var C;this.assetsContext!==this.wU()&&(U._assetsContext={meshes:this.assetsContext.meshes.map((U=>U.id)),materials:this.assetsContext.materials.map((U=>U.id)),textures:this.assetsContext.textures.map((U=>U.name)),animations:this.assetsContext.animations.map((U=>U.name)),lights:this.assetsContext.lights.map((U=>U.id)),cameras:this.assetsContext.cameras.map((U=>U.id)),ly:null===(C=this.assetsContext.ly)||void 0===C?void 0:C.map((U=>U.name)),skeletons:this.assetsContext.skeletons.map((U=>U.id)),SD:this.assetsContext.SD.map((U=>U.name)),geometries:this.assetsContext.geometries.map((U=>U.id)),multiMaterials:this.assetsContext.multiMaterials.map((U=>U.id)),transformNodes:this.assetsContext.transformNodes.map((U=>U.id))})}getClassName(){return"FlowGraphContext"}}(0,l.d)([(0,t.H)()],D.prototype,"uniqueId",void 0);var y=C(14148),V=C(13134);class p{constructor(U){this.onEventTriggeredObservable=new X.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=U,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.aE.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const U=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",hC:{timeSinceStart:this._startingTime,deltaTime:U}}),this._startingTime+=U})),this._meshPickedObserver=this._scene.onPointerObservable.add((U=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",hC:U})}),V.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((U=>{const G=U.pointerId,C=U.mesh,L=this._pointerUnderMeshState[G];!L&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",hC:{pointerId:G,mesh:C}}):L&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",hC:{pointerId:G,mesh:L}}):L&&C&&L!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",hC:{pointerId:G,mesh:L,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",hC:{pointerId:G,mesh:C,out:L}})),this._pointerUnderMeshState[G]=C}),V.e.POINTERMOVE)}dispose(){var U,G,C,L,X;null===(U=this._sceneDisposeObserver)||void 0===U||U.remove(),null===(G=this._sceneReadyObserver)||void 0===G||G.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(L=this._meshPickedObserver)||void 0===L||L.remove(),null===(X=this._meshUnderPointerObserver)||void 0===X||X.remove(),this.onEventTriggeredObservable.clear()}}var I,H=C(14166);!function(U){U[U.Stopped=0]="Stopped",U[U.Started=1]="Started"}(I||(I={}));class x{get state(){return this._state}set state(U){this._state=U,this.onStateChangedObservable.notifyObservers(U)}constructor(U){this.onStateChangedObservable=new X.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=U.HG,this._sceneEventCoordinator=new p(this._scene),this._coordinator=U.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((U=>{for(const G of this._executionContexts){const C=this._getContextualOrder(U.type,G);for(const L of C)if(!L._executeEvent(G,U.hC))break}switch(U.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const G of this._executionContexts)G._notifyOnTick(U.hC);break;case"SceneDispose":this.dispose()}}))}createContext(){const U=new D({HG:this._scene,coordinator:this._coordinator});return this._executionContexts.push(U),U}getContext(U){return this._executionContexts[U]}addEventBlock(U){if("PointerOver"!==U.type&&"PointerOut"!==U.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==U.type&&this._eventBlocks[U.type].push(U),1===this.state)for(const G of this._executionContexts)U._startPendingTasks(G);else this.onStateChangedObservable.addOnce((G=>{if(1===G)for(const C of this._executionContexts)U._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((U=>{1===U&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const U of this._executionContexts)for(const G in this._eventBlocks){const C=this._getContextualOrder(G,U);for(const G of C)G._startPendingTasks(U)}}_getContextualOrder(U,G){const C=this._eventBlocks[U].sort(((U,G)=>G.initPriority-U.initPriority));if("MeshPick"===U){const U=[];for(const L of C){const X=L.asset.getValue(G);let l=0;for(;l<C.length;l++){const U=C[l].asset.getValue(G);if(X&&U&&(0,H.k)(X,U))break}U.splice(l,0,L)}return U}return C}dispose(){var U;if(0!==this.state){this.state=0;for(const U of this._executionContexts)U._clearPendingBlocks();this._executionContexts.length=0;for(const U in this._eventBlocks)this._eventBlocks[U].length=0;null===(U=this._eventObserver)||void 0===U||U.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(U){const G=[],C=new Set;for(const L in this._eventBlocks)for(const U of this._eventBlocks[L])G.push(U),C.add(U.uniqueId);for(;G.length>0;){const L=G.pop();U(L);for(const U of L.dataInputs)for(const L of U._connectedPoint)C.has(L._ownerBlock.uniqueId)||(G.push(L._ownerBlock),C.add(L._ownerBlock.uniqueId));if(L instanceof y.d)for(const U of L.signalOutputs)for(const L of U._connectedPoint)C.has(L._ownerBlock.uniqueId)||(G.push(L._ownerBlock),C.add(L._ownerBlock.uniqueId))}}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},G=arguments.length>1?arguments[1]:void 0;U.allBlocks=[],this.visitAllBlocks((G=>{const C={};G.serialize(C),U.allBlocks.push(C)})),U.executionContexts=[];for(const C of this._executionContexts){const L={};C.serialize(L,G),U.executionContexts.push(L)}}}class h{constructor(U){var G;this.config=U,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.HG.aE.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.HG.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const U=this._executeOnNextFrame.slice(0);if(U.length)for(const G of U){this.notifyCustomEvent(G.id,G.data,!1);const U=this._executeOnNextFrame.findIndex((U=>U.uniqueId===G.uniqueId));-1!==U&&this._executeOnNextFrame.splice(U,1)}}));(null!==(G=h.SceneCoordinators.get(this.config.HG))&&void 0!==G?G:[]).push(this)}createGraph(){const U=new x({HG:this.config.HG,coordinator:this});return this._flowGraphs.push(U),U}removeGraph(U){const G=this._flowGraphs.indexOf(U);-1!==G&&(U.dispose(),this._flowGraphs.splice(G,1))}start(){for(const U of this._flowGraphs)U.start()}dispose(){var U,G,C;for(const l of this._flowGraphs)l.dispose();this._flowGraphs.length=0,null===(U=this._disposeObserver)||void 0===U||U.remove(),null===(G=this._onBeforeRenderObserver)||void 0===G||G.remove();const L=null!==(C=h.SceneCoordinators.get(this.config.HG))&&void 0!==C?C:[],X=L.indexOf(this);-1!==X&&L.splice(X,1)}serialize(U,G){U._flowGraphs=[];for(const C of this._flowGraphs){const L={};C.serialize(L,G),U._flowGraphs.push(L)}U.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(U){let G=this._customEventsMap.get(U);return G||(G=new X.e,this._customEventsMap.set(U,G)),G}notifyCustomEvent(U,G){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:U,data:G,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(U)){const G=this._eventExecutionCounter.get(U);if(this._eventExecutionCounter.set(U,G+1),G>=h.MaxEventTypeExecutionPerFrame)return void(G===h.MaxEventTypeExecutionPerFrame&&O.d.Warn('FlowGraphCoordinator: Too many executions of event "'.concat(U,'".')))}else this._eventExecutionCounter.set(U,1);const C=this._customEventsMap.get(U);C&&C.notifyObservers(G)}}h.MaxEventsPerType=30,h.MaxEventTypeExecutionPerFrame=30,h.SceneCoordinators=new Map},14173:(U,G,C)=>{"use strict";C.d(G,{d:()=>X});var L=C(14180);class X extends L.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(U){U._notifyExecuteNode(this),this.done._activateSignal(U)}}},14148:(U,G,C)=>{"use strict";C.d(G,{d:()=>E});var L=C(14154),X=C(14159),l=C(12850);class t extends X.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(U){super.connectTo(U),this._connectedPoint.sort(((U,G)=>G.priority-U.priority))}_activateSignal(U){var G;if(null===(G=U.logger)||void 0===G||G.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,hC:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(U,this),U._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(U)}}(0,l.e)("FlowGraphSignalConnection",t);class E extends L.b{constructor(U){super(U),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(U){const G=new t(U,0,this);return this.signalInputs.push(G),G}_registerSignalOutput(U){const G=new t(U,1,this);return this.signalOutputs.push(G),G}_unregisterSignalInput(U){const G=this.signalInputs.findIndex((G=>G.name===U));-1!==G&&(this.signalInputs[G].dispose(),this.signalInputs.splice(G,1))}_unregisterSignalOutput(U){const G=this.signalOutputs.findIndex((G=>G.name===U));-1!==G&&(this.signalOutputs[G].dispose(),this.signalOutputs.splice(G,1))}_reportError(U,G){this.error.hC="string"===typeof G?new Error(G):G,this.error._activateSignal(U)}getSignalInput(U){return this.signalInputs.find((G=>G.name===U))}getSignalOutput(U){return this.signalOutputs.find((G=>G.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.signalInputs=[],U.signalOutputs=[];for(const G of this.signalInputs){const C={};G.serialize(C),U.signalInputs.push(C)}for(const G of this.signalOutputs){const C={};G.serialize(C),U.signalOutputs.push(C)}}deserialize(U){for(let G=0;G<U.signalInputs.length;G++){const C=this.getSignalInput(U.signalInputs[G].name);if(!C)throw new Error("Could not find signal input with name "+U.signalInputs[G].name+" in block "+U.className);C.deserialize(U.signalInputs[G])}for(let G=0;G<U.signalOutputs.length;G++){const C=this.getSignalOutput(U.signalOutputs[G].name);if(!C)throw new Error("Could not find signal output with name "+U.signalOutputs[G].name+" in block "+U.className);C.deserialize(U.signalOutputs[G])}}getClassName(){return"FlowGraphExecutionBlock"}}},14188:(U,G,C)=>{"use strict";C.d(G,{d:()=>X});var L=C(14148);class X extends L.d{constructor(U){super(U),this.out=this._registerSignalOutput("out")}}},14134:(U,G,C)=>{"use strict";C.d(G,{C:()=>b,D:()=>O,H:()=>y,J:()=>V,L:()=>p,O:()=>v,S:()=>u,V:()=>S,Y:()=>w,c:()=>P,g:()=>D,k:()=>o,o:()=>I,s:()=>H,v:()=>x,y:()=>T});var L,X=C(12896),l=C(12934),t=C(14130),E=C(14137);!function(U){U.Any="any",U.String="string",U.Number="number",U.Boolean="boolean",U.Object="object",U.Integer="FlowGraphInteger",U.Vector2="Vector2",U.pG="pG",U.Vector4="Vector4",U.Quaternion="Quaternion",U.Matrix="Matrix",U.Matrix2D="Matrix2D",U.Matrix3D="Matrix3D",U.hG="hG",U.JE="JE"}(L||(L={}));class K{constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=U,this.defaultValue=G,this.animationType=C}serialize(U){U.typeName=this.typeName,U.defaultValue=this.defaultValue}}const P=new K("any",void 0),O=new K("string",""),T=new K("number",0,0),D=new K("boolean",!1),y=new K("Vector2",X.Vector2.Zero(),5),V=new K("pG",X.pG.Zero(),1),p=new K("Vector4",X.Vector4.Zero()),I=new K("Matrix",X.Matrix.Identity(),3),H=new K("Matrix2D",new E.e),x=new K("Matrix3D",new E.f),h=new K("hG",l.hG.Black(),4),N=new K("JE",new l.JE(0,0,0,0),7),b=new K("Quaternion",X.Quaternion.Identity(),2);b.typeTransformer=U=>{if(U.getClassName){if("Vector4"===U.getClassName())return X.Quaternion.NG(U.sE());if("pG"===U.getClassName())return X.Quaternion.FromEulerVector(U);if("Matrix"===U.getClassName())return X.Quaternion.FromRotationMatrix(U)}return U};const o=new K("FlowGraphInteger",new t.c(0),0);function w(U){const G=U;switch(typeof U){case"string":return O;case"number":return T;case"boolean":return D;case"object":if(G.getClassName)switch(G.getClassName()){case"Vector2":return y;case"pG":return V;case"Vector4":return p;case"Matrix":return I;case"hG":return h;case"JE":return N;case"Quaternion":return b;case"FlowGraphInteger":return o;case"Matrix2D":return H;case"Matrix3D":return x}return P;default:return P}}function S(U){switch(U){case"string":return O;case"number":return T;case"boolean":return D;case"Vector2":return y;case"pG":return V;case"Vector4":return p;case"Matrix":return I;case"hG":return h;case"JE":return N;case"Quaternion":return b;case"FlowGraphInteger":return o;case"Matrix2D":return H;case"Matrix3D":return x;default:return P}}function v(U){switch(U){case"number":default:return 0;case"Vector2":return 5;case"pG":return 1;case"Matrix":return 3;case"hG":return 4;case"JE":return 7;case"Quaternion":return 2}}function u(U){switch(U){case 0:return T;case 5:return y;case 1:return V;case 3:return I;case 4:return h;case 7:return N;case 2:return b;default:return P}}},14126:(U,G,C)=>{"use strict";C.d(G,{c:()=>O,d:()=>P,g:()=>T});var L=C(12934),X=C(12896),l=C(14130),t=C(14134),E=C(14137);function K(U){return"Vector2"===U||"pG"===U||"Vector4"===U||"Quaternion"===U||"hG"===U||"JE"===U}function P(U,G,C){var L,X;const l=null!==(L=null===G||void 0===G||null===(X=G.getClassName)||void 0===X?void 0:X.call(G))&&void 0!==L?L:"";if(K(l)||function(U){return"Matrix"===U||"Matrix2D"===U||"Matrix3D"===U}(l))C[U]={value:G.sE(),className:l};else if("FlowGraphInteger"===l)C[U]={value:G.value,className:l};else if(l&&(G.id||G.name))C[U]={id:G.id,name:G.name,className:l};else{if("object"===typeof G)throw new Error("Could not serialize value ".concat(G));C[U]=G}}function O(U,G,C,P){var T;const D=G[U];let y;const V=null!==(T=null===D||void 0===D?void 0:D.type)&&void 0!==T?T:null===D||void 0===D?void 0:D.className;if(function(U){return"Mesh"===U||"AbstractMesh"===U||"GroundMesh"===U||"InstanceMesh"===U||"LinesMesh"===U||"GoldbergMesh"===U||"GreasedLineMesh"===U||"TrailMesh"===U}(V)){let U=P.meshes.filter((U=>D.id?U.id===D.id:U.name===D.name));0===U.length&&(U=P.transformNodes.filter((U=>D.id?U.id===D.id:U.name===D.name))),y=D.uniqueId?U.find((U=>U.uniqueId===D.uniqueId)):U[0]}else if(K(V))y=function(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===U)return X.Vector2.NG(G);if("pG"===U)return C&&(G[2]*=-1),X.pG.NG(G);if("Vector4"===U)return X.Vector4.NG(G);if("Quaternion"===U)return C&&(G[2]*=-1,G[3]*=-1),X.Quaternion.NG(G);if("hG"===U)return new L.hG(G[0],G[1],G[2]);if("JE"===U)return new L.JE(G[0],G[1],G[2],G[3]);throw new Error("Unknown vector class name ".concat(U))}(V,D.value);else if(function(U){return"AnimationGroup"===U}(V)){const U=P.animationGroups.filter((U=>U.name===D.name));y=1===U.length?U[0]:U.find((U=>U.uniqueId===D.uniqueId))}else y="Matrix"===V?X.Matrix.NG(D.value):"Matrix2D"===V?new E.e(D.value):"Matrix3D"===V?new E.f(D.value):"FlowGraphInteger"===V?l.c.FromValue(D.value):"number"===V||"string"===V||"boolean"===V?D.value[0]:D&&void 0!==D.value?D.value:Array.isArray(D)?D.reduce(((U,G)=>G.eventData?(U[G.id]={type:(0,t.V)(G.type)},"undefined"!==typeof G.value&&(U[G.id].value=O("value",G,C,P)),U):U),{}):D;return y}function T(U){return"FlowGraphJsonPointerParserBlock"===U}},14166:(U,G,C)=>{"use strict";function L(U,G){return!(!U.parent||U.parent!==G&&!L(U.parent,G))}function X(U){if(U.getClassName)return U.getClassName()}function l(U,G){return U===G&&("Vector2"===U||"pG"===U||"Vector4"===U||"Quaternion"===U)}function t(U,G){return U===G&&("Matrix"===U||"Matrix2D"===U||"Matrix3D"===U)}function E(U,G){return"FlowGraphInteger"===U&&"FlowGraphInteger"===G}function K(U,G){const C="number"===typeof U||"number"===typeof(null===U||void 0===U?void 0:U.value);return C&&!G?!isNaN(P(U)):C}function P(U){return"number"===typeof U?U:U.value}C.d(G,{b:()=>E,d:()=>t,f:()=>l,g:()=>X,k:()=>L,m:()=>P,n:()=>K})},14449:(U,G,C)=>{"use strict";C.r(G),C.d(G,{SceneInstrumentation:()=>l});var L=C(12718),X=C(13087);class l{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(U){U!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=U,U?(this._onBeforeActiveMeshesEvaluationObserver=this.HG.onBeforeActiveMeshesEvaluationObservable.add((()=>{L.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.HG.onAfterActiveMeshesEvaluationObservable.add((()=>{L.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.HG.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.HG.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(U){U!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=U,U?(this._onBeforeRenderTargetsRenderObserver=this.HG.onBeforeRenderTargetsRenderObservable.add((()=>{L.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.HG.onAfterRenderTargetsRenderObservable.add((()=>{L.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.HG.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.HG.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(U){U!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=U,U?(this._onBeforeParticlesRenderingObserver=this.HG.onBeforeParticlesRenderingObservable.add((()=>{L.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.HG.onAfterParticlesRenderingObservable.add((()=>{L.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.HG.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.HG.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(U){U!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=U,this.HG.spriteManagers&&(U?(this._onBeforeSpritesRenderingObserver=this.HG.onBeforeSpritesRenderingObservable.add((()=>{L.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.HG.onAfterSpritesRenderingObservable.add((()=>{L.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.HG.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.HG.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(U){U!==this._capturePhysicsTime&&this.HG.onBeforePhysicsObservable&&(this._capturePhysicsTime=U,U?(this._onBeforePhysicsObserver=this.HG.onBeforePhysicsObservable.add((()=>{L.Tools.StartPerformanceCounter("bp"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.HG.onAfterPhysicsObservable.add((()=>{L.Tools.EndPerformanceCounter("bp"),this._physicsTime.endMonitoring()}))):(this.HG.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.HG.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(U){U!==this._captureAnimationsTime&&(this._captureAnimationsTime=U,U?this._onAfterAnimationsObserver=this.HG.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.HG.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(U){this._captureFrameTime=U}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(U){this._captureInterFrameTime=U}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(U){U!==this._captureRenderTime&&(this._captureRenderTime=U,U?(this._onBeforeDrawPhaseObserver=this.HG.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),L.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.HG.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),L.Tools.EndPerformanceCounter("Main render")}))):(this.HG.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.HG.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(U){U!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=U,U?(this._onBeforeCameraRenderObserver=this.HG.onBeforeCameraRenderObservable.add((U=>{this._cameraRenderTime.beginMonitoring(),L.Tools.StartPerformanceCounter("Rendering camera ".concat(U.name))})),this._onAfterCameraRenderObserver=this.HG.onAfterCameraRenderObservable.add((U=>{this._cameraRenderTime.endMonitoring(!1),L.Tools.EndPerformanceCounter("Rendering camera ".concat(U.name))}))):(this.HG.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.HG.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.HG.getEngine()._drawCalls}constructor(U){this.HG=U,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new X.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new X.b,this._captureFrameTime=!1,this._frameTime=new X.b,this._captureRenderTime=!1,this._renderTime=new X.b,this._captureInterFrameTime=!1,this._interFrameTime=new X.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new X.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new X.b,this._capturePhysicsTime=!1,this._physicsTime=new X.b,this._captureAnimationsTime=!1,this._animationsTime=new X.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new X.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=U.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(L.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.HG.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=U.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(L.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qE(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qE(),this._captureParticlesRenderTime&&this._particlesRenderTime.qE(),this._captureSpritesRenderTime&&this._spritesRenderTime.qE(),this._captureRenderTime&&this._renderTime.qE(),this._captureCameraRenderTime&&this._cameraRenderTime.qE()}))}dispose(){this._disposed||(this.HG.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.HG.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.HG.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.HG.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.HG.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.HG.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.HG.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.HG.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.HG.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.HG.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.HG.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.HG.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.HG.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.HG.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.HG.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.HG.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.HG.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.HG=null,this._disposed=!0)}}},14115:(U,G,C)=>{"use strict";C.d(G,{e:()=>O});var L=C(12876),X=C(12884),l=C(12896),t=C(13274),E=C(13412),K=C(13472),P=C(12850);t.e.AddNodeConstructor("Light_Type_1",((U,G)=>()=>new O(U,l.pG.Zero(),G)));class O extends K.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(U){this._shadowFrustumSize=U,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(U){this._shadowOrthoScale=U,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(U){this._orthoLeft=U}get orthoRight(){return this._orthoRight}set orthoRight(U){this._orthoRight=U}get orthoTop(){return this._orthoTop}set orthoTop(U){this._orthoTop=U}get orthoBottom(){return this._orthoBottom}set orthoBottom(U){this._orthoBottom=U}constructor(U,G,C){super(U,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=G.scale(-1),this.direction=G}getClassName(){return"wp"}getTypeID(){return E.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(U,G,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(U):this._setDefaultAutoExtendShadowProjectionMatrix(U,G,C)}_setDefaultFixedFrustumShadowProjectionMatrix(U){const G=this.wU().activeCamera;G&&l.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:G.AE,void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ,U,this.wU().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(U,G,C){const L=this.wU().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const U=l.pG.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let L=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let t=0;t<C.length;t++){const E=C[t];if(!E)continue;const K=E.getBoundingInfo().boundingBox;for(let C=0;C<K.vectorsWorld.length;C++)l.pG.TransformCoordinatesToRef(K.vectorsWorld[C],G,U),U.x<this._orthoLeft&&(this._orthoLeft=U.x),U.y<this._orthoBottom&&(this._orthoBottom=U.y),U.x>this._orthoRight&&(this._orthoRight=U.x),U.y>this._orthoTop&&(this._orthoTop=U.y),this.autoCalcShadowZBounds&&(U.z<L&&(L=U.z),U.z>X&&(X=U.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=L,this._shadowMaxZ=X)}const X=this._orthoRight-this._orthoLeft,t=this._orthoTop-this._orthoBottom,E=void 0!==this.shadowMinZ?this.shadowMinZ:(null===L||void 0===L?void 0:L.AE)||0,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===L||void 0===L?void 0:L.maxZ)||1e4,P=this.wU().getEngine().gt;l.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-X*this.shadowOrthoScale,this._orthoRight+X*this.shadowOrthoScale,this._orthoBottom-t*this.shadowOrthoScale,this._orthoTop+t*this.shadowOrthoScale,P?K:E,P?E:K,U,this.wU().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,G){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,G),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,G),this)}transferToNodeMaterialEffect(U,G){return this.computeTransformedInformation()?(U.setFloat3(G,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(U.setFloat3(G,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(U){const G=this._scene.getEngine();return!G.gt&&G.isNDCHalfZRange?0:1}getDepthMaxZ(U){const G=this._scene.getEngine();return G.gt&&G.isNDCHalfZRange?0:1}prepareLightSpecificDefines(U,G){U["DIRLIGHT"+G]=!0}}(0,L.d)([(0,X.H)()],O.prototype,"shadowFrustumSize",null),(0,L.d)([(0,X.H)()],O.prototype,"shadowOrthoScale",null),(0,L.d)([(0,X.H)()],O.prototype,"autoUpdateExtends",void 0),(0,L.d)([(0,X.H)()],O.prototype,"autoCalcShadowZBounds",void 0),(0,L.d)([(0,X.H)("orthoLeft")],O.prototype,"_orthoLeft",void 0),(0,L.d)([(0,X.H)("orthoRight")],O.prototype,"_orthoRight",void 0),(0,L.d)([(0,X.H)("orthoTop")],O.prototype,"_orthoTop",void 0),(0,L.d)([(0,X.H)("orthoBottom")],O.prototype,"_orthoBottom",void 0),(0,P.e)("BABYLON.DirectionalLight",O)},14636:(U,G,C)=>{"use strict";C.d(G,{d:()=>O});var L=C(12876),X=C(12884),l=C(12896),t=C(12934),E=C(13274),K=C(13412),P=C(12850);E.e.AddNodeConstructor("Light_Type_3",((U,G)=>()=>new O(U,l.pG.Zero(),G)));class O extends K.c{constructor(U,G,C){super(U,C),this.groundColor=new t.hG(0,0,0),this.direction=G||l.pG.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Sp"}setDirectionToTarget(U){return this.direction=l.pG.Normalize(U.IG(l.pG.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(U,G){const C=l.pG.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,G),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.CK),G),this}transferToNodeMaterialEffect(U,G){const C=l.pG.Normalize(this.direction);return U.setFloat3(G,C.x,C.y,C.z),this}eE(){return this._worldMatrix||(this._worldMatrix=l.Matrix.Identity()),this._worldMatrix}getTypeID(){return K.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(U,G){U["HEMILIGHT"+G]=!0}}(0,L.d)([(0,X.i)()],O.prototype,"groundColor",void 0),(0,L.d)([(0,X.E)()],O.prototype,"direction",void 0),(0,P.e)("BABYLON.HemisphericLight",O)},14080:(U,G,C)=>{"use strict";C.d(G,{e:()=>T});var L=C(12876),X=C(12884),l=C(12896),t=C(13274),E=C(13412),K=C(13472),P=C(12873),O=C(12850);t.e.AddNodeConstructor("Light_Type_2",((U,G)=>()=>new T(U,l.pG.Zero(),l.pG.Zero(),0,0,G)));class T extends K.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(U){this._iesProfileTexture!==U&&(this._iesProfileTexture=U,this._iesProfileTexture&&T._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(U){this._angle=U,this._cosHalfAngle=Math.cos(.5*U),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(U){this._innerAngle=U,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(U){this._shadowAngleScale=U,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(U){this._projectionTextureLightNear=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(U){this._projectionTextureLightFar=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(U){this._projectionTextureUpDirection=U,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(U){this._projectionTexture!==U&&(this._projectionTexture=U,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(T._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):T._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(U){return void 0!==U.onGeneratedObservable}static _IsTexture(U){return void 0!==U.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(U){this._projectionTextureProjectionLightMatrix=U,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(U,G,C,L,X,t){super(U,t),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=l.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=l.pG.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=l.pG.Zero(),this._projectionTextureViewLightMatrix=l.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=l.Matrix.Zero(),this._projectionTextureScalingMatrix=l.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=G,this.direction=C,this.angle=L,this.exponent=X}getClassName(){return"SpotLight"}getTypeID(){return E.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(U){super._setDirection(U),this._projectionTextureViewLightDirty=!0}_setPosition(U){super._setPosition(U),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(U,G,C){const L=this.wU().activeCamera;if(!L)return;this._shadowAngleScale=this._shadowAngleScale||1;const X=this._shadowAngleScale*this._angle,t=void 0!==this.shadowMinZ?this.shadowMinZ:L.AE,E=void 0!==this.shadowMaxZ?this.shadowMaxZ:L.maxZ,K=this.wU().getEngine().gt;l.Matrix.PerspectiveFovLHToRef(X,1,K?E:t,K?t:E,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,K)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),l.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const U=this.projectionTextureLightFar,G=this.projectionTextureLightNear,C=U/(U-G),L=-C*G,X=1/Math.tan(this._angle/2);l.Matrix.FromValuesToRef(X/1,0,0,0,0,X,0,0,0,0,C,1,0,0,L,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof P.c){const U=this._projectionTexture.uScale/2,G=this._projectionTexture.vScale/2;l.Matrix.FromValuesToRef(U,0,0,0,0,G,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(U,G){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),U.setMatrix("textureProjectionMatrix"+G,this._projectionTextureMatrix),U.setTexture("projectionLightTexture"+G,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&U.setTexture("iesLightTexture"+G,this._iesProfileTexture),this}transferToEffect(U,G){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,G),C=l.pG.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,G),C=l.pG.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,G),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,G),this}transferToNodeMaterialEffect(U,G){let C;return C=this.computeTransformedInformation()?l.pG.Normalize(this.transformedDirection):l.pG.Normalize(this.direction),this.wU().useRightHandedSystem?U.setFloat3(G,-C.x,-C.y,-C.z):U.setFloat3(G,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(U){var G;const C=this._scene.getEngine(),L=void 0!==this.shadowMinZ?this.shadowMinZ:null!==(G=null===U||void 0===U?void 0:U.AE)&&void 0!==G?G:0;return C.gt&&C.isNDCHalfZRange?L:this._scene.getEngine().isNDCHalfZRange?0:L}getDepthMaxZ(U){var G;const C=this._scene.getEngine(),L=void 0!==this.shadowMaxZ?this.shadowMaxZ:null!==(G=null===U||void 0===U?void 0:U.maxZ)&&void 0!==G?G:1e4;return C.gt&&C.isNDCHalfZRange?0:L}prepareLightSpecificDefines(U,G){U["SPOTLIGHT"+G]=!0,U["PROJECTEDLIGHTTEXTURE"+G]=!(!this.projectionTexture||!this.projectionTexture.isReady()),U["IESLIGHTTEXTURE"+G]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,L.d)([(0,X.H)()],T.prototype,"angle",null),(0,L.d)([(0,X.H)()],T.prototype,"innerAngle",null),(0,L.d)([(0,X.H)()],T.prototype,"shadowAngleScale",null),(0,L.d)([(0,X.H)()],T.prototype,"exponent",void 0),(0,L.d)([(0,X.H)()],T.prototype,"projectionTextureLightNear",null),(0,L.d)([(0,X.H)()],T.prototype,"projectionTextureLightFar",null),(0,L.d)([(0,X.H)()],T.prototype,"projectionTextureUpDirection",null),(0,L.d)([(0,X.z)("projectedLightTexture")],T.prototype,"_projectionTexture",void 0),(0,O.e)("BABYLON.SpotLight",T)},13834:(U,G,C)=>{"use strict";C.d(G,{c:()=>t,g:()=>l,h:()=>E});const L={},X={};function l(U,G){L[U]=G}function t(U,G){X[U]=G}function E(U){return X[U]?X[U]:null}},13736:(U,G,C)=>{"use strict";C.d(G,{d:()=>w,g:()=>n});var L,X=C(12718),l=C(12721),t=C(13097),E=C(12763),K=C(12731),P=C(13327),O=C(12772),T=C(12774),D=C(12853),y=C(12800),V=C(12756);!function(U){U[U.Clean=0]="Clean",U[U.Stop=1]="Stop",U[U.Sync=2]="Sync",U[U.NoSync=3]="NoSync"}(L||(L={}));const p=new l.e,I={};let H=!1;function x(){return I[".babylon"]}function h(U,G){const C=I[U];return C||(K.d.Warn("Unable to find a plugin to load "+U+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),G?x():void 0)}function N(U,G,C){let L="Unable to load from "+(U.rawData?"binary data":U.url);return G?L+=": ".concat(G):C&&(L+=": ".concat(C)),L}async function b(U,G,C,L,X,l,t,E,K){var P;const T="data:"===(D=U.url).substring(0,5)?D.substring(5):null;var D;if(U.rawData&&!t)throw"When using ArrayBufferView to load data the file extension must be provided.";const H=T||t?"":function(U){const G=U.indexOf("?");-1!==G&&(U=U.substring(0,G));const C=U.lastIndexOf(".");return U.substring(C,U.length).toLowerCase()}(U.url);let N=t?h(t,!0):T?function(U){for(const G in I){const C=I[G].plugin;if(C.canDirectLoad&&C.canDirectLoad(U))return I[G]}return x()}(U.url):h(H,!1);if(!N&&H){if(U.url&&!U.url.startsWith("blob:")){const G=await async function(U,G){const C=G.method||"GET";return await new Promise(((L,X)=>{const l=new V.d;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const U={};if(G.responseHeaders)for(const C of G.responseHeaders)U[C]=l.getResponseHeader(C)||"";L({response:l.response,headerValues:U})}else X("Unable to fetch data from ".concat(U,". Error code: ").concat(l.status))})),l.open(C,U),l.send()}))}(U.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=G.headerValues?G.headerValues["Content-Type"]:"";C&&(N=function(U){for(const G in I){const C=I[G];if(C.mimeType===U)return C}}(C))}N||(N=x())}if(!N)throw new Error("No plugin or fallback for ".concat(null!==t&&void 0!==t?t:U.url));if(!1===(null===K||void 0===K||null===(P=K[N.plugin.name])||void 0===P?void 0:P.enabled))throw new Error("The '".concat(N.plugin.name,"' plugin is disabled via the loader options passed to the loading operation."));if(U.rawData&&!N.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(U=>{if(N.plugin.createPlugin){const G=N.plugin.createPlugin(null!==K&&void 0!==K?K:{});return G instanceof Promise?(G.then(U).catch((U=>{X("Error instantiating plugin.",U)})),null):(U(G),G)}return U(N.plugin),N.plugin})((K=>{var P;if(!K)throw"The loader plugin corresponding to the '".concat(t,"' file type has not been found. If using es6, please import the plugin you wish to use before.");if(p.notifyObservers(K),T&&(K.canDirectLoad&&K.canDirectLoad(U.url)||!(0,O.k)(U.url))){if(K.directLoad){const U=K.directLoad(G,T);U instanceof Promise?U.then((U=>{C(K,U)})).catch((U=>{X("Error in directLoad of _loadData: "+U,U)})):C(K,U)}else C(K,T);return}const D=N.isBinary,V=(U,L)=>{G.t?X("Scene has been disposed"):C(K,U,L)};let I=null,H=!1;null===(P=K.aE)||void 0===P||P.add((()=>{H=!0,I&&(I.abort(),I=null),l()}));const x=()=>{if(H)return;const C=(U,G)=>{X(null===U||void 0===U?void 0:U.statusText,G)};if(!K.loadFile&&U.rawData)throw"Plugin does not support loading ArrayBufferView.";I=K.loadFile?K.loadFile(G,U.rawData||U.file||U.url,U.rootUrl,V,L,D,C,E):G._loadFile(U.file||U.url,V,L,!0,D,C)},h=G.getEngine();let b=h.enableOfflineSupport;if(b){let C=!1;for(const L of G.disableOfflineSupportExceptionRules)if(L.test(U.url)){C=!0;break}b=!C}b&&y.b.OfflineProviderFactory?G.offlineProvider=y.b.OfflineProviderFactory(U.url,x,h.disableManifestCheck):x()}))}function o(U,G){let C,L,l=null,t=null;if(G)if(G.name)C="file:".concat(G.name),L=G.name,l=G;else if(ArrayBuffer.isView(G))C="",L=(0,D.c)(),t=G;else if(G.startsWith("data:"))C=G,L="";else if(U){const l=G;if("/"===l.substring(0,1))return X.Tools.Error("Wrong sceneFilename parameter"),null;C=U+l,L=l}else C=G,L=X.Tools.GetFilename(G),U=X.Tools.GetFolderPath(G);else C=U,L=X.Tools.GetFilename(U),U=X.Tools.GetFolderPath(U);return{url:C,rootUrl:U,name:L,file:l,rawData:t}}function w(U){if("string"===typeof U.extensions){const G=U.extensions;I[G.toLowerCase()]={plugin:U,isBinary:!1}}else{const G=U.extensions,C=Object.keys(G);for(const L of C)I[L.toLowerCase()]={plugin:U,isBinary:G[L].isBinary,mimeType:G[L].mimeType}}}async function S(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.d.LastCreatedScene,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!L)return K.d.Error("No scene available to import mesh to"),null;const y=o(G,C);if(!y)return null;const V={};L.addPendingData(V);const p=()=>{L.removePendingData(V)},I=(U,G)=>{const C=N(y,U,G);t?t(L,C,new T.g(C,T.e.SceneLoaderError,G)):K.d.Error(C),p()},H=l?U=>{try{l(U)}catch(G){I("Error in onProgress callback: "+G,G)}}:void 0,x=(U,G,C,l,t,E,K,P)=>{if(L.importedMeshesFiles.push(y.url),X)try{X(U,G,C,l,t,E,K,P)}catch(O){I("Error in onSuccess callback: "+O,O)}L.removePendingData(V)};return await b(y,L,((G,C,X)=>{if(G.rewriteRootURL&&(y.rootUrl=G.rewriteRootURL(y.rootUrl,X)),G.importMesh){const X=[],l=[],t=[];if(!G.importMesh(U,L,C,y.rootUrl,X,l,t,I))return;L.loadingPluginName=G.name,x(X,l,t,[],[],[],[],[])}else{G.importMeshAsync(U,L,C,y.rootUrl,H,y.name).then((U=>{L.loadingPluginName=G.name,x(U.meshes,U.SD,U.skeletons,U.animationGroups,U.transformNodes,U.geometries,U.lights,U.spriteManagers)})).catch((U=>{I(U.message,U)}))}}),H,I,p,P,O,D)}async function v(U,G,C,L,X,l,t,E){return await new Promise(((K,P)=>{try{S(U,G,C,L,((U,G,C,L,X,l,t,E)=>{K({meshes:U,SD:G,skeletons:C,animationGroups:L,transformNodes:X,geometries:l,lights:t,spriteManagers:E})}),X,((U,G,C)=>{P(C||new Error(G))}),l,t,E).catch(P)}catch(T){P(T)}}))}async function u(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.d.LastCreatedEngine,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await g(U,G,new t.e(C),L,l,K,P,O,T):X.Tools.Error("No engine available")}async function d(U,G,C,L,X,l,t){return await new Promise(((E,K)=>{u(U,G,C,(U=>{E(U)}),L,((U,G,C)=>{K(C||new Error(G))}),X,l,t)}))}async function g(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.d.LastCreatedScene,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return K.d.Error("No scene available to append to"),null;const y=o(U,G);if(!y)return null;const V={};C.addPendingData(V);const p=()=>{C.removePendingData(V)};P.d.ShowLoadingScreen&&!H&&(H=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),H=!1})));const I=(U,G)=>{const L=N(y,U,G);l?l(C,L,new T.g(L,T.e.SceneLoaderError,G)):K.d.Error(L),p()},x=X?U=>{try{X(U)}catch(G){I("Error in onProgress callback",G)}}:void 0,h=()=>{if(L)try{L(C)}catch(U){I("Error in onSuccess callback",U)}C.removePendingData(V)};return await b(y,C,((U,G)=>{if(U.load){if(!U.load(C,G,y.rootUrl,I))return;C.loadingPluginName=U.name,h()}else{U.loadAsync(C,G,y.rootUrl,x,y.name).then((()=>{C.loadingPluginName=U.name,h()})).catch((U=>{I(U.message,U)}))}}),x,I,p,t,O,D)}async function Z(U,G,C,L,X,l,t){return await new Promise(((E,K)=>{try{g(U,G,C,(U=>{E(U)}),L,((U,G,C)=>{K(C||new Error(G))}),X,l,t).catch(K)}catch(T){K(T)}}))}async function F(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.d.LastCreatedScene,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return K.d.Error("No scene available to load asset container to"),null;const D=o(U,G);if(!D)return null;const y={};C.addPendingData(y);const V=()=>{C.removePendingData(y)},p=(U,G)=>{const L=N(D,U,G);l?l(C,L,new T.g(L,T.e.SceneLoaderError,G)):K.d.Error(L),V()},I=X?U=>{try{X(U)}catch(G){p("Error in onProgress callback",G)}}:void 0,H=U=>{if(L)try{L(U)}catch(G){p("Error in onSuccess callback",G)}C.removePendingData(y)};return await b(D,C,((U,G)=>{if(U.loadAssetContainer){const L=U.loadAssetContainer(C,G,D.rootUrl,p);if(!L)return;L.populateRootNodes(),C.loadingPluginName=U.name,H(L)}else if(U.loadAssetContainerAsync){U.loadAssetContainerAsync(C,G,D.rootUrl,I,D.name).then((G=>{G.populateRootNodes(),C.loadingPluginName=U.name,H(G)})).catch((U=>{p(U.message,U)}))}else p("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,p,V,t,P,O)}async function q(U,G,C,L,X,l,t){return await new Promise(((E,K)=>{try{F(U,G,C,(U=>{E(U)}),L,((U,G,C)=>{K(C||new Error(G))}),X,l,t).catch(K)}catch(T){K(T)}}))}async function a(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.d.LastCreatedScene,L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,T=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void K.d.Error("No scene available to load animations to");if(L){for(const L of C.animatables)L.reset();C.stopAllAnimations();const U=C.animationGroups.slice();for(const C of U)C.dispose();const G=C.getNodes();for(const C of G)C.animations&&(C.animations=[])}else switch(X){case 0:const U=C.animationGroups.slice();for(const G of U)G.dispose();break;case 1:for(const G of C.animationGroups)G.stop();break;case 2:for(const G of C.animationGroups)G.reset(),G.restart();break;case 3:break;default:return void K.d.Error("Unknown animation group loading mode value '"+X+"'")}const V=C.animatables.length;await F(U,G,C,(U=>{U.mergeAnimationsTo(C,C.animatables.slice(V),l),U.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),t&&t(C)}),P,O,T,D,y)}async function k(U,G,C,L,X,l,t,E,K,P){return await new Promise(((O,D)=>{try{a(U,G,C,L,X,l,(U=>{O(U)}),t,((U,G,C)=>{D(C||new Error(G))}),E,K,P).catch(D)}catch(T){D(T)}}))}class n{static get ForceFullSceneLoadingForIncremental(){return P.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(U){P.d.ForceFullSceneLoadingForIncremental=U}static get ShowLoadingScreen(){return P.d.ShowLoadingScreen}static set ShowLoadingScreen(U){P.d.ShowLoadingScreen=U}static get loggingLevel(){return P.d.loggingLevel}static set loggingLevel(U){P.d.loggingLevel=U}static get CleanBoneMatrixWeights(){return P.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(U){P.d.CleanBoneMatrixWeights=U}static GetDefaultPlugin(){return x()}static GetPluginForExtension(U){var G;return null===(G=h(U,!0))||void 0===G?void 0:G.plugin}static IsPluginForExtensionAvailable(U){return function(U){return!!I[U]}(U)}static RegisterPlugin(U){w(U)}static ImportMesh(U,G,C,L,X,l,t,K,P){S(U,G,C,L,X,l,t,K,P).catch((U=>null===t||void 0===t?void 0:t(E.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportMeshAsync(U,G,C,L,X,l,t){return await v(U,G,C,L,X,l,t)}static Load(U,G,C,L,X,l,t,K){u(U,G,C,L,X,l,t,K).catch((U=>null===l||void 0===l?void 0:l(E.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAsync(U,G,C,L,X,l){return await d(U,G,C,L,X,l)}static Append(U,G,C,L,X,l,t,K){g(U,G,C,L,X,l,t,K).catch((U=>null===l||void 0===l?void 0:l(null!==C&&void 0!==C?C:E.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async AppendAsync(U,G,C,L,X,l){return await Z(U,G,C,L,X,l)}static LoadAssetContainer(U,G,C,L,X,l,t,K){F(U,G,C,L,X,l,t,K).catch((U=>null===l||void 0===l?void 0:l(null!==C&&void 0!==C?C:E.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAssetContainerAsync(U,G,C,L,X,l){return await q(U,G,C,L,X,l)}static ImportAnimations(U,G,C,L,X,l,t,K,P,O,T){a(U,G,C,L,X,l,t,K,P,O,T).catch((U=>null===P||void 0===P?void 0:P(null!==C&&void 0!==C?C:E.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportAnimationsAsync(U,G,C,L,X,l,t,E,K,P,O){return await k(U,G,C,L,X,l,E,P,O)}}n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=p},14101:(U,G,C)=>{"use strict";C.d(G,{c:()=>D});var L=C(12876),X=C(12884),l=C(12718),t=C(12896),E=C(12913),K=C(12873),P=C(12850),O=C(12721),T=C(12928);C(14107);class D extends E.e{set boundingBoxSize(U){if(this._boundingBoxSize&&this._boundingBoxSize.equals(U))return;this._boundingBoxSize=U;const G=this.wU();G&&G.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(U){this._rotationY=U,this.setReflectionTextureMatrix(t.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(U,G,C){let L="";for(const X of U)L+=X;return new D(L,G,null,C,U)}static CreateFromPrefilteredData(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=G.useDelayedTextureLoading;G.useDelayedTextureLoading=!1;const l=new D(U,G,null,!1,null,null,null,void 0,!0,C,L);return G.useDelayedTextureLoading=X,l}constructor(U,G){var C;let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,H=arguments.length>13?arguments[13]:void 0,x=arguments.length>14?arguments[14]:void 0;super(G),this.onLoadObservable=new O.e,this.boundingBoxPosition=t.pG.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new t.Matrix,this._buffer=null,this.name=U,this.url=U,this._noMipmap=X,this.jE=!1,this.isCube=!0,this._textureMatrix=t.Matrix.Identity(),this.coordinatesMode=K.c.CUBIC_MODE;let h=null,N=null;var b,o,w,S,v,u,d,g,Z,F,q,a;null===L||Array.isArray(L)?(this._noMipmap=X,this._format=T,this._createPolynomials=V,h=L,this._loaderOptions=H,this._useSRGBBuffer=x,this._lodScale=p,this._lodOffset=I):(h=null!==(b=L.extensions)&&void 0!==b?b:null,this._noMipmap=null!==(o=L.noMipmap)&&void 0!==o&&o,l=null!==(w=L.files)&&void 0!==w?w:null,N=null!==(S=L.buffer)&&void 0!==S?S:null,this._format=null!==(v=L.format)&&void 0!==v?v:5,D=null!==(u=L.prefiltered)&&void 0!==u&&u,y=null!==(d=L.forcedExtension)&&void 0!==d?d:null,this._createPolynomials=null!==(g=L.createPolynomials)&&void 0!==g&&g,this._lodScale=null!==(Z=L.lodScale)&&void 0!==Z?Z:.8,this._lodOffset=null!==(F=L.lodOffset)&&void 0!==F?F:0,this._loaderOptions=L.loaderOptions,this._useSRGBBuffer=L.useSRGBBuffer,E=null!==(q=L.R)&&void 0!==q?q:null,P=null!==(a=L.onError)&&void 0!==a?a:null);(U||l)&&this.updateURL(U,y,E,D,P,h,null===(C=this.wU())||void 0===C?void 0:C.useDelayedTextureLoading,l,N)}getClassName(){return"CubeTexture"}updateURL(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=U),this.url=U,G&&(this._forcedExtension=G);const P=U.lastIndexOf("."),O=G||(P>-1?U.substring(P).toLowerCase():""),T=0===O.indexOf(".dds"),D=0===O.indexOf(".env"),y=0===O.indexOf(".basis");if(D?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=L,L&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),E)this._files=E;else if(y||D||T||l||(l=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,l){for(let G=0;G<l.length;G++)this._files.push(U+l[G]);this._extensions=l}this._buffer=K,t?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=X):this._loadTexture(C,X)}delayLoad(U){4===this.delayLoadState&&(U&&(this._forcedExtension=U),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(U){var G,C;if(U.updateFlag===this._textureMatrix.updateFlag)return;U.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.wU())||void 0===C||C.markAllMaterialsAsDirty(1,(U=>-1!==U.getActiveTextures().indexOf(this))));if(this._textureMatrix=U,null===(G=this.wU())||void 0===G||!G.useRightHandedSystem)return;const L=t.TmpVectors.pG[0],X=t.TmpVectors.Quaternion[0],l=t.TmpVectors.pG[1];this._textureMatrix.decompose(L,X,l),X.z*=-1,X.w*=-1,t.Matrix.ComposeToRef(L,X,l,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var U;return null!==(U=this.wU())&&void 0!==U&&U.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.wU(),L=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const X=()=>{var G;(this.onLoadObservable.notifyObservers(this),L)&&(L.dispose(),null===(G=this.wU())||void 0===G||G.markAllMaterialsAsDirty(1));U&&U()},t=(U,C)=>{this._loadingError=!0,this._errorObject={message:U,exception:C},G&&G(U,C),K.c.OnTextureLoadErrorObservable.notifyObservers(this)};var E;this._texture?this._texture.isReady?l.Tools.SetImmediate((()=>X())):this._texture.onLoadedObservable.add((()=>X())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,U,t,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,U,t,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(E=this._texture)||void 0===E||E.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(U,G,C){const L=T.c.Parse((()=>{var L;let X=!1;return U.prefiltered&&(X=U.prefiltered),new D(C+(null!==(L=U.url)&&void 0!==L?L:U.name),G,U.extensions,!1,U.files||null,null,null,void 0,X,U.forcedExtension)}),U,G);if(U.boundingBoxPosition&&(L.boundingBoxPosition=t.pG.NG(U.boundingBoxPosition)),U.boundingBoxSize&&(L.boundingBoxSize=t.pG.NG(U.boundingBoxSize)),U.animations)for(let X=0;X<U.animations.length;X++){const G=U.animations[X],C=(0,P.c)("BABYLON.Animation");C&&L.animations.push(C.Parse(G))}return L}clone(){let U=0;const G=T.c.Clone((()=>{const G=new D(this.url,this.wU()||this._getEngine(),this._extensions,this._noMipmap,this._files);return U=G.uniqueId,G}),this);return G.uniqueId=U,G}}(0,L.d)([(0,X.H)()],D.prototype,"url",void 0),(0,L.d)([(0,X.E)()],D.prototype,"boundingBoxPosition",void 0),(0,L.d)([(0,X.E)()],D.prototype,"boundingBoxSize",null),(0,L.d)([(0,X.H)("rotationY")],D.prototype,"rotationY",null),(0,L.d)([(0,X.H)("files")],D.prototype,"_files",void 0),(0,L.d)([(0,X.H)("forcedExtension")],D.prototype,"_forcedExtension",void 0),(0,L.d)([(0,X.H)("extensions")],D.prototype,"_extensions",void 0),(0,L.d)([(0,X.s)("textureMatrix")],D.prototype,"_textureMatrix",void 0),(0,L.d)([(0,X.s)("textureMatrixRefraction")],D.prototype,"_textureMatrixRefraction",void 0),K.c._CubeTextureParser=D.Parse,(0,P.e)("BABYLON.CubeTexture",D)},14642:(U,G,C)=>{"use strict";C.d(G,{e:()=>K});var L=C(12731),X=C(12873),l=C(12861),t=C(13016),E=C(12826);t.ThinEngine.prototype.createDynamicTexture=function(U,G,C,L){const X=new E.b(this,4);return X.baseWidth=U,X.baseHeight=G,C&&(U=this.needPOTTextures?(0,l.e)(U,this._caps.maxTextureSize):U,G=this.needPOTTextures?(0,l.e)(G,this._caps.maxTextureSize):G),X.width=U,X.height=G,X.isReady=!1,X.generateMipMaps=C,X.samplingMode=L,this.updateTextureSamplingMode(L,X),this._internalTexturesCache.push(X),X},t.ThinEngine.prototype.updateDynamicTexture=function(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!U)return;const t=this._gl,E=t.TEXTURE_2D,K=this._bindTextureDirectly(E,U,!0,l);this._unpackFlipY(void 0===C?U.invertY:C),L&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const P=this._getWebGLTextureType(U.type),O=this._getInternalFormat(X||U.format),T=this._getRGBABufferInternalSizedFormat(U.type,O);t.texImage2D(E,0,T,O,P,G),U.generateMipMaps&&t.generateMipmap(E),K||this._bindTextureDirectly(E,null),L&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),X&&(U.format=X),U._dynamicTextureSource=G,U._premulAlpha=L,U.invertY=C||!1,U.isReady=!0};class K extends X.c{constructor(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,E=arguments.length>6?arguments[6]:void 0;const K=!C||C._isScene;super(null,K?C:null===C||void 0===C?void 0:C.HG,K?!L:C,E,l,void 0,void 0,void 0,void 0,t),this.name=U,this.wrapU=X.c.CLAMP_ADDRESSMODE,this.wrapV=X.c.CLAMP_ADDRESSMODE,this._generateMipMaps=L;const P=this._getEngine();if(!P)return;if(G.getContext)this._canvas=G,this._ownCanvas=!1,this._texture=P.createDynamicTexture(this._canvas.width,this._canvas.height,L,l);else{this._canvas=P.createCanvas(1,1),this._ownCanvas=!0;const U=G;U.width||0===U.width?this._texture=P.createDynamicTexture(U.width,U.height,L,l):this._texture=P.createDynamicTexture(G,G,L,l)}const O=this.getSize();this._canvas.width!==O.width&&(this._canvas.width=O.width),this._canvas.height!==O.height&&(this._canvas.height=O.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(U){this._canvas.width=U.width,this._canvas.height=U.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(U.width,U.height,this._generateMipMaps,this.samplingMode)}scale(U){const G=this.getSize();G.width*=U,G.height*=U,this._recreate(G)}scaleTo(U,G){const C=this.getSize();C.width=U,C.height=G,this._recreate(C)}getContext(){return this._context}clear(U){const G=this.getSize();U&&(this._context.fillStyle=U),this._context.clearRect(0,0,G.width,G.height)}update(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===U||U,G,this._format||void 0,void 0,C)}drawText(U,G,C,L,X,l,t){let E=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const K=this.getSize();if(l&&(this._context.fillStyle=l,this._context.fillRect(0,0,K.width,K.height)),this._context.font=L,null===G||void 0===G){const C=this._context.measureText(U);G=(K.width-C.width)/2}if(null===C||void 0===C){const U=parseInt(L.replace(/\D/g,""));C=K.height/2+U/3.65}this._context.fillStyle=X||"",this._context.fillText(U,G,C),E&&this.update(t)}dispose(){var U,G;(super.dispose(),this._ownCanvas)&&(null===(U=this._canvas)||void 0===U||null===(G=U.remove)||void 0===G||G.call(U));this._canvas=null,this._context=null}clone(){const U=this.wU();if(!U)return this;const G=this.getSize(),C=new K(this.name,G,U,this._generateMipMaps);return C.jE=this.jE,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const U=this.wU();U&&!U.isReady()&&L.d.Warn("The scene must be ready before serializing the dynamic texture");const G=super.serialize();return K._IsCanvasElement(this._canvas)&&(G.base64String=this._canvas.toDataURL()),G.invertY=this._invertY,G.samplingMode=this.samplingMode,G}static _IsCanvasElement(U){return void 0!==U.toDataURL}_rebuild(){this.update()}}},14021:(U,G,C)=>{"use strict";C.d(G,{b:()=>X});var L=C(12873);class X extends L.c{get depth(){return this._depth}constructor(U,G,C,X,l,t){let E=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:L.c.TRILINEAR_SAMPLINGMODE,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,T=arguments.length>10?arguments[10]:void 0;super(null,t,!E,K),this.format=l,this._texture=t.getEngine().createRawTexture2DArray(U,G,C,X,l,E,K,P,null,O,T),this._depth=X,this.is2DArray=!0}update(U){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,U,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(U,G,C,L,l){return new X(U,G,C,L,5,l,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13845:(U,G,C)=>{"use strict";C.d(G,{b:()=>E,c:()=>K,d:()=>l,g:()=>t});var L=C(12911),X=C(12896);function l(U,G){return"{X: ".concat(U.x.toFixed(G)," Y: ").concat(U.y.toFixed(G),"}")}function t(U,G){return"{X: ".concat(U._x.toFixed(G)," Y: ").concat(U._y.toFixed(G)," Z: ").concat(U._z.toFixed(G),"}")}function E(U,G){return 2*Math.acos((0,L.Clamp)(X.Quaternion.Dot(U,G)))}function K(U,G){const C=new X.Quaternion;return function(U,G,C){const l=X.pG.Cross(U,G),t=Math.acos((0,L.Clamp)(X.pG.Dot(U,G),-1,1));X.Quaternion.RotationAxisToRef(l,t,C)}(U,G,C),C}},13697:(U,G,C)=>{"use strict";C.d(G,{e:()=>P});var L=C(12896),X=C(12934),l=C(13306),t=C(13285),E=C(12943);C(13701);function K(U){let G=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],l=[];let K=[];const P=U.width||U.size||1,O=U.height||U.size||1,T=U.depth||U.size||1,D=U.wrap||!1;let y=void 0===U.topBaseAt?1:U.topBaseAt,V=void 0===U.bottomBaseAt?0:U.bottomBaseAt;y=(y+4)%4,V=(V+4)%4;let p=[2,0,3,1][y],I=[2,0,1,3][V],H=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(D){G=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],H=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let U=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const L=[17,18,19,16],X=[22,23,20,21];for(;p>0;)U.unshift(U.pop()),L.unshift(L.pop()),p--;for(;I>0;)C.unshift(C.pop()),X.unshift(X.pop()),I--;U=U.flat(),C=C.flat(),H=H.concat(U).concat(C),G.push(L[0],L[2],L[3],L[0],L[1],L[2]),G.push(X[0],X[2],X[3],X[0],X[1],X[2])}const x=[P/2,O/2,T/2];K=H.reduce(((U,G,C)=>U.concat(G*x[C%3])),[]);const h=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,N=U.faceUV||new Array(6),b=U.faceColors,o=[];for(let t=0;t<6;t++)void 0===N[t]&&(N[t]=new L.Vector4(0,0,1,1)),b&&void 0===b[t]&&(b[t]=new X.JE(1,1,1,1));for(let L=0;L<6;L++)if(l.push(N[L].z,E.c?1-N[L].w:N[L].w),l.push(N[L].x,E.c?1-N[L].w:N[L].w),l.push(N[L].x,E.c?1-N[L].y:N[L].y),l.push(N[L].z,E.c?1-N[L].y:N[L].y),b)for(let U=0;U<4;U++)o.push(b[L].r,b[L].g,b[L].b,b[L].a);t.e._ComputeSides(h,K,G,C,l,U.frontUVs,U.backUVs);const w=new t.e;if(w.indices=G,w.vU=K,w.uU=C,w.gU=l,b){const U=h===t.e.DOUBLESIDE?o.concat(o):o;w.dU=U}return w}function P(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new l.d(U,C);G.sideOrientation=l.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return K(G).FU(L,G.updatable),L}t.e.CreateBox=K,l.d.CreateBox=function(U,G){return P(U,{size:G,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13838:(U,G,C)=>{"use strict";C.d(G,{e:()=>E});var L=C(13306),X=C(13285),l=C(12943);function t(U){const G=[],C=[],L=[],t=[],E=U.radius||.5,K=U.tessellation||64,P=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,O=0===U.sideOrientation?0:U.sideOrientation||X.e.DEFAULTSIDE;G.push(0,0,0),t.push(.5,.5);const T=2*Math.PI*P,D=1===P?T/K:T/(K-1);let y=0;for(let X=0;X<K;X++){const U=Math.cos(y),C=Math.sin(y),L=(U+1)/2,X=(1-C)/2;G.push(E*U,E*C,0),t.push(L,l.c?1-X:X),y+=D}1===P&&(G.push(G[3],G[4],G[5]),t.push(t[2],l.c?1-t[3]:t[3]));const V=G.length/3;for(let X=1;X<V-1;X++)C.push(X+1,0,X);X.e.ComputeNormals(G,C,L),X.e._ComputeSides(O,G,C,L,t,U.frontUVs,U.backUVs);const p=new X.e;return p.indices=C,p.vU=G,p.uU=L,p.gU=t,p}function E(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new L.d(U,C);G.sideOrientation=L.d._GetDefaultSideOrientation(G.sideOrientation),X._originalBuilderSideOrientation=G.sideOrientation;return t(G).FU(X,G.updatable),X}X.e.CreateDisc=t,L.d.CreateDisc=function(U,G,C){return E(U,{radius:G,tessellation:C,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13701:(U,G,C)=>{"use strict";C.d(G,{e:()=>I,d:()=>x,h:()=>H});var L=C(12896),X=C(12934),l=C(13306),t=C(13285),E=C(12957);l.d._GroundMeshParser=(U,G)=>K.Parse(U,G);class K extends l.d{constructor(U,G){super(U,G),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=U,this._subdivisionsY=U,this.subdivide(U);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(G)}getHeightAtCoordinates(U,G){const C=this.getWorldMatrix(),X=L.TmpVectors.Matrix[5];C.invertToRef(X);const l=L.TmpVectors.pG[8];if(L.pG.TransformCoordinatesFromFloatsToRef(U,0,G,X,l),U=l.x,G=l.z,U<this._minX||U>=this._maxX||G<=this._minZ||G>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const t=this._getFacetAt(U,G),E=-(t.x*U+t.z*G+t.w)/t.y;return L.pG.TransformCoordinatesFromFloatsToRef(0,E,0,C,l),l.y}getNormalAtCoordinates(U,G){const C=new L.pG(0,1,0);return this.getNormalAtCoordinatesToRef(U,G,C),C}getNormalAtCoordinatesToRef(U,G,C){const X=this.getWorldMatrix(),l=L.TmpVectors.Matrix[5];X.invertToRef(l);const t=L.TmpVectors.pG[8];if(L.pG.TransformCoordinatesFromFloatsToRef(U,0,G,l,t),U=t.x,G=t.z,U<this._minX||U>this._maxX||G<this._minZ||G>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const E=this._getFacetAt(U,G);return L.pG.TransformNormalFromFloatsToRef(E.x,E.y,E.z,X,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(U,G){const C=Math.floor((U+this._maxX)*this._subdivisionsX/this._width),L=Math.floor(-(G+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),X=this._heightQuads[L*this._subdivisionsX+C];let l;return l=G<X.slope.x*U+X.slope.y?X.facet1:X.facet2,l}_initHeightQuads(){const U=this._subdivisionsX,G=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<G;C++)for(let G=0;G<U;G++){const X={slope:L.Vector2.Zero(),facet1:new L.Vector4(0,0,0,0),facet2:new L.Vector4(0,0,0,0)};this._heightQuads[C*U+G]=X}return this}_computeHeightQuads(){const U=this.getVerticesData(E.e.PositionKind);if(!U)return this;const G=L.TmpVectors.pG[3],C=L.TmpVectors.pG[2],X=L.TmpVectors.pG[1],l=L.TmpVectors.pG[0],t=L.TmpVectors.pG[4],K=L.TmpVectors.pG[5],P=L.TmpVectors.pG[6],O=L.TmpVectors.pG[7],T=L.TmpVectors.pG[8];let D=0,y=0,V=0,p=0,I=0,H=0,x=0;const h=this._subdivisionsX,N=this._subdivisionsY;for(let E=0;E<N;E++)for(let N=0;N<h;N++){D=3*N,y=E*(h+1)*3,V=(E+1)*(h+1)*3,G.x=U[y+D],G.y=U[y+D+1],G.z=U[y+D+2],C.x=U[y+D+3],C.y=U[y+D+4],C.z=U[y+D+5],X.x=U[V+D],X.y=U[V+D+1],X.z=U[V+D+2],l.x=U[V+D+3],l.y=U[V+D+4],l.z=U[V+D+5],p=(l.z-G.z)/(l.x-G.x),I=G.z-p*G.x,C.subtractToRef(G,t),X.subtractToRef(G,K),l.subtractToRef(G,P),L.pG.CrossToRef(P,K,O),L.pG.CrossToRef(t,P,T),O.normalize(),T.normalize(),H=-(O.x*G.x+O.y*G.y+O.z*G.z),x=-(T.x*C.x+T.y*C.y+T.z*C.z);const b=this._heightQuads[E*h+N];b.slope.WE(p,I),b.facet1.WE(O.x,O.y,O.z,H),b.facet2.WE(T.x,T.y,T.z,x)}return this}serialize(U){super.serialize(U),U.subdivisionsX=this._subdivisionsX,U.subdivisionsY=this._subdivisionsY,U.minX=this._minX,U.maxX=this._maxX,U.AE=this._minZ,U.maxZ=this._maxZ,U.width=this._width,U.height=this._height}static Parse(U,G){const C=new K(U.name,G);return C._subdivisionsX=U.subdivisionsX||1,C._subdivisionsY=U.subdivisionsY||1,C._minX=U.minX,C._maxX=U.maxX,C._minZ=U.AE,C._maxZ=U.maxZ,C._width=U.width,C._height=U.height,C}}var P=C(12718),O=C(12763),T=C(12898),D=C(12943);function y(U){const G=[],C=[],X=[],l=[];let E,K;const P=U.width||U.size||1,O=U.height||U.size||1,T=0|(U.subdivisionsX||U.subdivisions||1),y=0|(U.subdivisionsY||U.subdivisions||1);for(E=0;E<=y;E++)for(K=0;K<=T;K++){const U=new L.pG(K*P/T-P/2,0,(y-E)*O/y-O/2),G=new L.pG(0,1,0);C.push(U.x,U.y,U.z),X.push(G.x,G.y,G.z),l.push(K/T,D.c?E/y:1-E/y)}for(E=0;E<y;E++)for(K=0;K<T;K++)G.push(K+1+(E+1)*(T+1)),G.push(K+1+E*(T+1)),G.push(K+E*(T+1)),G.push(K+(E+1)*(T+1)),G.push(K+1+(E+1)*(T+1)),G.push(K+E*(T+1));const V=new t.e;return V.indices=G,V.vU=C,V.uU=X,V.gU=l,V}function V(U){const G=void 0!==U.xmin&&null!==U.xmin?U.xmin:-1,C=void 0!==U.zmin&&null!==U.zmin?U.zmin:-1,X=void 0!==U.xmax&&null!==U.xmax?U.xmax:1,l=void 0!==U.zmax&&null!==U.zmax?U.zmax:1,E=U.subdivisions||{w:1,h:1},K=U.precision||{w:1,h:1},P=[],O=[],T=[],D=[];let y,V,p,I;E.h=E.h<1?1:E.h,E.w=E.w<1?1:E.w,K.w=K.w<1?1:K.w,K.h=K.h<1?1:K.h;const H=(X-G)/E.w,x=(l-C)/E.h;function h(U,G,C,X){const l=O.length/3,t=K.w+1;for(y=0;y<K.h;y++)for(V=0;V<K.w;V++){const U=[l+V+y*t,l+(V+1)+y*t,l+(V+1)+(y+1)*t,l+V+(y+1)*t];P.push(U[1]),P.push(U[2]),P.push(U[3]),P.push(U[0]),P.push(U[1]),P.push(U[3])}const E=L.pG.Zero(),p=new L.pG(0,1,0);for(y=0;y<=K.h;y++)for(E.z=y*(X-G)/K.h+G,V=0;V<=K.w;V++)E.x=V*(C-U)/K.w+U,E.y=0,O.push(E.x,E.y,E.z),T.push(p.x,p.y,p.z),D.push(V/K.w,y/K.h)}for(p=0;p<E.h;p++)for(I=0;I<E.w;I++)h(G+I*H,C+p*x,G+(I+1)*H,C+(p+1)*x);const N=new t.e;return N.indices=P,N.vU=O,N.uU=T,N.gU=D,N}function p(U){const G=[],C=[],l=[],E=[];let K,P;const O=U.colorFilter||new X.hG(.3,.59,.11),D=U.alphaFilter||0;let y=!1;if(U.minHeight>U.maxHeight){y=!0;const G=U.maxHeight;U.maxHeight=U.minHeight,U.minHeight=G}for(K=0;K<=U.subdivisions;K++)for(P=0;P<=U.subdivisions;P++){const G=new L.pG(P*U.width/U.subdivisions-U.width/2,0,(U.subdivisions-K)*U.height/U.subdivisions-U.height/2),X=4*(((G.x+U.width/2)/U.width*(U.bufferWidth-1)|0)+((1-(G.z+U.height/2)/U.height)*(U.bufferHeight-1)|0)*U.bufferWidth);let t=U.buffer[X]/255,V=U.buffer[X+1]/255,p=U.buffer[X+2]/255;const I=U.buffer[X+3]/255;y&&(t=1-t,V=1-V,p=1-p);const H=t*O.r+V*O.g+p*O.b;G.y=I>=D?U.minHeight+(U.maxHeight-U.minHeight)*H:U.minHeight-T.d,U.heightBuffer&&(U.heightBuffer[K*(U.subdivisions+1)+P]=G.y),C.push(G.x,G.y,G.z),l.push(0,0,0),E.push(P/U.subdivisions,1-K/U.subdivisions)}for(K=0;K<U.subdivisions;K++)for(P=0;P<U.subdivisions;P++){const L=P+1+(K+1)*(U.subdivisions+1),X=P+1+K*(U.subdivisions+1),l=P+K*(U.subdivisions+1),t=P+(K+1)*(U.subdivisions+1),E=C[3*L+1]>=U.minHeight,O=C[3*X+1]>=U.minHeight,T=C[3*l+1]>=U.minHeight;E&&O&&T&&(G.push(L),G.push(X),G.push(l));C[3*t+1]>=U.minHeight&&E&&T&&(G.push(t),G.push(L),G.push(l))}t.e.ComputeNormals(C,G,l);const V=new t.e;return V.indices=G,V.vU=C,V.uU=l,V.gU=E,V}function I(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new K(U,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=G.subdivisionsX||G.subdivisions||1,C._subdivisionsY=G.subdivisionsY||G.subdivisions||1,C._width=G.width||1,C._height=G.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return y(G).FU(C,G.updatable),C._setReady(!0),C}function H(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new l.d(U,C);return V(G).FU(L,G.updatable),L}function x(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=C.width||10,t=C.height||10,E=C.subdivisions||1,T=C.minHeight||0,D=C.maxHeight||1,y=C.colorFilter||new X.hG(.3,.59,.11),V=C.alphaFilter||0,I=C.updatable,H=C.onReady;L=L||O.d.LastCreatedScene;const x=new K(U,L);let h;x._subdivisionsX=E,x._subdivisionsY=E,x._width=l,x._height=t,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ,x._setReady(!1),C.passHeightBufferInCallback&&(h=new Float32Array((E+1)*(E+1)));const N=(U,G,C)=>{p({width:l,height:t,subdivisions:E,minHeight:T,maxHeight:D,colorFilter:y,buffer:U,bufferWidth:G,bufferHeight:C,alphaFilter:V,heightBuffer:h}).FU(x,I),H&&H(x,h),x._setReady(!0)};if("string"===typeof G){const U=U=>{var G;const C=U.width,X=U.height;if(L.t)return;const l=null===(G=L)||void 0===G?void 0:G.getEngine().resizeImageBitmap(U,C,X);N(l,C,X)};P.Tools.LoadImage(G,U,C.onError?C.onError:()=>{},L.offlineProvider)}else N(G.data,G.width,G.height);return x}t.e.CreateGround=y,t.e.CreateTiledGround=V,t.e.CreateGroundFromHeightMap=p,l.d.CreateGround=(U,G,C,L,X,l)=>I(U,{width:G,height:C,subdivisions:L,updatable:l},X),l.d.CreateTiledGround=(U,G,C,L,X,l,t,E,K)=>H(U,{xmin:G,zmin:C,xmax:L,zmax:X,subdivisions:l,precision:t,updatable:K},E),l.d.CreateGroundFromHeightMap=(U,G,C,L,X,l,t,E,K,P,O)=>x(U,G,{width:C,height:L,subdivisions:X,minHeight:l,maxHeight:t,updatable:K,onReady:P,alphaFilter:O},E)},14230:(U,G,C)=>{"use strict";C.d(G,{e:()=>y,i:()=>T,k:()=>D});var L=C(12896),X=C(13306),l=C(13285),t=C(13421),E=C(12957),K=C(12731);function P(U){const G=[],C=[],L=U.lines,X=U.dU,t=[];let E=0;for(let l=0;l<L.length;l++){const U=L[l];for(let L=0;L<U.length;L++){const{x:K,y:P,z:O}=U[L];if(C.push(K,P,O),X){const U=X[l],{r:G,g:C,b:E,a:K}=U[L];t.push(G,C,E,K)}L>0&&(G.push(E-1),G.push(E)),E++}}const K=new l.e;return K.indices=G,K.vU=C,X&&(K.dU=t),K}function O(U){const G=U.dashSize||3,C=U.gapSize||1,X=U.dashNb||200,t=U.points,E=[],K=[],P=L.pG.Zero();let O=0,T=0,D=0,y=0,V=0,p=0,I=0;for(I=0;I<t.length-1;I++)t[I+1].subtractToRef(t[I],P),O+=P.length();for(D=O/X,y=G*D/(G+C),I=0;I<t.length-1;I++){t[I+1].subtractToRef(t[I],P),T=Math.floor(P.length()/D),P.normalize();for(let U=0;U<T;U++)V=D*U,E.push(t[I].x+V*P.x,t[I].y+V*P.y,t[I].z+V*P.z),E.push(t[I].x+(V+y)*P.x,t[I].y+(V+y)*P.y,t[I].z+(V+y)*P.z),K.push(p,p+1),p+=2}const H=new l.e;return H.vU=E,H.indices=K,H}function T(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=G.instance,X=G.lines,l=G.dU;if(L){const U=L.getVerticesData(E.e.PositionKind);let G,C;l&&(G=L.getVerticesData(E.e.ColorKind));let t=0,K=0;for(let L=0;L<X.length;L++){const E=X[L];for(let X=0;X<E.length;X++)U[t]=E[X].x,U[t+1]=E[X].y,U[t+2]=E[X].z,l&&G&&(C=l[L],G[K]=C[X].r,G[K+1]=C[X].g,G[K+2]=C[X].b,G[K+3]=C[X].a,K+=4),t+=3}return L.updateVerticesData(E.e.PositionKind,U,!1,!1),l&&G&&L.updateVerticesData(E.e.ColorKind,G,!1,!1),L.refreshBoundingInfo(),L}const K=!!l,O=new t.b(U,C,null,void 0,void 0,K,G.useVertexAlpha,G.material);return P(G).FU(O,G.updatable),O}function D(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=G.dU?[G.dU]:null;return T(U,{lines:[G.points],updatable:G.updatable,instance:G.instance,dU:L,useVertexAlpha:G.useVertexAlpha,material:G.material},C)}function y(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=G.points,E=G.instance,P=G.gapSize||1,T=G.dashSize||3;if(E){const U=U=>{const G=L.pG.Zero(),C=U.length/6;let X=0,t=0,K=0,P=0,O=0,T=0,D=0,y=0;for(D=0;D<l.length-1;D++)l[D+1].subtractToRef(l[D],G),X+=G.length();K=X/C;const V=E._creationDataStorage.dashSize;for(P=V*K/(V+E._creationDataStorage.gapSize),D=0;D<l.length-1;D++)for(l[D+1].subtractToRef(l[D],G),t=Math.floor(G.length()/K),G.normalize(),y=0;y<t&&T<U.length;)O=K*y,U[T]=l[D].x+O*G.x,U[T+1]=l[D].y+O*G.y,U[T+2]=l[D].z+O*G.z,U[T+3]=l[D].x+(O+P)*G.x,U[T+4]=l[D].y+(O+P)*G.y,U[T+5]=l[D].z+(O+P)*G.z,T+=6,y++;for(;T<U.length;)U[T]=l[D].x,U[T+1]=l[D].y,U[T+2]=l[D].z,T+=3};return(G.dashNb||G.dashSize||G.gapSize||G.useVertexAlpha||G.material)&&K.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),E.updateMeshPositions(U,!1),E}const D=new t.b(U,C,null,void 0,void 0,void 0,G.useVertexAlpha,G.material);return O(G).FU(D,G.updatable),D._creationDataStorage=new X.g,D._creationDataStorage.dashSize=T,D._creationDataStorage.gapSize=P,D}l.e.CreateLineSystem=P,l.e.CreateDashedLines=O,X.d.iP=function(U,G){return D(U,{points:G,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},X.d.CreateDashedLines=function(U,G,C,L,X){return y(U,{points:G,dashSize:C,gapSize:L,dashNb:X,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13742:(U,G,C)=>{"use strict";C.d(G,{c:()=>E,g:()=>K});var L=C(13306),X=C(13285),l=C(12943);function t(U){const G=[],C=[],L=[],t=[],E=void 0!==U.width?U.width:void 0!==U.size?U.size:1,K=void 0!==U.height?U.height:void 0!==U.size?U.size:1,P=0===U.sideOrientation?0:U.sideOrientation||X.e.DEFAULTSIDE,O=E/2,T=K/2;C.push(-O,-T,0),L.push(0,0,-1),t.push(0,l.c?1:0),C.push(O,-T,0),L.push(0,0,-1),t.push(1,l.c?1:0),C.push(O,T,0),L.push(0,0,-1),t.push(1,l.c?0:1),C.push(-O,T,0),L.push(0,0,-1),t.push(0,l.c?0:1),G.push(0),G.push(1),G.push(2),G.push(0),G.push(2),G.push(3),X.e._ComputeSides(P,C,G,L,t,U.frontUVs,U.backUVs);const D=new X.e;return D.indices=G,D.vU=C,D.uU=L,D.gU=t,D}function E(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new L.d(U,C);G.sideOrientation=L.d._GetDefaultSideOrientation(G.sideOrientation),X._originalBuilderSideOrientation=G.sideOrientation;return t(G).FU(X,G.updatable),G.sourcePlane&&(X.translate(G.sourcePlane.normal,-G.sourcePlane.d),X.setDirection(G.sourcePlane.normal.scale(-1))),X}const K={WP:E};X.e.WP=t,L.d.WP=(U,G,C,L,X)=>E(U,{size:G,width:G,height:G,sideOrientation:X,updatable:L},C)},13826:(U,G,C)=>{"use strict";C.d(G,{b:()=>K});var L=C(12896),X=C(13306),l=C(13285),t=C(12943);function E(U){const G=0|(U.segments||32),C=U.diameterX||U.diameter||1,X=U.diameterY||U.diameter||1,E=U.diameterZ||U.diameter||1,K=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,P=U.slice&&U.slice<=0?1:U.slice||1,O=0===U.sideOrientation?0:U.sideOrientation||l.e.DEFAULTSIDE,T=!!U.dedupTopBottomIndices,D=new L.pG(C/2,X/2,E/2),y=2+G,V=2*y,p=[],I=[],H=[],x=[];for(let l=0;l<=y;l++){const U=l/y,G=U*Math.PI*P;for(let C=0;C<=V;C++){const X=C/V,l=X*Math.PI*2*K,E=L.Matrix.RotationZ(-G),P=L.Matrix.RotationY(l),O=L.pG.TransformCoordinates(L.pG.Up(),E),T=L.pG.TransformCoordinates(O,P),y=T.multiply(D),p=T.divide(D).normalize();I.push(y.x,y.y,y.z),H.push(p.x,p.y,p.z),x.push(X,t.c?1-U:U)}if(l>0){const U=I.length/3;for(let G=U-2*(V+1);G+V+2<U;G++)T?(l>1&&(p.push(G),p.push(G+1),p.push(G+V+1)),(l<y||P<1)&&(p.push(G+V+1),p.push(G+1),p.push(G+V+2))):(p.push(G),p.push(G+1),p.push(G+V+1),p.push(G+V+1),p.push(G+1),p.push(G+V+2))}}l.e._ComputeSides(O,I,p,H,x,U.frontUVs,U.backUVs);const h=new l.e;return h.indices=p,h.vU=I,h.uU=H,h.gU=x,h}function K(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return E(G).FU(L,G.updatable),L}l.e.CreateSphere=E,X.d.CreateSphere=(U,G,C,L,X,l)=>K(U,{segments:G,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:l,updatable:X},L)},14650:(U,G,C)=>{"use strict";C.d(G,{c:()=>K});var L=C(26),X=C(13445),l=C(14110),t=C(13462),E=C(13285);class K{static get Configuration(){return{get decoder(){return l.b.DefaultConfiguration},set decoder(U){l.b.DefaultConfiguration=U}}}static set Configuration(U){l.b.DefaultConfiguration=U.decoder}static get DecoderAvailable(){return(0,X.g)(l.b.DefaultConfiguration)}static get Default(){var U;return null!==(U=K._Default)&&void 0!==U||(K._Default=new K),K._Default}static ResetDefault(U){K._Default&&(U||K._Default.dispose(),K._Default=null)}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.DefaultNumWorkers;const G="number"===typeof U?(0,L.b)((0,L.b)({},l.b.DefaultConfiguration),{},{numWorkers:U}):(0,L.b)((0,L.b)({},l.b.DefaultConfiguration),U);this._decoder=new l.b(G)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(U,G,C){return this._decoder.decodeMeshToMeshDataAsync(U,G,C)}async decodeMeshToGeometryAsync(U,G,C,L){return await this._decoder.decodeMeshToGeometryAsync(U,G,C,L)}async _decodeMeshToGeometryForGltfAsync(U,G,C,L,X,l){return await this._decoder._decodeMeshToGeometryForGltfAsync(U,G,C,L,X,l)}async decodeMeshAsync(U,G){const C=await this._decoder.decodeMeshToMeshDataAsync(U,G),L=new E.e;C.indices&&(L.indices=C.indices);for(const X of C.attributes){const U=t.d.GetFloatData(X.data,X.size,t.d.GetDataType(X.data),X.byteOffset,X.byteStride,X.normalized,C.totalVertices);L.set(U,X.kind)}return L}}K.DefaultNumWorkers=(0,X.d)(),K._Default=null},14110:(U,G,C)=>{"use strict";C.d(G,{b:()=>P});var L=C(13445),X=C(12718),l=C(13319),t=C(13462),E=C(12731),K=C(13456);class P extends L.b{static get DefaultAvailable(){return(0,L.g)(P.DefaultConfiguration)}static get Default(){var U;return null!==(U=P._Default)&&void 0!==U||(P._Default=new P),P._Default}static ResetDefault(U){P._Default&&(U||P._Default.dispose(),P._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(U,G){return{module:await(G||DracoDecoderModule)({wasmBinary:U})}}_getWorkerContent(){return"".concat(K.e,"(").concat(K.g,")()")}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.DefaultConfiguration)}decodeMeshToMeshDataAsync(U,G,C){const L=U instanceof ArrayBuffer?new Int8Array(U):new Int8Array(U.buffer,U.byteOffset,U.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async U=>await new Promise(((X,l)=>{U.push(((U,t)=>{let K=null;const P=[],O=G=>{U.removeEventListener("error",O),U.removeEventListener("message",T),l(G),t()},T=G=>{const L=G.data;switch(L.id){case"indices":K=L.data;break;case"attribute":P.push({kind:L.kind,data:L.data,size:L.size,byteOffset:L.byteOffset,byteStride:L.byteStride,normalized:(l=L.kind,D=L.normalized,C&&void 0!==C[l]?(D!==C[l]&&E.d.Warn("Normalized flag from Draco data (".concat(D,") does not match normalized flag from glTF accessor (").concat(C[l],"). Using flag from glTF accessor.")),C[l]):D)});break;case"decodeMeshDone":U.removeEventListener("error",O),U.removeEventListener("message",T),X({indices:K,attributes:P,totalVertices:L.totalVertices}),t()}var l,D};U.addEventListener("error",O),U.addEventListener("message",T);const D=L.slice();U.postMessage({id:"decodeMesh",dataView:D,attributes:G},[D.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((U=>{let C=null;const X=[],l=(0,K.e)(U.module,L,G,(U=>{C=U}),((U,G,C,L,l,t)=>{X.push({kind:U,data:G,size:C,byteOffset:L,byteStride:l,normalized:t})}));return{indices:C,attributes:X,totalVertices:l}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(U,G,C,L){const X=await this.decodeMeshToMeshDataAsync(C,L),E=new l.d(U,G);X.indices&&E.setIndices(X.indices);for(const l of X.attributes)E.setVerticesBuffer(new t.d(G.getEngine(),l.data,l.kind,!1,void 0,l.byteStride,void 0,l.byteOffset,l.size,void 0,l.normalized,!0),X.totalVertices);return E}async _decodeMeshToGeometryForGltfAsync(U,G,C,L,X,E){const K=await this.decodeMeshToMeshDataAsync(C,L,X),P=new l.d(U,G);E&&(P._boundingInfo=E,P.useBoundingInfoFromGeometry=!0),K.indices&&P.setIndices(K.indices);for(const l of K.attributes)P.setVerticesBuffer(new t.d(G.getEngine(),l.data,l.kind,!1,void 0,l.byteStride,void 0,l.byteOffset,l.size,void 0,l.normalized,!0),K.totalVertices);return P}}P.DefaultConfiguration={wasmUrl:"".concat(X.Tools._DefaultCdnUrl,"/draco_wasm_wrapper_gltf.js"),wasmBinaryUrl:"".concat(X.Tools._DefaultCdnUrl,"/draco_decoder_gltf.wasm"),fallbackUrl:"".concat(X.Tools._DefaultCdnUrl,"/draco_decoder_gltf.js")},P._Default=null},14226:(U,G,C)=>{"use strict";C.d(G,{c:()=>EU});var L=C(12896),X=C(13306),l=C(12957),t=C(13285),E=C(12943);function K(U){let G=U.pathArray;const C=U.closeArray||!1,L=U.closePath||!1,X=U.invertUV||!1,K=Math.floor(G[0].length/2);let P=U.offset||K;P=P>K?K:Math.floor(P);const O=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,T=U.gU,D=U.dU,y=[],V=[],p=[],I=[],H=[],x=[],h=[],N=[];let b;const o=[],w=[];let S,v,u;if(G.length<2){const U=[],C=[];for(v=0;v<G[0].length-P;v++)U.push(G[0][v]),C.push(G[0][v+P]);G=[U,C]}let d=0;const g=L?1:0,Z=C?1:0;let F,q,a,k,n,Q;for(b=G[0].length,S=0;S<G.length+Z;S++){for(h[S]=0,H[S]=[0],F=S===G.length?G[0]:G[S],q=F.length,b=b<q?b:q,u=0;u<q;)y.push(F[u].x,F[u].y,F[u].z),u>0&&(a=F[u].IG(F[u-1]).length(),k=a+h[S],H[S].push(k),h[S]=k),u++;L&&(u--,y.push(F[0].x,F[0].y,F[0].z),a=F[u].IG(F[0]).length(),k=a+h[S],H[S].push(k),h[S]=k),o[S]=q+g,w[S]=d,d+=q+g}let mU,B,M=null,z=null;for(v=0;v<b+g;v++)for(N[v]=0,x[v]=[0],S=0;S<G.length-1+Z;S++)n=G[S],Q=S===G.length-1?G[0]:G[S+1],v===b?(M=n[0],z=Q[0]):(M=n[v],z=Q[v]),a=z.IG(M).length(),k=a+N[v],x[v].push(k),N[v]=k;if(T)for(S=0;S<T.length;S++)I.push(T[S].x,E.c?1-T[S].y:T[S].y);else for(S=0;S<G.length+Z;S++)for(v=0;v<b+g;v++)mU=0!=h[S]?H[S][v]/h[S]:0,B=0!=N[v]?x[v][S]/N[v]:0,X?I.push(B,mU):I.push(mU,E.c?1-B:B);S=0;let s=0,j=o[S]-1,A=o[S+1]-1,Y=j<A?j:A,e=w[1]-w[0];const i=o.length-1;for(;s<=Y&&S<i;)V.push(s,s+e,s+1),V.push(s+e+1,s+1,s+e),s+=1,s===Y&&(S++,e=w[S+1]-w[S],j=o[S]-1,A=o[S+1]-1,s=w[S],Y=j<A?j+s:A+s);if(t.e.ComputeNormals(y,V,p),L){let U=0,C=0;for(S=0;S<G.length;S++){U=3*w[S],C=S+1<G.length?3*(w[S+1]-1):p.length-3,p[U]=.5*(p[U]+p[C]),p[U+1]=.5*(p[U+1]+p[C+1]),p[U+2]=.5*(p[U+2]+p[C+2]);const L=Math.sqrt(p[U]*p[U]+p[U+1]*p[U+1]+p[U+2]*p[U+2]);p[U]/=L,p[U+1]/=L,p[U+2]/=L,p[C]=p[U],p[C+1]=p[U+1],p[C+2]=p[U+2]}}if(C){let U=3*w[0],C=3*w[G.length];for(v=0;v<b+g;v++){p[U]=.5*(p[U]+p[C]),p[U+1]=.5*(p[U+1]+p[C+1]),p[U+2]=.5*(p[U+2]+p[C+2]);const G=Math.sqrt(p[U]*p[U]+p[U+1]*p[U+1]+p[U+2]*p[U+2]);p[U]/=G,p[U+1]/=G,p[U+2]/=G,p[C]=p[U],p[C+1]=p[U+1],p[C+2]=p[U+2],U+=3,C+=3}}t.e._ComputeSides(O,y,V,p,I,U.frontUVs,U.backUVs);let c=null;if(D){c=new Float32Array(4*D.length);for(let U=0;U<D.length;U++)c[4*U]=D[U].r,c[4*U+1]=D[U].g,c[4*U+2]=D[U].b,c[4*U+3]=D[U].a}const R=new t.e,W=new Float32Array(y),f=new Float32Array(p),r=new Float32Array(I);return R.indices=V,R.vU=W,R.uU=f,R.gU=r,c&&R.set(c,l.e.ColorKind),L&&(R._idx=w),R}function P(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=G.pathArray,O=G.closeArray,T=G.closePath,D=X.d._GetDefaultSideOrientation(G.sideOrientation),y=G.instance,V=G.updatable;if(y){const U=L.TmpVectors.pG[0].rE(Number.MAX_VALUE),C=L.TmpVectors.pG[1].rE(-Number.MAX_VALUE),K=G=>{let L=P[0].length;const l=y;let t=0;const E=l._originalBuilderSideOrientation===X.d.DOUBLESIDE?2:1;for(let X=1;X<=E;++X)for(let E=0;E<P.length;++E){const X=P[E],K=X.length;L=L<K?L:K;for(let l=0;l<L;++l){const L=X[l];G[t]=L.x,G[t+1]=L.y,G[t+2]=L.z,U.minimizeInPlaceFromFloats(L.x,L.y,L.z),C.maximizeInPlaceFromFloats(L.x,L.y,L.z),t+=3}if(l._creationDataStorage&&l._creationDataStorage.closePath){const U=X[0];G[t]=U.x,G[t+1]=U.y,G[t+2]=U.z,t+=3}}},O=y.getVerticesData(l.e.PositionKind);if(K(O),y.hasBoundingInfo?y.getBoundingInfo().reConstruct(U,C,y._worldMatrix):y.buildBoundingInfo(U,C,y._worldMatrix),y.updateVerticesData(l.e.PositionKind,O,!1,!1),G.dU){const U=y.getVerticesData(l.e.ColorKind);for(let C=0,L=0;C<G.dU.length;C++,L+=4){const X=G.dU[C];U[L]=X.r,U[L+1]=X.g,U[L+2]=X.b,U[L+3]=X.a}y.updateVerticesData(l.e.ColorKind,U,!1,!1)}if(G.gU){const U=y.getVerticesData(l.e.UVKind);for(let C=0;C<G.gU.length;C++)U[2*C]=G.gU[C].x,U[2*C+1]=E.c?1-G.gU[C].y:G.gU[C].y;y.updateVerticesData(l.e.UVKind,U,!1,!1)}if(!y.areNormalsFrozen||y.isFacetDataEnabled){const U=y.cE(),G=y.getVerticesData(l.e.NormalKind),C=y.isFacetDataEnabled?y.getFacetDataParameters():null;if(t.e.ComputeNormals(O,U,G,C),y._creationDataStorage&&y._creationDataStorage.closePath){let U=0,C=0;for(let L=0;L<P.length;L++)U=3*y._creationDataStorage.idx[L],C=L+1<P.length?3*(y._creationDataStorage.idx[L+1]-1):G.length-3,G[U]=.5*(G[U]+G[C]),G[U+1]=.5*(G[U+1]+G[C+1]),G[U+2]=.5*(G[U+2]+G[C+2]),G[C]=G[U],G[C+1]=G[U+1],G[C+2]=G[U+2]}y.areNormalsFrozen||y.updateVerticesData(l.e.NormalKind,G,!1,!1)}return y}{const L=new X.d(U,C);L._originalBuilderSideOrientation=D,L._creationDataStorage=new X.g;const l=K(G);return T&&(L._creationDataStorage.idx=l._idx),L._creationDataStorage.closePath=T,L._creationDataStorage.closeArray=O,l.FU(L,V),L}}t.e.CreateRibbon=K,X.d.CreateRibbon=function(U,G){return P(U,{pathArray:G,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var O=C(13838),T=C(13697),D=C(12934);function y(U){const G=U.pattern||X.d.NO_FLIP,C=U.tileWidth||U.tileSize||1,L=U.tileHeight||U.tileSize||1,l=U.alignHorizontal||0,E=U.alignVertical||0,K=U.width||U.size||1,P=Math.floor(K/C);let O=K-P*C;const T=U.height||U.size||1,D=Math.floor(T/L);let y=T-D*L;const V=C*P/2,p=L*D/2;let I=0,H=0,x=0,h=0,N=0,b=0;if(O>0||y>0){switch(x=-V,h=-p,N=V,b=p,l){case X.d.CENTER:O/=2,x-=O,N+=O;break;case X.d.LEFT:N+=O,I=-O/2;break;case X.d.RIGHT:x-=O,I=O/2}switch(E){case X.d.CENTER:y/=2,h-=y,b+=y;break;case X.d.BOTTOM:b+=y,H=-y/2;break;case X.d.TOP:h-=y,H=y/2}}const o=[],w=[],S=[];S[0]=[0,0,1,0,1,1,0,1],S[1]=[0,0,1,0,1,1,0,1],G!==X.d.ROTATE_TILE&&G!==X.d.ROTATE_ROW||(S[1]=[1,1,0,1,0,0,1,0]),G!==X.d.FLIP_TILE&&G!==X.d.FLIP_ROW||(S[1]=[1,0,0,0,0,1,1,1]),G!==X.d.FLIP_N_ROTATE_TILE&&G!==X.d.FLIP_N_ROTATE_ROW||(S[1]=[0,1,1,1,1,0,0,0]);let v=[];const u=[],d=[];let g=0;for(let t=0;t<D;t++)for(let U=0;U<P;U++)o.push(U*C-V+I,t*L-p+H,0),o.push((U+1)*C-V+I,t*L-p+H,0),o.push((U+1)*C-V+I,(t+1)*L-p+H,0),o.push(U*C-V+I,(t+1)*L-p+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),v=G===X.d.FLIP_TILE||G===X.d.ROTATE_TILE||G===X.d.FLIP_N_ROTATE_TILE?v.concat(S[(U%2+t%2)%2]):G===X.d.FLIP_ROW||G===X.d.ROTATE_ROW||G===X.d.FLIP_N_ROTATE_ROW?v.concat(S[t%2]):v.concat(S[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),g+=4;if(O>0||y>0){const U=y>0&&(E===X.d.CENTER||E===X.d.TOP),t=y>0&&(E===X.d.CENTER||E===X.d.BOTTOM),K=O>0&&(l===X.d.CENTER||l===X.d.RIGHT),T=O>0&&(l===X.d.CENTER||l===X.d.LEFT);let S,Z,F,q,a=[];if(U&&K&&(o.push(x+I,h+H,0),o.push(-V+I,h+H,0),o.push(-V+I,h+y+H,0),o.push(x+I,h+y+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=1-O/C,Z=1-y/L,F=1,q=1,a=[S,Z,F,Z,F,q,S,q],G===X.d.ROTATE_ROW&&(a=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),G===X.d.FLIP_ROW&&(a=[1-S,Z,1-F,Z,1-F,q,1-S,q]),G===X.d.FLIP_N_ROTATE_ROW&&(a=[S,1-Z,F,1-Z,F,1-q,S,1-q]),v=v.concat(a),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&T&&(o.push(V+I,h+H,0),o.push(N+I,h+H,0),o.push(N+I,h+y+H,0),o.push(V+I,h+y+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=0,Z=1-y/L,F=O/C,q=1,a=[S,Z,F,Z,F,q,S,q],(G===X.d.ROTATE_ROW||G===X.d.ROTATE_TILE&&P%2===0)&&(a=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),(G===X.d.FLIP_ROW||G===X.d.FLIP_TILE&&P%2===0)&&(a=[1-S,Z,1-F,Z,1-F,q,1-S,q]),(G===X.d.FLIP_N_ROTATE_ROW||G===X.d.FLIP_N_ROTATE_TILE&&P%2===0)&&(a=[S,1-Z,F,1-Z,F,1-q,S,1-q]),v=v.concat(a),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&K&&(o.push(x+I,p+H,0),o.push(-V+I,p+H,0),o.push(-V+I,b+H,0),o.push(x+I,b+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=1-O/C,Z=0,F=1,q=y/L,a=[S,Z,F,Z,F,q,S,q],(G===X.d.ROTATE_ROW&&D%2===1||G===X.d.ROTATE_TILE&&D%1===0)&&(a=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),(G===X.d.FLIP_ROW&&D%2===1||G===X.d.FLIP_TILE&&D%2===0)&&(a=[1-S,Z,1-F,Z,1-F,q,1-S,q]),(G===X.d.FLIP_N_ROTATE_ROW&&D%2===1||G===X.d.FLIP_N_ROTATE_TILE&&D%2===0)&&(a=[S,1-Z,F,1-Z,F,1-q,S,1-q]),v=v.concat(a),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&T&&(o.push(V+I,p+H,0),o.push(N+I,p+H,0),o.push(N+I,b+H,0),o.push(V+I,b+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,S=0,Z=0,F=O/C,q=y/L,a=[S,Z,F,Z,F,q,S,q],(G===X.d.ROTATE_ROW&&D%2===1||G===X.d.ROTATE_TILE&&(D+P)%2===1)&&(a=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),(G===X.d.FLIP_ROW&&D%2===1||G===X.d.FLIP_TILE&&(D+P)%2===1)&&(a=[1-S,Z,1-F,Z,1-F,q,1-S,q]),(G===X.d.FLIP_N_ROTATE_ROW&&D%2===1||G===X.d.FLIP_N_ROTATE_TILE&&(D+P)%2===1)&&(a=[S,1-Z,F,1-Z,F,1-q,S,1-q]),v=v.concat(a),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U){const U=[];S=0,Z=1-y/L,F=1,q=1,U[0]=[S,Z,F,Z,F,q,S,q],U[1]=[S,Z,F,Z,F,q,S,q],G!==X.d.ROTATE_TILE&&G!==X.d.ROTATE_ROW||(U[1]=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),G!==X.d.FLIP_TILE&&G!==X.d.FLIP_ROW||(U[1]=[1-S,Z,1-F,Z,1-F,q,1-S,q]),G!==X.d.FLIP_N_ROTATE_TILE&&G!==X.d.FLIP_N_ROTATE_ROW||(U[1]=[S,1-Z,F,1-Z,F,1-q,S,1-q]);for(let L=0;L<P;L++)o.push(L*C-V+I,h+H,0),o.push((L+1)*C-V+I,h+H,0),o.push((L+1)*C-V+I,h+y+H,0),o.push(L*C-V+I,h+y+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=G===X.d.FLIP_TILE||G===X.d.ROTATE_TILE||G===X.d.FLIP_N_ROTATE_TILE?v.concat(U[(L+1)%2]):G===X.d.FLIP_ROW||G===X.d.ROTATE_ROW||G===X.d.FLIP_N_ROTATE_ROW?v.concat(U[1]):v.concat(U[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const U=[];S=0,Z=0,F=1,q=y/L,U[0]=[S,Z,F,Z,F,q,S,q],U[1]=[S,Z,F,Z,F,q,S,q],G!==X.d.ROTATE_TILE&&G!==X.d.ROTATE_ROW||(U[1]=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),G!==X.d.FLIP_TILE&&G!==X.d.FLIP_ROW||(U[1]=[1-S,Z,1-F,Z,1-F,q,1-S,q]),G!==X.d.FLIP_N_ROTATE_TILE&&G!==X.d.FLIP_N_ROTATE_ROW||(U[1]=[S,1-Z,F,1-Z,F,1-q,S,1-q]);for(let L=0;L<P;L++)o.push(L*C-V+I,b-y+H,0),o.push((L+1)*C-V+I,b-y+H,0),o.push((L+1)*C-V+I,b+H,0),o.push(L*C-V+I,b+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=G===X.d.FLIP_TILE||G===X.d.ROTATE_TILE||G===X.d.FLIP_N_ROTATE_TILE?v.concat(U[(L+D)%2]):G===X.d.FLIP_ROW||G===X.d.ROTATE_ROW||G===X.d.FLIP_N_ROTATE_ROW?v.concat(U[D%2]):v.concat(U[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const U=[];S=1-O/C,Z=0,F=1,q=1,U[0]=[S,Z,F,Z,F,q,S,q],U[1]=[S,Z,F,Z,F,q,S,q],G!==X.d.ROTATE_TILE&&G!==X.d.ROTATE_ROW||(U[1]=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),G!==X.d.FLIP_TILE&&G!==X.d.FLIP_ROW||(U[1]=[1-S,Z,1-F,Z,1-F,q,1-S,q]),G!==X.d.FLIP_N_ROTATE_TILE&&G!==X.d.FLIP_N_ROTATE_ROW||(U[1]=[S,1-Z,F,1-Z,F,1-q,S,1-q]);for(let C=0;C<D;C++)o.push(x+I,C*L-p+H,0),o.push(x+O+I,C*L-p+H,0),o.push(x+O+I,(C+1)*L-p+H,0),o.push(x+I,(C+1)*L-p+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=G===X.d.FLIP_TILE||G===X.d.ROTATE_TILE||G===X.d.FLIP_N_ROTATE_TILE?v.concat(U[(C+1)%2]):G===X.d.FLIP_ROW||G===X.d.ROTATE_ROW||G===X.d.FLIP_N_ROTATE_ROW?v.concat(U[C%2]):v.concat(U[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(T){const U=[];S=0,Z=0,F=O/L,q=1,U[0]=[S,Z,F,Z,F,q,S,q],U[1]=[S,Z,F,Z,F,q,S,q],G!==X.d.ROTATE_TILE&&G!==X.d.ROTATE_ROW||(U[1]=[1-S,1-Z,1-F,1-Z,1-F,1-q,1-S,1-q]),G!==X.d.FLIP_TILE&&G!==X.d.FLIP_ROW||(U[1]=[1-S,Z,1-F,Z,1-F,q,1-S,q]),G!==X.d.FLIP_N_ROTATE_TILE&&G!==X.d.FLIP_N_ROTATE_ROW||(U[1]=[S,1-Z,F,1-Z,F,1-q,S,1-q]);for(let C=0;C<D;C++)o.push(N-O+I,C*L-p+H,0),o.push(N+I,C*L-p+H,0),o.push(N+I,(C+1)*L-p+H,0),o.push(N-O+I,(C+1)*L-p+H,0),d.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=G===X.d.FLIP_TILE||G===X.d.ROTATE_TILE||G===X.d.FLIP_N_ROTATE_TILE?v.concat(U[(C+P)%2]):G===X.d.FLIP_ROW||G===X.d.ROTATE_ROW||G===X.d.FLIP_N_ROTATE_ROW?v.concat(U[C%2]):v.concat(U[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const Z=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE;t.e._ComputeSides(Z,o,d,w,v,U.frontUVs,U.backUVs);const F=new t.e;F.indices=d,F.vU=o,F.uU=w,F.gU=v;const q=Z===t.e.DOUBLESIDE?u.concat(u):u;return F.dU=q,F}function V(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return y(G).FU(L,G.updatable),L}function p(U){const G=U.faceUV||new Array(6),C=U.faceColors,l=U.pattern||X.d.NO_FLIP,K=U.width||U.size||1,P=U.height||U.size||1,O=U.depth||U.size||1,T=U.tileWidth||U.tileSize||1,V=U.tileHeight||U.tileSize||1,p=U.alignHorizontal||0,I=U.alignVertical||0,H=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE;for(let X=0;X<6;X++)void 0===G[X]&&(G[X]=new L.Vector4(0,0,1,1)),C&&void 0===C[X]&&(C[X]=new D.JE(1,1,1,1));const x=K/2,h=P/2,N=O/2,b=[];for(let L=0;L<2;L++)b[L]=y({pattern:l,tileWidth:T,tileHeight:V,width:K,height:P,alignVertical:I,alignHorizontal:p,sideOrientation:H});for(let L=2;L<4;L++)b[L]=y({pattern:l,tileWidth:T,tileHeight:V,width:O,height:P,alignVertical:I,alignHorizontal:p,sideOrientation:H});let o=I;I===X.d.BOTTOM?o=X.d.TOP:I===X.d.TOP&&(o=X.d.BOTTOM);for(let L=4;L<6;L++)b[L]=y({pattern:l,tileWidth:T,tileHeight:V,width:K,height:O,alignVertical:o,alignHorizontal:p,sideOrientation:H});let w=[],S=[],v=[],u=[];const d=[],g=[],Z=[],F=[];let q=0,a=0;for(let X=0;X<6;X++){const U=b[X].vU.length;g[X]=[],Z[X]=[];for(let G=0;G<U/3;G++)g[X].push(new L.pG(b[X].vU[3*G],b[X].vU[3*G+1],b[X].vU[3*G+2])),Z[X].push(new L.pG(b[X].uU[3*G],b[X].uU[3*G+1],b[X].uU[3*G+2]));q=b[X].gU.length,F[X]=[];for(let C=0;C<q;C+=2)F[X][C]=G[X].x+(G[X].z-G[X].x)*b[X].gU[C],F[X][C+1]=G[X].y+(G[X].w-G[X].y)*b[X].gU[C+1],E.c&&(F[X][C+1]=1-F[X][C+1]);if(v=v.concat(F[X]),u=u.concat(b[X].indices.map((U=>U+a))),a+=g[X].length,C)for(let G=0;G<4;G++)d.push(C[X].r,C[X].g,C[X].b,C[X].a)}const k=new L.pG(0,0,N),n=L.Matrix.RotationY(Math.PI);w=g[0].map((U=>L.pG.TransformNormal(U,n).add(k))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[]),S=Z[0].map((U=>L.pG.TransformNormal(U,n))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[]),w=w.concat(g[1].map((U=>U.IG(k))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[])),S=S.concat(Z[1].map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[]));const Q=new L.pG(x,0,0),mU=L.Matrix.RotationY(-Math.PI/2);w=w.concat(g[2].map((U=>L.pG.TransformNormal(U,mU).add(Q))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[])),S=S.concat(Z[2].map((U=>L.pG.TransformNormal(U,mU))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[]));const B=L.Matrix.RotationY(Math.PI/2);w=w.concat(g[3].map((U=>L.pG.TransformNormal(U,B).IG(Q))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[])),S=S.concat(Z[3].map((U=>L.pG.TransformNormal(U,B))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[]));const M=new L.pG(0,h,0),z=L.Matrix.RotationX(Math.PI/2);w=w.concat(g[4].map((U=>L.pG.TransformNormal(U,z).add(M))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[])),S=S.concat(Z[4].map((U=>L.pG.TransformNormal(U,z))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[]));const s=L.Matrix.RotationX(-Math.PI/2);w=w.concat(g[5].map((U=>L.pG.TransformNormal(U,s).IG(M))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[])),S=S.concat(Z[5].map((U=>L.pG.TransformNormal(U,s))).map((U=>[U.x,U.y,U.z])).reduce(((U,G)=>U.concat(G)),[])),t.e._ComputeSides(H,w,u,S,v);const j=new t.e;if(j.indices=u,j.vU=w,j.uU=S,j.gU=v,C){const U=H===t.e.DOUBLESIDE?d.concat(d):d;j.dU=U}return j}function I(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return p(G).FU(L,G.updatable),L}t.e.CreateTiledPlane=y;t.e.CreateTiledBox=p;var H=C(13826),x=C(13097),h=C(13075);function N(U){const G=U.height||2;let C=0===U.diameterTop?0:U.diameterTop||U.diameter||1,l=0===U.diameterBottom?0:U.diameterBottom||U.diameter||1;C=C||1e-5,l=l||1e-5;const K=0|(U.tessellation||24),P=0|(U.subdivisions||1),O=!!U.hasRings,T=!!U.enclose,y=0===U.cap?0:U.cap||X.d.CAP_ALL,V=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,p=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,I=U.faceUV||new Array(3),H=U.faceColors,x=2+(1+(1!==V&&T?2:0))*(O?P:1);let N;for(N=0;N<x;N++)H&&void 0===H[N]&&(H[N]=new D.JE(1,1,1,1));for(N=0;N<x;N++)I&&void 0===I[N]&&(I[N]=new L.Vector4(0,0,1,1));const b=[],o=[],w=[],S=[],v=[],u=2*Math.PI*V/K;let d,g,Z;const F=(l-C)/2/G,q=L.pG.Zero(),a=L.pG.Zero(),k=L.pG.Zero(),n=L.pG.Zero(),Q=L.pG.Zero(),mU=h.e.Y;let B,M,z,s=1,j=1,A=0,Y=0;for(B=0;B<=P;B++)for(g=B/P,Z=(g*(C-l)+l)/2,s=O&&0!==B&&B!==P?2:1,z=0;z<s;z++){for(O&&(j+=z),T&&(j+=2*z),M=0;M<=K;M++)d=M*u,q.x=Math.cos(-d)*Z,q.y=-G/2+g*G,q.z=Math.sin(-d)*Z,0===C&&B===P?(a.x=w[w.length-3*(K+1)],a.y=w[w.length-3*(K+1)+1],a.z=w[w.length-3*(K+1)+2]):(a.x=q.x,a.z=q.z,a.y=Math.sqrt(a.x*a.x+a.z*a.z)*F,a.normalize()),0===M&&(k.L(q),n.L(a)),o.push(q.x,q.y,q.z),w.push(a.x,a.y,a.z),Y=O?A!==j?I[j].y:I[j].w:I[j].y+(I[j].w-I[j].y)*g,S.push(I[j].x+(I[j].z-I[j].x)*M/K,E.c?1-Y:Y),H&&v.push(H[j].r,H[j].g,H[j].b,H[j].a);1!==V&&T&&(o.push(q.x,q.y,q.z),o.push(0,q.y,0),o.push(0,q.y,0),o.push(k.x,k.y,k.z),L.pG.CrossToRef(mU,a,Q),Q.normalize(),w.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),L.pG.CrossToRef(n,mU,Q),Q.normalize(),w.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),Y=O?A!==j?I[j+1].y:I[j+1].w:I[j+1].y+(I[j+1].w-I[j+1].y)*g,S.push(I[j+1].x,E.c?1-Y:Y),S.push(I[j+1].z,E.c?1-Y:Y),Y=O?A!==j?I[j+2].y:I[j+2].w:I[j+2].y+(I[j+2].w-I[j+2].y)*g,S.push(I[j+2].x,E.c?1-Y:Y),S.push(I[j+2].z,E.c?1-Y:Y),H&&(v.push(H[j+1].r,H[j+1].g,H[j+1].b,H[j+1].a),v.push(H[j+1].r,H[j+1].g,H[j+1].b,H[j+1].a),v.push(H[j+2].r,H[j+2].g,H[j+2].b,H[j+2].a),v.push(H[j+2].r,H[j+2].g,H[j+2].b,H[j+2].a))),A!==j&&(A=j)}const e=1!==V&&T?K+4:K;for(B=0,j=0;j<P;j++){let U=0,G=0,C=0,L=0;for(M=0;M<K;M++)U=B*(e+1)+M,G=(B+1)*(e+1)+M,C=B*(e+1)+(M+1),L=(B+1)*(e+1)+(M+1),b.push(U,G,C),b.push(L,C,G);1!==V&&T&&(b.push(U+2,G+2,C+2),b.push(L+2,C+2,G+2),b.push(U+4,G+4,C+4),b.push(L+4,C+4,G+4)),B=O?B+2:B+1}const i=U=>{const X=U?C/2:l/2;if(0===X)return;let t,P,O;const T=U?I[x-1]:I[0];let D=null;H&&(D=U?H[x-1]:H[0]);const y=o.length/3,p=U?G/2:-G/2,h=new L.pG(0,p,0);o.push(h.x,h.y,h.z),w.push(0,U?1:-1,0);const N=T.y+.5*(T.w-T.y);S.push(T.x+.5*(T.z-T.x),E.c?1-N:N),D&&v.push(D.r,D.g,D.b,D.a);const u=new L.Vector2(.5,.5);for(O=0;O<=K;O++){t=2*Math.PI*O*V/K;const G=Math.cos(-t),C=Math.sin(-t);P=new L.pG(G*X,p,C*X);const l=new L.Vector2(G*u.x+.5,C*u.y+.5);o.push(P.x,P.y,P.z),w.push(0,U?1:-1,0);const y=T.y+(T.w-T.y)*l.y;S.push(T.x+(T.z-T.x)*l.x,E.c?1-y:y),D&&v.push(D.r,D.g,D.b,D.a)}for(O=0;O<K;O++)U?(b.push(y),b.push(y+(O+2)),b.push(y+(O+1))):(b.push(y),b.push(y+(O+1)),b.push(y+(O+2)))};y!==X.d.CAP_START&&y!==X.d.CAP_ALL||i(!1),y!==X.d.CAP_END&&y!==X.d.CAP_ALL||i(!0),t.e._ComputeSides(p,o,b,w,S,U.frontUVs,U.backUVs);const c=new t.e;return c.indices=b,c.vU=o,c.uU=w,c.gU=S,H&&(c.dU=v),c}function b(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return N(G).FU(L,G.updatable),L}function o(U){const G=[],C=[],X=[],l=[],K=U.diameter||1,P=U.thickness||.5,O=0|(U.tessellation||16),T=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,D=O+1;for(let t=0;t<=O;t++){const U=t/O,T=t*Math.PI*2/O-Math.PI/2,y=L.Matrix.Translation(K/2,0,0).multiply(L.Matrix.RotationY(T));for(let K=0;K<=O;K++){const T=1-K/O,V=K*Math.PI*2/O+Math.PI,p=Math.cos(V),I=Math.sin(V);let H=new L.pG(p,I,0),x=H.scale(P/2);const h=new L.Vector2(U,T);x=L.pG.TransformCoordinates(x,y),H=L.pG.TransformNormal(H,y),C.push(x.x,x.y,x.z),X.push(H.x,H.y,H.z),l.push(h.x,E.c?1-h.y:h.y);const N=(t+1)%D,b=(K+1)%D;G.push(t*D+K),G.push(t*D+b),G.push(N*D+K),G.push(t*D+b),G.push(N*D+b),G.push(N*D+K)}}t.e._ComputeSides(T,C,G,X,l,U.frontUVs,U.backUVs);const y=new t.e;return y.indices=G,y.vU=C,y.uU=X,y.gU=l,y}function w(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return o(G).FU(L,G.updatable),L}t.e.CreateCylinder=N,X.d.CreateCylinder=(U,G,C,L,l,t,E,K,P)=>{void 0!==E&&E instanceof x.e||(void 0!==E&&(P=K||X.d.DEFAULTSIDE,K=E),E=t,t=1);return b(U,{height:G,diameterTop:C,diameterBottom:L,tessellation:l,subdivisions:t,sideOrientation:P,updatable:K},E)};function S(U){const G=[],C=[],X=[],l=[],K=U.radius||2,P=U.tube||.5,O=U.radialSegments||32,T=U.tubularSegments||32,D=U.p||2,y=U.q||3,V=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,p=U=>{const G=Math.cos(U),C=Math.sin(U),X=y/D*U,l=Math.cos(X),t=K*(2+l)*.5*G,E=K*(2+l)*C*.5,P=K*Math.sin(X)*.5;return new L.pG(t,E,P)};let I,H;for(I=0;I<=O;I++){const U=I%O/O*2*D*Math.PI,G=p(U),X=p(U+.01),t=X.IG(G);let K=X.add(G);const y=L.pG.Cross(t,K);for(K=L.pG.Cross(y,t),y.normalize(),K.normalize(),H=0;H<T;H++){const U=H%T/T*2*Math.PI,L=-P*Math.cos(U),X=P*Math.sin(U);C.push(G.x+L*K.x+X*y.x),C.push(G.y+L*K.y+X*y.y),C.push(G.z+L*K.z+X*y.z),l.push(I/O),l.push(E.c?1-H/T:H/T)}}for(I=0;I<O;I++)for(H=0;H<T;H++){const U=(H+1)%T,C=I*T+H,L=(I+1)*T+H,X=(I+1)*T+U,l=I*T+U;G.push(l),G.push(L),G.push(C),G.push(l),G.push(X),G.push(L)}t.e.ComputeNormals(C,G,X),t.e._ComputeSides(V,C,G,X,l,U.frontUVs,U.backUVs);const x=new t.e;return x.indices=G,x.vU=C,x.uU=X,x.gU=l,x}function v(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return S(G).FU(L,G.updatable),L}t.e.CreateTorus=o,X.d.CreateTorus=(U,G,C,L,X,l,t)=>w(U,{diameter:G,thickness:C,tessellation:L,sideOrientation:t,updatable:l},X);t.e.CreateTorusKnot=S,X.d.CreateTorusKnot=(U,G,C,L,X,l,t,E,K,P)=>v(U,{radius:G,tube:C,radialSegments:L,tubularSegments:X,p:l,q:t,sideOrientation:P,updatable:K},E);var u=C(14230),d=C(13431),g=C(13084);function Z(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=G.path,l=G.shape,t=G.scale||1,E=G.rotation||0,K=0===G.cap?0:G.cap||X.d.NO_CAP,P=G.updatable,O=X.d._GetDefaultSideOrientation(G.sideOrientation),T=G.instance||null,D=G.invertUV||!1,y=G.closeShape||!1,V=G.closePath||!1,p=G.capFunction||null;return q(U,l,L,t,E,null,null,V,y,K,!1,C,!!P,O,T,D,G.frontUVs||null,G.backUVs||null,G.firstNormal||null,!!G.adjustFrame,p)}function F(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=G.path,l=G.shape,t=G.scaleFunction||(()=>1),E=G.rotationFunction||(()=>0),K=G.closePath||G.ribbonCloseArray||!1,P=G.closeShape||G.ribbonClosePath||!1,O=0===G.cap?0:G.cap||X.d.NO_CAP,T=G.updatable,D=G.firstNormal||null,y=G.adjustFrame||!1,V=X.d._GetDefaultSideOrientation(G.sideOrientation),p=G.instance,I=G.invertUV||!1,H=G.capFunction||null;return q(U,l,L,null,null,t,E,K,P,O,!0,C,!!T,V,p||null,I,G.frontUVs||null,G.backUVs||null,D,y,H||null)}function q(U,G,C,l,t,E,K,O,T,D,y,V,p,I,H,x,h,N,b,o,w){const S=(U,G,C,l,t,E,K,P,O,T,D)=>{const y=C.getTangents(),V=C.getNormals(),p=C.getBinormals(),I=C.getDistances();if(D)for(let X=0;X<y.length;X++)if(0==y[X].x&&0==y[X].y&&0==y[X].z&&y[X].L(y[X-1]),0==V[X].x&&0==V[X].y&&0==V[X].z&&V[X].L(V[X-1]),0==p[X].x&&0==p[X].y&&0==p[X].z&&p[X].L(p[X-1]),X>0){let U=y[X-1];L.pG.Dot(U,y[X])<0&&y[X].scaleInPlace(-1),U=V[X-1],L.pG.Dot(U,V[X])<0&&V[X].scaleInPlace(-1),U=p[X-1],L.pG.Dot(U,p[X])<0&&p[X].scaleInPlace(-1)}let H=0;const x=T&&P?P:()=>null!==E?E:0,h=T&&K?K:()=>null!==t?t:1;let N=O===X.d.NO_CAP||O===X.d.CAP_END?0:2;const b=L.TmpVectors.Matrix[0];for(let X=0;X<G.length;X++){const C=[],t=x(X,I[X]),E=h(X,I[X]);L.Matrix.RotationAxisToRef(y[X],H,b);for(let l=0;l<U.length;l++){const t=y[X].scale(U[l].z).add(V[X].scale(U[l].x)).add(p[X].scale(U[l].y)),K=L.pG.Zero();L.pG.TransformCoordinatesToRef(t,b,K),K.scaleInPlace(E).addInPlace(G[X]),C[l]=K}l[N]=C,H+=t,N++}const o=w||(U=>{const G=Array(),C=L.pG.Zero();let X;for(X=0;X<U.length;X++)C.addInPlace(U[X]);for(C.scaleInPlace(1/U.length),X=0;X<U.length;X++)G.push(C);return G});switch(O){case X.d.NO_CAP:break;case X.d.CAP_START:l[0]=o(l[2]),l[1]=l[2];break;case X.d.CAP_END:l[N]=l[N-1],l[N+1]=o(l[N-1]);break;case X.d.CAP_ALL:l[0]=o(l[2]),l[1]=l[2],l[N]=l[N-1],l[N+1]=o(l[N-1])}return l};let v,u;if(H){const U=H._creationDataStorage;return v=b?U.path3D.update(C,b):U.path3D.update(C),u=S(G,C,U.path3D,U.pathArray,l,t,E,K,U.cap,y,o),H=P("",{pathArray:u,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:H},V||void 0)}v=b?new g.m(C,b):new g.m(C);u=S(G,C,v,new Array,l,t,E,K,D=D<0||D>3?0:D,y,o);const d=P(U,{pathArray:u,closeArray:O,closePath:T,updatable:p,sideOrientation:I,invertUV:x,frontUVs:h||void 0,backUVs:N||void 0},V);return d._creationDataStorage.pathArray=u,d._creationDataStorage.path3D=v,d._creationDataStorage.cap=D,d}function a(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=G.arc?G.arc<=0||G.arc>1?1:G.arc:1,t=void 0===G.closed||G.closed,E=G.shape,K=G.radius||1,O=G.tessellation||64,T=G.clip||0,D=G.updatable,y=X.d._GetDefaultSideOrientation(G.sideOrientation),V=G.cap||X.d.NO_CAP,p=2*Math.PI,I=[],H=G.invertUV||!1;let x=0,h=0;const N=p/O*l;let b,o;for(x=0;x<=O-T;x++){for(o=[],V!=X.d.CAP_START&&V!=X.d.CAP_ALL||(o.push(new L.pG(0,E[0].y,0)),o.push(new L.pG(Math.cos(x*N)*E[0].x*K,E[0].y,Math.sin(x*N)*E[0].x*K))),h=0;h<E.length;h++)b=new L.pG(Math.cos(x*N)*E[h].x*K,E[h].y,Math.sin(x*N)*E[h].x*K),o.push(b);V!=X.d.CAP_END&&V!=X.d.CAP_ALL||(o.push(new L.pG(Math.cos(x*N)*E[E.length-1].x*K,E[E.length-1].y,Math.sin(x*N)*E[E.length-1].x*K)),o.push(new L.pG(0,E[E.length-1].y,0))),I.push(o)}return P(U,{pathArray:I,closeArray:t,sideOrientation:y,updatable:D,invertUV:H,frontUVs:G.frontUVs,backUVs:G.backUVs},C)}X.d.ExtrudeShape=function(U,G,C,L,l,t){let E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7?arguments[7]:void 0,P=arguments.length>8?arguments[8]:void 0,O=arguments.length>9?arguments[9]:void 0;return Z(U,{shape:G,path:C,scale:L,rotation:l,cap:0===t?0:t||X.d.NO_CAP,sideOrientation:P,instance:O,updatable:K},E)},X.d.ExtrudeShapeCustom=(U,G,C,L,l,t,E,K,P,O,T,D)=>F(U,{shape:G,path:C,scaleFunction:L,rotationFunction:l,ribbonCloseArray:t,ribbonClosePath:E,cap:0===K?0:K||X.d.NO_CAP,sideOrientation:T,instance:D,updatable:O},P);X.d.CreateLathe=(U,G,C,L,X,l,t)=>a(U,{shape:G,radius:C,tessellation:L,sideOrientation:t,updatable:l},X);var k=C(13742),n=C(13701);function Q(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=G.path;let t=G.instance,E=1;void 0!==G.radius?E=G.radius:t&&(E=t._creationDataStorage.radius);const K=G.tessellation||64,O=G.radiusFunction||null;let T=G.cap||X.d.NO_CAP;const D=G.invertUV||!1,y=G.updatable,V=X.d._GetDefaultSideOrientation(G.sideOrientation);G.arc=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1;const p=(U,G,C,l,t,E,K,P)=>{const O=G.getTangents(),T=G.getNormals(),D=G.getDistances(),y=2*Math.PI/t*P,V=E||(()=>l);let p,I,H,x;const h=L.TmpVectors.Matrix[0];let N=K===X.d.NO_CAP||K===X.d.CAP_END?0:2;for(let X=0;X<U.length;X++){I=V(X,D[X]),p=Array(),H=T[X];for(let G=0;G<t;G++)L.Matrix.RotationAxisToRef(O[X],y*G,h),x=p[G]?p[G]:L.pG.Zero(),L.pG.TransformCoordinatesToRef(H,h,x),x.scaleInPlace(I).addInPlace(U[X]),p[G]=x;C[N]=p,N++}const b=(G,C)=>{const L=Array();for(let X=0;X<G;X++)L.push(U[C]);return L};switch(K){case X.d.NO_CAP:break;case X.d.CAP_START:C[0]=b(t,0),C[1]=C[2].slice(0);break;case X.d.CAP_END:C[N]=C[N-1].slice(0),C[N+1]=b(t,U.length-1);break;case X.d.CAP_ALL:C[0]=b(t,0),C[1]=C[2].slice(0),C[N]=C[N-1].slice(0),C[N+1]=b(t,U.length-1)}return C};let I,H;if(t){const U=t._creationDataStorage,C=G.arc||U.arc;return I=U.path3D.update(l),H=p(l,I,U.pathArray,E,U.tessellation,O,U.cap,C),t=P("",{pathArray:H,instance:t}),U.path3D=I,U.pathArray=H,U.arc=C,U.radius=E,t}I=new g.m(l);T=T<0||T>3?0:T,H=p(l,I,new Array,E,K,O,T,G.arc);const x=P(U,{pathArray:H,closePath:!0,closeArray:!1,updatable:y,sideOrientation:V,invertUV:D,frontUVs:G.frontUVs,backUVs:G.backUVs},C);return x._creationDataStorage.pathArray=H,x._creationDataStorage.path3D=I,x._creationDataStorage.tessellation=K,x._creationDataStorage.cap=T,x._creationDataStorage.arc=G.arc,x._creationDataStorage.radius=E,x}function mU(U){const G=[];G[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},G[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},G[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},G[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},G[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},G[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},G[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},G[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},G[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},G[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},G[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},G[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},G[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},G[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},G[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=U.type&&(U.type<0||U.type>=G.length)?0:U.type||0,X=U.size,l=U.sizeX||X||1,K=U.sizeY||X||1,P=U.sizeZ||X||1,O=U.custom||G[C],T=O.face.length,y=U.faceUV||new Array(T),V=U.faceColors,p=void 0===U.flat||U.flat,I=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,H=[],x=[],h=[],N=[],b=[];let o=0,w=0;const S=[];let v,u,d,g,Z,F,q=0,a=0;if(p)for(a=0;a<T;a++)V&&void 0===V[a]&&(V[a]=new D.JE(1,1,1,1)),y&&void 0===y[a]&&(y[a]=new L.Vector4(0,0,1,1));if(p)for(a=0;a<T;a++){const U=O.face[a].length;for(d=2*Math.PI/U,g=.5*Math.tan(d/2),Z=.5,q=0;q<U;q++)H.push(O.vertex[O.face[a][q]][0]*l,O.vertex[O.face[a][q]][1]*K,O.vertex[O.face[a][q]][2]*P),S.push(o),o++,v=y[a].x+(y[a].z-y[a].x)*(.5+g),u=y[a].y+(y[a].w-y[a].y)*(Z-.5),N.push(v,E.c?1-u:u),F=g*Math.cos(d)-Z*Math.sin(d),Z=g*Math.sin(d)+Z*Math.cos(d),g=F,V&&b.push(V[a].r,V[a].g,V[a].b,V[a].a);for(q=0;q<U-2;q++)x.push(S[0+w],S[q+2+w],S[q+1+w]);w+=U}else{for(q=0;q<O.vertex.length;q++)H.push(O.vertex[q][0]*l,O.vertex[q][1]*K,O.vertex[q][2]*P),N.push(0,E.c?1:0);for(a=0;a<T;a++)for(q=0;q<O.face[a].length-2;q++)x.push(O.face[a][0],O.face[a][q+2],O.face[a][q+1])}t.e.ComputeNormals(H,x,h),t.e._ComputeSides(I,H,x,h,N,U.frontUVs,U.backUVs);const k=new t.e;return k.vU=H,k.indices=x,k.uU=h,k.gU=N,V&&p&&(k.dU=b),k}function B(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return mU(G).FU(L,G.updatable),L}X.d.CreateTube=(U,G,C,L,X,l,t,E,K,P)=>Q(U,{path:G,radius:C,tessellation:L,radiusFunction:X,arc:1,cap:l,updatable:E,sideOrientation:K,instance:P},t);function M(U){const G=U.sideOrientation||t.e.DEFAULTSIDE,C=U.radius||1,X=void 0===U.flat||U.flat,l=0|(U.subdivisions||4),K=U.radiusX||C,P=U.radiusY||C,O=U.radiusZ||C,T=(1+Math.sqrt(5))/2,D=[-1,T,-0,1,T,0,-1,-T,0,1,-T,0,0,-1,-T,0,1,-T,0,-1,T,0,1,T,T,0,1,T,0,-1,-T,0,1,-T,0,-1],y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],V=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],p=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],H=[],x=[],h=[],N=[];let b=0;const o=new Array(3),w=new Array(3);let S;for(S=0;S<3;S++)o[S]=L.pG.Zero(),w[S]=L.Vector2.Zero();for(let t=0;t<20;t++){for(S=0;S<3;S++){const U=y[3*t+S];o[S].WE(D[3*V[U]],D[3*V[U]+1],D[3*V[U]+2]),o[S].normalize(),w[S].WE(.134765625*p[2*U]+.05859375+-.0390625*I[t],.2333984375*p[2*U+1]+.025390625+.01953125*I[t])}const U=(U,G,C,t)=>{const T=L.pG.Lerp(o[0],o[2],G/l),D=L.pG.Lerp(o[1],o[2],G/l),y=l===G?o[2]:L.pG.Lerp(T,D,U/(l-G));let V;if(y.normalize(),X){const U=L.pG.Lerp(o[0],o[2],t/l),G=L.pG.Lerp(o[1],o[2],t/l);V=L.pG.Lerp(U,G,C/(l-t))}else V=new L.pG(y.x,y.y,y.z);V.x/=K,V.y/=P,V.z/=O,V.normalize();const p=L.Vector2.Lerp(w[0],w[2],G/l),I=L.Vector2.Lerp(w[1],w[2],G/l),S=l===G?w[2]:L.Vector2.Lerp(p,I,U/(l-G));x.push(y.x*K,y.y*P,y.z*O),h.push(V.x,V.y,V.z),N.push(S.x,E.c?1-S.y:S.y),H.push(b),b++};for(let G=0;G<l;G++)for(let C=0;C+G<l;C++)U(C,G,C+1/3,G+1/3),U(C+1,G,C+1/3,G+1/3),U(C,G+1,C+1/3,G+1/3),C+G+1<l&&(U(C+1,G,C+2/3,G+2/3),U(C+1,G+1,C+2/3,G+2/3),U(C,G+1,C+2/3,G+2/3))}t.e._ComputeSides(G,x,H,h,N,U.frontUVs,U.backUVs);const v=new t.e;return v.indices=H,v.vU=x,v.uU=h,v.gU=N,v}function z(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new X.d(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),L._originalBuilderSideOrientation=G.sideOrientation;return M(G).FU(L,G.updatable),L}t.e.CreatePolyhedron=mU,X.d.CreatePolyhedron=(U,G,C)=>B(U,G,C);t.e.CreateIcoSphere=M,X.d.CreateIcoSphere=(U,G,C)=>z(U,G,C);var s=C(12911);const j=new L.pG(1,0,0),A=new L.pG(-1,0,0),Y=new L.pG(0,1,0),e=new L.pG(0,-1,0),i=new L.pG(0,0,1),c=new L.pG(0,0,-1);class R{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.pG.Zero(),G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.pG.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.Vector2.Zero(),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=U,this.normal=G,this.uv=C,this.vertexIdx=X,this.vertexIdxForBones=l,this.localPositionOverride=t,this.localNormalOverride=E,this.matrixIndicesOverride=K,this.matrixWeightsOverride=P}clone(){var U,G,C,L;return new R(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(U=this.localPositionOverride)||void 0===U?void 0:U.slice(),null===(G=this.localNormalOverride)||void 0===G?void 0:G.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(L=this.matrixWeightsOverride)||void 0===L?void 0:L.slice())}}function W(U,G,C){var K,P,O,T,D;const y=!!G.skeleton,V=!(null===(K=G.morphTargetManager)||void 0===K||!K.numTargets),p=C.localMode||y,I=G.cE(),H=y||V?G.DK(!0,!0):G.getVerticesData(l.e.PositionKind),x=y||V?G.getNormalsData(!0,!0):G.getVerticesData(l.e.NormalKind),h=p?y?G.getVerticesData(l.e.PositionKind):H:null,N=p?y?G.getVerticesData(l.e.NormalKind):x:null,b=G.getVerticesData(l.e.UVKind),o=y?G.getVerticesData(l.e.MatricesIndicesKind):null,w=y?G.getVerticesData(l.e.MatricesWeightsKind):null,S=y?G.getVerticesData(l.e.MatricesIndicesExtraKind):null,v=y?G.getVerticesData(l.e.MatricesWeightsExtraKind):null,u=C.position||L.pG.Zero();let d=C.normal||L.pG.Up();const g=C.size||L.pG.One(),Z=C.angle||0;if(!d){const U=new L.pG(0,0,1),C=G.wU().activeCamera,X=L.pG.TransformCoordinates(U,C.getWorldMatrix());d=C.globalPosition.IG(X)}const F=-Math.atan2(d.z,d.x)-Math.PI/2,q=Math.sqrt(d.x*d.x+d.z*d.z),a=Math.atan2(d.y,q),k=new t.e;k.indices=[],k.vU=[],k.uU=[],k.gU=[],k.matricesIndices=y?[]:null,k.matricesWeights=y?[]:null,k.matricesIndicesExtra=S?[]:null,k.matricesWeightsExtra=v?[]:null;let n=0;const Q=(U,G)=>{const X=new R;if(!I||!H||!x)return X;const l=I[U];if(X.vertexIdx=3*l,X.vertexIdxForBones=4*l,X.position=new L.pG(H[3*l],H[3*l+1],H[3*l+2]),L.pG.TransformCoordinatesToRef(X.position,G,X.position),X.normal=new L.pG(x[3*l],x[3*l+1],x[3*l+2]),L.pG.TransformNormalToRef(X.normal,G,X.normal),C.captureUVS&&b){const U=b[2*l+1];X.uv=new L.Vector2(b[2*l],E.c?1-U:U)}return X},mU=[0,0,0,0],B=(U,G)=>{var C,X;if(0===U.length)return U;const l=.5*Math.abs(L.pG.Dot(g,G)),t=(U,G,C,L)=>{for(let X=0;X<L;++X)if(U[C+X]===G)return C+X;return-1},E=(U,C)=>{var X,E,K,P,O,T,D,y,V,p,I,H;const x=L.pG.GetClipFactor(U.position,C.position,G,l);let b=mU,S=mU;if(o&&w){var v,u,d,g;const G=U.matrixIndicesOverride?0:U.vertexIdxForBones,L=null!==(v=U.matrixIndicesOverride)&&void 0!==v?v:o,X=null!==(u=U.matrixWeightsOverride)&&void 0!==u?u:w,l=C.matrixIndicesOverride?0:C.vertexIdxForBones,E=null!==(d=C.matrixIndicesOverride)&&void 0!==d?d:o,K=null!==(g=C.matrixWeightsOverride)&&void 0!==g?g:w;b=[0,0,0,0],S=[0,0,0,0];let P=0;for(let U=0;U<4;++U)if(X[G+U]>0){const C=t(E,L[G+U],l,4);b[P]=L[G+U],S[P]=(0,s.Lerp)(X[G+U],C>=0?K[C]:0,x),P++}for(let U=0;U<4&&P<4;++U){const C=E[l+U];-1===t(L,C,G,4)&&(b[P]=C,S[P]=(0,s.Lerp)(0,K[l+U],x),P++)}const O=S[0]+S[1]+S[2]+S[3];S[0]/=O,S[1]/=O,S[2]/=O,S[3]/=O}const Z=U.localPositionOverride?U.localPositionOverride[0]:null!==(X=null===h||void 0===h?void 0:h[U.vertexIdx])&&void 0!==X?X:0,F=U.localPositionOverride?U.localPositionOverride[1]:null!==(E=null===h||void 0===h?void 0:h[U.vertexIdx+1])&&void 0!==E?E:0,q=U.localPositionOverride?U.localPositionOverride[2]:null!==(K=null===h||void 0===h?void 0:h[U.vertexIdx+2])&&void 0!==K?K:0,a=C.localPositionOverride?C.localPositionOverride[0]:null!==(P=null===h||void 0===h?void 0:h[C.vertexIdx])&&void 0!==P?P:0,k=C.localPositionOverride?C.localPositionOverride[1]:null!==(O=null===h||void 0===h?void 0:h[C.vertexIdx+1])&&void 0!==O?O:0,n=C.localPositionOverride?C.localPositionOverride[2]:null!==(T=null===h||void 0===h?void 0:h[C.vertexIdx+2])&&void 0!==T?T:0,Q=U.localNormalOverride?U.localNormalOverride[0]:null!==(D=null===N||void 0===N?void 0:N[U.vertexIdx])&&void 0!==D?D:0,B=U.localNormalOverride?U.localNormalOverride[1]:null!==(y=null===N||void 0===N?void 0:N[U.vertexIdx+1])&&void 0!==y?y:0,M=U.localNormalOverride?U.localNormalOverride[2]:null!==(V=null===N||void 0===N?void 0:N[U.vertexIdx+2])&&void 0!==V?V:0,z=Q+((C.localNormalOverride?C.localNormalOverride[0]:null!==(p=null===N||void 0===N?void 0:N[C.vertexIdx])&&void 0!==p?p:0)-Q)*x,j=B+((C.localNormalOverride?C.localNormalOverride[1]:null!==(I=null===N||void 0===N?void 0:N[C.vertexIdx+1])&&void 0!==I?I:0)-B)*x,A=M+((C.localNormalOverride?C.localNormalOverride[2]:null!==(H=null===N||void 0===N?void 0:N[C.vertexIdx+2])&&void 0!==H?H:0)-M)*x,Y=Math.sqrt(z*z+j*j+A*A);return new R(L.pG.Lerp(U.position,C.position,x),L.pG.Lerp(U.normal,C.normal,x).normalize(),L.Vector2.Lerp(U.uv,C.uv,x),-1,-1,h?[Z+(a-Z)*x,F+(k-F)*x,q+(n-q)*x]:null,N?[z/Y,j/Y,A/Y]:null,b,S)};let K=null;U.length>3&&(K=[]);for(let P=0;P<U.length;P+=3){let t=0,O=null,T=null,D=null,y=null;const V=L.pG.Dot(U[P].position,G)-l>0,p=L.pG.Dot(U[P+1].position,G)-l>0,I=L.pG.Dot(U[P+2].position,G)-l>0;switch(t=(V?1:0)+(p?1:0)+(I?1:0),t){case 0:U.length>3?(K.push(U[P]),K.push(U[P+1]),K.push(U[P+2])):K=U;break;case 1:if(K=null!==(C=K)&&void 0!==C?C:new Array,V&&(O=U[P+1],T=U[P+2],D=E(U[P],O),y=E(U[P],T)),p){O=U[P],T=U[P+2],D=E(U[P+1],O),y=E(U[P+1],T),K.push(D),K.push(T.clone()),K.push(O.clone()),K.push(T.clone()),K.push(D.clone()),K.push(y);break}I&&(O=U[P],T=U[P+1],D=E(U[P+2],O),y=E(U[P+2],T)),O&&T&&D&&y&&(K.push(O.clone()),K.push(T.clone()),K.push(D),K.push(y),K.push(D.clone()),K.push(T.clone()));break;case 2:K=null!==(X=K)&&void 0!==X?X:new Array,V||(O=U[P].clone(),T=E(O,U[P+1]),D=E(O,U[P+2]),K.push(O),K.push(T),K.push(D)),p||(O=U[P+1].clone(),T=E(O,U[P+2]),D=E(O,U[P]),K.push(O),K.push(T),K.push(D)),I||(O=U[P+2].clone(),T=E(O,U[P]),D=E(O,U[P+1]),K.push(O),K.push(T),K.push(D))}}return K},M=G instanceof X.d?G:null,z=null===M||void 0===M?void 0:M._thinInstanceDataStorage.matrixData,W=(null===M||void 0===M?void 0:M.GK)||1,f=L.TmpVectors.Matrix[0];f.L(L.Matrix.IdentityReadOnly);for(let X=0;X<W;++X){if(null!==M&&void 0!==M&&M.hasThinInstances&&z){const U=16*X;f.setRowFromFloats(0,z[U+0],z[U+1],z[U+2],z[U+3]),f.setRowFromFloats(1,z[U+4],z[U+5],z[U+6],z[U+7]),f.setRowFromFloats(2,z[U+8],z[U+9],z[U+10],z[U+11]),f.setRowFromFloats(3,z[U+12],z[U+13],z[U+14],z[U+15])}const U=L.Matrix.RotationYawPitchRoll(F,a,Z).multiply(L.Matrix.Translation(u.x,u.y,u.z)),l=L.Matrix.Invert(U),t=G.getWorldMatrix(),K=f.multiply(t).multiply(l),P=new Array(3);for(let G=0;G<I.length;G+=3){let U=P;if(U[0]=Q(G,K),U[1]=Q(G+1,K),U[2]=Q(G+2,K),!(C.cullBackFaces&&-U[0].normal.z<=0&&-U[1].normal.z<=0&&-U[2].normal.z<=0)&&(U=B(U,j),U&&(U=B(U,A),U&&(U=B(U,Y),U&&(U=B(U,e),U&&(U=B(U,i),U&&(U=B(U,c),U)))))))for(let G=0;G<U.length;G++){const L=U[G];if(k.indices.push(n),p?(L.localPositionOverride?(k.vU[3*n]=L.localPositionOverride[0],k.vU[3*n+1]=L.localPositionOverride[1],k.vU[3*n+2]=L.localPositionOverride[2]):h&&(k.vU[3*n]=h[L.vertexIdx],k.vU[3*n+1]=h[L.vertexIdx+1],k.vU[3*n+2]=h[L.vertexIdx+2]),L.localNormalOverride?(k.uU[3*n]=L.localNormalOverride[0],k.uU[3*n+1]=L.localNormalOverride[1],k.uU[3*n+2]=L.localNormalOverride[2]):N&&(k.uU[3*n]=N[L.vertexIdx],k.uU[3*n+1]=N[L.vertexIdx+1],k.uU[3*n+2]=N[L.vertexIdx+2])):(L.position.toArray(k.vU,3*n),L.normal.toArray(k.uU,3*n)),k.matricesIndices&&k.matricesWeights&&(L.matrixIndicesOverride?(k.matricesIndices[4*n]=L.matrixIndicesOverride[0],k.matricesIndices[4*n+1]=L.matrixIndicesOverride[1],k.matricesIndices[4*n+2]=L.matrixIndicesOverride[2],k.matricesIndices[4*n+3]=L.matrixIndicesOverride[3]):(o&&(k.matricesIndices[4*n]=o[L.vertexIdxForBones],k.matricesIndices[4*n+1]=o[L.vertexIdxForBones+1],k.matricesIndices[4*n+2]=o[L.vertexIdxForBones+2],k.matricesIndices[4*n+3]=o[L.vertexIdxForBones+3]),S&&k.matricesIndicesExtra&&(k.matricesIndicesExtra[4*n]=S[L.vertexIdxForBones],k.matricesIndicesExtra[4*n+1]=S[L.vertexIdxForBones+1],k.matricesIndicesExtra[4*n+2]=S[L.vertexIdxForBones+2],k.matricesIndicesExtra[4*n+3]=S[L.vertexIdxForBones+3])),L.matrixWeightsOverride?(k.matricesWeights[4*n]=L.matrixWeightsOverride[0],k.matricesWeights[4*n+1]=L.matrixWeightsOverride[1],k.matricesWeights[4*n+2]=L.matrixWeightsOverride[2],k.matricesWeights[4*n+3]=L.matrixWeightsOverride[3]):(w&&(k.matricesWeights[4*n]=w[L.vertexIdxForBones],k.matricesWeights[4*n+1]=w[L.vertexIdxForBones+1],k.matricesWeights[4*n+2]=w[L.vertexIdxForBones+2],k.matricesWeights[4*n+3]=w[L.vertexIdxForBones+3]),v&&k.matricesWeightsExtra&&(k.matricesWeightsExtra[4*n]=v[L.vertexIdxForBones],k.matricesWeightsExtra[4*n+1]=v[L.vertexIdxForBones+1],k.matricesWeightsExtra[4*n+2]=v[L.vertexIdxForBones+2],k.matricesWeightsExtra[4*n+3]=v[L.vertexIdxForBones+3]))),C.captureUVS)L.uv.toArray(k.gU,2*n);else{k.gU.push(.5+L.position.x/g.x);const U=.5+L.position.y/g.y;k.gU.push(E.c?1-U:U)}n++}}}0===k.indices.length&&(k.indices=null),0===k.vU.length&&(k.vU=null),0===k.uU.length&&(k.uU=null),0===k.gU.length&&(k.gU=null),0===(null===(P=k.matricesIndices)||void 0===P?void 0:P.length)&&(k.matricesIndices=null),0===(null===(O=k.matricesWeights)||void 0===O?void 0:O.length)&&(k.matricesWeights=null),0===(null===(T=k.matricesIndicesExtra)||void 0===T?void 0:T.length)&&(k.matricesIndicesExtra=null),0===(null===(D=k.matricesWeightsExtra)||void 0===D?void 0:D.length)&&(k.matricesWeightsExtra=null);const r=new X.d(U,G.wU());return k.FU(r),p?(r.skeleton=G.skeleton,r.parent=G):(r.position=u.clone(),r.rotation=new L.pG(a,F,Z)),r.eE(!0),r.refreshBoundingInfo(!0,!0),r}function f(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const G=0|Math.max(U.subdivisions?U.subdivisions:2,1),C=0|Math.max(U.tessellation?U.tessellation:16,3),X=Math.max(U.height?U.height:1,0),l=Math.max(U.radius?U.radius:.25,0),K=0|Math.max(U.capSubdivisions?U.capSubdivisions:6,1),P=C,O=G,T=Math.max(U.radiusTop?U.radiusTop:l,0),D=Math.max(U.radiusBottom?U.radiusBottom:l,0),y=X-(T+D),V=2*Math.PI,p=Math.max(U.topCapSubdivisions?U.topCapSubdivisions:K,1),I=Math.max(U.bottomCapSubdivisions?U.bottomCapSubdivisions:K,1),H=Math.acos((D-T)/X);let x=[];const h=[],N=[],b=[];let o=0;const w=[],S=.5*y,v=.5*Math.PI;let u,d;const g=L.pG.Zero(),Z=L.pG.Zero(),F=Math.cos(H),q=Math.sin(H),a=new L.Vector2(T*q,S+T*F).IG(new L.Vector2(D*q,D*F-S)).length(),k=T*H+a+D*(v-H);let n=0;for(d=0;d<=p;d++){const U=[],G=v-H*(d/p);n+=T*H/p;const C=Math.cos(G),L=Math.sin(G),X=C*T;for(u=0;u<=P;u++){const G=u/P,l=G*V+0,t=Math.sin(l),K=Math.cos(l);Z.x=X*t,Z.y=S+L*T,Z.z=X*K,h.push(Z.x,Z.y,Z.z),g.set(C*t,L,C*K),N.push(g.x,g.y,g.z),b.push(G,E.c?n/k:1-n/k),U.push(o),o++}w.push(U)}const Q=X-T-D+F*T-F*D,mU=q*(D-T)/Q;for(d=1;d<=O;d++){const U=[];n+=a/O;const G=q*(d*(D-T)/O+T);for(u=0;u<=P;u++){const C=u/P,L=C*V+0,X=Math.sin(L),l=Math.cos(L);Z.x=G*X,Z.y=S+F*T-d*Q/O,Z.z=G*l,h.push(Z.x,Z.y,Z.z),g.set(X,mU,l).normalize(),N.push(g.x,g.y,g.z),b.push(C,E.c?n/k:1-n/k),U.push(o),o++}w.push(U)}for(d=1;d<=I;d++){const U=[],G=v-H-(Math.PI-H)*(d/I);n+=D*H/I;const C=Math.cos(G),L=Math.sin(G),X=C*D;for(u=0;u<=P;u++){const G=u/P,l=G*V+0,t=Math.sin(l),K=Math.cos(l);Z.x=X*t,Z.y=L*D-S,Z.z=X*K,h.push(Z.x,Z.y,Z.z),g.set(C*t,L,C*K),N.push(g.x,g.y,g.z),b.push(G,E.c?n/k:1-n/k),U.push(o),o++}w.push(U)}for(u=0;u<P;u++)for(d=0;d<p+O+I;d++){const U=w[d][u],G=w[d+1][u],C=w[d+1][u+1],L=w[d][u+1];x.push(U),x.push(G),x.push(L),x.push(G),x.push(C),x.push(L)}if(x=x.reverse(),U.orientation&&!U.orientation.equals(L.pG.Up())){const G=new L.Matrix;U.orientation.clone().scale(.5*Math.PI).cross(L.pG.Up()).toQuaternion().toRotationMatrix(G);const C=L.pG.Zero();for(let U=0;U<h.length;U+=3)C.set(h[U],h[U+1],h[U+2]),L.pG.TransformCoordinatesToRef(C.clone(),G,C),h[U]=C.x,h[U+1]=C.y,h[U+2]=C.z}const B=new t.e;return B.vU=h,B.uU=N,B.gU=b,B.indices=x,B}function r(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:L.pG.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new X.d(U,C);return f(G).FU(l,G.updatable),l}X.d.CreateDecal=(U,G,C,L,X,l)=>W(U,G,{position:C,normal:L,size:X,angle:l});X.d.CreateCapsule=(U,G,C)=>r(U,G,C),t.e.CreateCapsule=f;var J=C(12731),UU=C(12898);class GU{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=U,this.y=G,U!==Math.floor(U)&&(U=Math.floor(U),J.d.Warn("x is not an integer, floor(x) used")),G!==Math.floor(G)&&(G=Math.floor(G),J.d.Warn("y is not an integer, floor(y) used"))}clone(){return new GU(this.x,this.y)}rotate60About(U){const G=this.x;return this.x=U.x+U.y-this.y,this.y=G+this.y-U.x,this}rotateNeg60About(U){const G=this.x;return this.x=G+this.y-U.y,this.y=U.x+U.y-G,this}rotate120(U,G){U!==Math.floor(U)&&(U=Math.floor(U),J.d.Warn("m not an integer only floor(m) used")),G!==Math.floor(G)&&(G=Math.floor(G),J.d.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=U-C-this.y,this.y=G+C,this}rotateNeg120(U,G){U!==Math.floor(U)&&(U=Math.floor(U),J.d.Warn("m is not an integer, floor(m) used")),G!==Math.floor(G)&&(G=Math.floor(G),J.d.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-G,this.y=U+G-C-this.y,this}toCartesianOrigin(U,G){const C=L.pG.Zero();return C.x=U.x+2*this.x*G+this.y*G,C.y=U.y+Math.sqrt(3)*this.y*G,C}static Zero(){return new GU(0,0)}}class CU{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new LU("icosahedron","Regular",[[0,UU.h,-1],[-UU.h,1,0],[-1,0,-UU.h],[1,0,-UU.h],[UU.h,1,0],[0,UU.h,1],[-1,0,UU.h],[-UU.h,-1,0],[0,-UU.h,-1],[UU.h,-1,0],[1,0,UU.h],[0,-UU.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let U=12;const G={},C=this.m,L=this.n;let X,l,t,E,K,P=C,O=1,T=0;0!==L&&(P=(0,s.HighestCommonFactor)(C,L)),O=C/P,T=L/P;const D=GU.Zero(),y=new GU(C,L),V=new GU(-L,C+L),p=GU.Zero(),I=GU.Zero(),H=GU.Zero();let x,h,N,b,o=[];const w=[],S=this.vertByDist,v=(C,L,X,l)=>{x=C+"|"+X,h=L+"|"+l,x in G||h in G?x in G&&!(h in G)?G[h]=G[x]:h in G&&!(x in G)&&(G[x]=G[h]):(G[x]=U,G[h]=U,U++),S[X][0]>2?w[G[x]]=[-S[X][0],S[X][1],G[x]]:w[G[x]]=[o[S[X][0]],S[X][1],G[x]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let u=0;u<20;u++){if(o=this.IDATA.face[u],t=o[2],E=o[1],K=o[0],N=D.x+"|"+D.y,x=u+"|"+N,x in G||(G[x]=t,w[t]=[o[S[N][0]],S[N][1]]),N=y.x+"|"+y.y,x=u+"|"+N,x in G||(G[x]=E,w[E]=[o[S[N][0]],S[N][1]]),N=V.x+"|"+V.y,x=u+"|"+N,x in G||(G[x]=K,w[K]=[o[S[N][0]],S[N][1]]),X=this.IDATA.edgematch[u][0],l=this.IDATA.edgematch[u][1],"B"===l)for(let U=1;U<P;U++)I.x=C-U*(O+T),I.y=L+U*O,H.x=-U*T,H.y=U*(O+T),N=I.x+"|"+I.y,b=H.x+"|"+H.y,v(u,X,N,b);if("O"===l)for(let U=1;U<P;U++)H.x=-U*T,H.y=U*(O+T),p.x=U*O,p.y=U*T,N=H.x+"|"+H.y,b=p.x+"|"+p.y,v(u,X,N,b);if(X=this.IDATA.edgematch[u][2],l=this.IDATA.edgematch[u][3],l&&"A"===l)for(let U=1;U<P;U++)p.x=U*O,p.y=U*T,I.x=C-(P-U)*(O+T),I.y=L+(P-U)*O,N=p.x+"|"+p.y,b=I.x+"|"+I.y,v(u,X,N,b);for(let C=0;C<this.vertices.length;C++)N=this.vertices[C].x+"|"+this.vertices[C].y,x=u+"|"+N,x in G||(G[x]=U++,S[N][0]>2?w[G[x]]=[-S[N][0],S[N][1],G[x]]:w[G[x]]=[o[S[N][0]],S[N][1],G[x]])}this.closestTo=w,this.vecToidx=G}calcCoeffs(){const U=this.m,G=this.n,C=Math.sqrt(3)/3,L=U*U+G*G+U*G;this.coau=(U+G)/L,this.cobu=-G/L,this.coav=-C*(U-G)/L,this.cobv=C*(2*U+G)/L}createInnerFacets(){const U=this.m,G=this.n;for(let C=0;C<G+U+1;C++)for(let U=this.min[C];U<this.max[C]+1;U++)U<this.max[C]&&U<this.max[C+1]+1&&this.innerFacets.push(["|"+U+"|"+C,"|"+U+"|"+(C+1),"|"+(U+1)+"|"+C]),C>0&&U<this.max[C-1]&&U+1<this.max[C]+1&&this.innerFacets.push(["|"+U+"|"+C,"|"+(U+1)+"|"+C,"|"+(U+1)+"|"+(C-1)])}edgeVecsABOB(){const U=this.m,G=this.n,C=new GU(-G,U+G);for(let L=1;L<U+G;L++){const U=new GU(this.min[L],L),G=new GU(this.min[L-1],L-1),X=new GU(this.min[L+1],L+1),l=U.clone(),t=G.clone(),E=X.clone();l.rotate60About(C),t.rotate60About(C),E.rotate60About(C);const K=new GU(this.max[l.y],l.y),P=new GU(this.max[l.y-1],l.y-1),O=new GU(this.max[l.y-1]-1,l.y-1);l.x===K.x&&l.y===K.y||(l.x!==P.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,P,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,O,K])):l.y===E.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,G,P]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([U,P,X])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,G,P]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,P,K])))}}mapABOBtoOBOA(){const U=new GU(0,0);for(let G=0;G<this.isoVecsABOB.length;G++){const C=[];for(let L=0;L<3;L++)U.x=this.isoVecsABOB[G][L].x,U.y=this.isoVecsABOB[G][L].y,0===this.vertexTypes[G][L]&&U.rotateNeg120(this.m,this.n),C.push(U.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const U=new GU(0,0);for(let G=0;G<this.isoVecsABOB.length;G++){const C=[];for(let L=0;L<3;L++)U.x=this.isoVecsABOB[G][L].x,U.y=this.isoVecsABOB[G][L].y,1===this.vertexTypes[G][L]&&U.rotate120(this.m,this.n),C.push(U.clone());this.isoVecsBAOA.push(C)}}MapToFace(U,G){const C=this.IDATA.face[U],X=C[2],l=C[1],t=C[0],E=L.pG.NG(this.IDATA.vertex[X]),K=L.pG.NG(this.IDATA.vertex[l]),P=L.pG.NG(this.IDATA.vertex[t]),O=K.IG(E),T=P.IG(E),D=O.scale(this.coau).add(T.scale(this.cobu)),y=O.scale(this.coav).add(T.scale(this.cobv)),V=[];let p,I=L.TmpVectors.pG[0];for(let L=0;L<this.cartesian.length;L++)I=D.scale(this.cartesian[L].x).add(y.scale(this.cartesian[L].y)).add(E),V[L]=[I.x,I.y,I.z],p=U+"|"+this.vertices[L].x+"|"+this.vertices[L].y,G.vertex[this.vecToidx[p]]=[I.x,I.y,I.z]}build(U,G){const C=[],L=GU.Zero(),X=new GU(U,G),l=new GU(-G,U+G);C.push(L,X,l);for(let N=G;N<U+1;N++)for(let G=0;G<U+1-N;G++)C.push(new GU(G,N));if(G>0){const L=(0,s.HighestCommonFactor)(U,G),X=U/L,l=G/L;for(let E=1;E<L;E++)C.push(new GU(E*X,E*l)),C.push(new GU(-E*l,E*(X+l))),C.push(new GU(U-E*(X+l),G+E*X));const t=U/G;for(let E=1;E<G;E++)for(let L=0;L<E*t;L++)C.push(new GU(L,E)),C.push(new GU(L,E).rotate120(U,G)),C.push(new GU(L,E).rotateNeg120(U,G))}C.sort(((U,G)=>U.x-G.x)),C.sort(((U,G)=>U.y-G.y));const t=new Array(U+G+1),E=new Array(U+G+1);for(let N=0;N<t.length;N++)t[N]=1/0,E[N]=-1/0;let K=0,P=0;const O=C.length;for(let N=0;N<O;N++)P=C[N].x,K=C[N].y,t[K]=Math.min(P,t[K]),E[K]=Math.max(P,E[K]);const T=(C,L)=>{const X=C.clone();return"A"===L&&X.rotateNeg120(U,G),"B"===L&&X.rotate120(U,G),X.x<0?X.y:X.x+X.y},D=[],y=[],V=[],p=[],I={},H=[];let x=-1,h=-1;for(let N=0;N<O;N++)D[N]=C[N].toCartesianOrigin(new GU(0,0),.5),y[N]=T(C[N],"O"),V[N]=T(C[N],"A"),p[N]=T(C[N],"B"),y[N]===V[N]&&V[N]===p[N]?(x=3,h=y[N]):y[N]===V[N]?(x=4,h=y[N]):V[N]===p[N]?(x=5,h=V[N]):p[N]===y[N]&&(x=6,h=y[N]),y[N]<V[N]&&y[N]<p[N]&&(x=2,h=y[N]),V[N]<y[N]&&V[N]<p[N]&&(x=1,h=V[N]),p[N]<V[N]&&p[N]<y[N]&&(x=0,h=p[N]),H.push([x,h,C[N].x,C[N].y]);H.sort(((U,G)=>U[2]-G[2])),H.sort(((U,G)=>U[3]-G[3])),H.sort(((U,G)=>U[1]-G[1])),H.sort(((U,G)=>U[0]-G[0]));for(let N=0;N<H.length;N++)I[H[N][2]+"|"+H[N][3]]=[H[N][0],H[N][1],N];return this.m=U,this.n=G,this.vertices=C,this.vertByDist=I,this.cartesian=D,this.min=t,this.max=E,this}}class LU{constructor(U,G,C,L){this.name=U,this.category=G,this.vertex=C,this.face=L}}class XU extends LU{innerToData(U,G){for(let C=0;C<G.innerFacets.length;C++)this.face.push(G.innerFacets[C].map((C=>G.vecToidx[U+C])))}mapABOBtoDATA(U,G){const C=G.IDATA.edgematch[U][0];for(let L=0;L<G.isoVecsABOB.length;L++){const X=[];for(let l=0;l<3;l++)0===G.vertexTypes[L][l]?X.push(U+"|"+G.isoVecsABOB[L][l].x+"|"+G.isoVecsABOB[L][l].y):X.push(C+"|"+G.isoVecsABOB[L][l].x+"|"+G.isoVecsABOB[L][l].y);this.face.push([G.vecToidx[X[0]],G.vecToidx[X[1]],G.vecToidx[X[2]]])}}mapOBOAtoDATA(U,G){const C=G.IDATA.edgematch[U][0];for(let L=0;L<G.isoVecsOBOA.length;L++){const X=[];for(let l=0;l<3;l++)1===G.vertexTypes[L][l]?X.push(U+"|"+G.isoVecsOBOA[L][l].x+"|"+G.isoVecsOBOA[L][l].y):X.push(C+"|"+G.isoVecsOBOA[L][l].x+"|"+G.isoVecsOBOA[L][l].y);this.face.push([G.vecToidx[X[0]],G.vecToidx[X[1]],G.vecToidx[X[2]]])}}mapBAOAtoDATA(U,G){const C=G.IDATA.edgematch[U][2];for(let L=0;L<G.isoVecsBAOA.length;L++){const X=[];for(let l=0;l<3;l++)1===G.vertexTypes[L][l]?X.push(U+"|"+G.isoVecsBAOA[L][l].x+"|"+G.isoVecsBAOA[L][l].y):X.push(C+"|"+G.isoVecsBAOA[L][l].x+"|"+G.isoVecsBAOA[L][l].y);this.face.push([G.vecToidx[X[0]],G.vecToidx[X[1]],G.vecToidx[X[2]]])}}orderData(U){const G=[];for(let l=0;l<13;l++)G[l]=[];const C=U.closestTo;for(let l=0;l<C.length;l++)C[l][0]>-1?C[l][1]>0&&G[C[l][0]].push([l,C[l][1]]):G[12].push([l,C[l][0]]);const L=[];for(let l=0;l<12;l++)L[l]=l;let X=12;for(let l=0;l<12;l++){G[l].sort(((U,G)=>U[1]-G[1]));for(let U=0;U<G[l].length;U++)L[G[l][U][0]]=X++}for(let l=0;l<G[12].length;l++)L[G[12][l][0]]=X++;for(let l=0;l<this.vertex.length;l++)this.vertex[l].push(L[l]);this.vertex.sort(((U,G)=>U[3]-G[3]));for(let l=0;l<this.vertex.length;l++)this.vertex[l].pop();for(let l=0;l<this.face.length;l++)for(let U=0;U<this.face[l].length;U++)this.face[l][U]=L[this.face[l][U]];this.sharedNodes=G[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(U,G){const C=[],L=[];let X=G.pop();L.push(X);let l=this.face[X].indexOf(U);l=(l+2)%3;let t=this.face[X][l];C.push(t);let E=0;for(;G.length>0;)X=G[E],this.face[X].indexOf(t)>-1?(l=(this.face[X].indexOf(t)+1)%3,t=this.face[X][l],C.push(t),L.push(X),G.splice(E,1),E=0):E++;return this.adjacentFaces.push(C),L}toGoldbergPolyhedronData(){const U=new LU("GeoDual","Goldberg",[],[]);U.name="GD dual";const G=this.vertex.length,C=new Array(G);for(let K=0;K<G;K++)C[K]=[];for(let K=0;K<this.face.length;K++)for(let U=0;U<3;U++)C[this.face[K][U]].push(K);let L=0,X=0,l=0,t=[],E=[];this.adjacentFaces=[];for(let K=0;K<C.length;K++){U.face[K]=this.setOrder(K,C[K].concat([]));for(const G of C[K]){L=0,X=0,l=0,t=this.face[G];for(let U=0;U<3;U++)E=this.vertex[t[U]],L+=E[0],X+=E[1],l+=E[2];U.vertex[G]=[L/3,X/3,l/3]}}return U}static BuildGeodesicData(U){const G=new XU("Geodesic-m-n","Geodesic",[[0,UU.h,-1],[-UU.h,1,0],[-1,0,-UU.h],[1,0,-UU.h],[UU.h,1,0],[0,UU.h,1],[-1,0,UU.h],[-UU.h,-1,0],[0,-UU.h,-1],[UU.h,-1,0],[1,0,UU.h],[0,-UU.h,1]],[]);U.setIndices(),U.calcCoeffs(),U.createInnerFacets(),U.edgeVecsABOB(),U.mapABOBtoOBOA(),U.mapABOBtoBAOA();for(let C=0;C<U.IDATA.face.length;C++)U.MapToFace(C,G),G.innerToData(C,U),"B"===U.IDATA.edgematch[C][1]&&G.mapABOBtoDATA(C,U),"O"===U.IDATA.edgematch[C][1]&&G.mapOBOAtoDATA(C,U),"A"===U.IDATA.edgematch[C][3]&&G.mapBAOAtoDATA(C,U);G.orderData(U);return G.vertex=G.vertex.map((function(U){const G=U[0],C=U[1],L=U[2],X=Math.sqrt(G*G+C*C+L*L);return U[0]*=1/X,U[1]*=1/X,U[2]*=1/X,U})),G}}X.d._GoldbergMeshParser=(U,G)=>lU.Parse(U,G);class lU extends X.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(U,G){return void 0===G?(U>this.goldbergData.nbUnsharedFaces-1&&(J.d.Warn("Maximum number of unshared faces used"),U=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+U):(U>11&&(J.d.Warn("Last pole used"),U=11),G>this.goldbergData.nbFacesAtPole-1&&(J.d.Warn("Maximum number of faces at a pole used"),G=this.goldbergData.nbFacesAtPole-1),12+U*this.goldbergData.nbFacesAtPole+G)}_changeGoldbergFaceColors(U){for(let C=0;C<U.length;C++){const G=U[C][0],L=U[C][1],X=U[C][2];for(let U=G;U<L+1;U++)this.goldbergData.faceColors[U]=X}const G=[];for(let C=0;C<12;C++)for(let U=0;U<5;U++)G.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let U=0;U<6;U++)G.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return G}setGoldbergFaceColors(U){const G=this._changeGoldbergFaceColors(U);this.nU(l.e.ColorKind,G)}updateGoldbergFaceColors(U){const G=this._changeGoldbergFaceColors(U);this.updateVerticesData(l.e.ColorKind,G)}_changeGoldbergFaceUVs(U){const G=this.getVerticesData(l.e.UVKind);for(let C=0;C<U.length;C++){const L=U[C][0],X=U[C][1],l=U[C][2],t=U[C][3],E=U[C][4],K=[],P=[];let O,T;for(let U=0;U<5;U++)O=l.x+t*Math.cos(E+U*Math.PI/2.5),T=l.y+t*Math.sin(E+U*Math.PI/2.5),O<0&&(O=0),O>1&&(O=1),K.push(O,T);for(let U=0;U<6;U++)O=l.x+t*Math.cos(E+U*Math.PI/3),T=l.y+t*Math.sin(E+U*Math.PI/3),O<0&&(O=0),O>1&&(O=1),P.push(O,T);for(let U=L;U<Math.min(12,X+1);U++)for(let C=0;C<5;C++)G[10*U+2*C]=K[2*C],G[10*U+2*C+1]=K[2*C+1];for(let U=Math.max(12,L);U<X+1;U++)for(let C=0;C<6;C++)G[12*U-24+2*C]=P[2*C],G[12*U-23+2*C]=P[2*C+1]}return G}setGoldbergFaceUVs(U){const G=this._changeGoldbergFaceUVs(U);this.nU(l.e.UVKind,G)}updateGoldbergFaceUVs(U){const G=this._changeGoldbergFaceUVs(U);this.updateVerticesData(l.e.UVKind,G)}placeOnGoldbergFaceAt(U,G,C){const X=L.pG.RotationFromAxis(this.goldbergData.faceXaxis[G],this.goldbergData.faceYaxis[G],this.goldbergData.faceZaxis[G]);U.rotation=X,U.position=this.goldbergData.faceCenters[G].add(this.goldbergData.faceXaxis[G].scale(C.x)).add(this.goldbergData.faceYaxis[G].scale(C.y)).add(this.goldbergData.faceZaxis[G].scale(C.z))}serialize(U){super.serialize(U),U.type="GoldbergMesh";const G={};if(G.adjacentFaces=this.goldbergData.adjacentFaces,G.nbSharedFaces=this.goldbergData.nbSharedFaces,G.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,G.nbFaces=this.goldbergData.nbFaces,G.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){G.faceColors=[];for(const U of this.goldbergData.faceColors)G.faceColors.push(U.sE())}if(this.goldbergData.faceCenters){G.faceCenters=[];for(const U of this.goldbergData.faceCenters)G.faceCenters.push(U.sE())}if(this.goldbergData.faceZaxis){G.faceZaxis=[];for(const U of this.goldbergData.faceZaxis)G.faceZaxis.push(U.sE())}if(this.goldbergData.faceYaxis){G.faceYaxis=[];for(const U of this.goldbergData.faceYaxis)G.faceYaxis.push(U.sE())}if(this.goldbergData.faceXaxis){G.faceXaxis=[];for(const U of this.goldbergData.faceXaxis)G.faceXaxis.push(U.sE())}U.goldbergData=G}static Parse(U,G){const C=U.goldbergData;C.faceColors=C.faceColors.map((U=>D.JE.NG(U))),C.faceCenters=C.faceCenters.map((U=>L.pG.NG(U))),C.faceZaxis=C.faceZaxis.map((U=>L.pG.NG(U))),C.faceXaxis=C.faceXaxis.map((U=>L.pG.NG(U))),C.faceYaxis=C.faceYaxis.map((U=>L.pG.NG(U)));const X=new lU(U.name,G);return X.goldbergData=C,X}}var tU=C(13428);const EU={CreateBox:T.e,CreateTiledBox:I,CreateSphere:H.b,CreateDisc:O.e,CreateIcoSphere:z,CreateRibbon:P,CreateCylinder:b,CreateTorus:w,CreateTorusKnot:v,CreateLineSystem:u.i,iP:u.k,CreateDashedLines:u.e,ExtrudeShape:Z,ExtrudeShapeCustom:F,CreateLathe:a,CreateTiledPlane:V,WP:k.c,CreateGround:n.e,CreateTiledGround:n.h,CreateGroundFromHeightMap:n.d,CreatePolygon:d.d,ExtrudePolygon:d.f,CreateTube:Q,CreatePolyhedron:B,CreateGeodesic:function(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=G.m||1;L!==Math.floor(L)&&(L=Math.floor(L),J.d.Warn("m not an integer only floor(m) used"));let X=G.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),J.d.Warn("n not an integer only floor(n) used")),X>L){const U=X;X=L,L=U,J.d.Warn("n > m therefore m and n swapped")}const l=new CU;return l.build(L,X),B(U,{custom:XU.BuildGeodesicData(l),size:G.size,sizeX:G.sizeX,sizeY:G.sizeY,sizeZ:G.sizeZ,faceUV:G.faceUV,faceColors:G.faceColors,flat:G.flat,updatable:G.updatable,sideOrientation:G.sideOrientation,frontUVs:G.frontUVs,backUVs:G.backUVs},C)},CreateGoldberg:function(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=G.size,K=G.sizeX||l||1,P=G.sizeY||l||1,O=G.sizeZ||l||1;let T=G.m||1;T!==Math.floor(T)&&(T=Math.floor(T),J.d.Warn("m not an integer only floor(m) used"));let y=G.n||0;if(y!==Math.floor(y)&&(y=Math.floor(y),J.d.Warn("n not an integer only floor(n) used")),y>T){const U=y;y=T,T=U,J.d.Warn("n > m therefore m and n swapped")}const V=new CU;V.build(T,y);const p=XU.BuildGeodesicData(V),I=p.toGoldbergPolyhedronData(),H=new lU(U,C);G.sideOrientation=X.d._GetDefaultSideOrientation(G.sideOrientation),H._originalBuilderSideOrientation=G.sideOrientation;(function(U,G){const C=U.size,X=U.sizeX||C||1,l=U.sizeY||C||1,K=U.sizeZ||C||1,P=0===U.sideOrientation?0:U.sideOrientation||t.e.DEFAULTSIDE,O=[],T=[],D=[],y=[];let V=1/0,p=-1/0,I=1/0,H=-1/0;for(let L=0;L<G.vertex.length;L++)V=Math.min(V,G.vertex[L][0]*X),p=Math.max(p,G.vertex[L][0]*X),I=Math.min(I,G.vertex[L][1]*l),H=Math.max(H,G.vertex[L][1]*l);let x=0;for(let t=0;t<G.face.length;t++){const U=G.face[t],C=L.pG.NG(G.vertex[U[0]]),P=L.pG.NG(G.vertex[U[2]]),h=L.pG.NG(G.vertex[U[1]]),N=P.IG(C),b=h.IG(C),o=L.pG.Cross(b,N).normalize();for(let L=0;L<U.length;L++){D.push(o.x,o.y,o.z);const C=G.vertex[U[L]];O.push(C[0]*X,C[1]*l,C[2]*K);const t=(C[1]*l-I)/(H-I);y.push((C[0]*X-V)/(p-V),E.c?1-t:t)}for(let G=0;G<U.length-2;G++)T.push(x,x+G+2,x+G+1);x+=U.length}t.e._ComputeSides(P,O,T,D,y);const h=new t.e;return h.vU=O,h.indices=T,h.uU=D,h.gU=y,h})(G,I).FU(H,G.updatable),H.goldbergData.nbSharedFaces=p.sharedNodes,H.goldbergData.nbUnsharedFaces=p.poleNodes,H.goldbergData.adjacentFaces=p.adjacentFaces,H.goldbergData.nbFaces=H.goldbergData.nbSharedFaces+H.goldbergData.nbUnsharedFaces,H.goldbergData.nbFacesAtPole=(H.goldbergData.nbUnsharedFaces-12)/12;for(let X=0;X<p.vertex.length;X++)H.goldbergData.faceCenters.push(L.pG.NG(p.vertex[X])),H.goldbergData.faceCenters[X].x*=K,H.goldbergData.faceCenters[X].y*=P,H.goldbergData.faceCenters[X].z*=O,H.goldbergData.faceColors.push(new D.JE(1,1,1,1));for(let X=0;X<I.face.length;X++){const U=I.face[X],G=L.pG.NG(I.vertex[U[0]]),C=L.pG.NG(I.vertex[U[2]]),l=L.pG.NG(I.vertex[U[1]]),t=C.IG(G),E=l.IG(G),K=L.pG.Cross(E,t).normalize(),P=L.pG.Cross(E,K).normalize();H.goldbergData.faceXaxis.push(E.normalize()),H.goldbergData.faceYaxis.push(K),H.goldbergData.faceZaxis.push(P)}return H},CreateDecal:W,CreateCapsule:r,CreateText:tU.f}},13758:(U,G,C)=>{"use strict";C.d(G,{d:()=>KG});var L=C(12896),X=C(13238);class l extends X.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var t=C(12934),E=(C(13046),C(12850));class K{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this._targetStopDuration!==U&&(this._targetStopDuration=U)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){this._noiseTexture!==U&&(this._noiseTexture=U,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(U){this._isAnimationSheetEnabled!=U&&(this._isAnimationSheetEnabled=U,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(U){this._useLogarithmicDepth=U&&this.wU().getEngine().getCaps().fragmentDepthSupported}wU(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(U){switch(U){case K.BLENDMODE_MULTIPLYADD:return;case K.BLENDMODE_ADD:U=1;break;case K.BLENDMODE_ONEONE:U=6;break;case K.BLENDMODE_STANDARD:U=2;break;case K.BLENDMODE_MULTIPLY:U=4;break;case K.BLENDMODE_SUBTRACT:U=3}this._engine.setAlphaMode(U)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:L.pG.Zero()}set direction1(U){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=U)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:L.pG.Zero()}set direction2(U){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=U)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:L.pG.Zero()}set minEmitBox(U){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=U)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:L.pG.Zero()}set maxEmitBox(U){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=U)}get billboardMode(){return this._billboardMode}set billboardMode(U){this._billboardMode!==U&&(this._billboardMode=U,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(U){this._isBillboardBased!==U&&(this._isBillboardBased=U,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(U){this._attachImageProcessingConfiguration(U)}_attachImageProcessingConfiguration(U){U!==this._imageProcessingConfiguration&&(!U&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=U)}_reset(){}_removeGradientAndTexture(U,G,C){if(!G)return this;let L=0;for(const X of G){if(X.gradient===U){G.splice(L,1);break}L++}return C&&C.dispose(),this}constructor(U){this.animations=[],this.renderingGroupId=0,this.LG=L.pG.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new L.pG(10,10,10),this.onAnimationEnd=null,this.blendMode=K.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new L.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.AP=new L.pG(0,0,0),this._useLogarithmicDepth=!1,this.gravity=L.pG.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new t.JE(1,1,1,1),this.color2=new t.JE(1,1,1,1),this.colorDead=new t.JE(0,0,0,1),this.textureMask=new t.JE(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new l,this.id=U,this.name=U}createPointEmitter(U,G){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new L.pG(0,1,0),arguments.length>2&&void 0!==arguments[2]||new L.pG(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new L.pG(0,1,0),arguments.length>4&&void 0!==arguments[4]||new L.pG(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new L.pG(0,1,0),arguments.length>3&&void 0!==arguments[3]||new L.pG(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(U,G,C,L){throw new Error("Method not implemented.")}}K.BLENDMODE_ONEONE=0,K.BLENDMODE_STANDARD=1,K.BLENDMODE_ADD=2,K.BLENDMODE_MULTIPLY=3,K.BLENDMODE_MULTIPLYADD=4,K.BLENDMODE_SUBTRACT=-1,(0,E.e)("BABYLON.BaseParticleSystem",K);var P=C(12911),O=C(12737);class T{constructor(){this.direction1=new L.pG(0,1,0),this.direction2=new L.pG(0,1,0),this.minEmitBox=new L.pG(-.5,-.5,-.5),this.maxEmitBox=new L.pG(.5,.5,.5)}startDirectionFunction(U,G,C,X){const l=(0,P.RandomRange)(this.direction1.x,this.direction2.x),t=(0,P.RandomRange)(this.direction1.y,this.direction2.y),E=(0,P.RandomRange)(this.direction1.z,this.direction2.z);if(X)return G.x=l,G.y=t,void(G.z=E);L.pG.TransformNormalFromFloatsToRef(l,t,E,U,G)}startPositionFunction(U,G,C,X){const l=(0,P.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),t=(0,P.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),E=(0,P.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(X)return G.x=l,G.y=t,void(G.z=E);L.pG.TransformCoordinatesFromFloatsToRef(l,t,E,U,G)}clone(){const U=new T;return O.b.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2),U.setVector3("minEmitBox",this.minEmitBox),U.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3),U.addUniform("minEmitBox",3),U.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.sE(),U.direction2=this.direction2.sE(),U.minEmitBox=this.minEmitBox.sE(),U.maxEmitBox=this.maxEmitBox.sE(),U}parse(U){L.pG.FromArrayToRef(U.direction1,0,this.direction1),L.pG.FromArrayToRef(U.direction2,0,this.direction2),L.pG.FromArrayToRef(U.minEmitBox,0,this.minEmitBox),L.pG.FromArrayToRef(U.maxEmitBox,0,this.maxEmitBox)}}class D{get radius(){return this._radius}set radius(U){this._radius=U,this._buildHeight()}get angle(){return this._angle}set angle(U){this._angle=U,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=G,this.radius=U}startDirectionFunction(U,G,C,X){X?L.TmpVectors.pG[0].L(C.oK).normalize():C.position.subtractToRef(U.getTranslation(),L.TmpVectors.pG[0]).normalize();const l=(0,P.RandomRange)(0,this.directionRandomizer),t=(0,P.RandomRange)(0,this.directionRandomizer),E=(0,P.RandomRange)(0,this.directionRandomizer);G.x=L.TmpVectors.pG[0].x+l,G.y=L.TmpVectors.pG[0].y+t,G.z=L.TmpVectors.pG[0].z+E,G.normalize()}startPositionFunction(U,G,C,X){const l=(0,P.RandomRange)(0,2*Math.PI);let t;this.emitFromSpawnPointOnly?t=1e-4:(t=(0,P.RandomRange)(0,this.heightRange),t=1-t*t);let E=this._radius-(0,P.RandomRange)(0,this._radius*this.radiusRange);E*=t;const K=E*Math.sin(l),O=E*Math.cos(l),T=t*this._height;if(X)return G.x=K,G.y=T,void(G.z=O);L.pG.TransformCoordinatesFromFloatsToRef(K,T,O,U,G)}clone(){const U=new D(this._radius,this._angle,this.directionRandomizer);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat2("radius",this._radius,this.radiusRange),U.setFloat("coneAngle",this._angle),U.setFloat2("height",this._height,this.heightRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",2),U.addUniform("coneAngle",1),U.addUniform("height",2),U.addUniform("directionRandomizer",1)}getEffectDefines(){let U="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(U+="\n#define CONEEMITTERSPAWNPOINT"),U}getClassName(){return"ConeParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this._radius,U.angle=this._angle,U.directionRandomizer=this.directionRandomizer,U.radiusRange=this.radiusRange,U.heightRange=this.heightRange,U.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,U}parse(U){this.radius=U.radius,this.angle=U.angle,this.directionRandomizer=U.directionRandomizer,this.radiusRange=void 0!==U.radiusRange?U.radiusRange:1,this.heightRange=void 0!==U.radiusRange?U.heightRange:1,this.emitFromSpawnPointOnly=void 0!==U.emitFromSpawnPointOnly&&U.emitFromSpawnPointOnly}}class y extends D{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0);super(U,G),this.direction1=C,this.direction2=X}startDirectionFunction(U,G){const C=(0,P.RandomRange)(this.direction1.x,this.direction2.x),X=(0,P.RandomRange)(this.direction1.y,this.direction2.y),l=(0,P.RandomRange)(this.direction1.z,this.direction2.z);L.pG.TransformNormalFromFloatsToRef(C,X,l,U,G)}clone(){const U=new y(this.radius,this.angle,this.direction1,this.direction2);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.sE(),U.direction2=this.direction2.sE(),U}parse(U){super.parse(U),this.direction1.L(U.direction1),this.direction2.L(U.direction2)}}class V{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=U,this.height=G,this.radiusRange=C,this.directionRandomizer=X,this._tempVector=L.pG.Zero()}startDirectionFunction(U,G,C,X,l){C.position.subtractToRef(U.getTranslation(),this._tempVector),this._tempVector.normalize(),L.pG.TransformNormalToRef(this._tempVector,l,this._tempVector);const t=(0,P.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let E=Math.atan2(this._tempVector.x,this._tempVector.z);E+=(0,P.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=t,this._tempVector.x=Math.sin(E),this._tempVector.z=Math.cos(E),this._tempVector.normalize(),X?G.L(this._tempVector):L.pG.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U,G)}startPositionFunction(U,G,C,X){const l=(0,P.RandomRange)(-this.height/2,this.height/2),t=(0,P.RandomRange)(0,2*Math.PI),E=(0,P.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),K=Math.sqrt(E)*this.radius,O=K*Math.cos(t),T=K*Math.sin(t);X?G.WE(O,l,T):L.pG.TransformCoordinatesFromFloatsToRef(O,l,T,U,G)}clone(){const U=new V(this.radius,this.directionRandomizer);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.height=this.height,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.height=U.height,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class p extends V{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0),l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new L.pG(0,1,0);super(U,G,C),this.direction1=X,this.direction2=l}startDirectionFunction(U,G,C,X){const l=(0,P.RandomRange)(this.direction1.x,this.direction2.x),t=(0,P.RandomRange)(this.direction1.y,this.direction2.y),E=(0,P.RandomRange)(this.direction1.z,this.direction2.z);X?G.WE(l,t,E):L.pG.TransformNormalFromFloatsToRef(l,t,E,U,G)}clone(){const U=new p(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.sE(),U.direction2=this.direction2.sE(),U}parse(U){super.parse(U),L.pG.FromArrayToRef(U.direction1,0,this.direction1),L.pG.FromArrayToRef(U.direction2,0,this.direction2)}}class I{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=G,this.directionRandomizer=C}startDirectionFunction(U,G,C,X){const l=C.position.IG(U.getTranslation()).normalize(),t=(0,P.RandomRange)(0,this.directionRandomizer),E=(0,P.RandomRange)(0,this.directionRandomizer),K=(0,P.RandomRange)(0,this.directionRandomizer);l.x+=t,l.y+=E,l.z+=K,l.normalize(),X?G.L(l):L.pG.TransformNormalFromFloatsToRef(l.x,l.y,l.z,U,G)}startPositionFunction(U,G,C,X){const l=this.radius-(0,P.RandomRange)(0,this.radius*this.radiusRange),t=(0,P.RandomRange)(0,1),E=(0,P.RandomRange)(0,2*Math.PI),K=Math.acos(2*t-1),O=l*Math.cos(E)*Math.sin(K),T=l*Math.cos(K),D=l*Math.sin(E)*Math.sin(K);X?G.WE(O,Math.abs(T),D):L.pG.TransformCoordinatesFromFloatsToRef(O,Math.abs(T),D,U,G)}clone(){const U=new I(this.radius,this.directionRandomizer);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class H{constructor(){this.direction1=new L.pG(0,1,0),this.direction2=new L.pG(0,1,0)}startDirectionFunction(U,G,C,X){const l=(0,P.RandomRange)(this.direction1.x,this.direction2.x),t=(0,P.RandomRange)(this.direction1.y,this.direction2.y),E=(0,P.RandomRange)(this.direction1.z,this.direction2.z);X?G.WE(l,t,E):L.pG.TransformNormalFromFloatsToRef(l,t,E,U,G)}startPositionFunction(U,G,C,X){X?G.WE(0,0,0):L.pG.TransformCoordinatesFromFloatsToRef(0,0,0,U,G)}clone(){const U=new H;return O.b.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.sE(),U.direction2=this.direction2.sE(),U}parse(U){L.pG.FromArrayToRef(U.direction1,0,this.direction1),L.pG.FromArrayToRef(U.direction2,0,this.direction2)}}class x{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=G,this.directionRandomizer=C}startDirectionFunction(U,G,C,X){const l=C.position.IG(U.getTranslation()).normalize(),t=(0,P.RandomRange)(0,this.directionRandomizer),E=(0,P.RandomRange)(0,this.directionRandomizer),K=(0,P.RandomRange)(0,this.directionRandomizer);l.x+=t,l.y+=E,l.z+=K,l.normalize(),X?G.L(l):L.pG.TransformNormalFromFloatsToRef(l.x,l.y,l.z,U,G)}startPositionFunction(U,G,C,X){const l=this.radius-(0,P.RandomRange)(0,this.radius*this.radiusRange),t=(0,P.RandomRange)(0,1),E=(0,P.RandomRange)(0,2*Math.PI),K=Math.acos(2*t-1),O=l*Math.cos(E)*Math.sin(K),T=l*Math.cos(K),D=l*Math.sin(E)*Math.sin(K);X?G.WE(O,T,D):L.pG.TransformCoordinatesFromFloatsToRef(O,T,D,U,G)}clone(){const U=new x(this.radius,this.directionRandomizer);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class h extends x{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new L.pG(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0);super(U),this.direction1=G,this.direction2=C}startDirectionFunction(U,G){const C=(0,P.RandomRange)(this.direction1.x,this.direction2.x),X=(0,P.RandomRange)(this.direction1.y,this.direction2.y),l=(0,P.RandomRange)(this.direction1.z,this.direction2.z);L.pG.TransformNormalFromFloatsToRef(C,X,l,U,G)}clone(){const U=new h(this.radius,this.direction1,this.direction2);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.sE(),U.direction2=this.direction2.sE(),U}parse(U){super.parse(U),this.direction1.L(U.direction1),this.direction2.L(U.direction2)}}class N{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(U,G,C,X){const l=L.TmpVectors.pG[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,l);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,l);const U=L.TmpVectors.pG[1];l.subtractToRef(C.position,U),U.scaleToRef(1/C.lifeTime,l)}else l.set(0,0,0);X?G.L(l):L.pG.TransformNormalToRef(l,U,G)}startPositionFunction(U,G,C,X){const l=L.TmpVectors.pG[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,l):l.set(0,0,0),X?G.L(l):L.pG.TransformCoordinatesToRef(l,U,G)}clone(){const U=new N;return O.b.DeepCopy(this,U),U}applyToShader(U){}buildUniformLayout(U){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.particlePositionGenerator=this.particlePositionGenerator,U.particleDestinationGenerator=this.particleDestinationGenerator,U}parse(U){U.particlePositionGenerator&&(this.particlePositionGenerator=U.particlePositionGenerator),U.particleDestinationGenerator&&(this.particleDestinationGenerator=U.particleDestinationGenerator)}}var b=C(12957);class o{get mesh(){return this._mesh}set mesh(U){this._mesh!==U&&(this._mesh=U,U?(this._indices=U.cE(),this._positions=U.getVerticesData(b.e.PositionKind),this._normals=U.getVerticesData(b.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=L.pG.Zero(),this._mesh=null,this.direction1=new L.pG(0,1,0),this.direction2=new L.pG(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=U}startDirectionFunction(U,G,C,X){if(this.useMeshNormalsForDirection&&this._normals)return void L.pG.TransformNormalToRef(this._storedNormal,U,G);const l=(0,P.RandomRange)(this.direction1.x,this.direction2.x),t=(0,P.RandomRange)(this.direction1.y,this.direction2.y),E=(0,P.RandomRange)(this.direction1.z,this.direction2.z);X?G.WE(l,t,E):L.pG.TransformNormalFromFloatsToRef(l,t,E,U,G)}startPositionFunction(U,G,C,X){if(!this._indices||!this._positions)return;const l=3*(Math.random()*(this._indices.length/3)|0),t=Math.random(),E=Math.random()*(1-t),K=1-t-E,P=this._indices[l],O=this._indices[l+1],T=this._indices[l+2],D=L.TmpVectors.pG[0],y=L.TmpVectors.pG[1],V=L.TmpVectors.pG[2],p=L.TmpVectors.pG[3];L.pG.FromArrayToRef(this._positions,3*P,D),L.pG.FromArrayToRef(this._positions,3*O,y),L.pG.FromArrayToRef(this._positions,3*T,V),p.x=t*D.x+E*y.x+K*V.x,p.y=t*D.y+E*y.y+K*V.y,p.z=t*D.z+E*y.z+K*V.z,X?G.WE(p.x,p.y,p.z):L.pG.TransformCoordinatesFromFloatsToRef(p.x,p.y,p.z,U,G),this.useMeshNormalsForDirection&&this._normals&&(L.pG.FromArrayToRef(this._normals,3*P,D),L.pG.FromArrayToRef(this._normals,3*O,y),L.pG.FromArrayToRef(this._normals,3*T,V),this._storedNormal.x=t*D.x+E*y.x+K*V.x,this._storedNormal.y=t*D.y+E*y.y+K*V.y,this._storedNormal.z=t*D.z+E*y.z+K*V.z)}clone(){const U=new o(this.mesh);return O.b.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var U;const G={};return G.type=this.getClassName(),G.direction1=this.direction1.sE(),G.direction2=this.direction2.sE(),G.meshId=null===(U=this.mesh)||void 0===U?void 0:U.id,G.useMeshNormalsForDirection=this.useMeshNormalsForDirection,G}parse(U,G){L.pG.FromArrayToRef(U.direction1,0,this.direction1),L.pG.FromArrayToRef(U.direction2,0,this.direction2),U.meshId&&G&&(this.mesh=G.getLastMeshById(U.meshId)),this.useMeshNormalsForDirection=U.useMeshNormalsForDirection}}class w{_isUbo(U){return void 0!==U.addUniform}constructor(U){this._isUbo(U)?(this.setMatrix3x3=U.updateMatrix3x3.bind(U),this.setMatrix2x2=U.updateMatrix2x2.bind(U),this.setFloat=U.updateFloat.bind(U),this.setFloat2=U.updateFloat2.bind(U),this.setFloat3=U.updateFloat3.bind(U),this.setFloat4=U.updateFloat4.bind(U),this.setFloatArray=U.updateFloatArray.bind(U),this.setArray=U.updateArray.bind(U),this.setIntArray=U.updateIntArray.bind(U),this.setMatrix=U.YE.bind(U),this.setMatrices=U.updateMatrices.bind(U),this.setVector3=U.updateVector3.bind(U),this.setVector4=U.updateVector4.bind(U),this.setColor3=U.updateColor3.bind(U),this.setColor4=U.updateColor4.bind(U),this.setDirectColor4=U.updateDirectColor4.bind(U),this.setInt=U.updateInt.bind(U),this.setInt2=U.updateInt2.bind(U),this.setInt3=U.updateInt3.bind(U),this.setInt4=U.updateInt4.bind(U)):(this.setMatrix3x3=U.setMatrix3x3.bind(U),this.setMatrix2x2=U.setMatrix2x2.bind(U),this.setFloat=U.setFloat.bind(U),this.setFloat2=U.setFloat2.bind(U),this.setFloat3=U.setFloat3.bind(U),this.setFloat4=U.setFloat4.bind(U),this.setFloatArray=U.setFloatArray.bind(U),this.setArray=U.setArray.bind(U),this.setIntArray=U.setIntArray.bind(U),this.setMatrix=U.setMatrix.bind(U),this.setMatrices=U.setMatrices.bind(U),this.setVector3=U.setVector3.bind(U),this.setVector4=U.setVector4.bind(U),this.setColor3=U.setColor3.bind(U),this.setColor4=U.setColor4.bind(U),this.setDirectColor4=U.setDirectColor4.bind(U),this.setInt=U.setInt.bind(U),this.setInt2=U.setInt2.bind(U),this.setInt3=U.setInt3.bind(U),this.setInt4=U.setInt4.bind(U))}}var S=C(12808);const v="gpuUpdateParticlesPixelShader",u="#version 300 es\nvoid main() {discard;}\n";S.d.ShadersStore[v]||(S.d.ShadersStore[v]=u);const d="gpuUpdateParticlesVertexShader",g="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";S.d.ShadersStore[d]||(S.d.ShadersStore[d]=g);(0,E.e)("BABYLON.WebGL2ParticleSystem",class{constructor(U,G){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=U,this._engine=G,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var U,G;return null!==(U=null===(G=this._updateEffect)||void 0===G?void 0:G.isReady())&&void 0!==U&&U}createUpdateBuffer(U){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof N&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=U,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new w(this._updateEffect)}createVertexBuffers(U,G){this._updateVAO.push(this._createUpdateVAO(U)),this._renderVAO.push(this._engine.recordVertexArrayObject(G,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=G}createParticleBuffer(U){return U}bindDrawBuffers(U,G,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,G):this._engine.bindVertexArrayObject(this._renderVAO[U],null)}preUpdateParticleBuffer(){const U=this._engine;if(this._engine.enableEffect(this._updateEffect),!U.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(U,G,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[U],null);const L=this._engine;L.bindTransformFeedbackBuffer(G.getBuffer()),L.setRasterizerState(!1),L.beginTransformFeedback(!0),L.drawArraysType(3,0,C),L.endTransformFeedback(),L.setRasterizerState(!0),L.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let U=0;U<this._updateVAO.length;U++)this._engine.releaseVertexArrayObject(this._updateVAO[U]);this._updateVAO.length=0;for(let U=0;U<this._renderVAO.length;U++)this._engine.releaseVertexArrayObject(this._renderVAO[U]);this._renderVAO.length=0}_createUpdateVAO(U){const G={};G.position=U.createVertexBuffer("position",0,3);let C=3;G.age=U.createVertexBuffer("age",C,1),C+=1,G.size=U.createVertexBuffer("size",C,3),C+=3,G.life=U.createVertexBuffer("life",C,1),C+=1,G.seed=U.createVertexBuffer("seed",C,4),C+=4,G.direction=U.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof N&&(G.initialPosition=U.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(G.color=U.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(G.initialDirection=U.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(G.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",C,3),C+=3,G.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(G.angle=U.createVertexBuffer("angle",C,1),C+=1):(G.angle=U.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(G.cellIndex=U.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(G.cellStartOffset=U.createVertexBuffer("cellStartOffset",C,1),C+=1));const L=this._engine.recordVertexArrayObject(G,null,this._updateEffect);return this._engine.bindArrayBuffer(null),L}});class Z{constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,L=arguments.length>3?arguments[3]:void 0;this._engine=U,this._label=L,this._engine._storageBuffers.push(this),this._create(G,C)}_create(U,G){this._bufferSize=U,this._creationFlags=G,this._buffer=this._engine.createStorageBuffer(U,G,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(U,G,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,U,G,C)}async read(U,G,C,L){return await this._engine.readFromStorageBuffer(this._buffer,U,G,C,L)}dispose(){const U=this._engine._storageBuffers,G=U.indexOf(this);-1!==G&&(U[G]=U[U.length-1],U.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var F=C(26),q=C(12876),a=C(12884),k=C(12928),n=C(12873),Q=C(13156),mU=C(12731),B=C(12831),M=C(13087);class z{constructor(){this._gpuTimeInFrameId=-1,this.counter=new M.b}_addDuration(U,G){U<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==U?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(G,!1),this._gpuTimeInFrameId=U):this.counter.addCount(G,!1))}}var s=C(12794);class j{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=U,this._engine=G,this.uniqueId=Q.c.UniqueId,G.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new z),this._engine.getCaps().supportComputeShaders?L.bindingsMapping?(this._context=G.createComputeContext(),this._shaderPath=C,this._options=(0,F.b)({bindingsMapping:{},defines:[]},L)):mU.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):mU.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(U,G){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const L=this._bindings[U];this._bindings[U]={type:C?0:4,object:G,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!L||L.object!==G||L.type!==this._bindings[U].type)}setStorageTexture(U,G){const C=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==G),this._bindings[U]={type:1,object:G,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(U,G){const C=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==G),this._bindings[U]={type:6,object:G,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(U,G){return!!G.externalTexture&&(this.setExternalTexture(U,G.externalTexture),!0)}setUniformBuffer(U,G){const C=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==G),this._bindings[U]={type:j._BufferIsDataBuffer(G)?7:2,object:G,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(U,G){const C=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==G),this._bindings[U]={type:j._BufferIsDataBuffer(G)?7:3,object:G,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(U,G){const C=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!C||!G.compareSampler(C.object)),this._bindings[U]={type:5,object:G,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let U=this._effect;for(const X in this._bindings){const U=this._bindings[X],G=U.type,C=U.object;switch(G){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const G=[],C=this._shaderPath;if(this._options.defines)for(let X=0;X<this._options.defines.length;X++)G.push(this._options.defines[X]);const L=G.join("\n");return this._cachedDefines!==L&&(this._cachedDefines=L,U=this._engine.createComputeEffect(C,{defines:L,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=U),!!U.isReady()}dispatch(U,G,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,U,G,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=j._BufferIsDataBuffer(U)?U:U.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,G,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const G in this._bindings){const C=this._bindings[G];if(!this._options.bindingsMapping[G])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+G+"'");switch(C.type){case 0:{const L=this._samplers[G],X=C.object;var U;if(!L||!X._texture||!L.compareSampler(X._texture))this._samplers[G]=(new B.e).setParameters(X.wrapU,X.wrapV,X.wrapR,X.anisotropicFilteringLevel,X._texture.samplingMode,null===(U=X._texture)||void 0===U?void 0:U._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const U=C.object;U.getBuffer()!==C.buffer&&(C.buffer=U.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((X=>{(0,s.f)((()=>this.dispatch(U,G,C)),X,void 0,L)}))}serialize(){const U=k.c.Serialize(this);U.options=this._options,U.shaderPath=this._shaderPath,U.qD={},U.textures={};for(const G in this._bindings){const C=this._bindings[G],L=C.object;switch(C.type){case 0:case 4:case 1:{const X=L.serialize();X&&(U.textures[G]=X,U.qD[G]={type:C.type});break}}}return U}static Parse(U,G,C){const L=k.c.Parse((()=>new j(U.name,G.getEngine(),U.shaderPath,U.options)),U,G,C);for(const X in U.textures){const l=U.qD[X],t=n.c.Parse(U.textures[X],G,C);0===l.type?L.setTexture(X,t):4===l.type?L.setTexture(X,t,!1):L.setStorageTexture(X,t)}return L}static _BufferIsDataBuffer(U){return void 0!==U.underlyingResource}}(0,q.d)([(0,a.H)()],j.prototype,"name",void 0),(0,q.d)([(0,a.H)()],j.prototype,"fastMode",void 0),(0,E.e)("BABYLON.ComputeShader",j);var A=C(13116);const Y="gpuUpdateParticlesComputeShader",e="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";S.d.ShadersStoreWGSL[Y]||(S.d.ShadersStoreWGSL[Y]=e);(0,E.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(U,G){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=U,this._engine=G}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var U,G;return null!==(U=null===(G=this._updateComputeShader)||void 0===G?void 0:G.isReady())&&void 0!==U&&U}createUpdateBuffer(U){var G;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new j("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:U.split("\n")}),null===(G=this._simParamsComputeShader)||void 0===G||G.dispose(),this._simParamsComputeShader=new A.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new w(this._simParamsComputeShader)}createVertexBuffers(U,G){this._renderVertexBuffers.push(G)}createParticleBuffer(U){const G=new Z(this._engine,4*U.length,11,"ComputeShaderParticleSystemBuffer");return G.update(U),this._bufferComputeShader.push(G),G.getBuffer()}bindDrawBuffers(U,G,C){this._engine.bindBuffers(this._renderVertexBuffers[U],C,G)}preUpdateParticleBuffer(){}updateParticleBuffer(U,G,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[U]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^U]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var U;for(let G=0;G<this._bufferComputeShader.length;++G)this._bufferComputeShader[G].dispose();this._bufferComputeShader.length=0,null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class i{constructor(U,G,C){this.gradient=U,this.color1=G,this.color2=C}getColorToRef(U){this.color2?t.JE.LerpToRef(this.color1,this.color2,Math.random(),U):U.L(this.color1)}}class c{constructor(U,G){this.gradient=U,this.color=G}}class R{constructor(U,G,C){this.gradient=U,this.factor1=G,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class W{static GetCurrentGradient(U,G,C){if(G[0].gradient>U)return void C(G[0],G[0],1);for(let X=0;X<G.length-1;X++){const L=G[X],l=G[X+1];if(U>=L.gradient&&U<=l.gradient){return void C(L,l,(U-L.gradient)/(l.gradient-L.gradient))}}const L=G.length-1;C(G[L],G[L],1)}}var f=C(12721),r=C(13339),J=C(12763);class UU{constructor(U){this.particleSystem=U,this.position=L.pG.Zero(),this.direction=L.pG.Zero(),this.color=new t.JE(0,0,0,0),this.colorStep=new t.JE(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new L.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new t.JE(0,0,0,0),this._currentColor2=new t.JE(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=UU._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let U=this.age,G=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===G?(G=1,U=this._randomCellOffset):U+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let L;L=this._initialSpriteCellLoop?(0,P.Clamp)(U*G%this.lifeTime/this.lifeTime):(0,P.Clamp)(U*G/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+L*C|0}_inheritParticleInfoToSubEmitter(U){if(U.particleSystem.LG.position){const G=U.particleSystem.LG;if(G.position.L(this.position),U.inheritDirection){const U=L.TmpVectors.pG[0];this.direction.normalizeToRef(U),G.setDirection(U,0,Math.PI/2)}}else{U.particleSystem.LG.L(this.position)}this.direction.scaleToRef(U.inheritedVelocityAmount/2,L.TmpVectors.pG[0]),U.particleSystem._inheritedVelocityOffset.L(L.TmpVectors.pG[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const U of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(U)}_reset(){this.age=0,this.id=UU._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(U){U.position.L(this.position),this._initialDirection?U._initialDirection?U._initialDirection.L(this._initialDirection):U._initialDirection=this._initialDirection.clone():U._initialDirection=null,U.direction.L(this.direction),this.oK&&(U.oK?U.oK.L(this.oK):U.oK=this.oK.clone()),U.color.L(this.color),U.colorStep.L(this.colorStep),U.lifeTime=this.lifeTime,U.age=this.age,U._randomCellOffset=this._randomCellOffset,U.size=this.size,U.scale.L(this.scale),U.angle=this.angle,U.angularSpeed=this.angularSpeed,U.particleSystem=this.particleSystem,U.cellIndex=this.cellIndex,U.id=this.id,U._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(U._currentColorGradient=this._currentColorGradient,U._currentColor1.L(this._currentColor1),U._currentColor2.L(this._currentColor2)),this._currentSizeGradient&&(U._currentSizeGradient=this._currentSizeGradient,U._currentSize1=this._currentSize1,U._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(U._currentAngularSpeedGradient=this._currentAngularSpeedGradient,U._currentAngularSpeed1=this._currentAngularSpeed1,U._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(U._currentVelocityGradient=this._currentVelocityGradient,U._currentVelocity1=this._currentVelocity1,U._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(U._currentLimitVelocityGradient=this._currentLimitVelocityGradient,U._currentLimitVelocity1=this._currentLimitVelocity1,U._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(U._currentDragGradient=this._currentDragGradient,U._currentDrag1=this._currentDrag1,U._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(U._initialStartSpriteCellId=this._initialStartSpriteCellId,U._initialEndSpriteCellId=this._initialEndSpriteCellId,U._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(U.remapData&&this.remapData?U.remapData.L(this.remapData):U.remapData=new L.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.L(this._randomNoiseCoordinates1),U._randomNoiseCoordinates2.L(this._randomNoiseCoordinates2)):(U._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),U._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}UU._Count=0;var GU=C(13003),CU=(C(13039),C(13224)),LU=C(13217),XU=C(13110);function lU(U,G){const C=(0,P.RandomRange)(0,1);t.JE.LerpToRef(G.color1,G.color2,C,U.color),G.colorDead.subtractToRef(U.color,G._colorDiff),G._colorDiff.scaleToRef(1/U.lifeTime,U.colorStep)}function tU(U,G){U._currentColorGradient=G._colorGradients[0],U._currentColorGradient.getColorToRef(U.color),U._currentColor1.L(U.color),G._colorGradients.length>1?G._colorGradients[1].getColorToRef(U._currentColor2):U._currentColor2.L(U.color)}function EU(U,G){const C=G._colorGradients;W.GetCurrentGradient(G._ratio,C,((G,C,L)=>{G!==U._currentColorGradient&&(U._currentColor1.L(U._currentColor2),C.getColorToRef(U._currentColor2),U._currentColorGradient=G),t.JE.LerpToRef(U._currentColor1,U._currentColor2,L,U.color)}))}function KU(U,G){U.colorStep.scaleToRef(G._scaledUpdateSpeed,G._scaledColorStep),U.color.addInPlace(G._scaledColorStep),U.color.a<0&&(U.color.a=0)}function PU(U,G){W.GetCurrentGradient(G._ratio,G._angularSpeedGradients,((G,C,L)=>{G!==U._currentAngularSpeedGradient&&(U._currentAngularSpeed1=U._currentAngularSpeed2,U._currentAngularSpeed2=C.getFactor(),U._currentAngularSpeedGradient=G),U.angularSpeed=(0,P.Lerp)(U._currentAngularSpeed1,U._currentAngularSpeed2,L)}))}function OU(U,G){U.angle+=U.angularSpeed*G._scaledUpdateSpeed}function TU(U,G){G.particleEmitterType.startDirectionFunction(G._emitterWorldMatrix,U.direction,U,G.isLocal,G._emitterInverseWorldMatrix)}function DU(U,G){G.startDirectionFunction(G._emitterWorldMatrix,U.direction,U,G.isLocal)}function yU(U,G){U._currentVelocityGradient=G._velocityGradients[0],U._currentVelocity1=U._currentVelocityGradient.getFactor(),G._velocityGradients.length>1?U._currentVelocity2=G._velocityGradients[1].getFactor():U._currentVelocity2=U._currentVelocity1}function VU(U,G){U._currentLimitVelocityGradient=G._limitVelocityGradients[0],U._currentLimitVelocity1=U._currentLimitVelocityGradient.getFactor(),G._limitVelocityGradients.length>1?U._currentLimitVelocity2=G._limitVelocityGradients[1].getFactor():U._currentLimitVelocity2=U._currentLimitVelocity1}function pU(U,G){W.GetCurrentGradient(G._ratio,G._velocityGradients,((C,L,X)=>{C!==U._currentVelocityGradient&&(U._currentVelocity1=U._currentVelocity2,U._currentVelocity2=L.getFactor(),U._currentVelocityGradient=C),G._directionScale*=(0,P.Lerp)(U._currentVelocity1,U._currentVelocity2,X)}))}function IU(U,G){W.GetCurrentGradient(G._ratio,G._limitVelocityGradients,((C,L,X)=>{C!==U._currentLimitVelocityGradient&&(U._currentLimitVelocity1=U._currentLimitVelocity2,U._currentLimitVelocity2=L.getFactor(),U._currentLimitVelocityGradient=C);const l=(0,P.Lerp)(U._currentLimitVelocity1,U._currentLimitVelocity2,X);U.direction.length()>l&&U.direction.scaleInPlace(G.limitVelocityDamping)}))}function HU(U,G){U.direction.scaleToRef(G._directionScale,G._scaledDirection)}function xU(U,G){G.particleEmitterType.startPositionFunction(G._emitterWorldMatrix,U.position,U,G.isLocal)}function hU(U,G){G.startPositionFunction(G._emitterWorldMatrix,U.position,U,G.isLocal)}function NU(U,G){U.oK?U.oK.L(U.position):U.oK=U.position.clone(),L.pG.TransformCoordinatesToRef(U.oK,G._emitterWorldMatrix,U.position)}function bU(U,G){G.isLocal&&U.oK?(U.oK.addInPlace(G._scaledDirection),L.pG.TransformCoordinatesToRef(U.oK,G._emitterWorldMatrix,U.position)):U.position.addInPlace(G._scaledDirection)}function oU(U,G){U._currentDragGradient=G._dragGradients[0],U._currentDrag1=U._currentDragGradient.getFactor(),G._dragGradients.length>1?U._currentDrag2=G._dragGradients[1].getFactor():U._currentDrag2=U._currentDrag1}function wU(U,G){W.GetCurrentGradient(G._ratio,G._dragGradients,((C,L,X)=>{C!==U._currentDragGradient&&(U._currentDrag1=U._currentDrag2,U._currentDrag2=L.getFactor(),U._currentDragGradient=C);const l=(0,P.Lerp)(U._currentDrag1,U._currentDrag2,X);G._scaledDirection.scaleInPlace(1-l)}))}function SU(U,G){U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.WE(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2.WE(Math.random(),Math.random(),Math.random())):(U._randomNoiseCoordinates1=new L.pG(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2=new L.pG(Math.random(),Math.random(),Math.random()))}function vU(U,G){const C=G._noiseTextureData,X=G._noiseTextureSize;if(C&&X&&U._randomNoiseCoordinates1){const l=G._fetchR(U._randomNoiseCoordinates1.x,U._randomNoiseCoordinates1.y,X.width,X.height,C),t=G._fetchR(U._randomNoiseCoordinates1.z,U._randomNoiseCoordinates2.x,X.width,X.height,C),E=G._fetchR(U._randomNoiseCoordinates2.y,U._randomNoiseCoordinates2.z,X.width,X.height,C),K=L.TmpVectors.pG[0],P=L.TmpVectors.pG[1];K.WE((2*l-1)*G.noiseStrength.x,(2*t-1)*G.noiseStrength.y,(2*E-1)*G.noiseStrength.z),K.scaleToRef(G._tempScaledUpdateSpeed,P),U.direction.addInPlace(P)}}function uU(U,G){G.gravity.scaleToRef(G._tempScaledUpdateSpeed,G._scaledGravity),U.direction.addInPlace(G._scaledGravity)}function dU(U,G){U.size=(0,P.RandomRange)(G.minSize,G.maxSize),U.scale.WE((0,P.RandomRange)(G.minScaleX,G.maxScaleX),(0,P.RandomRange)(G.minScaleY,G.maxScaleY))}function gU(U,G){U._currentSizeGradient=G._sizeGradients[0],U._currentSize1=U._currentSizeGradient.getFactor(),U.size=U._currentSize1,G._sizeGradients.length>1?U._currentSize2=G._sizeGradients[1].getFactor():U._currentSize2=U._currentSize1,U.scale.WE((0,P.RandomRange)(G.minScaleX,G.maxScaleX),(0,P.RandomRange)(G.minScaleY,G.maxScaleY))}function ZU(U,G){const C=G._actualFrame/G.targetStopDuration;W.GetCurrentGradient(C,G._startSizeGradients,((C,L,X)=>{C!==G._currentStartSizeGradient&&(G._currentStartSize1=G._currentStartSize2,G._currentStartSize2=L.getFactor(),G._currentStartSizeGradient=C);const l=(0,P.Lerp)(G._currentStartSize1,G._currentStartSize2,X);U.scale.scaleInPlace(l)}))}function FU(U,G){W.GetCurrentGradient(G._ratio,G._sizeGradients,((G,C,L)=>{G!==U._currentSizeGradient&&(U._currentSize1=U._currentSize2,U._currentSize2=C.getFactor(),U._currentSizeGradient=G),U.size=(0,P.Lerp)(U._currentSize1,U._currentSize2,L)}))}function qU(U,G){U.remapData=new L.Vector4(0,1,0,1)}function aU(U,G){G._colorRemapGradients&&G._colorRemapGradients.length>0&&W.GetCurrentGradient(G._ratio,G._colorRemapGradients,((G,C,L)=>{const X=(0,P.Lerp)(G.factor1,C.factor1,L),l=(0,P.Lerp)(G.factor2,C.factor2,L);U.remapData.x=X,U.remapData.y=l-X})),G._alphaRemapGradients&&G._alphaRemapGradients.length>0&&W.GetCurrentGradient(G._ratio,G._alphaRemapGradients,((G,C,L)=>{const X=(0,P.Lerp)(G.factor1,C.factor1,L),l=(0,P.Lerp)(G.factor2,C.factor2,L);U.remapData.z=X,U.remapData.w=l-X}))}function kU(U,G){const C=(0,P.Clamp)(G._actualFrame/G.targetStopDuration);W.GetCurrentGradient(C,G._lifeTimeGradients,((G,L)=>{const X=G,l=L,t=X.getFactor(),E=l.getFactor(),K=(C-X.gradient)/(l.gradient-X.gradient);U.lifeTime=(0,P.Lerp)(t,E,K)})),G._emitPower=(0,P.RandomRange)(G.minEmitPower,G.maxEmitPower)}function nU(U,G){U.lifeTime=(0,P.RandomRange)(G.minLifeTime,G.maxLifeTime),G._emitPower=(0,P.RandomRange)(G.minEmitPower,G.maxEmitPower)}function QU(U,G){0===G._emitPower?(U._initialDirection?U._initialDirection.L(U.direction):U._initialDirection=U.direction.clone(),U.direction.set(0,0,0)):(U._initialDirection=null,U.direction.scaleInPlace(G._emitPower)),U.direction.addInPlace(G._inheritedVelocityOffset)}function mG(U,G){U.angularSpeed=(0,P.RandomRange)(G.minAngularSpeed,G.maxAngularSpeed),U.angle=(0,P.RandomRange)(G.minInitialRotation,G.maxInitialRotation)}function BU(U,G){U._currentAngularSpeedGradient=G._angularSpeedGradients[0],U.angularSpeed=U._currentAngularSpeedGradient.getFactor(),U._currentAngularSpeed1=U.angularSpeed,G._angularSpeedGradients.length>1?U._currentAngularSpeed2=G._angularSpeedGradients[1].getFactor():U._currentAngularSpeed2=U._currentAngularSpeed1,U.angle=(0,P.RandomRange)(G.minInitialRotation,G.maxInitialRotation)}function MU(U,G){U._initialStartSpriteCellId=G.startSpriteCellID,U._initialEndSpriteCellId=G.endSpriteCellID,U._initialSpriteCellLoop=G.spriteCellLoop}function zU(U,G){U.previousItem=G.previousItem,U.nextItem=G,G.previousItem&&(G.previousItem.nextItem=U),G.previousItem=U}function sU(U,G){U.previousItem=G,U.nextItem=G.nextItem,G.nextItem&&(G.nextItem.previousItem=U),G.nextItem=U}function jU(U,G){let C=G;for(;C.nextItem;)C=C.nextItem;U.previousItem=C,U.nextItem=C.nextItem,C.nextItem=U}function AU(U){U.previousItem&&(U.previousItem.nextItem=U.nextItem),U.nextItem&&(U.nextItem.previousItem=U.previousItem)}class YU extends K{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(U){this._startDirectionFunction!==U&&(this._startDirectionFunction=U,this._directionProcessing.process=U?DU:TU)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(U){this._startPositionFunction!==U&&(this._startPositionFunction=U,this._positionCreation.process=U?hU:xU)}set onDispose(U){this._onDisposeObserver&&this.aE.remove(this._onDisposeObserver),this._onDisposeObserver=this.aE.add(U)}get t(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(U){this._useRampGradients!==U&&(this._useRampGradients=U,this._resetEffect(),U?(this._rampCreation={process:qU,previousItem:null,nextItem:null},sU(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:aU,previousItem:null,nextItem:null},sU(this._remapGradientProcessing,this._gravityProcessing)):(AU(this._rampCreation),AU(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(U){this._isLocal!==U&&(this._isLocal=U,U?(this._isLocalCreation={process:NU,previousItem:null,nextItem:null},sU(this._isLocalCreation,this._positionCreation)):AU(this._isLocalCreation))}get particles(){return this.uD}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U,U?(this._sheetCreation={process:MU,previousItem:null,nextItem:null},sU(this._sheetCreation,this._colorCreation)):AU(this._sheetCreation),this._reset())}getActiveCount(){return this.uD.length}getClassName(){return"py"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var U,G;let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(U=null===(G=this._customWrappers[C])||void 0===G?void 0:G.effect)&&void 0!==U?U:this._customWrappers[0].effect}_getCustomDrawWrapper(){var U;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(U=this._customWrappers[G])&&void 0!==U?U:this._customWrappers[0]}setCustomEffect(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[G]=new GU.e(this._engine),this._customWrappers[G].effect=U,this._customWrappers[G].drawContext&&(this._customWrappers[G].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){if(this.noiseTexture!==U){if(this._noiseTexture=U,!U)return AU(this._noiseCreation),void AU(this._noiseProcessing);this._noiseCreation={process:SU,previousItem:null,nextItem:null},sU(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:vU,previousItem:null,nextItem:null},sU(this._noiseProcessing,this._positionProcessing)}}constructor(U,G,C){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(U),this._emitterInverseWorldMatrix=L.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new L.pG,this.aE=new f.e,this.onStoppedObservable=new f.e,this.onStartedObservable=new f.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.uD=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new t.JE(0,0,0,0),this._colorDiff=new t.JE(0,0,0,0),this._scaledDirection=L.pG.Zero(),this._scaledGravity=L.pG.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=U=>{},this.recycleParticle=U=>{const G=this.uD.pop();G!==U&&G.copyTo(U),this._stockParticles.push(G)},this._createParticle=()=>{let U;return 0!==this._stockParticles.length?(U=this._stockParticles.pop(),U._reset()):U=new UU(this),this._prepareParticle(U),U},this.paused=!1,this._shadersLoaded=!1,this._capacity=G,this._epsilon=E,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=L.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||J.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SD.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nU,previousItem:null,nextItem:null},this._positionCreation={process:xU,previousItem:null,nextItem:null},sU(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:TU,previousItem:null,nextItem:null},sU(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:QU,previousItem:null,nextItem:null},sU(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:dU,previousItem:null,nextItem:null},sU(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:mG,previousItem:null,nextItem:null},sU(this._angleCreation,this._sizeCreation),this._colorCreation={process:lU,previousItem:null,nextItem:null},sU(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,K||(this._colorProcessing={process:KU,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:OU,previousItem:null,nextItem:null},sU(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:HU,previousItem:null,nextItem:null},sU(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:bU,previousItem:null,nextItem:null},sU(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:uU,previousItem:null,nextItem:null},sU(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=l,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new GU.e(this._engine)},this._customWrappers[0].effect=X,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new T,this.updateFunction=U=>{var G;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(G=this.noiseTexture.getContent())||void 0===G||G.then((U=>{this._noiseTextureData=U})));const C=U===this.uD;for(let L=0;L<U.length;L++){const G=U[L];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const X=G.age;if(G.age+=this._tempScaledUpdateSpeed,G.age>G.lifeTime){const U=G.age-X,C=G.lifeTime-X;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/U,G.age=G.lifeTime}this._ratio=G.age/G.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let l=this._updateQueueStart;for(;l;)l.process(G,this),l=l.nextItem;if(this._isAnimationSheetEnabled&&!K&&G.updateCellIndex(),G._inheritParticleInfoToSubEmitters(),G.age>=G.lifeTime){if(this._emitFromParticle(G),G._attachedSubEmitters){for(const U of G._attachedSubEmitters)U.particleSystem.disposeOnStop=!0,U.particleSystem.stop();G._attachedSubEmitters=null}this.recycleParticle(G),C&&L--}else;}}}serialize(U){throw new Error("Method not implemented.")}clone(U,G){throw new Error("Method not implemented.")}_addFactorGradient(U,G,C,L){const X=new R(G,C,L);U.push(X),U.sort(((U,G)=>U.gradient<G.gradient?-1:U.gradient>G.gradient?1:0))}_removeFactorGradient(U,G){if(!U)return;let C=0;for(const L of U){if(L.gradient===G){U.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=kU:this._lifeTimeCreation.process=nU}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ZU,previousItem:null,nextItem:null},sU(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(AU(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this.targetStopDuration!==U&&(this._targetStopDuration=U,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(U,G,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,U,G,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(U){return this._removeFactorGradient(this._lifeTimeGradients,U),this._syncLifeTimeCreation(),this}addSizeGradient(U,G,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=gU,this._sizeGradientProcessing={process:FU,previousItem:null,nextItem:null},zU(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,U,G,C),this}removeSizeGradient(U){var G;return this._removeFactorGradient(this._sizeGradients,U),0===(null===(G=this._sizeGradients)||void 0===G?void 0:G.length)&&(AU(this._sizeGradientProcessing),this._sizeCreation.process=dU),this}addColorRemapGradient(U,G,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,U,G,C),this}removeColorRemapGradient(U){return this._removeFactorGradient(this._colorRemapGradients,U),this}addAlphaRemapGradient(U,G,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,U,G,C),this}removeAlphaRemapGradient(U){return this._removeFactorGradient(this._alphaRemapGradients,U),this}addAngularSpeedGradient(U,G,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=BU,this._angularSpeedGradientProcessing={process:PU,previousItem:null,nextItem:null},zU(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,U,G,C),this}removeAngularSpeedGradient(U){var G;return this._removeFactorGradient(this._angularSpeedGradients,U),0===(null===(G=this._angularSpeedGradients)||void 0===G?void 0:G.length)&&(this._angleCreation.process=mG,AU(this._angularSpeedGradientProcessing)),this}addVelocityGradient(U,G,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:yU,previousItem:null,nextItem:null},sU(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:pU,previousItem:null,nextItem:null},zU(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,U,G,C),this}removeVelocityGradient(U){var G;return this._removeFactorGradient(this._velocityGradients,U),0===(null===(G=this._velocityGradients)||void 0===G?void 0:G.length)&&(AU(this._velocityCreation),AU(this._velocityGradientProcessing)),this}addLimitVelocityGradient(U,G,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:VU,previousItem:null,nextItem:null},sU(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:IU,previousItem:null,nextItem:null},sU(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,U,G,C),this}removeLimitVelocityGradient(U){var G;return this._removeFactorGradient(this._limitVelocityGradients,U),0===(null===(G=this._limitVelocityGradients)||void 0===G?void 0:G.length)&&(AU(this._limitVelocityCreation),AU(this._limitVelocityGradientProcessing)),this}addDragGradient(U,G,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:oU,previousItem:null,nextItem:null},zU(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:wU,previousItem:null,nextItem:null},zU(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,U,G,C),this}removeDragGradient(U){var G;return this._removeFactorGradient(this._dragGradients,U),0===(null===(G=this._dragGradients)||void 0===G?void 0:G.length)&&(AU(this._dragCreation),AU(this._dragGradientProcessing)),this}addEmitRateGradient(U,G,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,U,G,C),this}removeEmitRateGradient(U){return this._removeFactorGradient(this._emitRateGradients,U),this}addStartSizeGradient(U,G,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,U,G,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(U){return this._removeFactorGradient(this._startSizeGradients,U),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const U=new Uint8Array(4*this._rawTextureWidth),G=t.TmpColors.hG[0];for(let C=0;C<this._rawTextureWidth;C++){const L=C/this._rawTextureWidth;W.GetCurrentGradient(L,this._rampGradients,((L,X,l)=>{t.hG.LerpToRef(L.color,X.color,l,G),U[4*C]=255*G.r,U[4*C+1]=255*G.g,U[4*C+2]=255*G.b,U[4*C+3]=255}))}this._rampGradientsTexture=r.b.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((U,G)=>U.gradient<G.gradient?-1:U.gradient>G.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(U,G){this._rampGradients||(this._rampGradients=[]);const C=new c(U,G);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(U){return this._removeGradientAndTexture(U,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(U,G,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=tU,this._colorProcessing.process=EU);const L=new i(U,G,C);return this._colorGradients.push(L),this._colorGradients.sort(((U,G)=>U.gradient<G.gradient?-1:U.gradient>G.gradient?1:0)),this}removeColorGradient(U){if(!this._colorGradients)return this;let G=0;for(const C of this._colorGradients){if(C.gradient===U){this._colorGradients.splice(G,1);break}G++}return 0===this._colorGradients.length&&(this._colorCreation.process=lU,this._colorProcessing.process=KU),this}resetDrawCache(){if(this._drawWrappers){for(const U of this._drawWrappers)if(U)for(const G of U)null===G||void 0===G||G.dispose();this._drawWrappers=[]}}_fetchR(U,G,C,L,X){return X[4*(((U=.5*Math.abs(U)+.5)*C%C|0)+((G=.5*Math.abs(G)+.5)*L%L|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const U=this._engine,G=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*G),this._vertexBuffer=new b.d(U,this._vertexData,!0,G);let C=0;const L=this._vertexBuffer.createVertexBuffer(b.e.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[b.e.PositionKind]=L,C+=3;const X=this._vertexBuffer.createVertexBuffer(b.e.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[b.e.ColorKind]=X,C+=4;const l=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=l,C+=1;const t=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=t,C+=2,this._isAnimationSheetEnabled){const U=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=U,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const U=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=U,C+=3}if(this._useRampGradients){const U=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=U,C+=4}let E;if(this._useInstancing){const G=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new b.d(U,G,!1,2),E=this._spriteBuffer.createVertexBuffer("offset",0,2)}else E=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=E,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const U=[],G=[];let C=0;for(let L=0;L<this._capacity;L++)U.push(C),U.push(C+1),U.push(C+2),U.push(C),U.push(C+2),U.push(C+3),G.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(U),this._linesIndexBuffer=this._engine.createIndexBuffer(G)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(U)setTimeout((()=>{this.start(0)}),U);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var G;-1!==(null===(G=this.LG)||void 0===G?void 0:G.getClassName().indexOf("Mesh"))&&this.LG.eE(!0);const U=this.noiseTexture;if(U&&U.onGeneratedObservable)U.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let G=0;G<this.preWarmCycles;G++)this.animate(!0),U.render()}))}));else for(let G=0;G<this.preWarmCycles;G++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(U))}_postStop(U){}reset(){this._stockParticles.length=0,this.uD.length=0}_appendParticleVertex(U,G,C,X){let l=U*this._vertexBufferSize;if(this._vertexData[l++]=G.position.x+this.AP.x,this._vertexData[l++]=G.position.y+this.AP.y,this._vertexData[l++]=G.position.z+this.AP.z,this._vertexData[l++]=G.color.r,this._vertexData[l++]=G.color.g,this._vertexData[l++]=G.color.b,this._vertexData[l++]=G.color.a,this._vertexData[l++]=G.angle,this._vertexData[l++]=G.scale.x*G.size,this._vertexData[l++]=G.scale.y*G.size,this._isAnimationSheetEnabled&&(this._vertexData[l++]=G.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[l++]=G.direction.x,this._vertexData[l++]=G.direction.y,this._vertexData[l++]=G.direction.z);else if(G._initialDirection){let U=G._initialDirection;this.isLocal&&(L.pG.TransformNormalToRef(U,this._emitterWorldMatrix,L.TmpVectors.pG[0]),U=L.TmpVectors.pG[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[l++]=U.x,this._vertexData[l++]=U.y,this._vertexData[l++]=U.z}else{let U=G.direction;this.isLocal&&(L.pG.TransformNormalToRef(U,this._emitterWorldMatrix,L.TmpVectors.pG[0]),U=L.TmpVectors.pG[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[l++]=U.x,this._vertexData[l++]=U.y,this._vertexData[l++]=U.z}this._useRampGradients&&G.remapData&&(this._vertexData[l++]=G.remapData.x,this._vertexData[l++]=G.remapData.y,this._vertexData[l++]=G.remapData.z,this._vertexData[l++]=G.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===X?X=this._epsilon:1===X&&(X=1-this._epsilon)),this._vertexData[l++]=C,this._vertexData[l++]=X)}_prepareParticle(U){}_createNewOnes(U){let G;for(let C=0;C<U&&this.uD.length!==this._capacity;C++){G=this._createParticle(),this.uD.push(G);let U=this._createQueueStart;for(;U;)U.process(G,this),U=U.nextItem;G._inheritParticleInfoToSubEmitters()}}_update(U){if(this._alive=this.uD.length>0,this.LG.position){const U=this.LG;this._emitterWorldMatrix=U.getWorldMatrix()}else{const U=this.LG;this._emitterWorldMatrix=L.Matrix.Translation(U.x,U.y,U.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.uD),this._createNewOnes(U)}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const L=[b.e.PositionKind,b.e.ColorKind,"angle","offset","size"];return U&&L.push("cellIndex"),G||L.push("direction"),C&&L.push("remapData"),L}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const L=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,CU.b)(L),U&&L.push("particlesInfos"),G&&L.push("logarithmicDepthConstant"),C&&(L.push("vFogInfos"),L.push("vFogColor")),L}fillDefines(U,G){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,CU.g)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&U.push("#define FOG")),this._isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),G===K.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&U.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case 2:U.push("#define BILLBOARDY");break;case 8:case 9:U.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&U.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:U.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,G,C){G.push(...YU._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),U.push(...YU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,XU.c)(U,this._imageProcessingConfigurationDefines),(0,XU.b)(C,this._imageProcessingConfigurationDefines))}_getWrapper(U){const G=this._getCustomDrawWrapper(U);if(null!==G&&void 0!==G&&G.effect)return G;const C=[];this.fillDefines(C,U);const L=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let X=this._drawWrappers[L];X||(X=this._drawWrappers[L]=[]);let l=X[U];l||(l=new GU.e(this._engine),l.drawContext&&(l.drawContext.useInstancing=this._useInstancing),X[U]=l);const t=C.join("\n");if(l.defines!==t){const U=[],G=[],C=[];this.fillUniformsAttributesAndSamplerNames(G,U,C),l.setEffect(this._engine.createEffect("particles",U,G,C,t,void 0,void 0,void 0,void 0,this._shaderLanguage),t)}return l}animate(){var U;let G,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this.manualEmitCount>-1)G=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let U=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const G=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(G,this._emitRateGradients,((G,C,L)=>{G!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=G),U=(0,P.Lerp)(this._currentEmitRate1,this._currentEmitRate2,L)}))}G=U*this._scaledUpdateSpeed|0,this._newPartsExcess+=U*this._scaledUpdateSpeed-G}if(this._newPartsExcess>1&&(G+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?G=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(G),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let U=0;for(let G=0;G<this.uD.length;G++){const C=this.uD[G];this._appendParticleVertices(U,C),U+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.uD.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(U,G){this._appendParticleVertex(U++,G,0,0),this._useInstancing||(this._appendParticleVertex(U++,G,1,0),this._appendParticleVertex(U++,G,1,1),this._appendParticleVertex(U++,G,0,1))}rebuild(){var U;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(U=this._spriteBuffer)||void 0===U||U._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!YU.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,13912)),Promise.resolve().then(C.bind(C,13869))])):await Promise.all([Promise.resolve().then(C.bind(C,13859)),Promise.resolve().then(C.bind(C,13852))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.LG||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==K.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(K.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(K.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(U){var G,C;const X=this._getWrapper(U),l=X.effect,t=this._engine;t.enableEffect(X);const E=null!==(G=this.defaultViewMatrix)&&void 0!==G?G:this._scene.getViewMatrix();if(l.setTexture("diffuseSampler",this.particleTexture),l.setMatrix("view",E),l.setMatrix("projection",null!==(C=this.defaultProjectionMatrix)&&void 0!==C?C:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();l.setFloat3("particlesInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,this.spriteCellWidth/U.width)}if(l.setVector2("translationPivot",this.translationPivot),l.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;l.setVector3("eyePosition",U.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),l.setTexture("rampSampler",this._rampGradientsTexture));const K=l.defines;var P,O,T,D,y,V;(this._scene&&((0,CU.e)(l,this,this._scene),this.applyFog&&(0,LU.h)(this._scene,void 0,l)),K.indexOf("#define BILLBOARDMODE_ALL")>=0&&(E.invertToRef(L.TmpVectors.Matrix[0]),l.setMatrix("invView",L.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?t.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,l):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,l)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?t.bindBuffers(this._vertexBuffers,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBuffer:this._indexBuffer,l):t.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBufferUseInstancing:null,l);(this.useLogarithmicDepth&&this._scene&&(0,LU.m)(K,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),this._setEngineBasedOnBlendMode(U),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?t.drawElementsType(6,0,10,this.uD.length):t.drawArraysType(7,0,4,this.uD.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?t.drawElementsType(1,0,10*this.uD.length):t.drawElementsType(0,0,6*this.uD.length);return this.uD.length}render(){if(!this.isReady()||!this.uD.length)return 0;const U=this._engine;U.setState&&(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0));let G=0;return G=this.blendMode===K.BLENDMODE_MULTIPLYADD?this._render(K.BLENDMODE_MULTIPLY)+this._render(K.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),G}_onDispose(){}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(G,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const U=this._scene.SD.indexOf(this);U>-1&&this._scene.SD.splice(U,1),this._scene._activeParticleSystems.dispose()}this.aE.notifyObservers(this),this.aE.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}YU.ForceGLSL=!1;var eU,iU=C(12747);!function(U){U[U.ATTACHED=0]="ATTACHED",U[U.END=1]="END"}(eU||(eU={}));class cU{constructor(U){if(this.particleSystem=U,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!U.LG||!U.LG.dispose){const G=(0,E.c)("BABYLON.AbstractMesh");U.LG=new G("SubemitterSystemEmitter",U.wU()),U._disposeEmitterOnDispose=!0}}clone(){let U=this.particleSystem.LG;if(U){if(U instanceof L.pG)U=U.clone();else if(-1!==U.getClassName().indexOf("Mesh")){U=new((0,E.c)("BABYLON.Mesh"))("",U.wU()),U.isVisible=!1}}else U=new L.pG;const G=new cU(this.particleSystem.clone(this.particleSystem.name,U));return G.particleSystem.name+="Clone",G.type=this.type,G.inheritDirection=this.inheritDirection,G.inheritedVelocityAmount=this.inheritedVelocityAmount,G.particleSystem._disposeEmitterOnDispose=!0,G.particleSystem.disposeOnStop=!0,G}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={};return G.type=this.type,G.inheritDirection=this.inheritDirection,G.inheritedVelocityAmount=this.inheritedVelocityAmount,G.particleSystem=this.particleSystem.serialize(U),G}static _ParseParticleSystem(U,G,C){throw(0,iU.d)("ParseParticle")}static Parse(U,G,C){const L=U.particleSystem,X=new cU(cU._ParseParticleSystem(L,G,C,!0));return X.type=U.type,X.inheritDirection=U.inheritDirection,X.inheritedVelocityAmount=U.inheritedVelocityAmount,X.particleSystem._isSubEmitter=!0,X}dispose(){this.particleSystem.dispose()}}var RU=C(12800);function WU(U,G){const C=new H;return C.direction1=U,C.direction2=G,C}function fU(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function rU(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function JU(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new L.pG(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0);return new h(U,G,C)}function UG(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function GG(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0),l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new L.pG(0,1,0);return new p(U,G,C,X,l)}function CG(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new D(U,G)}function LG(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0),X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0);return new y(U,G,C,X)}const XG=L.pG.Zero(),lG=L.pG.Zero(),tG=L.pG.Zero();class EG{constructor(){this.strength=0,this.position=L.pG.Zero()}_processParticle(U,G){this.position.subtractToRef(U.position,XG);const C=XG.lengthSquared()+1;XG.normalize().scaleToRef(this.strength/C,lG),lG.scaleToRef(G._tempScaledUpdateSpeed,tG),U.direction.addInPlace(tG)}serialize(){return{position:this.position.sE(),strength:this.strength}}}class KG extends YU{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=U=>{if(!this._subEmitters||0===this._subEmitters.length)return;const G=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[G])if(1===C.type){const G=C.clone();U._inheritParticleInfoToSubEmitter(G),G.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(G.particleSystem),G.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(U,G){const C=WU(U,G);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U,this._flowMapUpdate&&(AU(this._flowMapUpdate),this._flowMapUpdate=null),U&&(this._flowMapUpdate={process:U=>{var G;const C=null===(G=this.wU())||void 0===G?void 0:G.getTransformMatrix();this._flowMap._processParticle(U,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},sU(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(U){this._attractors.push(U),1===this._attractors.length&&(this._attractorUpdate={process:U=>{for(const G of this._attractors)G._processParticle(U,this)},previousItem:null,nextItem:null},sU(this._attractorUpdate,this._directionProcessing))}removeAttractor(U){const G=this._attractors.indexOf(U);-1!==G&&this._attractors.splice(G,1),0===this._attractors.length&&AU(this._attractorUpdate)}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(U)}createHemisphericEmitter(){const U=fU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=rU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=JU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new L.pG(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=UG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=GG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new L.pG(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=CG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=LG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,G,C,L){const X=new T;return this.particleEmitterType=X,this.direction1=U,this.direction2=G,this.minEmitBox=C,this.maxEmitBox=L,X}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const U of this.subEmitters)U instanceof KG?this._subEmitters.push([new cU(U)]):U instanceof cU?this._subEmitters.push([U]):U instanceof Array&&this._subEmitters.push(U)}_stopSubEmitters(){if(this.activeSubSystems){for(const U of this.activeSubSystems)U.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const U=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==U&&this._rootParticleSystem.activeSubSystems.splice(U,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(U){U&&this._stopSubEmitters()}_prepareParticle(U){if(this._subEmitters&&this._subEmitters.length>0){const G=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];U._attachedSubEmitters=[];for(const C of G)if(0===C.type){const G=C.clone();U._attachedSubEmitters.push(G),G.particleSystem.start()}}}_onDispose(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),U&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let U=C._attachedSubEmitters.length-1;U>=0;U-=1)C._attachedSubEmitters[U].dispose();if(G&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let U=0;U<this._subEmitters.length;U++)for(const G of this._subEmitters[U])G.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.LG&&this.LG.dispose&&this.LG.dispose(!0)}static _Parse(U,G,C,X){var l,K,P;let O;O=C instanceof RU.b?null:C;const b=(0,E.c)("BABYLON.Texture");if(b&&O&&(U.texture?G.particleTexture=b.Parse(U.texture,O,X):U.textureName&&(G.particleTexture=new b(X+U.textureName,O,!1,void 0===U.invertY||U.invertY),G.particleTexture.name=U.textureName)),U.emitterId||0===U.emitterId||void 0!==U.LG?U.emitterId&&O?G.LG=O.getLastMeshById(U.emitterId):G.LG=L.pG.NG(U.LG):G.LG=L.pG.Zero(),G.isLocal=!!U.isLocal,void 0!==U.renderingGroupId&&(G.renderingGroupId=U.renderingGroupId),void 0!==U.isBillboardBased&&(G.isBillboardBased=U.isBillboardBased),void 0!==U.billboardMode&&(G.billboardMode=U.billboardMode),void 0!==U.useLogarithmicDepth&&(G.useLogarithmicDepth=U.useLogarithmicDepth),U.animations){for(let C=0;C<U.animations.length;C++){const L=U.animations[C],X=(0,E.c)("BABYLON.Animation");X&&G.animations.push(X.Parse(L))}G.beginAnimationOnStart=U.beginAnimationOnStart,G.beginAnimationFrom=U.beginAnimationFrom,G.beginAnimationTo=U.beginAnimationTo,G.beginAnimationLoop=U.beginAnimationLoop}if(U.autoAnimate&&O&&O.beginAnimation(G,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1),G.startDelay=0|U.startDelay,G.minAngularSpeed=U.minAngularSpeed,G.maxAngularSpeed=U.maxAngularSpeed,G.minSize=U.minSize,G.maxSize=U.maxSize,U.minScaleX&&(G.minScaleX=U.minScaleX,G.maxScaleX=U.maxScaleX,G.minScaleY=U.minScaleY,G.maxScaleY=U.maxScaleY),void 0!==U.preWarmCycles&&(G.preWarmCycles=U.preWarmCycles,G.preWarmStepOffset=U.preWarmStepOffset),void 0!==U.minInitialRotation&&(G.minInitialRotation=U.minInitialRotation,G.maxInitialRotation=U.maxInitialRotation),G.minLifeTime=U.minLifeTime,G.maxLifeTime=U.maxLifeTime,G.minEmitPower=U.minEmitPower,G.maxEmitPower=U.maxEmitPower,G.emitRate=U.emitRate,G.gravity=L.pG.NG(U.gravity),U.noiseStrength&&(G.noiseStrength=L.pG.NG(U.noiseStrength)),G.color1=t.JE.NG(U.color1),G.color2=t.JE.NG(U.color2),G.colorDead=t.JE.NG(U.colorDead),G.updateSpeed=U.updateSpeed,G.targetStopDuration=U.targetStopDuration,G.blendMode=U.blendMode,U.colorGradients)for(const L of U.colorGradients)G.addColorGradient(L.gradient,t.JE.NG(L.color1),L.color2?t.JE.NG(L.color2):void 0);if(U.rampGradients){for(const C of U.rampGradients)G.addRampGradient(C.gradient,t.hG.NG(C.color));G.useRampGradients=U.useRampGradients}if(U.colorRemapGradients)for(const L of U.colorRemapGradients)G.addColorRemapGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.alphaRemapGradients)for(const L of U.alphaRemapGradients)G.addAlphaRemapGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.sizeGradients)for(const L of U.sizeGradients)G.addSizeGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.angularSpeedGradients)for(const L of U.angularSpeedGradients)G.addAngularSpeedGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.velocityGradients)for(const L of U.velocityGradients)G.addVelocityGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.dragGradients)for(const L of U.dragGradients)G.addDragGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.emitRateGradients)for(const L of U.emitRateGradients)G.addEmitRateGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.startSizeGradients)for(const L of U.startSizeGradients)G.addStartSizeGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.lifeTimeGradients)for(const L of U.lifeTimeGradients)G.addLifeTimeGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);if(U.limitVelocityGradients){for(const C of U.limitVelocityGradients)G.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);G.limitVelocityDamping=U.limitVelocityDamping}if(U.noiseTexture&&O){const C=(0,E.c)("BABYLON.ProceduralTexture");G.noiseTexture=C.Parse(U.noiseTexture,O,X)}let w;if(U.particleEmitterType){switch(U.particleEmitterType.type){case"SphereParticleEmitter":w=new x;break;case"SphereDirectedParticleEmitter":w=new h;break;case"ConeEmitter":case"ConeParticleEmitter":w=new D;break;case"ConeDirectedParticleEmitter":w=new y;break;case"CylinderParticleEmitter":w=new V;break;case"CylinderDirectedParticleEmitter":w=new p;break;case"HemisphericParticleEmitter":w=new I;break;case"PointParticleEmitter":w=new H;break;case"MeshParticleEmitter":w=new o;break;case"CustomParticleEmitter":w=new N;break;default:w=new T}w.parse(U.particleEmitterType,O)}else w=new T,w.parse(U,O);G.particleEmitterType=w,G.startSpriteCellID=U.startSpriteCellID,G.endSpriteCellID=U.endSpriteCellID,G.spriteCellLoop=null===(l=U.spriteCellLoop)||void 0===l||l,G.spriteCellWidth=U.spriteCellWidth,G.spriteCellHeight=U.spriteCellHeight,G.spriteCellChangeSpeed=U.spriteCellChangeSpeed,G.spriteRandomStartCell=U.spriteRandomStartCell,G.disposeOnStop=null!==(K=U.disposeOnStop)&&void 0!==K&&K,G.manualEmitCount=null!==(P=U.manualEmitCount)&&void 0!==P?P:-1}static Parse(U,G,C){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0;const E=U.name;let K,P,O=null,T=null;if(G instanceof RU.b?K=G:(P=G,K=P.getEngine()),U.customShader&&K.createEffectForParticles){T=U.customShader;const G=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"";O=K.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,G)}const D=new KG(E,l||U.SG,G,O,U.isAnimationSheetEnabled);if(D.customShader=T,D._rootUrl=C,U.id&&(D.id=U.id),U.subEmitters){D.subEmitters=[];for(const L of U.subEmitters){const U=[];for(const X of L)U.push(cU.Parse(X,G,C));D.subEmitters.push(U)}}if(U.attractors)for(const t of U.attractors){const U=new EG;U.position=L.pG.NG(t.position),U.strength=t.strength,D.addAttractor(U)}return KG._Parse(U,D,G,C),U.textureMask&&(D.textureMask=t.JE.NG(U.textureMask)),U.AP&&(D.AP=L.pG.NG(U.AP)),U.preventAutoStart&&(D.preventAutoStart=U.preventAutoStart),X||D.preventAutoStart||D.start(),D}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={};if(KG._Serialize(G,this,U),G.textureMask=this.textureMask.sE(),G.customShader=this.customShader,G.preventAutoStart=this.preventAutoStart,G.AP=this.AP.sE(),this.subEmitters){G.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const L=[];for(const G of C)L.push(G.serialize(U));G.subEmitters.push(L)}}if(this._attractors&&this._attractors.length){G.attractors=[];for(const U of this._attractors)G.attractors.push(U.serialize())}return G}static _Serialize(U,G,C){if(U.name=G.name,U.id=G.id,U.SG=G.getCapacity(),U.disposeOnStop=G.disposeOnStop,U.manualEmitCount=G.manualEmitCount,G.LG.position){const C=G.LG;U.emitterId=C.id}else{const C=G.LG;U.LG=C.sE()}G.particleEmitterType&&(U.particleEmitterType=G.particleEmitterType.serialize()),G.particleTexture&&(C?U.texture=G.particleTexture.serialize():(U.textureName=G.particleTexture.name,U.invertY=!!G.particleTexture._invertY)),U.isLocal=G.isLocal,k.c.AppendSerializedAnimations(G,U),U.beginAnimationOnStart=G.beginAnimationOnStart,U.beginAnimationFrom=G.beginAnimationFrom,U.beginAnimationTo=G.beginAnimationTo,U.beginAnimationLoop=G.beginAnimationLoop,U.startDelay=G.startDelay,U.renderingGroupId=G.renderingGroupId,U.isBillboardBased=G.isBillboardBased,U.billboardMode=G.billboardMode,U.minAngularSpeed=G.minAngularSpeed,U.maxAngularSpeed=G.maxAngularSpeed,U.minSize=G.minSize,U.maxSize=G.maxSize,U.minScaleX=G.minScaleX,U.maxScaleX=G.maxScaleX,U.minScaleY=G.minScaleY,U.maxScaleY=G.maxScaleY,U.minEmitPower=G.minEmitPower,U.maxEmitPower=G.maxEmitPower,U.minLifeTime=G.minLifeTime,U.maxLifeTime=G.maxLifeTime,U.emitRate=G.emitRate,U.gravity=G.gravity.sE(),U.noiseStrength=G.noiseStrength.sE(),U.color1=G.color1.sE(),U.color2=G.color2.sE(),U.colorDead=G.colorDead.sE(),U.updateSpeed=G.updateSpeed,U.targetStopDuration=G.targetStopDuration,U.blendMode=G.blendMode,U.preWarmCycles=G.preWarmCycles,U.preWarmStepOffset=G.preWarmStepOffset,U.minInitialRotation=G.minInitialRotation,U.maxInitialRotation=G.maxInitialRotation,U.startSpriteCellID=G.startSpriteCellID,U.spriteCellLoop=G.spriteCellLoop,U.endSpriteCellID=G.endSpriteCellID,U.spriteCellChangeSpeed=G.spriteCellChangeSpeed,U.spriteCellWidth=G.spriteCellWidth,U.spriteCellHeight=G.spriteCellHeight,U.spriteRandomStartCell=G.spriteRandomStartCell,U.isAnimationSheetEnabled=G.isAnimationSheetEnabled,U.useLogarithmicDepth=G.useLogarithmicDepth;const L=G.getColorGradients();if(L){U.colorGradients=[];for(const G of L){const C={gradient:G.gradient,color1:G.color1.sE()};G.color2?C.color2=G.color2.sE():C.color2=G.color1.sE(),U.colorGradients.push(C)}}const X=G.getRampGradients();if(X){U.rampGradients=[];for(const G of X){const C={gradient:G.gradient,color:G.color.sE()};U.rampGradients.push(C)}U.useRampGradients=G.useRampGradients}const l=G.getColorRemapGradients();if(l){U.colorRemapGradients=[];for(const G of l){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.colorRemapGradients.push(C)}}const t=G.getAlphaRemapGradients();if(t){U.alphaRemapGradients=[];for(const G of t){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.alphaRemapGradients.push(C)}}const E=G.getSizeGradients();if(E){U.sizeGradients=[];for(const G of E){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.sizeGradients.push(C)}}const K=G.getAngularSpeedGradients();if(K){U.angularSpeedGradients=[];for(const G of K){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.angularSpeedGradients.push(C)}}const P=G.getVelocityGradients();if(P){U.velocityGradients=[];for(const G of P){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.velocityGradients.push(C)}}const O=G.getDragGradients();if(O){U.dragGradients=[];for(const G of O){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.dragGradients.push(C)}}const T=G.getEmitRateGradients();if(T){U.emitRateGradients=[];for(const G of T){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.emitRateGradients.push(C)}}const D=G.getStartSizeGradients();if(D){U.startSizeGradients=[];for(const G of D){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.startSizeGradients.push(C)}}const y=G.getLifeTimeGradients();if(y){U.lifeTimeGradients=[];for(const G of y){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.lifeTimeGradients.push(C)}}const V=G.getLimitVelocityGradients();if(V){U.limitVelocityGradients=[];for(const G of V){const C={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?C.factor2=G.factor2:C.factor2=G.factor1,U.limitVelocityGradients.push(C)}U.limitVelocityDamping=G.limitVelocityDamping}G.noiseTexture&&(U.noiseTexture=G.noiseTexture.serialize())}clone(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const L=(0,F.b)({},this._customWrappers);let X=null;const l=this._engine;if(l.createEffectForParticles&&null!=this.customShader){X=this.customShader;const U=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",G=l.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,U);L[0]?L[0].effect=G:this.setCustomEffect(G,0)}const t=this.serialize(C),E=KG.Parse(t,this._scene||this._engine,this._rootUrl);return E.name=U,E.customShader=X,E._customWrappers=L,void 0===G&&(G=this.LG),this.noiseTexture&&(E.noiseTexture=this.noiseTexture.clone()),E.LG=G,this.preventAutoStart||E.start(),E}}KG.BILLBOARDMODE_Y=2,KG.BILLBOARDMODE_ALL=7,KG.BILLBOARDMODE_STRETCHED=8,KG.BILLBOARDMODE_STRETCHED_LOCAL=9,cU._ParseParticleSystem=KG.Parse;var PG=C(13103),OG=C(13097),TG=C(13014);TG.d.prototype.createTransformFeedback=function(){const U=this._gl.createTransformFeedback();if(!U)throw new Error("Unable to create Transform Feedback");return U},TG.d.prototype.deleteTransformFeedback=function(U){this._gl.deleteTransformFeedback(U)},TG.d.prototype.bindTransformFeedback=function(U){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,U)},TG.d.prototype.beginTransformFeedback=function(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(U?this._gl.POINTS:this._gl.TRIANGLES)},TG.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},TG.d.prototype.setTranformFeedbackVaryings=function(U,G){this._gl.transformFeedbackVaryings(U,G,this._gl.INTERLEAVED_ATTRIBS)},TG.d.prototype.bindTransformFeedbackBuffer=function(U){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U?U.underlyingResource:null)},TG.d.prototype.readTransformFeedbackBuffer=function(U){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U)};const DG="clipPlaneFragmentDeclaration2",yG="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[DG]||(S.d.IncludesShadersStore[DG]=yG);C(13760),C(13766),C(13769),C(13774),C(13783),C(13788),C(13793),C(13799);const VG="gpuRenderParticlesPixelShader",pG="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";S.d.ShadersStore[VG]||(S.d.ShadersStore[VG]=pG);const IG="clipPlaneVertexDeclaration2",HG="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[IG]||(S.d.IncludesShadersStore[IG]=HG);C(13807),C(13810),C(13812),C(13818);const xG="gpuRenderParticlesVertexShader",hG="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";S.d.ShadersStore[xG]||(S.d.ShadersStore[xG]=hG);class NG extends K{static get IsSupported(){if(!J.d.LastCreatedEngine)return!1;const U=J.d.LastCreatedEngine.getCaps();return U.supportTransformFeedbacks||U.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(U){this._maxActiveParticleCount=Math.min(U,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(U){this.maxActiveParticleCount=U}createPointEmitter(U,G){const C=WU(U,G);return this.particleEmitterType=C,C}createHemisphericEmitter(){const U=fU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=rU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=JU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new L.pG(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=UG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=GG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new L.pG(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=CG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=LG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.pG(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new L.pG(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,G,C,L){const X=new T;return this.particleEmitterType=X,this.direction1=U,this.direction2=G,this.minEmitBox=C,this.maxEmitBox=L,X}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U)}isReady(){if(!this.LG||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==KG.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(KG.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(KG.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";U?setTimeout((()=>{this.start(0)}),U):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var U,G;let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(U=null===(G=this._customWrappers[C])||void 0===G?void 0:G.effect)&&void 0!==U?U:this._customWrappers[0].effect}_getCustomDrawWrapper(){var U;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(U=this._customWrappers[G])&&void 0!==U?U:this._customWrappers[0]}setCustomEffect(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[G]=new GU.e(this._engine),this._customWrappers[G].effect=U}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(U,G,C){return super._removeGradientAndTexture(U,G,C),this._releaseBuffers(),this}addColorGradient(U,G){this._colorGradients||(this._colorGradients=[]);const C=new i(U,G);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(U&&this._colorGradients.sort(((U,G)=>U.gradient<G.gradient?-1:U.gradient>G.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(U){return this._removeGradientAndTexture(U,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const G in this._drawWrappers){var U;null===(U=this._drawWrappers[G].drawContext)||void 0===U||U.reset()}}_addFactorGradient(U,G,C){const L=new R(G,C);U.push(L),this._releaseBuffers()}addSizeGradient(U,G){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,U,G),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(U){return this._removeGradientAndTexture(U,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(U,G){if(!U)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&U.sort(((U,G)=>U.gradient<G.gradient?-1:U.gradient>G.gradient?1:0));const C=this;C[G]&&(C[G].dispose(),C[G]=null)}addAngularSpeedGradient(U,G){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,U,G),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(U){return this._removeGradientAndTexture(U,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(U,G){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,U,G),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(U){return this._removeGradientAndTexture(U,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(U,G){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,U,G),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(U){return this._removeGradientAndTexture(U,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(U,G){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,U,G),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(U){return this._removeGradientAndTexture(U,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(U){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(U,G,C){var X;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(U),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.aE=new f.e,this.onStoppedObservable=new f.e,this.onStartedObservable=new f.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=L.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||J.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SD.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,E.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,E.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,E.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,E.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new GU.e(this._engine)},this._customWrappers[0].effect=l,this._drawWrappers={0:new GU.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(G=null!==(X=G)&&void 0!==X?X:{}).randomTextureSize||delete G.randomTextureSize;const K=(0,F.b)({SG:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize},G),P=G;isFinite(P)&&(K.SG=P),this._capacity=K.SG,this._maxActiveParticleCount=K.SG,this._currentActiveCount=0,this._isAnimationSheetEnabled=t,this.particleEmitterType=new T;const O=Math.min(this._engine.getCaps().maxTextureSize,K.randomTextureSize);let D=[];for(let L=0;L<O;++L)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture=new r.b(new Float32Array(D),O,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,D=[];for(let L=0;L<O;++L)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture2=new r.b(new Float32Array(D),O,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=O}_reset(){this._releaseBuffers()}_createVertexBuffers(U,G,C){const L={};L.position=G.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let X=3;L.age=G.createVertexBuffer("age",X,1,this._attributesStrideSize,!0),X+=1,L.size=G.createVertexBuffer("size",X,3,this._attributesStrideSize,!0),X+=3,L.life=G.createVertexBuffer("life",X,1,this._attributesStrideSize,!0),X+=1,X+=4,this.billboardMode===KG.BILLBOARDMODE_STRETCHED&&(L.direction=G.createVertexBuffer("direction",X,3,this._attributesStrideSize,!0)),X+=3,this._platform.alignDataInBuffer&&(X+=1),this.particleEmitterType instanceof N&&(X+=3,this._platform.alignDataInBuffer&&(X+=1)),this._colorGradientsTexture||(L.color=G.createVertexBuffer("color",X,4,this._attributesStrideSize,!0),X+=4),this._isBillboardBased||(L.initialDirection=G.createVertexBuffer("initialDirection",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),this.noiseTexture&&(L.noiseCoordinates1=G.createVertexBuffer("noiseCoordinates1",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1),L.noiseCoordinates2=G.createVertexBuffer("noiseCoordinates2",X,3,this._attributesStrideSize,!0),X+=3,this._platform.alignDataInBuffer&&(X+=1)),L.angle=G.createVertexBuffer("angle",X,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?X++:X+=2,this._isAnimationSheetEnabled&&(L.cellIndex=G.createVertexBuffer("cellIndex",X,1,this._attributesStrideSize,!0),X+=1,this.spriteRandomStartCell&&(L.cellStartOffset=G.createVertexBuffer("cellStartOffset",X,1,this._attributesStrideSize,!0),X+=1)),L.offset=C.createVertexBuffer("offset",0,2),L.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(L),this._platform.createVertexBuffers(U,L),this.resetDrawCache()}_initialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!U)return;const G=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof N&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const X=this.particleEmitterType instanceof N,l=L.TmpVectors.pG[0];let t=0;for(let L=0;L<this._capacity;L++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),X?(this.particleEmitterType.particleDestinationGenerator(L,null,l),C.push(l.x),C.push(l.y),C.push(l.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),t+=16,X&&(this.particleEmitterType.particlePositionGenerator(L,null,l),C.push(l.x),C.push(l.y),C.push(l.z),this._platform.alignDataInBuffer&&C.push(0),t+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),t+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),t+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),t+=8),C.push(0),t+=1,this._angularSpeedGradientsTexture||(C.push(0),t+=1),this._isAnimationSheetEnabled&&(C.push(0),t+=1,this.spriteRandomStartCell&&(C.push(0),t+=1)),this._platform.alignDataInBuffer){let U=3-(t+3&3);for(t+=U;U-- >0;)C.push(0)}const E=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),K=this._platform.createParticleBuffer(C),P=this._platform.createParticleBuffer(C);this._buffer0=new b.d(G,K,!1,this._attributesStrideSize),this._buffer1=new b.d(G,P,!1,this._attributesStrideSize),this._spriteBuffer=new b.d(G,E,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let U=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(U+="\n#define BILLBOARD"),this._colorGradientsTexture&&(U+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(U+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(U+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(U+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(U+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(U+="\n#define DRAGGRADIENTS"),this._flowMap&&(U+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(U+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(U+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(U+="\n#define NOISE"),this.isLocal&&(U+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===U||(this._cachedUpdateDefines=U,this._updateBuffer=this._platform.createUpdateBuffer(U)),this._platform.isUpdateBufferReady()}_getWrapper(U){const G=this._getCustomDrawWrapper(U);if(null!==G&&void 0!==G&&G.effect)return G;const C=[];this.fillDefines(C,U);let L=this._drawWrappers[U];L||(L=new GU.e(this._engine),L.drawContext&&(L.drawContext.useInstancing=!0),this._drawWrappers[U]=L);const X=C.join("\n");if(L.defines!==X){const U=[],G=[],C=[];this.fillUniformsAttributesAndSamplerNames(G,U,C),L.setEffect(this._engine.createEffect("gpuRenderParticles",U,G,C,X),X)}return L}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const X=[b.e.PositionKind,"age","life","size","angle"];return U||X.push(b.e.ColorKind),G&&X.push("cellIndex"),C||X.push("initialDirection"),L&&X.push("direction"),X.push("offset",b.e.UVKind),X}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const L=["emitterWM","AP","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,CU.b)(L),U&&L.push("sheetInfos"),G&&L.push("logarithmicDepthConstant"),C&&(L.push("vFogInfos"),L.push("vFogColor")),L}fillDefines(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,CU.g)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==OG.e.FOGMODE_NONE&&U.push("#define FOG")),G===KG.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this.isLocal&&U.push("#define LOCAL"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case KG.BILLBOARDMODE_Y:U.push("#define BILLBOARDY");break;case KG.BILLBOARDMODE_STRETCHED:U.push("#define BILLBOARDSTRETCHED");break;case KG.BILLBOARDMODE_ALL:U.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&U.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,G,C){G.push(...NG._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===KG.BILLBOARDMODE_STRETCHED)),U.push(...NG._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(PG.d.PrepareUniforms(U,this._imageProcessingConfigurationDefines),PG.d.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var U;let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(G?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(U,G){const C=this[G];if(!U||!U.length||C)return;const L=new Float32Array(this._rawTextureWidth);for(let X=0;X<this._rawTextureWidth;X++){const G=X/this._rawTextureWidth;W.GetCurrentGradient(G,U,((U,G,C)=>{L[X]=(0,P.Lerp)(U.factor1,G.factor1,C)}))}this[G]=r.b.CreateRTexture(L,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[G].name=G.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const U=new Uint8Array(4*this._rawTextureWidth),G=t.TmpColors.JE[0];for(let C=0;C<this._rawTextureWidth;C++){const L=C/this._rawTextureWidth;W.GetCurrentGradient(L,this._colorGradients,((L,X,l)=>{t.JE.LerpToRef(L.color1,X.color1,l,G),U[4*C]=255*G.r,U[4*C+1]=255*G.g,U[4*C+2]=255*G.b,U[4*C+3]=255*G.a}))}this._colorGradientsTexture=r.b.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(U,G){var C,X,l,t,E;const K=this._getWrapper(U),P=K.effect;this._engine.enableEffect(K);const O=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||L.Matrix.IdentityReadOnly;if(P.setMatrix("view",O),P.setMatrix("projection",null!==(X=this.defaultProjectionMatrix)&&void 0!==X?X:this._scene.getProjectionMatrix()),P.setTexture("diffuseSampler",this.particleTexture),P.setVector2("translationPivot",this.translationPivot),P.setVector3("AP",this.AP),this.isLocal&&P.setMatrix("emitterWM",G),this._colorGradientsTexture?P.setTexture("colorGradientSampler",this._colorGradientsTexture):P.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();P.setFloat3("sheetInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,U.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;P.setVector3("eyePosition",U.globalPosition)}const T=P.defines;if(this._scene&&((0,CU.e)(P,this,this._scene),this.applyFog&&(0,LU.h)(this._scene,void 0,P)),T.indexOf("#define BILLBOARDMODE_ALL")>=0){const U=O.clone();U.invert(),P.setMatrix("invView",U)}return this.useLogarithmicDepth&&this._scene&&(0,LU.m)(T,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),this._setEngineBasedOnBlendMode(U),this._platform.bindDrawBuffers(this._targetIndex,P,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(E=this._scene)&&void 0!==E&&E.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(U){if(!this.LG||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!U)if(this.LG.position){U=this.LG.getWorldMatrix()}else{const G=this.LG;U=L.TmpVectors.Matrix[0],L.Matrix.TranslationToRef(G.x,G.y,G.z,U)}const G=this._engine,C=G.getDepthWrite();if(G.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const U=this.wU();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",U.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",U),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const X=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=X,G.setDepthWrite(C)}render(){let U,G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!G&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const U=0|this._accumulatedCount;this._accumulatedCount-=U,this._currentActiveCount+=U}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.LG.position){U=this.LG.getWorldMatrix()}else{const G=this.LG;U=L.TmpVectors.Matrix[0],L.Matrix.TranslationToRef(G.x,G.y,G.z,U)}const X=this._engine;this.updateInAnimate||this._update(U);let l=0;return G||C||(X.setState(!1),this.forceDepthWrite&&X.setDepthWrite(!0),l=this.blendMode===KG.BLENDMODE_MULTIPLYADD?this._render(KG.BLENDMODE_MULTIPLY,U)+this._render(KG.BLENDMODE_ADD,U):this._render(this.blendMode,U),this._engine.setAlphaMode(0)),l}rebuild(){const U=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(U,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,U()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const G in this._drawWrappers){this._drawWrappers[G].dispose()}if(this._drawWrappers={},this._scene){const U=this._scene.SD.indexOf(this);U>-1&&this._scene.SD.splice(U,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let G=0;G<this._renderVertexBuffers.length;++G){const U=this._renderVertexBuffers[G];for(const G in U)U[G].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.aE.notifyObservers(this),this.aE.clear()}clone(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const L=(0,F.b)({},this._customWrappers);let X=null;const l=this._engine;if(l.createEffectForParticles&&null!=this.customShader){X=this.customShader;const U=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";L[0]=l.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,U,void 0,void 0,void 0,this)}const t=this.serialize(C),E=NG.Parse(t,this._scene||this._engine,this._rootUrl);return E.name=U,E.customShader=X,E._customWrappers=L,void 0===G&&(G=this.LG),this.noiseTexture&&(E.noiseTexture=this.noiseTexture.clone()),E.LG=G,E}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={};return KG._Serialize(G,this,U),G.activeParticleCount=this.activeParticleCount,G.randomTextureSize=this._randomTextureSize,G.customShader=this.customShader,G}static Parse(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0;const l=U.name;let t,E;G instanceof RU.b?t=G:(E=G,t=E.getEngine());const K=new NG(l,{SG:X||U.SG,randomTextureSize:U.randomTextureSize},G,null,U.isAnimationSheetEnabled);if(K._rootUrl=C,U.customShader&&t.createEffectForParticles){const G=U.customShader,C=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"",L=t.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,C,void 0,void 0,void 0,K);K.setCustomEffect(L,0),K.customShader=G}return U.id&&(K.id=U.id),U.activeParticleCount&&(K.activeParticleCount=U.activeParticleCount),KG._Parse(U,K,G,C),U.preventAutoStart&&(K.preventAutoStart=U.preventAutoStart),L||K.preventAutoStart||K.start(),K}}var bG=C(12718),oG=C(13826),wG=C(13228);class SG{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(U){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const G of this.systems)G.LG=U;this._emitterNode=U}setEmitterAsSphere(U,G,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:U,renderingGroupId:G};const L=(0,oG.b)("emitterSphere",{diameter:U.diameter,segments:U.segments},C);L.renderingGroupId=G;const X=new wG.xG("emitterSphereMaterial",C);X.emissiveColor=U.color,L.material=X;for(const l of this.systems)l.LG=L;this._emitterNode=L}start(U){for(const G of this.systems)U&&(G.LG=U),G.start()}dispose(){for(const U of this.systems)U.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={systems:[]};for(const C of this.systems)G.systems.push(C.serialize(U));return this._emitterNode&&(G.LG=this._emitterCreationOptions),G}static Parse(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3?arguments[3]:void 0;const X=new SG,l=this.BaseAssetsUrl+"/textures/";G=G||J.d.LastCreatedScene;for(const t of U.systems)X.systems.push(C?NG.Parse(t,G,l,!0,L):KG.Parse(t,G,l,!0,L));if(U.LG){const C=U.LG.options;if("Sphere"===U.LG.kind)X.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:t.hG.NG(C.color)},U.LG.renderingGroupId,G)}return X}}SG.BaseAssetsUrl="https://assets.babylonjs.com/particles";var vG=C(12756);class uG{static CreateDefault(U){let G,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,L=arguments.length>2?arguments[2]:void 0;G=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new NG("default system",{SG:C},L):new KG("default system",C,L),G.LG=U;const X=bG.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return G.particleTexture=new n.c(X,G.wU()),G.createConeEmitter(.1,Math.PI/4),G.color1=new t.JE(1,1,1,1),G.color2=new t.JE(1,1,1,1),G.colorDead=new t.JE(1,1,1,0),G.minSize=.1,G.maxSize=.1,G.minEmitPower=2,G.maxEmitPower=2,G.updateSpeed=1/60,G.emitRate=30,G}static CreateAsync(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3?arguments[3]:void 0;G||(G=J.d.LastCreatedScene);const X={};return G.addPendingData(X),new Promise(((l,t)=>{if(C&&!NG.IsSupported)return G.removePendingData(X),t("Particle system with GPU is not supported.");bG.Tools.LoadFile("".concat(uG.BaseAssetsUrl,"/systems/").concat(U,".json"),(U=>{G.removePendingData(X);const t=JSON.parse(U.toString());return l(SG.Parse(t,G,C,L))}),void 0,void 0,void 0,(()=>(G.removePendingData(X),t("An error occurred with the creation of your particle system. Check if your type '".concat(U,"' exists.")))))}))}static ExportSet(U){const G=new SG;for(const C of U)G.systems.push(C);return G}static ParseFromFileAsync(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5?arguments[5]:void 0;return new Promise(((t,E)=>{const K=new vG.d;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const G=JSON.parse(K.responseText);let E;E=L?NG.Parse(G,C,X,!1,l):KG.Parse(G,C,X,!1,l),U&&(E.name=U),t(E)}else E("Unable to load the particle system")})),K.open("GET",G),K.send()}))}static ParseFromSnippetAsync(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",X=arguments.length>4?arguments[4]:void 0;if("_BLANK"===U){const U=this.CreateDefault(null);return U.start(),Promise.resolve(U)}return new Promise(((l,t)=>{const E=new vG.d;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const t=JSON.parse(JSON.parse(E.responseText).jsonPayload),K=JSON.parse(t.particleSystem);let P;P=C?NG.Parse(K,G,L,!1,X):KG.Parse(K,G,L,!1,X),P.snippetId=U,l(P)}else t("Unable to load the snippet "+U)})),E.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),E.send()}))}}uG.BaseAssetsUrl=SG.BaseAssetsUrl,uG.SnippetUrl="https://snippet.babylonjs.com",uG.CreateFromSnippetAsync=uG.ParseFromSnippetAsync;var dG=C(13306),gG=C(13128),ZG=C(13834);(0,ZG.g)(gG.d.NAME_PARTICLESYSTEM,((U,G,C,L)=>{const X=(0,ZG.h)(gG.d.NAME_PARTICLESYSTEM);if(X&&void 0!==U.SD&&null!==U.SD)for(let l=0,t=U.SD.length;l<t;l++){const t=U.SD[l];C.SD.push(X(t,G,L))}})),(0,ZG.c)(gG.d.NAME_PARTICLESYSTEM,((U,G,C)=>{if(U.activeParticleCount){return NG.Parse(U,G,C)}return KG.Parse(U,G,C)})),RU.b.prototype.createEffectForParticles=function(U){var G;let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0,P=arguments.length>7?arguments[7]:void 0,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,T=arguments.length>9?arguments[9]:void 0,D=[],y=[];const V=[];return P?P.fillUniformsAttributesAndSamplerNames(y,D,V):(D=KG._GetAttributeNamesOrOptions(),y=KG._GetEffectCreationOptions()),-1===l.indexOf(" BILLBOARD")&&(l+="\n#define BILLBOARD\n"),null!==P&&void 0!==P&&P.isAnimationSheetEnabled&&-1===l.indexOf(" ANIMATESHEET")&&(l+="\n#define ANIMATESHEET\n"),-1===X.indexOf("diffuseSampler")&&X.push("diffuseSampler"),this.createEffect({vertex:null!==(G=null!==T&&void 0!==T?T:null===P||void 0===P?void 0:P.vertexShaderName)&&void 0!==G?G:"particles",fragmentElement:U},D,y.concat(L),V.concat(X),l,t,E,K,void 0,O,(async()=>{0===O?await Promise.resolve().then(C.bind(C,13859)):await Promise.resolve().then(C.bind(C,13912))}))},dG.d.prototype.getEmittedParticleSystems=function(){const U=[];for(let G=0;G<this.wU().SD.length;G++){const C=this.wU().SD[G];C.LG===this&&U.push(C)}return U},dG.d.prototype.getHierarchyEmittedParticleSystems=function(){const U=[],G=this.getDescendants();G.push(this);for(let C=0;C<this.wU().SD.length;C++){const L=this.wU().SD[C],X=L.LG;X.position&&-1!==G.indexOf(X)&&U.push(L)}return U};C(13192),C(13206),C(13280);C(13285),C(13838),C(13075),C(13184),C(13331);C(13070);var FG;C(13842),C(12913);!function(U){U[U.Color=2]="Color",U[U.UV=1]="UV",U[U.Random=0]="Random",U[U.Stated=3]="Stated"}(FG||(FG={}));var qG=C(13092);const aG=new L.pG(0,0,0),kG=new L.pG(0,0,0),nG=new L.pG(0,0,0);class QG{constructor(U,G,C){this.width=U,this.height=G,this.data=C}processFlowable(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof L.Matrix?L.pG.TransformCoordinatesToRef(U.position,C,nG):(nG.x=C.x,nG.y=C.y,nG.z=C.z);const X=.5*nG.x+.5,l=1-(.5*nG.y+.5),t=Math.floor(X*this.width),E=Math.floor(l*this.height);if(t<0||t>=this.width||E<0||E>=this.height)return;const K=4*(E*this.width+t),P=this.data[K]/255*2-1,O=this.data[K+1]/255*2-1,T=this.data[K+2]/255*2-1,D=this.data[K+3]/255;aG.set(P,O,T),aG.scaleToRef(G*D,kG),U.direction.addInPlace(kG)}_processParticle(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(U,G,C)}static async FromUrlAsync(U){return await new Promise(((G,C)=>{const L=document.createElement("canvas"),X=L.getContext("2d");let l=null;const t=new Image;t.crossOrigin="anonymous",t.src=U,t.onerror=G=>{C(new Error("Failed to load image: ".concat(U," : ").concat(G)))},t.onload=()=>{L.width=t.width,L.height=t.height,X.drawImage(t,0,0),l=X.getImageData(0,0,L.width,L.height),G(new QG(L.width,L.height,l.data))}}))}static async ExtractFromTextureAsync(U){return await new Promise(((G,C)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(U);G(C)}catch(L){C(L)}}));const L=U.getSize();qG.g.GetTextureDataAsync(U,L.width,L.height).then((U=>{G(new QG(L.width,L.height,new Uint8ClampedArray(U)))})).catch(C)}))}}var mC,BG,MG,zG,sG,jG,AG,YG,eG;!function(U){U[U.Int=1]="Int",U[U.Float=2]="Float",U[U.Vector2=4]="Vector2",U[U.pG=8]="pG",U[U.Matrix=16]="Matrix",U[U.Particle=32]="Particle",U[U.Texture=64]="Texture",U[U.JE=128]="JE",U[U.FloatGradient=256]="FloatGradient",U[U.Vector2Gradient=512]="Vector2Gradient",U[U.Vector3Gradient=1024]="Vector3Gradient",U[U.Color4Gradient=2048]="Color4Gradient",U[U.System=4096]="System",U[U.AutoDetect=8192]="AutoDetect",U[U.BasedOnInput=16384]="BasedOnInput",U[U.Undefined=32768]="Undefined",U[U.All=65535]="All"}(mC||(mC={})),function(U){U[U.Compatible=0]="Compatible",U[U.TypeIncompatible=1]="TypeIncompatible",U[U.HierarchyIssue=2]="HierarchyIssue"}(BG||(BG={})),function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(MG||(MG={}));class iG{get direction(){return this._direction}get type(){if(this._type===mC.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===mC.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(U){this._type=U}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((U=>U.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(U,G,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=mC.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new f.e,this.onDisconnectionObservable=new f.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=G,this.name=U,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(U){var G;return this.isConnected?null!==(G=this._connectedPoint)&&void 0!==G&&G._storedFunction?this._connectedPoint._storedFunction(U):this._connectedPoint._storedValue:this.value}canConnectTo(U){return 0===this.checkCompatibilityState(U)}checkCompatibilityState(U){const G=this._ownerBlock,C=U.ownerBlock;if(this.type!==U.type&&U.innerType!==mC.AutoDetect)return U.acceptedConnectionPointTypes&&-1!==U.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(U.excludedConnectionPointTypes&&-1!==U.excludedConnectionPointTypes.indexOf(this.type))return 1;let L=C,X=G;return 0===this.direction&&(L=G,X=C),L.isAnAncestorOf(X)?2:0}connectTo(U){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(U))throw'Cannot connect these two connectors. source: "'.concat(this.ownerBlock.name,'".').concat(this.name,', target: "').concat(U.ownerBlock.name,'".').concat(U.name);return this._endpoints.push(U),U._connectedPoint=this,this.onConnectionObservable.notifyObservers(U),U.onConnectionObservable.notifyObservers(this),this}disconnectFrom(U){const G=this._endpoints.indexOf(U);return-1===G||(this._endpoints.splice(G,1),U._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(U),U.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(U){let G=1;for(;G<mC.All;)U&G||this.excludedConnectionPointTypes.push(G),G<<=1}serialize(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const G={};return G.name=this.name,G.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.sE?(G.valueType="BABYLON."+this.value.getClassName(),G.value=this.value.sE()):(G.valueType="number",G.value=this.value)),U&&this.connectedPoint&&(G.inputName=this.name,G.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,G.targetConnectionName=this.connectedPoint.name,G.isExposedOnFrame=!0,G.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(G.isExposedOnFrame=!0,G.exposedPortPosition=this.exposedPortPosition),G}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class cG{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(U){this._name=U}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(U){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new f.e,this.aE=new f.e,this.onInputChangedObservable=new f.e,this.visibleOnFrame=!1,this._name=U,this.uniqueId=Q.c.UniqueId}_inputRename(U){return U}_outputRename(U){return U}isAnAncestorOf(U){for(const G of this._outputs)if(G.hasEndpoints)for(const C of G.endpoints){if(C.ownerBlock===U)return!0;if(C.ownerBlock.isAnAncestorOf(U))return!0}return!1}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const G of this._outputs)if(G.hasEndpoints)for(const C of G.endpoints)if(C.ownerBlock.isAnAncestorOfType(U))return!0;return!1}getInputByName(U){const G=this._inputs.filter((G=>G.name===U));return G.length?G[0]:null}_linkConnectionTypes(U,G){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[G]._acceptedConnectionPointType=this._inputs[U]:(this._inputs[U]._linkedConnectionSource=this._inputs[G],this._inputs[U]._isMainLinkSource=!0),this._inputs[G]._linkedConnectionSource=this._inputs[U]}registerInput(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0;const t=new iG(U,this,0);return t.type=G,t.isOptional=C,t.defaultValue=L,t.value=L,t.valueMin=X,t.valueMax=l,this._inputs.push(t),this.onInputChangedObservable.notifyObservers(t),this}registerOutput(U,G,C){var L;return(C=null!==(L=C)&&void 0!==L?L:new iG(U,this,1)).type=G,this._outputs.push(C),this}_build(U){}_customBuildStep(U){}build(U){if(this._buildId===U.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((U=>U.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=U.buildId;for(const G of this._inputs){if(!G.connectedPoint){G.isOptional||U.notConnectedNonOptionalInputs.push(G);continue}const C=G.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(U)}return this._customBuildStep(U),U.verbose&&mU.d.Log("Building ".concat(this.name," [").concat(this.getClassName(),"]")),this._build(U),this.onBuildObservable.notifyObservers(this),!1}serialize(){const U={};U.customType="BABYLON."+this.getClassName(),U.id=this.uniqueId,U.name=this.name,U.visibleOnFrame=this.visibleOnFrame,U.inputs=[],U.outputs=[];for(const G of this.inputs)U.inputs.push(G.serialize());for(const G of this.outputs)U.outputs.push(G.serialize(!1));return U}_deserialize(U){this._name=U.name,this.comments=U.comments,this.visibleOnFrame=!!U.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(U)}_deserializePortDisplayNamesAndExposedOnFrame(U){const G=U.inputs,C=U.outputs;if(G)for(const L of G){const U=this.inputs.find((U=>U.name===L.name));if(!U)return;if(L.displayName&&(U.displayName=L.displayName),L.isExposedOnFrame&&(U.isExposedOnFrame=L.isExposedOnFrame,U.exposedPortPosition=L.exposedPortPosition),void 0!==L.value&&null!==L.value)if("number"===L.valueType)U.value=L.value;else{const G=(0,E.c)(L.valueType);G&&(U.value=G.NG(L.value))}}if(C)for(let L=0;L<C.length;L++){const U=C[L];U.displayName&&(this.outputs[L].displayName=U.displayName),U.isExposedOnFrame&&(this.outputs[L].isExposedOnFrame=U.isExposedOnFrame,this.outputs[L].exposedPortPosition=U.exposedPortPosition)}}clone(){const U=this.serialize(),G=(0,E.c)(U.customType);if(G){const C=new G;return C._deserialize(U),C}return null}dispose(){this.aE.notifyObservers(this),this.aE.clear();for(const U of this.inputs)U.dispose();for(const U of this.outputs)U.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function RG(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",L=arguments.length>3?arguments[3]:void 0;return(X,l)=>{let t=X._propStore;t||(t=[],X._propStore=t),t.push({propertyName:l,displayName:U,type:G,groupName:C,options:null!==L&&void 0!==L?L:{},className:X.getClassName()})}}(0,q.d)([(0,a.H)("comment")],cG.prototype,"comments",void 0),function(U){U[U.Boolean=0]="Boolean",U[U.Float=1]="Float",U[U.Int=2]="Int",U[U.Vector2=3]="Vector2",U[U.List=4]="List",U[U.JE=5]="JE",U[U.SamplingMode=6]="SamplingMode",U[U.TextureFormat=7]="TextureFormat",U[U.TextureType=8]="TextureType"}(zG||(zG={})),function(U){U[U.None=0]="None",U[U.Position=1]="Position",U[U.Direction=2]="Direction",U[U.Age=3]="Age",U[U.Lifetime=4]="Lifetime",U[U.Color=5]="Color",U[U.ScaledDirection=6]="ScaledDirection",U[U.Scale=7]="Scale",U[U.AgeGradient=8]="AgeGradient",U[U.Angle=9]="Angle",U[U.SpriteCellIndex=16]="SpriteCellIndex",U[U.SpriteCellStart=17]="SpriteCellStart",U[U.SpriteCellEnd=18]="SpriteCellEnd"}(sG||(sG={})),function(U){U[U.None=0]="None",U[U.Time=1]="Time",U[U.Delta=2]="Delta",U[U.Emitter=3]="Emitter"}(jG||(jG={}));class WG{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let U="";for(const G of this.notConnectedNonOptionalInputs)U+="input ".concat(G.name," from block ").concat(G.ownerBlock.name,"[").concat(G.ownerBlock.getClassName(),"] is not connected and is not optional.\n");if(U)throw"Build of Node Particle System Set failed:\n"+U}adapt(U,G){const C=U.getConnectedValue(this)||0;if(U.type===G)return C;switch(G){case mC.Vector2:return new L.Vector2(C,C);case mC.pG:return new L.pG(C,C,C);case mC.JE:return new t.JE(C,C,C,C)}return null}getContextualValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case sG.Position:return this.particleContext.position;case sG.Direction:return this.particleContext.direction;case sG.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case sG.Color:return this.particleContext.color;case sG.Age:return this.particleContext.age;case sG.Lifetime:return this.particleContext.lifeTime;case sG.Angle:return this.particleContext.angle;case sG.Scale:return this.particleContext.scale;case sG.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case sG.SpriteCellEnd:return this.systemContext.endSpriteCellID;case sG.SpriteCellIndex:return this.particleContext.cellIndex;case sG.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.LG.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.LG.absolutePosition:this.systemContext.LG:null}getSystemValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case jG.Time:return this.systemContext._actualFrame;case jG.Delta:return this.systemContext._scaledUpdateSpeed;case jG.Emitter:if(this.isEmitterTransformNode){return this.systemContext.LG.absolutePosition}return this.systemContext.LG}return null}}function fG(U,G,C){const L=new WG;L.HG=G;const X=U.createSystem(L);return X.canStart=()=>!0,X.LG=C.clone(),X.disposeOnStop=!0,X.start(),X}class rG extends cG{constructor(U){super(U),this.blendMode=K.BLENDMODE_ONEONE,this.SG=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",mC.Particle),this.registerInput("texture",mC.Texture),this.registerInput("onStart",mC.System,!0),this.registerInput("onEnd",mC.System,!0),this.registerOutput("system",mC.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(U){U.SG=this.SG,U.buildId=this._buildId++,this.build(U);const G=this.particle.getConnectedValue(U);return G.particleTexture=this.texture.getConnectedValue(U),G.emitRate=this.emitRate,G.blendMode=this.blendMode,G.name=this.name,G._nodeGenerated=!0,G._targetStopDuration=this.targetStopDuration,G.startDelay=this.startDelay,this.system._storedValue=this,G.canStart=()=>!this.doNoStart,G.onStartedObservable.add((C=>{const L=this.onStart.getConnectedValue(U);L&&C.onStartedObservable.addOnce((()=>{U.systemContext=G;const C=fG(L,U.HG,U.emitterPosition);this.aE.addOnce((()=>{C.dispose()}))}));const X=this.onEnd.getConnectedValue(U);X&&C.onStoppedObservable.addOnce((()=>{U.systemContext=G;const C=fG(X,U.HG,U.emitterPosition);this.aE.addOnce((()=>{C.dispose()}))}))})),this.aE.addOnce((()=>{G.dispose()})),G}serialize(){const U=super.serialize();return U.SG=this.SG,U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.doNoStart=this.doNoStart,U.targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,U}_deserialize(U){super._deserialize(U),this.SG=U.SG,this.emitRate=U.emitRate,this.doNoStart=!!U.doNoStart,void 0!==U.blendMode&&(this.blendMode=U.blendMode),void 0!==U.targetStopDuration&&(this.targetStopDuration=U.targetStopDuration),void 0!==U.startDelay&&(this.startDelay=U.startDelay)}}(0,q.d)([RG("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:K.BLENDMODE_ONEONE},{label:"Standard",value:K.BLENDMODE_STANDARD},{label:"Add",value:K.BLENDMODE_ADD},{label:"Multiply",value:K.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:K.BLENDMODE_MULTIPLYADD}]})],rG.prototype,"blendMode",void 0),(0,q.d)([RG("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],rG.prototype,"SG",void 0),(0,q.d)([RG("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rG.prototype,"emitRate",void 0),(0,q.d)([RG("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rG.prototype,"targetStopDuration",void 0),(0,q.d)([RG("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rG.prototype,"startDelay",void 0),(0,q.d)([RG("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rG.prototype,"doNoStart",void 0),(0,E.e)("BABYLON.SystemBlock",rG);class JG extends cG{get type(){if(this._type===mC.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=mC.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=mC.Vector2,this._type;case"pG":return this._type=mC.pG,this._type;case"JE":return this._type=mC.JE,this._type;case"Matrix":return this._type=mC.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===sG.None&&this._systemSource!==jG.None}get systemSource(){return this._systemSource}set systemSource(U){if(this._systemSource=U,U!==jG.None){switch(this._contextualSource=sG.None,this._type=mC.Float,U){case jG.Time:case jG.Delta:this._type=mC.Float;break;case jG.Emitter:this._type=mC.pG}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==sG.None}get contextualValue(){return this._contextualSource}set contextualValue(U){if(this._contextualSource=U,U!==sG.None){switch(this._systemSource=jG.None,U){case sG.Scale:this._type=mC.Vector2;break;case sG.Position:case sG.Direction:case sG.ScaledDirection:this._type=mC.pG;break;case sG.Color:this._type=mC.JE;break;case sG.Age:case sG.Lifetime:case sG.Angle:case sG.AgeGradient:this._type=mC.Float;break;case sG.SpriteCellEnd:case sG.SpriteCellStart:case sG.SpriteCellIndex:this._type=mC.Int}this.output&&(this.output.type=this._type)}}constructor(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mC.AutoDetect;super(U),this._type=mC.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new f.e,this._systemSource=jG.None,this._contextualSource=sG.None,this._type=G,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",G)}get value(){return this._storedValue}set value(U){this.type===mC.Float&&this.min!==this.max&&(U=Math.max(this.min,U),U=Math.min(this.max,U)),this._storedValue=U,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(U){this._valueCallback=U}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case mC.Int:case mC.Float:this.value=0;break;case mC.Vector2:this.value=L.Vector2.Zero();break;case mC.pG:this.value=L.pG.Zero();break;case mC.JE:this.value=new t.JE(1,1,1,1);break;case mC.Matrix:this.value=L.Matrix.Identity()}}_build(U){super._build(U),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=U=>U.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=U=>U.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const U=super.serialize();return U.type=this.type,U.contextualValue=this.contextualValue,U.systemSource=this.systemSource,U.min=this.min,U.max=this.max,U.groupInInspector=this.groupInInspector,U.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.sE?(U.valueType="BABYLON."+this._storedValue.getClassName(),U.value=this._storedValue.sE()):(U.valueType="number",U.value=this._storedValue)),U}_deserialize(U){if(super._deserialize(U),this._type=U.type,this.contextualValue=U.contextualValue,this.systemSource=U.systemSource||jG.None,this.min=U.min||0,this.max=U.max||0,this.groupInInspector=U.groupInInspector||"",void 0!==U.displayInInspector&&(this.displayInInspector=U.displayInInspector),U.valueType)if("number"===U.valueType)this._storedValue=U.value;else{const G=(0,E.c)(U.valueType);G&&(this._storedValue=G.NG(U.value))}}}(0,E.e)("BABYLON.ParticleInputBlock",JG);class UC extends cG{get url(){return this._url}set url(U){this._url!==U&&(this._cachedData=null,this._url=U,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(U){this._textureDataUrl!==U&&(this._cachedData=null,this._textureDataUrl=U,this._url="",this._sourceTexture=null)}set sourceTexture(U){this._sourceTexture!==U&&(this._cachedData=null,this._sourceTexture=U,this._url="",this._textureDataUrl="")}constructor(U){super(U),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",mC.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const U=this.texture._storedValue;return await new Promise(((G,C)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),G(this._cachedData)}catch(U){C(U)}}));const L=U.getSize();qG.g.GetTextureDataAsync(U,L.width,L.height).then((C=>{this._cachedData={width:L.width,height:L.height,data:new Uint8ClampedArray(C)},U.dispose(),G(this._cachedData)})).catch(C)}))}_build(U){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.c(this._textureDataUrl,U.HG):this.texture._storedValue=new n.c(this._url,U.HG):this.texture._storedValue=null}serialize(){const U=super.serialize();return U.url=this.url,U.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(U.textureDataUrl=this.textureDataUrl),U}_deserialize(U){super._deserialize(U),this.url=U.url,this.serializedCachedData=!!U.serializedCachedData,U.textureDataUrl&&(this.textureDataUrl=U.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,E.e)("BABYLON.ParticleTextureSourceBlock",UC);class GC extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("position",mC.pG),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(U){const G=this.particle.getConnectedValue(U);if(this.output._storedValue=G,!this.position.isConnected)return;const C={process:C=>{U.particleContext=C,U.systemContext=G,C.position.L(this.position.getConnectedValue(U))},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C}}(0,E.e)("BABYLON.UpdatePositionBlock",GC),function(U){U[U.Add=0]="Add",U[U.Subtract=1]="Subtract",U[U.Multiply=2]="Multiply",U[U.Divide=3]="Divide",U[U.Max=4]="Max",U[U.Min=5]="Min"}(AG||(AG={}));class CC extends cG{constructor(U){super(U),this.operation=AG.Add,this.registerInput("left",mC.AutoDetect),this.registerInput("right",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this.output._typeConnectionSource=this.left;const G=[mC.Matrix,mC.Particle,mC.Texture,mC.System,mC.FloatGradient,mC.Color4Gradient,mC.Vector2Gradient,mC.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...G),this.right.excludedConnectionPointTypes.push(...G),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(U){let G;const C=this.left,X=this.right;if(!C.isConnected||!X.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const l=C.type===mC.Float||C.type===mC.Int,E=X.type===mC.Float||X.type===mC.Int,K=l&&E;switch(this.operation){case AG.Add:G=K?U=>C.getConnectedValue(U)+X.getConnectedValue(U):l?U=>U.adapt(C,X.type).add(X.getConnectedValue(U)):U=>C.getConnectedValue(U).add(U.adapt(X,C.type));break;case AG.Subtract:G=K?U=>C.getConnectedValue(U)-X.getConnectedValue(U):l?U=>U.adapt(C,X.type).IG(X.getConnectedValue(U)):U=>C.getConnectedValue(U).IG(U.adapt(X,C.type));break;case AG.Multiply:G=K?U=>C.getConnectedValue(U)*X.getConnectedValue(U):l?U=>U.adapt(C,X.type).multiply(X.getConnectedValue(U)):U=>C.getConnectedValue(U).multiply(U.adapt(X,C.type));break;case AG.Divide:G=K?U=>C.getConnectedValue(U)/X.getConnectedValue(U):l?U=>U.adapt(C,X.type).divide(X.getConnectedValue(U)):U=>C.getConnectedValue(U).divide(U.adapt(X,C.type));break;case AG.Min:if(K)G=U=>Math.min(C.getConnectedValue(U),X.getConnectedValue(U));else{const[U,E]=l?[X,C]:[C,X];switch(U.type){case mC.Vector2:G=G=>L.Vector2.Minimize(U.getConnectedValue(G),G.adapt(E,U.type));break;case mC.pG:G=G=>L.pG.Minimize(U.getConnectedValue(G),G.adapt(E,U.type));break;case mC.JE:G=G=>{const C=U.getConnectedValue(G),{r:L,g:X,b:l,a:K}=G.adapt(E,U.type);return new t.JE(Math.min(C.r,L),Math.min(C.g,X),Math.min(C.b,l),Math.min(C.a,K))}}}break;case AG.Max:if(!K){const[U,E]=l?[X,C]:[C,X];switch(U.type){case mC.Vector2:G=G=>L.Vector2.Maximize(U.getConnectedValue(G),G.adapt(E,U.type));break;case mC.pG:G=G=>L.pG.Maximize(U.getConnectedValue(G),G.adapt(E,U.type));break;case mC.JE:G=G=>{const C=U.getConnectedValue(G),{r:L,g:X,b:l,a:K}=G.adapt(E,U.type);return new t.JE(Math.max(C.r,L),Math.min(C.g,X),Math.min(C.b,l),Math.min(C.a,K))}}break}G=U=>Math.max(C.getConnectedValue(U),X.getConnectedValue(U))}this.output._storedFunction=U=>C.type===mC.Int?0|G(U):G(U)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===mC.Int||this.left.type===mC.Float&&this.right.type!==mC.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[U,G]of[[this.left,this.right],[this.right,this.left]])U.acceptedConnectionPointTypes=[mC.Int,mC.Float],G.isConnected&&(U.acceptedConnectionPointTypes.push(G.type),G.type!==mC.Int&&G.type!==mC.Float||U.acceptedConnectionPointTypes.push(mC.Vector2,mC.pG,mC.JE))}dispose(){super.dispose();for(const U of this._connectionObservers)U.remove();this._connectionObservers.length=0}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,q.d)([RG("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:AG.Add},{label:"Subtract",value:AG.Subtract},{label:"Multiply",value:AG.Multiply},{label:"Divide",value:AG.Divide},{label:"Max",value:AG.Max},{label:"Min",value:AG.Min}]})],CC.prototype,"operation",void 0),(0,E.e)("BABYLON.ParticleMathBlock",CC);class LC extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("direction1",mC.pG,!0,new L.pG(0,1,0)),this.registerInput("direction2",mC.pG,!0,new L.pG(0,1,0)),this.registerInput("minEmitBox",mC.pG,!0,new L.pG(-.5,-.5,-.5)),this.registerInput("maxEmitBox",mC.pG,!0,new L.pG(.5,.5,.5)),this.registerOutput("output",mC.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const G=this.particle.getConnectedValue(U);G._directionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.direction1.getConnectedValue(U),l=this.direction2.getConnectedValue(U),t=(0,P.RandomRange)(X.x,l.x),E=(0,P.RandomRange)(X.y,l.y),K=(0,P.RandomRange)(X.z,l.z);U.isEmitterTransformNode?L.pG.TransformNormalFromFloatsToRef(t,E,K,U.emitterWorldMatrix,C.direction):C.direction.WE(t,E,K)},G._positionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.minEmitBox.getConnectedValue(U),l=this.maxEmitBox.getConnectedValue(U),t=(0,P.RandomRange)(X.x,l.x),E=(0,P.RandomRange)(X.y,l.y),K=(0,P.RandomRange)(X.z,l.z);U.isEmitterTransformNode?L.pG.TransformCoordinatesFromFloatsToRef(t,E,K,U.emitterWorldMatrix,C.position):(C.position.WE(t,E,K),C.position.addInPlace(U.emitterPosition))},this.output._storedValue=G}}(0,E.e)("BABYLON.BoxShapeBlock",LC);class XC extends cG{constructor(U){super(U),this.registerInput("emitPower",mC.Float,!0,1),this.registerInput("lifeTime",mC.Float,!0,1),this.registerInput("color",mC.JE,!0,new t.JE(1,1,1,1)),this.registerInput("scale",mC.Vector2,!0,new L.Vector2(1,1)),this.registerInput("angle",mC.Float,!0,0),this.registerOutput("particle",mC.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(U){const G=new KG(this.name,U.SG,U.HG,null,!1,void 0,!0);G.particleEmitterType=new H,G._lifeTimeCreation.process=(G,C)=>{U.particleContext=G,G.lifeTime=this.lifeTime.getConnectedValue(U),C._emitPower=this.emitPower.getConnectedValue(U)},G._colorCreation.process=G=>{U.particleContext=G,G.color.L(this.color.getConnectedValue(U))},G._sizeCreation.process=G=>{U.particleContext=G,G.size=1,G.scale.L(this.scale.getConnectedValue(U))},G._angleCreation.process=G=>{U.particleContext=G,G.angle=this.angle.getConnectedValue(U)},this.particle._storedValue=G}}(0,E.e)("BABYLON.CreateParticleBlock",XC);class lC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const U=[];for(const G of this.attachedBlocks)G.isInput&&U.push(G);return U}constructor(U){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new f.e,this.name=U}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(U)&&this.attachedBlocks.push(U);for(const C of U.inputs){const L=C.connectedPoint;if(L){const C=L.ownerBlock;C!==U&&this._initializeBlock(C,G)}}}async buildAsync(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const L=new SG;for(const U of this._systemBlocks)this._initializeBlock(U);for(const X of this.systemBlocks){const C=new WG;C.buildId=this._buildId++,C.HG=U,C.verbose=G;const l=X.createSystem(C);C.emitErrors(),L.systems.push(l)}this.onBuildObservable.notifyObservers(this),C(L)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const U=new rG("Particle system"),G=new GC("Update position");G.output.connectTo(U.particle);const C=new JG("Position");C.contextualValue=sG.Position;const L=new JG("Scaled direction");L.contextualValue=sG.ScaledDirection;const X=new CC("Add");X.operation=AG.Add,C.output.connectTo(X.left),L.output.connectTo(X.right),X.output.connectTo(G.position);const l=new XC("Create particle"),t=new LC("Box shape");l.particle.connectTo(t.particle),t.output.connectTo(G.particle);const E=new UC("Texture");E.texture.connectTo(U.texture),E.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(U)}removeBlock(U){const G=this.attachedBlocks.indexOf(U);if(G>-1&&this.attachedBlocks.splice(G,1),U.isSystem){const G=this._systemBlocks.indexOf(U);G>-1&&this._systemBlocks.splice(G,1)}}parseSerializedObject(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G||this.clear();const C={};for(const L of U.MO){const U=(0,E.c)(L.customType);if(U){const G=new U;G._deserialize(L),C[L.id]=G,this.attachedBlocks.push(G),G.isSystem&&this._systemBlocks.push(G)}}for(const L of this.attachedBlocks)if(L.isTeleportOut){const U=L,G=U._tempEntryPointUniqueId;if(G){const L=C[G];L&&L.attachToEndpoint(U)}}for(let L=0;L<U.MO.length;L++){const X=U.MO[L],l=C[X.id];l&&(l.inputs.length&&X.inputs.some((U=>U.targetConnectionName))&&!G||this._restoreConnections(l,U,C))}if(U.locations||U.editorData&&U.editorData.locations){const L=U.locations||U.editorData.locations;for(const U of L)C[U.YX]&&(U.YX=C[U.YX].uniqueId);G&&this.editorData&&this.editorData.locations&&L.concat(this.editorData.locations),U.locations?this.editorData={locations:L}:(this.editorData=U.editorData,this.editorData.locations=L);const X=[];for(const U in C)X[U]=C[U].uniqueId;this.editorData.map=X}this.comment=U.comment}_restoreConnections(U,G,C){for(const L of U.outputs)for(const X of G.MO){const l=C[X.id];if(l)for(const t of X.inputs)if(C[t.targetBlockId]!==U||t.targetConnectionName!==L.name);else{const U=l.getInputByName(t.inputName);if(!U||U.isConnected)continue;L.connectTo(U,!0),this._restoreConnections(l,G,C)}}}serialize(U){const G=U?{}:k.c.Serialize(this);G.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];U?C=U:G.customType="BABYLON.NodeParticleSystemSet",G.MO=[];for(const L of C)G.MO.push(L.serialize());if(!U)for(const L of this.attachedBlocks)-1===C.indexOf(L)&&G.MO.push(L.serialize());return G}dispose(){for(const U of this.attachedBlocks)U.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(U){const G=new lC(U);return G.setToDefault(),G}static Parse(U){const G=k.c.Parse((()=>new lC(U.name)),U,null);return G.parseSerializedObject(U),G}static ParseFromSnippetAsync(U,G){return"_BLANK"===U?Promise.resolve(lC.CreateDefault("blank")):new Promise(((C,L)=>{const X=new vG.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const t=JSON.parse(JSON.parse(X.responseText).jsonPayload),E=JSON.parse(t.nodeParticle);G||(G=k.c.Parse((()=>new lC(U)),E,null)),G.parseSerializedObject(E),G.snippetId=U;try{C(G)}catch(l){L(l)}}else L("Unable to load the snippet "+U)})),X.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),X.send()}))}}lC.EditorURL="".concat(bG.Tools._DefaultCdnUrl,"/v").concat(RU.b.Version,"/nodeParticleEditor/babylon.nodeParticleEditor.js"),lC.SnippetUrl="https://snippet.babylonjs.com",(0,q.d)([(0,a.H)()],lC.prototype,"name",void 0),(0,q.d)([(0,a.H)("comment")],lC.prototype,"comment",void 0),function(U){U[U.None=0]="None",U[U.PerParticle=1]="PerParticle",U[U.PerSystem=2]="PerSystem"}(YG||(YG={}));class tC extends cG{constructor(U){super(U),this._currentLockId=-2,this.lockMode=YG.PerParticle,this.registerInput("min",mC.AutoDetect,!0,0),this.registerInput("max",mC.AutoDetect,!0,1),this.registerOutput("output",mC.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(mC.Float|mC.Int|mC.Vector2|mC.pG|mC.JE),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(mC.Float|mC.Int|mC.Vector2|mC.pG|mC.JE),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=mC.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case mC.AutoDetect:case mC.Int:case mC.Float:U=U=>{const G=this.min.getConnectedValue(U)||0,C=this.max.getConnectedValue(U)||1;return G+Math.random()*(C-G)};break;case mC.Vector2:U=U=>{const G=this.min.getConnectedValue(U)||L.Vector2.Zero(),C=this.max.getConnectedValue(U)||L.Vector2.One();return new L.Vector2(G.x+Math.random()*(C.x-G.x),G.y+Math.random()*(C.y-G.y))};break;case mC.pG:U=U=>{const G=this.min.getConnectedValue(U)||L.pG.Zero(),C=this.max.getConnectedValue(U)||L.pG.One();return new L.pG(G.x+Math.random()*(C.x-G.x),G.y+Math.random()*(C.y-G.y),G.z+Math.random()*(C.z-G.z))};break;case mC.JE:U=U=>{const G=this.min.getConnectedValue(U)||new t.JE(0,0,0,0),C=this.max.getConnectedValue(U)||new t.JE(1,1,1,1);return new t.JE(G.x+Math.random()*(C.x-G.x),G.y+Math.random()*(C.y-G.y),G.z+Math.random()*(C.z-G.z),G.w+Math.random()*(C.w-G.w))}}this.output._storedFunction=G=>{var C;let L=0;switch(this.lockMode){case YG.PerParticle:L=(null===(C=G.particleContext)||void 0===C?void 0:C.id)||-1;break;case YG.PerSystem:L=G.buildId||0}return this._currentLockId!==L&&(this.lockMode!==YG.None&&(this._currentLockId=L),this.output._storedValue=U(G)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),this.lockMode=U.lockMode}}(0,q.d)([RG("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:YG.None},{label:"Per particle",value:YG.PerParticle},{label:"Per system",value:YG.PerSystem}]})],tC.prototype,"lockMode",void 0),(0,E.e)("BABYLON.ParticleRandomBlock",tC);class EC extends cG{constructor(U){super(U),this._currentLockId=-2,this.lockMode=YG.PerParticle,this.registerInput("min",mC.AutoDetect),this.registerInput("max",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const G=[mC.Matrix,mC.Particle,mC.Texture,mC.System,mC.FloatGradient,mC.Color4Gradient,mC.Vector2Gradient,mC.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...G),this.max.excludedConnectionPointTypes.push(...G)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case mC.Float:case mC.Int:U=U=>{const G=this.min.getConnectedValue(U),C=this.max.getConnectedValue(U);return Math.random()*(C-G)+G};break;case mC.Vector2:U=U=>{const G=this.min.getConnectedValue(U),C=this.max.getConnectedValue(U);return new L.Vector2(Math.random()*(C.x-G.x)+G.x,Math.random()*(C.y-G.y)+G.y)};break;case mC.pG:U=U=>{const G=this.min.getConnectedValue(U),C=this.max.getConnectedValue(U);return new L.pG(Math.random()*(C.x-G.x)+G.x,Math.random()*(C.y-G.y)+G.y,Math.random()*(C.z-G.z)+G.z)};break;case mC.JE:U=U=>{const G=this.min.getConnectedValue(U),C=this.max.getConnectedValue(U);return new t.JE(Math.random()*(C.r-G.r)+G.r,Math.random()*(C.g-G.g)+G.g,Math.random()*(C.b-G.b)+G.b,Math.random()*(C.a-G.a)+G.a)}}this.output._storedFunction=G=>{var C;let L=0;switch(this.lockMode){case YG.PerParticle:L=(null===(C=G.particleContext)||void 0===C?void 0:C.id)||-1;break;case YG.PerSystem:L=G.buildId||0}return this._currentLockId!==L&&(this.lockMode!==YG.None&&(this._currentLockId=L),this.output._storedValue=U(G)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),void 0!==U.lockMode&&(this.lockMode=U.lockMode)}}(0,q.d)([RG("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:YG.None},{label:"Per particle",value:YG.PerParticle},{label:"Per system",value:YG.PerSystem}]})],EC.prototype,"lockMode",void 0),(0,E.e)("BABYLON.RandomRangeBlock",EC);(0,E.e)("BABYLON.ParticleLerpBlock",class extends cG{constructor(U){super(U),this.registerInput("left",mC.AutoDetect),this.registerInput("right",mC.AutoDetect),this.registerInput("gradient",mC.Float,!0,0,0,1),this.registerOutput("output",mC.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(mC.Float|mC.Int|mC.Vector2|mC.pG|mC.JE)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const U=(U,G,C)=>(1-U)*G+U*C;this.output._storedFunction=G=>{const C=this.left.getConnectedValue(G),X=this.right.getConnectedValue(G),l=this.gradient.getConnectedValue(G);switch(this.left.type){case mC.Int:case mC.Float:return U(l,C,X);case mC.Vector2:return new L.Vector2(U(l,C.x,X.x),U(l,C.y,X.y));case mC.pG:return new L.pG(U(l,C.x,X.x),U(l,C.y,X.y),U(l,C.z,X.z));case mC.JE:return new t.JE(U(l,C.r,X.r),U(l,C.g,X.g),U(l,C.b,X.b),U(l,C.a,X.a))}return 0}}});(0,E.e)("BABYLON.UpdateDirectionBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("direction",mC.pG),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(U){const G=this.particle.getConnectedValue(U);if(this.output._storedValue=G,!this.direction.isConnected)return;const C={process:C=>{U.particleContext=C,U.systemContext=G,C.direction.L(this.direction.getConnectedValue(U))},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C}});(0,E.e)("BABYLON.UpdateColorBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("color",mC.JE),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(U){const G=this.particle.getConnectedValue(U);if(this.output._storedValue=G,!this.color.isConnected)return;const C={process:C=>{U.particleContext=C,U.systemContext=G,C.color.L(this.color.getConnectedValue(U))},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C}});(0,E.e)("BABYLON.UpdateScaleBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("scale",mC.Vector2),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(U){const G=this.particle.getConnectedValue(U);if(this.output._storedValue=G,!this.scale.isConnected)return;const C={process:C=>{U.particleContext=C,U.systemContext=G,C.scale.L(this.scale.getConnectedValue(U))},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C}});(0,E.e)("BABYLON.UpdateAngleBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("angle",mC.Float),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(U){const G=this.particle.getConnectedValue(U);if(this.output._storedValue=G,!this.angle.isConnected)return;const C={process:C=>{U.particleContext=C,U.systemContext=G,C.angle=this.angle.getConnectedValue(U)},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C}});(0,E.e)("BABYLON.BasicPositionUpdateBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(U){const G=this.particle.getConnectedValue(U),C={process:C=>{U.particleContext=C,U.systemContext=G,C.direction.scaleToRef(G._directionScale,G._scaledDirection),C.position.addInPlace(G._scaledDirection)},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C,this.output._storedValue=G}});(0,E.e)("BABYLON.BasicSpriteUpdateBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(U){const G=this.particle.getConnectedValue(U),C={process:C=>{U.particleContext=C,U.systemContext=G,C.updateCellIndex()},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C,this.output._storedValue=G}});(0,E.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("cellIndex",mC.Int),this.registerOutput("output",mC.Particle),this.cellIndex.acceptedConnectionPointTypes=[mC.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(U){const G=this.particle.getConnectedValue(U);if(this.output._storedValue=G,!this.cellIndex.isConnected)return;const C={process:C=>{U.particleContext=C,U.systemContext=G,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(U))},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C}});class KC extends cG{constructor(U){super(U),this.strength=1,this.registerInput("particle",mC.Particle),this.registerInput("flowMap",mC.Texture),this.registerOutput("output",mC.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(U){var G;const C=this.particle.getConnectedValue(U),L=U.HG;let X;(null===(G=this.flowMap.connectedPoint)||void 0===G?void 0:G.ownerBlock).extractTextureContentAsync().then((U=>{U&&(X=new QG(U.width,U.height,U.data))}));const l={process:U=>{const G=L.getTransformMatrix();X&&X._processParticle(U,this.strength*C._tempScaledUpdateSpeed,G)},previousItem:null,nextItem:null};C._updateQueueStart?jU(l,C._updateQueueStart):C._updateQueueStart=l,this.output._storedValue=C}serialize(){const U=super.serialize();return U.strength=this.strength,U}_deserialize(U){super._deserialize(U),this.strength=U.strength}}(0,q.d)([RG("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KC.prototype,"strength",void 0),(0,E.e)("BABYLON.UpdateFlowMapBlock",KC);(0,E.e)("BABYLON.SphereShapeBlock",class extends cG{constructor(U){super(U),this.registerInput("input",mC.Particle),this.registerInput("radius",mC.Float,!0,1),this.registerInput("radiusRange",mC.Float,!0,1,0,1),this.registerInput("directionRandomizer",mC.Float,!0,0,0,1),this.registerOutput("output",mC.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(U){const G=this.input.getConnectedValue(U);G._directionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.directionRandomizer.getConnectedValue(U),l=C.position.IG(U.emitterPosition).normalize(),t=(0,P.RandomRange)(0,X),E=(0,P.RandomRange)(0,X),K=(0,P.RandomRange)(0,X);l.x+=t,l.y+=E,l.z+=K,l.normalize(),U.isEmitterTransformNode?L.pG.TransformNormalFromFloatsToRef(t,E,K,U.emitterWorldMatrix,C.direction):C.direction.WE(t,E,K)},G._positionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.radius.getConnectedValue(U),l=this.radiusRange.getConnectedValue(U),t=X-(0,P.RandomRange)(0,X*l),E=(0,P.RandomRange)(0,1),K=(0,P.RandomRange)(0,2*Math.PI),O=Math.acos(2*E-1),T=t*Math.cos(K)*Math.sin(O),D=t*Math.cos(O),y=t*Math.sin(K)*Math.sin(O);U.isEmitterTransformNode?L.pG.TransformCoordinatesFromFloatsToRef(T,D,y,U.emitterWorldMatrix,C.position):(C.position.WE(T,D,y),C.position.addInPlace(U.emitterPosition))},this.output._storedValue=G}});(0,E.e)("BABYLON.PointShapeBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("direction1",mC.pG,!0,new L.pG(0,1,0)),this.registerInput("direction2",mC.pG,!0,new L.pG(0,1,0)),this.registerOutput("output",mC.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const G=this.particle.getConnectedValue(U);G._directionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.direction1.getConnectedValue(U),l=this.direction2.getConnectedValue(U),t=(0,P.RandomRange)(X.x,l.x),E=(0,P.RandomRange)(X.y,l.y),K=(0,P.RandomRange)(X.z,l.z);U.isEmitterTransformNode?L.pG.TransformNormalFromFloatsToRef(t,E,K,U.emitterWorldMatrix,C.direction):C.direction.WE(t,E,K)},G._positionCreation.process=C=>{U.systemContext=G,U.isEmitterTransformNode?L.pG.TransformCoordinatesFromFloatsToRef(0,0,0,U.emitterWorldMatrix,C.position):C.position.L(U.emitterPosition)},this.output._storedValue=G}});(0,E.e)("BABYLON.CustomShapeBlock",class extends cG{constructor(U){super(U),this.registerInput("particle",mC.Particle),this.registerInput("position",mC.pG,!0,new L.pG(0,0,0)),this.registerInput("direction",mC.pG,!0,new L.pG(0,1,0)),this.registerOutput("output",mC.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const G=this.particle.getConnectedValue(U);G._directionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.direction.getConnectedValue(U);U.isEmitterTransformNode?L.pG.TransformNormalToRef(X,U.emitterWorldMatrix,C.direction):C.direction.L(X)},G._positionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.position.getConnectedValue(U);U.isEmitterTransformNode?L.pG.TransformCoordinatesToRef(X,U.emitterWorldMatrix,C.position):(C.position.L(X),C.position.addInPlace(U.emitterPosition))},this.output._storedValue=G}});(0,E.e)("BABYLON.CylinderShapeBlock",class extends cG{constructor(U){super(U),this._tempVector=L.pG.Zero(),this.registerInput("particle",mC.Particle),this.registerInput("radius",mC.Float,!0,1),this.registerInput("height",mC.Float,!0,1,0),this.registerInput("radiusRange",mC.Float,!0,1,0,1),this.registerInput("directionRandomizer",mC.Float,!0,0,0,1),this.registerOutput("output",mC.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const G=this.particle.getConnectedValue(U);G._directionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.directionRandomizer.getConnectedValue(U);C.position.subtractToRef(U.emitterPosition,this._tempVector),this._tempVector.normalize(),U.isEmitterTransformNode&&L.pG.TransformNormalToRef(this._tempVector,U.emitterInverseWorldMatrix,this._tempVector);const l=(0,P.RandomRange)(-X/2,X/2);let t=Math.atan2(this._tempVector.x,this._tempVector.z);t+=(0,P.RandomRange)(-Math.PI/2,Math.PI/2)*X,this._tempVector.y=l,this._tempVector.x=Math.sin(t),this._tempVector.z=Math.cos(t),this._tempVector.normalize(),U.isEmitterTransformNode?L.pG.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U.emitterWorldMatrix,C.direction):C.direction.L(this._tempVector)},G._positionCreation.process=C=>{U.particleContext=C,U.systemContext=G;const X=this.height.getConnectedValue(U),l=this.radiusRange.getConnectedValue(U),t=this.radius.getConnectedValue(U),E=(0,P.RandomRange)(-X/2,X/2),K=(0,P.RandomRange)(0,2*Math.PI),O=(0,P.RandomRange)((1-l)*(1-l),1),T=Math.sqrt(O)*t,D=T*Math.cos(K),y=T*Math.sin(K);U.isEmitterTransformNode?L.pG.TransformCoordinatesFromFloatsToRef(D,E,y,U.emitterWorldMatrix,C.position):(C.position.WE(D,E,y),C.position.addInPlace(U.emitterPosition))},this.output._storedValue=G}});class PC extends cG{constructor(U){super(U),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",mC.Particle),this.registerOutput("output",mC.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const G=this.particle.getConnectedValue(U);G._isAnimationSheetEnabled=!0,G.spriteCellWidth=this.width,G.spriteCellHeight=this.height,G.startSpriteCellID=this.start,G.endSpriteCellID=this.end,G.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=G}serialize(){const U=super.serialize();return U.width=this.width,U.height=this.height,U.start=this.start,U.end=this.end,U.randomStartCell=this.randomStartCell,U}_deserialize(U){super._deserialize(U),this.width=U.width,this.height=U.height,this.start=U.start,this.end=U.end,this.randomStartCell=U.randomStartCell}}(0,q.d)([RG("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PC.prototype,"start",void 0),(0,q.d)([RG("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PC.prototype,"end",void 0),(0,q.d)([RG("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PC.prototype,"width",void 0),(0,q.d)([RG("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PC.prototype,"height",void 0),(0,q.d)([RG("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],PC.prototype,"loop",void 0),(0,q.d)([RG("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],PC.prototype,"randomStartCell",void 0),(0,E.e)("BABYLON.SetupSpriteSheetBlock",PC);class OC extends cG{constructor(U){super(U),this.reference=0,this.registerInput("value",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case mC.Float:return mC.FloatGradient;case mC.Vector2:return mC.Vector2Gradient;case mC.pG:return mC.Vector3Gradient;case mC.JE:return mC.Color4Gradient}return U},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(mC.Float|mC.Vector2|mC.pG|mC.JE)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=U=>null}serialize(){const U=super.serialize();return U.reference=this.reference,U}_deserialize(U){super._deserialize(U),this.reference=U.reference}}(0,q.d)([RG("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],OC.prototype,"reference",void 0),(0,E.e)("BABYLON.ParticleGradientValueBlock",OC);(0,E.e)("BABYLON.ParticleGradientBlock",class extends cG{constructor(U){super(U),this._entryCount=1,this.registerInput("gradient",mC.Float,!0,1,0,1),this.registerInput("value0",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case mC.FloatGradient:return mC.Float;case mC.Vector2Gradient:return mC.Vector2;case mC.Vector3Gradient:return mC.pG;case mC.Color4Gradient:return mC.JE}return U},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(mC.FloatGradient|mC.Vector2Gradient|mC.Vector3Gradient|mC.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(U){this._inputs[U].onConnectionObservable.add((()=>{this._entryCount>U||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),mC.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const U=[];for(let C=1;C<this._inputs.length;C++){var G;if(this._inputs[C].isConnected)U.push(null===(G=this._inputs[C].connectedPoint)||void 0===G?void 0:G.ownerBlock)}U.sort(((U,G)=>U.reference-G.reference)),this.output._storedFunction=G=>{const C=this.gradient.getConnectedValue(G);if(1===U.length)return U[0].value.getConnectedValue(G);let X=null;for(let l=U.length-1;l>=0;l--){const E=U[l];if(E.reference<=C){const U=E.value.getConnectedValue(G);if(X){const l=X.value.getConnectedValue(G),K=X.reference,O=E.reference,T=Math.max(0,Math.min(1,(C-O)/(K-O)));switch(this.output.type){case mC.Float:return(0,P.Lerp)(U,l,T);case mC.Vector2:return L.Vector2.Lerp(U,l,T);case mC.pG:return L.pG.Lerp(U,l,T);case mC.JE:return t.JE.Lerp(U,l,T)}}return U}X=E}return 0}}});(0,E.e)("BABYLON.ParticleConverterBlock",class extends cG{constructor(U){super(U),this.registerInput("color ",mC.JE,!0),this.registerInput("xyz ",mC.pG,!0),this.registerInput("xy ",mC.Vector2,!0),this.registerInput("zw ",mC.Vector2,!0),this.registerInput("x ",mC.Float,!0),this.registerInput("y ",mC.Float,!0),this.registerInput("z ",mC.Float,!0),this.registerInput("w ",mC.Float,!0),this.registerOutput("color",mC.JE),this.registerOutput("xyz",mC.pG),this.registerOutput("xy",mC.Vector2),this.registerOutput("zw",mC.Vector2),this.registerOutput("x",mC.Float),this.registerOutput("y",mC.Float),this.registerOutput("z",mC.Float),this.registerOutput("w",mC.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(U){return"color "===U?"colorIn":"xyz "===U?"xyzIn":"xy "===U?"xyIn":"zw "===U?"zwIn":"x "===U?"xIn":"y "===U?"yIn":"z "===U?"zIn":"w "===U?"wIn":U}_outputRename(U){switch(U){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return U}}_build(U){super._build(U);const G=this.xIn,C=this.yIn,X=this.zIn,l=this.wIn,E=this.xyIn,K=this.zwIn,P=this.xyzIn,O=this.colorIn,T=this.colorOut,D=this.xyzOut,y=this.xyOut,V=this.zwOut,p=this.xOut,I=this.yOut,H=this.zOut,x=this.wOut,h=U=>{if(O.isConnected)return O.getConnectedValue(U);let L=0,T=0,D=0,y=0;if(G.isConnected&&(L=G.getConnectedValue(U)),C.isConnected&&(T=C.getConnectedValue(U)),X.isConnected&&(D=X.getConnectedValue(U)),l.isConnected&&(y=l.getConnectedValue(U)),E.isConnected){const G=E.getConnectedValue(U);G&&(L=G.x,T=G.y)}if(K.isConnected){const G=K.getConnectedValue(U);G&&(D=G.x,y=G.y)}if(P.isConnected){const G=P.getConnectedValue(U);G&&(L=G.x,T=G.y,D=G.z)}return new t.JE(L,T,D,y)};T._storedFunction=U=>h(U),D._storedFunction=U=>{const G=h(U);return new L.pG(G.r,G.g,G.b)},y._storedFunction=U=>{const G=h(U);return new L.Vector2(G.r,G.g)},V._storedFunction=U=>{const G=h(U);return new L.Vector2(G.b,G.a)},p._storedFunction=U=>h(U).r,I._storedFunction=U=>h(U).g,H._storedFunction=U=>h(U).b,x._storedFunction=U=>h(U).a}}),function(U){U[U.Cos=0]="Cos",U[U.Sin=1]="Sin",U[U.Abs=2]="Abs",U[U.Exp=3]="Exp",U[U.Exp2=4]="Exp2",U[U.Round=5]="Round",U[U.Floor=6]="Floor",U[U.Ceiling=7]="Ceiling",U[U.Sqrt=8]="Sqrt",U[U.Log=9]="Log",U[U.Tan=10]="Tan",U[U.ArcTan=11]="ArcTan",U[U.ArcCos=12]="ArcCos",U[U.ArcSin=13]="ArcSin",U[U.Sign=14]="Sign",U[U.Negate=15]="Negate",U[U.OneMinus=16]="OneMinus",U[U.Reciprocal=17]="Reciprocal",U[U.ToDegrees=18]="ToDegrees",U[U.ToRadians=19]="ToRadians",U[U.Fract=20]="Fract"}(eG||(eG={}));class TC extends cG{constructor(U){super(U),this.operation=eG.Cos,this.registerInput("input",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(mC.Float|mC.Int|mC.Vector2|mC.pG|mC.JE)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);let G=null;switch(this.operation){case eG.Cos:G=U=>Math.cos(U);break;case eG.Sin:G=U=>Math.sin(U);break;case eG.Abs:G=U=>Math.abs(U);break;case eG.Exp:G=U=>Math.exp(U);break;case eG.Exp2:G=U=>Math.pow(2,U);break;case eG.Round:G=U=>Math.round(U);break;case eG.Floor:G=U=>Math.floor(U);break;case eG.Ceiling:G=U=>Math.ceil(U);break;case eG.Sqrt:G=U=>Math.sqrt(U);break;case eG.Log:G=U=>Math.log(U);break;case eG.Tan:G=U=>Math.tan(U);break;case eG.ArcTan:G=U=>Math.atan(U);break;case eG.ArcCos:G=U=>Math.acos(U);break;case eG.ArcSin:G=U=>Math.asin(U);break;case eG.Sign:G=U=>Math.sign(U);break;case eG.Negate:G=U=>-U;break;case eG.OneMinus:G=U=>1-U;break;case eG.Reciprocal:G=U=>1/U;break;case eG.ToRadians:G=U=>U*Math.PI/180;break;case eG.ToDegrees:G=U=>180*U/Math.PI;break;case eG.Fract:G=U=>U>=0?U-Math.floor(U):U-Math.ceil(U)}if(!G)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case mC.Int:case mC.Float:this.output._storedFunction=U=>{const C=this.input.getConnectedValue(U);return G(C)};break;case mC.Vector2:this.output._storedFunction=U=>{const C=this.input.getConnectedValue(U);return new L.Vector2(G(C.x),G(C.y))};break;case mC.pG:this.output._storedFunction=U=>{const C=this.input.getConnectedValue(U);return new L.pG(G(C.x),G(C.y),G(C.z))};break;case mC.JE:this.output._storedFunction=U=>{const C=this.input.getConnectedValue(U);return new t.JE(G(C.r),G(C.g),G(C.b),G(C.a))}}return this}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,q.d)([RG("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:eG.Cos},{label:"Sin",value:eG.Sin},{label:"Abs",value:eG.Abs},{label:"Exp",value:eG.Exp},{label:"Exp2",value:eG.Exp2},{label:"Round",value:eG.Round},{label:"Floor",value:eG.Floor},{label:"Ceiling",value:eG.Ceiling},{label:"Sqrt",value:eG.Sqrt},{label:"Log",value:eG.Log},{label:"Tan",value:eG.Tan},{label:"ArcTan",value:eG.ArcTan},{label:"ArcCos",value:eG.ArcCos},{label:"ArcSin",value:eG.ArcSin},{label:"Sign",value:eG.Sign},{label:"Negate",value:eG.Negate},{label:"OneMinus",value:eG.OneMinus},{label:"Reciprocal",value:eG.Reciprocal},{label:"ToDegrees",value:eG.ToDegrees},{label:"ToRadians",value:eG.ToRadians},{label:"Fract",value:eG.Fract}]})],TC.prototype,"operation",void 0),(0,E.e)("BABYLON.ParticleTrigonometryBlock",TC);var DC,yC=C(13845);class VC extends cG{constructor(U){super(U),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(mC.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(mC.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(mC.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(mC.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(mC.System),this._inputs[0].excludedConnectionPointTypes.push(mC.Particle),this._inputs[0].excludedConnectionPointTypes.push(mC.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const G=U=>{const G=this.input.getConnectedValue(U);if(this.log.length>=this.stackSize)return G;if(null===G||void 0===G)return this.log.push(["null",""]),G;switch(this.input.type){case mC.Vector2:this.log.push([(0,yC.d)(G,4),G.toString()]);break;case mC.pG:this.log.push([(0,yC.g)(G,4),G.toString()]);break;case mC.JE:this.log.push(["{R: ".concat(G.r.toFixed(4)," G: ").concat(G.g.toFixed(4)," B: ").concat(G.b.toFixed(4)," A: ").concat(G.a.toFixed(4),"}"),G.toString()]);break;default:this.log.push([G.toString(),G.toString()])}return G};this.output.isConnected?this.output._storedFunction=G:this.output._storedValue=G(U)}serialize(){const U=super.serialize();return U.stackSize=this.stackSize,U}_deserialize(U){super._deserialize(U),this.stackSize=U.stackSize}}(0,q.d)([RG("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],VC.prototype,"stackSize",void 0),(0,E.e)("BABYLON.ParticleDebugBlock",VC);(0,E.e)("BABYLON.ParticleElbowBlock",class extends cG{constructor(U){super(U),this.registerInput("input",mC.AutoDetect),this.registerOutput("output",mC.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const G=this._outputs[0],C=this._inputs[0];G._storedFunction=U=>C.getConnectedValue(U)}});(0,E.e)("BABYLON.ParticleTeleportInBlock",class extends cG{get endpoints(){return this._endpoints}constructor(U){super(U),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",mC.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const G of this.endpoints)if(G.isAnAncestorOfType(U))return!0;return!1}isAnAncestorOf(U){for(const G of this.endpoints){if(G===U)return!0;if(G.isAnAncestorOf(U))return!0}return!1}attachToEndpoint(U){U.detach(),this._endpoints.push(U),U._entryPoint=this,U._outputs[0]._typeConnectionSource=this._inputs[0],U._tempEntryPointUniqueId=null,U.name="> "+this.name}detachFromEndpoint(U){const G=this._endpoints.indexOf(U);-1!==G&&(this._endpoints.splice(G,1),U._outputs[0]._typeConnectionSource=null,U._entryPoint=null)}_build(){for(const U of this._endpoints)U.output._storedFunction=U=>this.input.getConnectedValue(U)}});(0,E.e)("BABYLON.ParticleTeleportOutBlock",class extends cG{constructor(U){super(U),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",mC.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(U){this.entryPoint&&this.entryPoint.build(U)}clone(){const U=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(U),U}serialize(){var U,G;const C=super.serialize();return C.entryPoint=null!==(U=null===(G=this.entryPoint)||void 0===G?void 0:G.uniqueId)&&void 0!==U?U:"",C}_deserialize(U){super._deserialize(U),this._tempEntryPointUniqueId=U.entryPoint}}),function(U){U[U.Equal=0]="Equal",U[U.NotEqual=1]="NotEqual",U[U.LessThan=2]="LessThan",U[U.GreaterThan=3]="GreaterThan",U[U.LessOrEqual=4]="LessOrEqual",U[U.GreaterOrEqual=5]="GreaterOrEqual",U[U.Xor=6]="Xor",U[U.Or=7]="Or",U[U.And=8]="And"}(DC||(DC={}));class pC extends cG{constructor(U){super(U),this.test=DC.Equal,this.epsilon=0,this.registerInput("left",mC.Float),this.registerInput("right",mC.Float,!0,0),this.registerInput("ifTrue",mC.AutoDetect,!0,1),this.registerInput("ifFalse",mC.AutoDetect,!0,0),this.registerOutput("output",mC.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=mC.Float,this._inputs[0].acceptedConnectionPointTypes.push(mC.Int),this._inputs[1].acceptedConnectionPointTypes.push(mC.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const U=U=>{const G=this.left.getConnectedValue(U),C=this.right.getConnectedValue(U);let L=!1;switch(this.test){case DC.Equal:L=(0,P.WithinEpsilon)(G,C,this.epsilon);break;case DC.NotEqual:L=!(0,P.WithinEpsilon)(G,C,this.epsilon);break;case DC.LessThan:L=G<C+this.epsilon;break;case DC.GreaterThan:L=G>C-this.epsilon;break;case DC.LessOrEqual:L=G<=C+this.epsilon;break;case DC.GreaterOrEqual:L=G>=C-this.epsilon;break;case DC.Xor:L=!!G&&!C||!G&&!!C;break;case DC.Or:L=!!G||!!C;break;case DC.And:L=!!G&&!!C}return L};this.output._storedFunction=G=>U(G)?this.ifTrue.getConnectedValue(G):this.ifFalse.getConnectedValue(G)}serialize(){const U=super.serialize();return U.test=this.test,U.epsilon=this.epsilon,U}_deserialize(U){super._deserialize(U),this.test=U.test,void 0!==U.epsilon&&(this.epsilon=U.epsilon)}}(0,q.d)([RG("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:DC.Equal},{label:"NotEqual",value:DC.NotEqual},{label:"LessThan",value:DC.LessThan},{label:"GreaterThan",value:DC.GreaterThan},{label:"LessOrEqual",value:DC.LessOrEqual},{label:"GreaterOrEqual",value:DC.GreaterOrEqual},{label:"Xor",value:DC.Xor},{label:"Or",value:DC.Or},{label:"And",value:DC.And}]})],pC.prototype,"test",void 0),(0,q.d)([RG("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pC.prototype,"epsilon",void 0),(0,E.e)("BABYLON.ParticleConditionBlock",pC);class IC extends cG{constructor(U){super(U),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",mC.Particle),this.registerInput("condition",mC.Float,!0,0),this.registerInput("system",mC.System),this.registerOutput("output",mC.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){this._triggerCount=0;const G=this.input.getConnectedValue(U),C={process:C=>{if(U.particleContext=C,U.systemContext=G,0!==this.condition.getConnectedValue(U)&&(0===this.limit||this._triggerCount<this.limit)){const L=(new Date).getTime();if(this._previousOne&&L-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=L;const X=this.system.getConnectedValue(U);if(X){const L=fG(X,U.HG,C.position);L.aE.addOnce((()=>{this._triggerCount--})),G.aE.addOnce((()=>{L.dispose()}))}}},previousItem:null,nextItem:null};G._updateQueueStart?jU(C,G._updateQueueStart):G._updateQueueStart=C,this.output._storedValue=G}serialize(){const U=super.serialize();return U.limit=this.limit,U.delay=this.delay,U}_deserialize(U){super._deserialize(U),void 0!==U.limit&&(this.limit=U.limit),void 0!==U.delay&&(this.delay=U.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,q.d)([RG("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IC.prototype,"limit",void 0),(0,q.d)([RG("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IC.prototype,"delay",void 0),(0,E.e)("BABYLON.ParticleTriggerBlock",IC);C(13852),C(13859),C(13869),C(13912)},13899:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneFragment",l="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13871:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneFragmentDeclaration",l="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13931:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneVertex",l="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13919:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneVertexDeclaration",l="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13910:(U,G,C)=>{"use strict";var L=C(12808);const X="fogFragment",l="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13895:(U,G,C)=>{"use strict";var L=C(12808);const X="fogFragmentDeclaration",l="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13933:(U,G,C)=>{"use strict";var L=C(12808);const X="fogVertex",l="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13925:(U,G,C)=>{"use strict";var L=C(12808);const X="fogVertexDeclaration",l="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13886:(U,G,C)=>{"use strict";var L=C(12808);const X="helperFunctions",l="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13874:(U,G,C)=>{"use strict";var L=C(12808);const X="imageProcessingDeclaration",l="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13892:(U,G,C)=>{"use strict";var L=C(12808);const X="imageProcessingFunctions",l="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13879:(U,G,C)=>{"use strict";var L=C(12808);const X="logDepthDeclaration",l="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13905:(U,G,C)=>{"use strict";var L=C(12808);const X="logDepthFragment",l="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13942:(U,G,C)=>{"use strict";var L=C(12808);const X="logDepthVertex",l="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";L.d.IncludesShadersStoreWGSL[X]||(L.d.IncludesShadersStoreWGSL[X]=l)},13869:(U,G,C)=>{"use strict";C.r(G),C.d(G,{particlesPixelShaderWGSL:()=>t});var L=C(12808);C(13871),C(13874),C(13879),C(13886),C(13892),C(13895),C(13899),C(13905),C(13910);const X="particlesPixelShader",l="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";L.d.ShadersStoreWGSL[X]||(L.d.ShadersStoreWGSL[X]=l);const t={name:X,shader:l}},13912:(U,G,C)=>{"use strict";C.r(G),C.d(G,{particlesVertexShaderWGSL:()=>t});var L=C(12808);C(13919),C(13925),C(13879),C(13931),C(13933),C(13942);const X="particlesVertexShader",l="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";L.d.ShadersStoreWGSL[X]||(L.d.ShadersStoreWGSL[X]=l);const t={name:X,shader:l}},13788:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneFragment",l="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13857:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneFragmentDeclaration",l="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13810:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneVertex",l="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13865:(U,G,C)=>{"use strict";var L=C(12808);const X="clipPlaneVertexDeclaration",l="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13799:(U,G,C)=>{"use strict";var L=C(12808);const X="fogFragment",l="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13783:(U,G,C)=>{"use strict";var L=C(12808);const X="fogFragmentDeclaration",l="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13812:(U,G,C)=>{"use strict";var L=C(12808);const X="fogVertex",l="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13807:(U,G,C)=>{"use strict";var L=C(12808);const X="fogVertexDeclaration",l="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13769:(U,G,C)=>{"use strict";var L=C(12808);const X="helperFunctions",l="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13760:(U,G,C)=>{"use strict";var L=C(12808);const X="imageProcessingDeclaration",l="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13774:(U,G,C)=>{"use strict";var L=C(12808);const X="imageProcessingFunctions",l="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13766:(U,G,C)=>{"use strict";var L=C(12808);const X="logDepthDeclaration",l="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13793:(U,G,C)=>{"use strict";var L=C(12808);const X="logDepthFragment",l="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13818:(U,G,C)=>{"use strict";var L=C(12808);const X="logDepthVertex",l="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";L.d.IncludesShadersStore[X]||(L.d.IncludesShadersStore[X]=l)},13852:(U,G,C)=>{"use strict";C.r(G),C.d(G,{particlesPixelShader:()=>t});var L=C(12808);C(13857),C(13760),C(13766),C(13769),C(13774),C(13783),C(13788),C(13793),C(13799);const X="particlesPixelShader",l="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";L.d.ShadersStore[X]||(L.d.ShadersStore[X]=l);const t={name:X,shader:l}},13859:(U,G,C)=>{"use strict";C.r(G),C.d(G,{particlesVertexShader:()=>t});var L=C(12808);C(13865),C(13807),C(13766),C(13810),C(13812),C(13818);const X="particlesVertexShader",l="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";L.d.ShadersStore[X]||(L.d.ShadersStore[X]=l);const t={name:X,shader:l}},14194:(U,G,C)=>{"use strict";C.r(G),C.d(G,{FlowGraphGLTFDataProvider:()=>l});var L=C(14154),X=C(14134);class l extends L.b{constructor(U){var G,C;super();const L=U.glTF,l=(null===(G=L.animations)||void 0===G?void 0:G.map((U=>U._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",X.c,l);const t=(null===(C=L.nodes)||void 0===C?void 0:C.map((U=>U._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",X.c,t)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14073:(U,G,C)=>{"use strict";C.d(G,{b:()=>I,d:()=>V,e:()=>y,h:()=>p});var L=C(12896),X=C(13347),l=C(12934),t=C(14080);const E=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class K{constructor(U,G){this._gltf=U,this._infoTree=G}convert(U){let G,C=this._gltf,L=this._infoTree;if(!U.startsWith("/"))throw new Error("Path must start with a /");const X=U.split("/");if(X.shift(),X[X.length-1].includes(".length")){const U=X[X.length-1].split(".");X.pop(),X.push(...U)}let l=!1;for(const K of X){const X="length"===K;if(X&&!L.__array__)throw new Error("Path ".concat(U," is invalid"));if(L.__ignoreObjectTree__&&(l=!0),L.__array__&&!X)L=L.__array__;else if(L=L[K],!L)throw new Error("Path ".concat(U," is invalid"));if(!l)if(void 0===C){if(!E.find((G=>G.regex.test(U))))throw new Error("Path ".concat(U," is invalid"))}else if(!X){var t;C=null===(t=C)||void 0===t?void 0:t[K]}(L.__target__||X)&&(G=C)}return{object:G,info:L}}}function P(U,G,C,L){const X=O(U,G);return L?X[C][L]:X[C]}function O(U,G,C){var L,l,t;return null===(L=U._data)||void 0===L||null===(l=L[null!==(t=null===C||void 0===C?void 0:C.fillMode)&&void 0!==t?t:X.e.MATERIAL_TriangleFillMode])||void 0===l?void 0:l.babylonMaterial}function T(U,G){return{offset:{componentsCount:2,type:"Vector2",get:(C,X,l)=>{const t=P(C,l,U,G);return new L.Vector2(null===t||void 0===t?void 0:t.uOffset,null===t||void 0===t?void 0:t.vOffset)},getTarget:O,set:(C,L,X,l)=>{const t=P(L,l,U,G);t.uOffset=C.x,t.vOffset=C.y},getPropertyName:[()=>"".concat(U).concat(G?"."+G:"",".uOffset"),()=>"".concat(U).concat(G?"."+G:"",".vOffset")]},rotation:{type:"number",get:(C,L,X)=>{var l;return null===(l=P(C,X,U,G))||void 0===l?void 0:l.wAng},getTarget:O,set:(C,L,X,l)=>P(L,l,U,G).wAng=C,getPropertyName:[()=>"".concat(U).concat(G?"."+G:"",".wAng")]},scale:{componentsCount:2,type:"Vector2",get:(C,X,l)=>{const t=P(C,l,U,G);return new L.Vector2(null===t||void 0===t?void 0:t.uScale,null===t||void 0===t?void 0:t.vScale)},getTarget:O,set:(C,L,X,l)=>{const t=P(L,l,U,G);t.uScale=C.x,t.vScale=C.y},getPropertyName:[()=>"".concat(U).concat(G?"."+G:"",".uScale"),()=>"".concat(U).concat(G?"."+G:"",".vScale")]}}}const D={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:U=>{var G,C,X,l;return new L.Vector2(null!==(G=null===(C=U._babylonCamera)||void 0===C?void 0:C.orthoLeft)&&void 0!==G?G:0,null!==(X=null===(l=U._babylonCamera)||void 0===l?void 0:l.orthoRight)&&void 0!==X?X:0)},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.orthoLeft=U.x,G._babylonCamera.orthoRight=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:U=>{var G,C,X,l;return new L.Vector2(null!==(G=null===(C=U._babylonCamera)||void 0===C?void 0:C.orthoBottom)&&void 0!==G?G:0,null!==(X=null===(l=U._babylonCamera)||void 0===l?void 0:l.orthoTop)&&void 0!==X?X:0)},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.orthoBottom=U.x,G._babylonCamera.orthoTop=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:U=>{var G;return null===(G=U._babylonCamera)||void 0===G?void 0:G.maxZ},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var G;return null===(G=U._babylonCamera)||void 0===G?void 0:G.AE},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.AE=U)},getTarget:U=>U,getPropertyName:[()=>"AE"]}},perspective:{aspectRatio:{type:"number",get:U=>{var G;return null===(G=U._babylonCamera)||void 0===G?void 0:G.getEngine().getAspectRatio(U._babylonCamera)},getTarget:U=>U,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:U=>{var G;return null===(G=U._babylonCamera)||void 0===G?void 0:G.fov},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.fov=U)},getTarget:U=>U,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:U=>{var G;return null===(G=U._babylonCamera)||void 0===G?void 0:G.maxZ},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var G;return null===(G=U._babylonCamera)||void 0===G?void 0:G.AE},set:(U,G)=>{G._babylonCamera&&(G._babylonCamera.AE=U)},getTarget:U=>U,getPropertyName:[()=>"AE"]}}}},nodes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"pG",get:U=>{var G;return null===(G=U._babylonTransformNode)||void 0===G?void 0:G.position},set:(U,G)=>{var C;return null===(C=G._babylonTransformNode)||void 0===C?void 0:C.position.L(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:U=>{var G;return null===(G=U._babylonTransformNode)||void 0===G?void 0:G.rotationQuaternion},set:(U,G)=>{var C,L;return null===(C=G._babylonTransformNode)||void 0===C||null===(L=C.rotationQuaternion)||void 0===L?void 0:L.L(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"pG",get:U=>{var G;return null===(G=U._babylonTransformNode)||void 0===G?void 0:G.fE},set:(U,G)=>{var C;return null===(C=G._babylonTransformNode)||void 0===C?void 0:C.fE.L(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"fE"]},weights:{length:{type:"number",get:U=>U._numMorphTargets,getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(U,G)=>{var C,L;return void 0!==G?null===(C=U._primitiveBabylonMeshes)||void 0===C||null===(L=C[0].morphTargetManager)||void 0===L?void 0:L.getTarget(G).influence:void 0},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(U,G)=>[0],getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:U=>{var G,C,X;return L.Matrix.Compose(null===(G=U._babylonTransformNode)||void 0===G?void 0:G.fE,null===(C=U._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(X=U._babylonTransformNode)||void 0===X?void 0:X.position)},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:U=>{var G,C,X,l;const t=L.Matrix.Identity();let E=U.parent;for(;E&&E.parent;)E=E.parent;const K=(null===(G=U._babylonTransformNode)||void 0===G?void 0:G.position._isDirty)||(null===(C=U._babylonTransformNode)||void 0===C||null===(X=C.rotationQuaternion)||void 0===X?void 0:X._isDirty)||(null===(l=U._babylonTransformNode)||void 0===l?void 0:l.fE._isDirty);if(E){var P;const G=null===(P=E._babylonTransformNode)||void 0===P?void 0:P.eE(!0).invert();var O,T;if(G)null===(O=U._babylonTransformNode)||void 0===O||null===(T=O.eE(K))||void 0===T||T.multiplyToRef(G,t)}else U._babylonTransformNode&&t.L(U._babylonTransformNode.eE(K));return t},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:U=>{var G,C;return null===(G=U._babylonTransformNode)||void 0===G||null===(C=G.getChildren((U=>U instanceof t.e),!0)[0])||void 0===C?void 0:C.CK},getTarget:U=>{var G;return null===(G=U._babylonTransformNode)||void 0===G?void 0:G.getChildren((U=>U instanceof t.e),!0)[0]},set:(U,G)=>{if(G._babylonTransformNode){const C=G._babylonTransformNode.getChildren((U=>U instanceof t.e),!0)[0];C&&(C.CK=U)}}},color:{type:"hG",get:U=>{var G,C;return null===(G=U._babylonTransformNode)||void 0===G||null===(C=G.getChildren((U=>U instanceof t.e),!0)[0])||void 0===C?void 0:C.LK},getTarget:U=>{var G;return null===(G=U._babylonTransformNode)||void 0===G?void 0:G.getChildren((U=>U instanceof t.e),!0)[0]},set:(U,G)=>{if(G._babylonTransformNode){const C=G._babylonTransformNode.getChildren((U=>U instanceof t.e),!0)[0];C&&(C.LK=U)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"hG",get:(U,G,C)=>O(U,G,C).emissiveColor,set:(U,G,C,L)=>O(G,C,L).emissiveColor.L(U),getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:T("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(U,G,C)=>{var L;return null===(L=P(U,C,"bumpTexture"))||void 0===L?void 0:L.level},set:(U,G,C,L)=>{const X=P(G,L,"bumpTexture");X&&(X.level=U)},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:T("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(U,G,C)=>O(U,G,C).ambientTextureStrength,set:(U,G,C,L)=>{const X=O(G,C,L);X&&(X.ambientTextureStrength=U)},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:T("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"JE",get:(U,G,C)=>{const L=O(U,G,C);return l.JE.FromColor3(L.albedoColor,L.alpha)},set:(U,G,C,L)=>{const X=O(G,C,L);X.albedoColor.set(U.r,U.g,U.b),X.alpha=U.a},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:T("albedoTexture")}},metallicFactor:{type:"number",get:(U,G,C)=>O(U,G,C).metallic,set:(U,G,C,L)=>{const X=O(G,C,L);X&&(X.metallic=U)},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(U,G,C)=>O(U,G,C).roughness,set:(U,G,C,L)=>{const X=O(G,C,L);X&&(X.roughness=U)},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:T("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(U,G,C)=>O(U,G,C).anisotropy.CK,set:(U,G,C,L)=>{O(G,C,L).anisotropy.CK=U},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(U,G,C)=>O(U,G,C).anisotropy.angle,set:(U,G,C,L)=>{O(G,C,L).anisotropy.angle=U},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:T("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(U,G,C)=>O(U,G,C).clearCoat.CK,set:(U,G,C,L)=>{O(G,C,L).clearCoat.CK=U},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(U,G,C)=>O(U,G,C).clearCoat.roughness,set:(U,G,C,L)=>{O(G,C,L).clearCoat.roughness=U},getTarget:(U,G,C)=>O(U,G,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:T("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(U,G,C)=>{var L;return null===(L=O(U,G,C).clearCoat.bumpTexture)||void 0===L?void 0:L.level},getTarget:O,set:(U,G,C,L)=>O(G,C,L).clearCoat.bumpTexture.level=U},extensions:{KHR_texture_transform:T("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:T("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(U,G,C)=>O(U,G,C).subSurface.dispersion,getTarget:O,set:(U,G,C,L)=>O(G,C,L).subSurface.dispersion=U}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(U,G,C)=>O(U,G,C).emissiveIntensity,getTarget:O,set:(U,G,C,L)=>O(G,C,L).emissiveIntensity=U}},KHR_materials_ior:{ior:{type:"number",get:(U,G,C)=>O(U,G,C).indexOfRefraction,getTarget:O,set:(U,G,C,L)=>O(G,C,L).indexOfRefraction=U}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(U,G,C)=>O(U,G,C).iridescence.CK,getTarget:O,set:(U,G,C,L)=>O(G,C,L).iridescence.CK=U},iridescenceIor:{type:"number",get:(U,G,C)=>O(U,G,C).iridescence.indexOfRefraction,getTarget:O,set:(U,G,C,L)=>O(G,C,L).iridescence.indexOfRefraction=U},iridescenceTexture:{extensions:{KHR_texture_transform:T("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(U,G,C)=>O(U,G,C).iridescence.maximumThickness,getTarget:O,set:(U,G,C,L)=>O(G,C,L).iridescence.maximumThickness=U},iridescenceThicknessMinimum:{type:"number",get:(U,G,C)=>O(U,G,C).iridescence.minimumThickness,getTarget:O,set:(U,G,C,L)=>O(G,C,L).iridescence.minimumThickness=U},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:T("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"hG",get:(U,G,C)=>O(U,G,C).sheen.color,getTarget:O,set:(U,G,C,L)=>O(G,C,L).sheen.color.L(U)},sheenColorTexture:{extensions:{KHR_texture_transform:T("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(U,G,C)=>O(U,G,C).sheen.CK,getTarget:O,set:(U,G,C,L)=>O(G,C,L).sheen.CK=U},sheenRoughnessTexture:{extensions:{KHR_texture_transform:T("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(U,G,C)=>O(U,G,C).metallicF0Factor,getTarget:O,set:(U,G,C,L)=>O(G,C,L).metallicF0Factor=U,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"hG",get:(U,G,C)=>O(U,G,C).metallicReflectanceColor,getTarget:O,set:(U,G,C,L)=>O(G,C,L).metallicReflectanceColor.L(U),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:T("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:T("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(U,G,C)=>O(U,G,C).subSurface.refractionIntensity,getTarget:O,set:(U,G,C,L)=>O(G,C,L).subSurface.refractionIntensity=U,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:T("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(U,G,C)=>O(U,G,C).subSurface.translucencyIntensity,getTarget:O,set:(U,G,C,L)=>O(G,C,L).subSurface.translucencyIntensity=U},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:T("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"hG",get:(U,G,C)=>O(U,G,C).subSurface.translucencyColor,getTarget:O,set:(U,G,C,L)=>{var X;return U&&(null===(X=O(G,C,L).subSurface.translucencyColor)||void 0===X?void 0:X.L(U))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:T("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"hG",get:(U,G,C)=>O(U,G,C).subSurface.tintColor,getTarget:O,set:(U,G,C,L)=>O(G,C,L).subSurface.tintColor.L(U)},attenuationDistance:{type:"number",get:(U,G,C)=>O(U,G,C).subSurface.tintColorAtDistance,getTarget:O,set:(U,G,C,L)=>O(G,C,L).subSurface.tintColorAtDistance=U},thicknessFactor:{type:"number",get:(U,G,C)=>O(U,G,C).subSurface.maximumThickness,getTarget:O,set:(U,G,C,L)=>O(G,C,L).subSurface.maximumThickness=U},thicknessTexture:{extensions:{KHR_texture_transform:T("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,color:{type:"hG",get:U=>{var G;return null===(G=U._babylonLight)||void 0===G?void 0:G.LK},set:(U,G)=>{var C;return null===(C=G._babylonLight)||void 0===C?void 0:C.LK.L(U)},getTarget:U=>U._babylonLight,getPropertyName:[U=>"diffuse"]},CK:{type:"number",get:U=>{var G;return null===(G=U._babylonLight)||void 0===G?void 0:G.CK},set:(U,G)=>G._babylonLight?G._babylonLight.CK=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"intensity"]},range:{type:"number",get:U=>{var G;return null===(G=U._babylonLight)||void 0===G?void 0:G.range},set:(U,G)=>G._babylonLight?G._babylonLight.range=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"range"]},spot:{innerConeAngle:{type:"number",get:U=>{var G;return null===(G=U._babylonLight)||void 0===G?void 0:G.innerAngle},set:(U,G)=>G._babylonLight?G._babylonLight.innerAngle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"innerConeAngle"]},outerConeAngle:{type:"number",get:U=>{var G;return null===(G=U._babylonLight)||void 0===G?void 0:G.angle},set:(U,G)=>G._babylonLight?G._babylonLight.angle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTexture)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,CK:{type:"number",get:U=>{var G;return null===(G=U._babylonTexture)||void 0===G?void 0:G.level},set:(U,G)=>{G._babylonTexture&&(G._babylonTexture.level=U)},getTarget:U=>U._babylonTexture},rotation:{type:"Quaternion",get:U=>{var G;return U._babylonTexture&&L.Quaternion.FromRotationMatrix(null===(G=U._babylonTexture)||void 0===G?void 0:G.getReflectionTextureMatrix())},set:(U,G)=>{var C;G._babylonTexture&&(null!==(C=G._babylonTexture.wU())&&void 0!==C&&C.useRightHandedSystem||(U=L.Quaternion.Inverse(U)),L.Matrix.FromQuaternionToRef(U,G._babylonTexture.getReflectionTextureMatrix()))},getTarget:U=>U._babylonTexture}}}}},animations:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>{var G;return null===(G=U.primitives[0]._instanceData)||void 0===G?void 0:G.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function y(U){return new K(U,D)}function V(U){const G=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let C=D;for(const L of G)L&&(C=C[L]);if(C&&C.type&&C.get)return C}function p(U,G){const C=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let L=D;for(const X of C)X&&(L=L[X]);L&&L.type&&L.get&&(L.interpolation=G)}function I(U,G){const C=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let L=D;for(const X of C)if(X){if(!L[X]){if("?"===X){L.__ignoreObjectTree__=!0;continue}L[X]={},"__array__"===X&&(L[X].__target__=!0)}L=L[X]}Object.assign(L,G)}},14087:(U,G,C)=>{"use strict";C.r(G),C.d(G,{AnimationPropertyInfo:()=>P,TransformNodeAnimationPropertyInfo:()=>O,WeightAnimationPropertyInfo:()=>T,getQuaternion:()=>E,getVector3:()=>t,getWeights:()=>K});var L=C(13392),X=C(12896),l=C(14073);function t(U,G,C,L){return X.pG.NG(G,C).scaleInPlace(L)}function E(U,G,C,L){return X.Quaternion.NG(G,C).scaleInPlace(L)}function K(U,G,C,L){const X=new Array(U._numMorphTargets);for(let l=0;l<X.length;l++)X[l]=G[C++]*L;return X}class P{constructor(U,G,C,L){this.type=U,this.name=G,this.getValue=C,this.getStride=L}_buildAnimation(U,G,C){const X=new L.d(U,this.name,G,this.type);return X.setKeys(C),X}}class O extends P{buildAnimations(U,G,C,L){const X=[];return X.push({babylonAnimatable:U._babylonTransformNode,babylonAnimation:this._buildAnimation(G,C,L)}),X}}class T extends P{buildAnimations(U,G,C,X){const l=[];if(U._numMorphTargets)for(let t=0;t<U._numMorphTargets;t++){const E=new L.d("".concat(G,"_").concat(t),this.name,C,this.type);if(E.setKeys(X.map((U=>({frame:U.frame,inTangent:U.inTangent?U.inTangent[t]:void 0,value:U.value[t],outTangent:U.outTangent?U.outTangent[t]:void 0,interpolation:U.interpolation})))),U._primitiveBabylonMeshes)for(const G of U._primitiveBabylonMeshes)if(G.morphTargetManager){const U=G.morphTargetManager.getTarget(t),C=E.clone();U.animations.push(C),l.push({babylonAnimatable:U,babylonAnimation:C})}}return l}}(0,l.h)("/nodes/{}/translation",[new O(L.d.ANIMATIONTYPE_VECTOR3,"position",t,(()=>3))]),(0,l.h)("/nodes/{}/rotation",[new O(L.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",E,(()=>4))]),(0,l.h)("/nodes/{}/scale",[new O(L.d.ANIMATIONTYPE_VECTOR3,"fE",t,(()=>3))]),(0,l.h)("/nodes/{}/weights",[new T(L.d.ANIMATIONTYPE_FLOAT,"influence",K,(U=>U._numMorphTargets))])},14043:(U,G,C)=>{"use strict";class L{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((U,G)=>{this._resolve=U,this._reject=G}))}}var X=C(12896),l=C(12934),t=C(12718),E=C(13310),K=C(14045),P=C(14054),O=C(12721),T=C(13339),D=C(13392),y=C(13399),V=C(12763),p=C(12731),I=C(12737);class H{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(U){this._useTextureToStoreBoneMatrices=U,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(U){this._animationPropertiesOverride=U}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(U,G,C){this.name=U,this.id=G,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=X.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new O.e,this.bones=[],this._scene=C||V.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const L=this._scene.getEngine().getCaps();this._canUseTextureForBones=L.textureFloat&&L.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((U=>!U.getParent()))}getTransformMatrices(U){if(this.needInitialSkinMatrix){if(!U)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return U._bonesTransformMatrices||this.prepare(!0),U._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(U){return this.needInitialSkinMatrix&&U._transformMatrixTexture?U._transformMatrixTexture:this._transformMatrixTexture}wU(){return this._scene}toString(U){let G="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(G+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),U){G+=", Ranges: {";let U=!0;for(const C in this._ranges)U&&(G+=", ",U=!1),G+=C;G+="}"}return G}getBoneIndexByName(U){for(let G=0,C=this.bones.length;G<C;G++)if(this.bones[G].name===U)return G;return-1}createAnimationRange(U,G,C){if(!this._ranges[U]){this._ranges[U]=new y.b(U,G,C);for(let L=0,X=this.bones.length;L<X;L++)this.bones[L].animations[0]&&this.bones[L].animations[0].createRange(U,G,C)}}deleteAnimationRange(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,L=this.bones.length;C<L;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(U,G);this._ranges[U]=null}getAnimationRange(U){return this._ranges[U]||null}getAnimationRanges(){const U=[];let G;for(G in this._ranges)U.push(this._ranges[G]);return U}copyAnimationRange(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[G]||!U.getAnimationRange(G))return!1;let L=!0;const X=this._getHighestAnimationFrame()+1,l={},t=U.bones;let E,K;for(K=0,E=t.length;K<E;K++)l[t[K].name]=t[K];this.bones.length!==t.length&&(p.d.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(t.length)),L=!1);const P=C&&this.dimensionsAtRest&&U.dimensionsAtRest?this.dimensionsAtRest.divide(U.dimensionsAtRest):null;for(K=0,E=this.bones.length;K<E;K++){const U=this.bones[K].name,t=l[U];t?L=L&&this.bones[K].copyAnimationRange(t,G,X,C,P):(p.d.Warn("copyAnimationRange: not same rig, missing source bone "+U),L=!1)}const O=U.getAnimationRange(G);return O&&(this._ranges[G]=new y.b(G,O.from+X,O.to+X)),L}returnToRest(){for(const U of this.bones)-1!==U._index&&U.returnToRest()}_getHighestAnimationFrame(){let U=0;for(let G=0,C=this.bones.length;G<C;G++)if(this.bones[G].animations[0]){const C=this.bones[G].animations[0].getHighestFrame();U<C&&(U=C)}return U}beginAnimation(U,G,C,L){const X=this.getAnimationRange(U);return X?this._scene.beginAnimation(this,X.from,X.to,G,C,L):null}static MakeAnimationAdditive(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const L=U.getAnimationRange(C);if(!L)return null;const X=U._scene.getAllAnimatablesByTarget(U);let l=null;for(let E=0;E<X.length;E++){const U=X[E];if(U.fromFrame===(null===L||void 0===L?void 0:L.from)&&U.toFrame===(null===L||void 0===L?void 0:L.to)){l=U;break}}const t=U.getAnimatables();for(let E=0;E<t.length;E++){const U=t[E].animations;if(U)for(let L=0;L<U.length;L++)D.d.MakeAnimationAdditive(U[L],G,C)}return l&&(l.isAdditive=!0),U}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(U){this._meshesWithPoseMatrix.push(U)}_unregisterMeshWithPoseMatrix(U){const G=this._meshesWithPoseMatrix.indexOf(U);G>-1&&this._meshesWithPoseMatrix.splice(G,1)}_computeTransformMatrices(U,G){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const L=this.bones[C];L._childUpdateId++;const X=L.getParent();if(X?L.getLocalMatrix().multiplyToRef(X.getFinalMatrix(),L.getFinalMatrix()):G?L.getLocalMatrix().multiplyToRef(G,L.getFinalMatrix()):L.getFinalMatrix().L(L.getLocalMatrix()),-1!==L._index){const G=null===L._index?C:L._index;L.getAbsoluteInverseBindMatrix().multiplyToArray(L.getFinalMatrix(),U,16*G)}}this._identity.copyToArray(U,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const U=this.wU().getRenderId();if(this._currentRenderId===U)return;this._currentRenderId=U}if(this._numBonesWithLinkedTransformNode>0)for(const U of this.bones)if(U._linkedTransformNode){const G=U._linkedTransformNode;U.position=G.position,G.rotationQuaternion?U.rotationQuaternion=G.rotationQuaternion:U.rotation=G.rotation,U.fE=G.fE}if(this.needInitialSkinMatrix)for(const U of this._meshesWithPoseMatrix){const G=U.getPoseMatrix();let C=this._isDirty;if(U._bonesTransformMatrices&&U._bonesTransformMatrices.length===16*(this.bones.length+1)||(U._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==U){this._synchronizedWithMesh=U;for(const U of this.bones)if(!U.getParent()){U.getBindMatrix().multiplyToRef(G,X.TmpVectors.Matrix[1]),U._updateAbsoluteBindMatrices(X.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const G=4*(this.bones.length+1);U._transformMatrixTexture&&U._transformMatrixTexture.getSize().width===G||(U._transformMatrixTexture&&U._transformMatrixTexture.dispose(),U._transformMatrixTexture=T.b.CreateRGBATexture(U._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(U._bonesTransformMatrices,G),this.isUsingTextureForMatrices&&U._transformMatrixTexture&&U._transformMatrixTexture.update(U._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=T.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let U=0;U<this.bones.length;U++)this._animatables.push(this.bones[U])}return this._animatables}clone(U,G){const C=new H(U,G||U,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let L=0;L<this.bones.length;L++){const U=this.bones[L];let G=null;const X=U.getParent();if(X){const U=this.bones.indexOf(X);G=C.bones[U]}const l=new P.d(U.name,C,G,U.getBindMatrix().clone(),U.getRestMatrix().clone());l._index=U._index,U._linkedTransformNode&&l.linkTransformNode(U._linkedTransformNode),I.b.DeepCopy(U.animations,l.animations)}if(this._ranges){C._ranges={};for(const U in this._ranges){const G=this._ranges[U];G&&(C._ranges[U]=G.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const G of this.bones)for(const C of G.animations)C.enableBlending=!0,C.blendingSpeed=U}dispose(){if(this._meshesWithPoseMatrix.length=0,this.wU().stopAnimation(this),this.wU().removeSkeleton(this),this._parentContainer){const U=this._parentContainer.skeletons.indexOf(this);U>-1&&this._parentContainer.skeletons.splice(U,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const U={};U.name=this.name,U.id=this.id,this.dimensionsAtRest&&(U.dimensionsAtRest=this.dimensionsAtRest.sE()),U.bones=[],U.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var G;const L=this.bones[C],X=L.getParent(),l={parentBoneIndex:X?this.bones.indexOf(X):-1,index:L.getIndex(),name:L.name,id:L.id,matrix:L.getBindMatrix().sE(),rest:L.getRestMatrix().sE(),linkedTransformNodeId:null===(G=L.getTransformNode())||void 0===G?void 0:G.id};U.bones.push(l),L.length&&(l.length=L.length),L.metadata&&(l.metadata=L.metadata),L.animations&&L.animations.length>0&&(l.animation=L.animations[0].serialize()),U.ranges=[];for(const G in this._ranges){const C=this._ranges[G];if(!C)continue;const L={};L.name=G,L.from=C.from,L.to=C.to,U.ranges.push(L)}}return U}static Parse(U,G){const C=new H(U.name,U.id,G);let L;for(U.dimensionsAtRest&&(C.dimensionsAtRest=X.pG.NG(U.dimensionsAtRest)),C.needInitialSkinMatrix=U.needInitialSkinMatrix,L=0;L<U.bones.length;L++){const G=U.bones[L],l=U.bones[L].index;let t=null;G.parentBoneIndex>-1&&(t=C.bones[G.parentBoneIndex]);const E=G.rest?X.Matrix.NG(G.rest):null,K=new P.d(G.name,C,t,X.Matrix.NG(G.matrix),E,null,l);void 0!==G.id&&null!==G.id&&(K.id=G.id),G.length&&(K.length=G.length),G.metadata&&(K.metadata=G.metadata),G.animation&&K.animations.push(D.d.Parse(G.animation)),void 0!==G.linkedTransformNodeId&&null!==G.linkedTransformNodeId&&(C._hasWaitingData=!0,K._waitingTransformNodeId=G.linkedTransformNodeId)}if(U.ranges)for(L=0;L<U.ranges.length;L++){const G=U.ranges[L];C.createAnimationRange(G.name,G.from,G.to)}return C}computeAbsoluteMatrices(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||U)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(U)}getPoseMatrix(){let U=null;return this._meshesWithPoseMatrix.length>0&&(U=this._meshesWithPoseMatrix[0].getPoseMatrix()),U}sortBones(){const U=[],G=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,U,G);this.bones=U}_sortBones(U,G,C){if(C[U])return;C[U]=!0;const L=this.bones[U];if(!L)return;void 0===L._index&&(L._index=U);const X=L.getParent();X&&this._sortBones(this.bones.indexOf(X),G,C),G.push(L)}setCurrentPoseAsRest(){for(const U of this.bones)U.setCurrentPoseAsRest()}}var x=C(13178),h=C(13354),N=C(12873),b=C(13267),o=C(12957),w=C(13319),S=C(13280),v=C(13306),u=C(13403),d=C(12982),g=C(14021);class Z{set areUpdatesFrozen(U){U?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new d.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,U||(U=V.d.LastCreatedScene),this._scene=U,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const U=this._scene.getEngine().getCaps();this._canUseTextureForTargets=U.canUseGLVertexID&&U.textureFloat&&U.maxVertexTextureImageUnits>0&&U.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return Z.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?Z.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(U){this._numMaxInfluencers!==U&&(this._numMaxInfluencers=U,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(U){this._useTextureToStoreTargets!==U&&(this._useTextureToStoreTargets=U,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var U;return Z.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(U=this._scene)&&void 0!==U&&U.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(U){return this._activeTargets.data[U]}getTarget(U){return this._targets[U]}getTargetByName(U){for(const G of this._targets)if(G.name===U)return G;return null}addTarget(U){this._targets.push(U),this._targetInfluenceChangedObservers.push(U.onInfluenceChanged.add((U=>{this.areUpdatesFrozen&&U&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(U)}))),this._targetDataLayoutChangedObservers.push(U._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(U){const G=this._targets.indexOf(U);G>=0&&(this._targets.splice(G,1),U.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(G,1)[0]),U._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(G,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(U)}_bind(U){U.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),U.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),U.setTexture("morphTargets",this._targetStoreTexture),U.setInt("morphTargetCount",this.numInfluencers)}clone(){const U=new Z(this._scene);for(const G of this._targets)U.addTarget(G.clone());return U.enablePositionMorphing=this.enablePositionMorphing,U.enableNormalMorphing=this.enableNormalMorphing,U.enableTangentMorphing=this.enableTangentMorphing,U.enableUVMorphing=this.enableUVMorphing,U.enableUV2Morphing=this.enableUV2Morphing,U.enableColorMorphing=this.enableColorMorphing,U}serialize(){const U={};U.id=this.uniqueId,U.targets=[];for(const G of this._targets)U.targets.push(G.serialize());return U}_syncActiveTargets(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const G=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||G!==C)&&(this._mustSynchronize=!1,this.synchronize());let L=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let X=-1;for(const l of this._targets)if(X++,0!==l.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=Z.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(l),this._morphTargetTextureIndices[L]=X,this._tempInfluences[L++]=l.influence}this._morphTargetTextureIndices.length!==L&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,L)),this._influences&&this._influences.length===L||(this._influences=new Float32Array(L));for(let l=0;l<L;l++)this._influences[l]=this._tempInfluences[l];if(U&&this._scene)for(const l of this._scene.meshes)l.morphTargetManager===this&&(C?l._markSubMeshesAsAttributesDirty():l._syncGeometryWithMorphTargetManager())}synchronize(){var U;if(!this._scene||this.areUpdatesFrozen)return;const G=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(U=this._targetStoreTexture)||void 0===U||U.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>G.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const U=C.vertexCount;if(0===this._vertexCount)this._vertexCount=U;else if(this._vertexCount!==U)return void p.d.Error("Incompatible target. Targets must all have the same vertices count. Current vertex count: ".concat(this._vertexCount,', vertex count for target "').concat(C.name,'": ').concat(U))}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const U=G.getCaps().maxTextureSize;this._textureWidth>U&&(this._textureHeight=Math.ceil(this._textureWidth/U),this._textureWidth=U);const C=this._targets.length,L=new Float32Array(C*this._textureWidth*this._textureHeight*4);let X=0;for(let G=0;G<C;G++){const U=this._targets[G],C=U.getPositions(),l=U.getNormals(),t=U.getUVs(),E=U.getTangents(),K=U.getUV2s(),P=U.getColors();X=G*this._textureWidth*this._textureHeight*4;for(let G=0;G<this._vertexCount;G++)this._supportsPositions&&C&&(L[X]=C[3*G],L[X+1]=C[3*G+1],L[X+2]=C[3*G+2],X+=4),this._supportsNormals&&l&&(L[X]=l[3*G],L[X+1]=l[3*G+1],L[X+2]=l[3*G+2],X+=4),this._supportsUVs&&t&&(L[X]=t[2*G],L[X+1]=t[2*G+1],X+=4),this._supportsTangents&&E&&(L[X]=E[3*G],L[X+1]=E[3*G+1],L[X+2]=E[3*G+2],X+=4),this._supportsUV2s&&K&&(L[X]=K[2*G],L[X+1]=K[2*G+1],X+=4),this._supportsColors&&P&&(L[X]=P[4*G],L[X+1]=P[4*G+1],L[X+2]=P[4*G+2],L[X+3]=P[4*G+3],X+=4)}this._targetStoreTexture=g.b.CreateRGBATexture(L,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name="Morph texture_".concat(this.uniqueId)}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const U=this._parentContainer.morphTargetManagers.indexOf(this);U>-1&&this._parentContainer.morphTargetManagers.splice(U,1),this._parentContainer=null}for(const U of this._targets)this._scene.stopAnimation(U)}}static Parse(U,G){const C=new Z(G);for(const L of U.targets)C.addTarget(u.b.Parse(L,G));return C}}Z.EnableTextureStorage=!0,Z.MaxActiveMorphTargetsInVertexAttributeMode=8,Z.ConstantTargetCountForTextureMode=0;var F=C(14058),q=C(12772),a=C(13192);const k=new Map,n=k;function Q(U,G,C){mU(U)&&p.d.Warn("Extension with the name '".concat(U,"' already exists")),k.set(U,{isGLTFExtension:G,factory:C})}function mU(U){return k.delete(U)}var B=C(14073),M=C(13465),z=C(12969);class s{static Get(U,G,C){if(!G||void 0==C||!G[C])throw new Error("".concat(U,": Failed to find index (").concat(C,")"));return G[C]}static TryGet(U,G){return U&&void 0!=G&&U[G]?U[G]:null}static Assign(U){if(U)for(let G=0;G<U.length;G++)U[G].index=G}}function j(U){if(U.min&&U.max){const G=U.min,C=U.max,L=X.TmpVectors.pG[0].WE(G[0],G[1],G[2]),l=X.TmpVectors.pG[1].WE(C[0],C[1],C[2]);if(U.normalized&&5126!==U.componentType){let G=1;switch(U.componentType){case 5120:G=127;break;case 5121:G=255;break;case 5122:G=32767;break;case 5123:G=65535}const C=1/G;L.scaleInPlace(C),l.scaleInPlace(C)}return new a.c(L,l)}return null}class A{static RegisterExtension(U,G){Q(U,!1,G)}static UnregisterExtension(U){return mU(U)}get mK(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(U){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=U}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((U=>U.dispose&&U.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(U,G,C,L,X,l){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=G,this._assetContainer=C,this._loadData(L);let l=null;if(U){const G={};if(this._gltf.nodes)for(const U of this._gltf.nodes)U.name&&(G[U.name]=U.index);l=(U instanceof Array?U:[U]).map((U=>{const C=G[U];if(void 0===C)throw new Error("Failed to find node '".concat(U,"'"));return C}))}return await this._loadAsync(X,t,l,(()=>({meshes:this._getMeshes(),SD:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=U,this._loadData(G),await this._loadAsync(C,X,null,(()=>{}))}async _loadAsync(U,G,C,L){return await Promise.resolve().then((async()=>{this._rootUrl=U,this._uniqueRootUrl=!U.startsWith("file:")&&G?U:"".concat(U).concat(Date.now(),"/"),this._fileName=G,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const X="".concat(F.o[F.o.LOADING]," => ").concat(F.o[F.o.READY]),l="".concat(F.o[F.o.LOADING]," => ").concat(F.o[F.o.COMPLETE]);this._parent._startPerformanceCounter(X),this._parent._startPerformanceCounter(l),this._parent._setState(F.o.LOADING),this._extensionsOnLoading();const E=new Array;if(!this.parent.loadOnlyMaterials)if(C)E.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.HG||this._gltf.scenes&&this._gltf.scenes[0]){const U=s.Get("/scene",this._gltf.scenes,this._gltf.HG||0);E.push(this.loadSceneAsync("/scenes/".concat(U.index),U))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let U=0;U<this._gltf.materials.length;++U){const G=this._gltf.materials[U],C="/materials/"+U,L=x.c.TriangleFillMode;E.push(this._loadMaterialAsync(C,G,null,L,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&E.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&E.push(this._compileShadowGeneratorsAsync());const K=Promise.all(E).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.NK(!0);for(const U of this._babylonScene.materials){const G=U;void 0!==G.maxSimultaneousLights&&(G.maxSimultaneousLights=Math.max(G.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(F.o.READY),this._skipStartAnimationStep||this._startAnimations(),L()}));return await K.then((U=>(this._parent._endPerformanceCounter(X),t.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(l),this._parent._setState(F.o.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(U=>{this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()}))})),U)))})).catch((U=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()),U}))}_loadData(U){if(this._gltf=U.json,this._setupData(),U.bin){const G=this._gltf.buffers;if(G&&G[0]&&!G[0].uri){const C=G[0];(C.byteLength<U.bin.byteLength-3||C.byteLength>U.bin.byteLength)&&p.d.Warn("Binary buffer length (".concat(C.byteLength,") from JSON does not match chunk length (").concat(U.bin.byteLength,")")),this._bin=U.bin}else p.d.Warn("Unexpected BIN chunk")}}_setupData(){if(s.Assign(this._gltf.accessors),s.Assign(this._gltf.animations),s.Assign(this._gltf.buffers),s.Assign(this._gltf.bufferViews),s.Assign(this._gltf.cameras),s.Assign(this._gltf.images),s.Assign(this._gltf.materials),s.Assign(this._gltf.meshes),s.Assign(this._gltf.nodes),s.Assign(this._gltf.samplers),s.Assign(this._gltf.scenes),s.Assign(this._gltf.skins),s.Assign(this._gltf.textures),this._gltf.nodes){const U={};for(const C of this._gltf.nodes)if(C.children)for(const G of C.children)U[G]=C.index;const G=this._createRootNode();for(const C of this._gltf.nodes){const L=U[C.index];C.parent=void 0===L?G:this._gltf.nodes[L]}}}async _loadExtensionsAsync(){const U=[];if(n.forEach(((G,C)=>{var L;!1===(null===(L=this.parent.extensionOptions[C])||void 0===L?void 0:L.enabled)?G.isGLTFExtension&&this.isExtensionUsed(C)&&p.d.Warn("Extension ".concat(C," is used but has been explicitly disabled.")):G.isGLTFExtension&&!this.isExtensionUsed(C)||U.push((async()=>{const U=await G.factory(this);return U.name!==C&&p.d.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(U.name," !== ").concat(C)),this._parent.onExtensionLoadedObservable.notifyObservers(U),U})())})),this._extensions.push(...await Promise.all(U)),this._extensions.sort(((U,G)=>(U.order||Number.MAX_VALUE)-(G.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((U=>U.name===C&&U.enabled))){var G;if(!1===(null===(G=this.parent.extensionOptions[C])||void 0===G?void 0:G.enabled))throw new Error("Required extension ".concat(C," is disabled"));throw new Error("Required extension ".concat(C," is not available"))}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new v.d("__root__",this._babylonScene);this._rootBabylonMesh=U,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.NK(!1);const G={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case F.k.AUTO:this._babylonScene.useRightHandedSystem||(G.rotation=[0,1,0,0],G.scale=[1,1,-1],A._LoadTransform(G,this._rootBabylonMesh));break;case F.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(U),G}loadSceneAsync(U,G){const C=this._extensionsLoadSceneAsync(U,G);if(C)return C;const L=new Array;if(this.logOpen("".concat(U," ").concat(G.name||"")),G.nodes)for(const X of G.nodes){const G=s.Get("".concat(U,"/nodes/").concat(X),this._gltf.nodes,X);L.push(this.loadNodeAsync("/nodes/".concat(G.index),G,(U=>{U.parent=this._rootBabylonMesh})))}for(const X of this._postSceneLoadActions)X();return L.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(L).then((()=>{}))}_forEachPrimitive(U,G){if(U._primitiveBabylonMeshes)for(const C of U._primitiveBabylonMeshes)G(C)}_getGeometries(){const U=[],G=this._gltf.nodes;if(G)for(const C of G)this._forEachPrimitive(C,(G=>{const C=G.iE;C&&-1===U.indexOf(C)&&U.push(C)}));return U}_getMeshes(){const U=[];this._rootBabylonMesh instanceof S.c&&U.push(this._rootBabylonMesh);const G=this._gltf.nodes;if(G)for(const C of G)this._forEachPrimitive(C,(G=>{U.push(G)}));return U}_getTransformNodes(){const U=[],G=this._gltf.nodes;if(G)for(const C of G)C._babylonTransformNode&&"eT"===C._babylonTransformNode.getClassName()&&U.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&U.push(C._babylonTransformNodeForSkin);return U}_getSkeletons(){const U=[],G=this._gltf.skins;if(G)for(const C of G)C._data&&U.push(C._data.babylonSkeleton);return U}_getAnimationGroups(){const U=[],G=this._gltf.animations;if(G)for(const C of G)C._babylonAnimationGroup&&U.push(C._babylonAnimationGroup);return U}_startAnimations(){switch(this._parent.animationStartMode){case F.g.NONE:break;case F.g.FIRST:{const U=this._getAnimationGroups();0!==U.length&&U[0].start(!0);break}case F.g.ALL:{const U=this._getAnimationGroups();for(const G of U)G.start(!0);break}default:return void p.d.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}}loadNodeAsync(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const L=this._extensionsLoadNodeAsync(U,G,C);if(L)return L;if(G._babylonTransformNode)throw new Error("".concat(U,": Invalid recursive node hierarchy"));const X=new Array;this.logOpen("".concat(U," ").concat(G.name||""));const l=L=>{if(A.AddPointerMetadata(L,U),A._LoadTransform(G,L),void 0!=G.camera){const C=s.Get("".concat(U,"/camera"),this._gltf.cameras,G.camera);X.push(this.loadCameraAsync("/cameras/".concat(C.index),C,(U=>{U.parent=L,this._babylonScene.useRightHandedSystem||(L.fE.x=-1)})))}if(G.children)for(const C of G.children){const G=s.Get("".concat(U,"/children/").concat(C),this._gltf.nodes,C);X.push(this.loadNodeAsync("/nodes/".concat(G.index),G,(U=>{U.parent=L})))}C(L)},t=void 0!=G.mesh,E=this._parent.loadSkins&&void 0!=G.skin;if(!t||E){const U=G.name||"node".concat(G.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new b.b(U,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==G.mesh?G._babylonTransformNode=C:G._babylonTransformNodeForSkin=C,l(C)}if(t)if(E){const C=s.Get("".concat(U,"/mesh"),this._gltf.meshes,G.mesh);X.push(this._loadMeshAsync("/meshes/".concat(C.index),G,C,(C=>{const L=G._babylonTransformNodeForSkin;C.metadata=(0,M.b)(L.metadata,C.metadata||{});const l=s.Get("".concat(U,"/skin"),this._gltf.skins,G.skin);X.push(this._loadSkinAsync("/skins/".concat(l.index),G,l,(U=>{this._forEachPrimitive(G,(G=>{G.skeleton=U})),this._postSceneLoadActions.push((()=>{if(void 0!=l.skeleton){const U=s.Get("/skins/".concat(l.index,"/skeleton"),this._gltf.nodes,l.skeleton).parent;G.index===U.index?C.parent=L.parent:C.parent=U._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:L,skinnedNode:C})}))})))})))}else{const C=s.Get("".concat(U,"/mesh"),this._gltf.meshes,G.mesh);X.push(this._loadMeshAsync("/meshes/".concat(C.index),G,C,l))}return this.logClose(),Promise.all(X).then((()=>(this._forEachPrimitive(G,(U=>{const G=U;!G.isAnInstance&&G.iE&&G.iE.useBoundingInfoFromGeometry?U.aU():U.refreshBoundingInfo(!0,!0)})),G._babylonTransformNode)))}_loadMeshAsync(U,G,C,L){const X=C.primitives;if(!X||!X.length)throw new Error("".concat(U,": Primitives are missing"));void 0==X[0].index&&s.Assign(X);const l=new Array;this.logOpen("".concat(U," ").concat(C.name||""));const t=G.name||"node".concat(G.index);if(1===X.length){const L=C.primitives[0];l.push(this._loadMeshPrimitiveAsync("".concat(U,"/primitives/").concat(L.index),t,G,C,L,(U=>{G._babylonTransformNode=U,G._primitiveBabylonMeshes=[U]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,G._babylonTransformNode=new b.b(t,this._babylonScene),G._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G._primitiveBabylonMeshes=[];for(const L of X)l.push(this._loadMeshPrimitiveAsync("".concat(U,"/primitives/").concat(L.index),"".concat(t,"_primitive").concat(L.index),G,C,L,(U=>{U.parent=G._babylonTransformNode,G._primitiveBabylonMeshes.push(U)})))}return L(G._babylonTransformNode),this.logClose(),Promise.all(l).then((()=>G._babylonTransformNode))}_loadMeshPrimitiveAsync(U,G,C,L,X,l){const t=this._extensionsLoadMeshPrimitiveAsync(U,G,C,L,X,l);if(t)return t;this.logOpen("".concat(U));const E=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!L.primitives[0].targets;let K,P;if(E&&X._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,K=X._instanceData.babylonSourceMesh.createInstance(G),K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P=X._instanceData.promise;else{const l=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new v.d(G,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.sideOrientation=this._babylonScene.useRightHandedSystem?x.c.CounterClockWiseSideOrientation:x.c.ClockWiseSideOrientation,this._createMorphTargets(U,C,L,X,t),l.push(this._loadVertexDataAsync(U,X,t).then((async G=>await this._loadMorphTargetsAsync(U,X,t,G).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,G.FU(t),G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const O=A._GetDrawMode(U,X.mode);if(void 0==X.material){let U=this._defaultBabylonMaterialData[O];U||(U=this._createDefaultMaterial("__GLTFLoader._default",O),this._parent.onMaterialLoadedObservable.notifyObservers(U),this._defaultBabylonMaterialData[O]=U),t.material=U}else if(!this.parent.skipMaterials){const G=s.Get("".concat(U,"/material"),this._gltf.materials,X.material);l.push(this._loadMaterialAsync("/materials/".concat(G.index),G,t,O,(U=>{t.material=U})))}P=Promise.all(l),E&&(X._instanceData={babylonSourceMesh:t,promise:P}),K=t}return A.AddPointerMetadata(K,U),this._parent.onMeshLoadedObservable.notifyObservers(K),l(K),this.logClose(),P.then((()=>K))}_loadVertexDataAsync(U,G,C){const L=this._extensionsLoadVertexDataAsync(U,G,C);if(L)return L;const X=G.attributes;if(!X)throw new Error("".concat(U,": Attributes are missing"));const l=new Array,t=new w.d(C.name,this._babylonScene);if(void 0==G.indices)C.isUnIndexed=!0;else{const C=s.Get("".concat(U,"/indices"),this._gltf.accessors,G.indices);l.push(this._loadIndicesAccessorAsync("/accessors/".concat(C.index),C).then((U=>{t.setIndices(U)})))}const E=(G,L,E)=>{if(void 0==X[G])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(L)&&C._delayInfo.push(L);const K=s.Get("".concat(U,"/attributes/").concat(G),this._gltf.accessors,X[G]);l.push(this._loadVertexAccessorAsync("/accessors/".concat(K.index),K,L).then((U=>{if(U.getKind()===o.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const U=j(K);U&&(t._boundingInfo=U,t.useBoundingInfoFromGeometry=!0)}t.setVerticesBuffer(U,K.count)}))),L==o.e.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),E&&E(K)};return E("POSITION",o.e.PositionKind),E("NORMAL",o.e.NormalKind),E("TANGENT",o.e.TangentKind),E("TEXCOORD_0",o.e.UVKind),E("TEXCOORD_1",o.e.UV2Kind),E("TEXCOORD_2",o.e.UV3Kind),E("TEXCOORD_3",o.e.UV4Kind),E("TEXCOORD_4",o.e.UV5Kind),E("TEXCOORD_5",o.e.UV6Kind),E("JOINTS_0",o.e.MatricesIndicesKind),E("WEIGHTS_0",o.e.MatricesWeightsKind),E("JOINTS_1",o.e.MatricesIndicesExtraKind),E("WEIGHTS_1",o.e.MatricesWeightsExtraKind),E("COLOR_0",o.e.ColorKind,(U=>{"VEC4"===U.type&&(C.hasVertexAlpha=!0)})),Promise.all(l).then((()=>t))}_createMorphTargets(U,G,C,L,X){if(!L.targets||!this._parent.loadMorphTargets)return;if(void 0==G._numMorphTargets)G._numMorphTargets=L.targets.length;else if(L.targets.length!==G._numMorphTargets)throw new Error("".concat(U,": Primitives do not have the same number of targets"));const l=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,X.morphTargetManager=new Z(this._babylonScene),X.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.morphTargetManager.areUpdatesFrozen=!0;for(let t=0;t<L.targets.length;t++){const U=G.weights?G.weights[t]:C.weights?C.weights[t]:0,L=l?l[t]:"morphTarget".concat(t);X.morphTargetManager.addTarget(new u.b(L,U,X.wU()))}}_loadMorphTargetsAsync(U,G,C,L){if(!G.targets||!this._parent.loadMorphTargets)return Promise.resolve();const X=new Array,l=C.morphTargetManager;for(let t=0;t<l.numTargets;t++){const C=l.getTarget(t);X.push(this._loadMorphTargetVertexDataAsync("".concat(U,"/targets/").concat(t),L,G.targets[t],C))}return Promise.all(X).then((()=>{l.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(U,G,C,L){const X=new Array,l=(L,l,t)=>{if(void 0==C[L])return;const E=G.getVertexBuffer(l);if(!E)return;const K=s.Get("".concat(U,"/").concat(L),this._gltf.accessors,C[L]);X.push(this._loadFloatAccessorAsync("/accessors/".concat(K.index),K).then((U=>{t(E,U)})))};return l("POSITION",o.e.PositionKind,((U,G)=>{const C=new Float32Array(G.length);U.forEach(G.length,((U,L)=>{C[L]=G[L]+U})),L.setPositions(C)})),l("NORMAL",o.e.NormalKind,((U,G)=>{const C=new Float32Array(G.length);U.forEach(C.length,((U,L)=>{C[L]=G[L]+U})),L.setNormals(C)})),l("TANGENT",o.e.TangentKind,((U,G)=>{const C=new Float32Array(G.length/3*4);let X=0;U.forEach(G.length/3*4,((U,L)=>{(L+1)%4!==0&&(C[X]=G[X]+U,X++)})),L.setTangents(C)})),l("TEXCOORD_0",o.e.UVKind,((U,G)=>{const C=new Float32Array(G.length);U.forEach(G.length,((U,L)=>{C[L]=G[L]+U})),L.setUVs(C)})),l("TEXCOORD_1",o.e.UV2Kind,((U,G)=>{const C=new Float32Array(G.length);U.forEach(G.length,((U,L)=>{C[L]=G[L]+U})),L.setUV2s(C)})),l("COLOR_0",o.e.ColorKind,((G,C)=>{let X=null;const l=G.getSize();if(3===l){X=new Float32Array(C.length/3*4),G.forEach(C.length,((U,G)=>{const L=Math.floor(G/3),l=G%3;X[4*L+l]=C[3*L+l]+U}));for(let U=0;U<C.length/3;++U)X[4*U+3]=1}else{if(4!==l)throw new Error("".concat(U,": Invalid number of components (").concat(l,") for COLOR_0 attribute"));X=new Float32Array(C.length),G.forEach(C.length,((U,G)=>{X[G]=C[G]+U}))}L.setColors(X)})),await Promise.all(X).then((()=>{}))}static _LoadTransform(U,G){if(void 0!=U.skin)return;let C=X.pG.Zero(),L=X.Quaternion.Identity(),l=X.pG.One();if(U.matrix){X.Matrix.NG(U.matrix).decompose(l,L,C)}else U.translation&&(C=X.pG.NG(U.translation)),U.rotation&&(L=X.Quaternion.NG(U.rotation)),U.scale&&(l=X.pG.NG(U.scale));G.position=C,G.rotationQuaternion=L,G.fE=l}_loadSkinAsync(U,G,C,L){if(!this._parent.loadSkins)return Promise.resolve();const X=this._extensionsLoadSkinAsync(U,G,C);if(X)return X;if(C._data)return L(C._data.babylonSkeleton),C._data.promise;const l="skeleton".concat(C.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new H(C.name||l,l,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(U,C,t);const E=this._loadSkinInverseBindMatricesDataAsync(U,C).then((U=>{this._updateBoneMatrices(t,U)}));return C._data={babylonSkeleton:t,promise:E},L(t),E}_loadBones(U,G,C){if(void 0==G.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode("".concat(U,"/joints"),G.joints);if(C)if(void 0===G.skeleton)G.skeleton=C.index;else{const L=(U,G)=>{for(;G.parent;G=G.parent)if(G.parent===U)return!0;return!1},X=s.Get("".concat(U,"/skeleton"),this._gltf.nodes,G.skeleton);X===C||L(X,C)||(p.d.Warn("".concat(U,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),G.skeleton=C.index)}else p.d.Warn("".concat(U,": Failed to find common root"))}const L={};for(const X of G.joints){const l=s.Get("".concat(U,"/joints/").concat(X),this._gltf.nodes,X);this._loadBone(l,G,C,L)}}_findSkeletonRootNode(U,G){if(0===G.length)return null;const C={};for(const X of G){const G=[];let L=s.Get("".concat(U,"/").concat(X),this._gltf.nodes,X);for(;-1!==L.index;)G.unshift(L),L=L.parent;C[X]=G}let L=null;for(let X=0;;++X){let U=C[G[0]];if(X>=U.length)return L;const l=U[X];for(let t=1;t<G.length;++t)if(U=C[G[t]],X>=U.length||l!==U[X])return L;L=l}}_loadBone(U,G,C,L){U._isJoint=!0;let X=L[U.index];if(X)return X;let l=null;U.index!==G.skeleton&&(U.parent&&-1!==U.parent.index?l=this._loadBone(U.parent,G,C,L):void 0!==G.skeleton&&p.d.Warn("/skins/".concat(G.index,"/skeleton: Skeleton node is not a common root")));const t=G.joints.indexOf(U.index);return X=new P.d(U.name||"joint".concat(U.index),C,l,this._getNodeMatrix(U),null,null,t),L[U.index]=X,this._postSceneLoadActions.push((()=>{X.linkTransformNode(U._babylonTransformNode)})),X}_loadSkinInverseBindMatricesDataAsync(U,G){if(void 0==G.inverseBindMatrices)return Promise.resolve(null);const C=s.Get("".concat(U,"/inverseBindMatrices"),this._gltf.accessors,G.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(C.index),C)}_updateBoneMatrices(U,G){for(const C of U.bones){const U=X.Matrix.Identity(),L=C._index;G&&-1!==L&&(X.Matrix.FromArrayToRef(G,16*L,U),U.invertToRef(U));const l=C.getParent();l&&U.multiplyToRef(l.getAbsoluteInverseBindMatrix(),U),C.YE(U,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(U){return U.matrix?X.Matrix.NG(U.matrix):X.Matrix.Compose(U.scale?X.pG.NG(U.scale):X.pG.One(),U.rotation?X.Quaternion.NG(U.rotation):X.Quaternion.Identity(),U.translation?X.pG.NG(U.translation):X.pG.Zero())}loadCameraAsync(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const L=this._extensionsLoadCameraAsync(U,G,C);if(L)return L;const l=new Array;this.logOpen("".concat(U," ").concat(G.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new K.b(G.name||"camera".concat(G.index),X.pG.Zero(),this._babylonScene,!1);switch(t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G._babylonCamera=t,t.setTarget(new X.pG(0,0,-1)),G.type){case"perspective":{const C=G.perspective;if(!C)throw new Error("".concat(U,": Camera perspective properties are missing"));t.fov=C.yfov,t.AE=C.znear,t.maxZ=C.zfar||0;break}case"orthographic":if(!G.orthographic)throw new Error("".concat(U,": Camera orthographic properties are missing"));t.mode=E.d.ORTHOGRAPHIC_CAMERA,t.orthoLeft=-G.orthographic.xmag,t.orthoRight=G.orthographic.xmag,t.orthoBottom=-G.orthographic.ymag,t.orthoTop=G.orthographic.ymag,t.AE=G.orthographic.znear,t.maxZ=G.orthographic.zfar;break;default:throw new Error("".concat(U,": Invalid camera type (").concat(G.type,")"))}return A.AddPointerMetadata(t,U),this._parent.onCameraLoadedObservable.notifyObservers(t),C(t),this.logClose(),Promise.all(l).then((()=>t))}_loadAnimationsAsync(){const U=this._gltf.animations;if(!U)return Promise.resolve();const G=new Array;for(let C=0;C<U.length;C++){const L=U[C];G.push(this.loadAnimationAsync("/animations/".concat(L.index),L).then((U=>{0===U.targetedAnimations.length&&U.dispose()})))}return Promise.all(G).then((()=>{}))}loadAnimationAsync(U,G){const L=this._extensionsLoadAnimationAsync(U,G);return L||C.e(78).then(C.bind(C,15600)).then((C=>{let{AnimationGroup:L}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new L(G.name||"animation".concat(G.index),this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G._babylonAnimationGroup=X;const l=new Array;s.Assign(G.channels),s.Assign(G.samplers);for(const t of G.channels)l.push(this._loadAnimationChannelAsync("".concat(U,"/channels/").concat(t.index),U,G,t,((U,G)=>{U.animations=U.animations||[],U.animations.push(G),X.addTargetedAnimation(G,U)})));return Promise.all(l).then((()=>(X.normalize(0),X)))}))}async _loadAnimationChannelAsync(U,G,L,X,l){const t=this._extensionsLoadAnimationChannelAsync(U,G,L,X,l);if(t)return await t;if(void 0==X.target.node)return await Promise.resolve();const E=s.Get("".concat(U,"/target/node"),this._gltf.nodes,X.target.node),K=X.target.path,P="weights"===K;if(P&&!E._numMorphTargets||!P&&!E._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!P&&!E._isJoint)return await Promise.resolve();let O;switch(await Promise.resolve().then(C.bind(C,14087)),K){case"translation":var T;O=null===(T=(0,B.d)("/nodes/{}/translation"))||void 0===T?void 0:T.interpolation;break;case"rotation":var D;O=null===(D=(0,B.d)("/nodes/{}/rotation"))||void 0===D?void 0:D.interpolation;break;case"scale":var y;O=null===(y=(0,B.d)("/nodes/{}/scale"))||void 0===y?void 0:y.interpolation;break;case"weights":var V;O=null===(V=(0,B.d)("/nodes/{}/weights"))||void 0===V?void 0:V.interpolation;break;default:throw new Error("".concat(U,"/target/path: Invalid value (").concat(X.target.path,")"))}if(!O)throw new Error("".concat(U,"/target/path: Could not find interpolation properties for target path (").concat(X.target.path,")"));const p={object:E,info:O};return await this._loadAnimationChannelFromTargetInfoAsync(U,G,L,X,p,l)}_loadAnimationChannelFromTargetInfoAsync(U,G,C,L,X,l){const t=this.parent.targetFps,E=1/t,K=s.Get("".concat(U,"/sampler"),C.samplers,L.sampler);return this._loadAnimationSamplerAsync("".concat(G,"/samplers/").concat(L.sampler),K).then((U=>{let G=0;const K=X.object,P=X.info;for(const X of P){const P=X.getStride(K),O=U.input,T=U.output,D=new Array(O.length);let y=0;switch(U.interpolation){case"STEP":for(let U=0;U<O.length;U++){const G=X.getValue(K,T,y,1);y+=P,D[U]={frame:O[U]*t,value:G,interpolation:1}}break;case"CUBICSPLINE":for(let U=0;U<O.length;U++){const G=X.getValue(K,T,y,E);y+=P;const C=X.getValue(K,T,y,1);y+=P;const L=X.getValue(K,T,y,E);y+=P,D[U]={frame:O[U]*t,inTangent:G,value:C,outTangent:L}}break;case"LINEAR":for(let U=0;U<O.length;U++){const G=X.getValue(K,T,y,1);y+=P,D[U]={frame:O[U]*t,value:G}}}if(y>0){const U="".concat(C.name||"animation".concat(C.index),"_channel").concat(L.index,"_").concat(G),E=X.buildAnimations(K,U,t,D);for(const C of E)G++,l(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(U,G){if(G._data)return G._data;const C=G.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(U,"/interpolation: Invalid value (").concat(G.interpolation,")"))}const L=s.Get("".concat(U,"/input"),this._gltf.accessors,G.input),X=s.Get("".concat(U,"/output"),this._gltf.accessors,G.output);return G._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(L.index),L),this._loadFloatAccessorAsync("/accessors/".concat(X.index),X)]).then((U=>{let[G,L]=U;return{input:G,interpolation:C,output:L}})),G._data}loadBufferAsync(U,G,C,L){const X=this._extensionsLoadBufferAsync(U,G,C,L);if(X)return X;if(!G._data)if(G.uri)G._data=this.loadUriAsync("".concat(U,"/uri"),G,G.uri);else{if(!this._bin)throw new Error("".concat(U,": Uri is missing or the binary glTF is missing its binary chunk"));G._data=this._bin.readAsync(0,G.byteLength)}return G._data.then((G=>{try{return new Uint8Array(G.buffer,G.byteOffset+C,L)}catch(X){throw new Error("".concat(U,": ").concat(X.message))}}))}loadBufferViewAsync(U,G){const C=this._extensionsLoadBufferViewAsync(U,G);if(C)return C;if(G._data)return G._data;const L=s.Get("".concat(U,"/buffer"),this._gltf.buffers,G.buffer);return G._data=this.loadBufferAsync("/buffers/".concat(L.index),L,G.byteOffset||0,G.byteLength),G._data}_loadAccessorAsync(U,G,C){if(G._data)return G._data;const L=A._GetNumComponents(U,G.type),X=L*o.e.GetTypeByteLength(G.componentType),l=L*G.count;if(void 0==G.bufferView)G._data=Promise.resolve(new C(l));else{const t=s.Get("".concat(U,"/bufferView"),this._gltf.bufferViews,G.bufferView);G._data=this.loadBufferViewAsync("/bufferViews/".concat(t.index),t).then((E=>{if(5126!==G.componentType||G.normalized||t.byteStride&&t.byteStride!==X){const U=new C(l);return o.e.ForEach(E,G.byteOffset||0,t.byteStride||X,L,G.componentType,U.length,G.normalized||!1,((G,C)=>{U[C]=G})),U}return A._GetTypedArray(U,G.componentType,E,G.byteOffset,l)}))}if(G.sparse){const l=G.sparse;G._data=G._data.then((t=>{const E=t,K=s.Get("".concat(U,"/sparse/indices/bufferView"),this._gltf.bufferViews,l.indices.bufferView),P=s.Get("".concat(U,"/sparse/values/bufferView"),this._gltf.bufferViews,l.values.bufferView);return Promise.all([this.loadBufferViewAsync("/bufferViews/".concat(K.index),K),this.loadBufferViewAsync("/bufferViews/".concat(P.index),P)]).then((t=>{let[K,P]=t;const O=A._GetTypedArray("".concat(U,"/sparse/indices"),l.indices.componentType,K,l.indices.byteOffset,l.count),T=L*l.count;let D;if(5126!==G.componentType||G.normalized){const t=A._GetTypedArray("".concat(U,"/sparse/values"),G.componentType,P,l.values.byteOffset,T);D=new C(T),o.e.ForEach(t,0,X,L,G.componentType,D.length,G.normalized||!1,((U,G)=>{D[G]=U}))}else D=A._GetTypedArray("".concat(U,"/sparse/values"),G.componentType,P,l.values.byteOffset,T);let y=0;for(let U=0;U<O.length;U++){let G=O[U]*L;for(let U=0;U<L;U++)E[G++]=D[y++]}return E}))}))}return G._data}_loadFloatAccessorAsync(U,G){return this._loadAccessorAsync(U,G,Float32Array)}_loadIndicesAccessorAsync(U,G){if("SCALAR"!==G.type)throw new Error("".concat(U,"/type: Invalid value ").concat(G.type));if(5121!==G.componentType&&5123!==G.componentType&&5125!==G.componentType)throw new Error("".concat(U,"/componentType: Invalid value ").concat(G.componentType));if(G._data)return G._data;if(G.sparse){const C=A._GetTypedArrayConstructor("".concat(U,"/componentType"),G.componentType);G._data=this._loadAccessorAsync(U,G,C)}else{const C=s.Get("".concat(U,"/bufferView"),this._gltf.bufferViews,G.bufferView);G._data=this.loadBufferViewAsync("/bufferViews/".concat(C.index),C).then((C=>A._GetTypedArray(U,G.componentType,C,G.byteOffset,G.count)))}return G._data}_loadVertexBufferViewAsync(U){if(U._babylonBuffer)return U._babylonBuffer;const G=this._babylonScene.getEngine();return U._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(U.index),U).then((U=>new o.d(G,U,!1))),U._babylonBuffer}_loadVertexAccessorAsync(U,G,C){var L;if(null!==(L=G._babylonVertexBuffer)&&void 0!==L&&L[C])return G._babylonVertexBuffer[C];G._babylonVertexBuffer||(G._babylonVertexBuffer={});const X=this._babylonScene.getEngine();if(G.sparse||void 0==G.bufferView)G._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(U,G).then((U=>new o.e(X,U,C,!1)));else{const L=s.Get("".concat(U,"/bufferView"),this._gltf.bufferViews,G.bufferView);G._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(L).then((l=>{const t=A._GetNumComponents(U,G.type);return new o.e(X,l,C,!1,void 0,L.byteStride,void 0,G.byteOffset,t,G.componentType,G.normalized,!0,void 0,!0)}))}return G._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return G&&(G.baseColorFactor?(C.albedoColor=l.hG.NG(G.baseColorFactor),C.alpha=G.baseColorFactor[3]):C.albedoColor=l.hG.White(),C.metallic=void 0==G.metallicFactor?1:G.metallicFactor,C.roughness=void 0==G.roughnessFactor?1:G.roughnessFactor,G.baseColorTexture&&L.push(this.loadTextureInfoAsync("".concat(U,"/baseColorTexture"),G.baseColorTexture,(U=>{U.name="".concat(C.name," (Base Color)"),C.albedoTexture=U}))),G.metallicRoughnessTexture&&(G.metallicRoughnessTexture.nonColorData=!0,L.push(this.loadTextureInfoAsync("".concat(U,"/metallicRoughnessTexture"),G.metallicRoughnessTexture,(U=>{U.name="".concat(C.name," (Metallic Roughness)"),C.metallicTexture=U}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(L).then((()=>{}))}_loadMaterialAsync(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const l=this._extensionsLoadMaterialAsync(U,G,C,L,X);if(l)return l;G._data=G._data||{};let t=G._data[L];if(!t){this.logOpen("".concat(U," ").concat(G.name||""));const C=this.createMaterial(U,G,L);t={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(U,G,C)},G._data[L]=t,A.AddPointerMetadata(C,U),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(t.babylonMeshes.push(C),C.aE.addOnce((()=>{const U=t.babylonMeshes.indexOf(C);-1!==U&&t.babylonMeshes.splice(U,1)}))),X(t.babylonMaterial),t.promise.then((()=>t.babylonMaterial))}_createDefaultMaterial(U,G){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new h.c(U,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=G,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=h.c.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(U,G,C){const L=this._extensionsCreateMaterial(U,G,C);if(L)return L;const X=G.name||"material".concat(G.index);return this._createDefaultMaterial(X,C)}loadMaterialPropertiesAsync(U,G,C){const L=this._extensionsLoadMaterialPropertiesAsync(U,G,C);if(L)return L;const X=new Array;return X.push(this.loadMaterialBasePropertiesAsync(U,G,C)),G.pbrMetallicRoughness&&X.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(U,"/pbrMetallicRoughness"),G.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(U,G,C),Promise.all(X).then((()=>{}))}loadMaterialBasePropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return C.emissiveColor=G.emissiveFactor?l.hG.NG(G.emissiveFactor):new l.hG(0,0,0),G.doubleSided&&(C.RE=!1,C.twoSidedLighting=!0),G.normalTexture&&(G.normalTexture.nonColorData=!0,L.push(this.loadTextureInfoAsync("".concat(U,"/normalTexture"),G.normalTexture,(U=>{U.name="".concat(C.name," (Normal)"),C.bumpTexture=U}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=G.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=G.normalTexture.scale),C.forceIrradianceInFragment=!0),G.occlusionTexture&&(G.occlusionTexture.nonColorData=!0,L.push(this.loadTextureInfoAsync("".concat(U,"/occlusionTexture"),G.occlusionTexture,(U=>{U.name="".concat(C.name," (Occlusion)"),C.ambientTexture=U}))),C.useAmbientInGrayScale=!0,void 0!=G.occlusionTexture.strength&&(C.ambientTextureStrength=G.occlusionTexture.strength)),G.emissiveTexture&&L.push(this.loadTextureInfoAsync("".concat(U,"/emissiveTexture"),G.emissiveTexture,(U=>{U.name="".concat(C.name," (Emissive)"),C.emissiveTexture=U}))),Promise.all(L).then((()=>{}))}loadMaterialAlphaProperties(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));switch(G.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=h.c.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=h.c.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==G.alphaCutoff?.5:G.alphaCutoff,C.albedoTexture&&(C.albedoTexture.jE=!0);break;case"BLEND":C.transparencyMode=h.c.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.jE=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(U,"/alphaMode: Invalid value (").concat(G.alphaMode,")"))}}loadTextureInfoAsync(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const L=this._extensionsLoadTextureInfoAsync(U,G,C);if(L)return L;if(this.logOpen("".concat(U)),G.texCoord>=6)throw new Error("".concat(U,"/texCoord: Invalid value (").concat(G.texCoord,")"));const X=s.Get("".concat(U,"/index"),this._gltf.textures,G.index);X._textureInfo=G;const l=this._loadTextureAsync("/textures/".concat(G.index),X,(L=>{L.coordinatesIndex=G.texCoord||0,A.AddPointerMetadata(L,U),this._parent.onTextureLoadedObservable.notifyObservers(L),C(L)}));return this.logClose(),l}_loadTextureAsync(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const L=this._extensionsLoadTextureAsync(U,G,C);if(L)return L;this.logOpen("".concat(U," ").concat(G.name||""));const X=void 0==G.sampler?A.DefaultSampler:s.Get("".concat(U,"/sampler"),this._gltf.samplers,G.sampler),l=s.Get("".concat(U,"/source"),this._gltf.images,G.source),t=this._createTextureAsync(U,X,l,C,void 0,!G._textureInfo.nonColorData);return this.logClose(),t}_createTextureAsync(U,G,C){var X,l;let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},E=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;const P=this._loadSampler("/samplers/".concat(G.index),G),O=new Array,T=new L;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D={noMipmap:P.noMipMaps,invertY:!1,samplingMode:P.samplingMode,R:()=>{this._disposed||T.resolve()},onError:(G,C)=>{this._disposed||T.reject(new Error("".concat(U,": ").concat(C&&C.message?C.message:G||"Failed to load texture")))},mimeType:null!==(X=C.mimeType)&&void 0!==X?X:(0,q.g)(null!==(l=C.uri)&&void 0!==l?l:""),loaderOptions:E,useSRGBBuffer:!!K&&this._parent.useSRGBBuffers},y=new N.c(null,this._babylonScene,D);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.push(T.promise),O.push(this.loadImageAsync("/images/".concat(C.index),C).then((U=>{const G=C.uri||"".concat(this._fileName,"#image").concat(C.index),L="data:".concat(this._uniqueRootUrl).concat(G);y.updateURL(L,U);const X=y.getInternalTexture();X&&(X.label=C.name)}))),y.wrapU=P.wrapU,y.wrapV=P.wrapV,t(y),this._parent.useGltfTextureNames&&(y.name=C.name||C.uri||"image".concat(C.index)),Promise.all(O).then((()=>y))}_loadSampler(U,G){return G._data||(G._data={noMipMaps:9728===G.minFilter||9729===G.minFilter,samplingMode:A._GetTextureSamplingMode(U,G),wrapU:A._GetTextureWrapMode("".concat(U,"/wrapS"),G.wrapS),wrapV:A._GetTextureWrapMode("".concat(U,"/wrapT"),G.wrapT)}),G._data}loadImageAsync(U,G){if(!G._data){if(this.logOpen("".concat(U," ").concat(G.name||"")),G.uri)G._data=this.loadUriAsync("".concat(U,"/uri"),G,G.uri);else{const C=s.Get("".concat(U,"/bufferView"),this._gltf.bufferViews,G.bufferView);G._data=this.loadBufferViewAsync("/bufferViews/".concat(C.index),C)}this.logClose()}return G._data}loadUriAsync(U,G,C){const L=this._extensionsLoadUriAsync(U,G,C);if(L)return L;if(!A._ValidateUri(C))throw new Error("".concat(U,": '").concat(C,"' is invalid"));if((0,q.k)(C)){const G=new Uint8Array((0,q.d)(C));return this.log("".concat(U,": Decoded ").concat(C.substring(0,64),"... (").concat(G.length," bytes)")),Promise.resolve(G)}return this.log("".concat(U,": Loading ").concat(C)),this._parent.preprocessUrlAsync(this._rootUrl+C).then((G=>new Promise(((L,X)=>{this._parent._loadFile(this._babylonScene,G,(G=>{this._disposed||(this.log("".concat(U,": Loaded ").concat(C," (").concat(G.byteLength," bytes)")),L(new Uint8Array(G)))}),!0,(G=>{X(new q.o("".concat(U,": Failed to load '").concat(C,"'").concat(G?": "+G.status+" "+G.statusText:""),G))}))}))))}static AddPointerMetadata(U,G){U.metadata=U.metadata||{};const C=U._internalMetadata=U._internalMetadata||{},L=C.mK=C.mK||{};(L.pointers=L.pointers||[]).push(G)}static _GetTextureWrapMode(U,G){switch(G=void 0==G?10497:G){case 33071:return N.c.CLAMP_ADDRESSMODE;case 33648:return N.c.MIRROR_ADDRESSMODE;case 10497:return N.c.WRAP_ADDRESSMODE;default:return p.d.Warn("".concat(U,": Invalid value (").concat(G,")")),N.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(U,G){const C=void 0==G.magFilter?9729:G.magFilter,L=void 0==G.minFilter?9987:G.minFilter;if(9729===C)switch(L){case 9728:return N.c.LINEAR_NEAREST;case 9729:return N.c.LINEAR_LINEAR;case 9984:return N.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return N.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return N.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return N.c.LINEAR_LINEAR_MIPLINEAR;default:return p.d.Warn("".concat(U,"/minFilter: Invalid value (").concat(L,")")),N.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&p.d.Warn("".concat(U,"/magFilter: Invalid value (").concat(C,")")),L){case 9728:return N.c.NEAREST_NEAREST;case 9729:return N.c.NEAREST_LINEAR;case 9984:return N.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return N.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return N.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return N.c.NEAREST_LINEAR_MIPLINEAR;default:return p.d.Warn("".concat(U,"/minFilter: Invalid value (").concat(L,")")),N.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(U,G){try{return(0,z.o)(G)}catch(C){throw new Error("".concat(U,": ").concat(C.message))}}static _GetTypedArray(U,G,C,L,X){const l=C.buffer;L=C.byteOffset+(L||0);const t=A._GetTypedArrayConstructor("".concat(U,"/componentType"),G),E=o.e.GetTypeByteLength(G);return L%E!==0?(p.d.Warn("".concat(U,": Copying buffer as byte offset (").concat(L,") is not a multiple of component type byte length (").concat(E,")")),new t(l.slice(L,L+X*E),0)):new t(l,L,X)}static _GetNumComponents(U,G){switch(G){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(U,": Invalid type (").concat(G,")"))}static _ValidateUri(U){return t.Tools.IsBase64(U)||-1===U.indexOf("..")}static _GetDrawMode(U,G){switch(void 0==G&&(G=4),G){case 0:return x.c.PointListDrawMode;case 1:return x.c.LineListDrawMode;case 2:return x.c.LineLoopDrawMode;case 3:return x.c.LineStripDrawMode;case 4:return x.c.TriangleFillMode;case 5:return x.c.TriangleStripDrawMode;case 6:return x.c.TriangleFanDrawMode}throw new Error("".concat(U,": Invalid mesh primitive mode (").concat(G,")"))}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const U=new Array;if(this._gltf.materials)for(const G of this._gltf.materials)if(G._data)for(const C in G._data){const L=G._data[C];for(const G of L.babylonMeshes){G.eE(!0);const C=L.babylonMaterial;U.push(C.forceCompilationAsync(G)),U.push(C.forceCompilationAsync(G,{useInstances:!0})),this._parent.useClipPlane&&(U.push(C.forceCompilationAsync(G,{clipPlane:!0})),U.push(C.forceCompilationAsync(G,{clipPlane:!0,useInstances:!0})))}}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const U=new Array,G=this._babylonScene.lights;for(const C of G){const G=C.getShadowGenerator();G&&U.push(G.forceCompilationAsync())}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(U){for(const G of this._extensions)G.enabled&&U(G)}_applyExtensions(U,G,C){for(const L of this._extensions)if(L.enabled){const X="".concat(L.name,".").concat(G),l=U;l._activeLoaderExtensionFunctions=l._activeLoaderExtensionFunctions||{};const t=l._activeLoaderExtensionFunctions;if(!t[X]){t[X]=!0;try{const U=C(L);if(U)return U}finally{delete t[X]}}}return null}_extensionsOnLoading(){this._forEachExtensions((U=>U.onLoading&&U.onLoading()))}_extensionsOnReady(){this._forEachExtensions((U=>U.onReady&&U.onReady()))}_extensionsLoadSceneAsync(U,G){return this._applyExtensions(G,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(U,G)))}_extensionsLoadNodeAsync(U,G,C){return this._applyExtensions(G,"loadNode",(L=>L.loadNodeAsync&&L.loadNodeAsync(U,G,C)))}_extensionsLoadCameraAsync(U,G,C){return this._applyExtensions(G,"loadCamera",(L=>L.loadCameraAsync&&L.loadCameraAsync(U,G,C)))}_extensionsLoadVertexDataAsync(U,G,C){return this._applyExtensions(G,"loadVertexData",(L=>L._loadVertexDataAsync&&L._loadVertexDataAsync(U,G,C)))}_extensionsLoadMeshPrimitiveAsync(U,G,C,L,X,l){return this._applyExtensions(X,"loadMeshPrimitive",(t=>t._loadMeshPrimitiveAsync&&t._loadMeshPrimitiveAsync(U,G,C,L,X,l)))}_extensionsLoadMaterialAsync(U,G,C,L,X){return this._applyExtensions(G,"loadMaterial",(l=>l._loadMaterialAsync&&l._loadMaterialAsync(U,G,C,L,X)))}_extensionsCreateMaterial(U,G,C){return this._applyExtensions(G,"createMaterial",(L=>L.createMaterial&&L.createMaterial(U,G,C)))}_extensionsLoadMaterialPropertiesAsync(U,G,C){return this._applyExtensions(G,"loadMaterialProperties",(L=>L.loadMaterialPropertiesAsync&&L.loadMaterialPropertiesAsync(U,G,C)))}_extensionsLoadTextureInfoAsync(U,G,C){return this._applyExtensions(G,"loadTextureInfo",(L=>L.loadTextureInfoAsync&&L.loadTextureInfoAsync(U,G,C)))}_extensionsLoadTextureAsync(U,G,C){return this._applyExtensions(G,"loadTexture",(L=>L._loadTextureAsync&&L._loadTextureAsync(U,G,C)))}_extensionsLoadAnimationAsync(U,G){return this._applyExtensions(G,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(U,G)))}_extensionsLoadAnimationChannelAsync(U,G,C,L,X){return this._applyExtensions(C,"loadAnimationChannel",(l=>l._loadAnimationChannelAsync&&l._loadAnimationChannelAsync(U,G,C,L,X)))}_extensionsLoadSkinAsync(U,G,C){return this._applyExtensions(C,"loadSkin",(L=>L._loadSkinAsync&&L._loadSkinAsync(U,G,C)))}_extensionsLoadUriAsync(U,G,C){return this._applyExtensions(G,"loadUri",(L=>L._loadUriAsync&&L._loadUriAsync(U,G,C)))}_extensionsLoadBufferViewAsync(U,G){return this._applyExtensions(G,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(U,G)))}_extensionsLoadBufferAsync(U,G,C,L){return this._applyExtensions(G,"loadBuffer",(X=>X.loadBufferAsync&&X.loadBufferAsync(U,G,C,L)))}static LoadExtensionAsync(U,G,C,L){if(!G.extensions)return null;const X=G.extensions[C];return X?L("".concat(U,"/extensions/").concat(C),X):null}static LoadExtraAsync(U,G,C,L){if(!G.extras)return null;const X=G.extras[C];return X?L("".concat(U,"/extras/").concat(C),X):null}isExtensionUsed(U){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(U)}logOpen(U){this._parent._logOpen(U)}logClose(){this._parent._logClose()}log(U){this._parent._log(U)}startPerformanceCounter(U){this._parent._startPerformanceCounter(U)}endPerformanceCounter(U){this._parent._endPerformanceCounter(U)}}A.DefaultSampler={index:-1},F.c._CreateGLTF2Loader=U=>new A(U);var Y=C(14087),e=C(13064),i=C(12928),c=C(14093),R=C(14101);class W extends R.c{constructor(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",U),this._texture=U.getEngine().createRawCubeTexture(G,C,L,X,l,t,E,K)}update(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,U,G,C,L,X)}updateRGBDAsync(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,c.l)(this._texture,U,G,C,L).then((()=>{}))}clone(){return i.c.Clone((()=>{const U=this.wU(),G=this._texture,C=new W(U,G._bufferViewArray,G.width,G.format,G.type,G.generateMipMaps,G.invertY,G.samplingMode,G._compression);return 13===G.source&&C.updateRGBDAsync(G._bufferViewArrayArray,G._sphericalPolynomial,G._lodGenerationScale,G._lodGenerationOffset),C}),this)}}const f="EXT_lights_image_based";class r{constructor(U){this.name=f,this._loader=U,this.enabled=this._loader.isExtensionUsed(f)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.mK.extensions;if(U&&U[this.name]){const G=U[this.name];this._lights=G.lights}}loadSceneAsync(U,G){return A.LoadExtensionAsync(U,G,this.name,(async(C,L)=>{this._loader._allMaterialsDirtyRequired=!0;const X=new Array;X.push(this._loader.loadSceneAsync(U,G)),this._loader.logOpen("".concat(C));const l=s.Get("".concat(C,"/light"),this._lights,L.lt);return X.push(this._loadLightAsync("/extensions/".concat(this.name,"/lights/").concat(L.lt),l).then((U=>{this._loader.babylonScene.environmentTexture=U}))),this._loader.logClose(),await Promise.all(X).then((()=>{}))}))}_loadLightAsync(U,G){if(!G._loaded){const C=new Array;this._loader.logOpen("".concat(U));const L=new Array(G.specularImages.length);for(let X=0;X<G.specularImages.length;X++){const l=G.specularImages[X];L[X]=new Array(l.length);for(let G=0;G<l.length;G++){const t="".concat(U,"/specularImages/").concat(X,"/").concat(G);this._loader.logOpen("".concat(t));const E=l[G],K=s.Get(t,this._loader.mK.images,E);C.push(this._loader.loadImageAsync("/images/".concat(E),K).then((U=>{L[X][G]=U}))),this._loader.logClose()}}this._loader.logClose(),G._loaded=Promise.all(C).then((async()=>{const C=new W(this._loader.babylonScene,null,G.specularImageSize);if(C.name=G.name||"environment",G._babylonTexture=C,void 0!=G.CK&&(C.level=G.CK),G.rotation){let U=X.Quaternion.NG(G.rotation);this._loader.babylonScene.useRightHandedSystem||(U=X.Quaternion.Inverse(U)),X.Matrix.FromQuaternionToRef(U,C.getReflectionTextureMatrix())}if(!G.irradianceCoefficients)throw new Error("".concat(U,": Irradiance coefficients are missing"));const l=e.c.NG(G.irradianceCoefficients);l.scaleInPlace(G.CK),l.convertIrradianceToLambertianRadiance();const t=e.g.FromHarmonics(l),E=(L.length-1)/Math.log2(G.specularImageSize);return await C.updateRGBDAsync(L,t,E)}))}return G._loaded.then((()=>G._babylonTexture))}}mU(f),Q(f,!0,(U=>new r(U)));C(13439);const J="EXT_mesh_gpu_instancing";class UU{constructor(U){this.name=J,this._loader=U,this.enabled=this._loader.isExtensionUsed(J)}dispose(){this._loader=null}loadNodeAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(U,L)=>{this._loader._disableInstancedMesh++;const l=this._loader.loadNodeAsync("/nodes/".concat(G.index),G,C);if(this._loader._disableInstancedMesh--,!G._primitiveBabylonMeshes)return await l;const t=new Array;let E=0;const K=G=>{if(void 0==L.attributes[G])return void t.push(Promise.resolve(null));const C=s.Get("".concat(U,"/attributes/").concat(G),this._loader.mK.accessors,L.attributes[G]);if(t.push(this._loader._loadFloatAccessorAsync("/accessors/".concat(C.bufferView),C)),0===E)E=C.count;else if(E!==C.count)throw new Error("".concat(U,"/attributes: Instance buffer accessors do not have the same count."))};return K("TRANSLATION"),K("ROTATION"),K("SCALE"),await l.then((async U=>{const[C,L,l]=await Promise.all(t),K=new Float32Array(16*E);X.TmpVectors.pG[0].WE(0,0,0),X.TmpVectors.Quaternion[0].WE(0,0,0,1),X.TmpVectors.pG[1].WE(1,1,1);for(let G=0;G<E;++G)C&&X.pG.FromArrayToRef(C,3*G,X.TmpVectors.pG[0]),L&&X.Quaternion.FromArrayToRef(L,4*G,X.TmpVectors.Quaternion[0]),l&&X.pG.FromArrayToRef(l,3*G,X.TmpVectors.pG[1]),X.Matrix.ComposeToRef(X.TmpVectors.pG[1],X.TmpVectors.Quaternion[0],X.TmpVectors.pG[0],X.TmpVectors.Matrix[0]),X.TmpVectors.Matrix[0].copyToArray(K,16*G);for(const X of G._primitiveBabylonMeshes)X.AT("matrix",K,16,!0);return U}))}))}}mU(J),Q(J,!0,(U=>new UU(U)));let GU=0,CU=null;class LU{static get Default(){return LU._Default||(LU._Default=new LU),LU._Default}constructor(){const U=LU.Configuration.decoder;this._decoderModulePromise=t.Tools.LoadBabylonScriptAsync(U.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(U,G,C,L,X){await this._decoderModulePromise,0===GU&&(MeshoptDecoder.useWorkers(1),GU=1);const l=await MeshoptDecoder.decodeGltfBufferAsync(G,C,U,L,X);return null!==CU&&clearTimeout(CU),CU=setTimeout((()=>{MeshoptDecoder.useWorkers(0),GU=0,CU=null}),1e3),l}}LU.Configuration={decoder:{url:"".concat(t.Tools._DefaultCdnUrl,"/meshopt_decoder.js")}},LU._Default=null;const XU="EXT_meshopt_compression";class lU{constructor(U){this.name=XU,this.enabled=U.isExtensionUsed(XU),this._loader=U}dispose(){this._loader=null}loadBufferViewAsync(U,G){return A.LoadExtensionAsync(U,G,this.name,(async(C,L)=>{const X=G;if(X._meshOptData)return await X._meshOptData;const l=s.Get("".concat(U,"/buffer"),this._loader.mK.buffers,L.buffer);return X._meshOptData=this._loader.loadBufferAsync("/buffers/".concat(l.index),l,L.byteOffset||0,L.byteLength).then((async U=>await LU.Default.decodeGltfBufferAsync(U,L.count,L.byteStride,L.mode,L.filter))),await X._meshOptData}))}}mU(XU),Q(XU,!0,(U=>new lU(U)));const tU="EXT_texture_webp";class EU{constructor(U){this.name=tU,this._loader=U,this.enabled=U.isExtensionUsed(tU)}dispose(){this._loader=null}_loadTextureAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=void 0==G.sampler?A.DefaultSampler:s.Get("".concat(U,"/sampler"),this._loader.mK.samplers,G.sampler),t=s.Get("".concat(L,"/source"),this._loader.mK.images,X.source);return await this._loader._createTextureAsync(U,l,t,(U=>{C(U)}),void 0,!G._textureInfo.nonColorData)}))}}mU(tU),Q(tU,!0,(U=>new EU(U)));const KU="EXT_texture_avif";class PU{constructor(U){this.name=KU,this._loader=U,this.enabled=U.isExtensionUsed(KU)}dispose(){this._loader=null}_loadTextureAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=void 0==G.sampler?A.DefaultSampler:s.Get("".concat(U,"/sampler"),this._loader.mK.samplers,G.sampler),t=s.Get("".concat(L,"/source"),this._loader.mK.images,X.source);return await this._loader._createTextureAsync(U,l,t,(U=>{C(U)}),void 0,!G._textureInfo.nonColorData)}))}}mU(KU),Q(KU,!0,(U=>new PU(U)));var OU=C(14080),TU=C(13412);const DU="EXT_lights_ies";class yU{constructor(U){this.name=DU,this._loader=U,this.enabled=this._loader.isExtensionUsed(DU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.mK.extensions;if(U&&U[this.name]){const G=U[this.name];this._lights=G.lights,s.Assign(this._lights)}}loadNodeAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,t)=>{let E,K;this._loader._allMaterialsDirtyRequired=!0;const P=await this._loader.loadNodeAsync(U,G,(U=>{K=s.Get(L,this._lights,t.lt);const G=K.name||U.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,E=new OU.e(G,X.pG.Zero(),X.pG.Backward(),0,1,this._loader.babylonScene),E.angle=Math.PI/2,E.innerAngle=0,E._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,K._babylonLight=E,E.falloffType=TU.c.FALLOFF_GLTF,E.LK=t.color?l.hG.NG(t.color):l.hG.White(),E.CK=t.multiplier||1,E.range=Number.MAX_VALUE,E.parent=U,this._loader._babylonLights.push(E),A.AddPointerMetadata(E,L),C(U)}));let O;if(K.uri)O=await this._loader.loadUriAsync(U,K,K.uri);else{const G=s.Get("".concat(U,"/bufferView"),this._loader.mK.bufferViews,K.bufferView);O=await this._loader.loadBufferViewAsync("/bufferViews/".concat(G.index),G)}return E.iesProfileTexture=new N.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,O,!0,void 0,void 0,void 0,void 0,".ies"),P}))}}mU(DU),Q(DU,!0,(U=>new yU(U)));var VU=C(14110);const pU="KHR_draco_mesh_compression";class IU{constructor(U){this.name=pU,this.useNormalizedFlagFromAccessor=!0,this._loader=U,this.enabled=VU.b.DefaultAvailable&&this._loader.isExtensionUsed(pU)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{if(void 0!=G.mode&&4!==G.mode&&5!==G.mode)throw new Error("".concat(U,": Unsupported mode ").concat(G.mode));const l={},t={},E=(U,L)=>{const E=X.attributes[U];if(void 0!=E&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(L)&&C._delayInfo.push(L),l[L]=E,this.useNormalizedFlagFromAccessor)){const C=s.TryGet(this._loader.mK.accessors,G.attributes[U]);C&&(t[L]=C.normalized||!1)}};E("POSITION",o.e.PositionKind),E("NORMAL",o.e.NormalKind),E("TANGENT",o.e.TangentKind),E("TEXCOORD_0",o.e.UVKind),E("TEXCOORD_1",o.e.UV2Kind),E("TEXCOORD_2",o.e.UV3Kind),E("TEXCOORD_3",o.e.UV4Kind),E("TEXCOORD_4",o.e.UV5Kind),E("TEXCOORD_5",o.e.UV6Kind),E("JOINTS_0",o.e.MatricesIndicesKind),E("WEIGHTS_0",o.e.MatricesWeightsKind),E("COLOR_0",o.e.ColorKind);const K=s.Get(L,this._loader.mK.bufferViews,X.bufferView);return K._dracoBabylonGeometry||(K._dracoBabylonGeometry=this._loader.loadBufferViewAsync("/bufferViews/".concat(K.index),K).then((async L=>{const X=this.dracoDecoder||VU.b.Default,E=s.TryGet(this._loader.mK.accessors,G.attributes.POSITION),K=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!E?null:j(E);return await X._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,L,l,t,K).catch((G=>{throw new Error("".concat(U,": ").concat(G.message))}))}))),await K._dracoBabylonGeometry}))}}mU(pU),Q(pU,!0,(U=>new IU(U)));var HU=C(14115),xU=C(12876),hU=C(12884),NU=C(13274),bU=C(13472),oU=C(12850);NU.e.AddNodeConstructor("Light_Type_0",((U,G)=>()=>new wU(U,X.pG.Zero(),G)));class wU extends bU.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(U){this._shadowAngle=U,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(U){const G=this.needCube();if(this._direction=U,this.needCube()!==G&&this._shadowGenerators){const U=this._shadowGenerators.values();for(let G=U.next();!0!==G.done;G=U.next()){G.value.recreateShadowMap()}}}constructor(U,G,C){super(U,C),this._shadowAngle=Math.PI/2,this.position=G}getClassName(){return"PointLight"}getTypeID(){return TU.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(U){if(this.direction)return super.getShadowDirection(U);switch(U){case 0:return new X.pG(1,0,0);case 1:return new X.pG(-1,0,0);case 2:return new X.pG(0,-1,0);case 3:return new X.pG(0,1,0);case 4:return new X.pG(0,0,1);case 5:return new X.pG(0,0,-1)}return X.pG.Zero()}_setDefaultShadowProjectionMatrix(U,G,C){const L=this.wU().activeCamera;if(!L)return;const l=void 0!==this.shadowMinZ?this.shadowMinZ:L.AE,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:L.maxZ,E=this.wU().getEngine().gt;X.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,E?t:l,E?l:t,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,E)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,G){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,G):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,G),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,G),this}transferToNodeMaterialEffect(U,G){return this.computeTransformedInformation()?U.setFloat3(G,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):U.setFloat3(G,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(U,G){U["POINTLIGHT"+G]=!0}}(0,xU.d)([(0,hU.H)()],wU.prototype,"shadowAngle",null),(0,oU.e)("BABYLON.PointLight",wU);const SU="KHR_lights_punctual";class vU{constructor(U){this.name=SU,this._loader=U,this.enabled=this._loader.isExtensionUsed(SU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.mK.extensions;if(U&&U[this.name]){const G=U[this.name];this._lights=G.lights,s.Assign(this._lights)}}loadNodeAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,t)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(U,G,(U=>{let G;const E=s.Get(L,this._lights,t.lt),K=E.name||U.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,E.type){case"directional":{const U=new HU.e(K,X.pG.Backward(),this._loader.babylonScene);U.position.rE(0),G=U;break}case"point":G=new wU(K,X.pG.Zero(),this._loader.babylonScene);break;case"spot":{const U=new OU.e(K,X.pG.Zero(),X.pG.Backward(),0,1,this._loader.babylonScene);U.angle=2*(E.spot&&E.spot.outerConeAngle||Math.PI/4),U.innerAngle=2*(E.spot&&E.spot.innerConeAngle||0),G=U;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(L,": Invalid light type (").concat(E.type,")"))}G._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,E._babylonLight=G,G.falloffType=TU.c.FALLOFF_GLTF,G.LK=E.color?l.hG.NG(E.color):l.hG.White(),G.CK=void 0==E.CK?1:E.CK,G.range=void 0==E.range?Number.MAX_VALUE:E.range,G.parent=U,this._loader._babylonLights.push(G),A.AddPointerMetadata(G,L),C(U)})))))}}mU(SU),Q(SU,!0,(U=>new vU(U)));const uU="KHR_materials_pbrSpecularGlossiness";class dU{constructor(U){this.name=uU,this.order=200,this._loader=U,this.enabled=this._loader.isExtensionUsed(uU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialBasePropertiesAsync(U,G,C)),l.push(this._loadSpecularGlossinessPropertiesAsync(L,X,C)),this._loader.loadMaterialAlphaProperties(U,G,C),await Promise.all(l).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return C.metallic=null,C.roughness=null,G.diffuseFactor?(C.albedoColor=l.hG.NG(G.diffuseFactor),C.alpha=G.diffuseFactor[3]):C.albedoColor=l.hG.White(),C.reflectivityColor=G.specularFactor?l.hG.NG(G.specularFactor):l.hG.White(),C.microSurface=void 0==G.glossinessFactor?1:G.glossinessFactor,G.diffuseTexture&&L.push(this._loader.loadTextureInfoAsync("".concat(U,"/diffuseTexture"),G.diffuseTexture,(U=>{U.name="".concat(C.name," (Diffuse)"),C.albedoTexture=U}))),G.specularGlossinessTexture&&(L.push(this._loader.loadTextureInfoAsync("".concat(U,"/specularGlossinessTexture"),G.specularGlossinessTexture,(U=>{U.name="".concat(C.name," (Specular Glossiness)"),C.reflectivityTexture=U,C.reflectivityTexture.jE=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(L).then((()=>{}))}}mU(uU),Q(uU,!0,(U=>new dU(U)));const gU="KHR_materials_unlit";class ZU{constructor(U){this.name=gU,this.order=210,this._loader=U,this.enabled=this._loader.isExtensionUsed(gU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async()=>await this._loadUnlitPropertiesAsync(U,G,C)))}_loadUnlitPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;C.unlit=!0;const X=G.pbrMetallicRoughness;return X&&(X.baseColorFactor?(C.albedoColor=l.hG.NG(X.baseColorFactor),C.alpha=X.baseColorFactor[3]):C.albedoColor=l.hG.White(),X.baseColorTexture&&L.push(this._loader.loadTextureInfoAsync("".concat(U,"/baseColorTexture"),X.baseColorTexture,(U=>{U.name="".concat(C.name," (Base Color)"),C.albedoTexture=U})))),G.doubleSided&&(C.RE=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(U,G,C),Promise.all(L).then((()=>{}))}}mU(gU),Q(gU,!0,(U=>new ZU(U)));const FU="KHR_materials_clearcoat";class qU{constructor(U){this.name=FU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(FU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadClearCoatPropertiesAsync(L,X,C)),await Promise.all(l)}))}_loadClearCoatPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=G.clearcoatFactor?C.clearCoat.CK=G.clearcoatFactor:C.clearCoat.CK=0,G.clearcoatTexture&&L.push(this._loader.loadTextureInfoAsync("".concat(U,"/clearcoatTexture"),G.clearcoatTexture,(U=>{U.name="".concat(C.name," (ClearCoat)"),C.clearCoat.texture=U}))),void 0!=G.clearcoatRoughnessFactor?C.clearCoat.roughness=G.clearcoatRoughnessFactor:C.clearCoat.roughness=0,G.clearcoatRoughnessTexture&&(G.clearcoatRoughnessTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync("".concat(U,"/clearcoatRoughnessTexture"),G.clearcoatRoughnessTexture,(U=>{U.name="".concat(C.name," (ClearCoat Roughness)"),C.clearCoat.textureRoughness=U})))),G.clearcoatNormalTexture&&(G.clearcoatNormalTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync("".concat(U,"/clearcoatNormalTexture"),G.clearcoatNormalTexture,(U=>{U.name="".concat(C.name," (ClearCoat Normal)"),C.clearCoat.bumpTexture=U}))),C.invertNormalMapX=!C.wU().useRightHandedSystem,C.invertNormalMapY=C.wU().useRightHandedSystem,void 0!=G.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=G.clearcoatNormalTexture.scale)),Promise.all(L).then((()=>{}))}}mU(FU),Q(FU,!0,(U=>new qU(U)));const aU="KHR_materials_iridescence";class kU{constructor(U){this.name=aU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(aU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadIridescencePropertiesAsync(L,X,C)),await Promise.all(l).then((()=>{}))}))}_loadIridescencePropertiesAsync(U,G,C){var L,X,l,t,E;if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const K=new Array;return C.iridescence.isEnabled=!0,C.iridescence.CK=null!==(L=G.iridescenceFactor)&&void 0!==L?L:0,C.iridescence.indexOfRefraction=null!==(X=null!==(l=G.iridescenceIor)&&void 0!==l?l:G.iridescenceIOR)&&void 0!==X?X:1.3,C.iridescence.minimumThickness=null!==(t=G.iridescenceThicknessMinimum)&&void 0!==t?t:100,C.iridescence.maximumThickness=null!==(E=G.iridescenceThicknessMaximum)&&void 0!==E?E:400,G.iridescenceTexture&&K.push(this._loader.loadTextureInfoAsync("".concat(U,"/iridescenceTexture"),G.iridescenceTexture,(U=>{U.name="".concat(C.name," (Iridescence)"),C.iridescence.texture=U}))),G.iridescenceThicknessTexture&&K.push(this._loader.loadTextureInfoAsync("".concat(U,"/iridescenceThicknessTexture"),G.iridescenceThicknessTexture,(U=>{U.name="".concat(C.name," (Iridescence Thickness)"),C.iridescence.thicknessTexture=U}))),Promise.all(K).then((()=>{}))}}mU(aU),Q(aU,!0,(U=>new kU(U)));const nU="KHR_materials_anisotropy";class QU{constructor(U){this.name=nU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(nU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadIridescencePropertiesAsync(L,X,C)),await Promise.all(l)}))}async _loadIridescencePropertiesAsync(U,G,C){var L,X;if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const l=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.CK=null!==(L=G.anisotropyStrength)&&void 0!==L?L:0,C.anisotropy.angle=null!==(X=G.anisotropyRotation)&&void 0!==X?X:0,G.anisotropyTexture&&(G.anisotropyTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync("".concat(U,"/anisotropyTexture"),G.anisotropyTexture,(U=>{U.name="".concat(C.name," (Anisotropy Intensity)"),C.anisotropy.texture=U})))),await Promise.all(l)}}mU(nU),Q(nU,!0,(U=>new QU(U)));const mG="KHR_materials_emissive_strength";class BU{constructor(U){this.name=mG,this.order=170,this._loader=U,this.enabled=this._loader.isExtensionUsed(mG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>await this._loader.loadMaterialPropertiesAsync(U,G,C).then((()=>{this._loadEmissiveProperties(L,X,C)}))))}_loadEmissiveProperties(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));void 0!==G.emissiveStrength&&(C.emissiveIntensity=G.emissiveStrength)}}mU(mG),Q(mG,!0,(U=>new BU(U)));const MU="KHR_materials_sheen";class zU{constructor(U){this.name=MU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(MU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadSheenPropertiesAsync(L,X,C)),await Promise.all(l).then((()=>{}))}))}_loadSheenPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return C.sheen.isEnabled=!0,C.sheen.CK=1,void 0!=G.sheenColorFactor?C.sheen.color=l.hG.NG(G.sheenColorFactor):C.sheen.color=l.hG.Black(),G.sheenColorTexture&&L.push(this._loader.loadTextureInfoAsync("".concat(U,"/sheenColorTexture"),G.sheenColorTexture,(U=>{U.name="".concat(C.name," (Sheen Color)"),C.sheen.texture=U}))),void 0!==G.sheenRoughnessFactor?C.sheen.roughness=G.sheenRoughnessFactor:C.sheen.roughness=0,G.sheenRoughnessTexture&&(G.sheenRoughnessTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync("".concat(U,"/sheenRoughnessTexture"),G.sheenRoughnessTexture,(U=>{U.name="".concat(C.name," (Sheen Roughness)"),C.sheen.textureRoughness=U})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(L).then((()=>{}))}}mU(MU),Q(MU,!0,(U=>new zU(U)));var sU=C(13347);const jU="KHR_materials_specular";class AU{constructor(U){this.name=jU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(jU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;if(l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadSpecularPropertiesAsync(L,X,C)),X.extensions&&X.extensions.EXT_materials_specular_edge_color&&C instanceof h.c){X.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=sU.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=sU.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(l).then((()=>{}))}))}_loadSpecularPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return void 0!==G.specularFactor&&(C.metallicF0Factor=G.specularFactor),void 0!==G.specularColorFactor&&(C.metallicReflectanceColor=l.hG.NG(G.specularColorFactor)),G.specularTexture&&(G.specularTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync("".concat(U,"/specularTexture"),G.specularTexture,(U=>{U.name="".concat(C.name," (Specular)"),C.metallicReflectanceTexture=U,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),G.specularColorTexture&&L.push(this._loader.loadTextureInfoAsync("".concat(U,"/specularColorTexture"),G.specularColorTexture,(U=>{U.name="".concat(C.name," (Specular Color)"),C.reflectanceTexture=U}))),Promise.all(L).then((()=>{}))}}mU(jU),Q(jU,!0,(U=>new AU(U)));const YU="KHR_materials_ior";class eU{constructor(U){this.name=YU,this.order=180,this._loader=U,this.enabled=this._loader.isExtensionUsed(YU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadIorPropertiesAsync(L,X,C)),await Promise.all(l).then((()=>{}))}))}_loadIorPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));return void 0!==G.ior?C.indexOfRefraction=G.ior:C.indexOfRefraction=eU._DEFAULT_IOR,Promise.resolve()}}eU._DEFAULT_IOR=1.5,mU(YU),Q(YU,!0,(U=>new eU(U)));const iU="KHR_materials_variants";class cU{constructor(U){this.name=iU,this._loader=U,this.enabled=this._loader.isExtensionUsed(iU)}dispose(){this._loader=null}static GetAvailableVariants(U){const G=this._GetExtensionMetadata(U);return G?Object.keys(G.variants):[]}getAvailableVariants(U){return cU.GetAvailableVariants(U)}static SelectVariant(U,G){const C=this._GetExtensionMetadata(U);if(!C)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(iU," extension"));const L=U=>{const G=C.variants[U];if(G)for(const C of G)C.mesh.material=C.material};if(G instanceof Array)for(const X of G)L(X);else L(G);C.lastSelected=G}selectVariant(U,G){cU.SelectVariant(U,G)}static Reset(U){const G=this._GetExtensionMetadata(U);if(!G)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(iU," extension"));for(const C of G.original)C.mesh.material=C.material;G.lastSelected=null}reset(U){cU.Reset(U)}static GetLastSelectedVariant(U){const G=this._GetExtensionMetadata(U);if(!G)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(iU," extension"));return G.lastSelected}getLastSelectedVariant(U){return cU.GetLastSelectedVariant(U)}static _GetExtensionMetadata(U){var G,C;return(null===U||void 0===U||null===(G=U._internalMetadata)||void 0===G||null===(C=G.mK)||void 0===C?void 0:C[iU])||null}onLoading(){const U=this._loader.mK.extensions;if(U&&U[this.name]){const G=U[this.name];this._variants=G.variants}}onReady(){const U=this._loader.rootBabylonMesh;if(U){var G;const C=this._loader.parent.extensionOptions[iU];null!==C&&void 0!==C&&C.defaultVariant&&cU.SelectVariant(U,C.defaultVariant),null===C||void 0===C||null===(G=C.onLoaded)||void 0===G||G.call(C,{get variants(){return cU.GetAvailableVariants(U)},get selectedVariant(){const G=cU.GetLastSelectedVariant(U);return G?Array.isArray(G)?G[0]:G:cU.GetAvailableVariants(U)[0]},set selectedVariant(G){cU.SelectVariant(U,G)}})}}_loadMeshPrimitiveAsync(U,G,C,L,X,l){return A.LoadExtensionAsync(U,X,this.name,(async(t,E)=>{const K=new Array;return K.push(this._loader._loadMeshPrimitiveAsync(U,G,C,L,X,(G=>{if(l(G),G instanceof v.d){const C=A._GetDrawMode(U,X.mode),L=this._loader.rootBabylonMesh,l=L?L._internalMetadata=L._internalMetadata||{}:{},P=l.mK=l.mK||{},O=P[iU]=P[iU]||{lastSelected:null,original:[],variants:{}};O.original.push({mesh:G,material:G.material});for(let U=0;U<E.mappings.length;++U){const X=E.mappings[U],l=s.Get("".concat(t,"/mappings/").concat(U,"/material"),this._loader.mK.materials,X.material);K.push(this._loader._loadMaterialAsync("#/materials/".concat(X.material),l,G,C,(U=>{for(let C=0;C<X.variants.length;++C){const l=X.variants[C],t=s.Get("/extensions/".concat(iU,"/variants/").concat(l),this._variants,l);O.variants[t.name]=O.variants[t.name]||[],O.variants[t.name].push({mesh:G,material:U}),G.onClonedObservable.add((U=>{const C=U;let X=null,l=C;do{if(l=l.parent,!l)return;X=cU._GetExtensionMetadata(l)}while(null===X);if(L&&X===cU._GetExtensionMetadata(L)){l._internalMetadata={};for(const U in L._internalMetadata)l._internalMetadata[U]=L._internalMetadata[U];l._internalMetadata.mK=[];for(const U in L._internalMetadata.mK)l._internalMetadata.mK[U]=L._internalMetadata.mK[U];l._internalMetadata.mK[iU]={lastSelected:null,original:[],variants:{}};for(const U of X.original)l._internalMetadata.mK[iU].original.push({mesh:U.mesh,material:U.material});for(const U in X.variants)if(Object.prototype.hasOwnProperty.call(X.variants,U)){l._internalMetadata.mK[iU].variants[U]=[];for(const G of X.variants[U])l._internalMetadata.mK[iU].variants[U].push({mesh:G.mesh,material:G.material})}X=l._internalMetadata.mK[iU]}for(const L of X.original)L.mesh===G&&(L.mesh=C);for(const L of X.variants[t.name])L.mesh===G&&(L.mesh=C)}))}})))}}}))),await Promise.all(K).then((U=>{let[G]=U;return G}))}))}}mU(iU),Q(iU,!0,(U=>new cU(U)));var RU=C(26),WU=C(12949);class fU{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:sU.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(U,G){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,RU.b)((0,RU.b)({},fU._GetDefaultOptions()),U),this._scene=G,this._scene._transmissionHelper=this,this.onErrorObservable=new O.e,this._scene.aE.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(U){if(!Object.keys(U).filter((G=>this._options[G]!==U[G])).length)return;const G=(0,RU.b)((0,RU.b)({},this._options),U),C=this._options;this._options=G,G.renderSize===C.renderSize&&G.renderTargetTextureType===C.renderTargetTextureType&&G.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=G.samples,this._opaqueRenderTarget.lodGenerationScale=G.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=G.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(U){return!!U&&!!(U instanceof h.c&&U.subSurface.isRefractionEnabled)}_addMesh(U){this._materialObservers[U.uniqueId]=U.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),t.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(U.material)?(U.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(U)&&this._transparentMeshesCache.push(U)):-1===this._opaqueMeshesCache.indexOf(U)&&this._opaqueMeshesCache.push(U)}))}_removeMesh(U){U.onMaterialChangedObservable.remove(this._materialObservers[U.uniqueId]),delete this._materialObservers[U.uniqueId];let G=this._transparentMeshesCache.indexOf(U);-1!==G&&this._transparentMeshesCache.splice(G,1),G=this._opaqueMeshesCache.indexOf(U),-1!==G&&this._opaqueMeshesCache.splice(G,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(U){const G=this._transparentMeshesCache.indexOf(U),C=this._opaqueMeshesCache.indexOf(U);this._shouldRenderAsTransmission(U.material)?(U.material instanceof h.c&&(U.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(U)):-1===G&&this._transparentMeshesCache.push(U)):-1!==G?(this._transparentMeshesCache.splice(G,1),this._opaqueMeshesCache.push(U)):-1===C&&this._opaqueMeshesCache.push(U)}_isRenderTargetValid(){var U;return null!==(null===(U=this._opaqueRenderTarget)||void 0===U?void 0:U.getInternalTexture())}_setupRenderTargets(){var U,G;let C;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new WU.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(U=null===(G=this._options.clearColor)||void 0===G?void 0:G.clone())&&void 0!==U?U:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((U=>{C=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?U.clearColor.L(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(U.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=C}));for(const L of this._transparentMeshesCache)this._shouldRenderAsTransmission(L.material)&&(L.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const rU="KHR_materials_transmission";class JU{constructor(U){this.name=rU,this.order=175,this._loader=U,this.enabled=this._loader.isExtensionUsed(rU),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadTransparentPropertiesAsync(L,G,C,X)),await Promise.all(l).then((()=>{}))}))}_loadTransparentPropertiesAsync(U,G,C,L){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const X=C;if(X.subSurface.isRefractionEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.useAlbedoToTintRefraction=!0,void 0===L.transmissionFactor)return X.subSurface.refractionIntensity=0,X.subSurface.isRefractionEnabled=!1,Promise.resolve();{var l;X.subSurface.refractionIntensity=L.transmissionFactor;const U=X.wU();if(X.subSurface.refractionIntensity&&!U._transmissionHelper)new fU({},X.wU());else if(X.subSurface.refractionIntensity&&(null===(l=U._transmissionHelper)||void 0===l||!l._isRenderTargetValid())){var t;null===(t=U._transmissionHelper)||void 0===t||t._setupRenderTargets()}}return X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,L.transmissionTexture?(L.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(U,"/transmissionTexture"),L.transmissionTexture,void 0).then((U=>{U.name="".concat(C.name," (Transmission)"),X.subSurface.refractionIntensityTexture=U,X.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}mU(rU),Q(rU,!0,(U=>new JU(U)));const UG="KHR_materials_diffuse_transmission";class GG{constructor(U){this.name=UG,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(UG),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadTranslucentPropertiesAsync(L,G,C,X)),await Promise.all(l).then((()=>{}))}))}_loadTranslucentPropertiesAsync(U,G,C,L){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const X=C;if(X.subSurface.isTranslucencyEnabled=!0,X.subSurface.volumeIndexOfRefraction=1,X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=0,X.subSurface.useAlbedoToTintTranslucency=!1,void 0===L.diffuseTransmissionFactor)return X.subSurface.translucencyIntensity=0,X.subSurface.isTranslucencyEnabled=!1,Promise.resolve();X.subSurface.translucencyIntensity=L.diffuseTransmissionFactor;const t=new Array;return X.subSurface.useGltfStyleTextures=!0,L.diffuseTransmissionTexture&&(L.diffuseTransmissionTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync("".concat(U,"/diffuseTransmissionTexture"),L.diffuseTransmissionTexture).then((U=>{U.name="".concat(C.name," (Diffuse Transmission)"),X.subSurface.translucencyIntensityTexture=U})))),void 0!==L.diffuseTransmissionColorFactor?X.subSurface.translucencyColor=l.hG.NG(L.diffuseTransmissionColorFactor):X.subSurface.translucencyColor=l.hG.White(),L.diffuseTransmissionColorTexture&&t.push(this._loader.loadTextureInfoAsync("".concat(U,"/diffuseTransmissionColorTexture"),L.diffuseTransmissionColorTexture).then((U=>{U.name="".concat(C.name," (Diffuse Transmission Color)"),X.subSurface.translucencyColorTexture=U}))),Promise.all(t).then((()=>{}))}}mU(UG),Q(UG,!0,(U=>new GG(U)));const CG="KHR_materials_volume";class LG{constructor(U){this.name=CG,this.order=173,this._loader=U,this.enabled=this._loader.isExtensionUsed(CG),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadVolumePropertiesAsync(L,G,C,X)),await Promise.all(l).then((()=>{}))}))}_loadVolumePropertiesAsync(U,G,C,L){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!L.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const X=void 0!==L.attenuationDistance?L.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=X,void 0!==L.attenuationColor&&3==L.attenuationColor.length&&C.subSurface.tintColor.WE(L.attenuationColor[0],L.attenuationColor[1],L.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=L.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,L.thicknessTexture?(L.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(U,"/thicknessTexture"),L.thicknessTexture).then((U=>{U.name="".concat(C.name," (Thickness)"),C.subSurface.thicknessTexture=U,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}mU(CG),Q(CG,!0,(U=>new LG(U)));const XG="KHR_materials_dispersion";class lG{constructor(U){this.name=XG,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(XG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadDispersionPropertiesAsync(L,G,C,X)),await Promise.all(l).then((()=>{}))}))}_loadDispersionPropertiesAsync(U,G,C,L){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));return C.subSurface.isRefractionEnabled&&L.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=L.dispersion,Promise.resolve()):Promise.resolve()}}mU(XG),Q(XG,!0,(U=>new lG(U)));const tG="EXT_materials_diffuse_roughness";class EG{constructor(U){this.name=tG,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(tG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(U,G,C)),l.push(this._loadDiffuseRoughnessPropertiesAsync(L,X,C)),await Promise.all(l).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(U,G,C){if(!(C instanceof h.c))throw new Error("".concat(U,": Material type not supported"));const L=new Array;return C.brdf.baseDiffuseModel=sU.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=G.diffuseRoughnessFactor?C.baseDiffuseRoughness=G.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,G.diffuseRoughnessTexture&&L.push(this._loader.loadTextureInfoAsync("".concat(U,"/diffuseRoughnessTexture"),G.diffuseRoughnessTexture,(U=>{U.name="".concat(C.name," (Diffuse Roughness)"),C.baseDiffuseRoughnessTexture=U}))),Promise.all(L).then((()=>{}))}}mU(tG),Q(tG,!0,(U=>new EG(U)));const KG="KHR_mesh_quantization";class PG{constructor(U){this.name=KG,this.enabled=U.isExtensionUsed(KG)}dispose(){}}mU(KG),Q(KG,!0,(U=>new PG(U)));const OG="KHR_texture_basisu";class TG{constructor(U){this.name=OG,this._loader=U,this.enabled=U.isExtensionUsed(OG)}dispose(){this._loader=null}_loadTextureAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>{const l=void 0==G.sampler?A.DefaultSampler:s.Get("".concat(U,"/sampler"),this._loader.mK.samplers,G.sampler),t=s.Get("".concat(L,"/source"),this._loader.mK.images,X.source);return await this._loader._createTextureAsync(U,l,t,(U=>{C(U)}),G._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!G._textureInfo.nonColorData)}))}}mU(OG),Q(OG,!0,(U=>new TG(U)));const DG="KHR_texture_transform";class yG{constructor(U){this.name=DG,this._loader=U,this.enabled=this._loader.isExtensionUsed(DG)}dispose(){this._loader=null}loadTextureInfoAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(L,X)=>await this._loader.loadTextureInfoAsync(U,G,(U=>{if(!(U instanceof N.c))throw new Error("".concat(L,": Texture type not supported"));X.offset&&(U.uOffset=X.offset[0],U.vOffset=X.offset[1]),U.uRotationCenter=0,U.vRotationCenter=0,X.rotation&&(U.wAng=-X.rotation),X.scale&&(U.uScale=X.scale[0],U.vScale=X.scale[1]),void 0!=X.texCoord&&(U.coordinatesIndex=X.texCoord),C(U)}))))}}mU(DG),Q(DG,!0,(U=>new yG(U)));const VG="KHR_xmp_json_ld";class pG{constructor(U){this.name=VG,this.order=100,this._loader=U,this.enabled=this._loader.isExtensionUsed(VG)}dispose(){this._loader=null}onLoading(){var U,G,C;if(null===this._loader.rootBabylonMesh)return;const L=null===(U=this._loader.mK.extensions)||void 0===U?void 0:U.KHR_xmp_json_ld,X=null===(G=this._loader.mK.asset)||void 0===G||null===(C=G.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(L&&X){const U=+X.packet;L.packets&&U<L.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=L.packets[U])}}}function IG(U,G,C,L){return l.hG.NG(G,C).scale(L)}function HG(U,G,C,L){return G[C]*L}function xG(U,G,C,L){return-G[C]*L}function hG(U,G,C,L){return G[C+1]*L}function NG(U,G,C,L){return G[C]*L*2}function bG(U){return{scale:[new wG(D.d.ANIMATIONTYPE_FLOAT,"".concat(U,".uScale"),HG,(()=>2)),new wG(D.d.ANIMATIONTYPE_FLOAT,"".concat(U,".vScale"),hG,(()=>2))],offset:[new wG(D.d.ANIMATIONTYPE_FLOAT,"".concat(U,".uOffset"),HG,(()=>2)),new wG(D.d.ANIMATIONTYPE_FLOAT,"".concat(U,".vOffset"),hG,(()=>2))],rotation:[new wG(D.d.ANIMATIONTYPE_FLOAT,"".concat(U,".wAng"),xG,(()=>1))]}}mU(VG),Q(VG,!0,(U=>new pG(U)));class oG extends Y.AnimationPropertyInfo{buildAnimations(U,G,C,L){return[{babylonAnimatable:U._babylonCamera,babylonAnimation:this._buildAnimation(G,C,L)}]}}class wG extends Y.AnimationPropertyInfo{buildAnimations(U,G,C,L){const X=[];for(const l in U._data)X.push({babylonAnimatable:U._data[l].babylonMaterial,babylonAnimation:this._buildAnimation(G,C,L)});return X}}class SG extends Y.AnimationPropertyInfo{buildAnimations(U,G,C,L){return[{babylonAnimatable:U._babylonLight,babylonAnimation:this._buildAnimation(G,C,L)}]}}(0,B.h)("/cameras/{}/orthographic/xmag",[new oG(D.d.ANIMATIONTYPE_FLOAT,"orthoLeft",xG,(()=>1)),new oG(D.d.ANIMATIONTYPE_FLOAT,"orthoRight",hG,(()=>1))]),(0,B.h)("/cameras/{}/orthographic/ymag",[new oG(D.d.ANIMATIONTYPE_FLOAT,"orthoBottom",xG,(()=>1)),new oG(D.d.ANIMATIONTYPE_FLOAT,"orthoTop",hG,(()=>1))]),(0,B.h)("/cameras/{}/orthographic/zfar",[new oG(D.d.ANIMATIONTYPE_FLOAT,"maxZ",HG,(()=>1))]),(0,B.h)("/cameras/{}/orthographic/znear",[new oG(D.d.ANIMATIONTYPE_FLOAT,"AE",HG,(()=>1))]),(0,B.h)("/cameras/{}/perspective/yfov",[new oG(D.d.ANIMATIONTYPE_FLOAT,"fov",HG,(()=>1))]),(0,B.h)("/cameras/{}/perspective/zfar",[new oG(D.d.ANIMATIONTYPE_FLOAT,"maxZ",HG,(()=>1))]),(0,B.h)("/cameras/{}/perspective/znear",[new oG(D.d.ANIMATIONTYPE_FLOAT,"AE",HG,(()=>1))]),(0,B.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new wG(D.d.ANIMATIONTYPE_COLOR3,"albedoColor",IG,(()=>4)),new wG(D.d.ANIMATIONTYPE_FLOAT,"alpha",(function(U,G,C,L){return G[C+3]*L}),(()=>4))]),(0,B.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"metallic",HG,(()=>1))]),(0,B.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"roughness",HG,(()=>1))]);const vG=bG("albedoTexture");(0,B.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",vG.scale),(0,B.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",vG.offset),(0,B.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",vG.rotation);const uG=bG("metallicTexture");(0,B.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",uG.scale),(0,B.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",uG.offset),(0,B.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",uG.rotation),(0,B.h)("/materials/{}/emissiveFactor",[new wG(D.d.ANIMATIONTYPE_COLOR3,"emissiveColor",IG,(()=>3))]);const dG=bG("bumpTexture");(0,B.h)("/materials/{}/normalTexture/scale",[new wG(D.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",HG,(()=>1))]),(0,B.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",dG.scale),(0,B.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",dG.offset),(0,B.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",dG.rotation),(0,B.h)("/materials/{}/occlusionTexture/strength",[new wG(D.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",HG,(()=>1))]);const gG=bG("ambientTexture");(0,B.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",gG.scale),(0,B.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",gG.offset),(0,B.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",gG.rotation);const ZG=bG("emissiveTexture");(0,B.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ZG.scale),(0,B.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ZG.offset),(0,B.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ZG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new wG(D.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new wG(D.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",HG,(()=>1))]);const FG=bG("anisotropy.texture");(0,B.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",FG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",FG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",FG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",HG,(()=>1))]);const qG=bG("clearCoat.texture");(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",qG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",qG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",qG.rotation);const aG=bG("clearCoat.bumpTexture");(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new wG(D.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",aG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",aG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",aG.rotation);const kG=bG("clearCoat.textureRoughness");(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",kG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",kG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",kG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new wG(D.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new wG(D.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new wG(D.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new wG(D.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",HG,(()=>1))]);const nG=bG("iridescence.texture");(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",nG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",nG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",nG.rotation);const QG=bG("iridescence.thicknessTexture");(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",QG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",QG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",QG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new wG(D.d.ANIMATIONTYPE_COLOR3,"sheen.color",IG,(()=>3))]),(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",HG,(()=>1))]);const mC=bG("sheen.texture");(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",mC.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",mC.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",mC.rotation);const BG=bG("sheen.textureRoughness");(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",BG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",BG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",BG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new wG(D.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",IG,(()=>3))]);const MG=bG("metallicReflectanceTexture");(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",MG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",MG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",MG.rotation);const zG=bG("reflectanceTexture");(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",zG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",zG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",zG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",HG,(()=>1))]);const sG=bG("subSurface.refractionIntensityTexture");(0,B.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",sG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",sG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",sG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new wG(D.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",IG,(()=>3))]),(0,B.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new wG(D.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",HG,(()=>1))]),(0,B.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",HG,(()=>1))]);const jG=bG("subSurface.thicknessTexture");(0,B.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",jG.scale),(0,B.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",jG.offset),(0,B.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",jG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new wG(D.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",HG,(()=>1))]);const AG=bG("subSurface.translucencyIntensityTexture");(0,B.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",AG.scale),(0,B.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",AG.offset),(0,B.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",AG.rotation),(0,B.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new wG(D.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",IG,(()=>3))]);const YG=bG("subSurface.translucencyColorTexture");(0,B.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",YG.scale),(0,B.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",YG.offset),(0,B.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",YG.rotation),(0,B.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new SG(D.d.ANIMATIONTYPE_COLOR3,"diffuse",IG,(()=>3))]),(0,B.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new SG(D.d.ANIMATIONTYPE_FLOAT,"intensity",HG,(()=>1))]),(0,B.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new SG(D.d.ANIMATIONTYPE_FLOAT,"range",HG,(()=>1))]),(0,B.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new SG(D.d.ANIMATIONTYPE_FLOAT,"innerAngle",NG,(()=>1))]),(0,B.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new SG(D.d.ANIMATIONTYPE_FLOAT,"angle",NG,(()=>1))]),(0,B.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new SG(D.d.ANIMATIONTYPE_COLOR3,"diffuse",IG,(()=>3))]),(0,B.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new SG(D.d.ANIMATIONTYPE_FLOAT,"intensity",HG,(()=>1))]);const eG="KHR_animation_pointer";class iG{constructor(U){this.name=eG,this._loader=U,this._pathToObjectConverter=(0,B.e)(this._loader.mK)}get enabled(){return this._loader.isExtensionUsed(eG)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(U,G,C,L,X){var l;const t=null===(l=L.target.extensions)||void 0===l?void 0:l.KHR_animation_pointer;if(!t||!this._pathToObjectConverter)return null;"pointer"!==L.target.path&&p.d.Warn("".concat(U,"/target/path: Value (").concat(L.target.path,") must be (","pointer",") when using the ").concat(this.name," extension")),void 0!=L.target.node&&p.d.Warn("".concat(U,"/target/node: Value (").concat(L.target.node,") must not be present when using the ").concat(this.name," extension"));const E="".concat(U,"/extensions/").concat(this.name),K=t.pointer;if(!K)throw new Error("".concat(E,": Pointer is missing"));try{const l=this._pathToObjectConverter.convert(K);if(!l.info.interpolation)throw new Error("".concat(E,"/pointer: Interpolation is missing"));return this._loader._loadAnimationChannelFromTargetInfoAsync(U,G,C,L,{object:l.object,info:l.info.interpolation},X)}catch(P){return p.d.Warn("".concat(E,"/pointer: Invalid pointer (").concat(K,") skipped")),null}}}mU(eG),Q(eG,!0,(U=>new iG(U)));class cG{constructor(U,G,C){this.frame=U,this.action=G,this.onlyOnce=C,this.isDone=!1}_clone(){return new cG(this.frame,this.action,this.onlyOnce)}}var RG=C(12747),WG=C(12800),fG=C(12794);class rG{get loop(){return this._loop}set loop(U){U!==this._loop&&(this._loop=U,this.updateOptions({loop:U}))}get currentTime(){var U;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(U=WG.b.audioEngine)&&void 0!==U&&U.audioContext&&(this.isPlaying||this.isPaused)){const U=this.isPaused?0:WG.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+U}return 0}get spatialSound(){return this._spatialSound}set spatialSound(U){if(U==this._spatialSound)return;const G=this.isPlaying;this.pause(),U?(this._spatialSound=U,this._updateSpatialParameters()):this._disableSpatialSound(),G&&this.play()}constructor(U,G,C){var L;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new O.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=X.pG.Zero(),this._localDirection=new X.pG(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=U,C=C||V.d.LastCreatedScene){var K,P,T,D;if(this._scene=C,rG._SceneComponentInitialization(C),this._readyToPlayCallback=l,this._customAttenuationFunction=(U,G,C,L,X)=>G<C?U*(1-G/C):0,E)this.autoplay=E.autoplay||!1,this._loop=E.loop||!1,void 0!==E.volume&&(this._volume=E.volume),this._spatialSound=null!==(K=E.spatialSound)&&void 0!==K&&K,this.maxDistance=null!==(P=E.maxDistance)&&void 0!==P?P:100,this.useCustomAttenuation=null!==(T=E.useCustomAttenuation)&&void 0!==T&&T,this.rolloffFactor=E.rolloffFactor||1,this.refDistance=E.refDistance||1,this.distanceModel=E.distanceModel||"linear",this._playbackRate=E.playbackRate||1,this._streaming=null!==(D=E.streaming)&&void 0!==D&&D,this._length=E.length,this._offset=E.offset;if(null!==(L=WG.b.audioEngine)&&void 0!==L&&L.canUseWebAudio&&WG.b.audioEngine.audioContext){this._soundGain=WG.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let U=!0;if(G)try{"string"===typeof G?(this._urlType="String",this._url=G):G instanceof ArrayBuffer?this._urlType="ArrayBuffer":G instanceof HTMLMediaElement?this._urlType="MediaElement":G instanceof MediaStream?this._urlType="MediaStream":G instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(G)&&(this._urlType="Array");let C=[],L=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=WG.b.audioEngine.audioContext.createMediaElementSource(G),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=WG.b.audioEngine.audioContext.createMediaStreamSource(G),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":G.byteLength>0&&(L=!0,this._soundLoaded(G));break;case"AudioBuffer":this._audioBufferLoaded(G);break;case"String":C.push(G);case"Array":0===C.length&&(C=G);for(let U=0;U<C.length;U++){const G=C[U];if(L=E&&E.skipCodecCheck||-1!==G.indexOf(".mp3",G.length-4)&&WG.b.audioEngine.isMP3supported||-1!==G.indexOf(".ogg",G.length-4)&&WG.b.audioEngine.isOGGsupported||-1!==G.indexOf(".wav",G.length-4)||-1!==G.indexOf(".m4a",G.length-4)||-1!==G.indexOf(".mp4",G.length-4)||-1!==G.indexOf("blob:"),L){this._streaming?(this._htmlAudioElement=new Audio(G),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,t.Tools.SetCorsBehavior(G,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(G,(U=>{this._soundLoaded(U)}),void 0,!0,!0,(U=>{U&&p.d.Error("XHR "+U.status+" error on: "+G+"."),p.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:U=!1}U?L||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):p.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(y){p.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),WG.b.audioEngine&&!WG.b.audioEngine.WarnedWebAudioUnsupported&&(p.d.Error("Web Audio is not supported by your browser."),WG.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}}dispose(){var U;null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(U){var G;null!==(G=WG.b.audioEngine)&&void 0!==G&&G.audioContext&&(this._audioBuffer=U,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(U){var G;null!==(G=WG.b.audioEngine)&&void 0!==G&&G.audioContext&&WG.b.audioEngine.audioContext.decodeAudioData(U,(U=>{this._audioBufferLoaded(U)}),(U=>{p.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+U)}))}setAudioBuffer(U){var G;null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&(this._audioBuffer=U,this._isReadyToPlay=!0)}updateOptions(U){var G,C,L,X,l,t,E,K,P,O,T;U&&(this.loop=null!==(G=U.loop)&&void 0!==G?G:this.loop,this.maxDistance=null!==(C=U.maxDistance)&&void 0!==C?C:this.maxDistance,this.useCustomAttenuation=null!==(L=U.useCustomAttenuation)&&void 0!==L?L:this.useCustomAttenuation,this.rolloffFactor=null!==(X=U.rolloffFactor)&&void 0!==X?X:this.rolloffFactor,this.refDistance=null!==(l=U.refDistance)&&void 0!==l?l:this.refDistance,this.distanceModel=null!==(t=U.distanceModel)&&void 0!==t?t:this.distanceModel,this._playbackRate=null!==(E=U.playbackRate)&&void 0!==E?E:this._playbackRate,this._length=null!==(K=U.length)&&void 0!==K?K:void 0,this.spatialSound=null!==(P=U.spatialSound)&&void 0!==P?P:this._spatialSound,this._setOffset(null!==(O=U.offset)&&void 0!==O?O:void 0),this.setVolume(null!==(T=U.volume)&&void 0!==T?T:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var U,G;null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&WG.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(G=this._soundPanner)&&void 0!==G?G:WG.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var U;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(U=this._soundPanner)||void 0===U||U.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var U;null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(U){var G;null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(U),this._isOutputConnected=!0)}setDirectionalCone(U,G,C){G<U?p.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=U,this._coneOuterAngle=G,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!=this._coneInnerAngle){var G;if(this._coneOuterAngle<U)return void p.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U,null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!=this._coneOuterAngle){var G;if(U<this._coneInnerAngle)return void p.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U,null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(U){var G;U.equals(this._position)||(this._position.L(U),null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(U){var G;this._localDirection=U,null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const U=this._connectedTransformNode.getWorldMatrix(),G=X.pG.TransformNormal(this._localDirection,U);G.normalize(),this._soundPanner.orientationX.value=G.x,this._soundPanner.orientationY.value=G.y,this._soundPanner.orientationZ.value=G.z}updateDistanceFromListener(){var U;if(null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const U=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.IG(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,U,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(U){this._customAttenuationFunction=U}play(U,G,C){var L;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(L=WG.b.audioEngine)&&void 0!==L&&L.audioContext)try{var X,l;this._clearTimeoutsAndObservers();let L=U?(null===(X=WG.b.audioEngine)||void 0===X?void 0:X.audioContext.currentTime)+U:null===(l=WG.b.audioEngine)||void 0===l?void 0:l.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=WG.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const U=()=>{var C;if(null!==(C=WG.b.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=null!==G&&void 0!==G?G:0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var G,C;(null===(G=WG.b.audioEngine)||void 0===G||G.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=WG.b.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{U()})))}))}else{var L;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(L=WG.b.audioEngine)||void 0===L?void 0:L.onAudioUnlockedObservable.addOnce((()=>{U()}))}};U()}}else{var t;const X=()=>{var X;if(null!==(X=WG.b.audioEngine)&&void 0!==X&&X.audioContext){var l;if(C=C||this._length,void 0!==G&&this._setOffset(G),this._soundSource){const U=this._soundSource;U.onended=()=>{U.disconnect()}}if(this._soundSource=null===(l=WG.b.audioEngine)||void 0===l?void 0:l.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var t,E;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==G&&(this._soundSource.loopStart=G),void 0!==C&&(this._soundSource.loopEnd=(0|G)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},L=U?(null===(t=WG.b.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+U:WG.b.audioEngine.audioContext.currentTime;const X=((this.isPaused?this.currentTime:0)+(null!==(E=this._offset)&&void 0!==E?E:0))%this._soundSource.buffer.duration;this._soundSource.start(L,X,this.loop?void 0:C)}}};"suspended"===(null===(t=WG.b.audioEngine)||void 0===t?void 0:t.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var U;"suspended"===(null===(U=WG.b.audioEngine)||void 0===U?void 0:U.audioContext.state)?(WG.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=WG.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{X()})))):X()}),500):X()}this._startTime=L,this.isPlaying=!0,this.isPaused=!1}catch(E){p.d.Error("Error while trying to play audio: "+this.name+", "+E.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(U){var G;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(G=WG.b.audioEngine)&&void 0!==G&&G.audioContext&&this._soundSource){const G=U?WG.b.audioEngine.audioContext.currentTime+U:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(G)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var G;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(G=this._streamingSource)||void 0===G||G.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(U=WG.b.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=WG.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(U,G){var C;null!==(C=WG.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(G&&WG.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(WG.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,WG.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(U,WG.b.audioEngine.audioContext.currentTime+G)):this._soundGain.gain.value=U),this._volume=U}setPlaybackRate(U){this._playbackRate=U,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(U){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=U,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=U=>this._onRegisterAfterWorldMatrixUpdate(U),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(U){var G;if(U.getBoundingInfo){const G=U.getBoundingInfo();this.setPosition(G.boundingSphere.centerWorld)}else this.setPosition(U.absolutePosition);null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const U=()=>{(0,fG.f)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},G={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new rG(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,G);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),U(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const U={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(U.connectedMeshId=this._connectedTransformNode.id),U.position=this._position.sE(),U.refDistance=this.refDistance,U.distanceModel=this.distanceModel,U.isDirectional=this._isDirectional,U.localDirectionToMesh=this._localDirection.sE(),U.coneInnerAngle=this._coneInnerAngle,U.coneOuterAngle=this._coneOuterAngle,U.coneOuterGain=this._coneOuterGain),U}static Parse(U,G,C,L){const l=U.name;let t;t=U.url?C+U.url:C+l;const E={autoplay:U.autoplay,loop:U.loop,volume:U.volume,spatialSound:U.spatialSound,maxDistance:U.maxDistance,rolloffFactor:U.rolloffFactor,refDistance:U.refDistance,distanceModel:U.distanceModel,playbackRate:U.playbackRate};let K;if(L){const U=()=>{(0,fG.f)((()=>L._isReadyToPlay),(()=>{K._audioBuffer=L.getAudioBuffer(),K._isReadyToPlay=!0,K.autoplay&&K.play(0,K._offset,K._length)}),void 0,300)};K=new rG(l,new ArrayBuffer(0),G,null,E),U()}else K=new rG(l,t,G,(()=>{G.removePendingData(K)}),E),G.addPendingData(K);if(U.position){const G=X.pG.NG(U.position);K.setPosition(G)}if(U.isDirectional&&(K.setDirectionalCone(U.coneInnerAngle||360,U.coneOuterAngle||360,U.coneOuterGain||0),U.localDirectionToMesh)){const G=X.pG.NG(U.localDirectionToMesh);K.setLocalDirectionToMesh(G)}if(U.connectedMeshId){const C=G.getMeshById(U.connectedMeshId);C&&K.attachToMesh(C)}return U.metadata&&(K.metadata=U.metadata),K}_setOffset(U){this._offset!==U&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=U)}_clearTimeoutsAndObservers(){var U;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(U=WG.b.audioEngine)||void 0===U||U.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}rG._SceneComponentInitialization=U=>{throw(0,RG.d)("AudioSceneComponent")},(0,oU.e)("BABYLON.Sound",rG);class JG{constructor(U,G,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],G.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=U,this._weights=C;let L=0;for(const l of C)L+=l;const X=L>0?1/L:0;for(let l=0;l<this._weights.length;l++)this._weights[l]*=X;this._sounds=G;for(const l of this._sounds)l.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!==this._coneInnerAngle){if(this._coneOuterAngle<U)return void p.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U;for(const G of this._sounds)G.directionalConeInnerAngle=U}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!==this._coneOuterAngle){if(U<this._coneInnerAngle)return void p.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U;for(const G of this._sounds)G.directionalConeOuterAngle=U}}get volume(){return this._volume}set volume(U){if(U!==this._volume)for(const G of this._sounds)G.setVolume(U)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(U){var G;if(!this.isPaused){this.stop();const U=Math.random();let G=0;for(let C=0;C<this._weights.length;C++)if(G+=this._weights[C],U<=G){this._currentIndex=C;break}}const C=this._sounds[null!==(G=this._currentIndex)&&void 0!==G?G:0];C.isReady()?C.play(0,this.isPaused?void 0:U):C.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class UC{constructor(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(U=U||V.d.LastCreatedScene)&&(this._scene=U,this.soundCollection=[],this._options=G,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var U;null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&WG.b.audioEngine.audioContext&&(this._outputAudioNode=WG.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(WG.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(WG.b.audioEngine&&WG.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(U){var G;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&U.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==U.soundTrackId&&(-1===U.soundTrackId?this._scene.mainSoundTrack.removeSound(U):this._scene.soundTracks&&this._scene.soundTracks[U.soundTrackId].removeSound(U)),this.soundCollection.push(U),U.soundTrackId=this.id}removeSound(U){const G=this.soundCollection.indexOf(U);-1!==G&&this.soundCollection.splice(G,1)}setVolume(U){var G;null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=U)}switchPanningModelToHRTF(){var U;if(null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let G=0;G<this.soundCollection.length;G++)this.soundCollection[G].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var U;if(null!==(U=WG.b.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let G=0;G<this.soundCollection.length;G++)this.soundCollection[G].switchPanningModelToEqualPower()}connectToAnalyser(U){var G;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=U,null!==(G=WG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,WG.b.audioEngine.masterGain))}}var GC=C(13128),CC=C(13097),LC=C(12725);WG.b.AudioEngineFactory=(U,G,C)=>new XC(U,G,C);class XC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new O.e,this.onAudioLockedObservable=new O.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,LC.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const L=document.createElement("audio");this._hostElement=U,this._audioContext=G,this._audioDestination=C;try{L&&L.canPlayType&&(L.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||L.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(X){}try{L&&L.canPlayType&&L.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(X){}}lock(){this._triggerSuspendedState()}unlock(){var U,G;if("running"===(null===(U=this._audioContext)||void 0===U?void 0:U.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(G=this._audioContext)||void 0===G||G.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{p.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var U;null===(U=this._audioContext)||void 0===U||U.addEventListener("statechange",(()=>{var U;this.unlocked&&"running"!==(null===(U=this._audioContext)||void 0===U?void 0:U.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var U;return null!==(U=this._audioContext)&&void 0!==U&&U.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(U){this.canUseWebAudio=!1,p.d.Error("Web Audio: "+U.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(U){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const U=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",G=document.createElement("style");G.appendChild(document.createTextNode(U)),document.getElementsByTagName("head")[0].appendChild(G),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var U;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(U=this._audioContext)||void 0===U||U.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(U){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=U)}connectToAnalyser(U){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=U,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var lC=C(12739);(0,C(13834).g)(GC.d.NAME_AUDIO,((U,G,C,L)=>{let X,l=[];if(C.ly=C.ly||[],void 0!==U.ly&&null!==U.ly)for(let E=0,K=U.ly.length;E<K;E++){var t;const K=U.ly[E];null!==(t=WG.b.audioEngine)&&void 0!==t&&t.canUseWebAudio?(K.url||(K.url=K.name),l[K.url]?C.ly.push(rG.Parse(K,G,L,l[K.url])):(X=rG.Parse(K,G,L),l[K.url]=X,C.ly.push(X))):C.ly.push(new rG(K.name,null,G))}l=[]})),Object.defineProperty(CC.e.prototype,"mainSoundTrack",{get:function(){let U=this._getComponent(GC.d.NAME_AUDIO);return U||(U=new tC(this),this.o(U)),this._mainSoundTrack||(this._mainSoundTrack=new UC(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),CC.e.prototype.getSoundByName=function(U){let G;for(G=0;G<this.mainSoundTrack.soundCollection.length;G++)if(this.mainSoundTrack.soundCollection[G].name===U)return this.mainSoundTrack.soundCollection[G];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(G=0;G<this.soundTracks[C].soundCollection.length;G++)if(this.soundTracks[C].soundCollection[G].name===U)return this.soundTracks[C].soundCollection[G];return null},Object.defineProperty(CC.e.prototype,"audioEnabled",{get:function(){let U=this._getComponent(GC.d.NAME_AUDIO);return U||(U=new tC(this),this.o(U)),U.audioEnabled},set:function(U){let G=this._getComponent(GC.d.NAME_AUDIO);G||(G=new tC(this),this.o(G)),U?G.enableAudio():G.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(CC.e.prototype,"headphone",{get:function(){let U=this._getComponent(GC.d.NAME_AUDIO);return U||(U=new tC(this),this.o(U)),U.headphone},set:function(U){let G=this._getComponent(GC.d.NAME_AUDIO);G||(G=new tC(this),this.o(G)),U?G.switchAudioModeForHeadphones():G.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(CC.e.prototype,"audioListenerPositionProvider",{get:function(){let U=this._getComponent(GC.d.NAME_AUDIO);return U||(U=new tC(this),this.o(U)),U.audioListenerPositionProvider},set:function(U){let G=this._getComponent(GC.d.NAME_AUDIO);if(G||(G=new tC(this),this.o(G)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");G.audioListenerPositionProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(CC.e.prototype,"audioListenerRotationProvider",{get:function(){let U=this._getComponent(GC.d.NAME_AUDIO);return U||(U=new tC(this),this.o(U)),U.audioListenerRotationProvider},set:function(U){let G=this._getComponent(GC.d.NAME_AUDIO);if(G||(G=new tC(this),this.o(G)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");G.audioListenerRotationProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(CC.e.prototype,"audioPositioningRefreshRate",{get:function(){let U=this._getComponent(GC.d.NAME_AUDIO);return U||(U=new tC(this),this.o(U)),U.audioPositioningRefreshRate},set:function(U){let G=this._getComponent(GC.d.NAME_AUDIO);G||(G=new tC(this),this.o(G)),G.audioPositioningRefreshRate=U},enumerable:!0,configurable:!0});class tC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(U){this.name=GC.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new X.pG,this._cachedCameraPosition=new X.pG,this._lastCheck=0,this._invertMatrixTemp=new X.Matrix,this._cameraDirectionTemp=new X.pG,(U=U||V.d.LastCreatedScene)&&(this.HG=U,U.soundTracks=[],U.ly=[])}register(){this.HG._afterRenderStage.registerStep(GC.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(U){if(U.ly=[],this.HG.soundTracks)for(let G=0;G<this.HG.soundTracks.length;G++){const C=this.HG.soundTracks[G];for(let G=0;G<C.soundCollection.length;G++)U.ly.push(C.soundCollection[G].serialize())}}addFromContainer(U){if(U.ly)for(const G of U.ly)G.play(),G.autoplay=!0,this.HG.mainSoundTrack.addSound(G)}removeFromContainer(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(U.ly)for(const C of U.ly)C.stop(),C.autoplay=!1,this.HG.mainSoundTrack.removeSound(C),G&&C.dispose()}dispose(){const U=this.HG;if(U._mainSoundTrack&&U.mainSoundTrack.dispose(),U.soundTracks)for(let G=0;G<U.soundTracks.length;G++)U.soundTracks[G].dispose()}disableAudio(){const U=this.HG;let G;for(this._audioEnabled=!1,WG.b.audioEngine&&WG.b.audioEngine.audioContext&&WG.b.audioEngine.audioContext.suspend(),G=0;G<U.mainSoundTrack.soundCollection.length;G++)U.mainSoundTrack.soundCollection[G].pause();if(U.soundTracks)for(G=0;G<U.soundTracks.length;G++)for(let C=0;C<U.soundTracks[G].soundCollection.length;C++)U.soundTracks[G].soundCollection[C].pause()}enableAudio(){const U=this.HG;let G;for(this._audioEnabled=!0,WG.b.audioEngine&&WG.b.audioEngine.audioContext&&WG.b.audioEngine.audioContext.resume(),G=0;G<U.mainSoundTrack.soundCollection.length;G++)U.mainSoundTrack.soundCollection[G].isPaused&&U.mainSoundTrack.soundCollection[G].play();if(U.soundTracks)for(G=0;G<U.soundTracks.length;G++)for(let C=0;C<U.soundTracks[G].soundCollection.length;C++)U.soundTracks[G].soundCollection[C].isPaused&&U.soundTracks[G].soundCollection[C].play()}switchAudioModeForHeadphones(){const U=this.HG;if(this._headphone=!0,U.mainSoundTrack.switchPanningModelToHRTF(),U.soundTracks)for(let G=0;G<U.soundTracks.length;G++)U.soundTracks[G].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const U=this.HG;if(this._headphone=!1,U.mainSoundTrack.switchPanningModelToEqualPower(),U.soundTracks)for(let G=0;G<U.soundTracks.length;G++)U.soundTracks[G].switchPanningModelToEqualPower()}_afterRender(){const U=lC.d.Now;if(this._lastCheck&&U-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=U;const G=this.HG;if(!this._audioEnabled||!G._mainSoundTrack||!G.soundTracks||0===G._mainSoundTrack.soundCollection.length&&1===G.soundTracks.length)return;const C=WG.b.audioEngine;if(C&&C.audioContext){let U,L=G.activeCamera;if(G.activeCameras&&G.activeCameras.length>0&&(L=G.activeCameras[0]),this.audioListenerPositionProvider){const U=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(U.x||0,U.y||0,U.z||0)}else L?this._cachedCameraPosition.equals(L.globalPosition)||(this._cachedCameraPosition.L(L.globalPosition),C.audioContext.listener.setPosition(L.globalPosition.x,L.globalPosition.y,L.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const U=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(U.x||0,U.y||0,U.z||0,0,1,0)}else L?(L.rigCameras&&L.rigCameras.length>0&&(L=L.rigCameras[0]),L.getViewMatrix().invertToRef(this._invertMatrixTemp),X.pG.TransformNormalToRef(tC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.L(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(U=0;U<G.mainSoundTrack.soundCollection.length;U++){const C=G.mainSoundTrack.soundCollection[U];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(G.soundTracks)for(U=0;U<G.soundTracks.length;U++)for(let C=0;C<G.soundTracks[U].soundCollection.length;C++){const L=G.soundTracks[U].soundCollection[C];L.useCustomAttenuation&&L.updateDistanceFromListener()}}}}tC._CameraDirection=new X.pG(0,0,-1),rG._SceneComponentInitialization=U=>{let G=U._getComponent(GC.d.NAME_AUDIO);G||(G=new tC(U),U.o(G))};const EC="MSFT_audio_emitter";class KC{constructor(U){this.name=EC,this._loader=U,this.enabled=this._loader.isExtensionUsed(EC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const U=this._loader.mK.extensions;if(U&&U[this.name]){const G=U[this.name];this._clips=G.clips,this._emitters=G.emitters,s.Assign(this._clips),s.Assign(this._emitters)}}loadSceneAsync(U,G){return A.LoadExtensionAsync(U,G,this.name,(async(C,L)=>{const X=new Array;X.push(this._loader.loadSceneAsync(U,G));for(const U of L.emitters){const G=s.Get("".concat(C,"/emitters"),this._emitters,U);if(void 0!=G.refDistance||void 0!=G.maxDistance||void 0!=G.rolloffFactor||void 0!=G.distanceModel||void 0!=G.innerAngle||void 0!=G.outerAngle)throw new Error("".concat(C,": Direction or Distance properties are not allowed on emitters attached to a scene"));X.push(this._loadEmitterAsync("".concat(C,"/emitters/").concat(G.index),G))}await Promise.all(X)}))}loadNodeAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(U,L)=>{const l=new Array,E=await this._loader.loadNodeAsync(U,G,(G=>{for(const C of L.emitters){const L=s.Get("".concat(U,"/emitters"),this._emitters,C);l.push(this._loadEmitterAsync("".concat(U,"/emitters/").concat(L.index),L).then((()=>{for(const U of L._babylonSounds)U.attachToMesh(G),void 0==L.innerAngle&&void 0==L.outerAngle||(U.setLocalDirectionToMesh(X.pG.Forward()),U.setDirectionalCone(2*t.Tools.ToDegrees(void 0==L.innerAngle?Math.PI:L.innerAngle),2*t.Tools.ToDegrees(void 0==L.outerAngle?Math.PI:L.outerAngle),0))})))}C(G)}));return await Promise.all(l),E}))}loadAnimationAsync(U,G){return A.LoadExtensionAsync(U,G,this.name,(async(C,L)=>{const X=await this._loader.loadAnimationAsync(U,G),l=new Array;s.Assign(L.events);for(const t of L.events)l.push(this._loadAnimationEventAsync("".concat(C,"/events/").concat(t.index),U,G,t,X));return await Promise.all(l),X}))}_loadClipAsync(U,G){if(G._objectURL)return G._objectURL;let C;if(G.uri)C=this._loader.loadUriAsync(U,G,G.uri);else{const L=s.Get("".concat(U,"/bufferView"),this._loader.mK.bufferViews,G.bufferView);C=this._loader.loadBufferViewAsync("/bufferViews/".concat(L.index),L)}return G._objectURL=C.then((U=>URL.createObjectURL(new Blob([U],{type:G.mimeType})))),G._objectURL}_loadEmitterAsync(U,G){if(G._babylonSounds=G._babylonSounds||[],!G._babylonData){const U=new Array,C=G.name||"LG".concat(G.index),L={loop:!1,autoplay:!1,volume:void 0==G.volume?1:G.volume};for(let l=0;l<G.clips.length;l++){const X="/extensions/".concat(this.name,"/clips"),t=s.Get(X,this._clips,G.clips[l].clip);U.push(this._loadClipAsync("".concat(X,"/").concat(G.clips[l].clip),t).then((U=>{const X=G._babylonSounds[l]=new rG(C,U,this._loader.babylonScene,null,L);X.refDistance=G.refDistance||1,X.maxDistance=G.maxDistance||256,X.rolloffFactor=G.rolloffFactor||1,X.distanceModel=G.distanceModel||"exponential"})))}const X=Promise.all(U).then((()=>{const U=G.clips.map((U=>U.weight||1)),C=new JG(G.loop||!1,G._babylonSounds,U);G.innerAngle&&(C.directionalConeInnerAngle=2*t.Tools.ToDegrees(G.innerAngle)),G.outerAngle&&(C.directionalConeOuterAngle=2*t.Tools.ToDegrees(G.outerAngle)),G.volume&&(C.volume=G.volume),G._babylonData.sound=C}));G._babylonData={loaded:X}}return G._babylonData.loaded}_getEventAction(U,G,C,L,X){switch(C){case"play":return U=>{const C=(X||0)+(U-L);G.play(C)};case"stop":return()=>{G.stop()};case"pause":return()=>{G.pause()};default:throw new Error("".concat(U,": Unsupported action ").concat(C))}}_loadAnimationEventAsync(U,G,C,L,X){if(0==X.targetedAnimations.length)return Promise.resolve();const l=X.targetedAnimations[0],t=L.LG,E=s.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,t);return this._loadEmitterAsync(U,E).then((()=>{const G=E._babylonData.sound;if(G){const C=new cG(L.time,this._getEventAction(U,G,L.action,L.time,L.startOffset));l.animation.addEvent(C),X.onAnimationGroupEndObservable.add((()=>{G.stop()})),X.onAnimationGroupPauseObservable.add((()=>{G.pause()}))}}))}}mU(EC),Q(EC,!0,(U=>new KC(U)));const PC="MSFT_lod";class OC{constructor(U){var G,C;this.name=PC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new O.e,this.onMaterialLODsLoadedObservable=new O.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=U,this.maxLODsToLoad=null!==(G=null===(C=this._loader.parent.extensionOptions[PC])||void 0===C?void 0:C.maxLODsToLoad)&&void 0!==G?G:this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(PC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let U=0;U<this._nodePromiseLODs.length;U++){const G=Promise.all(this._nodePromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter("Node LOD ".concat(U)),this._loader.log("Loaded node LOD ".concat(U))),this.onNodeLODsLoadedObservable.notifyObservers(U),U!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter("Node LOD ".concat(U+1)),this._loadBufferLOD(this._nodeBufferLODs,U+1),this._nodeSignalLODs[U]&&this._nodeSignalLODs[U].resolve())}));this._loader._completePromises.push(G)}for(let U=0;U<this._materialPromiseLODs.length;U++){const G=Promise.all(this._materialPromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter("Material LOD ".concat(U)),this._loader.log("Loaded material LOD ".concat(U))),this.onMaterialLODsLoadedObservable.notifyObservers(U),U!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter("Material LOD ".concat(U+1)),this._loadBufferLOD(this._materialBufferLODs,U+1),this._materialSignalLODs[U]&&this._materialSignalLODs[U].resolve())}));this._loader._completePromises.push(G)}}loadSceneAsync(U,G){const C=this._loader.loadSceneAsync(U,G);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(U,G,C){return A.LoadExtensionAsync(U,G,this.name,(async(U,X)=>{let l;const t=this._getLODs(U,G,this._loader.mK.nodes,X.ids);this._loader.logOpen("".concat(U));for(let G=0;G<t.length;G++){const U=t[G];0!==G&&(this._nodeIndexLOD=G,this._nodeSignalLODs[G]=this._nodeSignalLODs[G]||new L);const X=U=>{C(U),U.NK(!1)},E=this._loader.loadNodeAsync("/nodes/".concat(U.index),U,X).then((U=>{if(0!==G){const U=t[G-1];U._babylonTransformNode&&(this._disposeTransformNode(U._babylonTransformNode),delete U._babylonTransformNode)}return U.NK(!0),U}));this._nodePromiseLODs[G]=this._nodePromiseLODs[G]||[],0===G?l=E:(this._nodeIndexLOD=null,this._nodePromiseLODs[G].push(E))}return this._loader.logClose(),await l}))}_loadMaterialAsync(U,G,C,L,X){return this._nodeIndexLOD?null:A.LoadExtensionAsync(U,G,this.name,(async(U,l)=>{let t;const E=this._getLODs(U,G,this._loader.mK.materials,l.ids);this._loader.logOpen("".concat(U));for(let G=0;G<E.length;G++){const U=E[G];0!==G&&(this._materialIndexLOD=G);const l=this._loader._loadMaterialAsync("/materials/".concat(U.index),U,C,L,(U=>{0===G&&X(U)})).then((U=>{if(0!==G){X(U);const C=E[G-1]._data;C[L]&&(this._disposeMaterials([C[L].babylonMaterial]),delete C[L])}return U}));this._materialPromiseLODs[G]=this._materialPromiseLODs[G]||[],0===G?t=l:(this._materialIndexLOD=null,this._materialPromiseLODs[G].push(l))}return this._loader.logClose(),await t}))}_loadUriAsync(U,G,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const X=this._nodeIndexLOD-1;return this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new L,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(U,G,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const X=this._materialIndexLOD-1;return this._materialSignalLODs[X]=this._materialSignalLODs[X]||new L,this._materialSignalLODs[X].promise.then((async()=>await this._loader.loadUriAsync(U,G,C)))}return null}loadBufferAsync(U,G,C,X){if(this._loader.parent.useRangeRequests&&!G.uri){if(!this._loader.bin)throw new Error("".concat(U,": Uri is missing or the binary glTF is missing its binary chunk"));const G=async(U,G)=>{const l=C,t=l+X-1;let E=U[G];return E?(E.start=Math.min(E.start,l),E.end=Math.max(E.end,t)):(E={start:l,end:t,loaded:new L},U[G]=E),await E.loaded.promise.then((U=>new Uint8Array(U.buffer,U.byteOffset+C-E.start,X)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?G(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?G(this._materialBufferLODs,this._materialIndexLOD):G(this._bufferLODs,0)}return null}_loadBufferLOD(U,G){const C=U[G];C&&(this._loader.log("Loading buffer range [".concat(C.start,"-").concat(C.end,"]")),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((U=>{C.loaded.resolve(U)}),(U=>{C.loaded.reject(U)})))}_getLODs(U,G,C,L){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const X=[];for(let l=L.length-1;l>=0;l--)if(X.push(s.Get("".concat(U,"/ids/").concat(L[l]),C,L[l])),X.length===this.maxLODsToLoad)return X;return X.push(G),X}_disposeTransformNode(U){const G=[],C=U.material;C&&G.push(C);for(const X of U.getChildMeshes())X.material&&G.push(X.material);U.dispose();const L=G.filter((U=>this._loader.babylonScene.meshes.every((G=>G.material!=U))));this._disposeMaterials(L)}_disposeMaterials(U){const G={};for(const C of U){for(const U of C.getActiveTextures())G[U.uniqueId]=U;C.dispose()}for(const C in G)for(const U of this._loader.babylonScene.materials)U.hasTexture(G[C])&&delete G[C];for(const C in G)G[C].dispose()}}mU(PC),Q(PC,!0,(U=>new OC(U)));const TC="MSFT_minecraftMesh";class DC{constructor(U){this.name=TC,this._loader=U,this.enabled=this._loader.isExtensionUsed(TC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtraAsync(U,G,this.name,(async(L,X)=>{if(X){if(!(C instanceof h.c))throw new Error("".concat(L,": Material type not supported"));const X=this._loader.loadMaterialPropertiesAsync(U,G,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.RE=C.forceDepthWrite,C.twoSidedLighting=!0,await X}}))}}mU(TC),Q(TC,!0,(U=>new DC(U)));const yC="MSFT_sRGBFactors";class VC{constructor(U){this.name=yC,this._loader=U,this.enabled=this._loader.isExtensionUsed(yC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,G,C){return A.LoadExtraAsync(U,G,this.name,(async(L,X)=>{if(X){if(!(C instanceof h.c))throw new Error("".concat(L,": Material type not supported"));const X=this._loader.loadMaterialPropertiesAsync(U,G,C),l=C.wU().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,l),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,l),await X}}))}}mU(yC),Q(yC,!0,(U=>new VC(U)));var pC=C(14120);const IC={};var HC=C(14173),xC=C(14148),hC=C(14126),NC=C(14134);function bC(U,G){for(const C of U)for(const U of C.dataOutputs)if(U.uniqueId===G)return U;throw new Error("Could not find data out connection with unique id "+G)}function oC(U,G){for(const C of U)if(C instanceof xC.d)for(const U of C.signalInputs)if(U.uniqueId===G)return U;throw new Error("Could not find signal in connection with unique id "+G)}async function wC(U,G){const L=await Promise.all(U.allBlocks.map((async U=>{const G=function(U){switch(U){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(78),C.e(79)]).then(C.bind(C,15605))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(80).then(C.bind(C,15610))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(81).then(C.bind(C,15614))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(82).then(C.bind(C,15621))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(83).then(C.bind(C,15630))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(84).then(C.bind(C,15635))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(85).then(C.bind(C,15640))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(86).then(C.bind(C,15646))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(87).then(C.bind(C,15655))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(90).then(C.bind(C,15684))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(90).then(C.bind(C,15684))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(90).then(C.bind(C,15684))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(90).then(C.bind(C,15684))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(95).then(C.bind(C,15692))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(96).then(C.bind(C,15700))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(97).then(C.bind(C,15706))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(98).then(C.bind(C,15709))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(99).then(C.bind(C,15712))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(100).then(C.bind(C,15718))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(101).then(C.bind(C,15725))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(102).then(C.bind(C,15728))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(103).then(C.bind(C,15736))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(104).then(C.bind(C,15739))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(105).then(C.bind(C,15747))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(106).then(C.bind(C,15756))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(107).then(C.bind(C,15758))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(108).then(C.bind(C,15763))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(109).then(C.bind(C,15766))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(110).then(C.bind(C,15768))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(111).then(C.bind(C,15770))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(112).then(C.bind(C,15778))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(113).then(C.bind(C,15786))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(92).then(C.bind(C,15790))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(114).then(C.bind(C,15792))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(115).then(C.bind(C,15795))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(116).then(C.bind(C,15797))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(93).then(C.bind(C,15805))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(88).then(C.bind(C,15658))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,15807))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(89).then(C.bind(C,15680))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(90).then(C.bind(C,15684))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(90).then(C.bind(C,15684))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(91).then(C.bind(C,15812))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(91).then(C.bind(C,15812))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(91).then(C.bind(C,15812))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(91).then(C.bind(C,15812))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(91).then(C.bind(C,15812))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(91).then(C.bind(C,15812))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(117).then(C.bind(C,15820))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(118).then(C.bind(C,15826))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(119).then(C.bind(C,15834))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(120).then(C.bind(C,15841))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(121).then(C.bind(C,15843))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(122).then(C.bind(C,15849))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(123).then(C.bind(C,15858))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(124).then(C.bind(C,15866))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(125).then(C.bind(C,15868))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(126).then(C.bind(C,15875))).FlowGraphDataSwitchBlock;default:if(IC[U])return IC[U];throw new Error("Unknown block name ".concat(U))}}(U.className);return await G()})));return function(U,G,C){var L;const X=G.coordinator.createGraph(),l=[],t=null!==(L=G.valueParseFunction)&&void 0!==L?L:hC.c;for(let E=0;E<U.allBlocks.length;E++){const L=vC(U.allBlocks[E],{HG:G.coordinator.config.HG,pathConverter:G.pathConverter,assetsContainer:G.coordinator.config.HG,valueParseFunction:t},C[E]);l.push(L),L instanceof HC.d&&X.addEventBlock(L)}for(const E of l){for(const U of E.dataInputs)for(const G of U.connectedPointIds){const C=bC(l,G);U.connectTo(C)}if(E instanceof xC.d)for(const U of E.signalOutputs)for(const G of U.connectedPointIds){const C=oC(l,G);U.connectTo(C)}}for(const E of U.executionContexts)SC(E,{graph:X,valueParseFunction:t},U.rightHanded);return X}(U,G,L)}function SC(U,G,C){var L;const X=G.graph.createContext();U.enableLogging&&(X.enableLogging=!0),X.treatDataAsRightHanded=C||!1;const l=null!==(L=G.valueParseFunction)&&void 0!==L?L:hC.c;X.uniqueId=U.uniqueId;const t=X.wU();if(U._assetsContext){var E,K,P,O,T,D,y,V,p,I;const G=U._assetsContext,C={meshes:null===(E=G.meshes)||void 0===E?void 0:E.map((U=>t.getMeshById(U))),lights:null===(K=G.lights)||void 0===K?void 0:K.map((U=>t.getLightByName(U))),cameras:null===(P=G.cameras)||void 0===P?void 0:P.map((U=>t.getCameraByName(U))),materials:null===(O=G.materials)||void 0===O?void 0:O.map((U=>t.getMaterialById(U))),textures:null===(T=G.textures)||void 0===T?void 0:T.map((U=>t.getTextureByName(U))),animations:null===(D=G.animations)||void 0===D?void 0:D.map((U=>t.animations.find((G=>G.name===U)))),skeletons:null===(y=G.skeletons)||void 0===y?void 0:y.map((U=>t.getSkeletonByName(U))),SD:null===(V=G.SD)||void 0===V?void 0:V.map((U=>t.getParticleSystemById(U))),animationGroups:null===(p=G.animationGroups)||void 0===p?void 0:p.map((U=>t.getAnimationGroupByName(U))),transformNodes:null===(I=G.transformNodes)||void 0===I?void 0:I.map((U=>t.getTransformNodeById(U))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ly:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};X.assetsContext=C}for(const H in U._userVariables){const G=l(H,U._userVariables,X.assetsContext,t);X.userVariables[H]=G}for(const H in U._connectionValues){const G=l(H,U._connectionValues,X.assetsContext,t);X._setConnectionValueByKey(H,G)}return X}function vC(U,G,C){var L;const X={},l=null!==(L=G.valueParseFunction)&&void 0!==L?L:hC.c;if(U.config)for(const E in U.config)X[E]=l(E,U.config,G.assetsContainer||G.HG,G.HG);if((0,hC.g)(U.className)){if(!G.pathConverter)throw new Error("Path converter is required for this block");X.pathConverter=G.pathConverter}const t=new C(X);t.uniqueId=U.uniqueId;for(let E=0;E<U.dataInputs.length;E++){const G=t.getDataInput(U.dataInputs[E].name);if(!G)throw new Error("Could not find data input with name "+U.dataInputs[E].name+" in block "+U.className);G.deserialize(U.dataInputs[E])}for(let E=0;E<U.dataOutputs.length;E++){const G=t.getDataOutput(U.dataOutputs[E].name);if(!G)throw new Error("Could not find data output with name "+U.dataOutputs[E].name+" in block "+U.className);G.deserialize(U.dataOutputs[E])}return t.metadata=U.metadata,t.deserialize&&t.deserialize(U),t}function uC(U){const[G,C]=U.split(":");return dC({op:G,extension:C})}function dC(U){var G;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=U.extension?null===(G=ZC[U.extension])||void 0===G?void 0:G[U.op]:FC[U.op];if(!L&&(p.d.Warn("No mapping found for operation ".concat(U.op," and extension ").concat(U.extension||"KHR_interactivity")),C)){const G={},C={flows:{}};if(U.inputValueSockets){G.values={};for(const C in U.inputValueSockets)G.values[C]={name:C}}return U.outputValueSockets&&(C.values={},Object.keys(U.outputValueSockets).forEach((U=>{C.values[U]={name:U}}))),{MO:[],inputs:G,outputs:C}}return L}function gC(U,G,C){ZC[G]||(ZC[G]={}),ZC[G][U]=C}const ZC={BABYLON:{"flow/log":{MO:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},FC={"event/onStart":{MO:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{MO:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{MO:["FlowGraphSendCustomEventBlock"],extraProcessor(U,G,C,L,X){if("event/send"!==G.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const l=U.configuration.event.value[0];if("number"!==typeof l)throw new Error("Event id should be a number");const t=L.arrays.events[l],E=X[0];return E.config||(E.config={}),E.config.eventId=t.eventId,E.config.eventData=t.eventData,X}},"event/receive":{MO:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(U,G){var C;if(!U.configuration)return p.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const L=U.configuration.event;if(!L)return p.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const X=L.value[0];if("number"!==typeof X)return p.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=G.events)||void 0===C?void 0:C[X])?{valid:!0}:(p.d.Error("Event with id ".concat(X," not found")),{valid:!1,error:"Event with id ".concat(X," not found")})},extraProcessor(U,G,C,L,X){if("event/receive"!==G.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const l=U.configuration.event.value[0];if("number"!==typeof l)throw new Error("Event id should be a number");const t=L.arrays.events[l],E=X[0];return E.config||(E.config={}),E.config.eventId=t.eventId,E.config.eventData=t.eventData,X}},"math/e":qC("FlowGraphEBlock"),"math/pi":qC("FlowGraphPIBlock"),"math/inf":qC("FlowGraphInfBlock"),"math/nan":qC("FlowGraphNaNBlock"),"math/abs":qC("FlowGraphAbsBlock"),"math/sign":qC("FlowGraphSignBlock"),"math/trunc":qC("FlowGraphTruncBlock"),"math/floor":qC("FlowGraphFloorBlock"),"math/ceil":qC("FlowGraphCeilBlock"),"math/round":{MO:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X){var l;return(l=X[0]).config||(l.config={}),X[0].config.roundHalfAwayFromZero=!0,X}},"math/fract":qC("FlowGraphFractBlock"),"math/neg":qC("FlowGraphNegationBlock"),"math/add":qC("FlowGraphAddBlock",["a","b"],!0),"math/sub":qC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{MO:["FlowGraphMultiplyBlock"],extraProcessor(U,G,C,L,X){var l;(l=X[0]).config||(l.config={}),X[0].config.useMatrixPerComponent=!0,X[0].config.preventIntegerFloatArithmetic=!0;let t=-1;return Object.keys(U.values||{}).find((G=>{var C;return void 0!==(null===(C=U.values)||void 0===C?void 0:C[G].type)&&(t=U.values[G].type,!0)})),-1!==t&&(X[0].config.type=L.arrays.types[t].flowGraphType),X},validation:U=>U.values?aC(U):{valid:!0}},"math/div":qC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":qC("FlowGraphModuloBlock",["a","b"]),"math/min":qC("FlowGraphMinBlock",["a","b"]),"math/max":qC("FlowGraphMaxBlock",["a","b"]),"math/clamp":qC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":qC("FlowGraphSaturateBlock"),"math/mix":qC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":qC("FlowGraphEqualityBlock",["a","b"]),"math/lt":qC("FlowGraphLessThanBlock",["a","b"]),"math/le":qC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":qC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":qC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":qC("FlowGraphIsNaNBlock"),"math/isinf":qC("FlowGraphIsInfBlock"),"math/select":{MO:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{MO:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":qC("FlowGraphSinBlock"),"math/cos":qC("FlowGraphCosBlock"),"math/tan":qC("FlowGraphTanBlock"),"math/asin":qC("FlowGraphASinBlock"),"math/acos":qC("FlowGraphACosBlock"),"math/atan":qC("FlowGraphATanBlock"),"math/atan2":qC("FlowGraphATan2Block",["a","b"]),"math/sinh":qC("FlowGraphSinhBlock"),"math/cosh":qC("FlowGraphCoshBlock"),"math/tanh":qC("FlowGraphTanhBlock"),"math/asinh":qC("FlowGraphASinhBlock"),"math/acosh":qC("FlowGraphACoshBlock"),"math/atanh":qC("FlowGraphATanhBlock"),"math/exp":qC("FlowGraphExponentialBlock"),"math/log":qC("FlowGraphLogBlock"),"math/log2":qC("FlowGraphLog2Block"),"math/log10":qC("FlowGraphLog10Block"),"math/sqrt":qC("FlowGraphSquareRootBlock"),"math/cbrt":qC("FlowGraphCubeRootBlock"),"math/pow":qC("FlowGraphPowerBlock",["a","b"]),"math/length":qC("FlowGraphLengthBlock"),"math/normalize":qC("FlowGraphNormalizeBlock"),"math/dot":qC("FlowGraphDotBlock",["a","b"]),"math/cross":qC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":qC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":qC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{MO:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{MO:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{MO:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{MO:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{MO:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{MO:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{MO:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":qC("FlowGraphTransposeBlock"),"math/determinant":qC("FlowGraphDeterminantBlock"),"math/inverse":qC("FlowGraphInvertMatrixBlock"),"math/matmul":qC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{MO:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"fE",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X,l){const t=X[0].dataInputs.find((U=>"rotationQuaternion"===U.name));if(!t)throw new Error("Rotation quaternion input not found");return l._connectionValues[t.uniqueId]&&(l._connectionValues[t.uniqueId].type="Quaternion"),X}},"math/matDecompose":{MO:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"fE"}}}},"math/quatConjugate":qC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{MO:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X){var l;return(l=X[0]).config||(l.config={}),X[0].config.type="Quaternion",X}},"math/quatAngleBetween":qC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{MO:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":qC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":qC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{MO:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X){var l;return(l=X[0]).config||(l.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract2x2":{MO:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{MO:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X){var l;return(l=X[0]).config||(l.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract3x3":{MO:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{MO:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X){var l;return(l=X[0]).config||(l.config={}),X[0].config.inputIsColumnMajor=!0,X}},"math/extract4x4":{MO:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{MO:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X,l){var t,E,K;(K=X[0]).config||(K.config={});const P=X[0].dataInputs[0];return X[0].config.valueType=null!==(t=null===(E=l._connectionValues[P.uniqueId])||void 0===E?void 0:E.type)&&void 0!==t?t:"FlowGraphInteger",X}},"math/and":{MO:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X,l){var t,E,K,P,O;(O=X[0]).config||(O.config={});const T=X[0].dataInputs[0],D=X[0].dataInputs[1];return X[0].config.valueType=null!==(t=null!==(E=null===(K=l._connectionValues[T.uniqueId])||void 0===K?void 0:K.type)&&void 0!==E?E:null===(P=l._connectionValues[D.uniqueId])||void 0===P?void 0:P.type)&&void 0!==t?t:"FlowGraphInteger",X}},"math/or":{MO:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X,l){var t,E,K,P,O;(O=X[0]).config||(O.config={});const T=X[0].dataInputs[0],D=X[0].dataInputs[1];return X[0].config.valueType=null!==(t=null!==(E=null===(K=l._connectionValues[T.uniqueId])||void 0===K?void 0:K.type)&&void 0!==E?E:null===(P=l._connectionValues[D.uniqueId])||void 0===P?void 0:P.type)&&void 0!==t?t:"FlowGraphInteger",X}},"math/xor":{MO:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,G,C,L,X,l){var t,E,K,P,O;(O=X[0]).config||(O.config={});const T=X[0].dataInputs[0],D=X[0].dataInputs[1];return X[0].config.valueType=null!==(t=null!==(E=null===(K=l._connectionValues[T.uniqueId])||void 0===K?void 0:K.type)&&void 0!==E?E:null===(P=l._connectionValues[D.uniqueId])||void 0===P?void 0:P.type)&&void 0!==t?t:"FlowGraphInteger",X}},"math/asr":qC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":qC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":qC("FlowGraphLeadingZerosBlock"),"math/ctz":qC("FlowGraphTrailingZerosBlock"),"math/popcnt":qC("FlowGraphOneBitsCounterBlock"),"math/rad":qC("FlowGraphDegToRadBlock"),"math/deg":qC("FlowGraphRadToDegBlock"),"type/boolToInt":qC("FlowGraphBooleanToInt"),"type/boolToFloat":qC("FlowGraphBooleanToFloat"),"type/intToBool":qC("FlowGraphIntToBoolean"),"type/intToFloat":qC("FlowGraphIntToFloat"),"type/floatToInt":qC("FlowGraphFloatToInt"),"type/floatToBool":qC("FlowGraphFloatToBoolean"),"flow/sequence":{MO:["FlowGraphSequenceBlock"],extraProcessor(U,G,C,L,X){const l=X[0];return l.config||(l.config={}),l.config.outputSignalCount=Object.keys(U.flows||[]).length,l.signalOutputs.forEach(((U,G)=>{U.name="out_"+G})),X}},"flow/branch":{MO:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{MO:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(U){if(U.configuration&&U.configuration.cases){const G=U.configuration.cases.value;if(!G.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return p.d.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const C=new Set(G);U.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(U,G,C,L,X){if("flow/switch"!==G.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return X[0].signalOutputs.forEach((U=>{"default"!==U.name&&(U.name="out_"+U.name)})),X}},"flow/while":{MO:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{MO:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(U,G,C,L,X){const l=X[0];return l.config||(l.config={}),l.config.incrementIndexWhenLoopDone=!0,X}},"flow/doN":{MO:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{MO:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(U,G,C,L,X){if("flow/multiGate"!==G.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const l=X[0];return l.config||(l.config={}),l.config.outputSignalCount=Object.keys(U.flows).length,l.signalOutputs.forEach(((U,G)=>{U.name="out_"+G})),X}},"flow/waitAll":{MO:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(U){var G,C;return"number"!==typeof(null===(G=U.configuration)||void 0===G||null===(C=G.inputFlows)||void 0===C?void 0:C.value[0])&&(U.configuration=U.configuration||{inputFlows:{value:[0]}},U.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{MO:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{MO:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{MO:["FlowGraphCancelDelayBlock"]},"variable/get":{MO:["FlowGraphGetVariableBlock"],validation(U){var G,C;return null!==(G=U.configuration)&&void 0!==G&&null!==(C=G.variable)&&void 0!==C&&C.value?{valid:!0}:(p.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,G)=>[G.getVariableName(U[0])]}}},"variable/set":{MO:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,G)=>[G.getVariableName(U[0])]}}},"variable/setMultiple":{MO:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(U,G)=>[U[0].map((U=>G.getVariableName(U)))]}},extraProcessor:(U,G,C,L,X)=>(X[0].dataInputs.forEach((U=>{U.name=L.getVariableName(+U.name)})),X)},"variable/interpolate":{MO:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(U,G)=>[G.getVariableName(U[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:U=>!0===U[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",SC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",SC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",SC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",SC:"FlowGraphPlayAnimationBlock"},out:{name:"out",SC:"FlowGraphPlayAnimationBlock"},done:{name:"done",SC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(U,G,C,L,X){var l,t,E;const K=X[0],P=null===(l=U.configuration)||void 0===l?void 0:l.variable.value[0];if("number"!==typeof P)throw p.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const O=L.arrays.staticVariables[P];"undefined"===typeof K.config.animationType.value&&(L.arrays.staticVariables,K.config.animationType.value=(0,NC.O)(O.type));const T=X[4];return T.config||(T.config={}),(t=T.config).variable||(t.variable={}),T.config.variable.value=L.getVariableName(P),(E=X[3]).config||(E.config={}),X}},"pointer/get":{MO:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",SC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",SC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,G,C,L,X)=>(X.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),X)},"pointer/set":{MO:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",SC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",SC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,G,C,L,X)=>(X.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),X)},"pointer/interpolate":{MO:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",SC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",SC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",SC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",SC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",SC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",SC:"FlowGraphPlayAnimationBlock"},out:{name:"out",SC:"FlowGraphPlayAnimationBlock"},done:{name:"done",SC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,G,C,L,X)=>(X.forEach((G=>{"FlowGraphJsonPointerParserBlock"===G.className?(G.config||(G.config={}),G.config.outputValue=!0):"FlowGraphInterpolationBlock"===G.className&&(G.config||(G.config={}),Object.keys(U.values||[]).forEach((C=>{var X;const l=null===(X=U.values)||void 0===X?void 0:X[C];if("value"===C&&l){const U=l.type;void 0!==U&&(G.config.animationType=L.arrays.types[U].flowGraphType)}})))})),X)},"animation/start":{MO:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",SC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(U,G)=>[U[0]*G._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(U,G)=>[U[0]*G._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,G,C,L,X,l,t){const E=X[X.length-1];return E.config||(E.config={}),E.config.glTF=t,X}},"animation/stop":{MO:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",SC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,G,C,L,X,l,t){const E=X[X.length-1];return E.config||(E.config={}),E.config.glTF=t,X}},"animation/stopAt":{MO:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",SC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(U,G)=>[U[0]*G._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,G,C,L,X,l,t){const E=X[X.length-1];return E.config||(E.config={}),E.config.glTF=t,X}},"math/switch":{MO:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(U){if(U.configuration&&U.configuration.cases){const G=U.configuration.cases.value;if(!G.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return p.d.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const C=new Set(G);U.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(U,G,C,L,X){const l=X[0];return l.dataInputs.forEach((U=>{"default"!==U.name&&"case"!==U.name&&(U.name="in_"+U.name)})),l.config||(l.config={}),l.config.treatCasesAsIntegers=!0,X}},"debug/log":{MO:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function qC(U){let G=arguments.length>2?arguments[2]:void 0;return{MO:[U],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((U,G)=>(U[G]={name:G},U)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(U,C,L,X,l){var t;if(G){(t=l[0]).config||(t.config={}),l[0].config.preventIntegerFloatArithmetic=!0;let G=-1;Object.keys(U.values||{}).find((C=>{var L;return void 0!==(null===(L=U.values)||void 0===L?void 0:L[C].type)&&(G=U.values[C].type,!0)})),-1!==G&&(l[0].config.type=X.arrays.types[G].flowGraphType)}return l},validation:U=>G?aC(U):{valid:!0}}}function aC(U){if(U.values){const G=Object.keys(U.values).map((G=>U.values[G].type)).filter((U=>void 0!==U));if(!G.every((U=>U===G[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}FC["math/compose"]=FC["math/matCompose"],FC["math/decompose"]=FC["math/matDecompose"];var kC=C(12853);const nC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"pG",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class QC{constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=U,this._gltf=G,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const U of this._interactivityGraph.types)this._types.push(nC[U.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const U of this._interactivityGraph.declarations){const G=dC(U);if(!G)throw p.d.Error(["No mapping found for declaration",U]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:G,fullOperationName:U.extension?U.op+":"+U.extension:U.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const U of this._interactivityGraph.variables){const G=this._parseVariable(U);this._staticVariables.push(G)}}_parseVariable(U,G){const C=this._types[U.type];if(!C)throw p.d.Error(["No type found for variable",U]),new Error("Error parsing variables");if(U.value&&U.value.length!==C.length)throw p.d.Error(["Invalid value length for variable",U,C]),new Error("Error parsing variables");const L=U.value||[];if(!L.length)switch(C.flowGraphType){case"boolean":L.push(!1);break;case"FlowGraphInteger":L.push(0);break;case"number":L.push(NaN);break;case"Vector2":L.push(NaN,NaN);break;case"pG":L.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":L.fill(NaN,0,4);break;case"Matrix":L.fill(NaN,0,16);break;case"Matrix3D":L.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof L[0]&&(L[0]=parseFloat(L[0])),{type:C.flowGraphType,value:G?G(L,this):L}}_parseEvents(){if(this._interactivityGraph.events)for(const U of this._interactivityGraph.events){const G={eventId:U.id||"internalEvent_"+this._internalEventsCounter++};U.values&&(G.eventData=Object.keys(U.values).map((G=>{var C;const L=null===(C=U.values)||void 0===C?void 0:C[G];if(!L)throw p.d.Error(["No value found for event key",G]),new Error("Error parsing events");const X=this._types[L.type];if(!X)throw p.d.Error(["No type found for event value",L]),new Error("Error parsing events");const l="undefined"!==typeof L.value?this._parseVariable(L):void 0;return{id:G,type:X.flowGraphType,eventData:!0,value:l}}))),this._events.push(G)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const G of this._interactivityGraph.nodes){if("number"!==typeof G.declaration)throw p.d.Error(["No declaration found for node",G]),new Error("Error parsing nodes");const C=this._mappings[G.declaration];if(!C)throw p.d.Error(["No mapping found for node",G]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const L=C.flowGraphMapping.validation(G,this._interactivityGraph,this._gltf);var U;if(!L.valid)throw new Error("Error validating interactivity node ".concat(null===(U=this._interactivityGraph.declarations)||void 0===U?void 0:U[G.declaration].op," - ").concat(L.error))}const L=[];for(const U of C.flowGraphMapping.MO){const X=this._getEmptyBlock(U,C.fullOperationName);this._parseNodeConfiguration(G,X,C.flowGraphMapping,U),L.push(X)}this._nodes.push({MO:L,fullOperationName:C.fullOperationName})}}_getEmptyBlock(U,G){return{uniqueId:(0,kC.c)(),className:U,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:G,metadata:{}}}_parseNodeConfiguration(U,G,C,L){const X=G.config;if(U.configuration){const G=Object.keys(U.configuration);for(const E of G){var l,t;const G=null===(l=U.configuration)||void 0===l?void 0:l[E];if(!G)throw p.d.Error(["No value found for node configuration",E]),new Error("Error parsing node configuration");const K=null===(t=C.configuration)||void 0===t?void 0:t[E];if(K&&K.SC?K.SC===L:0===C.MO.indexOf(L)){const U=(null===K||void 0===K?void 0:K.name)||E;G&&"undefined"!==typeof G.value||"undefined"===typeof(null===K||void 0===K?void 0:K.defaultValue)?G.value.length>=0?X[U]={value:1===G.value.length?G.value[0]:G.value}:p.d.Warn(["Invalid value for node configuration",G]):X[U]={value:K.defaultValue},K&&K.dataTransformer&&(X[U].value=K.dataTransformer([X[U].value],this)[0])}}}}_parseNodeConnections(U){for(let o=0;o<this._nodes.length;o++){var G;const w=null===(G=this._interactivityGraph.nodes)||void 0===G?void 0:G[o];if(!w)throw p.d.Error(["No node found for interactivity node",this._nodes[o]]),new Error("Error parsing node connections");const S=this._nodes[o],v=this._mappings[w.declaration];if(!v)throw p.d.Error(["No mapping found for node",w]),new Error("Error parsing node connections");const u=w.flows||{},d=Object.keys(u).sort();for(const U of d){var C,L,X,l;const G=u[U],P=null===(C=v.flowGraphMapping.outputs)||void 0===C||null===(L=C.flows)||void 0===L?void 0:L[U],O=(null===P||void 0===P?void 0:P.name)||U,T=this._createNewSocketConnection(O,!0);(P&&P.SC&&S.MO.find((U=>U.className===P.SC))||S.MO[0]).signalOutputs.push(T);const D=G.node,y=this._nodes[D];if(!y)throw p.d.Error(["No node found for input node id",D]),new Error("Error parsing node connections");const V=uC(y.fullOperationName);if(!V)throw p.d.Error(["No mapping found for input node",y]),new Error("Error parsing node connections");let I=null===(X=V.inputs)||void 0===X||null===(l=X.flows)||void 0===l?void 0:l[G.socket||"in"],H=!1;if(!I)for(const U in null===(t=V.inputs)||void 0===t?void 0:t.flows){var t,E,K;if(U.startsWith("[")&&U.endsWith("]"))H=!0,I=null===(E=V.inputs)||void 0===E||null===(K=E.flows)||void 0===K?void 0:K[U]}const x=I?H?I.name.replace("$1",G.socket||""):I.name:G.socket||"in",h=I&&I.SC&&y.MO.find((U=>U.className===I.SC))||y.MO[0];let N=h.signalInputs.find((U=>U.name===x));N||(N=this._createNewSocketConnection(x),h.signalInputs.push(N)),N.connectedPointIds.push(T.uniqueId),T.connectedPointIds.push(N.uniqueId)}const g=w.values||{},Z=Object.keys(g);for(const G of Z){var P,O;const C=g[G];let L=null===(P=v.flowGraphMapping.inputs)||void 0===P||null===(O=P.values)||void 0===O?void 0:O[G],X=!1;if(!L)for(const U in null===(T=v.flowGraphMapping.inputs)||void 0===T?void 0:T.values){var T,D,y;if(U.startsWith("[")&&U.endsWith("]"))X=!0,L=null===(D=v.flowGraphMapping.inputs)||void 0===D||null===(y=D.values)||void 0===y?void 0:y[U]}const l=L?X?L.name.replace("$1",G):L.name:G,t=this._createNewSocketConnection(l);if((L&&L.SC&&S.MO.find((U=>U.className===L.SC))||S.MO[0]).dataInputs.push(t),void 0!==C.value){const G=this._parseVariable(C,L&&L.dataTransformer);U._connectionValues[t.uniqueId]=G}else{if("undefined"===typeof C.node)throw p.d.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var V,I,H;const U=C.node,G=C.socket||"value",L=this._nodes[U];if(!L)throw p.d.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const X=uC(L.fullOperationName);if(!X)throw p.d.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let l=null===(V=X.outputs)||void 0===V||null===(I=V.values)||void 0===I?void 0:I[G],E=!1;if(!l)for(const C in null===(x=X.outputs)||void 0===x?void 0:x.values){var x,h,N;if(C.startsWith("[")&&C.endsWith("]"))E=!0,l=null===(h=X.outputs)||void 0===h||null===(N=h.values)||void 0===N?void 0:N[C]}const K=l?E?l.name.replace("$1",G):null===(H=l)||void 0===H?void 0:H.name:G,P=l&&l.SC&&L.MO.find((U=>U.className===l.SC))||L.MO[0];let O=P.dataOutputs.find((U=>U.name===K));O||(O=this._createNewSocketConnection(K,!0),P.dataOutputs.push(O)),t.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(t.uniqueId)}}}if(v.flowGraphMapping.interBlockConnectors)for(const U of v.flowGraphMapping.interBlockConnectors){const G=U.input,C=U.output,L=U.isVariable;this._connectFlowGraphNodes(G,C,S.MO[U.inputBlockIndex],S.MO[U.outputBlockIndex],L)}if(v.flowGraphMapping.extraProcessor){var b;const G=null===(b=this._interactivityGraph.declarations)||void 0===b?void 0:b[w.declaration];if(!G)throw p.d.Error(["No declaration found for extra processor",w]),new Error("Error parsing node connections");S.MO=v.flowGraphMapping.extraProcessor(w,G,v.flowGraphMapping,this,S.MO,U,this._gltf)}}}_createNewSocketConnection(U,G){return{uniqueId:(0,kC.c)(),name:U,_connectionType:G?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(U,G,C,L,X){const l=X?C.dataInputs:C.signalInputs,t=X?L.dataOutputs:L.signalOutputs,E=l.find((G=>G.name===U))||this._createNewSocketConnection(U),K=t.find((U=>U.name===G))||this._createNewSocketConnection(G,!0);l.find((G=>G.name===U))||l.push(E),t.find((U=>U.name===G))||t.push(K),E.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(E.uniqueId)}getVariableName(U){return"staticVariable_"+U}serializeToFlowGraph(){const U={uniqueId:(0,kC.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(U);for(let G=0;G<this._staticVariables.length;G++){const C=this._staticVariables[G];U._userVariables[this.getVariableName(G)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((U,G)=>U.concat(G.MO)),[]),executionContexts:[U]}}}const mL="KHR_interactivity";class BC{constructor(U){this._loader=U,this.name=mL,this.enabled=this._loader.isExtensionUsed(mL),this._pathConverter=(0,B.e)(this._loader.mK),U._skipStartAnimationStep=!0;const G=U.babylonScene;G&&function(U){(0,B.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!U.activeCamera)return new X.Quaternion(NaN,NaN,NaN,NaN);const G=X.Quaternion.FromRotationMatrix(U.activeCamera.getWorldMatrix()).normalize();return U.useRightHandedSystem||(G.w*=-1,G.x*=-1),G},type:"Quaternion",getTarget:()=>U.activeCamera}),(0,B.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!U.activeCamera)return new X.pG(NaN,NaN,NaN);const G=U.activeCamera.getWorldMatrix().getTranslation();return U.useRightHandedSystem||(G.x*=-1),G},type:"pG",getTarget:()=>U.activeCamera}),(0,B.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:U=>{var G,C;return null!==(G=null===(C=U._babylonAnimationGroup)||void 0===C?void 0:C.isPlaying)&&void 0!==G&&G},type:"boolean",getTarget:U=>U._babylonAnimationGroup}),(0,B.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:U=>{var G,C;return(null!==(G=null===(C=U._babylonAnimationGroup)||void 0===C?void 0:C.from)&&void 0!==G?G:0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,B.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:U=>{var G,C;return(null!==(G=null===(C=U._babylonAnimationGroup)||void 0===C?void 0:C.to)&&void 0!==G?G:0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,B.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:U=>{var G,C;return(null!==(G=null===(C=U._babylonAnimationGroup)||void 0===C?void 0:C.getCurrentFrame())&&void 0!==G?G:0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,B.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:U=>{var G,C;return(null!==(G=null===(C=U._babylonAnimationGroup)||void 0===C?void 0:C.getCurrentFrame())&&void 0!==G?G:0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup})}(G)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var U;if(!this._loader.babylonScene||!this._pathConverter)return;const G=this._loader.babylonScene,C=null===(U=this._loader.mK.extensions)||void 0===U?void 0:U.KHR_interactivity;if(!C)return;const L=new pC.d({HG:G});L.dispatchEventsSynchronously=!1;const X=C.graphs.map((U=>new QC(U,this._loader.mK,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(X.map((async U=>await wC(U,{coordinator:L,pathConverter:this._pathConverter})))),L.start()}}var MC,zC;MC="FlowGraphGLTFDataProvider",zC=async()=>(await Promise.resolve().then(C.bind(C,14194))).FlowGraphGLTFDataProvider,IC["".concat(mL,"/").concat(MC)]=zC,mU(mL),Q(mL,!0,(U=>new BC(U)));const sC="KHR_node_visibility";(0,B.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:U=>{const G=U._babylonTransformNode;return!G||void 0===G.isVisible||G.isVisible},set:(U,G)=>{var C,L;null===(C=G._primitiveBabylonMeshes)||void 0===C||C.forEach((U=>{U.inheritVisibility=!0})),G._babylonTransformNode&&(G._babylonTransformNode.isVisible=U),null===(L=G._primitiveBabylonMeshes)||void 0===L||L.forEach((G=>{G.isVisible=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class jC{constructor(U){this.name=sC,this._loader=U,this.enabled=U.isExtensionUsed(sC)}async onReady(){var U;null===(U=this._loader.mK.nodes)||void 0===U||U.forEach((U=>{var G,C,L,X;(null===(G=U._primitiveBabylonMeshes)||void 0===G||G.forEach((U=>{U.inheritVisibility=!0})),null!==(C=U.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(L=U.extensions)||void 0===L?void 0:L.KHR_node_visibility.visible)&&(U._babylonTransformNode&&(U._babylonTransformNode.isVisible=!1),null===(X=U._primitiveBabylonMeshes)||void 0===X||X.forEach((U=>{U.isVisible=!1}))))}))}dispose(){this._loader=null}}mU(sC),Q(sC,!0,(U=>new jC(U)));const AC="KHR_node_selectability";gC("event/onSelect",AC,{MO:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",SC:"FlowGraphGetVariableBlock",dataTransformer:U=>["pickedMesh_"+U[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",SC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,G,C,L,X,l,t){var E,K,P,O,T,D;const y=X[X.length-1];y.config=y.config||{},y.config.glTF=t;const V=null===(E=U.configuration)||void 0===E||null===(K=E.nodeIndex)||void 0===K?void 0:K.value[0];if(void 0===V||"number"!==typeof V)throw new Error("nodeIndex not found in configuration");const p="pickedMesh_"+V;return X[1].config.variable=p,l._userVariables[p]={className:"Mesh",id:null===t||void 0===t||null===(P=t.nodes)||void 0===P||null===(O=P[V]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===t||void 0===t||null===(T=t.nodes)||void 0===T||null===(D=T[V]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},X}}),(0,B.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:U=>{const G=U._babylonTransformNode;return!G||void 0===G.yP||G.yP},set:(U,G)=>{var C;null===(C=G._primitiveBabylonMeshes)||void 0===C||C.forEach((G=>{G.yP=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"yP"],type:"boolean"});class YC{constructor(U){this.name=AC,this._loader=U,this.enabled=U.isExtensionUsed(AC)}async onReady(){var U;null===(U=this._loader.mK.nodes)||void 0===U||U.forEach((U=>{var G,C,L;null!==(G=U.extensions)&&void 0!==G&&G.KHR_node_selectability&&!1===(null===(C=U.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(L=U._babylonTransformNode)||void 0===L||L.getChildMeshes().forEach((U=>{U.yP=!1})))}))}dispose(){this._loader=null}}mU(AC),Q(AC,!0,(U=>new YC(U)));const eC="KHR_node_hoverability",iC="targetMeshPointerOver_";gC("event/onHoverIn",eC,{MO:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",SC:"FlowGraphGetVariableBlock",dataTransformer:U=>[iC+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",SC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,G,C,L,X,l,t){var E,K,P,O,T,D;const y=X[X.length-1];y.config=y.config||{},y.config.glTF=t;const V=null===(E=U.configuration)||void 0===E||null===(K=E.nodeIndex)||void 0===K?void 0:K.value[0];if(void 0===V||"number"!==typeof V)throw new Error("nodeIndex not found in configuration");const p=iC+V;return X[1].config.variable=p,l._userVariables[p]={className:"Mesh",id:null===t||void 0===t||null===(P=t.nodes)||void 0===P||null===(O=P[V]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===t||void 0===t||null===(T=t.nodes)||void 0===T||null===(D=T[V]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},X}});const cC="targetMeshPointerOut_";gC("event/onHoverOut",eC,{MO:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",SC:"FlowGraphGetVariableBlock",dataTransformer:U=>[cC+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",SC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,G,C,L,X,l,t){var E,K,P,O,T,D;const y=X[X.length-1];y.config=y.config||{},y.config.glTF=t;const V=null===(E=U.configuration)||void 0===E||null===(K=E.nodeIndex)||void 0===K?void 0:K.value[0];if(void 0===V||"number"!==typeof V)throw new Error("nodeIndex not found in configuration");const p=cC+V;return X[1].config.variable=p,l._userVariables[p]={className:"Mesh",id:null===t||void 0===t||null===(P=t.nodes)||void 0===P||null===(O=P[V]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===t||void 0===t||null===(T=t.nodes)||void 0===T||null===(D=T[V]._babylonTransformNode)||void 0===D?void 0:D.uniqueId},X}}),(0,B.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:U=>{const G=U._babylonTransformNode;return!G||void 0===G.pointerOverDisableMeshTesting||G.pointerOverDisableMeshTesting},set:(U,G)=>{var C;null===(C=G._primitiveBabylonMeshes)||void 0===C||C.forEach((G=>{G.pointerOverDisableMeshTesting=!U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class RC{constructor(U){this.name=eC,this._loader=U,this.enabled=U.isExtensionUsed(eC)}async onReady(){var U;null===(U=this._loader.mK.nodes)||void 0===U||U.forEach((U=>{var G,C,L;null!==(G=U.extensions)&&void 0!==G&&G.KHR_node_hoverability&&!1===(null===(C=U.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(L=U._babylonTransformNode)||void 0===L||L.getChildMeshes().forEach((U=>{U.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}mU(eC),Q(eC,!0,(U=>new RC(U)));const WC="ExtrasAsMetadata";class fC{_assignExtras(U,G){if(G.extras&&Object.keys(G.extras).length>0){const C=U.metadata=U.metadata||{};(C.mK=C.mK||{}).extras=G.extras}}constructor(U){this.name=WC,this.enabled=!0,this._loader=U}dispose(){this._loader=null}loadNodeAsync(U,G,C){return this._loader.loadNodeAsync(U,G,(U=>{this._assignExtras(U,G),C(U)}))}loadCameraAsync(U,G,C){return this._loader.loadCameraAsync(U,G,(U=>{this._assignExtras(U,G),C(U)}))}createMaterial(U,G,C){const L=this._loader.createMaterial(U,G,C);return this._assignExtras(L,G),L}}mU(WC),Q(WC,!1,(U=>new fC(U)));C(14194)},14058:(U,G,C)=>{"use strict";C.d(G,{c:()=>a,g:()=>u,k:()=>v,o:()=>d});var L=C(12721),X=C(12718),l=C(13736),t=C(26),E=C(13306),K=C(13267),P=C(13280),O=C(12731),T=C(12763),D=C(13297),y=C(13412),V=C(13310),p=C(12930);class I{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.SD=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ly=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(U){this._environmentTexture=U}getNodes(){let U=[];U=U.concat(this.meshes),U=U.concat(this.lights),U=U.concat(this.cameras),U=U.concat(this.transformNodes);for(const G of this.skeletons)U=U.concat(G.bones);return U}}class H extends I{}class x{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const U=this.rootNodes;for(const L of U)L.dispose();U.length=0;const G=this.skeletons;for(const L of G)L.dispose();G.length=0;const C=this.animationGroups;for(const L of C)L.dispose();C.length=0}}class h extends I{constructor(U){super(),this._wasAddedToScene=!1,(U=U||T.d.LastCreatedScene)&&(this.HG=U,this.proceduralTextures=[],U.aE.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=U.getEngine().onContextRestoredObservable.add((()=>{for(const U of this.geometries)U._rebuild();for(const U of this.meshes)U._rebuild();for(const U of this.SD)U.rebuild();for(const U of this.textures)U._rebuild()})))}_topologicalSort(U){const G=new Map;for(const t of U)G.set(t.uniqueId,t);const C={dependsOn:new Map,dependedBy:new Map};for(const t of U){const U=t.uniqueId;C.dependsOn.set(U,new Set),C.dependedBy.set(U,new Set)}for(const t of U){const U=t.uniqueId,L=C.dependsOn.get(U);if(t instanceof D.c){const X=t.sourceMesh;G.has(X.uniqueId)&&(L.add(X.uniqueId),C.dependedBy.get(X.uniqueId).add(U))}const X=C.dependedBy.get(U);for(const l of t.getDescendants()){const L=l.uniqueId;if(G.has(L)){X.add(L);C.dependsOn.get(L).add(U)}}}const L=[],X=[];for(const t of U){const U=t.uniqueId;0===C.dependsOn.get(U).size&&(X.push(t),G.delete(U))}const l=X;for(;l.length>0;){const U=l.shift();L.push(U);const X=C.dependedBy.get(U.uniqueId);for(const L of Array.from(X.values())){const X=C.dependsOn.get(L);X.delete(U.uniqueId),0===X.size&&G.get(L)&&(l.push(G.get(L)),G.delete(L))}}return G.size>0&&(O.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),G.forEach((U=>{O.d.Error(U.name)}))),L}_addNodeAndDescendantsToList(U,G,C,L){if(C&&(!L||L(C))&&!G.has(C.uniqueId)){U.push(C),G.add(C.uniqueId);for(const X of C.getDescendants(!0))this._addNodeAndDescendantsToList(U,G,X,L)}}_isNodeInContainer(U){return U instanceof P.c&&-1!==this.meshes.indexOf(U)||(U instanceof K.b&&-1!==this.transformNodes.indexOf(U)||(U instanceof y.c&&-1!==this.lights.indexOf(U)||U instanceof V.d&&-1!==this.cameras.indexOf(U)))}_isValidHierarchy(){for(const U of this.meshes)if(U.parent&&!this._isNodeInContainer(U.parent))return O.d.Warn("Node ".concat(U.name," has a parent that is not in the container.")),!1;for(const U of this.transformNodes)if(U.parent&&!this._isNodeInContainer(U.parent))return O.d.Warn("Node ".concat(U.name," has a parent that is not in the container.")),!1;for(const U of this.lights)if(U.parent&&!this._isNodeInContainer(U.parent))return O.d.Warn("Node ".concat(U.name," has a parent that is not in the container.")),!1;for(const U of this.cameras)if(U.parent&&!this._isNodeInContainer(U.parent))return O.d.Warn("Node ".concat(U.name," has a parent that is not in the container.")),!1;return!0}instantiateModelsToScene(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const L={},l={},K=new x,P=[],O=[],T=(0,t.b)({doNotInstantiate:!0},C),D=[],y=new Set;for(const X of this.transformNodes)null===X.parent&&this._addNodeAndDescendantsToList(D,y,X,T.predicate);for(const X of this.meshes)null===X.parent&&this._addNodeAndDescendantsToList(D,y,X,T.predicate);const V=this._topologicalSort(D),p=(C,X)=>{if(((G,C)=>{if(L[G.uniqueId]=C.uniqueId,l[C.uniqueId]=C,U&&(C.name=U(G.name)),C instanceof E.d){const U=C;if(U.morphTargetManager){const C=G.morphTargetManager;U.morphTargetManager=C.clone();for(let G=0;G<C.numTargets;G++){const X=C.getTarget(G),t=U.morphTargetManager.getTarget(G);L[X.uniqueId]=t.uniqueId,l[t.uniqueId]=t}}}})(C,X),C.parent){const U=L[C.parent.uniqueId],G=l[U];X.parent=G||C.parent}if(X.position&&C.position&&X.position.L(C.position),X.rotationQuaternion&&C.rotationQuaternion&&X.rotationQuaternion.L(C.rotationQuaternion),X.rotation&&C.rotation&&X.rotation.L(C.rotation),X.fE&&C.fE&&X.fE.L(C.fE),X.material){const t=X;if(t.material)if(G){const G=C.material;if(-1===O.indexOf(G)){let C=G.clone(U?U(G.name):"Clone of "+G.name);if(O.push(G),L[G.uniqueId]=C.uniqueId,l[C.uniqueId]=C,"MultiMaterial"===G.getClassName()){const X=G;for(const G of X.UK)G&&(C=G.clone(U?U(G.name):"Clone of "+G.name),O.push(G),L[G.uniqueId]=C.uniqueId,l[C.uniqueId]=C);X.UK=X.UK.map((U=>U&&l[L[U.uniqueId]]))}}"InstancedMesh"!==t.getClassName()&&(t.material=l[L[G.uniqueId]])}else"MultiMaterial"===t.material.getClassName()?-1===this.HG.multiMaterials.indexOf(t.material)&&this.HG.addMultiMaterial(t.material):-1===this.HG.materials.indexOf(t.material)&&this.HG.addMaterial(t.material)}null===X.parent&&K.rootNodes.push(X)};for(const X of V)if("InstancedMesh"===X.getClassName()){const U=X,G=U.sourceMesh,C=L[G.uniqueId];p(U,("number"===typeof C?l[C]:G).createInstance(U.name))}else{let U=!0;"eT"===X.getClassName()||"Node"===X.getClassName()||X.skeleton||!X.getTotalVertices||0===X.getTotalVertices()?U=!1:T.doNotInstantiate&&(U="function"===typeof T.doNotInstantiate?!T.doNotInstantiate(X):!T.doNotInstantiate);const G=U?X.createInstance("instance of ".concat(X.name)):X.clone("Clone of ".concat(X.name),null,!0);if(!G)throw new Error("Could not clone or instantiate node on Asset Container ".concat(X.name));p(X,G)}for(const X of this.skeletons){if(T.predicate&&!T.predicate(X))continue;const G=X.clone(U?U(X.name):"Clone of "+X.name);for(const U of this.meshes)if(U.skeleton===X&&!U.isAnInstance){const C=l[L[U.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=G,-1!==P.indexOf(G))continue;P.push(G);for(const U of G.bones)U._linkedTransformNode&&(U._linkedTransformNode=l[L[U._linkedTransformNode.uniqueId]])}K.skeletons.push(G)}for(const X of this.animationGroups){if(T.predicate&&!T.predicate(X))continue;const G=X.clone(U?U(X.name):"Clone of "+X.name,(U=>l[L[U.uniqueId]]||U));K.animationGroups.push(G)}return K}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.HG.environmentTexture=this.environmentTexture);for(const U of this.HG._serializableComponents)U.addFromContainer(this);this.HG.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const G=[];for(const C of this.cameras)U&&!U(C)||(this.HG.addCamera(C),G.push(C));for(const C of this.lights)U&&!U(C)||(this.HG.addLight(C),G.push(C));for(const C of this.meshes)U&&!U(C)||(this.HG.FO(C),G.push(C));for(const C of this.skeletons)U&&!U(C)||this.HG.addSkeleton(C);for(const C of this.animations)U&&!U(C)||this.HG.addAnimation(C);for(const C of this.animationGroups)U&&!U(C)||this.HG.addAnimationGroup(C);for(const C of this.multiMaterials)U&&!U(C)||this.HG.addMultiMaterial(C);for(const C of this.materials)U&&!U(C)||this.HG.addMaterial(C);for(const C of this.morphTargetManagers)U&&!U(C)||this.HG.addMorphTargetManager(C);for(const C of this.geometries)U&&!U(C)||this.HG.addGeometry(C);for(const C of this.transformNodes)U&&!U(C)||(this.HG.addTransformNode(C),G.push(C));for(const C of this.actionManagers)U&&!U(C)||this.HG.addActionManager(C);for(const C of this.textures)U&&!U(C)||this.HG.addTexture(C);for(const C of this.reflectionProbes)U&&!U(C)||this.HG.addReflectionProbe(C);for(const C of G)C.parent&&-1===this.HG.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||X.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.HG.environmentTexture&&(this.HG.environmentTexture=null);for(const U of this.HG._serializableComponents)U.removeFromContainer(this)}removeFromScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const G of this.cameras)U&&!U(G)||this.HG.removeCamera(G);for(const G of this.lights)U&&!U(G)||this.HG.removeLight(G);for(const G of this.meshes)U&&!U(G)||this.HG.ZO(G,!0);for(const G of this.skeletons)U&&!U(G)||this.HG.removeSkeleton(G);for(const G of this.animations)U&&!U(G)||this.HG.removeAnimation(G);for(const G of this.animationGroups)U&&!U(G)||this.HG.removeAnimationGroup(G);for(const G of this.multiMaterials)U&&!U(G)||this.HG.removeMultiMaterial(G);for(const G of this.materials)U&&!U(G)||this.HG.removeMaterial(G);for(const G of this.morphTargetManagers)U&&!U(G)||this.HG.removeMorphTargetManager(G);for(const G of this.geometries)U&&!U(G)||this.HG.removeGeometry(G);for(const G of this.transformNodes)U&&!U(G)||this.HG.removeTransformNode(G);for(const G of this.actionManagers)U&&!U(G)||this.HG.removeActionManager(G);for(const G of this.textures)U&&!U(G)||this.HG.removeTexture(G);for(const G of this.reflectionProbes)U&&!U(G)||this.HG.removeReflectionProbe(G)}dispose(){const U=this.cameras.slice(0);for(const y of U)y.dispose();this.cameras.length=0;const G=this.lights.slice(0);for(const y of G)y.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const y of C)y.dispose();this.meshes.length=0;const L=this.skeletons.slice(0);for(const y of L)y.dispose();this.skeletons.length=0;const X=this.animationGroups.slice(0);for(const y of X)y.dispose();this.animationGroups.length=0;const l=this.multiMaterials.slice(0);for(const y of l)y.dispose();this.multiMaterials.length=0;const t=this.materials.slice(0);for(const y of t)y.dispose();this.materials.length=0;const E=this.geometries.slice(0);for(const y of E)y.dispose();this.geometries.length=0;const K=this.transformNodes.slice(0);for(const y of K)y.dispose();this.transformNodes.length=0;const P=this.actionManagers.slice(0);for(const y of P)y.dispose();this.actionManagers.length=0;const O=this.textures.slice(0);for(const y of O)y.dispose();this.textures.length=0;const T=this.reflectionProbes.slice(0);for(const y of T)y.dispose();this.reflectionProbes.length=0;const D=this.morphTargetManagers.slice(0);for(const y of D)y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const y of this.HG._serializableComponents)y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.HG.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(U,G,C){if(U&&G)for(const L of U){let U=!0;if(C)for(const G of C)if(L===G){U=!1;break}U&&(G.push(L),L._parentContainer=this)}}moveAllFromScene(U){this._wasAddedToScene=!1,void 0===U&&(U=new H);for(const G in this)Object.prototype.hasOwnProperty.call(this,G)&&(this[G]=this[G]||("_environmentTexture"===G?null:[]),this._moveAssets(this.HG[G],this[G],U[G]));this.environmentTexture=this.HG.environmentTexture,this.removeAllFromScene()}createRootMesh(){const U=new E.d("assetContainerRootMesh",this.HG);for(const G of this.meshes)G.parent||U.addChild(G);return this.meshes.unshift(U),U}mergeAnimationsTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.d.LastCreatedScene,G=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!U)return O.d.Error("No scene available to merge animations to"),[];const L=C||(G=>{let C=null;const L=G.animations.length?G.animations[0].targetProperty:"",X=G.name.split(".").join("").split("_primitive")[0];switch(L){case"position":case"rotationQuaternion":C=U.getTransformNodeByName(G.name)||U.getTransformNodeByName(X);break;case"influence":C=U.getMorphTargetByName(G.name)||U.getMorphTargetByName(X);break;default:C=U.getNodeByName(G.name)||U.getNodeByName(X)}return C}),X=this.getNodes();for(const E of X){const U=L(E);if(null!==U){for(const G of E.animations){const C=U.animations.filter((U=>U.targetProperty===G.targetProperty));for(const G of C){const C=U.animations.indexOf(G,0);C>-1&&U.animations.splice(C,1)}}U.animations=U.animations.concat(E.animations)}}const l=[],t=this.animationGroups.slice();for(const E of t){l.push(E.clone(E.name,L));for(const U of E.animatables)U.stop()}for(const E of G){const G=L(E.target);G&&(U.beginAnimation(G,E.fromFrame,E.toFrame,E.loopAnimation,E.speedRatio,E.onAnimationEnd?E.onAnimationEnd:void 0,void 0,!0,void 0,E.onAnimationLoop?E.onAnimationLoop:void 0),U.stopAnimation(E.target))}return l}populateRootNodes(){this.rootNodes.length=0;for(const U of this.meshes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.transformNodes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.lights)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.cameras)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U)}addAllAssetsToContainer(U){if(!U)return;const G=[],C=new Set;for(G.push(U);G.length>0;){const U=G.pop();if(U instanceof E.d?(U.iE&&-1===this.geometries.indexOf(U.iE)&&this.geometries.push(U.iE),this.meshes.push(U)):U instanceof D.c?this.meshes.push(U):U instanceof K.b?this.transformNodes.push(U):U instanceof y.c?this.lights.push(U):U instanceof V.d&&this.cameras.push(U),U instanceof P.c){if(U.material&&-1===this.materials.indexOf(U.material)){this.materials.push(U.material);for(const G of U.material.getActiveTextures())-1===this.textures.indexOf(G)&&this.textures.push(G)}U.skeleton&&-1===this.skeletons.indexOf(U.skeleton)&&this.skeletons.push(U.skeleton),U.morphTargetManager&&-1===this.morphTargetManagers.indexOf(U.morphTargetManager)&&this.morphTargetManagers.push(U.morphTargetManager)}for(const L of U.getChildren())C.has(L)||G.push(L);C.add(U)}this.populateRootNodes()}_getByTags(U,G,C){if(void 0===G)return U;const L=[];for(const X in U){const l=U[X];p.b&&p.b.MatchesQuery(l,G)&&(!C||C(l))&&L.push(l)}return L}getMeshesByTags(U,G){return this._getByTags(this.meshes,U,G)}getCamerasByTags(U,G){return this._getByTags(this.cameras,U,G)}getLightsByTags(U,G){return this._getByTags(this.lights,U,G)}getMaterialsByTags(U,G){return this._getByTags(this.materials,U,G).concat(this._getByTags(this.multiMaterials,U,G))}getTransformNodesByTags(U,G){return this._getByTags(this.transformNodes,U,G)}}var N=C(12783);class b{constructor(U){this.byteOffset=0,this.buffer=U}async loadAsync(U){const G=await this.buffer.readAsync(this.byteOffset,U);this._dataView=new DataView(G.buffer,G.byteOffset,G.byteLength),this._dataByteOffset=0}readUint32(){const U=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,U}readUint8Array(U){const G=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,U);return this._dataByteOffset+=U,this.byteOffset+=U,G}readString(U){return(0,N.g)(this.readUint8Array(U))}skipBytes(U){this._dataByteOffset+=U,this.byteOffset+=U}}var o=C(14064);const w="Z2xURg",S={name:"mK",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:U=>-1!==U.indexOf("asset")&&-1!==U.indexOf("version")||U.startsWith("data:base64,"+w)||U.startsWith("data:;base64,"+w)||U.startsWith("data:application/octet-stream;base64,"+w)||U.startsWith("data:model/gltf-binary;base64,"+w)};var v,u,d,g=C(12772),Z=C(12774);function F(U,G,C){try{return Promise.resolve(new Uint8Array(U,G,C))}catch(L){return Promise.reject(L)}}!function(U){U[U.AUTO=0]="AUTO",U[U.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(v||(v={})),function(U){U[U.NONE=0]="NONE",U[U.FIRST=1]="FIRST",U[U.ALL=2]="ALL"}(u||(u={})),function(U){U[U.LOADING=0]="LOADING",U[U.READY=1]="READY",U[U.COMPLETE=2]="COMPLETE"}(d||(d={}));class q{constructor(){this.coordinateSystemMode=v.AUTO,this.animationStartMode=u.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=U=>Promise.resolve(U),this.extensionOptions={}}L(U){var G,C,L,X,l,t,E,K,P,O,T,D,y,V,p,I,H,x,h,N,b;U&&(this.onParsed=U.onParsed,this.coordinateSystemMode=null!==(G=U.coordinateSystemMode)&&void 0!==G?G:this.coordinateSystemMode,this.animationStartMode=null!==(C=U.animationStartMode)&&void 0!==C?C:this.animationStartMode,this.loadNodeAnimations=null!==(L=U.loadNodeAnimations)&&void 0!==L?L:this.loadNodeAnimations,this.loadSkins=null!==(X=U.loadSkins)&&void 0!==X?X:this.loadSkins,this.loadMorphTargets=null!==(l=U.loadMorphTargets)&&void 0!==l?l:this.loadMorphTargets,this.compileMaterials=null!==(t=U.compileMaterials)&&void 0!==t?t:this.compileMaterials,this.useClipPlane=null!==(E=U.useClipPlane)&&void 0!==E?E:this.useClipPlane,this.compileShadowGenerators=null!==(K=U.compileShadowGenerators)&&void 0!==K?K:this.compileShadowGenerators,this.transparencyAsCoverage=null!==(P=U.transparencyAsCoverage)&&void 0!==P?P:this.transparencyAsCoverage,this.useRangeRequests=null!==(O=U.useRangeRequests)&&void 0!==O?O:this.useRangeRequests,this.createInstances=null!==(T=U.createInstances)&&void 0!==T?T:this.createInstances,this.alwaysComputeBoundingBox=null!==(D=U.alwaysComputeBoundingBox)&&void 0!==D?D:this.alwaysComputeBoundingBox,this.loadAllMaterials=null!==(y=U.loadAllMaterials)&&void 0!==y?y:this.loadAllMaterials,this.loadOnlyMaterials=null!==(V=U.loadOnlyMaterials)&&void 0!==V?V:this.loadOnlyMaterials,this.skipMaterials=null!==(p=U.skipMaterials)&&void 0!==p?p:this.skipMaterials,this.useSRGBBuffers=null!==(I=U.useSRGBBuffers)&&void 0!==I?I:this.useSRGBBuffers,this.targetFps=null!==(H=U.targetFps)&&void 0!==H?H:this.targetFps,this.alwaysComputeSkeletonRootNode=null!==(x=U.alwaysComputeSkeletonRootNode)&&void 0!==x?x:this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=null!==(h=U.useGltfTextureNames)&&void 0!==h?h:this.useGltfTextureNames,this.preprocessUrlAsync=null!==(N=U.preprocessUrlAsync)&&void 0!==N?N:this.preprocessUrlAsync,this.customRootNode=U.customRootNode,this.onMeshLoaded=U.onMeshLoaded,this.onSkinLoaded=U.onSkinLoaded,this.onTextureLoaded=U.onTextureLoaded,this.onMaterialLoaded=U.onMaterialLoaded,this.onCameraLoaded=U.onCameraLoaded,this.extensionOptions=null!==(b=U.extensionOptions)&&void 0!==b?b:this.extensionOptions)}}class a extends q{constructor(U){super(),this.onParsedObservable=new L.e,this.onMeshLoadedObservable=new L.e,this.onSkinLoadedObservable=new L.e,this.onTextureLoadedObservable=new L.e,this.onMaterialLoadedObservable=new L.e,this.onCameraLoadedObservable=new L.e,this.onCompleteObservable=new L.e,this.onErrorObservable=new L.e,this.aE=new L.e,this.onExtensionLoadedObservable=new L.e,this.validate=!1,this.onValidatedObservable=new L.e,this._loader=null,this._state=null,this._requests=new Array,this.name=S.name,this.extensions=S.extensions,this.onLoaderStateChangedObservable=new L.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.L(U)}set onParsed(U){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),U&&(this._onParsedObserver=this.onParsedObservable.add(U))}set onMeshLoaded(U){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),U&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(U))}set onSkinLoaded(U){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),U&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((G=>U(G.node,G.skinnedNode))))}set onTextureLoaded(U){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),U&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(U))}set onMaterialLoaded(U){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),U&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(U))}set onCameraLoaded(U){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),U&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(U))}set onComplete(U){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(U)}set onError(U){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(U)}set onDispose(U){this._onDisposeObserver&&this.aE.remove(this._onDisposeObserver),this._onDisposeObserver=this.aE.add(U)}set onExtensionLoaded(U){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(U)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(U){this._loggingEnabled!==U&&(this._loggingEnabled=U,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(U){this._capturePerformanceCounters!==U&&(this._capturePerformanceCounters=U,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(U){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(U)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const U of this._requests)U.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=U=>Promise.resolve(U),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.aE.notifyObservers(void 0),this.aE.clear()}loadFile(U,G,C,l,t,E,K,P){if(ArrayBuffer.isView(G))return this._loadBinary(U,G,C,l,K,P),null;this._progressCallback=t;const T=G.name||X.Tools.GetFilename(G);if(E){if(this.useRangeRequests){this.validate&&O.d.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new L.e},X={readAsync:(C,L)=>new Promise(((X,l)=>{this._loadFile(U,G,(U=>{X(new Uint8Array(U))}),!0,(U=>{l(U)}),(U=>{U.setRequestHeader("Range","bytes=".concat(C,"-").concat(C+L-1))}))})),byteLength:0};return this._unpackBinaryAsync(new b(X)).then((U=>{C.onCompleteObservable.notifyObservers(C),l(U)}),K?U=>K(void 0,U):void 0),C}return this._loadFile(U,G,(G=>{this._validate(U,new Uint8Array(G,0,G.byteLength),C,T),this._unpackBinaryAsync(new b({readAsync:(U,C)=>F(G,U,C),byteLength:G.byteLength})).then((U=>{l(U)}),K?U=>K(void 0,U):void 0)}),!0,K)}return this._loadFile(U,G,(G=>{try{this._validate(U,G,C,T),l({json:this._parseJson(G)})}catch(L){K&&K()}}),!1,K)}_loadBinary(U,G,C,L,X,l){this._validate(U,new Uint8Array(G.buffer,G.byteOffset,G.byteLength),C,l),this._unpackBinaryAsync(new b({readAsync:(U,C)=>function(U,G,C){try{if(G<0||G>=U.byteLength)throw new RangeError("Offset is out of range.");if(G+C>U.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(U.buffer,U.byteOffset+G,C))}catch(L){return Promise.reject(L)}}(G,U,C),byteLength:G.byteLength})).then((U=>{L(U)}),X?U=>X(void 0,U):void 0)}importMeshAsync(U,G,C,L,X,l){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log("Loading ".concat(l||"")),this._loader=this._getLoader(C),this._loader.importMeshAsync(U,G,null,C,L,X,l))))}loadAsync(U,G,C,L,X){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(G),this.onParsedObservable.clear(),this._log("Loading ".concat(X||"")),this._loader=this._getLoader(G),this._loader.loadAsync(U,G,C,L,X))))}loadAssetContainerAsync(U,G,C,L,X){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(G),this.onParsedObservable.clear(),this._log("Loading ".concat(X||"")),this._loader=this._getLoader(G);const l=new h(U),t=[];this.onMaterialLoadedObservable.add((U=>{t.push(U)}));const E=[];this.onTextureLoadedObservable.add((U=>{E.push(U)}));const K=[];this.onCameraLoadedObservable.add((U=>{K.push(U)}));const P=[];return this.onMeshLoadedObservable.add((U=>{U.morphTargetManager&&P.push(U.morphTargetManager)})),this._loader.importMeshAsync(null,U,l,G,C,L,X).then((U=>(Array.prototype.push.apply(l.geometries,U.geometries),Array.prototype.push.apply(l.meshes,U.meshes),Array.prototype.push.apply(l.SD,U.SD),Array.prototype.push.apply(l.skeletons,U.skeletons),Array.prototype.push.apply(l.animationGroups,U.animationGroups),Array.prototype.push.apply(l.materials,t),Array.prototype.push.apply(l.textures,E),Array.prototype.push.apply(l.lights,U.lights),Array.prototype.push.apply(l.transformNodes,U.transformNodes),Array.prototype.push.apply(l.cameras,K),Array.prototype.push.apply(l.morphTargetManagers,P),l)))}))}canDirectLoad(U){return S.canDirectLoad(U)}directLoad(U,G){if(G.startsWith("base64,"+w)||G.startsWith(";base64,"+w)||G.startsWith("application/octet-stream;base64,"+w)||G.startsWith("model/gltf-binary;base64,"+w)){const C=(0,g.d)(G);return this._validate(U,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new b({readAsync:(U,G)=>F(C,U,G),byteLength:C.byteLength}))}return this._validate(U,G),Promise.resolve({json:this._parseJson(G)})}createPlugin(U){return new a(U[S.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((U,G)=>{this.onCompleteObservable.addOnce((()=>{U()})),this.onErrorObservable.addOnce((U=>{G(U)}))}))}_setState(U){this._state!==U&&(this._state=U,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(d[this._state]))}_loadFile(U,G,C,L,X,l){const t=U._loadFile(G,C,(U=>{this._onProgress(U,t)}),!0,L,X,l);return t.onCompleteObservable.add((()=>{t._lengthComputable=!0,t._total=t._loaded})),this._requests.push(t),t}_onProgress(U,G){if(!this._progressCallback)return;G._lengthComputable=U.lengthComputable,G._loaded=U.loaded,G._total=U.total;let C=!0,L=0,X=0;for(const l of this._requests){if(void 0===l._lengthComputable||void 0===l._loaded||void 0===l._total)return;C=C&&l._lengthComputable,L+=l._loaded,X+=l._total}this._progressCallback({lengthComputable:C,loaded:L,total:C?X:0})}_validate(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),o.b.ValidateAsync(G,C,L,(G=>this.preprocessUrlAsync(C+G).then((G=>U._loadFileAsync(G,void 0,!0,!0).then((U=>new Uint8Array(U,0,U.byteLength))))))).then((U=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(U),this.onValidatedObservable.clear()}),(U=>{this._endPerformanceCounter("Validate JSON"),X.Tools.Warn("Failed to validate: ".concat(U.message)),this.onValidatedObservable.clear()})))}_getLoader(U){const G=U.json.asset||{};this._log("Asset version: ".concat(G.version)),G.minVersion&&this._log("Asset minimum version: ".concat(G.minVersion)),G.generator&&this._log("Asset generator: ".concat(G.generator));const C=a._parseVersion(G.version);if(!C)throw new Error("Invalid version: "+G.version);if(void 0!==G.minVersion){const U=a._parseVersion(G.minVersion);if(!U)throw new Error("Invalid minimum version: "+G.minVersion);if(a._compareVersion(U,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+G.minVersion)}const L={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader}[C.major];if(!L)throw new Error("Unsupported version: "+G.version);return L(this)}_parseJson(U){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(U.length));const G=JSON.parse(U);return this._endPerformanceCounter("Parse JSON"),G}_unpackBinaryAsync(U){return this._startPerformanceCounter("Unpack Binary"),U.loadAsync(20).then((()=>{const G=U.readUint32();if(1179937895!==G)throw new Z.g("Unexpected magic: "+G,Z.e.GLTFLoaderUnexpectedMagicError);const C=U.readUint32();this.loggingEnabled&&this._log("Binary version: ".concat(C));const L=U.readUint32();let X;switch(this.useRangeRequests||L===U.buffer.byteLength||O.d.Warn("Length in header does not match actual data length: ".concat(L," != ").concat(U.buffer.byteLength)),C){case 1:X=this._unpackBinaryV1Async(U,L);break;case 2:X=this._unpackBinaryV2Async(U,L);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),X}))}_unpackBinaryV1Async(U,G){const C=U.readUint32(),L=U.readUint32();if(0!==L)throw new Error("Unexpected content format: ".concat(L));const X=G-U.byteOffset,l={json:this._parseJson(U.readString(C)),bin:null};if(0!==X){const G=U.byteOffset;l.bin={readAsync:(C,L)=>U.buffer.readAsync(G+C,L),byteLength:X}}return Promise.resolve(l)}_unpackBinaryV2Async(U,G){const C=1313821514,L=5130562,X=U.readUint32();if(U.readUint32()!==C)throw new Error("First chunk format is not JSON");return U.byteOffset+X===G?U.loadAsync(X).then((()=>({json:this._parseJson(U.readString(X)),bin:null}))):U.loadAsync(X+8).then((()=>{const l={json:this._parseJson(U.readString(X)),bin:null},t=()=>{const X=U.readUint32();switch(U.readUint32()){case C:throw new Error("Unexpected JSON chunk");case L:{const G=U.byteOffset;l.bin={readAsync:(C,L)=>U.buffer.readAsync(G+C,L),byteLength:X},U.skipBytes(X);break}default:U.skipBytes(X)}return U.byteOffset!==G?U.loadAsync(8).then(t):Promise.resolve(l)};return t()}))}static _parseVersion(U){if("1.0"===U||"1.0.1"===U)return{major:1,minor:0};const G=(U+"").match(/^(\d+)\.(\d+)/);return G?{major:parseInt(G[1]),minor:parseInt(G[2])}:null}static _compareVersion(U,G){return U.major>G.major?1:U.major<G.major?-1:U.minor>G.minor?1:U.minor<G.minor?-1:0}_logOpen(U){this._log(U),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(U){const G=a._logSpaces.substring(0,2*this._logIndentLevel);O.d.Log("".concat(G).concat(U))}_logDisabled(U){}_startPerformanceCounterEnabled(U){X.Tools.StartPerformanceCounter(U)}_startPerformanceCounterDisabled(U){}_endPerformanceCounterEnabled(U){X.Tools.EndPerformanceCounter(U)}_endPerformanceCounterDisabled(U){}}a.IncrementalLoading=!0,a.HomogeneousCoordinates=!1,a._logSpaces="                                ",(0,l.d)(new a)},14064:(U,G,C)=>{"use strict";C.d(G,{b:()=>t});var L=C(12718);function X(U,G,C,L){const X={externalResourceFunction:L};return C&&(X.uri="file:"===G?C:G+C),ArrayBuffer.isView(U)?GLTFValidator.validateBytes(U,X):GLTFValidator.validateString(U,X)}function l(){const U=[];onmessage=G=>{const C=G.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":X(C.data,C.rootUrl,C.fileName,(G=>new Promise(((C,L)=>{const X=U.length;U.push({resolve:C,reject:L}),postMessage({id:"getExternalResource",index:X,uri:G})})))).then((U=>{postMessage({id:"validate.resolve",value:U})}),(U=>{postMessage({id:"validate.reject",reason:U})}));break;case"getExternalResource.resolve":U[C.index].resolve(C.value);break;case"getExternalResource.reject":U[C.index].reject(C.reason)}}}class t{static ValidateAsync(U,G,C,t){return"function"===typeof Worker?new Promise(((E,K)=>{const P="".concat(X,"(").concat(l,")()"),O=URL.createObjectURL(new Blob([P],{type:"application/javascript"})),T=new Worker(O),D=U=>{T.removeEventListener("error",D),T.removeEventListener("message",y),K(U)},y=U=>{const G=U.data;switch(G.id){case"getExternalResource":t(G.uri).then((U=>{T.postMessage({id:"getExternalResource.resolve",index:G.index,value:U},[U.buffer])}),(U=>{T.postMessage({id:"getExternalResource.reject",index:G.index,reason:U})}));break;case"validate.resolve":T.removeEventListener("error",D),T.removeEventListener("message",y),E(G.value),T.terminate();break;case"validate.reject":T.removeEventListener("error",D),T.removeEventListener("message",y),K(G.reason),T.terminate()}};if(T.addEventListener("error",D),T.addEventListener("message",y),T.postMessage({id:"init",url:L.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(U)){const L=U.slice();T.postMessage({id:"validate",data:L,rootUrl:G,fileName:C},[L.buffer])}else T.postMessage({id:"validate",data:U,rootUrl:G,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=L.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>X(U,G,C,t))))}}t.Configuration={url:"".concat(L.Tools._DefaultCdnUrl,"/gltf_validator.js")}},14647:(U,G,C)=>{"use strict";C.d(G,{d:()=>w});var L=C(12876),X=C(12884),l=C(12928),t=C(12896),E=C(13238),K=C(13175),P=C(12957),O=C(13097),T=C(12850),D=C(12808);C(13857),C(13766),C(13783),C(13769),C(13788),C(13793),C(13799);const y="imageProcessingCompatibility",V="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";D.d.IncludesShadersStore[y]||(D.d.IncludesShadersStore[y]=V);const p="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";D.d.ShadersStore[p]||(D.d.ShadersStore[p]=I);C(13865),C(13807),C(13810),C(13818),C(13812);const H="skyVertexShader",x="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";D.d.ShadersStore[H]||(D.d.ShadersStore[H]=x);var h=C(13170),N=C(13224),b=C(13217);class o extends E.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class w extends K.c{constructor(U,G){super(U,G),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new t.pG(0,100,0),this.useSunPosition=!1,this.cameraOffset=t.pG.Zero(),this.up=t.pG.Up(),this.dithering=!1,this._cameraPosition=t.pG.Zero(),this._skyOrientation=new t.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(U,G){const C=G._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;G.materialDefines||(G.materialDefines=new o);const L=G.materialDefines,X=this.wU();if(this._isReadyForSubMesh(G))return!0;if((0,b.ab)(U,X,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,L),(0,b.R)(U,L,!0,!1),L.IMAGEPROCESSINGPOSTPROCESS!==X.imageProcessingConfiguration.applyByPostProcess&&L.markAsMiscDirty(),L.DITHER!==this.dithering&&L.markAsMiscDirty(),L.isDirty){L.markAsProcessed(),X.resetCachedMaterial();const U=new h.d;L.FOG&&U.addFallback(1,"FOG"),L.IMAGEPROCESSINGPOSTPROCESS=X.imageProcessingConfiguration.applyByPostProcess,L.DITHER=this.dithering;const C=[P.e.PositionKind];L.VERTEXCOLOR&&C.push(P.e.ColorKind);const l="sky",t=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,N.b)(t);const E=L.toString();G.setEffect(X.getEngine().createEffect(l,C,t,[],E,U,this.onCompiled,this.onError),L,this._materialContext)}return!(!G.effect||!G.effect.isReady())&&(L._renderId=X.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(U,G,C){const L=this.wU(),X=C.materialDefines;if(!X)return;const l=C.effect;if(!l)return;this._activeEffect=l,this.bindOnlyWorldMatrix(U),this._activeEffect.setMatrix("viewProjection",L.getTransformMatrix()),this._mustRebind(L,l,C)&&((0,N.e)(l,this,L),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,b.m)(X,l,L)),L.fogEnabled&&G.applyFog&&L.fogMode!==O.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",L.getViewMatrix()),(0,b.h)(L,G,this._activeEffect);const E=L.activeCamera;if(E){const U=E.getWorldMatrix();this._cameraPosition.x=U.m[12],this._cameraPosition.y=U.m[13],this._cameraPosition.z=U.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const U=Math.PI*(this.inclination-.5),G=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(G)*Math.cos(U),this.sunPosition.y=this.distance*Math.sin(-U),this.sunPosition.z=this.distance*Math.sin(G)*Math.cos(U),t.Quaternion.FromUnitVectorsToRef(t.pG.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(G,this._activeEffect,C)}getAnimatables(){return[]}dispose(U){super.dispose(U)}clone(U){return l.c.Clone((()=>new w(U,this.wU())),this)}serialize(){const U=super.serialize();return U.customType="BABYLON.SkyMaterial",U}getClassName(){return"SkyMaterial"}static Parse(U,G,C){return l.c.Parse((()=>new w(U.name,G)),U,G,C)}}(0,L.d)([(0,X.H)()],w.prototype,"luminance",void 0),(0,L.d)([(0,X.H)()],w.prototype,"turbidity",void 0),(0,L.d)([(0,X.H)()],w.prototype,"rayleigh",void 0),(0,L.d)([(0,X.H)()],w.prototype,"mieCoefficient",void 0),(0,L.d)([(0,X.H)()],w.prototype,"mieDirectionalG",void 0),(0,L.d)([(0,X.H)()],w.prototype,"distance",void 0),(0,L.d)([(0,X.H)()],w.prototype,"inclination",void 0),(0,L.d)([(0,X.H)()],w.prototype,"azimuth",void 0),(0,L.d)([(0,X.E)()],w.prototype,"sunPosition",void 0),(0,L.d)([(0,X.H)()],w.prototype,"useSunPosition",void 0),(0,L.d)([(0,X.E)()],w.prototype,"cameraOffset",void 0),(0,L.d)([(0,X.E)()],w.prototype,"up",void 0),(0,L.d)([(0,X.H)()],w.prototype,"dithering",void 0),(0,T.e)("BABYLON.SkyMaterial",w)},13556:(U,G,C)=>{"use strict";function L(U,G){G.headers=U.headers||{},G.statusMessage=U.statusText,G.statusCode=U.status,G.data=U.response}function X(U,G,C){return new Promise((function(X,l){C=C||{};var t,E,K,P=new XMLHttpRequest,O=C.body,T=C.headers||{};for(t in C.timeout&&(P.timeout=C.timeout),P.ontimeout=P.onerror=function(U){U.timeout="timeout"==U.type,l(U)},P.open(U,G.href||G),P.onload=function(){for(K=P.getAllResponseHeaders().trim().split(/[\r\n]+/),L(P,P);E=K.shift();)E=E.split(": "),P.headers[E.shift().toLowerCase()]=E.join(": ");if((E=P.headers["content-type"])&&~E.indexOf("application/json"))try{P.data=JSON.parse(P.data,C.reviver)}catch(U){return L(P,U),l(U)}(P.status>=400?l:X)(P)},typeof FormData<"u"&&O instanceof FormData||O&&"object"==typeof O&&(T["content-type"]="application/json",O=JSON.stringify(O)),P.withCredentials=!!C.withCredentials,T)P.setRequestHeader(t,T[t]);P.send(O)}))}C.r(G),C.d(G,{del:()=>K,get:()=>l,patch:()=>E,post:()=>t,put:()=>P,send:()=>X});var l=X.bind(X,"GET"),t=X.bind(X,"POST"),E=X.bind(X,"PATCH"),K=X.bind(X,"DELETE"),P=X.bind(X,"PUT")},14753:(U,G,C)=>{"use strict";C.d(G,{e:()=>T});const L=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,l=1/3,t=1/6,E=(Math.sqrt(5)-1)/4,K=(5-Math.sqrt(5))/20,P=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),O=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const T=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const G="function"==typeof U?U:function(U){let G=0,C=0,L=0,X=1;const l=function(){let U=4022871197;return function(G){G=G.toString();for(let C=0;C<G.length;C++){U+=G.charCodeAt(C);let L=.02519603282416938*U;U=L>>>0,L-=U,L*=U,U=L>>>0,L-=U,U+=4294967296*L}return 2.3283064365386963e-10*(U>>>0)}}();G=l(" "),C=l(" "),L=l(" "),G-=l(U),G<0&&(G+=1);C-=l(U),C<0&&(C+=1);L-=l(U),L<0&&(L+=1);return function(){const U=2091639*G+2.3283064365386963e-10*X;return G=C,C=L,L=U-(X=0|U)}}(U);this.p=function(U){const G=new Uint8Array(256);for(let C=0;C<256;C++)G[C]=C;for(let C=0;C<255;C++){const L=C+~~(U()*(256-C)),X=G[C];G[C]=G[L],G[L]=X}return G}(G),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(U,G){const C=this.permMod12,l=this.perm;let t=0,E=0,K=0;const O=(U+G)*L,T=Math.floor(U+O),D=Math.floor(G+O),y=(T+D)*X,V=U-(T-y),p=G-(D-y);let I,H;V>p?(I=1,H=0):(I=0,H=1);const x=V-I+X,h=p-H+X,N=V-1+2*X,b=p-1+2*X,o=255&T,w=255&D;let S=.5-V*V-p*p;if(S>=0){const U=3*C[o+l[w]];S*=S,t=S*S*(P[U]*V+P[U+1]*p)}let v=.5-x*x-h*h;if(v>=0){const U=3*C[o+I+l[w+H]];v*=v,E=v*v*(P[U]*x+P[U+1]*h)}let u=.5-N*N-b*b;if(u>=0){const U=3*C[o+1+l[w+1]];u*=u,K=u*u*(P[U]*N+P[U+1]*b)}return 70*(t+E+K)}noise3D(U,G,C){const L=this.permMod12,X=this.perm;let E,K,O,T;const D=(U+G+C)*l,y=Math.floor(U+D),V=Math.floor(G+D),p=Math.floor(C+D),I=(y+V+p)*t,H=U-(y-I),x=G-(V-I),h=C-(p-I);let N,b,o,w,S,v;H>=x?x>=h?(N=1,b=0,o=0,w=1,S=1,v=0):H>=h?(N=1,b=0,o=0,w=1,S=0,v=1):(N=0,b=0,o=1,w=1,S=0,v=1):x<h?(N=0,b=0,o=1,w=0,S=1,v=1):H<h?(N=0,b=1,o=0,w=0,S=1,v=1):(N=0,b=1,o=0,w=1,S=1,v=0);const u=H-N+t,d=x-b+t,g=h-o+t,Z=H-w+2*t,F=x-S+2*t,q=h-v+2*t,a=H-1+.5,k=x-1+.5,n=h-1+.5,Q=255&y,mU=255&V,B=255&p;let M=.6-H*H-x*x-h*h;if(M<0)E=0;else{const U=3*L[Q+X[mU+X[B]]];M*=M,E=M*M*(P[U]*H+P[U+1]*x+P[U+2]*h)}let z=.6-u*u-d*d-g*g;if(z<0)K=0;else{const U=3*L[Q+N+X[mU+b+X[B+o]]];z*=z,K=z*z*(P[U]*u+P[U+1]*d+P[U+2]*g)}let s=.6-Z*Z-F*F-q*q;if(s<0)O=0;else{const U=3*L[Q+w+X[mU+S+X[B+v]]];s*=s,O=s*s*(P[U]*Z+P[U+1]*F+P[U+2]*q)}let j=.6-a*a-k*k-n*n;if(j<0)T=0;else{const U=3*L[Q+1+X[mU+1+X[B+1]]];j*=j,T=j*j*(P[U]*a+P[U+1]*k+P[U+2]*n)}return 32*(E+K+O+T)}noise4D(U,G,C,L){const X=this.perm;let l,t,P,T,D;const y=(U+G+C+L)*E,V=Math.floor(U+y),p=Math.floor(G+y),I=Math.floor(C+y),H=Math.floor(L+y),x=(V+p+I+H)*K,h=U-(V-x),N=G-(p-x),b=C-(I-x),o=L-(H-x);let w=0,S=0,v=0,u=0;h>N?w++:S++,h>b?w++:v++,h>o?w++:u++,N>b?S++:v++,N>o?S++:u++,b>o?v++:u++;const d=w>=3?1:0,g=S>=3?1:0,Z=v>=3?1:0,F=u>=3?1:0,q=w>=2?1:0,a=S>=2?1:0,k=v>=2?1:0,n=u>=2?1:0,Q=w>=1?1:0,mU=S>=1?1:0,B=v>=1?1:0,M=u>=1?1:0,z=h-d+K,s=N-g+K,j=b-Z+K,A=o-F+K,Y=h-q+2*K,e=N-a+2*K,i=b-k+2*K,c=o-n+2*K,R=h-Q+3*K,W=N-mU+3*K,f=b-B+3*K,r=o-M+3*K,J=h-1+4*K,UU=N-1+4*K,GU=b-1+4*K,CU=o-1+4*K,LU=255&V,XU=255&p,lU=255&I,tU=255&H;let EU=.6-h*h-N*N-b*b-o*o;if(EU<0)l=0;else{const U=X[LU+X[XU+X[lU+X[tU]]]]%32*4;EU*=EU,l=EU*EU*(O[U]*h+O[U+1]*N+O[U+2]*b+O[U+3]*o)}let KU=.6-z*z-s*s-j*j-A*A;if(KU<0)t=0;else{const U=X[LU+d+X[XU+g+X[lU+Z+X[tU+F]]]]%32*4;KU*=KU,t=KU*KU*(O[U]*z+O[U+1]*s+O[U+2]*j+O[U+3]*A)}let PU=.6-Y*Y-e*e-i*i-c*c;if(PU<0)P=0;else{const U=X[LU+q+X[XU+a+X[lU+k+X[tU+n]]]]%32*4;PU*=PU,P=PU*PU*(O[U]*Y+O[U+1]*e+O[U+2]*i+O[U+3]*c)}let OU=.6-R*R-W*W-f*f-r*r;if(OU<0)T=0;else{const U=X[LU+Q+X[XU+mU+X[lU+B+X[tU+M]]]]%32*4;OU*=OU,T=OU*OU*(O[U]*R+O[U+1]*W+O[U+2]*f+O[U+3]*r)}let TU=.6-J*J-UU*UU-GU*GU-CU*CU;if(TU<0)D=0;else{const U=X[LU+1+X[XU+1+X[lU+1+X[tU+1]]]]%32*4;TU*=TU,D=TU*TU*(O[U]*J+O[U+1]*UU+O[U+2]*GU+O[U+3]*CU)}return 27*(l+t+P+T+D)}}}}]);