/*! For license information please see 1gabsc.32.dc109464.chunk.js.LICENSE.txt */
(self.b15p7b72fr8=self.b15p7b72fr8||[]).push([[32],{14586:(s,k,h)=>{"use strict";var A=h(14591),g=h(14596),ms=h(14599);h.g.__TYPEDARRAY_POOL||(h.g.__TYPEDARRAY_POOL={UINT8:g([32,0]),UINT16:g([32,0]),UINT32:g([32,0]),INT8:g([32,0]),INT16:g([32,0]),INT32:g([32,0]),FLOAT:g([32,0]),DOUBLE:g([32,0]),DATA:g([32,0]),UINT8C:g([32,0]),BUFFER:g([32,0])});var i="undefined"!==typeof Uint8ClampedArray,K=h.g.__TYPEDARRAY_POOL;K.UINT8C||(K.UINT8C=g([32,0])),K.BUFFER||(K.BUFFER=g([32,0]));var H=K.DATA,O=K.BUFFER;function c(s){if(s){var k=s.length||s.byteLength,h=A.log2(k);H[h].push(s)}}function S(s){s=A.nextPow2(s);var k=A.log2(s),h=H[k];return h.length>0?h.pop():new ArrayBuffer(s)}function a(s){return new Uint8Array(S(s),0,s)}function r(s){return new Uint16Array(S(2*s),0,s)}function d(s){return new Uint32Array(S(4*s),0,s)}function E(s){return new Int8Array(S(s),0,s)}function j(s){return new Int16Array(S(2*s),0,s)}function P(s){return new Int32Array(S(4*s),0,s)}function R(s){return new Float32Array(S(4*s),0,s)}function D(s){return new Float64Array(S(8*s),0,s)}function w(s){return i?new Uint8ClampedArray(S(s),0,s):a(s)}function B(s){return new DataView(S(s),0,s)}k.free=function(s){if(ms(s))O[A.log2(s.length)].push(s);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(s)&&(s=s.buffer),!s)return;var k=s.length||s.byteLength,h=0|A.log2(k);H[h].push(s)}},k.freeUint8=k.freeUint16=k.freeUint32=k.freeInt8=k.freeInt16=k.freeInt32=k.freeFloat32=k.freeFloat=k.freeFloat64=k.freeDouble=k.freeUint8Clamped=k.freeDataView=function(s){c(s.buffer)},k.freeArrayBuffer=c,k.freeBuffer=function(s){O[A.log2(s.length)].push(s)},k.malloc=function(s,k){if(void 0===k||"arraybuffer"===k)return S(s);switch(k){case"uint8":return a(s);case"uint16":return r(s);case"uint32":return d(s);case"int8":return E(s);case"int16":return j(s);case"int32":return P(s);case"float":case"float32":return R(s);case"double":case"float64":return D(s);case"uint8_clamped":return w(s);case"buffer":throw"Buffer not supported";case"data":case"dataview":return B(s);default:return null}return null},k.mallocArrayBuffer=S,k.mallocUint8=a,k.mallocUint16=r,k.mallocUint32=d,k.mallocInt8=E,k.mallocInt16=j,k.mallocInt32=P,k.mallocFloat32=k.mallocFloat=R,k.mallocFloat64=k.mallocDouble=D,k.mallocUint8Clamped=w,k.mallocDataView=B,k.clearCache=function(){for(var s=0;s<32;++s)K.UINT8[s].length=0,K.UINT16[s].length=0,K.UINT32[s].length=0,K.INT8[s].length=0,K.INT16[s].length=0,K.INT32[s].length=0,K.FLOAT[s].length=0,K.DOUBLE[s].length=0,K.UINT8C[s].length=0,H[s].length=0,O[s].length=0}},14678:(s,k,h)=>{s.exports=g;var A=h(13421);function g(s,k){if(!(this instanceof g))return new g(s,k);var h=A.create();A.add(h,s,k),this.base=A.min(A.create(),s,h),this.Wc=A.clone(k),this.max=A.max(A.create(),s,h),this.mag=A.length(this.Wc)}var ms=g.prototype;ms.width=function(){return this.Wc[0]},ms.height=function(){return this.Wc[1]},ms.depth=function(){return this.Wc[2]},ms.x0=function(){return this.base[0]},ms.y0=function(){return this.base[1]},ms.z0=function(){return this.base[2]},ms.x1=function(){return this.max[0]},ms.y1=function(){return this.max[1]},ms.z1=function(){return this.max[2]},ms.translate=function(s){return A.add(this.max,this.max,s),A.add(this.base,this.base,s),this},ms.setPosition=function(s){return A.add(this.max,s,this.Wc),A.j(this.base,s),this},ms.expand=function(s){var k=A.create(),h=A.create();return A.max(k,s.max,this.max),A.min(h,s.base,this.base),A.Rk(k,k,h),new g(h,k)},ms.intersects=function(s){return!(s.base[0]>this.max[0])&&(!(s.base[1]>this.max[1])&&(!(s.base[2]>this.max[2])&&(!(s.max[0]<this.base[0])&&(!(s.max[1]<this.base[1])&&!(s.max[2]<this.base[2])))))},ms.touches=function(s){var k=this.union(s);return null!==k&&(0==k.width()||0==k.height()||0==k.depth())},ms.union=function(s){if(!this.intersects(s))return null;var k=Math.max(s.base[0],this.base[0]),h=Math.max(s.base[1],this.base[1]),A=Math.max(s.base[2],this.base[2]);return new g([k,h,A],[Math.min(s.max[0],this.max[0])-k,Math.min(s.max[1],this.max[1])-h,Math.min(s.max[2],this.max[2])-A])}},14591:(s,k)=>{"use strict";function h(s){var k=32;return(s&=-s)&&k--,65535&s&&(k-=16),16711935&s&&(k-=8),252645135&s&&(k-=4),858993459&s&&(k-=2),1431655765&s&&(k-=1),k}k.INT_BITS=32,k.INT_MAX=2147483647,k.INT_MIN=-1<<31,k.sign=function(s){return(s>0)-(s<0)},k.abs=function(s){var k=s>>31;return(s^k)-k},k.min=function(s,k){return k^(s^k)&-(s<k)},k.max=function(s,k){return s^(s^k)&-(s<k)},k.isPow2=function(s){return!(s&s-1)&&!!s},k.log2=function(s){var k,h;return k=(s>65535)<<4,k|=h=((s>>>=k)>255)<<3,k|=h=((s>>>=h)>15)<<2,(k|=h=((s>>>=h)>3)<<1)|(s>>>=h)>>1},k.log10=function(s){return s>=1e9?9:s>=1e8?8:s>=1e7?7:s>=1e6?6:s>=1e5?5:s>=1e4?4:s>=1e3?3:s>=100?2:s>=10?1:0},k.popCount=function(s){return 16843009*((s=(858993459&(s-=s>>>1&1431655765))+(s>>>2&858993459))+(s>>>4)&252645135)>>>24},k.countTrailingZeros=h,k.nextPow2=function(s){return s+=0===s,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)+1},k.prevPow2=function(s){return s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)-(s>>>1)},k.parity=function(s){return s^=s>>>16,s^=s>>>8,s^=s>>>4,27030>>>(s&=15)&1};var A=new Array(256);!function(s){for(var k=0;k<256;++k){var h=k,A=k,g=7;for(h>>>=1;h;h>>>=1)A<<=1,A|=1&h,--g;s[k]=A<<g&255}}(A),k.reverse=function(s){return A[255&s]<<24|A[s>>>8&255]<<16|A[s>>>16&255]<<8|A[s>>>24&255]},k.interleave2=function(s,k){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s&=65535)|s<<8))|s<<4))|s<<2))|s<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))<<1},k.deinterleave2=function(s,k){return(s=65535&((s=16711935&((s=252645135&((s=858993459&((s=s>>>k&1431655765)|s>>>1))|s>>>2))|s>>>4))|s>>>16))<<16>>16},k.interleave3=function(s,k,h){return s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2),(s|=(k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},k.deinterleave3=function(s,k){return(s=1023&((s=4278190335&((s=251719695&((s=3272356035&((s=s>>>k&1227133513)|s>>>2))|s>>>4))|s>>>8))|s>>>16))<<22>>22},k.nextCombination=function(s){var k=s|s-1;return k+1|(~k&-~k)-1>>>h(s)+1}},14581:(s,k,h)=>{"use strict";s.exports=function(s,k,h){switch(arguments.length){case 1:return A=[],O(g=s,g,c,!0),A;case 2:return"function"===typeof k?O(s,s,k,!0):function(s,k){return A=[],O(s,k,c,!1),A}(s,k);case 3:return O(s,k,h,!1);default:throw new Error("box-intersect: Invalid arguments")}var g};var A,g=h(14586),ms=h(14601),i=h(14610);function K(s,k){for(var h=0;h<s;++h)if(!(k[h]<=k[h+s]))return!0;return!1}function H(s,k,h,A){for(var g=0,ms=0,i=0,H=s.length;i<H;++i){var O=s[i];if(!K(k,O)){for(var c=0;c<2*k;++c)h[g++]=O[c];A[ms++]=i}}return ms}function O(s,k,h,A){var K=s.length,O=k.length;if(!(K<=0||O<=0)){var c=s[0].length>>>1;if(!(c<=0)){var S,a=g.mallocDouble(2*c*K),r=g.mallocInt32(K);if((K=H(s,c,a,r))>0){if(1===c&&A)ms.init(K),S=ms.sweepComplete(c,h,0,K,a,r,0,K,a,r);else{var d=g.mallocDouble(2*c*O),E=g.mallocInt32(O);(O=H(k,c,d,E))>0&&(ms.init(K+O),S=1===c?ms.sweepBipartite(c,h,0,K,a,r,0,O,d,E):i(c,h,A,K,a,r,O,d,E),g.free(d),g.free(E))}g.free(a),g.free(r)}return S}}}function c(s,k){A.push([s,k])}},14619:(s,k)=>{"use strict";var h="d",A="ax",g="fp",ms="es",i="rs",K="re",H="rb",O="bs",c="be",S="bb",a=[h,A,"vv",i,K,H,"ri",O,c,S,"bi"];function r(s){var k="bruteForce"+(s?"Full":"Partial"),A=[],i=a.slice();s||i.splice(3,0,g);var K=["function "+k+"("+i.join()+"){"];function H(k,g){var i=function(s,k,A){var g="bruteForce"+(s?"Red":"Blue")+(k?"Flip":"")+(A?"Full":""),i=["function ",g,"(",a.join(),"){","var ",ms,"=2*",h,";"],K="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",H="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(A?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return s?i.push(K,"Q",":",H):i.push(H,"Q",":",K),A?i.push("if(y1<x0||x1<y0)continue;"):k?i.push("if(y0<=x0||x1<y0)continue;"):i.push("if(y0<x0||x1<y0)continue;"),i.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),k?i.push("yi,xi"):i.push("xi,yi"),i.push(");if(rv!==void 0)return rv;}}}"),{name:g,code:i.join("")}}(k,g,s);A.push(i.code),K.push("return "+i.name+"("+a.join()+");")}K.push("if(re-rs>be-bs){"),s?(H(!0,!1),K.push("}else{"),H(!1,!1)):(K.push("if(fp){"),H(!0,!0),K.push("}else{"),H(!0,!1),K.push("}}else{if(fp){"),H(!1,!0),K.push("}else{"),H(!1,!1),K.push("}")),K.push("}}return "+k);var O=A.join("")+K.join("");return new Function(O)()}k.partial=r(!1),k.full=r(!0)},14610:(s,k,h)=>{"use strict";s.exports=function(s,k,h,ms,c,N,b,t,z){!function(s,k){var h=8*g.log2(k+1)*(s+1)|0,ms=g.nextPow2(w*h);u.length<ms&&(A.free(u),u=A.mallocInt32(ms));var i=g.nextPow2(B*h);G.length<i&&(A.free(G),G=A.mallocDouble(i))}(s,ms+b);var C,v=0,Y=2*s;Q(v++,0,0,ms,0,b,h?16:0,-1/0,1/0),h||Q(v++,0,0,b,0,ms,1,-1/0,1/0);for(;v>0;){var n=(v-=1)*w,T=u[n],U=u[n+1],q=u[n+2],M=u[n+3],V=u[n+4],X=u[n+5],L=v*B,Z=G[L],x=G[L+1],y=1&X,W=!!(16&X),J=c,F=N,o=t,l=z;if(y&&(J=t,F=z,o=c,l=N),!(2&X&&U>=(q=j(s,T,U,q,J,F,x)))&&!(4&X&&(U=P(s,T,U,q,J,F,Z))>=q)){var f=q-U,e=V-M;if(W){if(s*f*(f+e)<r){if(void 0!==(C=H.scanComplete(s,T,k,U,q,J,F,M,V,o,l)))return C;continue}}else{if(s*Math.min(f,e)<S){if(void 0!==(C=i(s,T,k,y,U,q,J,F,M,V,o,l)))return C;continue}if(s*f*e<a){if(void 0!==(C=H.scanBipartite(s,T,k,y,U,q,J,F,M,V,o,l)))return C;continue}}var ss=d(s,T,U,q,J,F,Z,x);if(U<ss)if(s*(ss-U)<S){if(void 0!==(C=K(s,T+1,k,U,ss,J,F,M,V,o,l)))return C}else if(T===s-2){if(void 0!==(C=y?H.sweepBipartite(s,k,M,V,o,l,U,ss,J,F):H.sweepBipartite(s,k,U,ss,J,F,M,V,o,l)))return C}else Q(v++,T+1,U,ss,M,V,y,-1/0,1/0),Q(v++,T+1,M,V,U,ss,1^y,-1/0,1/0);if(ss<q){var ks=O(s,T,M,V,o,l),hs=o[Y*ks+T],As=E(s,T,ks,V,o,l,hs);if(As<V&&Q(v++,T,ss,q,As,V,(4|y)+(W?16:0),hs,x),M<ks&&Q(v++,T,ss,q,M,ks,(2|y)+(W?16:0),Z,hs),ks+1===As){if(void 0!==(C=W?I(s,T,k,ss,q,J,F,ks,o,l[ks]):p(s,T,k,y,ss,q,J,F,ks,o,l[ks])))return C}else if(ks<As){var gs;if(W){if(ss<(gs=R(s,T,ss,q,J,F,hs))){var mk=E(s,T,ss,gs,J,F,hs);if(T===s-2){if(ss<mk&&void 0!==(C=H.sweepComplete(s,k,ss,mk,J,F,ks,As,o,l)))return C;if(mk<gs&&void 0!==(C=H.sweepBipartite(s,k,mk,gs,J,F,ks,As,o,l)))return C}else ss<mk&&Q(v++,T+1,ss,mk,ks,As,16,-1/0,1/0),mk<gs&&(Q(v++,T+1,mk,gs,ks,As,0,-1/0,1/0),Q(v++,T+1,ks,As,mk,gs,1,-1/0,1/0))}}else ss<(gs=y?D(s,T,ss,q,J,F,hs):R(s,T,ss,q,J,F,hs))&&(T===s-2?C=y?H.sweepBipartite(s,k,ks,As,o,l,ss,gs,J,F):H.sweepBipartite(s,k,ss,gs,J,F,ks,As,o,l):(Q(v++,T+1,ss,gs,ks,As,y,-1/0,1/0),Q(v++,T+1,ks,As,ss,gs,1^y,-1/0,1/0)))}}}}};var A=h(14586),g=h(14591),ms=h(14619),i=ms.partial,K=ms.full,H=h(14601),O=h(14624),c=h(14628),S=128,a=1<<22,r=1<<22,d=c("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),E=c("lo===p0",["p0"]),j=c("lo<p0",["p0"]),P=c("hi<=p0",["p0"]),R=c("lo<=p0&&p0<=hi",["p0"]),D=c("lo<p0&&p0<=hi",["p0"]),w=6,B=2,u=A.mallocInt32(1024),G=A.mallocDouble(1024);function Q(s,k,h,A,g,ms,i,K,H){var O=w*s;u[O]=k,u[O+1]=h,u[O+2]=A,u[O+3]=g,u[O+4]=ms,u[O+5]=i;var c=B*s;G[c]=K,G[c+1]=H}function p(s,k,h,A,g,ms,i,K,H,O,c){var S=2*s,a=H*S,r=O[a+k];s:for(var d=g,E=g*S;d<ms;++d,E+=S){var j=i[E+k],P=i[E+k+s];if(!(r<j||P<r)&&(!A||r!==j)){for(var R,D=K[d],w=k+1;w<s;++w){j=i[E+w],P=i[E+w+s];var B=O[a+w],u=O[a+w+s];if(P<B||u<j)continue s}if(void 0!==(R=A?h(c,D):h(D,c)))return R}}}function I(s,k,h,A,g,ms,i,K,H,O){var c=2*s,S=K*c,a=H[S+k];s:for(var r=A,d=A*c;r<g;++r,d+=c){var E=i[r];if(E!==O){var j=ms[d+k],P=ms[d+k+s];if(!(a<j||P<a)){for(var R=k+1;R<s;++R){j=ms[d+R],P=ms[d+R+s];var D=H[S+R],w=H[S+R+s];if(P<D||w<j)continue s}var B=h(E,O);if(void 0!==B)return B}}}}},14624:(s,k,h)=>{"use strict";s.exports=function(s,k,h,i,K,H){if(i<=h+1)return h;var O=h,c=i,S=i+h>>>1,a=2*s,r=S,d=K[a*S+k];for(;O<c;){if(c-O<g){ms(s,k,O,c,K,H),d=K[a*S+k];break}var E=c-O,j=Math.random()*E+O|0,P=K[a*j+k],R=Math.random()*E+O|0,D=K[a*R+k],w=Math.random()*E+O|0,B=K[a*w+k];P<=D?B>=D?(r=R,d=D):P>=B?(r=j,d=P):(r=w,d=B):D>=B?(r=R,d=D):B>=P?(r=j,d=P):(r=w,d=B);for(var u=a*(c-1),G=a*r,Q=0;Q<a;++Q,++u,++G){var p=K[u];K[u]=K[G],K[G]=p}var I=H[c-1];H[c-1]=H[r],H[r]=I;for(u=a*(c-1),G=a*(r=A(s,k,O,c-1,K,H,d)),Q=0;Q<a;++Q,++u,++G){p=K[u];K[u]=K[G],K[G]=p}I=H[c-1];if(H[c-1]=H[r],H[r]=I,S<r){for(c=r-1;O<c&&K[a*(c-1)+k]===d;)c-=1;c+=1}else{if(!(r<S))break;for(O=r+1;O<c&&K[a*O+k]===d;)O+=1}}return A(s,k,h,S,K,H,K[a*S+k])};var A=h(14628)("lo<p0",["p0"]),g=8;function ms(s,k,h,A,g,ms){for(var i=2*s,K=i*(h+1)+k,H=h+1;H<A;++H,K+=i)for(var O=g[K],c=H,S=i*(H-1);c>h&&g[S+k]>O;--c,S-=i){for(var a=S,r=S+i,d=0;d<i;++d,++a,++r){var E=g[a];g[a]=g[r],g[r]=E}var j=ms[c];ms[c]=ms[c-1],ms[c-1]=j}}},14628:s=>{"use strict";s.exports=function(s,h){var A="abcdef".split("").concat(h),g=[];s.indexOf("lo")>=0&&g.push("lo=e[k+n]");s.indexOf("hi")>=0&&g.push("hi=e[k+o]");return A.push(k.replace("_",g.join()).replace("$",s)),Function.apply(void 0,A)};var k="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14607:s=>{"use strict";s.exports=function(s,A){A<=4*k?h(0,A-1,s):O(0,A-1,s)};var k=32;function h(s,k,h){for(var A=2*(s+1),g=s+1;g<=k;++g){for(var ms=h[A++],i=h[A++],K=g,H=A-2;K-- >s;){var O=h[H-2],c=h[H-1];if(O<ms)break;if(O===ms&&c<i)break;h[H]=O,h[H+1]=c,H-=2}h[H]=ms,h[H+1]=i}}function A(s,k,h){k*=2;var A=h[s*=2],g=h[s+1];h[s]=h[k],h[s+1]=h[k+1],h[k]=A,h[k+1]=g}function g(s,k,h){k*=2,h[s*=2]=h[k],h[s+1]=h[k+1]}function ms(s,k,h,A){k*=2,h*=2;var g=A[s*=2],ms=A[s+1];A[s]=A[k],A[s+1]=A[k+1],A[k]=A[h],A[k+1]=A[h+1],A[h]=g,A[h+1]=ms}function i(s,k,h,A,g){k*=2,g[s*=2]=g[k],g[k]=h,g[s+1]=g[k+1],g[k+1]=A}function K(s,k,h){k*=2;var A=h[s*=2],g=h[k];return!(A<g)&&(A!==g||h[s+1]>h[k+1])}function H(s,k,h,A){var g=A[s*=2];return g<k||g===k&&A[s+1]<h}function O(s,c,S){var a=(c-s+1)/6|0,r=s+a,d=c-a,E=s+c>>1,j=E-a,P=E+a,R=r,D=j,w=E,B=P,u=d,G=s+1,Q=c-1,p=0;K(R,D,S)&&(p=R,R=D,D=p),K(B,u,S)&&(p=B,B=u,u=p),K(R,w,S)&&(p=R,R=w,w=p),K(D,w,S)&&(p=D,D=w,w=p),K(R,B,S)&&(p=R,R=B,B=p),K(w,B,S)&&(p=w,w=B,B=p),K(D,u,S)&&(p=D,D=u,u=p),K(D,w,S)&&(p=D,D=w,w=p),K(B,u,S)&&(p=B,B=u,u=p);for(var I=S[2*D],N=S[2*D+1],b=S[2*B],t=S[2*B+1],z=2*R,C=2*w,v=2*u,Y=2*r,n=2*E,T=2*d,U=0;U<2;++U){var q=S[z+U],M=S[C+U],V=S[v+U];S[Y+U]=q,S[n+U]=M,S[T+U]=V}g(j,s,S),g(P,c,S);for(var X=G;X<=Q;++X)if(H(X,I,N,S))X!==G&&A(X,G,S),++G;else if(!H(X,b,t,S))for(;;){if(H(Q,b,t,S)){H(Q,I,N,S)?(ms(X,G,Q,S),++G,--Q):(A(X,Q,S),--Q);break}if(--Q<X)break}i(s,G-1,I,N,S),i(c,Q+1,b,t,S),G-2-s<=k?h(s,G-2,S):O(s,G-2,S),c-(Q+2)<=k?h(Q+2,c,S):O(Q+2,c,S),Q-G<=k?h(G,Q,S):O(G,Q,S)}},14601:(s,k,h)=>{"use strict";s.exports={init:function(s){var k=g.nextPow2(s);H.length<k&&(A.free(H),H=A.mallocInt32(k));O.length<k&&(A.free(O),O=A.mallocInt32(k));c.length<k&&(A.free(c),c=A.mallocInt32(k));S.length<k&&(A.free(S),S=A.mallocInt32(k));a.length<k&&(A.free(a),a=A.mallocInt32(k));r.length<k&&(A.free(r),r=A.mallocInt32(k));var h=8*k;d.length<h&&(A.free(d),d=A.mallocDouble(h))},sweepBipartite:function(s,k,h,A,g,K,a,r,P,R){for(var D=0,w=2*s,B=s-1,u=w-1,G=h;G<A;++G){var Q=K[G],p=w*G;d[D++]=g[p+B],d[D++]=-(Q+1),d[D++]=g[p+u],d[D++]=Q}for(G=a;G<r;++G){Q=R[G]+i;var I=w*G;d[D++]=P[I+B],d[D++]=-Q,d[D++]=P[I+u],d[D++]=Q}var N=D>>>1;ms(d,N);var b=0,t=0;for(G=0;G<N;++G){var z=0|d[2*G+1];if(z>=i)E(c,S,t--,z=z-i|0);else if(z>=0)E(H,O,b--,z);else if(z<=-i){z=-z-i|0;for(var C=0;C<b;++C){if(void 0!==(v=k(H[C],z)))return v}j(c,S,t++,z)}else{z=-z-1|0;for(C=0;C<t;++C){var v;if(void 0!==(v=k(z,c[C])))return v}j(H,O,b++,z)}}},sweepComplete:function(s,k,h,A,g,i,K,P,R,D){for(var w=0,B=2*s,u=s-1,G=B-1,Q=h;Q<A;++Q){var p=i[Q]+1<<1,I=B*Q;d[w++]=g[I+u],d[w++]=-p,d[w++]=g[I+G],d[w++]=p}for(Q=K;Q<P;++Q){p=D[Q]+1<<1;var N=B*Q;d[w++]=R[N+u],d[w++]=1|-p,d[w++]=R[N+G],d[w++]=1|p}var b=w>>>1;ms(d,b);var t=0,z=0,C=0;for(Q=0;Q<b;++Q){var v=0|d[2*Q+1],Y=1&v;if(Q<b-1&&v>>1===d[2*Q+3]>>1&&(Y=2,Q+=1),v<0){for(var n=-(v>>1)-1,T=0;T<C;++T){if(void 0!==(U=k(a[T],n)))return U}if(0!==Y)for(T=0;T<t;++T){if(void 0!==(U=k(H[T],n)))return U}if(1!==Y)for(T=0;T<z;++T){var U;if(void 0!==(U=k(c[T],n)))return U}0===Y?j(H,O,t++,n):1===Y?j(c,S,z++,n):2===Y&&j(a,r,C++,n)}else{n=(v>>1)-1;0===Y?E(H,O,t--,n):1===Y?E(c,S,z--,n):2===Y&&E(a,r,C--,n)}}},scanBipartite:function(s,k,h,A,g,K,c,S,a,r,P,R){var D=0,w=2*s,B=k,u=k+s,G=1,Q=1;A?Q=i:G=i;for(var p=g;p<K;++p){var I=p+G,N=w*p;d[D++]=c[N+B],d[D++]=-I,d[D++]=c[N+u],d[D++]=I}for(p=a;p<r;++p){I=p+Q;var b=w*p;d[D++]=P[b+B],d[D++]=-I}var t=D>>>1;ms(d,t);var z=0;for(p=0;p<t;++p){var C=0|d[2*p+1];if(C<0){var v=!1;if((I=-C)>=i?(v=!A,I-=i):(v=!!A,I-=1),v)j(H,O,z++,I);else{var Y=R[I],n=w*I,T=P[n+k+1],U=P[n+k+1+s];s:for(var q=0;q<z;++q){var M=H[q],V=w*M;if(!(U<c[V+k+1]||c[V+k+1+s]<T)){for(var X=k+2;X<s;++X)if(P[n+X+s]<c[V+X]||c[V+X+s]<P[n+X])continue s;var L,Z=S[M];if(void 0!==(L=A?h(Y,Z):h(Z,Y)))return L}}}}else E(H,O,z--,C-G)}},scanComplete:function(s,k,h,A,g,K,O,c,S,a,r){for(var E=0,j=2*s,P=k,R=k+s,D=A;D<g;++D){var w=D+i,B=j*D;d[E++]=K[B+P],d[E++]=-w,d[E++]=K[B+R],d[E++]=w}for(D=c;D<S;++D){w=D+1;var u=j*D;d[E++]=a[u+P],d[E++]=-w}var G=E>>>1;ms(d,G);var Q=0;for(D=0;D<G;++D){var p=0|d[2*D+1];if(p<0){if((w=-p)>=i)H[Q++]=w-i;else{var I=r[w-=1],N=j*w,b=a[N+k+1],t=a[N+k+1+s];s:for(var z=0;z<Q;++z){var C=H[z],v=O[C];if(v===I)break;var Y=j*C;if(!(t<K[Y+k+1]||K[Y+k+1+s]<b)){for(var n=k+2;n<s;++n)if(a[N+n+s]<K[Y+n]||K[Y+n+s]<a[N+n])continue s;var T=h(v,I);if(void 0!==T)return T}}}}else{for(w=p-i,z=Q-1;z>=0;--z)if(H[z]===w){for(n=z+1;n<Q;++n)H[n-1]=H[n];break}--Q}}}};var A=h(14586),g=h(14591),ms=h(14607),i=1<<28,K=1024,H=A.mallocInt32(K),O=A.mallocInt32(K),c=A.mallocInt32(K),S=A.mallocInt32(K),a=A.mallocInt32(K),r=A.mallocInt32(K),d=A.mallocDouble(8192);function E(s,k,h,A){var g=k[A],ms=s[h-1];s[g]=ms,k[ms]=g}function j(s,k,h,A){s[h]=A,k[A]=h}},14596:s=>{"use strict";function k(s,h,A){var g=0|s[A];if(g<=0)return[];var ms,i=new Array(g);if(A===s.length-1)for(ms=0;ms<g;++ms)i[ms]=h;else for(ms=0;ms<g;++ms)i[ms]=k(s,h,A+1);return i}s.exports=function(s,h){switch("undefined"===typeof h&&(h=0),typeof s){case"number":if(s>0)return function(s,k){var h,A;for(h=new Array(s),A=0;A<s;++A)h[A]=k;return h}(0|s,h);break;case"object":if("number"===typeof s.length)return k(s,h,0)}return[]}},14544:(s,k,h)=>{s.exports=function(){var s=this;this.components={},this.comps=this.components;var k=this.components,h=1,g={},ms=[],i=[],K={timeout:!1,removals:[],multiComps:[]};function H(s,h){var A=k[h],ms=g[h],i=ms.hash[s];i&&(ms.remove(s),A.kh&&(A.multi?(i.forEach((k=>{k&&A.kh(s,k)})),i.length=0):A.kh(s,i)),K.removals.push(ms),O())}function O(){K.timeout||(K.timeout=!0,setTimeout(c,1))}function c(){K.timeout=!1,S()}function S(){K.multiComps.length&&function(s){for(var k=0;k<s.length;k++){var{entID:h,data:A}=s[k],g=A.hash[h];if(g){for(var ms=0;ms<g.length;ms++)g[ms]||(g.splice(ms,1),ms--);0===g.length&&(A.remove(h),K.removals.push(A))}}s.length=0}(K.multiComps),K.removals.length&&function(s){for(var k=0;k<s.length;k++){s[k].flush()}s.length=0}(K.removals)}this.ra=g,this._systems=ms,this._renderSystems=i,this.hS=function(k){var A=h++;return Array.isArray(k)&&k.forEach((k=>s.JH(A,k))),A},this.deleteEntity=function(k){return Object.keys(g).forEach((s=>{g[s].hash[k]&&H(k,s)})),s},this.PS=function(s){if(!s)throw new Error("Missing component definition");var h=s.name;if(!h)throw new Error("Component definition must have a name property.");if("string"!==typeof h)throw new Error("Component name must be a string.");if(""===h)throw new Error("Component name must be a non-empty string.");if(g[h])throw new Error(`Component ${h} already exists.`);var K={};return K.name=h,K.multi=!!s.multi,K.order=isNaN(s.order)?99:s.order,K.stateConstructor=s.stateConstructor||null,K.state=s.state||{},K.yK=s.yK||null,K.kh=s.kh||null,K.system=s.system||null,K.fK=s.fK||null,k[h]=K,g[h]=new A,g[h]._pendingMultiCleanup=!1,g[h]._multiCleanupIDs=K.multi?[]:null,K.system&&(ms.push(h),ms.sort(((s,h)=>k[s].order-k[h].order))),K.fK&&(i.push(h),i.sort(((s,h)=>k[s].order-k[h].order))),h},this.overwriteComponent=function(s,h){var A=k[s];if(!A)throw new Error(`Unknown component: ${s}`);if(!h)throw new Error("Missing component definition");if(A.name!==h.name)throw new Error("Overwriting component must use the same name property.");var K={};K.name=s,K.multi=!!h.multi,K.order=isNaN(h.order)?99:h.order,K.state=h.state||{},K.yK=h.yK||null,K.kh=h.kh||null,K.system=h.system||null,K.fK=h.fK||null,k[s]=K,g[s]._pendingMultiCleanup=!1,g[s]._multiCleanupIDs=K.multi?[]:null;var H=ms.indexOf(s);K.system&&H<0&&ms.push(s),!K.system&&H>=0&&ms.splice(H,1),ms.sort(((s,h)=>k[s].order-k[h].order));var O=i.indexOf(s);K.fK&&O<0&&i.push(s),!K.fK&&O>=0&&i.splice(O,1),i.sort(((s,h)=>k[s].order-k[h].order));var c=K.state;return this.WO(s).forEach((s=>{for(var k in c)k in s||(s[k]=c[k]);K.yK&&K.yK(s.oK,s)})),s},this.deleteComponent=function(h){var A=g[h];if(!A)throw new Error(`Unknown component: ${h}`);A.flush(),A.list.forEach((s=>{s&&H(s.oK||s[0].oK,h)}));var K=ms.indexOf(h),O=i.indexOf(h);return K>-1&&ms.splice(K,1),O>-1&&i.splice(O,1),g[h].dispose(),delete g[h],delete k[h],s},this.JH=function(s,h,A){var ms,i=k[h],K=g[h];if(!K)throw new Error(`Unknown component: ${h}.`);if(K.hash[s]&&!i.multi)throw new Error(`Entity ${s} already has component: ${h}.`);if(i.stateConstructor){if(!(ms=new i.stateConstructor).hasOwnProperty("oK"))throw new Error(`Component ${i.name} stateConstructor type does not have property __id`)}else ms=Object.assign({},{oK:s},i.state,A);if(ms.oK=s,i.multi){var H=K.hash[s];H||(H=[],K.add(s,H)),H.push(ms)}else K.add(s,ms);return i.yK&&i.yK(s,ms),this},this.gO=function(s,k){var h=g[k];if(!h)throw new Error(`Unknown component: ${k}.`);return!!h.hash[s]},this.fH=function(k,h){if(!g[h])throw new Error(`Unknown component: ${h}.`);return H(k,h),s},this.getState=function(s,k){var h=g[k];if(!h)throw new Error(`Unknown component: ${k}.`);return h.hash[s]},this.WO=function(s){var k=g[s];if(!k)throw new Error(`Unknown component: ${s}.`);return S(),k.list},this.Hd=function(s){if(!g[s])throw new Error(`Unknown component: ${s}.`);var k=g[s].hash;return s=>k[s]},this.ad=function(s){if(!g[s])throw new Error(`Unknown component: ${s}.`);var k=g[s].hash;return s=>!!k[s]},this.ZK=function(h){S();for(var A=0;A<ms.length;A++){var i=ms[A],K=k[i],H=g[i];K.system(h,H.list),S()}return s},this.render=function(h){S();for(var A=0;A<i.length;A++){var ms=i[A],K=k[ms],H=g[ms];K.fK(h,H.list),S()}return s},this.removeMultiComponent=function(h,A,ms){var i=k[A],H=g[A];if(!H)throw new Error(`Unknown component: ${A}.`);if(!i.multi)throw new Error("removeMultiComponent called on non-multi component");return function(s,k,h,A){var g=h.hash[s];if(g){var ms=g[A];ms&&(g[A]=null,k.kh&&k.kh(s,ms),K.multiComps.push({entID:s,data:h}),O())}}(h,i,H,ms),s}};var A=h(14549)},14549:s=>{function k(s,k){var h=s._map[k];if(delete s.hash[k],delete s._map[k],h===s.list.length-1)s.list.pop();else{var A=s.list.pop();if(s.list[h]=A,null===A||null===A[0]){var g=s.list.length;for(var ms in s._map)if(s._map[ms]===g)return void(s._map[ms]=h)}else{var i=A.oK||A[0].oK;s._map[i]=h}}}s.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(s,k){if("number"===typeof this._map[s]){var h=this._map[s];this.hash[s]=k,this.list[h]=k}else this._map[s]=this.list.length,this.hash[s]=k,this.list.push(k)}remove(s){var k=this._map[s];this.hash[s]=null,this.list[k]=null,this._pendingRemovals.push(s)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var s=0;s<this._pendingRemovals.length;s++){var h=this._pendingRemovals[s];null===this.hash[h]&&k(this,h)}this._pendingRemovals.length=0}}},14500:s=>{"use strict";var k,h="object"===typeof Reflect?Reflect:null,A=function(s,k,h){return Function.prototype.apply.call(s,k,h)};k=h&&"function"===typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:function(s){return Object.getOwnPropertyNames(s)};var g=Number.isNaN||function(s){return s!==s};function ms(){ms.init.call(this)}s.exports=ms,s.exports.once=function(s,k){return new Promise((function(h,A){function g(h){s.removeListener(k,ms),A(h)}function ms(){"function"===typeof s.removeListener&&s.removeListener("error",g),h([].slice.call(arguments))}E(s,k,ms,{once:!0}),"error"!==k&&function(s,k,h){"function"===typeof s.on&&E(s,"error",k,h)}(s,g,{once:!0})}))},ms.EventEmitter=ms,ms.prototype._events=void 0,ms.prototype._eventsCount=0,ms.prototype._maxListeners=void 0;var i=10;function K(s){if("function"!==typeof s)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}function H(s){return void 0===s._maxListeners?ms.defaultMaxListeners:s._maxListeners}function O(s,k,h,A){var g,ms,i,O;if(K(h),void 0===(ms=s._events)?(ms=s._events=Object.create(null),s._eventsCount=0):(void 0!==ms.newListener&&(s.emit("newListener",k,h.listener?h.listener:h),ms=s._events),i=ms[k]),void 0===i)i=ms[k]=h,++s._eventsCount;else if("function"===typeof i?i=ms[k]=A?[h,i]:[i,h]:A?i.unshift(h):i.push(h),(g=H(s))>0&&i.length>g&&!i.warned){i.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.ik=s,c.type=k,c.count=i.length,O=c,console&&console.warn&&console.warn(O)}return s}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(s,k,h){var A={fired:!1,wrapFn:void 0,target:s,type:k,listener:h},g=c.bind(A);return g.listener=h,A.wrapFn=g,g}function a(s,k,h){var A=s._events;if(void 0===A)return[];var g=A[k];return void 0===g?[]:"function"===typeof g?h?[g.listener||g]:[g]:h?function(s){for(var k=new Array(s.length),h=0;h<k.length;++h)k[h]=s[h].listener||s[h];return k}(g):d(g,g.length)}function r(s){var k=this._events;if(void 0!==k){var h=k[s];if("function"===typeof h)return 1;if(void 0!==h)return h.length}return 0}function d(s,k){for(var h=new Array(k),A=0;A<k;++A)h[A]=s[A];return h}function E(s,k,h,A){if("function"===typeof s.on)A.once?s.once(k,h):s.on(k,h);else{if("function"!==typeof s.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s);s.addEventListener(k,(function g(ms){A.once&&s.removeEventListener(k,g),h(ms)}))}}Object.defineProperty(ms,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(s){if("number"!==typeof s||s<0||g(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");i=s}}),ms.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ms.prototype.setMaxListeners=function(s){if("number"!==typeof s||s<0||g(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this},ms.prototype.getMaxListeners=function(){return H(this)},ms.prototype.emit=function(s){for(var k=[],h=1;h<arguments.length;h++)k.push(arguments[h]);var g="error"===s,ms=this._events;if(void 0!==ms)g=g&&void 0===ms.error;else if(!g)return!1;if(g){var i;if(k.length>0&&(i=k[0]),i instanceof Error)throw i;var K=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw K.context=i,K}var H=ms[s];if(void 0===H)return!1;if("function"===typeof H)A(H,this,k);else{var O=H.length,c=d(H,O);for(h=0;h<O;++h)A(c[h],this,k)}return!0},ms.prototype.addListener=function(s,k){return O(this,s,k,!1)},ms.prototype.on=ms.prototype.addListener,ms.prototype.prependListener=function(s,k){return O(this,s,k,!0)},ms.prototype.once=function(s,k){return K(k),this.on(s,S(this,s,k)),this},ms.prototype.prependOnceListener=function(s,k){return K(k),this.prependListener(s,S(this,s,k)),this},ms.prototype.removeListener=function(s,k){var h,A,g,ms,i;if(K(k),void 0===(A=this._events))return this;if(void 0===(h=A[s]))return this;if(h===k||h.listener===k)0===--this._eventsCount?this._events=Object.create(null):(delete A[s],A.removeListener&&this.emit("removeListener",s,h.listener||k));else if("function"!==typeof h){for(g=-1,ms=h.length-1;ms>=0;ms--)if(h[ms]===k||h[ms].listener===k){i=h[ms].listener,g=ms;break}if(g<0)return this;0===g?h.shift():function(s,k){for(;k+1<s.length;k++)s[k]=s[k+1];s.pop()}(h,g),1===h.length&&(A[s]=h[0]),void 0!==A.removeListener&&this.emit("removeListener",s,i||k)}return this},ms.prototype.off=ms.prototype.removeListener,ms.prototype.Kk=function(s){var k,h,A;if(void 0===(h=this._events))return this;if(void 0===h.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==h[s]&&(0===--this._eventsCount?this._events=Object.create(null):delete h[s]),this;if(0===arguments.length){var g,ms=Object.keys(h);for(A=0;A<ms.length;++A)"removeListener"!==(g=ms[A])&&this.Kk(g);return this.Kk("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(k=h[s]))this.removeListener(s,k);else if(void 0!==k)for(A=k.length-1;A>=0;A--)this.removeListener(s,k[A]);return this},ms.prototype.listeners=function(s){return a(this,s,!0)},ms.prototype.rawListeners=function(s){return a(this,s,!1)},ms.listenerCount=function(s,k){return"function"===typeof s.listenerCount?s.listenerCount(k):r.call(s,k)},ms.prototype.listenerCount=r,ms.prototype.eventNames=function(){return this._eventsCount>0?k(this._events):[]}},14810:s=>{"use strict";s.exports=function(s,k,h,A,g,ms){var i=+k[0],K=+k[1],H=+k[2],O=+h[0],c=+h[1],S=+h[2],a=Math.sqrt(O*O+c*c+S*S);if(0===a)throw new Error("Can't raycast along a zero vector");return function(s,k,h,A,g,ms,i,K,H,O){for(var c=0,S=Math.floor,a=0|S(k),r=0|S(h),d=0|S(A),E=g>0?1:-1,j=ms>0?1:-1,P=i>0?1:-1,R=Math.abs(1/g),D=Math.abs(1/ms),w=Math.abs(1/i),B=R<1/0?R*(E>0?a+1-k:k-a):1/0,u=D<1/0?D*(j>0?r+1-h:h-r):1/0,G=w<1/0?w*(P>0?d+1-A:A-d):1/0,Q=-1;c<=K;){var p=s(a,r,d);if(p)return H&&(H[0]=k+c*g,H[1]=h+c*ms,H[2]=A+c*i),O&&(O[0]=O[1]=O[2]=0,0===Q&&(O[0]=-E),1===Q&&(O[1]=-j),2===Q&&(O[2]=-P)),p;B<u?B<G?(a+=E,c=B,B+=R,Q=0):(d+=P,c=G,G+=w,Q=2):u<G?(r+=j,c=u,u+=D,Q=1):(d+=P,c=G,G+=w,Q=2)}return H&&(H[0]=k+c*g,H[1]=h+c*ms,H[2]=A+c*i),O&&(O[0]=O[1]=O[2]=0),0}(s,i,K,H,O/=a,c/=a,S/=a,A="undefined"===typeof A?64:+A,g,ms)}},14846:(s,k,h)=>{"use strict";h.d(k,{b:()=>ms});var A=h(14500);function g(){this.hr=!1,this.stopPropagation=!1,this.Ar=!1,this.disabled=!1}class ms{constructor(s,k){this.version="0.7.0";var h=Object.assign({},new g,k||{});this.element=s||document,this.hr=!!h.hr,this.stopPropagation=!!h.stopPropagation,this.Ar=!!h.Ar,this.disabled=!!h.disabled,this.filterEvents=(s,k)=>!0,this.down=new A.EventEmitter,this.up=new A.EventEmitter,this.state={},this.VO={dx:0,dy:0,Wr:0,MO:0,Jr:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?K(this):document.addEventListener("DOMContentLoaded",(s=>{K(this)}),{once:!0})}bind(s){for(var k=arguments.length,h=new Array(k>1?k-1:0),A=1;A<k;A++)h[A-1]=arguments[A];h.forEach((k=>{var h=this._keyBindmap[k]||[];h.includes(s)||(h.push(s),this._keyBindmap[k]=h)})),this.state[s]=!!this.state[s],this.pressCount[s]=this.pressCount[s]||0,this.releaseCount[s]=this.releaseCount[s]||0}unbind(s){for(var k in this._keyBindmap){var h=this._keyBindmap[k],A=h.indexOf(s);A>-1&&h.splice(A,1)}}getBindings(){var s={};for(var k in this._keyBindmap){this._keyBindmap[k].forEach((h=>{s[h]=s[h]||[],s[h].push(k)}))}return s}ZK(){i(this.VO),i(this.pressCount),i(this.releaseCount)}}function i(s){for(var k in s)s[k]=0}function K(s){window.addEventListener("keydown",d.bind(null,s,!0),!1),window.addEventListener("keyup",d.bind(null,s,!1),!1);var k={passive:!0};s.element.addEventListener("touchstart",S.bind(void 0,s),{passive:!1}),s.element.addEventListener("touchend",r.bind(void 0,s),k),s.element.addEventListener("mousedown",E.bind(null,s,!0),k),window.document.addEventListener("mouseup",E.bind(null,s,!1),k),s.element.addEventListener("touchmove",j.bind(null,s),k),s.element.addEventListener("mousemove",j.bind(null,s),k),window.PointerEvent,s.element.addEventListener("wheel",P.bind(null,s),k),s.element.addEventListener("contextmenu",R.bind(null,s),!1),window.addEventListener("blur",D.bind(null,s),!1)}var H=0,O=0,c=null;function S(s,k){k.preventDefault(),a(k)}function a(s){let k=!1;for(let h=0;h<s.touches.length;++h)if(s.touches[h].identifier===c){k=!0;break}if(!k){const k=s.changedTouches[0];H=k.clientX,O=k.clientY,c=k.identifier}}function r(s,k){for(var h=k.changedTouches,A=0;A<h.length;++A)h[A].identifier===c&&(c=null)}function d(s,k,h){w(h.code,k,s,h)}function E(s,k,h){if("pointerId"in h)if(k){if(null!==s._touches.currID)return;s._touches.currID=h.pointerId}else{if(s._touches.currID!==h.pointerId)return;s._touches.currID=null}return w("Mouse"+("button"in h?h.button+1:1),k,s,h),!1}function j(s,k){var h=k.movementX||k.mozMovementX||0,A=k.movementY||k.mozMovementY||0;if(k.touches&&0===(h|A)){var g=function(s){a(s);for(let k=0;k<s.changedTouches.length;++k)if(s.changedTouches[k].identifier==c){const h=s.changedTouches[k],A=[h.clientX-H,h.clientY-O];return H=h.clientX,O=h.clientY,A}return console.error(`Did not find touch id ${c}`),[0,0]}(k);h=g[0],A=g[1]}s.VO.dx+=h,s.VO.dy+=A}function P(s,k){var h=1;switch(k.deltaMode){case 0:h=1;break;case 1:h=12;break;case 2:h=s.element.clientHeight||window.innerHeight}s.VO.Wr+=(k.deltaX||0)*h,s.VO.MO+=(k.deltaY||0)*h,s.VO.Jr+=(k.deltaZ||0)*h}function R(s,k){if(!s.Ar)return k.preventDefault(),!1}function D(s){for(var k in s._keyStates)s._keyStates[k]&&(/^Mouse\d/.test(k)||w(k,!1,s,{code:k,note:"ztr282aew5",preventDefault:()=>{},stopPropagation:()=>{}}))}function w(s,k,h,A){var g=h._keyBindmap[s];g&&(B(h._keyStates[s],k)&&(h._keyStates[s]=k,g.forEach((s=>{(!h.filterEvents||h.filterEvents(A,s))&&function(s,k,h,A){var g=k?h.pressCount:h.releaseCount;g[s]=(g[s]||0)+1;var ms=h._bindPressCount[s]||0;(ms+=k?1:-1)<0&&(ms=0);h._bindPressCount[s]=ms;var i=h.state[s];if(B(i,ms)){h.state[s]=ms>0;var K=k?h.down:h.up;h.disabled||K.emit(s,A)}}(s,k,h,A)}))),"button"in A||(h.hr&&!A.defaultPrevented&&A.preventDefault(),h.stopPropagation&&A.stopPropagation()))}function B(s,k){return s?!k:k}},13478:s=>{s.exports=function(s,k,h){return s[0]=k[0]+h[0],s[1]=k[1]+h[1],s[2]=k[2]+h[2],s}},13433:(s,k,h)=>{s.exports=function(s,k){var h=A(s[0],s[1],s[2]),i=A(k[0],k[1],k[2]);g(h,h),g(i,i);var K=ms(h,i);return K>1?0:Math.acos(K)};var A=h(13442),g=h(13447),ms=h(13451)},13535:s=>{s.exports=function(s,k){return s[0]=Math.ceil(k[0]),s[1]=Math.ceil(k[1]),s[2]=Math.ceil(k[2]),s}},13429:s=>{s.exports=function(s){var k=new Float32Array(3);return k[0]=s[0],k[1]=s[1],k[2]=s[2],k}},13454:s=>{s.exports=function(s,k){return s[0]=k[0],s[1]=k[1],s[2]=k[2],s}},13427:s=>{s.exports=function(){var s=new Float32Array(3);return s[0]=0,s[1]=0,s[2]=0,s}},13618:s=>{s.exports=function(s,k,h){var A=k[0],g=k[1],ms=k[2],i=h[0],K=h[1],H=h[2];return s[0]=g*H-ms*K,s[1]=ms*i-A*H,s[2]=A*K-g*i,s}},13565:(s,k,h)=>{s.exports=h(13560)},13560:s=>{s.exports=function(s,k){var h=k[0]-s[0],A=k[1]-s[1],g=k[2]-s[2];return Math.sqrt(h*h+A*A+g*g)}},13514:(s,k,h)=>{s.exports=h(13507)},13507:s=>{s.exports=function(s,k,h){return s[0]=k[0]/h[0],s[1]=k[1]/h[1],s[2]=k[2]/h[2],s}},13451:s=>{s.exports=function(s,k){return s[0]*k[0]+s[1]*k[1]+s[2]*k[2]}},13423:s=>{s.exports=1e-6},13466:(s,k,h)=>{s.exports=function(s,k){var h=s[0],g=s[1],ms=s[2],i=k[0],K=k[1],H=k[2];return Math.abs(h-i)<=A*Math.max(1,Math.abs(h),Math.abs(i))&&Math.abs(g-K)<=A*Math.max(1,Math.abs(g),Math.abs(K))&&Math.abs(ms-H)<=A*Math.max(1,Math.abs(ms),Math.abs(H))};var A=h(13423)},13472:s=>{s.exports=function(s,k){return s[0]===k[0]&&s[1]===k[1]&&s[2]===k[2]}},13532:s=>{s.exports=function(s,k){return s[0]=Math.floor(k[0]),s[1]=Math.floor(k[1]),s[2]=Math.floor(k[2]),s}},13671:(s,k,h)=>{s.exports=function(s,k,h,g,ms,i){var K,H;k||(k=3);h||(h=0);H=g?Math.min(g*k+h,s.length):s.length;for(K=h;K<H;K+=k)A[0]=s[K],A[1]=s[K+1],A[2]=s[K+2],ms(A,A,i),s[K]=A[0],s[K+1]=A[1],s[K+2]=A[2];return s};var A=h(13427)()},13442:s=>{s.exports=function(s,k,h){var A=new Float32Array(3);return A[0]=s,A[1]=k,A[2]=h,A}},13421:(s,k,h)=>{s.exports={EPSILON:h(13423),create:h(13427),clone:h(13429),angle:h(13433),YK:h(13442),j:h(13454),set:h(13458),equals:h(13466),exactEquals:h(13472),add:h(13478),Rk:h(13485),sub:h(13493),multiply:h(13502),mul:h(13504),divide:h(13507),div:h(13514),min:h(13516),max:h(13525),floor:h(13532),ceil:h(13535),round:h(13538),scale:h(13546),nK:h(13555),distance:h(13560),k:h(13565),squaredDistance:h(13568),sqrDist:h(13573),length:h(13578),len:h(13587),squaredLength:h(13594),TK:h(13602),negate:h(13610),inverse:h(13613),normalize:h(13447),dot:h(13451),cross:h(13618),zK:h(13627),random:h(13634),transformMat4:h(13637),transformMat3:h(13643),transformQuat:h(13650),UK:h(13657),qK:h(13661),MK:h(13667),forEach:h(13671)}},13613:s=>{s.exports=function(s,k){return s[0]=1/k[0],s[1]=1/k[1],s[2]=1/k[2],s}},13587:(s,k,h)=>{s.exports=h(13578)},13578:s=>{s.exports=function(s){var k=s[0],h=s[1],A=s[2];return Math.sqrt(k*k+h*h+A*A)}},13627:s=>{s.exports=function(s,k,h,A){var g=k[0],ms=k[1],i=k[2];return s[0]=g+A*(h[0]-g),s[1]=ms+A*(h[1]-ms),s[2]=i+A*(h[2]-i),s}},13525:s=>{s.exports=function(s,k,h){return s[0]=Math.max(k[0],h[0]),s[1]=Math.max(k[1],h[1]),s[2]=Math.max(k[2],h[2]),s}},13516:s=>{s.exports=function(s,k,h){return s[0]=Math.min(k[0],h[0]),s[1]=Math.min(k[1],h[1]),s[2]=Math.min(k[2],h[2]),s}},13504:(s,k,h)=>{s.exports=h(13502)},13502:s=>{s.exports=function(s,k,h){return s[0]=k[0]*h[0],s[1]=k[1]*h[1],s[2]=k[2]*h[2],s}},13610:s=>{s.exports=function(s,k){return s[0]=-k[0],s[1]=-k[1],s[2]=-k[2],s}},13447:s=>{s.exports=function(s,k){var h=k[0],A=k[1],g=k[2],ms=h*h+A*A+g*g;ms>0&&(ms=1/Math.sqrt(ms),s[0]=k[0]*ms,s[1]=k[1]*ms,s[2]=k[2]*ms);return s}},13634:s=>{s.exports=function(s,k){k=k||1;var h=2*Math.random()*Math.PI,A=2*Math.random()-1,g=Math.sqrt(1-A*A)*k;return s[0]=Math.cos(h)*g,s[1]=Math.sin(h)*g,s[2]=A*k,s}},13657:s=>{s.exports=function(s,k,h,A){var g=h[1],ms=h[2],i=k[1]-g,K=k[2]-ms,H=Math.sin(A),O=Math.cos(A);return s[0]=k[0],s[1]=g+i*O-K*H,s[2]=ms+i*H+K*O,s}},13661:s=>{s.exports=function(s,k,h,A){var g=h[0],ms=h[2],i=k[0]-g,K=k[2]-ms,H=Math.sin(A),O=Math.cos(A);return s[0]=g+K*H+i*O,s[1]=k[1],s[2]=ms+K*O-i*H,s}},13667:s=>{s.exports=function(s,k,h,A){var g=h[0],ms=h[1],i=k[0]-g,K=k[1]-ms,H=Math.sin(A),O=Math.cos(A);return s[0]=g+i*O-K*H,s[1]=ms+i*H+K*O,s[2]=k[2],s}},13538:s=>{s.exports=function(s,k){return s[0]=Math.round(k[0]),s[1]=Math.round(k[1]),s[2]=Math.round(k[2]),s}},13546:s=>{s.exports=function(s,k,h){return s[0]=k[0]*h,s[1]=k[1]*h,s[2]=k[2]*h,s}},13555:s=>{s.exports=function(s,k,h,A){return s[0]=k[0]+h[0]*A,s[1]=k[1]+h[1]*A,s[2]=k[2]+h[2]*A,s}},13458:s=>{s.exports=function(s,k,h,A){return s[0]=k,s[1]=h,s[2]=A,s}},13573:(s,k,h)=>{s.exports=h(13568)},13602:(s,k,h)=>{s.exports=h(13594)},13568:s=>{s.exports=function(s,k){var h=k[0]-s[0],A=k[1]-s[1],g=k[2]-s[2];return h*h+A*A+g*g}},13594:s=>{s.exports=function(s){var k=s[0],h=s[1],A=s[2];return k*k+h*h+A*A}},13493:(s,k,h)=>{s.exports=h(13485)},13485:s=>{s.exports=function(s,k,h){return s[0]=k[0]-h[0],s[1]=k[1]-h[1],s[2]=k[2]-h[2],s}},13643:s=>{s.exports=function(s,k,h){var A=k[0],g=k[1],ms=k[2];return s[0]=A*h[0]+g*h[3]+ms*h[6],s[1]=A*h[1]+g*h[4]+ms*h[7],s[2]=A*h[2]+g*h[5]+ms*h[8],s}},13637:s=>{s.exports=function(s,k,h){var A=k[0],g=k[1],ms=k[2],i=h[3]*A+h[7]*g+h[11]*ms+h[15];return i=i||1,s[0]=(h[0]*A+h[4]*g+h[8]*ms+h[12])/i,s[1]=(h[1]*A+h[5]*g+h[9]*ms+h[13])/i,s[2]=(h[2]*A+h[6]*g+h[10]*ms+h[14])/i,s}},13650:s=>{s.exports=function(s,k,h){var A=k[0],g=k[1],ms=k[2],i=h[0],K=h[1],H=h[2],O=h[3],c=O*A+K*ms-H*g,S=O*g+H*A-i*ms,a=O*ms+i*g-K*A,r=-i*A-K*g-H*ms;return s[0]=c*O+r*-i+S*-H-a*-K,s[1]=S*O+r*-K+a*-i-c*-H,s[2]=a*O+r*-H+c*-K-S*-i,s}},14526:s=>{"use strict";s.exports=function(s){for(var k=new Array(s),h=0;h<s;++h)k[h]=h;return k}},14599:s=>{s.exports=function(s){return null!=s&&null!=s.constructor&&"function"===typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}},14812:(s,k,h)=>{"use strict";h.d(k,{b:()=>A});class A{constructor(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.qS=!1,this.MS=!1,this.TS=30,this.US=0,this.JS=!1,this.fullscreen=!1,this.XS=function(s){},this.LS=function(){},this.yS=function(){},this.gh=function(){},this.ZS=function(s){},this.onFullscreenChanged=function(s){},O((()=>{!function(s,k){s._nowObject=performance||Date,s._lastTick=0,s._renderAccum=0,s._rt=0,s._frameCB=K.bind(null,s),requestAnimationFrame(s._frameCB),k>0&&(s._intervalCB=i.bind(null,s),s._interval=setInterval(s._intervalCB,Math.max(k,1e3/s.TS/2)))}(this,k),function(s,k){if(!k)return;var h=!1,A=!1;document.addEventListener("pointerlockchange",(A=>{h=document.pointerLockElement===k,s.ZS(h)})),document.addEventListener("fullscreenchange",(h=>{A=document.fullscreenElement===k,s.onFullscreenChanged(A)})),Object.defineProperty(s,"JS",{get:()=>h,set:s=>{s&&!h?H(k):h&&!s&&function(s){s.exitPointerLock&&s.exitPointerLock()}(document)}}),Object.defineProperty(s,"fullscreen",{get:()=>A,set:s=>{s&&!A?k.requestFullscreen():A&&!s&&document.exitFullscreen()}}),k.addEventListener("click",(g=>{s.qS&&!h&&H(k),s.MS&&!A&&k.requestFullscreen()}));var g=()=>s.gh();if(window.ResizeObserver){new ResizeObserver(g).observe(k)}else window.addEventListener("resize",g)}(this,s),this.yS()}))}}var g=3,ms=20;function i(s){for(var k=1e3/s.TS,h=s._nowObject.now()+ms,A=0;s._nowObject.now()>=s._lastTick+k&&s._nowObject.now()<h&&++A<=g;)s.XS(k),s._lastTick+=k;var i=5*(k+5),K=s._nowObject.now();if(K-s._lastTick>i)for(;K>=s._lastTick+k;)s._lastTick+=k}function K(s){requestAnimationFrame(s._frameCB),i(s);var k=s._nowObject.now(),h=k-s._rt;if(s._rt=k,s.US>0){s._renderAccum+=h;var A=1e3/s.US;if(s._renderAccum<A)return;s._renderAccum=Math.min(s._renderAccum-A,A)}var g=1e3/s.TS,ms=(k-s._lastTick)/g;s.LS(h,ms,g)}function H(s){s.requestPointerLock&&s.requestPointerLock()}var O=s=>{if("loading"===document.readyState){var k=()=>{document.removeEventListener("readystatechange",k),s()};document.addEventListener("readystatechange",k)}else setTimeout(s,1)}},14519:(s,k,h)=>{var A=h(14526),g=h(14532),ms="undefined"!==typeof Float64Array;function i(s,k){return s[0]-k[0]}function K(){var s,k=this.stride,h=new Array(k.length);for(s=0;s<h.length;++s)h[s]=[Math.abs(k[s]),s];h.sort(i);var A=new Array(h.length);for(s=0;s<A.length;++s)A[s]=h[s][1];return A}function H(s,k){var h=["View",k,"d",s].join("");k<0&&(h="View_Nil"+s);var g="generic"===s;if(-1===k){var ms="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+s+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(ms)()}if(0===k){ms="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+s+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",ms)(O[s][0])}ms=["'use strict'"];var i=A(k),H=i.map((function(s){return"i"+s})),c="this.offset+"+i.map((function(s){return"this.stride["+s+"]*i"+s})).join("+"),S=i.map((function(s){return"b"+s})).join(","),a=i.map((function(s){return"c"+s})).join(",");ms.push("function "+h+"(a,"+S+","+a+",d){this.data=a","this.shape=["+S+"]","this.stride=["+a+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+s+"'","proto.dimension="+k),ms.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+i.map((function(s){return"this.shape["+s+"]"})).join("*"),"}})"),1===k?ms.push("proto.order=[0]"):(ms.push("Object.defineProperty(proto,'order',{get:"),k<4?(ms.push("function "+h+"_order(){"),2===k?ms.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===k&&ms.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):ms.push("ORDER})")),ms.push("proto.set=function "+h+"_set("+H.join(",")+",v){"),g?ms.push("return this.data.set("+c+",v)}"):ms.push("return this.data["+c+"]=v}"),ms.push("proto.get=function "+h+"_get("+H.join(",")+"){"),g?ms.push("return this.data.get("+c+")}"):ms.push("return this.data["+c+"]}"),ms.push("proto.index=function "+h+"_index(",H.join(),"){return "+c+"}"),ms.push("proto.hi=function "+h+"_hi("+H.join(",")+"){return new "+h+"(this.data,"+i.map((function(s){return["(typeof i",s,"!=='number'||i",s,"<0)?this.shape[",s,"]:i",s,"|0"].join("")})).join(",")+","+i.map((function(s){return"this.stride["+s+"]"})).join(",")+",this.offset)}");var r=i.map((function(s){return"a"+s+"=this.shape["+s+"]"})),d=i.map((function(s){return"c"+s+"=this.stride["+s+"]"}));ms.push("proto.lo=function "+h+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+r.join(",")+","+d.join(","));for(var E=0;E<k;++E)ms.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");ms.push("return new "+h+"(this.data,"+i.map((function(s){return"a"+s})).join(",")+","+i.map((function(s){return"c"+s})).join(",")+",b)}"),ms.push("proto.step=function "+h+"_step("+H.join(",")+"){var "+i.map((function(s){return"a"+s+"=this.shape["+s+"]"})).join(",")+","+i.map((function(s){return"b"+s+"=this.stride["+s+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<k;++E)ms.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");ms.push("return new "+h+"(this.data,"+i.map((function(s){return"a"+s})).join(",")+","+i.map((function(s){return"b"+s})).join(",")+",c)}");var j=new Array(k),P=new Array(k);for(E=0;E<k;++E)j[E]="a[i"+E+"]",P[E]="b[i"+E+"]";ms.push("proto.transpose=function "+h+"_transpose("+H+"){"+H.map((function(s,k){return s+"=("+s+"===undefined?"+k+":"+s+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+j.join(",")+","+P.join(",")+",this.offset)}"),ms.push("proto.pick=function "+h+"_pick("+H+"){var a=[],b=[],c=this.offset");for(E=0;E<k;++E)ms.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return ms.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),ms.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+i.map((function(s){return"shape["+s+"]"})).join(",")+","+i.map((function(s){return"stride["+s+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",ms.join("\n"))(O[s],K)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};s.exports=function(s,k,h,A){if(void 0===s)return(0,O.array[0])([]);"number"===typeof s&&(s=[s]),void 0===k&&(k=[s.length]);var i=k.length;if(void 0===h){h=new Array(i);for(var K=i-1,c=1;K>=0;--K)h[K]=c,c*=k[K]}if(void 0===A){A=0;for(K=0;K<i;++K)h[K]<0&&(A-=(k[K]-1)*h[K])}for(var S=function(s){if(g(s))return"buffer";if(ms)switch(Object.prototype.toString.call(s)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(s)?"array":"generic"}(s),a=O[S];a.length<=i+1;)a.push(H(S,a.length-1));return(0,a[i+1])(s,k,h,A)}},14532:s=>{function k(s){return!!s.constructor&&"function"===typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}s.exports=function(s){return null!=s&&(k(s)||function(s){return"function"===typeof s.readFloatLE&&"function"===typeof s.slice&&k(s.slice(0,0))}(s)||!!s._isBuffer)}},14684:s=>{"use strict";var k=[],h=[],A=[],g=[],ms=[],i=[],K=[],H=[],O=[],c=[],S=[],a=[];s.exports=function(s,r,d,E,j,P){for(var R=K,D=O,w=c,B=a,u=0;u<3;u++)R[u]=+d[u],w[u]=+r.max[u],D[u]=+r.base[u];P||(P=1e-10);var G=function(s,K,O,c,a,r){var d=k,E=h,j=A,P=g,R=ms,D=i,w=H,B=Math.floor,u=0,G=0,Q=0,p=0,I=0;if(N(),0===Q)return 0;for(p=z();G<=Q;){if(b(p)&&t())return u;p=z()}for(u+=Q,I=0;I<3;I++)c[I]+=O[I],a[I]+=O[I];return u;function N(){if(G=0,0!==(Q=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2])))for(var s=0;s<3;s++){var k=O[s]>=0;P[s]=k?1:-1;var h=k?a[s]:c[s];d[s]=k?c[s]:a[s],E[s]=C(h,P[s]),j[s]=v(d[s],P[s]),w[s]=O[s]/Q,R[s]=Math.abs(1/w[s]);var A=k?E[s]+1-h:h-E[s];D[s]=R[s]<1/0?R[s]*A:1/0}}function b(k){for(var h=P[0],A=0===k?E[0]:j[0],g=E[0]+h,ms=P[1],i=1===k?E[1]:j[1],K=E[1]+ms,H=P[2],O=2===k?E[2]:j[2],c=E[2]+H,S=A;S!=g;S+=h)for(var a=i;a!=K;a+=ms)for(var r=O;r!=c;r+=H)if(s(S,a,r))return!0;return!1}function t(){u+=G;var s=P[p],k=G/Q,h=S;for(I=0;I<3;I++){var A=O[I]*k;c[I]+=A,a[I]+=A,h[I]=O[I]-A}if(s>0?a[p]=Math.round(a[p]):c[p]=Math.round(c[p]),K(u,p,s,h))return!0;for(I=0;I<3;I++)O[I]=h[I];return N(),0===Q}function z(){var s=D[0]<D[1]?D[0]<D[2]?0:2:D[1]<D[2]?1:2,k=D[s]-G;for(G=D[s],E[s]+=P[s],D[s]+=R[s],I=0;I<3;I++)d[I]+=k*w[I],j[I]=v(d[I],P[I]);return s}function C(s,k){return B(s-k*r)}function v(s,k){return B(s+k*r)}}(s,E,R,D,w,P);if(!j){for(u=0;u<3;u++)B[u]=d[u]>0?w[u]-r.max[u]:D[u]-r.base[u];r.translate(B)}return G}},14852:(s,k,h)=>{"use strict";h.d(k,{c:()=>S});var A=h(14678),g=h(13421);class ms{constructor(s,k,h,ms,i,K,H){this.yO=new A(s.base,s.Wc),this.IA=k,this.friction=h,this.restitution=ms,this.GK=i,this.td=K,this.QK=!!H,this.xc=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.bE=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.wO=g.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=g.create(),this._impulses=g.create(),this._sleepFrameCount=10}loadFromCopy(s){g.j(this.yO.base,s.yO.base),g.j(this.yO.Wc,s.yO.Wc),g.j(this.yO.max,s.yO.max),this.yO.mag=s.yO.mag,this.IA=s.IA,this.friction=s.friction,this.restitution=s.restitution,this.GK=s.GK,this.td=s.td,this.QK=s.QK,this.xc=s.xc,this.fluidDrag=s.fluidDrag,this.bE=s.bE,this.preventFallOffEdge=s.preventFallOffEdge,this.rolledBackLastTick=s.rolledBackLastTick,g.j(this.wO,s.wO),g.j(this.resting,s.resting),this.inFluid=s.inFluid,this._ratioInFluid=s._ratioInFluid,g.j(this._forces,s._forces),g.j(this._impulses,s._impulses),this._sleepFrameCount=s._sleepFrameCount}setPosition(s){i(s),g.Rk(s,s,this.yO.base),this.yO.translate(s),this.GO()}Kh(){return g.clone(this.yO.base)}applyForce(s){i(s),g.add(this._forces,this._forces,s),this.GO()}applyImpulse(s){i(s),g.add(this._impulses,this._impulses,s),this.GO()}GO(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var i=s=>{};var K=h(14678),H=h(13421),O=h(14684);function c(){this.xc=.1,this.fluidDrag=.4,this.tK=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function S(s,k,h){s=Object.assign(new c,s),this.gravity=s.gravity||[0,-10,0],this.xc=s.xc||.1,this.tK=s.tK||2,this.fluidDrag=s.fluidDrag||.4,this.minBounceImpulse=s.minBounceImpulse,this.bodies=[],this.nr=s.nr,this.testSolid=k,this.testFluid=h}S.prototype.yd=function(s,k,h,A,g,i){s=s||new K([0,0,0],[1,1,1]),"undefined"==typeof k&&(k=1),"undefined"==typeof h&&(h=1),"undefined"==typeof A&&(A=0),"undefined"==typeof g&&(g=1);var H=new ms(s,k,h,A,g,i);return this.bodies.push(H),H},S.prototype.od=function(s){var k=this.bodies.indexOf(s);k<0||(this.bodies.splice(k,1),s.yO=s.td=null)};var a=H.create(),r=H.create(),d=H.create(),E=H.create(),j=H.create(),P=H.create(),R=H.create(),D=new K([0,0,0],[1,1,1]),w=new ms(D,1,1,0,1,(()=>{}),!1);function B(s,k,h){return k=h,k*=1-(1-s.ratioInFluid)**2}S.prototype.ZK=function(s){s/=1e3;var k=q(0,H.squaredLength(this.gravity));this.bodies.forEach((h=>function(s,k,h,A){H.j(j,k.resting),s.nr&&w.loadFromCopy(k);if(k.IA<=0)return H.set(k.wO,0,0,0),H.set(k._forces,0,0,0),void H.set(k._impulses,0,0,0);var g=A||0===k.GK;if(function(s,k,h,A){if(k._sleepFrameCount>0)return!1;if(A)return!0;var g=!1,ms=.5*h*h*k.GK;return H.scale(U,s.gravity,ms),O(s.testSolid,k.yO,U,(function(){return g=!0,!0}),!0),g}(s,k,h,g))return;k._sleepFrameCount--,function(s,k){var h=k.yO,A=Math.floor(h.base[0]),g=Math.floor(h.base[2]),ms=Math.floor(h.base[1]),i=Math.floor(h.max[1]);if(!s.testFluid(A,ms,g))return k.inFluid=!1,void(k.ratioInFluid=0);var K=1,O=ms+1;for(;O<=i&&s.testFluid(A,O,g);)K++,O++;var c=(ms+K-h.base[1])/h.Wc[1];c>1&&(c=1);var S=h.Wc[0]*h.Wc[1]*h.Wc[2]*c,a=G;H.scale(a,s.gravity,-s.tK*S*k.GK),k.applyForce(a),k.inFluid=!0,k.ratioInFluid=c}(s,k),V(k._forces),V(k._impulses),V(k.wO),V(k.resting),H.scale(a,k._forces,1/k.IA),H.nK(a,a,s.gravity,k.GK),H.scale(r,k._impulses,1/k.IA),H.nK(r,r,a,h),H.add(k.wO,k.wO,r),k.friction&&(Q(s,0,k,r,h),Q(s,1,k,r,h),Q(s,2,k,r,h));var ms=k.fluidDrag>=0?k.fluidDrag:s.fluidDrag,i=k.xc>=0?k.xc:s.xc,K=i,c=i;k.inFluid&&(K=B(k,K,k.fluidDragHoriz>=0?k.fluidDragHoriz:ms),c=B(k,c,k.fluidDragVert>=0?k.fluidDragVert:ms));K=Math.max(1-K*h/k.IA,0),c=Math.max(1-c*h/k.IA,0),H.set(u,K,c,K),H.multiply(k.wO,k.wO,u),H.scale(d,k.wO,h),H.set(k._forces,0,0,0),H.set(k._impulses,0,0,0),k.QK&&M(N,k.yO);H.j(P,d),H.set(R,0,0,0),k.preventFallOffEdge&&function(s,k,h,A){if(!k.resting[1]||h[1]>0)return;var g=Y;M(g,k.yO);for(var ms=0;ms<3;ms+=2){H.set(v,0,0,0),v[ms]=h[ms];var i=!0;(i=(i=(i=(i=i&&!T(s,g.base[0]+v[0]+1e-5,g.base[1],g.base[2]+v[2]+1e-5))&&!T(s,g.max[0]+v[0]-1e-5,g.base[1],g.base[2]+v[2]+1e-5))&&!T(s,g.base[0]+v[0]+1e-5,g.base[1],g.max[2]+v[2]-1e-5))&&!T(s,g.max[0]+v[0]-1e-5,g.base[1],g.max[2]+v[2]-1e-5))?(A[ms]=h[ms]>0?1:-1,h[ms]=0):0===ms&&(H.set(n,h[0],0,0),I(s,g,n,A,k.slideOnCollision))}}(s,k,d,R);I(s,k.yO,d,k.resting,k.slideOnCollision),k.QK&&function(s,k,h,A){if(k.resting[1]>=0&&!k.inFluid)return;var g=0!==k.resting[0],ms=0!==k.resting[2];if(!g&&!ms)return;var i=Math.abs(A[0]/A[2]),K=4;if(!g&&i>K)return;if(!ms&&i<1/K)return;H.add(t,h.base,A);var c=s.testSolid;O(c,h,A,(function(s,k,h,A){if(1!==k)return!0;A[k]=0}));var S=h.base[1],a=k.inFluid?1.951:1.001,r=Math.floor(S+a)-S;H.set(z,0,r,0);var d=!1;if(O(c,h,z,(function(s,k,h,A){return d=!0,!0})),d)return;H.Rk(C,t,h.base),C[1]=0,I(s,h,C,b,!0);var E=q(h.base[0],t[0]),j=q(h.base[2],t[2]);if(g&&!E&&(!j||!ms))return;if(ms&&(!E||!g)&&!j)return;var P=!0;if(P=P&&!T(s,h.base[0]+1e-5,h.base[1],h.base[2]+1e-5),P=P&&!T(s,h.max[0]-1e-5,h.base[1],h.base[2]+1e-5),P=P&&!T(s,h.base[0]+1e-5,h.base[1],h.max[2]-1e-5),P=P&&!T(s,h.max[0]-1e-5,h.base[1],h.max[2]-1e-5),P)return;M(k.yO,h),k.resting[0]=b[0],k.resting[2]=b[2],k.bE&&k.bE()}(s,k,N,P);for(var S=0;S<3;++S)k.resting[S]=k.resting[S]||R[S],E[S]=0,k.resting[S]&&(j[S]||(E[S]=-k.wO[S]),k.wO[S]=0);var D=H.length(E);D>.001&&(H.scale(E,E,k.IA),k.td&&k.td(E),k.restitution>0&&D>s.minBounceImpulse&&(H.scale(E,E,k.restitution),k.applyImpulse(E)));var p=H.squaredLength(k.wO);p>1e-5&&k.GO();s.nr&&s.nr(k)?(k.loadFromCopy(w),k.rolledBackLastTick=!0):k.rolledBackLastTick=!1}(this,h,s,k)))};var u=H.create([0,0,0]);var G=H.create();function Q(s,k,h,A,g){var ms=h.resting[k],i=A[k];if(!h.alwaysApplyHorizFriction||1!==k){if(0===ms)return;if(ms*i<=0)return}H.j(p,h.wO),p[k]=0;var K=H.length(p);if(!q(K,0)){var O=Math.abs(h.friction*s.gravity[k]*g),c=K>O?(K-O)/K:0;h.wO[(k+1)%3]*=c,h.wO[(k+2)%3]*=c}}var p=H.create();function I(s,k,h,A,g){return H.set(A,0,0,0),O(s.testSolid,k,h,(function(s,k,h,ms){A[k]=h,ms[k]=0,g||(ms[0]=0,ms[1]=0,ms[2]=0)}))}var N=new K([],[]),b=H.create(),t=H.create(),z=H.create(),C=H.create();var v=H.create(),Y=new K([],[]),n=H.create();function T(s,k,h,A){return s.testSolid(Math.floor(k),Math.floor(h-1),Math.floor(A))}var U=H.create();function q(s,k){return Math.abs(s-k)<1e-5}function M(s,k){for(var h=0;h<3;h++)s.base[h]=k.base[h],s.max[h]=k.max[h],s.Wc[h]=k.Wc[h]}var V=function(s){}},13285:function(s,k){!function(s){"use strict";var k=function(s,h){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,k){s.__proto__=k}||function(s,k){for(var h in k)Object.prototype.hasOwnProperty.call(k,h)&&(s[h]=k[h])},k(s,h)};function h(s,h){if("function"!==typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function A(){this.constructor=s}k(s,h),s.prototype=null===h?Object.create(h):(A.prototype=h.prototype,new A)}function A(s,k,h,A){var g,ms=arguments.length,i=ms<3?k:null===A?A=Object.getOwnPropertyDescriptor(k,h):A;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(s,k,h,A);else for(var K=s.length-1;K>=0;K--)(g=s[K])&&(i=(ms<3?g(i):ms>3?g(k,h,i):g(k,h))||i);return ms>3&&i&&Object.defineProperty(k,h,i),i}function g(s,k,h){if(h||2===arguments.length)for(var A,g=0,ms=k.length;g<ms;g++)!A&&g in k||(A||(A=Array.prototype.slice.call(k,0,g)),A[g]=k[g]);return s.concat(A||Array.prototype.slice.call(k))}var ms,i=255,K=213;s.OPERATION=void 0,(ms=s.OPERATION||(s.OPERATION={}))[ms.ADD=128]="ADD",ms[ms.REPLACE=0]="REPLACE",ms[ms.DELETE=64]="DELETE",ms[ms.DELETE_AND_ADD=192]="DELETE_AND_ADD",ms[ms.TOUCH=1]="TOUCH",ms[ms.CLEAR=10]="CLEAR";var H=function(){function k(s,k,h){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=s,this.setParent(k,h)}return k.prototype.setParent=function(s,k,h){var A=this;if(this.indexes||(this.indexes=this.ref instanceof Cs?this.ref._definition.indexes:{}),this.parent=s,this.parentIndex=h,k)if(this.root=k,this.ref instanceof Cs){var g=this.ref._definition;for(var ms in g.schema){var i=this.ref[ms];if(i&&i.$changes){var K=g.indexes[ms];i.$changes.setParent(this.ref,k,K)}}}else"object"===typeof this.ref&&this.ref.forEach((function(s,k){if(s instanceof Cs){var h=s.$changes,g=A.ref.$changes.indexes[k];h.setParent(A.ref,A.root,g)}}))},k.prototype.operation=function(s){this.changes.set(--this.currentCustomOperation,s)},k.prototype.change=function(k,h){void 0===h&&(h=s.OPERATION.ADD);var A="number"===typeof k?k:this.indexes[k];this.assertValidIndex(A,k);var g=this.changes.get(A);g&&g.op!==s.OPERATION.DELETE&&g.op!==s.OPERATION.TOUCH||this.changes.set(A,{op:g&&g.op===s.OPERATION.DELETE?s.OPERATION.DELETE_AND_ADD:h,index:A}),this.allChanges.add(A),this.changed=!0,this.touchParents()},k.prototype.touch=function(k){var h="number"===typeof k?k:this.indexes[k];this.assertValidIndex(h,k),this.changes.has(h)||this.changes.set(h,{op:s.OPERATION.TOUCH,index:h}),this.allChanges.add(h),this.touchParents()},k.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},k.prototype.getType=function(s){if(this.ref._definition)return(k=this.ref._definition).schema[k.fieldsByIndex[s]];var k,h=(k=this.parent._definition).schema[k.fieldsByIndex[this.parentIndex]];return Object.values(h)[0]},k.prototype.getChildrenFilter=function(){var s=this.parent._definition.childFilters;return s&&s[this.parentIndex]},k.prototype.getValue=function(s){return this.ref.getByIndex(s)},k.prototype.delete=function(k){var h="number"===typeof k?k:this.indexes[k];if(void 0!==h){var A=this.getValue(h);this.changes.set(h,{op:s.OPERATION.DELETE,index:h}),this.allChanges.delete(h),delete this.caches[h],A&&A.$changes&&(A.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(k," (").concat(h,")"))},k.prototype.discard=function(k,h){var A=this;void 0===k&&(k=!1),void 0===h&&(h=!1),this.ref instanceof Cs||this.changes.forEach((function(k){if(k.op===s.OPERATION.DELETE){var h=A.ref.getIndex(k.index);delete A.indexes[h]}})),this.changes.clear(),this.changed=k,h&&this.allChanges.clear(),this.currentCustomOperation=0},k.prototype.discardAll=function(){var s=this;this.changes.forEach((function(k){var h=s.getValue(k.index);h&&h.$changes&&h.$changes.discardAll()})),this.discard()},k.prototype.cache=function(s,k){this.caches[s]=k},k.prototype.clone=function(){return new k(this.ref,this.parent,this.root)},k.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},k.prototype.assertValidIndex=function(s,k){if(void 0===s)throw new Error('ChangeTree: missing index for field "'.concat(k,'"'))},k}();function O(s,k,h,A){return s[k]||(s[k]=[]),s[k].push(h),null===A||void 0===A||A.forEach((function(s,k){return h(s,k)})),function(){return S(s[k],s[k].indexOf(h))}}function c(k){var h=this,A="string"!==typeof this.$changes.getType();this.$items.forEach((function(g,ms){k.push({refId:h.$changes.refId,op:s.OPERATION.DELETE,field:ms,value:void 0,previousValue:g}),A&&h.$changes.root.removeRef(g.$changes.refId)}))}function S(s,k){if(-1===k||k>=s.length)return!1;for(var h=s.length-1,A=k;A<h;A++)s[A]=s[A+1];return s.length=h,!0}var a=function(s,k){var h=s.toString(),A=k.toString();return h<A?-1:h>A?1:0};function r(s){return s.$proxy=!0,s=new Proxy(s,{get:function(s,k){return"symbol"===typeof k||isNaN(k)?s[k]:s.at(k)},set:function(s,k,h){if("symbol"===typeof k||isNaN(k))s[k]=h;else{var A=Array.from(s.$items.keys()),g=parseInt(A[k]||k);void 0===h||null===h?s.deleteAt(g):s.setAt(g,h)}return!0},deleteProperty:function(s,k){return"number"===typeof k?s.deleteAt(k):delete s[k],!0}})}var d=function(){function k(){for(var s=[],k=0;k<arguments.length;k++)s[k]=arguments[k];this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,s)}return k.prototype.yK=function(k,h){return void 0===h&&(h=!0),O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,k,h?this.$items:void 0)},k.prototype.kh=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,k)},k.is=function(s){return Array.isArray(s)||void 0!==s.array},Object.defineProperty(k.prototype,"length",{get:function(){return this.$items.size},set:function(s){0===s?this.clear():this.splice(s,this.length-s)},enumerable:!1,configurable:!0}),k.prototype.push=function(){for(var s,k=this,h=[],A=0;A<arguments.length;A++)h[A]=arguments[A];return h.forEach((function(h){s=k.$refId++,k.setAt(s,h)})),s},k.prototype.pop=function(){var s=Array.from(this.$indexes.values()).pop();if(void 0!==s){this.$changes.delete(s),this.$indexes.delete(s);var k=this.$items.get(s);return this.$items.delete(s),k}},k.prototype.at=function(s){var k=Array.from(this.$items.keys())[s];return this.$items.get(k)},k.prototype.setAt=function(k,h){var A,g;if(void 0!==h&&null!==h){if(this.$items.get(k)!==h){void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,k);var ms=null!==(g=null===(A=this.$changes.indexes[k])||void 0===A?void 0:A.op)&&void 0!==g?g:s.OPERATION.ADD;this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,h),this.$changes.change(k,ms)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},k.prototype.deleteAt=function(s){var k=Array.from(this.$items.keys())[s];return void 0!==k&&this.$deleteAt(k)},k.prototype.$deleteAt=function(s){return this.$changes.delete(s),this.$indexes.delete(s),this.$items.delete(s)},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&c.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.concat=function(){for(var s,h=[],A=0;A<arguments.length;A++)h[A]=arguments[A];return new(k.bind.apply(k,g([void 0],(s=Array.from(this.$items.values())).concat.apply(s,h),!1)))},k.prototype.join=function(s){return Array.from(this.$items.values()).join(s)},k.prototype.reverse=function(){var s=this,k=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(h,A){s.setAt(k[A],h)})),this},k.prototype.shift=function(){var s=Array.from(this.$items.keys()).shift();if(void 0!==s){var k=this.$items.get(s);return this.$deleteAt(s),k}},k.prototype.slice=function(s,h){var A=new k;return A.push.apply(A,Array.from(this.$items.values()).slice(s,h)),A},k.prototype.sort=function(s){var k=this;void 0===s&&(s=a);var h=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(s).forEach((function(s,A){k.setAt(h[A],s)})),this},k.prototype.splice=function(s,k){void 0===k&&(k=this.length-s);for(var h=Array.from(this.$items.keys()),A=[],g=s;g<s+k;g++)A.push(this.$items.get(h[g])),this.$deleteAt(h[g]);return A},k.prototype.unshift=function(){for(var s=this,k=[],h=0;h<arguments.length;h++)k[h]=arguments[h];var A=this.length,g=k.length,ms=Array.from(this.$items.values());return k.forEach((function(k,h){s.setAt(h,k)})),ms.forEach((function(k,h){s.setAt(g+h,k)})),A+g},k.prototype.indexOf=function(s,k){return Array.from(this.$items.values()).indexOf(s,k)},k.prototype.lastIndexOf=function(s,k){return void 0===k&&(k=this.length-1),Array.from(this.$items.values()).lastIndexOf(s,k)},k.prototype.every=function(s,k){return Array.from(this.$items.values()).every(s,k)},k.prototype.some=function(s,k){return Array.from(this.$items.values()).some(s,k)},k.prototype.forEach=function(s,k){Array.from(this.$items.values()).forEach(s,k)},k.prototype.map=function(s,k){return Array.from(this.$items.values()).map(s,k)},k.prototype.filter=function(s,k){return Array.from(this.$items.values()).filter(s,k)},k.prototype.reduce=function(s,k){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},k.prototype.reduceRight=function(s,k){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},k.prototype.find=function(s,k){return Array.from(this.$items.values()).find(s,k)},k.prototype.findIndex=function(s,k){return Array.from(this.$items.values()).findIndex(s,k)},k.prototype.fill=function(s,k,h){throw new Error("ArraySchema#fill() not implemented")},k.prototype.copyWithin=function(s,k,h){throw new Error("ArraySchema#copyWithin() not implemented")},k.prototype.toString=function(){return this.$items.toString()},k.prototype.toLocaleString=function(){return this.$items.toLocaleString()},k.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(k,Symbol.species,{get:function(){return k},enumerable:!1,configurable:!0}),k.prototype.entries=function(){return this.$items.entries()},k.prototype.keys=function(){return this.$items.keys()},k.prototype.values=function(){return this.$items.values()},k.prototype.includes=function(s,k){return Array.from(this.$items.values()).includes(s,k)},k.prototype.flatMap=function(s,k){throw new Error("ArraySchema#flatMap() is not supported.")},k.prototype.flat=function(s){throw new Error("ArraySchema#flat() is not supported.")},k.prototype.findLast=function(){var s=Array.from(this.$items.values());return s.findLast.apply(s,arguments)},k.prototype.findLastIndex=function(){var s=Array.from(this.$items.values());return s.findLastIndex.apply(s,arguments)},k.prototype.setIndex=function(s,k){this.$indexes.set(s,k)},k.prototype.getIndex=function(s){return this.$indexes.get(s)},k.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},k.prototype.deleteByIndex=function(s){var k=this.$indexes.get(s);this.$items.delete(k),this.$indexes.delete(s)},k.prototype.toArray=function(){return Array.from(this.$items.values())},k.prototype.toJSON=function(){return this.toArray().map((function(s){return"function"===typeof s.toJSON?s.toJSON():s}))},k.prototype.clone=function(s){return s?new(k.bind.apply(k,g([void 0],Array.from(this.$items.values()),!1))):new(k.bind.apply(k,g([void 0],this.map((function(s){return s.$changes?s.clone():s})),!1)))},k}();function E(s){return s.$proxy=!0,s=new Proxy(s,{get:function(s,k){return"symbol"!==typeof k&&"undefined"===typeof s[k]?s.get(k):s[k]},set:function(s,k,h){return"symbol"!==typeof k&&-1===k.indexOf("$")&&"yK"!==k&&"kh"!==k&&"onChange"!==k?s.set(k,h):s[k]=h,!0},deleteProperty:function(s,k){return s.delete(k),!0}})}var j=function(){function k(s){var h=this;if(this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,s)if(s instanceof Map||s instanceof k)s.forEach((function(s,k){return h.set(k,s)}));else for(var A in s)this.set(A,s[A])}return k.prototype.yK=function(k,h){return void 0===h&&(h=!0),O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,k,h?this.$items:void 0)},k.prototype.kh=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,k)},k.is=function(s){return void 0!==s.map},k.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(k.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(k,Symbol.species,{get:function(){return k},enumerable:!1,configurable:!0}),k.prototype.set=function(k,h){if(void 0===h||null===h)throw new Error("MapSchema#set('".concat(k,"', ").concat(h,"): trying to set ").concat(h," value on '").concat(k,"'."));k=k.toString();var A="undefined"!==typeof this.$changes.indexes[k],g=A?this.$changes.indexes[k]:this.$refId++,ms=A?s.OPERATION.REPLACE:s.OPERATION.ADD,i=void 0!==h.$changes;if(i&&h.$changes.setParent(this,this.$changes.root,g),A){if(!i&&this.$items.get(k)===h)return;i&&this.$items.get(k)!==h&&(ms=s.OPERATION.ADD)}else this.$changes.indexes[k]=g,this.$indexes.set(g,k);return this.$items.set(k,h),this.$changes.change(k,ms),this},k.prototype.get=function(s){return this.$items.get(s)},k.prototype.delete=function(s){return this.$changes.delete(s),this.$items.delete(s)},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&c.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.has=function(s){return this.$items.has(s)},k.prototype.forEach=function(s){this.$items.forEach(s)},k.prototype.entries=function(){return this.$items.entries()},k.prototype.keys=function(){return this.$items.keys()},k.prototype.values=function(){return this.$items.values()},Object.defineProperty(k.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),k.prototype.setIndex=function(s,k){this.$indexes.set(s,k)},k.prototype.getIndex=function(s){return this.$indexes.get(s)},k.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},k.prototype.deleteByIndex=function(s){var k=this.$indexes.get(s);this.$items.delete(k),this.$indexes.delete(s)},k.prototype.toJSON=function(){var s={};return this.forEach((function(k,h){s[h]="function"===typeof k.toJSON?k.toJSON():k})),s},k.prototype.clone=function(s){var h;return s?h=Object.assign(new k,this):(h=new k,this.forEach((function(s,k){s.$changes?h.set(k,s.clone()):h.set(k,s)}))),h},k}(),P={};function R(s,k){P[s]=k}function D(s){return P[s]}var w=function(){function s(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return s.create=function(k){var h=new s;return h.schema=Object.assign({},k&&k.schema||{}),h.indexes=Object.assign({},k&&k.indexes||{}),h.fieldsByIndex=Object.assign({},k&&k.fieldsByIndex||{}),h.descriptors=Object.assign({},k&&k.descriptors||{}),h.deprecated=Object.assign({},k&&k.deprecated||{}),h},s.prototype.addField=function(s,k){var h=this.getNextFieldIndex();this.fieldsByIndex[h]=s,this.indexes[s]=h,this.schema[s]=Array.isArray(k)?{array:k[0]}:k},s.prototype.hasField=function(s){return void 0!==this.indexes[s]},s.prototype.addFilter=function(s,k){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[s]]=k,this.indexesWithFilters.push(this.indexes[s]),!0},s.prototype.addChildrenFilter=function(s,k){var h=this.indexes[s],A=this.schema[s];if(D(Object.keys(A)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[h]=k,!0;console.warn("@filterChildren: field '".concat(s,"' can't have children. Ignoring filter."))},s.prototype.getChildrenFilter=function(s){return this.childFilters&&this.childFilters[this.indexes[s]]},s.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},s}();function B(s){return s._context&&s._context.useFilters}var u=function(){function s(){this.types={},this.schemas=new Map,this.useFilters=!1}return s.prototype.has=function(s){return this.schemas.has(s)},s.prototype.get=function(s){return this.types[s]},s.prototype.add=function(s,k){void 0===k&&(k=this.schemas.size),s._definition=w.create(s._definition),s._typeid=k,this.types[k]=s,this.schemas.set(s,k)},s.create=function(k){return void 0===k&&(k={}),function(h){return k.context||(k.context=new s),Q(h,k)}},s}(),G=new u;function Q(s,k){return void 0===k&&(k={}),function(h,A){var ms=k.context||G,i=h.constructor;if(i._context=ms,!s)throw new Error("".concat(i.name,': @type() reference provided for "').concat(A,"\" is undefined. Make sure you don't have any circular dependencies."));ms.has(i)||ms.add(i);var K=i._definition;if(K.addField(A,s),K.descriptors[A]){if(K.deprecated[A])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(A,"' definition on '").concat(i.name,"'.\nCheck @type() annotation"))}catch(P){var H=P.stack.split("\n")[4].trim();throw new Error("".concat(P.message," ").concat(H))}}var O=d.is(s),c=!O&&j.is(s);if("string"!==typeof s&&!Cs.is(s)){var S=Object.values(s)[0];"string"===typeof S||ms.has(S)||ms.add(S)}if(k.manual)K.descriptors[A]={enumerable:!0,configurable:!0,writable:!0};else{var a="_".concat(A);K.descriptors[a]={enumerable:!1,configurable:!1,writable:!0},K.descriptors[A]={get:function(){return this[a]},set:function(s){s!==this[a]&&(void 0!==s&&null!==s?(!O||s instanceof d||(s=new(d.bind.apply(d,g([void 0],s,!1)))),!c||s instanceof j||(s=new j(s)),void 0===s.$proxy&&(c?s=E(s):O&&(s=r(s))),this.$changes.change(A),s.$changes&&s.$changes.setParent(this,this.$changes.root,this._definition.indexes[A])):this[a]&&this.$changes.delete(A),this[a]=s)},enumerable:!0,configurable:!0}}}}function p(s){return function(k,h){var A=k.constructor;A._definition.addFilter(h,s)&&(A._context.useFilters=!0)}}function I(s){return function(k,h){var A=k.constructor;A._definition.addChildrenFilter(h,s)&&(A._context.useFilters=!0)}}function N(s){return void 0===s&&(s=!0),function(k,h){var A=k.constructor._definition;A.deprecated[h]=!0,s&&(A.descriptors[h]={get:function(){throw new Error("".concat(h," is deprecated."))},set:function(s){},enumerable:!1,configurable:!0})}}function b(s,k,h){for(var A in void 0===h&&(h={}),h.context||(h.context=s._context||h.context||G),k)Q(k[A],h)(s.prototype,A);return s}function t(s){for(var k=0,h=0,A=0,g=s.length;A<g;A++)(k=s.charCodeAt(A))<128?h+=1:k<2048?h+=2:k<55296||k>=57344?h+=3:(A++,h+=4);return h}function z(s,k,h){for(var A=0,g=0,ms=h.length;g<ms;g++)(A=h.charCodeAt(g))<128?s[k++]=A:A<2048?(s[k++]=192|A>>6,s[k++]=128|63&A):A<55296||A>=57344?(s[k++]=224|A>>12,s[k++]=128|A>>6&63,s[k++]=128|63&A):(g++,A=65536+((1023&A)<<10|1023&h.charCodeAt(g)),s[k++]=240|A>>18,s[k++]=128|A>>12&63,s[k++]=128|A>>6&63,s[k++]=128|63&A)}function C(s,k){s.push(255&k)}function v(s,k){s.push(255&k)}function Y(s,k){s.push(255&k),s.push(k>>8&255)}function n(s,k){s.push(255&k),s.push(k>>8&255)}function T(s,k){s.push(255&k),s.push(k>>8&255),s.push(k>>16&255),s.push(k>>24&255)}function U(s,k){var h=k>>24,A=k>>16,g=k>>8,ms=k;s.push(255&ms),s.push(255&g),s.push(255&A),s.push(255&h)}function q(s,k){var h=Math.floor(k/Math.pow(2,32));U(s,k>>>0),U(s,h)}function M(s,k){var h=k/Math.pow(2,32)|0;U(s,k>>>0),U(s,h)}function V(s,k){y(s,k)}function X(s,k){W(s,k)}var L=new Int32Array(2),Z=new Float32Array(L.buffer),x=new Float64Array(L.buffer);function y(s,k){Z[0]=k,T(s,L[0])}function W(s,k){x[0]=k,T(s,L[0]),T(s,L[1])}function J(s,k){return v(s,k?1:0)}function F(s,k){k||(k="");var h=t(k),A=0;if(h<32)s.push(160|h),A=1;else if(h<256)s.push(217),v(s,h),A=2;else if(h<65536)s.push(218),n(s,h),A=3;else{if(!(h<4294967296))throw new Error("String too long");s.push(219),U(s,h),A=5}return z(s,s.length,k),A+h}function o(s,k){return isNaN(k)?o(s,0):isFinite(k)?k!==(0|k)?(s.push(203),W(s,k),9):k>=0?k<128?(v(s,k),1):k<256?(s.push(204),v(s,k),2):k<65536?(s.push(205),n(s,k),3):k<4294967296?(s.push(206),U(s,k),5):(s.push(207),M(s,k),9):k>=-32?(s.push(224|k+32),1):k>=-128?(s.push(208),C(s,k),2):k>=-32768?(s.push(209),Y(s,k),3):k>=-2147483648?(s.push(210),T(s,k),5):(s.push(211),q(s,k),9):o(s,k>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var l=Object.freeze({__proto__:null,utf8Write:z,int8:C,uint8:v,int16:Y,uint16:n,int32:T,uint32:U,int64:q,uint64:M,float32:V,float64:X,writeFloat32:y,writeFloat64:W,boolean:J,string:F,number:o});function f(s,k,h){for(var A="",g=0,ms=k,i=k+h;ms<i;ms++){var K=s[ms];0!==(128&K)?192!==(224&K)?224!==(240&K)?240!==(248&K)?console.error("Invalid byte "+K.toString(16)):(g=(7&K)<<18|(63&s[++ms])<<12|(63&s[++ms])<<6|63&s[++ms])>=65536?(g-=65536,A+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):A+=String.fromCharCode(g):A+=String.fromCharCode((15&K)<<12|(63&s[++ms])<<6|63&s[++ms]):A+=String.fromCharCode((31&K)<<6|63&s[++ms]):A+=String.fromCharCode(K)}return A}function e(s,k){return ss(s,k)<<24>>24}function ss(s,k){return s[k.offset++]}function ks(s,k){return hs(s,k)<<16>>16}function hs(s,k){return s[k.offset++]|s[k.offset++]<<8}function As(s,k){return s[k.offset++]|s[k.offset++]<<8|s[k.offset++]<<16|s[k.offset++]<<24}function gs(s,k){return As(s,k)>>>0}function mk(s,k){return as(s,k)}function is(s,k){return rs(s,k)}function Ks(s,k){var h=gs(s,k);return As(s,k)*Math.pow(2,32)+h}function Hs(s,k){var h=gs(s,k);return gs(s,k)*Math.pow(2,32)+h}var Os=new Int32Array(2),cs=new Float32Array(Os.buffer),Ss=new Float64Array(Os.buffer);function as(s,k){return Os[0]=As(s,k),cs[0]}function rs(s,k){return Os[0]=As(s,k),Os[1]=As(s,k),Ss[0]}function ds(s,k){return ss(s,k)>0}function Es(s,k){var h,A=s[k.offset++];A<192?h=31&A:217===A?h=ss(s,k):218===A?h=hs(s,k):219===A&&(h=gs(s,k));var g=f(s,k.offset,h);return k.offset+=h,g}function js(s,k){var h=s[k.offset];return h<192&&h>160||217===h||218===h||219===h}function Ps(s,k){var h=s[k.offset++];return h<128?h:202===h?as(s,k):203===h?rs(s,k):204===h?ss(s,k):205===h?hs(s,k):206===h?gs(s,k):207===h?Hs(s,k):208===h?e(s,k):209===h?ks(s,k):210===h?As(s,k):211===h?Ks(s,k):h>223?-1*(255-h+1):void 0}function Rs(s,k){var h=s[k.offset];return h<128||h>=202&&h<=211}function Ds(s,k){return s[k.offset]<160}function ws(s,k){return s[k.offset-1]===i&&(s[k.offset]<128||s[k.offset]>=202&&s[k.offset]<=211)}var Bs=Object.freeze({__proto__:null,int8:e,uint8:ss,int16:ks,uint16:hs,int32:As,uint32:gs,float32:mk,float64:is,int64:Ks,uint64:Hs,readFloat32:as,readFloat64:rs,boolean:ds,string:Es,stringCheck:js,number:Ps,numberCheck:Rs,arrayCheck:Ds,switchStructureCheck:ws}),us=function(){function k(s){var k=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,s&&s.forEach((function(s){return k.add(s)}))}return k.prototype.yK=function(k,h){return void 0===h&&(h=!0),O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,k,h?this.$items:void 0)},k.prototype.kh=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,k)},k.is=function(s){return void 0!==s.collection},k.prototype.add=function(s){var k=this.$refId++;return void 0!==s.$changes&&s.$changes.setParent(this,this.$changes.root,k),this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,s),this.$changes.change(k),k},k.prototype.at=function(s){var k=Array.from(this.$items.keys())[s];return this.$items.get(k)},k.prototype.entries=function(){return this.$items.entries()},k.prototype.delete=function(s){for(var k,h,A=this.$items.entries();(h=A.next())&&!h.done;)if(s===h.value[1]){k=h.value[0];break}return void 0!==k&&(this.$changes.delete(k),this.$indexes.delete(k),this.$items.delete(k))},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&c.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.has=function(s){return Array.from(this.$items.values()).some((function(k){return k===s}))},k.prototype.forEach=function(s){var k=this;this.$items.forEach((function(h,A,g){return s(h,A,k)}))},k.prototype.values=function(){return this.$items.values()},Object.defineProperty(k.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),k.prototype.setIndex=function(s,k){this.$indexes.set(s,k)},k.prototype.getIndex=function(s){return this.$indexes.get(s)},k.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},k.prototype.deleteByIndex=function(s){var k=this.$indexes.get(s);this.$items.delete(k),this.$indexes.delete(s)},k.prototype.toArray=function(){return Array.from(this.$items.values())},k.prototype.toJSON=function(){var s=[];return this.forEach((function(k,h){s.push("function"===typeof k.toJSON?k.toJSON():k)})),s},k.prototype.clone=function(s){var h;return s?h=Object.assign(new k,this):(h=new k,this.forEach((function(s){s.$changes?h.add(s.clone()):h.add(s)}))),h},k}(),Gs=function(){function k(s){var k=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,s&&s.forEach((function(s){return k.add(s)}))}return k.prototype.yK=function(k,h){return void 0===h&&(h=!0),O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.ADD,k,h?this.$items:void 0)},k.prototype.kh=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,k)},k.is=function(s){return void 0!==s.set},k.prototype.add=function(k){var h,A;if(this.has(k))return!1;var g=this.$refId++;void 0!==k.$changes&&k.$changes.setParent(this,this.$changes.root,g);var ms=null!==(A=null===(h=this.$changes.indexes[g])||void 0===h?void 0:h.op)&&void 0!==A?A:s.OPERATION.ADD;return this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,k),this.$changes.change(g,ms),g},k.prototype.entries=function(){return this.$items.entries()},k.prototype.delete=function(s){for(var k,h,A=this.$items.entries();(h=A.next())&&!h.done;)if(s===h.value[1]){k=h.value[0];break}return void 0!==k&&(this.$changes.delete(k),this.$indexes.delete(k),this.$items.delete(k))},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&c.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:s.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.has=function(s){for(var k,h=this.$items.values(),A=!1;(k=h.next())&&!k.done;)if(s===k.value){A=!0;break}return A},k.prototype.forEach=function(s){var k=this;this.$items.forEach((function(h,A,g){return s(h,A,k)}))},k.prototype.values=function(){return this.$items.values()},Object.defineProperty(k.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),k.prototype.setIndex=function(s,k){this.$indexes.set(s,k)},k.prototype.getIndex=function(s){return this.$indexes.get(s)},k.prototype.getByIndex=function(s){return this.$items.get(this.$indexes.get(s))},k.prototype.deleteByIndex=function(s){var k=this.$indexes.get(s);this.$items.delete(k),this.$indexes.delete(s)},k.prototype.toArray=function(){return Array.from(this.$items.values())},k.prototype.toJSON=function(){var s=[];return this.forEach((function(k,h){s.push("function"===typeof k.toJSON?k.toJSON():k)})),s},k.prototype.clone=function(s){var h;return s?h=Object.assign(new k,this):(h=new k,this.forEach((function(s){s.$changes?h.add(s.clone()):h.add(s)}))),h},k}(),Qs=function(){function s(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return s.prototype.addRefId=function(s){this.refIds.has(s)||(this.refIds.add(s),this.containerIndexes.set(s,new Set))},s.get=function(k){return void 0===k.$filterState&&(k.$filterState=new s),k.$filterState},s}(),ps=function(){function s(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return s.prototype.getNextUniqueId=function(){return this.nextUniqueId++},s.prototype.addRef=function(s,k,h){void 0===h&&(h=!0),this.refs.set(s,k),h&&(this.refCounts[s]=(this.refCounts[s]||0)+1)},s.prototype.removeRef=function(s){this.refCounts[s]=this.refCounts[s]-1,this.deletedRefs.add(s)},s.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},s.prototype.garbageCollectDeletedRefs=function(){var s=this;this.deletedRefs.forEach((function(k){if(!(s.refCounts[k]>0)){var h=s.refs.get(k);if(h instanceof Cs)for(var A in h._definition.schema)"string"!==typeof h._definition.schema[A]&&h[A]&&h[A].$changes&&s.removeRef(h[A].$changes.refId);else{var g=h.$changes.parent._definition,ms=g.schema[g.fieldsByIndex[h.$changes.parentIndex]];"function"===typeof Object.values(ms)[0]&&Array.from(h.values()).forEach((function(k){return s.removeRef(k.$changes.refId)}))}s.refs.delete(k),delete s.refCounts[k]}})),this.deletedRefs.clear()},s}(),Is=function(s){function k(){return null!==s&&s.apply(this,arguments)||this}return h(k,s),k}(Error);function Ns(s,k,h,A){var g,ms=!1;switch(k){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":g="number",isNaN(s)&&console.log('trying to encode "NaN" in '.concat(h.constructor.name,"#").concat(A));break;case"string":g="string",ms=!0;break;case"boolean":return}if(typeof s!==g&&(!ms||ms&&null!==s)){var i="'".concat(JSON.stringify(s),"'").concat(s&&s.constructor&&" (".concat(s.constructor.name,")")||"");throw new Is("a '".concat(g,"' was expected, but ").concat(i," was provided in ").concat(h.constructor.name,"#").concat(A))}}function bs(s,k,h,A){if(!(s instanceof k))throw new Is("a '".concat(k.name,"' was expected, but '").concat(s.constructor.name,"' was provided in ").concat(h.constructor.name,"#").concat(A))}function ts(s,k,h,A,g){Ns(h,s,A,g);var ms=l[s];if(!ms)throw new Is("a '".concat(s,"' was expected, but ").concat(h," was provided in ").concat(A.constructor.name,"#").concat(g));ms(k,h)}function zs(s,k,h){return Bs[s](k,h)}var Cs=function(){function k(){for(var s=[],k=0;k<arguments.length;k++)s[k]=arguments[k];Object.defineProperties(this,{$changes:{value:new H(this,void 0,new ps),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var h=this._definition.descriptors;h&&Object.defineProperties(this,h),s[0]&&this.assign(s[0])}return k.onError=function(s){console.error(s)},k.is=function(s){return s._definition&&void 0!==s._definition.schema},k.prototype.onChange=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.REPLACE,k)},k.prototype.kh=function(k){return O(this.$callbacks||(this.$callbacks=[]),s.OPERATION.DELETE,k)},k.prototype.assign=function(s){return Object.assign(this,s),this},Object.defineProperty(k.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),k.prototype.setDirty=function(s,k){this.$changes.change(s,k)},k.prototype.listen=function(s,k,h){var A=this;return void 0===h&&(h=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[s]||(this.$callbacks[s]=[]),this.$callbacks[s].push(k),h&&void 0!==this[s]&&k(this[s],void 0),function(){return S(A.$callbacks[s],A.$callbacks[s].indexOf(k))}},k.prototype.decode=function(h,A,g){var ms;void 0===A&&(A={offset:0}),void 0===g&&(g=this);var K=[],H=this.$changes.root,O=h.length,c=0;for(H.refs.set(c,this);A.offset<O;){var S=h[A.offset++];if(S!=i){var a=g.$changes,r=void 0!==g._definition,E=r?S>>6<<6:S;if(E!==s.OPERATION.CLEAR){var P=r?S%(E||255):Ps(h,A),R=r?g._definition.fieldsByIndex[P]:"",w=a.getType(P),B=void 0,u=void 0,G=void 0;if(r?u=g["_".concat(R)]:(u=g.getByIndex(P),(E&s.OPERATION.ADD)===s.OPERATION.ADD?(G=g instanceof j?Es(h,A):P,g.setIndex(P,G)):G=g.getIndex(P)),(E&s.OPERATION.DELETE)===s.OPERATION.DELETE&&(E!==s.OPERATION.DELETE_AND_ADD&&g.deleteByIndex(P),u&&u.$changes&&H.removeRef(u.$changes.refId),B=null),void 0!==R){if(E===s.OPERATION.DELETE);else if(k.is(w)){var Q=Ps(h,A);if(B=H.refs.get(Q),E!==s.OPERATION.REPLACE){var p=this.getSchemaType(h,A,w);B||((B=this.createTypeInstance(p)).$changes.refId=Q,u&&(B.$callbacks=u.$callbacks,u.$changes.refId&&Q!==u.$changes.refId&&H.removeRef(u.$changes.refId))),H.addRef(Q,B,B!==u)}}else if("string"===typeof w)B=zs(w,h,A);else{var I=D(Object.keys(w)[0]),N=Ps(h,A),b=H.refs.has(N)?u||H.refs.get(N):new I.constructor;if((B=b.clone(!0)).$changes.refId=N,u&&(B.$callbacks=u.$callbacks,u.$changes.refId&&N!==u.$changes.refId)){H.removeRef(u.$changes.refId);for(var t=u.entries(),z=void 0;(z=t.next())&&!z.done;){var C=(ms=z.value)[0],v=ms[1];K.push({refId:N,op:s.OPERATION.DELETE,field:C,value:void 0,previousValue:v})}}H.addRef(N,B,b!==u)}if(null!==B&&void 0!==B)if(B.$changes&&B.$changes.setParent(a.ref,a.root,P),g instanceof k)g[R]=B;else if(g instanceof j)C=G,g.$items.set(C,B),g.$changes.allChanges.add(P);else if(g instanceof d)g.setAt(P,B);else if(g instanceof us){var Y=g.add(B);g.setIndex(P,Y)}else g instanceof Gs&&!1!==(Y=g.add(B))&&g.setIndex(P,Y);u!==B&&K.push({refId:c,op:E,field:R,dynamicIndex:G,value:B,previousValue:u})}else{console.warn("@colyseus/schema: definition mismatch");for(var n={offset:A.offset};A.offset<O&&(!ws(h,A)||(n.offset=A.offset+1,!H.refs.has(Ps(h,n))));)A.offset++}}else g.clear(K)}else{c=Ps(h,A);var T=H.refs.get(c);if(!T)throw new Error('"refId" not found: '.concat(c));g=T}}return this._triggerChanges(K),H.garbageCollectDeletedRefs(),K},k.prototype.encode=function(h,A,g){void 0===h&&(h=!1),void 0===A&&(A=[]),void 0===g&&(g=!1);for(var ms=this.$changes,K=new WeakSet,H=[ms],O=1,c=0;c<O;c++){var S=H[c],a=S.ref,r=a instanceof k;S.ensureRefId(),K.add(S),S!==ms&&(S.changed||h)&&(v(A,i),o(A,S.refId));for(var d=h?Array.from(S.allChanges):Array.from(S.changes.values()),E=0,P=d.length;E<P;E++){var R=h?{op:s.OPERATION.ADD,index:d[E]}:d[E],w=R.index,B=r?a._definition.fieldsByIndex&&a._definition.fieldsByIndex[w]:w,u=A.length;if(R.op!==s.OPERATION.TOUCH)if(r)v(A,w|R.op);else{if(v(A,R.op),R.op===s.OPERATION.CLEAR)continue;o(A,w)}if(r||(R.op&s.OPERATION.ADD)!=s.OPERATION.ADD||a instanceof j&&F(A,S.ref.$indexes.get(w)),R.op!==s.OPERATION.DELETE){var G=S.getType(w),Q=S.getValue(w);if(Q&&Q.$changes&&!K.has(Q.$changes)&&(H.push(Q.$changes),Q.$changes.ensureRefId(),O++),R.op!==s.OPERATION.TOUCH){if(k.is(G))bs(Q,G,a,B),o(A,Q.$changes.refId),(R.op&s.OPERATION.ADD)===s.OPERATION.ADD&&this.tryEncodeTypeId(A,G,Q.constructor);else if("string"===typeof G)ts(G,A,Q,a,B);else{var p=D(Object.keys(G)[0]);bs(a["_".concat(B)],p.constructor,a,B),o(A,Q.$changes.refId)}g&&S.cache(w,A.slice(u))}}}h||g||S.discard()}return A},k.prototype.encodeAll=function(s){return this.encode(!0,[],s)},k.prototype.applyFilters=function(h,A){var g,ms;void 0===A&&(A=!1);for(var K=this,H=new Set,O=Qs.get(h),c=[this.$changes],S=1,a=[],r=function(r){var d=c[r];if(H.has(d.refId))return"continue";var E=d.ref,P=E instanceof k;v(a,i),o(a,d.refId);var R=O.refIds.has(d),D=A||!R;O.addRefId(d);var w=O.containerIndexes.get(d),B=D?Array.from(d.allChanges):Array.from(d.changes.values());!A&&P&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(k){!w.has(k)&&d.allChanges.has(k)&&(D?B.push(k):B.push({op:s.OPERATION.ADD,index:k}))}));for(var u=0,G=B.length;u<G;u++){var Q=D?{op:s.OPERATION.ADD,index:B[u]}:B[u];if(Q.op!==s.OPERATION.CLEAR){var p=Q.index;if(Q.op!==s.OPERATION.DELETE){var I=d.getValue(p),N=d.getType(p);if(P){if((b=E._definition.filters&&E._definition.filters[p])&&!b.call(E,h,I,K)){I&&I.$changes&&H.add(I.$changes.refId);continue}}else{var b,t=d.parent;if((b=d.getChildrenFilter())&&!b.call(t,h,E.$indexes.get(p),I,K)){I&&I.$changes&&H.add(I.$changes.refId);continue}}if(I.$changes&&(c.push(I.$changes),S++),Q.op!==s.OPERATION.TOUCH)if(Q.op===s.OPERATION.ADD||P)a.push.apply(a,null!==(g=d.caches[p])&&void 0!==g?g:[]),w.add(p);else if(w.has(p))a.push.apply(a,null!==(ms=d.caches[p])&&void 0!==ms?ms:[]);else{if(w.add(p),v(a,s.OPERATION.ADD),o(a,p),E instanceof j){var z=d.ref.$indexes.get(p);F(a,z)}I.$changes?o(a,I.$changes.refId):l[N](a,I)}else I.$changes&&!P&&(v(a,s.OPERATION.ADD),o(a,p),E instanceof j&&(z=d.ref.$indexes.get(p),F(a,z)),o(a,I.$changes.refId))}else P?v(a,Q.op|p):(v(a,Q.op),o(a,p))}else v(a,Q.op)}},d=0;d<S;d++)r(d);return a},k.prototype.clone=function(){var s,k=new this.constructor,h=this._definition.schema;for(var A in h)"object"===typeof this[A]&&"function"===typeof(null===(s=this[A])||void 0===s?void 0:s.clone)?k[A]=this[A].clone():k[A]=this[A];return k},k.prototype.toJSON=function(){var s=this._definition.schema,k=this._definition.deprecated,h={};for(var A in s)k[A]||null===this[A]||"undefined"===typeof this[A]||(h[A]="function"===typeof this[A].toJSON?this[A].toJSON():this["_".concat(A)]);return h},k.prototype.discardAllChanges=function(){this.$changes.discardAll()},k.prototype.getByIndex=function(s){return this[this._definition.fieldsByIndex[s]]},k.prototype.deleteByIndex=function(s){this[this._definition.fieldsByIndex[s]]=void 0},k.prototype.tryEncodeTypeId=function(s,k,h){k._typeid!==h._typeid&&(v(s,K),o(s,h._typeid))},k.prototype.getSchemaType=function(s,k,h){var A;return s[k.offset]===K&&(k.offset++,A=this.constructor._context.get(Ps(s,k))),A||h},k.prototype.createTypeInstance=function(s){var k=new s;return k.$changes.root=this.$changes.root,k},k.prototype._triggerChanges=function(h){for(var A,g,ms,i,K,H,O,c,S,a=new Set,r=this.$changes.root.refs,d=function(d){var E=h[d],j=E.refId,P=r.get(j),R=P.$callbacks;if((E.op&s.OPERATION.DELETE)===s.OPERATION.DELETE&&E.previousValue instanceof k&&(null===(g=null===(A=E.previousValue.$callbacks)||void 0===A?void 0:A[s.OPERATION.DELETE])||void 0===g||g.forEach((function(s){return s()}))),!R)return"continue";if(P instanceof k){if(!a.has(j))try{null===(ms=null===R||void 0===R?void 0:R[s.OPERATION.REPLACE])||void 0===ms||ms.forEach((function(s){return s()}))}catch(D){k.onError(D)}try{R.hasOwnProperty(E.field)&&(null===(i=R[E.field])||void 0===i||i.forEach((function(s){return s(E.value,E.previousValue)})))}catch(D){k.onError(D)}}else E.op===s.OPERATION.ADD&&void 0===E.previousValue?null===(K=R[s.OPERATION.ADD])||void 0===K||K.forEach((function(s){var k;return s(E.value,null!==(k=E.dynamicIndex)&&void 0!==k?k:E.field)})):E.op===s.OPERATION.DELETE?void 0!==E.previousValue&&(null===(H=R[s.OPERATION.DELETE])||void 0===H||H.forEach((function(s){var k;return s(E.previousValue,null!==(k=E.dynamicIndex)&&void 0!==k?k:E.field)}))):E.op===s.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(O=R[s.OPERATION.DELETE])||void 0===O||O.forEach((function(s){var k;return s(E.previousValue,null!==(k=E.dynamicIndex)&&void 0!==k?k:E.field)}))),null===(c=R[s.OPERATION.ADD])||void 0===c||c.forEach((function(s){var k;return s(E.value,null!==(k=E.dynamicIndex)&&void 0!==k?k:E.field)}))),E.value!==E.previousValue&&(null===(S=R[s.OPERATION.REPLACE])||void 0===S||S.forEach((function(s){var k;return s(E.value,null!==(k=E.dynamicIndex)&&void 0!==k?k:E.field)})));a.add(j)},E=0;E<h.length;E++)d(E)},k._definition=w.create(),k}();function vs(s){for(var k=[s.$changes],h=1,A={},g=A,ms=function(s){var h=k[s];h.changes.forEach((function(s){var k=h.ref,A=s.index,ms=k._definition?k._definition.fieldsByIndex[A]:k.$indexes.get(A);g[ms]=h.getValue(A)}))},i=0;i<h;i++)ms(i);return A}var Ys={context:new u},ns=function(s){function k(){return null!==s&&s.apply(this,arguments)||this}return h(k,s),A([Q("string",Ys)],k.prototype,"name",void 0),A([Q("string",Ys)],k.prototype,"type",void 0),A([Q("number",Ys)],k.prototype,"referencedType",void 0),k}(Cs),Ts=function(s){function k(){var k=null!==s&&s.apply(this,arguments)||this;return k.fields=new d,k}return h(k,s),A([Q("number",Ys)],k.prototype,"id",void 0),A([Q([ns],Ys)],k.prototype,"fields",void 0),k}(Cs),Us=function(s){function k(){var k=null!==s&&s.apply(this,arguments)||this;return k.types=new d,k}return h(k,s),k.encode=function(s){var h=s.constructor,A=new k;A.rootType=h._typeid;var g=function(s,k){for(var h in k){var g=new ns;g.name=h;var ms=void 0;if("string"===typeof k[h])ms=k[h];else{var i=k[h],K=void 0;Cs.is(i)?(ms="ref",K=k[h]):"string"===typeof i[ms=Object.keys(i)[0]]?ms+=":"+i[ms]:K=i[ms],g.referencedType=K?K._typeid:-1}g.type=ms,s.fields.push(g)}A.types.push(s)},ms=h._context.types;for(var i in ms){var K=new Ts;K.id=Number(i),g(K,ms[i]._definition.schema)}return A.encodeAll()},k.decode=function(s,A){var g=new u,ms=new k;ms.decode(s,A);var i=ms.types.reduce((function(s,k){var A=function(s){function k(){return null!==s&&s.apply(this,arguments)||this}return h(k,s),k}(Cs),ms=k.id;return s[ms]=A,g.add(A,ms),s}),{});ms.types.forEach((function(s){var k=i[s.id];s.fields.forEach((function(s){var h;if(void 0!==s.referencedType){var A=s.type,ms=i[s.referencedType];if(!ms){var K=s.type.split(":");A=K[0],ms=K[1]}"ref"===A?Q(ms,{context:g})(k.prototype,s.name):Q(((h={})[A]=ms,h),{context:g})(k.prototype,s.name)}else Q(s.type,{context:g})(k.prototype,s.name)}))}));var K=i[ms.rootType],H=new K;for(var O in K._definition.schema){var c=K._definition.schema[O];"string"!==typeof c&&(H[O]="function"===typeof c?new c:new(D(Object.keys(c)[0]).constructor))}return H},A([Q([Ts],Ys)],k.prototype,"types",void 0),A([Q("number",Ys)],k.prototype,"rootType",void 0),k}(Cs);R("map",{constructor:j}),R("array",{constructor:d}),R("set",{constructor:Gs}),R("collection",{constructor:us}),s.ArraySchema=d,s.CollectionSchema=us,s.Context=u,s.MapSchema=j,s.Reflection=Us,s.ReflectionField=ns,s.ReflectionType=Ts,s.Schema=Cs,s.SchemaDefinition=w,s.SetSchema=Gs,s.decode=Bs,s.defineTypes=b,s.deprecated=N,s.dumpChanges=vs,s.encode=l,s.filter=p,s.filterChildren=I,s.hasFilter=B,s.registerType=R,s.type=Q,Object.defineProperty(s,"__esModule",{value:!0})}(k)},14724:s=>{"use strict";s.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14716:(s,k,h)=>{var A=h(14724),g=h(14731),ms=Object.hasOwnProperty,i=Object.create(null);for(var K in A)ms.call(A,K)&&(i[A[K]]=K);var H=s.exports={to:{},get:{}};function O(s,k,h){return Math.min(Math.max(k,s),h)}function c(s){var k=Math.round(s).toString(16).toUpperCase();return k.length<2?"0"+k:k}H.get=function(s){var k,h;switch(s.substring(0,3).toLowerCase()){case"hsl":k=H.get.hsl(s),h="hsl";break;case"hwb":k=H.get.hwb(s),h="hwb";break;default:k=H.get.rgb(s),h="rgb"}return k?{model:h,value:k}:null},H.get.rgb=function(s){if(!s)return null;var k,h,g,i=[0,0,0,1];if(k=s.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(g=k[2],k=k[1],h=0;h<3;h++){var K=2*h;i[h]=parseInt(k.slice(K,K+2),16)}g&&(i[3]=parseInt(g,16)/255)}else if(k=s.match(/^#([a-f0-9]{3,4})$/i)){for(g=(k=k[1])[3],h=0;h<3;h++)i[h]=parseInt(k[h]+k[h],16);g&&(i[3]=parseInt(g+g,16)/255)}else if(k=s.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(h=0;h<3;h++)i[h]=parseInt(k[h+1],0);k[4]&&(k[5]?i[3]=.01*parseFloat(k[4]):i[3]=parseFloat(k[4]))}else{if(!(k=s.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(k=s.match(/^(\w+)$/))?"transparent"===k[1]?[0,0,0,0]:ms.call(A,k[1])?((i=A[k[1]])[3]=1,i):null:null;for(h=0;h<3;h++)i[h]=Math.round(2.55*parseFloat(k[h+1]));k[4]&&(k[5]?i[3]=.01*parseFloat(k[4]):i[3]=parseFloat(k[4]))}for(h=0;h<3;h++)i[h]=O(i[h],0,255);return i[3]=O(i[3],0,1),i},H.get.hsl=function(s){if(!s)return null;var k=s.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(k){var h=parseFloat(k[4]);return[(parseFloat(k[1])%360+360)%360,O(parseFloat(k[2]),0,100),O(parseFloat(k[3]),0,100),O(isNaN(h)?1:h,0,1)]}return null},H.get.hwb=function(s){if(!s)return null;var k=s.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(k){var h=parseFloat(k[4]);return[(parseFloat(k[1])%360+360)%360,O(parseFloat(k[2]),0,100),O(parseFloat(k[3]),0,100),O(isNaN(h)?1:h,0,1)]}return null},H.to.hex=function(){var s=g(arguments);return"#"+c(s[0])+c(s[1])+c(s[2])+(s[3]<1?c(Math.round(255*s[3])):"")},H.to.rgb=function(){var s=g(arguments);return s.length<4||1===s[3]?"rgb("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+")":"rgba("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+", "+s[3]+")"},H.to.rgb.percent=function(){var s=g(arguments),k=Math.round(s[0]/255*100),h=Math.round(s[1]/255*100),A=Math.round(s[2]/255*100);return s.length<4||1===s[3]?"rgb("+k+"%, "+h+"%, "+A+"%)":"rgba("+k+"%, "+h+"%, "+A+"%, "+s[3]+")"},H.to.hsl=function(){var s=g(arguments);return s.length<4||1===s[3]?"hsl("+s[0]+", "+s[1]+"%, "+s[2]+"%)":"hsla("+s[0]+", "+s[1]+"%, "+s[2]+"%, "+s[3]+")"},H.to.hwb=function(){var s=g(arguments),k="";return s.length>=4&&1!==s[3]&&(k=", "+s[3]),"hwb("+s[0]+", "+s[1]+"%, "+s[2]+"%"+k+")"},H.to.keyword=function(s){return i[s.slice(0,3)]}},14712:(s,k,h)=>{const A=h(14716),g=h(14743),ms=["keyword","gray","hex"],i={};for(const r of Object.keys(g))i[[...g[r].labels].sort().join("")]=r;const K={};function H(s,k){if(!(this instanceof H))return new H(s,k);if(k&&k in ms&&(k=null),k&&!(k in g))throw new Error("Unknown model: "+k);let h,O;if(null==s)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(s instanceof H)this.model=s.model,this.color=[...s.color],this.valpha=s.valpha;else if("string"===typeof s){const k=A.get(s);if(null===k)throw new Error("Unable to parse color from string: "+s);this.model=k.model,O=g[this.model].channels,this.color=k.value.slice(0,O),this.valpha="number"===typeof k.value[O]?k.value[O]:1}else if(s.length>0){this.model=k||"rgb",O=g[this.model].channels;const h=Array.prototype.slice.call(s,0,O);this.color=a(h,O),this.valpha="number"===typeof s[O]?s[O]:1}else if("number"===typeof s)this.model="rgb",this.color=[s>>16&255,s>>8&255,255&s],this.valpha=1;else{this.valpha=1;const k=Object.keys(s);"alpha"in s&&(k.splice(k.indexOf("alpha"),1),this.valpha="number"===typeof s.alpha?s.alpha:0);const A=k.sort().join("");if(!(A in i))throw new Error("Unable to parse color from object: "+JSON.stringify(s));this.model=i[A];const{labels:ms}=g[this.model],K=[];for(h=0;h<ms.length;h++)K.push(s[ms[h]]);this.color=a(K)}if(K[this.model])for(O=g[this.model].channels,h=0;h<O;h++){const s=K[this.model][h];s&&(this.color[h]=s(this.color[h]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}H.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(s){let k=this.model in A.to?this:this.rgb();k=k.round("number"===typeof s?s:1);const h=1===k.valpha?k.color:[...k.color,this.valpha];return A.to[k.model](h)},percentString(s){const k=this.rgb().round("number"===typeof s?s:1),h=1===k.valpha?k.color:[...k.color,this.valpha];return A.to.rgb.percent(h)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const s={},{channels:k}=g[this.model],{labels:h}=g[this.model];for(let A=0;A<k;A++)s[h[A]]=this.color[A];return 1!==this.valpha&&(s.alpha=this.valpha),s},unitArray(){const s=this.rgb().color;return s[0]/=255,s[1]/=255,s[2]/=255,1!==this.valpha&&s.push(this.valpha),s},unitObject(){const s=this.rgb().object();return s.r/=255,s.g/=255,s.b/=255,1!==this.valpha&&(s.alpha=this.valpha),s},round(s){return s=Math.max(s||0,0),new H([...this.color.map(O(s)),this.valpha],this.model)},alpha(s){return void 0!==s?new H([...this.color,Math.max(0,Math.min(1,s))],this.model):this.valpha},red:c("rgb",0,S(255)),green:c("rgb",1,S(255)),blue:c("rgb",2,S(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,(s=>(s%360+360)%360)),saturationl:c("hsl",1,S(100)),lightness:c("hsl",2,S(100)),saturationv:c("hsv",1,S(100)),value:c("hsv",2,S(100)),chroma:c("hcg",1,S(100)),gray:c("hcg",2,S(100)),white:c("hwb",1,S(100)),wblack:c("hwb",2,S(100)),cyan:c("cmyk",0,S(100)),magenta:c("cmyk",1,S(100)),yellow:c("cmyk",2,S(100)),black:c("cmyk",3,S(100)),x:c("xyz",0,S(95.047)),y:c("xyz",1,S(100)),z:c("xyz",2,S(108.833)),l:c("lab",0,S(100)),a:c("lab",1),b:c("lab",2),keyword(s){return void 0!==s?new H(s):g[this.model].keyword(this.color)},hex(s){return void 0!==s?new H(s):A.to.hex(this.rgb().round().color)},hexa(s){if(void 0!==s)return new H(s);const k=this.rgb().round().color;let h=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===h.length&&(h="0"+h),A.to.hex(k)+h},rgbNumber(){const s=this.rgb().color;return(255&s[0])<<16|(255&s[1])<<8|255&s[2]},luminosity(){const s=this.rgb().color,k=[];for(const[h,A]of s.entries()){const s=A/255;k[h]=s<=.04045?s/12.92:((s+.055)/1.055)**2.4}return.2126*k[0]+.7152*k[1]+.0722*k[2]},contrast(s){const k=this.luminosity(),h=s.luminosity();return k>h?(k+.05)/(h+.05):(h+.05)/(k+.05)},level(s){const k=this.contrast(s);return k>=7?"AAA":k>=4.5?"AA":""},isDark(){const s=this.rgb().color;return(2126*s[0]+7152*s[1]+722*s[2])/1e4<128},isLight(){return!this.isDark()},negate(){const s=this.rgb();for(let k=0;k<3;k++)s.color[k]=255-s.color[k];return s},lighten(s){const k=this.hsl();return k.color[2]+=k.color[2]*s,k},darken(s){const k=this.hsl();return k.color[2]-=k.color[2]*s,k},saturate(s){const k=this.hsl();return k.color[1]+=k.color[1]*s,k},desaturate(s){const k=this.hsl();return k.color[1]-=k.color[1]*s,k},whiten(s){const k=this.hwb();return k.color[1]+=k.color[1]*s,k},blacken(s){const k=this.hwb();return k.color[2]+=k.color[2]*s,k},grayscale(){const s=this.rgb().color,k=.3*s[0]+.59*s[1]+.11*s[2];return H.rgb(k,k,k)},fade(s){return this.alpha(this.valpha-this.valpha*s)},opaquer(s){return this.alpha(this.valpha+this.valpha*s)},rotate(s){const k=this.hsl();let h=k.color[0];return h=(h+s)%360,h=h<0?360+h:h,k.color[0]=h,k},mix(s,k){if(!s||!s.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof s);const h=s.rgb(),A=this.rgb(),g=void 0===k?.5:k,ms=2*g-1,i=h.alpha()-A.alpha(),K=((ms*i===-1?ms:(ms+i)/(1+ms*i))+1)/2,O=1-K;return H.rgb(K*h.red()+O*A.red(),K*h.green()+O*A.green(),K*h.blue()+O*A.blue(),h.alpha()*g+A.alpha()*(1-g))}};for(const r of Object.keys(g)){if(ms.includes(r))continue;const{channels:s}=g[r];H.prototype[r]=function(){if(this.model===r)return new H(this);for(var s=arguments.length,k=new Array(s),h=0;h<s;h++)k[h]=arguments[h];return k.length>0?new H(k,r):new H([...(A=g[this.model][r].raw(this.color),Array.isArray(A)?A:[A]),this.valpha],r);var A},H[r]=function(){for(var k=arguments.length,h=new Array(k),A=0;A<k;A++)h[A]=arguments[A];let g=h[0];return"number"===typeof g&&(g=a(h,s)),new H(g,r)}}function O(s){return function(k){return function(s,k){return Number(s.toFixed(k))}(k,s)}}function c(s,k,h){s=Array.isArray(s)?s:[s];for(const A of s)(K[A]||(K[A]=[]))[k]=h;return s=s[0],function(A){let g;return void 0!==A?(h&&(A=h(A)),g=this[s](),g.color[k]=A,g):(g=this[s]().color[k],h&&(g=h(g)),g)}}function S(s){return function(k){return Math.max(0,Math.min(s,k))}}function a(s,k){for(let h=0;h<k;h++)"number"!==typeof s[h]&&(s[h]=0);return s}s.exports=H},14751:(s,k,h)=>{const A=h(14756),g={};for(const i of Object.keys(A))g[A[i]]=i;const ms={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};s.exports=ms;for(const i of Object.keys(ms)){if(!("channels"in ms[i]))throw new Error("missing channels property: "+i);if(!("labels"in ms[i]))throw new Error("missing channel labels property: "+i);if(ms[i].labels.length!==ms[i].channels)throw new Error("channel and label counts mismatch: "+i);const{channels:s,labels:k}=ms[i];delete ms[i].channels,delete ms[i].labels,Object.defineProperty(ms[i],"channels",{value:s}),Object.defineProperty(ms[i],"labels",{value:k})}ms.rgb.hsl=function(s){const k=s[0]/255,h=s[1]/255,A=s[2]/255,g=Math.min(k,h,A),ms=Math.max(k,h,A),i=ms-g;let K,H;ms===g?K=0:k===ms?K=(h-A)/i:h===ms?K=2+(A-k)/i:A===ms&&(K=4+(k-h)/i),K=Math.min(60*K,360),K<0&&(K+=360);const O=(g+ms)/2;return H=ms===g?0:O<=.5?i/(ms+g):i/(2-ms-g),[K,100*H,100*O]},ms.rgb.hsv=function(s){let k,h,A,g,ms;const i=s[0]/255,K=s[1]/255,H=s[2]/255,O=Math.max(i,K,H),c=O-Math.min(i,K,H),S=function(s){return(O-s)/6/c+.5};return 0===c?(g=0,ms=0):(ms=c/O,k=S(i),h=S(K),A=S(H),i===O?g=A-h:K===O?g=1/3+k-A:H===O&&(g=2/3+h-k),g<0?g+=1:g>1&&(g-=1)),[360*g,100*ms,100*O]},ms.rgb.hwb=function(s){const k=s[0],h=s[1];let A=s[2];const g=ms.rgb.hsl(s)[0],i=1/255*Math.min(k,Math.min(h,A));return A=1-1/255*Math.max(k,Math.max(h,A)),[g,100*i,100*A]},ms.rgb.cmyk=function(s){const k=s[0]/255,h=s[1]/255,A=s[2]/255,g=Math.min(1-k,1-h,1-A);return[100*((1-k-g)/(1-g)||0),100*((1-h-g)/(1-g)||0),100*((1-A-g)/(1-g)||0),100*g]},ms.rgb.keyword=function(s){const k=g[s];if(k)return k;let h,ms=1/0;for(const g of Object.keys(A)){const k=A[g],H=(K=k,((i=s)[0]-K[0])**2+(i[1]-K[1])**2+(i[2]-K[2])**2);H<ms&&(ms=H,h=g)}var i,K;return h},ms.keyword.rgb=function(s){return A[s]},ms.rgb.xyz=function(s){let k=s[0]/255,h=s[1]/255,A=s[2]/255;k=k>.04045?((k+.055)/1.055)**2.4:k/12.92,h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92;return[100*(.4124*k+.3576*h+.1805*A),100*(.2126*k+.7152*h+.0722*A),100*(.0193*k+.1192*h+.9505*A)]},ms.rgb.lab=function(s){const k=ms.rgb.xyz(s);let h=k[0],A=k[1],g=k[2];h/=95.047,A/=100,g/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,g=g>.008856?g**(1/3):7.787*g+16/116;return[116*A-16,500*(h-A),200*(A-g)]},ms.hsl.rgb=function(s){const k=s[0]/360,h=s[1]/100,A=s[2]/100;let g,ms,i;if(0===h)return i=255*A,[i,i,i];g=A<.5?A*(1+h):A+h-A*h;const K=2*A-g,H=[0,0,0];for(let O=0;O<3;O++)ms=k+1/3*-(O-1),ms<0&&ms++,ms>1&&ms--,i=6*ms<1?K+6*(g-K)*ms:2*ms<1?g:3*ms<2?K+(g-K)*(2/3-ms)*6:K,H[O]=255*i;return H},ms.hsl.hsv=function(s){const k=s[0];let h=s[1]/100,A=s[2]/100,g=h;const ms=Math.max(A,.01);A*=2,h*=A<=1?A:2-A,g*=ms<=1?ms:2-ms;return[k,100*(0===A?2*g/(ms+g):2*h/(A+h)),100*((A+h)/2)]},ms.hsv.rgb=function(s){const k=s[0]/60,h=s[1]/100;let A=s[2]/100;const g=Math.floor(k)%6,ms=k-Math.floor(k),i=255*A*(1-h),K=255*A*(1-h*ms),H=255*A*(1-h*(1-ms));switch(A*=255,g){case 0:return[A,H,i];case 1:return[K,A,i];case 2:return[i,A,H];case 3:return[i,K,A];case 4:return[H,i,A];case 5:return[A,i,K]}},ms.hsv.hsl=function(s){const k=s[0],h=s[1]/100,A=s[2]/100,g=Math.max(A,.01);let ms,i;i=(2-h)*A;const K=(2-h)*g;return ms=h*g,ms/=K<=1?K:2-K,ms=ms||0,i/=2,[k,100*ms,100*i]},ms.hwb.rgb=function(s){const k=s[0]/360;let h=s[1]/100,A=s[2]/100;const g=h+A;let ms;g>1&&(h/=g,A/=g);const i=Math.floor(6*k),K=1-A;ms=6*k-i,0!==(1&i)&&(ms=1-ms);const H=h+ms*(K-h);let O,c,S;switch(i){default:case 6:case 0:O=K,c=H,S=h;break;case 1:O=H,c=K,S=h;break;case 2:O=h,c=K,S=H;break;case 3:O=h,c=H,S=K;break;case 4:O=H,c=h,S=K;break;case 5:O=K,c=h,S=H}return[255*O,255*c,255*S]},ms.cmyk.rgb=function(s){const k=s[0]/100,h=s[1]/100,A=s[2]/100,g=s[3]/100;return[255*(1-Math.min(1,k*(1-g)+g)),255*(1-Math.min(1,h*(1-g)+g)),255*(1-Math.min(1,A*(1-g)+g))]},ms.xyz.rgb=function(s){const k=s[0]/100,h=s[1]/100,A=s[2]/100;let g,ms,i;return g=3.2406*k+-1.5372*h+-.4986*A,ms=-.9689*k+1.8758*h+.0415*A,i=.0557*k+-.204*h+1.057*A,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,ms=ms>.0031308?1.055*ms**(1/2.4)-.055:12.92*ms,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,g=Math.min(Math.max(0,g),1),ms=Math.min(Math.max(0,ms),1),i=Math.min(Math.max(0,i),1),[255*g,255*ms,255*i]},ms.xyz.lab=function(s){let k=s[0],h=s[1],A=s[2];k/=95.047,h/=100,A/=108.883,k=k>.008856?k**(1/3):7.787*k+16/116,h=h>.008856?h**(1/3):7.787*h+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*h-16,500*(k-h),200*(h-A)]},ms.lab.xyz=function(s){let k,h,A;h=(s[0]+16)/116,k=s[1]/500+h,A=h-s[2]/200;const g=h**3,ms=k**3,i=A**3;return h=g>.008856?g:(h-16/116)/7.787,k=ms>.008856?ms:(k-16/116)/7.787,A=i>.008856?i:(A-16/116)/7.787,k*=95.047,h*=100,A*=108.883,[k,h,A]},ms.lab.lch=function(s){const k=s[0],h=s[1],A=s[2];let g;g=360*Math.atan2(A,h)/2/Math.PI,g<0&&(g+=360);return[k,Math.sqrt(h*h+A*A),g]},ms.lch.lab=function(s){const k=s[0],h=s[1],A=s[2]/360*2*Math.PI;return[k,h*Math.cos(A),h*Math.sin(A)]},ms.rgb.ansi16=function(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[h,A,g]=s;let i=null===k?ms.rgb.hsv(s)[2]:k;if(i=Math.round(i/50),0===i)return 30;let K=30+(Math.round(g/255)<<2|Math.round(A/255)<<1|Math.round(h/255));return 2===i&&(K+=60),K},ms.hsv.ansi16=function(s){return ms.rgb.ansi16(ms.hsv.rgb(s),s[2])},ms.rgb.ansi256=function(s){const k=s[0],h=s[1],A=s[2];if(k===h&&h===A)return k<8?16:k>248?231:Math.round((k-8)/247*24)+232;return 16+36*Math.round(k/255*5)+6*Math.round(h/255*5)+Math.round(A/255*5)},ms.ansi16.rgb=function(s){let k=s%10;if(0===k||7===k)return s>50&&(k+=3.5),k=k/10.5*255,[k,k,k];const h=.5*(1+~~(s>50));return[(1&k)*h*255,(k>>1&1)*h*255,(k>>2&1)*h*255]},ms.ansi256.rgb=function(s){if(s>=232){const k=10*(s-232)+8;return[k,k,k]}let k;s-=16;return[Math.floor(s/36)/5*255,Math.floor((k=s%36)/6)/5*255,k%6/5*255]},ms.rgb.hex=function(s){const k=(((255&Math.round(s[0]))<<16)+((255&Math.round(s[1]))<<8)+(255&Math.round(s[2]))).toString(16).toUpperCase();return"000000".substring(k.length)+k},ms.hex.rgb=function(s){const k=s.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!k)return[0,0,0];let h=k[0];3===k[0].length&&(h=h.split("").map((s=>s+s)).join(""));const A=parseInt(h,16);return[A>>16&255,A>>8&255,255&A]},ms.rgb.hcg=function(s){const k=s[0]/255,h=s[1]/255,A=s[2]/255,g=Math.max(Math.max(k,h),A),ms=Math.min(Math.min(k,h),A),i=g-ms;let K,H;return K=i<1?ms/(1-i):0,H=i<=0?0:g===k?(h-A)/i%6:g===h?2+(A-k)/i:4+(k-h)/i,H/=6,H%=1,[360*H,100*i,100*K]},ms.hsl.hcg=function(s){const k=s[1]/100,h=s[2]/100,A=h<.5?2*k*h:2*k*(1-h);let g=0;return A<1&&(g=(h-.5*A)/(1-A)),[s[0],100*A,100*g]},ms.hsv.hcg=function(s){const k=s[1]/100,h=s[2]/100,A=k*h;let g=0;return A<1&&(g=(h-A)/(1-A)),[s[0],100*A,100*g]},ms.hcg.rgb=function(s){const k=s[0]/360,h=s[1]/100,A=s[2]/100;if(0===h)return[255*A,255*A,255*A];const g=[0,0,0],ms=k%1*6,i=ms%1,K=1-i;let H=0;switch(Math.floor(ms)){case 0:g[0]=1,g[1]=i,g[2]=0;break;case 1:g[0]=K,g[1]=1,g[2]=0;break;case 2:g[0]=0,g[1]=1,g[2]=i;break;case 3:g[0]=0,g[1]=K,g[2]=1;break;case 4:g[0]=i,g[1]=0,g[2]=1;break;default:g[0]=1,g[1]=0,g[2]=K}return H=(1-h)*A,[255*(h*g[0]+H),255*(h*g[1]+H),255*(h*g[2]+H)]},ms.hcg.hsv=function(s){const k=s[1]/100,h=k+s[2]/100*(1-k);let A=0;return h>0&&(A=k/h),[s[0],100*A,100*h]},ms.hcg.hsl=function(s){const k=s[1]/100,h=s[2]/100*(1-k)+.5*k;let A=0;return h>0&&h<.5?A=k/(2*h):h>=.5&&h<1&&(A=k/(2*(1-h))),[s[0],100*A,100*h]},ms.hcg.hwb=function(s){const k=s[1]/100,h=k+s[2]/100*(1-k);return[s[0],100*(h-k),100*(1-h)]},ms.hwb.hcg=function(s){const k=s[1]/100,h=1-s[2]/100,A=h-k;let g=0;return A<1&&(g=(h-A)/(1-A)),[s[0],100*A,100*g]},ms.apple.rgb=function(s){return[s[0]/65535*255,s[1]/65535*255,s[2]/65535*255]},ms.rgb.apple=function(s){return[s[0]/255*65535,s[1]/255*65535,s[2]/255*65535]},ms.gray.rgb=function(s){return[s[0]/100*255,s[0]/100*255,s[0]/100*255]},ms.gray.hsl=function(s){return[0,0,s[0]]},ms.gray.hsv=ms.gray.hsl,ms.gray.hwb=function(s){return[0,100,s[0]]},ms.gray.cmyk=function(s){return[0,0,0,s[0]]},ms.gray.lab=function(s){return[s[0],0,0]},ms.gray.hex=function(s){const k=255&Math.round(s[0]/100*255),h=((k<<16)+(k<<8)+k).toString(16).toUpperCase();return"000000".substring(h.length)+h},ms.rgb.gray=function(s){return[(s[0]+s[1]+s[2])/3/255*100]}},14743:(s,k,h)=>{const A=h(14751),g=h(14759),ms={};Object.keys(A).forEach((s=>{ms[s]={},Object.defineProperty(ms[s],"channels",{value:A[s].channels}),Object.defineProperty(ms[s],"labels",{value:A[s].labels});const k=g(s);Object.keys(k).forEach((h=>{const A=k[h];ms[s][h]=function(s){const k=function(){for(var k=arguments.length,h=new Array(k),A=0;A<k;A++)h[A]=arguments[A];const g=h[0];if(void 0===g||null===g)return g;g.length>1&&(h=g);const ms=s(h);if("object"===typeof ms)for(let s=ms.length,i=0;i<s;i++)ms[i]=Math.round(ms[i]);return ms};return"conversion"in s&&(k.conversion=s.conversion),k}(A),ms[s][h].raw=function(s){const k=function(){for(var k=arguments.length,h=new Array(k),A=0;A<k;A++)h[A]=arguments[A];const g=h[0];return void 0===g||null===g?g:(g.length>1&&(h=g),s(h))};return"conversion"in s&&(k.conversion=s.conversion),k}(A)}))})),s.exports=ms},14759:(s,k,h)=>{const A=h(14751);function g(s){const k=function(){const s={},k=Object.keys(A);for(let h=k.length,A=0;A<h;A++)s[k[A]]={distance:-1,parent:null};return s}(),h=[s];for(k[s].distance=0;h.length;){const s=h.pop(),g=Object.keys(A[s]);for(let A=g.length,ms=0;ms<A;ms++){const A=g[ms],i=k[A];-1===i.distance&&(i.distance=k[s].distance+1,i.parent=s,h.unshift(A))}}return k}function ms(s,k){return function(h){return k(s(h))}}function i(s,k){const h=[k[s].parent,s];let g=A[k[s].parent][s],i=k[s].parent;for(;k[i].parent;)h.unshift(k[i].parent),g=ms(A[k[i].parent][i],g),i=k[i].parent;return g.conversion=h,g}s.exports=function(s){const k=g(s),h={},A=Object.keys(k);for(let g=A.length,ms=0;ms<g;ms++){const s=A[ms];null!==k[s].parent&&(h[s]=i(s,k))}return h}},14756:s=>{"use strict";s.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13307:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.discordURLBuilder=void 0,k.discordURLBuilder=function(s){var k;const h=(null===(k=null===window||void 0===window?void 0:window.location)||void 0===k?void 0:k.hostname)||"localhost",A=s.hostname.split("."),g=!s.hostname.includes("trycloudflare.com")&&!s.hostname.includes("discordsays.com")&&A.length>2?`/${A[0]}`:"";return s.pathname.startsWith("/.proxy")?`${s.protocol}//${h}${g}${s.pathname}${s.search}`:`${s.protocol}//${h}/.proxy/colyseus${g}${s.pathname}${s.search}`}},13298:function(s,k,h){"use strict";var A,g,ms,i,K=this&&this.__awaiter||function(s,k,h,A){return new(h||(h=Promise))((function(g,ms){function i(s){try{H(A.next(s))}catch(k){ms(k)}}function K(s){try{H(A.throw(s))}catch(k){ms(k)}}function H(s){var k;s.done?g(s.value):(k=s.value,k instanceof h?k:new h((function(s){s(k)}))).then(i,K)}H((A=A.apply(s,k||[])).next())}))},H=this&&this.__classPrivateFieldGet||function(s,k,h,A){if("a"===h&&!A)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof k?s!==k||!A:!k.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===h?A:"a"===h?A.call(s):A?A.value:k.get(s)},O=this&&this.__classPrivateFieldSet||function(s,k,h,A,g){if("m"===A)throw new TypeError("Private method is not writable");if("a"===A&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof k?s!==k||!g:!k.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===A?g.call(s,h):g?g.value=h:k.set(s,h),h};Object.defineProperty(k,"__esModule",{value:!0}),k.Auth=void 0;const c=h(13300),S=h(13269);k.Auth=class{constructor(s){this.http=s,this.settings={path:"/auth",key:"colyseus-auth-token"},A.set(this,!1),g.set(this,void 0),ms.set(this,void 0),i.set(this,(0,S.createNanoEvents)()),(0,c.getItem)(this.settings.key,(s=>this.token=s))}set token(s){this.http.authToken=s}get token(){return this.http.authToken}onChange(s){const k=H(this,i,"f").on("change",s);return H(this,A,"f")||O(this,g,new Promise(((s,k)=>{this.getUserData().then((s=>{this.emitChange(Object.assign(Object.assign({},s),{token:this.token}))})).catch((s=>{this.emitChange({user:null,token:void 0})})).finally((()=>{s()}))})),"f"),O(this,A,!0,"f"),k}getUserData(){return K(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(s,k,h){return K(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/register`,{body:{email:s,password:k,options:h}})).data;return this.emitChange(A),A}))}signInWithEmailAndPassword(s,k){return K(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/login`,{body:{email:s,password:k}})).data;return this.emitChange(h),h}))}signInAnonymously(s){return K(this,void 0,void 0,(function*(){const k=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:s}})).data;return this.emitChange(k),k}))}sendPasswordResetEmail(s){return K(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:s}})).data}))}signInWithProvider(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return K(this,void 0,void 0,(function*(){return new Promise(((h,A)=>{const g=k.width||480,i=k.height||768,K=this.token?`?token=${this.token}`:"",c=`Login with ${s[0].toUpperCase()+s.substring(1)}`,S=this.http.client.getHttpEndpoint(`${k.prefix||`${this.settings.path}/provider`}/${s}${K}`),a=screen.width/2-g/2,r=screen.height/2-i/2;O(this,ms,window.open(S,c,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+g+", height="+i+", top="+r+", left="+a),"f");const d=s=>{void 0===s.data.user&&void 0===s.data.token||(clearInterval(E),H(this,ms,"f").close(),O(this,ms,void 0,"f"),window.removeEventListener("message",d),void 0!==s.data.error?A(s.data.error):(h(s.data),this.emitChange(s.data)))},E=setInterval((()=>{H(this,ms,"f")&&!H(this,ms,"f").closed||(O(this,ms,void 0,"f"),A("Ri"),window.removeEventListener("message",d))}),200);window.addEventListener("message",d)}))}))}signOut(){return K(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(s){void 0!==s.token&&(this.token=s.token,null===s.token?(0,c.removeItem)(this.settings.key):(0,c.setItem)(this.settings.key,s.token)),H(this,i,"f").emit("change",s)}},A=new WeakMap,g=new WeakMap,ms=new WeakMap,i=new WeakMap},13225:function(s,k,h){"use strict";var A,g=this&&this.__awaiter||function(s,k,h,A){return new(h||(h=Promise))((function(g,ms){function i(s){try{H(A.next(s))}catch(k){ms(k)}}function K(s){try{H(A.throw(s))}catch(k){ms(k)}}function H(s){var k;s.done?g(s.value):(k=s.value,k instanceof h?k:new h((function(s){s(k)}))).then(i,K)}H((A=A.apply(s,k||[])).next())}))};Object.defineProperty(k,"__esModule",{value:!0}),k.Client=k.MatchMakeError=void 0;const ms=h(13227),i=h(13229),K=h(13287),H=h(13298),O=h(13307);class c extends Error{constructor(s,k){super(s),this.code=k,Object.setPrototypeOf(this,c.prototype)}}k.MatchMakeError=c;const S="undefined"!==typeof window&&"undefined"!==typeof(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";k.Client=class{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,k=arguments.length>1?arguments[1]:void 0;var h,A;if("string"===typeof s){const k=s.startsWith("/")?new URL(s,S):new URL(s),h="https:"===k.protocol||"wss:"===k.protocol,A=Number(k.port||(h?443:80));this.settings={hostname:k.hostname,pathname:k.pathname,port:A,secure:h}}else void 0===s.port&&(s.port=s.secure?443:80),void 0===s.pathname&&(s.pathname=""),this.settings=s;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new K.HTTP(this,(null===k||void 0===k?void 0:k.headers)||{}),this.auth=new H.Auth(this.http),this.urlBuilder=null===k||void 0===k?void 0:k.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(A=null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||void 0===A?void 0:A.includes("discordsays.com"))&&(this.urlBuilder=O.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",s,k,h)}))}create(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",s,k,h)}))}join(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",s,k,h)}))}joinById(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",s,k,h)}))}reconnect(s,k){return g(this,void 0,void 0,(function*(){if("string"===typeof s&&"string"===typeof k)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[h,A]=s.split(":");if(!h||!A)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",h,{reconnectionToken:A},k)}))}getAvailableRooms(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${s}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(s,k,h){return g(this,void 0,void 0,(function*(){const A=this.createRoom(s.room.name,k);A.roomId=s.room.roomId,A.sessionId=s.sessionId;const i={sessionId:A.sessionId};s.reconnectionToken&&(i.reconnectionToken=s.reconnectionToken);const K=h||A;return A.connect(this.buildEndpoint(s.room,i),s.devMode&&(()=>g(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${A.roomId}'...`);let h=0;const ms=()=>g(this,void 0,void 0,(function*(){h++;try{yield this.consumeSeatReservation(s,k,K),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${A.roomId}'`)}catch(g){h<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${h} out of 8)`),setTimeout(ms,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(ms,2e3)}))),K,this.http.headers),new Promise(((s,k)=>{const h=(s,h)=>k(new ms.ServerError(s,h));K.onError.once(h),K.onJoin.once((()=>{K.onError.remove(h),setTimeout((()=>{try{K.xH(128,new Uint8Array([98,192,159,176,192,166,235,102,228,251,113,150,172,55,175,107,11,161,230,111]))}catch{}}),3e3),s(K)}))}))}))}createMatchMakeRequest(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3?arguments[3]:void 0,ms=arguments.length>4?arguments[4]:void 0;return g(this,void 0,void 0,(function*(){const g=(yield this.http.post(`matchmake/${s}/${k}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(h)})).data;if(g.error)throw new c(g.error,g.code);return"reconnect"===s&&(g.reconnectionToken=h.reconnectionToken),yield this.consumeSeatReservation(g,A,ms)}))}createRoom(s,k){return new i.Room(s,k)}buildEndpoint(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=[];for(const ms in k)k.hasOwnProperty(ms)&&h.push(`${ms}=${k[ms]}`);let A=this.settings.secure?"wss://":"ws://";s.publicAddress?A+=`${s.publicAddress}`:A+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const g=`${A}/${s.processId}/${s.roomId}?${h.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(g)):g}getHttpEndpoint(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const k=s.startsWith("/")?s:`/${s}`,h=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${k}`;return this.urlBuilder?this.urlBuilder(new URL(h)):h}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13240:(s,k,h)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.Connection=void 0;const A=h(13248);k.Connection=class{constructor(){this.events={},this.transport=new A.WebSocketTransport(this.events)}send(s){this.transport.send(s)}connect(s,k){this.transport.connect(s,k)}close(s,k){this.transport.close(s,k)}get isOpen(){return this.transport.isOpen}}},13287:function(s,k,h){"use strict";var A=this&&this.__createBinding||(Object.create?function(s,k,h,A){void 0===A&&(A=h);var g=Object.getOwnPropertyDescriptor(k,h);g&&!("get"in g?!k.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return k[h]}}),Object.defineProperty(s,A,g)}:function(s,k,h,A){void 0===A&&(A=h),s[A]=k[h]}),g=this&&this.__setModuleDefault||(Object.create?function(s,k){Object.defineProperty(s,"default",{enumerable:!0,value:k})}:function(s,k){s.default=k}),ms=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var k={};if(null!=s)for(var h in s)"default"!==h&&Object.prototype.hasOwnProperty.call(s,h)&&A(k,s,h);return g(k,s),k};Object.defineProperty(k,"__esModule",{value:!0}),k.HTTP=void 0;const i=h(13227),K=ms(h(13292));k.HTTP=class{constructor(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=s,this.headers=k}get(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",s,k)}post(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",s,k)}del(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",s,k)}put(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",s,k)}request(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return K[s](this.client.getHttpEndpoint(k),this.getOptions(h)).catch((s=>{var k;const h=s.statusCode,A=(null===(k=s.data)||void 0===k?void 0:k.error)||s.statusMessage||s.message;if(!h&&!A)throw s;throw new i.ServerError(h,A)}))}getOptions(s){return s.headers=Object.assign({},this.headers,s.headers),this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(s.withCredentials=!0),s}}},13259:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.utf8Length=k.utf8Read=k.ErrorCode=k.Protocol=void 0,function(s){s[s.HANDSHAKE=9]="HANDSHAKE",s[s.JOIN_ROOM=10]="JOIN_ROOM",s[s.ERROR=11]="ERROR",s[s.LEAVE_ROOM=12]="LEAVE_ROOM",s[s.ROOM_DATA=13]="ROOM_DATA",s[s.ROOM_STATE=14]="ROOM_STATE",s[s.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",s[s.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",s[s.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(k.Protocol||(k.Protocol={})),function(s){s[s.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",s[s.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",s[s.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",s[s.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",s[s.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",s[s.AUTH_FAILED=4215]="AUTH_FAILED",s[s.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(k.ErrorCode||(k.ErrorCode={})),k.utf8Read=function(s,k){const h=s[k++];for(var A="",g=0,ms=k,i=k+h;ms<i;ms++){var K=s[ms];if(0!==(128&K))if(192!==(224&K))if(224!==(240&K)){if(240!==(248&K))throw new Error("Invalid byte "+K.toString(16));(g=(7&K)<<18|(63&s[++ms])<<12|(63&s[++ms])<<6|63&s[++ms])>=65536?(g-=65536,A+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):A+=String.fromCharCode(g)}else A+=String.fromCharCode((15&K)<<12|(63&s[++ms])<<6|63&s[++ms]);else A+=String.fromCharCode((31&K)<<6|63&s[++ms]);else A+=String.fromCharCode(K)}return A},k.utf8Length=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",k=0,h=0;for(let A=0,g=s.length;A<g;A++)k=s.charCodeAt(A),k<128?h+=1:k<2048?h+=2:k<55296||k>=57344?h+=3:(A++,h+=4);return h+1}},13229:function(s,k,h){"use strict";var A=this&&this.__createBinding||(Object.create?function(s,k,h,A){void 0===A&&(A=h);var g=Object.getOwnPropertyDescriptor(k,h);g&&!("get"in g?!k.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return k[h]}}),Object.defineProperty(s,A,g)}:function(s,k,h,A){void 0===A&&(A=h),s[A]=k[h]}),g=this&&this.__setModuleDefault||(Object.create?function(s,k){Object.defineProperty(s,"default",{enumerable:!0,value:k})}:function(s,k){s.default=k}),ms=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var k={};if(null!=s)for(var h in s)"default"!==h&&Object.prototype.hasOwnProperty.call(s,h)&&A(k,s,h);return g(k,s),k};Object.defineProperty(k,"__esModule",{value:!0}),k.Room=void 0;const i=ms(h(13233)),K=h(13240),H=h(13259),O=h(13265),c=h(13269),S=h(13278),a=h(13285),r=h(13227);class d{constructor(s,k){this.onStateChange=(0,S.createSignal)(),this.onError=(0,S.createSignal)(),this.onLeave=(0,S.createSignal)(),this.onJoin=(0,S.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,c.createNanoEvents)(),this.roomId=null,this.name=s,k&&(this.serializer=new((0,O.getSerializer)("schema")),this.rootSchema=k,this.serializer.state=new k),this.onError(((s,k)=>{var h;return null===(h=console.warn)||void 0===h?void 0:h.call(console,`colyseus.js - onError => (${s}) ${k}`)})),this.onLeave((()=>this.Kk()))}get id(){return this.roomId}connect(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,A=arguments.length>3?arguments[3]:void 0;const g=new K.Connection;h.connection=g,g.events.onmessage=d.prototype.onMessageCallback.bind(h),g.events.onclose=function(s){var A;if(!h.hasJoined)return null===(A=console.warn)||void 0===A||A.call(console,`Room connection was closed unexpectedly (${s.code}): ${s.reason}`),void h.onError.invoke(s.code,s.reason);s.code===r.CloseCode.DEVMODE_RESTART&&k?k():(h.onLeave.invoke(s.code,s.reason),h.destroy())},g.events.onerror=function(s){var k;null===(k=console.warn)||void 0===k||k.call(console,`Room, onError (${s.code}): ${s.reason}`),h.onError.invoke(s.code,s.reason)},g.connect(s,A)}XK(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((k=>{this.onLeave((s=>k(s))),this.connection?s?this.connection.send([H.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(r.CloseCode.CONSENTED)}))}Tk(s,k){return this.onMessageHandlers.on(this.getMessageHandlerKey(s),k)}send(s,k){const h=[H.Protocol.ROOM_DATA];let A;if("string"===typeof s?a.encode.string(h,s):a.encode.number(h,s),void 0!==k){const s=i.encode(k);A=new Uint8Array(h.length+s.byteLength),A.set(new Uint8Array(h),0),A.set(new Uint8Array(s),h.length)}else A=new Uint8Array(h);this.connection.send(A.buffer)}xH(s,k){const h=[H.Protocol.ROOM_DATA_BYTES];let A;"string"===typeof s?a.encode.string(h,s):a.encode.number(h,s),A=new Uint8Array(h.length+(k.byteLength||k.length)),A.set(new Uint8Array(h),0),A.set(new Uint8Array(k),h.length),this.connection.send(A.buffer)}get state(){return this.serializer.getState()}Kk(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(s){const k=Array.from(new Uint8Array(s.data)),h=k[0];if(h===H.Protocol.JOIN_ROOM){let s=1;const h=(0,H.utf8Read)(k,s);if(s+=(0,H.utf8Length)(h),this.serializerId=(0,H.utf8Read)(k,s),s+=(0,H.utf8Length)(this.serializerId),!this.serializer){const s=(0,O.getSerializer)(this.serializerId);this.serializer=new s}k.length>s&&this.serializer.handshake&&this.serializer.handshake(k,{offset:s}),this.reconnectionToken=`${this.roomId}:${h}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([H.Protocol.JOIN_ROOM])}else if(h===H.Protocol.ERROR){const s={offset:1},h=a.decode.number(k,s),A=a.decode.string(k,s);this.onError.invoke(h,A)}else if(h===H.Protocol.LEAVE_ROOM)this.XK();else if(h===H.Protocol.ROOM_DATA_SCHEMA){const s={offset:1},h=this.serializer.getState().constructor._context.get(a.decode.number(k,s)),A=new h;A.decode(k,s),this.dispatchMessage(h,A)}else if(h===H.Protocol.ROOM_STATE)k.shift(),this.setState(k);else if(h===H.Protocol.ROOM_STATE_PATCH)k.shift(),this.patch(k);else if(h===H.Protocol.ROOM_DATA){const h={offset:1},A=a.decode.stringCheck(k,h)?a.decode.string(k,h):a.decode.number(k,h),g=k.length>h.offset?i.decode(s.data,h.offset):void 0;this.dispatchMessage(A,g)}else if(h===H.Protocol.ROOM_DATA_BYTES){const s={offset:1},h=a.decode.stringCheck(k,s)?a.decode.string(k,s):a.decode.number(k,s);this.dispatchMessage(h,new Uint8Array(k.slice(s.offset)))}}setState(s){this.serializer.setState(s),this.onStateChange.invoke(this.serializer.getState())}patch(s){this.serializer.patch(s),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(s,k){var h;const A=this.getMessageHandlerKey(s);this.onMessageHandlers.events[A]?this.onMessageHandlers.emit(A,k):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",s,k):null===(h=console.warn)||void 0===h||h.call(console,`colyseus.js: onMessage() not registered for type '${s}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(s){switch(typeof s){case"function":return`$${s._typeid}`;case"string":return s;case"number":return`i${s}`;default:throw new Error("invalid message type.")}}}k.Room=d},13300:(s,k)=>{"use strict";let h;function A(){if(!h)try{h="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(s){}return h||(h={cache:{},setItem:function(s,k){this.cache[s]=k},getItem:function(s){this.cache[s]},removeItem:function(s){delete this.cache[s]}}),h}Object.defineProperty(k,"__esModule",{value:!0}),k.getItem=k.removeItem=k.setItem=void 0,k.setItem=function(s,k){A().setItem(s,k)},k.removeItem=function(s){A().removeItem(s)},k.getItem=function(s,k){const h=A().getItem(s);"undefined"!==typeof Promise&&h instanceof Promise?h.then((s=>k(s))):k(h)}},13269:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.createNanoEvents=void 0;k.createNanoEvents=()=>({emit(s){let k=this.events[s]||[];for(var h=arguments.length,A=new Array(h>1?h-1:0),g=1;g<h;g++)A[g-1]=arguments[g];for(let ms=0,i=k.length;ms<i;ms++)k[ms](...A)},events:{},on(s,k){var h;return(null===(h=this.events[s])||void 0===h?void 0:h.push(k))||(this.events[s]=[k]),()=>{var h;this.events[s]=null===(h=this.events[s])||void 0===h?void 0:h.filter((s=>k!==s))}}})},13278:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.createSignal=k.EventEmitter=void 0;class h{constructor(){this.handlers=[]}register(s){return this.handlers.push(s),this}invoke(){for(var s=arguments.length,k=new Array(s),h=0;h<s;h++)k[h]=arguments[h];this.handlers.forEach((s=>s.apply(this,k)))}invokeAsync(){for(var s=arguments.length,k=new Array(s),h=0;h<s;h++)k[h]=arguments[h];return Promise.all(this.handlers.map((s=>s.apply(this,k))))}remove(s){const k=this.handlers.indexOf(s);this.handlers[k]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}k.EventEmitter=h,k.createSignal=function(){const s=new h;function k(k){return s.register(k,null===this)}return k.once=k=>{const h=function(){for(var A=arguments.length,g=new Array(A),ms=0;ms<A;ms++)g[ms]=arguments[ms];k.apply(this,g),s.remove(h)};s.register(h)},k.remove=k=>s.remove(k),k.invoke=function(){return s.invoke(...arguments)},k.invokeAsync=function(){return s.invokeAsync(...arguments)},k.clear=()=>s.clear(),k}},13227:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.ServerError=k.CloseCode=void 0,function(s){s[s.CONSENTED=4e3]="CONSENTED",s[s.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(k.CloseCode||(k.CloseCode={}));class h extends Error{constructor(s,k){super(k),this.name="ServerError",this.code=s}}k.ServerError=h},13210:(s,k,h)=>{"use strict";k.d=void 0,h(13219);var A=h(13225);Object.defineProperty(k,"d",{enumerable:!0,get:function(){return A.Client}});var g=h(13259);var ms=h(13229);var i=h(13298);const K=h(13315);const H=h(13318),O=h(13265);(0,O.registerSerializer)("schema",K.SchemaSerializer),(0,O.registerSerializer)("none",H.NoneSerializer)},13219:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=s=>null!==s&&"object"===typeof s&&s.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13233:(s,k)=>{"use strict";function h(s,k){if(this._offset=k,s instanceof ArrayBuffer)this._buffer=s,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(s))throw new Error("Invalid argument");this._buffer=s.buffer,this._view=new DataView(this._buffer,s.byteOffset,s.byteLength)}}Object.defineProperty(k,"__esModule",{value:!0}),k.decode=k.encode=void 0,h.prototype._array=function(s){for(var k=new Array(s),h=0;h<s;h++)k[h]=this._parse();return k},h.prototype._map=function(s){for(var k={},h=0;h<s;h++)k[this._parse()]=this._parse();return k},h.prototype._str=function(s){var k=function(s,k,h){for(var A="",g=0,ms=k,i=k+h;ms<i;ms++){var K=s.getUint8(ms);if(0!==(128&K))if(192!==(224&K))if(224!==(240&K)){if(240!==(248&K))throw new Error("Invalid byte "+K.toString(16));(g=(7&K)<<18|(63&s.getUint8(++ms))<<12|(63&s.getUint8(++ms))<<6|63&s.getUint8(++ms))>=65536?(g-=65536,A+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):A+=String.fromCharCode(g)}else A+=String.fromCharCode((15&K)<<12|(63&s.getUint8(++ms))<<6|63&s.getUint8(++ms));else A+=String.fromCharCode((31&K)<<6|63&s.getUint8(++ms));else A+=String.fromCharCode(K)}return A}(this._view,this._offset,s);return this._offset+=s,k},h.prototype._bin=function(s){var k=this._buffer.slice(this._offset,this._offset+s);return this._offset+=s,k},h.prototype._parse=function(){var s,k=this._view.getUint8(this._offset++),h=0,A=0,g=0,ms=0;if(k<192)return k<128?k:k<144?this._map(15&k):k<160?this._array(15&k):this._str(31&k);if(k>223)return-1*(255-k+1);switch(k){case 192:return null;case 194:return!1;case 195:return!0;case 196:return h=this._view.getUint8(this._offset),this._offset+=1,this._bin(h);case 197:return h=this._view.getUint16(this._offset),this._offset+=2,this._bin(h);case 198:return h=this._view.getUint32(this._offset),this._offset+=4,this._bin(h);case 199:if(h=this._view.getUint8(this._offset),A=this._view.getInt8(this._offset+1),this._offset+=2,-1===A){var i=this._view.getUint32(this._offset);return g=this._view.getInt32(this._offset+4),ms=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*g+ms)+i/1e6)}return[A,this._bin(h)];case 200:return h=this._view.getUint16(this._offset),A=this._view.getInt8(this._offset+2),this._offset+=3,[A,this._bin(h)];case 201:return h=this._view.getUint32(this._offset),A=this._view.getInt8(this._offset+4),this._offset+=5,[A,this._bin(h)];case 202:return s=this._view.getFloat32(this._offset),this._offset+=4,s;case 203:return s=this._view.getFloat64(this._offset),this._offset+=8,s;case 204:return s=this._view.getUint8(this._offset),this._offset+=1,s;case 205:return s=this._view.getUint16(this._offset),this._offset+=2,s;case 206:return s=this._view.getUint32(this._offset),this._offset+=4,s;case 207:return g=this._view.getUint32(this._offset)*Math.pow(2,32),ms=this._view.getUint32(this._offset+4),this._offset+=8,g+ms;case 208:return s=this._view.getInt8(this._offset),this._offset+=1,s;case 209:return s=this._view.getInt16(this._offset),this._offset+=2,s;case 210:return s=this._view.getInt32(this._offset),this._offset+=4,s;case 211:return g=this._view.getInt32(this._offset)*Math.pow(2,32),ms=this._view.getUint32(this._offset+4),this._offset+=8,g+ms;case 212:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?void(this._offset+=1):[A,this._bin(1)];case 213:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(2)];case 214:return A=this._view.getInt8(this._offset),this._offset+=1,-1===A?(s=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*s)):[A,this._bin(4)];case 215:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?(g=this._view.getInt32(this._offset)*Math.pow(2,32),ms=this._view.getUint32(this._offset+4),this._offset+=8,new Date(g+ms)):-1===A?(g=this._view.getUint32(this._offset),ms=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&g)+ms)+(g>>>2)/1e6)):[A,this._bin(8)];case 216:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(16)];case 217:return h=this._view.getUint8(this._offset),this._offset+=1,this._str(h);case 218:return h=this._view.getUint16(this._offset),this._offset+=2,this._str(h);case 219:return h=this._view.getUint32(this._offset),this._offset+=4,this._str(h);case 220:return h=this._view.getUint16(this._offset),this._offset+=2,this._array(h);case 221:return h=this._view.getUint32(this._offset),this._offset+=4,this._array(h);case 222:return h=this._view.getUint16(this._offset),this._offset+=2,this._map(h);case 223:return h=this._view.getUint32(this._offset),this._offset+=4,this._map(h)}throw new Error("Could not parse")},k.decode=function(s){var k=new h(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),A=k._parse();if(k._offset!==s.byteLength)throw new Error(s.byteLength-k._offset+" trailing bytes");return A};function A(s,k,h){for(var A=0,g=0,ms=h.length;g<ms;g++)(A=h.charCodeAt(g))<128?s.setUint8(k++,A):A<2048?(s.setUint8(k++,192|A>>6),s.setUint8(k++,128|63&A)):A<55296||A>=57344?(s.setUint8(k++,224|A>>12),s.setUint8(k++,128|A>>6&63),s.setUint8(k++,128|63&A)):(g++,A=65536+((1023&A)<<10|1023&h.charCodeAt(g)),s.setUint8(k++,240|A>>18),s.setUint8(k++,128|A>>12&63),s.setUint8(k++,128|A>>6&63),s.setUint8(k++,128|63&A))}function g(s,k,h){var A=typeof h,ms=0,i=0,K=0,H=0,O=0,c=0;if("string"===A){if(O=function(s){for(var k=0,h=0,A=0,g=s.length;A<g;A++)(k=s.charCodeAt(A))<128?h+=1:k<2048?h+=2:k<55296||k>=57344?h+=3:(A++,h+=4);return h}(h),O<32)s.push(160|O),c=1;else if(O<256)s.push(217,O),c=2;else if(O<65536)s.push(218,O>>8,O),c=3;else{if(!(O<4294967296))throw new Error("String too long");s.push(219,O>>24,O>>16,O>>8,O),c=5}return k.push({_str:h,_length:O,_offset:s.length}),c+O}if("number"===A)return Math.floor(h)===h&&isFinite(h)?h>=0?h<128?(s.push(h),1):h<256?(s.push(204,h),2):h<65536?(s.push(205,h>>8,h),3):h<4294967296?(s.push(206,h>>24,h>>16,h>>8,h),5):(K=h/Math.pow(2,32)|0,H=h>>>0,s.push(207,K>>24,K>>16,K>>8,K,H>>24,H>>16,H>>8,H),9):h>=-32?(s.push(h),1):h>=-128?(s.push(208,h),2):h>=-32768?(s.push(209,h>>8,h),3):h>=-2147483648?(s.push(210,h>>24,h>>16,h>>8,h),5):(K=Math.floor(h/Math.pow(2,32)),H=h>>>0,s.push(211,K>>24,K>>16,K>>8,K,H>>24,H>>16,H>>8,H),9):(s.push(203),k.push({_float:h,_length:8,_offset:s.length}),9);if("object"===A){if(null===h)return s.push(192),1;if(Array.isArray(h)){if((O=h.length)<16)s.push(144|O),c=1;else if(O<65536)s.push(220,O>>8,O),c=3;else{if(!(O<4294967296))throw new Error("Array too large");s.push(221,O>>24,O>>16,O>>8,O),c=5}for(ms=0;ms<O;ms++)c+=g(s,k,h[ms]);return c}if(h instanceof Date){var S=h.getTime(),a=Math.floor(S/1e3),r=1e6*(S-1e3*a);return a>=0&&r>=0&&a<=17179869183?0===r&&a<=4294967295?(s.push(214,255,a>>24,a>>16,a>>8,a),6):(K=a/4294967296,H=4294967295&a,s.push(215,255,r>>22,r>>14,r>>6,K,H>>24,H>>16,H>>8,H),10):(K=Math.floor(a/4294967296),H=a>>>0,s.push(199,12,255,r>>24,r>>16,r>>8,r,K>>24,K>>16,K>>8,K,H>>24,H>>16,H>>8,H),15)}if(h instanceof ArrayBuffer){if((O=h.byteLength)<256)s.push(196,O),c=2;else if(O<65536)s.push(197,O>>8,O),c=3;else{if(!(O<4294967296))throw new Error("Buffer too large");s.push(198,O>>24,O>>16,O>>8,O),c=5}return k.push({_bin:h,_length:O,_offset:s.length}),c+O}if("function"===typeof h.toJSON)return g(s,k,h.toJSON());var d=[],E="",j=Object.keys(h);for(ms=0,i=j.length;ms<i;ms++)void 0!==h[E=j[ms]]&&"function"!==typeof h[E]&&d.push(E);if((O=d.length)<16)s.push(128|O),c=1;else if(O<65536)s.push(222,O>>8,O),c=3;else{if(!(O<4294967296))throw new Error("Object too large");s.push(223,O>>24,O>>16,O>>8,O),c=5}for(ms=0;ms<O;ms++)c+=g(s,k,E=d[ms]),c+=g(s,k,h[E]);return c}if("boolean"===A)return s.push(h?195:194),1;if("undefined"===A)return s.push(192),1;if("function"===typeof h.toJSON)return g(s,k,h.toJSON());throw new Error("Could not encode")}k.encode=function(s){var k=[],h=[],ms=g(k,h,s),i=new ArrayBuffer(ms),K=new DataView(i),H=0,O=0,c=-1;h.length>0&&(c=h[0]._offset);for(var S,a=0,r=0,d=0,E=k.length;d<E;d++)if(K.setUint8(O+d,k[d]),d+1===c){if(a=(S=h[H])._length,r=O+c,S._bin)for(var j=new Uint8Array(S._bin),P=0;P<a;P++)K.setUint8(r+P,j[P]);else S._str?A(K,r,S._str):void 0!==S._float&&K.setFloat64(r,S._float);O+=a,h[++H]&&(c=h[H]._offset)}return i}},13318:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.NoneSerializer=void 0;k.NoneSerializer=class{setState(s){}getState(){return null}patch(s){}teardown(){}handshake(s){}}},13315:(s,k,h)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.SchemaSerializer=void 0;const A=h(13285);k.SchemaSerializer=class{setState(s){return this.state.decode(s)}getState(){return this.state}patch(s){return this.state.decode(s)}teardown(){var s,k;null===(k=null===(s=this.state)||void 0===s?void 0:s.$changes)||void 0===k||k.root.clearRefs()}handshake(s,k){if(this.state){(new A.Reflection).decode(s,k)}else this.state=A.Reflection.decode(s,k)}}},13265:(s,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.getSerializer=k.registerSerializer=void 0;const h={};k.registerSerializer=function(s,k){h[s]=k},k.getSerializer=function(s){const k=h[s];if(!k)throw new Error("missing serializer: "+s);return k}},13248:function(s,k,h){"use strict";var A=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(k,"__esModule",{value:!0}),k.WebSocketTransport=void 0;const g=A(h(13257)),ms=globalThis.WebSocket||g.default;k.WebSocketTransport=class{constructor(s){this.events=s}send(s){s instanceof ArrayBuffer?this.ws.send(s):Array.isArray(s)&&this.ws.send(new Uint8Array(s).buffer)}connect(s,k){try{this.ws=new ms(s,{headers:k,protocols:this.protocols})}catch(h){this.ws=new ms(s,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(s,k){this.ws.close(s,k)}get isOpen(){return this.ws.readyState===ms.OPEN}}},13257:s=>{"use strict";s.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13703:s=>{"use strict";s.exports=function(s){for(var k=new Array(s),h=0;h<s;++h)k[h]=h;return k}},13706:s=>{function k(s){return!!s.constructor&&"function"===typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}s.exports=function(s){return null!=s&&(k(s)||function(s){return"function"===typeof s.readFloatLE&&"function"===typeof s.slice&&k(s.slice(0,0))}(s)||!!s._isBuffer)}},13696:(s,k,h)=>{var A=h(13703),g=h(13706),ms="undefined"!==typeof Float64Array;function i(s,k){return s[0]-k[0]}function K(){var s,k=this.stride,h=new Array(k.length);for(s=0;s<h.length;++s)h[s]=[Math.abs(k[s]),s];h.sort(i);var A=new Array(h.length);for(s=0;s<A.length;++s)A[s]=h[s][1];return A}function H(s,k){var h=["View",k,"d",s].join("");k<0&&(h="View_Nil"+s);var g="generic"===s;if(-1===k){var ms="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+s+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(ms)()}if(0===k){ms="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+s+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",ms)(O[s][0])}ms=["'use strict'"];var i=A(k),H=i.map((function(s){return"i"+s})),c="this.offset+"+i.map((function(s){return"this.stride["+s+"]*i"+s})).join("+"),S=i.map((function(s){return"b"+s})).join(","),a=i.map((function(s){return"c"+s})).join(",");ms.push("function "+h+"(a,"+S+","+a+",d){this.data=a","this.shape=["+S+"]","this.stride=["+a+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+s+"'","proto.dimension="+k),ms.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+i.map((function(s){return"this.shape["+s+"]"})).join("*"),"}})"),1===k?ms.push("proto.order=[0]"):(ms.push("Object.defineProperty(proto,'order',{get:"),k<4?(ms.push("function "+h+"_order(){"),2===k?ms.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===k&&ms.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):ms.push("ORDER})")),ms.push("proto.set=function "+h+"_set("+H.join(",")+",v){"),g?ms.push("return this.data.set("+c+",v)}"):ms.push("return this.data["+c+"]=v}"),ms.push("proto.get=function "+h+"_get("+H.join(",")+"){"),g?ms.push("return this.data.get("+c+")}"):ms.push("return this.data["+c+"]}"),ms.push("proto.index=function "+h+"_index(",H.join(),"){return "+c+"}"),ms.push("proto.hi=function "+h+"_hi("+H.join(",")+"){return new "+h+"(this.data,"+i.map((function(s){return["(typeof i",s,"!=='number'||i",s,"<0)?this.shape[",s,"]:i",s,"|0"].join("")})).join(",")+","+i.map((function(s){return"this.stride["+s+"]"})).join(",")+",this.offset)}");var r=i.map((function(s){return"a"+s+"=this.shape["+s+"]"})),d=i.map((function(s){return"c"+s+"=this.stride["+s+"]"}));ms.push("proto.lo=function "+h+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+r.join(",")+","+d.join(","));for(var E=0;E<k;++E)ms.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");ms.push("return new "+h+"(this.data,"+i.map((function(s){return"a"+s})).join(",")+","+i.map((function(s){return"c"+s})).join(",")+",b)}"),ms.push("proto.step=function "+h+"_step("+H.join(",")+"){var "+i.map((function(s){return"a"+s+"=this.shape["+s+"]"})).join(",")+","+i.map((function(s){return"b"+s+"=this.stride["+s+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<k;++E)ms.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");ms.push("return new "+h+"(this.data,"+i.map((function(s){return"a"+s})).join(",")+","+i.map((function(s){return"b"+s})).join(",")+",c)}");var j=new Array(k),P=new Array(k);for(E=0;E<k;++E)j[E]="a[i"+E+"]",P[E]="b[i"+E+"]";ms.push("proto.transpose=function "+h+"_transpose("+H+"){"+H.map((function(s,k){return s+"=("+s+"===undefined?"+k+":"+s+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+j.join(",")+","+P.join(",")+",this.offset)}"),ms.push("proto.pick=function "+h+"_pick("+H+"){var a=[],b=[],c=this.offset");for(E=0;E<k;++E)ms.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return ms.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),ms.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+i.map((function(s){return"shape["+s+"]"})).join(",")+","+i.map((function(s){return"stride["+s+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",ms.join("\n"))(O[s],K)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};s.exports=function(s,k,h,A){if(void 0===s)return(0,O.array[0])([]);"number"===typeof s&&(s=[s]),void 0===k&&(k=[s.length]);var i=k.length;if(void 0===h){h=new Array(i);for(var K=i-1,c=1;K>=0;--K)h[K]=c,c*=k[K]}if(void 0===A){A=0;for(K=0;K<i;++K)h[K]<0&&(A-=(k[K]-1)*h[K])}for(var S=function(s){if(g(s))return"buffer";if(ms)switch(Object.prototype.toString.call(s)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(s)?"array":"generic"}(s),a=O[S];a.length<=i+1;)a.push(H(S,a.length-1));return(0,a[i+1])(s,k,h,A)}},14697:s=>{var k;self,k=()=>(()=>{"use strict";var s={d:(k,h)=>{for(var A in h)s.o(h,A)&&!s.o(k,A)&&Object.defineProperty(k,A,{enumerable:!0,get:h[A]})},o:(s,k)=>Object.prototype.hasOwnProperty.call(s,k)},k={};s.d(k,{default:()=>v});var h,A=function(s,k){var h=k.x-s.x,A=k.y-s.y;return Math.sqrt(h*h+A*A)},g=function(s){return s*(Math.PI/180)},ms=new Map,i=function(s){ms.has(s)&&clearTimeout(ms.get(s)),ms.set(s,setTimeout(s,100))},K=function(s,k,h){for(var A,g=k.split(/[ ,]+/g),ms=0;ms<g.length;ms+=1)A=g[ms],s.addEventListener?s.addEventListener(A,h,!1):s.attachEvent&&s.attachEvent(A,h)},H=function(s,k,h){for(var A,g=k.split(/[ ,]+/g),ms=0;ms<g.length;ms+=1)A=g[ms],s.removeEventListener?s.removeEventListener(A,h):s.detachEvent&&s.detachEvent(A,h)},O=function(s){return s.preventDefault(),s.type.match(/^touch/)?s.changedTouches:s},c=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},S=function(s,k){k.top||k.right||k.bottom||k.left?(s.style.top=k.top,s.style.right=k.right,s.style.bottom=k.bottom,s.style.left=k.left):(s.style.left=k.x+"px",s.style.top=k.y+"px")},a=function(s,k,h){var A=r(s);for(var g in A)if(A.hasOwnProperty(g))if("string"==typeof k)A[g]=k+" "+h;else{for(var ms="",i=0,K=k.length;i<K;i+=1)ms+=k[i]+" "+h+", ";A[g]=ms.slice(0,-2)}return A},r=function(s){var k={};return k[s]="",["webkit","Moz","o"].forEach((function(h){k[h+s.charAt(0).toUpperCase()+s.slice(1)]=""})),k},d=function(s,k){for(var h in k)k.hasOwnProperty(h)&&(s[h]=k[h]);return s},E=function(s,k){if(s.length)for(var h=0,A=s.length;h<A;h+=1)k(s[h]);else k(s)},j="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,P=window.matchMedia("(any-hover: none)").matches,R=!!("ontouchstart"in window),D=!!window.PointerEvent,w=!!window.MSPointerEvent,B={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},u={start:"mousedown",move:"mousemove",end:"mouseup"},G={};function Q(){}j&&!P?h=B:D?h={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:w?h={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:R?(h=B,G=u):h=u,Q.prototype.on=function(s,k){var h,A=this,g=s.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var ms=0;ms<g.length;ms+=1)h=g[ms],A._handlers_[h]=A._handlers_[h]||[],A._handlers_[h].push(k);return A},Q.prototype.off=function(s,k){var h=this;return h._handlers_=h._handlers_||{},void 0===s?h._handlers_={}:void 0===k?h._handlers_[s]=null:h._handlers_[s]&&h._handlers_[s].indexOf(k)>=0&&h._handlers_[s].splice(h._handlers_[s].indexOf(k),1),h},Q.prototype.trigger=function(s,k){var h,A=this,g=s.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var ms=0;ms<g.length;ms+=1)h=g[ms],A._handlers_[h]&&A._handlers_[h].length&&A._handlers_[h].forEach((function(s){s.call(A,{type:h,target:A},k)}))},Q.prototype.config=function(s){var k=this;k.options=k.defaults||{},s&&(k.options=function(s,k){var h={};for(var A in s)s.hasOwnProperty(A)&&k.hasOwnProperty(A)?h[A]=k[A]:s.hasOwnProperty(A)&&(h[A]=s[A]);return h}(k.options,s))},Q.prototype.bindEvt=function(s,k){var A=this;return A._domHandlers_=A._domHandlers_||{},A._domHandlers_[k]=function(){"function"==typeof A["on"+k]?A["on"+k].apply(A,arguments):console.warn('[WARNING] : Missing "on'+k+'" handler.')},K(s,h[k],A._domHandlers_[k]),G[k]&&K(s,G[k],A._domHandlers_[k]),A},Q.prototype.unbindEvt=function(s,k){var A=this;return A._domHandlers_=A._domHandlers_||{},H(s,h[k],A._domHandlers_[k]),G[k]&&H(s,G[k],A._domHandlers_[k]),delete A._domHandlers_[k],this};const p=Q;function I(s,k){return this.identifier=k.identifier,this.position=k.position,this.frontPosition=k.frontPosition,this.collection=s,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(k),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=I.id,I.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}I.prototype=new p,I.constructor=I,I.id=0,I.prototype.buildEl=function(s){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},I.prototype.stylize=function(){if(this.options.dataOnly)return this;var s=this.options.fadeTime+"ms",k=function(){var s=r("borderRadius");for(var k in s)s.hasOwnProperty(k)&&(s[k]="50%");return s}(),h=a("transition","opacity",s),A={};return A.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},A.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},A.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},d(A.el,h),"circle"===this.options.shape&&d(A.back,k),d(A.front,k),this.applyStyles(A),this},I.prototype.applyStyles=function(s){for(var k in this.ui)if(this.ui.hasOwnProperty(k))for(var h in s[k])this.ui[k].style[h]=s[k][h];return this},I.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},I.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},I.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},I.prototype.show=function(s){var k=this;return k.options.dataOnly||(clearTimeout(k.removeTimeout),clearTimeout(k.showTimeout),clearTimeout(k.restTimeout),k.addToDom(),k.restCallback(),setTimeout((function(){k.ui.el.style.opacity=1}),0),k.showTimeout=setTimeout((function(){k.trigger("shown",k.instance),"function"==typeof s&&s.call(this)}),k.options.fadeTime)),k},I.prototype.hide=function(s){var k=this;if(k.options.dataOnly)return k;if(k.ui.el.style.opacity=k.options.restOpacity,clearTimeout(k.removeTimeout),clearTimeout(k.showTimeout),clearTimeout(k.restTimeout),k.removeTimeout=setTimeout((function(){var h="dynamic"===k.options.mode?"none":"block";k.ui.el.style.display=h,"function"==typeof s&&s.call(k),k.trigger("hidden",k.instance)}),k.options.fadeTime),k.options.restJoystick){var h=k.options.restJoystick,A={};A.x=!0===h||!1!==h.x?0:k.instance.frontPosition.x,A.y=!0===h||!1!==h.y?0:k.instance.frontPosition.y,k.setPosition(s,A)}return k},I.prototype.setPosition=function(s,k){var h=this;h.frontPosition={x:k.x,y:k.y};var A=h.options.fadeTime+"ms",g={};g.front=a("transition",["transform"],A);var ms={front:{}};ms.front={transform:"translate("+h.frontPosition.x+"px,"+h.frontPosition.y+"px)"},h.applyStyles(g),h.applyStyles(ms),h.restTimeout=setTimeout((function(){"function"==typeof s&&s.call(h),h.restCallback()}),h.options.fadeTime)},I.prototype.restCallback=function(){var s=this,k={};k.front=a("transition","none",""),s.applyStyles(k),s.trigger("rested",s.instance)},I.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},I.prototype.computeDirection=function(s){var k,h,A,g=s.angle.radian,ms=Math.PI/4,i=Math.PI/2;if(g>ms&&g<3*ms&&!s.lockX?k="up":g>-ms&&g<=ms&&!s.lockY?k="left":g>3*-ms&&g<=-ms&&!s.lockX?k="down":s.lockY||(k="right"),s.lockY||(h=g>-i&&g<i?"left":"right"),s.lockX||(A=g>0?"up":"down"),s.force>this.options.threshold){var K,H={};for(K in this.direction)this.direction.hasOwnProperty(K)&&(H[K]=this.direction[K]);var O={};for(K in this.direction={x:h,y:A,angle:k},s.direction=this.direction,H)H[K]===this.direction[K]&&(O[K]=!0);if(O.x&&O.y&&O.angle)return s;O.x&&O.y||this.trigger("plain",s),O.x||this.trigger("plain:"+h,s),O.y||this.trigger("plain:"+A,s),O.angle||this.trigger("dir dir:"+k,s)}else this.resetDirection();return s};const N=I;function b(s,k){var h=this;h.nipples=[],h.idles=[],h.actives=[],h.ids=[],h.pressureIntervals={},h.manager=s,h.id=b.id,b.id+=1,h.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},h.config(k),"static"!==h.options.mode&&"semi"!==h.options.mode||(h.options.multitouch=!1),h.options.multitouch||(h.options.maxNumberOfNipples=1);var A=getComputedStyle(h.options.zone.parentElement);return A&&"flex"===A.display&&(h.parentIsFlex=!0),h.updateBox(),h.prepareNipples(),h.gr(),h.begin(),h.nipples}b.prototype=new p,b.constructor=b,b.id=0,b.prototype.prepareNipples=function(){var s=this,k=s.nipples;k.on=s.on.bind(s),k.off=s.off.bind(s),k.options=s.options,k.destroy=s.destroy.bind(s),k.ids=s.ids,k.id=s.id,k.processOnMove=s.processOnMove.bind(s),k.processOnEnd=s.processOnEnd.bind(s),k.get=function(s){if(void 0===s)return k[0];for(var h=0,A=k.length;h<A;h+=1)if(k[h].identifier===s)return k[h];return!1}},b.prototype.gr=function(){var s=this;s.bindEvt(s.options.zone,"start"),s.options.zone.style.touchAction="none",s.options.zone.style.msTouchAction="none"},b.prototype.begin=function(){var s=this,k=s.options;if("static"===k.mode){var h=s.createNipple(k.position,s.manager.getIdentifier());h.add(),s.idles.push(h)}},b.prototype.createNipple=function(s,k){var h=this,A=h.manager.scroll,g={},ms=h.options,i=h.parentIsFlex?A.x:A.x+h.box.left,K=h.parentIsFlex?A.y:A.y+h.box.top;if(s.x&&s.y)g={x:s.x-i,y:s.y-K};else if(s.top||s.right||s.bottom||s.left){var H=document.createElement("DIV");H.style.display="hidden",H.style.top=s.top,H.style.right=s.right,H.style.bottom=s.bottom,H.style.left=s.left,H.style.position="absolute",ms.zone.appendChild(H);var O=H.getBoundingClientRect();ms.zone.removeChild(H),g=s,s={x:O.left+A.x,y:O.top+A.y}}var c=new N(h,{color:ms.color,size:ms.size,threshold:ms.threshold,fadeTime:ms.fadeTime,dataOnly:ms.dataOnly,restJoystick:ms.restJoystick,restOpacity:ms.restOpacity,mode:ms.mode,identifier:k,position:s,zone:ms.zone,frontPosition:{x:0,y:0},shape:ms.shape});return ms.dataOnly||(S(c.ui.el,g),S(c.ui.front,c.frontPosition)),h.nipples.push(c),h.trigger("added "+c.identifier+":added",c),h.manager.trigger("added "+c.identifier+":added",c),h.bindNipple(c),c},b.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},b.prototype.bindNipple=function(s){var k,h=this,A=function(s,A){k=s.type+" "+A.id+":"+s.type,h.trigger(k,A)};s.on("destroyed",h.onDestroyed.bind(h)),s.on("shown hidden rested dir plain",A),s.on("dir:up dir:right dir:down dir:left",A),s.on("plain:up plain:right plain:down plain:left",A)},b.prototype.pressureFn=function(s,k,h){var A=this,g=0;clearInterval(A.pressureIntervals[h]),A.pressureIntervals[h]=setInterval(function(){var h=s.force||s.pressure||s.webkitForce||0;h!==g&&(k.trigger("pressure",h),A.trigger("pressure "+k.identifier+":pressure",h),g=h)}.bind(A),100)},b.prototype.onstart=function(s){var k=this,h=k.options,A=s;return s=O(s),k.updateBox(),E(s,(function(g){k.actives.length<h.maxNumberOfNipples?k.processOnStart(g):A.type.match(/^touch/)&&(Object.keys(k.manager.ids).forEach((function(h){if(Object.values(A.touches).findIndex((function(s){return s.identifier===h}))<0){var g=[s[0]];g.identifier=h,k.processOnEnd(g)}})),k.actives.length<h.maxNumberOfNipples&&k.processOnStart(g))})),k.manager.bindDocument(),!1},b.prototype.processOnStart=function(s){var k,h=this,g=h.options,ms=h.manager.getIdentifier(s),i=s.force||s.pressure||s.webkitForce||0,K={x:s.pageX,y:s.pageY},H=h.getOrCreate(ms,K);H.identifier!==ms&&h.manager.removeIdentifier(H.identifier),H.identifier=ms;var O=function(k){k.trigger("start",k),h.trigger("start "+k.id+":start",k),k.show(),i>0&&h.pressureFn(s,k,k.identifier),h.processOnMove(s)};if((k=h.idles.indexOf(H))>=0&&h.idles.splice(k,1),h.actives.push(H),h.ids.push(H.identifier),"semi"!==g.mode)O(H);else{if(!(A(K,H.position)<=g.catchDistance))return H.destroy(),void h.processOnStart(s);O(H)}return H},b.prototype.getOrCreate=function(s,k){var h,A=this,g=A.options;return/(semi|static)/.test(g.mode)?(h=A.idles[0])?(A.idles.splice(0,1),h):"semi"===g.mode?A.createNipple(k,s):(console.warn("Coudln't find the needed nipple."),!1):h=A.createNipple(k,s)},b.prototype.processOnMove=function(s){var k=this,h=k.options,ms=k.manager.getIdentifier(s),i=k.nipples.get(ms),K=k.manager.scroll;if(function(s){return isNaN(s.buttons)?0!==s.pressure:0!==s.buttons}(s)){if(!i)return console.error("Found zombie joystick with ID "+ms),void k.manager.removeIdentifier(ms);if(h.dynamicPage){var H=i.el.getBoundingClientRect();i.position={x:K.x+H.left,y:K.y+H.top}}i.identifier=ms;var O=i.options.size/2,c={x:s.pageX,y:s.pageY};h.lockX&&(c.y=i.position.y),h.lockY&&(c.x=i.position.x);var S,a,r,d,E,j,P,R,D,w,B=A(c,i.position),u=(S=c,r=(a=i.position).x-S.x,d=a.y-S.y,function(s){return s*(180/Math.PI)}(Math.atan2(d,r))),G=g(u),Q=B/O,p={distance:B,position:c};if("circle"===i.options.shape?(E=Math.min(B,O),P=i.position,R=E,w={x:0,y:0},D=g(D=u),w.x=P.x-R*Math.cos(D),w.y=P.y-R*Math.sin(D),j=w):(j=function(s,k,h){return{x:Math.min(Math.max(s.x,k.x-h),k.x+h),y:Math.min(Math.max(s.y,k.y-h),k.y+h)}}(c,i.position,O),E=A(j,i.position)),h.follow){if(B>O){var I=c.x-j.x,N=c.y-j.y;i.position.x+=I,i.position.y+=N,i.el.style.top=i.position.y-(k.box.top+K.y)+"px",i.el.style.left=i.position.x-(k.box.left+K.x)+"px",B=A(c,i.position)}}else c=j,B=E;var b=c.x-i.position.x,t=c.y-i.position.y;i.frontPosition={x:b,y:t},h.dataOnly||(i.ui.front.style.transform="translate("+b+"px,"+t+"px)");var z={identifier:i.identifier,position:c,force:Q,pressure:s.force||s.pressure||s.webkitForce||0,distance:B,angle:{radian:G,degree:u},vector:{x:b/O,y:-t/O},raw:p,instance:i,lockX:h.lockX,lockY:h.lockY};(z=i.computeDirection(z)).angle={radian:g(180-u),degree:180-u},i.trigger("move",z),k.trigger("move "+i.id+":move",z)}else this.processOnEnd(s)},b.prototype.processOnEnd=function(s){var k=this,h=k.options,A=k.manager.getIdentifier(s),g=k.nipples.get(A),ms=k.manager.removeIdentifier(g.identifier);g&&(h.dataOnly||g.hide((function(){"dynamic"===h.mode&&(g.trigger("removed",g),k.trigger("removed "+g.id+":removed",g),k.manager.trigger("removed "+g.id+":removed",g),g.destroy())})),clearInterval(k.pressureIntervals[g.identifier]),g.resetDirection(),g.trigger("end",g),k.trigger("end "+g.id+":end",g),k.ids.indexOf(g.identifier)>=0&&k.ids.splice(k.ids.indexOf(g.identifier),1),k.actives.indexOf(g)>=0&&k.actives.splice(k.actives.indexOf(g),1),/(semi|static)/.test(h.mode)?k.idles.push(g):k.nipples.indexOf(g)>=0&&k.nipples.splice(k.nipples.indexOf(g),1),k.manager.unbindDocument(),/(semi|static)/.test(h.mode)&&(k.manager.ids[ms.id]=ms.identifier))},b.prototype.onDestroyed=function(s,k){var h=this;h.nipples.indexOf(k)>=0&&h.nipples.splice(h.nipples.indexOf(k),1),h.actives.indexOf(k)>=0&&h.actives.splice(h.actives.indexOf(k),1),h.idles.indexOf(k)>=0&&h.idles.splice(h.idles.indexOf(k),1),h.ids.indexOf(k.identifier)>=0&&h.ids.splice(h.ids.indexOf(k.identifier),1),h.manager.removeIdentifier(k.identifier),h.manager.unbindDocument()},b.prototype.destroy=function(){var s=this;for(var k in s.unbindEvt(s.options.zone,"start"),s.nipples.forEach((function(s){s.destroy()})),s.pressureIntervals)s.pressureIntervals.hasOwnProperty(k)&&clearInterval(s.pressureIntervals[k]);s.trigger("destroyed",s.nipples),s.manager.unbindDocument(),s.off()};const t=b;function z(s){var k=this;k.ids={},k.index=0,k.collections=[],k.scroll=c(),k.config(s),k.prepareCollections();var h=function(){var s;k.collections.forEach((function(h){h.forEach((function(h){s=h.el.getBoundingClientRect(),h.position={x:k.scroll.x+s.left,y:k.scroll.y+s.top}}))}))};K(window,"resize",(function(){i(h)}));var A=function(){k.scroll=c()};return K(window,"scroll",(function(){i(A)})),k.collections}z.prototype=new p,z.constructor=z,z.prototype.prepareCollections=function(){var s=this;s.collections.create=s.create.bind(s),s.collections.on=s.on.bind(s),s.collections.off=s.off.bind(s),s.collections.destroy=s.destroy.bind(s),s.collections.get=function(k){var h;return s.collections.every((function(s){return!(h=s.get(k))})),h}},z.prototype.create=function(s){return this.createCollection(s)},z.prototype.createCollection=function(s){var k=this,h=new t(k,s);return k.bindCollection(h),k.collections.push(h),h},z.prototype.bindCollection=function(s){var k,h=this,A=function(s,A){k=s.type+" "+A.id+":"+s.type,h.trigger(k,A)};s.on("destroyed",h.onDestroyed.bind(h)),s.on("shown hidden rested dir plain",A),s.on("dir:up dir:right dir:down dir:left",A),s.on("plain:up plain:right plain:down plain:left",A)},z.prototype.bindDocument=function(){var s=this;s.binded||(s.bindEvt(document,"move").bindEvt(document,"end"),s.binded=!0)},z.prototype.unbindDocument=function(s){var k=this;Object.keys(k.ids).length&&!0!==s||(k.unbindEvt(document,"move").unbindEvt(document,"end"),k.binded=!1)},z.prototype.getIdentifier=function(s){var k;return s?void 0===(k=void 0===s.identifier?s.pointerId:s.identifier)&&(k=this.latest||0):k=this.index,void 0===this.ids[k]&&(this.ids[k]=this.index,this.index+=1),this.latest=k,this.ids[k]},z.prototype.removeIdentifier=function(s){var k={};for(var h in this.ids)if(this.ids[h]===s){k.id=h,k.identifier=this.ids[h],delete this.ids[h];break}return k},z.prototype.onmove=function(s){return this.onAny("move",s),!1},z.prototype.onend=function(s){return this.onAny("end",s),!1},z.prototype.oncancel=function(s){return this.onAny("end",s),!1},z.prototype.onAny=function(s,k){var h,A=this,g="processOn"+s.charAt(0).toUpperCase()+s.slice(1);k=O(k);var ms=function(s,k,h){h.ids.indexOf(k)>=0&&(h[g](s),s._found_=!0)};return E(k,(function(s){h=A.getIdentifier(s),E(A.collections,ms.bind(null,s,h)),s._found_||A.removeIdentifier(h)})),!1},z.prototype.destroy=function(){var s=this;s.unbindDocument(!0),s.ids={},s.index=0,s.collections.forEach((function(s){s.destroy()})),s.off()},z.prototype.onDestroyed=function(s,k){var h=this;if(h.collections.indexOf(k)<0)return!1;h.collections.splice(h.collections.indexOf(k),1)};var C=new z;const v={create:function(s){return C.create(s)},factory:C};return k.default})(),s.exports=k()},13729:(s,k,h)=>{"use strict";const{Deflate:A,deflate:g,deflateRaw:ms,gzip:i}=h(13736),{Inflate:K,inflate:H,inflateRaw:O,ungzip:c}=h(13783),S=h(13768);s.exports.Deflate=A,s.exports.deflate=g,s.exports.deflateRaw=ms,s.exports.gzip=i,s.exports.Inflate=K,s.exports.inflate=H,s.exports.inflateRaw=O,s.exports.ungzip=c,s.exports.constants=S},13736:(s,k,h)=>{"use strict";const A=h(13740),g=h(13771),ms=h(13774),i=h(13763),K=h(13777),H=Object.prototype.toString,{Z_NO_FLUSH:O,Z_SYNC_FLUSH:c,Z_FULL_FLUSH:S,Z_FINISH:a,Z_OK:r,Z_STREAM_END:d,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:j,Z_DEFLATED:P}=h(13768);function R(s){this.options=g.assign({level:E,method:P,Xs:16384,windowBits:15,memLevel:8,strategy:j},s||{});let k=this.options;k.raw&&k.windowBits>0?k.windowBits=-k.windowBits:k.gzip&&k.windowBits>0&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.ak="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;let h=A.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(h!==r)throw new Error(i[h]);if(k.header&&A.deflateSetHeader(this.strm,k.header),k.dictionary){let s;if(s="string"===typeof k.dictionary?ms.string2buf(k.dictionary):"[object ArrayBuffer]"===H.call(k.dictionary)?new Uint8Array(k.dictionary):k.dictionary,h=A.deflateSetDictionary(this.strm,s),h!==r)throw new Error(i[h]);this._dict_set=!0}}function D(s,k){const h=new R(k);if(h.push(s,!0),h.err)throw h.ak||i[h.err];return h.result}R.prototype.push=function(s,k){const h=this.strm,g=this.options.Xs;let i,K;if(this.ended)return!1;for(K=k===~~k?k:!0===k?a:O,"string"===typeof s?h.input=ms.string2buf(s):"[object ArrayBuffer]"===H.call(s)?h.input=new Uint8Array(s):h.input=s,h.next_in=0,h.avail_in=h.input.length;;)if(0===h.avail_out&&(h.output=new Uint8Array(g),h.next_out=0,h.avail_out=g),(K===c||K===S)&&h.avail_out<=6)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else{if(i=A.deflate(h,K),i===d)return h.next_out>0&&this.onData(h.output.subarray(0,h.next_out)),i=A.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===r;if(0!==h.avail_out){if(K>0&&h.next_out>0)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else if(0===h.avail_in)break}else this.onData(h.output)}return!0},R.prototype.onData=function(s){this.chunks.push(s)},R.prototype.onEnd=function(s){s===r&&(this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.ak=this.strm.ak},s.exports.Deflate=R,s.exports.deflate=D,s.exports.deflateRaw=function(s,k){return(k=k||{}).raw=!0,D(s,k)},s.exports.gzip=function(s,k){return(k=k||{}).gzip=!0,D(s,k)},s.exports.constants=h(13768)},13783:(s,k,h)=>{"use strict";const A=h(13791),g=h(13771),ms=h(13774),i=h(13763),K=h(13777),H=h(13809),O=Object.prototype.toString,{Z_NO_FLUSH:c,Z_FINISH:S,Z_OK:a,Z_STREAM_END:r,Z_NEED_DICT:d,Z_STREAM_ERROR:E,Z_DATA_ERROR:j,Z_MEM_ERROR:P}=h(13768);function R(s){this.options=g.assign({Xs:65536,windowBits:15,to:""},s||{});const k=this.options;k.raw&&k.windowBits>=0&&k.windowBits<16&&(k.windowBits=-k.windowBits,0===k.windowBits&&(k.windowBits=-15)),!(k.windowBits>=0&&k.windowBits<16)||s&&s.windowBits||(k.windowBits+=32),k.windowBits>15&&k.windowBits<48&&0===(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.ak="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;let h=A.inflateInit2(this.strm,k.windowBits);if(h!==a)throw new Error(i[h]);if(this.header=new H,A.inflateGetHeader(this.strm,this.header),k.dictionary&&("string"===typeof k.dictionary?k.dictionary=ms.string2buf(k.dictionary):"[object ArrayBuffer]"===O.call(k.dictionary)&&(k.dictionary=new Uint8Array(k.dictionary)),k.raw&&(h=A.inflateSetDictionary(this.strm,k.dictionary),h!==a)))throw new Error(i[h])}function D(s,k){const h=new R(k);if(h.push(s),h.err)throw h.ak||i[h.err];return h.result}R.prototype.push=function(s,k){const h=this.strm,g=this.options.Xs,i=this.options.dictionary;let K,H,R;if(this.ended)return!1;for(H=k===~~k?k:!0===k?S:c,"[object ArrayBuffer]"===O.call(s)?h.input=new Uint8Array(s):h.input=s,h.next_in=0,h.avail_in=h.input.length;;){for(0===h.avail_out&&(h.output=new Uint8Array(g),h.next_out=0,h.avail_out=g),K=A.inflate(h,H),K===d&&i&&(K=A.inflateSetDictionary(h,i),K===a?K=A.inflate(h,H):K===j&&(K=d));h.avail_in>0&&K===r&&h.state.wrap>0&&0!==s[h.next_in];)A.inflateReset(h),K=A.inflate(h,H);switch(K){case E:case j:case d:case P:return this.onEnd(K),this.ended=!0,!1}if(R=h.avail_out,h.next_out&&(0===h.avail_out||K===r))if("string"===this.options.to){let s=ms.utf8border(h.output,h.next_out),k=h.next_out-s,A=ms.buf2string(h.output,s);h.next_out=k,h.avail_out=g-k,k&&h.output.set(h.output.subarray(s,s+k),0),this.onData(A)}else this.onData(h.output.length===h.next_out?h.output:h.output.subarray(0,h.next_out));if(K!==a||0!==R){if(K===r)return K=A.inflateEnd(this.strm),this.onEnd(K),this.ended=!0,!0;if(0===h.avail_in)break}}return!0},R.prototype.onData=function(s){this.chunks.push(s)},R.prototype.onEnd=function(s){s===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.ak=this.strm.ak},s.exports.Inflate=R,s.exports.inflate=D,s.exports.inflateRaw=function(s,k){return(k=k||{}).raw=!0,D(s,k)},s.exports.ungzip=D,s.exports.constants=h(13768)},13771:s=>{"use strict";const k=(s,k)=>Object.prototype.hasOwnProperty.call(s,k);s.exports.assign=function(s){const h=Array.prototype.slice.call(arguments,1);for(;h.length;){const A=h.shift();if(A){if("object"!==typeof A)throw new TypeError(A+"must be non-object");for(const h in A)k(A,h)&&(s[h]=A[h])}}return s},s.exports.flattenChunks=s=>{let k=0;for(let A=0,g=s.length;A<g;A++)k+=s[A].length;const h=new Uint8Array(k);for(let A=0,g=0,ms=s.length;A<ms;A++){let k=s[A];h.set(k,g),g+=k.length}return h}},13774:s=>{"use strict";let k=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){k=!1}const h=new Uint8Array(256);for(let g=0;g<256;g++)h[g]=g>=252?6:g>=248?5:g>=240?4:g>=224?3:g>=192?2:1;h[254]=h[254]=1,s.exports.string2buf=s=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let k,h,A,g,ms,i=s.length,K=0;for(g=0;g<i;g++)h=s.charCodeAt(g),55296===(64512&h)&&g+1<i&&(A=s.charCodeAt(g+1),56320===(64512&A)&&(h=65536+(h-55296<<10)+(A-56320),g++)),K+=h<128?1:h<2048?2:h<65536?3:4;for(k=new Uint8Array(K),ms=0,g=0;ms<K;g++)h=s.charCodeAt(g),55296===(64512&h)&&g+1<i&&(A=s.charCodeAt(g+1),56320===(64512&A)&&(h=65536+(h-55296<<10)+(A-56320),g++)),h<128?k[ms++]=h:h<2048?(k[ms++]=192|h>>>6,k[ms++]=128|63&h):h<65536?(k[ms++]=224|h>>>12,k[ms++]=128|h>>>6&63,k[ms++]=128|63&h):(k[ms++]=240|h>>>18,k[ms++]=128|h>>>12&63,k[ms++]=128|h>>>6&63,k[ms++]=128|63&h);return k};s.exports.buf2string=(s,A)=>{const g=A||s.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,A));let ms,i;const K=new Array(2*g);for(i=0,ms=0;ms<g;){let k=s[ms++];if(k<128){K[i++]=k;continue}let A=h[k];if(A>4)K[i++]=65533,ms+=A-1;else{for(k&=2===A?31:3===A?15:7;A>1&&ms<g;)k=k<<6|63&s[ms++],A--;A>1?K[i++]=65533:k<65536?K[i++]=k:(k-=65536,K[i++]=55296|k>>10&1023,K[i++]=56320|1023&k)}}return((s,h)=>{if(h<65534&&s.subarray&&k)return String.fromCharCode.apply(null,s.length===h?s:s.subarray(0,h));let A="";for(let k=0;k<h;k++)A+=String.fromCharCode(s[k]);return A})(K,i)},s.exports.utf8border=(s,k)=>{(k=k||s.length)>s.length&&(k=s.length);let A=k-1;for(;A>=0&&128===(192&s[A]);)A--;return A<0||0===A?k:A+h[s[A]]>k?A:k}},13753:s=>{"use strict";s.exports=(s,k,h,A)=>{let g=65535&s,ms=s>>>16&65535,i=0;for(;0!==h;){i=h>2e3?2e3:h,h-=i;do{g=g+k[A++]|0,ms=ms+g|0}while(--i);g%=65521,ms%=65521}return g|ms<<16}},13768:s=>{"use strict";s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13757:s=>{"use strict";const k=new Uint32Array((()=>{let s,k=[];for(var h=0;h<256;h++){s=h;for(var A=0;A<8;A++)s=1&s?3988292384^s>>>1:s>>>1;k[h]=s}return k})());s.exports=(s,h,A,g)=>{const ms=k,i=g+A;s^=-1;for(let k=g;k<i;k++)s=s>>>8^ms[255&(s^h[k])];return~s}},13740:(s,k,h)=>{"use strict";const{_tr_init:A,_tr_stored_block:g,_tr_flush_block:ms,_tr_tally:i,_tr_align:K}=h(13749),H=h(13753),O=h(13757),c=h(13763),{Z_NO_FLUSH:S,Z_PARTIAL_FLUSH:a,Z_FULL_FLUSH:r,Z_FINISH:d,Z_BLOCK:E,Z_OK:j,Z_STREAM_END:P,Z_STREAM_ERROR:R,Z_DATA_ERROR:D,Z_BUF_ERROR:w,Z_DEFAULT_COMPRESSION:B,Z_FILTERED:u,Z_HUFFMAN_ONLY:G,Z_RLE:Q,Z_FIXED:p,Z_DEFAULT_STRATEGY:I,Z_UNKNOWN:N,Z_DEFLATED:b}=h(13768),t=258,z=262,C=103,v=113,Y=666,n=(s,k)=>(s.ak=c[k],k),T=s=>(s<<1)-(s>4?9:0),U=s=>{let k=s.length;for(;--k>=0;)s[k]=0};let q=(s,k,h)=>(k<<s.hash_shift^h)&s.hash_mask;const M=s=>{const k=s.state;let h=k.pending;h>s.avail_out&&(h=s.avail_out),0!==h&&(s.output.set(k.pending_buf.subarray(k.pending_out,k.pending_out+h),s.next_out),s.next_out+=h,k.pending_out+=h,s.total_out+=h,s.avail_out-=h,k.pending-=h,0===k.pending&&(k.pending_out=0))},V=(s,k)=>{ms(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,k),s.block_start=s.strstart,M(s.strm)},X=(s,k)=>{s.pending_buf[s.pending++]=k},L=(s,k)=>{s.pending_buf[s.pending++]=k>>>8&255,s.pending_buf[s.pending++]=255&k},Z=(s,k,h,A)=>{let g=s.avail_in;return g>A&&(g=A),0===g?0:(s.avail_in-=g,k.set(s.input.subarray(s.next_in,s.next_in+g),h),1===s.state.wrap?s.adler=H(s.adler,k,g,h):2===s.state.wrap&&(s.adler=O(s.adler,k,g,h)),s.next_in+=g,s.total_in+=g,g)},x=(s,k)=>{let h,A,g=s.max_chain_length,ms=s.strstart,i=s.prev_length,K=s.nice_match;const H=s.strstart>s.w_size-z?s.strstart-(s.w_size-z):0,O=s.window,c=s.w_mask,S=s.prev,a=s.strstart+t;let r=O[ms+i-1],d=O[ms+i];s.prev_length>=s.good_match&&(g>>=2),K>s.lookahead&&(K=s.lookahead);do{if(h=k,O[h+i]===d&&O[h+i-1]===r&&O[h]===O[ms]&&O[++h]===O[ms+1]){ms+=2,h++;do{}while(O[++ms]===O[++h]&&O[++ms]===O[++h]&&O[++ms]===O[++h]&&O[++ms]===O[++h]&&O[++ms]===O[++h]&&O[++ms]===O[++h]&&O[++ms]===O[++h]&&O[++ms]===O[++h]&&ms<a);if(A=t-(a-ms),ms=a-t,A>i){if(s.match_start=k,i=A,A>=K)break;r=O[ms+i-1],d=O[ms+i]}}}while((k=S[k&c])>H&&0!==--g);return i<=s.lookahead?i:s.lookahead},y=s=>{const k=s.w_size;let h,A,g,ms,i;do{if(ms=s.window_size-s.lookahead-s.strstart,s.strstart>=k+(k-z)){s.window.set(s.window.subarray(k,k+k),0),s.match_start-=k,s.strstart-=k,s.block_start-=k,A=s.hash_size,h=A;do{g=s.head[--h],s.head[h]=g>=k?g-k:0}while(--A);A=k,h=A;do{g=s.prev[--h],s.prev[h]=g>=k?g-k:0}while(--A);ms+=k}if(0===s.strm.avail_in)break;if(A=Z(s.strm,s.window,s.strstart+s.lookahead,ms),s.lookahead+=A,s.lookahead+s.insert>=3)for(i=s.strstart-s.insert,s.ins_h=s.window[i],s.ins_h=q(s,s.ins_h,s.window[i+1]);s.insert&&(s.ins_h=q(s,s.ins_h,s.window[i+3-1]),s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<z&&0!==s.strm.avail_in)},W=(s,k)=>{let h,A;for(;;){if(s.lookahead<z){if(y(s),s.lookahead<z&&k===S)return 1;if(0===s.lookahead)break}if(h=0,s.lookahead>=3&&(s.ins_h=q(s,s.ins_h,s.window[s.strstart+3-1]),h=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==h&&s.strstart-h<=s.w_size-z&&(s.match_length=x(s,h)),s.match_length>=3)if(A=i(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=q(s,s.ins_h,s.window[s.strstart+3-1]),h=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!==--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=q(s,s.ins_h,s.window[s.strstart+1]);else A=i(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(A&&(V(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,k===d?(V(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(V(s,!1),0===s.strm.avail_out)?1:2},J=(s,k)=>{let h,A,g;for(;;){if(s.lookahead<z){if(y(s),s.lookahead<z&&k===S)return 1;if(0===s.lookahead)break}if(h=0,s.lookahead>=3&&(s.ins_h=q(s,s.ins_h,s.window[s.strstart+3-1]),h=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==h&&s.prev_length<s.max_lazy_match&&s.strstart-h<=s.w_size-z&&(s.match_length=x(s,h),s.match_length<=5&&(s.strategy===u||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){g=s.strstart+s.lookahead-3,A=i(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=g&&(s.ins_h=q(s,s.ins_h,s.window[s.strstart+3-1]),h=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!==--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,A&&(V(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(A=i(s,0,s.window[s.strstart-1]),A&&V(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(A=i(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,k===d?(V(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(V(s,!1),0===s.strm.avail_out)?1:2};function F(s,k,h,A,g){this.good_length=s,this.max_lazy=k,this.nice_length=h,this.max_chain=A,this.func=g}const o=[new F(0,0,0,0,((s,k)=>{let h=65535;for(h>s.pending_buf_size-5&&(h=s.pending_buf_size-5);;){if(s.lookahead<=1){if(y(s),0===s.lookahead&&k===S)return 1;if(0===s.lookahead)break}s.strstart+=s.lookahead,s.lookahead=0;const A=s.block_start+h;if((0===s.strstart||s.strstart>=A)&&(s.lookahead=s.strstart-A,s.strstart=A,V(s,!1),0===s.strm.avail_out))return 1;if(s.strstart-s.block_start>=s.w_size-z&&(V(s,!1),0===s.strm.avail_out))return 1}return s.insert=0,k===d?(V(s,!0),0===s.strm.avail_out?3:4):(s.strstart>s.block_start&&(V(s,!1),s.strm.avail_out),1)})),new F(4,4,8,4,W),new F(4,5,16,8,W),new F(4,6,32,32,W),new F(4,4,16,16,J),new F(8,16,32,32,J),new F(8,16,128,128,J),new F(8,32,128,256,J),new F(32,128,258,1024,J),new F(32,258,258,4096,J)];function l(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const f=s=>{if(!s||!s.state)return n(s,R);s.total_in=s.total_out=0,s.data_type=N;const k=s.state;return k.pending=0,k.pending_out=0,k.wrap<0&&(k.wrap=-k.wrap),k.status=k.wrap?42:v,s.adler=2===k.wrap?0:1,k.last_flush=S,A(k),j},e=s=>{const k=f(s);var h;return k===j&&((h=s.state).window_size=2*h.w_size,U(h.head),h.max_lazy_match=o[h.level].max_lazy,h.good_match=o[h.level].good_length,h.nice_match=o[h.level].nice_length,h.max_chain_length=o[h.level].max_chain,h.strstart=0,h.block_start=0,h.lookahead=0,h.insert=0,h.match_length=h.prev_length=2,h.match_available=0,h.ins_h=0),k},ss=(s,k,h,A,g,ms)=>{if(!s)return R;let i=1;if(k===B&&(k=6),A<0?(i=0,A=-A):A>15&&(i=2,A-=16),g<1||g>9||h!==b||A<8||A>15||k<0||k>9||ms<0||ms>p)return n(s,R);8===A&&(A=9);const K=new l;return s.state=K,K.strm=s,K.wrap=i,K.gzhead=null,K.w_bits=A,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=g+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+3-1)/3),K.window=new Uint8Array(2*K.w_size),K.head=new Uint16Array(K.hash_size),K.prev=new Uint16Array(K.w_size),K.lit_bufsize=1<<g+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new Uint8Array(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=k,K.strategy=ms,K.method=h,e(s)};s.exports.deflateInit=(s,k)=>ss(s,k,b,15,8,I),s.exports.deflateInit2=ss,s.exports.deflateReset=e,s.exports.deflateResetKeep=f,s.exports.deflateSetHeader=(s,k)=>s&&s.state?2!==s.state.wrap?R:(s.state.gzhead=k,j):R,s.exports.deflate=(s,k)=>{let h,A;if(!s||!s.state||k>E||k<0)return s?n(s,R):R;const ms=s.state;if(!s.output||!s.input&&0!==s.avail_in||ms.status===Y&&k!==d)return n(s,0===s.avail_out?w:R);ms.strm=s;const H=ms.last_flush;if(ms.last_flush=k,42===ms.status)if(2===ms.wrap)s.adler=0,X(ms,31),X(ms,139),X(ms,8),ms.gzhead?(X(ms,(ms.gzhead.text?1:0)+(ms.gzhead.hcrc?2:0)+(ms.gzhead.extra?4:0)+(ms.gzhead.name?8:0)+(ms.gzhead.comment?16:0)),X(ms,255&ms.gzhead.time),X(ms,ms.gzhead.time>>8&255),X(ms,ms.gzhead.time>>16&255),X(ms,ms.gzhead.time>>24&255),X(ms,9===ms.level?2:ms.strategy>=G||ms.level<2?4:0),X(ms,255&ms.gzhead.os),ms.gzhead.extra&&ms.gzhead.extra.length&&(X(ms,255&ms.gzhead.extra.length),X(ms,ms.gzhead.extra.length>>8&255)),ms.gzhead.hcrc&&(s.adler=O(s.adler,ms.pending_buf,ms.pending,0)),ms.gzindex=0,ms.status=69):(X(ms,0),X(ms,0),X(ms,0),X(ms,0),X(ms,0),X(ms,9===ms.level?2:ms.strategy>=G||ms.level<2?4:0),X(ms,3),ms.status=v);else{let k=b+(ms.w_bits-8<<4)<<8,h=-1;h=ms.strategy>=G||ms.level<2?0:ms.level<6?1:6===ms.level?2:3,k|=h<<6,0!==ms.strstart&&(k|=32),k+=31-k%31,ms.status=v,L(ms,k),0!==ms.strstart&&(L(ms,s.adler>>>16),L(ms,65535&s.adler)),s.adler=1}if(69===ms.status)if(ms.gzhead.extra){for(h=ms.pending;ms.gzindex<(65535&ms.gzhead.extra.length)&&(ms.pending!==ms.pending_buf_size||(ms.gzhead.hcrc&&ms.pending>h&&(s.adler=O(s.adler,ms.pending_buf,ms.pending-h,h)),M(s),h=ms.pending,ms.pending!==ms.pending_buf_size));)X(ms,255&ms.gzhead.extra[ms.gzindex]),ms.gzindex++;ms.gzhead.hcrc&&ms.pending>h&&(s.adler=O(s.adler,ms.pending_buf,ms.pending-h,h)),ms.gzindex===ms.gzhead.extra.length&&(ms.gzindex=0,ms.status=73)}else ms.status=73;if(73===ms.status)if(ms.gzhead.name){h=ms.pending;do{if(ms.pending===ms.pending_buf_size&&(ms.gzhead.hcrc&&ms.pending>h&&(s.adler=O(s.adler,ms.pending_buf,ms.pending-h,h)),M(s),h=ms.pending,ms.pending===ms.pending_buf_size)){A=1;break}A=ms.gzindex<ms.gzhead.name.length?255&ms.gzhead.name.charCodeAt(ms.gzindex++):0,X(ms,A)}while(0!==A);ms.gzhead.hcrc&&ms.pending>h&&(s.adler=O(s.adler,ms.pending_buf,ms.pending-h,h)),0===A&&(ms.gzindex=0,ms.status=91)}else ms.status=91;if(91===ms.status)if(ms.gzhead.comment){h=ms.pending;do{if(ms.pending===ms.pending_buf_size&&(ms.gzhead.hcrc&&ms.pending>h&&(s.adler=O(s.adler,ms.pending_buf,ms.pending-h,h)),M(s),h=ms.pending,ms.pending===ms.pending_buf_size)){A=1;break}A=ms.gzindex<ms.gzhead.comment.length?255&ms.gzhead.comment.charCodeAt(ms.gzindex++):0,X(ms,A)}while(0!==A);ms.gzhead.hcrc&&ms.pending>h&&(s.adler=O(s.adler,ms.pending_buf,ms.pending-h,h)),0===A&&(ms.status=C)}else ms.status=C;if(ms.status===C&&(ms.gzhead.hcrc?(ms.pending+2>ms.pending_buf_size&&M(s),ms.pending+2<=ms.pending_buf_size&&(X(ms,255&s.adler),X(ms,s.adler>>8&255),s.adler=0,ms.status=v)):ms.status=v),0!==ms.pending){if(M(s),0===s.avail_out)return ms.last_flush=-1,j}else if(0===s.avail_in&&T(k)<=T(H)&&k!==d)return n(s,w);if(ms.status===Y&&0!==s.avail_in)return n(s,w);if(0!==s.avail_in||0!==ms.lookahead||k!==S&&ms.status!==Y){let h=ms.strategy===G?((s,k)=>{let h;for(;;){if(0===s.lookahead&&(y(s),0===s.lookahead)){if(k===S)return 1;break}if(s.match_length=0,h=i(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,h&&(V(s,!1),0===s.strm.avail_out))return 1}return s.insert=0,k===d?(V(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(V(s,!1),0===s.strm.avail_out)?1:2})(ms,k):ms.strategy===Q?((s,k)=>{let h,A,g,ms;const K=s.window;for(;;){if(s.lookahead<=t){if(y(s),s.lookahead<=t&&k===S)return 1;if(0===s.lookahead)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(g=s.strstart-1,A=K[g],A===K[++g]&&A===K[++g]&&A===K[++g])){ms=s.strstart+t;do{}while(A===K[++g]&&A===K[++g]&&A===K[++g]&&A===K[++g]&&A===K[++g]&&A===K[++g]&&A===K[++g]&&A===K[++g]&&g<ms);s.match_length=t-(ms-g),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(h=i(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(h=i(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),h&&(V(s,!1),0===s.strm.avail_out))return 1}return s.insert=0,k===d?(V(s,!0),0===s.strm.avail_out?3:4):s.last_lit&&(V(s,!1),0===s.strm.avail_out)?1:2})(ms,k):o[ms.level].func(ms,k);if(3!==h&&4!==h||(ms.status=Y),1===h||3===h)return 0===s.avail_out&&(ms.last_flush=-1),j;if(2===h&&(k===a?K(ms):k!==E&&(g(ms,0,0,!1),k===r&&(U(ms.head),0===ms.lookahead&&(ms.strstart=0,ms.block_start=0,ms.insert=0))),M(s),0===s.avail_out))return ms.last_flush=-1,j}return k!==d?j:ms.wrap<=0?P:(2===ms.wrap?(X(ms,255&s.adler),X(ms,s.adler>>8&255),X(ms,s.adler>>16&255),X(ms,s.adler>>24&255),X(ms,255&s.total_in),X(ms,s.total_in>>8&255),X(ms,s.total_in>>16&255),X(ms,s.total_in>>24&255)):(L(ms,s.adler>>>16),L(ms,65535&s.adler)),M(s),ms.wrap>0&&(ms.wrap=-ms.wrap),0!==ms.pending?j:P)},s.exports.deflateEnd=s=>{if(!s||!s.state)return R;const k=s.state.status;return 42!==k&&69!==k&&73!==k&&91!==k&&k!==C&&k!==v&&k!==Y?n(s,R):(s.state=null,k===v?n(s,D):j)},s.exports.deflateSetDictionary=(s,k)=>{let h=k.length;if(!s||!s.state)return R;const A=s.state,g=A.wrap;if(2===g||1===g&&42!==A.status||A.lookahead)return R;if(1===g&&(s.adler=H(s.adler,k,h,0)),A.wrap=0,h>=A.w_size){0===g&&(U(A.head),A.strstart=0,A.block_start=0,A.insert=0);let s=new Uint8Array(A.w_size);s.set(k.subarray(h-A.w_size,h),0),k=s,h=A.w_size}const ms=s.avail_in,i=s.next_in,K=s.input;for(s.avail_in=h,s.next_in=0,s.input=k,y(A);A.lookahead>=3;){let s=A.strstart,k=A.lookahead-2;do{A.ins_h=q(A,A.ins_h,A.window[s+3-1]),A.prev[s&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=s,s++}while(--k);A.strstart=s,A.lookahead=2,y(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=2,A.match_available=0,s.next_in=i,s.input=K,s.avail_in=ms,A.wrap=g,j},s.exports.deflateInfo="pako deflate (from Nodeca project)"},13809:s=>{"use strict";s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13799:s=>{"use strict";s.exports=function(s,k){let h,A,g,ms,i,K,H,O,c,S,a,r,d,E,j,P,R,D,w,B,u,G,Q,p;const I=s.state;h=s.next_in,Q=s.input,A=h+(s.avail_in-5),g=s.next_out,p=s.output,ms=g-(k-s.avail_out),i=g+(s.avail_out-257),K=I.dmax,H=I.wsize,O=I.whave,c=I.wnext,S=I.window,a=I.hold,r=I.bits,d=I.lencode,E=I.distcode,j=(1<<I.lenbits)-1,P=(1<<I.distbits)-1;s:do{r<15&&(a+=Q[h++]<<r,r+=8,a+=Q[h++]<<r,r+=8),R=d[a&j];k:for(;;){if(D=R>>>24,a>>>=D,r-=D,D=R>>>16&255,0===D)p[g++]=65535&R;else{if(!(16&D)){if(0===(64&D)){R=d[(65535&R)+(a&(1<<D)-1)];continue k}if(32&D){I.mode=12;break s}s.ak="invalid literal/length code",I.mode=30;break s}w=65535&R,D&=15,D&&(r<D&&(a+=Q[h++]<<r,r+=8),w+=a&(1<<D)-1,a>>>=D,r-=D),r<15&&(a+=Q[h++]<<r,r+=8,a+=Q[h++]<<r,r+=8),R=E[a&P];h:for(;;){if(D=R>>>24,a>>>=D,r-=D,D=R>>>16&255,!(16&D)){if(0===(64&D)){R=E[(65535&R)+(a&(1<<D)-1)];continue h}s.ak="invalid distance code",I.mode=30;break s}if(B=65535&R,D&=15,r<D&&(a+=Q[h++]<<r,r+=8,r<D&&(a+=Q[h++]<<r,r+=8)),B+=a&(1<<D)-1,B>K){s.ak="invalid distance too far back",I.mode=30;break s}if(a>>>=D,r-=D,D=g-ms,B>D){if(D=B-D,D>O&&I.sane){s.ak="invalid distance too far back",I.mode=30;break s}if(u=0,G=S,0===c){if(u+=H-D,D<w){w-=D;do{p[g++]=S[u++]}while(--D);u=g-B,G=p}}else if(c<D){if(u+=H+c-D,D-=c,D<w){w-=D;do{p[g++]=S[u++]}while(--D);if(u=0,c<w){D=c,w-=D;do{p[g++]=S[u++]}while(--D);u=g-B,G=p}}}else if(u+=c-D,D<w){w-=D;do{p[g++]=S[u++]}while(--D);u=g-B,G=p}for(;w>2;)p[g++]=G[u++],p[g++]=G[u++],p[g++]=G[u++],w-=3;w&&(p[g++]=G[u++],w>1&&(p[g++]=G[u++]))}else{u=g-B;do{p[g++]=p[u++],p[g++]=p[u++],p[g++]=p[u++],w-=3}while(w>2);w&&(p[g++]=p[u++],w>1&&(p[g++]=p[u++]))}break}}break}}while(h<A&&g<i);w=r>>3,h-=w,r-=w<<3,a&=(1<<r)-1,s.next_in=h,s.next_out=g,s.avail_in=h<A?A-h+5:5-(h-A),s.avail_out=g<i?i-g+257:257-(g-i),I.hold=a,I.bits=r}},13791:(s,k,h)=>{"use strict";const A=h(13753),g=h(13757),ms=h(13799),i=h(13806),{Z_FINISH:K,Z_BLOCK:H,Z_TREES:O,Z_OK:c,Z_STREAM_END:S,Z_NEED_DICT:a,Z_STREAM_ERROR:r,Z_DATA_ERROR:d,Z_MEM_ERROR:E,Z_BUF_ERROR:j,Z_DEFLATED:P}=h(13768),R=12,D=30,w=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function B(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const u=s=>{if(!s||!s.state)return r;const k=s.state;return s.total_in=s.total_out=k.total=0,s.ak="",k.wrap&&(s.adler=1&k.wrap),k.mode=1,k.last=0,k.havedict=0,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new Int32Array(852),k.distcode=k.distdyn=new Int32Array(592),k.sane=1,k.back=-1,c},G=s=>{if(!s||!s.state)return r;const k=s.state;return k.wsize=0,k.whave=0,k.wnext=0,u(s)},Q=(s,k)=>{let h;if(!s||!s.state)return r;const A=s.state;return k<0?(h=0,k=-k):(h=1+(k>>4),k<48&&(k&=15)),k&&(k<8||k>15)?r:(null!==A.window&&A.wbits!==k&&(A.window=null),A.wrap=h,A.wbits=k,G(s))},p=(s,k)=>{if(!s)return r;const h=new B;s.state=h,h.window=null;const A=Q(s,k);return A!==c&&(s.state=null),A};let I,N,b=!0;const t=s=>{if(b){I=new Int32Array(512),N=new Int32Array(32);let k=0;for(;k<144;)s.lens[k++]=8;for(;k<256;)s.lens[k++]=9;for(;k<280;)s.lens[k++]=7;for(;k<288;)s.lens[k++]=8;for(i(1,s.lens,0,288,I,0,s.work,{bits:9}),k=0;k<32;)s.lens[k++]=5;i(2,s.lens,0,32,N,0,s.work,{bits:5}),b=!1}s.lencode=I,s.lenbits=9,s.distcode=N,s.distbits=5},z=(s,k,h,A)=>{let g;const ms=s.state;return null===ms.window&&(ms.wsize=1<<ms.wbits,ms.wnext=0,ms.whave=0,ms.window=new Uint8Array(ms.wsize)),A>=ms.wsize?(ms.window.set(k.subarray(h-ms.wsize,h),0),ms.wnext=0,ms.whave=ms.wsize):(g=ms.wsize-ms.wnext,g>A&&(g=A),ms.window.set(k.subarray(h-A,h-A+g),ms.wnext),(A-=g)?(ms.window.set(k.subarray(h-A,h),0),ms.wnext=A,ms.whave=ms.wsize):(ms.wnext+=g,ms.wnext===ms.wsize&&(ms.wnext=0),ms.whave<ms.wsize&&(ms.whave+=g))),0};s.exports.inflateReset=G,s.exports.inflateReset2=Q,s.exports.inflateResetKeep=u,s.exports.inflateInit=s=>p(s,15),s.exports.inflateInit2=p,s.exports.inflate=(s,k)=>{let h,B,u,G,Q,p,I,N,b,C,v,Y,n,T,U,q,M,V,X,L,Z,x,y=0;const W=new Uint8Array(4);let J,F;const o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!s||!s.state||!s.output||!s.input&&0!==s.avail_in)return r;h=s.state,h.mode===R&&(h.mode=13),Q=s.next_out,u=s.output,I=s.avail_out,G=s.next_in,B=s.input,p=s.avail_in,N=h.hold,b=h.bits,C=p,v=I,x=c;s:for(;;)switch(h.mode){case 1:if(0===h.wrap){h.mode=13;break}for(;b<16;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(2&h.wrap&&35615===N){h.check=0,W[0]=255&N,W[1]=N>>>8&255,h.check=g(h.check,W,2,0),N=0,b=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&N)<<8)+(N>>8))%31){s.ak="incorrect header check",h.mode=D;break}if((15&N)!==P){s.ak="unknown compression method",h.mode=D;break}if(N>>>=4,b-=4,Z=8+(15&N),0===h.wbits)h.wbits=Z;else if(Z>h.wbits){s.ak="invalid window size",h.mode=D;break}h.dmax=1<<h.wbits,s.adler=h.check=1,h.mode=512&N?10:R,N=0,b=0;break;case 2:for(;b<16;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(h.flags=N,(255&h.flags)!==P){s.ak="unknown compression method",h.mode=D;break}if(57344&h.flags){s.ak="unknown header flags set",h.mode=D;break}h.head&&(h.head.text=N>>8&1),512&h.flags&&(W[0]=255&N,W[1]=N>>>8&255,h.check=g(h.check,W,2,0)),N=0,b=0,h.mode=3;case 3:for(;b<32;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}h.head&&(h.head.time=N),512&h.flags&&(W[0]=255&N,W[1]=N>>>8&255,W[2]=N>>>16&255,W[3]=N>>>24&255,h.check=g(h.check,W,4,0)),N=0,b=0,h.mode=4;case 4:for(;b<16;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}h.head&&(h.head.xflags=255&N,h.head.os=N>>8),512&h.flags&&(W[0]=255&N,W[1]=N>>>8&255,h.check=g(h.check,W,2,0)),N=0,b=0,h.mode=5;case 5:if(1024&h.flags){for(;b<16;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}h.length=N,h.head&&(h.head.extra_len=N),512&h.flags&&(W[0]=255&N,W[1]=N>>>8&255,h.check=g(h.check,W,2,0)),N=0,b=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(Y=h.length,Y>p&&(Y=p),Y&&(h.head&&(Z=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Uint8Array(h.head.extra_len)),h.head.extra.set(B.subarray(G,G+Y),Z)),512&h.flags&&(h.check=g(h.check,B,Y,G)),p-=Y,G+=Y,h.length-=Y),h.length))break s;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(0===p)break s;Y=0;do{Z=B[G+Y++],h.head&&Z&&h.length<65536&&(h.head.name+=String.fromCharCode(Z))}while(Z&&Y<p);if(512&h.flags&&(h.check=g(h.check,B,Y,G)),p-=Y,G+=Y,Z)break s}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(0===p)break s;Y=0;do{Z=B[G+Y++],h.head&&Z&&h.length<65536&&(h.head.comment+=String.fromCharCode(Z))}while(Z&&Y<p);if(512&h.flags&&(h.check=g(h.check,B,Y,G)),p-=Y,G+=Y,Z)break s}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;b<16;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(N!==(65535&h.check)){s.ak="header crc mismatch",h.mode=D;break}N=0,b=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),s.adler=h.check=0,h.mode=R;break;case 10:for(;b<32;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}s.adler=h.check=w(N),N=0,b=0,h.mode=11;case 11:if(0===h.havedict)return s.next_out=Q,s.avail_out=I,s.next_in=G,s.avail_in=p,h.hold=N,h.bits=b,a;s.adler=h.check=1,h.mode=R;case R:if(k===H||k===O)break s;case 13:if(h.last){N>>>=7&b,b-=7&b,h.mode=27;break}for(;b<3;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}switch(h.last=1&N,N>>>=1,b-=1,3&N){case 0:h.mode=14;break;case 1:if(t(h),h.mode=20,k===O){N>>>=2,b-=2;break s}break;case 2:h.mode=17;break;case 3:s.ak="invalid block type",h.mode=D}N>>>=2,b-=2;break;case 14:for(N>>>=7&b,b-=7&b;b<32;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if((65535&N)!==(N>>>16^65535)){s.ak="invalid stored block lengths",h.mode=D;break}if(h.length=65535&N,N=0,b=0,h.mode=15,k===O)break s;case 15:h.mode=16;case 16:if(Y=h.length,Y){if(Y>p&&(Y=p),Y>I&&(Y=I),0===Y)break s;u.set(B.subarray(G,G+Y),Q),p-=Y,G+=Y,I-=Y,Q+=Y,h.length-=Y;break}h.mode=R;break;case 17:for(;b<14;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(h.nlen=257+(31&N),N>>>=5,b-=5,h.ndist=1+(31&N),N>>>=5,b-=5,h.ncode=4+(15&N),N>>>=4,b-=4,h.nlen>286||h.ndist>30){s.ak="too many length or distance symbols",h.mode=D;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;b<3;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}h.lens[o[h.have++]]=7&N,N>>>=3,b-=3}for(;h.have<19;)h.lens[o[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,J={bits:h.lenbits},x=i(0,h.lens,0,19,h.lencode,0,h.work,J),h.lenbits=J.bits,x){s.ak="invalid code lengths set",h.mode=D;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;y=h.lencode[N&(1<<h.lenbits)-1],U=y>>>24,q=y>>>16&255,M=65535&y,!(U<=b);){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(M<16)N>>>=U,b-=U,h.lens[h.have++]=M;else{if(16===M){for(F=U+2;b<F;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(N>>>=U,b-=U,0===h.have){s.ak="invalid bit length repeat",h.mode=D;break}Z=h.lens[h.have-1],Y=3+(3&N),N>>>=2,b-=2}else if(17===M){for(F=U+3;b<F;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}N>>>=U,b-=U,Z=0,Y=3+(7&N),N>>>=3,b-=3}else{for(F=U+7;b<F;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}N>>>=U,b-=U,Z=0,Y=11+(127&N),N>>>=7,b-=7}if(h.have+Y>h.nlen+h.ndist){s.ak="invalid bit length repeat",h.mode=D;break}for(;Y--;)h.lens[h.have++]=Z}}if(h.mode===D)break;if(0===h.lens[256]){s.ak="invalid code -- missing end-of-block",h.mode=D;break}if(h.lenbits=9,J={bits:h.lenbits},x=i(1,h.lens,0,h.nlen,h.lencode,0,h.work,J),h.lenbits=J.bits,x){s.ak="invalid literal/lengths set",h.mode=D;break}if(h.distbits=6,h.distcode=h.distdyn,J={bits:h.distbits},x=i(2,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,J),h.distbits=J.bits,x){s.ak="invalid distances set",h.mode=D;break}if(h.mode=20,k===O)break s;case 20:h.mode=21;case 21:if(p>=6&&I>=258){s.next_out=Q,s.avail_out=I,s.next_in=G,s.avail_in=p,h.hold=N,h.bits=b,ms(s,v),Q=s.next_out,u=s.output,I=s.avail_out,G=s.next_in,B=s.input,p=s.avail_in,N=h.hold,b=h.bits,h.mode===R&&(h.back=-1);break}for(h.back=0;y=h.lencode[N&(1<<h.lenbits)-1],U=y>>>24,q=y>>>16&255,M=65535&y,!(U<=b);){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(q&&0===(240&q)){for(V=U,X=q,L=M;y=h.lencode[L+((N&(1<<V+X)-1)>>V)],U=y>>>24,q=y>>>16&255,M=65535&y,!(V+U<=b);){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}N>>>=V,b-=V,h.back+=V}if(N>>>=U,b-=U,h.back+=U,h.length=M,0===q){h.mode=26;break}if(32&q){h.back=-1,h.mode=R;break}if(64&q){s.ak="invalid literal/length code",h.mode=D;break}h.extra=15&q,h.mode=22;case 22:if(h.extra){for(F=h.extra;b<F;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}h.length+=N&(1<<h.extra)-1,N>>>=h.extra,b-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;y=h.distcode[N&(1<<h.distbits)-1],U=y>>>24,q=y>>>16&255,M=65535&y,!(U<=b);){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(0===(240&q)){for(V=U,X=q,L=M;y=h.distcode[L+((N&(1<<V+X)-1)>>V)],U=y>>>24,q=y>>>16&255,M=65535&y,!(V+U<=b);){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}N>>>=V,b-=V,h.back+=V}if(N>>>=U,b-=U,h.back+=U,64&q){s.ak="invalid distance code",h.mode=D;break}h.offset=M,h.extra=15&q,h.mode=24;case 24:if(h.extra){for(F=h.extra;b<F;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}h.offset+=N&(1<<h.extra)-1,N>>>=h.extra,b-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){s.ak="invalid distance too far back",h.mode=D;break}h.mode=25;case 25:if(0===I)break s;if(Y=v-I,h.offset>Y){if(Y=h.offset-Y,Y>h.whave&&h.sane){s.ak="invalid distance too far back",h.mode=D;break}Y>h.wnext?(Y-=h.wnext,n=h.wsize-Y):n=h.wnext-Y,Y>h.length&&(Y=h.length),T=h.window}else T=u,n=Q-h.offset,Y=h.length;Y>I&&(Y=I),I-=Y,h.length-=Y;do{u[Q++]=T[n++]}while(--Y);0===h.length&&(h.mode=21);break;case 26:if(0===I)break s;u[Q++]=h.length,I--,h.mode=21;break;case 27:if(h.wrap){for(;b<32;){if(0===p)break s;p--,N|=B[G++]<<b,b+=8}if(v-=I,s.total_out+=v,h.total+=v,v&&(s.adler=h.check=h.flags?g(h.check,u,v,Q-v):A(h.check,u,v,Q-v)),v=I,(h.flags?N:w(N))!==h.check){s.ak="incorrect data check",h.mode=D;break}N=0,b=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;b<32;){if(0===p)break s;p--,N+=B[G++]<<b,b+=8}if(N!==(4294967295&h.total)){s.ak="incorrect length check",h.mode=D;break}N=0,b=0}h.mode=29;case 29:x=S;break s;case D:x=d;break s;case 31:return E;default:return r}return s.next_out=Q,s.avail_out=I,s.next_in=G,s.avail_in=p,h.hold=N,h.bits=b,(h.wsize||v!==s.avail_out&&h.mode<D&&(h.mode<27||k!==K))&&z(s,s.output,s.next_out,v-s.avail_out)?(h.mode=31,E):(C-=s.avail_in,v-=s.avail_out,s.total_in+=C,s.total_out+=v,h.total+=v,h.wrap&&v&&(s.adler=h.check=h.flags?g(h.check,u,v,s.next_out-v):A(h.check,u,v,s.next_out-v)),s.data_type=h.bits+(h.last?64:0)+(h.mode===R?128:0)+(20===h.mode||15===h.mode?256:0),(0===C&&0===v||k===K)&&x===c&&(x=j),x)},s.exports.inflateEnd=s=>{if(!s||!s.state)return r;let k=s.state;return k.window&&(k.window=null),s.state=null,c},s.exports.inflateGetHeader=(s,k)=>{if(!s||!s.state)return r;const h=s.state;return 0===(2&h.wrap)?r:(h.head=k,k.done=!1,c)},s.exports.inflateSetDictionary=(s,k)=>{const h=k.length;let g,ms,i;return s&&s.state?(g=s.state,0!==g.wrap&&11!==g.mode?r:11===g.mode&&(ms=1,ms=A(ms,k,h,0),ms!==g.check)?d:(i=z(s,k,h,h),i?(g.mode=31,E):(g.havedict=1,c))):r},s.exports.inflateInfo="pako inflate (from Nodeca project)"},13806:s=>{"use strict";const k=15,h=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),A=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ms=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);s.exports=(s,i,K,H,O,c,S,a)=>{const r=a.bits;let d,E,j,P,R,D,w=0,B=0,u=0,G=0,Q=0,p=0,I=0,N=0,b=0,t=0,z=null,C=0;const v=new Uint16Array(16),Y=new Uint16Array(16);let n,T,U,q=null,M=0;for(w=0;w<=k;w++)v[w]=0;for(B=0;B<H;B++)v[i[K+B]]++;for(Q=r,G=k;G>=1&&0===v[G];G--);if(Q>G&&(Q=G),0===G)return O[c++]=20971520,O[c++]=20971520,a.bits=1,0;for(u=1;u<G&&0===v[u];u++);for(Q<u&&(Q=u),N=1,w=1;w<=k;w++)if(N<<=1,N-=v[w],N<0)return-1;if(N>0&&(0===s||1!==G))return-1;for(Y[1]=0,w=1;w<k;w++)Y[w+1]=Y[w]+v[w];for(B=0;B<H;B++)0!==i[K+B]&&(S[Y[i[K+B]]++]=B);if(0===s?(z=q=S,D=19):1===s?(z=h,C-=257,q=A,M-=257,D=256):(z=g,q=ms,D=-1),t=0,B=0,w=u,R=c,p=Q,I=0,j=-1,b=1<<Q,P=b-1,1===s&&b>852||2===s&&b>592)return 1;for(;;){n=w-I,S[B]<D?(T=0,U=S[B]):S[B]>D?(T=q[M+S[B]],U=z[C+S[B]]):(T=96,U=0),d=1<<w-I,E=1<<p,u=E;do{E-=d,O[R+(t>>I)+E]=n<<24|T<<16|U}while(0!==E);for(d=1<<w-1;t&d;)d>>=1;if(0!==d?(t&=d-1,t+=d):t=0,B++,0===--v[w]){if(w===G)break;w=i[K+S[B]]}if(w>Q&&(t&P)!==j){for(0===I&&(I=Q),R+=u,p=w-I,N=1<<p;p+I<G&&(N-=v[p+I],!(N<=0));)p++,N<<=1;if(b+=1<<p,1===s&&b>852||2===s&&b>592)return 1;j=t&P,O[j]=Q<<24|p<<16|R-c}}return 0!==t&&(O[R+t]=w-I<<24|64<<16),a.bits=Q,0}},13763:s=>{"use strict";s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13749:s=>{"use strict";function k(s){let k=s.length;for(;--k>=0;)s[k]=0}const h=256,A=286,g=30,ms=15,i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),K=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),H=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=new Array(576);k(c);const S=new Array(60);k(S);const a=new Array(512);k(a);const r=new Array(256);k(r);const d=new Array(29);k(d);const E=new Array(g);function j(s,k,h,A,g){this.static_tree=s,this.extra_bits=k,this.extra_base=h,this.elems=A,this.max_length=g,this.has_stree=s&&s.length}let P,R,D;function w(s,k){this.dyn_tree=s,this.max_code=0,this.stat_desc=k}k(E);const B=s=>s<256?a[s]:a[256+(s>>>7)],u=(s,k)=>{s.pending_buf[s.pending++]=255&k,s.pending_buf[s.pending++]=k>>>8&255},G=(s,k,h)=>{s.bi_valid>16-h?(s.bi_buf|=k<<s.bi_valid&65535,u(s,s.bi_buf),s.bi_buf=k>>16-s.bi_valid,s.bi_valid+=h-16):(s.bi_buf|=k<<s.bi_valid&65535,s.bi_valid+=h)},Q=(s,k,h)=>{G(s,h[2*k],h[2*k+1])},p=(s,k)=>{let h=0;do{h|=1&s,s>>>=1,h<<=1}while(--k>0);return h>>>1},I=(s,k,h)=>{const A=new Array(16);let g,i,K=0;for(g=1;g<=ms;g++)A[g]=K=K+h[g-1]<<1;for(i=0;i<=k;i++){let k=s[2*i+1];0!==k&&(s[2*i]=p(A[k]++,k))}},N=s=>{let k;for(k=0;k<A;k++)s.dyn_ltree[2*k]=0;for(k=0;k<g;k++)s.dyn_dtree[2*k]=0;for(k=0;k<19;k++)s.bl_tree[2*k]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.last_lit=s.matches=0},b=s=>{s.bi_valid>8?u(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},t=(s,k,h,A)=>{const g=2*k,ms=2*h;return s[g]<s[ms]||s[g]===s[ms]&&A[k]<=A[h]},z=(s,k,h)=>{const A=s.heap[h];let g=h<<1;for(;g<=s.heap_len&&(g<s.heap_len&&t(k,s.heap[g+1],s.heap[g],s.depth)&&g++,!t(k,A,s.heap[g],s.depth));)s.heap[h]=s.heap[g],h=g,g<<=1;s.heap[h]=A},C=(s,k,A)=>{let g,ms,H,O,c=0;if(0!==s.last_lit)do{g=s.pending_buf[s.d_buf+2*c]<<8|s.pending_buf[s.d_buf+2*c+1],ms=s.pending_buf[s.l_buf+c],c++,0===g?Q(s,ms,k):(H=r[ms],Q(s,H+h+1,k),O=i[H],0!==O&&(ms-=d[H],G(s,ms,O)),g--,H=B(g),Q(s,H,A),O=K[H],0!==O&&(g-=E[H],G(s,g,O)))}while(c<s.last_lit);Q(s,256,k)},v=(s,k)=>{const h=k.dyn_tree,A=k.stat_desc.static_tree,g=k.stat_desc.has_stree,i=k.stat_desc.elems;let K,H,O,c=-1;for(s.heap_len=0,s.heap_max=573,K=0;K<i;K++)0!==h[2*K]?(s.heap[++s.heap_len]=c=K,s.depth[K]=0):h[2*K+1]=0;for(;s.heap_len<2;)O=s.heap[++s.heap_len]=c<2?++c:0,h[2*O]=1,s.depth[O]=0,s.opt_len--,g&&(s.static_len-=A[2*O+1]);for(k.max_code=c,K=s.heap_len>>1;K>=1;K--)z(s,h,K);O=i;do{K=s.heap[1],s.heap[1]=s.heap[s.heap_len--],z(s,h,1),H=s.heap[1],s.heap[--s.heap_max]=K,s.heap[--s.heap_max]=H,h[2*O]=h[2*K]+h[2*H],s.depth[O]=(s.depth[K]>=s.depth[H]?s.depth[K]:s.depth[H])+1,h[2*K+1]=h[2*H+1]=O,s.heap[1]=O++,z(s,h,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((s,k)=>{const h=k.dyn_tree,A=k.max_code,g=k.stat_desc.static_tree,i=k.stat_desc.has_stree,K=k.stat_desc.extra_bits,H=k.stat_desc.extra_base,O=k.stat_desc.max_length;let c,S,a,r,d,E,j=0;for(r=0;r<=ms;r++)s.bl_count[r]=0;for(h[2*s.heap[s.heap_max]+1]=0,c=s.heap_max+1;c<573;c++)S=s.heap[c],r=h[2*h[2*S+1]+1]+1,r>O&&(r=O,j++),h[2*S+1]=r,S>A||(s.bl_count[r]++,d=0,S>=H&&(d=K[S-H]),E=h[2*S],s.opt_len+=E*(r+d),i&&(s.static_len+=E*(g[2*S+1]+d)));if(0!==j){do{for(r=O-1;0===s.bl_count[r];)r--;s.bl_count[r]--,s.bl_count[r+1]+=2,s.bl_count[O]--,j-=2}while(j>0);for(r=O;0!==r;r--)for(S=s.bl_count[r];0!==S;)a=s.heap[--c],a>A||(h[2*a+1]!==r&&(s.opt_len+=(r-h[2*a+1])*h[2*a],h[2*a+1]=r),S--)}})(s,k),I(h,c,s.bl_count)},Y=(s,k,h)=>{let A,g,ms=-1,i=k[1],K=0,H=7,O=4;for(0===i&&(H=138,O=3),k[2*(h+1)+1]=65535,A=0;A<=h;A++)g=i,i=k[2*(A+1)+1],++K<H&&g===i||(K<O?s.bl_tree[2*g]+=K:0!==g?(g!==ms&&s.bl_tree[2*g]++,s.bl_tree[32]++):K<=10?s.bl_tree[34]++:s.bl_tree[36]++,K=0,ms=g,0===i?(H=138,O=3):g===i?(H=6,O=3):(H=7,O=4))},n=(s,k,h)=>{let A,g,ms=-1,i=k[1],K=0,H=7,O=4;for(0===i&&(H=138,O=3),A=0;A<=h;A++)if(g=i,i=k[2*(A+1)+1],!(++K<H&&g===i)){if(K<O)do{Q(s,g,s.bl_tree)}while(0!==--K);else 0!==g?(g!==ms&&(Q(s,g,s.bl_tree),K--),Q(s,16,s.bl_tree),G(s,K-3,2)):K<=10?(Q(s,17,s.bl_tree),G(s,K-3,3)):(Q(s,18,s.bl_tree),G(s,K-11,7));K=0,ms=g,0===i?(H=138,O=3):g===i?(H=6,O=3):(H=7,O=4)}};let T=!1;const U=(s,k,h,A)=>{G(s,0+(A?1:0),3),((s,k,h,A)=>{b(s),A&&(u(s,h),u(s,~h)),s.pending_buf.set(s.window.subarray(k,k+h),s.pending),s.pending+=h})(s,k,h,!0)};s.exports._tr_init=s=>{T||((()=>{let s,k,h,O,w;const B=new Array(16);for(h=0,O=0;O<28;O++)for(d[O]=h,s=0;s<1<<i[O];s++)r[h++]=O;for(r[h-1]=O,w=0,O=0;O<16;O++)for(E[O]=w,s=0;s<1<<K[O];s++)a[w++]=O;for(w>>=7;O<g;O++)for(E[O]=w<<7,s=0;s<1<<K[O]-7;s++)a[256+w++]=O;for(k=0;k<=ms;k++)B[k]=0;for(s=0;s<=143;)c[2*s+1]=8,s++,B[8]++;for(;s<=255;)c[2*s+1]=9,s++,B[9]++;for(;s<=279;)c[2*s+1]=7,s++,B[7]++;for(;s<=287;)c[2*s+1]=8,s++,B[8]++;for(I(c,287,B),s=0;s<g;s++)S[2*s+1]=5,S[2*s]=p(s,5);P=new j(c,i,257,A,ms),R=new j(S,K,0,g,ms),D=new j(new Array(0),H,0,19,7)})(),T=!0),s.l_desc=new w(s.dyn_ltree,P),s.d_desc=new w(s.dyn_dtree,R),s.bl_desc=new w(s.bl_tree,D),s.bi_buf=0,s.bi_valid=0,N(s)},s.exports._tr_stored_block=U,s.exports._tr_flush_block=(s,k,A,g)=>{let ms,i,K=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(s=>{let k,A=4093624447;for(k=0;k<=31;k++,A>>>=1)if(1&A&&0!==s.dyn_ltree[2*k])return 0;if(0!==s.dyn_ltree[18]||0!==s.dyn_ltree[20]||0!==s.dyn_ltree[26])return 1;for(k=32;k<h;k++)if(0!==s.dyn_ltree[2*k])return 1;return 0})(s)),v(s,s.l_desc),v(s,s.d_desc),K=(s=>{let k;for(Y(s,s.dyn_ltree,s.l_desc.max_code),Y(s,s.dyn_dtree,s.d_desc.max_code),v(s,s.bl_desc),k=18;k>=3&&0===s.bl_tree[2*O[k]+1];k--);return s.opt_len+=3*(k+1)+5+5+4,k})(s),ms=s.opt_len+3+7>>>3,i=s.static_len+3+7>>>3,i<=ms&&(ms=i)):ms=i=A+5,A+4<=ms&&-1!==k?U(s,k,A,g):4===s.strategy||i===ms?(G(s,2+(g?1:0),3),C(s,c,S)):(G(s,4+(g?1:0),3),((s,k,h,A)=>{let g;for(G(s,k-257,5),G(s,h-1,5),G(s,A-4,4),g=0;g<A;g++)G(s,s.bl_tree[2*O[g]+1],3);n(s,s.dyn_ltree,k-1),n(s,s.dyn_dtree,h-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,K+1),C(s,s.dyn_ltree,s.dyn_dtree)),N(s),g&&b(s)},s.exports._tr_tally=(s,k,A)=>(s.pending_buf[s.d_buf+2*s.last_lit]=k>>>8&255,s.pending_buf[s.d_buf+2*s.last_lit+1]=255&k,s.pending_buf[s.l_buf+s.last_lit]=255&A,s.last_lit++,0===k?s.dyn_ltree[2*A]++:(s.matches++,k--,s.dyn_ltree[2*(r[A]+h+1)]++,s.dyn_dtree[2*B(k)]++),s.last_lit===s.lit_bufsize-1),s.exports._tr_align=s=>{G(s,2,3),Q(s,256,c),(s=>{16===s.bi_valid?(u(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)})(s)}},13777:s=>{"use strict";s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.ak="",this.state=null,this.data_type=2,this.adler=0}},13405:s=>{function k(s,k,h){for(var A=s.length,g=-1/0,ms=1/0,i=0;i<A;i++){var K=(h[0][i]-s[i])/k[i],H=(h[1][i]-s[i])/k[i];if(K>H){var O=K;K=H,H=O}if(H<g||K>ms)return 1/0;K>g&&(g=K),H<ms&&(ms=H)}return g>ms?1/0:g}s.exports=function(s,h,A,g){var ms=k(h,A,g);if(ms===1/0)s=null;else{s=s||[];for(var i=0;i<h.length;i++)s[i]=h[i]+A[i]*ms}return s},s.exports.distance=k},14780:(s,k,h)=>{"use strict";h.d(k,{e:()=>i});var A=h(37);const g=A.useLayoutEffect;const ms=function(s){var k=(0,A.useRef)(s);return g((function(){k.current=s})),k};var i=function(s){var k=ms(s);(0,A.Ok)((function(){var s=function(s){var h;if(null!=k.current&&(h=k.current(s)),s.defaultPrevented&&(s.returnValue=""),"string"===typeof h)return s.returnValue=h,h};return window.addEventListener("beforeunload",s),function(){window.removeEventListener("beforeunload",s)}}),[])}},14731:(s,k,h)=>{"use strict";var A=h(14740),g=Array.prototype.concat,ms=Array.prototype.slice,i=s.exports=function(s){for(var k=[],h=0,i=s.length;h<i;h++){var K=s[h];A(K)?k=g.call(k,ms.call(K)):k.push(K)}return k};i.wrap=function(s){return function(){return s(i(arguments))}}},14740:s=>{s.exports=function(s){return!(!s||"string"===typeof s)&&(s instanceof Array||Array.isArray(s)||s.length>=0&&(s.splice instanceof Function||Object.getOwnPropertyDescriptor(s,s.length-1)&&"String"!==s.constructor.name))}},13685:(s,k,h)=>{var A=h(13693);function g(s){for(var k,h,g=0,ms=s.length,i=0;i<s.length;){for(k=s[i],h=0;i<ms&&s[i]===k;)++i,++h;g+=A.log2(h)/7|0,g+=A.log2(k>>>0)/7|0,g+=2}return g}k.size=g,k.encode=function(s,k){k||(k=new Uint8Array(g(s)));for(var h,A,ms=0,i=k.length,K=0;K<s.length;){for(h=s[K],A=0;K<s.length&&s[K]===h;)++K,++A;for(;ms<i&&A>=128;)k[ms++]=128+(127&A),A>>>=7;if(ms>=i)throw new Error("RLE buffer overflow");for(k[ms++]=A,h>>>=0;ms<i&&h>=128;)k[ms++]=128+(127&h),h>>>=7;if(ms>=i)throw new Error("RLE buffer overflow");k[ms++]=h}return k},k.decode=function(s,k){for(var h,A,g,ms,i=k.length,K=s.length,H=0,O=0;O<K;){for(h=0,A=0;O<K&&s[O]>=128;)h+=(127&s[O++])<<A,A+=7;if(h+=s[O++]<<A,O>=K)throw new Error("RLE buffer underrun");if(H+h>i)throw new Error("Chunk buffer overflow");for(g=0,A=0;O<K&&s[O]>=128;)g+=(127&s[O++])<<A,A+=7;if(O>=K)throw new Error("RLE buffer underrun");for(g+=s[O++]<<A,ms=0;ms<h;++ms)k[H++]=g}return k}},13693:(s,k)=>{"use strict";function h(s){var k=32;return(s&=-s)&&k--,65535&s&&(k-=16),16711935&s&&(k-=8),252645135&s&&(k-=4),858993459&s&&(k-=2),1431655765&s&&(k-=1),k}k.INT_BITS=32,k.INT_MAX=2147483647,k.INT_MIN=-1<<31,k.sign=function(s){return(s>0)-(s<0)},k.abs=function(s){var k=s>>31;return(s^k)-k},k.min=function(s,k){return k^(s^k)&-(s<k)},k.max=function(s,k){return s^(s^k)&-(s<k)},k.isPow2=function(s){return!(s&s-1)&&!!s},k.log2=function(s){var k,h;return k=(s>65535)<<4,k|=h=((s>>>=k)>255)<<3,k|=h=((s>>>=h)>15)<<2,(k|=h=((s>>>=h)>3)<<1)|(s>>>=h)>>1},k.log10=function(s){return s>=1e9?9:s>=1e8?8:s>=1e7?7:s>=1e6?6:s>=1e5?5:s>=1e4?4:s>=1e3?3:s>=100?2:s>=10?1:0},k.popCount=function(s){return 16843009*((s=(858993459&(s-=s>>>1&1431655765))+(s>>>2&858993459))+(s>>>4)&252645135)>>>24},k.countTrailingZeros=h,k.nextPow2=function(s){return s+=0===s,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)+1},k.prevPow2=function(s){return s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)-(s>>>1)},k.parity=function(s){return s^=s>>>16,s^=s>>>8,s^=s>>>4,27030>>>(s&=15)&1};var A=new Array(256);!function(s){for(var k=0;k<256;++k){var h=k,A=k,g=7;for(h>>>=1;h;h>>>=1)A<<=1,A|=1&h,--g;s[k]=A<<g&255}}(A),k.reverse=function(s){return A[255&s]<<24|A[s>>>8&255]<<16|A[s>>>16&255]<<8|A[s>>>24&255]},k.interleave2=function(s,k){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s&=65535)|s<<8))|s<<4))|s<<2))|s<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))<<1},k.deinterleave2=function(s,k){return(s=65535&((s=16711935&((s=252645135&((s=858993459&((s=s>>>k&1431655765)|s>>>1))|s>>>2))|s>>>4))|s>>>16))<<16>>16},k.interleave3=function(s,k,h){return s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2),(s|=(k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},k.deinterleave3=function(s,k){return(s=1023&((s=4278190335&((s=251719695&((s=3272356035&((s=s>>>k&1227133513)|s>>>2))|s>>>4))|s>>>8))|s>>>16))<<22>>22},k.nextCombination=function(s){var k=s|s-1;return k+1|(~k&-~k)-1>>>h(s)+1}},13721:s=>{"use strict";s.exports=function(s,k,h,A){var g=self||window;try{try{var ms;try{ms=new g.Blob([s])}catch(O){(ms=new(g.BlobBuilder||g.WebKitBlobBuilder||g.MozBlobBuilder||g.MSBlobBuilder)).append(s),ms=ms.getBlob()}var i=g.URL||g.webkitURL,K=i.createObjectURL(ms),H=new g[k](K,h);return i.revokeObjectURL(K),H}catch(O){return new g[k]("data:application/javascript,".concat(encodeURIComponent(s)),h)}}catch(O){if(!A)throw Error("Inline worker is not supported");return new g[k](A,h)}}},13390:(s,k,h)=>{"use strict";function A(s,k,h,A,g){var ms={};return Object.keys(A).forEach((function(s){ms[s]=A[s]})),ms.enumerable=!!ms.enumerable,ms.configurable=!!ms.configurable,("value"in ms||ms.initializer)&&(ms.writable=!0),ms=h.slice().reverse().reduce((function(h,A){return A(s,k,h)||h}),ms),g&&void 0!==ms.initializer&&(ms.value=ms.initializer?ms.initializer.call(g):void 0,ms.initializer=void 0),void 0===ms.initializer&&(Object.defineProperty(s,k,ms),ms=null),ms}h.d(k,{e:()=>A})},13387:(s,k,h)=>{"use strict";function A(s,k,h,A){h&&Object.defineProperty(s,k,{enumerable:h.enumerable,configurable:h.configurable,writable:h.writable,value:h.initializer?h.initializer.call(A):void 0})}h.d(k,{c:()=>A})},14774:(s,k,h)=>{"use strict";h.d(k,{e:()=>i,g:()=>S,i:()=>K,j:()=>ms,l:()=>H,m:()=>g,p:()=>O,s:()=>c});var A=h(12802);class g{constructor(){this._easingMode=g.EASINGMODE_EASEIN}setEasingMode(s){const k=Math.min(Math.max(s,0),2);this._easingMode=k}getEasingMode(){return this._easingMode}easeInCore(s){throw new Error("You must implement this method")}ease(s){switch(this._easingMode){case g.EASINGMODE_EASEIN:return this.easeInCore(s);case g.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-s)}return s>=.5?.5*(1-this.easeInCore(2*(1-s)))+.5:.5*this.easeInCore(2*s)}}g.EASINGMODE_EASEIN=0,g.EASINGMODE_EASEOUT=1,g.EASINGMODE_EASEINOUT=2;class ms extends g{easeInCore(s){return s=Math.max(0,Math.min(1,s)),1-Math.sqrt(1-s*s)}}class i extends g{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=s}easeInCore(s){const k=Math.max(0,this.amplitude);return Math.pow(s,3)-s*k*Math.sin(3.141592653589793*s)}}class K extends g{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=s,this.bounciness=k}easeInCore(s){const k=Math.max(0,this.bounces);let h=this.bounciness;h<=1&&(h=1.001);const A=Math.pow(h,k),g=1-h,ms=(1-A)/g+.5*A,i=s*ms,K=Math.log(-i*(1-h)+1)/Math.log(h),H=Math.floor(K),O=H+1,c=(1-Math.pow(h,H))/(g*ms),S=.5*(c+(1-Math.pow(h,O))/(g*ms)),a=s-S,r=S-c;return-Math.pow(1/h,k-H)/(r*r)*(a-r)*(a+r)}}class H extends g{easeInCore(s){return s*s*s}}class O extends g{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=s,this.springiness=k}easeInCore(s){let k;const h=Math.max(0,this.oscillations),A=Math.max(0,this.springiness);return k=0==A?s:(Math.exp(A*s)-1)/(Math.exp(A)-1),k*Math.sin((6.283185307179586*h+1.5707963267948966)*s)}}class c extends g{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=s}easeInCore(s){return this.exponent<=0?s:(Math.exp(this.exponent*s)-1)/(Math.exp(this.exponent)-1)}}class S extends g{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=s,this.y1=k,this.x2=h,this.y2=A}easeInCore(s){return A.b.Interpolate(s,this.x1,this.y1,this.x2,this.y2)}}},14228:(s,k,h)=>{"use strict";h.d(k,{e:()=>i});var A=h(12590),g=h(12603),ms=h(13041);class i extends ms.e{get _matrix(){return this._compose(),this.Dr}set _matrix(s){(s.updateFlag!==this.Dr.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Dr.H(s),this._markAsDirtyAndDecompose())}constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(s,k.Is(),!1),this.name=s,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=k,this.Dr=(null===g||void 0===g?void 0:g.clone())??A.Matrix.Identity(),this._restMatrix=ms??this.Dr.clone(),this._bindMatrix=i??this.Dr.clone(),this._index=K,this._absoluteMatrix=new A.Matrix,this._absoluteBindMatrix=new A.Matrix,this._absoluteInverseBindMatrix=new A.Matrix,this._finalMatrix=new A.Matrix,k.bones.push(this),this.setParent(h,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(s){this.setParent(s)}setParent(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==s){if(this.parent){const s=this.parent.children.indexOf(this);-1!==s&&this.parent.children.splice(s,1)}this._parentNode=s,this.parent&&this.parent.children.push(this),k&&this._updateAbsoluteBindMatrices(),this.mS()}}getLocalMatrix(){return this._compose(),this.Dr}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(s){this._restMatrix.H(s)}setRestPose(s){this.setRestMatrix(s)}getBindPose(){return this.getBindMatrix()}setBindMatrix(s){this.Fh(s)}setBindPose(s){this.setBindMatrix(s)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const s=A.TmpVectors.Pk[0],k=A.TmpVectors.Quaternion[0],h=A.TmpVectors.Pk[1];this.getRestMatrix().decompose(s,k,h),this._linkedTransformNode.position.H(h),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??A.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.H(k),this._linkedTransformNode.Sg.H(s)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(s){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=s,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.gH}set position(s){this._decompose(),this.gH.H(s),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(s){this.setRotation(s)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(s){this.setRotationQuaternion(s)}get Sg(){return this.getScale()}set Sg(s){this.setScale(s)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=A.Pk.Zero(),this._localRotation=A.Quaternion.Zero(),this.gH=A.Pk.Zero()),this.Dr.decompose(this._localScaling,this._localRotation,this.gH))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,A.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.gH,this.Dr)):this._needToCompose=!1)}Fh(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.H(s),k&&this._updateAbsoluteBindMatrices(),h?this._matrix=s:this.mS()}_updateAbsoluteBindMatrices(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(s||(s=this._bindMatrix),this.parent?s.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.H(s),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),k)for(let h=0;h<this.children.length;h++)this.children[h]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}mS(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.mS(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.mS(),this._needToDecompose=!0}_updatePosition(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const ms=this.getLocalMatrix();if(0==k)g?(ms.addAtIndex(12,s.x),ms.addAtIndex(13,s.y),ms.addAtIndex(14,s.z)):ms.setTranslationFromFloats(s.x,s.y,s.z);else{let k=null;h&&(k=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=i._TmpMats[0],H=i._TmpVecs[0];this.parent?h&&k?(K.H(this.parent.getAbsoluteMatrix()),K.multiplyToRef(k,K)):K.H(this.parent.getAbsoluteMatrix()):A.Matrix.IdentityToRef(K),g&&K.setTranslationFromFloats(0,0,0),K.invert(),A.Pk.TransformCoordinatesToRef(s,K,H),g?(ms.addAtIndex(12,H.x),ms.addAtIndex(13,H.y),ms.addAtIndex(14,H.z)):ms.setTranslationFromFloats(H.x,H.y,H.z)}this._markAsDirtyAndDecompose()}translate(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(s,k,h,!0)}setPosition(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(s,k,h,!1)}setAbsolutePosition(s,k){this.setPosition(s,1,k)}scale(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const ms=this.getLocalMatrix(),K=i._TmpMats[0];A.Matrix.ScalingToRef(s,k,h,K),K.multiplyToRef(ms,ms),K.invert();for(const A of this.children){const g=A.getLocalMatrix();g.multiplyToRef(K,g),g.multiplyAtIndex(12,s),g.multiplyAtIndex(13,k),g.multiplyAtIndex(14,h),A._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),g)for(const A of this.children)A.scale(s,k,h,g)}setScale(s){this._decompose(),this._localScaling.H(s),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(s){this._decompose(),s.H(this._localScaling)}setYawPitchRoll(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,ms=arguments.length>4?arguments[4]:void 0;if(0===g){const K=i._TmpQuat;return A.Quaternion.RotationYawPitchRollToRef(s,k,h,K),void this.setRotationQuaternion(K,g,ms)}const K=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,ms))return;const H=i._TmpMats[1];A.Matrix.RotationYawPitchRollToRef(s,k,h,H),K.multiplyToRef(H,H),this._rotateWithMatrix(H,g,ms)}rotate(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3?arguments[3]:void 0;const ms=i._TmpMats[0];ms.setTranslationFromFloats(0,0,0),A.Matrix.RotationAxisToRef(s,k,ms),this._rotateWithMatrix(ms,h,g)}setAxisAngle(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3?arguments[3]:void 0;if(0===h){const ms=i._TmpQuat;return A.Quaternion.RotationAxisToRef(s,k,ms),void this.setRotationQuaternion(ms,h,g)}const ms=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(ms,g))return;const K=i._TmpMats[1];A.Matrix.RotationAxisToRef(s,k,K),ms.multiplyToRef(K,K),this._rotateWithMatrix(K,h,g)}setRotation(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(s.y,s.x,s.z,k,h)}setRotationQuaternion(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===k)return this._decompose(),this._localRotation.H(s),void this._markAsDirtyAndCompose();const g=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,h))return;const ms=i._TmpMats[1];A.Matrix.FromQuaternionToRef(s,ms),g.multiplyToRef(ms,ms),this._rotateWithMatrix(ms,k,h)}setRotationMatrix(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===k){const g=i._TmpQuat;return A.Quaternion.FromRotationMatrixToRef(s,g),void this.setRotationQuaternion(g,k,h)}const g=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,h))return;const ms=i._TmpMats[1];ms.H(s),g.multiplyToRef(s,ms),this._rotateWithMatrix(ms,k,h)}_rotateWithMatrix(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const A=this.getLocalMatrix(),g=A.m[12],ms=A.m[13],K=A.m[14],H=this.getParent(),O=i._TmpMats[3],c=i._TmpMats[4];H&&1==k?(h?(O.H(h.getWorldMatrix()),H.getAbsoluteMatrix().multiplyToRef(O,O)):O.H(H.getAbsoluteMatrix()),c.H(O),c.invert(),A.multiplyToRef(O,A),A.multiplyToRef(s,A),A.multiplyToRef(c,A)):1==k&&h?(O.H(h.getWorldMatrix()),c.H(O),c.invert(),A.multiplyToRef(O,A),A.multiplyToRef(s,A),A.multiplyToRef(c,A)):A.multiplyToRef(s,A),A.setTranslationFromFloats(g,ms,K),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(s,k){const h=i._TmpMats[2];return s.H(this.getAbsoluteMatrix()),k?(s.multiplyToRef(k.getWorldMatrix(),s),A.Matrix.ScalingToRef(k.Sg.x,k.Sg.y,k.Sg.z,h)):A.Matrix.IdentityToRef(h),s.invert(),!isNaN(s.m[0])&&(h.multiplyAtIndex(0,this._scalingDeterminant),s.multiplyToRef(h,s),!0)}Kh(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=A.Pk.Zero();return this.getPositionToRef(s,k,h),h}getPositionToRef(){let s=arguments.length>1?arguments[1]:void 0,k=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const s=this.getLocalMatrix();k.x=s.m[12],k.y=s.m[13],k.z=s.m[14]}else{let h=null;s&&(h=s.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let A=i._TmpMats[0];s&&h?(A.H(this.getAbsoluteMatrix()),A.multiplyToRef(h,A)):A=this.getAbsoluteMatrix(),k.x=A.m[12],k.y=A.m[13],k.z=A.m[14]}}getAbsolutePosition(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const k=A.Pk.Zero();return this.getPositionToRef(1,s,k),k}getAbsolutePositionToRef(s,k){this.getPositionToRef(1,s,k)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Dr.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.H(this.Dr);const s=this._skeleton.getPoseMatrix();s&&this._absoluteMatrix.multiplyToRef(s,this._absoluteMatrix)}const s=this.children,k=s.length;for(let h=0;h<k;h++)s[h].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}CH(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=A.Pk.Zero();return this.getDirectionToRef(s,k,h),h}getDirectionToRef(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,g=null;k&&(g=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const ms=i._TmpMats[0];ms.H(this.getAbsoluteMatrix()),k&&g&&ms.multiplyToRef(g,ms),A.Pk.TransformNormalToRef(s,ms,h),h.normalize()}getRotation(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=A.Pk.Zero();return this.getRotationToRef(s,k,h),h}getRotationToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;const A=i._TmpQuat;this.getRotationQuaternionToRef(s,k,A),A.toEulerAnglesToRef(h)}getRotationQuaternion(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=A.Quaternion.Identity();return this.getRotationQuaternionToRef(s,k,h),h}getRotationQuaternionToRef(){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,k=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),k.H(this._localRotation);else{const h=i._TmpMats[0],A=this.getAbsoluteMatrix();s?A.multiplyToRef(s.getWorldMatrix(),h):h.H(A),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.decompose(void 0,k,void 0)}}getRotationMatrix(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1?arguments[1]:void 0;const h=A.Matrix.Identity();return this.getRotationMatrixToRef(s,k,h),h}getRotationMatrixToRef(){let s=arguments.length>1?arguments[1]:void 0,k=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(k);else{const h=i._TmpMats[0],A=this.getAbsoluteMatrix();s?A.multiplyToRef(s.getWorldMatrix(),h):h.H(A),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.getRotationMatrixToRef(k)}}getAbsolutePositionFromLocal(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=A.Pk.Zero();return this.getAbsolutePositionFromLocalToRef(s,k,h),h}getAbsolutePositionFromLocalToRef(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,g=null;k&&(g=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const ms=i._TmpMats[0];ms.H(this.getAbsoluteMatrix()),k&&g&&ms.multiplyToRef(g,ms),A.Pk.TransformCoordinatesToRef(s,ms,h)}getLocalPositionFromAbsolute(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=A.Pk.Zero();return this.getLocalPositionFromAbsoluteToRef(s,k,h),h}getLocalPositionFromAbsoluteToRef(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,g=null;k&&(g=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const ms=i._TmpMats[0];ms.H(this.getAbsoluteMatrix()),k&&g&&ms.multiplyToRef(g,ms),ms.invert(),A.Pk.TransformCoordinatesToRef(s,ms,h)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const s=this._skeleton.bones.indexOf(this);if(-1!==s&&this._skeleton.bones.splice(s,1),this._parentNode&&this._parentNode.children){const s=this._parentNode.children,k=s.indexOf(this);-1!==k&&s.splice(k,1)}super.dispose()}}i._TmpVecs=(0,g.e)(2,A.Pk.Zero),i._TmpQuat=A.Quaternion.Identity(),i._TmpMats=(0,g.e)(5,A.Matrix.Identity)},14766:(s,k,h)=>{"use strict";h.d(k,{c:()=>v});var A=h(12570),g=h(12579),ms=h(12408),i=h(12590),K=h(12607),H=h(13041),O=h(13061),c=h(12871),S=h(12435),a=h(12598);class r{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(s){this._zoomStopsAnimation=s}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(s){this._idleRotationSpeed=s}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(s){this._idleRotationWaitTime=s}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(s){this._idleRotationSpinupTime=s}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(s){this._attachedCamera=s;const k=this._attachedCamera.Is();this._onPrePointerObservableObserver=k.onPrePointerObservable.add((s=>{s.type!==c.c.POINTERDOWN?s.type===c.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const s=S.e.Now;let k=0;null!=this._lastFrameTime&&(k=s-this._lastFrameTime),this._lastFrameTime=s,this._applyUserInteraction();const h=s-this._lastInteractionTime-this._idleRotationWaitTime,A=Math.max(Math.min(h/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*A,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(k/1e3))}))}detach(){if(!this._attachedCamera)return;const s=this._attachedCamera.Is();this._onPrePointerObservableObserver&&s.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(s){this._lastInteractionTime=s??S.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<a.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let s=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(s=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?s:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=S.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var d=h(14774),E=h(13128);class j{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(s){if(this._autoTransitionRange===s)return;this._autoTransitionRange=s;const k=this._attachedCamera;k&&(s?this._onMeshTargetChangedObserver=k.onMeshTargetChangedObservable.add((s=>{if(s&&(s.fh(!0),s.getBoundingInfo)){const k=s.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*k,this.upperRadiusTransitionRange=.05*k}})):this._onMeshTargetChangedObserver&&k.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(s){this._attachedCamera=s,this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(s){return!!this._attachedCamera&&(this._attachedCamera.radius===s&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(s){if(!this._attachedCamera)return;this._radiusBounceTransition||(j.EasingFunction.setEasingMode(j.EasingMode),this._radiusBounceTransition=E.c.CreateAnimation("radius",E.c.ANIMATIONTYPE_FLOAT,60,j.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const k=E.c.TransitionTo("radius",this._attachedCamera.radius+s,this._attachedCamera,this._attachedCamera.Is(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));k&&this._animatables.push(k)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}j.EasingFunction=new d.e(.3),j.EasingMode=d.m.EASINGMODE_EASEOUT;class P{constructor(){this.onTargetFramingAnimationEndObservable=new ms.c,this._mode=P.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(s){this._mode=s}get mode(){return this._mode}set radiusScale(s){this._radiusScale=s}get radiusScale(){return this._radiusScale}set positionScale(s){this._positionScale=s}get positionScale(){return this._positionScale}set defaultElevation(s){this._defaultElevation=s}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(s){this._elevationReturnTime=s}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(s){this._elevationReturnWaitTime=s}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(s){this._zoomStopsAnimation=s}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(s){this._framingTime=s}get framingTime(){return this._framingTime}init(){}attach(s){this._attachedCamera=s;const k=this._attachedCamera.Is();P.EasingFunction.setEasingMode(P.EasingMode),this._onPrePointerObservableObserver=k.onPrePointerObservable.add((s=>{s.type!==c.c.POINTERDOWN?s.type===c.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=s.onMeshTargetChangedObservable.add((s=>{s&&s.getBoundingInfo&&this.zoomOnMesh(s,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const s=this._attachedCamera.Is();this._onPrePointerObservableObserver&&s.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s.fh(!0);const A=s.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(A.minimumWorld,A.maximumWorld,k,h)}zoomOnMeshHierarchy(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s.fh(!0);const A=s.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(A.min,A.max,k,h)}zoomOnMeshesHierarchy(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new i.Pk(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),g=new i.Pk(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let ms=0;ms<s.length;ms++){const k=s[ms].getHierarchyBoundingVectors(!0);i.Pk.CheckExtends(k.min,A,g),i.Pk.CheckExtends(k.max,A,g)}this.zoomOnBoundingInfo(A,g,k,h)}zoomOnBoundingInfo(s,k){let h,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const ms=s.y,K=ms+(k.y-ms)*this._positionScale,H=k.Rk(s).scale(.5);if(!isFinite(K))return!1;if(A)h=new i.Pk(0,K,0);else{const k=s.add(H);h=new i.Pk(k.x,K,k.z)}this._vectorTransition||(this._vectorTransition=E.c.CreateAnimation("target",E.c.ANIMATIONTYPE_VECTOR3,60,P.EasingFunction)),this._betaIsAnimating=!0;let O=E.c.TransitionTo("target",h,this._attachedCamera,this._attachedCamera.Is(),60,this._vectorTransition,this._framingTime);O&&this._animatables.push(O);let c=0;if(this._mode===P.FitFrustumSidesMode){const h=this._calculateLowerRadiusFromModelBoundingSphere(s,k);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=H.length()+this._attachedCamera.Jh),c=h}else this._mode===P.IgnoreBoundsSizeMode&&(c=this._calculateLowerRadiusFromModelBoundingSphere(s,k),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Jh));if(this.autoCorrectCameraLimitsAndSensibility){const h=k.Rk(s).length();this._attachedCamera.panningSensibility=5e3/h,this._attachedCamera.wheelPrecision=100/c}return this._radiusTransition||(this._radiusTransition=E.c.CreateAnimation("radius",E.c.ANIMATIONTYPE_FLOAT,60,P.EasingFunction)),O=E.c.TransitionTo("radius",c,this._attachedCamera,this._attachedCamera.Is(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),g&&g(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),O&&this._animatables.push(O),!0}_calculateLowerRadiusFromModelBoundingSphere(s,k){const h=this._attachedCamera;if(!h)return 0;let A=h._calculateLowerRadiusFromModelBoundingSphere(s,k,this._radiusScale);return h.lowerRadiusLimit&&this._mode===P.IgnoreBoundsSizeMode&&(A=A<h.lowerRadiusLimit?h.lowerRadiusLimit:A),h.upperRadiusLimit&&(A=A>h.upperRadiusLimit?h.upperRadiusLimit:A),A}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const s=S.e.Now-this._lastInteractionTime,k=.5*Math.PI-this._defaultElevation,h=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>h&&s>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.c.CreateAnimation("beta",E.c.ANIMATIONTYPE_FLOAT,60,P.EasingFunction));const s=E.c.TransitionTo("beta",k,this._attachedCamera,this._attachedCamera.Is(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));s&&this._animatables.push(s)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=S.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}P.EasingFunction=new d.s,P.EasingMode=d.m.EASINGMODE_EASEINOUT,P.IgnoreBoundsSizeMode=0,P.FitFrustumSidesMode=1;var R=h(13067),D=h(13096),w=h(14225),B=h(12402);class u{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(s){s=B.Tools.BackCompatCameraNoPreventDefault(arguments);const k=this.camera.getEngine(),h=k.getInputElement();let A=0,g=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=ms=>{var i,K;const H=ms.event,O="touch"===H.pointerType;if(ms.type!==c.c.POINTERMOVE&&-1===this.buttons.indexOf(H.button))return;const S=H.target;if(this._altKey=H.altKey,this._ctrlKey=H.ctrlKey,this._metaKey=H.metaKey,this._shiftKey=H.shiftKey,this._buttonsPressed=H.buttons,k.isPointerLock){const s=H.movementX,k=H.movementY;this.onTouch(null,s,k),this._pointA=null,this._pointB=null}else{if(ms.type!==c.c.POINTERDOWN&&ms.type!==c.c.POINTERDOUBLETAP&&O&&(null===(i=this._pointA)||void 0===i?void 0:i.pointerId)!==H.pointerId&&(null===(K=this._pointB)||void 0===K?void 0:K.pointerId)!==H.pointerId)return;if(ms.type!==c.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!O)if(ms.type===c.c.POINTERDOUBLETAP)this.onDoubleTap(H.pointerType);else if(ms.type!==c.c.POINTERUP||this._currentMousePointerIdDown!==H.pointerId&&!O){if(ms.type===c.c.POINTERMOVE)if(s||H.preventDefault(),this._pointA&&null===this._pointB){const s=H.clientX-this._pointA.x,k=H.clientY-this._pointA.y;this._pointA.x=H.clientX,this._pointA.y=H.clientY,this.onTouch(this._pointA,s,k)}else if(this._pointA&&this._pointB){const s=this._pointA.pointerId===H.pointerId?this._pointA:this._pointB;s.x=H.clientX,s.y=H.clientY;const k=this._pointA.x-this._pointB.x,h=this._pointA.y-this._pointB.y,i=k*k+h*h,K={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:H.pointerId,type:ms.type};this.onMultiTouch(this._pointA,this._pointB,A,i,g,K),g=K,A=i}}else{try{null===S||void 0===S||S.releasePointerCapture(H.pointerId)}catch(a){}O||(this._pointB=null),k._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==H.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==H.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==A||g)&&(this.onMultiTouch(this._pointA,this._pointB,A,0,g,null),A=0,g=null),this._currentMousePointerIdDown=-1,this.onButtonUp(H),s||H.preventDefault()}else{try{null===S||void 0===S||S.setPointerCapture(H.pointerId)}catch(a){}if(null===this._pointA)this._pointA={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType};else{if(null!==this._pointB)return;this._pointB={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType}}-1!==this._currentMousePointerIdDown||O||(this._currentMousePointerIdDown=H.pointerId),this.onButtonDown(H),s||(H.preventDefault(),h&&h.focus())}}},this._observer=this.camera.Is()._inputManager._addCameraPointerObserver(this._pointerInput,c.c.POINTERDOWN|c.c.POINTERUP|c.c.POINTERMOVE|c.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,A=0,g=null,this.onLostFocus()},this._contextMenuBind=s=>this.onContextMenu(s),h&&h.addEventListener("contextmenu",this._contextMenuBind,!1);const ms=this.camera.Is().getEngine().getHostWindow();ms&&B.Tools.RegisterTopRootEvents(ms,[{name:"blur",handler:this._onLostFocus}])}za(){if(this._onLostFocus){const s=this.camera.Is().getEngine().getHostWindow();s&&B.Tools.UnregisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Is()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const s=this.camera.Is().getEngine().getInputElement();s&&s.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(s){}onTouch(s,k,h){}onMultiTouch(s,k,h,A,g,ms){}onContextMenu(s){s.preventDefault()}onButtonDown(s){}onButtonUp(s){}onLostFocus(){}}(0,A.e)([(0,g.J)()],u.prototype,"buttons",void 0);class G extends u{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(s,k){if(0!==this.panningSensibility&&s&&k){const h=k.x-s.x,A=k.y-s.y;this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility}}_computePinchZoom(s,k){const h=this.camera.radius||G.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=h*Math.sqrt(s)/Math.sqrt(k):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(k-s)*h*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(k-s)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(s,k,h){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-k/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility):(this.camera.inertialAlphaOffset-=k/this.angularSensibilityX,this.camera.inertialBetaOffset-=h/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(s,k,h,A,g,ms){0===h&&null===g||0===A&&null===ms||(this.multiTouchPanAndZoom?(this._computePinchZoom(h,A),this._computeMultiTouchPanning(g,ms)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(A)-Math.sqrt(h))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(h,A),this._isPinching=!0):this._computeMultiTouchPanning(g,ms)):this.multiTouchPanning?this._computeMultiTouchPanning(g,ms):this.pinchZoom&&this._computePinchZoom(h,A))}onButtonDown(s){this._isPanClick=s.button===this.camera._panningMouseButton}onButtonUp(s){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}G.MinimumRadiusForPinch=.001,(0,A.e)([(0,g.J)()],G.prototype,"buttons",void 0),(0,A.e)([(0,g.J)()],G.prototype,"angularSensibilityX",void 0),(0,A.e)([(0,g.J)()],G.prototype,"angularSensibilityY",void 0),(0,A.e)([(0,g.J)()],G.prototype,"pinchPrecision",void 0),(0,A.e)([(0,g.J)()],G.prototype,"pinchDeltaPercentage",void 0),(0,A.e)([(0,g.J)()],G.prototype,"useNaturalPinchZoom",void 0),(0,A.e)([(0,g.J)()],G.prototype,"pinchZoom",void 0),(0,A.e)([(0,g.J)()],G.prototype,"panningSensibility",void 0),(0,A.e)([(0,g.J)()],G.prototype,"multiTouchPanning",void 0),(0,A.e)([(0,g.J)()],G.prototype,"multiTouchPanAndZoom",void 0),w.b.ArcRotateCameraPointersInput=G;var Q=h(12874);class p{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(s){s=B.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Is(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((k=>{const h=k.event;if(!h.metaKey)if(k.type===Q.c.KEYDOWN){if(this._ctrlPressed=h.ctrlKey,this._altPressed=h.altKey,-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),h.preventDefault&&(s||h.preventDefault())}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){const k=this._keys.indexOf(h.keyCode);k>=0&&this._keys.splice(k,1),h.preventDefault&&(s||h.preventDefault())}})))}za(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const s=this.camera;for(let k=0;k<this._keys.length;k++){const h=this._keys[k];-1!==this.keysLeft.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningX-=1/this.panningSensibility:s.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?s.inertialRadiusOffset+=1/this.zoomingSensibility:s.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningX+=1/this.panningSensibility:s.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?s.inertialRadiusOffset-=1/this.zoomingSensibility:s.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(h)&&s.useInputToRestoreState&&s.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,A.e)([(0,g.J)()],p.prototype,"keysUp",void 0),(0,A.e)([(0,g.J)()],p.prototype,"keysDown",void 0),(0,A.e)([(0,g.J)()],p.prototype,"keysLeft",void 0),(0,A.e)([(0,g.J)()],p.prototype,"keysRight",void 0),(0,A.e)([(0,g.J)()],p.prototype,"keysReset",void 0),(0,A.e)([(0,g.J)()],p.prototype,"panningSensibility",void 0),(0,A.e)([(0,g.J)()],p.prototype,"zoomingSensibility",void 0),(0,A.e)([(0,g.J)()],p.prototype,"useAltToZoom",void 0),(0,A.e)([(0,g.J)()],p.prototype,"angularSpeed",void 0),w.b.ArcRotateCameraKeyboardMoveInput=p;var I=h(12645),N=h(12882);class b{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new i.Pk(0,0,0),this._globalOffset=new i.Pk(0,0,0),this._inertialPanning=i.Pk.Zero()}_computeDeltaFromMouseWheelLegacyEvent(s,k){let h=0;const A=.01*s*this.wheelDeltaPercentage*k;return h=s>0?A/(1+this.wheelDeltaPercentage):A*(1+this.wheelDeltaPercentage),h}attachControl(s){s=B.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=k=>{if(k.type!==c.c.POINTERWHEEL)return;const h=k.event;let A=0;const g=h.deltaMode===N.e.DOM_DELTA_LINE?40:1,ms=-h.deltaY*g;if(this.customComputeDeltaFromMouseWheel)A=this.customComputeDeltaFromMouseWheel(ms,this,h);else if(this.wheelDeltaPercentage){if(A=this._computeDeltaFromMouseWheelLegacyEvent(ms,this.camera.radius),A>0){let s=this.camera.radius,k=this.camera.inertialRadiusOffset+A;for(let h=0;h<20&&!(s<=k)&&!(Math.abs(k*this.camera.inertia)<.001);h++)s-=k,k*=this.camera.inertia;s=(0,K.Clamp)(s,0,Number.MAX_VALUE),A=this._computeDeltaFromMouseWheelLegacyEvent(ms,s)}}else A=ms/(40*this.wheelPrecision);A&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(A)):this.camera.inertialRadiusOffset+=A),h.preventDefault&&(s||h.preventDefault())},this._observer=this.camera.Is()._inputManager._addCameraPointerObserver(this._wheel,c.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Eg(0)}za(){this._observer&&(this.camera.Is()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const s=this.camera;0+s.inertialAlphaOffset+s.inertialBetaOffset+s.inertialRadiusOffset&&(this._updateHitPlane(),s.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(s.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const s=this.camera,k=s.target.Rk(s.position);this._hitPlane=I.b.FromPositionAndNormal(s.target,k)}_getPosition(){const s=this.camera,k=s.Is(),h=k.createPickingRay(k.pointerX,k.pointerY,i.Matrix.Identity(),s,!1);0===s.targetScreenOffset.x&&0===s.targetScreenOffset.y||(this._viewOffset.set(s.targetScreenOffset.x,s.targetScreenOffset.y,0),s.getViewMatrix().invertToRef(s._cameraTransformMatrix),this._globalOffset=i.Pk.TransformNormal(this._viewOffset,s._cameraTransformMatrix),h.origin.addInPlace(this._globalOffset));let A=0;return this._hitPlane&&(A=h.intersectsPlane(this._hitPlane)??0),h.origin.addInPlace(h.direction.scaleInPlace(A))}_zoomToMouse(s){const k=this.camera,h=1-k.inertia;if(k.lowerRadiusLimit){const A=k.lowerRadiusLimit??0;k.radius-(k.inertialRadiusOffset+s)/h<A&&(s=(k.radius-A)*h-k.inertialRadiusOffset)}if(k.upperRadiusLimit){const A=k.upperRadiusLimit??0;k.radius-(k.inertialRadiusOffset+s)/h>A&&(s=(k.radius-A)*h-k.inertialRadiusOffset)}const A=s/h/k.radius,g=this._getPosition(),ms=i.TmpVectors.Pk[6];g.subtractToRef(k.target,ms),ms.scaleInPlace(A),ms.scaleInPlace(h),this._inertialPanning.addInPlace(ms),k.inertialRadiusOffset+=s}_zeroIfClose(s){Math.abs(s.x)<a.c&&(s.x=0),Math.abs(s.y)<a.c&&(s.y=0),Math.abs(s.z)<a.c&&(s.z=0)}}(0,A.e)([(0,g.J)()],b.prototype,"wheelPrecision",void 0),(0,A.e)([(0,g.J)()],b.prototype,"zoomToMouseLocation",void 0),(0,A.e)([(0,g.J)()],b.prototype,"wheelDeltaPercentage",void 0),w.b.ArcRotateCameraMouseWheelInput=b;class t extends w.d{constructor(s){super(s)}addMouseWheel(){return this.add(new b),this}addPointers(){return this.add(new G),this}addKeyboard(){return this.add(new p),this}}var z=h(12543);function C(s,k){return isNaN(s)?k:s}H.e.AddNodeConstructor("ArcRotateCamera",((s,k)=>()=>new v(s,0,0,1,i.Pk.Zero(),k)));class v extends D.c{get target(){return this._target}set target(s){this.setTarget(s)}get targetHost(){return this._targetHost}set targetHost(s){s&&this.setTarget(s)}getTarget(){return this.target}get position(){return this._position}set position(s){this.setPosition(s)}set upVector(s){this._upToYMatrix||(this._yToUpMatrix=new i.Matrix,this._upToYMatrix=new i.Matrix,this._upVector=i.Pk.Zero()),s.normalize(),this._upVector.H(s),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){i.Matrix.RotationAlignToRef(i.Pk.UpReadOnly,this._upVector,this._yToUpMatrix),i.Matrix.RotationAlignToRef(this._upVector,i.Pk.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const s=this.inputs.attached.pointers;return s?s.angularSensibilityX:0}set angularSensibilityX(s){const k=this.inputs.attached.pointers;k&&(k.angularSensibilityX=s)}get angularSensibilityY(){const s=this.inputs.attached.pointers;return s?s.angularSensibilityY:0}set angularSensibilityY(s){const k=this.inputs.attached.pointers;k&&(k.angularSensibilityY=s)}get pinchPrecision(){const s=this.inputs.attached.pointers;return s?s.pinchPrecision:0}set pinchPrecision(s){const k=this.inputs.attached.pointers;k&&(k.pinchPrecision=s)}get pinchDeltaPercentage(){const s=this.inputs.attached.pointers;return s?s.pinchDeltaPercentage:0}set pinchDeltaPercentage(s){const k=this.inputs.attached.pointers;k&&(k.pinchDeltaPercentage=s)}get useNaturalPinchZoom(){const s=this.inputs.attached.pointers;return!!s&&s.useNaturalPinchZoom}set useNaturalPinchZoom(s){const k=this.inputs.attached.pointers;k&&(k.useNaturalPinchZoom=s)}get panningSensibility(){const s=this.inputs.attached.pointers;return s?s.panningSensibility:0}set panningSensibility(s){const k=this.inputs.attached.pointers;k&&(k.panningSensibility=s)}get keysUp(){const s=this.inputs.attached.keyboard;return s?s.keysUp:[]}set keysUp(s){const k=this.inputs.attached.keyboard;k&&(k.keysUp=s)}get keysDown(){const s=this.inputs.attached.keyboard;return s?s.keysDown:[]}set keysDown(s){const k=this.inputs.attached.keyboard;k&&(k.keysDown=s)}get keysLeft(){const s=this.inputs.attached.keyboard;return s?s.keysLeft:[]}set keysLeft(s){const k=this.inputs.attached.keyboard;k&&(k.keysLeft=s)}get keysRight(){const s=this.inputs.attached.keyboard;return s?s.keysRight:[]}set keysRight(s){const k=this.inputs.attached.keyboard;k&&(k.keysRight=s)}get wheelPrecision(){const s=this.inputs.attached.mousewheel;return s?s.wheelPrecision:0}set wheelPrecision(s){const k=this.inputs.attached.mousewheel;k&&(k.wheelPrecision=s)}get zoomToMouseLocation(){const s=this.inputs.attached.mousewheel;return!!s&&s.zoomToMouseLocation}set zoomToMouseLocation(s){const k=this.inputs.attached.mousewheel;k&&(k.zoomToMouseLocation=s)}get wheelDeltaPercentage(){const s=this.inputs.attached.mousewheel;return s?s.wheelDeltaPercentage:0}set wheelDeltaPercentage(s){const k=this.inputs.attached.mousewheel;k&&(k.wheelDeltaPercentage=s)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(s){s!==this.useBouncingBehavior&&(s?(this._bouncingBehavior=new j,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(s){s!==this.useFramingBehavior&&(s?(this._framingBehavior=new P,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(s){s!==this.useAutoRotationBehavior&&(s?(this._autoRotationBehavior=new r,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(s,k,h,A,g,K){var H;let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(s,i.Pk.Zero(),K,O),H=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=i.Pk.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=i.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new i.Matrix,this.panningAxis=new i.Pk(1,1,0),this._transformedDirection=new i.Pk,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new ms.c,this.checkCollisions=!1,this.collisionRadius=new i.Pk(.5,.5,.5),this._previousPosition=i.Pk.Zero(),this._collisionVelocity=i.Pk.Zero(),this._newPosition=i.Pk.Zero(),this._computationVector=i.Pk.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new i.Pk(NaN,NaN,NaN),this._goalTargetScreenOffset=new i.Vector2(NaN,NaN),this._onCollisionPositionChange=function(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h?(H.setPosition(k),H.td&&H.td(h)):H._previousPosition.H(H._position);const A=Math.cos(H.alpha),g=Math.sin(H.alpha),ms=Math.cos(H.beta);let i=Math.sin(H.beta);0===i&&(i=1e-4);const K=H._getTargetPosition();H._computationVector.cg(H.radius*A*i,H.radius*ms,H.radius*g*i),K.addToRef(H._computationVector,H._newPosition),H._position.H(H._newPosition);let O=H.upVector;H.allowUpsideDown&&H.beta<0&&(O=O.clone(),O=O.negate()),H._computeViewMatrix(H._position,K,O),H._viewMatrix.addAtIndex(12,H.targetScreenOffset.x),H._viewMatrix.addAtIndex(13,H.targetScreenOffset.y),H._collisionTriggered=!1},this._target=i.Pk.Zero(),g&&this.setTarget(g),this.alpha=k,this.beta=h,this.radius=A,this.getViewMatrix(),this.inputs=new t(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new i.Pk(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=i.Vector2.Zero()}_updateCache(s){s||super._updateCache(),this._cache._target.H(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.H(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const s=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?s.addToRef(this._targetBoundingCenter,this._target):this._target.H(s)}const s=this._getLockedTargetPosition();return s||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>a.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,ms=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=ms?this._currentInterpolationFactor=ms:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=C(s,this._goalAlpha),this._goalBeta=C(k,this._goalBeta),this._goalRadius=C(h,this._goalRadius),this._goalTarget.set(C(A.x,this._goalTarget.x),C(A.y,this._goalTarget.y),C(A.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(C(g.x,this._goalTargetScreenOffset.x),C(g.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,K.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,K.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,K.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,K.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(s,k){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const g=arguments;k=B.Tools.BackCompatCameraNoPreventDefault(g),this._useCtrlForPanning=h,this._panningMouseButton=A,"boolean"===typeof g[0]&&(g.length>1&&(this._useCtrlForPanning=g[1]),g.length>2&&(this._panningMouseButton=g[2])),this.inputs.attachElement(k),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}za(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let s=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){s=!0;const k=this.invertRotation?-1:1,h=this._calculateHandednessMultiplier();let A=this.inertialAlphaOffset*h;this.beta<0&&(A*=-1),this.alpha+=A*k,this.beta+=this.inertialBetaOffset*k,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<a.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<a.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*a.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){s=!0;const k=new i.Pk(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),k.multiplyInPlace(this.panningAxis),i.Pk.TransformNormalToRef(k,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const s=this.upVector,k=i.Pk.CrossToRef(this._transformedDirection,s,this._transformedDirection);i.Pk.CrossToRef(s,k,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);i.Pk.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.H(this._transformedDirection)}else{if(this.parent){const s=i.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.transposeToRef(s),i.Pk.TransformCoordinatesToRef(this._transformedDirection,s,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*a.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*a.c&&(this.inertialPanningY=0)}if(s)this.stopInterpolation();else if(this._isInterpolating){let s=!1;const k=this._scene.getEngine().getDeltaTime()/1e3,h=1-Math.pow(2,-k/this._currentInterpolationFactor),A=C(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const k=i.TmpVectors.Pk[0].set(C(this._goalTarget.x,this._target.x),C(this._goalTarget.y,this._target.y),C(this._goalTarget.z,this._target.z));i.Pk.LerpToRef(this.target,k,h,this._target),10*i.Pk.Distance(this.target,k)/A<a.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.H(k),this.setTarget(this.target,!1,!0,!0)):s=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const k=i.Quaternion.RotationAlphaBetaGammaToRef(C(this._goalAlpha,this.alpha),C(this._goalBeta,this.beta),0,i.TmpVectors.Quaternion[0]),A=i.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,i.TmpVectors.Quaternion[1]),g=i.Quaternion.SlerpToRef(A,k,h,i.TmpVectors.Quaternion[2]);g.normalize();const ms=g.toAlphaBetaGammaToRef(i.TmpVectors.Pk[0]);if(this.alpha=ms.x,this.beta=ms.y,g.isApprox(k,a.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const s=k.toAlphaBetaGammaToRef(i.TmpVectors.Pk[0]);this.alpha=s.x,this.beta=s.y}else s=!0}if(isNaN(this._goalRadius)||(this.radius+=(A-this.radius)*h,Math.abs(A/this.radius-1)<a.c?(this._goalRadius=NaN,this.radius=A):s=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const k=i.TmpVectors.Vector2[0].set(C(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),C(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));i.Vector2.LerpToRef(this.targetScreenOffset,k,h,this.targetScreenOffset),i.Vector2.Distance(this.targetScreenOffset,k)<a.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.H(k)):s=!0}this._isInterpolating=s}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.Pk.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const s=this.alpha;var k,h;this.alpha=function(s){let k=Math.PI/2;return 0===s.x&&0===s.z||(k=Math.acos(s.x/Math.sqrt(Math.pow(s.x,2)+Math.pow(s.z,2)))),s.z<0&&(k=2*Math.PI-k),k}(this._computationVector),this.beta=(k=this._computationVector.y,h=this.radius,Math.acos(k/h));const A=Math.round((s-this.alpha)/(2*Math.PI));this.alpha+=2*A*Math.PI,this._checkLimits()}setPosition(s){this._position.equals(s)||(this._position.H(s),this.rebuildAnglesAndRadius())}setTarget(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(A=this.overrideCloneAlphaBetaRadius??A,s.fh)k&&s.getBoundingInfo?this._targetBoundingCenter=s.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,s.fh(),this._targetHost=s,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const k=s,A=this._getTargetPosition();if(A&&!h&&A.equals(k))return;this._targetHost=null,this._target=k,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}A||this.rebuildAnglesAndRadius()}_getViewMatrix(){const s=Math.cos(this.alpha),k=Math.sin(this.alpha),h=Math.cos(this.beta);let A=Math.sin(this.beta);0===A&&(A=1e-4),0===this.radius&&(this.radius=1e-4);const g=this._getTargetPosition();if(this._computationVector.cg(this.radius*s*A,this.radius*h,this.radius*k*A),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.Pk.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),g.addToRef(this._computationVector,this._newPosition),this.Is().collisionsEnabled&&this.checkCollisions){const s=this.Is().collisionCoordinator;this._collider||(this._collider=s.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,s.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.H(this._newPosition);let s=this.upVector;this.allowUpsideDown&&A<0&&(s=s.negate()),this._computeViewMatrix(this._position,g,s),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.H(g),this._viewMatrix}zoomOn(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s=s||this.Is().meshes;const h=O.e.MinMax(s);let A=this._calculateLowerRadiusFromModelBoundingSphere(h.min,h.max);if(A=Math.max(Math.min(A,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=A*this.zoomOnFactor,this.mode===R.d.ORTHOGRAPHIC_CAMERA){const s=this.Is().getEngine().getAspectRatio(this),k=A*this.zoomOnFactor/2;this.orthoLeft=-k*s,this.orthoRight=k*s,this.orthoBottom=-k,this.orthoTop=k}this.focusOn({min:h.min,max:h.max,distance:A},k)}focusOn(s){let k,h,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===s.min){const A=s||this.Is().meshes;k=O.e.MinMax(A),h=i.Pk.Distance(k.min,k.max)}else{k=s,h=s.distance}this._target=O.e.Center(k),A||(this.maxZ=2*h)}createRigCamera(s,k){let h=0;switch(this.cameraRigMode){case R.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.d.RIG_MODE_VR:h=this._cameraRigParams.stereoHalfAngle*(0===k?1:-1);break;case R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h=this._cameraRigParams.stereoHalfAngle*(0===k?-1:1)}const A=new v(s,this.alpha+h,this.beta,this.radius,this._target,this.Is());return A._cameraRigParams={},A.isRigCamera=!0,A.rigParent=this,A.upVector=this.upVector,A.mode=this.mode,A.orthoLeft=this.orthoLeft,A.orthoRight=this.orthoRight,A.orthoBottom=this.orthoBottom,A.orthoTop=this.orthoTop,A}_updateRigCameras(){const s=this._rigCameras[0],k=this._rigCameras[1];switch(s.beta=k.beta=this.beta,this.cameraRigMode){case R.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.d.RIG_MODE_VR:s.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,k.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:s.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,k.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const A=i.Pk.Distance(s,k),g=this.Is().getEngine().getAspectRatio(this),ms=Math.tan(this.fov/2),K=ms*g,H=.5*A*h,O=H*Math.sqrt(1+1/(K*K)),c=H*Math.sqrt(1+1/(ms*ms));return Math.max(O,c)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,A.e)([(0,g.J)()],v.prototype,"alpha",void 0),(0,A.e)([(0,g.J)()],v.prototype,"beta",void 0),(0,A.e)([(0,g.J)()],v.prototype,"radius",void 0),(0,A.e)([(0,g.J)()],v.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,A.e)([(0,g.G)("target")],v.prototype,"_target",void 0),(0,A.e)([(0,g.z)("targetHost")],v.prototype,"_targetHost",void 0),(0,A.e)([(0,g.J)()],v.prototype,"inertialAlphaOffset",void 0),(0,A.e)([(0,g.J)()],v.prototype,"inertialBetaOffset",void 0),(0,A.e)([(0,g.J)()],v.prototype,"inertialRadiusOffset",void 0),(0,A.e)([(0,g.J)()],v.prototype,"lowerAlphaLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"upperAlphaLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"lowerBetaLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"upperBetaLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"lowerRadiusLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"upperRadiusLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"lowerTargetYLimit",void 0),(0,A.e)([(0,g.J)()],v.prototype,"inertialPanningX",void 0),(0,A.e)([(0,g.J)()],v.prototype,"inertialPanningY",void 0),(0,A.e)([(0,g.J)()],v.prototype,"pinchToPanMaxDistance",void 0),(0,A.e)([(0,g.J)()],v.prototype,"panningDistanceLimit",void 0),(0,A.e)([(0,g.G)()],v.prototype,"panningOriginTarget",void 0),(0,A.e)([(0,g.J)()],v.prototype,"panningInertia",void 0),(0,A.e)([(0,g.J)()],v.prototype,"zoomToMouseLocation",null),(0,A.e)([(0,g.J)()],v.prototype,"zoomOnFactor",void 0),(0,A.e)([(0,g.F)()],v.prototype,"targetScreenOffset",void 0),(0,A.e)([(0,g.J)()],v.prototype,"allowUpsideDown",void 0),(0,A.e)([(0,g.J)()],v.prototype,"useInputToRestoreState",void 0),(0,A.e)([(0,g.J)()],v.prototype,"restoreStateInterpolationFactor",void 0),(0,z.f)("BABYLON.ArcRotateCamera",v)},14225:(s,k,h)=>{"use strict";h.d(k,{b:()=>i,d:()=>K});var A=h(12422),g=h(12623),ms=h(13067),i={};class K{constructor(s){this.attachedToElement=!1,this.attached={},this.camera=s,this.checkInputs=()=>{}}add(s){const k=s.getSimpleName();this.attached[k]?A.c.Warn("camera input of type "+k+" already exists on camera"):(this.attached[k]=s,s.camera=this.camera,s.checkInputs&&(this.checkInputs=this._addCheckInputs(s.checkInputs.bind(s))),this.attachedToElement&&s.attachControl(this.noPreventDefault))}remove(s){for(const k in this.attached){const h=this.attached[k];if(h===s)return h.za(),h.camera=null,delete this.attached[k],void this.rebuildInputCheck()}}removeByType(s){for(const k in this.attached){const h=this.attached[k];h.getClassName()===s&&(h.za(),h.camera=null,delete this.attached[k],this.rebuildInputCheck())}}_addCheckInputs(s){const k=this.checkInputs;return()=>{k(),s()}}attachInput(s){this.attachedToElement&&s.attachControl(this.noPreventDefault)}attachElement(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){s=!ms.d.ForceAttachControlToAlwaysPreventDefault&&s,this.attachedToElement=!0,this.noPreventDefault=s;for(const k in this.attached)this.attached[k].attachControl(s)}}detachElement(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const k in this.attached)this.attached[k].za(),s&&(this.attached[k].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const s in this.attached){const k=this.attached[s];k.checkInputs&&(this.checkInputs=this._addCheckInputs(k.checkInputs.bind(k)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(s){const k={};for(const h in this.attached){const s=this.attached[h],A=g.e.Serialize(s);k[s.getClassName()]=A}s.inputsmgr=k}parse(s){const k=s.inputsmgr;if(k){this.clear();for(const s in k){const h=i[s];if(h){const A=k[s],ms=g.e.Parse((()=>new h),A,null);this.add(ms)}}}else for(const h in this.attached){const k=i[this.attached[h].getClassName()];if(k){const A=g.e.Parse((()=>new k),s,null);this.remove(this.attached[h]),this.add(A)}}}}},14223:(s,k,h)=>{"use strict";h.d(k,{e:()=>u});var A=h(12570),g=h(12579),ms=h(12590),i=h(13096),K=h(14225),H=h(12874),O=h(12402);class c{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(s){s=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Is(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((k=>{const h=k.event;if(!h.metaKey)if(k.type===H.c.KEYDOWN){if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),s||h.preventDefault()}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){const k=this._keys.indexOf(h.keyCode);k>=0&&this._keys.splice(k,1),s||h.preventDefault()}})))}za(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const s=this.camera;for(let k=0;k<this._keys.length;k++){const h=this._keys[k],A=s._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(h)?s._localDirection.cg(-A,0,0):-1!==this.keysUp.indexOf(h)?s._localDirection.cg(0,0,A):-1!==this.keysRight.indexOf(h)?s._localDirection.cg(A,0,0):-1!==this.keysDown.indexOf(h)?s._localDirection.cg(0,0,-A):-1!==this.keysUpward.indexOf(h)?s._localDirection.cg(0,A,0):-1!==this.keysDownward.indexOf(h)?s._localDirection.cg(0,-A,0):-1!==this.keysRotateLeft.indexOf(h)?(s._localDirection.cg(0,0,0),s.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(h)?(s._localDirection.cg(0,0,0),s.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(h)?(s._localDirection.cg(0,0,0),s.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(h)&&(s._localDirection.cg(0,0,0),s.cameraRotation.x+=this._getLocalRotation()),s.Is().useRightHandedSystem&&(s._localDirection.z*=-1),s.getViewMatrix().invertToRef(s._cameraTransformMatrix),ms.Pk.TransformNormalToRef(s._localDirection,s._cameraTransformMatrix,s._transformedDirection),s.cameraDirection.addInPlace(s._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const s=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*s}}(0,A.e)([(0,g.J)()],c.prototype,"keysUp",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysUpward",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysDown",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysDownward",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysLeft",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysRight",void 0),(0,A.e)([(0,g.J)()],c.prototype,"rotationSpeed",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysRotateLeft",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysRotateRight",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysRotateUp",void 0),(0,A.e)([(0,g.J)()],c.prototype,"keysRotateDown",void 0),K.b.FreeCameraKeyboardMoveInput=c;var S=h(12408),a=h(12871);class r{constructor(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=s,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new S.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(s){s=O.Tools.BackCompatCameraNoPreventDefault(arguments);const k=this.camera.getEngine(),h=k.getInputElement();this._pointerInput||(this._pointerInput=A=>{const g=A.event,ms="touch"===g.pointerType;if(!this.touchEnabled&&ms)return;if(A.type!==a.c.POINTERMOVE&&-1===this.buttons.indexOf(g.button))return;const i=g.target;if(A.type===a.c.POINTERDOWN){if(ms&&-1!==this._activePointerId||!ms&&-1!==this._currentActiveButton)return;this._activePointerId=g.pointerId;try{null===i||void 0===i||i.setPointerCapture(g.pointerId)}catch(K){}-1===this._currentActiveButton&&(this._currentActiveButton=g.button),this._previousPosition={x:g.clientX,y:g.clientY},s||(g.preventDefault(),h&&h.focus()),k.isPointerLock&&this._onMouseMove&&this._onMouseMove(A.event)}else if(A.type===a.c.POINTERUP){if(ms&&this._activePointerId!==g.pointerId||!ms&&this._currentActiveButton!==g.button)return;try{null===i||void 0===i||i.releasePointerCapture(g.pointerId)}catch(K){}this._currentActiveButton=-1,this._previousPosition=null,s||g.preventDefault(),this._activePointerId=-1}else if(A.type===a.c.POINTERMOVE&&(this._activePointerId===g.pointerId||!ms))if(k.isPointerLock&&this._onMouseMove)this._onMouseMove(A.event);else if(this._previousPosition){const k=this.camera._calculateHandednessMultiplier(),h=(g.clientX-this._previousPosition.x)*k,A=g.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=h/this.angularSensibility,this.camera.cameraRotation.x+=A/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:h,offsetY:A}),this._previousPosition={x:g.clientX,y:g.clientY},s||g.preventDefault()}}),this._onMouseMove=h=>{if(!k.isPointerLock)return;const A=this.camera._calculateHandednessMultiplier(),g=h.movementX*A;this.camera.cameraRotation.y+=g/this.angularSensibility;const ms=h.movementY;this.camera.cameraRotation.x+=ms/this.angularSensibility,this._previousPosition=null,s||h.preventDefault()},this._observer=this.camera.Is()._inputManager._addCameraPointerObserver(this._pointerInput,a.c.POINTERDOWN|a.c.POINTERUP|a.c.POINTERMOVE),h&&(this._contextMenuBind=s=>this.onContextMenu(s),h.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(s){s.preventDefault()}za(){if(this._observer){if(this.camera.Is()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const s=this.camera.getEngine().getInputElement();s&&s.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,A.e)([(0,g.J)()],r.prototype,"buttons",void 0),(0,A.e)([(0,g.J)()],r.prototype,"angularSensibility",void 0),K.b.FreeCameraMouseInput=r;var d,E=h(12882);class j{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new S.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(s){s=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=k=>{if(k.type!==a.c.POINTERWHEEL)return;const h=k.event,A=h.deltaMode===E.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*A*h.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*A*h.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*A*h.deltaZ/this._normalize,h.preventDefault&&(s||h.preventDefault())},this._observer=this.camera.Is()._inputManager._addCameraPointerObserver(this._wheel,a.c.POINTERWHEEL)}za(){this._observer&&(this.camera.Is()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,A.e)([(0,g.J)()],j.prototype,"wheelPrecisionX",void 0),(0,A.e)([(0,g.J)()],j.prototype,"wheelPrecisionY",void 0),(0,A.e)([(0,g.J)()],j.prototype,"wheelPrecisionZ",void 0),function(s){s[s.MoveRelative=0]="MoveRelative",s[s.RotateRelative=1]="RotateRelative",s[s.MoveScene=2]="MoveScene"}(d||(d={}));class P extends j{constructor(){super(...arguments),this._moveRelative=ms.Pk.Zero(),this._rotateRelative=ms.Pk.Zero(),this._moveScene=ms.Pk.Zero(),this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(s){null===s&&this._wheelXAction!==d.MoveRelative||(this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=s)}get wheelXMoveRelative(){return this._wheelXAction!==d.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(s){null===s&&this._wheelYAction!==d.MoveRelative||(this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=s)}get wheelYMoveRelative(){return this._wheelYAction!==d.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(s){null===s&&this._wheelZAction!==d.MoveRelative||(this._wheelZAction=d.MoveRelative,this._wheelZActionCoordinate=s)}get wheelZMoveRelative(){return this._wheelZAction!==d.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(s){null===s&&this._wheelXAction!==d.RotateRelative||(this._wheelXAction=d.RotateRelative,this._wheelXActionCoordinate=s)}get wheelXRotateRelative(){return this._wheelXAction!==d.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(s){null===s&&this._wheelYAction!==d.RotateRelative||(this._wheelYAction=d.RotateRelative,this._wheelYActionCoordinate=s)}get wheelYRotateRelative(){return this._wheelYAction!==d.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(s){null===s&&this._wheelZAction!==d.RotateRelative||(this._wheelZAction=d.RotateRelative,this._wheelZActionCoordinate=s)}get wheelZRotateRelative(){return this._wheelZAction!==d.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(s){null===s&&this._wheelXAction!==d.MoveScene||(this._wheelXAction=d.MoveScene,this._wheelXActionCoordinate=s)}get wheelXMoveScene(){return this._wheelXAction!==d.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(s){null===s&&this._wheelYAction!==d.MoveScene||(this._wheelYAction=d.MoveScene,this._wheelYActionCoordinate=s)}get wheelYMoveScene(){return this._wheelYAction!==d.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(s){null===s&&this._wheelZAction!==d.MoveScene||(this._wheelZAction=d.MoveScene,this._wheelZActionCoordinate=s)}get wheelZMoveScene(){return this._wheelZAction!==d.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Eg(0),this._rotateRelative.Eg(0),this._moveScene.Eg(0),this._updateCamera(),this.camera.Is().useRightHandedSystem&&(this._moveRelative.z*=-1);const s=ms.Matrix.Zero();this.camera.getViewMatrix().invertToRef(s);const k=ms.Pk.Zero();ms.Pk.TransformNormalToRef(this._moveRelative,s,k),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(k),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(s,k,h){if(0===s)return;if(null===k||null===h)return;let A=null;switch(k){case d.MoveRelative:A=this._moveRelative;break;case d.RotateRelative:A=this._rotateRelative;break;case d.MoveScene:A=this._moveScene}switch(h){case 0:A.set(s,0,0);break;case 1:A.set(0,s,0);break;case 2:A.set(0,0,s)}}}(0,A.e)([(0,g.J)()],P.prototype,"wheelXMoveRelative",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelYMoveRelative",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelZMoveRelative",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelXRotateRelative",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelYRotateRelative",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelZRotateRelative",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelXMoveScene",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelYMoveScene",null),(0,A.e)([(0,g.J)()],P.prototype,"wheelZMoveScene",null),K.b.FreeCameraMouseWheelInput=P;class R{constructor(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=s,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=O.Tools.IsSafari()}attachControl(s){s=O.Tools.BackCompatCameraNoPreventDefault(arguments);let k=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=h=>{const A=h.event,g="mouse"===A.pointerType||this._isSafari&&"undefined"===typeof A.pointerType;if(this.allowMouse||!g)if(h.type===a.c.POINTERDOWN){if(s||A.preventDefault(),this._pointerPressed.push(A.pointerId),1!==this._pointerPressed.length)return;k={x:A.clientX,y:A.clientY}}else if(h.type===a.c.POINTERUP){s||A.preventDefault();const h=this._pointerPressed.indexOf(A.pointerId);if(-1===h)return;if(this._pointerPressed.splice(h,1),0!=h)return;k=null,this._offsetX=null,this._offsetY=null}else if(h.type===a.c.POINTERMOVE){if(s||A.preventDefault(),!k)return;if(0!=this._pointerPressed.indexOf(A.pointerId))return;this._offsetX=A.clientX-k.x,this._offsetY=-(A.clientY-k.y)}}),this._observer=this.camera.Is()._inputManager._addCameraPointerObserver(this._pointerInput,a.c.POINTERDOWN|a.c.POINTERUP|a.c.POINTERMOVE),this._onLostFocus){const s=this.camera.getEngine().getInputElement();s&&s.addEventListener("blur",this._onLostFocus)}}za(){if(this._pointerInput){if(this._observer&&(this.camera.Is()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const s=this.camera.getEngine().getInputElement();s&&s.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const s=this.camera,k=s._calculateHandednessMultiplier();s.cameraRotation.y=k*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)s.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const k=s._computeLocalCameraSpeed(),h=new ms.Pk(0,0,0!==this.touchMoveSensibility?k*this._offsetY/this.touchMoveSensibility:0);ms.Matrix.RotationYawPitchRollToRef(s.rotation.y,s.rotation.x,0,s._cameraRotationMatrix),s.cameraDirection.addInPlace(ms.Pk.TransformCoordinates(h,s._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,A.e)([(0,g.J)()],R.prototype,"touchAngularSensibility",void 0),(0,A.e)([(0,g.J)()],R.prototype,"touchMoveSensibility",void 0),K.b.FreeCameraTouchInput=R;class D extends K.d{constructor(s){super(s),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new c),this}addMouse(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new r(s),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new P,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new R),this}clear(){super.clear(),this._mouseInput=null}}var w=h(12543),B=h(12481);class u extends i.c{get angularSensibility(){const s=this.inputs.attached.mouse;return s?s.angularSensibility:0}set angularSensibility(s){const k=this.inputs.attached.mouse;k&&(k.angularSensibility=s)}get keysUp(){const s=this.inputs.attached.keyboard;return s?s.keysUp:[]}set keysUp(s){const k=this.inputs.attached.keyboard;k&&(k.keysUp=s)}get keysUpward(){const s=this.inputs.attached.keyboard;return s?s.keysUpward:[]}set keysUpward(s){const k=this.inputs.attached.keyboard;k&&(k.keysUpward=s)}get keysDown(){const s=this.inputs.attached.keyboard;return s?s.keysDown:[]}set keysDown(s){const k=this.inputs.attached.keyboard;k&&(k.keysDown=s)}get keysDownward(){const s=this.inputs.attached.keyboard;return s?s.keysDownward:[]}set keysDownward(s){const k=this.inputs.attached.keyboard;k&&(k.keysDownward=s)}get keysLeft(){const s=this.inputs.attached.keyboard;return s?s.keysLeft:[]}set keysLeft(s){const k=this.inputs.attached.keyboard;k&&(k.keysLeft=s)}get keysRight(){const s=this.inputs.attached.keyboard;return s?s.keysRight:[]}set keysRight(s){const k=this.inputs.attached.keyboard;k&&(k.keysRight=s)}get keysRotateLeft(){const s=this.inputs.attached.keyboard;return s?s.keysRotateLeft:[]}set keysRotateLeft(s){const k=this.inputs.attached.keyboard;k&&(k.keysRotateLeft=s)}get keysRotateRight(){const s=this.inputs.attached.keyboard;return s?s.keysRotateRight:[]}set keysRotateRight(s){const k=this.inputs.attached.keyboard;k&&(k.keysRotateRight=s)}get keysRotateUp(){const s=this.inputs.attached.keyboard;return s?s.keysRotateUp:[]}set keysRotateUp(s){const k=this.inputs.attached.keyboard;k&&(k.keysRotateUp=s)}get keysRotateDown(){const s=this.inputs.attached.keyboard;return s?s.keysRotateDown:[]}set keysRotateDown(s){const k=this.inputs.attached.keyboard;k&&(k.keysRotateDown=s)}constructor(s,k,h){var A;super(s,k,h,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),A=this,this.ellipsoid=new ms.Pk(.5,1,.5),this.ellipsoidOffset=new ms.Pk(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=ms.Pk.Zero(),this._diffPosition=ms.Pk.Zero(),this._newPosition=ms.Pk.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A._newPosition.H(k),A._newPosition.subtractToRef(A._oldPosition,A._diffPosition),A._diffPosition.length()>B.e.CollisionsEpsilon&&(A.position.addToRef(A._diffPosition,A._deferredPositionUpdate),A._deferOnly?A._deferredUpdated=!0:A.position.H(A._deferredPositionUpdate),A.td&&h&&A.td(h))},this.inputs=new D(this),this.inputs.addKeyboard().addMouse()}attachControl(s,k){k=O.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(k)}za(){this.inputs.detachElement(),this.cameraDirection=new ms.Pk(0,0,0),this.cameraRotation=new ms.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(s){this._collisionMask=isNaN(s)?-1:s}_collideWithWorld(s){let k;k=this.parent?ms.Pk.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,k.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const h=this.Is().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let A=s;this.applyGravity&&(A=s.add(this.Is().gravity)),h.getNewPosition(this._oldPosition,A,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=ms.Pk.Zero(),this._transformedDirection=ms.Pk.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(s){this._needMoveForGravity=s}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Is().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"lg"}}(0,A.e)([(0,g.G)()],u.prototype,"ellipsoid",void 0),(0,A.e)([(0,g.G)()],u.prototype,"ellipsoidOffset",void 0),(0,A.e)([(0,g.J)()],u.prototype,"checkCollisions",void 0),(0,A.e)([(0,g.J)()],u.prototype,"applyGravity",void 0),(0,w.f)("BABYLON.FreeCamera",u)},14821:(s,k,h)=>{"use strict";h.d(k,{c:()=>ms});var A=h(12688),g=h(14829);class ms{constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=h,this.lS=[],this._maxBlockCapacity=k||64,this._selectionContent=new A.e(1024),this._creationFunc=s}update(s,k,h){g.c._CreateBlocks(s,k,h,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}gS(s){for(let k=0;k<this.jS.length;k++){this.jS[k].addEntry(s)}}AS(s){for(let k=0;k<this.jS.length;k++){this.jS[k].removeEntry(s)}}select(s,k){this._selectionContent.reset();for(let h=0;h<this.jS.length;h++){this.jS[h].select(s,this._selectionContent,k)}return k?this._selectionContent.concat(this.lS):this._selectionContent.concatWithNoDuplicate(this.lS),this._selectionContent}intersects(s,k,h){this._selectionContent.reset();for(let A=0;A<this.jS.length;A++){this.jS[A].intersects(s,k,this._selectionContent,h)}return h?this._selectionContent.concat(this.lS):this._selectionContent.concatWithNoDuplicate(this.lS),this._selectionContent}intersectsRay(s){this._selectionContent.reset();for(let k=0;k<this.jS.length;k++){this.jS[k].intersectsRay(s,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.lS),this._selectionContent}}ms.CreationFuncForMeshes=(s,k)=>{const h=s.getBoundingInfo();!s.isBlocked&&h.boundingBox.intersectsMinMax(k.ha,k.Aa)&&k.entries.push(s)},ms.CreationFuncForSubMeshes=(s,k)=>{s.getBoundingInfo().boundingBox.intersectsMinMax(k.ha,k.Aa)&&k.entries.push(s)}},14829:(s,k,h)=>{"use strict";h.d(k,{c:()=>ms});var A=h(12590),g=h(12946);class ms{constructor(s,k,h,A,g,ms){this.entries=[],this.ga=new Array,this._capacity=h,this._depth=A,this._maxDepth=g,this._creationFunc=ms,this._minPoint=s,this._maxPoint=k,this.ga.push(s.clone()),this.ga.push(k.clone()),this.ga.push(s.clone()),this.ga[2].x=k.x,this.ga.push(s.clone()),this.ga[3].y=k.y,this.ga.push(s.clone()),this.ga[4].z=k.z,this.ga.push(k.clone()),this.ga[5].z=s.z,this.ga.push(k.clone()),this.ga[6].x=s.x,this.ga.push(k.clone()),this.ga[7].y=s.y}get Ch(){return this._capacity}get ha(){return this._minPoint}get Aa(){return this._maxPoint}addEntry(s){if(this.jS)for(let k=0;k<this.jS.length;k++){this.jS[k].addEntry(s)}else this._creationFunc(s,this),this.entries.length>this.Ch&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(s){if(this.jS){for(let k=0;k<this.jS.length;k++){this.jS[k].removeEntry(s)}return}const k=this.entries.indexOf(s);k>-1&&this.entries.splice(k,1)}addEntries(s){for(let k=0;k<s.length;k++){const h=s[k];this.addEntry(h)}}select(s,k,h){if(g.b.IsInFrustum(this.ga,s)){if(this.jS){for(let A=0;A<this.jS.length;A++){this.jS[A].select(s,k,h)}return}h?k.concat(this.entries):k.concatWithNoDuplicate(this.entries)}}intersects(s,k,h,A){if(g.b.IntersectsSphere(this._minPoint,this._maxPoint,s,k)){if(this.jS){for(let g=0;g<this.jS.length;g++){this.jS[g].intersects(s,k,h,A)}return}A?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersectsRay(s,k){if(s.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.jS){for(let h=0;h<this.jS.length;h++){this.jS[h].intersectsRay(s,k)}return}k.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){ms._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(s,k,h,g,i,K,H,O){H.jS=new Array;const c=new A.Pk((k.x-s.x)/2,(k.y-s.y)/2,(k.z-s.z)/2);for(let A=0;A<2;A++)for(let k=0;k<2;k++)for(let S=0;S<2;S++){const a=s.add(c.multiplyByFloats(A,k,S)),r=s.add(c.multiplyByFloats(A+1,k+1,S+1)),d=new ms(a,r,g,i+1,K,O);d.addEntries(h),H.jS.push(d)}}}},14835:(s,k,h)=>{"use strict";h.d(k,{d:()=>c});var A=h(12836),g=h(12590),ms=h(13043),i=h(13986),K=h(12869),H=h(14821),O=h(12445);A.d.prototype.createOrUpdateSelectionOctree=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,h=this._getComponent(K.e.NAME_OCTREE);h||(h=new c(this),this.o(h)),this.FS||(this.FS=new H.c(H.c.CreationFuncForMeshes,s,k));const A=this.getWorldExtends();return this.FS.update(A.min,A.max,this.meshes),this.FS},Object.defineProperty(A.d.prototype,"selectionOctree",{get:function(){return this.FS},enumerable:!0,configurable:!0}),ms.e.prototype.createOrUpdateSubmeshesOctree=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const h=this.Is();let A=h._getComponent(K.e.NAME_OCTREE);A||(A=new c(h),h.o(A)),this._submeshesOctree||(this._submeshesOctree=new H.c(H.c.CreationFuncForSubMeshes,s,k)),this.fh(!0);const g=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(g.minimumWorld,g.maximumWorld,this.Lh),this._submeshesOctree};class c{constructor(s){this.name=K.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new i.c(g.Pk.Zero(),new g.Pk(1,1,1)),(s=s||O.b.LastCreatedScene)&&(this.Dk=s,this.Dk.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Dk.getActiveSubMeshCandidates=s=>this.getActiveSubMeshCandidates(s),this.Dk.getCollidingSubMeshCandidates=(s,k)=>this.getCollidingSubMeshCandidates(s,k),this.Dk.getIntersectingSubMeshCandidates=(s,k)=>this.getIntersectingSubMeshCandidates(s,k))}register(){this.Dk.onMeshRemovedObservable.add((s=>{const k=this.Dk.selectionOctree;if(void 0!==k&&null!==k){const h=k.lS.indexOf(s);-1!==h&&k.lS.splice(h,1)}})),this.Dk.onMeshImportedObservable.add((s=>{const k=this.Dk.selectionOctree;void 0!==k&&null!==k&&k.gS(s)}))}getActiveMeshCandidates(){var s;return(null===(s=this.Dk.FS)||void 0===s?void 0:s.select(this.Dk.frustumPlanes))||this.Dk._getDefaultMeshCandidates()}getActiveSubMeshCandidates(s){if(s._submeshesOctree&&s.useOctreeForRenderingSelection){return s._submeshesOctree.select(this.Dk.frustumPlanes)}return this.Dk._getDefaultSubMeshCandidates(s)}getIntersectingSubMeshCandidates(s,k){if(s._submeshesOctree&&s.useOctreeForPicking){i.c.TransformToRef(k,s.getWorldMatrix(),this._tempRay);return s._submeshesOctree.intersectsRay(this._tempRay)}return this.Dk._getDefaultSubMeshCandidates(s)}getCollidingSubMeshCandidates(s,k){if(s._submeshesOctree&&s.useOctreeForCollisions){const h=k._velocityWorldLength+Math.max(k._radius.x,k._radius.y,k._radius.z);return s._submeshesOctree.intersects(k._basePointWorld,h)}return this.Dk._getDefaultSubMeshCandidates(s)}rebuild(){}dispose(){}}},13986:(s,k,h)=>{"use strict";h.d(k,{c:()=>r});var A=h(12836),g=h(13067),ms=h(12598),i=h(12590),K=h(12603),H=h(12931),O=h(12865),c=h(12445),S=h(12887);const a={internalPickerForMesh:void 0};class r{constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ms.c;this.origin=s,this.direction=k,this.length=h,this.epsilon=A}clone(){return new r(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const A=r._TmpVector3[0].cg(s.x-h,s.y-h,s.z-h),g=r._TmpVector3[1].cg(k.x+h,k.y+h,k.z+h);let ms,i,K,H,O=0,c=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<A.x||this.origin.x>g.x)return!1}else if(ms=1/this.direction.x,i=(A.x-this.origin.x)*ms,K=(g.x-this.origin.x)*ms,K===-1/0&&(K=1/0),i>K&&(H=i,i=K,K=H),O=Math.max(i,O),c=Math.min(K,c),O>c)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<A.y||this.origin.y>g.y)return!1}else if(ms=1/this.direction.y,i=(A.y-this.origin.y)*ms,K=(g.y-this.origin.y)*ms,K===-1/0&&(K=1/0),i>K&&(H=i,i=K,K=H),O=Math.max(i,O),c=Math.min(K,c),O>c)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<A.z||this.origin.z>g.z)return!1}else if(ms=1/this.direction.z,i=(A.z-this.origin.z)*ms,K=(g.z-this.origin.z)*ms,K===-1/0&&(K=1/0),i>K&&(H=i,i=K,K=H),O=Math.max(i,O),c=Math.min(K,c),O>c)return!1;return!0}intersectsBox(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(s.minimum,s.maximum,k)}intersectsSphere(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=s.center.x-this.origin.x,A=s.center.y-this.origin.y,g=s.center.z-this.origin.z,ms=h*h+A*A+g*g,i=s.radius+k,K=i*i;if(ms<=K)return!0;const H=h*this.direction.x+A*this.direction.y+g*this.direction.z;if(H<0)return!1;return ms-H*H<=K}intersectsTriangle(s,k,h){const A=r._TmpVector3[0],g=r._TmpVector3[1],ms=r._TmpVector3[2],K=r._TmpVector3[3],O=r._TmpVector3[4];k.subtractToRef(s,A),h.subtractToRef(s,g),i.Pk.CrossToRef(this.direction,g,ms);const c=i.Pk.Dot(A,ms);if(0===c)return null;const S=1/c;this.origin.subtractToRef(s,K);const a=i.Pk.Dot(K,ms)*S;if(a<-this.epsilon||a>1+this.epsilon)return null;i.Pk.CrossToRef(K,A,O);const d=i.Pk.Dot(this.direction,O)*S;if(d<-this.epsilon||a+d>1+this.epsilon)return null;const E=i.Pk.Dot(g,O)*S;return E>this.length?null:new H.e(1-a-d,a,E)}intersectsPlane(s){let k;const h=i.Pk.Dot(s.normal,this.direction);if(Math.abs(h)<9.99999997475243e-7)return null;{const A=i.Pk.Dot(s.normal,this.origin);return k=(-s.d-A)/h,k<0?k<-9.99999997475243e-7?null:0:k}}intersectsAxis(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(s){case"y":{const s=(this.origin.y-k)/this.direction.y;return s>0?null:new i.Pk(this.origin.x+this.direction.x*-s,k,this.origin.z+this.direction.z*-s)}case"x":{const s=(this.origin.x-k)/this.direction.x;return s>0?null:new i.Pk(k,this.origin.y+this.direction.y*-s,this.origin.z+this.direction.z*-s)}case"z":{const s=(this.origin.z-k)/this.direction.z;return s>0?null:new i.Pk(this.origin.x+this.direction.x*-s,this.origin.y+this.direction.y*-s,k)}default:return null}}intersectsMesh(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=i.TmpVectors.Matrix[0];return s.getWorldMatrix().invertToRef(K),this._tmpRay?r.TransformToRef(this,K,this._tmpRay):this._tmpRay=r.Transform(this,K),s.intersects(this._tmpRay,k,h,A,g,ms)}intersectsMeshes(s,k,h){h?h.length=0:h=[];for(let A=0;A<s.length;A++){const g=this.intersectsMesh(s[A],k);g.hit&&h.push(g)}return h.sort(this._comparePickingInfo),h}_comparePickingInfo(s,k){return s.distance<k.distance?-1:s.distance>k.distance?1:0}intersectionSegment(s,k,h){const A=this.origin,g=i.TmpVectors.Pk[0],ms=i.TmpVectors.Pk[1],K=i.TmpVectors.Pk[2],H=i.TmpVectors.Pk[3];k.subtractToRef(s,g),this.direction.scaleToRef(r._Rayl,K),A.addToRef(K,ms),s.subtractToRef(A,H);const O=i.Pk.Dot(g,g),c=i.Pk.Dot(g,K),S=i.Pk.Dot(K,K),a=i.Pk.Dot(g,H),d=i.Pk.Dot(K,H),E=O*S-c*c;let j,P,R=E,D=E;E<r._Smallnum?(j=0,R=1,P=d,D=S):(j=c*d-S*a,P=O*d-c*a,j<0?(j=0,P=d,D=S):j>R&&(j=R,P=d+c,D=S)),P<0?(P=0,-a<0?j=0:-a>O?j=R:(j=-a,R=O)):P>D&&(P=D,-a+c<0?j=0:-a+c>O?j=R:(j=-a+c,R=O));const w=Math.abs(j)<r._Smallnum?0:j/R,B=Math.abs(P)<r._Smallnum?0:P/D,u=i.TmpVectors.Pk[4];K.scaleToRef(B,u);const G=i.TmpVectors.Pk[5];g.scaleToRef(w,G),G.addInPlace(H);const Q=i.TmpVectors.Pk[6];G.subtractToRef(u,Q);return B>0&&B<=this.length&&Q.lengthSquared()<h*h?G.length():-1}update(s,k,h,A,g,ms,K){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){r._RayDistant||(r._RayDistant=r.Zero()),r._RayDistant.unprojectRayToRef(s,k,h,A,i.Matrix.IdentityReadOnly,ms,K);const H=i.TmpVectors.Matrix[0];g.invertToRef(H),r.TransformToRef(r._RayDistant,H,this)}else this.unprojectRayToRef(s,k,h,A,g,ms,K);return this}static Zero(){return new r(i.Pk.Zero(),i.Pk.Zero())}static CreateNew(s,k,h,A,g,ms,i){return r.Zero().update(s,k,h,A,g,ms,i)}static CreateNewFromTo(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Matrix.IdentityReadOnly;const A=new r(new i.Pk(0,0,0),new i.Pk(0,0,0));return r.CreateFromToToRef(s,k,A,h)}static CreateFromToToRef(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Matrix.IdentityReadOnly;h.origin.H(s);const g=k.subtractToRef(s,h.direction),ms=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);return h.length=ms,h.direction.normalize(),r.TransformToRef(h,A,h)}static Transform(s,k){const h=new r(new i.Pk(0,0,0),new i.Pk(0,0,0));return r.TransformToRef(s,k,h),h}static TransformToRef(s,k,h){i.Pk.TransformCoordinatesToRef(s.origin,k,h.origin),i.Pk.TransformNormalToRef(s.direction,k,h.direction),h.length=s.length,h.epsilon=s.epsilon;const A=h.direction,g=A.length();if(0!==g&&1!==g){const s=1/g;A.x*=s,A.y*=s,A.z*=s,h.length*=g}return h}unprojectRayToRef(s,k,h,A,g,ms,K){const H=i.TmpVectors.Matrix[0];g.multiplyToRef(ms,H),H.multiplyToRef(K,H),H.invert();const O=c.b.LastCreatedEngine,S=i.TmpVectors.Pk[0];S.x=s/h*2-1,S.y=-(k/A*2-1),S.z=null!==O&&void 0!==O&&O.rh?1:null!==O&&void 0!==O&&O.isNDCHalfZRange?0:-1;const a=i.TmpVectors.Pk[1].cg(S.x,S.y,1-1e-8),r=i.TmpVectors.Pk[2],d=i.TmpVectors.Pk[3];i.Pk._UnprojectFromInvertedMatrixToRef(S,H,r),i.Pk._UnprojectFromInvertedMatrixToRef(a,H,d),this.origin.H(r),d.subtractToRef(r,this.direction),this.direction.normalize()}}function d(s,k,h,A,g){let ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=r.Zero();return E(s,k,h,A,i,g,ms),i}function E(s,k,h,A,g,ms){let K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const O=s.getEngine();if(!ms&&!(ms=s.activeCamera))return s;const c=ms.viewport,S=O.getRenderHeight(),{x:a,y:r,width:d,height:E}=c.toGlobal(O.getRenderWidth(),S),j=1/O.getHardwareScalingLevel();return k=k*j-a,h=h*j-(S-r-E),g.update(k,h,d,E,A||i.Matrix.IdentityReadOnly,K?i.Matrix.IdentityReadOnly:ms.getViewMatrix(),ms.getProjectionMatrix(),H),s}function j(s,k,h,A,g){if(!O.b)return s;const ms=s.getEngine();if(!g&&!(g=s.activeCamera))throw new Error("Active camera not set");const K=g.viewport,H=ms.getRenderHeight(),{x:c,y:S,width:a,height:r}=K.toGlobal(ms.getRenderWidth(),H),d=i.Matrix.Identity(),E=1/ms.getHardwareScalingLevel();return k=k*E-c,h=h*E-(H-S-r),A.update(k,h,a,r,d,d,g.getProjectionMatrix()),s}function P(s,k,h,A,g,ms,i,K){const H=k(A,h.enableDistantPicking),O=h.intersects(H,g,i,ms,A,K);return O&&O.hit?!g&&null!=s&&O.distance>=s.distance?null:O:null}function R(s,k,h,A,g,ms){let K=null;const H=!!(s.activeCameras&&s.activeCameras.length>1&&s.cameraToUseForPointers!==s.activeCamera),c=s.cameraToUseForPointers||s.activeCamera,S=a.internalPickerForMesh||P;for(let O=0;O<s.meshes.length;O++){const a=s.meshes[O];if(h){if(!h(a,-1))continue}else if(!a.isEnabled()||!a.isVisible||!a.oH)continue;const r=H&&a.isWorldMatrixCameraDependent(),d=a.fh(r,c);if(a.hasThinInstances&&a.tO){const s=S(K,k,a,d,!0,!0,ms);if(s){if(g)return s;const H=i.TmpVectors.Matrix[1],O=a.thinInstanceGetWorldMatrices();for(let s=0;s<O.length;s++){if(h&&!h(a,s))continue;O[s].multiplyToRef(d,H);const i=S(K,k,a,H,A,g,ms,!0);if(i&&(K=i,K.thinInstanceIndex=s,A))return K}}}else{const s=S(K,k,a,d,A,g,ms);if(s&&(K=s,A))return K}}return K||new O.b}function D(s,k,h,A){if(!O.b)return null;const g=[],ms=!!(s.activeCameras&&s.activeCameras.length>1&&s.cameraToUseForPointers!==s.activeCamera),K=s.cameraToUseForPointers||s.activeCamera,H=a.internalPickerForMesh||P;for(let O=0;O<s.meshes.length;O++){const c=s.meshes[O];if(h){if(!h(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.oH)continue;const S=ms&&c.isWorldMatrixCameraDependent(),a=c.fh(S,K);if(c.hasThinInstances&&c.tO){if(H(null,k,c,a,!0,!0,A)){const s=i.TmpVectors.Matrix[1],ms=c.thinInstanceGetWorldMatrices();for(let i=0;i<ms.length;i++){if(h&&!h(c,i))continue;ms[i].multiplyToRef(a,s);const K=H(null,k,c,s,!1,!1,A,!0);K&&(K.thinInstanceIndex=i,g.push(K))}}}else{const s=H(null,k,c,a,!1,!1,A);s&&g.push(s)}}return g}function w(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,A=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;A||(A=s.getWorldMatrix()),k.length=h,g?k.origin.H(g):k.origin.H(s.position);const ms=i.TmpVectors.Pk[2];ms.set(0,0,s._scene.useRightHandedSystem?-1:1);const K=i.TmpVectors.Pk[3];return i.Pk.TransformNormalToRef(ms,A,K),i.Pk.NormalizeToRef(K,k.direction),k}var B,u;r._TmpVector3=(0,K.e)(6,i.Pk.Zero),r._RayDistant=r.Zero(),r._Smallnum=1e-8,r._Rayl=1e9,B=A.d,(u=g.d)&&(u.prototype.getForwardRay=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,k=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return w(this,new r(i.Pk.Zero(),i.Pk.Zero(),s),s,k,h)},u.prototype.getForwardRayToRef=function(s){return w(this,s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),B&&(S.e._IsPickingAvailable=!0,B.prototype.createPickingRay=function(s,k,h,A){return d(this,s,k,h,A,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),A.d.prototype.createPickingRayToRef=function(s,k,h,A,g){return E(this,s,k,h,A,g,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},A.d.prototype.createPickingRayInCameraSpace=function(s,k,h){return function(s,k,h,A){const g=r.Zero();return j(s,k,h,g,A),g}(this,s,k,h)},A.d.prototype.createPickingRayInCameraSpaceToRef=function(s,k,h,A){return j(this,s,k,h,A)},A.d.prototype.pickWithBoundingInfo=function(s,k,h,A,g){return function(s,k,h,A,g,ms){if(!O.b)return null;const K=R(s,(A=>(s._tempPickingRay||(s._tempPickingRay=r.Zero()),E(s,k,h,A,s._tempPickingRay,ms||null),s._tempPickingRay)),A,g,!0);return K&&(K.ray=d(s,k,h,i.Matrix.Identity(),ms||null)),K}(this,s,k,h,A,g)},A.d.prototype.Ih=function(s,k,h,A,g,ms){return function(s,k,h,A,g,ms,K){const H=R(s,((A,g)=>(s._tempPickingRay||(s._tempPickingRay=r.Zero()),E(s,k,h,A,s._tempPickingRay,ms||null,!1,g),s._tempPickingRay)),A,g,!1,K);return H&&(H.ray=d(s,k,h,i.Matrix.Identity(),ms||null)),H}(this,s,k,h,A,g,ms)},A.d.prototype.pickWithRay=function(s,k,h,A){return function(s,k,h,A,g){const ms=R(s,(h=>(s._pickWithRayInverseMatrix||(s._pickWithRayInverseMatrix=i.Matrix.Identity()),h.invertToRef(s._pickWithRayInverseMatrix),s._cachedRayForTransform||(s._cachedRayForTransform=r.Zero()),r.TransformToRef(k,s._pickWithRayInverseMatrix,s._cachedRayForTransform),s._cachedRayForTransform)),h,A,!1,g);return ms&&(ms.ray=k),ms}(this,s,k,h,A)},A.d.prototype.multiPick=function(s,k,h,A,g){return function(s,k,h,A,g,ms){return D(s,(A=>d(s,k,h,A,g||null)),A,ms)}(this,s,k,h,A,g)},A.d.prototype.multiPickWithRay=function(s,k,h){return function(s,k,h,A){return D(s,(h=>(s._pickWithRayInverseMatrix||(s._pickWithRayInverseMatrix=i.Matrix.Identity()),h.invertToRef(s._pickWithRayInverseMatrix),s._cachedRayForTransform||(s._cachedRayForTransform=r.Zero()),r.TransformToRef(k,s._pickWithRayInverseMatrix,s._cachedRayForTransform),s._cachedRayForTransform)),h,A)}(this,s,k,h)}},14275:(s,k,h)=>{"use strict";var A=h(12515),g=h(12422),ms=h(12448),i=h(12552),K=h(12481),H=h(12527);K.e.prototype._partialLoadFile=function(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(s,(s=>{h[k]=s,h._internalCount++,6===h._internalCount&&A(h)}),void 0,void 0,!0,((s,k)=>{g&&s&&g(s.status+" "+s.statusText,k)}))},K.e.prototype._cascadeLoadFiles=function(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const g=[];g._internalCount=0;for(let ms=0;ms<6;ms++)this._partialLoadFile(h[ms],ms,g,k,A)},K.e.prototype._cascadeLoadImgs=function(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,ms=arguments.length>5?arguments[5]:void 0;const i=[];i._internalCount=0;for(let K=0;K<6;K++)this._partialLoadImg(A[K],K,i,s,k,h,g,ms)},K.e.prototype._partialLoadImg=function(s,k,h,A,g,K){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0;const c=(0,i.d)();(0,ms.k)(s,(s=>{h[k]=s,h._internalCount++,A&&A.removePendingData(c),6===h._internalCount&&K&&K(g,h)}),((s,k)=>{A&&A.removePendingData(c),H&&H(s,k)}),A?A.offlineProvider:null,O),A&&A.addPendingData(c)},K.e.prototype.createCubeTextureBase=function(s,k,h,ms){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,j=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,P=arguments.length>14&&void 0!==arguments[14]&&arguments[14],R=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const D=d||new A.c(this,7);D.isCube=!0,D.url=s,D.generateMipMaps=!ms,D._lodGenerationScale=a,D._lodGenerationOffset=r,D._useSRGBBuffer=!!P&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!ms),D!==d&&(D.label=s.substring(0,60)),this._doNotHandleContextLost||(D._extension=c,D._files=h,D._buffer=R);const w=s;this._transformTextureUrl&&!d&&(s=this._transformTextureUrl(s));const B=c??function(s){const k=s.split("?")[0],h=k.lastIndexOf(".");return h>-1?k.substring(h).toLowerCase():""}(s),u=(0,H.c)(B),G=(s,k)=>{D.dispose(),K?K(s,k):s&&g.c.Warn(s)},Q=(A,K)=>{s===w?A&&G(A.status+" "+A.statusText,K):(g.c.Warn(`Failed to load ${s}, falling back to the ${w}`),this.createCubeTextureBase(w,k,h,!!ms,i,G,O,c,S,a,r,D,E,j,P,R))};if(u)u.then((A=>{const g=s=>{E&&E(D,s),A.loadCubeData(s,D,S,i,((s,k)=>{G(s,k)}))};R?g(R):h&&6===h.length?A.supportCascades?this._cascadeLoadFiles(k,(s=>g(s.map((s=>new Uint8Array(s))))),h,G):G("Textures type does not support cascades."):this._loadFile(s,(s=>g(new Uint8Array(s))),void 0,void 0,!0,Q)}));else{if(!h||0===h.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(k,D,((s,k)=>{j&&j(s,k)}),h,G)}return this._internalTexturesCache.push(D),D}},14837:(s,k,h)=>{"use strict";h(12422);var A=h(12722);h(12515),h(12673),h(12508),h(12777),h(12735);A.b},14313:(s,k,h)=>{"use strict";h.d(k,{c:()=>g});var A=h(12543);class g{constructor(s){this.value=this._toInt(s)}_toInt(s){return 0|s}add(s){return new g(this.value+s.value)}Rk(s){return new g(this.value-s.value)}multiply(s){return new g(Math.imul(this.value,s.value))}divide(s){return new g(this.value/s.value)}getClassName(){return g.ClassName}equals(s){return this.value===s.value}static FromValue(s){return new g(s)}toString(){return this.value.toString()}}g.ClassName="FlowGraphInteger",(0,A.f)("FlowGraphInteger",g)},14317:(s,k,h)=>{"use strict";h.d(k,{c:()=>g,d:()=>ms});var A=h(12590);class g{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Gh=s}get m(){return this.Gh}transformVector(s){return this.transformVectorToRef(s,new A.Vector2)}transformVectorToRef(s,k){return k.x=s.x*this.Gh[0]+s.y*this.Gh[1],k.y=s.x*this.Gh[2]+s.y*this.Gh[3],k}yh(){return this.toArray()}toArray(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let k=0;k<4;k++)s[k]=this.Gh[k];return s}Nh(s){for(let k=0;k<4;k++)this.Gh[k]=s[k];return this}multiplyToRef(s,k){const h=s.Gh,A=this.Gh,g=k.Gh;return g[0]=h[0]*A[0]+h[1]*A[2],g[1]=h[0]*A[1]+h[1]*A[3],g[2]=h[2]*A[0]+h[3]*A[2],g[3]=h[2]*A[1]+h[3]*A[3],k}multiply(s){return this.multiplyToRef(s,new g)}divideToRef(s,k){const h=this.Gh,A=s.Gh,g=k.Gh;return g[0]=h[0]/A[0],g[1]=h[1]/A[1],g[2]=h[2]/A[2],g[3]=h[3]/A[3],k}divide(s){return this.divideToRef(s,new g)}addToRef(s,k){const h=this.Gh,A=s.m,g=k.m;return g[0]=h[0]+A[0],g[1]=h[1]+A[1],g[2]=h[2]+A[2],g[3]=h[3]+A[3],k}add(s){return this.addToRef(s,new g)}subtractToRef(s,k){const h=this.Gh,A=s.m,g=k.m;return g[0]=h[0]-A[0],g[1]=h[1]-A[1],g[2]=h[2]-A[2],g[3]=h[3]-A[3],k}Rk(s){return this.subtractToRef(s,new g)}transpose(){const s=this.Gh;return new g([s[0],s[2],s[1],s[3]])}determinant(){const s=this.Gh;return s[0]*s[3]-s[1]*s[2]}inverse(){const s=this.determinant();if(0===s)throw new Error("Matrix is not invertible");const k=this.Gh,h=1/s;return new g([k[3]*h,-k[1]*h,-k[2]*h,k[0]*h])}equals(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.Gh,A=s.m;return 0===k?h[0]===A[0]&&h[1]===A[1]&&h[2]===A[2]&&h[3]===A[3]:Math.abs(h[0]-A[0])<k&&Math.abs(h[1]-A[1])<k&&Math.abs(h[2]-A[2])<k&&Math.abs(h[3]-A[3])<k}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Gh.join(", ")})`}}class ms{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Gh=s}get m(){return this.Gh}transformVector(s){return this.transformVectorToRef(s,new A.Pk)}transformVectorToRef(s,k){const h=this.Gh;return k.x=s.x*h[0]+s.y*h[1]+s.z*h[2],k.y=s.x*h[3]+s.y*h[4]+s.z*h[5],k.z=s.x*h[6]+s.y*h[7]+s.z*h[8],k}multiplyToRef(s,k){const h=s.Gh,A=this.Gh,g=k.m;return g[0]=h[0]*A[0]+h[1]*A[3]+h[2]*A[6],g[1]=h[0]*A[1]+h[1]*A[4]+h[2]*A[7],g[2]=h[0]*A[2]+h[1]*A[5]+h[2]*A[8],g[3]=h[3]*A[0]+h[4]*A[3]+h[5]*A[6],g[4]=h[3]*A[1]+h[4]*A[4]+h[5]*A[7],g[5]=h[3]*A[2]+h[4]*A[5]+h[5]*A[8],g[6]=h[6]*A[0]+h[7]*A[3]+h[8]*A[6],g[7]=h[6]*A[1]+h[7]*A[4]+h[8]*A[7],g[8]=h[6]*A[2]+h[7]*A[5]+h[8]*A[8],k}multiply(s){return this.multiplyToRef(s,new ms)}divideToRef(s,k){const h=this.Gh,A=s.m,g=k.m;return g[0]=h[0]/A[0],g[1]=h[1]/A[1],g[2]=h[2]/A[2],g[3]=h[3]/A[3],g[4]=h[4]/A[4],g[5]=h[5]/A[5],g[6]=h[6]/A[6],g[7]=h[7]/A[7],g[8]=h[8]/A[8],k}divide(s){return this.divideToRef(s,new ms)}addToRef(s,k){const h=this.Gh,A=s.m,g=k.m;return g[0]=h[0]+A[0],g[1]=h[1]+A[1],g[2]=h[2]+A[2],g[3]=h[3]+A[3],g[4]=h[4]+A[4],g[5]=h[5]+A[5],g[6]=h[6]+A[6],g[7]=h[7]+A[7],g[8]=h[8]+A[8],k}add(s){return this.addToRef(s,new ms)}subtractToRef(s,k){const h=this.Gh,A=s.m,g=k.m;return g[0]=h[0]-A[0],g[1]=h[1]-A[1],g[2]=h[2]-A[2],g[3]=h[3]-A[3],g[4]=h[4]-A[4],g[5]=h[5]-A[5],g[6]=h[6]-A[6],g[7]=h[7]-A[7],g[8]=h[8]-A[8],k}Rk(s){return this.subtractToRef(s,new ms)}toArray(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let k=0;k<9;k++)s[k]=this.Gh[k];return s}yh(){return this.toArray()}Nh(s){for(let k=0;k<9;k++)this.Gh[k]=s[k];return this}transpose(){const s=this.Gh;return new ms([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]])}determinant(){const s=this.Gh;return s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6])}inverse(){const s=this.determinant();if(0===s)throw new Error("Matrix is not invertible");const k=this.Gh,h=1/s;return new ms([(k[4]*k[8]-k[5]*k[7])*h,(k[2]*k[7]-k[1]*k[8])*h,(k[1]*k[5]-k[2]*k[4])*h,(k[5]*k[6]-k[3]*k[8])*h,(k[0]*k[8]-k[2]*k[6])*h,(k[2]*k[3]-k[0]*k[5])*h,(k[3]*k[7]-k[4]*k[6])*h,(k[1]*k[6]-k[0]*k[7])*h,(k[0]*k[4]-k[1]*k[3])*h])}equals(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.Gh,A=s.m;return 0===k?h[0]===A[0]&&h[1]===A[1]&&h[2]===A[2]&&h[3]===A[3]&&h[4]===A[4]&&h[5]===A[5]&&h[6]===A[6]&&h[7]===A[7]&&h[8]===A[8]:Math.abs(h[0]-A[0])<k&&Math.abs(h[1]-A[1])<k&&Math.abs(h[2]-A[2])<k&&Math.abs(h[3]-A[3])<k&&Math.abs(h[4]-A[4])<k&&Math.abs(h[5]-A[5])<k&&Math.abs(h[6]-A[6])<k&&Math.abs(h[7]-A[7])<k&&Math.abs(h[8]-A[8])<k}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Gh.join(", ")})`}}},14319:(s,k,h)=>{"use strict";var A;function g(s,k,h,A){switch(k){case"Animation":return A?s.animations.find((s=>s.uniqueId===h))??null:s.animations[h]??null;case"AnimationGroup":return A?s.animationGroups.find((s=>s.uniqueId===h))??null:s.animationGroups[h]??null;case"Mesh":return A?s.meshes.find((s=>s.uniqueId===h))??null:s.meshes[h]??null;case"Material":return A?s.materials.find((s=>s.uniqueId===h))??null:s.materials[h]??null;case"aS":return A?s.cameras.find((s=>s.uniqueId===h))??null:s.cameras[h]??null;case"Light":return A?s.lights.find((s=>s.uniqueId===h))??null:s.lights[h]??null;default:return null}}h.d(k,{d:()=>g}),function(s){s.Animation="Animation",s.AnimationGroup="AnimationGroup",s.Mesh="Mesh",s.Material="Material",s.aS="aS",s.Light="Light"}(A||(A={}))},14344:(s,k,h)=>{"use strict";h.d(k,{b:()=>g});var A=h(14351);class g extends A.d{constructor(s,k){if(super(s),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),k)for(const h of k)this._eventsSignalOutputs[h]=this._registerSignalOutput(h+"Event")}_executeOnTick(s){}_startPendingTasks(s){s._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(s),this._resetAfterCanceled(s)),this._preparePendingTasks(s),s._addPendingBlock(this),this.out._activateSignal(s),s._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(s){s._deleteExecutionVariable(this,"_initialized"),s._removePendingBlock(this)}}},14325:(s,k,h)=>{"use strict";h.d(k,{e:()=>O});var A=h(12552),g=h(12543),ms=h(14332),i=h(12408),K=h(14307);class H extends ms.b{constructor(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.defaultValue,ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(s,k,h),this.richType=A,this._defaultValue=g,this._optional=ms,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new i.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(s){this._isDisabled!==s&&(this._isDisabled=s,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(s,k){k._getConnectionValue(this)!==s&&(k._setConnectionValue(this,s),this.onValueChangedObservable.notifyObservers(s))}resetToDefaultValue(s){s._setConnectionValue(this,this._defaultValue)}connectTo(s){this._isDisabled||super.connectTo(s)}_getValueOrDefault(s){const k=s._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(k):k}getValue(s){if(1===this.connectionType){s._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(s);const k=this._getValueOrDefault(s);return this._lastValue=k,this.richType.typeTransformer?this.richType.typeTransformer(k):k}const k=this.isConnected()?this._connectedPoint[0].getValue(s):this._getValueOrDefault(s);return this._lastValue=k,this.richType.typeTransformer?this.richType.typeTransformer(k):k}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(s),s.richType={},this.richType.serialize(s.richType),s.optional=this._optional,(0,K.f)("defaultValue",this._defaultValue,s)}}(0,g.f)("FlowGraphDataConnection",H);class O{constructor(s){var k;this.config=s,this.uniqueId=(0,A.d)(),this.name=(null===(k=this.config)||void 0===k?void 0:k.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(s){}registerDataInput(s,k,h){const A=new H(s,0,this,k,h);return this.dataInputs.push(A),A}registerDataOutput(s,k,h){const A=new H(s,1,this,k,h);return this.dataOutputs.push(A),A}getDataInput(s){return this.dataInputs.find((k=>k.name===s))}getDataOutput(s){return this.dataOutputs.find((k=>k.name===s))}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.f;if(s.uniqueId=this.uniqueId,s.config={},this.config){const h=this.config,A=Object.keys(h);for(const g of A)k(g,h[g],s.config)}s.dataInputs=[],s.dataOutputs=[],s.className=this.getClassName();for(const h of this.dataInputs){const k={};h.serialize(k),s.dataInputs.push(k)}for(const h of this.dataOutputs){const k={};h.serialize(k),s.dataOutputs.push(k)}}deserialize(s){}_log(s,k,h){var A;null===(A=s.logger)||void 0===A||A.addLogItem({action:k,zh:h,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14332:(s,k,h)=>{"use strict";h.d(k,{b:()=>ms});var A,g=h(12552);!function(s){s[s.Input=0]="Input",s[s.Output=1]="Output"}(A||(A={}));class ms{constructor(s,k,h){this._ownerBlock=h,this._connectedPoint=[],this.uniqueId=(0,g.d)(),this.connectedPointIds=[],this.name=s,this._connectionType=k}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(s){if(this._connectionType===s._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||s._isSingularConnection()&&s._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(s),s._connectedPoint.push(this)}disconnectFrom(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this._connectedPoint.indexOf(s),A=s._connectedPoint.indexOf(this);-1!==h&&-1!==A&&(k&&this._connectedPoint.splice(h,1),s._connectedPoint.splice(A,1))}disconnectFromAll(){for(const s of this._connectedPoint)this.disconnectFrom(s,!1);this._connectedPoint.length=0}dispose(){for(const s of this._connectedPoint)this.disconnectFrom(s)}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.uniqueId=this.uniqueId,s.name=this.name,s._connectionType=this._connectionType,s.connectedPointIds=[],s.className=this.getClassName();for(const k of this._connectedPoint)s.connectedPointIds.push(k.uniqueId)}getClassName(){return"FGConnection"}deserialize(s){this.uniqueId=s.uniqueId,this.name=s.name,this._connectionType=s._connectionType,this.connectedPointIds=s.connectedPointIds}}},14298:(s,k,h)=>{"use strict";h.d(k,{e:()=>D});var A,g=h(12408),ms=h(12570),i=h(12579),K=h(12552),H=h(14307),O=h(14319),c=h(12422);!function(s){s.ExecuteBlock="ExecuteBlock",s.ExecuteEvent="ExecuteEvent",s.TriggerConnection="TriggerConnection",s.ContextVariableSet="ContextVariableSet",s.GlobalVariableSet="GlobalVariableSet",s.GlobalVariableDelete="GlobalVariableDelete",s.GlobalVariableGet="GlobalVariableGet",s.AddConnection="AddConnection",s.GetConnectionValue="GetConnectionValue",s.SetConnectionValue="SetConnectionValue",s.ActivateSignal="ActivateSignal",s.ContextVariableGet="ContextVariableGet"}(A||(A={}));class S{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(s){if(s.time||(s.time=Date.now()),this.log.push(s),this.logToConsole){var k;const h=null===(k=s.zh)||void 0===k?void 0:k.value;"object"===typeof h&&h.getClassName?c.c.Log(`[FGLog] ${s.className}:${s.uniqueId.split("-")[0]} ${s.action} - ${JSON.stringify(h.getClassName())}: ${h.toString()}`):c.c.Log(`[FGLog] ${s.className}:${s.uniqueId.split("-")[0]} ${s.action} - ${JSON.stringify(s.zh)}`)}}getItemsOfType(s){return this.log.filter((k=>k.action===s))}}class a{get enableLogging(){return this._enableLogging}set enableLogging(s){this._enableLogging!==s&&(this._enableLogging=s,this._enableLogging?(this.logger=new S,this.logger.logToConsole=!0):this.logger=null)}constructor(s){this.uniqueId=(0,K.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new g.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=s,this.assetsContext=s.assetsContext??s.Dk}hasVariable(s){return s in this._userVariables}setVariable(s,k){var h;this._userVariables[s]=k,null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",zh:{name:s,value:k}})}getAsset(s,k){return(0,O.d)(this.assetsContext,s,k)}getVariable(s){var k;return null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",zh:{name:s,value:this._userVariables[s]}}),this._userVariables[s]}get userVariables(){return this._userVariables}Is(){return this._configuration.Dk}_getUniqueIdPrefixedName(s,k){return`${s.uniqueId}_${k}`}_getGlobalContextVariable(s,k){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",zh:{name:s,defaultValue:k,possibleValue:this._globalContextVariables[s]}}),this._hasGlobalContextVariable(s)?this._globalContextVariables[s]:k}_setGlobalContextVariable(s,k){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",zh:{name:s,value:k}}),this._globalContextVariables[s]=k}_deleteGlobalContextVariable(s){var k;null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",zh:{name:s}}),delete this._globalContextVariables[s]}_hasGlobalContextVariable(s){return s in this._globalContextVariables}_setExecutionVariable(s,k,h){this._executionVariables[this._getUniqueIdPrefixedName(s,k)]=h}_getExecutionVariable(s,k,h){return this._hasExecutionVariable(s,k)?this._executionVariables[this._getUniqueIdPrefixedName(s,k)]:h}_deleteExecutionVariable(s,k){delete this._executionVariables[this._getUniqueIdPrefixedName(s,k)]}_hasExecutionVariable(s,k){return this._getUniqueIdPrefixedName(s,k)in this._executionVariables}_hasConnectionValue(s){return s.uniqueId in this._connectionValues}_setConnectionValue(s,k){var h;this._connectionValues[s.uniqueId]=k,null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",zh:{connectionPointId:s.uniqueId,value:k}})}_setConnectionValueByKey(s,k){this._connectionValues[s]=k}_getConnectionValue(s){var k;return null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",zh:{connectionPointId:s.uniqueId,value:this._connectionValues[s.uniqueId]}}),this._connectionValues[s.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(s){this._pendingBlocks.includes(s)||(this._pendingBlocks.push(s),this._pendingBlocks.sort(((s,k)=>s.priority-k.priority)))}_removePendingBlock(s){const k=this._pendingBlocks.indexOf(s);-1!==k&&this._pendingBlocks.splice(k,1)}_clearPendingBlocks(){for(const s of this._pendingBlocks)s._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(s){var k;this.onNodeExecutedObservable.notifyObservers(s),null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:s.getClassName(),uniqueId:s.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(s){this._setGlobalContextVariable("timeSinceStart",s.timeSinceStart),this._setGlobalContextVariable("deltaTime",s.deltaTime);for(const h of this._pendingBlocks){var k;null===(k=h._executeOnTick)||void 0===k||k.call(h,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.f;s.uniqueId=this.uniqueId,s._userVariables={};for(const A in this._userVariables)k(A,this._userVariables[A],s._userVariables);s._connectionValues={};for(const A in this._connectionValues)k(A,this._connectionValues[A],s._connectionValues);var h;this.assetsContext!==this.Is()&&(s._assetsContext={meshes:this.assetsContext.meshes.map((s=>s.id)),materials:this.assetsContext.materials.map((s=>s.id)),textures:this.assetsContext.textures.map((s=>s.name)),animations:this.assetsContext.animations.map((s=>s.name)),lights:this.assetsContext.lights.map((s=>s.id)),cameras:this.assetsContext.cameras.map((s=>s.id)),zr:null===(h=this.assetsContext.zr)||void 0===h?void 0:h.map((s=>s.name)),skeletons:this.assetsContext.skeletons.map((s=>s.id)),la:this.assetsContext.la.map((s=>s.name)),geometries:this.assetsContext.geometries.map((s=>s.id)),multiMaterials:this.assetsContext.multiMaterials.map((s=>s.id)),transformNodes:this.assetsContext.transformNodes.map((s=>s.id))})}getClassName(){return"FlowGraphContext"}}(0,ms.e)([(0,i.J)()],a.prototype,"uniqueId",void 0);var r=h(14322),d=h(12871);class E{constructor(s){this.onEventTriggeredObservable=new g.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=s,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Dh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const s=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",zh:{timeSinceStart:this._startingTime,deltaTime:s}}),this._startingTime+=s})),this._meshPickedObserver=this._scene.onPointerObservable.add((s=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",zh:s})}),d.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((s=>{const k=s.pointerId,h=s.mesh,A=this._pointerUnderMeshState[k];!A&&h?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",zh:{pointerId:k,mesh:h}}):A&&!h?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",zh:{pointerId:k,mesh:A}}):A&&h&&A!==h&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",zh:{pointerId:k,mesh:A,over:h}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",zh:{pointerId:k,mesh:h,out:A}})),this._pointerUnderMeshState[k]=h}),d.c.POINTERMOVE)}dispose(){var s,k,h,A,g;null===(s=this._sceneDisposeObserver)||void 0===s||s.remove(),null===(k=this._sceneReadyObserver)||void 0===k||k.remove(),null===(h=this._sceneOnBeforeRenderObserver)||void 0===h||h.remove(),null===(A=this._meshPickedObserver)||void 0===A||A.remove(),null===(g=this._meshUnderPointerObserver)||void 0===g||g.remove(),this.onEventTriggeredObservable.clear()}}var j,P=h(14338);!function(s){s[s.Stopped=0]="Stopped",s[s.Started=1]="Started"}(j||(j={}));class R{get state(){return this._state}set state(s){this._state=s,this.onStateChangedObservable.notifyObservers(s)}constructor(s){this.onStateChangedObservable=new g.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=s.Dk,this._sceneEventCoordinator=new E(this._scene),this._coordinator=s.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((s=>{for(const k of this._executionContexts){const h=this._getContextualOrder(s.type,k);for(const A of h)if(!A._executeEvent(k,s.zh))break}switch(s.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const k of this._executionContexts)k._notifyOnTick(s.zh);break;case"SceneDispose":this.dispose()}}))}createContext(){const s=new a({Dk:this._scene,coordinator:this._coordinator});return this._executionContexts.push(s),s}getContext(s){return this._executionContexts[s]}addEventBlock(s){if("PointerOver"!==s.type&&"PointerOut"!==s.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==s.type&&this._eventBlocks[s.type].push(s),1===this.state)for(const k of this._executionContexts)s._startPendingTasks(k);else this.onStateChangedObservable.addOnce((k=>{if(1===k)for(const h of this._executionContexts)s._startPendingTasks(h)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((s=>{1===s&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const s of this._executionContexts)for(const k in this._eventBlocks){const h=this._getContextualOrder(k,s);for(const k of h)k._startPendingTasks(s)}}_getContextualOrder(s,k){const h=this._eventBlocks[s].sort(((s,k)=>k.initPriority-s.initPriority));if("MeshPick"===s){const s=[];for(const A of h){const g=A.asset.getValue(k);let ms=0;for(;ms<h.length;ms++){const s=h[ms].asset.getValue(k);if(g&&s&&(0,P.l)(g,s))break}s.splice(ms,0,A)}return s}return h}dispose(){var s;if(0!==this.state){this.state=0;for(const s of this._executionContexts)s._clearPendingBlocks();this._executionContexts.length=0;for(const s in this._eventBlocks)this._eventBlocks[s].length=0;null===(s=this._eventObserver)||void 0===s||s.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(s){const k=[],h=new Set;for(const A in this._eventBlocks)for(const s of this._eventBlocks[A])k.push(s),h.add(s.uniqueId);for(;k.length>0;){const A=k.pop();s(A);for(const s of A.dataInputs)for(const A of s._connectedPoint)h.has(A._ownerBlock.uniqueId)||(k.push(A._ownerBlock),h.add(A._ownerBlock.uniqueId));if(A instanceof r.b)for(const s of A.signalOutputs)for(const A of s._connectedPoint)h.has(A._ownerBlock.uniqueId)||(k.push(A._ownerBlock),h.add(A._ownerBlock.uniqueId))}}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=arguments.length>1?arguments[1]:void 0;s.allBlocks=[],this.visitAllBlocks((k=>{const h={};k.serialize(h),s.allBlocks.push(h)})),s.executionContexts=[];for(const h of this._executionContexts){const A={};h.serialize(A,k),s.executionContexts.push(A)}}}class D{constructor(s){this.config=s,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Dk.Dh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Dk.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const s=this._executeOnNextFrame.slice(0);if(s.length)for(const k of s){this.notifyCustomEvent(k.id,k.data,!1);const s=this._executeOnNextFrame.findIndex((s=>s.uniqueId===k.uniqueId));-1!==s&&this._executeOnNextFrame.splice(s,1)}}));(D.SceneCoordinators.get(this.config.Dk)??[]).push(this)}createGraph(){const s=new R({Dk:this.config.Dk,coordinator:this});return this._flowGraphs.push(s),s}removeGraph(s){const k=this._flowGraphs.indexOf(s);-1!==k&&(s.dispose(),this._flowGraphs.splice(k,1))}start(){for(const s of this._flowGraphs)s.start()}dispose(){var s,k;for(const g of this._flowGraphs)g.dispose();this._flowGraphs.length=0,null===(s=this._disposeObserver)||void 0===s||s.remove(),null===(k=this._onBeforeRenderObserver)||void 0===k||k.remove();const h=D.SceneCoordinators.get(this.config.Dk)??[],A=h.indexOf(this);-1!==A&&h.splice(A,1)}serialize(s,k){s._flowGraphs=[];for(const h of this._flowGraphs){const A={};h.serialize(A,k),s._flowGraphs.push(A)}s.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(s){let k=this._customEventsMap.get(s);return k||(k=new g.c,this._customEventsMap.set(s,k)),k}notifyCustomEvent(s,k){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:s,data:k,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(s)){const k=this._eventExecutionCounter.get(s);if(this._eventExecutionCounter.set(s,k+1),k>=D.MaxEventTypeExecutionPerFrame)return void(k===D.MaxEventTypeExecutionPerFrame&&c.c.Warn(`FlowGraphCoordinator: Too many executions of event "${s}".`))}else this._eventExecutionCounter.set(s,1);const h=this._customEventsMap.get(s);h&&h.notifyObservers(k)}}D.MaxEventsPerType=30,D.MaxEventTypeExecutionPerFrame=30,D.SceneCoordinators=new Map},14340:(s,k,h)=>{"use strict";h.d(k,{e:()=>g});var A=h(14344);class g extends A.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(s){s._notifyExecuteNode(this),this.done._activateSignal(s)}}},14322:(s,k,h)=>{"use strict";h.d(k,{b:()=>K});var A=h(14325),g=h(14332),ms=h(12543);class i extends g.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(s){super.connectTo(s),this._connectedPoint.sort(((s,k)=>k.priority-s.priority))}_activateSignal(s){var k;if(null===(k=s.logger)||void 0===k||k.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,zh:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)s._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(s,this),s._increaseExecutionId();else for(const h of this._connectedPoint)h._activateSignal(s)}}(0,ms.f)("FlowGraphSignalConnection",i);class K extends A.e{constructor(s){super(s),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(s){const k=new i(s,0,this);return this.signalInputs.push(k),k}_registerSignalOutput(s){const k=new i(s,1,this);return this.signalOutputs.push(k),k}_unregisterSignalInput(s){const k=this.signalInputs.findIndex((k=>k.name===s));-1!==k&&(this.signalInputs[k].dispose(),this.signalInputs.splice(k,1))}_unregisterSignalOutput(s){const k=this.signalOutputs.findIndex((k=>k.name===s));-1!==k&&(this.signalOutputs[k].dispose(),this.signalOutputs.splice(k,1))}_reportError(s,k){this.error.zh="string"===typeof k?new Error(k):k,this.error._activateSignal(s)}getSignalInput(s){return this.signalInputs.find((k=>k.name===s))}getSignalOutput(s){return this.signalOutputs.find((k=>k.name===s))}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(s),s.signalInputs=[],s.signalOutputs=[];for(const k of this.signalInputs){const h={};k.serialize(h),s.signalInputs.push(h)}for(const k of this.signalOutputs){const h={};k.serialize(h),s.signalOutputs.push(h)}}deserialize(s){for(let k=0;k<s.signalInputs.length;k++){const h=this.getSignalInput(s.signalInputs[k].name);if(!h)throw new Error("Could not find signal input with name "+s.signalInputs[k].name+" in block "+s.className);h.deserialize(s.signalInputs[k])}for(let k=0;k<s.signalOutputs.length;k++){const h=this.getSignalOutput(s.signalOutputs[k].name);if(!h)throw new Error("Could not find signal output with name "+s.signalOutputs[k].name+" in block "+s.className);h.deserialize(s.signalOutputs[k])}}getClassName(){return"FlowGraphExecutionBlock"}}},14351:(s,k,h)=>{"use strict";h.d(k,{d:()=>g});var A=h(14322);class g extends A.b{constructor(s){super(s),this.out=this._registerSignalOutput("out")}}},14315:(s,k,h)=>{"use strict";h.d(k,{B:()=>p,F:()=>I,G:()=>Q,K:()=>G,c:()=>O,d:()=>a,e:()=>u,f:()=>j,g:()=>P,j:()=>R,m:()=>S,q:()=>B,r:()=>c,t:()=>r,x:()=>d,z:()=>E});var A,g=h(12590),ms=h(12636),i=h(14313),K=h(14317);!function(s){s.Any="any",s.String="string",s.Number="number",s.Boolean="boolean",s.Object="object",s.Integer="FlowGraphInteger",s.Vector2="Vector2",s.Pk="Pk",s.Vector4="Vector4",s.Quaternion="Quaternion",s.Matrix="Matrix",s.Matrix2D="Matrix2D",s.Matrix3D="Matrix3D",s.Bk="Bk",s.jg="jg"}(A||(A={}));class H{constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=s,this.defaultValue=k,this.animationType=h}serialize(s){s.typeName=this.typeName,s.defaultValue=this.defaultValue}}const O=new H("any",void 0),c=new H("string",""),S=new H("number",0,0),a=new H("boolean",!1),r=new H("Vector2",g.Vector2.Zero(),5),d=new H("Pk",g.Pk.Zero(),1),E=new H("Vector4",g.Vector4.Zero()),j=new H("Matrix",g.Matrix.Identity(),3),P=new H("Matrix2D",new K.c),R=new H("Matrix3D",new K.d),D=new H("Bk",ms.Bk.Black(),4),w=new H("jg",new ms.jg(0,0,0,0),7),B=new H("Quaternion",g.Quaternion.Identity(),2);B.typeTransformer=s=>{if(s.getClassName){if("Vector4"===s.getClassName())return g.Quaternion.uk(s.yh());if("Pk"===s.getClassName())return g.Quaternion.FromEulerVector(s);if("Matrix"===s.getClassName())return g.Quaternion.FromRotationMatrix(s)}return s};const u=new H("FlowGraphInteger",new i.c(0),0);function G(s){const k=s;switch(typeof s){case"string":return c;case"number":return S;case"boolean":return a;case"object":if(k.getClassName)switch(k.getClassName()){case"Vector2":return r;case"Pk":return d;case"Vector4":return E;case"Matrix":return j;case"Bk":return D;case"jg":return w;case"Quaternion":return B;case"FlowGraphInteger":return u;case"Matrix2D":return P;case"Matrix3D":return R}return O;default:return O}}function Q(s){switch(s){case"string":return c;case"number":return S;case"boolean":return a;case"Vector2":return r;case"Pk":return d;case"Vector4":return E;case"Matrix":return j;case"Bk":return D;case"jg":return w;case"Quaternion":return B;case"FlowGraphInteger":return u;case"Matrix2D":return P;case"Matrix3D":return R;default:return O}}function p(s){switch(s){case"number":default:return 0;case"Vector2":return 5;case"Pk":return 1;case"Matrix":return 3;case"Bk":return 4;case"jg":return 7;case"Quaternion":return 2}}function I(s){switch(s){case 0:return S;case 5:return r;case 1:return d;case 3:return j;case 4:return D;case 7:return w;case 2:return B;default:return O}}},14307:(s,k,h)=>{"use strict";h.d(k,{b:()=>c,f:()=>O,g:()=>S});var A=h(12636),g=h(12590),ms=h(14313),i=h(14315),K=h(14317);function H(s){return"Vector2"===s||"Pk"===s||"Vector4"===s||"Quaternion"===s||"Bk"===s||"jg"===s}function O(s,k,h){var A;const g=(null===k||void 0===k||null===(A=k.getClassName)||void 0===A?void 0:A.call(k))??"";if(H(g)||function(s){return"Matrix"===s||"Matrix2D"===s||"Matrix3D"===s}(g))h[s]={value:k.yh(),className:g};else if("FlowGraphInteger"===g)h[s]={value:k.value,className:g};else if(g&&(k.id||k.name))h[s]={id:k.id,name:k.name,className:g};else{if("object"===typeof k)throw new Error(`Could not serialize value ${k}`);h[s]=k}}function c(s,k,h,O){const S=k[s];let a;const r=(null===S||void 0===S?void 0:S.type)??(null===S||void 0===S?void 0:S.className);if(function(s){return"Mesh"===s||"AbstractMesh"===s||"GroundMesh"===s||"InstanceMesh"===s||"LinesMesh"===s||"GoldbergMesh"===s||"GreasedLineMesh"===s||"TrailMesh"===s}(r)){let s=O.meshes.filter((s=>S.id?s.id===S.id:s.name===S.name));0===s.length&&(s=O.transformNodes.filter((s=>S.id?s.id===S.id:s.name===S.name))),a=S.uniqueId?s.find((s=>s.uniqueId===S.uniqueId)):s[0]}else if(H(r))a=function(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===s)return g.Vector2.uk(k);if("Pk"===s)return h&&(k[2]*=-1),g.Pk.uk(k);if("Vector4"===s)return g.Vector4.uk(k);if("Quaternion"===s)return h&&(k[2]*=-1,k[3]*=-1),g.Quaternion.uk(k);if("Bk"===s)return new A.Bk(k[0],k[1],k[2]);if("jg"===s)return new A.jg(k[0],k[1],k[2],k[3]);throw new Error(`Unknown vector class name ${s}`)}(r,S.value);else if(function(s){return"AnimationGroup"===s}(r)){const s=O.animationGroups.filter((s=>s.name===S.name));a=1===s.length?s[0]:s.find((s=>s.uniqueId===S.uniqueId))}else a="Matrix"===r?g.Matrix.uk(S.value):"Matrix2D"===r?new K.c(S.value):"Matrix3D"===r?new K.d(S.value):"FlowGraphInteger"===r?ms.c.FromValue(S.value):"number"===r||"string"===r||"boolean"===r?S.value[0]:S&&void 0!==S.value?S.value:Array.isArray(S)?S.reduce(((s,k)=>k.eventData?(s[k.id]={type:(0,i.G)(k.type)},"undefined"!==typeof k.value&&(s[k.id].value=c("value",k,h,O)),s):s),{}):S;return a}function S(s){return"FlowGraphJsonPointerParserBlock"===s}},14338:(s,k,h)=>{"use strict";function A(s,k){return!(!s.parent||s.parent!==k&&!A(s.parent,k))}function g(s){if(s.getClassName)return s.getClassName()}function ms(s,k){return s===k&&("Vector2"===s||"Pk"===s||"Vector4"===s||"Quaternion"===s)}function i(s,k){return s===k&&("Matrix"===s||"Matrix2D"===s||"Matrix3D"===s)}function K(s,k){return"FlowGraphInteger"===s&&"FlowGraphInteger"===k}function H(s,k){const h="number"===typeof s||"number"===typeof(null===s||void 0===s?void 0:s.value);return h&&!k?!isNaN(O(s)):h}function O(s){return"number"===typeof s?s:s.value}h.d(k,{e:()=>K,f:()=>i,i:()=>ms,k:()=>g,l:()=>A,p:()=>O,s:()=>H})},13715:(s,k,h)=>{"use strict";h.r(k),h.d(k,{SceneInstrumentation:()=>ms});var A=h(12402),g=h(12811);class ms{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(s){s!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=s,s?(this._onBeforeActiveMeshesEvaluationObserver=this.Dk.onBeforeActiveMeshesEvaluationObservable.add((()=>{A.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Dk.onAfterActiveMeshesEvaluationObservable.add((()=>{A.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Dk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Dk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(s){s!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=s,s?(this._onBeforeRenderTargetsRenderObserver=this.Dk.onBeforeRenderTargetsRenderObservable.add((()=>{A.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Dk.onAfterRenderTargetsRenderObservable.add((()=>{A.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Dk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Dk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(s){s!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=s,s?(this._onBeforeParticlesRenderingObserver=this.Dk.onBeforeParticlesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Dk.onAfterParticlesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Dk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Dk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(s){s!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=s,this.Dk.spriteManagers&&(s?(this._onBeforeSpritesRenderingObserver=this.Dk.onBeforeSpritesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Dk.onAfterSpritesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Dk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Dk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(s){s!==this._capturePhysicsTime&&this.Dk.onBeforePhysicsObservable&&(this._capturePhysicsTime=s,s?(this._onBeforePhysicsObserver=this.Dk.onBeforePhysicsObservable.add((()=>{A.Tools.StartPerformanceCounter("fg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Dk.onAfterPhysicsObservable.add((()=>{A.Tools.EndPerformanceCounter("fg"),this._physicsTime.endMonitoring()}))):(this.Dk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Dk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(s){s!==this._captureAnimationsTime&&(this._captureAnimationsTime=s,s?this._onAfterAnimationsObserver=this.Dk.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Dk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(s){this._captureFrameTime=s}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(s){this._captureInterFrameTime=s}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(s){s!==this._captureRenderTime&&(this._captureRenderTime=s,s?(this._onBeforeDrawPhaseObserver=this.Dk.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),A.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Dk.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter("Main render")}))):(this.Dk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Dk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(s){s!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=s,s?(this._onBeforeCameraRenderObserver=this.Dk.onBeforeCameraRenderObservable.add((s=>{this._cameraRenderTime.beginMonitoring(),A.Tools.StartPerformanceCounter(`Rendering camera ${s.name}`)})),this._onAfterCameraRenderObserver=this.Dk.onAfterCameraRenderObservable.add((s=>{this._cameraRenderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter(`Rendering camera ${s.name}`)}))):(this.Dk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Dk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Dk.getEngine()._drawCalls}constructor(s){this.Dk=s,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new g.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new g.c,this._captureFrameTime=!1,this._frameTime=new g.c,this._captureRenderTime=!1,this._renderTime=new g.c,this._captureInterFrameTime=!1,this._interFrameTime=new g.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new g.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new g.c,this._capturePhysicsTime=!1,this._physicsTime=new g.c,this._captureAnimationsTime=!1,this._animationsTime=new g.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new g.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=s.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(A.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Dk.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=s.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(A.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Rh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Rh(),this._captureParticlesRenderTime&&this._particlesRenderTime.Rh(),this._captureSpritesRenderTime&&this._spritesRenderTime.Rh(),this._captureRenderTime&&this._renderTime.Rh(),this._captureCameraRenderTime&&this._cameraRenderTime.Rh()}))}dispose(){this._disposed||(this.Dk.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Dk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Dk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Dk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Dk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Dk.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Dk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Dk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Dk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Dk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Dk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Dk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Dk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Dk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Dk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Dk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Dk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Dk=null,this._disposed=!0)}}},14291:(s,k,h)=>{"use strict";h.d(k,{c:()=>c});var A=h(12570),g=h(12579),ms=h(12590),i=h(13041),K=h(13147),H=h(13199),O=h(12543);i.e.AddNodeConstructor("Light_Type_1",((s,k)=>()=>new c(s,ms.Pk.Zero(),k)));class c extends H.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(s){this._shadowFrustumSize=s,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(s){this._shadowOrthoScale=s,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(s){this._orthoLeft=s}get orthoRight(){return this._orthoRight}set orthoRight(s){this._orthoRight=s}get orthoTop(){return this._orthoTop}set orthoTop(s){this._orthoTop=s}get orthoBottom(){return this._orthoBottom}set orthoBottom(s){this._orthoBottom=s}constructor(s,k,h){super(s,h),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=k.scale(-1),this.direction=k}getClassName(){return"mc"}getTypeID(){return K.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(s,k,h){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(s):this._setDefaultAutoExtendShadowProjectionMatrix(s,k,h)}_setDefaultFixedFrustumShadowProjectionMatrix(s){const k=this.Is().activeCamera;k&&ms.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:k.Jh,void 0!==this.shadowMaxZ?this.shadowMaxZ:k.maxZ,s,this.Is().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(s,k,h){const A=this.Is().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const s=ms.Pk.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let A=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let i=0;i<h.length;i++){const K=h[i];if(!K)continue;const H=K.getBoundingInfo().boundingBox;for(let h=0;h<H.vectorsWorld.length;h++)ms.Pk.TransformCoordinatesToRef(H.vectorsWorld[h],k,s),s.x<this._orthoLeft&&(this._orthoLeft=s.x),s.y<this._orthoBottom&&(this._orthoBottom=s.y),s.x>this._orthoRight&&(this._orthoRight=s.x),s.y>this._orthoTop&&(this._orthoTop=s.y),this.autoCalcShadowZBounds&&(s.z<A&&(A=s.z),s.z>g&&(g=s.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=A,this._shadowMaxZ=g)}const g=this._orthoRight-this._orthoLeft,i=this._orthoTop-this._orthoBottom,K=void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.Jh)||0,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)||1e4,O=this.Is().getEngine().rh;ms.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-g*this.shadowOrthoScale,this._orthoRight+g*this.shadowOrthoScale,this._orthoBottom-i*this.shadowOrthoScale,this._orthoTop+i*this.shadowOrthoScale,O?H:K,O?K:H,s,this.Is().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(s,k){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,k),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,k),this)}transferToNodeMaterialEffect(s,k){return this.computeTransformedInformation()?(s.setFloat3(k,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(s.setFloat3(k,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(s){const k=this._scene.getEngine();return!k.rh&&k.isNDCHalfZRange?0:1}getDepthMaxZ(s){const k=this._scene.getEngine();return k.rh&&k.isNDCHalfZRange?0:1}prepareLightSpecificDefines(s,k){s["DIRLIGHT"+k]=!0}}(0,A.e)([(0,g.J)()],c.prototype,"shadowFrustumSize",null),(0,A.e)([(0,g.J)()],c.prototype,"shadowOrthoScale",null),(0,A.e)([(0,g.J)()],c.prototype,"autoUpdateExtends",void 0),(0,A.e)([(0,g.J)()],c.prototype,"autoCalcShadowZBounds",void 0),(0,A.e)([(0,g.J)("orthoLeft")],c.prototype,"_orthoLeft",void 0),(0,A.e)([(0,g.J)("orthoRight")],c.prototype,"_orthoRight",void 0),(0,A.e)([(0,g.J)("orthoTop")],c.prototype,"_orthoTop",void 0),(0,A.e)([(0,g.J)("orthoBottom")],c.prototype,"_orthoBottom",void 0),(0,O.f)("BABYLON.DirectionalLight",c)},14778:(s,k,h)=>{"use strict";h.d(k,{b:()=>c});var A=h(12570),g=h(12579),ms=h(12590),i=h(12636),K=h(13041),H=h(13147),O=h(12543);K.e.AddNodeConstructor("Light_Type_3",((s,k)=>()=>new c(s,ms.Pk.Zero(),k)));class c extends H.e{constructor(s,k,h){super(s,h),this.groundColor=new i.Bk(0,0,0),this.direction=k||ms.Pk.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"sc"}setDirectionToTarget(s){return this.direction=ms.Pk.Normalize(s.Rk(ms.Pk.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(s,k){const h=ms.Pk.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",h.x,h.y,h.z,0,k),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ng),k),this}transferToNodeMaterialEffect(s,k){const h=ms.Pk.Normalize(this.direction);return s.setFloat3(k,h.x,h.y,h.z),this}fh(){return this._worldMatrix||(this._worldMatrix=ms.Matrix.Identity()),this._worldMatrix}getTypeID(){return H.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(s,k){s["HEMILIGHT"+k]=!0}}(0,A.e)([(0,g.j)()],c.prototype,"groundColor",void 0),(0,A.e)([(0,g.G)()],c.prototype,"direction",void 0),(0,O.f)("BABYLON.HemisphericLight",c)},14253:(s,k,h)=>{"use strict";h.d(k,{c:()=>S});var A=h(12570),g=h(12579),ms=h(12590),i=h(13041),K=h(13147),H=h(13199),O=h(12567),c=h(12543);i.e.AddNodeConstructor("Light_Type_2",((s,k)=>()=>new S(s,ms.Pk.Zero(),ms.Pk.Zero(),0,0,k)));class S extends H.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(s){this._iesProfileTexture!==s&&(this._iesProfileTexture=s,this._iesProfileTexture&&S._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(s){this._angle=s,this._cosHalfAngle=Math.cos(.5*s),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(s){this._innerAngle=s,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(s){this._shadowAngleScale=s,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(s){this._projectionTextureLightNear=s,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(s){this._projectionTextureLightFar=s,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(s){this._projectionTextureUpDirection=s,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(s){this._projectionTexture!==s&&(this._projectionTexture=s,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(S._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):S._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(s){return void 0!==s.onGeneratedObservable}static _IsTexture(s){return void 0!==s.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(s){this._projectionTextureProjectionLightMatrix=s,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(s,k,h,A,g,i){super(s,i),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=ms.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=ms.Pk.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=ms.Pk.Zero(),this._projectionTextureViewLightMatrix=ms.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=ms.Matrix.Zero(),this._projectionTextureScalingMatrix=ms.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=k,this.direction=h,this.angle=A,this.exponent=g}getClassName(){return"SpotLight"}getTypeID(){return K.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(s){super._setDirection(s),this._projectionTextureViewLightDirty=!0}_setPosition(s){super._setPosition(s),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(s,k,h){const A=this.Is().activeCamera;if(!A)return;this._shadowAngleScale=this._shadowAngleScale||1;const g=this._shadowAngleScale*this._angle,i=void 0!==this.shadowMinZ?this.shadowMinZ:A.Jh,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,H=this.Is().getEngine().rh;ms.Matrix.PerspectiveFovLHToRef(g,1,H?K:i,H?i:K,s,!0,this._scene.getEngine().isNDCHalfZRange,void 0,H)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),ms.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const s=this.projectionTextureLightFar,k=this.projectionTextureLightNear,h=s/(s-k),A=-h*k,g=1/Math.tan(this._angle/2);ms.Matrix.FromValuesToRef(g/1,0,0,0,0,g,0,0,0,0,h,1,0,0,A,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof O.b){const s=this._projectionTexture.uScale/2,k=this._projectionTexture.vScale/2;ms.Matrix.FromValuesToRef(s,0,0,0,0,k,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(s,k){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),s.setMatrix("textureProjectionMatrix"+k,this._projectionTextureMatrix),s.setTexture("projectionLightTexture"+k,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&s.setTexture("iesLightTexture"+k,this._iesProfileTexture),this}transferToEffect(s,k){let h;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,k),h=ms.Pk.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,k),h=ms.Pk.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",h.x,h.y,h.z,this._cosHalfAngle,k),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,k),this}transferToNodeMaterialEffect(s,k){let h;return h=this.computeTransformedInformation()?ms.Pk.Normalize(this.transformedDirection):ms.Pk.Normalize(this.direction),this.Is().useRightHandedSystem?s.setFloat3(k,-h.x,-h.y,-h.z):s.setFloat3(k,h.x,h.y,h.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(s){const k=this._scene.getEngine(),h=void 0!==this.shadowMinZ?this.shadowMinZ:(null===s||void 0===s?void 0:s.Jh)??0;return k.rh&&k.isNDCHalfZRange?h:this._scene.getEngine().isNDCHalfZRange?0:h}getDepthMaxZ(s){const k=this._scene.getEngine(),h=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===s||void 0===s?void 0:s.maxZ)??1e4;return k.rh&&k.isNDCHalfZRange?0:h}prepareLightSpecificDefines(s,k){s["SPOTLIGHT"+k]=!0,s["PROJECTEDLIGHTTEXTURE"+k]=!(!this.projectionTexture||!this.projectionTexture.isReady()),s["IESLIGHTTEXTURE"+k]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,A.e)([(0,g.J)()],S.prototype,"angle",null),(0,A.e)([(0,g.J)()],S.prototype,"innerAngle",null),(0,A.e)([(0,g.J)()],S.prototype,"shadowAngleScale",null),(0,A.e)([(0,g.J)()],S.prototype,"exponent",void 0),(0,A.e)([(0,g.J)()],S.prototype,"projectionTextureLightNear",null),(0,A.e)([(0,g.J)()],S.prototype,"projectionTextureLightFar",null),(0,A.e)([(0,g.J)()],S.prototype,"projectionTextureUpDirection",null),(0,A.e)([(0,g.E)("projectedLightTexture")],S.prototype,"_projectionTexture",void 0),(0,c.f)("BABYLON.SpotLight",S)},13976:(s,k,h)=>{"use strict";h.d(k,{d:()=>i,e:()=>ms,f:()=>K});const A={},g={};function ms(s,k){A[s]=k}function i(s,k){g[s]=k}function K(s){return g[s]?g[s]:null}},13878:(s,k,h)=>{"use strict";h.d(k,{e:()=>G,i:()=>n});var A,g=h(12402),ms=h(12408),i=h(12836),K=h(12445),H=h(12422),O=h(13079),c=h(12448),S=h(12451),a=h(12552),r=h(12481),d=h(12442);!function(s){s[s.Clean=0]="Clean",s[s.Stop=1]="Stop",s[s.Sync=2]="Sync",s[s.NoSync=3]="NoSync"}(A||(A={}));const E=new ms.c,j={};let P=!1;function R(){return j[".babylon"]}function D(s,k){const h=j[s];return h||(H.c.Warn("Unable to find a plugin to load "+s+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),k?R():void 0)}function w(s,k,h){let A="Unable to load from "+(s.rawData?"binary data":s.url);return k?A+=`: ${k}`:h&&(A+=`: ${h}`),A}async function B(s,k,h,A,g,ms,i,K,H){var O;const S="data:"===(a=s.url).substring(0,5)?a.substring(5):null;var a;if(s.rawData&&!i)throw"When using ArrayBufferView to load data the file extension must be provided.";const P=S||i?"":function(s){const k=s.indexOf("?");-1!==k&&(s=s.substring(0,k));const h=s.lastIndexOf(".");return s.substring(h,s.length).toLowerCase()}(s.url);let w=i?D(i,!0):S?function(s){for(const k in j){const h=j[k].plugin;if(h.canDirectLoad&&h.canDirectLoad(s))return j[k]}return R()}(s.url):D(P,!1);if(!w&&P){if(s.url&&!s.url.startsWith("blob:")){const k=await async function(s,k){const h=k.method||"GET";return await new Promise(((A,g)=>{const ms=new d.d;ms.addEventListener("readystatechange",(()=>{if(4==ms.readyState)if(200==ms.status){const s={};if(k.responseHeaders)for(const h of k.responseHeaders)s[h]=ms.getResponseHeader(h)||"";A({response:ms.response,headerValues:s})}else g(`Unable to fetch data from ${s}. Error code: ${ms.status}`)})),ms.open(h,s),ms.send()}))}(s.url,{method:"HEAD",responseHeaders:["Content-Type"]}),h=k.headerValues?k.headerValues["Content-Type"]:"";h&&(w=function(s){for(const k in j){const h=j[k];if(h.mimeType===s)return h}}(h))}w||(w=R())}if(!w)throw new Error(`No plugin or fallback for ${i??s.url}`);if(!1===(null===H||void 0===H||null===(O=H[w.plugin.name])||void 0===O?void 0:O.enabled))throw new Error(`The '${w.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(s.rawData&&!w.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(s=>{if(w.plugin.createPlugin){const k=w.plugin.createPlugin(H??{});return k instanceof Promise?(k.then(s).catch((s=>{g("Error instantiating plugin.",s)})),null):(s(k),k)}return s(w.plugin),w.plugin})((H=>{var O;if(!H)throw`The loader plugin corresponding to the '${i}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(E.notifyObservers(H),S&&(H.canDirectLoad&&H.canDirectLoad(s.url)||!(0,c.g)(s.url))){if(H.directLoad){const s=H.directLoad(k,S);s instanceof Promise?s.then((s=>{h(H,s)})).catch((s=>{g("Error in directLoad of _loadData: "+s,s)})):h(H,s)}else h(H,S);return}const a=w.isBinary,d=(s,A)=>{k.P?g("Scene has been disposed"):h(H,s,A)};let j=null,P=!1;null===(O=H.Dh)||void 0===O||O.add((()=>{P=!0,j&&(j.abort(),j=null),ms()}));const R=()=>{if(P)return;const h=(s,k)=>{g(null===s||void 0===s?void 0:s.statusText,k)};if(!H.loadFile&&s.rawData)throw"Plugin does not support loading ArrayBufferView.";j=H.loadFile?H.loadFile(k,s.rawData||s.file||s.url,s.rootUrl,d,A,a,h,K):k._loadFile(s.file||s.url,d,A,!0,a,h)},D=k.getEngine();let B=D.enableOfflineSupport;if(B){let h=!1;for(const A of k.disableOfflineSupportExceptionRules)if(A.test(s.url)){h=!0;break}B=!h}B&&r.e.OfflineProviderFactory?k.offlineProvider=r.e.OfflineProviderFactory(s.url,R,D.disableManifestCheck):R()}))}function u(s,k){let h,A,ms=null,i=null;if(k)if(k.name)h=`file:${k.name}`,A=k.name,ms=k;else if(ArrayBuffer.isView(k))h="",A=(0,a.d)(),i=k;else if(k.startsWith("data:"))h=k,A="";else if(s){const ms=k;if("/"===ms.substring(0,1))return g.Tools.Error("Wrong sceneFilename parameter"),null;h=s+ms,A=ms}else h=k,A=g.Tools.GetFilename(k),s=g.Tools.GetFolderPath(k);else h=s,A=g.Tools.GetFilename(s),s=g.Tools.GetFolderPath(s);return{url:h,rootUrl:s,name:A,file:ms,rawData:i}}function G(s){if("string"===typeof s.extensions){const k=s.extensions;j[k.toLowerCase()]={plugin:s,isBinary:!1}}else{const k=s.extensions,h=Object.keys(k);for(const A of h)j[A.toLowerCase()]={plugin:s,isBinary:k[A].isBinary,mimeType:k[A].mimeType}}}async function Q(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.b.LastCreatedScene,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,ms=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!A)return H.c.Error("No scene available to import mesh to"),null;const r=u(k,h);if(!r)return null;const d={};A.addPendingData(d);const E=()=>{A.removePendingData(d)},j=(s,k)=>{const h=w(r,s,k);i?i(A,h,new S.i(h,S.e.SceneLoaderError,k)):H.c.Error(h),E()},P=ms?s=>{try{ms(s)}catch(k){j("Error in onProgress callback: "+k,k)}}:void 0,R=(s,k,h,ms,i,K,H,O)=>{if(A.importedMeshesFiles.push(r.url),g)try{g(s,k,h,ms,i,K,H,O)}catch(c){j("Error in onSuccess callback: "+c,c)}A.removePendingData(d)};return await B(r,A,((k,h,g)=>{if(k.rewriteRootURL&&(r.rootUrl=k.rewriteRootURL(r.rootUrl,g)),k.importMesh){const g=[],ms=[],i=[];if(!k.importMesh(s,A,h,r.rootUrl,g,ms,i,j))return;A.loadingPluginName=k.name,R(g,ms,i,[],[],[],[],[])}else{k.importMeshAsync(s,A,h,r.rootUrl,P,r.name).then((s=>{A.loadingPluginName=k.name,R(s.meshes,s.la,s.skeletons,s.animationGroups,s.transformNodes,s.geometries,s.lights,s.spriteManagers)})).catch((s=>{j(s.message,s)}))}}),P,j,E,O,c,a)}async function p(s,k,h,A,g,ms,i,K){return await new Promise(((H,O)=>{try{Q(s,k,h,A,((s,k,h,A,g,ms,i,K)=>{H({meshes:s,la:k,skeletons:h,animationGroups:A,transformNodes:g,geometries:ms,lights:i,spriteManagers:K})}),g,((s,k,h)=>{O(h||new Error(k))}),ms,i,K).catch(O)}catch(S){O(S)}}))}async function I(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedEngine,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};h?await b(s,k,new i.d(h),A,ms,H,O,c,S):g.Tools.Error("No engine available")}async function N(s,k,h,A,g,ms,i){return await new Promise(((K,H)=>{I(s,k,h,(s=>{K(s)}),A,((s,k,h)=>{H(h||new Error(k))}),g,ms,i)}))}async function b(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,ms=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return H.c.Error("No scene available to append to"),null;const r=u(s,k);if(!r)return null;const d={};h.addPendingData(d);const E=()=>{h.removePendingData(d)};O.b.ShowLoadingScreen&&!P&&(P=!0,h.getEngine().displayLoadingUI(),h.executeWhenReady((()=>{h.getEngine().hideLoadingUI(),P=!1})));const j=(s,k)=>{const A=w(r,s,k);ms?ms(h,A,new S.i(A,S.e.SceneLoaderError,k)):H.c.Error(A),E()},R=g?s=>{try{g(s)}catch(k){j("Error in onProgress callback",k)}}:void 0,D=()=>{if(A)try{A(h)}catch(s){j("Error in onSuccess callback",s)}h.removePendingData(d)};return await B(r,h,((s,k)=>{if(s.load){if(!s.load(h,k,r.rootUrl,j))return;h.loadingPluginName=s.name,D()}else{s.loadAsync(h,k,r.rootUrl,R,r.name).then((()=>{h.loadingPluginName=s.name,D()})).catch((s=>{j(s.message,s)}))}}),R,j,E,i,c,a)}async function t(s,k,h,A,g,ms,i){return await new Promise(((K,H)=>{try{b(s,k,h,(s=>{K(s)}),A,((s,k,h)=>{H(h||new Error(k))}),g,ms,i).catch(H)}catch(S){H(S)}}))}async function z(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,ms=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return H.c.Error("No scene available to load asset container to"),null;const a=u(s,k);if(!a)return null;const r={};h.addPendingData(r);const d=()=>{h.removePendingData(r)},E=(s,k)=>{const A=w(a,s,k);ms?ms(h,A,new S.i(A,S.e.SceneLoaderError,k)):H.c.Error(A),d()},j=g?s=>{try{g(s)}catch(k){E("Error in onProgress callback",k)}}:void 0,P=s=>{if(A)try{A(s)}catch(k){E("Error in onSuccess callback",k)}h.removePendingData(r)};return await B(a,h,((s,k)=>{if(s.loadAssetContainer){const A=s.loadAssetContainer(h,k,a.rootUrl,E);if(!A)return;A.populateRootNodes(),h.loadingPluginName=s.name,P(A)}else if(s.loadAssetContainerAsync){s.loadAssetContainerAsync(h,k,a.rootUrl,j,a.name).then((k=>{k.populateRootNodes(),h.loadingPluginName=s.name,P(k)})).catch((s=>{E(s.message,s)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),j,E,d,i,O,c)}async function C(s,k,h,A,g,ms,i){return await new Promise(((K,H)=>{try{z(s,k,h,(s=>{K(s)}),A,((s,k,h)=>{H(h||new Error(k))}),g,ms,i).catch(H)}catch(S){H(S)}}))}async function v(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedScene,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ms=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!h)return void H.c.Error("No scene available to load animations to");if(A){for(const A of h.animatables)A.reset();h.stopAllAnimations();const s=h.animationGroups.slice();for(const h of s)h.dispose();const k=h.getNodes();for(const h of k)h.animations&&(h.animations=[])}else switch(g){case 0:const s=h.animationGroups.slice();for(const k of s)k.dispose();break;case 1:for(const k of h.animationGroups)k.stop();break;case 2:for(const k of h.animationGroups)k.reset(),k.restart();break;case 3:break;default:return void H.c.Error("Unknown animation group loading mode value '"+g+"'")}const d=h.animatables.length;await z(s,k,h,(s=>{s.mergeAnimationsTo(h,h.animatables.slice(d),ms),s.dispose(),h.onAnimationFileImportedObservable.notifyObservers(h),i&&i(h)}),O,c,S,a,r)}async function Y(s,k,h,A,g,ms,i,K,H,O){return await new Promise(((c,a)=>{try{v(s,k,h,A,g,ms,(s=>{c(s)}),i,((s,k,h)=>{a(h||new Error(k))}),K,H,O).catch(a)}catch(S){a(S)}}))}class n{static get ForceFullSceneLoadingForIncremental(){return O.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(s){O.b.ForceFullSceneLoadingForIncremental=s}static get ShowLoadingScreen(){return O.b.ShowLoadingScreen}static set ShowLoadingScreen(s){O.b.ShowLoadingScreen=s}static get loggingLevel(){return O.b.loggingLevel}static set loggingLevel(s){O.b.loggingLevel=s}static get CleanBoneMatrixWeights(){return O.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(s){O.b.CleanBoneMatrixWeights=s}static GetDefaultPlugin(){return R()}static GetPluginForExtension(s){var k;return null===(k=D(s,!0))||void 0===k?void 0:k.plugin}static IsPluginForExtensionAvailable(s){return function(s){return!!j[s]}(s)}static RegisterPlugin(s){G(s)}static ImportMesh(s,k,h,A,g,ms,i,H,O){Q(s,k,h,A,g,ms,i,H,O).catch((s=>null===i||void 0===i?void 0:i(K.b.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async ImportMeshAsync(s,k,h,A,g,ms,i){return await p(s,k,h,A,g,ms,i)}static Load(s,k,h,A,g,ms,i,H){I(s,k,h,A,g,ms,i,H).catch((s=>null===ms||void 0===ms?void 0:ms(K.b.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async LoadAsync(s,k,h,A,g,ms){return await N(s,k,h,A,g,ms)}static Append(s,k,h,A,g,ms,i,H){b(s,k,h,A,g,ms,i,H).catch((s=>null===ms||void 0===ms?void 0:ms(h??K.b.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async AppendAsync(s,k,h,A,g,ms){return await t(s,k,h,A,g,ms)}static LoadAssetContainer(s,k,h,A,g,ms,i,H){z(s,k,h,A,g,ms,i,H).catch((s=>null===ms||void 0===ms?void 0:ms(h??K.b.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async LoadAssetContainerAsync(s,k,h,A,g,ms){return await C(s,k,h,A,g,ms)}static ImportAnimations(s,k,h,A,g,ms,i,H,O,c,S){v(s,k,h,A,g,ms,i,H,O,c,S).catch((s=>null===O||void 0===O?void 0:O(h??K.b.LastCreatedScene,null===s||void 0===s?void 0:s.message,s)))}static async ImportAnimationsAsync(s,k,h,A,g,ms,i,K,H,O,c){return await Y(s,k,h,A,g,ms,K,O,c)}}n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=E},14269:(s,k,h)=>{"use strict";h.d(k,{d:()=>a});var A=h(12570),g=h(12579),ms=h(12402),i=h(12590),K=h(12614),H=h(12567),O=h(12543),c=h(12408),S=h(12623);h(14275);class a extends K.e{set boundingBoxSize(s){if(this._boundingBoxSize&&this._boundingBoxSize.equals(s))return;this._boundingBoxSize=s;const k=this.Is();k&&k.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(s){this._rotationY=s,this.setReflectionTextureMatrix(i.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(s,k,h){let A="";for(const g of s)A+=g;return new a(A,k,null,h,s)}static CreateFromPrefilteredData(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=k.useDelayedTextureLoading;k.useDelayedTextureLoading=!1;const ms=new a(s,k,null,!1,null,null,null,void 0,!0,h,A);return k.useDelayedTextureLoading=g,ms}constructor(s,k){var h;let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,j=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,P=arguments.length>13?arguments[13]:void 0,R=arguments.length>14?arguments[14]:void 0;super(k),this.onLoadObservable=new c.c,this.boundingBoxPosition=i.Pk.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new i.Matrix,this._buffer=null,this.name=s,this.url=s,this._noMipmap=g,this.Wh=!1,this.isCube=!0,this._textureMatrix=i.Matrix.Identity(),this.coordinatesMode=H.b.CUBIC_MODE;let D=null,w=null;null===A||Array.isArray(A)?(this._noMipmap=g,this._format=S,this._createPolynomials=d,D=A,this._loaderOptions=P,this._useSRGBBuffer=R,this._lodScale=E,this._lodOffset=j):(D=A.extensions??null,this._noMipmap=A.noMipmap??!1,ms=A.files??null,w=A.buffer??null,this._format=A.format??5,a=A.prefiltered??!1,r=A.forcedExtension??null,this._createPolynomials=A.createPolynomials??!1,this._lodScale=A.lodScale??.8,this._lodOffset=A.lodOffset??0,this._loaderOptions=A.loaderOptions,this._useSRGBBuffer=A.useSRGBBuffer,K=A.F??null,O=A.onError??null),(s||ms)&&this.updateURL(s,r,K,a,O,D,null===(h=this.Is())||void 0===h?void 0:h.useDelayedTextureLoading,ms,w)}getClassName(){return"CubeTexture"}updateURL(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,ms=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=s),this.url=s,k&&(this._forcedExtension=k);const O=s.lastIndexOf("."),c=k||(O>-1?s.substring(O).toLowerCase():""),S=0===c.indexOf(".dds"),a=0===c.indexOf(".env"),r=0===c.indexOf(".basis");if(a?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=A,A&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),K)this._files=K;else if(r||a||S||ms||(ms=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,ms){for(let k=0;k<ms.length;k++)this._files.push(s+ms[k]);this._extensions=ms}this._buffer=H,i?(this.delayLoadState=4,this._delayedOnLoad=h,this._delayedOnError=g):this._loadTexture(h,g)}delayLoad(s){4===this.delayLoadState&&(s&&(this._forcedExtension=s),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(s){var k,h;if(s.updateFlag===this._textureMatrix.updateFlag)return;s.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(h=this.Is())||void 0===h||h.markAllMaterialsAsDirty(1,(s=>-1!==s.getActiveTextures().indexOf(this))));if(this._textureMatrix=s,null===(k=this.Is())||void 0===k||!k.useRightHandedSystem)return;const A=i.TmpVectors.Pk[0],g=i.TmpVectors.Quaternion[0],ms=i.TmpVectors.Pk[1];this._textureMatrix.decompose(A,g,ms),g.z*=-1,g.w*=-1,i.Matrix.ComposeToRef(A,g,ms,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var s;return null!==(s=this.Is())&&void 0!==s&&s.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this.Is(),A=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const g=()=>{var k;(this.onLoadObservable.notifyObservers(this),A)&&(A.dispose(),null===(k=this.Is())||void 0===k||k.markAllMaterialsAsDirty(1));s&&s()},i=(s,h)=>{this._loadingError=!0,this._errorObject={message:s,exception:h},k&&k(s,h),H.b.OnTextureLoadErrorObservable.notifyObservers(this)};var K;this._texture?this._texture.isReady?ms.Tools.SetImmediate((()=>g())):this._texture.onLoadedObservable.add((()=>g())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,h,this._lodScale,this._lodOffset,s,i,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,h,this._files,this._noMipmap,s,i,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(K=this._texture)||void 0===K||K.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(s,k,h){const A=S.e.Parse((()=>{let A=!1;return s.prefiltered&&(A=s.prefiltered),new a(h+(s.url??s.name),k,s.extensions,!1,s.files||null,null,null,void 0,A,s.forcedExtension)}),s,k);if(s.boundingBoxPosition&&(A.boundingBoxPosition=i.Pk.uk(s.boundingBoxPosition)),s.boundingBoxSize&&(A.boundingBoxSize=i.Pk.uk(s.boundingBoxSize)),s.animations)for(let g=0;g<s.animations.length;g++){const k=s.animations[g],h=(0,O.d)("BABYLON.Animation");h&&A.animations.push(h.Parse(k))}return A}clone(){let s=0;const k=S.e.Clone((()=>{const k=new a(this.url,this.Is()||this._getEngine(),this._extensions,this._noMipmap,this._files);return s=k.uniqueId,k}),this);return k.uniqueId=s,k}}(0,A.e)([(0,g.J)()],a.prototype,"url",void 0),(0,A.e)([(0,g.G)()],a.prototype,"boundingBoxPosition",void 0),(0,A.e)([(0,g.G)()],a.prototype,"boundingBoxSize",null),(0,A.e)([(0,g.J)("rotationY")],a.prototype,"rotationY",null),(0,A.e)([(0,g.J)("files")],a.prototype,"_files",void 0),(0,A.e)([(0,g.J)("forcedExtension")],a.prototype,"_forcedExtension",void 0),(0,A.e)([(0,g.J)("extensions")],a.prototype,"_extensions",void 0),(0,A.e)([(0,g.v)("textureMatrix")],a.prototype,"_textureMatrix",void 0),(0,A.e)([(0,g.v)("textureMatrixRefraction")],a.prototype,"_textureMatrixRefraction",void 0),H.b._CubeTextureParser=a.Parse,(0,O.f)("BABYLON.CubeTexture",a)},14788:(s,k,h)=>{"use strict";h.d(k,{c:()=>H});var A=h(12422),g=h(12567),ms=h(12559),i=h(12727),K=h(12515);i.ThinEngine.prototype.createDynamicTexture=function(s,k,h,A){const g=new K.c(this,4);return g.baseWidth=s,g.baseHeight=k,h&&(s=this.needPOTTextures?(0,ms.f)(s,this._caps.maxTextureSize):s,k=this.needPOTTextures?(0,ms.f)(k,this._caps.maxTextureSize):k),g.width=s,g.height=k,g.isReady=!1,g.generateMipMaps=h,g.samplingMode=A,this.updateTextureSamplingMode(A,g),this._internalTexturesCache.push(g),g},i.ThinEngine.prototype.updateDynamicTexture=function(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!s)return;const i=this._gl,K=i.TEXTURE_2D,H=this._bindTextureDirectly(K,s,!0,ms);this._unpackFlipY(void 0===h?s.invertY:h),A&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const O=this._getWebGLTextureType(s.type),c=this._getInternalFormat(g||s.format),S=this._getRGBABufferInternalSizedFormat(s.type,c);i.texImage2D(K,0,S,c,O,k),s.generateMipMaps&&i.generateMipmap(K),H||this._bindTextureDirectly(K,null),A&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g&&(s.format=g),s._dynamicTextureSource=k,s._premulAlpha=A,s.invertY=h||!1,s.isReady=!0};class H extends g.b{constructor(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,K=arguments.length>6?arguments[6]:void 0;const H=!h||h._isScene;super(null,H?h:null===h||void 0===h?void 0:h.Dk,H?!A:h,K,ms,void 0,void 0,void 0,void 0,i),this.name=s,this.wrapU=g.b.CLAMP_ADDRESSMODE,this.wrapV=g.b.CLAMP_ADDRESSMODE,this._generateMipMaps=A;const O=this._getEngine();if(!O)return;if(k.getContext)this._canvas=k,this._ownCanvas=!1,this._texture=O.createDynamicTexture(this._canvas.width,this._canvas.height,A,ms);else{this._canvas=O.createCanvas(1,1),this._ownCanvas=!0;const s=k;s.width||0===s.width?this._texture=O.createDynamicTexture(s.width,s.height,A,ms):this._texture=O.createDynamicTexture(k,k,A,ms)}const c=this.getSize();this._canvas.width!==c.width&&(this._canvas.width=c.width),this._canvas.height!==c.height&&(this._canvas.height=c.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(s){this._canvas.width=s.width,this._canvas.height=s.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(s.width,s.height,this._generateMipMaps,this.samplingMode)}scale(s){const k=this.getSize();k.width*=s,k.height*=s,this._recreate(k)}scaleTo(s,k){const h=this.getSize();h.width=s,h.height=k,this._recreate(h)}getContext(){return this._context}clear(s){const k=this.getSize();s&&(this._context.fillStyle=s),this._context.clearRect(0,0,k.width,k.height)}update(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===s||s,k,this._format||void 0,void 0,h)}drawText(s,k,h,A,g,ms,i){let K=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const H=this.getSize();if(ms&&(this._context.fillStyle=ms,this._context.fillRect(0,0,H.width,H.height)),this._context.font=A,null===k||void 0===k){const h=this._context.measureText(s);k=(H.width-h.width)/2}if(null===h||void 0===h){const s=parseInt(A.replace(/\D/g,""));h=H.height/2+s/3.65}this._context.fillStyle=g||"",this._context.fillText(s,k,h),K&&this.update(i)}dispose(){var s,k;(super.dispose(),this._ownCanvas)&&(null===(s=this._canvas)||void 0===s||null===(k=s.remove)||void 0===k||k.call(s));this._canvas=null,this._context=null}clone(){const s=this.Is();if(!s)return this;const k=this.getSize(),h=new H(this.name,k,s,this._generateMipMaps);return h.Wh=this.Wh,h.level=this.level,h.wrapU=this.wrapU,h.wrapV=this.wrapV,h}serialize(){const s=this.Is();s&&!s.isReady()&&A.c.Warn("The scene must be ready before serializing the dynamic texture");const k=super.serialize();return H._IsCanvasElement(this._canvas)&&(k.base64String=this._canvas.toDataURL()),k.invertY=this._invertY,k.samplingMode=this.samplingMode,k}static _IsCanvasElement(s){return void 0!==s.toDataURL}_rebuild(){this.update()}}},14180:(s,k,h)=>{"use strict";h.d(k,{c:()=>g});var A=h(12567);class g extends A.b{get depth(){return this._depth}constructor(s,k,h,g,ms,i){let K=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:A.b.TRILINEAR_SAMPLINGMODE,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,S=arguments.length>10?arguments[10]:void 0;super(null,i,!K,H),this.format=ms,this._texture=i.getEngine().createRawTexture2DArray(s,k,h,g,ms,K,H,O,null,c,S),this._depth=g,this.is2DArray=!0}update(s){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,s,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(s,k,h,A,ms){return new g(s,k,h,A,5,ms,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13990:(s,k,h)=>{"use strict";h.d(k,{b:()=>K,c:()=>H,f:()=>ms,i:()=>i});var A=h(12607),g=h(12590);function ms(s,k){return`{X: ${s.x.toFixed(k)} Y: ${s.y.toFixed(k)}}`}function i(s,k){return`{X: ${s._x.toFixed(k)} Y: ${s._y.toFixed(k)} Z: ${s._z.toFixed(k)}}`}function K(s,k){return 2*Math.acos((0,A.Clamp)(g.Quaternion.Dot(s,k)))}function H(s,k){const h=new g.Quaternion;return function(s,k,h){const ms=g.Pk.Cross(s,k),i=Math.acos((0,A.Clamp)(g.Pk.Dot(s,k),-1,1));g.Quaternion.RotationAxisToRef(ms,i,h)}(s,k,h),h}},13835:(s,k,h)=>{"use strict";h.d(k,{c:()=>O});var A=h(12590),g=h(12636),ms=h(13061),i=h(13047),K=h(12651);h(13840);function H(s){let k=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const h=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],ms=[];let H=[];const O=s.width||s.size||1,c=s.height||s.size||1,S=s.depth||s.size||1,a=s.wrap||!1;let r=void 0===s.topBaseAt?1:s.topBaseAt,d=void 0===s.bottomBaseAt?0:s.bottomBaseAt;r=(r+4)%4,d=(d+4)%4;let E=[2,0,3,1][r],j=[2,0,1,3][d],P=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(a){k=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],P=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let s=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],h=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const A=[17,18,19,16],g=[22,23,20,21];for(;E>0;)s.unshift(s.pop()),A.unshift(A.pop()),E--;for(;j>0;)h.unshift(h.pop()),g.unshift(g.pop()),j--;s=s.flat(),h=h.flat(),P=P.concat(s).concat(h),k.push(A[0],A[2],A[3],A[0],A[1],A[2]),k.push(g[0],g[2],g[3],g[0],g[1],g[2])}const R=[O/2,c/2,S/2];H=P.reduce(((s,k,h)=>s.concat(k*R[h%3])),[]);const D=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,w=s.faceUV||new Array(6),B=s.faceColors,u=[];for(let i=0;i<6;i++)void 0===w[i]&&(w[i]=new A.Vector4(0,0,1,1)),B&&void 0===B[i]&&(B[i]=new g.jg(1,1,1,1));for(let A=0;A<6;A++)if(ms.push(w[A].z,K.d?1-w[A].w:w[A].w),ms.push(w[A].x,K.d?1-w[A].w:w[A].w),ms.push(w[A].x,K.d?1-w[A].y:w[A].y),ms.push(w[A].z,K.d?1-w[A].y:w[A].y),B)for(let s=0;s<4;s++)u.push(B[A].r,B[A].g,B[A].b,B[A].a);i.c._ComputeSides(D,H,k,h,ms,s.frontUVs,s.backUVs);const G=new i.c;if(G.indices=k,G.bs=H,G.ts=h,G.Cs=ms,B){const s=D===i.c.DOUBLESIDE?u.concat(u):u;G.zs=s}return G}function O(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new ms.e(s,h);k.sideOrientation=ms.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return H(k).Ys(A,k.updatable),A}i.c.CreateBox=H,ms.e.CreateBox=function(s,k){return O(s,{size:k,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13983:(s,k,h)=>{"use strict";h.d(k,{e:()=>K});var A=h(13061),g=h(13047),ms=h(12651);function i(s){const k=[],h=[],A=[],i=[],K=s.radius||.5,H=s.tessellation||64,O=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,c=0===s.sideOrientation?0:s.sideOrientation||g.c.DEFAULTSIDE;k.push(0,0,0),i.push(.5,.5);const S=2*Math.PI*O,a=1===O?S/H:S/(H-1);let r=0;for(let g=0;g<H;g++){const s=Math.cos(r),h=Math.sin(r),A=(s+1)/2,g=(1-h)/2;k.push(K*s,K*h,0),i.push(A,ms.d?1-g:g),r+=a}1===O&&(k.push(k[3],k[4],k[5]),i.push(i[2],ms.d?1-i[3]:i[3]));const d=k.length/3;for(let g=1;g<d-1;g++)h.push(g+1,0,g);g.c.ComputeNormals(k,h,A),g.c._ComputeSides(c,k,h,A,i,s.frontUVs,s.backUVs);const E=new g.c;return E.indices=h,E.bs=k,E.ts=A,E.Cs=i,E}function K(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new A.e(s,h);k.sideOrientation=A.e._GetDefaultSideOrientation(k.sideOrientation),g._originalBuilderSideOrientation=k.sideOrientation;return i(k).Ys(g,k.updatable),g}g.c.CreateDisc=i,A.e.CreateDisc=function(s,k,h){return K(s,{radius:k,tessellation:h,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13840:(s,k,h)=>{"use strict";h.d(k,{f:()=>j,e:()=>R,h:()=>P});var A=h(12590),g=h(12636),ms=h(13061),i=h(13047),K=h(12664);ms.e._GroundMeshParser=(s,k)=>H.Parse(s,k);class H extends ms.e{constructor(s,k){super(s,k),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=s,this._subdivisionsY=s,this.subdivide(s);const h=this;h.createOrUpdateSubmeshesOctree&&h.createOrUpdateSubmeshesOctree(k)}getHeightAtCoordinates(s,k){const h=this.getWorldMatrix(),g=A.TmpVectors.Matrix[5];h.invertToRef(g);const ms=A.TmpVectors.Pk[8];if(A.Pk.TransformCoordinatesFromFloatsToRef(s,0,k,g,ms),s=ms.x,k=ms.z,s<this._minX||s>=this._maxX||k<=this._minZ||k>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const i=this._getFacetAt(s,k),K=-(i.x*s+i.z*k+i.w)/i.y;return A.Pk.TransformCoordinatesFromFloatsToRef(0,K,0,h,ms),ms.y}getNormalAtCoordinates(s,k){const h=new A.Pk(0,1,0);return this.getNormalAtCoordinatesToRef(s,k,h),h}getNormalAtCoordinatesToRef(s,k,h){const g=this.getWorldMatrix(),ms=A.TmpVectors.Matrix[5];g.invertToRef(ms);const i=A.TmpVectors.Pk[8];if(A.Pk.TransformCoordinatesFromFloatsToRef(s,0,k,ms,i),s=i.x,k=i.z,s<this._minX||s>this._maxX||k<this._minZ||k>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const K=this._getFacetAt(s,k);return A.Pk.TransformNormalFromFloatsToRef(K.x,K.y,K.z,g,h),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(s,k){const h=Math.floor((s+this._maxX)*this._subdivisionsX/this._width),A=Math.floor(-(k+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),g=this._heightQuads[A*this._subdivisionsX+h];let ms;return ms=k<g.slope.x*s+g.slope.y?g.facet1:g.facet2,ms}_initHeightQuads(){const s=this._subdivisionsX,k=this._subdivisionsY;this._heightQuads=[];for(let h=0;h<k;h++)for(let k=0;k<s;k++){const g={slope:A.Vector2.Zero(),facet1:new A.Vector4(0,0,0,0),facet2:new A.Vector4(0,0,0,0)};this._heightQuads[h*s+k]=g}return this}_computeHeightQuads(){const s=this.getVerticesData(K.e.PositionKind);if(!s)return this;const k=A.TmpVectors.Pk[3],h=A.TmpVectors.Pk[2],g=A.TmpVectors.Pk[1],ms=A.TmpVectors.Pk[0],i=A.TmpVectors.Pk[4],H=A.TmpVectors.Pk[5],O=A.TmpVectors.Pk[6],c=A.TmpVectors.Pk[7],S=A.TmpVectors.Pk[8];let a=0,r=0,d=0,E=0,j=0,P=0,R=0;const D=this._subdivisionsX,w=this._subdivisionsY;for(let K=0;K<w;K++)for(let w=0;w<D;w++){a=3*w,r=K*(D+1)*3,d=(K+1)*(D+1)*3,k.x=s[r+a],k.y=s[r+a+1],k.z=s[r+a+2],h.x=s[r+a+3],h.y=s[r+a+4],h.z=s[r+a+5],g.x=s[d+a],g.y=s[d+a+1],g.z=s[d+a+2],ms.x=s[d+a+3],ms.y=s[d+a+4],ms.z=s[d+a+5],E=(ms.z-k.z)/(ms.x-k.x),j=k.z-E*k.x,h.subtractToRef(k,i),g.subtractToRef(k,H),ms.subtractToRef(k,O),A.Pk.CrossToRef(O,H,c),A.Pk.CrossToRef(i,O,S),c.normalize(),S.normalize(),P=-(c.x*k.x+c.y*k.y+c.z*k.z),R=-(S.x*h.x+S.y*h.y+S.z*h.z);const B=this._heightQuads[K*D+w];B.slope.cg(E,j),B.facet1.cg(c.x,c.y,c.z,P),B.facet2.cg(S.x,S.y,S.z,R)}return this}serialize(s){super.serialize(s),s.subdivisionsX=this._subdivisionsX,s.subdivisionsY=this._subdivisionsY,s.minX=this._minX,s.maxX=this._maxX,s.Jh=this._minZ,s.maxZ=this._maxZ,s.width=this._width,s.height=this._height}static Parse(s,k){const h=new H(s.name,k);return h._subdivisionsX=s.subdivisionsX||1,h._subdivisionsY=s.subdivisionsY||1,h._minX=s.minX,h._maxX=s.maxX,h._minZ=s.Jh,h._maxZ=s.maxZ,h._width=s.width,h._height=s.height,h}}var O=h(12402),c=h(12445),S=h(12598),a=h(12651);function r(s){const k=[],h=[],g=[],ms=[];let K,H;const O=s.width||s.size||1,c=s.height||s.size||1,S=0|(s.subdivisionsX||s.subdivisions||1),r=0|(s.subdivisionsY||s.subdivisions||1);for(K=0;K<=r;K++)for(H=0;H<=S;H++){const s=new A.Pk(H*O/S-O/2,0,(r-K)*c/r-c/2),k=new A.Pk(0,1,0);h.push(s.x,s.y,s.z),g.push(k.x,k.y,k.z),ms.push(H/S,a.d?K/r:1-K/r)}for(K=0;K<r;K++)for(H=0;H<S;H++)k.push(H+1+(K+1)*(S+1)),k.push(H+1+K*(S+1)),k.push(H+K*(S+1)),k.push(H+(K+1)*(S+1)),k.push(H+1+(K+1)*(S+1)),k.push(H+K*(S+1));const d=new i.c;return d.indices=k,d.bs=h,d.ts=g,d.Cs=ms,d}function d(s){const k=void 0!==s.xmin&&null!==s.xmin?s.xmin:-1,h=void 0!==s.zmin&&null!==s.zmin?s.zmin:-1,g=void 0!==s.xmax&&null!==s.xmax?s.xmax:1,ms=void 0!==s.zmax&&null!==s.zmax?s.zmax:1,K=s.subdivisions||{w:1,h:1},H=s.precision||{w:1,h:1},O=[],c=[],S=[],a=[];let r,d,E,j;K.h=K.h<1?1:K.h,K.w=K.w<1?1:K.w,H.w=H.w<1?1:H.w,H.h=H.h<1?1:H.h;const P=(g-k)/K.w,R=(ms-h)/K.h;function D(s,k,h,g){const ms=c.length/3,i=H.w+1;for(r=0;r<H.h;r++)for(d=0;d<H.w;d++){const s=[ms+d+r*i,ms+(d+1)+r*i,ms+(d+1)+(r+1)*i,ms+d+(r+1)*i];O.push(s[1]),O.push(s[2]),O.push(s[3]),O.push(s[0]),O.push(s[1]),O.push(s[3])}const K=A.Pk.Zero(),E=new A.Pk(0,1,0);for(r=0;r<=H.h;r++)for(K.z=r*(g-k)/H.h+k,d=0;d<=H.w;d++)K.x=d*(h-s)/H.w+s,K.y=0,c.push(K.x,K.y,K.z),S.push(E.x,E.y,E.z),a.push(d/H.w,r/H.h)}for(E=0;E<K.h;E++)for(j=0;j<K.w;j++)D(k+j*P,h+E*R,k+(j+1)*P,h+(E+1)*R);const w=new i.c;return w.indices=O,w.bs=c,w.ts=S,w.Cs=a,w}function E(s){const k=[],h=[],ms=[],K=[];let H,O;const c=s.colorFilter||new g.Bk(.3,.59,.11),a=s.alphaFilter||0;let r=!1;if(s.minHeight>s.maxHeight){r=!0;const k=s.maxHeight;s.maxHeight=s.minHeight,s.minHeight=k}for(H=0;H<=s.subdivisions;H++)for(O=0;O<=s.subdivisions;O++){const k=new A.Pk(O*s.width/s.subdivisions-s.width/2,0,(s.subdivisions-H)*s.height/s.subdivisions-s.height/2),g=4*(((k.x+s.width/2)/s.width*(s.bufferWidth-1)|0)+((1-(k.z+s.height/2)/s.height)*(s.bufferHeight-1)|0)*s.bufferWidth);let i=s.buffer[g]/255,d=s.buffer[g+1]/255,E=s.buffer[g+2]/255;const j=s.buffer[g+3]/255;r&&(i=1-i,d=1-d,E=1-E);const P=i*c.r+d*c.g+E*c.b;k.y=j>=a?s.minHeight+(s.maxHeight-s.minHeight)*P:s.minHeight-S.c,s.heightBuffer&&(s.heightBuffer[H*(s.subdivisions+1)+O]=k.y),h.push(k.x,k.y,k.z),ms.push(0,0,0),K.push(O/s.subdivisions,1-H/s.subdivisions)}for(H=0;H<s.subdivisions;H++)for(O=0;O<s.subdivisions;O++){const A=O+1+(H+1)*(s.subdivisions+1),g=O+1+H*(s.subdivisions+1),ms=O+H*(s.subdivisions+1),i=O+(H+1)*(s.subdivisions+1),K=h[3*A+1]>=s.minHeight,c=h[3*g+1]>=s.minHeight,S=h[3*ms+1]>=s.minHeight;K&&c&&S&&(k.push(A),k.push(g),k.push(ms));h[3*i+1]>=s.minHeight&&K&&S&&(k.push(i),k.push(A),k.push(ms))}i.c.ComputeNormals(h,k,ms);const d=new i.c;return d.indices=k,d.bs=h,d.ts=ms,d.Cs=K,d}function j(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=new H(s,arguments.length>2?arguments[2]:void 0);h._setReady(!1),h._subdivisionsX=k.subdivisionsX||k.subdivisions||1,h._subdivisionsY=k.subdivisionsY||k.subdivisions||1,h._width=k.width||1,h._height=k.height||1,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ;return r(k).Ys(h,k.updatable),h._setReady(!0),h}function P(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new ms.e(s,h);return d(k).Ys(A,k.updatable),A}function R(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const ms=h.width||10,i=h.height||10,K=h.subdivisions||1,S=h.minHeight||0,a=h.maxHeight||1,r=h.colorFilter||new g.Bk(.3,.59,.11),d=h.alphaFilter||0,j=h.updatable,P=h.onReady;A=A||c.b.LastCreatedScene;const R=new H(s,A);let D;R._subdivisionsX=K,R._subdivisionsY=K,R._width=ms,R._height=i,R._maxX=R._width/2,R._maxZ=R._height/2,R._minX=-R._maxX,R._minZ=-R._maxZ,R._setReady(!1),h.passHeightBufferInCallback&&(D=new Float32Array((K+1)*(K+1)));const w=(s,k,h)=>{E({width:ms,height:i,subdivisions:K,minHeight:S,maxHeight:a,colorFilter:r,buffer:s,bufferWidth:k,bufferHeight:h,alphaFilter:d,heightBuffer:D}).Ys(R,j),P&&P(R,D),R._setReady(!0)};if("string"===typeof k){const s=s=>{var k;const h=s.width,g=s.height;if(A.P)return;const ms=null===(k=A)||void 0===k?void 0:k.getEngine().resizeImageBitmap(s,h,g);w(ms,h,g)};O.Tools.LoadImage(k,s,h.onError?h.onError:()=>{},A.offlineProvider)}else w(k.data,k.width,k.height);return R}i.c.CreateGround=r,i.c.CreateTiledGround=d,i.c.CreateGroundFromHeightMap=E,ms.e.CreateGround=(s,k,h,A,g,ms)=>j(s,{width:k,height:h,subdivisions:A,updatable:ms},g),ms.e.CreateTiledGround=(s,k,h,A,g,ms,i,K,H)=>P(s,{xmin:k,zmin:h,xmax:A,zmax:g,subdivisions:ms,precision:i,updatable:H},K),ms.e.CreateGroundFromHeightMap=(s,k,h,A,g,ms,i,K,H,O,c)=>R(s,k,{width:h,height:A,subdivisions:g,minHeight:ms,maxHeight:i,updatable:H,onReady:O,alphaFilter:c},K)},14479:(s,k,h)=>{"use strict";h.d(k,{d:()=>r,e:()=>S,i:()=>a});var A=h(12590),g=h(13061),ms=h(13047),i=h(13150),K=h(12664),H=h(12422);function O(s){const k=[],h=[],A=s.lines,g=s.zs,i=[];let K=0;for(let ms=0;ms<A.length;ms++){const s=A[ms];for(let A=0;A<s.length;A++){const{x:H,y:O,z:c}=s[A];if(h.push(H,O,c),g){const s=g[ms],{r:k,g:h,b:K,a:H}=s[A];i.push(k,h,K,H)}A>0&&(k.push(K-1),k.push(K)),K++}}const H=new ms.c;return H.indices=k,H.bs=h,g&&(H.zs=i),H}function c(s){const k=s.dashSize||3,h=s.gapSize||1,g=s.dashNb||200,i=s.points,K=[],H=[],O=A.Pk.Zero();let c=0,S=0,a=0,r=0,d=0,E=0,j=0;for(j=0;j<i.length-1;j++)i[j+1].subtractToRef(i[j],O),c+=O.length();for(a=c/g,r=k*a/(k+h),j=0;j<i.length-1;j++){i[j+1].subtractToRef(i[j],O),S=Math.floor(O.length()/a),O.normalize();for(let s=0;s<S;s++)d=a*s,K.push(i[j].x+d*O.x,i[j].y+d*O.y,i[j].z+d*O.z),K.push(i[j].x+(d+r)*O.x,i[j].y+(d+r)*O.y,i[j].z+(d+r)*O.z),H.push(E,E+1),E+=2}const P=new ms.c;return P.bs=K,P.indices=H,P}function S(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=k.instance,g=k.lines,ms=k.zs;if(A){const s=A.getVerticesData(K.e.PositionKind);let k,h;ms&&(k=A.getVerticesData(K.e.ColorKind));let i=0,H=0;for(let A=0;A<g.length;A++){const K=g[A];for(let g=0;g<K.length;g++)s[i]=K[g].x,s[i+1]=K[g].y,s[i+2]=K[g].z,ms&&k&&(h=ms[A],k[H]=h[g].r,k[H+1]=h[g].g,k[H+2]=h[g].b,k[H+3]=h[g].a,H+=4),i+=3}return A.updateVerticesData(K.e.PositionKind,s,!1,!1),ms&&k&&A.updateVerticesData(K.e.ColorKind,k,!1,!1),A.refreshBoundingInfo(),A}const H=!!ms,c=new i.e(s,h,null,void 0,void 0,H,k.useVertexAlpha,k.material);return O(k).Ys(c,k.updatable),c}function a(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=k.zs?[k.zs]:null;return S(s,{lines:[k.points],updatable:k.updatable,instance:k.instance,zs:A,useVertexAlpha:k.useVertexAlpha,material:k.material},h)}function r(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const ms=k.points,K=k.instance,O=k.gapSize||1,S=k.dashSize||3;if(K){const s=s=>{const k=A.Pk.Zero(),h=s.length/6;let g=0,i=0,H=0,O=0,c=0,S=0,a=0,r=0;for(a=0;a<ms.length-1;a++)ms[a+1].subtractToRef(ms[a],k),g+=k.length();H=g/h;const d=K._creationDataStorage.dashSize;for(O=d*H/(d+K._creationDataStorage.gapSize),a=0;a<ms.length-1;a++)for(ms[a+1].subtractToRef(ms[a],k),i=Math.floor(k.length()/H),k.normalize(),r=0;r<i&&S<s.length;)c=H*r,s[S]=ms[a].x+c*k.x,s[S+1]=ms[a].y+c*k.y,s[S+2]=ms[a].z+c*k.z,s[S+3]=ms[a].x+(c+O)*k.x,s[S+4]=ms[a].y+(c+O)*k.y,s[S+5]=ms[a].z+(c+O)*k.z,S+=6,r++;for(;S<s.length;)s[S]=ms[a].x,s[S+1]=ms[a].y,s[S+2]=ms[a].z,S+=3};return(k.dashNb||k.dashSize||k.gapSize||k.useVertexAlpha||k.material)&&H.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),K.updateMeshPositions(s,!1),K}const a=new i.e(s,h,null,void 0,void 0,void 0,k.useVertexAlpha,k.material);return c(k).Ys(a,k.updatable),a._creationDataStorage=new g.g,a._creationDataStorage.dashSize=S,a._creationDataStorage.gapSize=O,a}ms.c.CreateLineSystem=O,ms.c.CreateDashedLines=c,g.e.bO=function(s,k){return a(s,{points:k,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},g.e.CreateDashedLines=function(s,k,h,A,g){return r(s,{points:k,dashSize:h,gapSize:A,dashNb:g,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13881:(s,k,h)=>{"use strict";h.d(k,{d:()=>K,g:()=>H});var A=h(13061),g=h(13047),ms=h(12651);function i(s){const k=[],h=[],A=[],i=[],K=void 0!==s.width?s.width:void 0!==s.size?s.size:1,H=void 0!==s.height?s.height:void 0!==s.size?s.size:1,O=0===s.sideOrientation?0:s.sideOrientation||g.c.DEFAULTSIDE,c=K/2,S=H/2;h.push(-c,-S,0),A.push(0,0,-1),i.push(0,ms.d?1:0),h.push(c,-S,0),A.push(0,0,-1),i.push(1,ms.d?1:0),h.push(c,S,0),A.push(0,0,-1),i.push(1,ms.d?0:1),h.push(-c,S,0),A.push(0,0,-1),i.push(0,ms.d?0:1),k.push(0),k.push(1),k.push(2),k.push(0),k.push(2),k.push(3),g.c._ComputeSides(O,h,k,A,i,s.frontUVs,s.backUVs);const a=new g.c;return a.indices=k,a.bs=h,a.ts=A,a.Cs=i,a}function K(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new A.e(s,h);k.sideOrientation=A.e._GetDefaultSideOrientation(k.sideOrientation),g._originalBuilderSideOrientation=k.sideOrientation;return i(k).Ys(g,k.updatable),k.sourcePlane&&(g.translate(k.sourcePlane.normal,-k.sourcePlane.d),g.setDirection(k.sourcePlane.normal.scale(-1))),g}const H={CO:K};g.c.CO=i,A.e.CO=(s,k,h,A,g)=>K(s,{size:k,width:k,height:k,sideOrientation:g,updatable:A},h)},13973:(s,k,h)=>{"use strict";h.d(k,{c:()=>H});var A=h(12590),g=h(13061),ms=h(13047),i=h(12651);function K(s){const k=0|(s.segments||32),h=s.diameterX||s.diameter||1,g=s.diameterY||s.diameter||1,K=s.diameterZ||s.diameter||1,H=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,O=s.slice&&s.slice<=0?1:s.slice||1,c=0===s.sideOrientation?0:s.sideOrientation||ms.c.DEFAULTSIDE,S=!!s.dedupTopBottomIndices,a=new A.Pk(h/2,g/2,K/2),r=2+k,d=2*r,E=[],j=[],P=[],R=[];for(let ms=0;ms<=r;ms++){const s=ms/r,k=s*Math.PI*O;for(let h=0;h<=d;h++){const g=h/d,ms=g*Math.PI*2*H,K=A.Matrix.RotationZ(-k),O=A.Matrix.RotationY(ms),c=A.Pk.TransformCoordinates(A.Pk.Up(),K),S=A.Pk.TransformCoordinates(c,O),r=S.multiply(a),E=S.divide(a).normalize();j.push(r.x,r.y,r.z),P.push(E.x,E.y,E.z),R.push(g,i.d?1-s:s)}if(ms>0){const s=j.length/3;for(let k=s-2*(d+1);k+d+2<s;k++)S?(ms>1&&(E.push(k),E.push(k+1),E.push(k+d+1)),(ms<r||O<1)&&(E.push(k+d+1),E.push(k+1),E.push(k+d+2))):(E.push(k),E.push(k+1),E.push(k+d+1),E.push(k+d+1),E.push(k+1),E.push(k+d+2))}}ms.c._ComputeSides(c,j,E,P,R,s.frontUVs,s.backUVs);const D=new ms.c;return D.indices=E,D.bs=j,D.ts=P,D.Cs=R,D}function H(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return K(k).Ys(A,k.updatable),A}ms.c.CreateSphere=K,g.e.CreateSphere=(s,k,h,A,g,ms)=>H(s,{segments:k,diameterX:h,diameterY:h,diameterZ:h,sideOrientation:ms,updatable:g},A)},14799:(s,k,h)=>{"use strict";h.d(k,{b:()=>K});var A=h(13179),g=h(14282),ms=h(13194),i=h(13047);class K{static get Configuration(){return{get decoder(){return g.e.DefaultConfiguration},set decoder(s){g.e.DefaultConfiguration=s}}}static set Configuration(s){g.e.DefaultConfiguration=s.decoder}static get DecoderAvailable(){return(0,A.h)(g.e.DefaultConfiguration)}static get Default(){return K._Default??(K._Default=new K),K._Default}static ResetDefault(s){K._Default&&(s||K._Default.dispose(),K._Default=null)}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.DefaultNumWorkers;const k="number"===typeof s?{...g.e.DefaultConfiguration,numWorkers:s}:{...g.e.DefaultConfiguration,...s};this._decoder=new g.e(k)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(s,k,h){return this._decoder.decodeMeshToMeshDataAsync(s,k,h)}async decodeMeshToGeometryAsync(s,k,h,A){return await this._decoder.decodeMeshToGeometryAsync(s,k,h,A)}async _decodeMeshToGeometryForGltfAsync(s,k,h,A,g,ms){return await this._decoder._decodeMeshToGeometryForGltfAsync(s,k,h,A,g,ms)}async decodeMeshAsync(s,k){const h=await this._decoder.decodeMeshToMeshDataAsync(s,k),A=new i.c;h.indices&&(A.indices=h.indices);for(const g of h.attributes){const s=ms.d.GetFloatData(g.data,g.size,ms.d.GetDataType(g.data),g.byteOffset,g.byteStride,g.normalized,h.totalVertices);A.set(s,g.kind)}return A}}K.DefaultNumWorkers=(0,A.d)(),K._Default=null},14282:(s,k,h)=>{"use strict";h.d(k,{e:()=>O});var A=h(13179),g=h(12402),ms=h(13076),i=h(13194),K=h(12422),H=h(13186);class O extends A.c{static get DefaultAvailable(){return(0,A.h)(O.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(s){O._Default&&(s||O._Default.dispose(),O._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(s,k){return{module:await(k||DracoDecoderModule)({wasmBinary:s})}}_getWorkerContent(){return`${H.d}(${H.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultConfiguration)}decodeMeshToMeshDataAsync(s,k,h){const A=s instanceof ArrayBuffer?new Int8Array(s):new Int8Array(s.buffer,s.byteOffset,s.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async s=>await new Promise(((g,ms)=>{s.push(((s,i)=>{let H=null;const O=[],c=k=>{s.removeEventListener("error",c),s.removeEventListener("message",S),ms(k),i()},S=k=>{const A=k.data;switch(A.id){case"indices":H=A.data;break;case"attribute":O.push({kind:A.kind,data:A.data,size:A.size,byteOffset:A.byteOffset,byteStride:A.byteStride,normalized:(ms=A.kind,a=A.normalized,h&&void 0!==h[ms]?(a!==h[ms]&&K.c.Warn(`Normalized flag from Draco data (${a}) does not match normalized flag from glTF accessor (${h[ms]}). Using flag from glTF accessor.`),h[ms]):a)});break;case"decodeMeshDone":s.removeEventListener("error",c),s.removeEventListener("message",S),g({indices:H,attributes:O,totalVertices:A.totalVertices}),i()}var ms,a};s.addEventListener("error",c),s.addEventListener("message",S);const a=A.slice();s.postMessage({id:"decodeMesh",dataView:a,attributes:k},[a.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((s=>{let h=null;const g=[],ms=(0,H.d)(s.module,A,k,(s=>{h=s}),((s,k,h,A,ms,i)=>{g.push({kind:s,data:k,size:h,byteOffset:A,byteStride:ms,normalized:i})}));return{indices:h,attributes:g,totalVertices:ms}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(s,k,h,A){const g=await this.decodeMeshToMeshDataAsync(h,A),K=new ms.c(s,k);g.indices&&K.setIndices(g.indices);for(const ms of g.attributes)K.setVerticesBuffer(new i.d(k.getEngine(),ms.data,ms.kind,!1,void 0,ms.byteStride,void 0,ms.byteOffset,ms.size,void 0,ms.normalized,!0),g.totalVertices);return K}async _decodeMeshToGeometryForGltfAsync(s,k,h,A,g,K){const H=await this.decodeMeshToMeshDataAsync(h,A,g),O=new ms.c(s,k);K&&(O._boundingInfo=K,O.useBoundingInfoFromGeometry=!0),H.indices&&O.setIndices(H.indices);for(const ms of H.attributes)O.setVerticesBuffer(new i.d(k.getEngine(),ms.data,ms.kind,!1,void 0,ms.byteStride,void 0,ms.byteOffset,ms.size,void 0,ms.normalized,!0),H.totalVertices);return O}}O.DefaultConfiguration={wasmUrl:`${g.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${g.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${g.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},O._Default=null},14471:(s,k,h)=>{"use strict";h.d(k,{e:()=>Ks});var A=h(12590),g=h(13061),ms=h(12664),i=h(13047),K=h(12651);function H(s){let k=s.pathArray;const h=s.closeArray||!1,A=s.closePath||!1,g=s.invertUV||!1,H=Math.floor(k[0].length/2);let O=s.offset||H;O=O>H?H:Math.floor(O);const c=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,S=s.Cs,a=s.zs,r=[],d=[],E=[],j=[],P=[],R=[],D=[],w=[];let B;const u=[],G=[];let Q,p,I;if(k.length<2){const s=[],h=[];for(p=0;p<k[0].length-O;p++)s.push(k[0][p]),h.push(k[0][p+O]);k=[s,h]}let N=0;const b=A?1:0,t=h?1:0;let z,C,v,Y,n,T;for(B=k[0].length,Q=0;Q<k.length+t;Q++){for(D[Q]=0,P[Q]=[0],z=Q===k.length?k[0]:k[Q],C=z.length,B=B<C?B:C,I=0;I<C;)r.push(z[I].x,z[I].y,z[I].z),I>0&&(v=z[I].Rk(z[I-1]).length(),Y=v+D[Q],P[Q].push(Y),D[Q]=Y),I++;A&&(I--,r.push(z[0].x,z[0].y,z[0].z),v=z[I].Rk(z[0]).length(),Y=v+D[Q],P[Q].push(Y),D[Q]=Y),u[Q]=C+b,G[Q]=N,N+=C+b}let U,q,M=null,V=null;for(p=0;p<B+b;p++)for(w[p]=0,R[p]=[0],Q=0;Q<k.length-1+t;Q++)n=k[Q],T=Q===k.length-1?k[0]:k[Q+1],p===B?(M=n[0],V=T[0]):(M=n[p],V=T[p]),v=V.Rk(M).length(),Y=v+w[p],R[p].push(Y),w[p]=Y;if(S)for(Q=0;Q<S.length;Q++)j.push(S[Q].x,K.d?1-S[Q].y:S[Q].y);else for(Q=0;Q<k.length+t;Q++)for(p=0;p<B+b;p++)U=0!=D[Q]?P[Q][p]/D[Q]:0,q=0!=w[p]?R[p][Q]/w[p]:0,g?j.push(q,U):j.push(U,K.d?1-q:q);Q=0;let X=0,L=u[Q]-1,Z=u[Q+1]-1,x=L<Z?L:Z,y=G[1]-G[0];const W=u.length-1;for(;X<=x&&Q<W;)d.push(X,X+y,X+1),d.push(X+y+1,X+1,X+y),X+=1,X===x&&(Q++,y=G[Q+1]-G[Q],L=u[Q]-1,Z=u[Q+1]-1,X=G[Q],x=L<Z?L+X:Z+X);if(i.c.ComputeNormals(r,d,E),A){let s=0,h=0;for(Q=0;Q<k.length;Q++){s=3*G[Q],h=Q+1<k.length?3*(G[Q+1]-1):E.length-3,E[s]=.5*(E[s]+E[h]),E[s+1]=.5*(E[s+1]+E[h+1]),E[s+2]=.5*(E[s+2]+E[h+2]);const A=Math.sqrt(E[s]*E[s]+E[s+1]*E[s+1]+E[s+2]*E[s+2]);E[s]/=A,E[s+1]/=A,E[s+2]/=A,E[h]=E[s],E[h+1]=E[s+1],E[h+2]=E[s+2]}}if(h){let s=3*G[0],h=3*G[k.length];for(p=0;p<B+b;p++){E[s]=.5*(E[s]+E[h]),E[s+1]=.5*(E[s+1]+E[h+1]),E[s+2]=.5*(E[s+2]+E[h+2]);const k=Math.sqrt(E[s]*E[s]+E[s+1]*E[s+1]+E[s+2]*E[s+2]);E[s]/=k,E[s+1]/=k,E[s+2]/=k,E[h]=E[s],E[h+1]=E[s+1],E[h+2]=E[s+2],s+=3,h+=3}}i.c._ComputeSides(c,r,d,E,j,s.frontUVs,s.backUVs);let J=null;if(a){J=new Float32Array(4*a.length);for(let s=0;s<a.length;s++)J[4*s]=a[s].r,J[4*s+1]=a[s].g,J[4*s+2]=a[s].b,J[4*s+3]=a[s].a}const F=new i.c,o=new Float32Array(r),l=new Float32Array(E),f=new Float32Array(j);return F.indices=d,F.bs=o,F.ts=l,F.Cs=f,J&&F.set(J,ms.e.ColorKind),A&&(F._idx=G),F}function O(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=k.pathArray,c=k.closeArray,S=k.closePath,a=g.e._GetDefaultSideOrientation(k.sideOrientation),r=k.instance,d=k.updatable;if(r){const s=A.TmpVectors.Pk[0].Eg(Number.MAX_VALUE),h=A.TmpVectors.Pk[1].Eg(-Number.MAX_VALUE),H=k=>{let A=O[0].length;const ms=r;let i=0;const K=ms._originalBuilderSideOrientation===g.e.DOUBLESIDE?2:1;for(let g=1;g<=K;++g)for(let K=0;K<O.length;++K){const g=O[K],H=g.length;A=A<H?A:H;for(let ms=0;ms<A;++ms){const A=g[ms];k[i]=A.x,k[i+1]=A.y,k[i+2]=A.z,s.minimizeInPlaceFromFloats(A.x,A.y,A.z),h.maximizeInPlaceFromFloats(A.x,A.y,A.z),i+=3}if(ms._creationDataStorage&&ms._creationDataStorage.closePath){const s=g[0];k[i]=s.x,k[i+1]=s.y,k[i+2]=s.z,i+=3}}},c=r.getVerticesData(ms.e.PositionKind);if(H(c),r.hasBoundingInfo?r.getBoundingInfo().reConstruct(s,h,r._worldMatrix):r.buildBoundingInfo(s,h,r._worldMatrix),r.updateVerticesData(ms.e.PositionKind,c,!1,!1),k.zs){const s=r.getVerticesData(ms.e.ColorKind);for(let h=0,A=0;h<k.zs.length;h++,A+=4){const g=k.zs[h];s[A]=g.r,s[A+1]=g.g,s[A+2]=g.b,s[A+3]=g.a}r.updateVerticesData(ms.e.ColorKind,s,!1,!1)}if(k.Cs){const s=r.getVerticesData(ms.e.UVKind);for(let h=0;h<k.Cs.length;h++)s[2*h]=k.Cs[h].x,s[2*h+1]=K.d?1-k.Cs[h].y:k.Cs[h].y;r.updateVerticesData(ms.e.UVKind,s,!1,!1)}if(!r.areNormalsFrozen||r.isFacetDataEnabled){const s=r.sg(),k=r.getVerticesData(ms.e.NormalKind),h=r.isFacetDataEnabled?r.getFacetDataParameters():null;if(i.c.ComputeNormals(c,s,k,h),r._creationDataStorage&&r._creationDataStorage.closePath){let s=0,h=0;for(let A=0;A<O.length;A++)s=3*r._creationDataStorage.idx[A],h=A+1<O.length?3*(r._creationDataStorage.idx[A+1]-1):k.length-3,k[s]=.5*(k[s]+k[h]),k[s+1]=.5*(k[s+1]+k[h+1]),k[s+2]=.5*(k[s+2]+k[h+2]),k[h]=k[s],k[h+1]=k[s+1],k[h+2]=k[s+2]}r.areNormalsFrozen||r.updateVerticesData(ms.e.NormalKind,k,!1,!1)}return r}{const A=new g.e(s,h);A._originalBuilderSideOrientation=a,A._creationDataStorage=new g.g;const ms=H(k);return S&&(A._creationDataStorage.idx=ms._idx),A._creationDataStorage.closePath=S,A._creationDataStorage.closeArray=c,ms.Ys(A,d),A}}i.c.CreateRibbon=H,g.e.CreateRibbon=function(s,k){return O(s,{pathArray:k,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var c=h(13983),S=h(13835),a=h(12636);function r(s){const k=s.pattern||g.e.NO_FLIP,h=s.tileWidth||s.tileSize||1,A=s.tileHeight||s.tileSize||1,ms=s.alignHorizontal||0,K=s.alignVertical||0,H=s.width||s.size||1,O=Math.floor(H/h);let c=H-O*h;const S=s.height||s.size||1,a=Math.floor(S/A);let r=S-a*A;const d=h*O/2,E=A*a/2;let j=0,P=0,R=0,D=0,w=0,B=0;if(c>0||r>0){switch(R=-d,D=-E,w=d,B=E,ms){case g.e.CENTER:c/=2,R-=c,w+=c;break;case g.e.LEFT:w+=c,j=-c/2;break;case g.e.RIGHT:R-=c,j=c/2}switch(K){case g.e.CENTER:r/=2,D-=r,B+=r;break;case g.e.BOTTOM:B+=r,P=-r/2;break;case g.e.TOP:D-=r,P=r/2}}const u=[],G=[],Q=[];Q[0]=[0,0,1,0,1,1,0,1],Q[1]=[0,0,1,0,1,1,0,1],k!==g.e.ROTATE_TILE&&k!==g.e.ROTATE_ROW||(Q[1]=[1,1,0,1,0,0,1,0]),k!==g.e.FLIP_TILE&&k!==g.e.FLIP_ROW||(Q[1]=[1,0,0,0,0,1,1,1]),k!==g.e.FLIP_N_ROTATE_TILE&&k!==g.e.FLIP_N_ROTATE_ROW||(Q[1]=[0,1,1,1,1,0,0,0]);let p=[];const I=[],N=[];let b=0;for(let i=0;i<a;i++)for(let s=0;s<O;s++)u.push(s*h-d+j,i*A-E+P,0),u.push((s+1)*h-d+j,i*A-E+P,0),u.push((s+1)*h-d+j,(i+1)*A-E+P,0),u.push(s*h-d+j,(i+1)*A-E+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),p=k===g.e.FLIP_TILE||k===g.e.ROTATE_TILE||k===g.e.FLIP_N_ROTATE_TILE?p.concat(Q[(s%2+i%2)%2]):k===g.e.FLIP_ROW||k===g.e.ROTATE_ROW||k===g.e.FLIP_N_ROTATE_ROW?p.concat(Q[i%2]):p.concat(Q[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),b+=4;if(c>0||r>0){const s=r>0&&(K===g.e.CENTER||K===g.e.TOP),i=r>0&&(K===g.e.CENTER||K===g.e.BOTTOM),H=c>0&&(ms===g.e.CENTER||ms===g.e.RIGHT),S=c>0&&(ms===g.e.CENTER||ms===g.e.LEFT);let Q,t,z,C,v=[];if(s&&H&&(u.push(R+j,D+P,0),u.push(-d+j,D+P,0),u.push(-d+j,D+r+P,0),u.push(R+j,D+r+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,Q=1-c/h,t=1-r/A,z=1,C=1,v=[Q,t,z,t,z,C,Q,C],k===g.e.ROTATE_ROW&&(v=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),k===g.e.FLIP_ROW&&(v=[1-Q,t,1-z,t,1-z,C,1-Q,C]),k===g.e.FLIP_N_ROTATE_ROW&&(v=[Q,1-t,z,1-t,z,1-C,Q,1-C]),p=p.concat(v),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),s&&S&&(u.push(d+j,D+P,0),u.push(w+j,D+P,0),u.push(w+j,D+r+P,0),u.push(d+j,D+r+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,Q=0,t=1-r/A,z=c/h,C=1,v=[Q,t,z,t,z,C,Q,C],(k===g.e.ROTATE_ROW||k===g.e.ROTATE_TILE&&O%2===0)&&(v=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),(k===g.e.FLIP_ROW||k===g.e.FLIP_TILE&&O%2===0)&&(v=[1-Q,t,1-z,t,1-z,C,1-Q,C]),(k===g.e.FLIP_N_ROTATE_ROW||k===g.e.FLIP_N_ROTATE_TILE&&O%2===0)&&(v=[Q,1-t,z,1-t,z,1-C,Q,1-C]),p=p.concat(v),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&H&&(u.push(R+j,E+P,0),u.push(-d+j,E+P,0),u.push(-d+j,B+P,0),u.push(R+j,B+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,Q=1-c/h,t=0,z=1,C=r/A,v=[Q,t,z,t,z,C,Q,C],(k===g.e.ROTATE_ROW&&a%2===1||k===g.e.ROTATE_TILE&&a%1===0)&&(v=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),(k===g.e.FLIP_ROW&&a%2===1||k===g.e.FLIP_TILE&&a%2===0)&&(v=[1-Q,t,1-z,t,1-z,C,1-Q,C]),(k===g.e.FLIP_N_ROTATE_ROW&&a%2===1||k===g.e.FLIP_N_ROTATE_TILE&&a%2===0)&&(v=[Q,1-t,z,1-t,z,1-C,Q,1-C]),p=p.concat(v),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&S&&(u.push(d+j,E+P,0),u.push(w+j,E+P,0),u.push(w+j,B+P,0),u.push(d+j,B+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,Q=0,t=0,z=c/h,C=r/A,v=[Q,t,z,t,z,C,Q,C],(k===g.e.ROTATE_ROW&&a%2===1||k===g.e.ROTATE_TILE&&(a+O)%2===1)&&(v=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),(k===g.e.FLIP_ROW&&a%2===1||k===g.e.FLIP_TILE&&(a+O)%2===1)&&(v=[1-Q,t,1-z,t,1-z,C,1-Q,C]),(k===g.e.FLIP_N_ROTATE_ROW&&a%2===1||k===g.e.FLIP_N_ROTATE_TILE&&(a+O)%2===1)&&(v=[Q,1-t,z,1-t,z,1-C,Q,1-C]),p=p.concat(v),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),s){const s=[];Q=0,t=1-r/A,z=1,C=1,s[0]=[Q,t,z,t,z,C,Q,C],s[1]=[Q,t,z,t,z,C,Q,C],k!==g.e.ROTATE_TILE&&k!==g.e.ROTATE_ROW||(s[1]=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),k!==g.e.FLIP_TILE&&k!==g.e.FLIP_ROW||(s[1]=[1-Q,t,1-z,t,1-z,C,1-Q,C]),k!==g.e.FLIP_N_ROTATE_TILE&&k!==g.e.FLIP_N_ROTATE_ROW||(s[1]=[Q,1-t,z,1-t,z,1-C,Q,1-C]);for(let A=0;A<O;A++)u.push(A*h-d+j,D+P,0),u.push((A+1)*h-d+j,D+P,0),u.push((A+1)*h-d+j,D+r+P,0),u.push(A*h-d+j,D+r+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,p=k===g.e.FLIP_TILE||k===g.e.ROTATE_TILE||k===g.e.FLIP_N_ROTATE_TILE?p.concat(s[(A+1)%2]):k===g.e.FLIP_ROW||k===g.e.ROTATE_ROW||k===g.e.FLIP_N_ROTATE_ROW?p.concat(s[1]):p.concat(s[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(i){const s=[];Q=0,t=0,z=1,C=r/A,s[0]=[Q,t,z,t,z,C,Q,C],s[1]=[Q,t,z,t,z,C,Q,C],k!==g.e.ROTATE_TILE&&k!==g.e.ROTATE_ROW||(s[1]=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),k!==g.e.FLIP_TILE&&k!==g.e.FLIP_ROW||(s[1]=[1-Q,t,1-z,t,1-z,C,1-Q,C]),k!==g.e.FLIP_N_ROTATE_TILE&&k!==g.e.FLIP_N_ROTATE_ROW||(s[1]=[Q,1-t,z,1-t,z,1-C,Q,1-C]);for(let A=0;A<O;A++)u.push(A*h-d+j,B-r+P,0),u.push((A+1)*h-d+j,B-r+P,0),u.push((A+1)*h-d+j,B+P,0),u.push(A*h-d+j,B+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,p=k===g.e.FLIP_TILE||k===g.e.ROTATE_TILE||k===g.e.FLIP_N_ROTATE_TILE?p.concat(s[(A+a)%2]):k===g.e.FLIP_ROW||k===g.e.ROTATE_ROW||k===g.e.FLIP_N_ROTATE_ROW?p.concat(s[a%2]):p.concat(s[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const s=[];Q=1-c/h,t=0,z=1,C=1,s[0]=[Q,t,z,t,z,C,Q,C],s[1]=[Q,t,z,t,z,C,Q,C],k!==g.e.ROTATE_TILE&&k!==g.e.ROTATE_ROW||(s[1]=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),k!==g.e.FLIP_TILE&&k!==g.e.FLIP_ROW||(s[1]=[1-Q,t,1-z,t,1-z,C,1-Q,C]),k!==g.e.FLIP_N_ROTATE_TILE&&k!==g.e.FLIP_N_ROTATE_ROW||(s[1]=[Q,1-t,z,1-t,z,1-C,Q,1-C]);for(let h=0;h<a;h++)u.push(R+j,h*A-E+P,0),u.push(R+c+j,h*A-E+P,0),u.push(R+c+j,(h+1)*A-E+P,0),u.push(R+j,(h+1)*A-E+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,p=k===g.e.FLIP_TILE||k===g.e.ROTATE_TILE||k===g.e.FLIP_N_ROTATE_TILE?p.concat(s[(h+1)%2]):k===g.e.FLIP_ROW||k===g.e.ROTATE_ROW||k===g.e.FLIP_N_ROTATE_ROW?p.concat(s[h%2]):p.concat(s[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const s=[];Q=0,t=0,z=c/A,C=1,s[0]=[Q,t,z,t,z,C,Q,C],s[1]=[Q,t,z,t,z,C,Q,C],k!==g.e.ROTATE_TILE&&k!==g.e.ROTATE_ROW||(s[1]=[1-Q,1-t,1-z,1-t,1-z,1-C,1-Q,1-C]),k!==g.e.FLIP_TILE&&k!==g.e.FLIP_ROW||(s[1]=[1-Q,t,1-z,t,1-z,C,1-Q,C]),k!==g.e.FLIP_N_ROTATE_TILE&&k!==g.e.FLIP_N_ROTATE_ROW||(s[1]=[Q,1-t,z,1-t,z,1-C,Q,1-C]);for(let h=0;h<a;h++)u.push(w-c+j,h*A-E+P,0),u.push(w+j,h*A-E+P,0),u.push(w+j,(h+1)*A-E+P,0),u.push(w-c+j,(h+1)*A-E+P,0),N.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,p=k===g.e.FLIP_TILE||k===g.e.ROTATE_TILE||k===g.e.FLIP_N_ROTATE_TILE?p.concat(s[(h+O)%2]):k===g.e.FLIP_ROW||k===g.e.ROTATE_ROW||k===g.e.FLIP_N_ROTATE_ROW?p.concat(s[h%2]):p.concat(s[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const t=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE;i.c._ComputeSides(t,u,N,G,p,s.frontUVs,s.backUVs);const z=new i.c;z.indices=N,z.bs=u,z.ts=G,z.Cs=p;const C=t===i.c.DOUBLESIDE?I.concat(I):I;return z.zs=C,z}function d(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return r(k).Ys(A,k.updatable),A}function E(s){const k=s.faceUV||new Array(6),h=s.faceColors,ms=s.pattern||g.e.NO_FLIP,H=s.width||s.size||1,O=s.height||s.size||1,c=s.depth||s.size||1,S=s.tileWidth||s.tileSize||1,d=s.tileHeight||s.tileSize||1,E=s.alignHorizontal||0,j=s.alignVertical||0,P=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE;for(let g=0;g<6;g++)void 0===k[g]&&(k[g]=new A.Vector4(0,0,1,1)),h&&void 0===h[g]&&(h[g]=new a.jg(1,1,1,1));const R=H/2,D=O/2,w=c/2,B=[];for(let A=0;A<2;A++)B[A]=r({pattern:ms,tileWidth:S,tileHeight:d,width:H,height:O,alignVertical:j,alignHorizontal:E,sideOrientation:P});for(let A=2;A<4;A++)B[A]=r({pattern:ms,tileWidth:S,tileHeight:d,width:c,height:O,alignVertical:j,alignHorizontal:E,sideOrientation:P});let u=j;j===g.e.BOTTOM?u=g.e.TOP:j===g.e.TOP&&(u=g.e.BOTTOM);for(let A=4;A<6;A++)B[A]=r({pattern:ms,tileWidth:S,tileHeight:d,width:H,height:c,alignVertical:u,alignHorizontal:E,sideOrientation:P});let G=[],Q=[],p=[],I=[];const N=[],b=[],t=[],z=[];let C=0,v=0;for(let g=0;g<6;g++){const s=B[g].bs.length;b[g]=[],t[g]=[];for(let k=0;k<s/3;k++)b[g].push(new A.Pk(B[g].bs[3*k],B[g].bs[3*k+1],B[g].bs[3*k+2])),t[g].push(new A.Pk(B[g].ts[3*k],B[g].ts[3*k+1],B[g].ts[3*k+2]));C=B[g].Cs.length,z[g]=[];for(let h=0;h<C;h+=2)z[g][h]=k[g].x+(k[g].z-k[g].x)*B[g].Cs[h],z[g][h+1]=k[g].y+(k[g].w-k[g].y)*B[g].Cs[h+1],K.d&&(z[g][h+1]=1-z[g][h+1]);if(p=p.concat(z[g]),I=I.concat(B[g].indices.map((s=>s+v))),v+=b[g].length,h)for(let k=0;k<4;k++)N.push(h[g].r,h[g].g,h[g].b,h[g].a)}const Y=new A.Pk(0,0,w),n=A.Matrix.RotationY(Math.PI);G=b[0].map((s=>A.Pk.TransformNormal(s,n).add(Y))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[]),Q=t[0].map((s=>A.Pk.TransformNormal(s,n))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[]),G=G.concat(b[1].map((s=>s.Rk(Y))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[])),Q=Q.concat(t[1].map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[]));const T=new A.Pk(R,0,0),U=A.Matrix.RotationY(-Math.PI/2);G=G.concat(b[2].map((s=>A.Pk.TransformNormal(s,U).add(T))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[])),Q=Q.concat(t[2].map((s=>A.Pk.TransformNormal(s,U))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[]));const q=A.Matrix.RotationY(Math.PI/2);G=G.concat(b[3].map((s=>A.Pk.TransformNormal(s,q).Rk(T))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[])),Q=Q.concat(t[3].map((s=>A.Pk.TransformNormal(s,q))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[]));const M=new A.Pk(0,D,0),V=A.Matrix.RotationX(Math.PI/2);G=G.concat(b[4].map((s=>A.Pk.TransformNormal(s,V).add(M))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[])),Q=Q.concat(t[4].map((s=>A.Pk.TransformNormal(s,V))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[]));const X=A.Matrix.RotationX(-Math.PI/2);G=G.concat(b[5].map((s=>A.Pk.TransformNormal(s,X).Rk(M))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[])),Q=Q.concat(t[5].map((s=>A.Pk.TransformNormal(s,X))).map((s=>[s.x,s.y,s.z])).reduce(((s,k)=>s.concat(k)),[])),i.c._ComputeSides(P,G,I,Q,p);const L=new i.c;if(L.indices=I,L.bs=G,L.ts=Q,L.Cs=p,h){const s=P===i.c.DOUBLESIDE?N.concat(N):N;L.zs=s}return L}function j(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return E(k).Ys(A,k.updatable),A}i.c.CreateTiledPlane=r;i.c.CreateTiledBox=E;var P=h(13973),R=h(12836),D=h(12794);function w(s){const k=s.height||2;let h=0===s.diameterTop?0:s.diameterTop||s.diameter||1,ms=0===s.diameterBottom?0:s.diameterBottom||s.diameter||1;h=h||1e-5,ms=ms||1e-5;const H=0|(s.tessellation||24),O=0|(s.subdivisions||1),c=!!s.hasRings,S=!!s.enclose,r=0===s.cap?0:s.cap||g.e.CAP_ALL,d=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,E=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,j=s.faceUV||new Array(3),P=s.faceColors,R=2+(1+(1!==d&&S?2:0))*(c?O:1);let w;for(w=0;w<R;w++)P&&void 0===P[w]&&(P[w]=new a.jg(1,1,1,1));for(w=0;w<R;w++)j&&void 0===j[w]&&(j[w]=new A.Vector4(0,0,1,1));const B=[],u=[],G=[],Q=[],p=[],I=2*Math.PI*d/H;let N,b,t;const z=(ms-h)/2/k,C=A.Pk.Zero(),v=A.Pk.Zero(),Y=A.Pk.Zero(),n=A.Pk.Zero(),T=A.Pk.Zero(),U=D.d.Y;let q,M,V,X=1,L=1,Z=0,x=0;for(q=0;q<=O;q++)for(b=q/O,t=(b*(h-ms)+ms)/2,X=c&&0!==q&&q!==O?2:1,V=0;V<X;V++){for(c&&(L+=V),S&&(L+=2*V),M=0;M<=H;M++)N=M*I,C.x=Math.cos(-N)*t,C.y=-k/2+b*k,C.z=Math.sin(-N)*t,0===h&&q===O?(v.x=G[G.length-3*(H+1)],v.y=G[G.length-3*(H+1)+1],v.z=G[G.length-3*(H+1)+2]):(v.x=C.x,v.z=C.z,v.y=Math.sqrt(v.x*v.x+v.z*v.z)*z,v.normalize()),0===M&&(Y.H(C),n.H(v)),u.push(C.x,C.y,C.z),G.push(v.x,v.y,v.z),x=c?Z!==L?j[L].y:j[L].w:j[L].y+(j[L].w-j[L].y)*b,Q.push(j[L].x+(j[L].z-j[L].x)*M/H,K.d?1-x:x),P&&p.push(P[L].r,P[L].g,P[L].b,P[L].a);1!==d&&S&&(u.push(C.x,C.y,C.z),u.push(0,C.y,0),u.push(0,C.y,0),u.push(Y.x,Y.y,Y.z),A.Pk.CrossToRef(U,v,T),T.normalize(),G.push(T.x,T.y,T.z,T.x,T.y,T.z),A.Pk.CrossToRef(n,U,T),T.normalize(),G.push(T.x,T.y,T.z,T.x,T.y,T.z),x=c?Z!==L?j[L+1].y:j[L+1].w:j[L+1].y+(j[L+1].w-j[L+1].y)*b,Q.push(j[L+1].x,K.d?1-x:x),Q.push(j[L+1].z,K.d?1-x:x),x=c?Z!==L?j[L+2].y:j[L+2].w:j[L+2].y+(j[L+2].w-j[L+2].y)*b,Q.push(j[L+2].x,K.d?1-x:x),Q.push(j[L+2].z,K.d?1-x:x),P&&(p.push(P[L+1].r,P[L+1].g,P[L+1].b,P[L+1].a),p.push(P[L+1].r,P[L+1].g,P[L+1].b,P[L+1].a),p.push(P[L+2].r,P[L+2].g,P[L+2].b,P[L+2].a),p.push(P[L+2].r,P[L+2].g,P[L+2].b,P[L+2].a))),Z!==L&&(Z=L)}const y=1!==d&&S?H+4:H;for(q=0,L=0;L<O;L++){let s=0,k=0,h=0,A=0;for(M=0;M<H;M++)s=q*(y+1)+M,k=(q+1)*(y+1)+M,h=q*(y+1)+(M+1),A=(q+1)*(y+1)+(M+1),B.push(s,k,h),B.push(A,h,k);1!==d&&S&&(B.push(s+2,k+2,h+2),B.push(A+2,h+2,k+2),B.push(s+4,k+4,h+4),B.push(A+4,h+4,k+4)),q=c?q+2:q+1}const W=s=>{const g=s?h/2:ms/2;if(0===g)return;let i,O,c;const S=s?j[R-1]:j[0];let a=null;P&&(a=s?P[R-1]:P[0]);const r=u.length/3,E=s?k/2:-k/2,D=new A.Pk(0,E,0);u.push(D.x,D.y,D.z),G.push(0,s?1:-1,0);const w=S.y+.5*(S.w-S.y);Q.push(S.x+.5*(S.z-S.x),K.d?1-w:w),a&&p.push(a.r,a.g,a.b,a.a);const I=new A.Vector2(.5,.5);for(c=0;c<=H;c++){i=2*Math.PI*c*d/H;const k=Math.cos(-i),h=Math.sin(-i);O=new A.Pk(k*g,E,h*g);const ms=new A.Vector2(k*I.x+.5,h*I.y+.5);u.push(O.x,O.y,O.z),G.push(0,s?1:-1,0);const r=S.y+(S.w-S.y)*ms.y;Q.push(S.x+(S.z-S.x)*ms.x,K.d?1-r:r),a&&p.push(a.r,a.g,a.b,a.a)}for(c=0;c<H;c++)s?(B.push(r),B.push(r+(c+2)),B.push(r+(c+1))):(B.push(r),B.push(r+(c+1)),B.push(r+(c+2)))};r!==g.e.CAP_START&&r!==g.e.CAP_ALL||W(!1),r!==g.e.CAP_END&&r!==g.e.CAP_ALL||W(!0),i.c._ComputeSides(E,u,B,G,Q,s.frontUVs,s.backUVs);const J=new i.c;return J.indices=B,J.bs=u,J.ts=G,J.Cs=Q,P&&(J.zs=p),J}function B(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return w(k).Ys(A,k.updatable),A}function u(s){const k=[],h=[],g=[],ms=[],H=s.diameter||1,O=s.thickness||.5,c=0|(s.tessellation||16),S=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,a=c+1;for(let i=0;i<=c;i++){const s=i/c,S=i*Math.PI*2/c-Math.PI/2,r=A.Matrix.Translation(H/2,0,0).multiply(A.Matrix.RotationY(S));for(let H=0;H<=c;H++){const S=1-H/c,d=H*Math.PI*2/c+Math.PI,E=Math.cos(d),j=Math.sin(d);let P=new A.Pk(E,j,0),R=P.scale(O/2);const D=new A.Vector2(s,S);R=A.Pk.TransformCoordinates(R,r),P=A.Pk.TransformNormal(P,r),h.push(R.x,R.y,R.z),g.push(P.x,P.y,P.z),ms.push(D.x,K.d?1-D.y:D.y);const w=(i+1)%a,B=(H+1)%a;k.push(i*a+H),k.push(i*a+B),k.push(w*a+H),k.push(i*a+B),k.push(w*a+B),k.push(w*a+H)}}i.c._ComputeSides(S,h,k,g,ms,s.frontUVs,s.backUVs);const r=new i.c;return r.indices=k,r.bs=h,r.ts=g,r.Cs=ms,r}function G(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return u(k).Ys(A,k.updatable),A}i.c.CreateCylinder=w,g.e.CreateCylinder=(s,k,h,A,ms,i,K,H,O)=>{void 0!==K&&K instanceof R.d||(void 0!==K&&(O=H||g.e.DEFAULTSIDE,H=K),K=i,i=1);return B(s,{height:k,diameterTop:h,diameterBottom:A,tessellation:ms,subdivisions:i,sideOrientation:O,updatable:H},K)};function Q(s){const k=[],h=[],g=[],ms=[],H=s.radius||2,O=s.tube||.5,c=s.radialSegments||32,S=s.tubularSegments||32,a=s.p||2,r=s.q||3,d=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,E=s=>{const k=Math.cos(s),h=Math.sin(s),g=r/a*s,ms=Math.cos(g),i=H*(2+ms)*.5*k,K=H*(2+ms)*h*.5,O=H*Math.sin(g)*.5;return new A.Pk(i,K,O)};let j,P;for(j=0;j<=c;j++){const s=j%c/c*2*a*Math.PI,k=E(s),g=E(s+.01),i=g.Rk(k);let H=g.add(k);const r=A.Pk.Cross(i,H);for(H=A.Pk.Cross(r,i),r.normalize(),H.normalize(),P=0;P<S;P++){const s=P%S/S*2*Math.PI,A=-O*Math.cos(s),g=O*Math.sin(s);h.push(k.x+A*H.x+g*r.x),h.push(k.y+A*H.y+g*r.y),h.push(k.z+A*H.z+g*r.z),ms.push(j/c),ms.push(K.d?1-P/S:P/S)}}for(j=0;j<c;j++)for(P=0;P<S;P++){const s=(P+1)%S,h=j*S+P,A=(j+1)*S+P,g=(j+1)*S+s,ms=j*S+s;k.push(ms),k.push(A),k.push(h),k.push(ms),k.push(g),k.push(A)}i.c.ComputeNormals(h,k,g),i.c._ComputeSides(d,h,k,g,ms,s.frontUVs,s.backUVs);const R=new i.c;return R.indices=k,R.bs=h,R.ts=g,R.Cs=ms,R}function p(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return Q(k).Ys(A,k.updatable),A}i.c.CreateTorus=u,g.e.CreateTorus=(s,k,h,A,g,ms,i)=>G(s,{diameter:k,thickness:h,tessellation:A,sideOrientation:i,updatable:ms},g);i.c.CreateTorusKnot=Q,g.e.CreateTorusKnot=(s,k,h,A,g,ms,i,K,H,O)=>p(s,{radius:k,tube:h,radialSegments:A,tubularSegments:g,p:ms,q:i,sideOrientation:O,updatable:H},K);var I=h(14479),N=h(13167),b=h(12802);function t(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=k.path,ms=k.shape,i=k.scale||1,K=k.rotation||0,H=0===k.cap?0:k.cap||g.e.NO_CAP,O=k.updatable,c=g.e._GetDefaultSideOrientation(k.sideOrientation),S=k.instance||null,a=k.invertUV||!1,r=k.closeShape||!1,d=k.closePath||!1,E=k.capFunction||null;return C(s,ms,A,i,K,null,null,d,r,H,!1,h,!!O,c,S,a,k.frontUVs||null,k.backUVs||null,k.firstNormal||null,!!k.adjustFrame,E)}function z(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=k.path,ms=k.shape,i=k.scaleFunction||(()=>1),K=k.rotationFunction||(()=>0),H=k.closePath||k.ribbonCloseArray||!1,O=k.closeShape||k.ribbonClosePath||!1,c=0===k.cap?0:k.cap||g.e.NO_CAP,S=k.updatable,a=k.firstNormal||null,r=k.adjustFrame||!1,d=g.e._GetDefaultSideOrientation(k.sideOrientation),E=k.instance,j=k.invertUV||!1,P=k.capFunction||null;return C(s,ms,A,null,null,i,K,H,O,c,!0,h,!!S,d,E||null,j,k.frontUVs||null,k.backUVs||null,a,r,P||null)}function C(s,k,h,ms,i,K,H,c,S,a,r,d,E,j,P,R,D,w,B,u,G){const Q=(s,k,h,ms,i,K,H,O,c,S,a)=>{const r=h.getTangents(),d=h.getNormals(),E=h.getBinormals(),j=h.getDistances();if(a)for(let g=0;g<r.length;g++)if(0==r[g].x&&0==r[g].y&&0==r[g].z&&r[g].H(r[g-1]),0==d[g].x&&0==d[g].y&&0==d[g].z&&d[g].H(d[g-1]),0==E[g].x&&0==E[g].y&&0==E[g].z&&E[g].H(E[g-1]),g>0){let s=r[g-1];A.Pk.Dot(s,r[g])<0&&r[g].scaleInPlace(-1),s=d[g-1],A.Pk.Dot(s,d[g])<0&&d[g].scaleInPlace(-1),s=E[g-1],A.Pk.Dot(s,E[g])<0&&E[g].scaleInPlace(-1)}let P=0;const R=S&&O?O:()=>null!==K?K:0,D=S&&H?H:()=>null!==i?i:1;let w=c===g.e.NO_CAP||c===g.e.CAP_END?0:2;const B=A.TmpVectors.Matrix[0];for(let g=0;g<k.length;g++){const h=[],i=R(g,j[g]),K=D(g,j[g]);A.Matrix.RotationAxisToRef(r[g],P,B);for(let ms=0;ms<s.length;ms++){const i=r[g].scale(s[ms].z).add(d[g].scale(s[ms].x)).add(E[g].scale(s[ms].y)),H=A.Pk.Zero();A.Pk.TransformCoordinatesToRef(i,B,H),H.scaleInPlace(K).addInPlace(k[g]),h[ms]=H}ms[w]=h,P+=i,w++}const u=G||(s=>{const k=Array(),h=A.Pk.Zero();let g;for(g=0;g<s.length;g++)h.addInPlace(s[g]);for(h.scaleInPlace(1/s.length),g=0;g<s.length;g++)k.push(h);return k});switch(c){case g.e.NO_CAP:break;case g.e.CAP_START:ms[0]=u(ms[2]),ms[1]=ms[2];break;case g.e.CAP_END:ms[w]=ms[w-1],ms[w+1]=u(ms[w-1]);break;case g.e.CAP_ALL:ms[0]=u(ms[2]),ms[1]=ms[2],ms[w]=ms[w-1],ms[w+1]=u(ms[w-1])}return ms};let p,I;if(P){const s=P._creationDataStorage;return p=B?s.path3D.update(h,B):s.path3D.update(h),I=Q(k,h,s.path3D,s.pathArray,ms,i,K,H,s.cap,r,u),P=O("",{pathArray:I,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:P},d||void 0)}p=B?new b.j(h,B):new b.j(h);I=Q(k,h,p,new Array,ms,i,K,H,a=a<0||a>3?0:a,r,u);const N=O(s,{pathArray:I,closeArray:c,closePath:S,updatable:E,sideOrientation:j,invertUV:R,frontUVs:D||void 0,backUVs:w||void 0},d);return N._creationDataStorage.pathArray=I,N._creationDataStorage.path3D=p,N._creationDataStorage.cap=a,N}function v(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const ms=k.arc?k.arc<=0||k.arc>1?1:k.arc:1,i=void 0===k.closed||k.closed,K=k.shape,H=k.radius||1,c=k.tessellation||64,S=k.clip||0,a=k.updatable,r=g.e._GetDefaultSideOrientation(k.sideOrientation),d=k.cap||g.e.NO_CAP,E=2*Math.PI,j=[],P=k.invertUV||!1;let R=0,D=0;const w=E/c*ms;let B,u;for(R=0;R<=c-S;R++){for(u=[],d!=g.e.CAP_START&&d!=g.e.CAP_ALL||(u.push(new A.Pk(0,K[0].y,0)),u.push(new A.Pk(Math.cos(R*w)*K[0].x*H,K[0].y,Math.sin(R*w)*K[0].x*H))),D=0;D<K.length;D++)B=new A.Pk(Math.cos(R*w)*K[D].x*H,K[D].y,Math.sin(R*w)*K[D].x*H),u.push(B);d!=g.e.CAP_END&&d!=g.e.CAP_ALL||(u.push(new A.Pk(Math.cos(R*w)*K[K.length-1].x*H,K[K.length-1].y,Math.sin(R*w)*K[K.length-1].x*H)),u.push(new A.Pk(0,K[K.length-1].y,0))),j.push(u)}return O(s,{pathArray:j,closeArray:i,sideOrientation:r,updatable:a,invertUV:P,frontUVs:k.frontUVs,backUVs:k.backUVs},h)}g.e.ExtrudeShape=function(s,k,h,A,ms,i){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0;return t(s,{shape:k,path:h,scale:A,rotation:ms,cap:0===i?0:i||g.e.NO_CAP,sideOrientation:O,instance:c,updatable:H},K)},g.e.ExtrudeShapeCustom=(s,k,h,A,ms,i,K,H,O,c,S,a)=>z(s,{shape:k,path:h,scaleFunction:A,rotationFunction:ms,ribbonCloseArray:i,ribbonClosePath:K,cap:0===H?0:H||g.e.NO_CAP,sideOrientation:S,instance:a,updatable:c},O);g.e.CreateLathe=(s,k,h,A,g,ms,i)=>v(s,{shape:k,radius:h,tessellation:A,sideOrientation:i,updatable:ms},g);var Y=h(13881),n=h(13840);function T(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const ms=k.path;let i=k.instance,K=1;void 0!==k.radius?K=k.radius:i&&(K=i._creationDataStorage.radius);const H=k.tessellation||64,c=k.radiusFunction||null;let S=k.cap||g.e.NO_CAP;const a=k.invertUV||!1,r=k.updatable,d=g.e._GetDefaultSideOrientation(k.sideOrientation);k.arc=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1;const E=(s,k,h,ms,i,K,H,O)=>{const c=k.getTangents(),S=k.getNormals(),a=k.getDistances(),r=2*Math.PI/i*O,d=K||(()=>ms);let E,j,P,R;const D=A.TmpVectors.Matrix[0];let w=H===g.e.NO_CAP||H===g.e.CAP_END?0:2;for(let g=0;g<s.length;g++){j=d(g,a[g]),E=Array(),P=S[g];for(let k=0;k<i;k++)A.Matrix.RotationAxisToRef(c[g],r*k,D),R=E[k]?E[k]:A.Pk.Zero(),A.Pk.TransformCoordinatesToRef(P,D,R),R.scaleInPlace(j).addInPlace(s[g]),E[k]=R;h[w]=E,w++}const B=(k,h)=>{const A=Array();for(let g=0;g<k;g++)A.push(s[h]);return A};switch(H){case g.e.NO_CAP:break;case g.e.CAP_START:h[0]=B(i,0),h[1]=h[2].slice(0);break;case g.e.CAP_END:h[w]=h[w-1].slice(0),h[w+1]=B(i,s.length-1);break;case g.e.CAP_ALL:h[0]=B(i,0),h[1]=h[2].slice(0),h[w]=h[w-1].slice(0),h[w+1]=B(i,s.length-1)}return h};let j,P;if(i){const s=i._creationDataStorage,h=k.arc||s.arc;return j=s.path3D.update(ms),P=E(ms,j,s.pathArray,K,s.tessellation,c,s.cap,h),i=O("",{pathArray:P,instance:i}),s.path3D=j,s.pathArray=P,s.arc=h,s.radius=K,i}j=new b.j(ms);S=S<0||S>3?0:S,P=E(ms,j,new Array,K,H,c,S,k.arc);const R=O(s,{pathArray:P,closePath:!0,closeArray:!1,updatable:r,sideOrientation:d,invertUV:a,frontUVs:k.frontUVs,backUVs:k.backUVs},h);return R._creationDataStorage.pathArray=P,R._creationDataStorage.path3D=j,R._creationDataStorage.tessellation=H,R._creationDataStorage.cap=S,R._creationDataStorage.arc=k.arc,R._creationDataStorage.radius=K,R}function U(s){const k=[];k[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},k[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},k[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},k[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},k[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},k[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},k[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},k[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},k[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},k[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},k[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},k[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},k[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},k[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},k[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const h=s.type&&(s.type<0||s.type>=k.length)?0:s.type||0,g=s.size,ms=s.sizeX||g||1,H=s.sizeY||g||1,O=s.sizeZ||g||1,c=s.custom||k[h],S=c.face.length,r=s.faceUV||new Array(S),d=s.faceColors,E=void 0===s.flat||s.flat,j=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,P=[],R=[],D=[],w=[],B=[];let u=0,G=0;const Q=[];let p,I,N,b,t,z,C=0,v=0;if(E)for(v=0;v<S;v++)d&&void 0===d[v]&&(d[v]=new a.jg(1,1,1,1)),r&&void 0===r[v]&&(r[v]=new A.Vector4(0,0,1,1));if(E)for(v=0;v<S;v++){const s=c.face[v].length;for(N=2*Math.PI/s,b=.5*Math.tan(N/2),t=.5,C=0;C<s;C++)P.push(c.vertex[c.face[v][C]][0]*ms,c.vertex[c.face[v][C]][1]*H,c.vertex[c.face[v][C]][2]*O),Q.push(u),u++,p=r[v].x+(r[v].z-r[v].x)*(.5+b),I=r[v].y+(r[v].w-r[v].y)*(t-.5),w.push(p,K.d?1-I:I),z=b*Math.cos(N)-t*Math.sin(N),t=b*Math.sin(N)+t*Math.cos(N),b=z,d&&B.push(d[v].r,d[v].g,d[v].b,d[v].a);for(C=0;C<s-2;C++)R.push(Q[0+G],Q[C+2+G],Q[C+1+G]);G+=s}else{for(C=0;C<c.vertex.length;C++)P.push(c.vertex[C][0]*ms,c.vertex[C][1]*H,c.vertex[C][2]*O),w.push(0,K.d?1:0);for(v=0;v<S;v++)for(C=0;C<c.face[v].length-2;C++)R.push(c.face[v][0],c.face[v][C+2],c.face[v][C+1])}i.c.ComputeNormals(P,R,D),i.c._ComputeSides(j,P,R,D,w,s.frontUVs,s.backUVs);const Y=new i.c;return Y.bs=P,Y.indices=R,Y.ts=D,Y.Cs=w,d&&E&&(Y.zs=B),Y}function q(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return U(k).Ys(A,k.updatable),A}g.e.CreateTube=(s,k,h,A,g,ms,i,K,H,O)=>T(s,{path:k,radius:h,tessellation:A,radiusFunction:g,arc:1,cap:ms,updatable:K,sideOrientation:H,instance:O},i);function M(s){const k=s.sideOrientation||i.c.DEFAULTSIDE,h=s.radius||1,g=void 0===s.flat||s.flat,ms=0|(s.subdivisions||4),H=s.radiusX||h,O=s.radiusY||h,c=s.radiusZ||h,S=(1+Math.sqrt(5))/2,a=[-1,S,-0,1,S,0,-1,-S,0,1,-S,0,0,-1,-S,0,1,-S,0,-1,S,0,1,S,S,0,1,S,0,-1,-S,0,1,-S,0,-1],r=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],d=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],j=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],P=[],R=[],D=[],w=[];let B=0;const u=new Array(3),G=new Array(3);let Q;for(Q=0;Q<3;Q++)u[Q]=A.Pk.Zero(),G[Q]=A.Vector2.Zero();for(let i=0;i<20;i++){for(Q=0;Q<3;Q++){const s=r[3*i+Q];u[Q].cg(a[3*d[s]],a[3*d[s]+1],a[3*d[s]+2]),u[Q].normalize(),G[Q].cg(.134765625*E[2*s]+.05859375+-.0390625*j[i],.2333984375*E[2*s+1]+.025390625+.01953125*j[i])}const s=(s,k,h,i)=>{const S=A.Pk.Lerp(u[0],u[2],k/ms),a=A.Pk.Lerp(u[1],u[2],k/ms),r=ms===k?u[2]:A.Pk.Lerp(S,a,s/(ms-k));let d;if(r.normalize(),g){const s=A.Pk.Lerp(u[0],u[2],i/ms),k=A.Pk.Lerp(u[1],u[2],i/ms);d=A.Pk.Lerp(s,k,h/(ms-i))}else d=new A.Pk(r.x,r.y,r.z);d.x/=H,d.y/=O,d.z/=c,d.normalize();const E=A.Vector2.Lerp(G[0],G[2],k/ms),j=A.Vector2.Lerp(G[1],G[2],k/ms),Q=ms===k?G[2]:A.Vector2.Lerp(E,j,s/(ms-k));R.push(r.x*H,r.y*O,r.z*c),D.push(d.x,d.y,d.z),w.push(Q.x,K.d?1-Q.y:Q.y),P.push(B),B++};for(let k=0;k<ms;k++)for(let h=0;h+k<ms;h++)s(h,k,h+1/3,k+1/3),s(h+1,k,h+1/3,k+1/3),s(h,k+1,h+1/3,k+1/3),h+k+1<ms&&(s(h+1,k,h+2/3,k+2/3),s(h+1,k+1,h+2/3,k+2/3),s(h,k+1,h+2/3,k+2/3))}i.c._ComputeSides(k,R,P,D,w,s.frontUVs,s.backUVs);const p=new i.c;return p.indices=P,p.bs=R,p.ts=D,p.Cs=w,p}function V(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new g.e(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),A._originalBuilderSideOrientation=k.sideOrientation;return M(k).Ys(A,k.updatable),A}i.c.CreatePolyhedron=U,g.e.CreatePolyhedron=(s,k,h)=>q(s,k,h);i.c.CreateIcoSphere=M,g.e.CreateIcoSphere=(s,k,h)=>V(s,k,h);var X=h(12607);const L=new A.Pk(1,0,0),Z=new A.Pk(-1,0,0),x=new A.Pk(0,1,0),y=new A.Pk(0,-1,0),W=new A.Pk(0,0,1),J=new A.Pk(0,0,-1);class F{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.Pk.Zero(),k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.Pk.Up(),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.Vector2.Zero(),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=s,this.normal=k,this.uv=h,this.vertexIdx=g,this.vertexIdxForBones=ms,this.localPositionOverride=i,this.localNormalOverride=K,this.matrixIndicesOverride=H,this.matrixWeightsOverride=O}clone(){var s,k,h,A;return new F(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(s=this.localPositionOverride)||void 0===s?void 0:s.slice(),null===(k=this.localNormalOverride)||void 0===k?void 0:k.slice(),null===(h=this.matrixIndicesOverride)||void 0===h?void 0:h.slice(),null===(A=this.matrixWeightsOverride)||void 0===A?void 0:A.slice())}}function o(s,k,h){var H,O,c,S,a;const r=!!k.skeleton,d=!(null===(H=k.morphTargetManager)||void 0===H||!H.numTargets),E=h.localMode||r,j=k.sg(),P=r||d?k.JK(!0,!0):k.getVerticesData(ms.e.PositionKind),R=r||d?k.getNormalsData(!0,!0):k.getVerticesData(ms.e.NormalKind),D=E?r?k.getVerticesData(ms.e.PositionKind):P:null,w=E?r?k.getVerticesData(ms.e.NormalKind):R:null,B=k.getVerticesData(ms.e.UVKind),u=r?k.getVerticesData(ms.e.MatricesIndicesKind):null,G=r?k.getVerticesData(ms.e.MatricesWeightsKind):null,Q=r?k.getVerticesData(ms.e.MatricesIndicesExtraKind):null,p=r?k.getVerticesData(ms.e.MatricesWeightsExtraKind):null,I=h.position||A.Pk.Zero();let N=h.normal||A.Pk.Up();const b=h.size||A.Pk.One(),t=h.angle||0;if(!N){const s=new A.Pk(0,0,1),h=k.Is().activeCamera,g=A.Pk.TransformCoordinates(s,h.getWorldMatrix());N=h.globalPosition.Rk(g)}const z=-Math.atan2(N.z,N.x)-Math.PI/2,C=Math.sqrt(N.x*N.x+N.z*N.z),v=Math.atan2(N.y,C),Y=new i.c;Y.indices=[],Y.bs=[],Y.ts=[],Y.Cs=[],Y.matricesIndices=r?[]:null,Y.matricesWeights=r?[]:null,Y.matricesIndicesExtra=Q?[]:null,Y.matricesWeightsExtra=p?[]:null;let n=0;const T=(s,k)=>{const g=new F;if(!j||!P||!R)return g;const ms=j[s];if(g.vertexIdx=3*ms,g.vertexIdxForBones=4*ms,g.position=new A.Pk(P[3*ms],P[3*ms+1],P[3*ms+2]),A.Pk.TransformCoordinatesToRef(g.position,k,g.position),g.normal=new A.Pk(R[3*ms],R[3*ms+1],R[3*ms+2]),A.Pk.TransformNormalToRef(g.normal,k,g.normal),h.captureUVS&&B){const s=B[2*ms+1];g.uv=new A.Vector2(B[2*ms],K.d?1-s:s)}return g},U=[0,0,0,0],q=(s,k)=>{if(0===s.length)return s;const h=.5*Math.abs(A.Pk.Dot(b,k)),g=(s,k,h,A)=>{for(let g=0;g<A;++g)if(s[h+g]===k)return h+g;return-1},ms=(s,ms)=>{const i=A.Pk.GetClipFactor(s.position,ms.position,k,h);let K=U,H=U;if(u&&G){const k=s.matrixIndicesOverride?0:s.vertexIdxForBones,h=s.matrixIndicesOverride??u,A=s.matrixWeightsOverride??G,O=ms.matrixIndicesOverride?0:ms.vertexIdxForBones,c=ms.matrixIndicesOverride??u,S=ms.matrixWeightsOverride??G;K=[0,0,0,0],H=[0,0,0,0];let a=0;for(let s=0;s<4;++s)if(A[k+s]>0){const ms=g(c,h[k+s],O,4);K[a]=h[k+s],H[a]=(0,X.Lerp)(A[k+s],ms>=0?S[ms]:0,i),a++}for(let s=0;s<4&&a<4;++s){const A=c[O+s];-1===g(h,A,k,4)&&(K[a]=A,H[a]=(0,X.Lerp)(0,S[O+s],i),a++)}const r=H[0]+H[1]+H[2]+H[3];H[0]/=r,H[1]/=r,H[2]/=r,H[3]/=r}const O=s.localPositionOverride?s.localPositionOverride[0]:(null===D||void 0===D?void 0:D[s.vertexIdx])??0,c=s.localPositionOverride?s.localPositionOverride[1]:(null===D||void 0===D?void 0:D[s.vertexIdx+1])??0,S=s.localPositionOverride?s.localPositionOverride[2]:(null===D||void 0===D?void 0:D[s.vertexIdx+2])??0,a=ms.localPositionOverride?ms.localPositionOverride[0]:(null===D||void 0===D?void 0:D[ms.vertexIdx])??0,r=ms.localPositionOverride?ms.localPositionOverride[1]:(null===D||void 0===D?void 0:D[ms.vertexIdx+1])??0,d=ms.localPositionOverride?ms.localPositionOverride[2]:(null===D||void 0===D?void 0:D[ms.vertexIdx+2])??0,E=s.localNormalOverride?s.localNormalOverride[0]:(null===w||void 0===w?void 0:w[s.vertexIdx])??0,j=s.localNormalOverride?s.localNormalOverride[1]:(null===w||void 0===w?void 0:w[s.vertexIdx+1])??0,P=s.localNormalOverride?s.localNormalOverride[2]:(null===w||void 0===w?void 0:w[s.vertexIdx+2])??0,R=E+((ms.localNormalOverride?ms.localNormalOverride[0]:(null===w||void 0===w?void 0:w[ms.vertexIdx])??0)-E)*i,B=j+((ms.localNormalOverride?ms.localNormalOverride[1]:(null===w||void 0===w?void 0:w[ms.vertexIdx+1])??0)-j)*i,Q=P+((ms.localNormalOverride?ms.localNormalOverride[2]:(null===w||void 0===w?void 0:w[ms.vertexIdx+2])??0)-P)*i,p=Math.sqrt(R*R+B*B+Q*Q);return new F(A.Pk.Lerp(s.position,ms.position,i),A.Pk.Lerp(s.normal,ms.normal,i).normalize(),A.Vector2.Lerp(s.uv,ms.uv,i),-1,-1,D?[O+(a-O)*i,c+(r-c)*i,S+(d-S)*i]:null,w?[R/p,B/p,Q/p]:null,K,H)};let i=null;s.length>3&&(i=[]);for(let K=0;K<s.length;K+=3){let g=0,H=null,O=null,c=null,S=null;const a=A.Pk.Dot(s[K].position,k)-h>0,r=A.Pk.Dot(s[K+1].position,k)-h>0,d=A.Pk.Dot(s[K+2].position,k)-h>0;switch(g=(a?1:0)+(r?1:0)+(d?1:0),g){case 0:s.length>3?(i.push(s[K]),i.push(s[K+1]),i.push(s[K+2])):i=s;break;case 1:if(i=i??new Array,a&&(H=s[K+1],O=s[K+2],c=ms(s[K],H),S=ms(s[K],O)),r){H=s[K],O=s[K+2],c=ms(s[K+1],H),S=ms(s[K+1],O),i.push(c),i.push(O.clone()),i.push(H.clone()),i.push(O.clone()),i.push(c.clone()),i.push(S);break}d&&(H=s[K],O=s[K+1],c=ms(s[K+2],H),S=ms(s[K+2],O)),H&&O&&c&&S&&(i.push(H.clone()),i.push(O.clone()),i.push(c),i.push(S),i.push(c.clone()),i.push(O.clone()));break;case 2:i=i??new Array,a||(H=s[K].clone(),O=ms(H,s[K+1]),c=ms(H,s[K+2]),i.push(H),i.push(O),i.push(c)),r||(H=s[K+1].clone(),O=ms(H,s[K+2]),c=ms(H,s[K]),i.push(H),i.push(O),i.push(c)),d||(H=s[K+2].clone(),O=ms(H,s[K]),c=ms(H,s[K+1]),i.push(H),i.push(O),i.push(c))}}return i},M=k instanceof g.e?k:null,V=null===M||void 0===M?void 0:M._thinInstanceDataStorage.matrixData,o=(null===M||void 0===M?void 0:M.Gg)||1,l=A.TmpVectors.Matrix[0];l.H(A.Matrix.IdentityReadOnly);for(let g=0;g<o;++g){if(null!==M&&void 0!==M&&M.hasThinInstances&&V){const s=16*g;l.setRowFromFloats(0,V[s+0],V[s+1],V[s+2],V[s+3]),l.setRowFromFloats(1,V[s+4],V[s+5],V[s+6],V[s+7]),l.setRowFromFloats(2,V[s+8],V[s+9],V[s+10],V[s+11]),l.setRowFromFloats(3,V[s+12],V[s+13],V[s+14],V[s+15])}const s=A.Matrix.RotationYawPitchRoll(z,v,t).multiply(A.Matrix.Translation(I.x,I.y,I.z)),ms=A.Matrix.Invert(s),i=k.getWorldMatrix(),H=l.multiply(i).multiply(ms),O=new Array(3);for(let k=0;k<j.length;k+=3){let s=O;if(s[0]=T(k,H),s[1]=T(k+1,H),s[2]=T(k+2,H),!(h.cullBackFaces&&-s[0].normal.z<=0&&-s[1].normal.z<=0&&-s[2].normal.z<=0)&&(s=q(s,L),s&&(s=q(s,Z),s&&(s=q(s,x),s&&(s=q(s,y),s&&(s=q(s,W),s&&(s=q(s,J),s)))))))for(let k=0;k<s.length;k++){const A=s[k];if(Y.indices.push(n),E?(A.localPositionOverride?(Y.bs[3*n]=A.localPositionOverride[0],Y.bs[3*n+1]=A.localPositionOverride[1],Y.bs[3*n+2]=A.localPositionOverride[2]):D&&(Y.bs[3*n]=D[A.vertexIdx],Y.bs[3*n+1]=D[A.vertexIdx+1],Y.bs[3*n+2]=D[A.vertexIdx+2]),A.localNormalOverride?(Y.ts[3*n]=A.localNormalOverride[0],Y.ts[3*n+1]=A.localNormalOverride[1],Y.ts[3*n+2]=A.localNormalOverride[2]):w&&(Y.ts[3*n]=w[A.vertexIdx],Y.ts[3*n+1]=w[A.vertexIdx+1],Y.ts[3*n+2]=w[A.vertexIdx+2])):(A.position.toArray(Y.bs,3*n),A.normal.toArray(Y.ts,3*n)),Y.matricesIndices&&Y.matricesWeights&&(A.matrixIndicesOverride?(Y.matricesIndices[4*n]=A.matrixIndicesOverride[0],Y.matricesIndices[4*n+1]=A.matrixIndicesOverride[1],Y.matricesIndices[4*n+2]=A.matrixIndicesOverride[2],Y.matricesIndices[4*n+3]=A.matrixIndicesOverride[3]):(u&&(Y.matricesIndices[4*n]=u[A.vertexIdxForBones],Y.matricesIndices[4*n+1]=u[A.vertexIdxForBones+1],Y.matricesIndices[4*n+2]=u[A.vertexIdxForBones+2],Y.matricesIndices[4*n+3]=u[A.vertexIdxForBones+3]),Q&&Y.matricesIndicesExtra&&(Y.matricesIndicesExtra[4*n]=Q[A.vertexIdxForBones],Y.matricesIndicesExtra[4*n+1]=Q[A.vertexIdxForBones+1],Y.matricesIndicesExtra[4*n+2]=Q[A.vertexIdxForBones+2],Y.matricesIndicesExtra[4*n+3]=Q[A.vertexIdxForBones+3])),A.matrixWeightsOverride?(Y.matricesWeights[4*n]=A.matrixWeightsOverride[0],Y.matricesWeights[4*n+1]=A.matrixWeightsOverride[1],Y.matricesWeights[4*n+2]=A.matrixWeightsOverride[2],Y.matricesWeights[4*n+3]=A.matrixWeightsOverride[3]):(G&&(Y.matricesWeights[4*n]=G[A.vertexIdxForBones],Y.matricesWeights[4*n+1]=G[A.vertexIdxForBones+1],Y.matricesWeights[4*n+2]=G[A.vertexIdxForBones+2],Y.matricesWeights[4*n+3]=G[A.vertexIdxForBones+3]),p&&Y.matricesWeightsExtra&&(Y.matricesWeightsExtra[4*n]=p[A.vertexIdxForBones],Y.matricesWeightsExtra[4*n+1]=p[A.vertexIdxForBones+1],Y.matricesWeightsExtra[4*n+2]=p[A.vertexIdxForBones+2],Y.matricesWeightsExtra[4*n+3]=p[A.vertexIdxForBones+3]))),h.captureUVS)A.uv.toArray(Y.Cs,2*n);else{Y.Cs.push(.5+A.position.x/b.x);const s=.5+A.position.y/b.y;Y.Cs.push(K.d?1-s:s)}n++}}}0===Y.indices.length&&(Y.indices=null),0===Y.bs.length&&(Y.bs=null),0===Y.ts.length&&(Y.ts=null),0===Y.Cs.length&&(Y.Cs=null),0===(null===(O=Y.matricesIndices)||void 0===O?void 0:O.length)&&(Y.matricesIndices=null),0===(null===(c=Y.matricesWeights)||void 0===c?void 0:c.length)&&(Y.matricesWeights=null),0===(null===(S=Y.matricesIndicesExtra)||void 0===S?void 0:S.length)&&(Y.matricesIndicesExtra=null),0===(null===(a=Y.matricesWeightsExtra)||void 0===a?void 0:a.length)&&(Y.matricesWeightsExtra=null);const f=new g.e(s,k.Is());return Y.Ys(f),E?(f.skeleton=k.skeleton,f.parent=k):(f.position=I.clone(),f.rotation=new A.Pk(v,z,t)),f.fh(!0),f.refreshBoundingInfo(!0,!0),f}function l(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const k=0|Math.max(s.subdivisions?s.subdivisions:2,1),h=0|Math.max(s.tessellation?s.tessellation:16,3),g=Math.max(s.height?s.height:1,0),ms=Math.max(s.radius?s.radius:.25,0),H=0|Math.max(s.capSubdivisions?s.capSubdivisions:6,1),O=h,c=k,S=Math.max(s.radiusTop?s.radiusTop:ms,0),a=Math.max(s.radiusBottom?s.radiusBottom:ms,0),r=g-(S+a),d=2*Math.PI,E=Math.max(s.topCapSubdivisions?s.topCapSubdivisions:H,1),j=Math.max(s.bottomCapSubdivisions?s.bottomCapSubdivisions:H,1),P=Math.acos((a-S)/g);let R=[];const D=[],w=[],B=[];let u=0;const G=[],Q=.5*r,p=.5*Math.PI;let I,N;const b=A.Pk.Zero(),t=A.Pk.Zero(),z=Math.cos(P),C=Math.sin(P),v=new A.Vector2(S*C,Q+S*z).Rk(new A.Vector2(a*C,a*z-Q)).length(),Y=S*P+v+a*(p-P);let n=0;for(N=0;N<=E;N++){const s=[],k=p-P*(N/E);n+=S*P/E;const h=Math.cos(k),A=Math.sin(k),g=h*S;for(I=0;I<=O;I++){const k=I/O,ms=k*d+0,i=Math.sin(ms),H=Math.cos(ms);t.x=g*i,t.y=Q+A*S,t.z=g*H,D.push(t.x,t.y,t.z),b.set(h*i,A,h*H),w.push(b.x,b.y,b.z),B.push(k,K.d?n/Y:1-n/Y),s.push(u),u++}G.push(s)}const T=g-S-a+z*S-z*a,U=C*(a-S)/T;for(N=1;N<=c;N++){const s=[];n+=v/c;const k=C*(N*(a-S)/c+S);for(I=0;I<=O;I++){const h=I/O,A=h*d+0,g=Math.sin(A),ms=Math.cos(A);t.x=k*g,t.y=Q+z*S-N*T/c,t.z=k*ms,D.push(t.x,t.y,t.z),b.set(g,U,ms).normalize(),w.push(b.x,b.y,b.z),B.push(h,K.d?n/Y:1-n/Y),s.push(u),u++}G.push(s)}for(N=1;N<=j;N++){const s=[],k=p-P-(Math.PI-P)*(N/j);n+=a*P/j;const h=Math.cos(k),A=Math.sin(k),g=h*a;for(I=0;I<=O;I++){const k=I/O,ms=k*d+0,i=Math.sin(ms),H=Math.cos(ms);t.x=g*i,t.y=A*a-Q,t.z=g*H,D.push(t.x,t.y,t.z),b.set(h*i,A,h*H),w.push(b.x,b.y,b.z),B.push(k,K.d?n/Y:1-n/Y),s.push(u),u++}G.push(s)}for(I=0;I<O;I++)for(N=0;N<E+c+j;N++){const s=G[N][I],k=G[N+1][I],h=G[N+1][I+1],A=G[N][I+1];R.push(s),R.push(k),R.push(A),R.push(k),R.push(h),R.push(A)}if(R=R.reverse(),s.orientation&&!s.orientation.equals(A.Pk.Up())){const k=new A.Matrix;s.orientation.clone().scale(.5*Math.PI).cross(A.Pk.Up()).toQuaternion().toRotationMatrix(k);const h=A.Pk.Zero();for(let s=0;s<D.length;s+=3)h.set(D[s],D[s+1],D[s+2]),A.Pk.TransformCoordinatesToRef(h.clone(),k,h),D[s]=h.x,D[s+1]=h.y,D[s+2]=h.z}const q=new i.c;return q.bs=D,q.ts=w,q.Cs=B,q.indices=R,q}function f(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:A.Pk.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const ms=new g.e(s,h);return l(k).Ys(ms,k.updatable),ms}g.e.CreateDecal=(s,k,h,A,g,ms)=>o(s,k,{position:h,normal:A,size:g,angle:ms});g.e.CreateCapsule=(s,k,h)=>f(s,k,h),i.c.CreateCapsule=l;var e=h(12422),ss=h(12598);class ks{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=s,this.y=k,s!==Math.floor(s)&&(s=Math.floor(s),e.c.Warn("x is not an integer, floor(x) used")),k!==Math.floor(k)&&(k=Math.floor(k),e.c.Warn("y is not an integer, floor(y) used"))}clone(){return new ks(this.x,this.y)}rotate60About(s){const k=this.x;return this.x=s.x+s.y-this.y,this.y=k+this.y-s.x,this}rotateNeg60About(s){const k=this.x;return this.x=k+this.y-s.y,this.y=s.x+s.y-k,this}rotate120(s,k){s!==Math.floor(s)&&(s=Math.floor(s),e.c.Warn("m not an integer only floor(m) used")),k!==Math.floor(k)&&(k=Math.floor(k),e.c.Warn("n not an integer only floor(n) used"));const h=this.x;return this.x=s-h-this.y,this.y=k+h,this}rotateNeg120(s,k){s!==Math.floor(s)&&(s=Math.floor(s),e.c.Warn("m is not an integer, floor(m) used")),k!==Math.floor(k)&&(k=Math.floor(k),e.c.Warn("n is not an integer,   floor(n) used"));const h=this.x;return this.x=this.y-k,this.y=s+k-h-this.y,this}toCartesianOrigin(s,k){const h=A.Pk.Zero();return h.x=s.x+2*this.x*k+this.y*k,h.y=s.y+Math.sqrt(3)*this.y*k,h}static Zero(){return new ks(0,0)}}class hs{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new As("icosahedron","Regular",[[0,ss.d,-1],[-ss.d,1,0],[-1,0,-ss.d],[1,0,-ss.d],[ss.d,1,0],[0,ss.d,1],[-1,0,ss.d],[-ss.d,-1,0],[0,-ss.d,-1],[ss.d,-1,0],[1,0,ss.d],[0,-ss.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let s=12;const k={},h=this.m,A=this.n;let g,ms,i,K,H,O=h,c=1,S=0;0!==A&&(O=(0,X.HighestCommonFactor)(h,A)),c=h/O,S=A/O;const a=ks.Zero(),r=new ks(h,A),d=new ks(-A,h+A),E=ks.Zero(),j=ks.Zero(),P=ks.Zero();let R,D,w,B,u=[];const G=[],Q=this.vertByDist,p=(h,A,g,ms)=>{R=h+"|"+g,D=A+"|"+ms,R in k||D in k?R in k&&!(D in k)?k[D]=k[R]:D in k&&!(R in k)&&(k[R]=k[D]):(k[R]=s,k[D]=s,s++),Q[g][0]>2?G[k[R]]=[-Q[g][0],Q[g][1],k[R]]:G[k[R]]=[u[Q[g][0]],Q[g][1],k[R]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let I=0;I<20;I++){if(u=this.IDATA.face[I],i=u[2],K=u[1],H=u[0],w=a.x+"|"+a.y,R=I+"|"+w,R in k||(k[R]=i,G[i]=[u[Q[w][0]],Q[w][1]]),w=r.x+"|"+r.y,R=I+"|"+w,R in k||(k[R]=K,G[K]=[u[Q[w][0]],Q[w][1]]),w=d.x+"|"+d.y,R=I+"|"+w,R in k||(k[R]=H,G[H]=[u[Q[w][0]],Q[w][1]]),g=this.IDATA.edgematch[I][0],ms=this.IDATA.edgematch[I][1],"B"===ms)for(let s=1;s<O;s++)j.x=h-s*(c+S),j.y=A+s*c,P.x=-s*S,P.y=s*(c+S),w=j.x+"|"+j.y,B=P.x+"|"+P.y,p(I,g,w,B);if("O"===ms)for(let s=1;s<O;s++)P.x=-s*S,P.y=s*(c+S),E.x=s*c,E.y=s*S,w=P.x+"|"+P.y,B=E.x+"|"+E.y,p(I,g,w,B);if(g=this.IDATA.edgematch[I][2],ms=this.IDATA.edgematch[I][3],ms&&"A"===ms)for(let s=1;s<O;s++)E.x=s*c,E.y=s*S,j.x=h-(O-s)*(c+S),j.y=A+(O-s)*c,w=E.x+"|"+E.y,B=j.x+"|"+j.y,p(I,g,w,B);for(let h=0;h<this.vertices.length;h++)w=this.vertices[h].x+"|"+this.vertices[h].y,R=I+"|"+w,R in k||(k[R]=s++,Q[w][0]>2?G[k[R]]=[-Q[w][0],Q[w][1],k[R]]:G[k[R]]=[u[Q[w][0]],Q[w][1],k[R]])}this.closestTo=G,this.vecToidx=k}calcCoeffs(){const s=this.m,k=this.n,h=Math.sqrt(3)/3,A=s*s+k*k+s*k;this.coau=(s+k)/A,this.cobu=-k/A,this.coav=-h*(s-k)/A,this.cobv=h*(2*s+k)/A}createInnerFacets(){const s=this.m,k=this.n;for(let h=0;h<k+s+1;h++)for(let s=this.min[h];s<this.max[h]+1;s++)s<this.max[h]&&s<this.max[h+1]+1&&this.innerFacets.push(["|"+s+"|"+h,"|"+s+"|"+(h+1),"|"+(s+1)+"|"+h]),h>0&&s<this.max[h-1]&&s+1<this.max[h]+1&&this.innerFacets.push(["|"+s+"|"+h,"|"+(s+1)+"|"+h,"|"+(s+1)+"|"+(h-1)])}edgeVecsABOB(){const s=this.m,k=this.n,h=new ks(-k,s+k);for(let A=1;A<s+k;A++){const s=new ks(this.min[A],A),k=new ks(this.min[A-1],A-1),g=new ks(this.min[A+1],A+1),ms=s.clone(),i=k.clone(),K=g.clone();ms.rotate60About(h),i.rotate60About(h),K.rotate60About(h);const H=new ks(this.max[ms.y],ms.y),O=new ks(this.max[ms.y-1],ms.y-1),c=new ks(this.max[ms.y-1]-1,ms.y-1);ms.x===H.x&&ms.y===H.y||(ms.x!==O.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,O,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,c,H])):ms.y===K.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,k,O]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([s,O,g])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,k,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,O,H])))}}mapABOBtoOBOA(){const s=new ks(0,0);for(let k=0;k<this.isoVecsABOB.length;k++){const h=[];for(let A=0;A<3;A++)s.x=this.isoVecsABOB[k][A].x,s.y=this.isoVecsABOB[k][A].y,0===this.vertexTypes[k][A]&&s.rotateNeg120(this.m,this.n),h.push(s.clone());this.isoVecsOBOA.push(h)}}mapABOBtoBAOA(){const s=new ks(0,0);for(let k=0;k<this.isoVecsABOB.length;k++){const h=[];for(let A=0;A<3;A++)s.x=this.isoVecsABOB[k][A].x,s.y=this.isoVecsABOB[k][A].y,1===this.vertexTypes[k][A]&&s.rotate120(this.m,this.n),h.push(s.clone());this.isoVecsBAOA.push(h)}}MapToFace(s,k){const h=this.IDATA.face[s],g=h[2],ms=h[1],i=h[0],K=A.Pk.uk(this.IDATA.vertex[g]),H=A.Pk.uk(this.IDATA.vertex[ms]),O=A.Pk.uk(this.IDATA.vertex[i]),c=H.Rk(K),S=O.Rk(K),a=c.scale(this.coau).add(S.scale(this.cobu)),r=c.scale(this.coav).add(S.scale(this.cobv)),d=[];let E,j=A.TmpVectors.Pk[0];for(let A=0;A<this.cartesian.length;A++)j=a.scale(this.cartesian[A].x).add(r.scale(this.cartesian[A].y)).add(K),d[A]=[j.x,j.y,j.z],E=s+"|"+this.vertices[A].x+"|"+this.vertices[A].y,k.vertex[this.vecToidx[E]]=[j.x,j.y,j.z]}build(s,k){const h=[],A=ks.Zero(),g=new ks(s,k),ms=new ks(-k,s+k);h.push(A,g,ms);for(let w=k;w<s+1;w++)for(let k=0;k<s+1-w;k++)h.push(new ks(k,w));if(k>0){const A=(0,X.HighestCommonFactor)(s,k),g=s/A,ms=k/A;for(let K=1;K<A;K++)h.push(new ks(K*g,K*ms)),h.push(new ks(-K*ms,K*(g+ms))),h.push(new ks(s-K*(g+ms),k+K*g));const i=s/k;for(let K=1;K<k;K++)for(let A=0;A<K*i;A++)h.push(new ks(A,K)),h.push(new ks(A,K).rotate120(s,k)),h.push(new ks(A,K).rotateNeg120(s,k))}h.sort(((s,k)=>s.x-k.x)),h.sort(((s,k)=>s.y-k.y));const i=new Array(s+k+1),K=new Array(s+k+1);for(let w=0;w<i.length;w++)i[w]=1/0,K[w]=-1/0;let H=0,O=0;const c=h.length;for(let w=0;w<c;w++)O=h[w].x,H=h[w].y,i[H]=Math.min(O,i[H]),K[H]=Math.max(O,K[H]);const S=(h,A)=>{const g=h.clone();return"A"===A&&g.rotateNeg120(s,k),"B"===A&&g.rotate120(s,k),g.x<0?g.y:g.x+g.y},a=[],r=[],d=[],E=[],j={},P=[];let R=-1,D=-1;for(let w=0;w<c;w++)a[w]=h[w].toCartesianOrigin(new ks(0,0),.5),r[w]=S(h[w],"O"),d[w]=S(h[w],"A"),E[w]=S(h[w],"B"),r[w]===d[w]&&d[w]===E[w]?(R=3,D=r[w]):r[w]===d[w]?(R=4,D=r[w]):d[w]===E[w]?(R=5,D=d[w]):E[w]===r[w]&&(R=6,D=r[w]),r[w]<d[w]&&r[w]<E[w]&&(R=2,D=r[w]),d[w]<r[w]&&d[w]<E[w]&&(R=1,D=d[w]),E[w]<d[w]&&E[w]<r[w]&&(R=0,D=E[w]),P.push([R,D,h[w].x,h[w].y]);P.sort(((s,k)=>s[2]-k[2])),P.sort(((s,k)=>s[3]-k[3])),P.sort(((s,k)=>s[1]-k[1])),P.sort(((s,k)=>s[0]-k[0]));for(let w=0;w<P.length;w++)j[P[w][2]+"|"+P[w][3]]=[P[w][0],P[w][1],w];return this.m=s,this.n=k,this.vertices=h,this.vertByDist=j,this.cartesian=a,this.min=i,this.max=K,this}}class As{constructor(s,k,h,A){this.name=s,this.category=k,this.vertex=h,this.face=A}}class gs extends As{innerToData(s,k){for(let h=0;h<k.innerFacets.length;h++)this.face.push(k.innerFacets[h].map((h=>k.vecToidx[s+h])))}mapABOBtoDATA(s,k){const h=k.IDATA.edgematch[s][0];for(let A=0;A<k.isoVecsABOB.length;A++){const g=[];for(let ms=0;ms<3;ms++)0===k.vertexTypes[A][ms]?g.push(s+"|"+k.isoVecsABOB[A][ms].x+"|"+k.isoVecsABOB[A][ms].y):g.push(h+"|"+k.isoVecsABOB[A][ms].x+"|"+k.isoVecsABOB[A][ms].y);this.face.push([k.vecToidx[g[0]],k.vecToidx[g[1]],k.vecToidx[g[2]]])}}mapOBOAtoDATA(s,k){const h=k.IDATA.edgematch[s][0];for(let A=0;A<k.isoVecsOBOA.length;A++){const g=[];for(let ms=0;ms<3;ms++)1===k.vertexTypes[A][ms]?g.push(s+"|"+k.isoVecsOBOA[A][ms].x+"|"+k.isoVecsOBOA[A][ms].y):g.push(h+"|"+k.isoVecsOBOA[A][ms].x+"|"+k.isoVecsOBOA[A][ms].y);this.face.push([k.vecToidx[g[0]],k.vecToidx[g[1]],k.vecToidx[g[2]]])}}mapBAOAtoDATA(s,k){const h=k.IDATA.edgematch[s][2];for(let A=0;A<k.isoVecsBAOA.length;A++){const g=[];for(let ms=0;ms<3;ms++)1===k.vertexTypes[A][ms]?g.push(s+"|"+k.isoVecsBAOA[A][ms].x+"|"+k.isoVecsBAOA[A][ms].y):g.push(h+"|"+k.isoVecsBAOA[A][ms].x+"|"+k.isoVecsBAOA[A][ms].y);this.face.push([k.vecToidx[g[0]],k.vecToidx[g[1]],k.vecToidx[g[2]]])}}orderData(s){const k=[];for(let ms=0;ms<13;ms++)k[ms]=[];const h=s.closestTo;for(let ms=0;ms<h.length;ms++)h[ms][0]>-1?h[ms][1]>0&&k[h[ms][0]].push([ms,h[ms][1]]):k[12].push([ms,h[ms][0]]);const A=[];for(let ms=0;ms<12;ms++)A[ms]=ms;let g=12;for(let ms=0;ms<12;ms++){k[ms].sort(((s,k)=>s[1]-k[1]));for(let s=0;s<k[ms].length;s++)A[k[ms][s][0]]=g++}for(let ms=0;ms<k[12].length;ms++)A[k[12][ms][0]]=g++;for(let ms=0;ms<this.vertex.length;ms++)this.vertex[ms].push(A[ms]);this.vertex.sort(((s,k)=>s[3]-k[3]));for(let ms=0;ms<this.vertex.length;ms++)this.vertex[ms].pop();for(let ms=0;ms<this.face.length;ms++)for(let s=0;s<this.face[ms].length;s++)this.face[ms][s]=A[this.face[ms][s]];this.sharedNodes=k[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(s,k){const h=[],A=[];let g=k.pop();A.push(g);let ms=this.face[g].indexOf(s);ms=(ms+2)%3;let i=this.face[g][ms];h.push(i);let K=0;for(;k.length>0;)g=k[K],this.face[g].indexOf(i)>-1?(ms=(this.face[g].indexOf(i)+1)%3,i=this.face[g][ms],h.push(i),A.push(g),k.splice(K,1),K=0):K++;return this.adjacentFaces.push(h),A}toGoldbergPolyhedronData(){const s=new As("GeoDual","Goldberg",[],[]);s.name="GD dual";const k=this.vertex.length,h=new Array(k);for(let H=0;H<k;H++)h[H]=[];for(let H=0;H<this.face.length;H++)for(let s=0;s<3;s++)h[this.face[H][s]].push(H);let A=0,g=0,ms=0,i=[],K=[];this.adjacentFaces=[];for(let H=0;H<h.length;H++){s.face[H]=this.setOrder(H,h[H].concat([]));for(const k of h[H]){A=0,g=0,ms=0,i=this.face[k];for(let s=0;s<3;s++)K=this.vertex[i[s]],A+=K[0],g+=K[1],ms+=K[2];s.vertex[k]=[A/3,g/3,ms/3]}}return s}static BuildGeodesicData(s){const k=new gs("Geodesic-m-n","Geodesic",[[0,ss.d,-1],[-ss.d,1,0],[-1,0,-ss.d],[1,0,-ss.d],[ss.d,1,0],[0,ss.d,1],[-1,0,ss.d],[-ss.d,-1,0],[0,-ss.d,-1],[ss.d,-1,0],[1,0,ss.d],[0,-ss.d,1]],[]);s.setIndices(),s.calcCoeffs(),s.createInnerFacets(),s.edgeVecsABOB(),s.mapABOBtoOBOA(),s.mapABOBtoBAOA();for(let h=0;h<s.IDATA.face.length;h++)s.MapToFace(h,k),k.innerToData(h,s),"B"===s.IDATA.edgematch[h][1]&&k.mapABOBtoDATA(h,s),"O"===s.IDATA.edgematch[h][1]&&k.mapOBOAtoDATA(h,s),"A"===s.IDATA.edgematch[h][3]&&k.mapBAOAtoDATA(h,s);k.orderData(s);return k.vertex=k.vertex.map((function(s){const k=s[0],h=s[1],A=s[2],g=Math.sqrt(k*k+h*h+A*A);return s[0]*=1/g,s[1]*=1/g,s[2]*=1/g,s})),k}}g.e._GoldbergMeshParser=(s,k)=>mk.Parse(s,k);class mk extends g.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(s,k){return void 0===k?(s>this.goldbergData.nbUnsharedFaces-1&&(e.c.Warn("Maximum number of unshared faces used"),s=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+s):(s>11&&(e.c.Warn("Last pole used"),s=11),k>this.goldbergData.nbFacesAtPole-1&&(e.c.Warn("Maximum number of faces at a pole used"),k=this.goldbergData.nbFacesAtPole-1),12+s*this.goldbergData.nbFacesAtPole+k)}_changeGoldbergFaceColors(s){for(let h=0;h<s.length;h++){const k=s[h][0],A=s[h][1],g=s[h][2];for(let s=k;s<A+1;s++)this.goldbergData.faceColors[s]=g}const k=[];for(let h=0;h<12;h++)for(let s=0;s<5;s++)k.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);for(let h=12;h<this.goldbergData.faceColors.length;h++)for(let s=0;s<6;s++)k.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);return k}setGoldbergFaceColors(s){const k=this._changeGoldbergFaceColors(s);this.qs(ms.e.ColorKind,k)}updateGoldbergFaceColors(s){const k=this._changeGoldbergFaceColors(s);this.updateVerticesData(ms.e.ColorKind,k)}_changeGoldbergFaceUVs(s){const k=this.getVerticesData(ms.e.UVKind);for(let h=0;h<s.length;h++){const A=s[h][0],g=s[h][1],ms=s[h][2],i=s[h][3],K=s[h][4],H=[],O=[];let c,S;for(let s=0;s<5;s++)c=ms.x+i*Math.cos(K+s*Math.PI/2.5),S=ms.y+i*Math.sin(K+s*Math.PI/2.5),c<0&&(c=0),c>1&&(c=1),H.push(c,S);for(let s=0;s<6;s++)c=ms.x+i*Math.cos(K+s*Math.PI/3),S=ms.y+i*Math.sin(K+s*Math.PI/3),c<0&&(c=0),c>1&&(c=1),O.push(c,S);for(let s=A;s<Math.min(12,g+1);s++)for(let h=0;h<5;h++)k[10*s+2*h]=H[2*h],k[10*s+2*h+1]=H[2*h+1];for(let s=Math.max(12,A);s<g+1;s++)for(let h=0;h<6;h++)k[12*s-24+2*h]=O[2*h],k[12*s-23+2*h]=O[2*h+1]}return k}setGoldbergFaceUVs(s){const k=this._changeGoldbergFaceUVs(s);this.qs(ms.e.UVKind,k)}updateGoldbergFaceUVs(s){const k=this._changeGoldbergFaceUVs(s);this.updateVerticesData(ms.e.UVKind,k)}placeOnGoldbergFaceAt(s,k,h){const g=A.Pk.RotationFromAxis(this.goldbergData.faceXaxis[k],this.goldbergData.faceYaxis[k],this.goldbergData.faceZaxis[k]);s.rotation=g,s.position=this.goldbergData.faceCenters[k].add(this.goldbergData.faceXaxis[k].scale(h.x)).add(this.goldbergData.faceYaxis[k].scale(h.y)).add(this.goldbergData.faceZaxis[k].scale(h.z))}serialize(s){super.serialize(s),s.type="GoldbergMesh";const k={};if(k.adjacentFaces=this.goldbergData.adjacentFaces,k.nbSharedFaces=this.goldbergData.nbSharedFaces,k.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,k.nbFaces=this.goldbergData.nbFaces,k.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){k.faceColors=[];for(const s of this.goldbergData.faceColors)k.faceColors.push(s.yh())}if(this.goldbergData.faceCenters){k.faceCenters=[];for(const s of this.goldbergData.faceCenters)k.faceCenters.push(s.yh())}if(this.goldbergData.faceZaxis){k.faceZaxis=[];for(const s of this.goldbergData.faceZaxis)k.faceZaxis.push(s.yh())}if(this.goldbergData.faceYaxis){k.faceYaxis=[];for(const s of this.goldbergData.faceYaxis)k.faceYaxis.push(s.yh())}if(this.goldbergData.faceXaxis){k.faceXaxis=[];for(const s of this.goldbergData.faceXaxis)k.faceXaxis.push(s.yh())}s.goldbergData=k}static Parse(s,k){const h=s.goldbergData;h.faceColors=h.faceColors.map((s=>a.jg.uk(s))),h.faceCenters=h.faceCenters.map((s=>A.Pk.uk(s))),h.faceZaxis=h.faceZaxis.map((s=>A.Pk.uk(s))),h.faceXaxis=h.faceXaxis.map((s=>A.Pk.uk(s))),h.faceYaxis=h.faceYaxis.map((s=>A.Pk.uk(s)));const g=new mk(s.name,k);return g.goldbergData=h,g}}var is=h(13158);const Ks={CreateBox:S.c,CreateTiledBox:j,CreateSphere:P.c,CreateDisc:c.e,CreateIcoSphere:V,CreateRibbon:O,CreateCylinder:B,CreateTorus:G,CreateTorusKnot:p,CreateLineSystem:I.e,bO:I.i,CreateDashedLines:I.d,ExtrudeShape:t,ExtrudeShapeCustom:z,CreateLathe:v,CreateTiledPlane:d,CO:Y.d,CreateGround:n.f,CreateTiledGround:n.h,CreateGroundFromHeightMap:n.e,CreatePolygon:N.d,ExtrudePolygon:N.e,CreateTube:T,CreatePolyhedron:q,CreateGeodesic:function(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=k.m||1;A!==Math.floor(A)&&(A=Math.floor(A),e.c.Warn("m not an integer only floor(m) used"));let g=k.n||0;if(g!==Math.floor(g)&&(g=Math.floor(g),e.c.Warn("n not an integer only floor(n) used")),g>A){const s=g;g=A,A=s,e.c.Warn("n > m therefore m and n swapped")}const ms=new hs;return ms.build(A,g),q(s,{custom:gs.BuildGeodesicData(ms),size:k.size,sizeX:k.sizeX,sizeY:k.sizeY,sizeZ:k.sizeZ,faceUV:k.faceUV,faceColors:k.faceColors,flat:k.flat,updatable:k.updatable,sideOrientation:k.sideOrientation,frontUVs:k.frontUVs,backUVs:k.backUVs},h)},CreateGoldberg:function(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const ms=k.size,H=k.sizeX||ms||1,O=k.sizeY||ms||1,c=k.sizeZ||ms||1;let S=k.m||1;S!==Math.floor(S)&&(S=Math.floor(S),e.c.Warn("m not an integer only floor(m) used"));let r=k.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),e.c.Warn("n not an integer only floor(n) used")),r>S){const s=r;r=S,S=s,e.c.Warn("n > m therefore m and n swapped")}const d=new hs;d.build(S,r);const E=gs.BuildGeodesicData(d),j=E.toGoldbergPolyhedronData(),P=new mk(s,h);k.sideOrientation=g.e._GetDefaultSideOrientation(k.sideOrientation),P._originalBuilderSideOrientation=k.sideOrientation;(function(s,k){const h=s.size,g=s.sizeX||h||1,ms=s.sizeY||h||1,H=s.sizeZ||h||1,O=0===s.sideOrientation?0:s.sideOrientation||i.c.DEFAULTSIDE,c=[],S=[],a=[],r=[];let d=1/0,E=-1/0,j=1/0,P=-1/0;for(let A=0;A<k.vertex.length;A++)d=Math.min(d,k.vertex[A][0]*g),E=Math.max(E,k.vertex[A][0]*g),j=Math.min(j,k.vertex[A][1]*ms),P=Math.max(P,k.vertex[A][1]*ms);let R=0;for(let i=0;i<k.face.length;i++){const s=k.face[i],h=A.Pk.uk(k.vertex[s[0]]),O=A.Pk.uk(k.vertex[s[2]]),D=A.Pk.uk(k.vertex[s[1]]),w=O.Rk(h),B=D.Rk(h),u=A.Pk.Cross(B,w).normalize();for(let A=0;A<s.length;A++){a.push(u.x,u.y,u.z);const h=k.vertex[s[A]];c.push(h[0]*g,h[1]*ms,h[2]*H);const i=(h[1]*ms-j)/(P-j);r.push((h[0]*g-d)/(E-d),K.d?1-i:i)}for(let k=0;k<s.length-2;k++)S.push(R,R+k+2,R+k+1);R+=s.length}i.c._ComputeSides(O,c,S,a,r);const D=new i.c;return D.bs=c,D.indices=S,D.ts=a,D.Cs=r,D})(k,j).Ys(P,k.updatable),P.goldbergData.nbSharedFaces=E.sharedNodes,P.goldbergData.nbUnsharedFaces=E.poleNodes,P.goldbergData.adjacentFaces=E.adjacentFaces,P.goldbergData.nbFaces=P.goldbergData.nbSharedFaces+P.goldbergData.nbUnsharedFaces,P.goldbergData.nbFacesAtPole=(P.goldbergData.nbUnsharedFaces-12)/12;for(let g=0;g<E.vertex.length;g++)P.goldbergData.faceCenters.push(A.Pk.uk(E.vertex[g])),P.goldbergData.faceCenters[g].x*=H,P.goldbergData.faceCenters[g].y*=O,P.goldbergData.faceCenters[g].z*=c,P.goldbergData.faceColors.push(new a.jg(1,1,1,1));for(let g=0;g<j.face.length;g++){const s=j.face[g],k=A.Pk.uk(j.vertex[s[0]]),h=A.Pk.uk(j.vertex[s[2]]),ms=A.Pk.uk(j.vertex[s[1]]),i=h.Rk(k),K=ms.Rk(k),H=A.Pk.Cross(K,i).normalize(),O=A.Pk.Cross(K,H).normalize();P.goldbergData.faceXaxis.push(K.normalize()),P.goldbergData.faceYaxis.push(H),P.goldbergData.faceZaxis.push(O)}return P},CreateDecal:o,CreateCapsule:f,CreateText:is.d}},13903:(s,k,h)=>{"use strict";h.d(k,{b:()=>Kk});var A=h(12590),g=h(13001);class ms extends g.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var i=h(12636),K=(h(12764),h(12543));class H{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(s){this._targetStopDuration!==s&&(this._targetStopDuration=s)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(s){this._noiseTexture!==s&&(this._noiseTexture=s,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(s){this._animationSheetEnabled!==s&&(this._animationSheetEnabled=s)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(s){this._isAnimationSheetEnabled!=s&&(this._isAnimationSheetEnabled=s,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(s){this._useLogarithmicDepth=s&&this.Is().getEngine().getCaps().fragmentDepthSupported}Is(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(s){switch(s){case H.BLENDMODE_MULTIPLYADD:return;case H.BLENDMODE_ADD:s=1;break;case H.BLENDMODE_ONEONE:s=6;break;case H.BLENDMODE_STANDARD:s=2;break;case H.BLENDMODE_MULTIPLY:s=4;break;case H.BLENDMODE_SUBTRACT:s=3}this._engine.setAlphaMode(s)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:A.Pk.Zero()}set direction1(s){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=s)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:A.Pk.Zero()}set direction2(s){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=s)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:A.Pk.Zero()}set minEmitBox(s){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=s)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:A.Pk.Zero()}set maxEmitBox(s){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=s)}get billboardMode(){return this._billboardMode}set billboardMode(s){this._billboardMode!==s&&(this._billboardMode=s,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(s){this._isBillboardBased!==s&&(this._isBillboardBased=s,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(s){this._attachImageProcessingConfiguration(s)}_attachImageProcessingConfiguration(s){s!==this._imageProcessingConfiguration&&(!s&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=s)}_reset(){}_removeGradientAndTexture(s,k,h){if(!k)return this;let A=0;for(const g of k){if(g.gradient===s){k.splice(A,1);break}A++}return h&&h.dispose(),this}constructor(s){this.animations=[],this.renderingGroupId=0,this.ik=A.Pk.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new A.Pk(10,10,10),this.onAnimationEnd=null,this.blendMode=H.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new A.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.pO=new A.Pk(0,0,0),this._useLogarithmicDepth=!1,this.gravity=A.Pk.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new i.jg(1,1,1,1),this.color2=new i.jg(1,1,1,1),this.colorDead=new i.jg(0,0,0,1),this.textureMask=new i.jg(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new ms,this.id=s,this.name=s}createPointEmitter(s,k){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new A.Pk(0,1,0),arguments.length>2&&void 0!==arguments[2]||new A.Pk(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new A.Pk(0,1,0),arguments.length>4&&void 0!==arguments[4]||new A.Pk(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new A.Pk(0,1,0),arguments.length>3&&void 0!==arguments[3]||new A.Pk(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(s,k,h,A){throw new Error("Method not implemented.")}}H.BLENDMODE_ONEONE=0,H.BLENDMODE_STANDARD=1,H.BLENDMODE_ADD=2,H.BLENDMODE_MULTIPLY=3,H.BLENDMODE_MULTIPLYADD=4,H.BLENDMODE_SUBTRACT=-1,(0,K.f)("BABYLON.BaseParticleSystem",H);var O=h(12607),c=h(12429);class S{constructor(){this.direction1=new A.Pk(0,1,0),this.direction2=new A.Pk(0,1,0),this.minEmitBox=new A.Pk(-.5,-.5,-.5),this.maxEmitBox=new A.Pk(.5,.5,.5)}startDirectionFunction(s,k,h,g){const ms=(0,O.RandomRange)(this.direction1.x,this.direction2.x),i=(0,O.RandomRange)(this.direction1.y,this.direction2.y),K=(0,O.RandomRange)(this.direction1.z,this.direction2.z);if(g)return k.x=ms,k.y=i,void(k.z=K);A.Pk.TransformNormalFromFloatsToRef(ms,i,K,s,k)}startPositionFunction(s,k,h,g){const ms=(0,O.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),i=(0,O.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),K=(0,O.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(g)return k.x=ms,k.y=i,void(k.z=K);A.Pk.TransformCoordinatesFromFloatsToRef(ms,i,K,s,k)}clone(){const s=new S;return c.e.DeepCopy(this,s),s}applyToShader(s){s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2),s.setVector3("minEmitBox",this.minEmitBox),s.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(s){s.addUniform("direction1",3),s.addUniform("direction2",3),s.addUniform("minEmitBox",3),s.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.direction1=this.direction1.yh(),s.direction2=this.direction2.yh(),s.minEmitBox=this.minEmitBox.yh(),s.maxEmitBox=this.maxEmitBox.yh(),s}parse(s){A.Pk.FromArrayToRef(s.direction1,0,this.direction1),A.Pk.FromArrayToRef(s.direction2,0,this.direction2),A.Pk.FromArrayToRef(s.minEmitBox,0,this.minEmitBox),A.Pk.FromArrayToRef(s.maxEmitBox,0,this.maxEmitBox)}}class a{get radius(){return this._radius}set radius(s){this._radius=s,this._buildHeight()}get angle(){return this._angle}set angle(s){this._angle=s,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=h,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=k,this.radius=s}startDirectionFunction(s,k,h,g){g?A.TmpVectors.Pk[0].H(h.gH).normalize():h.position.subtractToRef(s.getTranslation(),A.TmpVectors.Pk[0]).normalize();const ms=(0,O.RandomRange)(0,this.directionRandomizer),i=(0,O.RandomRange)(0,this.directionRandomizer),K=(0,O.RandomRange)(0,this.directionRandomizer);k.x=A.TmpVectors.Pk[0].x+ms,k.y=A.TmpVectors.Pk[0].y+i,k.z=A.TmpVectors.Pk[0].z+K,k.normalize()}startPositionFunction(s,k,h,g){const ms=(0,O.RandomRange)(0,2*Math.PI);let i;this.emitFromSpawnPointOnly?i=1e-4:(i=(0,O.RandomRange)(0,this.heightRange),i=1-i*i);let K=this._radius-(0,O.RandomRange)(0,this._radius*this.radiusRange);K*=i;const H=K*Math.sin(ms),c=K*Math.cos(ms),S=i*this._height;if(g)return k.x=H,k.y=S,void(k.z=c);A.Pk.TransformCoordinatesFromFloatsToRef(H,S,c,s,k)}clone(){const s=new a(this._radius,this._angle,this.directionRandomizer);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat2("radius",this._radius,this.radiusRange),s.setFloat("coneAngle",this._angle),s.setFloat2("height",this._height,this.heightRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",2),s.addUniform("coneAngle",1),s.addUniform("height",2),s.addUniform("directionRandomizer",1)}getEffectDefines(){let s="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(s+="\n#define CONEEMITTERSPAWNPOINT"),s}getClassName(){return"ConeParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this._radius,s.angle=this._angle,s.directionRandomizer=this.directionRandomizer,s.radiusRange=this.radiusRange,s.heightRange=this.heightRange,s.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,s}parse(s){this.radius=s.radius,this.angle=s.angle,this.directionRandomizer=s.directionRandomizer,this.radiusRange=void 0!==s.radiusRange?s.radiusRange:1,this.heightRange=void 0!==s.radiusRange?s.heightRange:1,this.emitFromSpawnPointOnly=void 0!==s.emitFromSpawnPointOnly&&s.emitFromSpawnPointOnly}}class r extends a{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0);super(s,k),this.direction1=h,this.direction2=g}startDirectionFunction(s,k){const h=(0,O.RandomRange)(this.direction1.x,this.direction2.x),g=(0,O.RandomRange)(this.direction1.y,this.direction2.y),ms=(0,O.RandomRange)(this.direction1.z,this.direction2.z);A.Pk.TransformNormalFromFloatsToRef(h,g,ms,s,k)}clone(){const s=new r(this.radius,this.angle,this.direction1,this.direction2);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const s=super.serialize();return s.direction1=this.direction1.yh(),s.direction2=this.direction2.yh(),s}parse(s){super.parse(s),this.direction1.H(s.direction1),this.direction2.H(s.direction2)}}class d{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=s,this.height=k,this.radiusRange=h,this.directionRandomizer=g,this._tempVector=A.Pk.Zero()}startDirectionFunction(s,k,h,g,ms){h.position.subtractToRef(s.getTranslation(),this._tempVector),this._tempVector.normalize(),A.Pk.TransformNormalToRef(this._tempVector,ms,this._tempVector);const i=(0,O.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let K=Math.atan2(this._tempVector.x,this._tempVector.z);K+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=i,this._tempVector.x=Math.sin(K),this._tempVector.z=Math.cos(K),this._tempVector.normalize(),g?k.H(this._tempVector):A.Pk.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,s,k)}startPositionFunction(s,k,h,g){const ms=(0,O.RandomRange)(-this.height/2,this.height/2),i=(0,O.RandomRange)(0,2*Math.PI),K=(0,O.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),H=Math.sqrt(K)*this.radius,c=H*Math.cos(i),S=H*Math.sin(i);g?k.cg(c,ms,S):A.Pk.TransformCoordinatesFromFloatsToRef(c,ms,S,s,k)}clone(){const s=new d(this.radius,this.directionRandomizer);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("height",this.height),s.setFloat("radiusRange",this.radiusRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("height",1),s.addUniform("radiusRange",1),s.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this.radius,s.height=this.height,s.radiusRange=this.radiusRange,s.directionRandomizer=this.directionRandomizer,s}parse(s){this.radius=s.radius,this.height=s.height,this.radiusRange=s.radiusRange,this.directionRandomizer=s.directionRandomizer}}class E extends d{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0),ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Pk(0,1,0);super(s,k,h),this.direction1=g,this.direction2=ms}startDirectionFunction(s,k,h,g){const ms=(0,O.RandomRange)(this.direction1.x,this.direction2.x),i=(0,O.RandomRange)(this.direction1.y,this.direction2.y),K=(0,O.RandomRange)(this.direction1.z,this.direction2.z);g?k.cg(ms,i,K):A.Pk.TransformNormalFromFloatsToRef(ms,i,K,s,k)}clone(){const s=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("height",this.height),s.setFloat("radiusRange",this.radiusRange),s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("height",1),s.addUniform("radiusRange",1),s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const s=super.serialize();return s.direction1=this.direction1.yh(),s.direction2=this.direction2.yh(),s}parse(s){super.parse(s),A.Pk.FromArrayToRef(s.direction1,0,this.direction1),A.Pk.FromArrayToRef(s.direction2,0,this.direction2)}}class j{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=s,this.radiusRange=k,this.directionRandomizer=h}startDirectionFunction(s,k,h,g){const ms=h.position.Rk(s.getTranslation()).normalize(),i=(0,O.RandomRange)(0,this.directionRandomizer),K=(0,O.RandomRange)(0,this.directionRandomizer),H=(0,O.RandomRange)(0,this.directionRandomizer);ms.x+=i,ms.y+=K,ms.z+=H,ms.normalize(),g?k.H(ms):A.Pk.TransformNormalFromFloatsToRef(ms.x,ms.y,ms.z,s,k)}startPositionFunction(s,k,h,g){const ms=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),i=(0,O.RandomRange)(0,1),K=(0,O.RandomRange)(0,2*Math.PI),H=Math.acos(2*i-1),c=ms*Math.cos(K)*Math.sin(H),S=ms*Math.cos(H),a=ms*Math.sin(K)*Math.sin(H);g?k.cg(c,Math.abs(S),a):A.Pk.TransformCoordinatesFromFloatsToRef(c,Math.abs(S),a,s,k)}clone(){const s=new j(this.radius,this.directionRandomizer);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this.radius,s.radiusRange=this.radiusRange,s.directionRandomizer=this.directionRandomizer,s}parse(s){this.radius=s.radius,this.radiusRange=s.radiusRange,this.directionRandomizer=s.directionRandomizer}}class P{constructor(){this.direction1=new A.Pk(0,1,0),this.direction2=new A.Pk(0,1,0)}startDirectionFunction(s,k,h,g){const ms=(0,O.RandomRange)(this.direction1.x,this.direction2.x),i=(0,O.RandomRange)(this.direction1.y,this.direction2.y),K=(0,O.RandomRange)(this.direction1.z,this.direction2.z);g?k.cg(ms,i,K):A.Pk.TransformNormalFromFloatsToRef(ms,i,K,s,k)}startPositionFunction(s,k,h,g){g?k.cg(0,0,0):A.Pk.TransformCoordinatesFromFloatsToRef(0,0,0,s,k)}clone(){const s=new P;return c.e.DeepCopy(this,s),s}applyToShader(s){s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.direction1=this.direction1.yh(),s.direction2=this.direction2.yh(),s}parse(s){A.Pk.FromArrayToRef(s.direction1,0,this.direction1),A.Pk.FromArrayToRef(s.direction2,0,this.direction2)}}class R{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=s,this.radiusRange=k,this.directionRandomizer=h}startDirectionFunction(s,k,h,g){const ms=h.position.Rk(s.getTranslation()).normalize(),i=(0,O.RandomRange)(0,this.directionRandomizer),K=(0,O.RandomRange)(0,this.directionRandomizer),H=(0,O.RandomRange)(0,this.directionRandomizer);ms.x+=i,ms.y+=K,ms.z+=H,ms.normalize(),g?k.H(ms):A.Pk.TransformNormalFromFloatsToRef(ms.x,ms.y,ms.z,s,k)}startPositionFunction(s,k,h,g){const ms=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),i=(0,O.RandomRange)(0,1),K=(0,O.RandomRange)(0,2*Math.PI),H=Math.acos(2*i-1),c=ms*Math.cos(K)*Math.sin(H),S=ms*Math.cos(H),a=ms*Math.sin(K)*Math.sin(H);g?k.cg(c,S,a):A.Pk.TransformCoordinatesFromFloatsToRef(c,S,a,s,k)}clone(){const s=new R(this.radius,this.directionRandomizer);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.radius=this.radius,s.radiusRange=this.radiusRange,s.directionRandomizer=this.directionRandomizer,s}parse(s){this.radius=s.radius,this.radiusRange=s.radiusRange,this.directionRandomizer=s.directionRandomizer}}class D extends R{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Pk(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0);super(s),this.direction1=k,this.direction2=h}startDirectionFunction(s,k){const h=(0,O.RandomRange)(this.direction1.x,this.direction2.x),g=(0,O.RandomRange)(this.direction1.y,this.direction2.y),ms=(0,O.RandomRange)(this.direction1.z,this.direction2.z);A.Pk.TransformNormalFromFloatsToRef(h,g,ms,s,k)}clone(){const s=new D(this.radius,this.direction1,this.direction2);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setFloat("radius",this.radius),s.setFloat("radiusRange",this.radiusRange),s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("radius",1),s.addUniform("radiusRange",1),s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const s=super.serialize();return s.direction1=this.direction1.yh(),s.direction2=this.direction2.yh(),s}parse(s){super.parse(s),this.direction1.H(s.direction1),this.direction2.H(s.direction2)}}class w{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(s,k,h,g){const ms=A.TmpVectors.Pk[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,h,ms);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,h,ms);const s=A.TmpVectors.Pk[1];ms.subtractToRef(h.position,s),s.scaleToRef(1/h.lifeTime,ms)}else ms.set(0,0,0);g?k.H(ms):A.Pk.TransformNormalToRef(ms,s,k)}startPositionFunction(s,k,h,g){const ms=A.TmpVectors.Pk[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,h,ms):ms.set(0,0,0),g?k.H(ms):A.Pk.TransformCoordinatesToRef(ms,s,k)}clone(){const s=new w;return c.e.DeepCopy(this,s),s}applyToShader(s){}buildUniformLayout(s){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const s={};return s.type=this.getClassName(),s.particlePositionGenerator=this.particlePositionGenerator,s.particleDestinationGenerator=this.particleDestinationGenerator,s}parse(s){s.particlePositionGenerator&&(this.particlePositionGenerator=s.particlePositionGenerator),s.particleDestinationGenerator&&(this.particleDestinationGenerator=s.particleDestinationGenerator)}}var B=h(12664);class u{get mesh(){return this._mesh}set mesh(s){this._mesh!==s&&(this._mesh=s,s?(this._indices=s.sg(),this._positions=s.getVerticesData(B.e.PositionKind),this._normals=s.getVerticesData(B.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=A.Pk.Zero(),this._mesh=null,this.direction1=new A.Pk(0,1,0),this.direction2=new A.Pk(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=s}startDirectionFunction(s,k,h,g){if(this.useMeshNormalsForDirection&&this._normals)return void A.Pk.TransformNormalToRef(this._storedNormal,s,k);const ms=(0,O.RandomRange)(this.direction1.x,this.direction2.x),i=(0,O.RandomRange)(this.direction1.y,this.direction2.y),K=(0,O.RandomRange)(this.direction1.z,this.direction2.z);g?k.cg(ms,i,K):A.Pk.TransformNormalFromFloatsToRef(ms,i,K,s,k)}startPositionFunction(s,k,h,g){if(!this._indices||!this._positions)return;const ms=3*(Math.random()*(this._indices.length/3)|0),i=Math.random(),K=Math.random()*(1-i),H=1-i-K,O=this._indices[ms],c=this._indices[ms+1],S=this._indices[ms+2],a=A.TmpVectors.Pk[0],r=A.TmpVectors.Pk[1],d=A.TmpVectors.Pk[2],E=A.TmpVectors.Pk[3];A.Pk.FromArrayToRef(this._positions,3*O,a),A.Pk.FromArrayToRef(this._positions,3*c,r),A.Pk.FromArrayToRef(this._positions,3*S,d),E.x=i*a.x+K*r.x+H*d.x,E.y=i*a.y+K*r.y+H*d.y,E.z=i*a.z+K*r.z+H*d.z,g?k.cg(E.x,E.y,E.z):A.Pk.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,s,k),this.useMeshNormalsForDirection&&this._normals&&(A.Pk.FromArrayToRef(this._normals,3*O,a),A.Pk.FromArrayToRef(this._normals,3*c,r),A.Pk.FromArrayToRef(this._normals,3*S,d),this._storedNormal.x=i*a.x+K*r.x+H*d.x,this._storedNormal.y=i*a.y+K*r.y+H*d.y,this._storedNormal.z=i*a.z+K*r.z+H*d.z)}clone(){const s=new u(this.mesh);return c.e.DeepCopy(this,s),s}applyToShader(s){s.setVector3("direction1",this.direction1),s.setVector3("direction2",this.direction2)}buildUniformLayout(s){s.addUniform("direction1",3),s.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var s;const k={};return k.type=this.getClassName(),k.direction1=this.direction1.yh(),k.direction2=this.direction2.yh(),k.meshId=null===(s=this.mesh)||void 0===s?void 0:s.id,k.useMeshNormalsForDirection=this.useMeshNormalsForDirection,k}parse(s,k){A.Pk.FromArrayToRef(s.direction1,0,this.direction1),A.Pk.FromArrayToRef(s.direction2,0,this.direction2),s.meshId&&k&&(this.mesh=k.getLastMeshById(s.meshId)),this.useMeshNormalsForDirection=s.useMeshNormalsForDirection}}class G{_isUbo(s){return void 0!==s.addUniform}constructor(s){this._isUbo(s)?(this.setMatrix3x3=s.updateMatrix3x3.bind(s),this.setMatrix2x2=s.updateMatrix2x2.bind(s),this.setFloat=s.updateFloat.bind(s),this.setFloat2=s.updateFloat2.bind(s),this.setFloat3=s.updateFloat3.bind(s),this.setFloat4=s.updateFloat4.bind(s),this.setFloatArray=s.updateFloatArray.bind(s),this.setArray=s.updateArray.bind(s),this.setIntArray=s.updateIntArray.bind(s),this.setMatrix=s.Fh.bind(s),this.setMatrices=s.updateMatrices.bind(s),this.setVector3=s.updateVector3.bind(s),this.setVector4=s.updateVector4.bind(s),this.setColor3=s.updateColor3.bind(s),this.setColor4=s.updateColor4.bind(s),this.setDirectColor4=s.updateDirectColor4.bind(s),this.setInt=s.updateInt.bind(s),this.setInt2=s.updateInt2.bind(s),this.setInt3=s.updateInt3.bind(s),this.setInt4=s.updateInt4.bind(s)):(this.setMatrix3x3=s.setMatrix3x3.bind(s),this.setMatrix2x2=s.setMatrix2x2.bind(s),this.setFloat=s.setFloat.bind(s),this.setFloat2=s.setFloat2.bind(s),this.setFloat3=s.setFloat3.bind(s),this.setFloat4=s.setFloat4.bind(s),this.setFloatArray=s.setFloatArray.bind(s),this.setArray=s.setArray.bind(s),this.setIntArray=s.setIntArray.bind(s),this.setMatrix=s.setMatrix.bind(s),this.setMatrices=s.setMatrices.bind(s),this.setVector3=s.setVector3.bind(s),this.setVector4=s.setVector4.bind(s),this.setColor3=s.setColor3.bind(s),this.setColor4=s.setColor4.bind(s),this.setDirectColor4=s.setDirectColor4.bind(s),this.setInt=s.setInt.bind(s),this.setInt2=s.setInt2.bind(s),this.setInt3=s.setInt3.bind(s),this.setInt4=s.setInt4.bind(s))}}var Q=h(12493);const p="gpuUpdateParticlesPixelShader",I="#version 300 es\nvoid main() {discard;}\n";Q.e.ShadersStore[p]||(Q.e.ShadersStore[p]=I);const N="gpuUpdateParticlesVertexShader",b="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Q.e.ShadersStore[N]||(Q.e.ShadersStore[N]=b);(0,K.f)("BABYLON.WebGL2ParticleSystem",class{constructor(s,k){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=s,this._engine=k,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var s;return(null===(s=this._updateEffect)||void 0===s?void 0:s.isReady())??!1}createUpdateBuffer(s){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof w&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=s,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new G(this._updateEffect)}createVertexBuffers(s,k){this._updateVAO.push(this._createUpdateVAO(s)),this._renderVAO.push(this._engine.recordVertexArrayObject(k,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=k}createParticleBuffer(s){return s}bindDrawBuffers(s,k,h){h?this._engine.bindBuffers(this._renderVertexBuffers,h,k):this._engine.bindVertexArrayObject(this._renderVAO[s],null)}preUpdateParticleBuffer(){const s=this._engine;if(this._engine.enableEffect(this._updateEffect),!s.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(s,k,h){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[s],null);const A=this._engine;A.bindTransformFeedbackBuffer(k.getBuffer()),A.setRasterizerState(!1),A.beginTransformFeedback(!0),A.drawArraysType(3,0,h),A.endTransformFeedback(),A.setRasterizerState(!0),A.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let s=0;s<this._updateVAO.length;s++)this._engine.releaseVertexArrayObject(this._updateVAO[s]);this._updateVAO.length=0;for(let s=0;s<this._renderVAO.length;s++)this._engine.releaseVertexArrayObject(this._renderVAO[s]);this._renderVAO.length=0}_createUpdateVAO(s){const k={};k.position=s.createVertexBuffer("position",0,3);let h=3;k.age=s.createVertexBuffer("age",h,1),h+=1,k.size=s.createVertexBuffer("size",h,3),h+=3,k.life=s.createVertexBuffer("life",h,1),h+=1,k.seed=s.createVertexBuffer("seed",h,4),h+=4,k.direction=s.createVertexBuffer("direction",h,3),h+=3,this._parent.particleEmitterType instanceof w&&(k.initialPosition=s.createVertexBuffer("initialPosition",h,3),h+=3),this._parent._colorGradientsTexture||(k.color=s.createVertexBuffer("color",h,4),h+=4),this._parent._isBillboardBased||(k.initialDirection=s.createVertexBuffer("initialDirection",h,3),h+=3),this._parent.noiseTexture&&(k.noiseCoordinates1=s.createVertexBuffer("noiseCoordinates1",h,3),h+=3,k.noiseCoordinates2=s.createVertexBuffer("noiseCoordinates2",h,3),h+=3),this._parent._angularSpeedGradientsTexture?(k.angle=s.createVertexBuffer("angle",h,1),h+=1):(k.angle=s.createVertexBuffer("angle",h,2),h+=2),this._parent._isAnimationSheetEnabled&&(k.cellIndex=s.createVertexBuffer("cellIndex",h,1),h+=1,this._parent.spriteRandomStartCell&&(k.cellStartOffset=s.createVertexBuffer("cellStartOffset",h,1),h+=1));const A=this._engine.recordVertexArrayObject(k,null,this._updateEffect);return this._engine.bindArrayBuffer(null),A}});class t{constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3?arguments[3]:void 0;this._engine=s,this._label=A,this._engine._storageBuffers.push(this),this._create(k,h)}_create(s,k){this._bufferSize=s,this._creationFlags=k,this._buffer=this._engine.createStorageBuffer(s,k,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(s,k,h){this._buffer&&this._engine.updateStorageBuffer(this._buffer,s,k,h)}async read(s,k,h,A){return await this._engine.readFromStorageBuffer(this._buffer,s,k,h,A)}dispose(){const s=this._engine._storageBuffers,k=s.indexOf(this);-1!==k&&(s[k]=s[s.length-1],s.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var z=h(12570),C=h(12579),v=h(12623),Y=h(12567),n=h(12896),T=h(12422),U=h(12523),q=h(12811);class M{constructor(){this._gpuTimeInFrameId=-1,this.counter=new q.c}_addDuration(s,k){s<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==s?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(k,!1),this._gpuTimeInFrameId=s):this.counter.addCount(k,!1))}}var V=h(12476);class X{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=s,this._engine=k,this.uniqueId=n.b.UniqueId,k.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new M),this._engine.getCaps().supportComputeShaders?A.bindingsMapping?(this._context=k.createComputeContext(),this._shaderPath=h,this._options={bindingsMapping:{},defines:[],...A}):T.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):T.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(s,k){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const A=this._bindings[s];this._bindings[s]={type:h?0:4,object:k,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!A||A.object!==k||A.type!==this._bindings[s].type)}setStorageTexture(s,k){const h=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==k),this._bindings[s]={type:1,object:k,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setExternalTexture(s,k){const h=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==k),this._bindings[s]={type:6,object:k,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setVideoTexture(s,k){return!!k.externalTexture&&(this.setExternalTexture(s,k.externalTexture),!0)}setUniformBuffer(s,k){const h=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==k),this._bindings[s]={type:X._BufferIsDataBuffer(k)?7:2,object:k,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setStorageBuffer(s,k){const h=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==k),this._bindings[s]={type:X._BufferIsDataBuffer(k)?7:3,object:k,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setTextureSampler(s,k){const h=this._bindings[s];this._contextIsDirty||(this._contextIsDirty=!h||!k.compareSampler(h.object)),this._bindings[s]={type:5,object:k,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}isReady(){let s=this._effect;for(const g in this._bindings){const s=this._bindings[g],k=s.type,h=s.object;switch(k){case 0:case 4:case 1:if(!h.isReady())return!1;break;case 6:if(!h.isReady())return!1;break}}const k=[],h=this._shaderPath;if(this._options.defines)for(let g=0;g<this._options.defines.length;g++)k.push(this._options.defines[g]);const A=k.join("\n");return this._cachedDefines!==A&&(this._cachedDefines=A,s=this._engine.createComputeEffect(h,{defines:A,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=s),!!s.isReady()}dispatch(s,k,h){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,s,k,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const h=X._BufferIsDataBuffer(s)?s:s.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,h,k,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const k in this._bindings){const h=this._bindings[k];if(!this._options.bindingsMapping[k])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+k+"'");switch(h.type){case 0:{const A=this._samplers[k],g=h.object;var s;if(!A||!g._texture||!A.compareSampler(g._texture))this._samplers[k]=(new U.c).setParameters(g.wrapU,g.wrapV,g.wrapR,g.anisotropicFilteringLevel,g._texture.samplingMode,null===(s=g._texture)||void 0===s?void 0:s._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const s=h.object;s.getBuffer()!==h.buffer&&(h.buffer=s.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((g=>{(0,V.e)((()=>this.dispatch(s,k,h)),g,void 0,A)}))}serialize(){const s=v.e.Serialize(this);s.options=this._options,s.shaderPath=this._shaderPath,s.gr={},s.textures={};for(const k in this._bindings){const h=this._bindings[k],A=h.object;switch(h.type){case 0:case 4:case 1:{const g=A.serialize();g&&(s.textures[k]=g,s.gr[k]={type:h.type});break}}}return s}static Parse(s,k,h){const A=v.e.Parse((()=>new X(s.name,k.getEngine(),s.shaderPath,s.options)),s,k,h);for(const g in s.textures){const ms=s.gr[g],i=Y.b.Parse(s.textures[g],k,h);0===ms.type?A.setTexture(g,i):4===ms.type?A.setTexture(g,i,!1):A.setStorageTexture(g,i)}return A}static _BufferIsDataBuffer(s){return void 0!==s.underlyingResource}}(0,z.e)([(0,C.J)()],X.prototype,"name",void 0),(0,z.e)([(0,C.J)()],X.prototype,"fastMode",void 0),(0,K.f)("BABYLON.ComputeShader",X);var L=h(12863);const Z="gpuUpdateParticlesComputeShader",x="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Q.e.ShadersStoreWGSL[Z]||(Q.e.ShadersStoreWGSL[Z]=x);(0,K.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(s,k){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=s,this._engine=k}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var s;return(null===(s=this._updateComputeShader)||void 0===s?void 0:s.isReady())??!1}createUpdateBuffer(s){var k;const h={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(h.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(h.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(h.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(h.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(h.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(h.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(h.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new X("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:h,defines:s.split("\n")}),null===(k=this._simParamsComputeShader)||void 0===k||k.dispose(),this._simParamsComputeShader=new L.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new G(this._simParamsComputeShader)}createVertexBuffers(s,k){this._renderVertexBuffers.push(k)}createParticleBuffer(s){const k=new t(this._engine,4*s.length,11,"ComputeShaderParticleSystemBuffer");return k.update(s),this._bufferComputeShader.push(k),k.getBuffer()}bindDrawBuffers(s,k,h){this._engine.bindBuffers(this._renderVertexBuffers[s],h,k)}preUpdateParticleBuffer(){}updateParticleBuffer(s,k,h){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[s]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^s]),this._updateComputeShader.dispatch(Math.ceil(h/64))}releaseBuffers(){var s;for(let k=0;k<this._bufferComputeShader.length;++k)this._bufferComputeShader[k].dispose();this._bufferComputeShader.length=0,null===(s=this._simParamsComputeShader)||void 0===s||s.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class y{constructor(s,k,h){this.gradient=s,this.color1=k,this.color2=h}getColorToRef(s){this.color2?i.jg.LerpToRef(this.color1,this.color2,Math.random(),s):s.H(this.color1)}}class W{constructor(s,k){this.gradient=s,this.color=k}}class J{constructor(s,k,h){this.gradient=s,this.factor1=k,this.factor2=h}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class F{static GetCurrentGradient(s,k,h){if(k[0].gradient>s)return void h(k[0],k[0],1);for(let g=0;g<k.length-1;g++){const A=k[g],ms=k[g+1];if(s>=A.gradient&&s<=ms.gradient){return void h(A,ms,(s-A.gradient)/(ms.gradient-A.gradient))}}const A=k.length-1;h(k[A],k[A],1)}}var o=h(12408),l=h(13084),f=h(12445);class e{constructor(s){this.particleSystem=s,this.position=A.Pk.Zero(),this.direction=A.Pk.Zero(),this.color=new i.jg(0,0,0,0),this.colorStep=new i.jg(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new A.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new i.jg(0,0,0,0),this._currentColor2=new i.jg(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=e._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let s=this.age,k=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===k?(k=1,s=this._randomCellOffset):s+=this._randomCellOffset);const h=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let A;A=this._initialSpriteCellLoop?(0,O.Clamp)(s*k%this.lifeTime/this.lifeTime):(0,O.Clamp)(s*k/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+A*h|0}_inheritParticleInfoToSubEmitter(s){if(s.particleSystem.ik.position){const k=s.particleSystem.ik;if(k.position.H(this.position),s.inheritDirection){const s=A.TmpVectors.Pk[0];this.direction.normalizeToRef(s),k.setDirection(s,0,Math.PI/2)}}else{s.particleSystem.ik.H(this.position)}this.direction.scaleToRef(s.inheritedVelocityAmount/2,A.TmpVectors.Pk[0]),s.particleSystem._inheritedVelocityOffset.H(A.TmpVectors.Pk[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const s of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(s)}_reset(){this.age=0,this.id=e._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(s){s.position.H(this.position),this._initialDirection?s._initialDirection?s._initialDirection.H(this._initialDirection):s._initialDirection=this._initialDirection.clone():s._initialDirection=null,s.direction.H(this.direction),this.gH&&(s.gH?s.gH.H(this.gH):s.gH=this.gH.clone()),s.color.H(this.color),s.colorStep.H(this.colorStep),s.lifeTime=this.lifeTime,s.age=this.age,s._randomCellOffset=this._randomCellOffset,s.size=this.size,s.scale.H(this.scale),s.angle=this.angle,s.angularSpeed=this.angularSpeed,s.particleSystem=this.particleSystem,s.cellIndex=this.cellIndex,s.id=this.id,s._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(s._currentColorGradient=this._currentColorGradient,s._currentColor1.H(this._currentColor1),s._currentColor2.H(this._currentColor2)),this._currentSizeGradient&&(s._currentSizeGradient=this._currentSizeGradient,s._currentSize1=this._currentSize1,s._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(s._currentAngularSpeedGradient=this._currentAngularSpeedGradient,s._currentAngularSpeed1=this._currentAngularSpeed1,s._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(s._currentVelocityGradient=this._currentVelocityGradient,s._currentVelocity1=this._currentVelocity1,s._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(s._currentLimitVelocityGradient=this._currentLimitVelocityGradient,s._currentLimitVelocity1=this._currentLimitVelocity1,s._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(s._currentDragGradient=this._currentDragGradient,s._currentDrag1=this._currentDrag1,s._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(s._initialStartSpriteCellId=this._initialStartSpriteCellId,s._initialEndSpriteCellId=this._initialEndSpriteCellId,s._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(s.remapData&&this.remapData?s.remapData.H(this.remapData):s.remapData=new A.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(s._randomNoiseCoordinates1?(s._randomNoiseCoordinates1.H(this._randomNoiseCoordinates1),s._randomNoiseCoordinates2.H(this._randomNoiseCoordinates2)):(s._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),s._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}e._Count=0;var ss=h(12712),ks=(h(12758),h(12976)),hs=h(12968),As=h(12854);function gs(s,k){const h=(0,O.RandomRange)(0,1);i.jg.LerpToRef(k.color1,k.color2,h,s.color),k.colorDead.subtractToRef(s.color,k._colorDiff),k._colorDiff.scaleToRef(1/s.lifeTime,s.colorStep)}function mk(s,k){s._currentColorGradient=k._colorGradients[0],s._currentColorGradient.getColorToRef(s.color),s._currentColor1.H(s.color),k._colorGradients.length>1?k._colorGradients[1].getColorToRef(s._currentColor2):s._currentColor2.H(s.color)}function is(s,k){const h=k._colorGradients;F.GetCurrentGradient(k._ratio,h,((k,h,A)=>{k!==s._currentColorGradient&&(s._currentColor1.H(s._currentColor2),h.getColorToRef(s._currentColor2),s._currentColorGradient=k),i.jg.LerpToRef(s._currentColor1,s._currentColor2,A,s.color)}))}function Ks(s,k){s.colorStep.scaleToRef(k._scaledUpdateSpeed,k._scaledColorStep),s.color.addInPlace(k._scaledColorStep),s.color.a<0&&(s.color.a=0)}function Hs(s,k){F.GetCurrentGradient(k._ratio,k._angularSpeedGradients,((k,h,A)=>{k!==s._currentAngularSpeedGradient&&(s._currentAngularSpeed1=s._currentAngularSpeed2,s._currentAngularSpeed2=h.getFactor(),s._currentAngularSpeedGradient=k),s.angularSpeed=(0,O.Lerp)(s._currentAngularSpeed1,s._currentAngularSpeed2,A)}))}function Os(s,k){s.angle+=s.angularSpeed*k._scaledUpdateSpeed}function cs(s,k){k.particleEmitterType.startDirectionFunction(k._emitterWorldMatrix,s.direction,s,k.isLocal,k._emitterInverseWorldMatrix)}function Ss(s,k){k.startDirectionFunction(k._emitterWorldMatrix,s.direction,s,k.isLocal)}function as(s,k){s._currentVelocityGradient=k._velocityGradients[0],s._currentVelocity1=s._currentVelocityGradient.getFactor(),k._velocityGradients.length>1?s._currentVelocity2=k._velocityGradients[1].getFactor():s._currentVelocity2=s._currentVelocity1}function rs(s,k){s._currentLimitVelocityGradient=k._limitVelocityGradients[0],s._currentLimitVelocity1=s._currentLimitVelocityGradient.getFactor(),k._limitVelocityGradients.length>1?s._currentLimitVelocity2=k._limitVelocityGradients[1].getFactor():s._currentLimitVelocity2=s._currentLimitVelocity1}function ds(s,k){F.GetCurrentGradient(k._ratio,k._velocityGradients,((h,A,g)=>{h!==s._currentVelocityGradient&&(s._currentVelocity1=s._currentVelocity2,s._currentVelocity2=A.getFactor(),s._currentVelocityGradient=h),k._directionScale*=(0,O.Lerp)(s._currentVelocity1,s._currentVelocity2,g)}))}function Es(s,k){F.GetCurrentGradient(k._ratio,k._limitVelocityGradients,((h,A,g)=>{h!==s._currentLimitVelocityGradient&&(s._currentLimitVelocity1=s._currentLimitVelocity2,s._currentLimitVelocity2=A.getFactor(),s._currentLimitVelocityGradient=h);const ms=(0,O.Lerp)(s._currentLimitVelocity1,s._currentLimitVelocity2,g);s.direction.length()>ms&&s.direction.scaleInPlace(k.limitVelocityDamping)}))}function js(s,k){s.direction.scaleToRef(k._directionScale,k._scaledDirection)}function Ps(s,k){k.particleEmitterType.startPositionFunction(k._emitterWorldMatrix,s.position,s,k.isLocal)}function Rs(s,k){k.startPositionFunction(k._emitterWorldMatrix,s.position,s,k.isLocal)}function Ds(s,k){s.gH?s.gH.H(s.position):s.gH=s.position.clone(),A.Pk.TransformCoordinatesToRef(s.gH,k._emitterWorldMatrix,s.position)}function ws(s,k){k.isLocal&&s.gH?(s.gH.addInPlace(k._scaledDirection),A.Pk.TransformCoordinatesToRef(s.gH,k._emitterWorldMatrix,s.position)):s.position.addInPlace(k._scaledDirection)}function Bs(s,k){s._currentDragGradient=k._dragGradients[0],s._currentDrag1=s._currentDragGradient.getFactor(),k._dragGradients.length>1?s._currentDrag2=k._dragGradients[1].getFactor():s._currentDrag2=s._currentDrag1}function us(s,k){F.GetCurrentGradient(k._ratio,k._dragGradients,((h,A,g)=>{h!==s._currentDragGradient&&(s._currentDrag1=s._currentDrag2,s._currentDrag2=A.getFactor(),s._currentDragGradient=h);const ms=(0,O.Lerp)(s._currentDrag1,s._currentDrag2,g);k._scaledDirection.scaleInPlace(1-ms)}))}function Gs(s,k){s._randomNoiseCoordinates1?(s._randomNoiseCoordinates1.cg(Math.random(),Math.random(),Math.random()),s._randomNoiseCoordinates2.cg(Math.random(),Math.random(),Math.random())):(s._randomNoiseCoordinates1=new A.Pk(Math.random(),Math.random(),Math.random()),s._randomNoiseCoordinates2=new A.Pk(Math.random(),Math.random(),Math.random()))}function Qs(s,k){const h=k._noiseTextureData,g=k._noiseTextureSize;if(h&&g&&s._randomNoiseCoordinates1){const ms=k._fetchR(s._randomNoiseCoordinates1.x,s._randomNoiseCoordinates1.y,g.width,g.height,h),i=k._fetchR(s._randomNoiseCoordinates1.z,s._randomNoiseCoordinates2.x,g.width,g.height,h),K=k._fetchR(s._randomNoiseCoordinates2.y,s._randomNoiseCoordinates2.z,g.width,g.height,h),H=A.TmpVectors.Pk[0],O=A.TmpVectors.Pk[1];H.cg((2*ms-1)*k.noiseStrength.x,(2*i-1)*k.noiseStrength.y,(2*K-1)*k.noiseStrength.z),H.scaleToRef(k._tempScaledUpdateSpeed,O),s.direction.addInPlace(O)}}function ps(s,k){k.gravity.scaleToRef(k._tempScaledUpdateSpeed,k._scaledGravity),s.direction.addInPlace(k._scaledGravity)}function Is(s,k){s.size=(0,O.RandomRange)(k.minSize,k.maxSize),s.scale.cg((0,O.RandomRange)(k.minScaleX,k.maxScaleX),(0,O.RandomRange)(k.minScaleY,k.maxScaleY))}function Ns(s,k){s._currentSizeGradient=k._sizeGradients[0],s._currentSize1=s._currentSizeGradient.getFactor(),s.size=s._currentSize1,k._sizeGradients.length>1?s._currentSize2=k._sizeGradients[1].getFactor():s._currentSize2=s._currentSize1,s.scale.cg((0,O.RandomRange)(k.minScaleX,k.maxScaleX),(0,O.RandomRange)(k.minScaleY,k.maxScaleY))}function bs(s,k){const h=k._actualFrame/k.targetStopDuration;F.GetCurrentGradient(h,k._startSizeGradients,((h,A,g)=>{h!==k._currentStartSizeGradient&&(k._currentStartSize1=k._currentStartSize2,k._currentStartSize2=A.getFactor(),k._currentStartSizeGradient=h);const ms=(0,O.Lerp)(k._currentStartSize1,k._currentStartSize2,g);s.scale.scaleInPlace(ms)}))}function ts(s,k){F.GetCurrentGradient(k._ratio,k._sizeGradients,((k,h,A)=>{k!==s._currentSizeGradient&&(s._currentSize1=s._currentSize2,s._currentSize2=h.getFactor(),s._currentSizeGradient=k),s.size=(0,O.Lerp)(s._currentSize1,s._currentSize2,A)}))}function zs(s,k){s.remapData=new A.Vector4(0,1,0,1)}function Cs(s,k){k._colorRemapGradients&&k._colorRemapGradients.length>0&&F.GetCurrentGradient(k._ratio,k._colorRemapGradients,((k,h,A)=>{const g=(0,O.Lerp)(k.factor1,h.factor1,A),ms=(0,O.Lerp)(k.factor2,h.factor2,A);s.remapData.x=g,s.remapData.y=ms-g})),k._alphaRemapGradients&&k._alphaRemapGradients.length>0&&F.GetCurrentGradient(k._ratio,k._alphaRemapGradients,((k,h,A)=>{const g=(0,O.Lerp)(k.factor1,h.factor1,A),ms=(0,O.Lerp)(k.factor2,h.factor2,A);s.remapData.z=g,s.remapData.w=ms-g}))}function vs(s,k){const h=(0,O.Clamp)(k._actualFrame/k.targetStopDuration);F.GetCurrentGradient(h,k._lifeTimeGradients,((k,A)=>{const g=k,ms=A,i=g.getFactor(),K=ms.getFactor(),H=(h-g.gradient)/(ms.gradient-g.gradient);s.lifeTime=(0,O.Lerp)(i,K,H)})),k._emitPower=(0,O.RandomRange)(k.minEmitPower,k.maxEmitPower)}function Ys(s,k){s.lifeTime=(0,O.RandomRange)(k.minLifeTime,k.maxLifeTime),k._emitPower=(0,O.RandomRange)(k.minEmitPower,k.maxEmitPower)}function ns(s,k){0===k._emitPower?(s._initialDirection?s._initialDirection.H(s.direction):s._initialDirection=s.direction.clone(),s.direction.set(0,0,0)):(s._initialDirection=null,s.direction.scaleInPlace(k._emitPower)),s.direction.addInPlace(k._inheritedVelocityOffset)}function Ts(s,k){s.angularSpeed=(0,O.RandomRange)(k.minAngularSpeed,k.maxAngularSpeed),s.angle=(0,O.RandomRange)(k.minInitialRotation,k.maxInitialRotation)}function Us(s,k){s._currentAngularSpeedGradient=k._angularSpeedGradients[0],s.angularSpeed=s._currentAngularSpeedGradient.getFactor(),s._currentAngularSpeed1=s.angularSpeed,k._angularSpeedGradients.length>1?s._currentAngularSpeed2=k._angularSpeedGradients[1].getFactor():s._currentAngularSpeed2=s._currentAngularSpeed1,s.angle=(0,O.RandomRange)(k.minInitialRotation,k.maxInitialRotation)}function qs(s,k){s._initialStartSpriteCellId=k.startSpriteCellID,s._initialEndSpriteCellId=k.endSpriteCellID,s._initialSpriteCellLoop=k.spriteCellLoop}function Ms(s,k){s.previousItem=k.previousItem,s.nextItem=k,k.previousItem&&(k.previousItem.nextItem=s),k.previousItem=s}function Vs(s,k){s.previousItem=k,s.nextItem=k.nextItem,k.nextItem&&(k.nextItem.previousItem=s),k.nextItem=s}function Xs(s,k){let h=k;for(;h.nextItem;)h=h.nextItem;s.previousItem=h,s.nextItem=h.nextItem,h.nextItem=s}function Ls(s){s.previousItem&&(s.previousItem.nextItem=s.nextItem),s.nextItem&&(s.nextItem.previousItem=s.previousItem)}class Zs extends H{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(s){this._startDirectionFunction!==s&&(this._startDirectionFunction=s,this._directionProcessing.process=s?Ss:cs)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(s){this._startPositionFunction!==s&&(this._startPositionFunction=s,this._positionCreation.process=s?Rs:Ps)}set onDispose(s){this._onDisposeObserver&&this.Dh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Dh.add(s)}get P(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(s){this._useRampGradients!==s&&(this._useRampGradients=s,this._resetEffect(),s?(this._rampCreation={process:zs,previousItem:null,nextItem:null},Vs(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Cs,previousItem:null,nextItem:null},Vs(this._remapGradientProcessing,this._gravityProcessing)):(Ls(this._rampCreation),Ls(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(s){this._isLocal!==s&&(this._isLocal=s,s?(this._isLocalCreation={process:Ds,previousItem:null,nextItem:null},Vs(this._isLocalCreation,this._positionCreation)):Ls(this._isLocalCreation))}get particles(){return this.ea}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(s){this._animationSheetEnabled!==s&&(this._animationSheetEnabled=s,s?(this._sheetCreation={process:qs,previousItem:null,nextItem:null},Vs(this._sheetCreation,this._colorCreation)):Ls(this._sheetCreation),this._reset())}getActiveCount(){return this.ea.length}getClassName(){return"vg"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var s;let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(s=this._customWrappers[k])||void 0===s?void 0:s.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[s]??this._customWrappers[0]}setCustomEffect(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[k]=new ss.b(this._engine),this._customWrappers[k].effect=s,this._customWrappers[k].drawContext&&(this._customWrappers[k].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new o.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(s){if(this.noiseTexture!==s){if(this._noiseTexture=s,!s)return Ls(this._noiseCreation),void Ls(this._noiseProcessing);this._noiseCreation={process:Gs,previousItem:null,nextItem:null},Vs(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Qs,previousItem:null,nextItem:null},Vs(this._noiseProcessing,this._positionProcessing)}}constructor(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ms=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(s),this._emitterInverseWorldMatrix=A.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new A.Pk,this.Dh=new o.c,this.onStoppedObservable=new o.c,this.onStartedObservable=new o.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.ea=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new i.jg(0,0,0,0),this._colorDiff=new i.jg(0,0,0,0),this._scaledDirection=A.Pk.Zero(),this._scaledGravity=A.Pk.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=s=>{},this.recycleParticle=s=>{const k=this.ea.pop();k!==s&&k.copyTo(s),this._stockParticles.push(k)},this._createParticle=()=>{let s;return 0!==this._stockParticles.length?(s=this._stockParticles.pop(),s._reset()):s=new e(this),this._prepareParticle(s),s},this.paused=!1,this._shadersLoaded=!1,this._capacity=k,this._epsilon=K,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||f.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.la.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Ys,previousItem:null,nextItem:null},this._positionCreation={process:Ps,previousItem:null,nextItem:null},Vs(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:cs,previousItem:null,nextItem:null},Vs(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:ns,previousItem:null,nextItem:null},Vs(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Is,previousItem:null,nextItem:null},Vs(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Ts,previousItem:null,nextItem:null},Vs(this._angleCreation,this._sizeCreation),this._colorCreation={process:gs,previousItem:null,nextItem:null},Vs(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,H||(this._colorProcessing={process:Ks,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Os,previousItem:null,nextItem:null},Vs(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:js,previousItem:null,nextItem:null},Vs(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:ws,previousItem:null,nextItem:null},Vs(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ps,previousItem:null,nextItem:null},Vs(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=ms,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ss.b(this._engine)},this._customWrappers[0].effect=g,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new S,this.updateFunction=s=>{var k;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(k=this.noiseTexture.getContent())||void 0===k||k.then((s=>{this._noiseTextureData=s})));const h=s===this.ea;for(let A=0;A<s.length;A++){const k=s[A];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const g=k.age;if(k.age+=this._tempScaledUpdateSpeed,k.age>k.lifeTime){const s=k.age-g,h=k.lifeTime-g;this._tempScaledUpdateSpeed=h*this._tempScaledUpdateSpeed/s,k.age=k.lifeTime}this._ratio=k.age/k.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let ms=this._updateQueueStart;for(;ms;)ms.process(k,this),ms=ms.nextItem;if(this._isAnimationSheetEnabled&&!H&&k.updateCellIndex(),k._inheritParticleInfoToSubEmitters(),k.age>=k.lifeTime){if(this._emitFromParticle(k),k._attachedSubEmitters){for(const s of k._attachedSubEmitters)s.particleSystem.disposeOnStop=!0,s.particleSystem.stop();k._attachedSubEmitters=null}this.recycleParticle(k),h&&A--}else;}}}serialize(s){throw new Error("Method not implemented.")}clone(s,k){throw new Error("Method not implemented.")}_addFactorGradient(s,k,h,A){const g=new J(k,h,A);s.push(g),s.sort(((s,k)=>s.gradient<k.gradient?-1:s.gradient>k.gradient?1:0))}_removeFactorGradient(s,k){if(!s)return;let h=0;for(const A of s){if(A.gradient===k){s.splice(h,1);break}h++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=vs:this._lifeTimeCreation.process=Ys}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:bs,previousItem:null,nextItem:null},Vs(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Ls(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(s){this.targetStopDuration!==s&&(this._targetStopDuration=s,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(s,k,h){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,s,k,h),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(s){return this._removeFactorGradient(this._lifeTimeGradients,s),this._syncLifeTimeCreation(),this}addSizeGradient(s,k,h){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Ns,this._sizeGradientProcessing={process:ts,previousItem:null,nextItem:null},Ms(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,s,k,h),this}removeSizeGradient(s){var k;return this._removeFactorGradient(this._sizeGradients,s),0===(null===(k=this._sizeGradients)||void 0===k?void 0:k.length)&&(Ls(this._sizeGradientProcessing),this._sizeCreation.process=Is),this}addColorRemapGradient(s,k,h){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,s,k,h),this}removeColorRemapGradient(s){return this._removeFactorGradient(this._colorRemapGradients,s),this}addAlphaRemapGradient(s,k,h){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,s,k,h),this}removeAlphaRemapGradient(s){return this._removeFactorGradient(this._alphaRemapGradients,s),this}addAngularSpeedGradient(s,k,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Us,this._angularSpeedGradientProcessing={process:Hs,previousItem:null,nextItem:null},Ms(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,s,k,h),this}removeAngularSpeedGradient(s){var k;return this._removeFactorGradient(this._angularSpeedGradients,s),0===(null===(k=this._angularSpeedGradients)||void 0===k?void 0:k.length)&&(this._angleCreation.process=Ts,Ls(this._angularSpeedGradientProcessing)),this}addVelocityGradient(s,k,h){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:as,previousItem:null,nextItem:null},Vs(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:ds,previousItem:null,nextItem:null},Ms(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,s,k,h),this}removeVelocityGradient(s){var k;return this._removeFactorGradient(this._velocityGradients,s),0===(null===(k=this._velocityGradients)||void 0===k?void 0:k.length)&&(Ls(this._velocityCreation),Ls(this._velocityGradientProcessing)),this}addLimitVelocityGradient(s,k,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:rs,previousItem:null,nextItem:null},Vs(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Es,previousItem:null,nextItem:null},Vs(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,s,k,h),this}removeLimitVelocityGradient(s){var k;return this._removeFactorGradient(this._limitVelocityGradients,s),0===(null===(k=this._limitVelocityGradients)||void 0===k?void 0:k.length)&&(Ls(this._limitVelocityCreation),Ls(this._limitVelocityGradientProcessing)),this}addDragGradient(s,k,h){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Bs,previousItem:null,nextItem:null},Ms(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:us,previousItem:null,nextItem:null},Ms(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,s,k,h),this}removeDragGradient(s){var k;return this._removeFactorGradient(this._dragGradients,s),0===(null===(k=this._dragGradients)||void 0===k?void 0:k.length)&&(Ls(this._dragCreation),Ls(this._dragGradientProcessing)),this}addEmitRateGradient(s,k,h){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,s,k,h),this}removeEmitRateGradient(s){return this._removeFactorGradient(this._emitRateGradients,s),this}addStartSizeGradient(s,k,h){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,s,k,h),this._syncStartSizeCreation(),this}removeStartSizeGradient(s){return this._removeFactorGradient(this._startSizeGradients,s),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const s=new Uint8Array(4*this._rawTextureWidth),k=i.TmpColors.Bk[0];for(let h=0;h<this._rawTextureWidth;h++){const A=h/this._rawTextureWidth;F.GetCurrentGradient(A,this._rampGradients,((A,g,ms)=>{i.Bk.LerpToRef(A.color,g.color,ms,k),s[4*h]=255*k.r,s[4*h+1]=255*k.g,s[4*h+2]=255*k.b,s[4*h+3]=255}))}this._rampGradientsTexture=l.e.CreateRGBATexture(s,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((s,k)=>s.gradient<k.gradient?-1:s.gradient>k.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(s,k){this._rampGradients||(this._rampGradients=[]);const h=new W(s,k);return this._rampGradients.push(h),this._syncRampGradientTexture(),this}removeRampGradient(s){return this._removeGradientAndTexture(s,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(s,k,h){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=mk,this._colorProcessing.process=is);const A=new y(s,k,h);return this._colorGradients.push(A),this._colorGradients.sort(((s,k)=>s.gradient<k.gradient?-1:s.gradient>k.gradient?1:0)),this}removeColorGradient(s){if(!this._colorGradients)return this;let k=0;for(const h of this._colorGradients){if(h.gradient===s){this._colorGradients.splice(k,1);break}k++}return 0===this._colorGradients.length&&(this._colorCreation.process=gs,this._colorProcessing.process=Ks),this}resetDrawCache(){if(this._drawWrappers){for(const s of this._drawWrappers)if(s)for(const k of s)null===k||void 0===k||k.dispose();this._drawWrappers=[]}}_fetchR(s,k,h,A,g){return g[4*(((s=.5*Math.abs(s)+.5)*h%h|0)+((k=.5*Math.abs(k)+.5)*A%A|0)*h)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const s=this._engine,k=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*k),this._vertexBuffer=new B.b(s,this._vertexData,!0,k);let h=0;const A=this._vertexBuffer.createVertexBuffer(B.e.PositionKind,h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[B.e.PositionKind]=A,h+=3;const g=this._vertexBuffer.createVertexBuffer(B.e.ColorKind,h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[B.e.ColorKind]=g,h+=4;const ms=this._vertexBuffer.createVertexBuffer("angle",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=ms,h+=1;const i=this._vertexBuffer.createVertexBuffer("size",h,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=i,h+=2,this._isAnimationSheetEnabled){const s=this._vertexBuffer.createVertexBuffer("cellIndex",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=s,h+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const s=this._vertexBuffer.createVertexBuffer("direction",h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=s,h+=3}if(this._useRampGradients){const s=this._vertexBuffer.createVertexBuffer("remapData",h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=s,h+=4}let K;if(this._useInstancing){const k=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new B.b(s,k,!1,2),K=this._spriteBuffer.createVertexBuffer("offset",0,2)}else K=this._vertexBuffer.createVertexBuffer("offset",h,2,this._vertexBufferSize,this._useInstancing),h+=2;this._vertexBuffers.offset=K,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const s=[],k=[];let h=0;for(let A=0;A<this._capacity;A++)s.push(h),s.push(h+1),s.push(h+2),s.push(h),s.push(h+2),s.push(h+3),k.push(h,h+1,h+1,h+2,h+2,h+3,h+3,h,h,h+3),h+=4;this._indexBuffer=this._engine.createIndexBuffer(s),this._linesIndexBuffer=this._engine.createIndexBuffer(k)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(s)setTimeout((()=>{this.start(0)}),s);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var k;-1!==(null===(k=this.ik)||void 0===k?void 0:k.getClassName().indexOf("Mesh"))&&this.ik.fh(!0);const s=this.noiseTexture;if(s&&s.onGeneratedObservable)s.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let k=0;k<this.preWarmCycles;k++)this.animate(!0),s.render()}))}));else for(let k=0;k<this.preWarmCycles;k++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(s))}_postStop(s){}reset(){this._stockParticles.length=0,this.ea.length=0}_appendParticleVertex(s,k,h,g){let ms=s*this._vertexBufferSize;if(this._vertexData[ms++]=k.position.x+this.pO.x,this._vertexData[ms++]=k.position.y+this.pO.y,this._vertexData[ms++]=k.position.z+this.pO.z,this._vertexData[ms++]=k.color.r,this._vertexData[ms++]=k.color.g,this._vertexData[ms++]=k.color.b,this._vertexData[ms++]=k.color.a,this._vertexData[ms++]=k.angle,this._vertexData[ms++]=k.scale.x*k.size,this._vertexData[ms++]=k.scale.y*k.size,this._isAnimationSheetEnabled&&(this._vertexData[ms++]=k.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[ms++]=k.direction.x,this._vertexData[ms++]=k.direction.y,this._vertexData[ms++]=k.direction.z);else if(k._initialDirection){let s=k._initialDirection;this.isLocal&&(A.Pk.TransformNormalToRef(s,this._emitterWorldMatrix,A.TmpVectors.Pk[0]),s=A.TmpVectors.Pk[0]),0===s.x&&0===s.z&&(s.x=.001),this._vertexData[ms++]=s.x,this._vertexData[ms++]=s.y,this._vertexData[ms++]=s.z}else{let s=k.direction;this.isLocal&&(A.Pk.TransformNormalToRef(s,this._emitterWorldMatrix,A.TmpVectors.Pk[0]),s=A.TmpVectors.Pk[0]),0===s.x&&0===s.z&&(s.x=.001),this._vertexData[ms++]=s.x,this._vertexData[ms++]=s.y,this._vertexData[ms++]=s.z}this._useRampGradients&&k.remapData&&(this._vertexData[ms++]=k.remapData.x,this._vertexData[ms++]=k.remapData.y,this._vertexData[ms++]=k.remapData.z,this._vertexData[ms++]=k.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===h?h=this._epsilon:1===h&&(h=1-this._epsilon),0===g?g=this._epsilon:1===g&&(g=1-this._epsilon)),this._vertexData[ms++]=h,this._vertexData[ms++]=g)}_prepareParticle(s){}_createNewOnes(s){let k;for(let h=0;h<s&&this.ea.length!==this._capacity;h++){k=this._createParticle(),this.ea.push(k);let s=this._createQueueStart;for(;s;)s.process(k,this),s=s.nextItem;k._inheritParticleInfoToSubEmitters()}}_update(s){if(this._alive=this.ea.length>0,this.ik.position){const s=this.ik;this._emitterWorldMatrix=s.getWorldMatrix()}else{const s=this.ik;this._emitterWorldMatrix=A.Matrix.Translation(s.x,s.y,s.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.ea),this._createNewOnes(s)}static _GetAttributeNamesOrOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=[B.e.PositionKind,B.e.ColorKind,"angle","offset","size"];return s&&A.push("cellIndex"),k||A.push("direction"),h&&A.push("remapData"),A}static _GetEffectCreationOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,ks.c)(A),s&&A.push("particlesInfos"),k&&A.push("logarithmicDepthConstant"),h&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(s,k){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ks.j)(this,this._scene,s),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&s.push("#define FOG")),this._isAnimationSheetEnabled&&s.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&s.push("#define LOGARITHMICDEPTH"),k===H.BLENDMODE_MULTIPLY&&s.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&s.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(s.push("#define BILLBOARD"),this.billboardMode){case 2:s.push("#define BILLBOARDY");break;case 8:case 9:s.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&s.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:s.push("#define BILLBOARDMODE_ALL")}h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),s.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(s,k,h){k.push(...Zs._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),s.push(...Zs._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,As.g)(s,this._imageProcessingConfigurationDefines),(0,As.c)(h,this._imageProcessingConfigurationDefines))}_getWrapper(s){const k=this._getCustomDrawWrapper(s);if(null!==k&&void 0!==k&&k.effect)return k;const h=[];this.fillDefines(h,s);const A=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let g=this._drawWrappers[A];g||(g=this._drawWrappers[A]=[]);let ms=g[s];ms||(ms=new ss.b(this._engine),ms.drawContext&&(ms.drawContext.useInstancing=this._useInstancing),g[s]=ms);const i=h.join("\n");if(ms.defines!==i){const s=[],k=[],h=[];this.fillUniformsAttributesAndSamplerNames(k,s,h),ms.setEffect(this._engine.createEffect("particles",s,k,h,i,void 0,void 0,void 0,void 0,this._shaderLanguage),i)}return ms}animate(){var s;let k,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!h&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(h?this.preWarmStepOffset:(null===(s=this._scene)||void 0===s?void 0:s.getAnimationRatio())||1),this.manualEmitCount>-1)k=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let s=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const k=this._actualFrame/this.targetStopDuration;F.GetCurrentGradient(k,this._emitRateGradients,((k,h,A)=>{k!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=h.getFactor(),this._currentEmitRateGradient=k),s=(0,O.Lerp)(this._currentEmitRate1,this._currentEmitRate2,A)}))}k=s*this._scaledUpdateSpeed|0,this._newPartsExcess+=s*this._scaledUpdateSpeed-k}if(this._newPartsExcess>1&&(k+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?k=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(k),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!h){let s=0;for(let k=0;k<this.ea.length;k++){const h=this.ea[k];this._appendParticleVertices(s,h),s+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.ea.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(s,k){this._appendParticleVertex(s++,k,0,0),this._useInstancing||(this._appendParticleVertex(s++,k,1,0),this._appendParticleVertex(s++,k,1,1),this._appendParticleVertex(s++,k,0,1))}rebuild(){var s;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(s=this._spriteBuffer)||void 0===s||s._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Zs.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(h.bind(h,14080)),Promise.resolve().then(h.bind(h,14021))])):await Promise.all([Promise.resolve().then(h.bind(h,14006)),Promise.resolve().then(h.bind(h,13993))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.ik||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==H.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(H.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(H.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(s){const k=this._getWrapper(s),h=k.effect,g=this._engine;g.enableEffect(k);const ms=this.defaultViewMatrix??this._scene.getViewMatrix();if(h.setTexture("diffuseSampler",this.particleTexture),h.setMatrix("view",ms),h.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const s=this.particleTexture.getBaseSize();h.setFloat3("particlesInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,this.spriteCellWidth/s.width)}if(h.setVector2("translationPivot",this.translationPivot),h.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const s=this._scene.activeCamera;h.setVector3("eyePosition",s.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),h.setTexture("rampSampler",this._rampGradientsTexture));const i=h.defines;var K,H,O,c,S,a;(this._scene&&((0,ks.d)(h,this,this._scene),this.applyFog&&(0,hs.f)(this._scene,void 0,h)),i.indexOf("#define BILLBOARDMODE_ALL")>=0&&(ms.invertToRef(A.TmpVectors.Matrix[0]),h.setMatrix("invView",A.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?g.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,h):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,h)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?g.bindBuffers(this._vertexBuffers,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBuffer:this._indexBuffer,h):g.bindBuffers(this._vertexBuffers,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:null,h);(this.useLogarithmicDepth&&this._scene&&(0,hs.j)(i,h,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(h),this._setEngineBasedOnBlendMode(s),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(h),this._useInstancing)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?g.drawElementsType(6,0,10,this.ea.length):g.drawArraysType(7,0,4,this.ea.length):null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?g.drawElementsType(1,0,10*this.ea.length):g.drawElementsType(0,0,6*this.ea.length);return this.ea.length}render(){if(!this.isReady()||!this.ea.length)return 0;const s=this._engine;s.setState&&(s.setState(!1),this.forceDepthWrite&&s.setDepthWrite(!0));let k=0;return k=this.blendMode===H.BLENDMODE_MULTIPLYADD?this._render(H.BLENDMODE_MULTIPLY)+this._render(H.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),k}_onDispose(){}dispose(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),s&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),s&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(k,h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const s=this._scene.la.indexOf(this);s>-1&&this._scene.la.splice(s,1),this._scene._activeParticleSystems.dispose()}this.Dh.notifyObservers(this),this.Dh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Zs.ForceGLSL=!1;var xs,ys=h(12438);!function(s){s[s.ATTACHED=0]="ATTACHED",s[s.END=1]="END"}(xs||(xs={}));class Ws{constructor(s){if(this.particleSystem=s,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!s.ik||!s.ik.dispose){const k=(0,K.d)("BABYLON.AbstractMesh");s.ik=new k("SubemitterSystemEmitter",s.Is()),s._disposeEmitterOnDispose=!0}}clone(){let s=this.particleSystem.ik;if(s){if(s instanceof A.Pk)s=s.clone();else if(-1!==s.getClassName().indexOf("Mesh")){s=new((0,K.d)("BABYLON.Mesh"))("",s.Is()),s.isVisible=!1}}else s=new A.Pk;const k=new Ws(this.particleSystem.clone(this.particleSystem.name,s));return k.particleSystem.name+="Clone",k.type=this.type,k.inheritDirection=this.inheritDirection,k.inheritedVelocityAmount=this.inheritedVelocityAmount,k.particleSystem._disposeEmitterOnDispose=!0,k.particleSystem.disposeOnStop=!0,k}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={};return k.type=this.type,k.inheritDirection=this.inheritDirection,k.inheritedVelocityAmount=this.inheritedVelocityAmount,k.particleSystem=this.particleSystem.serialize(s),k}static _ParseParticleSystem(s,k,h){throw(0,ys.b)("ParseParticle")}static Parse(s,k,h){const A=s.particleSystem,g=new Ws(Ws._ParseParticleSystem(A,k,h,!0));return g.type=s.type,g.inheritDirection=s.inheritDirection,g.inheritedVelocityAmount=s.inheritedVelocityAmount,g.particleSystem._isSubEmitter=!0,g}dispose(){this.particleSystem.dispose()}}var Js=h(12481);function Fs(s,k){const h=new P;return h.direction1=s,h.direction2=k,h}function os(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ls(){return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fs(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Pk(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0);return new D(s,k,h)}function es(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function sk(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0),ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Pk(0,1,0);return new E(s,k,h,g,ms)}function kk(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new a(s,k)}function hk(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0);return new r(s,k,h,g)}const Ak=A.Pk.Zero(),gk=A.Pk.Zero(),mh=A.Pk.Zero();class ik{constructor(){this.strength=0,this.position=A.Pk.Zero()}_processParticle(s,k){this.position.subtractToRef(s.position,Ak);const h=Ak.lengthSquared()+1;Ak.normalize().scaleToRef(this.strength/h,gk),gk.scaleToRef(k._tempScaledUpdateSpeed,mh),s.direction.addInPlace(mh)}serialize(){return{position:this.position.yh(),strength:this.strength}}}class Kk extends Zs{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=s=>{if(!this._subEmitters||0===this._subEmitters.length)return;const k=Math.floor(Math.random()*this._subEmitters.length);for(const h of this._subEmitters[k])if(1===h.type){const k=h.clone();s._inheritParticleInfoToSubEmitter(k),k.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(k.particleSystem),k.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(s,k){const h=Fs(s,k);return this.particleEmitterType=h,h}get flowMap(){return this._flowMap}set flowMap(s){this._flowMap!==s&&(this._flowMap=s,this._flowMapUpdate&&(Ls(this._flowMapUpdate),this._flowMapUpdate=null),s&&(this._flowMapUpdate={process:s=>{var k;const h=null===(k=this.Is())||void 0===k?void 0:k.getTransformMatrix();this._flowMap._processParticle(s,this.flowMapStrength*this._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null},Vs(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(s){this._attractors.push(s),1===this._attractors.length&&(this._attractorUpdate={process:s=>{for(const k of this._attractors)k._processParticle(s,this)},previousItem:null,nextItem:null},Vs(this._attractorUpdate,this._directionProcessing))}removeAttractor(s){const k=this._attractors.indexOf(s);-1!==k&&this._attractors.splice(k,1),0===this._attractors.length&&Ls(this._attractorUpdate)}start(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(s)}createHemisphericEmitter(){const s=os(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createSphereEmitter(){const s=ls(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createDirectedSphereEmitter(){const s=fs(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Pk(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0));return this.particleEmitterType=s,s}createCylinderEmitter(){const s=es(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=s,s}createDirectedCylinderEmitter(){const s=sk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Pk(0,1,0));return this.particleEmitterType=s,s}createConeEmitter(){const s=kk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=s,s}createDirectedConeEmitter(){const s=hk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0));return this.particleEmitterType=s,s}createBoxEmitter(s,k,h,A){const g=new S;return this.particleEmitterType=g,this.direction1=s,this.direction2=k,this.minEmitBox=h,this.maxEmitBox=A,g}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const s of this.subEmitters)s instanceof Kk?this._subEmitters.push([new Ws(s)]):s instanceof Ws?this._subEmitters.push([s]):s instanceof Array&&this._subEmitters.push(s)}_stopSubEmitters(){if(this.activeSubSystems){for(const s of this.activeSubSystems)s.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const s=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==s&&this._rootParticleSystem.activeSubSystems.splice(s,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(s){s&&this._stopSubEmitters()}_prepareParticle(s){if(this._subEmitters&&this._subEmitters.length>0){const k=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];s._attachedSubEmitters=[];for(const h of k)if(0===h.type){const k=h.clone();s._attachedSubEmitters.push(k),k.particleSystem.start()}}}_onDispose(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),s&&this.particles)for(const h of this.particles)if(h._attachedSubEmitters)for(let s=h._attachedSubEmitters.length-1;s>=0;s-=1)h._attachedSubEmitters[s].dispose();if(k&&this.activeSubSystems)for(let h=this.activeSubSystems.length-1;h>=0;h-=1)this.activeSubSystems[h].dispose();if(this._subEmitters&&this._subEmitters.length){for(let s=0;s<this._subEmitters.length;s++)for(const k of this._subEmitters[s])k.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.ik&&this.ik.dispose&&this.ik.dispose(!0)}static _Parse(s,k,h,g){let ms;ms=h instanceof Js.e?null:h;const H=(0,K.d)("BABYLON.Texture");if(H&&ms&&(s.texture?k.particleTexture=H.Parse(s.texture,ms,g):s.textureName&&(k.particleTexture=new H(g+s.textureName,ms,!1,void 0===s.invertY||s.invertY),k.particleTexture.name=s.textureName)),s.emitterId||0===s.emitterId||void 0!==s.ik?s.emitterId&&ms?k.ik=ms.getLastMeshById(s.emitterId):k.ik=A.Pk.uk(s.ik):k.ik=A.Pk.Zero(),k.isLocal=!!s.isLocal,void 0!==s.renderingGroupId&&(k.renderingGroupId=s.renderingGroupId),void 0!==s.isBillboardBased&&(k.isBillboardBased=s.isBillboardBased),void 0!==s.billboardMode&&(k.billboardMode=s.billboardMode),void 0!==s.useLogarithmicDepth&&(k.useLogarithmicDepth=s.useLogarithmicDepth),s.animations){for(let h=0;h<s.animations.length;h++){const A=s.animations[h],g=(0,K.d)("BABYLON.Animation");g&&k.animations.push(g.Parse(A))}k.beginAnimationOnStart=s.beginAnimationOnStart,k.beginAnimationFrom=s.beginAnimationFrom,k.beginAnimationTo=s.beginAnimationTo,k.beginAnimationLoop=s.beginAnimationLoop}if(s.autoAnimate&&ms&&ms.beginAnimation(k,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),k.startDelay=0|s.startDelay,k.minAngularSpeed=s.minAngularSpeed,k.maxAngularSpeed=s.maxAngularSpeed,k.minSize=s.minSize,k.maxSize=s.maxSize,s.minScaleX&&(k.minScaleX=s.minScaleX,k.maxScaleX=s.maxScaleX,k.minScaleY=s.minScaleY,k.maxScaleY=s.maxScaleY),void 0!==s.preWarmCycles&&(k.preWarmCycles=s.preWarmCycles,k.preWarmStepOffset=s.preWarmStepOffset),void 0!==s.minInitialRotation&&(k.minInitialRotation=s.minInitialRotation,k.maxInitialRotation=s.maxInitialRotation),k.minLifeTime=s.minLifeTime,k.maxLifeTime=s.maxLifeTime,k.minEmitPower=s.minEmitPower,k.maxEmitPower=s.maxEmitPower,k.emitRate=s.emitRate,k.gravity=A.Pk.uk(s.gravity),s.noiseStrength&&(k.noiseStrength=A.Pk.uk(s.noiseStrength)),k.color1=i.jg.uk(s.color1),k.color2=i.jg.uk(s.color2),k.colorDead=i.jg.uk(s.colorDead),k.updateSpeed=s.updateSpeed,k.targetStopDuration=s.targetStopDuration,k.blendMode=s.blendMode,s.colorGradients)for(const A of s.colorGradients)k.addColorGradient(A.gradient,i.jg.uk(A.color1),A.color2?i.jg.uk(A.color2):void 0);if(s.rampGradients){for(const h of s.rampGradients)k.addRampGradient(h.gradient,i.Bk.uk(h.color));k.useRampGradients=s.useRampGradients}if(s.colorRemapGradients)for(const A of s.colorRemapGradients)k.addColorRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.alphaRemapGradients)for(const A of s.alphaRemapGradients)k.addAlphaRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.sizeGradients)for(const A of s.sizeGradients)k.addSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.angularSpeedGradients)for(const A of s.angularSpeedGradients)k.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.velocityGradients)for(const A of s.velocityGradients)k.addVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.dragGradients)for(const A of s.dragGradients)k.addDragGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.emitRateGradients)for(const A of s.emitRateGradients)k.addEmitRateGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.startSizeGradients)for(const A of s.startSizeGradients)k.addStartSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.lifeTimeGradients)for(const A of s.lifeTimeGradients)k.addLifeTimeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(s.limitVelocityGradients){for(const h of s.limitVelocityGradients)k.addLimitVelocityGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);k.limitVelocityDamping=s.limitVelocityDamping}if(s.noiseTexture&&ms){const h=(0,K.d)("BABYLON.ProceduralTexture");k.noiseTexture=h.Parse(s.noiseTexture,ms,g)}let O;if(s.particleEmitterType){switch(s.particleEmitterType.type){case"SphereParticleEmitter":O=new R;break;case"SphereDirectedParticleEmitter":O=new D;break;case"ConeEmitter":case"ConeParticleEmitter":O=new a;break;case"ConeDirectedParticleEmitter":O=new r;break;case"CylinderParticleEmitter":O=new d;break;case"CylinderDirectedParticleEmitter":O=new E;break;case"HemisphericParticleEmitter":O=new j;break;case"PointParticleEmitter":O=new P;break;case"MeshParticleEmitter":O=new u;break;case"CustomParticleEmitter":O=new w;break;default:O=new S}O.parse(s.particleEmitterType,ms)}else O=new S,O.parse(s,ms);k.particleEmitterType=O,k.startSpriteCellID=s.startSpriteCellID,k.endSpriteCellID=s.endSpriteCellID,k.spriteCellLoop=s.spriteCellLoop??!0,k.spriteCellWidth=s.spriteCellWidth,k.spriteCellHeight=s.spriteCellHeight,k.spriteCellChangeSpeed=s.spriteCellChangeSpeed,k.spriteRandomStartCell=s.spriteRandomStartCell,k.disposeOnStop=s.disposeOnStop??!1,k.manualEmitCount=s.manualEmitCount??-1}static Parse(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],ms=arguments.length>4?arguments[4]:void 0;const K=s.name;let H,O,c=null,S=null;if(k instanceof Js.e?H=k:(O=k,H=O.getEngine()),s.customShader&&H.createEffectForParticles){S=s.customShader;const k=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"";c=H.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,k)}const a=new Kk(K,ms||s.Ch,k,c,s.isAnimationSheetEnabled);if(a.customShader=S,a._rootUrl=h,s.id&&(a.id=s.id),s.subEmitters){a.subEmitters=[];for(const A of s.subEmitters){const s=[];for(const g of A)s.push(Ws.Parse(g,k,h));a.subEmitters.push(s)}}if(s.attractors)for(const i of s.attractors){const s=new ik;s.position=A.Pk.uk(i.position),s.strength=i.strength,a.addAttractor(s)}return Kk._Parse(s,a,k,h),s.textureMask&&(a.textureMask=i.jg.uk(s.textureMask)),s.pO&&(a.pO=A.Pk.uk(s.pO)),s.preventAutoStart&&(a.preventAutoStart=s.preventAutoStart),g||a.preventAutoStart||a.start(),a}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={};if(Kk._Serialize(k,this,s),k.textureMask=this.textureMask.yh(),k.customShader=this.customShader,k.preventAutoStart=this.preventAutoStart,k.pO=this.pO.yh(),this.subEmitters){k.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const h of this._subEmitters){const A=[];for(const k of h)A.push(k.serialize(s));k.subEmitters.push(A)}}if(this._attractors&&this._attractors.length){k.attractors=[];for(const s of this._attractors)k.attractors.push(s.serialize())}return k}static _Serialize(s,k,h){if(s.name=k.name,s.id=k.id,s.Ch=k.getCapacity(),s.disposeOnStop=k.disposeOnStop,s.manualEmitCount=k.manualEmitCount,k.ik.position){const h=k.ik;s.emitterId=h.id}else{const h=k.ik;s.ik=h.yh()}k.particleEmitterType&&(s.particleEmitterType=k.particleEmitterType.serialize()),k.particleTexture&&(h?s.texture=k.particleTexture.serialize():(s.textureName=k.particleTexture.name,s.invertY=!!k.particleTexture._invertY)),s.isLocal=k.isLocal,v.e.AppendSerializedAnimations(k,s),s.beginAnimationOnStart=k.beginAnimationOnStart,s.beginAnimationFrom=k.beginAnimationFrom,s.beginAnimationTo=k.beginAnimationTo,s.beginAnimationLoop=k.beginAnimationLoop,s.startDelay=k.startDelay,s.renderingGroupId=k.renderingGroupId,s.isBillboardBased=k.isBillboardBased,s.billboardMode=k.billboardMode,s.minAngularSpeed=k.minAngularSpeed,s.maxAngularSpeed=k.maxAngularSpeed,s.minSize=k.minSize,s.maxSize=k.maxSize,s.minScaleX=k.minScaleX,s.maxScaleX=k.maxScaleX,s.minScaleY=k.minScaleY,s.maxScaleY=k.maxScaleY,s.minEmitPower=k.minEmitPower,s.maxEmitPower=k.maxEmitPower,s.minLifeTime=k.minLifeTime,s.maxLifeTime=k.maxLifeTime,s.emitRate=k.emitRate,s.gravity=k.gravity.yh(),s.noiseStrength=k.noiseStrength.yh(),s.color1=k.color1.yh(),s.color2=k.color2.yh(),s.colorDead=k.colorDead.yh(),s.updateSpeed=k.updateSpeed,s.targetStopDuration=k.targetStopDuration,s.blendMode=k.blendMode,s.preWarmCycles=k.preWarmCycles,s.preWarmStepOffset=k.preWarmStepOffset,s.minInitialRotation=k.minInitialRotation,s.maxInitialRotation=k.maxInitialRotation,s.startSpriteCellID=k.startSpriteCellID,s.spriteCellLoop=k.spriteCellLoop,s.endSpriteCellID=k.endSpriteCellID,s.spriteCellChangeSpeed=k.spriteCellChangeSpeed,s.spriteCellWidth=k.spriteCellWidth,s.spriteCellHeight=k.spriteCellHeight,s.spriteRandomStartCell=k.spriteRandomStartCell,s.isAnimationSheetEnabled=k.isAnimationSheetEnabled,s.useLogarithmicDepth=k.useLogarithmicDepth;const A=k.getColorGradients();if(A){s.colorGradients=[];for(const k of A){const h={gradient:k.gradient,color1:k.color1.yh()};k.color2?h.color2=k.color2.yh():h.color2=k.color1.yh(),s.colorGradients.push(h)}}const g=k.getRampGradients();if(g){s.rampGradients=[];for(const k of g){const h={gradient:k.gradient,color:k.color.yh()};s.rampGradients.push(h)}s.useRampGradients=k.useRampGradients}const ms=k.getColorRemapGradients();if(ms){s.colorRemapGradients=[];for(const k of ms){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.colorRemapGradients.push(h)}}const i=k.getAlphaRemapGradients();if(i){s.alphaRemapGradients=[];for(const k of i){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.alphaRemapGradients.push(h)}}const K=k.getSizeGradients();if(K){s.sizeGradients=[];for(const k of K){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.sizeGradients.push(h)}}const H=k.getAngularSpeedGradients();if(H){s.angularSpeedGradients=[];for(const k of H){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.angularSpeedGradients.push(h)}}const O=k.getVelocityGradients();if(O){s.velocityGradients=[];for(const k of O){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.velocityGradients.push(h)}}const c=k.getDragGradients();if(c){s.dragGradients=[];for(const k of c){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.dragGradients.push(h)}}const S=k.getEmitRateGradients();if(S){s.emitRateGradients=[];for(const k of S){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.emitRateGradients.push(h)}}const a=k.getStartSizeGradients();if(a){s.startSizeGradients=[];for(const k of a){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.startSizeGradients.push(h)}}const r=k.getLifeTimeGradients();if(r){s.lifeTimeGradients=[];for(const k of r){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.lifeTimeGradients.push(h)}}const d=k.getLimitVelocityGradients();if(d){s.limitVelocityGradients=[];for(const k of d){const h={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?h.factor2=k.factor2:h.factor2=k.factor1,s.limitVelocityGradients.push(h)}s.limitVelocityDamping=k.limitVelocityDamping}k.noiseTexture&&(s.noiseTexture=k.noiseTexture.serialize())}clone(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let g=null;const ms=this._engine;if(ms.createEffectForParticles&&null!=this.customShader){g=this.customShader;const s=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"",k=ms.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,s);A[0]?A[0].effect=k:this.setCustomEffect(k,0)}const i=this.serialize(h),K=Kk.Parse(i,this._scene||this._engine,this._rootUrl);return K.name=s,K.customShader=g,K._customWrappers=A,void 0===k&&(k=this.ik),this.noiseTexture&&(K.noiseTexture=this.noiseTexture.clone()),K.ik=k,this.preventAutoStart||K.start(),K}}Kk.BILLBOARDMODE_Y=2,Kk.BILLBOARDMODE_ALL=7,Kk.BILLBOARDMODE_STRETCHED=8,Kk.BILLBOARDMODE_STRETCHED_LOCAL=9,Ws._ParseParticleSystem=Kk.Parse;var Hk=h(12844),Ok=h(12836),ck=h(12722);ck.b.prototype.createTransformFeedback=function(){const s=this._gl.createTransformFeedback();if(!s)throw new Error("Unable to create Transform Feedback");return s},ck.b.prototype.deleteTransformFeedback=function(s){this._gl.deleteTransformFeedback(s)},ck.b.prototype.bindTransformFeedback=function(s){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,s)},ck.b.prototype.beginTransformFeedback=function(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(s?this._gl.POINTS:this._gl.TRIANGLES)},ck.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ck.b.prototype.setTranformFeedbackVaryings=function(s,k){this._gl.transformFeedbackVaryings(s,k,this._gl.INTERLEAVED_ATTRIBS)},ck.b.prototype.bindTransformFeedbackBuffer=function(s){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,s?s.underlyingResource:null)},ck.b.prototype.readTransformFeedbackBuffer=function(s){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,s)};const Sk="clipPlaneFragmentDeclaration2",ak="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Q.e.IncludesShadersStore[Sk]||(Q.e.IncludesShadersStore[Sk]=ak);h(13906),h(13912),h(13918),h(13926),h(13934),h(13936),h(13938),h(13941);const rk="gpuRenderParticlesPixelShader",dk="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Q.e.ShadersStore[rk]||(Q.e.ShadersStore[rk]=dk);const Ek="clipPlaneVertexDeclaration2",jk="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Q.e.IncludesShadersStore[Ek]||(Q.e.IncludesShadersStore[Ek]=jk);h(13950),h(13956),h(13962),h(13964);const Pk="gpuRenderParticlesVertexShader",Rk="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Q.e.ShadersStore[Pk]||(Q.e.ShadersStore[Pk]=Rk);class Dk extends H{static get IsSupported(){if(!f.b.LastCreatedEngine)return!1;const s=f.b.LastCreatedEngine.getCaps();return s.supportTransformFeedbacks||s.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(s){this._maxActiveParticleCount=Math.min(s,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(s){this.maxActiveParticleCount=s}createPointEmitter(s,k){const h=Fs(s,k);return this.particleEmitterType=h,h}createHemisphericEmitter(){const s=os(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createSphereEmitter(){const s=ls(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=s,s}createDirectedSphereEmitter(){const s=fs(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.Pk(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0));return this.particleEmitterType=s,s}createCylinderEmitter(){const s=es(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=s,s}createDirectedCylinderEmitter(){const s=sk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.Pk(0,1,0));return this.particleEmitterType=s,s}createConeEmitter(){const s=kk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=s,s}createDirectedConeEmitter(){const s=hk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.Pk(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.Pk(0,1,0));return this.particleEmitterType=s,s}createBoxEmitter(s,k,h,A){const g=new S;return this.particleEmitterType=g,this.direction1=s,this.direction2=k,this.minEmitBox=h,this.maxEmitBox=A,g}get flowMap(){return this._flowMap}set flowMap(s){this._flowMap!==s&&(this._flowMap=s)}isReady(){if(!this.ik||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Kk.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Kk.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Kk.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";s?setTimeout((()=>{this.start(0)}),s):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var s;let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(s=this._customWrappers[k])||void 0===s?void 0:s.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[s]??this._customWrappers[0]}setCustomEffect(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[k]=new ss.b(this._engine),this._customWrappers[k].effect=s}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new o.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(s,k,h){return super._removeGradientAndTexture(s,k,h),this._releaseBuffers(),this}addColorGradient(s,k){this._colorGradients||(this._colorGradients=[]);const h=new y(s,k);return this._colorGradients.push(h),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(s&&this._colorGradients.sort(((s,k)=>s.gradient<k.gradient?-1:s.gradient>k.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(s){return this._removeGradientAndTexture(s,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const k in this._drawWrappers){var s;null===(s=this._drawWrappers[k].drawContext)||void 0===s||s.reset()}}_addFactorGradient(s,k,h){const A=new J(k,h);s.push(A),this._releaseBuffers()}addSizeGradient(s,k){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,s,k),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(s){return this._removeGradientAndTexture(s,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(s,k){if(!s)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&s.sort(((s,k)=>s.gradient<k.gradient?-1:s.gradient>k.gradient?1:0));const h=this;h[k]&&(h[k].dispose(),h[k]=null)}addAngularSpeedGradient(s,k){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,s,k),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(s){return this._removeGradientAndTexture(s,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(s,k){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,s,k),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(s){return this._removeGradientAndTexture(s,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(s,k){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,s,k),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(s){return this._removeGradientAndTexture(s,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(s,k){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,s,k),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(s){return this._removeGradientAndTexture(s,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(s){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ms=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(s),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Dh=new o.c,this.onStoppedObservable=new o.c,this.onStartedObservable=new o.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||f.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.la.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,K.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,K.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,K.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,K.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ss.b(this._engine)},this._customWrappers[0].effect=g,this._drawWrappers={0:new ss.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(k=k??{}).randomTextureSize||delete k.randomTextureSize;const i={Ch:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...k},H=k;isFinite(H)&&(i.Ch=H),this._capacity=i.Ch,this._maxActiveParticleCount=i.Ch,this._currentActiveCount=0,this._isAnimationSheetEnabled=ms,this.particleEmitterType=new S;const O=Math.min(this._engine.getCaps().maxTextureSize,i.randomTextureSize);let c=[];for(let A=0;A<O;++A)c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),c.push(Math.random());this._randomTexture=new l.e(new Float32Array(c),O,1,5,h,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,c=[];for(let A=0;A<O;++A)c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),c.push(Math.random());this._randomTexture2=new l.e(new Float32Array(c),O,1,5,h,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=O}_reset(){this._releaseBuffers()}_createVertexBuffers(s,k,h){const A={};A.position=k.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let g=3;A.age=k.createVertexBuffer("age",g,1,this._attributesStrideSize,!0),g+=1,A.size=k.createVertexBuffer("size",g,3,this._attributesStrideSize,!0),g+=3,A.life=k.createVertexBuffer("life",g,1,this._attributesStrideSize,!0),g+=1,g+=4,this.billboardMode===Kk.BILLBOARDMODE_STRETCHED&&(A.direction=k.createVertexBuffer("direction",g,3,this._attributesStrideSize,!0)),g+=3,this._platform.alignDataInBuffer&&(g+=1),this.particleEmitterType instanceof w&&(g+=3,this._platform.alignDataInBuffer&&(g+=1)),this._colorGradientsTexture||(A.color=k.createVertexBuffer("color",g,4,this._attributesStrideSize,!0),g+=4),this._isBillboardBased||(A.initialDirection=k.createVertexBuffer("initialDirection",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1)),this.noiseTexture&&(A.noiseCoordinates1=k.createVertexBuffer("noiseCoordinates1",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1),A.noiseCoordinates2=k.createVertexBuffer("noiseCoordinates2",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1)),A.angle=k.createVertexBuffer("angle",g,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?g++:g+=2,this._isAnimationSheetEnabled&&(A.cellIndex=k.createVertexBuffer("cellIndex",g,1,this._attributesStrideSize,!0),g+=1,this.spriteRandomStartCell&&(A.cellStartOffset=k.createVertexBuffer("cellStartOffset",g,1,this._attributesStrideSize,!0),g+=1)),A.offset=h.createVertexBuffer("offset",0,2),A.uv=h.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(A),this._platform.createVertexBuffers(s,A),this.resetDrawCache()}_initialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!s)return;const k=this._engine,h=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof w&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const g=this.particleEmitterType instanceof w,ms=A.TmpVectors.Pk[0];let i=0;for(let A=0;A<this._capacity;A++)if(h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),g?(this.particleEmitterType.particleDestinationGenerator(A,null,ms),h.push(ms.x),h.push(ms.y),h.push(ms.z)):(h.push(0),h.push(0),h.push(0)),this._platform.alignDataInBuffer&&h.push(0),i+=16,g&&(this.particleEmitterType.particlePositionGenerator(A,null,ms),h.push(ms.x),h.push(ms.y),h.push(ms.z),this._platform.alignDataInBuffer&&h.push(0),i+=4),this._colorGradientsTexture||(h.push(0),h.push(0),h.push(0),h.push(0),i+=4),this.isBillboardBased||(h.push(0),h.push(0),h.push(0),this._platform.alignDataInBuffer&&h.push(0),i+=4),this.noiseTexture&&(h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),i+=8),h.push(0),i+=1,this._angularSpeedGradientsTexture||(h.push(0),i+=1),this._isAnimationSheetEnabled&&(h.push(0),i+=1,this.spriteRandomStartCell&&(h.push(0),i+=1)),this._platform.alignDataInBuffer){let s=3-(i+3&3);for(i+=s;s-- >0;)h.push(0)}const K=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),H=this._platform.createParticleBuffer(h),O=this._platform.createParticleBuffer(h);this._buffer0=new B.b(k,H,!1,this._attributesStrideSize),this._buffer1=new B.b(k,O,!1,this._attributesStrideSize),this._spriteBuffer=new B.b(k,K,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let s=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(s+="\n#define BILLBOARD"),this._colorGradientsTexture&&(s+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(s+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(s+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(s+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(s+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(s+="\n#define DRAGGRADIENTS"),this._flowMap&&(s+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(s+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(s+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(s+="\n#define NOISE"),this.isLocal&&(s+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===s||(this._cachedUpdateDefines=s,this._updateBuffer=this._platform.createUpdateBuffer(s)),this._platform.isUpdateBufferReady()}_getWrapper(s){const k=this._getCustomDrawWrapper(s);if(null!==k&&void 0!==k&&k.effect)return k;const h=[];this.fillDefines(h,s);let A=this._drawWrappers[s];A||(A=new ss.b(this._engine),A.drawContext&&(A.drawContext.useInstancing=!0),this._drawWrappers[s]=A);const g=h.join("\n");if(A.defines!==g){const s=[],k=[],h=[];this.fillUniformsAttributesAndSamplerNames(k,s,h),A.setEffect(this._engine.createEffect("gpuRenderParticles",s,k,h,g),g)}return A}static _GetAttributeNamesOrOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=[B.e.PositionKind,"age","life","size","angle"];return s||g.push(B.e.ColorKind),k&&g.push("cellIndex"),h||g.push("initialDirection"),A&&g.push("direction"),g.push("offset",B.e.UVKind),g}static _GetEffectCreationOptions(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["emitterWM","pO","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,ks.c)(A),s&&A.push("sheetInfos"),k&&A.push("logarithmicDepthConstant"),h&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ks.j)(this,this._scene,s),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ok.d.FOGMODE_NONE&&s.push("#define FOG")),k===Kk.BLENDMODE_MULTIPLY&&s.push("#define BLENDMULTIPLYMODE"),this.isLocal&&s.push("#define LOCAL"),this.useLogarithmicDepth&&s.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(s.push("#define BILLBOARD"),this.billboardMode){case Kk.BILLBOARDMODE_Y:s.push("#define BILLBOARDY");break;case Kk.BILLBOARDMODE_STRETCHED:s.push("#define BILLBOARDSTRETCHED");break;case Kk.BILLBOARDMODE_ALL:s.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&s.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&s.push("#define ANIMATESHEET"),h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),s.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(s,k,h){k.push(...Dk._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Kk.BILLBOARDMODE_STRETCHED)),s.push(...Dk._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Hk.b.PrepareUniforms(s,this._imageProcessingConfigurationDefines),Hk.b.PrepareSamplers(h,this._imageProcessingConfigurationDefines))}animate(){var s;let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(k?this.preWarmStepOffset:(null===(s=this._scene)||void 0===s?void 0:s.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(s,k){const h=this[k];if(!s||!s.length||h)return;const A=new Float32Array(this._rawTextureWidth);for(let g=0;g<this._rawTextureWidth;g++){const k=g/this._rawTextureWidth;F.GetCurrentGradient(k,s,((s,k,h)=>{A[g]=(0,O.Lerp)(s.factor1,k.factor1,h)}))}this[k]=l.e.CreateRTexture(A,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[k].name=k.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const s=new Uint8Array(4*this._rawTextureWidth),k=i.TmpColors.jg[0];for(let h=0;h<this._rawTextureWidth;h++){const A=h/this._rawTextureWidth;F.GetCurrentGradient(A,this._colorGradients,((A,g,ms)=>{i.jg.LerpToRef(A.color1,g.color1,ms,k),s[4*h]=255*k.r,s[4*h+1]=255*k.g,s[4*h+2]=255*k.b,s[4*h+3]=255*k.a}))}this._colorGradientsTexture=l.e.CreateRGBATexture(s,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(s,k){var h,g,ms,i;const K=this._getWrapper(s),H=K.effect;this._engine.enableEffect(K);const O=(null===(h=this._scene)||void 0===h?void 0:h.getViewMatrix())||A.Matrix.IdentityReadOnly;if(H.setMatrix("view",O),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),H.setTexture("diffuseSampler",this.particleTexture),H.setVector2("translationPivot",this.translationPivot),H.setVector3("pO",this.pO),this.isLocal&&H.setMatrix("emitterWM",k),this._colorGradientsTexture?H.setTexture("colorGradientSampler",this._colorGradientsTexture):H.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const s=this.particleTexture.getBaseSize();H.setFloat3("sheetInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,s.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const s=this._scene.activeCamera;H.setVector3("eyePosition",s.globalPosition)}const c=H.defines;if(this._scene&&((0,ks.d)(H,this,this._scene),this.applyFog&&(0,hs.f)(this._scene,void 0,H)),c.indexOf("#define BILLBOARDMODE_ALL")>=0){const s=O.clone();s.invert(),H.setMatrix("invView",s)}return this.useLogarithmicDepth&&this._scene&&(0,hs.j)(c,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(s),this._platform.bindDrawBuffers(this._targetIndex,H,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),null!==(ms=this._scene)&&void 0!==ms&&ms.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(i=this._scene)&&void 0!==i&&i.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(s){if(!this.ik||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!s)if(this.ik.position){s=this.ik.getWorldMatrix()}else{const k=this.ik;s=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(k.x,k.y,k.z,s)}const k=this._engine,h=k.getDepthWrite();if(k.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const s=this.Is();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",s.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",s),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const g=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=g,k.setDepthWrite(h)}render(){let s,k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!k&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let s=0;s<this.preWarmCycles;s++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const s=0|this._accumulatedCount;this._accumulatedCount-=s,this._currentActiveCount+=s}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.ik.position){s=this.ik.getWorldMatrix()}else{const k=this.ik;s=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(k.x,k.y,k.z,s)}const g=this._engine;this.updateInAnimate||this._update(s);let ms=0;return k||h||(g.setState(!1),this.forceDepthWrite&&g.setDepthWrite(!0),ms=this.blendMode===Kk.BLENDMODE_MULTIPLYADD?this._render(Kk.BLENDMODE_MULTIPLY,s)+this._render(Kk.BLENDMODE_ADD,s):this._render(this.blendMode,s),this._engine.setAlphaMode(0)),ms}rebuild(){const s=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(s,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,s()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const k in this._drawWrappers){this._drawWrappers[k].dispose()}if(this._drawWrappers={},this._scene){const s=this._scene.la.indexOf(this);s>-1&&this._scene.la.splice(s,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let k=0;k<this._renderVertexBuffers.length;++k){const s=this._renderVertexBuffers[k];for(const k in s)s[k].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),s&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),s&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Dh.notifyObservers(this),this.Dh.clear()}clone(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let g=null;const ms=this._engine;if(ms.createEffectForParticles&&null!=this.customShader){g=this.customShader;const s=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"";A[0]=ms.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,s,void 0,void 0,void 0,this)}const i=this.serialize(h),K=Dk.Parse(i,this._scene||this._engine,this._rootUrl);return K.name=s,K.customShader=g,K._customWrappers=A,void 0===k&&(k=this.ik),this.noiseTexture&&(K.noiseTexture=this.noiseTexture.clone()),K.ik=k,K}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={};return Kk._Serialize(k,this,s),k.activeParticleCount=this.activeParticleCount,k.randomTextureSize=this._randomTextureSize,k.customShader=this.customShader,k}static Parse(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0;const ms=s.name;let i,K;k instanceof Js.e?i=k:(K=k,i=K.getEngine());const H=new Dk(ms,{Ch:g||s.Ch,randomTextureSize:s.randomTextureSize},k,null,s.isAnimationSheetEnabled);if(H._rootUrl=h,s.customShader&&i.createEffectForParticles){const k=s.customShader,h=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",A=i.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,h,void 0,void 0,void 0,H);H.setCustomEffect(A,0),H.customShader=k}return s.id&&(H.id=s.id),s.activeParticleCount&&(H.activeParticleCount=s.activeParticleCount),Kk._Parse(s,H,k,h),s.preventAutoStart&&(H.preventAutoStart=s.preventAutoStart),A||H.preventAutoStart||H.start(),H}}var wk=h(12402),Bk=h(13973),uk=h(12984);class Gk{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(s){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const k of this.systems)k.ik=s;this._emitterNode=s}setEmitterAsSphere(s,k,h){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:s,renderingGroupId:k};const A=(0,Bk.c)("emitterSphere",{diameter:s.diameter,segments:s.segments},h);A.renderingGroupId=k;const g=new uk.wk("emitterSphereMaterial",h);g.emissiveColor=s.color,A.material=g;for(const ms of this.systems)ms.ik=A;this._emitterNode=A}start(s){for(const k of this.systems)s&&(k.ik=s),k.start()}dispose(){for(const s of this.systems)s.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={systems:[]};for(const h of this.systems)k.systems.push(h.serialize(s));return this._emitterNode&&(k.ik=this._emitterCreationOptions),k}static Parse(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;const g=new Gk,ms=this.BaseAssetsUrl+"/textures/";k=k||f.b.LastCreatedScene;for(const i of s.systems)g.systems.push(h?Dk.Parse(i,k,ms,!0,A):Kk.Parse(i,k,ms,!0,A));if(s.ik){const h=s.ik.options;if("Sphere"===s.ik.kind)g.setEmitterAsSphere({diameter:h.diameter,segments:h.segments,color:i.Bk.uk(h.color)},s.ik.renderingGroupId,k)}return g}}Gk.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Qk=h(12442);class pk{static CreateDefault(s){let k,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,A=arguments.length>2?arguments[2]:void 0;k=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Dk("default system",{Ch:h},A):new Kk("default system",h,A),k.ik=s;const g=wk.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return k.particleTexture=new Y.b(g,k.Is()),k.createConeEmitter(.1,Math.PI/4),k.color1=new i.jg(1,1,1,1),k.color2=new i.jg(1,1,1,1),k.colorDead=new i.jg(1,1,1,0),k.minSize=.1,k.maxSize=.1,k.minEmitPower=2,k.maxEmitPower=2,k.updateSpeed=1/60,k.emitRate=30,k}static CreateAsync(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;k||(k=f.b.LastCreatedScene);const g={};return k.addPendingData(g),new Promise(((ms,i)=>{if(h&&!Dk.IsSupported)return k.removePendingData(g),i("Particle system with GPU is not supported.");wk.Tools.LoadFile(`${pk.BaseAssetsUrl}/systems/${s}.json`,(s=>{k.removePendingData(g);const i=JSON.parse(s.toString());return ms(Gk.Parse(i,k,h,A))}),void 0,void 0,void 0,(()=>(k.removePendingData(g),i(`An error occurred with the creation of your particle system. Check if your type '${s}' exists.`))))}))}static ExportSet(s){const k=new Gk;for(const h of s)k.systems.push(h);return k}static ParseFromFileAsync(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",ms=arguments.length>5?arguments[5]:void 0;return new Promise(((i,K)=>{const H=new Qk.d;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const k=JSON.parse(H.responseText);let K;K=A?Dk.Parse(k,h,g,!1,ms):Kk.Parse(k,h,g,!1,ms),s&&(K.name=s),i(K)}else K("Unable to load the particle system")})),H.open("GET",k),H.send()}))}static ParseFromSnippetAsync(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",g=arguments.length>4?arguments[4]:void 0;if("_BLANK"===s){const s=this.CreateDefault(null);return s.start(),Promise.resolve(s)}return new Promise(((ms,i)=>{const K=new Qk.d;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const i=JSON.parse(JSON.parse(K.responseText).jsonPayload),H=JSON.parse(i.particleSystem);let O;O=h?Dk.Parse(H,k,A,!1,g):Kk.Parse(H,k,A,!1,g),O.snippetId=s,ms(O)}else i("Unable to load the snippet "+s)})),K.open("GET",this.SnippetUrl+"/"+s.replace(/#/g,"/")),K.send()}))}}pk.BaseAssetsUrl=Gk.BaseAssetsUrl,pk.SnippetUrl="https://snippet.babylonjs.com",pk.CreateFromSnippetAsync=pk.ParseFromSnippetAsync;var Ik=h(13061),Nk=h(12869),bk=h(13976);(0,bk.e)(Nk.e.NAME_PARTICLESYSTEM,((s,k,h,A)=>{const g=(0,bk.f)(Nk.e.NAME_PARTICLESYSTEM);if(g&&void 0!==s.la&&null!==s.la)for(let ms=0,i=s.la.length;ms<i;ms++){const i=s.la[ms];h.la.push(g(i,k,A))}})),(0,bk.d)(Nk.e.NAME_PARTICLESYSTEM,((s,k,h)=>{if(s.activeParticleCount){return Dk.Parse(s,k,h)}return Kk.Parse(s,k,h)})),Js.e.prototype.createEffectForParticles=function(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",ms=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=arguments.length>9?arguments[9]:void 0,S=[],a=[];const r=[];return H?H.fillUniformsAttributesAndSamplerNames(a,S,r):(S=Kk._GetAttributeNamesOrOptions(),a=Kk._GetEffectCreationOptions()),-1===g.indexOf(" BILLBOARD")&&(g+="\n#define BILLBOARD\n"),null!==H&&void 0!==H&&H.isAnimationSheetEnabled&&-1===g.indexOf(" ANIMATESHEET")&&(g+="\n#define ANIMATESHEET\n"),-1===A.indexOf("diffuseSampler")&&A.push("diffuseSampler"),this.createEffect({vertex:c??(null===H||void 0===H?void 0:H.vertexShaderName)??"particles",fragmentElement:s},S,a.concat(k),r.concat(A),g,ms,i,K,void 0,O,(async()=>{0===O?await Promise.resolve().then(h.bind(h,14006)):await Promise.resolve().then(h.bind(h,14080))}))},Ik.e.prototype.getEmittedParticleSystems=function(){const s=[];for(let k=0;k<this.Is().la.length;k++){const h=this.Is().la[k];h.ik===this&&s.push(h)}return s},Ik.e.prototype.getHierarchyEmittedParticleSystems=function(){const s=[],k=this.getDescendants();k.push(this);for(let h=0;h<this.Is().la.length;h++){const A=this.Is().la[h],g=A.ik;g.position&&-1!==k.indexOf(g)&&s.push(A)}return s};h(12937),h(12953),h(13043);h(13047),h(13983),h(12794),h(12925),h(13081);h(12790);var tk;h(13986),h(12614);!function(s){s[s.Color=2]="Color",s[s.UV=1]="UV",s[s.Random=0]="Random",s[s.Stated=3]="Stated"}(tk||(tk={}));var zk=h(12823);const Ck=new A.Pk(0,0,0),vk=new A.Pk(0,0,0),Yk=new A.Pk(0,0,0);class nk{constructor(s,k,h){this.width=s,this.height=k,this.data=h}processFlowable(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;if(!h)return;h instanceof A.Matrix?A.Pk.TransformCoordinatesToRef(s.position,h,Yk):(Yk.x=h.x,Yk.y=h.y,Yk.z=h.z);const g=.5*Yk.x+.5,ms=1-(.5*Yk.y+.5),i=Math.floor(g*this.width),K=Math.floor(ms*this.height);if(i<0||i>=this.width||K<0||K>=this.height)return;const H=4*(K*this.width+i),O=this.data[H]/255*2-1,c=this.data[H+1]/255*2-1,S=this.data[H+2]/255*2-1,a=this.data[H+3]/255;Ck.set(O,c,S),Ck.scaleToRef(k*a,vk),s.direction.addInPlace(vk)}_processParticle(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;this.processFlowable(s,k,h)}static async FromUrlAsync(s){return await new Promise(((k,h)=>{const A=document.createElement("canvas"),g=A.getContext("2d");let ms=null;const i=new Image;i.crossOrigin="anonymous",i.src=s,i.onerror=k=>{h(new Error(`Failed to load image: ${s} : ${k}`))},i.onload=()=>{A.width=i.width,A.height=i.height,g.drawImage(i,0,0),ms=g.getImageData(0,0,A.width,A.height),k(new nk(A.width,A.height,ms.data))}}))}static async ExtractFromTextureAsync(s){return await new Promise(((k,h)=>{if(!s.isReady())return void s.onLoadObservable.addOnce((async()=>{try{const h=await this.ExtractFromTextureAsync(s);k(h)}catch(A){h(A)}}));const A=s.getSize();zk.n.GetTextureDataAsync(s,A.width,A.height).then((s=>{k(new nk(A.width,A.height,new Uint8ClampedArray(s)))})).catch(h)}))}}var Tk,Uk,qk,Mk,Vk,Xk,Lk,Zk,xk;!function(s){s[s.Int=1]="Int",s[s.Float=2]="Float",s[s.Vector2=4]="Vector2",s[s.Pk=8]="Pk",s[s.Matrix=16]="Matrix",s[s.Particle=32]="Particle",s[s.Texture=64]="Texture",s[s.jg=128]="jg",s[s.FloatGradient=256]="FloatGradient",s[s.Vector2Gradient=512]="Vector2Gradient",s[s.Vector3Gradient=1024]="Vector3Gradient",s[s.Color4Gradient=2048]="Color4Gradient",s[s.System=4096]="System",s[s.AutoDetect=8192]="AutoDetect",s[s.BasedOnInput=16384]="BasedOnInput",s[s.Undefined=32768]="Undefined",s[s.All=65535]="All"}(Tk||(Tk={})),function(s){s[s.Compatible=0]="Compatible",s[s.TypeIncompatible=1]="TypeIncompatible",s[s.HierarchyIssue=2]="HierarchyIssue"}(Uk||(Uk={})),function(s){s[s.Input=0]="Input",s[s.Output=1]="Output"}(qk||(qk={}));class yk{get direction(){return this._direction}get type(){if(this._type===Tk.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Tk.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(s){this._type=s}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((s=>s.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(s,k,h){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Tk.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new o.c,this.onDisconnectionObservable=new o.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=k,this.name=s,this._direction=h}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(s){var k;return this.isConnected?null!==(k=this._connectedPoint)&&void 0!==k&&k._storedFunction?this._connectedPoint._storedFunction(s):this._connectedPoint._storedValue:this.value}canConnectTo(s){return 0===this.checkCompatibilityState(s)}checkCompatibilityState(s){const k=this._ownerBlock,h=s.ownerBlock;if(this.type!==s.type&&s.innerType!==Tk.AutoDetect)return s.acceptedConnectionPointTypes&&-1!==s.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(s.excludedConnectionPointTypes&&-1!==s.excludedConnectionPointTypes.indexOf(this.type))return 1;let A=h,g=k;return 0===this.direction&&(A=k,g=h),A.isAnAncestorOf(g)?2:0}connectTo(s){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(s))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${s.ownerBlock.name}".${s.name}`;return this._endpoints.push(s),s._connectedPoint=this,this.onConnectionObservable.notifyObservers(s),s.onConnectionObservable.notifyObservers(this),this}disconnectFrom(s){const k=this._endpoints.indexOf(s);return-1===k||(this._endpoints.splice(k,1),s._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(s),s.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(s){let k=1;for(;k<Tk.All;)s&k||this.excludedConnectionPointTypes.push(k),k<<=1}serialize(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const k={};return k.name=this.name,k.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.yh?(k.valueType="BABYLON."+this.value.getClassName(),k.value=this.value.yh()):(k.valueType="number",k.value=this.value)),s&&this.connectedPoint&&(k.inputName=this.name,k.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,k.targetConnectionName=this.connectedPoint.name,k.isExposedOnFrame=!0,k.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(k.isExposedOnFrame=!0,k.exposedPortPosition=this.exposedPortPosition),k}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Wk{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(s){this._name=s}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(s){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new o.c,this.Dh=new o.c,this.onInputChangedObservable=new o.c,this.visibleOnFrame=!1,this._name=s,this.uniqueId=n.b.UniqueId}_inputRename(s){return s}_outputRename(s){return s}isAnAncestorOf(s){for(const k of this._outputs)if(k.hasEndpoints)for(const h of k.endpoints){if(h.ownerBlock===s)return!0;if(h.ownerBlock.isAnAncestorOf(s))return!0}return!1}isAnAncestorOfType(s){if(this.getClassName()===s)return!0;for(const k of this._outputs)if(k.hasEndpoints)for(const h of k.endpoints)if(h.ownerBlock.isAnAncestorOfType(s))return!0;return!1}getInputByName(s){const k=this._inputs.filter((k=>k.name===s));return k.length?k[0]:null}_linkConnectionTypes(s,k){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[k]._acceptedConnectionPointType=this._inputs[s]:(this._inputs[s]._linkedConnectionSource=this._inputs[k],this._inputs[s]._isMainLinkSource=!0),this._inputs[k]._linkedConnectionSource=this._inputs[s]}registerInput(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,ms=arguments.length>5?arguments[5]:void 0;const i=new yk(s,this,0);return i.type=k,i.isOptional=h,i.defaultValue=A,i.value=A,i.valueMin=g,i.valueMax=ms,this._inputs.push(i),this.onInputChangedObservable.notifyObservers(i),this}registerOutput(s,k,h){return(h=h??new yk(s,this,1)).type=k,this._outputs.push(h),this}_build(s){}_customBuildStep(s){}build(s){if(this._buildId===s.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((s=>s.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=s.buildId;for(const k of this._inputs){if(!k.connectedPoint){k.isOptional||s.notConnectedNonOptionalInputs.push(k);continue}const h=k.connectedPoint.ownerBlock;h&&h!==this&&!h.isSystem&&h.build(s)}return this._customBuildStep(s),s.verbose&&T.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(s),this.onBuildObservable.notifyObservers(this),!1}serialize(){const s={};s.customType="BABYLON."+this.getClassName(),s.id=this.uniqueId,s.name=this.name,s.visibleOnFrame=this.visibleOnFrame,s.inputs=[],s.outputs=[];for(const k of this.inputs)s.inputs.push(k.serialize());for(const k of this.outputs)s.outputs.push(k.serialize(!1));return s}_deserialize(s){this._name=s.name,this.comments=s.comments,this.visibleOnFrame=!!s.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(s)}_deserializePortDisplayNamesAndExposedOnFrame(s){const k=s.inputs,h=s.outputs;if(k)for(const A of k){const s=this.inputs.find((s=>s.name===A.name));if(!s)return;if(A.displayName&&(s.displayName=A.displayName),A.isExposedOnFrame&&(s.isExposedOnFrame=A.isExposedOnFrame,s.exposedPortPosition=A.exposedPortPosition),void 0!==A.value&&null!==A.value)if("number"===A.valueType)s.value=A.value;else{const k=(0,K.d)(A.valueType);k&&(s.value=k.uk(A.value))}}if(h)for(let A=0;A<h.length;A++){const s=h[A];s.displayName&&(this.outputs[A].displayName=s.displayName),s.isExposedOnFrame&&(this.outputs[A].isExposedOnFrame=s.isExposedOnFrame,this.outputs[A].exposedPortPosition=s.exposedPortPosition)}}clone(){const s=this.serialize(),k=(0,K.d)(s.customType);if(k){const h=new k;return h._deserialize(s),h}return null}dispose(){this.Dh.notifyObservers(this),this.Dh.clear();for(const s of this.inputs)s.dispose();for(const s of this.outputs)s.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Jk(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",A=arguments.length>3?arguments[3]:void 0;return(g,ms)=>{let i=g._propStore;i||(i=[],g._propStore=i),i.push({propertyName:ms,displayName:s,type:k,groupName:h,options:A??{},className:g.getClassName()})}}(0,z.e)([(0,C.J)("comment")],Wk.prototype,"comments",void 0),function(s){s[s.Boolean=0]="Boolean",s[s.Float=1]="Float",s[s.Int=2]="Int",s[s.Vector2=3]="Vector2",s[s.List=4]="List",s[s.jg=5]="jg",s[s.SamplingMode=6]="SamplingMode",s[s.TextureFormat=7]="TextureFormat",s[s.TextureType=8]="TextureType"}(Mk||(Mk={})),function(s){s[s.None=0]="None",s[s.Position=1]="Position",s[s.Direction=2]="Direction",s[s.Age=3]="Age",s[s.Lifetime=4]="Lifetime",s[s.Color=5]="Color",s[s.ScaledDirection=6]="ScaledDirection",s[s.Scale=7]="Scale",s[s.AgeGradient=8]="AgeGradient",s[s.Angle=9]="Angle",s[s.SpriteCellIndex=16]="SpriteCellIndex",s[s.SpriteCellStart=17]="SpriteCellStart",s[s.SpriteCellEnd=18]="SpriteCellEnd"}(Vk||(Vk={})),function(s){s[s.None=0]="None",s[s.Time=1]="Time",s[s.Delta=2]="Delta",s[s.Emitter=3]="Emitter"}(Xk||(Xk={}));class Fk{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let s="";for(const k of this.notConnectedNonOptionalInputs)s+=`input ${k.name} from block ${k.ownerBlock.name}[${k.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(s)throw"Build of Node Particle System Set failed:\n"+s}adapt(s,k){const h=s.getConnectedValue(this)||0;if(s.type===k)return h;switch(k){case Tk.Vector2:return new A.Vector2(h,h);case Tk.Pk:return new A.Pk(h,h,h);case Tk.jg:return new i.jg(h,h,h,h)}return null}getContextualValue(s){if(!this.particleContext||!this.systemContext)return null;switch(s){case Vk.Position:return this.particleContext.position;case Vk.Direction:return this.particleContext.direction;case Vk.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Vk.Color:return this.particleContext.color;case Vk.Age:return this.particleContext.age;case Vk.Lifetime:return this.particleContext.lifeTime;case Vk.Angle:return this.particleContext.angle;case Vk.Scale:return this.particleContext.scale;case Vk.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Vk.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Vk.SpriteCellIndex:return this.particleContext.cellIndex;case Vk.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.ik.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.ik.absolutePosition:this.systemContext.ik:null}getSystemValue(s){if(!this.particleContext||!this.systemContext)return null;switch(s){case Xk.Time:return this.systemContext._actualFrame;case Xk.Delta:return this.systemContext._scaledUpdateSpeed;case Xk.Emitter:if(this.isEmitterTransformNode){return this.systemContext.ik.absolutePosition}return this.systemContext.ik}return null}}function ok(s,k,h){const A=new Fk;A.Dk=k;const g=s.createSystem(A);return g.canStart=()=>!0,g.ik=h.clone(),g.disposeOnStop=!0,g.start(),g}class lk extends Wk{constructor(s){super(s),this.blendMode=H.BLENDMODE_ONEONE,this.Ch=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Tk.Particle),this.registerInput("texture",Tk.Texture),this.registerInput("onStart",Tk.System,!0),this.registerInput("onEnd",Tk.System,!0),this.registerOutput("system",Tk.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(s){s.Ch=this.Ch,s.buildId=this._buildId++,this.build(s);const k=this.particle.getConnectedValue(s);return k.particleTexture=this.texture.getConnectedValue(s),k.emitRate=this.emitRate,k.blendMode=this.blendMode,k.name=this.name,k._nodeGenerated=!0,k._targetStopDuration=this.targetStopDuration,k.startDelay=this.startDelay,this.system._storedValue=this,k.canStart=()=>!this.doNoStart,k.onStartedObservable.add((h=>{const A=this.onStart.getConnectedValue(s);A&&h.onStartedObservable.addOnce((()=>{s.systemContext=k;const h=ok(A,s.Dk,s.emitterPosition);this.Dh.addOnce((()=>{h.dispose()}))}));const g=this.onEnd.getConnectedValue(s);g&&h.onStoppedObservable.addOnce((()=>{s.systemContext=k;const h=ok(g,s.Dk,s.emitterPosition);this.Dh.addOnce((()=>{h.dispose()}))}))})),this.Dh.addOnce((()=>{k.dispose()})),k}serialize(){const s=super.serialize();return s.Ch=this.Ch,s.emitRate=this.emitRate,s.blendMode=this.blendMode,s.doNoStart=this.doNoStart,s.targetStopDuration=this.targetStopDuration,s.startDelay=this.startDelay,s}_deserialize(s){super._deserialize(s),this.Ch=s.Ch,this.emitRate=s.emitRate,this.doNoStart=!!s.doNoStart,void 0!==s.blendMode&&(this.blendMode=s.blendMode),void 0!==s.targetStopDuration&&(this.targetStopDuration=s.targetStopDuration),void 0!==s.startDelay&&(this.startDelay=s.startDelay)}}(0,z.e)([Jk("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:H.BLENDMODE_ONEONE},{label:"Standard",value:H.BLENDMODE_STANDARD},{label:"Add",value:H.BLENDMODE_ADD},{label:"Multiply",value:H.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:H.BLENDMODE_MULTIPLYADD}]})],lk.prototype,"blendMode",void 0),(0,z.e)([Jk("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],lk.prototype,"Ch",void 0),(0,z.e)([Jk("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lk.prototype,"emitRate",void 0),(0,z.e)([Jk("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lk.prototype,"targetStopDuration",void 0),(0,z.e)([Jk("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lk.prototype,"startDelay",void 0),(0,z.e)([Jk("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],lk.prototype,"doNoStart",void 0),(0,K.f)("BABYLON.SystemBlock",lk);class fk extends Wk{get type(){if(this._type===Tk.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Tk.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Tk.Vector2,this._type;case"Pk":return this._type=Tk.Pk,this._type;case"jg":return this._type=Tk.jg,this._type;case"Matrix":return this._type=Tk.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Vk.None&&this._systemSource!==Xk.None}get systemSource(){return this._systemSource}set systemSource(s){if(this._systemSource=s,s!==Xk.None){switch(this._contextualSource=Vk.None,this._type=Tk.Float,s){case Xk.Time:case Xk.Delta:this._type=Tk.Float;break;case Xk.Emitter:this._type=Tk.Pk}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Vk.None}get contextualValue(){return this._contextualSource}set contextualValue(s){if(this._contextualSource=s,s!==Vk.None){switch(this._systemSource=Xk.None,s){case Vk.Scale:this._type=Tk.Vector2;break;case Vk.Position:case Vk.Direction:case Vk.ScaledDirection:this._type=Tk.Pk;break;case Vk.Color:this._type=Tk.jg;break;case Vk.Age:case Vk.Lifetime:case Vk.Angle:case Vk.AgeGradient:this._type=Tk.Float;break;case Vk.SpriteCellEnd:case Vk.SpriteCellStart:case Vk.SpriteCellIndex:this._type=Tk.Int}this.output&&(this.output.type=this._type)}}constructor(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tk.AutoDetect;super(s),this._type=Tk.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new o.c,this._systemSource=Xk.None,this._contextualSource=Vk.None,this._type=k,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",k)}get value(){return this._storedValue}set value(s){this.type===Tk.Float&&this.min!==this.max&&(s=Math.max(this.min,s),s=Math.min(this.max,s)),this._storedValue=s,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(s){this._valueCallback=s}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Tk.Int:case Tk.Float:this.value=0;break;case Tk.Vector2:this.value=A.Vector2.Zero();break;case Tk.Pk:this.value=A.Pk.Zero();break;case Tk.jg:this.value=new i.jg(1,1,1,1);break;case Tk.Matrix:this.value=A.Matrix.Identity()}}_build(s){super._build(s),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=s=>s.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=s=>s.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const s=super.serialize();return s.type=this.type,s.contextualValue=this.contextualValue,s.systemSource=this.systemSource,s.min=this.min,s.max=this.max,s.groupInInspector=this.groupInInspector,s.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.yh?(s.valueType="BABYLON."+this._storedValue.getClassName(),s.value=this._storedValue.yh()):(s.valueType="number",s.value=this._storedValue)),s}_deserialize(s){if(super._deserialize(s),this._type=s.type,this.contextualValue=s.contextualValue,this.systemSource=s.systemSource||Xk.None,this.min=s.min||0,this.max=s.max||0,this.groupInInspector=s.groupInInspector||"",void 0!==s.displayInInspector&&(this.displayInInspector=s.displayInInspector),s.valueType)if("number"===s.valueType)this._storedValue=s.value;else{const k=(0,K.d)(s.valueType);k&&(this._storedValue=k.uk(s.value))}}}(0,K.f)("BABYLON.ParticleInputBlock",fk);class ek extends Wk{get url(){return this._url}set url(s){this._url!==s&&(this._cachedData=null,this._url=s,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(s){this._textureDataUrl!==s&&(this._cachedData=null,this._textureDataUrl=s,this._url="",this._sourceTexture=null)}set sourceTexture(s){this._sourceTexture!==s&&(this._cachedData=null,this._sourceTexture=s,this._url="",this._textureDataUrl="")}constructor(s){super(s),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Tk.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const s=this.texture._storedValue;return await new Promise(((k,h)=>{if(!s.isReady())return void s.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),k(this._cachedData)}catch(s){h(s)}}));const A=s.getSize();zk.n.GetTextureDataAsync(s,A.width,A.height).then((h=>{this._cachedData={width:A.width,height:A.height,data:new Uint8ClampedArray(h)},s.dispose(),k(this._cachedData)})).catch(h)}))}_build(s){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Y.b(this._textureDataUrl,s.Dk):this.texture._storedValue=new Y.b(this._url,s.Dk):this.texture._storedValue=null}serialize(){const s=super.serialize();return s.url=this.url,s.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(s.textureDataUrl=this.textureDataUrl),s}_deserialize(s){super._deserialize(s),this.url=s.url,this.serializedCachedData=!!s.serializedCachedData,s.textureDataUrl&&(this.textureDataUrl=s.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,K.f)("BABYLON.ParticleTextureSourceBlock",ek);class sh extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("position",Tk.Pk),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(s){const k=this.particle.getConnectedValue(s);if(this.output._storedValue=k,!this.position.isConnected)return;const h={process:h=>{s.particleContext=h,s.systemContext=k,h.position.H(this.position.getConnectedValue(s))},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h}}(0,K.f)("BABYLON.UpdatePositionBlock",sh),function(s){s[s.Add=0]="Add",s[s.Subtract=1]="Subtract",s[s.Multiply=2]="Multiply",s[s.Divide=3]="Divide",s[s.Max=4]="Max",s[s.Min=5]="Min"}(Lk||(Lk={}));class kh extends Wk{constructor(s){super(s),this.operation=Lk.Add,this.registerInput("left",Tk.AutoDetect),this.registerInput("right",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this.output._typeConnectionSource=this.left;const k=[Tk.Matrix,Tk.Particle,Tk.Texture,Tk.System,Tk.FloatGradient,Tk.Color4Gradient,Tk.Vector2Gradient,Tk.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...k),this.right.excludedConnectionPointTypes.push(...k),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(s){let k;const h=this.left,g=this.right;if(!h.isConnected||!g.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const ms=h.type===Tk.Float||h.type===Tk.Int,K=g.type===Tk.Float||g.type===Tk.Int,H=ms&&K;switch(this.operation){case Lk.Add:k=H?s=>h.getConnectedValue(s)+g.getConnectedValue(s):ms?s=>s.adapt(h,g.type).add(g.getConnectedValue(s)):s=>h.getConnectedValue(s).add(s.adapt(g,h.type));break;case Lk.Subtract:k=H?s=>h.getConnectedValue(s)-g.getConnectedValue(s):ms?s=>s.adapt(h,g.type).Rk(g.getConnectedValue(s)):s=>h.getConnectedValue(s).Rk(s.adapt(g,h.type));break;case Lk.Multiply:k=H?s=>h.getConnectedValue(s)*g.getConnectedValue(s):ms?s=>s.adapt(h,g.type).multiply(g.getConnectedValue(s)):s=>h.getConnectedValue(s).multiply(s.adapt(g,h.type));break;case Lk.Divide:k=H?s=>h.getConnectedValue(s)/g.getConnectedValue(s):ms?s=>s.adapt(h,g.type).divide(g.getConnectedValue(s)):s=>h.getConnectedValue(s).divide(s.adapt(g,h.type));break;case Lk.Min:if(H)k=s=>Math.min(h.getConnectedValue(s),g.getConnectedValue(s));else{const[s,K]=ms?[g,h]:[h,g];switch(s.type){case Tk.Vector2:k=k=>A.Vector2.Minimize(s.getConnectedValue(k),k.adapt(K,s.type));break;case Tk.Pk:k=k=>A.Pk.Minimize(s.getConnectedValue(k),k.adapt(K,s.type));break;case Tk.jg:k=k=>{const h=s.getConnectedValue(k),{r:A,g:g,b:ms,a:H}=k.adapt(K,s.type);return new i.jg(Math.min(h.r,A),Math.min(h.g,g),Math.min(h.b,ms),Math.min(h.a,H))}}}break;case Lk.Max:if(!H){const[s,K]=ms?[g,h]:[h,g];switch(s.type){case Tk.Vector2:k=k=>A.Vector2.Maximize(s.getConnectedValue(k),k.adapt(K,s.type));break;case Tk.Pk:k=k=>A.Pk.Maximize(s.getConnectedValue(k),k.adapt(K,s.type));break;case Tk.jg:k=k=>{const h=s.getConnectedValue(k),{r:A,g:g,b:ms,a:H}=k.adapt(K,s.type);return new i.jg(Math.max(h.r,A),Math.min(h.g,g),Math.min(h.b,ms),Math.min(h.a,H))}}break}k=s=>Math.max(h.getConnectedValue(s),g.getConnectedValue(s))}this.output._storedFunction=s=>h.type===Tk.Int?0|k(s):k(s)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Tk.Int||this.left.type===Tk.Float&&this.right.type!==Tk.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[s,k]of[[this.left,this.right],[this.right,this.left]])s.acceptedConnectionPointTypes=[Tk.Int,Tk.Float],k.isConnected&&(s.acceptedConnectionPointTypes.push(k.type),k.type!==Tk.Int&&k.type!==Tk.Float||s.acceptedConnectionPointTypes.push(Tk.Vector2,Tk.Pk,Tk.jg))}dispose(){super.dispose();for(const s of this._connectionObservers)s.remove();this._connectionObservers.length=0}serialize(){const s=super.serialize();return s.operation=this.operation,s}_deserialize(s){super._deserialize(s),this.operation=s.operation}}(0,z.e)([Jk("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Lk.Add},{label:"Subtract",value:Lk.Subtract},{label:"Multiply",value:Lk.Multiply},{label:"Divide",value:Lk.Divide},{label:"Max",value:Lk.Max},{label:"Min",value:Lk.Min}]})],kh.prototype,"operation",void 0),(0,K.f)("BABYLON.ParticleMathBlock",kh);class hh extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("direction1",Tk.Pk,!0,new A.Pk(0,1,0)),this.registerInput("direction2",Tk.Pk,!0,new A.Pk(0,1,0)),this.registerInput("minEmitBox",Tk.Pk,!0,new A.Pk(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Tk.Pk,!0,new A.Pk(.5,.5,.5)),this.registerOutput("output",Tk.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(s){const k=this.particle.getConnectedValue(s);k._directionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.direction1.getConnectedValue(s),ms=this.direction2.getConnectedValue(s),i=(0,O.RandomRange)(g.x,ms.x),K=(0,O.RandomRange)(g.y,ms.y),H=(0,O.RandomRange)(g.z,ms.z);s.isEmitterTransformNode?A.Pk.TransformNormalFromFloatsToRef(i,K,H,s.emitterWorldMatrix,h.direction):h.direction.cg(i,K,H)},k._positionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.minEmitBox.getConnectedValue(s),ms=this.maxEmitBox.getConnectedValue(s),i=(0,O.RandomRange)(g.x,ms.x),K=(0,O.RandomRange)(g.y,ms.y),H=(0,O.RandomRange)(g.z,ms.z);s.isEmitterTransformNode?A.Pk.TransformCoordinatesFromFloatsToRef(i,K,H,s.emitterWorldMatrix,h.position):(h.position.cg(i,K,H),h.position.addInPlace(s.emitterPosition))},this.output._storedValue=k}}(0,K.f)("BABYLON.BoxShapeBlock",hh);class Ah extends Wk{constructor(s){super(s),this.registerInput("emitPower",Tk.Float,!0,1),this.registerInput("lifeTime",Tk.Float,!0,1),this.registerInput("color",Tk.jg,!0,new i.jg(1,1,1,1)),this.registerInput("scale",Tk.Vector2,!0,new A.Vector2(1,1)),this.registerInput("angle",Tk.Float,!0,0),this.registerOutput("particle",Tk.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(s){const k=new Kk(this.name,s.Ch,s.Dk,null,!1,void 0,!0);k.particleEmitterType=new P,k._lifeTimeCreation.process=(k,h)=>{s.particleContext=k,k.lifeTime=this.lifeTime.getConnectedValue(s),h._emitPower=this.emitPower.getConnectedValue(s)},k._colorCreation.process=k=>{s.particleContext=k,k.color.H(this.color.getConnectedValue(s))},k._sizeCreation.process=k=>{s.particleContext=k,k.size=1,k.scale.H(this.scale.getConnectedValue(s))},k._angleCreation.process=k=>{s.particleContext=k,k.angle=this.angle.getConnectedValue(s)},this.particle._storedValue=k}}(0,K.f)("BABYLON.CreateParticleBlock",Ah);class gh{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const s=[];for(const k of this.attachedBlocks)k.isInput&&s.push(k);return s}constructor(s){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new o.c,this.name=s}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(s)&&this.attachedBlocks.push(s);for(const h of s.inputs){const A=h.connectedPoint;if(A){const h=A.ownerBlock;h!==s&&this._initializeBlock(h,k)}}}async buildAsync(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((h=>{const A=new Gk;for(const s of this._systemBlocks)this._initializeBlock(s);for(const g of this.systemBlocks){const h=new Fk;h.buildId=this._buildId++,h.Dk=s,h.verbose=k;const ms=g.createSystem(h);h.emitErrors(),A.systems.push(ms)}this.onBuildObservable.notifyObservers(this),h(A)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const s=new lk("Particle system"),k=new sh("Update position");k.output.connectTo(s.particle);const h=new fk("Position");h.contextualValue=Vk.Position;const A=new fk("Scaled direction");A.contextualValue=Vk.ScaledDirection;const g=new kh("Add");g.operation=Lk.Add,h.output.connectTo(g.left),A.output.connectTo(g.right),g.output.connectTo(k.position);const ms=new Ah("Create particle"),i=new hh("Box shape");ms.particle.connectTo(i.particle),i.output.connectTo(k.particle);const K=new ek("Texture");K.texture.connectTo(s.texture),K.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(s)}removeBlock(s){const k=this.attachedBlocks.indexOf(s);if(k>-1&&this.attachedBlocks.splice(k,1),s.isSystem){const k=this._systemBlocks.indexOf(s);k>-1&&this._systemBlocks.splice(k,1)}}parseSerializedObject(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k||this.clear();const h={};for(const A of s.jS){const s=(0,K.d)(A.customType);if(s){const k=new s;k._deserialize(A),h[A.id]=k,this.attachedBlocks.push(k),k.isSystem&&this._systemBlocks.push(k)}}for(const A of this.attachedBlocks)if(A.isTeleportOut){const s=A,k=s._tempEntryPointUniqueId;if(k){const A=h[k];A&&A.attachToEndpoint(s)}}for(let A=0;A<s.jS.length;A++){const g=s.jS[A],ms=h[g.id];ms&&(ms.inputs.length&&g.inputs.some((s=>s.targetConnectionName))&&!k||this._restoreConnections(ms,s,h))}if(s.locations||s.editorData&&s.editorData.locations){const A=s.locations||s.editorData.locations;for(const s of A)h[s.Cm]&&(s.Cm=h[s.Cm].uniqueId);k&&this.editorData&&this.editorData.locations&&A.concat(this.editorData.locations),s.locations?this.editorData={locations:A}:(this.editorData=s.editorData,this.editorData.locations=A);const g=[];for(const s in h)g[s]=h[s].uniqueId;this.editorData.map=g}this.comment=s.comment}_restoreConnections(s,k,h){for(const A of s.outputs)for(const g of k.jS){const ms=h[g.id];if(ms)for(const i of g.inputs)if(h[i.targetBlockId]!==s||i.targetConnectionName!==A.name);else{const s=ms.getInputByName(i.inputName);if(!s||s.isConnected)continue;A.connectTo(s,!0),this._restoreConnections(ms,k,h)}}}serialize(s){const k=s?{}:v.e.Serialize(this);k.editorData=JSON.parse(JSON.stringify(this.editorData));let h=[];s?h=s:k.customType="BABYLON.NodeParticleSystemSet",k.jS=[];for(const A of h)k.jS.push(A.serialize());if(!s)for(const A of this.attachedBlocks)-1===h.indexOf(A)&&k.jS.push(A.serialize());return k}dispose(){for(const s of this.attachedBlocks)s.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(s){const k=new gh(s);return k.setToDefault(),k}static Parse(s){const k=v.e.Parse((()=>new gh(s.name)),s,null);return k.parseSerializedObject(s),k}static ParseFromSnippetAsync(s,k){return"_BLANK"===s?Promise.resolve(gh.CreateDefault("blank")):new Promise(((h,A)=>{const g=new Qk.d;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const i=JSON.parse(JSON.parse(g.responseText).jsonPayload),K=JSON.parse(i.nodeParticle);k||(k=v.e.Parse((()=>new gh(s)),K,null)),k.parseSerializedObject(K),k.snippetId=s;try{h(k)}catch(ms){A(ms)}}else A("Unable to load the snippet "+s)})),g.open("GET",this.SnippetUrl+"/"+s.replace(/#/g,"/")),g.send()}))}}gh.EditorURL=`${wk.Tools._DefaultCdnUrl}/v${Js.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,gh.SnippetUrl="https://snippet.babylonjs.com",(0,z.e)([(0,C.J)()],gh.prototype,"name",void 0),(0,z.e)([(0,C.J)("comment")],gh.prototype,"comment",void 0),function(s){s[s.None=0]="None",s[s.PerParticle=1]="PerParticle",s[s.PerSystem=2]="PerSystem"}(Zk||(Zk={}));class mA extends Wk{constructor(s){super(s),this._currentLockId=-2,this.lockMode=Zk.PerParticle,this.registerInput("min",Tk.AutoDetect,!0,0),this.registerInput("max",Tk.AutoDetect,!0,1),this.registerOutput("output",Tk.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tk.Float|Tk.Int|Tk.Vector2|Tk.Pk|Tk.jg),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tk.Float|Tk.Int|Tk.Vector2|Tk.Pk|Tk.jg),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Tk.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let s=null;switch(this._currentLockId=-2,this.min.type){case Tk.AutoDetect:case Tk.Int:case Tk.Float:s=s=>{const k=this.min.getConnectedValue(s)||0,h=this.max.getConnectedValue(s)||1;return k+Math.random()*(h-k)};break;case Tk.Vector2:s=s=>{const k=this.min.getConnectedValue(s)||A.Vector2.Zero(),h=this.max.getConnectedValue(s)||A.Vector2.One();return new A.Vector2(k.x+Math.random()*(h.x-k.x),k.y+Math.random()*(h.y-k.y))};break;case Tk.Pk:s=s=>{const k=this.min.getConnectedValue(s)||A.Pk.Zero(),h=this.max.getConnectedValue(s)||A.Pk.One();return new A.Pk(k.x+Math.random()*(h.x-k.x),k.y+Math.random()*(h.y-k.y),k.z+Math.random()*(h.z-k.z))};break;case Tk.jg:s=s=>{const k=this.min.getConnectedValue(s)||new i.jg(0,0,0,0),h=this.max.getConnectedValue(s)||new i.jg(1,1,1,1);return new i.jg(k.x+Math.random()*(h.x-k.x),k.y+Math.random()*(h.y-k.y),k.z+Math.random()*(h.z-k.z),k.w+Math.random()*(h.w-k.w))}}this.output._storedFunction=k=>{var h;let A=0;switch(this.lockMode){case Zk.PerParticle:A=(null===(h=k.particleContext)||void 0===h?void 0:h.id)||-1;break;case Zk.PerSystem:A=k.buildId||0}return this._currentLockId!==A&&(this.lockMode!==Zk.None&&(this._currentLockId=A),this.output._storedValue=s(k)),this.output._storedValue}}serialize(){const s=super.serialize();return s.lockMode=this.lockMode,s}_deserialize(s){super._deserialize(s),this.lockMode=s.lockMode}}(0,z.e)([Jk("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Zk.None},{label:"Per particle",value:Zk.PerParticle},{label:"Per system",value:Zk.PerSystem}]})],mA.prototype,"lockMode",void 0),(0,K.f)("BABYLON.ParticleRandomBlock",mA);class ih extends Wk{constructor(s){super(s),this._currentLockId=-2,this.lockMode=Zk.PerParticle,this.registerInput("min",Tk.AutoDetect),this.registerInput("max",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const k=[Tk.Matrix,Tk.Particle,Tk.Texture,Tk.System,Tk.FloatGradient,Tk.Color4Gradient,Tk.Vector2Gradient,Tk.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...k),this.max.excludedConnectionPointTypes.push(...k)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let s=null;switch(this._currentLockId=-2,this.min.type){case Tk.Float:case Tk.Int:s=s=>{const k=this.min.getConnectedValue(s),h=this.max.getConnectedValue(s);return Math.random()*(h-k)+k};break;case Tk.Vector2:s=s=>{const k=this.min.getConnectedValue(s),h=this.max.getConnectedValue(s);return new A.Vector2(Math.random()*(h.x-k.x)+k.x,Math.random()*(h.y-k.y)+k.y)};break;case Tk.Pk:s=s=>{const k=this.min.getConnectedValue(s),h=this.max.getConnectedValue(s);return new A.Pk(Math.random()*(h.x-k.x)+k.x,Math.random()*(h.y-k.y)+k.y,Math.random()*(h.z-k.z)+k.z)};break;case Tk.jg:s=s=>{const k=this.min.getConnectedValue(s),h=this.max.getConnectedValue(s);return new i.jg(Math.random()*(h.r-k.r)+k.r,Math.random()*(h.g-k.g)+k.g,Math.random()*(h.b-k.b)+k.b,Math.random()*(h.a-k.a)+k.a)}}this.output._storedFunction=k=>{var h;let A=0;switch(this.lockMode){case Zk.PerParticle:A=(null===(h=k.particleContext)||void 0===h?void 0:h.id)||-1;break;case Zk.PerSystem:A=k.buildId||0}return this._currentLockId!==A&&(this.lockMode!==Zk.None&&(this._currentLockId=A),this.output._storedValue=s(k)),this.output._storedValue}}serialize(){const s=super.serialize();return s.lockMode=this.lockMode,s}_deserialize(s){super._deserialize(s),void 0!==s.lockMode&&(this.lockMode=s.lockMode)}}(0,z.e)([Jk("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Zk.None},{label:"Per particle",value:Zk.PerParticle},{label:"Per system",value:Zk.PerSystem}]})],ih.prototype,"lockMode",void 0),(0,K.f)("BABYLON.RandomRangeBlock",ih);(0,K.f)("BABYLON.ParticleLerpBlock",class extends Wk{constructor(s){super(s),this.registerInput("left",Tk.AutoDetect),this.registerInput("right",Tk.AutoDetect),this.registerInput("gradient",Tk.Float,!0,0,0,1),this.registerOutput("output",Tk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tk.Float|Tk.Int|Tk.Vector2|Tk.Pk|Tk.jg)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const s=(s,k,h)=>(1-s)*k+s*h;this.output._storedFunction=k=>{const h=this.left.getConnectedValue(k),g=this.right.getConnectedValue(k),ms=this.gradient.getConnectedValue(k);switch(this.left.type){case Tk.Int:case Tk.Float:return s(ms,h,g);case Tk.Vector2:return new A.Vector2(s(ms,h.x,g.x),s(ms,h.y,g.y));case Tk.Pk:return new A.Pk(s(ms,h.x,g.x),s(ms,h.y,g.y),s(ms,h.z,g.z));case Tk.jg:return new i.jg(s(ms,h.r,g.r),s(ms,h.g,g.g),s(ms,h.b,g.b),s(ms,h.a,g.a))}return 0}}});(0,K.f)("BABYLON.UpdateDirectionBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("direction",Tk.Pk),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(s){const k=this.particle.getConnectedValue(s);if(this.output._storedValue=k,!this.direction.isConnected)return;const h={process:h=>{s.particleContext=h,s.systemContext=k,h.direction.H(this.direction.getConnectedValue(s))},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h}});(0,K.f)("BABYLON.UpdateColorBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("color",Tk.jg),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(s){const k=this.particle.getConnectedValue(s);if(this.output._storedValue=k,!this.color.isConnected)return;const h={process:h=>{s.particleContext=h,s.systemContext=k,h.color.H(this.color.getConnectedValue(s))},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h}});(0,K.f)("BABYLON.UpdateScaleBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("scale",Tk.Vector2),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(s){const k=this.particle.getConnectedValue(s);if(this.output._storedValue=k,!this.scale.isConnected)return;const h={process:h=>{s.particleContext=h,s.systemContext=k,h.scale.H(this.scale.getConnectedValue(s))},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h}});(0,K.f)("BABYLON.UpdateAngleBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("angle",Tk.Float),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(s){const k=this.particle.getConnectedValue(s);if(this.output._storedValue=k,!this.angle.isConnected)return;const h={process:h=>{s.particleContext=h,s.systemContext=k,h.angle=this.angle.getConnectedValue(s)},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h}});(0,K.f)("BABYLON.BasicPositionUpdateBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(s){const k=this.particle.getConnectedValue(s),h={process:h=>{s.particleContext=h,s.systemContext=k,h.direction.scaleToRef(k._directionScale,k._scaledDirection),h.position.addInPlace(k._scaledDirection)},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h,this.output._storedValue=k}});(0,K.f)("BABYLON.BasicSpriteUpdateBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(s){const k=this.particle.getConnectedValue(s),h={process:h=>{s.particleContext=h,s.systemContext=k,h.updateCellIndex()},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h,this.output._storedValue=k}});(0,K.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("cellIndex",Tk.Int),this.registerOutput("output",Tk.Particle),this.cellIndex.acceptedConnectionPointTypes=[Tk.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(s){const k=this.particle.getConnectedValue(s);if(this.output._storedValue=k,!this.cellIndex.isConnected)return;const h={process:h=>{s.particleContext=h,s.systemContext=k,h.cellIndex=Math.floor(this.cellIndex.getConnectedValue(s))},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h}});class Kh extends Wk{constructor(s){super(s),this.strength=1,this.registerInput("particle",Tk.Particle),this.registerInput("flowMap",Tk.Texture),this.registerOutput("output",Tk.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(s){var k;const h=this.particle.getConnectedValue(s),A=s.Dk;let g;(null===(k=this.flowMap.connectedPoint)||void 0===k?void 0:k.ownerBlock).extractTextureContentAsync().then((s=>{s&&(g=new nk(s.width,s.height,s.data))}));const ms={process:s=>{const k=A.getTransformMatrix();g&&g._processParticle(s,this.strength*h._tempScaledUpdateSpeed,k)},previousItem:null,nextItem:null};h._updateQueueStart?Xs(ms,h._updateQueueStart):h._updateQueueStart=ms,this.output._storedValue=h}serialize(){const s=super.serialize();return s.strength=this.strength,s}_deserialize(s){super._deserialize(s),this.strength=s.strength}}(0,z.e)([Jk("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kh.prototype,"strength",void 0),(0,K.f)("BABYLON.UpdateFlowMapBlock",Kh);(0,K.f)("BABYLON.SphereShapeBlock",class extends Wk{constructor(s){super(s),this.registerInput("input",Tk.Particle),this.registerInput("radius",Tk.Float,!0,1),this.registerInput("radiusRange",Tk.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tk.Float,!0,0,0,1),this.registerOutput("output",Tk.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(s){const k=this.input.getConnectedValue(s);k._directionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.directionRandomizer.getConnectedValue(s),ms=h.position.Rk(s.emitterPosition).normalize(),i=(0,O.RandomRange)(0,g),K=(0,O.RandomRange)(0,g),H=(0,O.RandomRange)(0,g);ms.x+=i,ms.y+=K,ms.z+=H,ms.normalize(),s.isEmitterTransformNode?A.Pk.TransformNormalFromFloatsToRef(i,K,H,s.emitterWorldMatrix,h.direction):h.direction.cg(i,K,H)},k._positionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.radius.getConnectedValue(s),ms=this.radiusRange.getConnectedValue(s),i=g-(0,O.RandomRange)(0,g*ms),K=(0,O.RandomRange)(0,1),H=(0,O.RandomRange)(0,2*Math.PI),c=Math.acos(2*K-1),S=i*Math.cos(H)*Math.sin(c),a=i*Math.cos(c),r=i*Math.sin(H)*Math.sin(c);s.isEmitterTransformNode?A.Pk.TransformCoordinatesFromFloatsToRef(S,a,r,s.emitterWorldMatrix,h.position):(h.position.cg(S,a,r),h.position.addInPlace(s.emitterPosition))},this.output._storedValue=k}});(0,K.f)("BABYLON.PointShapeBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("direction1",Tk.Pk,!0,new A.Pk(0,1,0)),this.registerInput("direction2",Tk.Pk,!0,new A.Pk(0,1,0)),this.registerOutput("output",Tk.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(s){const k=this.particle.getConnectedValue(s);k._directionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.direction1.getConnectedValue(s),ms=this.direction2.getConnectedValue(s),i=(0,O.RandomRange)(g.x,ms.x),K=(0,O.RandomRange)(g.y,ms.y),H=(0,O.RandomRange)(g.z,ms.z);s.isEmitterTransformNode?A.Pk.TransformNormalFromFloatsToRef(i,K,H,s.emitterWorldMatrix,h.direction):h.direction.cg(i,K,H)},k._positionCreation.process=h=>{s.systemContext=k,s.isEmitterTransformNode?A.Pk.TransformCoordinatesFromFloatsToRef(0,0,0,s.emitterWorldMatrix,h.position):h.position.H(s.emitterPosition)},this.output._storedValue=k}});(0,K.f)("BABYLON.CustomShapeBlock",class extends Wk{constructor(s){super(s),this.registerInput("particle",Tk.Particle),this.registerInput("position",Tk.Pk,!0,new A.Pk(0,0,0)),this.registerInput("direction",Tk.Pk,!0,new A.Pk(0,1,0)),this.registerOutput("output",Tk.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(s){const k=this.particle.getConnectedValue(s);k._directionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.direction.getConnectedValue(s);s.isEmitterTransformNode?A.Pk.TransformNormalToRef(g,s.emitterWorldMatrix,h.direction):h.direction.H(g)},k._positionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.position.getConnectedValue(s);s.isEmitterTransformNode?A.Pk.TransformCoordinatesToRef(g,s.emitterWorldMatrix,h.position):(h.position.H(g),h.position.addInPlace(s.emitterPosition))},this.output._storedValue=k}});(0,K.f)("BABYLON.CylinderShapeBlock",class extends Wk{constructor(s){super(s),this._tempVector=A.Pk.Zero(),this.registerInput("particle",Tk.Particle),this.registerInput("radius",Tk.Float,!0,1),this.registerInput("height",Tk.Float,!0,1,0),this.registerInput("radiusRange",Tk.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tk.Float,!0,0,0,1),this.registerOutput("output",Tk.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(s){const k=this.particle.getConnectedValue(s);k._directionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.directionRandomizer.getConnectedValue(s);h.position.subtractToRef(s.emitterPosition,this._tempVector),this._tempVector.normalize(),s.isEmitterTransformNode&&A.Pk.TransformNormalToRef(this._tempVector,s.emitterInverseWorldMatrix,this._tempVector);const ms=(0,O.RandomRange)(-g/2,g/2);let i=Math.atan2(this._tempVector.x,this._tempVector.z);i+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*g,this._tempVector.y=ms,this._tempVector.x=Math.sin(i),this._tempVector.z=Math.cos(i),this._tempVector.normalize(),s.isEmitterTransformNode?A.Pk.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,s.emitterWorldMatrix,h.direction):h.direction.H(this._tempVector)},k._positionCreation.process=h=>{s.particleContext=h,s.systemContext=k;const g=this.height.getConnectedValue(s),ms=this.radiusRange.getConnectedValue(s),i=this.radius.getConnectedValue(s),K=(0,O.RandomRange)(-g/2,g/2),H=(0,O.RandomRange)(0,2*Math.PI),c=(0,O.RandomRange)((1-ms)*(1-ms),1),S=Math.sqrt(c)*i,a=S*Math.cos(H),r=S*Math.sin(H);s.isEmitterTransformNode?A.Pk.TransformCoordinatesFromFloatsToRef(a,K,r,s.emitterWorldMatrix,h.position):(h.position.cg(a,K,r),h.position.addInPlace(s.emitterPosition))},this.output._storedValue=k}});class Hh extends Wk{constructor(s){super(s),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Tk.Particle),this.registerOutput("output",Tk.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){super._build(s);const k=this.particle.getConnectedValue(s);k._isAnimationSheetEnabled=!0,k.spriteCellWidth=this.width,k.spriteCellHeight=this.height,k.startSpriteCellID=this.start,k.endSpriteCellID=this.end,k.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=k}serialize(){const s=super.serialize();return s.width=this.width,s.height=this.height,s.start=this.start,s.end=this.end,s.randomStartCell=this.randomStartCell,s}_deserialize(s){super._deserialize(s),this.width=s.width,this.height=s.height,this.start=s.start,this.end=s.end,this.randomStartCell=s.randomStartCell}}(0,z.e)([Jk("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"start",void 0),(0,z.e)([Jk("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"end",void 0),(0,z.e)([Jk("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"width",void 0),(0,z.e)([Jk("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"height",void 0),(0,z.e)([Jk("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Hh.prototype,"loop",void 0),(0,z.e)([Jk("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Hh.prototype,"randomStartCell",void 0),(0,K.f)("BABYLON.SetupSpriteSheetBlock",Hh);class Oh extends Wk{constructor(s){super(s),this.reference=0,this.registerInput("value",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=s=>{switch(s){case Tk.Float:return Tk.FloatGradient;case Tk.Vector2:return Tk.Vector2Gradient;case Tk.Pk:return Tk.Vector3Gradient;case Tk.jg:return Tk.Color4Gradient}return s},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tk.Float|Tk.Vector2|Tk.Pk|Tk.jg)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=s=>null}serialize(){const s=super.serialize();return s.reference=this.reference,s}_deserialize(s){super._deserialize(s),this.reference=s.reference}}(0,z.e)([Jk("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Oh.prototype,"reference",void 0),(0,K.f)("BABYLON.ParticleGradientValueBlock",Oh);(0,K.f)("BABYLON.ParticleGradientBlock",class extends Wk{constructor(s){super(s),this._entryCount=1,this.registerInput("gradient",Tk.Float,!0,1,0,1),this.registerInput("value0",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=s=>{switch(s){case Tk.FloatGradient:return Tk.Float;case Tk.Vector2Gradient:return Tk.Vector2;case Tk.Vector3Gradient:return Tk.Pk;case Tk.Color4Gradient:return Tk.jg}return s},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tk.FloatGradient|Tk.Vector2Gradient|Tk.Vector3Gradient|Tk.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(s){this._inputs[s].onConnectionObservable.add((()=>{this._entryCount>s||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Tk.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const s=[];for(let h=1;h<this._inputs.length;h++){var k;if(this._inputs[h].isConnected)s.push(null===(k=this._inputs[h].connectedPoint)||void 0===k?void 0:k.ownerBlock)}s.sort(((s,k)=>s.reference-k.reference)),this.output._storedFunction=k=>{const h=this.gradient.getConnectedValue(k);if(1===s.length)return s[0].value.getConnectedValue(k);let g=null;for(let ms=s.length-1;ms>=0;ms--){const K=s[ms];if(K.reference<=h){const s=K.value.getConnectedValue(k);if(g){const ms=g.value.getConnectedValue(k),H=g.reference,c=K.reference,S=Math.max(0,Math.min(1,(h-c)/(H-c)));switch(this.output.type){case Tk.Float:return(0,O.Lerp)(s,ms,S);case Tk.Vector2:return A.Vector2.Lerp(s,ms,S);case Tk.Pk:return A.Pk.Lerp(s,ms,S);case Tk.jg:return i.jg.Lerp(s,ms,S)}}return s}g=K}return 0}}});(0,K.f)("BABYLON.ParticleConverterBlock",class extends Wk{constructor(s){super(s),this.registerInput("color ",Tk.jg,!0),this.registerInput("xyz ",Tk.Pk,!0),this.registerInput("xy ",Tk.Vector2,!0),this.registerInput("zw ",Tk.Vector2,!0),this.registerInput("x ",Tk.Float,!0),this.registerInput("y ",Tk.Float,!0),this.registerInput("z ",Tk.Float,!0),this.registerInput("w ",Tk.Float,!0),this.registerOutput("color",Tk.jg),this.registerOutput("xyz",Tk.Pk),this.registerOutput("xy",Tk.Vector2),this.registerOutput("zw",Tk.Vector2),this.registerOutput("x",Tk.Float),this.registerOutput("y",Tk.Float),this.registerOutput("z",Tk.Float),this.registerOutput("w",Tk.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(s){return"color "===s?"colorIn":"xyz "===s?"xyzIn":"xy "===s?"xyIn":"zw "===s?"zwIn":"x "===s?"xIn":"y "===s?"yIn":"z "===s?"zIn":"w "===s?"wIn":s}_outputRename(s){switch(s){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return s}}_build(s){super._build(s);const k=this.xIn,h=this.yIn,g=this.zIn,ms=this.wIn,K=this.xyIn,H=this.zwIn,O=this.xyzIn,c=this.colorIn,S=this.colorOut,a=this.xyzOut,r=this.xyOut,d=this.zwOut,E=this.xOut,j=this.yOut,P=this.zOut,R=this.wOut,D=s=>{if(c.isConnected)return c.getConnectedValue(s);let A=0,S=0,a=0,r=0;if(k.isConnected&&(A=k.getConnectedValue(s)),h.isConnected&&(S=h.getConnectedValue(s)),g.isConnected&&(a=g.getConnectedValue(s)),ms.isConnected&&(r=ms.getConnectedValue(s)),K.isConnected){const k=K.getConnectedValue(s);k&&(A=k.x,S=k.y)}if(H.isConnected){const k=H.getConnectedValue(s);k&&(a=k.x,r=k.y)}if(O.isConnected){const k=O.getConnectedValue(s);k&&(A=k.x,S=k.y,a=k.z)}return new i.jg(A,S,a,r)};S._storedFunction=s=>D(s),a._storedFunction=s=>{const k=D(s);return new A.Pk(k.r,k.g,k.b)},r._storedFunction=s=>{const k=D(s);return new A.Vector2(k.r,k.g)},d._storedFunction=s=>{const k=D(s);return new A.Vector2(k.b,k.a)},E._storedFunction=s=>D(s).r,j._storedFunction=s=>D(s).g,P._storedFunction=s=>D(s).b,R._storedFunction=s=>D(s).a}}),function(s){s[s.Cos=0]="Cos",s[s.Sin=1]="Sin",s[s.Abs=2]="Abs",s[s.Exp=3]="Exp",s[s.Exp2=4]="Exp2",s[s.Round=5]="Round",s[s.Floor=6]="Floor",s[s.Ceiling=7]="Ceiling",s[s.Sqrt=8]="Sqrt",s[s.Log=9]="Log",s[s.Tan=10]="Tan",s[s.ArcTan=11]="ArcTan",s[s.ArcCos=12]="ArcCos",s[s.ArcSin=13]="ArcSin",s[s.Sign=14]="Sign",s[s.Negate=15]="Negate",s[s.OneMinus=16]="OneMinus",s[s.Reciprocal=17]="Reciprocal",s[s.ToDegrees=18]="ToDegrees",s[s.ToRadians=19]="ToRadians",s[s.Fract=20]="Fract"}(xk||(xk={}));class ch extends Wk{constructor(s){super(s),this.operation=xk.Cos,this.registerInput("input",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tk.Float|Tk.Int|Tk.Vector2|Tk.Pk|Tk.jg)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){super._build(s);let k=null;switch(this.operation){case xk.Cos:k=s=>Math.cos(s);break;case xk.Sin:k=s=>Math.sin(s);break;case xk.Abs:k=s=>Math.abs(s);break;case xk.Exp:k=s=>Math.exp(s);break;case xk.Exp2:k=s=>Math.pow(2,s);break;case xk.Round:k=s=>Math.round(s);break;case xk.Floor:k=s=>Math.floor(s);break;case xk.Ceiling:k=s=>Math.ceil(s);break;case xk.Sqrt:k=s=>Math.sqrt(s);break;case xk.Log:k=s=>Math.log(s);break;case xk.Tan:k=s=>Math.tan(s);break;case xk.ArcTan:k=s=>Math.atan(s);break;case xk.ArcCos:k=s=>Math.acos(s);break;case xk.ArcSin:k=s=>Math.asin(s);break;case xk.Sign:k=s=>Math.sign(s);break;case xk.Negate:k=s=>-s;break;case xk.OneMinus:k=s=>1-s;break;case xk.Reciprocal:k=s=>1/s;break;case xk.ToRadians:k=s=>s*Math.PI/180;break;case xk.ToDegrees:k=s=>180*s/Math.PI;break;case xk.Fract:k=s=>s>=0?s-Math.floor(s):s-Math.ceil(s)}if(!k)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Tk.Int:case Tk.Float:this.output._storedFunction=s=>{const h=this.input.getConnectedValue(s);return k(h)};break;case Tk.Vector2:this.output._storedFunction=s=>{const h=this.input.getConnectedValue(s);return new A.Vector2(k(h.x),k(h.y))};break;case Tk.Pk:this.output._storedFunction=s=>{const h=this.input.getConnectedValue(s);return new A.Pk(k(h.x),k(h.y),k(h.z))};break;case Tk.jg:this.output._storedFunction=s=>{const h=this.input.getConnectedValue(s);return new i.jg(k(h.r),k(h.g),k(h.b),k(h.a))}}return this}serialize(){const s=super.serialize();return s.operation=this.operation,s}_deserialize(s){super._deserialize(s),this.operation=s.operation}}(0,z.e)([Jk("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:xk.Cos},{label:"Sin",value:xk.Sin},{label:"Abs",value:xk.Abs},{label:"Exp",value:xk.Exp},{label:"Exp2",value:xk.Exp2},{label:"Round",value:xk.Round},{label:"Floor",value:xk.Floor},{label:"Ceiling",value:xk.Ceiling},{label:"Sqrt",value:xk.Sqrt},{label:"Log",value:xk.Log},{label:"Tan",value:xk.Tan},{label:"ArcTan",value:xk.ArcTan},{label:"ArcCos",value:xk.ArcCos},{label:"ArcSin",value:xk.ArcSin},{label:"Sign",value:xk.Sign},{label:"Negate",value:xk.Negate},{label:"OneMinus",value:xk.OneMinus},{label:"Reciprocal",value:xk.Reciprocal},{label:"ToDegrees",value:xk.ToDegrees},{label:"ToRadians",value:xk.ToRadians},{label:"Fract",value:xk.Fract}]})],ch.prototype,"operation",void 0),(0,K.f)("BABYLON.ParticleTrigonometryBlock",ch);var Sh,ah=h(13990);class rh extends Wk{constructor(s){super(s),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Tk.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Tk.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tk.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tk.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tk.System),this._inputs[0].excludedConnectionPointTypes.push(Tk.Particle),this._inputs[0].excludedConnectionPointTypes.push(Tk.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const k=s=>{const k=this.input.getConnectedValue(s);if(this.log.length>=this.stackSize)return k;if(null===k||void 0===k)return this.log.push(["null",""]),k;switch(this.input.type){case Tk.Vector2:this.log.push([(0,ah.f)(k,4),k.toString()]);break;case Tk.Pk:this.log.push([(0,ah.i)(k,4),k.toString()]);break;case Tk.jg:this.log.push([`{R: ${k.r.toFixed(4)} G: ${k.g.toFixed(4)} B: ${k.b.toFixed(4)} A: ${k.a.toFixed(4)}}`,k.toString()]);break;default:this.log.push([k.toString(),k.toString()])}return k};this.output.isConnected?this.output._storedFunction=k:this.output._storedValue=k(s)}serialize(){const s=super.serialize();return s.stackSize=this.stackSize,s}_deserialize(s){super._deserialize(s),this.stackSize=s.stackSize}}(0,z.e)([Jk("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],rh.prototype,"stackSize",void 0),(0,K.f)("BABYLON.ParticleDebugBlock",rh);(0,K.f)("BABYLON.ParticleElbowBlock",class extends Wk{constructor(s){super(s),this.registerInput("input",Tk.AutoDetect),this.registerOutput("output",Tk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(s){super._build(s);const k=this._outputs[0],h=this._inputs[0];k._storedFunction=s=>h.getConnectedValue(s)}});(0,K.f)("BABYLON.ParticleTeleportInBlock",class extends Wk{get endpoints(){return this._endpoints}constructor(s){super(s),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Tk.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(s){if(this.getClassName()===s)return!0;for(const k of this.endpoints)if(k.isAnAncestorOfType(s))return!0;return!1}isAnAncestorOf(s){for(const k of this.endpoints){if(k===s)return!0;if(k.isAnAncestorOf(s))return!0}return!1}attachToEndpoint(s){s.detach(),this._endpoints.push(s),s._entryPoint=this,s._outputs[0]._typeConnectionSource=this._inputs[0],s._tempEntryPointUniqueId=null,s.name="> "+this.name}detachFromEndpoint(s){const k=this._endpoints.indexOf(s);-1!==k&&(this._endpoints.splice(k,1),s._outputs[0]._typeConnectionSource=null,s._entryPoint=null)}_build(){for(const s of this._endpoints)s.output._storedFunction=s=>this.input.getConnectedValue(s)}});(0,K.f)("BABYLON.ParticleTeleportOutBlock",class extends Wk{constructor(s){super(s),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Tk.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(s){this.entryPoint&&this.entryPoint.build(s)}clone(){const s=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(s),s}serialize(){var s;const k=super.serialize();return k.entryPoint=(null===(s=this.entryPoint)||void 0===s?void 0:s.uniqueId)??"",k}_deserialize(s){super._deserialize(s),this._tempEntryPointUniqueId=s.entryPoint}}),function(s){s[s.Equal=0]="Equal",s[s.NotEqual=1]="NotEqual",s[s.LessThan=2]="LessThan",s[s.GreaterThan=3]="GreaterThan",s[s.LessOrEqual=4]="LessOrEqual",s[s.GreaterOrEqual=5]="GreaterOrEqual",s[s.Xor=6]="Xor",s[s.Or=7]="Or",s[s.And=8]="And"}(Sh||(Sh={}));class dh extends Wk{constructor(s){super(s),this.test=Sh.Equal,this.epsilon=0,this.registerInput("left",Tk.Float),this.registerInput("right",Tk.Float,!0,0),this.registerInput("ifTrue",Tk.AutoDetect,!0,1),this.registerInput("ifFalse",Tk.AutoDetect,!0,0),this.registerOutput("output",Tk.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Tk.Float,this._inputs[0].acceptedConnectionPointTypes.push(Tk.Int),this._inputs[1].acceptedConnectionPointTypes.push(Tk.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const s=s=>{const k=this.left.getConnectedValue(s),h=this.right.getConnectedValue(s);let A=!1;switch(this.test){case Sh.Equal:A=(0,O.WithinEpsilon)(k,h,this.epsilon);break;case Sh.NotEqual:A=!(0,O.WithinEpsilon)(k,h,this.epsilon);break;case Sh.LessThan:A=k<h+this.epsilon;break;case Sh.GreaterThan:A=k>h-this.epsilon;break;case Sh.LessOrEqual:A=k<=h+this.epsilon;break;case Sh.GreaterOrEqual:A=k>=h-this.epsilon;break;case Sh.Xor:A=!!k&&!h||!k&&!!h;break;case Sh.Or:A=!!k||!!h;break;case Sh.And:A=!!k&&!!h}return A};this.output._storedFunction=k=>s(k)?this.ifTrue.getConnectedValue(k):this.ifFalse.getConnectedValue(k)}serialize(){const s=super.serialize();return s.test=this.test,s.epsilon=this.epsilon,s}_deserialize(s){super._deserialize(s),this.test=s.test,void 0!==s.epsilon&&(this.epsilon=s.epsilon)}}(0,z.e)([Jk("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Sh.Equal},{label:"NotEqual",value:Sh.NotEqual},{label:"LessThan",value:Sh.LessThan},{label:"GreaterThan",value:Sh.GreaterThan},{label:"LessOrEqual",value:Sh.LessOrEqual},{label:"GreaterOrEqual",value:Sh.GreaterOrEqual},{label:"Xor",value:Sh.Xor},{label:"Or",value:Sh.Or},{label:"And",value:Sh.And}]})],dh.prototype,"test",void 0),(0,z.e)([Jk("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dh.prototype,"epsilon",void 0),(0,K.f)("BABYLON.ParticleConditionBlock",dh);class Eh extends Wk{constructor(s){super(s),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Tk.Particle),this.registerInput("condition",Tk.Float,!0,0),this.registerInput("system",Tk.System),this.registerOutput("output",Tk.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(s){this._triggerCount=0;const k=this.input.getConnectedValue(s),h={process:h=>{if(s.particleContext=h,s.systemContext=k,0!==this.condition.getConnectedValue(s)&&(0===this.limit||this._triggerCount<this.limit)){const A=(new Date).getTime();if(this._previousOne&&A-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=A;const g=this.system.getConnectedValue(s);if(g){const A=ok(g,s.Dk,h.position);A.Dh.addOnce((()=>{this._triggerCount--})),k.Dh.addOnce((()=>{A.dispose()}))}}},previousItem:null,nextItem:null};k._updateQueueStart?Xs(h,k._updateQueueStart):k._updateQueueStart=h,this.output._storedValue=k}serialize(){const s=super.serialize();return s.limit=this.limit,s.delay=this.delay,s}_deserialize(s){super._deserialize(s),void 0!==s.limit&&(this.limit=s.limit),void 0!==s.delay&&(this.delay=s.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,z.e)([Jk("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Eh.prototype,"limit",void 0),(0,z.e)([Jk("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Eh.prototype,"delay",void 0),(0,K.f)("BABYLON.ParticleTriggerBlock",Eh);h(13993),h(14006),h(14021),h(14080)},14061:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneFragment",ms="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14024:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneFragmentDeclaration",ms="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14096:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneVertex",ms="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14086:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneVertexDeclaration",ms="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14073:(s,k,h)=>{"use strict";var A=h(12493);const g="fogFragment",ms="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14058:(s,k,h)=>{"use strict";var A=h(12493);const g="fogFragmentDeclaration",ms="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14101:(s,k,h)=>{"use strict";var A=h(12493);const g="fogVertex",ms="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14093:(s,k,h)=>{"use strict";var A=h(12493);const g="fogVertexDeclaration",ms="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14046:(s,k,h)=>{"use strict";var A=h(12493);const g="helperFunctions",ms="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14032:(s,k,h)=>{"use strict";var A=h(12493);const g="imageProcessingDeclaration",ms="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14053:(s,k,h)=>{"use strict";var A=h(12493);const g="imageProcessingFunctions",ms="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14038:(s,k,h)=>{"use strict";var A=h(12493);const g="logDepthDeclaration",ms="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14067:(s,k,h)=>{"use strict";var A=h(12493);const g="logDepthFragment",ms="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14106:(s,k,h)=>{"use strict";var A=h(12493);const g="logDepthVertex",ms="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";A.e.IncludesShadersStoreWGSL[g]||(A.e.IncludesShadersStoreWGSL[g]=ms)},14021:(s,k,h)=>{"use strict";h.r(k),h.d(k,{particlesPixelShaderWGSL:()=>i});var A=h(12493);h(14024),h(14032),h(14038),h(14046),h(14053),h(14058),h(14061),h(14067),h(14073);const g="particlesPixelShader",ms="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.e.ShadersStoreWGSL[g]||(A.e.ShadersStoreWGSL[g]=ms);const i={name:g,shader:ms}},14080:(s,k,h)=>{"use strict";h.r(k),h.d(k,{particlesVertexShaderWGSL:()=>i});var A=h(12493);h(14086),h(14093),h(14038),h(14096),h(14101),h(14106);const g="particlesVertexShader",ms="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.e.ShadersStoreWGSL[g]||(A.e.ShadersStoreWGSL[g]=ms);const i={name:g,shader:ms}},13936:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneFragment",ms="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13999:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneFragmentDeclaration",ms="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13956:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneVertex",ms="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},14015:(s,k,h)=>{"use strict";var A=h(12493);const g="clipPlaneVertexDeclaration",ms="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13941:(s,k,h)=>{"use strict";var A=h(12493);const g="fogFragment",ms="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13934:(s,k,h)=>{"use strict";var A=h(12493);const g="fogFragmentDeclaration",ms="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13962:(s,k,h)=>{"use strict";var A=h(12493);const g="fogVertex",ms="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13950:(s,k,h)=>{"use strict";var A=h(12493);const g="fogVertexDeclaration",ms="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13918:(s,k,h)=>{"use strict";var A=h(12493);const g="helperFunctions",ms="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13906:(s,k,h)=>{"use strict";var A=h(12493);const g="imageProcessingDeclaration",ms="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13926:(s,k,h)=>{"use strict";var A=h(12493);const g="imageProcessingFunctions",ms="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13912:(s,k,h)=>{"use strict";var A=h(12493);const g="logDepthDeclaration",ms="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13938:(s,k,h)=>{"use strict";var A=h(12493);const g="logDepthFragment",ms="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13964:(s,k,h)=>{"use strict";var A=h(12493);const g="logDepthVertex",ms="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";A.e.IncludesShadersStore[g]||(A.e.IncludesShadersStore[g]=ms)},13993:(s,k,h)=>{"use strict";h.r(k),h.d(k,{particlesPixelShader:()=>i});var A=h(12493);h(13999),h(13906),h(13912),h(13918),h(13926),h(13934),h(13936),h(13938),h(13941);const g="particlesPixelShader",ms="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.e.ShadersStore[g]||(A.e.ShadersStore[g]=ms);const i={name:g,shader:ms}},14006:(s,k,h)=>{"use strict";h.r(k),h.d(k,{particlesVertexShader:()=>i});var A=h(12493);h(14015),h(13950),h(13912),h(13956),h(13962),h(13964);const g="particlesVertexShader",ms="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.e.ShadersStore[g]||(A.e.ShadersStore[g]=ms);const i={name:g,shader:ms}},14357:(s,k,h)=>{"use strict";h.r(k),h.d(k,{FlowGraphGLTFDataProvider:()=>ms});var A=h(14325),g=h(14315);class ms extends A.e{constructor(s){var k,h;super();const A=s.glTF,ms=(null===(k=A.animations)||void 0===k?void 0:k.map((s=>s._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",g.c,ms);const i=(null===(h=A.nodes)||void 0===h?void 0:h.map((s=>s._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",g.c,i)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14244:(s,k,h)=>{"use strict";h.d(k,{b:()=>j,c:()=>d,d:()=>r,h:()=>E});var A=h(12590),g=h(13093),ms=h(12636),i=h(14253);const K=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class H{constructor(s,k){this._gltf=s,this._infoTree=k}convert(s){let k,h=this._gltf,A=this._infoTree;if(!s.startsWith("/"))throw new Error("Path must start with a /");const g=s.split("/");if(g.shift(),g[g.length-1].includes(".length")){const s=g[g.length-1].split(".");g.pop(),g.push(...s)}let ms=!1;for(const H of g){const g="length"===H;if(g&&!A.__array__)throw new Error(`Path ${s} is invalid`);if(A.__ignoreObjectTree__&&(ms=!0),A.__array__&&!g)A=A.__array__;else if(A=A[H],!A)throw new Error(`Path ${s} is invalid`);if(!ms)if(void 0===h){if(!K.find((k=>k.regex.test(s))))throw new Error(`Path ${s} is invalid`)}else if(!g){var i;h=null===(i=h)||void 0===i?void 0:i[H]}(A.__target__||g)&&(k=h)}return{object:k,info:A}}}function O(s,k,h,A){const g=c(s,k);return A?g[h][A]:g[h]}function c(s,k,h){var A,ms;return null===(A=s._data)||void 0===A||null===(ms=A[(null===h||void 0===h?void 0:h.fillMode)??g.b.MATERIAL_TriangleFillMode])||void 0===ms?void 0:ms.babylonMaterial}function S(s,k){return{offset:{componentsCount:2,type:"Vector2",get:(h,g,ms)=>{const i=O(h,ms,s,k);return new A.Vector2(null===i||void 0===i?void 0:i.uOffset,null===i||void 0===i?void 0:i.vOffset)},getTarget:c,set:(h,A,g,ms)=>{const i=O(A,ms,s,k);i.uOffset=h.x,i.vOffset=h.y},getPropertyName:[()=>`${s}${k?"."+k:""}.uOffset`,()=>`${s}${k?"."+k:""}.vOffset`]},rotation:{type:"number",get:(h,A,g)=>{var ms;return null===(ms=O(h,g,s,k))||void 0===ms?void 0:ms.wAng},getTarget:c,set:(h,A,g,ms)=>O(A,ms,s,k).wAng=h,getPropertyName:[()=>`${s}${k?"."+k:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(h,g,ms)=>{const i=O(h,ms,s,k);return new A.Vector2(null===i||void 0===i?void 0:i.uScale,null===i||void 0===i?void 0:i.vScale)},getTarget:c,set:(h,A,g,ms)=>{const i=O(A,ms,s,k);i.uScale=h.x,i.vScale=h.y},getPropertyName:[()=>`${s}${k?"."+k:""}.uScale`,()=>`${s}${k?"."+k:""}.vScale`]}}}const a={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:s=>{var k,h;return new A.Vector2((null===(k=s._babylonCamera)||void 0===k?void 0:k.orthoLeft)??0,(null===(h=s._babylonCamera)||void 0===h?void 0:h.orthoRight)??0)},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.orthoLeft=s.x,k._babylonCamera.orthoRight=s.y)},getTarget:s=>s,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:s=>{var k,h;return new A.Vector2((null===(k=s._babylonCamera)||void 0===k?void 0:k.orthoBottom)??0,(null===(h=s._babylonCamera)||void 0===h?void 0:h.orthoTop)??0)},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.orthoBottom=s.x,k._babylonCamera.orthoTop=s.y)},getTarget:s=>s,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:s=>{var k;return null===(k=s._babylonCamera)||void 0===k?void 0:k.maxZ},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.maxZ=s)},getTarget:s=>s,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:s=>{var k;return null===(k=s._babylonCamera)||void 0===k?void 0:k.Jh},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.Jh=s)},getTarget:s=>s,getPropertyName:[()=>"Jh"]}},perspective:{aspectRatio:{type:"number",get:s=>{var k;return null===(k=s._babylonCamera)||void 0===k?void 0:k.getEngine().getAspectRatio(s._babylonCamera)},getTarget:s=>s,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:s=>{var k;return null===(k=s._babylonCamera)||void 0===k?void 0:k.fov},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.fov=s)},getTarget:s=>s,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:s=>{var k;return null===(k=s._babylonCamera)||void 0===k?void 0:k.maxZ},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.maxZ=s)},getTarget:s=>s,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:s=>{var k;return null===(k=s._babylonCamera)||void 0===k?void 0:k.Jh},set:(s,k)=>{k._babylonCamera&&(k._babylonCamera.Jh=s)},getTarget:s=>s,getPropertyName:[()=>"Jh"]}}}},nodes:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Pk",get:s=>{var k;return null===(k=s._babylonTransformNode)||void 0===k?void 0:k.position},set:(s,k)=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.position.H(s)},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:s=>{var k;return null===(k=s._babylonTransformNode)||void 0===k?void 0:k.rotationQuaternion},set:(s,k)=>{var h,A;return null===(h=k._babylonTransformNode)||void 0===h||null===(A=h.rotationQuaternion)||void 0===A?void 0:A.H(s)},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Pk",get:s=>{var k;return null===(k=s._babylonTransformNode)||void 0===k?void 0:k.Sg},set:(s,k)=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.Sg.H(s)},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"Sg"]},weights:{length:{type:"number",get:s=>s._numMorphTargets,getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(s,k)=>{var h,A;return void 0!==k?null===(h=s._primitiveBabylonMeshes)||void 0===h||null===(A=h[0].morphTargetManager)||void 0===A?void 0:A.getTarget(k).influence:void 0},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(s,k)=>[0],getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:s=>{var k,h,g;return A.Matrix.Compose(null===(k=s._babylonTransformNode)||void 0===k?void 0:k.Sg,null===(h=s._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion,null===(g=s._babylonTransformNode)||void 0===g?void 0:g.position)},getTarget:s=>s._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:s=>{var k,h,g,ms;const i=A.Matrix.Identity();let K=s.parent;for(;K&&K.parent;)K=K.parent;const H=(null===(k=s._babylonTransformNode)||void 0===k?void 0:k.position._isDirty)||(null===(h=s._babylonTransformNode)||void 0===h||null===(g=h.rotationQuaternion)||void 0===g?void 0:g._isDirty)||(null===(ms=s._babylonTransformNode)||void 0===ms?void 0:ms.Sg._isDirty);if(K){var O;const k=null===(O=K._babylonTransformNode)||void 0===O?void 0:O.fh(!0).invert();var c,S;if(k)null===(c=s._babylonTransformNode)||void 0===c||null===(S=c.fh(H))||void 0===S||S.multiplyToRef(k,i)}else s._babylonTransformNode&&i.H(s._babylonTransformNode.fh(H));return i},getTarget:s=>s._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:s=>{var k,h;return null===(k=s._babylonTransformNode)||void 0===k||null===(h=k.getChildren((s=>s instanceof i.c),!0)[0])||void 0===h?void 0:h.Ng},getTarget:s=>{var k;return null===(k=s._babylonTransformNode)||void 0===k?void 0:k.getChildren((s=>s instanceof i.c),!0)[0]},set:(s,k)=>{if(k._babylonTransformNode){const h=k._babylonTransformNode.getChildren((s=>s instanceof i.c),!0)[0];h&&(h.Ng=s)}}},color:{type:"Bk",get:s=>{var k,h;return null===(k=s._babylonTransformNode)||void 0===k||null===(h=k.getChildren((s=>s instanceof i.c),!0)[0])||void 0===h?void 0:h.zg},getTarget:s=>{var k;return null===(k=s._babylonTransformNode)||void 0===k?void 0:k.getChildren((s=>s instanceof i.c),!0)[0]},set:(s,k)=>{if(k._babylonTransformNode){const h=k._babylonTransformNode.getChildren((s=>s instanceof i.c),!0)[0];h&&(h.zg=s)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Bk",get:(s,k,h)=>c(s,k,h).emissiveColor,set:(s,k,h,A)=>c(k,h,A).emissiveColor.H(s),getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:S("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(s,k,h)=>{var A;return null===(A=O(s,h,"bumpTexture"))||void 0===A?void 0:A.level},set:(s,k,h,A)=>{const g=O(k,A,"bumpTexture");g&&(g.level=s)},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:S("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(s,k,h)=>c(s,k,h).ambientTextureStrength,set:(s,k,h,A)=>{const g=c(k,h,A);g&&(g.ambientTextureStrength=s)},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:S("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"jg",get:(s,k,h)=>{const A=c(s,k,h);return ms.jg.FromColor3(A.albedoColor,A.alpha)},set:(s,k,h,A)=>{const g=c(k,h,A);g.albedoColor.set(s.r,s.g,s.b),g.alpha=s.a},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:S("albedoTexture")}},metallicFactor:{type:"number",get:(s,k,h)=>c(s,k,h).metallic,set:(s,k,h,A)=>{const g=c(k,h,A);g&&(g.metallic=s)},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(s,k,h)=>c(s,k,h).roughness,set:(s,k,h,A)=>{const g=c(k,h,A);g&&(g.roughness=s)},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:S("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(s,k,h)=>c(s,k,h).anisotropy.Ng,set:(s,k,h,A)=>{c(k,h,A).anisotropy.Ng=s},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(s,k,h)=>c(s,k,h).anisotropy.angle,set:(s,k,h,A)=>{c(k,h,A).anisotropy.angle=s},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:S("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(s,k,h)=>c(s,k,h).clearCoat.Ng,set:(s,k,h,A)=>{c(k,h,A).clearCoat.Ng=s},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(s,k,h)=>c(s,k,h).clearCoat.roughness,set:(s,k,h,A)=>{c(k,h,A).clearCoat.roughness=s},getTarget:(s,k,h)=>c(s,k,h),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:S("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(s,k,h)=>{var A;return null===(A=c(s,k,h).clearCoat.bumpTexture)||void 0===A?void 0:A.level},getTarget:c,set:(s,k,h,A)=>c(k,h,A).clearCoat.bumpTexture.level=s},extensions:{KHR_texture_transform:S("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:S("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(s,k,h)=>c(s,k,h).subSurface.dispersion,getTarget:c,set:(s,k,h,A)=>c(k,h,A).subSurface.dispersion=s}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(s,k,h)=>c(s,k,h).emissiveIntensity,getTarget:c,set:(s,k,h,A)=>c(k,h,A).emissiveIntensity=s}},KHR_materials_ior:{ior:{type:"number",get:(s,k,h)=>c(s,k,h).indexOfRefraction,getTarget:c,set:(s,k,h,A)=>c(k,h,A).indexOfRefraction=s}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(s,k,h)=>c(s,k,h).iridescence.Ng,getTarget:c,set:(s,k,h,A)=>c(k,h,A).iridescence.Ng=s},iridescenceIor:{type:"number",get:(s,k,h)=>c(s,k,h).iridescence.indexOfRefraction,getTarget:c,set:(s,k,h,A)=>c(k,h,A).iridescence.indexOfRefraction=s},iridescenceTexture:{extensions:{KHR_texture_transform:S("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(s,k,h)=>c(s,k,h).iridescence.maximumThickness,getTarget:c,set:(s,k,h,A)=>c(k,h,A).iridescence.maximumThickness=s},iridescenceThicknessMinimum:{type:"number",get:(s,k,h)=>c(s,k,h).iridescence.minimumThickness,getTarget:c,set:(s,k,h,A)=>c(k,h,A).iridescence.minimumThickness=s},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:S("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Bk",get:(s,k,h)=>c(s,k,h).sheen.color,getTarget:c,set:(s,k,h,A)=>c(k,h,A).sheen.color.H(s)},sheenColorTexture:{extensions:{KHR_texture_transform:S("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(s,k,h)=>c(s,k,h).sheen.Ng,getTarget:c,set:(s,k,h,A)=>c(k,h,A).sheen.Ng=s},sheenRoughnessTexture:{extensions:{KHR_texture_transform:S("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(s,k,h)=>c(s,k,h).metallicF0Factor,getTarget:c,set:(s,k,h,A)=>c(k,h,A).metallicF0Factor=s,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Bk",get:(s,k,h)=>c(s,k,h).metallicReflectanceColor,getTarget:c,set:(s,k,h,A)=>c(k,h,A).metallicReflectanceColor.H(s),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:S("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:S("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(s,k,h)=>c(s,k,h).subSurface.refractionIntensity,getTarget:c,set:(s,k,h,A)=>c(k,h,A).subSurface.refractionIntensity=s,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:S("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(s,k,h)=>c(s,k,h).subSurface.translucencyIntensity,getTarget:c,set:(s,k,h,A)=>c(k,h,A).subSurface.translucencyIntensity=s},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:S("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Bk",get:(s,k,h)=>c(s,k,h).subSurface.translucencyColor,getTarget:c,set:(s,k,h,A)=>{var g;return s&&(null===(g=c(k,h,A).subSurface.translucencyColor)||void 0===g?void 0:g.H(s))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:S("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Bk",get:(s,k,h)=>c(s,k,h).subSurface.tintColor,getTarget:c,set:(s,k,h,A)=>c(k,h,A).subSurface.tintColor.H(s)},attenuationDistance:{type:"number",get:(s,k,h)=>c(s,k,h).subSurface.tintColorAtDistance,getTarget:c,set:(s,k,h,A)=>c(k,h,A).subSurface.tintColorAtDistance=s},thicknessFactor:{type:"number",get:(s,k,h)=>c(s,k,h).subSurface.maximumThickness,getTarget:c,set:(s,k,h,A)=>c(k,h,A).subSurface.maximumThickness=s},thicknessTexture:{extensions:{KHR_texture_transform:S("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonLight)),getPropertyName:[s=>"length"]},__array__:{__target__:!0,color:{type:"Bk",get:s=>{var k;return null===(k=s._babylonLight)||void 0===k?void 0:k.zg},set:(s,k)=>{var h;return null===(h=k._babylonLight)||void 0===h?void 0:h.zg.H(s)},getTarget:s=>s._babylonLight,getPropertyName:[s=>"diffuse"]},Ng:{type:"number",get:s=>{var k;return null===(k=s._babylonLight)||void 0===k?void 0:k.Ng},set:(s,k)=>k._babylonLight?k._babylonLight.Ng=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"intensity"]},range:{type:"number",get:s=>{var k;return null===(k=s._babylonLight)||void 0===k?void 0:k.range},set:(s,k)=>k._babylonLight?k._babylonLight.range=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"range"]},spot:{innerConeAngle:{type:"number",get:s=>{var k;return null===(k=s._babylonLight)||void 0===k?void 0:k.innerAngle},set:(s,k)=>k._babylonLight?k._babylonLight.innerAngle=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"innerConeAngle"]},outerConeAngle:{type:"number",get:s=>{var k;return null===(k=s._babylonLight)||void 0===k?void 0:k.angle},set:(s,k)=>k._babylonLight?k._babylonLight.angle=s:void 0,getTarget:s=>s._babylonLight,getPropertyName:[s=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonLight)),getPropertyName:[s=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonTexture)),getPropertyName:[s=>"length"]},__array__:{__target__:!0,Ng:{type:"number",get:s=>{var k;return null===(k=s._babylonTexture)||void 0===k?void 0:k.level},set:(s,k)=>{k._babylonTexture&&(k._babylonTexture.level=s)},getTarget:s=>s._babylonTexture},rotation:{type:"Quaternion",get:s=>{var k;return s._babylonTexture&&A.Quaternion.FromRotationMatrix(null===(k=s._babylonTexture)||void 0===k?void 0:k.getReflectionTextureMatrix())},set:(s,k)=>{var h;k._babylonTexture&&(null!==(h=k._babylonTexture.Is())&&void 0!==h&&h.useRightHandedSystem||(s=A.Quaternion.Inverse(s)),A.Matrix.FromQuaternionToRef(s,k._babylonTexture.getReflectionTextureMatrix()))},getTarget:s=>s._babylonTexture}}}}},animations:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>s._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:s=>s.length,getTarget:s=>s.map((s=>{var k;return null===(k=s.primitives[0]._instanceData)||void 0===k?void 0:k.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function r(s){return new H(s,a)}function d(s){const k=s.split("/").map((s=>s.replace(/{}/g,"__array__")));let h=a;for(const A of k)A&&(h=h[A]);if(h&&h.type&&h.get)return h}function E(s,k){const h=s.split("/").map((s=>s.replace(/{}/g,"__array__")));let A=a;for(const g of h)g&&(A=A[g]);A&&A.type&&A.get&&(A.interpolation=k)}function j(s,k){const h=s.split("/").map((s=>s.replace(/{}/g,"__array__")));let A=a;for(const g of h)if(g){if(!A[g]){if("?"===g){A.__ignoreObjectTree__=!0;continue}A[g]={},"__array__"===g&&(A[g].__target__=!0)}A=A[g]}Object.assign(A,k)}},14257:(s,k,h)=>{"use strict";h.r(k),h.d(k,{AnimationPropertyInfo:()=>O,TransformNodeAnimationPropertyInfo:()=>c,WeightAnimationPropertyInfo:()=>S,getQuaternion:()=>K,getVector3:()=>i,getWeights:()=>H});var A=h(13128),g=h(12590),ms=h(14244);function i(s,k,h,A){return g.Pk.uk(k,h).scaleInPlace(A)}function K(s,k,h,A){return g.Quaternion.uk(k,h).scaleInPlace(A)}function H(s,k,h,A){const g=new Array(s._numMorphTargets);for(let ms=0;ms<g.length;ms++)g[ms]=k[h++]*A;return g}class O{constructor(s,k,h,A){this.type=s,this.name=k,this.getValue=h,this.getStride=A}_buildAnimation(s,k,h){const g=new A.c(s,this.name,k,this.type);return g.setKeys(h),g}}class c extends O{buildAnimations(s,k,h,A){const g=[];return g.push({babylonAnimatable:s._babylonTransformNode,babylonAnimation:this._buildAnimation(k,h,A)}),g}}class S extends O{buildAnimations(s,k,h,g){const ms=[];if(s._numMorphTargets)for(let i=0;i<s._numMorphTargets;i++){const K=new A.c(`${k}_${i}`,this.name,h,this.type);if(K.setKeys(g.map((s=>({frame:s.frame,inTangent:s.inTangent?s.inTangent[i]:void 0,value:s.value[i],outTangent:s.outTangent?s.outTangent[i]:void 0,interpolation:s.interpolation})))),s._primitiveBabylonMeshes)for(const k of s._primitiveBabylonMeshes)if(k.morphTargetManager){const s=k.morphTargetManager.getTarget(i),h=K.clone();s.animations.push(h),ms.push({babylonAnimatable:s,babylonAnimation:h})}}return ms}}(0,ms.h)("/nodes/{}/translation",[new c(A.c.ANIMATIONTYPE_VECTOR3,"position",i,(()=>3))]),(0,ms.h)("/nodes/{}/rotation",[new c(A.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",K,(()=>4))]),(0,ms.h)("/nodes/{}/scale",[new c(A.c.ANIMATIONTYPE_VECTOR3,"Sg",i,(()=>3))]),(0,ms.h)("/nodes/{}/weights",[new S(A.c.ANIMATIONTYPE_FLOAT,"influence",H,(s=>s._numMorphTargets))])},14214:(s,k,h)=>{"use strict";class A{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((s,k)=>{this._resolve=s,this._reject=k}))}}var g=h(12590),ms=h(12636),i=h(12402),K=h(13067),H=h(14223),O=h(14228),c=h(12408),S=h(13084),a=h(13128),r=h(13134),d=h(12445),E=h(12422),j=h(12429);class P{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(s){this._useTextureToStoreBoneMatrices=s,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(s){this._animationPropertiesOverride=s}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(s,k,h){this.name=s,this.id=k,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=g.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new c.c,this.bones=[],this._scene=h||d.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const A=this._scene.getEngine().getCaps();this._canUseTextureForBones=A.textureFloat&&A.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((s=>!s.getParent()))}getTransformMatrices(s){if(this.needInitialSkinMatrix){if(!s)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return s._bonesTransformMatrices||this.prepare(!0),s._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(s){return this.needInitialSkinMatrix&&s._transformMatrixTexture?s._transformMatrixTexture:this._transformMatrixTexture}Is(){return this._scene}toString(s){let k=`Name: ${this.name}, nBones: ${this.bones.length}`;if(k+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,s){k+=", Ranges: {";let s=!0;for(const h in this._ranges)s&&(k+=", ",s=!1),k+=h;k+="}"}return k}getBoneIndexByName(s){for(let k=0,h=this.bones.length;k<h;k++)if(this.bones[k].name===s)return k;return-1}createAnimationRange(s,k,h){if(!this._ranges[s]){this._ranges[s]=new r.d(s,k,h);for(let A=0,g=this.bones.length;A<g;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].createRange(s,k,h)}}deleteAnimationRange(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let h=0,A=this.bones.length;h<A;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].deleteRange(s,k);this._ranges[s]=null}getAnimationRange(s){return this._ranges[s]||null}getAnimationRanges(){const s=[];let k;for(k in this._ranges)s.push(this._ranges[k]);return s}copyAnimationRange(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[k]||!s.getAnimationRange(k))return!1;let A=!0;const g=this._getHighestAnimationFrame()+1,ms={},i=s.bones;let K,H;for(H=0,K=i.length;H<K;H++)ms[i[H].name]=i[H];this.bones.length!==i.length&&(E.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${i.length}`),A=!1);const O=h&&this.dimensionsAtRest&&s.dimensionsAtRest?this.dimensionsAtRest.divide(s.dimensionsAtRest):null;for(H=0,K=this.bones.length;H<K;H++){const s=this.bones[H].name,i=ms[s];i?A=A&&this.bones[H].copyAnimationRange(i,k,g,h,O):(E.c.Warn("copyAnimationRange: not same rig, missing source bone "+s),A=!1)}const c=s.getAnimationRange(k);return c&&(this._ranges[k]=new r.d(k,c.from+g,c.to+g)),A}returnToRest(){for(const s of this.bones)-1!==s._index&&s.returnToRest()}_getHighestAnimationFrame(){let s=0;for(let k=0,h=this.bones.length;k<h;k++)if(this.bones[k].animations[0]){const h=this.bones[k].animations[0].getHighestFrame();s<h&&(s=h)}return s}beginAnimation(s,k,h,A){const g=this.getAnimationRange(s);return g?this._scene.beginAnimation(this,g.from,g.to,k,h,A):null}static MakeAnimationAdditive(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const A=s.getAnimationRange(h);if(!A)return null;const g=s._scene.getAllAnimatablesByTarget(s);let ms=null;for(let K=0;K<g.length;K++){const s=g[K];if(s.fromFrame===(null===A||void 0===A?void 0:A.from)&&s.toFrame===(null===A||void 0===A?void 0:A.to)){ms=s;break}}const i=s.getAnimatables();for(let K=0;K<i.length;K++){const s=i[K].animations;if(s)for(let A=0;A<s.length;A++)a.c.MakeAnimationAdditive(s[A],k,h)}return ms&&(ms.isAdditive=!0),s}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(s){this._meshesWithPoseMatrix.push(s)}_unregisterMeshWithPoseMatrix(s){const k=this._meshesWithPoseMatrix.indexOf(s);k>-1&&this._meshesWithPoseMatrix.splice(k,1)}_computeTransformMatrices(s,k){this.onBeforeComputeObservable.notifyObservers(this);for(let h=0;h<this.bones.length;h++){const A=this.bones[h];A._childUpdateId++;const g=A.getParent();if(g?A.getLocalMatrix().multiplyToRef(g.getFinalMatrix(),A.getFinalMatrix()):k?A.getLocalMatrix().multiplyToRef(k,A.getFinalMatrix()):A.getFinalMatrix().H(A.getLocalMatrix()),-1!==A._index){const k=null===A._index?h:A._index;A.getAbsoluteInverseBindMatrix().multiplyToArray(A.getFinalMatrix(),s,16*k)}}this._identity.copyToArray(s,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const s=this.Is().getRenderId();if(this._currentRenderId===s)return;this._currentRenderId=s}if(this._numBonesWithLinkedTransformNode>0)for(const s of this.bones)if(s._linkedTransformNode){const k=s._linkedTransformNode;s.position=k.position,k.rotationQuaternion?s.rotationQuaternion=k.rotationQuaternion:s.rotation=k.rotation,s.Sg=k.Sg}if(this.needInitialSkinMatrix)for(const s of this._meshesWithPoseMatrix){const k=s.getPoseMatrix();let h=this._isDirty;if(s._bonesTransformMatrices&&s._bonesTransformMatrices.length===16*(this.bones.length+1)||(s._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),h=!0),h){if(this._synchronizedWithMesh!==s){this._synchronizedWithMesh=s;for(const s of this.bones)if(!s.getParent()){s.getBindMatrix().multiplyToRef(k,g.TmpVectors.Matrix[1]),s._updateAbsoluteBindMatrices(g.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const k=4*(this.bones.length+1);s._transformMatrixTexture&&s._transformMatrixTexture.getSize().width===k||(s._transformMatrixTexture&&s._transformMatrixTexture.dispose(),s._transformMatrixTexture=S.e.CreateRGBATexture(s._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(s._bonesTransformMatrices,k),this.isUsingTextureForMatrices&&s._transformMatrixTexture&&s._transformMatrixTexture.update(s._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=S.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let s=0;s<this.bones.length;s++)this._animatables.push(this.bones[s])}return this._animatables}clone(s,k){const h=new P(s,k||s,this._scene);h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){const s=this.bones[A];let k=null;const g=s.getParent();if(g){const s=this.bones.indexOf(g);k=h.bones[s]}const ms=new O.e(s.name,h,k,s.getBindMatrix().clone(),s.getRestMatrix().clone());ms._index=s._index,s._linkedTransformNode&&ms.linkTransformNode(s._linkedTransformNode),j.e.DeepCopy(s.animations,ms.animations)}if(this._ranges){h._ranges={};for(const s in this._ranges){const k=this._ranges[s];k&&(h._ranges[s]=k.clone())}}return this._isDirty=!0,h.prepare(!0),h}enableBlending(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const k of this.bones)for(const h of k.animations)h.enableBlending=!0,h.blendingSpeed=s}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Is().stopAnimation(this),this.Is().removeSkeleton(this),this._parentContainer){const s=this._parentContainer.skeletons.indexOf(this);s>-1&&this._parentContainer.skeletons.splice(s,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const s={};s.name=this.name,s.id=this.id,this.dimensionsAtRest&&(s.dimensionsAtRest=this.dimensionsAtRest.yh()),s.bones=[],s.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let h=0;h<this.bones.length;h++){var k;const A=this.bones[h],g=A.getParent(),ms={parentBoneIndex:g?this.bones.indexOf(g):-1,index:A.getIndex(),name:A.name,id:A.id,matrix:A.getBindMatrix().yh(),rest:A.getRestMatrix().yh(),linkedTransformNodeId:null===(k=A.getTransformNode())||void 0===k?void 0:k.id};s.bones.push(ms),A.length&&(ms.length=A.length),A.metadata&&(ms.metadata=A.metadata),A.animations&&A.animations.length>0&&(ms.animation=A.animations[0].serialize()),s.ranges=[];for(const k in this._ranges){const h=this._ranges[k];if(!h)continue;const A={};A.name=k,A.from=h.from,A.to=h.to,s.ranges.push(A)}}return s}static Parse(s,k){const h=new P(s.name,s.id,k);let A;for(s.dimensionsAtRest&&(h.dimensionsAtRest=g.Pk.uk(s.dimensionsAtRest)),h.needInitialSkinMatrix=s.needInitialSkinMatrix,A=0;A<s.bones.length;A++){const k=s.bones[A],ms=s.bones[A].index;let i=null;k.parentBoneIndex>-1&&(i=h.bones[k.parentBoneIndex]);const K=k.rest?g.Matrix.uk(k.rest):null,H=new O.e(k.name,h,i,g.Matrix.uk(k.matrix),K,null,ms);void 0!==k.id&&null!==k.id&&(H.id=k.id),k.length&&(H.length=k.length),k.metadata&&(H.metadata=k.metadata),k.animation&&H.animations.push(a.c.Parse(k.animation)),void 0!==k.linkedTransformNodeId&&null!==k.linkedTransformNodeId&&(h._hasWaitingData=!0,H._waitingTransformNodeId=k.linkedTransformNodeId)}if(s.ranges)for(A=0;A<s.ranges.length;A++){const k=s.ranges[A];h.createAnimationRange(k.name,k.from,k.to)}return h}computeAbsoluteMatrices(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||s)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(s)}getPoseMatrix(){let s=null;return this._meshesWithPoseMatrix.length>0&&(s=this._meshesWithPoseMatrix[0].getPoseMatrix()),s}sortBones(){const s=[],k=new Array(this.bones.length);for(let h=0;h<this.bones.length;h++)this._sortBones(h,s,k);this.bones=s}_sortBones(s,k,h){if(h[s])return;h[s]=!0;const A=this.bones[s];if(!A)return;void 0===A._index&&(A._index=s);const g=A.getParent();g&&this._sortBones(this.bones.indexOf(g),k,h),k.push(A)}setCurrentPoseAsRest(){for(const s of this.bones)s.setCurrentPoseAsRest()}}var R=h(12916),D=h(13099),w=h(12567),B=h(13038),u=h(12664),G=h(13076),Q=h(13043),p=h(13061),I=h(13143),N=h(12688),b=h(14180);class t{set areUpdatesFrozen(s){s?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new N.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,s||(s=d.b.LastCreatedScene),this._scene=s,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const s=this._scene.getEngine().getCaps();this._canUseTextureForTargets=s.canUseGLVertexID&&s.textureFloat&&s.maxVertexTextureImageUnits>0&&s.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return t.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?t.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(s){this._numMaxInfluencers!==s&&(this._numMaxInfluencers=s,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(s){this._useTextureToStoreTargets!==s&&(this._useTextureToStoreTargets=s,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var s;return t.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(s=this._scene)&&void 0!==s&&s.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(s){return this._activeTargets.data[s]}getTarget(s){return this._targets[s]}getTargetByName(s){for(const k of this._targets)if(k.name===s)return k;return null}addTarget(s){this._targets.push(s),this._targetInfluenceChangedObservers.push(s.onInfluenceChanged.add((s=>{this.areUpdatesFrozen&&s&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(s)}))),this._targetDataLayoutChangedObservers.push(s._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(s){const k=this._targets.indexOf(s);k>=0&&(this._targets.splice(k,1),s.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(k,1)[0]),s._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(k,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(s)}_bind(s){s.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),s.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),s.setTexture("morphTargets",this._targetStoreTexture),s.setInt("morphTargetCount",this.numInfluencers)}clone(){const s=new t(this._scene);for(const k of this._targets)s.addTarget(k.clone());return s.enablePositionMorphing=this.enablePositionMorphing,s.enableNormalMorphing=this.enableNormalMorphing,s.enableTangentMorphing=this.enableTangentMorphing,s.enableUVMorphing=this.enableUVMorphing,s.enableUV2Morphing=this.enableUV2Morphing,s.enableColorMorphing=this.enableColorMorphing,s}serialize(){const s={};s.id=this.uniqueId,s.targets=[];for(const k of this._targets)s.targets.push(k.serialize());return s}_syncActiveTargets(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const k=!!this._targetStoreTexture,h=this.isUsingTextureForTargets;(this._mustSynchronize||k!==h)&&(this._mustSynchronize=!1,this.synchronize());let A=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let g=-1;for(const ms of this._targets)if(g++,0!==ms.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=t.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(ms),this._morphTargetTextureIndices[A]=g,this._tempInfluences[A++]=ms.influence}this._morphTargetTextureIndices.length!==A&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,A)),this._influences&&this._influences.length===A||(this._influences=new Float32Array(A));for(let ms=0;ms<A;ms++)this._influences[ms]=this._tempInfluences[ms];if(s&&this._scene)for(const ms of this._scene.meshes)ms.morphTargetManager===this&&(h?ms._markSubMeshesAsAttributesDirty():ms._syncGeometryWithMorphTargetManager())}synchronize(){var s;if(!this._scene||this.areUpdatesFrozen)return;const k=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(s=this._targetStoreTexture)||void 0===s||s.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>k.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const h of this._targets){this._supportsPositions=this._supportsPositions&&h.hasPositions,this._supportsNormals=this._supportsNormals&&h.hasNormals,this._supportsTangents=this._supportsTangents&&h.hasTangents,this._supportsUVs=this._supportsUVs&&h.hasUVs,this._supportsUV2s=this._supportsUV2s&&h.hasUV2s,this._supportsColors=this._supportsColors&&h.hasColors;const s=h.vertexCount;if(0===this._vertexCount)this._vertexCount=s;else if(this._vertexCount!==s)return void E.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${h.name}": ${s}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const s=k.getCaps().maxTextureSize;this._textureWidth>s&&(this._textureHeight=Math.ceil(this._textureWidth/s),this._textureWidth=s);const h=this._targets.length,A=new Float32Array(h*this._textureWidth*this._textureHeight*4);let g=0;for(let k=0;k<h;k++){const s=this._targets[k],h=s.getPositions(),ms=s.getNormals(),i=s.getUVs(),K=s.getTangents(),H=s.getUV2s(),O=s.getColors();g=k*this._textureWidth*this._textureHeight*4;for(let k=0;k<this._vertexCount;k++)this._supportsPositions&&h&&(A[g]=h[3*k],A[g+1]=h[3*k+1],A[g+2]=h[3*k+2],g+=4),this._supportsNormals&&ms&&(A[g]=ms[3*k],A[g+1]=ms[3*k+1],A[g+2]=ms[3*k+2],g+=4),this._supportsUVs&&i&&(A[g]=i[2*k],A[g+1]=i[2*k+1],g+=4),this._supportsTangents&&K&&(A[g]=K[3*k],A[g+1]=K[3*k+1],A[g+2]=K[3*k+2],g+=4),this._supportsUV2s&&H&&(A[g]=H[2*k],A[g+1]=H[2*k+1],g+=4),this._supportsColors&&O&&(A[g]=O[4*k],A[g+1]=O[4*k+1],A[g+2]=O[4*k+2],A[g+3]=O[4*k+3],g+=4)}this._targetStoreTexture=b.c.CreateRGBATexture(A,this._textureWidth,this._textureHeight,h,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const h of this._scene.meshes)h.morphTargetManager===this&&h._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const s=this._parentContainer.morphTargetManagers.indexOf(this);s>-1&&this._parentContainer.morphTargetManagers.splice(s,1),this._parentContainer=null}for(const s of this._targets)this._scene.stopAnimation(s)}}static Parse(s,k){const h=new t(k);for(const A of s.targets)h.addTarget(I.b.Parse(A,k));return h}}t.EnableTextureStorage=!0,t.MaxActiveMorphTargetsInVertexAttributeMode=8,t.ConstantTargetCountForTextureMode=0;var z=h(14234),C=h(12448),v=h(12937);const Y=new Map,n=Y;function T(s,k,h){U(s)&&E.c.Warn(`Extension with the name '${s}' already exists`),Y.set(s,{isGLTFExtension:k,factory:h})}function U(s){return Y.delete(s)}var q=h(14244),M=h(13197),V=h(12675);class X{static Get(s,k,h){if(!k||void 0==h||!k[h])throw new Error(`${s}: Failed to find index (${h})`);return k[h]}static TryGet(s,k){return s&&void 0!=k&&s[k]?s[k]:null}static Assign(s){if(s)for(let k=0;k<s.length;k++)s[k].index=k}}function L(s){if(s.min&&s.max){const k=s.min,h=s.max,A=g.TmpVectors.Pk[0].cg(k[0],k[1],k[2]),ms=g.TmpVectors.Pk[1].cg(h[0],h[1],h[2]);if(s.normalized&&5126!==s.componentType){let k=1;switch(s.componentType){case 5120:k=127;break;case 5121:k=255;break;case 5122:k=32767;break;case 5123:k=65535}const h=1/k;A.scaleInPlace(h),ms.scaleInPlace(h)}return new v.c(A,ms)}return null}class Z{static RegisterExtension(s,k){T(s,!1,k)}static UnregisterExtension(s){return U(s)}get th(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(s){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=s}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((s=>s.dispose&&s.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(s,k,h,A,g,ms){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=k,this._assetContainer=h,this._loadData(A);let ms=null;if(s){const k={};if(this._gltf.nodes)for(const s of this._gltf.nodes)s.name&&(k[s.name]=s.index);ms=(s instanceof Array?s:[s]).map((s=>{const h=k[s];if(void 0===h)throw new Error(`Failed to find node '${s}'`);return h}))}return await this._loadAsync(g,i,ms,(()=>({meshes:this._getMeshes(),la:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=s,this._loadData(k),await this._loadAsync(h,g,null,(()=>{}))}async _loadAsync(s,k,h,A){return await Promise.resolve().then((async()=>{this._rootUrl=s,this._uniqueRootUrl=!s.startsWith("file:")&&k?s:`${s}${Date.now()}/`,this._fileName=k,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const g=`${z.j[z.j.LOADING]} => ${z.j[z.j.READY]}`,ms=`${z.j[z.j.LOADING]} => ${z.j[z.j.COMPLETE]}`;this._parent._startPerformanceCounter(g),this._parent._startPerformanceCounter(ms),this._parent._setState(z.j.LOADING),this._extensionsOnLoading();const K=new Array;if(!this.parent.loadOnlyMaterials)if(h)K.push(this.loadSceneAsync("/nodes",{nodes:h,index:-1}));else if(void 0!=this._gltf.Dk||this._gltf.scenes&&this._gltf.scenes[0]){const s=X.Get("/scene",this._gltf.scenes,this._gltf.Dk||0);K.push(this.loadSceneAsync(`/scenes/${s.index}`,s))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let s=0;s<this._gltf.materials.length;++s){const k=this._gltf.materials[s],h="/materials/"+s,A=R.b.TriangleFillMode;K.push(this._loadMaterialAsync(h,k,null,A,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&K.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&K.push(this._compileShadowGeneratorsAsync());const H=Promise.all(K).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.hH(!0);for(const s of this._babylonScene.materials){const k=s;void 0!==k.maxSimultaneousLights&&(k.maxSimultaneousLights=Math.max(k.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(z.j.READY),this._skipStartAnimationStep||this._startAnimations(),A()}));return await H.then((s=>(this._parent._endPerformanceCounter(g),i.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(ms),this._parent._setState(z.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(s=>{this._parent.onErrorObservable.notifyObservers(s),this._parent.onErrorObservable.clear(),this.dispose()}))})),s)))})).catch((s=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(s),this._parent.onErrorObservable.clear(),this.dispose()),s}))}_loadData(s){if(this._gltf=s.json,this._setupData(),s.bin){const k=this._gltf.buffers;if(k&&k[0]&&!k[0].uri){const h=k[0];(h.byteLength<s.bin.byteLength-3||h.byteLength>s.bin.byteLength)&&E.c.Warn(`Binary buffer length (${h.byteLength}) from JSON does not match chunk length (${s.bin.byteLength})`),this._bin=s.bin}else E.c.Warn("Unexpected BIN chunk")}}_setupData(){if(X.Assign(this._gltf.accessors),X.Assign(this._gltf.animations),X.Assign(this._gltf.buffers),X.Assign(this._gltf.bufferViews),X.Assign(this._gltf.cameras),X.Assign(this._gltf.images),X.Assign(this._gltf.materials),X.Assign(this._gltf.meshes),X.Assign(this._gltf.nodes),X.Assign(this._gltf.samplers),X.Assign(this._gltf.scenes),X.Assign(this._gltf.skins),X.Assign(this._gltf.textures),this._gltf.nodes){const s={};for(const h of this._gltf.nodes)if(h.children)for(const k of h.children)s[k]=h.index;const k=this._createRootNode();for(const h of this._gltf.nodes){const A=s[h.index];h.parent=void 0===A?k:this._gltf.nodes[A]}}}async _loadExtensionsAsync(){const s=[];if(n.forEach(((k,h)=>{var A;!1===(null===(A=this.parent.extensionOptions[h])||void 0===A?void 0:A.enabled)?k.isGLTFExtension&&this.isExtensionUsed(h)&&E.c.Warn(`Extension ${h} is used but has been explicitly disabled.`):k.isGLTFExtension&&!this.isExtensionUsed(h)||s.push((async()=>{const s=await k.factory(this);return s.name!==h&&E.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${s.name} !== ${h}`),this._parent.onExtensionLoadedObservable.notifyObservers(s),s})())})),this._extensions.push(...await Promise.all(s)),this._extensions.sort(((s,k)=>(s.order||Number.MAX_VALUE)-(k.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const h of this._gltf.extensionsRequired){if(!this._extensions.some((s=>s.name===h&&s.enabled))){var k;if(!1===(null===(k=this.parent.extensionOptions[h])||void 0===k?void 0:k.enabled))throw new Error(`Required extension ${h} is disabled`);throw new Error(`Required extension ${h} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new p.e("__root__",this._babylonScene);this._rootBabylonMesh=s,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.hH(!1);const k={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case z.h.AUTO:this._babylonScene.useRightHandedSystem||(k.rotation=[0,1,0,0],k.scale=[1,1,-1],Z._LoadTransform(k,this._rootBabylonMesh));break;case z.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(s),k}loadSceneAsync(s,k){const h=this._extensionsLoadSceneAsync(s,k);if(h)return h;const A=new Array;if(this.logOpen(`${s} ${k.name||""}`),k.nodes)for(const g of k.nodes){const k=X.Get(`${s}/nodes/${g}`,this._gltf.nodes,g);A.push(this.loadNodeAsync(`/nodes/${k.index}`,k,(s=>{s.parent=this._rootBabylonMesh})))}for(const g of this._postSceneLoadActions)g();return A.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(A).then((()=>{}))}_forEachPrimitive(s,k){if(s._primitiveBabylonMeshes)for(const h of s._primitiveBabylonMeshes)k(h)}_getGeometries(){const s=[],k=this._gltf.nodes;if(k)for(const h of k)this._forEachPrimitive(h,(k=>{const h=k.mg;h&&-1===s.indexOf(h)&&s.push(h)}));return s}_getMeshes(){const s=[];this._rootBabylonMesh instanceof Q.e&&s.push(this._rootBabylonMesh);const k=this._gltf.nodes;if(k)for(const h of k)this._forEachPrimitive(h,(k=>{s.push(k)}));return s}_getTransformNodes(){const s=[],k=this._gltf.nodes;if(k)for(const h of k)h._babylonTransformNode&&"og"===h._babylonTransformNode.getClassName()&&s.push(h._babylonTransformNode),h._babylonTransformNodeForSkin&&s.push(h._babylonTransformNodeForSkin);return s}_getSkeletons(){const s=[],k=this._gltf.skins;if(k)for(const h of k)h._data&&s.push(h._data.babylonSkeleton);return s}_getAnimationGroups(){const s=[],k=this._gltf.animations;if(k)for(const h of k)h._babylonAnimationGroup&&s.push(h._babylonAnimationGroup);return s}_startAnimations(){switch(this._parent.animationStartMode){case z.e.NONE:break;case z.e.FIRST:{const s=this._getAnimationGroups();0!==s.length&&s[0].start(!0);break}case z.e.ALL:{const s=this._getAnimationGroups();for(const k of s)k.start(!0);break}default:return void E.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadNodeAsync(s,k,h);if(A)return A;if(k._babylonTransformNode)throw new Error(`${s}: Invalid recursive node hierarchy`);const g=new Array;this.logOpen(`${s} ${k.name||""}`);const ms=A=>{if(Z.AddPointerMetadata(A,s),Z._LoadTransform(k,A),void 0!=k.camera){const h=X.Get(`${s}/camera`,this._gltf.cameras,k.camera);g.push(this.loadCameraAsync(`/cameras/${h.index}`,h,(s=>{s.parent=A,this._babylonScene.useRightHandedSystem||(A.Sg.x=-1)})))}if(k.children)for(const h of k.children){const k=X.Get(`${s}/children/${h}`,this._gltf.nodes,h);g.push(this.loadNodeAsync(`/nodes/${k.index}`,k,(s=>{s.parent=A})))}h(A)},i=void 0!=k.mesh,K=this._parent.loadSkins&&void 0!=k.skin;if(!i||K){const s=k.name||`node${k.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new B.b(s,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==k.mesh?k._babylonTransformNode=h:k._babylonTransformNodeForSkin=h,ms(h)}if(i)if(K){const h=X.Get(`${s}/mesh`,this._gltf.meshes,k.mesh);g.push(this._loadMeshAsync(`/meshes/${h.index}`,k,h,(h=>{const A=k._babylonTransformNodeForSkin;h.metadata=(0,M.c)(A.metadata,h.metadata||{});const ms=X.Get(`${s}/skin`,this._gltf.skins,k.skin);g.push(this._loadSkinAsync(`/skins/${ms.index}`,k,ms,(s=>{this._forEachPrimitive(k,(k=>{k.skeleton=s})),this._postSceneLoadActions.push((()=>{if(void 0!=ms.skeleton){const s=X.Get(`/skins/${ms.index}/skeleton`,this._gltf.nodes,ms.skeleton).parent;k.index===s.index?h.parent=A.parent:h.parent=s._babylonTransformNode}else h.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:A,skinnedNode:h})}))})))})))}else{const h=X.Get(`${s}/mesh`,this._gltf.meshes,k.mesh);g.push(this._loadMeshAsync(`/meshes/${h.index}`,k,h,ms))}return this.logClose(),Promise.all(g).then((()=>(this._forEachPrimitive(k,(s=>{const k=s;!k.isAnInstance&&k.mg&&k.mg.useBoundingInfoFromGeometry?s.Ts():s.refreshBoundingInfo(!0,!0)})),k._babylonTransformNode)))}_loadMeshAsync(s,k,h,A){const g=h.primitives;if(!g||!g.length)throw new Error(`${s}: Primitives are missing`);void 0==g[0].index&&X.Assign(g);const ms=new Array;this.logOpen(`${s} ${h.name||""}`);const i=k.name||`node${k.index}`;if(1===g.length){const A=h.primitives[0];ms.push(this._loadMeshPrimitiveAsync(`${s}/primitives/${A.index}`,i,k,h,A,(s=>{k._babylonTransformNode=s,k._primitiveBabylonMeshes=[s]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,k._babylonTransformNode=new B.b(i,this._babylonScene),k._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k._primitiveBabylonMeshes=[];for(const A of g)ms.push(this._loadMeshPrimitiveAsync(`${s}/primitives/${A.index}`,`${i}_primitive${A.index}`,k,h,A,(s=>{s.parent=k._babylonTransformNode,k._primitiveBabylonMeshes.push(s)})))}return A(k._babylonTransformNode),this.logClose(),Promise.all(ms).then((()=>k._babylonTransformNode))}_loadMeshPrimitiveAsync(s,k,h,A,g,ms){const i=this._extensionsLoadMeshPrimitiveAsync(s,k,h,A,g,ms);if(i)return i;this.logOpen(`${s}`);const K=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==h.skin&&!A.primitives[0].targets;let H,O;if(K&&g._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,H=g._instanceData.babylonSourceMesh.createInstance(k),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O=g._instanceData.promise;else{const ms=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new p.e(k,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.sideOrientation=this._babylonScene.useRightHandedSystem?R.b.CounterClockWiseSideOrientation:R.b.ClockWiseSideOrientation,this._createMorphTargets(s,h,A,g,i),ms.push(this._loadVertexDataAsync(s,g,i).then((async k=>await this._loadMorphTargetsAsync(s,g,i,k).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,k.Ys(i),k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const c=Z._GetDrawMode(s,g.mode);if(void 0==g.material){let s=this._defaultBabylonMaterialData[c];s||(s=this._createDefaultMaterial("__GLTFLoader._default",c),this._parent.onMaterialLoadedObservable.notifyObservers(s),this._defaultBabylonMaterialData[c]=s),i.material=s}else if(!this.parent.skipMaterials){const k=X.Get(`${s}/material`,this._gltf.materials,g.material);ms.push(this._loadMaterialAsync(`/materials/${k.index}`,k,i,c,(s=>{i.material=s})))}O=Promise.all(ms),K&&(g._instanceData={babylonSourceMesh:i,promise:O}),H=i}return Z.AddPointerMetadata(H,s),this._parent.onMeshLoadedObservable.notifyObservers(H),ms(H),this.logClose(),O.then((()=>H))}_loadVertexDataAsync(s,k,h){const A=this._extensionsLoadVertexDataAsync(s,k,h);if(A)return A;const g=k.attributes;if(!g)throw new Error(`${s}: Attributes are missing`);const ms=new Array,i=new G.c(h.name,this._babylonScene);if(void 0==k.indices)h.isUnIndexed=!0;else{const h=X.Get(`${s}/indices`,this._gltf.accessors,k.indices);ms.push(this._loadIndicesAccessorAsync(`/accessors/${h.index}`,h).then((s=>{i.setIndices(s)})))}const K=(k,A,K)=>{if(void 0==g[k])return;h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(A)&&h._delayInfo.push(A);const H=X.Get(`${s}/attributes/${k}`,this._gltf.accessors,g[k]);ms.push(this._loadVertexAccessorAsync(`/accessors/${H.index}`,H,A).then((s=>{if(s.getKind()===u.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!h.skeleton){const s=L(H);s&&(i._boundingInfo=s,i.useBoundingInfoFromGeometry=!0)}i.setVerticesBuffer(s,H.count)}))),A==u.e.MatricesIndicesExtraKind&&(h.numBoneInfluencers=8),K&&K(H)};return K("POSITION",u.e.PositionKind),K("NORMAL",u.e.NormalKind),K("TANGENT",u.e.TangentKind),K("TEXCOORD_0",u.e.UVKind),K("TEXCOORD_1",u.e.UV2Kind),K("TEXCOORD_2",u.e.UV3Kind),K("TEXCOORD_3",u.e.UV4Kind),K("TEXCOORD_4",u.e.UV5Kind),K("TEXCOORD_5",u.e.UV6Kind),K("JOINTS_0",u.e.MatricesIndicesKind),K("WEIGHTS_0",u.e.MatricesWeightsKind),K("JOINTS_1",u.e.MatricesIndicesExtraKind),K("WEIGHTS_1",u.e.MatricesWeightsExtraKind),K("COLOR_0",u.e.ColorKind,(s=>{"VEC4"===s.type&&(h.hasVertexAlpha=!0)})),Promise.all(ms).then((()=>i))}_createMorphTargets(s,k,h,A,g){if(!A.targets||!this._parent.loadMorphTargets)return;if(void 0==k._numMorphTargets)k._numMorphTargets=A.targets.length;else if(A.targets.length!==k._numMorphTargets)throw new Error(`${s}: Primitives do not have the same number of targets`);const ms=h.extras?h.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,g.morphTargetManager=new t(this._babylonScene),g.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.morphTargetManager.areUpdatesFrozen=!0;for(let i=0;i<A.targets.length;i++){const s=k.weights?k.weights[i]:h.weights?h.weights[i]:0,A=ms?ms[i]:`morphTarget${i}`;g.morphTargetManager.addTarget(new I.b(A,s,g.Is()))}}_loadMorphTargetsAsync(s,k,h,A){if(!k.targets||!this._parent.loadMorphTargets)return Promise.resolve();const g=new Array,ms=h.morphTargetManager;for(let i=0;i<ms.numTargets;i++){const h=ms.getTarget(i);g.push(this._loadMorphTargetVertexDataAsync(`${s}/targets/${i}`,A,k.targets[i],h))}return Promise.all(g).then((()=>{ms.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(s,k,h,A){const g=new Array,ms=(A,ms,i)=>{if(void 0==h[A])return;const K=k.getVertexBuffer(ms);if(!K)return;const H=X.Get(`${s}/${A}`,this._gltf.accessors,h[A]);g.push(this._loadFloatAccessorAsync(`/accessors/${H.index}`,H).then((s=>{i(K,s)})))};return ms("POSITION",u.e.PositionKind,((s,k)=>{const h=new Float32Array(k.length);s.forEach(k.length,((s,A)=>{h[A]=k[A]+s})),A.setPositions(h)})),ms("NORMAL",u.e.NormalKind,((s,k)=>{const h=new Float32Array(k.length);s.forEach(h.length,((s,A)=>{h[A]=k[A]+s})),A.setNormals(h)})),ms("TANGENT",u.e.TangentKind,((s,k)=>{const h=new Float32Array(k.length/3*4);let g=0;s.forEach(k.length/3*4,((s,A)=>{(A+1)%4!==0&&(h[g]=k[g]+s,g++)})),A.setTangents(h)})),ms("TEXCOORD_0",u.e.UVKind,((s,k)=>{const h=new Float32Array(k.length);s.forEach(k.length,((s,A)=>{h[A]=k[A]+s})),A.setUVs(h)})),ms("TEXCOORD_1",u.e.UV2Kind,((s,k)=>{const h=new Float32Array(k.length);s.forEach(k.length,((s,A)=>{h[A]=k[A]+s})),A.setUV2s(h)})),ms("COLOR_0",u.e.ColorKind,((k,h)=>{let g=null;const ms=k.getSize();if(3===ms){g=new Float32Array(h.length/3*4),k.forEach(h.length,((s,k)=>{const A=Math.floor(k/3),ms=k%3;g[4*A+ms]=h[3*A+ms]+s}));for(let s=0;s<h.length/3;++s)g[4*s+3]=1}else{if(4!==ms)throw new Error(`${s}: Invalid number of components (${ms}) for COLOR_0 attribute`);g=new Float32Array(h.length),k.forEach(h.length,((s,k)=>{g[k]=h[k]+s}))}A.setColors(g)})),await Promise.all(g).then((()=>{}))}static _LoadTransform(s,k){if(void 0!=s.skin)return;let h=g.Pk.Zero(),A=g.Quaternion.Identity(),ms=g.Pk.One();if(s.matrix){g.Matrix.uk(s.matrix).decompose(ms,A,h)}else s.translation&&(h=g.Pk.uk(s.translation)),s.rotation&&(A=g.Quaternion.uk(s.rotation)),s.scale&&(ms=g.Pk.uk(s.scale));k.position=h,k.rotationQuaternion=A,k.Sg=ms}_loadSkinAsync(s,k,h,A){if(!this._parent.loadSkins)return Promise.resolve();const g=this._extensionsLoadSkinAsync(s,k,h);if(g)return g;if(h._data)return A(h._data.babylonSkeleton),h._data.promise;const ms=`skeleton${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new P(h.name||ms,ms,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(s,h,i);const K=this._loadSkinInverseBindMatricesDataAsync(s,h).then((s=>{this._updateBoneMatrices(i,s)}));return h._data={babylonSkeleton:i,promise:K},A(i),K}_loadBones(s,k,h){if(void 0==k.skeleton||this._parent.alwaysComputeSkeletonRootNode){const h=this._findSkeletonRootNode(`${s}/joints`,k.joints);if(h)if(void 0===k.skeleton)k.skeleton=h.index;else{const A=(s,k)=>{for(;k.parent;k=k.parent)if(k.parent===s)return!0;return!1},g=X.Get(`${s}/skeleton`,this._gltf.nodes,k.skeleton);g===h||A(g,h)||(E.c.Warn(`${s}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),k.skeleton=h.index)}else E.c.Warn(`${s}: Failed to find common root`)}const A={};for(const g of k.joints){const ms=X.Get(`${s}/joints/${g}`,this._gltf.nodes,g);this._loadBone(ms,k,h,A)}}_findSkeletonRootNode(s,k){if(0===k.length)return null;const h={};for(const g of k){const k=[];let A=X.Get(`${s}/${g}`,this._gltf.nodes,g);for(;-1!==A.index;)k.unshift(A),A=A.parent;h[g]=k}let A=null;for(let g=0;;++g){let s=h[k[0]];if(g>=s.length)return A;const ms=s[g];for(let i=1;i<k.length;++i)if(s=h[k[i]],g>=s.length||ms!==s[g])return A;A=ms}}_loadBone(s,k,h,A){s._isJoint=!0;let g=A[s.index];if(g)return g;let ms=null;s.index!==k.skeleton&&(s.parent&&-1!==s.parent.index?ms=this._loadBone(s.parent,k,h,A):void 0!==k.skeleton&&E.c.Warn(`/skins/${k.index}/skeleton: Skeleton node is not a common root`));const i=k.joints.indexOf(s.index);return g=new O.e(s.name||`joint${s.index}`,h,ms,this._getNodeMatrix(s),null,null,i),A[s.index]=g,this._postSceneLoadActions.push((()=>{g.linkTransformNode(s._babylonTransformNode)})),g}_loadSkinInverseBindMatricesDataAsync(s,k){if(void 0==k.inverseBindMatrices)return Promise.resolve(null);const h=X.Get(`${s}/inverseBindMatrices`,this._gltf.accessors,k.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)}_updateBoneMatrices(s,k){for(const h of s.bones){const s=g.Matrix.Identity(),A=h._index;k&&-1!==A&&(g.Matrix.FromArrayToRef(k,16*A,s),s.invertToRef(s));const ms=h.getParent();ms&&s.multiplyToRef(ms.getAbsoluteInverseBindMatrix(),s),h.Fh(s,!1,!1),h._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(s){return s.matrix?g.Matrix.uk(s.matrix):g.Matrix.Compose(s.scale?g.Pk.uk(s.scale):g.Pk.One(),s.rotation?g.Quaternion.uk(s.rotation):g.Quaternion.Identity(),s.translation?g.Pk.uk(s.translation):g.Pk.Zero())}loadCameraAsync(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadCameraAsync(s,k,h);if(A)return A;const ms=new Array;this.logOpen(`${s} ${k.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new H.e(k.name||`camera${k.index}`,g.Pk.Zero(),this._babylonScene,!1);switch(i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k._babylonCamera=i,i.setTarget(new g.Pk(0,0,-1)),k.type){case"perspective":{const h=k.perspective;if(!h)throw new Error(`${s}: Camera perspective properties are missing`);i.fov=h.yfov,i.Jh=h.znear,i.maxZ=h.zfar||0;break}case"orthographic":if(!k.orthographic)throw new Error(`${s}: Camera orthographic properties are missing`);i.mode=K.d.ORTHOGRAPHIC_CAMERA,i.orthoLeft=-k.orthographic.xmag,i.orthoRight=k.orthographic.xmag,i.orthoBottom=-k.orthographic.ymag,i.orthoTop=k.orthographic.ymag,i.Jh=k.orthographic.znear,i.maxZ=k.orthographic.zfar;break;default:throw new Error(`${s}: Invalid camera type (${k.type})`)}return Z.AddPointerMetadata(i,s),this._parent.onCameraLoadedObservable.notifyObservers(i),h(i),this.logClose(),Promise.all(ms).then((()=>i))}_loadAnimationsAsync(){const s=this._gltf.animations;if(!s)return Promise.resolve();const k=new Array;for(let h=0;h<s.length;h++){const A=s[h];k.push(this.loadAnimationAsync(`/animations/${A.index}`,A).then((s=>{0===s.targetedAnimations.length&&s.dispose()})))}return Promise.all(k).then((()=>{}))}loadAnimationAsync(s,k){const A=this._extensionsLoadAnimationAsync(s,k);return A||h.e(78).then(h.bind(h,15796)).then((h=>{let{AnimationGroup:A}=h;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new A(k.name||`animation${k.index}`,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k._babylonAnimationGroup=g;const ms=new Array;X.Assign(k.channels),X.Assign(k.samplers);for(const i of k.channels)ms.push(this._loadAnimationChannelAsync(`${s}/channels/${i.index}`,s,k,i,((s,k)=>{s.animations=s.animations||[],s.animations.push(k),g.addTargetedAnimation(k,s)})));return Promise.all(ms).then((()=>(g.normalize(0),g)))}))}async _loadAnimationChannelAsync(s,k,A,g,ms){const i=this._extensionsLoadAnimationChannelAsync(s,k,A,g,ms);if(i)return await i;if(void 0==g.target.node)return await Promise.resolve();const K=X.Get(`${s}/target/node`,this._gltf.nodes,g.target.node),H=g.target.path,O="weights"===H;if(O&&!K._numMorphTargets||!O&&!K._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!O&&!K._isJoint)return await Promise.resolve();let c;switch(await Promise.resolve().then(h.bind(h,14257)),H){case"translation":var S;c=null===(S=(0,q.c)("/nodes/{}/translation"))||void 0===S?void 0:S.interpolation;break;case"rotation":var a;c=null===(a=(0,q.c)("/nodes/{}/rotation"))||void 0===a?void 0:a.interpolation;break;case"scale":var r;c=null===(r=(0,q.c)("/nodes/{}/scale"))||void 0===r?void 0:r.interpolation;break;case"weights":var d;c=null===(d=(0,q.c)("/nodes/{}/weights"))||void 0===d?void 0:d.interpolation;break;default:throw new Error(`${s}/target/path: Invalid value (${g.target.path})`)}if(!c)throw new Error(`${s}/target/path: Could not find interpolation properties for target path (${g.target.path})`);const E={object:K,info:c};return await this._loadAnimationChannelFromTargetInfoAsync(s,k,A,g,E,ms)}_loadAnimationChannelFromTargetInfoAsync(s,k,h,A,g,ms){const i=this.parent.targetFps,K=1/i,H=X.Get(`${s}/sampler`,h.samplers,A.sampler);return this._loadAnimationSamplerAsync(`${k}/samplers/${A.sampler}`,H).then((s=>{let k=0;const H=g.object,O=g.info;for(const g of O){const O=g.getStride(H),c=s.input,S=s.output,a=new Array(c.length);let r=0;switch(s.interpolation){case"STEP":for(let s=0;s<c.length;s++){const k=g.getValue(H,S,r,1);r+=O,a[s]={frame:c[s]*i,value:k,interpolation:1}}break;case"CUBICSPLINE":for(let s=0;s<c.length;s++){const k=g.getValue(H,S,r,K);r+=O;const h=g.getValue(H,S,r,1);r+=O;const A=g.getValue(H,S,r,K);r+=O,a[s]={frame:c[s]*i,inTangent:k,value:h,outTangent:A}}break;case"LINEAR":for(let s=0;s<c.length;s++){const k=g.getValue(H,S,r,1);r+=O,a[s]={frame:c[s]*i,value:k}}}if(r>0){const s=`${h.name||`animation${h.index}`}_channel${A.index}_${k}`,K=g.buildAnimations(H,s,i,a);for(const h of K)k++,ms(h.babylonAnimatable,h.babylonAnimation)}}}))}_loadAnimationSamplerAsync(s,k){if(k._data)return k._data;const h=k.interpolation||"LINEAR";switch(h){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${s}/interpolation: Invalid value (${k.interpolation})`)}const A=X.Get(`${s}/input`,this._gltf.accessors,k.input),g=X.Get(`${s}/output`,this._gltf.accessors,k.output);return k._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${A.index}`,A),this._loadFloatAccessorAsync(`/accessors/${g.index}`,g)]).then((s=>{let[k,A]=s;return{input:k,interpolation:h,output:A}})),k._data}loadBufferAsync(s,k,h,A){const g=this._extensionsLoadBufferAsync(s,k,h,A);if(g)return g;if(!k._data)if(k.uri)k._data=this.loadUriAsync(`${s}/uri`,k,k.uri);else{if(!this._bin)throw new Error(`${s}: Uri is missing or the binary glTF is missing its binary chunk`);k._data=this._bin.readAsync(0,k.byteLength)}return k._data.then((k=>{try{return new Uint8Array(k.buffer,k.byteOffset+h,A)}catch(g){throw new Error(`${s}: ${g.message}`)}}))}loadBufferViewAsync(s,k){const h=this._extensionsLoadBufferViewAsync(s,k);if(h)return h;if(k._data)return k._data;const A=X.Get(`${s}/buffer`,this._gltf.buffers,k.buffer);return k._data=this.loadBufferAsync(`/buffers/${A.index}`,A,k.byteOffset||0,k.byteLength),k._data}_loadAccessorAsync(s,k,h){if(k._data)return k._data;const A=Z._GetNumComponents(s,k.type),g=A*u.e.GetTypeByteLength(k.componentType),ms=A*k.count;if(void 0==k.bufferView)k._data=Promise.resolve(new h(ms));else{const i=X.Get(`${s}/bufferView`,this._gltf.bufferViews,k.bufferView);k._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((K=>{if(5126!==k.componentType||k.normalized||i.byteStride&&i.byteStride!==g){const s=new h(ms);return u.e.ForEach(K,k.byteOffset||0,i.byteStride||g,A,k.componentType,s.length,k.normalized||!1,((k,h)=>{s[h]=k})),s}return Z._GetTypedArray(s,k.componentType,K,k.byteOffset,ms)}))}if(k.sparse){const ms=k.sparse;k._data=k._data.then((i=>{const K=i,H=X.Get(`${s}/sparse/indices/bufferView`,this._gltf.bufferViews,ms.indices.bufferView),O=X.Get(`${s}/sparse/values/bufferView`,this._gltf.bufferViews,ms.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${H.index}`,H),this.loadBufferViewAsync(`/bufferViews/${O.index}`,O)]).then((i=>{let[H,O]=i;const c=Z._GetTypedArray(`${s}/sparse/indices`,ms.indices.componentType,H,ms.indices.byteOffset,ms.count),S=A*ms.count;let a;if(5126!==k.componentType||k.normalized){const i=Z._GetTypedArray(`${s}/sparse/values`,k.componentType,O,ms.values.byteOffset,S);a=new h(S),u.e.ForEach(i,0,g,A,k.componentType,a.length,k.normalized||!1,((s,k)=>{a[k]=s}))}else a=Z._GetTypedArray(`${s}/sparse/values`,k.componentType,O,ms.values.byteOffset,S);let r=0;for(let s=0;s<c.length;s++){let k=c[s]*A;for(let s=0;s<A;s++)K[k++]=a[r++]}return K}))}))}return k._data}_loadFloatAccessorAsync(s,k){return this._loadAccessorAsync(s,k,Float32Array)}_loadIndicesAccessorAsync(s,k){if("SCALAR"!==k.type)throw new Error(`${s}/type: Invalid value ${k.type}`);if(5121!==k.componentType&&5123!==k.componentType&&5125!==k.componentType)throw new Error(`${s}/componentType: Invalid value ${k.componentType}`);if(k._data)return k._data;if(k.sparse){const h=Z._GetTypedArrayConstructor(`${s}/componentType`,k.componentType);k._data=this._loadAccessorAsync(s,k,h)}else{const h=X.Get(`${s}/bufferView`,this._gltf.bufferViews,k.bufferView);k._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>Z._GetTypedArray(s,k.componentType,h,k.byteOffset,k.count)))}return k._data}_loadVertexBufferViewAsync(s){if(s._babylonBuffer)return s._babylonBuffer;const k=this._babylonScene.getEngine();return s._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((s=>new u.b(k,s,!1))),s._babylonBuffer}_loadVertexAccessorAsync(s,k,h){var A;if(null!==(A=k._babylonVertexBuffer)&&void 0!==A&&A[h])return k._babylonVertexBuffer[h];k._babylonVertexBuffer||(k._babylonVertexBuffer={});const g=this._babylonScene.getEngine();if(k.sparse||void 0==k.bufferView)k._babylonVertexBuffer[h]=this._loadFloatAccessorAsync(s,k).then((s=>new u.e(g,s,h,!1)));else{const A=X.Get(`${s}/bufferView`,this._gltf.bufferViews,k.bufferView);k._babylonVertexBuffer[h]=this._loadVertexBufferViewAsync(A).then((ms=>{const i=Z._GetNumComponents(s,k.type);return new u.e(g,ms,h,!1,void 0,A.byteStride,void 0,k.byteOffset,i,k.componentType,k.normalized,!0,void 0,!0)}))}return k._babylonVertexBuffer[h]}_loadMaterialMetallicRoughnessPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return k&&(k.baseColorFactor?(h.albedoColor=ms.Bk.uk(k.baseColorFactor),h.alpha=k.baseColorFactor[3]):h.albedoColor=ms.Bk.White(),h.metallic=void 0==k.metallicFactor?1:k.metallicFactor,h.roughness=void 0==k.roughnessFactor?1:k.roughnessFactor,k.baseColorTexture&&A.push(this.loadTextureInfoAsync(`${s}/baseColorTexture`,k.baseColorTexture,(s=>{s.name=`${h.name} (Base Color)`,h.albedoTexture=s}))),k.metallicRoughnessTexture&&(k.metallicRoughnessTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${s}/metallicRoughnessTexture`,k.metallicRoughnessTexture,(s=>{s.name=`${h.name} (Metallic Roughness)`,h.metallicTexture=s}))),h.useMetallnessFromMetallicTextureBlue=!0,h.useRoughnessFromMetallicTextureGreen=!0,h.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(A).then((()=>{}))}_loadMaterialAsync(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const ms=this._extensionsLoadMaterialAsync(s,k,h,A,g);if(ms)return ms;k._data=k._data||{};let i=k._data[A];if(!i){this.logOpen(`${s} ${k.name||""}`);const h=this.createMaterial(s,k,A);i={babylonMaterial:h,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(s,k,h)},k._data[A]=i,Z.AddPointerMetadata(h,s),this._parent.onMaterialLoadedObservable.notifyObservers(h),this.logClose()}return h&&(i.babylonMeshes.push(h),h.Dh.addOnce((()=>{const s=i.babylonMeshes.indexOf(h);-1!==s&&i.babylonMeshes.splice(s,1)}))),g(i.babylonMaterial),i.promise.then((()=>i.babylonMaterial))}_createDefaultMaterial(s,k){this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new D.c(s,this._babylonScene);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.fillMode=k,h.enableSpecularAntiAliasing=!0,h.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,h.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,h.transparencyMode=D.c.PBRMATERIAL_OPAQUE,h.metallic=1,h.roughness=1,h}createMaterial(s,k,h){const A=this._extensionsCreateMaterial(s,k,h);if(A)return A;const g=k.name||`material${k.index}`;return this._createDefaultMaterial(g,h)}loadMaterialPropertiesAsync(s,k,h){const A=this._extensionsLoadMaterialPropertiesAsync(s,k,h);if(A)return A;const g=new Array;return g.push(this.loadMaterialBasePropertiesAsync(s,k,h)),k.pbrMetallicRoughness&&g.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${s}/pbrMetallicRoughness`,k.pbrMetallicRoughness,h)),this.loadMaterialAlphaProperties(s,k,h),Promise.all(g).then((()=>{}))}loadMaterialBasePropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return h.emissiveColor=k.emissiveFactor?ms.Bk.uk(k.emissiveFactor):new ms.Bk(0,0,0),k.doubleSided&&(h.Hg=!1,h.twoSidedLighting=!0),k.normalTexture&&(k.normalTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${s}/normalTexture`,k.normalTexture,(s=>{s.name=`${h.name} (Normal)`,h.bumpTexture=s}))),h.invertNormalMapX=!this._babylonScene.useRightHandedSystem,h.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=k.normalTexture.scale&&h.bumpTexture&&(h.bumpTexture.level=k.normalTexture.scale),h.forceIrradianceInFragment=!0),k.occlusionTexture&&(k.occlusionTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${s}/occlusionTexture`,k.occlusionTexture,(s=>{s.name=`${h.name} (Occlusion)`,h.ambientTexture=s}))),h.useAmbientInGrayScale=!0,void 0!=k.occlusionTexture.strength&&(h.ambientTextureStrength=k.occlusionTexture.strength)),k.emissiveTexture&&A.push(this.loadTextureInfoAsync(`${s}/emissiveTexture`,k.emissiveTexture,(s=>{s.name=`${h.name} (Emissive)`,h.emissiveTexture=s}))),Promise.all(A).then((()=>{}))}loadMaterialAlphaProperties(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);switch(k.alphaMode||"OPAQUE"){case"OPAQUE":h.transparencyMode=D.c.PBRMATERIAL_OPAQUE,h.alpha=1;break;case"MASK":h.transparencyMode=D.c.PBRMATERIAL_ALPHATEST,h.alphaCutOff=void 0==k.alphaCutoff?.5:k.alphaCutoff,h.albedoTexture&&(h.albedoTexture.Wh=!0);break;case"BLEND":h.transparencyMode=D.c.PBRMATERIAL_ALPHABLEND,h.albedoTexture&&(h.albedoTexture.Wh=!0,h.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${s}/alphaMode: Invalid value (${k.alphaMode})`)}}loadTextureInfoAsync(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureInfoAsync(s,k,h);if(A)return A;if(this.logOpen(`${s}`),k.texCoord>=6)throw new Error(`${s}/texCoord: Invalid value (${k.texCoord})`);const g=X.Get(`${s}/index`,this._gltf.textures,k.index);g._textureInfo=k;const ms=this._loadTextureAsync(`/textures/${k.index}`,g,(A=>{A.coordinatesIndex=k.texCoord||0,Z.AddPointerMetadata(A,s),this._parent.onTextureLoadedObservable.notifyObservers(A),h(A)}));return this.logClose(),ms}_loadTextureAsync(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureAsync(s,k,h);if(A)return A;this.logOpen(`${s} ${k.name||""}`);const g=void 0==k.sampler?Z.DefaultSampler:X.Get(`${s}/sampler`,this._gltf.samplers,k.sampler),ms=X.Get(`${s}/source`,this._gltf.images,k.source),i=this._createTextureAsync(s,g,ms,h,void 0,!k._textureInfo.nonColorData);return this.logClose(),i}_createTextureAsync(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},ms=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;const K=this._loadSampler(`/samplers/${k.index}`,k),H=new Array,O=new A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c={noMipmap:K.noMipMaps,invertY:!1,samplingMode:K.samplingMode,F:()=>{this._disposed||O.resolve()},onError:(k,h)=>{this._disposed||O.reject(new Error(`${s}: ${h&&h.message?h.message:k||"Failed to load texture"}`))},mimeType:h.mimeType??(0,C.f)(h.uri??""),loaderOptions:ms,useSRGBBuffer:!!i&&this._parent.useSRGBBuffers},S=new w.b(null,this._babylonScene,c);return S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.push(O.promise),H.push(this.loadImageAsync(`/images/${h.index}`,h).then((s=>{const k=h.uri||`${this._fileName}#image${h.index}`,A=`data:${this._uniqueRootUrl}${k}`;S.updateURL(A,s);const g=S.getInternalTexture();g&&(g.label=h.name)}))),S.wrapU=K.wrapU,S.wrapV=K.wrapV,g(S),this._parent.useGltfTextureNames&&(S.name=h.name||h.uri||`image${h.index}`),Promise.all(H).then((()=>S))}_loadSampler(s,k){return k._data||(k._data={noMipMaps:9728===k.minFilter||9729===k.minFilter,samplingMode:Z._GetTextureSamplingMode(s,k),wrapU:Z._GetTextureWrapMode(`${s}/wrapS`,k.wrapS),wrapV:Z._GetTextureWrapMode(`${s}/wrapT`,k.wrapT)}),k._data}loadImageAsync(s,k){if(!k._data){if(this.logOpen(`${s} ${k.name||""}`),k.uri)k._data=this.loadUriAsync(`${s}/uri`,k,k.uri);else{const h=X.Get(`${s}/bufferView`,this._gltf.bufferViews,k.bufferView);k._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}this.logClose()}return k._data}loadUriAsync(s,k,h){const A=this._extensionsLoadUriAsync(s,k,h);if(A)return A;if(!Z._ValidateUri(h))throw new Error(`${s}: '${h}' is invalid`);if((0,C.g)(h)){const k=new Uint8Array((0,C.c)(h));return this.log(`${s}: Decoded ${h.substring(0,64)}... (${k.length} bytes)`),Promise.resolve(k)}return this.log(`${s}: Loading ${h}`),this._parent.preprocessUrlAsync(this._rootUrl+h).then((k=>new Promise(((A,g)=>{this._parent._loadFile(this._babylonScene,k,(k=>{this._disposed||(this.log(`${s}: Loaded ${h} (${k.byteLength} bytes)`),A(new Uint8Array(k)))}),!0,(k=>{g(new C.h(`${s}: Failed to load '${h}'${k?": "+k.status+" "+k.statusText:""}`,k))}))}))))}static AddPointerMetadata(s,k){s.metadata=s.metadata||{};const h=s._internalMetadata=s._internalMetadata||{},A=h.th=h.th||{};(A.pointers=A.pointers||[]).push(k)}static _GetTextureWrapMode(s,k){switch(k=void 0==k?10497:k){case 33071:return w.b.CLAMP_ADDRESSMODE;case 33648:return w.b.MIRROR_ADDRESSMODE;case 10497:return w.b.WRAP_ADDRESSMODE;default:return E.c.Warn(`${s}: Invalid value (${k})`),w.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(s,k){const h=void 0==k.magFilter?9729:k.magFilter,A=void 0==k.minFilter?9987:k.minFilter;if(9729===h)switch(A){case 9728:return w.b.LINEAR_NEAREST;case 9729:return w.b.LINEAR_LINEAR;case 9984:return w.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return w.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return w.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return w.b.LINEAR_LINEAR_MIPLINEAR;default:return E.c.Warn(`${s}/minFilter: Invalid value (${A})`),w.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==h&&E.c.Warn(`${s}/magFilter: Invalid value (${h})`),A){case 9728:return w.b.NEAREST_NEAREST;case 9729:return w.b.NEAREST_LINEAR;case 9984:return w.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return w.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return w.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return w.b.NEAREST_LINEAR_MIPLINEAR;default:return E.c.Warn(`${s}/minFilter: Invalid value (${A})`),w.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(s,k){try{return(0,V.n)(k)}catch(h){throw new Error(`${s}: ${h.message}`)}}static _GetTypedArray(s,k,h,A,g){const ms=h.buffer;A=h.byteOffset+(A||0);const i=Z._GetTypedArrayConstructor(`${s}/componentType`,k),K=u.e.GetTypeByteLength(k);return A%K!==0?(E.c.Warn(`${s}: Copying buffer as byte offset (${A}) is not a multiple of component type byte length (${K})`),new i(ms.slice(A,A+g*K),0)):new i(ms,A,g)}static _GetNumComponents(s,k){switch(k){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${s}: Invalid type (${k})`)}static _ValidateUri(s){return i.Tools.IsBase64(s)||-1===s.indexOf("..")}static _GetDrawMode(s,k){switch(void 0==k&&(k=4),k){case 0:return R.b.PointListDrawMode;case 1:return R.b.LineListDrawMode;case 2:return R.b.LineLoopDrawMode;case 3:return R.b.LineStripDrawMode;case 4:return R.b.TriangleFillMode;case 5:return R.b.TriangleStripDrawMode;case 6:return R.b.TriangleFanDrawMode}throw new Error(`${s}: Invalid mesh primitive mode (${k})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const s=new Array;if(this._gltf.materials)for(const k of this._gltf.materials)if(k._data)for(const h in k._data){const A=k._data[h];for(const k of A.babylonMeshes){k.fh(!0);const h=A.babylonMaterial;s.push(h.forceCompilationAsync(k)),s.push(h.forceCompilationAsync(k,{useInstances:!0})),this._parent.useClipPlane&&(s.push(h.forceCompilationAsync(k,{clipPlane:!0})),s.push(h.forceCompilationAsync(k,{clipPlane:!0,useInstances:!0})))}}return Promise.all(s).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const s=new Array,k=this._babylonScene.lights;for(const h of k){const k=h.getShadowGenerator();k&&s.push(k.forceCompilationAsync())}return Promise.all(s).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(s){for(const k of this._extensions)k.enabled&&s(k)}_applyExtensions(s,k,h){for(const A of this._extensions)if(A.enabled){const g=`${A.name}.${k}`,ms=s;ms._activeLoaderExtensionFunctions=ms._activeLoaderExtensionFunctions||{};const i=ms._activeLoaderExtensionFunctions;if(!i[g]){i[g]=!0;try{const s=h(A);if(s)return s}finally{delete i[g]}}}return null}_extensionsOnLoading(){this._forEachExtensions((s=>s.onLoading&&s.onLoading()))}_extensionsOnReady(){this._forEachExtensions((s=>s.onReady&&s.onReady()))}_extensionsLoadSceneAsync(s,k){return this._applyExtensions(k,"loadScene",(h=>h.loadSceneAsync&&h.loadSceneAsync(s,k)))}_extensionsLoadNodeAsync(s,k,h){return this._applyExtensions(k,"loadNode",(A=>A.loadNodeAsync&&A.loadNodeAsync(s,k,h)))}_extensionsLoadCameraAsync(s,k,h){return this._applyExtensions(k,"loadCamera",(A=>A.loadCameraAsync&&A.loadCameraAsync(s,k,h)))}_extensionsLoadVertexDataAsync(s,k,h){return this._applyExtensions(k,"loadVertexData",(A=>A._loadVertexDataAsync&&A._loadVertexDataAsync(s,k,h)))}_extensionsLoadMeshPrimitiveAsync(s,k,h,A,g,ms){return this._applyExtensions(g,"loadMeshPrimitive",(i=>i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(s,k,h,A,g,ms)))}_extensionsLoadMaterialAsync(s,k,h,A,g){return this._applyExtensions(k,"loadMaterial",(ms=>ms._loadMaterialAsync&&ms._loadMaterialAsync(s,k,h,A,g)))}_extensionsCreateMaterial(s,k,h){return this._applyExtensions(k,"createMaterial",(A=>A.createMaterial&&A.createMaterial(s,k,h)))}_extensionsLoadMaterialPropertiesAsync(s,k,h){return this._applyExtensions(k,"loadMaterialProperties",(A=>A.loadMaterialPropertiesAsync&&A.loadMaterialPropertiesAsync(s,k,h)))}_extensionsLoadTextureInfoAsync(s,k,h){return this._applyExtensions(k,"loadTextureInfo",(A=>A.loadTextureInfoAsync&&A.loadTextureInfoAsync(s,k,h)))}_extensionsLoadTextureAsync(s,k,h){return this._applyExtensions(k,"loadTexture",(A=>A._loadTextureAsync&&A._loadTextureAsync(s,k,h)))}_extensionsLoadAnimationAsync(s,k){return this._applyExtensions(k,"loadAnimation",(h=>h.loadAnimationAsync&&h.loadAnimationAsync(s,k)))}_extensionsLoadAnimationChannelAsync(s,k,h,A,g){return this._applyExtensions(h,"loadAnimationChannel",(ms=>ms._loadAnimationChannelAsync&&ms._loadAnimationChannelAsync(s,k,h,A,g)))}_extensionsLoadSkinAsync(s,k,h){return this._applyExtensions(h,"loadSkin",(A=>A._loadSkinAsync&&A._loadSkinAsync(s,k,h)))}_extensionsLoadUriAsync(s,k,h){return this._applyExtensions(k,"loadUri",(A=>A._loadUriAsync&&A._loadUriAsync(s,k,h)))}_extensionsLoadBufferViewAsync(s,k){return this._applyExtensions(k,"loadBufferView",(h=>h.loadBufferViewAsync&&h.loadBufferViewAsync(s,k)))}_extensionsLoadBufferAsync(s,k,h,A){return this._applyExtensions(k,"loadBuffer",(g=>g.loadBufferAsync&&g.loadBufferAsync(s,k,h,A)))}static LoadExtensionAsync(s,k,h,A){if(!k.extensions)return null;const g=k.extensions[h];return g?A(`${s}/extensions/${h}`,g):null}static LoadExtraAsync(s,k,h,A){if(!k.extras)return null;const g=k.extras[h];return g?A(`${s}/extras/${h}`,g):null}isExtensionUsed(s){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(s)}logOpen(s){this._parent._logOpen(s)}logClose(){this._parent._logClose()}log(s){this._parent._log(s)}startPerformanceCounter(s){this._parent._startPerformanceCounter(s)}endPerformanceCounter(s){this._parent._endPerformanceCounter(s)}}Z.DefaultSampler={index:-1},z.d._CreateGLTF2Loader=s=>new Z(s);var x=h(14257),y=h(12788),W=h(12623),J=h(14263),F=h(14269);class o extends F.d{constructor(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",s),this._texture=s.getEngine().createRawCubeTexture(k,h,A,g,ms,i,K,H)}update(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,s,k,h,A,g)}updateRGBDAsync(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,J.m)(this._texture,s,k,h,A).then((()=>{}))}clone(){return W.e.Clone((()=>{const s=this.Is(),k=this._texture,h=new o(s,k._bufferViewArray,k.width,k.format,k.type,k.generateMipMaps,k.invertY,k.samplingMode,k._compression);return 13===k.source&&h.updateRGBDAsync(k._bufferViewArrayArray,k._sphericalPolynomial,k._lodGenerationScale,k._lodGenerationOffset),h}),this)}}const l="EXT_lights_image_based";class f{constructor(s){this.name=l,this._loader=s,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null,delete this._lights}onLoading(){const s=this._loader.th.extensions;if(s&&s[this.name]){const k=s[this.name];this._lights=k.lights}}loadSceneAsync(s,k){return Z.LoadExtensionAsync(s,k,this.name,(async(h,A)=>{this._loader._allMaterialsDirtyRequired=!0;const g=new Array;g.push(this._loader.loadSceneAsync(s,k)),this._loader.logOpen(`${h}`);const ms=X.Get(`${h}/light`,this._lights,A.Sh);return g.push(this._loadLightAsync(`/extensions/${this.name}/lights/${A.Sh}`,ms).then((s=>{this._loader.babylonScene.environmentTexture=s}))),this._loader.logClose(),await Promise.all(g).then((()=>{}))}))}_loadLightAsync(s,k){if(!k._loaded){const h=new Array;this._loader.logOpen(`${s}`);const A=new Array(k.specularImages.length);for(let g=0;g<k.specularImages.length;g++){const ms=k.specularImages[g];A[g]=new Array(ms.length);for(let k=0;k<ms.length;k++){const i=`${s}/specularImages/${g}/${k}`;this._loader.logOpen(`${i}`);const K=ms[k],H=X.Get(i,this._loader.th.images,K);h.push(this._loader.loadImageAsync(`/images/${K}`,H).then((s=>{A[g][k]=s}))),this._loader.logClose()}}this._loader.logClose(),k._loaded=Promise.all(h).then((async()=>{const h=new o(this._loader.babylonScene,null,k.specularImageSize);if(h.name=k.name||"environment",k._babylonTexture=h,void 0!=k.Ng&&(h.level=k.Ng),k.rotation){let s=g.Quaternion.uk(k.rotation);this._loader.babylonScene.useRightHandedSystem||(s=g.Quaternion.Inverse(s)),g.Matrix.FromQuaternionToRef(s,h.getReflectionTextureMatrix())}if(!k.irradianceCoefficients)throw new Error(`${s}: Irradiance coefficients are missing`);const ms=y.c.uk(k.irradianceCoefficients);ms.scaleInPlace(k.Ng),ms.convertIrradianceToLambertianRadiance();const i=y.f.FromHarmonics(ms),K=(A.length-1)/Math.log2(k.specularImageSize);return await h.updateRGBDAsync(A,i,K)}))}return k._loaded.then((()=>k._babylonTexture))}}U(l),T(l,!0,(s=>new f(s)));h(13170);const e="EXT_mesh_gpu_instancing";class ss{constructor(s){this.name=e,this._loader=s,this.enabled=this._loader.isExtensionUsed(e)}dispose(){this._loader=null}loadNodeAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(s,A)=>{this._loader._disableInstancedMesh++;const ms=this._loader.loadNodeAsync(`/nodes/${k.index}`,k,h);if(this._loader._disableInstancedMesh--,!k._primitiveBabylonMeshes)return await ms;const i=new Array;let K=0;const H=k=>{if(void 0==A.attributes[k])return void i.push(Promise.resolve(null));const h=X.Get(`${s}/attributes/${k}`,this._loader.th.accessors,A.attributes[k]);if(i.push(this._loader._loadFloatAccessorAsync(`/accessors/${h.bufferView}`,h)),0===K)K=h.count;else if(K!==h.count)throw new Error(`${s}/attributes: Instance buffer accessors do not have the same count.`)};return H("TRANSLATION"),H("ROTATION"),H("SCALE"),await ms.then((async s=>{const[h,A,ms]=await Promise.all(i),H=new Float32Array(16*K);g.TmpVectors.Pk[0].cg(0,0,0),g.TmpVectors.Quaternion[0].cg(0,0,0,1),g.TmpVectors.Pk[1].cg(1,1,1);for(let k=0;k<K;++k)h&&g.Pk.FromArrayToRef(h,3*k,g.TmpVectors.Pk[0]),A&&g.Quaternion.FromArrayToRef(A,4*k,g.TmpVectors.Quaternion[0]),ms&&g.Pk.FromArrayToRef(ms,3*k,g.TmpVectors.Pk[1]),g.Matrix.ComposeToRef(g.TmpVectors.Pk[1],g.TmpVectors.Quaternion[0],g.TmpVectors.Pk[0],g.TmpVectors.Matrix[0]),g.TmpVectors.Matrix[0].copyToArray(H,16*k);for(const g of k._primitiveBabylonMeshes)g.ja("matrix",H,16,!0);return s}))}))}}U(e),T(e,!0,(s=>new ss(s)));let ks=0,hs=null;class As{static get Default(){return As._Default||(As._Default=new As),As._Default}constructor(){const s=As.Configuration.decoder;this._decoderModulePromise=i.Tools.LoadBabylonScriptAsync(s.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(s,k,h,A,g){await this._decoderModulePromise,0===ks&&(MeshoptDecoder.useWorkers(1),ks=1);const ms=await MeshoptDecoder.decodeGltfBufferAsync(k,h,s,A,g);return null!==hs&&clearTimeout(hs),hs=setTimeout((()=>{MeshoptDecoder.useWorkers(0),ks=0,hs=null}),1e3),ms}}As.Configuration={decoder:{url:`${i.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},As._Default=null;const gs="EXT_meshopt_compression";class mk{constructor(s){this.name=gs,this.enabled=s.isExtensionUsed(gs),this._loader=s}dispose(){this._loader=null}loadBufferViewAsync(s,k){return Z.LoadExtensionAsync(s,k,this.name,(async(h,A)=>{const g=k;if(g._meshOptData)return await g._meshOptData;const ms=X.Get(`${s}/buffer`,this._loader.th.buffers,A.buffer);return g._meshOptData=this._loader.loadBufferAsync(`/buffers/${ms.index}`,ms,A.byteOffset||0,A.byteLength).then((async s=>await As.Default.decodeGltfBufferAsync(s,A.count,A.byteStride,A.mode,A.filter))),await g._meshOptData}))}}U(gs),T(gs,!0,(s=>new mk(s)));const is="EXT_texture_webp";class Ks{constructor(s){this.name=is,this._loader=s,this.enabled=s.isExtensionUsed(is)}dispose(){this._loader=null}_loadTextureAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=void 0==k.sampler?Z.DefaultSampler:X.Get(`${s}/sampler`,this._loader.th.samplers,k.sampler),i=X.Get(`${A}/source`,this._loader.th.images,g.source);return await this._loader._createTextureAsync(s,ms,i,(s=>{h(s)}),void 0,!k._textureInfo.nonColorData)}))}}U(is),T(is,!0,(s=>new Ks(s)));const Hs="EXT_texture_avif";class Os{constructor(s){this.name=Hs,this._loader=s,this.enabled=s.isExtensionUsed(Hs)}dispose(){this._loader=null}_loadTextureAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=void 0==k.sampler?Z.DefaultSampler:X.Get(`${s}/sampler`,this._loader.th.samplers,k.sampler),i=X.Get(`${A}/source`,this._loader.th.images,g.source);return await this._loader._createTextureAsync(s,ms,i,(s=>{h(s)}),void 0,!k._textureInfo.nonColorData)}))}}U(Hs),T(Hs,!0,(s=>new Os(s)));var cs=h(14253),Ss=h(13147);const as="EXT_lights_ies";class rs{constructor(s){this.name=as,this._loader=s,this.enabled=this._loader.isExtensionUsed(as)}dispose(){this._loader=null,delete this._lights}onLoading(){const s=this._loader.th.extensions;if(s&&s[this.name]){const k=s[this.name];this._lights=k.lights,X.Assign(this._lights)}}loadNodeAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,i)=>{let K,H;this._loader._allMaterialsDirtyRequired=!0;const O=await this._loader.loadNodeAsync(s,k,(s=>{H=X.Get(A,this._lights,i.Sh);const k=H.name||s.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,K=new cs.c(k,g.Pk.Zero(),g.Pk.Backward(),0,1,this._loader.babylonScene),K.angle=Math.PI/2,K.innerAngle=0,K._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,H._babylonLight=K,K.falloffType=Ss.e.FALLOFF_GLTF,K.zg=i.color?ms.Bk.uk(i.color):ms.Bk.White(),K.Ng=i.multiplier||1,K.range=Number.MAX_VALUE,K.parent=s,this._loader._babylonLights.push(K),Z.AddPointerMetadata(K,A),h(s)}));let c;if(H.uri)c=await this._loader.loadUriAsync(s,H,H.uri);else{const k=X.Get(`${s}/bufferView`,this._loader.th.bufferViews,H.bufferView);c=await this._loader.loadBufferViewAsync(`/bufferViews/${k.index}`,k)}return K.iesProfileTexture=new w.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,c,!0,void 0,void 0,void 0,void 0,".ies"),O}))}}U(as),T(as,!0,(s=>new rs(s)));var ds=h(14282);const Es="KHR_draco_mesh_compression";class js{constructor(s){this.name=Es,this.useNormalizedFlagFromAccessor=!0,this._loader=s,this.enabled=ds.e.DefaultAvailable&&this._loader.isExtensionUsed(Es)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{if(void 0!=k.mode&&4!==k.mode&&5!==k.mode)throw new Error(`${s}: Unsupported mode ${k.mode}`);const ms={},i={},K=(s,A)=>{const K=g.attributes[s];if(void 0!=K&&(h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(A)&&h._delayInfo.push(A),ms[A]=K,this.useNormalizedFlagFromAccessor)){const h=X.TryGet(this._loader.th.accessors,k.attributes[s]);h&&(i[A]=h.normalized||!1)}};K("POSITION",u.e.PositionKind),K("NORMAL",u.e.NormalKind),K("TANGENT",u.e.TangentKind),K("TEXCOORD_0",u.e.UVKind),K("TEXCOORD_1",u.e.UV2Kind),K("TEXCOORD_2",u.e.UV3Kind),K("TEXCOORD_3",u.e.UV4Kind),K("TEXCOORD_4",u.e.UV5Kind),K("TEXCOORD_5",u.e.UV6Kind),K("JOINTS_0",u.e.MatricesIndicesKind),K("WEIGHTS_0",u.e.MatricesWeightsKind),K("COLOR_0",u.e.ColorKind);const H=X.Get(A,this._loader.th.bufferViews,g.bufferView);return H._dracoBabylonGeometry||(H._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((async A=>{const g=this.dracoDecoder||ds.e.Default,K=X.TryGet(this._loader.th.accessors,k.attributes.POSITION),H=this._loader.parent.alwaysComputeBoundingBox||h.skeleton||!K?null:L(K);return await g._decodeMeshToGeometryForGltfAsync(h.name,this._loader.babylonScene,A,ms,i,H).catch((k=>{throw new Error(`${s}: ${k.message}`)}))}))),await H._dracoBabylonGeometry}))}}U(Es),T(Es,!0,(s=>new js(s)));var Ps=h(14291),Rs=h(12570),Ds=h(12579),ws=h(13041),Bs=h(13199),us=h(12543);ws.e.AddNodeConstructor("Light_Type_0",((s,k)=>()=>new Gs(s,g.Pk.Zero(),k)));class Gs extends Bs.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(s){this._shadowAngle=s,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(s){const k=this.needCube();if(this._direction=s,this.needCube()!==k&&this._shadowGenerators){const s=this._shadowGenerators.values();for(let k=s.next();!0!==k.done;k=s.next()){k.value.recreateShadowMap()}}}constructor(s,k,h){super(s,h),this._shadowAngle=Math.PI/2,this.position=k}getClassName(){return"PointLight"}getTypeID(){return Ss.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(s){if(this.direction)return super.getShadowDirection(s);switch(s){case 0:return new g.Pk(1,0,0);case 1:return new g.Pk(-1,0,0);case 2:return new g.Pk(0,-1,0);case 3:return new g.Pk(0,1,0);case 4:return new g.Pk(0,0,1);case 5:return new g.Pk(0,0,-1)}return g.Pk.Zero()}_setDefaultShadowProjectionMatrix(s,k,h){const A=this.Is().activeCamera;if(!A)return;const ms=void 0!==this.shadowMinZ?this.shadowMinZ:A.Jh,i=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,K=this.Is().getEngine().rh;g.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,K?i:ms,K?ms:i,s,!0,this._scene.getEngine().isNDCHalfZRange,void 0,K)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(s,k){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,k):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,k),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,k),this}transferToNodeMaterialEffect(s,k){return this.computeTransformedInformation()?s.setFloat3(k,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):s.setFloat3(k,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(s,k){s["POINTLIGHT"+k]=!0}}(0,Rs.e)([(0,Ds.J)()],Gs.prototype,"shadowAngle",null),(0,us.f)("BABYLON.PointLight",Gs);const Qs="KHR_lights_punctual";class ps{constructor(s){this.name=Qs,this._loader=s,this.enabled=this._loader.isExtensionUsed(Qs)}dispose(){this._loader=null,delete this._lights}onLoading(){const s=this._loader.th.extensions;if(s&&s[this.name]){const k=s[this.name];this._lights=k.lights,X.Assign(this._lights)}}loadNodeAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,i)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(s,k,(s=>{let k;const K=X.Get(A,this._lights,i.Sh),H=K.name||s.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,K.type){case"directional":{const s=new Ps.c(H,g.Pk.Backward(),this._loader.babylonScene);s.position.Eg(0),k=s;break}case"point":k=new Gs(H,g.Pk.Zero(),this._loader.babylonScene);break;case"spot":{const s=new cs.c(H,g.Pk.Zero(),g.Pk.Backward(),0,1,this._loader.babylonScene);s.angle=2*(K.spot&&K.spot.outerConeAngle||Math.PI/4),s.innerAngle=2*(K.spot&&K.spot.innerConeAngle||0),k=s;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${A}: Invalid light type (${K.type})`)}k._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,K._babylonLight=k,k.falloffType=Ss.e.FALLOFF_GLTF,k.zg=K.color?ms.Bk.uk(K.color):ms.Bk.White(),k.Ng=void 0==K.Ng?1:K.Ng,k.range=void 0==K.range?Number.MAX_VALUE:K.range,k.parent=s,this._loader._babylonLights.push(k),Z.AddPointerMetadata(k,A),h(s)})))))}}U(Qs),T(Qs,!0,(s=>new ps(s)));const Is="KHR_materials_pbrSpecularGlossiness";class Ns{constructor(s){this.name=Is,this.order=200,this._loader=s,this.enabled=this._loader.isExtensionUsed(Is)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialBasePropertiesAsync(s,k,h)),ms.push(this._loadSpecularGlossinessPropertiesAsync(A,g,h)),this._loader.loadMaterialAlphaProperties(s,k,h),await Promise.all(ms).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return h.metallic=null,h.roughness=null,k.diffuseFactor?(h.albedoColor=ms.Bk.uk(k.diffuseFactor),h.alpha=k.diffuseFactor[3]):h.albedoColor=ms.Bk.White(),h.reflectivityColor=k.specularFactor?ms.Bk.uk(k.specularFactor):ms.Bk.White(),h.microSurface=void 0==k.glossinessFactor?1:k.glossinessFactor,k.diffuseTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/diffuseTexture`,k.diffuseTexture,(s=>{s.name=`${h.name} (Diffuse)`,h.albedoTexture=s}))),k.specularGlossinessTexture&&(A.push(this._loader.loadTextureInfoAsync(`${s}/specularGlossinessTexture`,k.specularGlossinessTexture,(s=>{s.name=`${h.name} (Specular Glossiness)`,h.reflectivityTexture=s,h.reflectivityTexture.Wh=!0}))),h.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(A).then((()=>{}))}}U(Is),T(Is,!0,(s=>new Ns(s)));const bs="KHR_materials_unlit";class ts{constructor(s){this.name=bs,this.order=210,this._loader=s,this.enabled=this._loader.isExtensionUsed(bs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async()=>await this._loadUnlitPropertiesAsync(s,k,h)))}_loadUnlitPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;h.unlit=!0;const g=k.pbrMetallicRoughness;return g&&(g.baseColorFactor?(h.albedoColor=ms.Bk.uk(g.baseColorFactor),h.alpha=g.baseColorFactor[3]):h.albedoColor=ms.Bk.White(),g.baseColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/baseColorTexture`,g.baseColorTexture,(s=>{s.name=`${h.name} (Base Color)`,h.albedoTexture=s})))),k.doubleSided&&(h.Hg=!1,h.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(s,k,h),Promise.all(A).then((()=>{}))}}U(bs),T(bs,!0,(s=>new ts(s)));const zs="KHR_materials_clearcoat";class Cs{constructor(s){this.name=zs,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(zs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadClearCoatPropertiesAsync(A,g,h)),await Promise.all(ms)}))}_loadClearCoatPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return h.clearCoat.isEnabled=!0,h.clearCoat.useRoughnessFromMainTexture=!1,h.clearCoat.remapF0OnInterfaceChange=!1,void 0!=k.clearcoatFactor?h.clearCoat.Ng=k.clearcoatFactor:h.clearCoat.Ng=0,k.clearcoatTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/clearcoatTexture`,k.clearcoatTexture,(s=>{s.name=`${h.name} (ClearCoat)`,h.clearCoat.texture=s}))),void 0!=k.clearcoatRoughnessFactor?h.clearCoat.roughness=k.clearcoatRoughnessFactor:h.clearCoat.roughness=0,k.clearcoatRoughnessTexture&&(k.clearcoatRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${s}/clearcoatRoughnessTexture`,k.clearcoatRoughnessTexture,(s=>{s.name=`${h.name} (ClearCoat Roughness)`,h.clearCoat.textureRoughness=s})))),k.clearcoatNormalTexture&&(k.clearcoatNormalTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${s}/clearcoatNormalTexture`,k.clearcoatNormalTexture,(s=>{s.name=`${h.name} (ClearCoat Normal)`,h.clearCoat.bumpTexture=s}))),h.invertNormalMapX=!h.Is().useRightHandedSystem,h.invertNormalMapY=h.Is().useRightHandedSystem,void 0!=k.clearcoatNormalTexture.scale&&(h.clearCoat.bumpTexture.level=k.clearcoatNormalTexture.scale)),Promise.all(A).then((()=>{}))}}U(zs),T(zs,!0,(s=>new Cs(s)));const vs="KHR_materials_iridescence";class Ys{constructor(s){this.name=vs,this.order=195,this._loader=s,this.enabled=this._loader.isExtensionUsed(vs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadIridescencePropertiesAsync(A,g,h)),await Promise.all(ms).then((()=>{}))}))}_loadIridescencePropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return h.iridescence.isEnabled=!0,h.iridescence.Ng=k.iridescenceFactor??0,h.iridescence.indexOfRefraction=k.iridescenceIor??k.iridescenceIOR??1.3,h.iridescence.minimumThickness=k.iridescenceThicknessMinimum??100,h.iridescence.maximumThickness=k.iridescenceThicknessMaximum??400,k.iridescenceTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/iridescenceTexture`,k.iridescenceTexture,(s=>{s.name=`${h.name} (Iridescence)`,h.iridescence.texture=s}))),k.iridescenceThicknessTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/iridescenceThicknessTexture`,k.iridescenceThicknessTexture,(s=>{s.name=`${h.name} (Iridescence Thickness)`,h.iridescence.thicknessTexture=s}))),Promise.all(A).then((()=>{}))}}U(vs),T(vs,!0,(s=>new Ys(s)));const ns="KHR_materials_anisotropy";class Ts{constructor(s){this.name=ns,this.order=195,this._loader=s,this.enabled=this._loader.isExtensionUsed(ns)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadIridescencePropertiesAsync(A,g,h)),await Promise.all(ms)}))}async _loadIridescencePropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;h.anisotropy.isEnabled=!0,h.anisotropy.Ng=k.anisotropyStrength??0,h.anisotropy.angle=k.anisotropyRotation??0,k.anisotropyTexture&&(k.anisotropyTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${s}/anisotropyTexture`,k.anisotropyTexture,(s=>{s.name=`${h.name} (Anisotropy Intensity)`,h.anisotropy.texture=s})))),await Promise.all(A)}}U(ns),T(ns,!0,(s=>new Ts(s)));const Us="KHR_materials_emissive_strength";class qs{constructor(s){this.name=Us,this.order=170,this._loader=s,this.enabled=this._loader.isExtensionUsed(Us)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>await this._loader.loadMaterialPropertiesAsync(s,k,h).then((()=>{this._loadEmissiveProperties(A,g,h)}))))}_loadEmissiveProperties(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);void 0!==k.emissiveStrength&&(h.emissiveIntensity=k.emissiveStrength)}}U(Us),T(Us,!0,(s=>new qs(s)));const Ms="KHR_materials_sheen";class Vs{constructor(s){this.name=Ms,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ms)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadSheenPropertiesAsync(A,g,h)),await Promise.all(ms).then((()=>{}))}))}_loadSheenPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return h.sheen.isEnabled=!0,h.sheen.Ng=1,void 0!=k.sheenColorFactor?h.sheen.color=ms.Bk.uk(k.sheenColorFactor):h.sheen.color=ms.Bk.Black(),k.sheenColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/sheenColorTexture`,k.sheenColorTexture,(s=>{s.name=`${h.name} (Sheen Color)`,h.sheen.texture=s}))),void 0!==k.sheenRoughnessFactor?h.sheen.roughness=k.sheenRoughnessFactor:h.sheen.roughness=0,k.sheenRoughnessTexture&&(k.sheenRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${s}/sheenRoughnessTexture`,k.sheenRoughnessTexture,(s=>{s.name=`${h.name} (Sheen Roughness)`,h.sheen.textureRoughness=s})))),h.sheen.albedoScaling=!0,h.sheen.useRoughnessFromMainTexture=!1,Promise.all(A).then((()=>{}))}}U(Ms),T(Ms,!0,(s=>new Vs(s)));var Xs=h(13093);const Ls="KHR_materials_specular";class Zs{constructor(s){this.name=Ls,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ls)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;if(ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadSpecularPropertiesAsync(A,g,h)),g.extensions&&g.extensions.EXT_materials_specular_edge_color&&h instanceof D.c){g.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(h.brdf.dielectricSpecularModel=Xs.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,h.brdf.conductorSpecularModel=Xs.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(ms).then((()=>{}))}))}_loadSpecularPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return void 0!==k.specularFactor&&(h.metallicF0Factor=k.specularFactor),void 0!==k.specularColorFactor&&(h.metallicReflectanceColor=ms.Bk.uk(k.specularColorFactor)),k.specularTexture&&(k.specularTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${s}/specularTexture`,k.specularTexture,(s=>{s.name=`${h.name} (Specular)`,h.metallicReflectanceTexture=s,h.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),k.specularColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/specularColorTexture`,k.specularColorTexture,(s=>{s.name=`${h.name} (Specular Color)`,h.reflectanceTexture=s}))),Promise.all(A).then((()=>{}))}}U(Ls),T(Ls,!0,(s=>new Zs(s)));const xs="KHR_materials_ior";class ys{constructor(s){this.name=xs,this.order=180,this._loader=s,this.enabled=this._loader.isExtensionUsed(xs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadIorPropertiesAsync(A,g,h)),await Promise.all(ms).then((()=>{}))}))}_loadIorPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);return void 0!==k.ior?h.indexOfRefraction=k.ior:h.indexOfRefraction=ys._DEFAULT_IOR,Promise.resolve()}}ys._DEFAULT_IOR=1.5,U(xs),T(xs,!0,(s=>new ys(s)));const Ws="KHR_materials_variants";class Js{constructor(s){this.name=Ws,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ws)}dispose(){this._loader=null}static GetAvailableVariants(s){const k=this._GetExtensionMetadata(s);return k?Object.keys(k.variants):[]}getAvailableVariants(s){return Js.GetAvailableVariants(s)}static SelectVariant(s,k){const h=this._GetExtensionMetadata(s);if(!h)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Ws} extension`);const A=s=>{const k=h.variants[s];if(k)for(const h of k)h.mesh.material=h.material};if(k instanceof Array)for(const g of k)A(g);else A(k);h.lastSelected=k}selectVariant(s,k){Js.SelectVariant(s,k)}static Reset(s){const k=this._GetExtensionMetadata(s);if(!k)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Ws} extension`);for(const h of k.original)h.mesh.material=h.material;k.lastSelected=null}reset(s){Js.Reset(s)}static GetLastSelectedVariant(s){const k=this._GetExtensionMetadata(s);if(!k)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Ws} extension`);return k.lastSelected}getLastSelectedVariant(s){return Js.GetLastSelectedVariant(s)}static _GetExtensionMetadata(s){var k,h;return(null===s||void 0===s||null===(k=s._internalMetadata)||void 0===k||null===(h=k.th)||void 0===h?void 0:h[Ws])||null}onLoading(){const s=this._loader.th.extensions;if(s&&s[this.name]){const k=s[this.name];this._variants=k.variants}}onReady(){const s=this._loader.rootBabylonMesh;if(s){var k;const h=this._loader.parent.extensionOptions[Ws];null!==h&&void 0!==h&&h.defaultVariant&&Js.SelectVariant(s,h.defaultVariant),null===h||void 0===h||null===(k=h.onLoaded)||void 0===k||k.call(h,{get variants(){return Js.GetAvailableVariants(s)},get selectedVariant(){const k=Js.GetLastSelectedVariant(s);return k?Array.isArray(k)?k[0]:k:Js.GetAvailableVariants(s)[0]},set selectedVariant(k){Js.SelectVariant(s,k)}})}}_loadMeshPrimitiveAsync(s,k,h,A,g,ms){return Z.LoadExtensionAsync(s,g,this.name,(async(i,K)=>{const H=new Array;return H.push(this._loader._loadMeshPrimitiveAsync(s,k,h,A,g,(k=>{if(ms(k),k instanceof p.e){const h=Z._GetDrawMode(s,g.mode),A=this._loader.rootBabylonMesh,ms=A?A._internalMetadata=A._internalMetadata||{}:{},O=ms.th=ms.th||{},c=O[Ws]=O[Ws]||{lastSelected:null,original:[],variants:{}};c.original.push({mesh:k,material:k.material});for(let s=0;s<K.mappings.length;++s){const g=K.mappings[s],ms=X.Get(`${i}/mappings/${s}/material`,this._loader.th.materials,g.material);H.push(this._loader._loadMaterialAsync(`#/materials/${g.material}`,ms,k,h,(s=>{for(let h=0;h<g.variants.length;++h){const ms=g.variants[h],i=X.Get(`/extensions/${Ws}/variants/${ms}`,this._variants,ms);c.variants[i.name]=c.variants[i.name]||[],c.variants[i.name].push({mesh:k,material:s}),k.onClonedObservable.add((s=>{const h=s;let g=null,ms=h;do{if(ms=ms.parent,!ms)return;g=Js._GetExtensionMetadata(ms)}while(null===g);if(A&&g===Js._GetExtensionMetadata(A)){ms._internalMetadata={};for(const s in A._internalMetadata)ms._internalMetadata[s]=A._internalMetadata[s];ms._internalMetadata.th=[];for(const s in A._internalMetadata.th)ms._internalMetadata.th[s]=A._internalMetadata.th[s];ms._internalMetadata.th[Ws]={lastSelected:null,original:[],variants:{}};for(const s of g.original)ms._internalMetadata.th[Ws].original.push({mesh:s.mesh,material:s.material});for(const s in g.variants)if(Object.prototype.hasOwnProperty.call(g.variants,s)){ms._internalMetadata.th[Ws].variants[s]=[];for(const k of g.variants[s])ms._internalMetadata.th[Ws].variants[s].push({mesh:k.mesh,material:k.material})}g=ms._internalMetadata.th[Ws]}for(const A of g.original)A.mesh===k&&(A.mesh=h);for(const A of g.variants[i.name])A.mesh===k&&(A.mesh=h)}))}})))}}}))),await Promise.all(H).then((s=>{let[k]=s;return k}))}))}}U(Ws),T(Ws,!0,(s=>new Js(s)));var Fs=h(12656);class os{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Xs.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(s,k){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...os._GetDefaultOptions(),...s},this._scene=k,this._scene._transmissionHelper=this,this.onErrorObservable=new c.c,this._scene.Dh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(s){if(!Object.keys(s).filter((k=>this._options[k]!==s[k])).length)return;const k={...this._options,...s},h=this._options;this._options=k,k.renderSize===h.renderSize&&k.renderTargetTextureType===h.renderTargetTextureType&&k.generateMipmaps===h.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=k.samples,this._opaqueRenderTarget.lodGenerationScale=k.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=k.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(s){return!!s&&!!(s instanceof D.c&&s.subSurface.isRefractionEnabled)}_addMesh(s){this._materialObservers[s.uniqueId]=s.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),i.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(s.material)?(s.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(s)&&this._transparentMeshesCache.push(s)):-1===this._opaqueMeshesCache.indexOf(s)&&this._opaqueMeshesCache.push(s)}))}_removeMesh(s){s.onMaterialChangedObservable.remove(this._materialObservers[s.uniqueId]),delete this._materialObservers[s.uniqueId];let k=this._transparentMeshesCache.indexOf(s);-1!==k&&this._transparentMeshesCache.splice(k,1),k=this._opaqueMeshesCache.indexOf(s),-1!==k&&this._opaqueMeshesCache.splice(k,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(s){const k=this._transparentMeshesCache.indexOf(s),h=this._opaqueMeshesCache.indexOf(s);this._shouldRenderAsTransmission(s.material)?(s.material instanceof D.c&&(s.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==h?(this._opaqueMeshesCache.splice(h,1),this._transparentMeshesCache.push(s)):-1===k&&this._transparentMeshesCache.push(s)):-1!==k?(this._transparentMeshesCache.splice(k,1),this._opaqueMeshesCache.push(s)):-1===h&&this._opaqueMeshesCache.push(s)}_isRenderTargetValid(){var s;return null!==(null===(s=this._opaqueRenderTarget)||void 0===s?void 0:s.getInternalTexture())}_setupRenderTargets(){var s;let k;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Fs.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(s=this._options.clearColor)||void 0===s?void 0:s.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((s=>{k=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?s.clearColor.H(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(s.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=k}));for(const h of this._transparentMeshesCache)this._shouldRenderAsTransmission(h.material)&&(h.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ls="KHR_materials_transmission";class fs{constructor(s){this.name=ls,this.order=175,this._loader=s,this.enabled=this._loader.isExtensionUsed(ls),this.enabled&&(s.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadTransparentPropertiesAsync(A,k,h,g)),await Promise.all(ms).then((()=>{}))}))}_loadTransparentPropertiesAsync(s,k,h,A){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const g=h;if(g.subSurface.isRefractionEnabled=!0,g.subSurface.volumeIndexOfRefraction=1,g.subSurface.useAlbedoToTintRefraction=!0,void 0===A.transmissionFactor)return g.subSurface.refractionIntensity=0,g.subSurface.isRefractionEnabled=!1,Promise.resolve();{var ms;g.subSurface.refractionIntensity=A.transmissionFactor;const s=g.Is();if(g.subSurface.refractionIntensity&&!s._transmissionHelper)new os({},g.Is());else if(g.subSurface.refractionIntensity&&(null===(ms=s._transmissionHelper)||void 0===ms||!ms._isRenderTargetValid())){var i;null===(i=s._transmissionHelper)||void 0===i||i._setupRenderTargets()}}return g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=0,A.transmissionTexture?(A.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${s}/transmissionTexture`,A.transmissionTexture,void 0).then((s=>{s.name=`${h.name} (Transmission)`,g.subSurface.refractionIntensityTexture=s,g.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}U(ls),T(ls,!0,(s=>new fs(s)));const es="KHR_materials_diffuse_transmission";class sk{constructor(s){this.name=es,this.order=174,this._loader=s,this.enabled=this._loader.isExtensionUsed(es),this.enabled&&(s.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadTranslucentPropertiesAsync(A,k,h,g)),await Promise.all(ms).then((()=>{}))}))}_loadTranslucentPropertiesAsync(s,k,h,A){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const g=h;if(g.subSurface.isTranslucencyEnabled=!0,g.subSurface.volumeIndexOfRefraction=1,g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=0,g.subSurface.useAlbedoToTintTranslucency=!1,void 0===A.diffuseTransmissionFactor)return g.subSurface.translucencyIntensity=0,g.subSurface.isTranslucencyEnabled=!1,Promise.resolve();g.subSurface.translucencyIntensity=A.diffuseTransmissionFactor;const i=new Array;return g.subSurface.useGltfStyleTextures=!0,A.diffuseTransmissionTexture&&(A.diffuseTransmissionTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${s}/diffuseTransmissionTexture`,A.diffuseTransmissionTexture).then((s=>{s.name=`${h.name} (Diffuse Transmission)`,g.subSurface.translucencyIntensityTexture=s})))),void 0!==A.diffuseTransmissionColorFactor?g.subSurface.translucencyColor=ms.Bk.uk(A.diffuseTransmissionColorFactor):g.subSurface.translucencyColor=ms.Bk.White(),A.diffuseTransmissionColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${s}/diffuseTransmissionColorTexture`,A.diffuseTransmissionColorTexture).then((s=>{s.name=`${h.name} (Diffuse Transmission Color)`,g.subSurface.translucencyColorTexture=s}))),Promise.all(i).then((()=>{}))}}U(es),T(es,!0,(s=>new sk(s)));const kk="KHR_materials_volume";class hk{constructor(s){this.name=kk,this.order=173,this._loader=s,this.enabled=this._loader.isExtensionUsed(kk),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadVolumePropertiesAsync(A,k,h,g)),await Promise.all(ms).then((()=>{}))}))}_loadVolumePropertiesAsync(s,k,h,A){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);if(!h.subSurface.isRefractionEnabled&&!h.subSurface.isTranslucencyEnabled||!A.thicknessFactor)return Promise.resolve();h.subSurface.volumeIndexOfRefraction=h.indexOfRefraction;const g=void 0!==A.attenuationDistance?A.attenuationDistance:Number.MAX_VALUE;return h.subSurface.tintColorAtDistance=g,void 0!==A.attenuationColor&&3==A.attenuationColor.length&&h.subSurface.tintColor.cg(A.attenuationColor[0],A.attenuationColor[1],A.attenuationColor[2]),h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=A.thicknessFactor,h.subSurface.useThicknessAsDepth=!0,A.thicknessTexture?(A.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${s}/thicknessTexture`,A.thicknessTexture).then((s=>{s.name=`${h.name} (Thickness)`,h.subSurface.thicknessTexture=s,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}U(kk),T(kk,!0,(s=>new hk(s)));const Ak="KHR_materials_dispersion";class gk{constructor(s){this.name=Ak,this.order=174,this._loader=s,this.enabled=this._loader.isExtensionUsed(Ak)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadDispersionPropertiesAsync(A,k,h,g)),await Promise.all(ms).then((()=>{}))}))}_loadDispersionPropertiesAsync(s,k,h,A){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);return h.subSurface.isRefractionEnabled&&A.dispersion?(h.subSurface.isDispersionEnabled=!0,h.subSurface.dispersion=A.dispersion,Promise.resolve()):Promise.resolve()}}U(Ak),T(Ak,!0,(s=>new gk(s)));const mh="EXT_materials_diffuse_roughness";class ik{constructor(s){this.name=mh,this.order=190,this._loader=s,this.enabled=this._loader.isExtensionUsed(mh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=new Array;return ms.push(this._loader.loadMaterialPropertiesAsync(s,k,h)),ms.push(this._loadDiffuseRoughnessPropertiesAsync(A,g,h)),await Promise.all(ms).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(s,k,h){if(!(h instanceof D.c))throw new Error(`${s}: Material type not supported`);const A=new Array;return h.brdf.baseDiffuseModel=Xs.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=k.diffuseRoughnessFactor?h.baseDiffuseRoughness=k.diffuseRoughnessFactor:h.baseDiffuseRoughness=0,k.diffuseRoughnessTexture&&A.push(this._loader.loadTextureInfoAsync(`${s}/diffuseRoughnessTexture`,k.diffuseRoughnessTexture,(s=>{s.name=`${h.name} (Diffuse Roughness)`,h.baseDiffuseRoughnessTexture=s}))),Promise.all(A).then((()=>{}))}}U(mh),T(mh,!0,(s=>new ik(s)));const Kk="KHR_mesh_quantization";class Hk{constructor(s){this.name=Kk,this.enabled=s.isExtensionUsed(Kk)}dispose(){}}U(Kk),T(Kk,!0,(s=>new Hk(s)));const Ok="KHR_texture_basisu";class ck{constructor(s){this.name=Ok,this._loader=s,this.enabled=s.isExtensionUsed(Ok)}dispose(){this._loader=null}_loadTextureAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>{const ms=void 0==k.sampler?Z.DefaultSampler:X.Get(`${s}/sampler`,this._loader.th.samplers,k.sampler),i=X.Get(`${A}/source`,this._loader.th.images,g.source);return await this._loader._createTextureAsync(s,ms,i,(s=>{h(s)}),k._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!k._textureInfo.nonColorData)}))}}U(Ok),T(Ok,!0,(s=>new ck(s)));const Sk="KHR_texture_transform";class ak{constructor(s){this.name=Sk,this._loader=s,this.enabled=this._loader.isExtensionUsed(Sk)}dispose(){this._loader=null}loadTextureInfoAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(A,g)=>await this._loader.loadTextureInfoAsync(s,k,(s=>{if(!(s instanceof w.b))throw new Error(`${A}: Texture type not supported`);g.offset&&(s.uOffset=g.offset[0],s.vOffset=g.offset[1]),s.uRotationCenter=0,s.vRotationCenter=0,g.rotation&&(s.wAng=-g.rotation),g.scale&&(s.uScale=g.scale[0],s.vScale=g.scale[1]),void 0!=g.texCoord&&(s.coordinatesIndex=g.texCoord),h(s)}))))}}U(Sk),T(Sk,!0,(s=>new ak(s)));const rk="KHR_xmp_json_ld";class dk{constructor(s){this.name=rk,this.order=100,this._loader=s,this.enabled=this._loader.isExtensionUsed(rk)}dispose(){this._loader=null}onLoading(){var s,k,h;if(null===this._loader.rootBabylonMesh)return;const A=null===(s=this._loader.th.extensions)||void 0===s?void 0:s.KHR_xmp_json_ld,g=null===(k=this._loader.th.asset)||void 0===k||null===(h=k.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld;if(A&&g){const s=+g.packet;A.packets&&s<A.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=A.packets[s])}}}function Ek(s,k,h,A){return ms.Bk.uk(k,h).scale(A)}function jk(s,k,h,A){return k[h]*A}function Pk(s,k,h,A){return-k[h]*A}function Rk(s,k,h,A){return k[h+1]*A}function Dk(s,k,h,A){return k[h]*A*2}function wk(s){return{scale:[new uk(a.c.ANIMATIONTYPE_FLOAT,`${s}.uScale`,jk,(()=>2)),new uk(a.c.ANIMATIONTYPE_FLOAT,`${s}.vScale`,Rk,(()=>2))],offset:[new uk(a.c.ANIMATIONTYPE_FLOAT,`${s}.uOffset`,jk,(()=>2)),new uk(a.c.ANIMATIONTYPE_FLOAT,`${s}.vOffset`,Rk,(()=>2))],rotation:[new uk(a.c.ANIMATIONTYPE_FLOAT,`${s}.wAng`,Pk,(()=>1))]}}U(rk),T(rk,!0,(s=>new dk(s)));class Bk extends x.AnimationPropertyInfo{buildAnimations(s,k,h,A){return[{babylonAnimatable:s._babylonCamera,babylonAnimation:this._buildAnimation(k,h,A)}]}}class uk extends x.AnimationPropertyInfo{buildAnimations(s,k,h,A){const g=[];for(const ms in s._data)g.push({babylonAnimatable:s._data[ms].babylonMaterial,babylonAnimation:this._buildAnimation(k,h,A)});return g}}class Gk extends x.AnimationPropertyInfo{buildAnimations(s,k,h,A){return[{babylonAnimatable:s._babylonLight,babylonAnimation:this._buildAnimation(k,h,A)}]}}(0,q.h)("/cameras/{}/orthographic/xmag",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Pk,(()=>1)),new Bk(a.c.ANIMATIONTYPE_FLOAT,"orthoRight",Rk,(()=>1))]),(0,q.h)("/cameras/{}/orthographic/ymag",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Pk,(()=>1)),new Bk(a.c.ANIMATIONTYPE_FLOAT,"orthoTop",Rk,(()=>1))]),(0,q.h)("/cameras/{}/orthographic/zfar",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"maxZ",jk,(()=>1))]),(0,q.h)("/cameras/{}/orthographic/znear",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"Jh",jk,(()=>1))]),(0,q.h)("/cameras/{}/perspective/yfov",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"fov",jk,(()=>1))]),(0,q.h)("/cameras/{}/perspective/zfar",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"maxZ",jk,(()=>1))]),(0,q.h)("/cameras/{}/perspective/znear",[new Bk(a.c.ANIMATIONTYPE_FLOAT,"Jh",jk,(()=>1))]),(0,q.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new uk(a.c.ANIMATIONTYPE_COLOR3,"albedoColor",Ek,(()=>4)),new uk(a.c.ANIMATIONTYPE_FLOAT,"alpha",(function(s,k,h,A){return k[h+3]*A}),(()=>4))]),(0,q.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"metallic",jk,(()=>1))]),(0,q.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"roughness",jk,(()=>1))]);const Qk=wk("albedoTexture");(0,q.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Qk.scale),(0,q.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Qk.offset),(0,q.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Qk.rotation);const pk=wk("metallicTexture");(0,q.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",pk.scale),(0,q.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",pk.offset),(0,q.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",pk.rotation),(0,q.h)("/materials/{}/emissiveFactor",[new uk(a.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Ek,(()=>3))]);const Ik=wk("bumpTexture");(0,q.h)("/materials/{}/normalTexture/scale",[new uk(a.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",jk,(()=>1))]),(0,q.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Ik.scale),(0,q.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Ik.offset),(0,q.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Ik.rotation),(0,q.h)("/materials/{}/occlusionTexture/strength",[new uk(a.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",jk,(()=>1))]);const Nk=wk("ambientTexture");(0,q.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Nk.scale),(0,q.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Nk.offset),(0,q.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Nk.rotation);const bk=wk("emissiveTexture");(0,q.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",bk.scale),(0,q.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",bk.offset),(0,q.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",bk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new uk(a.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new uk(a.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",jk,(()=>1))]);const tk=wk("anisotropy.texture");(0,q.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",tk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",tk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",tk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",jk,(()=>1))]);const zk=wk("clearCoat.texture");(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",zk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",zk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",zk.rotation);const Ck=wk("clearCoat.bumpTexture");(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new uk(a.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ck.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ck.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ck.rotation);const vk=wk("clearCoat.textureRoughness");(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",vk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",vk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",vk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new uk(a.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new uk(a.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new uk(a.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new uk(a.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",jk,(()=>1))]);const Yk=wk("iridescence.texture");(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Yk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Yk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Yk.rotation);const nk=wk("iridescence.thicknessTexture");(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",nk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",nk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",nk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new uk(a.c.ANIMATIONTYPE_COLOR3,"sheen.color",Ek,(()=>3))]),(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",jk,(()=>1))]);const Tk=wk("sheen.texture");(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Tk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Tk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Tk.rotation);const Uk=wk("sheen.textureRoughness");(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Uk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Uk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Uk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new uk(a.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Ek,(()=>3))]);const qk=wk("metallicReflectanceTexture");(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",qk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",qk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",qk.rotation);const Mk=wk("reflectanceTexture");(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Mk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Mk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Mk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",jk,(()=>1))]);const Vk=wk("subSurface.refractionIntensityTexture");(0,q.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Vk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Vk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Vk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new uk(a.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Ek,(()=>3))]),(0,q.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new uk(a.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",jk,(()=>1))]),(0,q.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",jk,(()=>1))]);const Xk=wk("subSurface.thicknessTexture");(0,q.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Xk.scale),(0,q.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Xk.offset),(0,q.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Xk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new uk(a.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",jk,(()=>1))]);const Lk=wk("subSurface.translucencyIntensityTexture");(0,q.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Lk.scale),(0,q.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Lk.offset),(0,q.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Lk.rotation),(0,q.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new uk(a.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Ek,(()=>3))]);const Zk=wk("subSurface.translucencyColorTexture");(0,q.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Zk.scale),(0,q.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Zk.offset),(0,q.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Zk.rotation),(0,q.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new Gk(a.c.ANIMATIONTYPE_COLOR3,"diffuse",Ek,(()=>3))]),(0,q.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Gk(a.c.ANIMATIONTYPE_FLOAT,"intensity",jk,(()=>1))]),(0,q.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new Gk(a.c.ANIMATIONTYPE_FLOAT,"range",jk,(()=>1))]),(0,q.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Gk(a.c.ANIMATIONTYPE_FLOAT,"innerAngle",Dk,(()=>1))]),(0,q.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Gk(a.c.ANIMATIONTYPE_FLOAT,"angle",Dk,(()=>1))]),(0,q.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new Gk(a.c.ANIMATIONTYPE_COLOR3,"diffuse",Ek,(()=>3))]),(0,q.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Gk(a.c.ANIMATIONTYPE_FLOAT,"intensity",jk,(()=>1))]);const xk="KHR_animation_pointer";class yk{constructor(s){this.name=xk,this._loader=s,this._pathToObjectConverter=(0,q.d)(this._loader.th)}get enabled(){return this._loader.isExtensionUsed(xk)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(s,k,h,A,g){var ms;const i=null===(ms=A.target.extensions)||void 0===ms?void 0:ms.KHR_animation_pointer;if(!i||!this._pathToObjectConverter)return null;"pointer"!==A.target.path&&E.c.Warn(`${s}/target/path: Value (${A.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=A.target.node&&E.c.Warn(`${s}/target/node: Value (${A.target.node}) must not be present when using the ${this.name} extension`);const K=`${s}/extensions/${this.name}`,H=i.pointer;if(!H)throw new Error(`${K}: Pointer is missing`);try{const ms=this._pathToObjectConverter.convert(H);if(!ms.info.interpolation)throw new Error(`${K}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(s,k,h,A,{object:ms.object,info:ms.info.interpolation},g)}catch(O){return E.c.Warn(`${K}/pointer: Invalid pointer (${H}) skipped`),null}}}U(xk),T(xk,!0,(s=>new yk(s)));class Wk{constructor(s,k,h){this.frame=s,this.action=k,this.onlyOnce=h,this.isDone=!1}_clone(){return new Wk(this.frame,this.action,this.onlyOnce)}}var Jk=h(12438),Fk=h(12481),ok=h(12476);class lk{get loop(){return this._loop}set loop(s){s!==this._loop&&(this._loop=s,this.updateOptions({loop:s}))}get currentTime(){var s;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.audioContext&&(this.isPlaying||this.isPaused)){const s=this.isPaused?0:Fk.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+s}return 0}get spatialSound(){return this._spatialSound}set spatialSound(s){if(s==this._spatialSound)return;const k=this.isPlaying;this.pause(),s?(this._spatialSound=s,this._updateSpatialParameters()):this._disableSpatialSound(),k&&this.play()}constructor(s,k,h){var A;let ms=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new c.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=g.Pk.Zero(),this._localDirection=new g.Pk(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=s,h=h||d.b.LastCreatedScene)if(this._scene=h,lk._SceneComponentInitialization(h),this._readyToPlayCallback=ms,this._customAttenuationFunction=(s,k,h,A,g)=>k<h?s*(1-k/h):0,K&&(this.autoplay=K.autoplay||!1,this._loop=K.loop||!1,void 0!==K.volume&&(this._volume=K.volume),this._spatialSound=K.spatialSound??!1,this.maxDistance=K.maxDistance??100,this.useCustomAttenuation=K.useCustomAttenuation??!1,this.rolloffFactor=K.rolloffFactor||1,this.refDistance=K.refDistance||1,this.distanceModel=K.distanceModel||"linear",this._playbackRate=K.playbackRate||1,this._streaming=K.streaming??!1,this._length=K.length,this._offset=K.offset),null!==(A=Fk.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&Fk.e.audioEngine.audioContext){this._soundGain=Fk.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let s=!0;if(k)try{"string"===typeof k?(this._urlType="String",this._url=k):k instanceof ArrayBuffer?this._urlType="ArrayBuffer":k instanceof HTMLMediaElement?this._urlType="MediaElement":k instanceof MediaStream?this._urlType="MediaStream":k instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(k)&&(this._urlType="Array");let h=[],A=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fk.e.audioEngine.audioContext.createMediaElementSource(k),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fk.e.audioEngine.audioContext.createMediaStreamSource(k),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":k.byteLength>0&&(A=!0,this._soundLoaded(k));break;case"AudioBuffer":this._audioBufferLoaded(k);break;case"String":h.push(k);case"Array":0===h.length&&(h=k);for(let s=0;s<h.length;s++){const k=h[s];if(A=K&&K.skipCodecCheck||-1!==k.indexOf(".mp3",k.length-4)&&Fk.e.audioEngine.isMP3supported||-1!==k.indexOf(".ogg",k.length-4)&&Fk.e.audioEngine.isOGGsupported||-1!==k.indexOf(".wav",k.length-4)||-1!==k.indexOf(".m4a",k.length-4)||-1!==k.indexOf(".mp4",k.length-4)||-1!==k.indexOf("blob:"),A){this._streaming?(this._htmlAudioElement=new Audio(k),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,i.Tools.SetCorsBehavior(k,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(k,(s=>{this._soundLoaded(s)}),void 0,!0,!0,(s=>{s&&E.c.Error("XHR "+s.status+" error on: "+k+"."),E.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:s=!1}s?A||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(H){E.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Fk.e.audioEngine&&!Fk.e.audioEngine.WarnedWebAudioUnsupported&&(E.c.Error("Web Audio is not supported by your browser."),Fk.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var s;null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(s){var k;null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.audioContext&&(this._audioBuffer=s,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(s){var k;null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.audioContext&&Fk.e.audioEngine.audioContext.decodeAudioData(s,(s=>{this._audioBufferLoaded(s)}),(s=>{E.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+s)}))}setAudioBuffer(s){var k;null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&(this._audioBuffer=s,this._isReadyToPlay=!0)}updateOptions(s){s&&(this.loop=s.loop??this.loop,this.maxDistance=s.maxDistance??this.maxDistance,this.useCustomAttenuation=s.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=s.rolloffFactor??this.rolloffFactor,this.refDistance=s.refDistance??this.refDistance,this.distanceModel=s.distanceModel??this.distanceModel,this._playbackRate=s.playbackRate??this._playbackRate,this._length=s.length??void 0,this.spatialSound=s.spatialSound??this._spatialSound,this._setOffset(s.offset??void 0),this.setVolume(s.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var s;null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&Fk.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Fk.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var s;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(s=this._soundPanner)||void 0===s||s.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var s;null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(s){var k;null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(s),this._isOutputConnected=!0)}setDirectionalCone(s,k,h){k<s?E.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=s,this._coneOuterAngle=k,this._coneOuterGain=h,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(s){if(s!=this._coneInnerAngle){var k;if(this._coneOuterAngle<s)return void E.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=s,null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(s){if(s!=this._coneOuterAngle){var k;if(s<this._coneInnerAngle)return void E.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=s,null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(s){var k;s.equals(this._position)||(this._position.H(s),null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(s){var k;this._localDirection=s,null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const s=this._connectedTransformNode.getWorldMatrix(),k=g.Pk.TransformNormal(this._localDirection,s);k.normalize(),this._soundPanner.orientationX.value=k.x,this._soundPanner.orientationY.value=k.y,this._soundPanner.orientationZ.value=k.z}updateDistanceFromListener(){var s;if(null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const s=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Rk(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,s,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(s){this._customAttenuationFunction=s}play(s,k,h){var A;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(A=Fk.e.audioEngine)&&void 0!==A&&A.audioContext)try{var g,ms;this._clearTimeoutsAndObservers();let A=s?(null===(g=Fk.e.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+s:null===(ms=Fk.e.audioEngine)||void 0===ms?void 0:ms.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Fk.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const s=()=>{var h;if(null!==(h=Fk.e.audioEngine)&&void 0!==h&&h.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=k??0;const h=this._htmlAudioElement.play();void 0!==h&&h.catch((()=>{var k,h;(null===(k=Fk.e.audioEngine)||void 0===k||k.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(h=Fk.e.audioEngine)||void 0===h?void 0:h.onAudioUnlockedObservable.addOnce((()=>{s()})))}))}else{var A;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(A=Fk.e.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{s()}))}};s()}}else{var i;const g=()=>{var g;if(null!==(g=Fk.e.audioEngine)&&void 0!==g&&g.audioContext){var ms;if(h=h||this._length,void 0!==k&&this._setOffset(k),this._soundSource){const s=this._soundSource;s.onended=()=>{s.disconnect()}}if(this._soundSource=null===(ms=Fk.e.audioEngine)||void 0===ms?void 0:ms.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var i;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==k&&(this._soundSource.loopStart=k),void 0!==h&&(this._soundSource.loopEnd=(0|k)+h),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},A=s?(null===(i=Fk.e.audioEngine)||void 0===i?void 0:i.audioContext.currentTime)+s:Fk.e.audioEngine.audioContext.currentTime;const g=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(A,g,this.loop?void 0:h)}}};"suspended"===(null===(i=Fk.e.audioEngine)||void 0===i?void 0:i.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var s;"suspended"===(null===(s=Fk.e.audioEngine)||void 0===s?void 0:s.audioContext.state)?(Fk.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Fk.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{g()})))):g()}),500):g()}this._startTime=A,this.isPlaying=!0,this.isPaused=!1}catch(K){E.c.Error("Error while trying to play audio: "+this.name+", "+K.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(s){var k;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1}else if(null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.audioContext&&this._soundSource){const k=s?Fk.e.audioEngine.audioContext.currentTime+s:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(k)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var s;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var k;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(k=this._streamingSource)||void 0===k||k.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Fk.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(s,k){var h;null!==(h=Fk.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._soundGain&&(k&&Fk.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Fk.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Fk.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(s,Fk.e.audioEngine.audioContext.currentTime+k)):this._soundGain.gain.value=s),this._volume=s}setPlaybackRate(s){this._playbackRate=s,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(s){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=s,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=s=>this._onRegisterAfterWorldMatrixUpdate(s),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(s){var k;if(s.getBoundingInfo){const k=s.getBoundingInfo();this.setPosition(k.boundingSphere.centerWorld)}else this.setPosition(s.absolutePosition);null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const s=()=>{(0,ok.e)((()=>this._isReadyToPlay),(()=>{h._audioBuffer=this.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,this._offset,this._length)}),void 0,300)},k={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},h=new lk(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,k);return this.useCustomAttenuation&&h.setAttenuationFunction(this._customAttenuationFunction),h.setPosition(this._position),h.setPlaybackRate(this._playbackRate),s(),h}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const s={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(s.connectedMeshId=this._connectedTransformNode.id),s.position=this._position.yh(),s.refDistance=this.refDistance,s.distanceModel=this.distanceModel,s.isDirectional=this._isDirectional,s.localDirectionToMesh=this._localDirection.yh(),s.coneInnerAngle=this._coneInnerAngle,s.coneOuterAngle=this._coneOuterAngle,s.coneOuterGain=this._coneOuterGain),s}static Parse(s,k,h,A){const ms=s.name;let i;i=s.url?h+s.url:h+ms;const K={autoplay:s.autoplay,loop:s.loop,volume:s.volume,spatialSound:s.spatialSound,maxDistance:s.maxDistance,rolloffFactor:s.rolloffFactor,refDistance:s.refDistance,distanceModel:s.distanceModel,playbackRate:s.playbackRate};let H;if(A){const s=()=>{(0,ok.e)((()=>A._isReadyToPlay),(()=>{H._audioBuffer=A.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,H._offset,H._length)}),void 0,300)};H=new lk(ms,new ArrayBuffer(0),k,null,K),s()}else H=new lk(ms,i,k,(()=>{k.removePendingData(H)}),K),k.addPendingData(H);if(s.position){const k=g.Pk.uk(s.position);H.setPosition(k)}if(s.isDirectional&&(H.setDirectionalCone(s.coneInnerAngle||360,s.coneOuterAngle||360,s.coneOuterGain||0),s.localDirectionToMesh)){const k=g.Pk.uk(s.localDirectionToMesh);H.setLocalDirectionToMesh(k)}if(s.connectedMeshId){const h=k.getMeshById(s.connectedMeshId);h&&H.attachToMesh(h)}return s.metadata&&(H.metadata=s.metadata),H}_setOffset(s){this._offset!==s&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=s)}_clearTimeoutsAndObservers(){var s;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(s=Fk.e.audioEngine)||void 0===s||s.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}lk._SceneComponentInitialization=s=>{throw(0,Jk.b)("AudioSceneComponent")},(0,us.f)("BABYLON.Sound",lk);class fk{constructor(s,k,h){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],k.length!==h.length)throw new Error("Sounds length does not equal weights length");this.loop=s,this._weights=h;let A=0;for(const ms of h)A+=ms;const g=A>0?1/A:0;for(let ms=0;ms<this._weights.length;ms++)this._weights[ms]*=g;this._sounds=k;for(const ms of this._sounds)ms.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(s){if(s!==this._coneInnerAngle){if(this._coneOuterAngle<s)return void E.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=s;for(const k of this._sounds)k.directionalConeInnerAngle=s}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(s){if(s!==this._coneOuterAngle){if(s<this._coneInnerAngle)return void E.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=s;for(const k of this._sounds)k.directionalConeOuterAngle=s}}get volume(){return this._volume}set volume(s){if(s!==this._volume)for(const k of this._sounds)k.setVolume(s)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(s){if(!this.isPaused){this.stop();const s=Math.random();let k=0;for(let h=0;h<this._weights.length;h++)if(k+=this._weights[h],s<=k){this._currentIndex=h;break}}const k=this._sounds[this._currentIndex??0];k.isReady()?k.play(0,this.isPaused?void 0:s):k.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class ek{constructor(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(s=s||d.b.LastCreatedScene)&&(this._scene=s,this.soundCollection=[],this._options=k,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var s;null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio&&Fk.e.audioEngine.audioContext&&(this._outputAudioNode=Fk.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Fk.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Fk.e.audioEngine&&Fk.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(s){var k;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&s.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==s.soundTrackId&&(-1===s.soundTrackId?this._scene.mainSoundTrack.removeSound(s):this._scene.soundTracks&&this._scene.soundTracks[s.soundTrackId].removeSound(s)),this.soundCollection.push(s),s.soundTrackId=this.id}removeSound(s){const k=this.soundCollection.indexOf(s);-1!==k&&this.soundCollection.splice(k,1)}setVolume(s){var k;null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=s)}switchPanningModelToHRTF(){var s;if(null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio)for(let k=0;k<this.soundCollection.length;k++)this.soundCollection[k].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var s;if(null!==(s=Fk.e.audioEngine)&&void 0!==s&&s.canUseWebAudio)for(let k=0;k<this.soundCollection.length;k++)this.soundCollection[k].switchPanningModelToEqualPower()}connectToAnalyser(s){var k;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=s,null!==(k=Fk.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Fk.e.audioEngine.masterGain))}}var sh=h(12869),kh=h(12836),hh=h(12416);Fk.e.AudioEngineFactory=(s,k,h)=>new Ah(s,k,h);class Ah{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new c.c,this.onAudioLockedObservable=new c.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,hh.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const A=document.createElement("audio");this._hostElement=s,this._audioContext=k,this._audioDestination=h;try{A&&A.canPlayType&&(A.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||A.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(g){}try{A&&A.canPlayType&&A.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(g){}}lock(){this._triggerSuspendedState()}unlock(){var s,k;if("running"===(null===(s=this._audioContext)||void 0===s?void 0:s.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(k=this._audioContext)||void 0===k||k.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var s;null===(s=this._audioContext)||void 0===s||s.addEventListener("statechange",(()=>{var s;this.unlocked&&"running"!==(null===(s=this._audioContext)||void 0===s?void 0:s.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var s;return null!==(s=this._audioContext)&&void 0!==s&&s.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(s){this.canUseWebAudio=!1,E.c.Error("Web Audio: "+s.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(s){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const s=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",k=document.createElement("style");k.appendChild(document.createTextNode(s)),document.getElementsByTagName("head")[0].appendChild(k),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var s;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(s=this._audioContext)||void 0===s||s.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(s){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=s)}connectToAnalyser(s){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=s,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var gh=h(12435);(0,h(13976).e)(sh.e.NAME_AUDIO,((s,k,h,A)=>{let g,ms=[];if(h.zr=h.zr||[],void 0!==s.zr&&null!==s.zr)for(let K=0,H=s.zr.length;K<H;K++){var i;const H=s.zr[K];null!==(i=Fk.e.audioEngine)&&void 0!==i&&i.canUseWebAudio?(H.url||(H.url=H.name),ms[H.url]?h.zr.push(lk.Parse(H,k,A,ms[H.url])):(g=lk.Parse(H,k,A),ms[H.url]=g,h.zr.push(g))):h.zr.push(new lk(H.name,null,k))}ms=[]})),Object.defineProperty(kh.d.prototype,"mainSoundTrack",{get:function(){let s=this._getComponent(sh.e.NAME_AUDIO);return s||(s=new mA(this),this.o(s)),this._mainSoundTrack||(this._mainSoundTrack=new ek(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),kh.d.prototype.getSoundByName=function(s){let k;for(k=0;k<this.mainSoundTrack.soundCollection.length;k++)if(this.mainSoundTrack.soundCollection[k].name===s)return this.mainSoundTrack.soundCollection[k];if(this.soundTracks)for(let h=0;h<this.soundTracks.length;h++)for(k=0;k<this.soundTracks[h].soundCollection.length;k++)if(this.soundTracks[h].soundCollection[k].name===s)return this.soundTracks[h].soundCollection[k];return null},Object.defineProperty(kh.d.prototype,"audioEnabled",{get:function(){let s=this._getComponent(sh.e.NAME_AUDIO);return s||(s=new mA(this),this.o(s)),s.audioEnabled},set:function(s){let k=this._getComponent(sh.e.NAME_AUDIO);k||(k=new mA(this),this.o(k)),s?k.enableAudio():k.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(kh.d.prototype,"headphone",{get:function(){let s=this._getComponent(sh.e.NAME_AUDIO);return s||(s=new mA(this),this.o(s)),s.headphone},set:function(s){let k=this._getComponent(sh.e.NAME_AUDIO);k||(k=new mA(this),this.o(k)),s?k.switchAudioModeForHeadphones():k.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(kh.d.prototype,"audioListenerPositionProvider",{get:function(){let s=this._getComponent(sh.e.NAME_AUDIO);return s||(s=new mA(this),this.o(s)),s.audioListenerPositionProvider},set:function(s){let k=this._getComponent(sh.e.NAME_AUDIO);if(k||(k=new mA(this),this.o(k)),s&&"function"!==typeof s)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");k.audioListenerPositionProvider=s},enumerable:!0,configurable:!0}),Object.defineProperty(kh.d.prototype,"audioListenerRotationProvider",{get:function(){let s=this._getComponent(sh.e.NAME_AUDIO);return s||(s=new mA(this),this.o(s)),s.audioListenerRotationProvider},set:function(s){let k=this._getComponent(sh.e.NAME_AUDIO);if(k||(k=new mA(this),this.o(k)),s&&"function"!==typeof s)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");k.audioListenerRotationProvider=s},enumerable:!0,configurable:!0}),Object.defineProperty(kh.d.prototype,"audioPositioningRefreshRate",{get:function(){let s=this._getComponent(sh.e.NAME_AUDIO);return s||(s=new mA(this),this.o(s)),s.audioPositioningRefreshRate},set:function(s){let k=this._getComponent(sh.e.NAME_AUDIO);k||(k=new mA(this),this.o(k)),k.audioPositioningRefreshRate=s},enumerable:!0,configurable:!0});class mA{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(s){this.name=sh.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new g.Pk,this._cachedCameraPosition=new g.Pk,this._lastCheck=0,this._invertMatrixTemp=new g.Matrix,this._cameraDirectionTemp=new g.Pk,(s=s||d.b.LastCreatedScene)&&(this.Dk=s,s.soundTracks=[],s.zr=[])}register(){this.Dk._afterRenderStage.registerStep(sh.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(s){if(s.zr=[],this.Dk.soundTracks)for(let k=0;k<this.Dk.soundTracks.length;k++){const h=this.Dk.soundTracks[k];for(let k=0;k<h.soundCollection.length;k++)s.zr.push(h.soundCollection[k].serialize())}}addFromContainer(s){if(s.zr)for(const k of s.zr)k.play(),k.autoplay=!0,this.Dk.mainSoundTrack.addSound(k)}removeFromContainer(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s.zr)for(const h of s.zr)h.stop(),h.autoplay=!1,this.Dk.mainSoundTrack.removeSound(h),k&&h.dispose()}dispose(){const s=this.Dk;if(s._mainSoundTrack&&s.mainSoundTrack.dispose(),s.soundTracks)for(let k=0;k<s.soundTracks.length;k++)s.soundTracks[k].dispose()}disableAudio(){const s=this.Dk;let k;for(this._audioEnabled=!1,Fk.e.audioEngine&&Fk.e.audioEngine.audioContext&&Fk.e.audioEngine.audioContext.suspend(),k=0;k<s.mainSoundTrack.soundCollection.length;k++)s.mainSoundTrack.soundCollection[k].pause();if(s.soundTracks)for(k=0;k<s.soundTracks.length;k++)for(let h=0;h<s.soundTracks[k].soundCollection.length;h++)s.soundTracks[k].soundCollection[h].pause()}enableAudio(){const s=this.Dk;let k;for(this._audioEnabled=!0,Fk.e.audioEngine&&Fk.e.audioEngine.audioContext&&Fk.e.audioEngine.audioContext.resume(),k=0;k<s.mainSoundTrack.soundCollection.length;k++)s.mainSoundTrack.soundCollection[k].isPaused&&s.mainSoundTrack.soundCollection[k].play();if(s.soundTracks)for(k=0;k<s.soundTracks.length;k++)for(let h=0;h<s.soundTracks[k].soundCollection.length;h++)s.soundTracks[k].soundCollection[h].isPaused&&s.soundTracks[k].soundCollection[h].play()}switchAudioModeForHeadphones(){const s=this.Dk;if(this._headphone=!0,s.mainSoundTrack.switchPanningModelToHRTF(),s.soundTracks)for(let k=0;k<s.soundTracks.length;k++)s.soundTracks[k].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const s=this.Dk;if(this._headphone=!1,s.mainSoundTrack.switchPanningModelToEqualPower(),s.soundTracks)for(let k=0;k<s.soundTracks.length;k++)s.soundTracks[k].switchPanningModelToEqualPower()}_afterRender(){const s=gh.e.Now;if(this._lastCheck&&s-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=s;const k=this.Dk;if(!this._audioEnabled||!k._mainSoundTrack||!k.soundTracks||0===k._mainSoundTrack.soundCollection.length&&1===k.soundTracks.length)return;const h=Fk.e.audioEngine;if(h&&h.audioContext){let s,A=k.activeCamera;if(k.activeCameras&&k.activeCameras.length>0&&(A=k.activeCameras[0]),this.audioListenerPositionProvider){const s=this.audioListenerPositionProvider();h.audioContext.listener.setPosition(s.x||0,s.y||0,s.z||0)}else A?this._cachedCameraPosition.equals(A.globalPosition)||(this._cachedCameraPosition.H(A.globalPosition),h.audioContext.listener.setPosition(A.globalPosition.x,A.globalPosition.y,A.globalPosition.z)):h.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const s=this.audioListenerRotationProvider();h.audioContext.listener.setOrientation(s.x||0,s.y||0,s.z||0,0,1,0)}else A?(A.rigCameras&&A.rigCameras.length>0&&(A=A.rigCameras[0]),A.getViewMatrix().invertToRef(this._invertMatrixTemp),g.Pk.TransformNormalToRef(mA._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.H(this._cameraDirectionTemp),h.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):h.audioContext.listener.setOrientation(0,0,0,0,1,0);for(s=0;s<k.mainSoundTrack.soundCollection.length;s++){const h=k.mainSoundTrack.soundCollection[s];h.useCustomAttenuation&&h.updateDistanceFromListener()}if(k.soundTracks)for(s=0;s<k.soundTracks.length;s++)for(let h=0;h<k.soundTracks[s].soundCollection.length;h++){const A=k.soundTracks[s].soundCollection[h];A.useCustomAttenuation&&A.updateDistanceFromListener()}}}}mA._CameraDirection=new g.Pk(0,0,-1),lk._SceneComponentInitialization=s=>{let k=s._getComponent(sh.e.NAME_AUDIO);k||(k=new mA(s),s.o(k))};const ih="MSFT_audio_emitter";class Kh{constructor(s){this.name=ih,this._loader=s,this.enabled=this._loader.isExtensionUsed(ih)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const s=this._loader.th.extensions;if(s&&s[this.name]){const k=s[this.name];this._clips=k.clips,this._emitters=k.emitters,X.Assign(this._clips),X.Assign(this._emitters)}}loadSceneAsync(s,k){return Z.LoadExtensionAsync(s,k,this.name,(async(h,A)=>{const g=new Array;g.push(this._loader.loadSceneAsync(s,k));for(const s of A.emitters){const k=X.Get(`${h}/emitters`,this._emitters,s);if(void 0!=k.refDistance||void 0!=k.maxDistance||void 0!=k.rolloffFactor||void 0!=k.distanceModel||void 0!=k.innerAngle||void 0!=k.outerAngle)throw new Error(`${h}: Direction or Distance properties are not allowed on emitters attached to a scene`);g.push(this._loadEmitterAsync(`${h}/emitters/${k.index}`,k))}await Promise.all(g)}))}loadNodeAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(s,A)=>{const ms=new Array,K=await this._loader.loadNodeAsync(s,k,(k=>{for(const h of A.emitters){const A=X.Get(`${s}/emitters`,this._emitters,h);ms.push(this._loadEmitterAsync(`${s}/emitters/${A.index}`,A).then((()=>{for(const s of A._babylonSounds)s.attachToMesh(k),void 0==A.innerAngle&&void 0==A.outerAngle||(s.setLocalDirectionToMesh(g.Pk.Forward()),s.setDirectionalCone(2*i.Tools.ToDegrees(void 0==A.innerAngle?Math.PI:A.innerAngle),2*i.Tools.ToDegrees(void 0==A.outerAngle?Math.PI:A.outerAngle),0))})))}h(k)}));return await Promise.all(ms),K}))}loadAnimationAsync(s,k){return Z.LoadExtensionAsync(s,k,this.name,(async(h,A)=>{const g=await this._loader.loadAnimationAsync(s,k),ms=new Array;X.Assign(A.events);for(const i of A.events)ms.push(this._loadAnimationEventAsync(`${h}/events/${i.index}`,s,k,i,g));return await Promise.all(ms),g}))}_loadClipAsync(s,k){if(k._objectURL)return k._objectURL;let h;if(k.uri)h=this._loader.loadUriAsync(s,k,k.uri);else{const A=X.Get(`${s}/bufferView`,this._loader.th.bufferViews,k.bufferView);h=this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return k._objectURL=h.then((s=>URL.createObjectURL(new Blob([s],{type:k.mimeType})))),k._objectURL}_loadEmitterAsync(s,k){if(k._babylonSounds=k._babylonSounds||[],!k._babylonData){const s=new Array,h=k.name||`emitter${k.index}`,A={loop:!1,autoplay:!1,volume:void 0==k.volume?1:k.volume};for(let ms=0;ms<k.clips.length;ms++){const g=`/extensions/${this.name}/clips`,i=X.Get(g,this._clips,k.clips[ms].clip);s.push(this._loadClipAsync(`${g}/${k.clips[ms].clip}`,i).then((s=>{const g=k._babylonSounds[ms]=new lk(h,s,this._loader.babylonScene,null,A);g.refDistance=k.refDistance||1,g.maxDistance=k.maxDistance||256,g.rolloffFactor=k.rolloffFactor||1,g.distanceModel=k.distanceModel||"exponential"})))}const g=Promise.all(s).then((()=>{const s=k.clips.map((s=>s.weight||1)),h=new fk(k.loop||!1,k._babylonSounds,s);k.innerAngle&&(h.directionalConeInnerAngle=2*i.Tools.ToDegrees(k.innerAngle)),k.outerAngle&&(h.directionalConeOuterAngle=2*i.Tools.ToDegrees(k.outerAngle)),k.volume&&(h.volume=k.volume),k._babylonData.sound=h}));k._babylonData={loaded:g}}return k._babylonData.loaded}_getEventAction(s,k,h,A,g){switch(h){case"play":return s=>{const h=(g||0)+(s-A);k.play(h)};case"stop":return()=>{k.stop()};case"pause":return()=>{k.pause()};default:throw new Error(`${s}: Unsupported action ${h}`)}}_loadAnimationEventAsync(s,k,h,A,g){if(0==g.targetedAnimations.length)return Promise.resolve();const ms=g.targetedAnimations[0],i=A.ik,K=X.Get(`/extensions/${this.name}/emitters`,this._emitters,i);return this._loadEmitterAsync(s,K).then((()=>{const k=K._babylonData.sound;if(k){const h=new Wk(A.time,this._getEventAction(s,k,A.action,A.time,A.startOffset));ms.animation.addEvent(h),g.onAnimationGroupEndObservable.add((()=>{k.stop()})),g.onAnimationGroupPauseObservable.add((()=>{k.pause()}))}}))}}U(ih),T(ih,!0,(s=>new Kh(s)));const Hh="MSFT_lod";class Oh{constructor(s){var k;this.name=Hh,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new c.c,this.onMaterialLODsLoadedObservable=new c.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=s,this.maxLODsToLoad=(null===(k=this._loader.parent.extensionOptions[Hh])||void 0===k?void 0:k.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let s=0;s<this._nodePromiseLODs.length;s++){const k=Promise.all(this._nodePromiseLODs[s]).then((()=>{0!==s&&(this._loader.endPerformanceCounter(`Node LOD ${s}`),this._loader.log(`Loaded node LOD ${s}`)),this.onNodeLODsLoadedObservable.notifyObservers(s),s!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${s+1}`),this._loadBufferLOD(this._nodeBufferLODs,s+1),this._nodeSignalLODs[s]&&this._nodeSignalLODs[s].resolve())}));this._loader._completePromises.push(k)}for(let s=0;s<this._materialPromiseLODs.length;s++){const k=Promise.all(this._materialPromiseLODs[s]).then((()=>{0!==s&&(this._loader.endPerformanceCounter(`Material LOD ${s}`),this._loader.log(`Loaded material LOD ${s}`)),this.onMaterialLODsLoadedObservable.notifyObservers(s),s!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${s+1}`),this._loadBufferLOD(this._materialBufferLODs,s+1),this._materialSignalLODs[s]&&this._materialSignalLODs[s].resolve())}));this._loader._completePromises.push(k)}}loadSceneAsync(s,k){const h=this._loader.loadSceneAsync(s,k);return this._loadBufferLOD(this._bufferLODs,0),h}loadNodeAsync(s,k,h){return Z.LoadExtensionAsync(s,k,this.name,(async(s,g)=>{let ms;const i=this._getLODs(s,k,this._loader.th.nodes,g.ids);this._loader.logOpen(`${s}`);for(let k=0;k<i.length;k++){const s=i[k];0!==k&&(this._nodeIndexLOD=k,this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new A);const g=s=>{h(s),s.hH(!1)},K=this._loader.loadNodeAsync(`/nodes/${s.index}`,s,g).then((s=>{if(0!==k){const s=i[k-1];s._babylonTransformNode&&(this._disposeTransformNode(s._babylonTransformNode),delete s._babylonTransformNode)}return s.hH(!0),s}));this._nodePromiseLODs[k]=this._nodePromiseLODs[k]||[],0===k?ms=K:(this._nodeIndexLOD=null,this._nodePromiseLODs[k].push(K))}return this._loader.logClose(),await ms}))}_loadMaterialAsync(s,k,h,A,g){return this._nodeIndexLOD?null:Z.LoadExtensionAsync(s,k,this.name,(async(s,ms)=>{let i;const K=this._getLODs(s,k,this._loader.th.materials,ms.ids);this._loader.logOpen(`${s}`);for(let k=0;k<K.length;k++){const s=K[k];0!==k&&(this._materialIndexLOD=k);const ms=this._loader._loadMaterialAsync(`/materials/${s.index}`,s,h,A,(s=>{0===k&&g(s)})).then((s=>{if(0!==k){g(s);const h=K[k-1]._data;h[A]&&(this._disposeMaterials([h[A].babylonMaterial]),delete h[A])}return s}));this._materialPromiseLODs[k]=this._materialPromiseLODs[k]||[],0===k?i=ms:(this._materialIndexLOD=null,this._materialPromiseLODs[k].push(ms))}return this._loader.logClose(),await i}))}_loadUriAsync(s,k,h){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const g=this._nodeIndexLOD-1;return this._nodeSignalLODs[g]=this._nodeSignalLODs[g]||new A,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(s,k,h)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const g=this._materialIndexLOD-1;return this._materialSignalLODs[g]=this._materialSignalLODs[g]||new A,this._materialSignalLODs[g].promise.then((async()=>await this._loader.loadUriAsync(s,k,h)))}return null}loadBufferAsync(s,k,h,g){if(this._loader.parent.useRangeRequests&&!k.uri){if(!this._loader.bin)throw new Error(`${s}: Uri is missing or the binary glTF is missing its binary chunk`);const k=async(s,k)=>{const ms=h,i=ms+g-1;let K=s[k];return K?(K.start=Math.min(K.start,ms),K.end=Math.max(K.end,i)):(K={start:ms,end:i,loaded:new A},s[k]=K),await K.loaded.promise.then((s=>new Uint8Array(s.buffer,s.byteOffset+h-K.start,g)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?k(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?k(this._materialBufferLODs,this._materialIndexLOD):k(this._bufferLODs,0)}return null}_loadBufferLOD(s,k){const h=s[k];h&&(this._loader.log(`Loading buffer range [${h.start}-${h.end}]`),this._loader.bin.readAsync(h.start,h.end-h.start+1).then((s=>{h.loaded.resolve(s)}),(s=>{h.loaded.reject(s)})))}_getLODs(s,k,h,A){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const g=[];for(let ms=A.length-1;ms>=0;ms--)if(g.push(X.Get(`${s}/ids/${A[ms]}`,h,A[ms])),g.length===this.maxLODsToLoad)return g;return g.push(k),g}_disposeTransformNode(s){const k=[],h=s.material;h&&k.push(h);for(const g of s.getChildMeshes())g.material&&k.push(g.material);s.dispose();const A=k.filter((s=>this._loader.babylonScene.meshes.every((k=>k.material!=s))));this._disposeMaterials(A)}_disposeMaterials(s){const k={};for(const h of s){for(const s of h.getActiveTextures())k[s.uniqueId]=s;h.dispose()}for(const h in k)for(const s of this._loader.babylonScene.materials)s.hasTexture(k[h])&&delete k[h];for(const h in k)k[h].dispose()}}U(Hh),T(Hh,!0,(s=>new Oh(s)));const ch="MSFT_minecraftMesh";class Sh{constructor(s){this.name=ch,this._loader=s,this.enabled=this._loader.isExtensionUsed(ch)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtraAsync(s,k,this.name,(async(A,g)=>{if(g){if(!(h instanceof D.c))throw new Error(`${A}: Material type not supported`);const g=this._loader.loadMaterialPropertiesAsync(s,k,h);return h.needAlphaBlending()&&(h.forceDepthWrite=!0,h.separateCullingPass=!0),h.Hg=h.forceDepthWrite,h.twoSidedLighting=!0,await g}}))}}U(ch),T(ch,!0,(s=>new Sh(s)));const ah="MSFT_sRGBFactors";class rh{constructor(s){this.name=ah,this._loader=s,this.enabled=this._loader.isExtensionUsed(ah)}dispose(){this._loader=null}loadMaterialPropertiesAsync(s,k,h){return Z.LoadExtraAsync(s,k,this.name,(async(A,g)=>{if(g){if(!(h instanceof D.c))throw new Error(`${A}: Material type not supported`);const g=this._loader.loadMaterialPropertiesAsync(s,k,h),ms=h.Is().getEngine().useExactSrgbConversions;return h.albedoTexture||h.albedoColor.toLinearSpaceToRef(h.albedoColor,ms),h.reflectivityTexture||h.reflectivityColor.toLinearSpaceToRef(h.reflectivityColor,ms),await g}}))}}U(ah),T(ah,!0,(s=>new rh(s)));var dh=h(14298);const Eh={};var jh=h(14340),Ph=h(14322),Rh=h(14307),Dh=h(14315);function wh(s,k){for(const h of s)for(const s of h.dataOutputs)if(s.uniqueId===k)return s;throw new Error("Could not find data out connection with unique id "+k)}function Bh(s,k){for(const h of s)if(h instanceof Ph.b)for(const s of h.signalInputs)if(s.uniqueId===k)return s;throw new Error("Could not find signal in connection with unique id "+k)}async function uh(s,k){const A=await Promise.all(s.allBlocks.map((async s=>{const k=function(s){switch(s){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([h.e(78),h.e(79)]).then(h.bind(h,15803))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await h.e(80).then(h.bind(h,15805))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await h.e(81).then(h.bind(h,15807))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await h.e(82).then(h.bind(h,15813))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await h.e(83).then(h.bind(h,15821))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await h.e(84).then(h.bind(h,15829))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await h.e(85).then(h.bind(h,15838))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await h.e(86).then(h.bind(h,15841))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await h.e(87).then(h.bind(h,15846))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await h.e(90).then(h.bind(h,15887))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await h.e(90).then(h.bind(h,15887))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await h.e(90).then(h.bind(h,15887))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await h.e(90).then(h.bind(h,15887))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await h.e(95).then(h.bind(h,15894))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await h.e(96).then(h.bind(h,15901))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await h.e(97).then(h.bind(h,15906))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await h.e(98).then(h.bind(h,15911))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await h.e(99).then(h.bind(h,15914))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await h.e(100).then(h.bind(h,15917))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await h.e(101).then(h.bind(h,15923))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await h.e(102).then(h.bind(h,15931))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await h.e(103).then(h.bind(h,15936))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await h.e(104).then(h.bind(h,15944))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await h.e(105).then(h.bind(h,15948))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await h.e(106).then(h.bind(h,15956))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await h.e(107).then(h.bind(h,15959))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await h.e(108).then(h.bind(h,15963))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await h.e(109).then(h.bind(h,15966))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await h.e(110).then(h.bind(h,15975))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await h.e(111).then(h.bind(h,15980))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await h.e(112).then(h.bind(h,15984))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await h.e(113).then(h.bind(h,15993))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await h.e(92).then(h.bind(h,15997))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await h.e(114).then(h.bind(h,16004))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await h.e(115).then(h.bind(h,16012))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await h.e(116).then(h.bind(h,16014))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await h.e(93).then(h.bind(h,16023))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await h.e(88).then(h.bind(h,15854))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await h.e(94).then(h.bind(h,16029))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await h.e(89).then(h.bind(h,15879))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await h.e(90).then(h.bind(h,15887))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await h.e(90).then(h.bind(h,15887))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await h.e(91).then(h.bind(h,16034))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await h.e(91).then(h.bind(h,16034))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await h.e(91).then(h.bind(h,16034))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await h.e(91).then(h.bind(h,16034))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await h.e(91).then(h.bind(h,16034))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await h.e(91).then(h.bind(h,16034))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await h.e(117).then(h.bind(h,16038))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await h.e(118).then(h.bind(h,16042))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await h.e(119).then(h.bind(h,16044))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await h.e(120).then(h.bind(h,16046))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await h.e(121).then(h.bind(h,16051))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await h.e(122).then(h.bind(h,16056))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await h.e(123).then(h.bind(h,16061))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await h.e(124).then(h.bind(h,16070))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await h.e(125).then(h.bind(h,16075))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await h.e(126).then(h.bind(h,16078))).FlowGraphDataSwitchBlock;default:if(Eh[s])return Eh[s];throw new Error(`Unknown block name ${s}`)}}(s.className);return await k()})));return function(s,k,h){const A=k.coordinator.createGraph(),g=[],ms=k.valueParseFunction??Rh.b;for(let i=0;i<s.allBlocks.length;i++){const K=Qh(s.allBlocks[i],{Dk:k.coordinator.config.Dk,pathConverter:k.pathConverter,assetsContainer:k.coordinator.config.Dk,valueParseFunction:ms},h[i]);g.push(K),K instanceof jh.e&&A.addEventBlock(K)}for(const i of g){for(const s of i.dataInputs)for(const k of s.connectedPointIds){const h=wh(g,k);s.connectTo(h)}if(i instanceof Ph.b)for(const s of i.signalOutputs)for(const k of s.connectedPointIds){const h=Bh(g,k);s.connectTo(h)}}for(const i of s.executionContexts)Gh(i,{graph:A,valueParseFunction:ms},s.rightHanded);return A}(s,k,A)}function Gh(s,k,h){const A=k.graph.createContext();s.enableLogging&&(A.enableLogging=!0),A.treatDataAsRightHanded=h||!1;const g=k.valueParseFunction??Rh.b;A.uniqueId=s.uniqueId;const ms=A.Is();if(s._assetsContext){var i,K,H,O,c,S,a,r,d,E;const k=s._assetsContext,h={meshes:null===(i=k.meshes)||void 0===i?void 0:i.map((s=>ms.getMeshById(s))),lights:null===(K=k.lights)||void 0===K?void 0:K.map((s=>ms.getLightByName(s))),cameras:null===(H=k.cameras)||void 0===H?void 0:H.map((s=>ms.getCameraByName(s))),materials:null===(O=k.materials)||void 0===O?void 0:O.map((s=>ms.getMaterialById(s))),textures:null===(c=k.textures)||void 0===c?void 0:c.map((s=>ms.getTextureByName(s))),animations:null===(S=k.animations)||void 0===S?void 0:S.map((s=>ms.animations.find((k=>k.name===s)))),skeletons:null===(a=k.skeletons)||void 0===a?void 0:a.map((s=>ms.getSkeletonByName(s))),la:null===(r=k.la)||void 0===r?void 0:r.map((s=>ms.getParticleSystemById(s))),animationGroups:null===(d=k.animationGroups)||void 0===d?void 0:d.map((s=>ms.getAnimationGroupByName(s))),transformNodes:null===(E=k.transformNodes)||void 0===E?void 0:E.map((s=>ms.getTransformNodeById(s))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],zr:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};A.assetsContext=h}for(const j in s._userVariables){const k=g(j,s._userVariables,A.assetsContext,ms);A.userVariables[j]=k}for(const j in s._connectionValues){const k=g(j,s._connectionValues,A.assetsContext,ms);A._setConnectionValueByKey(j,k)}return A}function Qh(s,k,h){const A={},g=k.valueParseFunction??Rh.b;if(s.config)for(const i in s.config)A[i]=g(i,s.config,k.assetsContainer||k.Dk,k.Dk);if((0,Rh.g)(s.className)){if(!k.pathConverter)throw new Error("Path converter is required for this block");A.pathConverter=k.pathConverter}const ms=new h(A);ms.uniqueId=s.uniqueId;for(let i=0;i<s.dataInputs.length;i++){const k=ms.getDataInput(s.dataInputs[i].name);if(!k)throw new Error("Could not find data input with name "+s.dataInputs[i].name+" in block "+s.className);k.deserialize(s.dataInputs[i])}for(let i=0;i<s.dataOutputs.length;i++){const k=ms.getDataOutput(s.dataOutputs[i].name);if(!k)throw new Error("Could not find data output with name "+s.dataOutputs[i].name+" in block "+s.className);k.deserialize(s.dataOutputs[i])}return ms.metadata=s.metadata,ms.deserialize&&ms.deserialize(s),ms}function ph(s){const[k,h]=s.split(":");return Ih({op:k,extension:h})}function Ih(s){var k;let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=s.extension?null===(k=bh[s.extension])||void 0===k?void 0:k[s.op]:th[s.op];if(!A&&(E.c.Warn(`No mapping found for operation ${s.op} and extension ${s.extension||"KHR_interactivity"}`),h)){const k={},h={flows:{}};if(s.inputValueSockets){k.values={};for(const h in s.inputValueSockets)k.values[h]={name:h}}return s.outputValueSockets&&(h.values={},Object.keys(s.outputValueSockets).forEach((s=>{h.values[s]={name:s}}))),{jS:[],inputs:k,outputs:h}}return A}function Nh(s,k,h){bh[k]||(bh[k]={}),bh[k][s]=h}const bh={BABYLON:{"flow/log":{jS:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},th={"event/onStart":{jS:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{jS:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{jS:["FlowGraphSendCustomEventBlock"],extraProcessor(s,k,h,A,g){if("event/send"!==k.op||!s.configuration||1!==Object.keys(s.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const ms=s.configuration.event.value[0];if("number"!==typeof ms)throw new Error("Event id should be a number");const i=A.arrays.events[ms],K=g[0];return K.config||(K.config={}),K.config.eventId=i.eventId,K.config.eventData=i.eventData,g}},"event/receive":{jS:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(s,k){var h;if(!s.configuration)return E.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const A=s.configuration.event;if(!A)return E.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const g=A.value[0];if("number"!==typeof g)return E.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(h=k.events)||void 0===h?void 0:h[g])?{valid:!0}:(E.c.Error(`Event with id ${g} not found`),{valid:!1,error:`Event with id ${g} not found`})},extraProcessor(s,k,h,A,g){if("event/receive"!==k.op||!s.configuration||1!==Object.keys(s.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const ms=s.configuration.event.value[0];if("number"!==typeof ms)throw new Error("Event id should be a number");const i=A.arrays.events[ms],K=g[0];return K.config||(K.config={}),K.config.eventId=i.eventId,K.config.eventData=i.eventData,g}},"math/e":zh("FlowGraphEBlock"),"math/pi":zh("FlowGraphPIBlock"),"math/inf":zh("FlowGraphInfBlock"),"math/nan":zh("FlowGraphNaNBlock"),"math/abs":zh("FlowGraphAbsBlock"),"math/sign":zh("FlowGraphSignBlock"),"math/trunc":zh("FlowGraphTruncBlock"),"math/floor":zh("FlowGraphFloorBlock"),"math/ceil":zh("FlowGraphCeilBlock"),"math/round":{jS:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g){var ms;return(ms=g[0]).config||(ms.config={}),g[0].config.roundHalfAwayFromZero=!0,g}},"math/fract":zh("FlowGraphFractBlock"),"math/neg":zh("FlowGraphNegationBlock"),"math/add":zh("FlowGraphAddBlock",["a","b"],!0),"math/sub":zh("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{jS:["FlowGraphMultiplyBlock"],extraProcessor(s,k,h,A,g){var ms;(ms=g[0]).config||(ms.config={}),g[0].config.useMatrixPerComponent=!0,g[0].config.preventIntegerFloatArithmetic=!0;let i=-1;return Object.keys(s.values||{}).find((k=>{var h;return void 0!==(null===(h=s.values)||void 0===h?void 0:h[k].type)&&(i=s.values[k].type,!0)})),-1!==i&&(g[0].config.type=A.arrays.types[i].flowGraphType),g},validation:s=>s.values?Ch(s):{valid:!0}},"math/div":zh("FlowGraphDivideBlock",["a","b"],!0),"math/rem":zh("FlowGraphModuloBlock",["a","b"]),"math/min":zh("FlowGraphMinBlock",["a","b"]),"math/max":zh("FlowGraphMaxBlock",["a","b"]),"math/clamp":zh("FlowGraphClampBlock",["a","b","c"]),"math/saturate":zh("FlowGraphSaturateBlock"),"math/mix":zh("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":zh("FlowGraphEqualityBlock",["a","b"]),"math/lt":zh("FlowGraphLessThanBlock",["a","b"]),"math/le":zh("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":zh("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":zh("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":zh("FlowGraphIsNaNBlock"),"math/isinf":zh("FlowGraphIsInfBlock"),"math/select":{jS:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{jS:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":zh("FlowGraphSinBlock"),"math/cos":zh("FlowGraphCosBlock"),"math/tan":zh("FlowGraphTanBlock"),"math/asin":zh("FlowGraphASinBlock"),"math/acos":zh("FlowGraphACosBlock"),"math/atan":zh("FlowGraphATanBlock"),"math/atan2":zh("FlowGraphATan2Block",["a","b"]),"math/sinh":zh("FlowGraphSinhBlock"),"math/cosh":zh("FlowGraphCoshBlock"),"math/tanh":zh("FlowGraphTanhBlock"),"math/asinh":zh("FlowGraphASinhBlock"),"math/acosh":zh("FlowGraphACoshBlock"),"math/atanh":zh("FlowGraphATanhBlock"),"math/exp":zh("FlowGraphExponentialBlock"),"math/log":zh("FlowGraphLogBlock"),"math/log2":zh("FlowGraphLog2Block"),"math/log10":zh("FlowGraphLog10Block"),"math/sqrt":zh("FlowGraphSquareRootBlock"),"math/cbrt":zh("FlowGraphCubeRootBlock"),"math/pow":zh("FlowGraphPowerBlock",["a","b"]),"math/length":zh("FlowGraphLengthBlock"),"math/normalize":zh("FlowGraphNormalizeBlock"),"math/dot":zh("FlowGraphDotBlock",["a","b"]),"math/cross":zh("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":zh("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":zh("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{jS:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{jS:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{jS:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{jS:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{jS:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{jS:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{jS:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":zh("FlowGraphTransposeBlock"),"math/determinant":zh("FlowGraphDeterminantBlock"),"math/inverse":zh("FlowGraphInvertMatrixBlock"),"math/matmul":zh("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{jS:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Sg",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g,ms){const i=g[0].dataInputs.find((s=>"rotationQuaternion"===s.name));if(!i)throw new Error("Rotation quaternion input not found");return ms._connectionValues[i.uniqueId]&&(ms._connectionValues[i.uniqueId].type="Quaternion"),g}},"math/matDecompose":{jS:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Sg"}}}},"math/quatConjugate":zh("FlowGraphConjugateBlock",["a"]),"math/quatMul":{jS:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g){var ms;return(ms=g[0]).config||(ms.config={}),g[0].config.type="Quaternion",g}},"math/quatAngleBetween":zh("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{jS:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":zh("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":zh("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{jS:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g){var ms;return(ms=g[0]).config||(ms.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract2x2":{jS:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{jS:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g){var ms;return(ms=g[0]).config||(ms.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract3x3":{jS:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{jS:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g){var ms;return(ms=g[0]).config||(ms.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract4x4":{jS:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{jS:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g,ms){var i,K;(K=g[0]).config||(K.config={});const H=g[0].dataInputs[0];return g[0].config.valueType=(null===(i=ms._connectionValues[H.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",g}},"math/and":{jS:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g,ms){var i,K,H;(H=g[0]).config||(H.config={});const O=g[0].dataInputs[0],c=g[0].dataInputs[1];return g[0].config.valueType=(null===(i=ms._connectionValues[O.uniqueId])||void 0===i?void 0:i.type)??(null===(K=ms._connectionValues[c.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",g}},"math/or":{jS:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g,ms){var i,K,H;(H=g[0]).config||(H.config={});const O=g[0].dataInputs[0],c=g[0].dataInputs[1];return g[0].config.valueType=(null===(i=ms._connectionValues[O.uniqueId])||void 0===i?void 0:i.type)??(null===(K=ms._connectionValues[c.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",g}},"math/xor":{jS:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(s,k,h,A,g,ms){var i,K,H;(H=g[0]).config||(H.config={});const O=g[0].dataInputs[0],c=g[0].dataInputs[1];return g[0].config.valueType=(null===(i=ms._connectionValues[O.uniqueId])||void 0===i?void 0:i.type)??(null===(K=ms._connectionValues[c.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",g}},"math/asr":zh("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":zh("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":zh("FlowGraphLeadingZerosBlock"),"math/ctz":zh("FlowGraphTrailingZerosBlock"),"math/popcnt":zh("FlowGraphOneBitsCounterBlock"),"math/rad":zh("FlowGraphDegToRadBlock"),"math/deg":zh("FlowGraphRadToDegBlock"),"type/boolToInt":zh("FlowGraphBooleanToInt"),"type/boolToFloat":zh("FlowGraphBooleanToFloat"),"type/intToBool":zh("FlowGraphIntToBoolean"),"type/intToFloat":zh("FlowGraphIntToFloat"),"type/floatToInt":zh("FlowGraphFloatToInt"),"type/floatToBool":zh("FlowGraphFloatToBoolean"),"flow/sequence":{jS:["FlowGraphSequenceBlock"],extraProcessor(s,k,h,A,g){const ms=g[0];return ms.config||(ms.config={}),ms.config.outputSignalCount=Object.keys(s.flows||[]).length,ms.signalOutputs.forEach(((s,k)=>{s.name="out_"+k})),g}},"flow/branch":{jS:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{jS:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(s){if(s.configuration&&s.configuration.cases){const k=s.configuration.cases.value;if(!k.every((s=>"number"===typeof s&&/^-?\d+$/.test(s.toString()))))return E.c.Warn("Switch cases should be integers. Using empty array instead."),s.configuration.cases.value=[],{valid:!0};const h=new Set(k);s.configuration.cases.value=Array.from(h)}return{valid:!0}},extraProcessor(s,k,h,A,g){if("flow/switch"!==k.op||!s.flows||0===Object.keys(s.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return g[0].signalOutputs.forEach((s=>{"default"!==s.name&&(s.name="out_"+s.name)})),g}},"flow/while":{jS:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{jS:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(s,k,h,A,g){const ms=g[0];return ms.config||(ms.config={}),ms.config.incrementIndexWhenLoopDone=!0,g}},"flow/doN":{jS:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{jS:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(s,k,h,A,g){if("flow/multiGate"!==k.op||!s.flows||0===Object.keys(s.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const ms=g[0];return ms.config||(ms.config={}),ms.config.outputSignalCount=Object.keys(s.flows).length,ms.signalOutputs.forEach(((s,k)=>{s.name="out_"+k})),g}},"flow/waitAll":{jS:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(s){var k,h;return"number"!==typeof(null===(k=s.configuration)||void 0===k||null===(h=k.inputFlows)||void 0===h?void 0:h.value[0])&&(s.configuration=s.configuration||{inputFlows:{value:[0]}},s.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{jS:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{jS:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{jS:["FlowGraphCancelDelayBlock"]},"variable/get":{jS:["FlowGraphGetVariableBlock"],validation(s){var k,h;return null!==(k=s.configuration)&&void 0!==k&&null!==(h=k.variable)&&void 0!==h&&h.value?{valid:!0}:(E.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(s,k)=>[k.getVariableName(s[0])]}}},"variable/set":{jS:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(s,k)=>[k.getVariableName(s[0])]}}},"variable/setMultiple":{jS:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(s,k)=>[s[0].map((s=>k.getVariableName(s)))]}},extraProcessor:(s,k,h,A,g)=>(g[0].dataInputs.forEach((s=>{s.name=A.getVariableName(+s.name)})),g)},"variable/interpolate":{jS:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(s,k)=>[k.getVariableName(s[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:s=>!0===s[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Mh:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Mh:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Mh:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Mh:"FlowGraphPlayAnimationBlock"},out:{name:"out",Mh:"FlowGraphPlayAnimationBlock"},done:{name:"done",Mh:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(s,k,h,A,g){var ms,i,K;const H=g[0],O=null===(ms=s.configuration)||void 0===ms?void 0:ms.variable.value[0];if("number"!==typeof O)throw E.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const c=A.arrays.staticVariables[O];"undefined"===typeof H.config.animationType.value&&(A.arrays.staticVariables,H.config.animationType.value=(0,Dh.B)(c.type));const S=g[4];return S.config||(S.config={}),(i=S.config).variable||(i.variable={}),S.config.variable.value=A.getVariableName(O),(K=g[3]).config||(K.config={}),g}},"pointer/get":{jS:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Mh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Mh:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(s,k,h,A,g)=>(g.forEach((s=>{"FlowGraphJsonPointerParserBlock"===s.className&&(s.config||(s.config={}),s.config.outputValue=!0)})),g)},"pointer/set":{jS:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Mh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Mh:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(s,k,h,A,g)=>(g.forEach((s=>{"FlowGraphJsonPointerParserBlock"===s.className&&(s.config||(s.config={}),s.config.outputValue=!0)})),g)},"pointer/interpolate":{jS:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Mh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Mh:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Mh:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Mh:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Mh:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Mh:"FlowGraphPlayAnimationBlock"},out:{name:"out",Mh:"FlowGraphPlayAnimationBlock"},done:{name:"done",Mh:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(s,k,h,A,g)=>(g.forEach((k=>{"FlowGraphJsonPointerParserBlock"===k.className?(k.config||(k.config={}),k.config.outputValue=!0):"FlowGraphInterpolationBlock"===k.className&&(k.config||(k.config={}),Object.keys(s.values||[]).forEach((h=>{var g;const ms=null===(g=s.values)||void 0===g?void 0:g[h];if("value"===h&&ms){const s=ms.type;void 0!==s&&(k.config.animationType=A.arrays.types[s].flowGraphType)}})))})),g)},"animation/start":{jS:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Mh:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(s,k)=>[s[0]*k._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(s,k)=>[s[0]*k._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(s,k,h,A,g,ms,i){const K=g[g.length-1];return K.config||(K.config={}),K.config.glTF=i,g}},"animation/stop":{jS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Mh:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(s,k,h,A,g,ms,i){const K=g[g.length-1];return K.config||(K.config={}),K.config.glTF=i,g}},"animation/stopAt":{jS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Mh:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(s,k)=>[s[0]*k._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(s,k,h,A,g,ms,i){const K=g[g.length-1];return K.config||(K.config={}),K.config.glTF=i,g}},"math/switch":{jS:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(s){if(s.configuration&&s.configuration.cases){const k=s.configuration.cases.value;if(!k.every((s=>"number"===typeof s&&/^-?\d+$/.test(s.toString()))))return E.c.Warn("Switch cases should be integers. Using empty array instead."),s.configuration.cases.value=[],{valid:!0};const h=new Set(k);s.configuration.cases.value=Array.from(h)}return{valid:!0}},extraProcessor(s,k,h,A,g){const ms=g[0];return ms.dataInputs.forEach((s=>{"default"!==s.name&&"case"!==s.name&&(s.name="in_"+s.name)})),ms.config||(ms.config={}),ms.config.treatCasesAsIntegers=!0,g}},"debug/log":{jS:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function zh(s){let k=arguments.length>2?arguments[2]:void 0;return{jS:[s],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((s,k)=>(s[k]={name:k},s)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(s,h,A,g,ms){var i;if(k){(i=ms[0]).config||(i.config={}),ms[0].config.preventIntegerFloatArithmetic=!0;let k=-1;Object.keys(s.values||{}).find((h=>{var A;return void 0!==(null===(A=s.values)||void 0===A?void 0:A[h].type)&&(k=s.values[h].type,!0)})),-1!==k&&(ms[0].config.type=g.arrays.types[k].flowGraphType)}return ms},validation:s=>k?Ch(s):{valid:!0}}}function Ch(s){if(s.values){const k=Object.keys(s.values).map((k=>s.values[k].type)).filter((s=>void 0!==s));if(!k.every((s=>s===k[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}th["math/compose"]=th["math/matCompose"],th["math/decompose"]=th["math/matDecompose"];var vh=h(12552);const Yh={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Pk",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class nh{constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=s,this._gltf=k,this._animationTargetFps=h,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const s of this._interactivityGraph.types)this._types.push(Yh[s.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const s of this._interactivityGraph.declarations){const k=Ih(s);if(!k)throw E.c.Error(["No mapping found for declaration",s]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:k,fullOperationName:s.extension?s.op+":"+s.extension:s.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const s of this._interactivityGraph.variables){const k=this._parseVariable(s);this._staticVariables.push(k)}}_parseVariable(s,k){const h=this._types[s.type];if(!h)throw E.c.Error(["No type found for variable",s]),new Error("Error parsing variables");if(s.value&&s.value.length!==h.length)throw E.c.Error(["Invalid value length for variable",s,h]),new Error("Error parsing variables");const A=s.value||[];if(!A.length)switch(h.flowGraphType){case"boolean":A.push(!1);break;case"FlowGraphInteger":A.push(0);break;case"number":A.push(NaN);break;case"Vector2":A.push(NaN,NaN);break;case"Pk":A.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":A.fill(NaN,0,4);break;case"Matrix":A.fill(NaN,0,16);break;case"Matrix3D":A.fill(NaN,0,9)}return"number"===h.elementType&&"string"===typeof A[0]&&(A[0]=parseFloat(A[0])),{type:h.flowGraphType,value:k?k(A,this):A}}_parseEvents(){if(this._interactivityGraph.events)for(const s of this._interactivityGraph.events){const k={eventId:s.id||"internalEvent_"+this._internalEventsCounter++};s.values&&(k.eventData=Object.keys(s.values).map((k=>{var h;const A=null===(h=s.values)||void 0===h?void 0:h[k];if(!A)throw E.c.Error(["No value found for event key",k]),new Error("Error parsing events");const g=this._types[A.type];if(!g)throw E.c.Error(["No type found for event value",A]),new Error("Error parsing events");const ms="undefined"!==typeof A.value?this._parseVariable(A):void 0;return{id:k,type:g.flowGraphType,eventData:!0,value:ms}}))),this._events.push(k)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const k of this._interactivityGraph.nodes){if("number"!==typeof k.declaration)throw E.c.Error(["No declaration found for node",k]),new Error("Error parsing nodes");const h=this._mappings[k.declaration];if(!h)throw E.c.Error(["No mapping found for node",k]),new Error("Error parsing nodes");if(h.flowGraphMapping.validation){const A=h.flowGraphMapping.validation(k,this._interactivityGraph,this._gltf);var s;if(!A.valid)throw new Error(`Error validating interactivity node ${null===(s=this._interactivityGraph.declarations)||void 0===s?void 0:s[k.declaration].op} - ${A.error}`)}const A=[];for(const s of h.flowGraphMapping.jS){const g=this._getEmptyBlock(s,h.fullOperationName);this._parseNodeConfiguration(k,g,h.flowGraphMapping,s),A.push(g)}this._nodes.push({jS:A,fullOperationName:h.fullOperationName})}}_getEmptyBlock(s,k){return{uniqueId:(0,vh.d)(),className:s,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:k,metadata:{}}}_parseNodeConfiguration(s,k,h,A){const g=k.config;if(s.configuration){const k=Object.keys(s.configuration);for(const K of k){var ms,i;const k=null===(ms=s.configuration)||void 0===ms?void 0:ms[K];if(!k)throw E.c.Error(["No value found for node configuration",K]),new Error("Error parsing node configuration");const H=null===(i=h.configuration)||void 0===i?void 0:i[K];if(H&&H.Mh?H.Mh===A:0===h.jS.indexOf(A)){const s=(null===H||void 0===H?void 0:H.name)||K;k&&"undefined"!==typeof k.value||"undefined"===typeof(null===H||void 0===H?void 0:H.defaultValue)?k.value.length>=0?g[s]={value:1===k.value.length?k.value[0]:k.value}:E.c.Warn(["Invalid value for node configuration",k]):g[s]={value:H.defaultValue},H&&H.dataTransformer&&(g[s].value=H.dataTransformer([g[s].value],this)[0])}}}}_parseNodeConnections(s){for(let u=0;u<this._nodes.length;u++){var k;const G=null===(k=this._interactivityGraph.nodes)||void 0===k?void 0:k[u];if(!G)throw E.c.Error(["No node found for interactivity node",this._nodes[u]]),new Error("Error parsing node connections");const Q=this._nodes[u],p=this._mappings[G.declaration];if(!p)throw E.c.Error(["No mapping found for node",G]),new Error("Error parsing node connections");const I=G.flows||{},N=Object.keys(I).sort();for(const s of N){var h,A,g,ms;const k=I[s],O=null===(h=p.flowGraphMapping.outputs)||void 0===h||null===(A=h.flows)||void 0===A?void 0:A[s],c=(null===O||void 0===O?void 0:O.name)||s,S=this._createNewSocketConnection(c,!0);(O&&O.Mh&&Q.jS.find((s=>s.className===O.Mh))||Q.jS[0]).signalOutputs.push(S);const a=k.node,r=this._nodes[a];if(!r)throw E.c.Error(["No node found for input node id",a]),new Error("Error parsing node connections");const d=ph(r.fullOperationName);if(!d)throw E.c.Error(["No mapping found for input node",r]),new Error("Error parsing node connections");let j=null===(g=d.inputs)||void 0===g||null===(ms=g.flows)||void 0===ms?void 0:ms[k.socket||"in"],P=!1;if(!j)for(const s in null===(i=d.inputs)||void 0===i?void 0:i.flows){var i,K,H;if(s.startsWith("[")&&s.endsWith("]"))P=!0,j=null===(K=d.inputs)||void 0===K||null===(H=K.flows)||void 0===H?void 0:H[s]}const R=j?P?j.name.replace("$1",k.socket||""):j.name:k.socket||"in",D=j&&j.Mh&&r.jS.find((s=>s.className===j.Mh))||r.jS[0];let w=D.signalInputs.find((s=>s.name===R));w||(w=this._createNewSocketConnection(R),D.signalInputs.push(w)),w.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(w.uniqueId)}const b=G.values||{},t=Object.keys(b);for(const k of t){var O,c;const h=b[k];let A=null===(O=p.flowGraphMapping.inputs)||void 0===O||null===(c=O.values)||void 0===c?void 0:c[k],g=!1;if(!A)for(const s in null===(S=p.flowGraphMapping.inputs)||void 0===S?void 0:S.values){var S,a,r;if(s.startsWith("[")&&s.endsWith("]"))g=!0,A=null===(a=p.flowGraphMapping.inputs)||void 0===a||null===(r=a.values)||void 0===r?void 0:r[s]}const ms=A?g?A.name.replace("$1",k):A.name:k,i=this._createNewSocketConnection(ms);if((A&&A.Mh&&Q.jS.find((s=>s.className===A.Mh))||Q.jS[0]).dataInputs.push(i),void 0!==h.value){const k=this._parseVariable(h,A&&A.dataTransformer);s._connectionValues[i.uniqueId]=k}else{if("undefined"===typeof h.node)throw E.c.Error(["Invalid value for value connection",h]),new Error("Error parsing node connections");{var d,j,P;const s=h.node,k=h.socket||"value",A=this._nodes[s];if(!A)throw E.c.Error(["No node found for output socket reference",h]),new Error("Error parsing node connections");const g=ph(A.fullOperationName);if(!g)throw E.c.Error(["No mapping found for output socket reference",h]),new Error("Error parsing node connections");let ms=null===(d=g.outputs)||void 0===d||null===(j=d.values)||void 0===j?void 0:j[k],K=!1;if(!ms)for(const h in null===(R=g.outputs)||void 0===R?void 0:R.values){var R,D,w;if(h.startsWith("[")&&h.endsWith("]"))K=!0,ms=null===(D=g.outputs)||void 0===D||null===(w=D.values)||void 0===w?void 0:w[h]}const H=ms?K?ms.name.replace("$1",k):null===(P=ms)||void 0===P?void 0:P.name:k,O=ms&&ms.Mh&&A.jS.find((s=>s.className===ms.Mh))||A.jS[0];let c=O.dataOutputs.find((s=>s.name===H));c||(c=this._createNewSocketConnection(H,!0),O.dataOutputs.push(c)),i.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(i.uniqueId)}}}if(p.flowGraphMapping.interBlockConnectors)for(const s of p.flowGraphMapping.interBlockConnectors){const k=s.input,h=s.output,A=s.isVariable;this._connectFlowGraphNodes(k,h,Q.jS[s.inputBlockIndex],Q.jS[s.outputBlockIndex],A)}if(p.flowGraphMapping.extraProcessor){var B;const k=null===(B=this._interactivityGraph.declarations)||void 0===B?void 0:B[G.declaration];if(!k)throw E.c.Error(["No declaration found for extra processor",G]),new Error("Error parsing node connections");Q.jS=p.flowGraphMapping.extraProcessor(G,k,p.flowGraphMapping,this,Q.jS,s,this._gltf)}}}_createNewSocketConnection(s,k){return{uniqueId:(0,vh.d)(),name:s,_connectionType:k?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(s,k,h,A,g){const ms=g?h.dataInputs:h.signalInputs,i=g?A.dataOutputs:A.signalOutputs,K=ms.find((k=>k.name===s))||this._createNewSocketConnection(s),H=i.find((s=>s.name===k))||this._createNewSocketConnection(k,!0);ms.find((k=>k.name===s))||ms.push(K),i.find((s=>s.name===k))||i.push(H),K.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(K.uniqueId)}getVariableName(s){return"staticVariable_"+s}serializeToFlowGraph(){const s={uniqueId:(0,vh.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(s);for(let k=0;k<this._staticVariables.length;k++){const h=this._staticVariables[k];s._userVariables[this.getVariableName(k)]=h}return{rightHanded:!0,allBlocks:this._nodes.reduce(((s,k)=>s.concat(k.jS)),[]),executionContexts:[s]}}}const Th="KHR_interactivity";class Uh{constructor(s){this._loader=s,this.name=Th,this.enabled=this._loader.isExtensionUsed(Th),this._pathConverter=(0,q.d)(this._loader.th),s._skipStartAnimationStep=!0;const k=s.babylonScene;k&&function(s){(0,q.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!s.activeCamera)return new g.Quaternion(NaN,NaN,NaN,NaN);const k=g.Quaternion.FromRotationMatrix(s.activeCamera.getWorldMatrix()).normalize();return s.useRightHandedSystem||(k.w*=-1,k.x*=-1),k},type:"Quaternion",getTarget:()=>s.activeCamera}),(0,q.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!s.activeCamera)return new g.Pk(NaN,NaN,NaN);const k=s.activeCamera.getWorldMatrix().getTranslation();return s.useRightHandedSystem||(k.x*=-1),k},type:"Pk",getTarget:()=>s.activeCamera}),(0,q.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:s=>{var k;return(null===(k=s._babylonAnimationGroup)||void 0===k?void 0:k.isPlaying)??!1},type:"boolean",getTarget:s=>s._babylonAnimationGroup}),(0,q.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:s=>{var k;return((null===(k=s._babylonAnimationGroup)||void 0===k?void 0:k.from)??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup}),(0,q.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:s=>{var k;return((null===(k=s._babylonAnimationGroup)||void 0===k?void 0:k.to)??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup}),(0,q.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:s=>{var k;return((null===(k=s._babylonAnimationGroup)||void 0===k?void 0:k.getCurrentFrame())??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup}),(0,q.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:s=>{var k;return((null===(k=s._babylonAnimationGroup)||void 0===k?void 0:k.getCurrentFrame())??0)/60},type:"number",getTarget:s=>s._babylonAnimationGroup})}(k)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var s;if(!this._loader.babylonScene||!this._pathConverter)return;const k=this._loader.babylonScene,h=null===(s=this._loader.th.extensions)||void 0===s?void 0:s.KHR_interactivity;if(!h)return;const A=new dh.e({Dk:k});A.dispatchEventsSynchronously=!1;const g=h.graphs.map((s=>new nh(s,this._loader.th,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(g.map((async s=>await uh(s,{coordinator:A,pathConverter:this._pathConverter})))),A.start()}}var qh;qh=async()=>(await Promise.resolve().then(h.bind(h,14357))).FlowGraphGLTFDataProvider,Eh[`${Th}/${"FlowGraphGLTFDataProvider"}`]=qh,U(Th),T(Th,!0,(s=>new Uh(s)));const Mh="KHR_node_visibility";(0,q.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:s=>{const k=s._babylonTransformNode;return!k||void 0===k.isVisible||k.isVisible},set:(s,k)=>{var h,A;null===(h=k._primitiveBabylonMeshes)||void 0===h||h.forEach((s=>{s.inheritVisibility=!0})),k._babylonTransformNode&&(k._babylonTransformNode.isVisible=s),null===(A=k._primitiveBabylonMeshes)||void 0===A||A.forEach((k=>{k.isVisible=s}))},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Vh{constructor(s){this.name=Mh,this._loader=s,this.enabled=s.isExtensionUsed(Mh)}async onReady(){var s;null===(s=this._loader.th.nodes)||void 0===s||s.forEach((s=>{var k,h,A,g;(null===(k=s._primitiveBabylonMeshes)||void 0===k||k.forEach((s=>{s.inheritVisibility=!0})),null!==(h=s.extensions)&&void 0!==h&&h.KHR_node_visibility)&&(!1===(null===(A=s.extensions)||void 0===A?void 0:A.KHR_node_visibility.visible)&&(s._babylonTransformNode&&(s._babylonTransformNode.isVisible=!1),null===(g=s._primitiveBabylonMeshes)||void 0===g||g.forEach((s=>{s.isVisible=!1}))))}))}dispose(){this._loader=null}}U(Mh),T(Mh,!0,(s=>new Vh(s)));const Xh="KHR_node_selectability";Nh("event/onSelect",Xh,{jS:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Mh:"FlowGraphGetVariableBlock",dataTransformer:s=>["pickedMesh_"+s[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Mh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(s,k,h,A,g,ms,i){var K,H,O,c,S,a;const r=g[g.length-1];r.config=r.config||{},r.config.glTF=i;const d=null===(K=s.configuration)||void 0===K||null===(H=K.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+d;return g[1].config.variable=E,ms._userVariables[E]={className:"Mesh",id:null===i||void 0===i||null===(O=i.nodes)||void 0===O||null===(c=O[d]._babylonTransformNode)||void 0===c?void 0:c.id,uniqueId:null===i||void 0===i||null===(S=i.nodes)||void 0===S||null===(a=S[d]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},g}}),(0,q.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:s=>{const k=s._babylonTransformNode;return!k||void 0===k.oH||k.oH},set:(s,k)=>{var h;null===(h=k._primitiveBabylonMeshes)||void 0===h||h.forEach((k=>{k.oH=s}))},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"oH"],type:"boolean"});class Lh{constructor(s){this.name=Xh,this._loader=s,this.enabled=s.isExtensionUsed(Xh)}async onReady(){var s;null===(s=this._loader.th.nodes)||void 0===s||s.forEach((s=>{var k,h,A;null!==(k=s.extensions)&&void 0!==k&&k.KHR_node_selectability&&!1===(null===(h=s.extensions)||void 0===h?void 0:h.KHR_node_selectability.selectable)&&(null===(A=s._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((s=>{s.oH=!1})))}))}dispose(){this._loader=null}}U(Xh),T(Xh,!0,(s=>new Lh(s)));const Zh="KHR_node_hoverability",xh="targetMeshPointerOver_";Nh("event/onHoverIn",Zh,{jS:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Mh:"FlowGraphGetVariableBlock",dataTransformer:s=>[xh+s[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Mh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(s,k,h,A,g,ms,i){var K,H,O,c,S,a;const r=g[g.length-1];r.config=r.config||{},r.config.glTF=i;const d=null===(K=s.configuration)||void 0===K||null===(H=K.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const E=xh+d;return g[1].config.variable=E,ms._userVariables[E]={className:"Mesh",id:null===i||void 0===i||null===(O=i.nodes)||void 0===O||null===(c=O[d]._babylonTransformNode)||void 0===c?void 0:c.id,uniqueId:null===i||void 0===i||null===(S=i.nodes)||void 0===S||null===(a=S[d]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},g}});const yh="targetMeshPointerOut_";Nh("event/onHoverOut",Zh,{jS:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Mh:"FlowGraphGetVariableBlock",dataTransformer:s=>[yh+s[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Mh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(s,k,h,A,g,ms,i){var K,H,O,c,S,a;const r=g[g.length-1];r.config=r.config||{},r.config.glTF=i;const d=null===(K=s.configuration)||void 0===K||null===(H=K.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const E=yh+d;return g[1].config.variable=E,ms._userVariables[E]={className:"Mesh",id:null===i||void 0===i||null===(O=i.nodes)||void 0===O||null===(c=O[d]._babylonTransformNode)||void 0===c?void 0:c.id,uniqueId:null===i||void 0===i||null===(S=i.nodes)||void 0===S||null===(a=S[d]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},g}}),(0,q.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:s=>{const k=s._babylonTransformNode;return!k||void 0===k.pointerOverDisableMeshTesting||k.pointerOverDisableMeshTesting},set:(s,k)=>{var h;null===(h=k._primitiveBabylonMeshes)||void 0===h||h.forEach((k=>{k.pointerOverDisableMeshTesting=!s}))},getTarget:s=>s._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Wh{constructor(s){this.name=Zh,this._loader=s,this.enabled=s.isExtensionUsed(Zh)}async onReady(){var s;null===(s=this._loader.th.nodes)||void 0===s||s.forEach((s=>{var k,h,A;null!==(k=s.extensions)&&void 0!==k&&k.KHR_node_hoverability&&!1===(null===(h=s.extensions)||void 0===h?void 0:h.KHR_node_hoverability.hoverable)&&(null===(A=s._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((s=>{s.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}U(Zh),T(Zh,!0,(s=>new Wh(s)));const Jh="ExtrasAsMetadata";class Fh{_assignExtras(s,k){if(k.extras&&Object.keys(k.extras).length>0){const h=s.metadata=s.metadata||{};(h.th=h.th||{}).extras=k.extras}}constructor(s){this.name=Jh,this.enabled=!0,this._loader=s}dispose(){this._loader=null}loadNodeAsync(s,k,h){return this._loader.loadNodeAsync(s,k,(s=>{this._assignExtras(s,k),h(s)}))}loadCameraAsync(s,k,h){return this._loader.loadCameraAsync(s,k,(s=>{this._assignExtras(s,k),h(s)}))}createMaterial(s,k,h){const A=this._loader.createMaterial(s,k,h);return this._assignExtras(A,k),A}}U(Jh),T(Jh,!1,(s=>new Fh(s)));h(14357)},14234:(s,k,h)=>{"use strict";h.d(k,{d:()=>C,e:()=>p,h:()=>Q,j:()=>I});var A=h(12408),g=h(12402),ms=h(13878),i=h(13061),K=h(13038),H=h(13043),O=h(12422),c=h(12445),S=h(13056),a=h(13147),r=h(13067),d=h(12631);class E{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.la=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.zr=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(s){this._environmentTexture=s}getNodes(){let s=[];s=s.concat(this.meshes),s=s.concat(this.lights),s=s.concat(this.cameras),s=s.concat(this.transformNodes);for(const k of this.skeletons)s=s.concat(k.bones);return s}}class j extends E{}class P{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const s=this.rootNodes;for(const A of s)A.dispose();s.length=0;const k=this.skeletons;for(const A of k)A.dispose();k.length=0;const h=this.animationGroups;for(const A of h)A.dispose();h.length=0}}class R extends E{constructor(s){super(),this._wasAddedToScene=!1,(s=s||c.b.LastCreatedScene)&&(this.Dk=s,this.proceduralTextures=[],s.Dh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=s.getEngine().onContextRestoredObservable.add((()=>{for(const s of this.geometries)s._rebuild();for(const s of this.meshes)s._rebuild();for(const s of this.la)s.rebuild();for(const s of this.textures)s._rebuild()})))}_topologicalSort(s){const k=new Map;for(const i of s)k.set(i.uniqueId,i);const h={dependsOn:new Map,dependedBy:new Map};for(const i of s){const s=i.uniqueId;h.dependsOn.set(s,new Set),h.dependedBy.set(s,new Set)}for(const i of s){const s=i.uniqueId,A=h.dependsOn.get(s);if(i instanceof S.e){const g=i.sourceMesh;k.has(g.uniqueId)&&(A.add(g.uniqueId),h.dependedBy.get(g.uniqueId).add(s))}const g=h.dependedBy.get(s);for(const ms of i.getDescendants()){const A=ms.uniqueId;if(k.has(A)){g.add(A);h.dependsOn.get(A).add(s)}}}const A=[],g=[];for(const i of s){const s=i.uniqueId;0===h.dependsOn.get(s).size&&(g.push(i),k.delete(s))}const ms=g;for(;ms.length>0;){const s=ms.shift();A.push(s);const g=h.dependedBy.get(s.uniqueId);for(const A of Array.from(g.values())){const g=h.dependsOn.get(A);g.delete(s.uniqueId),0===g.size&&k.get(A)&&(ms.push(k.get(A)),k.delete(A))}}return k.size>0&&(O.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),k.forEach((s=>{O.c.Error(s.name)}))),A}_addNodeAndDescendantsToList(s,k,h,A){if(h&&(!A||A(h))&&!k.has(h.uniqueId)){s.push(h),k.add(h.uniqueId);for(const g of h.getDescendants(!0))this._addNodeAndDescendantsToList(s,k,g,A)}}_isNodeInContainer(s){return s instanceof H.e&&-1!==this.meshes.indexOf(s)||(s instanceof K.b&&-1!==this.transformNodes.indexOf(s)||(s instanceof a.e&&-1!==this.lights.indexOf(s)||s instanceof r.d&&-1!==this.cameras.indexOf(s)))}_isValidHierarchy(){for(const s of this.meshes)if(s.parent&&!this._isNodeInContainer(s.parent))return O.c.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;for(const s of this.transformNodes)if(s.parent&&!this._isNodeInContainer(s.parent))return O.c.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;for(const s of this.lights)if(s.parent&&!this._isNodeInContainer(s.parent))return O.c.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;for(const s of this.cameras)if(s.parent&&!this._isNodeInContainer(s.parent))return O.c.Warn(`Node ${s.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||g.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const A={},ms={},K=new P,H=[],O=[],c={doNotInstantiate:!0,...h},S=[],a=new Set;for(const g of this.transformNodes)null===g.parent&&this._addNodeAndDescendantsToList(S,a,g,c.predicate);for(const g of this.meshes)null===g.parent&&this._addNodeAndDescendantsToList(S,a,g,c.predicate);const r=this._topologicalSort(S),d=(h,g)=>{if(((k,h)=>{if(A[k.uniqueId]=h.uniqueId,ms[h.uniqueId]=h,s&&(h.name=s(k.name)),h instanceof i.e){const s=h;if(s.morphTargetManager){const h=k.morphTargetManager;s.morphTargetManager=h.clone();for(let k=0;k<h.numTargets;k++){const g=h.getTarget(k),i=s.morphTargetManager.getTarget(k);A[g.uniqueId]=i.uniqueId,ms[i.uniqueId]=i}}}})(h,g),h.parent){const s=A[h.parent.uniqueId],k=ms[s];g.parent=k||h.parent}if(g.position&&h.position&&g.position.H(h.position),g.rotationQuaternion&&h.rotationQuaternion&&g.rotationQuaternion.H(h.rotationQuaternion),g.rotation&&h.rotation&&g.rotation.H(h.rotation),g.Sg&&h.Sg&&g.Sg.H(h.Sg),g.material){const i=g;if(i.material)if(k){const k=h.material;if(-1===O.indexOf(k)){let h=k.clone(s?s(k.name):"Clone of "+k.name);if(O.push(k),A[k.uniqueId]=h.uniqueId,ms[h.uniqueId]=h,"MultiMaterial"===k.getClassName()){const g=k;for(const k of g.Pg)k&&(h=k.clone(s?s(k.name):"Clone of "+k.name),O.push(k),A[k.uniqueId]=h.uniqueId,ms[h.uniqueId]=h);g.Pg=g.Pg.map((s=>s&&ms[A[s.uniqueId]]))}}"InstancedMesh"!==i.getClassName()&&(i.material=ms[A[k.uniqueId]])}else"MultiMaterial"===i.material.getClassName()?-1===this.Dk.multiMaterials.indexOf(i.material)&&this.Dk.addMultiMaterial(i.material):-1===this.Dk.materials.indexOf(i.material)&&this.Dk.addMaterial(i.material)}null===g.parent&&K.rootNodes.push(g)};for(const g of r)if("InstancedMesh"===g.getClassName()){const s=g,k=s.sourceMesh,h=A[k.uniqueId];d(s,("number"===typeof h?ms[h]:k).createInstance(s.name))}else{let s=!0;"og"===g.getClassName()||"Node"===g.getClassName()||g.skeleton||!g.getTotalVertices||0===g.getTotalVertices()?s=!1:c.doNotInstantiate&&(s="function"===typeof c.doNotInstantiate?!c.doNotInstantiate(g):!c.doNotInstantiate);const k=s?g.createInstance(`instance of ${g.name}`):g.clone(`Clone of ${g.name}`,null,!0);if(!k)throw new Error(`Could not clone or instantiate node on Asset Container ${g.name}`);d(g,k)}for(const g of this.skeletons){if(c.predicate&&!c.predicate(g))continue;const k=g.clone(s?s(g.name):"Clone of "+g.name);for(const s of this.meshes)if(s.skeleton===g&&!s.isAnInstance){const h=ms[A[s.uniqueId]];if(!h||h.isAnInstance)continue;if(h.skeleton=k,-1!==H.indexOf(k))continue;H.push(k);for(const s of k.bones)s._linkedTransformNode&&(s._linkedTransformNode=ms[A[s._linkedTransformNode.uniqueId]])}K.skeletons.push(k)}for(const g of this.animationGroups){if(c.predicate&&!c.predicate(g))continue;const k=g.clone(s?s(g.name):"Clone of "+g.name,(s=>ms[A[s.uniqueId]]||s));K.animationGroups.push(k)}return K}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||g.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Dk.environmentTexture=this.environmentTexture);for(const s of this.Dk._serializableComponents)s.addFromContainer(this);this.Dk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const k=[];for(const h of this.cameras)s&&!s(h)||(this.Dk.addCamera(h),k.push(h));for(const h of this.lights)s&&!s(h)||(this.Dk.addLight(h),k.push(h));for(const h of this.meshes)s&&!s(h)||(this.Dk.gS(h),k.push(h));for(const h of this.skeletons)s&&!s(h)||this.Dk.addSkeleton(h);for(const h of this.animations)s&&!s(h)||this.Dk.addAnimation(h);for(const h of this.animationGroups)s&&!s(h)||this.Dk.addAnimationGroup(h);for(const h of this.multiMaterials)s&&!s(h)||this.Dk.addMultiMaterial(h);for(const h of this.materials)s&&!s(h)||this.Dk.addMaterial(h);for(const h of this.morphTargetManagers)s&&!s(h)||this.Dk.addMorphTargetManager(h);for(const h of this.geometries)s&&!s(h)||this.Dk.addGeometry(h);for(const h of this.transformNodes)s&&!s(h)||(this.Dk.addTransformNode(h),k.push(h));for(const h of this.actionManagers)s&&!s(h)||this.Dk.addActionManager(h);for(const h of this.textures)s&&!s(h)||this.Dk.addTexture(h);for(const h of this.reflectionProbes)s&&!s(h)||this.Dk.addReflectionProbe(h);for(const h of k)h.parent&&-1===this.Dk.getNodes().indexOf(h.parent)&&(h.setParent?h.setParent(null):h.parent=null)}removeAllFromScene(){this._isValidHierarchy()||g.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Dk.environmentTexture&&(this.Dk.environmentTexture=null);for(const s of this.Dk._serializableComponents)s.removeFromContainer(this)}removeFromScene(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const k of this.cameras)s&&!s(k)||this.Dk.removeCamera(k);for(const k of this.lights)s&&!s(k)||this.Dk.removeLight(k);for(const k of this.meshes)s&&!s(k)||this.Dk.AS(k,!0);for(const k of this.skeletons)s&&!s(k)||this.Dk.removeSkeleton(k);for(const k of this.animations)s&&!s(k)||this.Dk.removeAnimation(k);for(const k of this.animationGroups)s&&!s(k)||this.Dk.removeAnimationGroup(k);for(const k of this.multiMaterials)s&&!s(k)||this.Dk.removeMultiMaterial(k);for(const k of this.materials)s&&!s(k)||this.Dk.removeMaterial(k);for(const k of this.morphTargetManagers)s&&!s(k)||this.Dk.removeMorphTargetManager(k);for(const k of this.geometries)s&&!s(k)||this.Dk.removeGeometry(k);for(const k of this.transformNodes)s&&!s(k)||this.Dk.removeTransformNode(k);for(const k of this.actionManagers)s&&!s(k)||this.Dk.removeActionManager(k);for(const k of this.textures)s&&!s(k)||this.Dk.removeTexture(k);for(const k of this.reflectionProbes)s&&!s(k)||this.Dk.removeReflectionProbe(k)}dispose(){const s=this.cameras.slice(0);for(const r of s)r.dispose();this.cameras.length=0;const k=this.lights.slice(0);for(const r of k)r.dispose();this.lights.length=0;const h=this.meshes.slice(0);for(const r of h)r.dispose();this.meshes.length=0;const A=this.skeletons.slice(0);for(const r of A)r.dispose();this.skeletons.length=0;const g=this.animationGroups.slice(0);for(const r of g)r.dispose();this.animationGroups.length=0;const ms=this.multiMaterials.slice(0);for(const r of ms)r.dispose();this.multiMaterials.length=0;const i=this.materials.slice(0);for(const r of i)r.dispose();this.materials.length=0;const K=this.geometries.slice(0);for(const r of K)r.dispose();this.geometries.length=0;const H=this.transformNodes.slice(0);for(const r of H)r.dispose();this.transformNodes.length=0;const O=this.actionManagers.slice(0);for(const r of O)r.dispose();this.actionManagers.length=0;const c=this.textures.slice(0);for(const r of c)r.dispose();this.textures.length=0;const S=this.reflectionProbes.slice(0);for(const r of S)r.dispose();this.reflectionProbes.length=0;const a=this.morphTargetManagers.slice(0);for(const r of a)r.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const r of this.Dk._serializableComponents)r.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Dk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(s,k,h){if(s&&k)for(const A of s){let s=!0;if(h)for(const k of h)if(A===k){s=!1;break}s&&(k.push(A),A._parentContainer=this)}}moveAllFromScene(s){this._wasAddedToScene=!1,void 0===s&&(s=new j);for(const k in this)Object.prototype.hasOwnProperty.call(this,k)&&(this[k]=this[k]||("_environmentTexture"===k?null:[]),this._moveAssets(this.Dk[k],this[k],s[k]));this.environmentTexture=this.Dk.environmentTexture,this.removeAllFromScene()}createRootMesh(){const s=new i.e("assetContainerRootMesh",this.Dk);for(const k of this.meshes)k.parent||s.addChild(k);return this.meshes.unshift(s),s}mergeAnimationsTo(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.b.LastCreatedScene,k=arguments.length>1?arguments[1]:void 0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!s)return O.c.Error("No scene available to merge animations to"),[];const A=h||(k=>{let h=null;const A=k.animations.length?k.animations[0].targetProperty:"",g=k.name.split(".").join("").split("_primitive")[0];switch(A){case"position":case"rotationQuaternion":h=s.getTransformNodeByName(k.name)||s.getTransformNodeByName(g);break;case"influence":h=s.getMorphTargetByName(k.name)||s.getMorphTargetByName(g);break;default:h=s.getNodeByName(k.name)||s.getNodeByName(g)}return h}),g=this.getNodes();for(const K of g){const s=A(K);if(null!==s){for(const k of K.animations){const h=s.animations.filter((s=>s.targetProperty===k.targetProperty));for(const k of h){const h=s.animations.indexOf(k,0);h>-1&&s.animations.splice(h,1)}}s.animations=s.animations.concat(K.animations)}}const ms=[],i=this.animationGroups.slice();for(const K of i){ms.push(K.clone(K.name,A));for(const s of K.animatables)s.stop()}for(const K of k){const k=A(K.target);k&&(s.beginAnimation(k,K.fromFrame,K.toFrame,K.loopAnimation,K.speedRatio,K.onAnimationEnd?K.onAnimationEnd:void 0,void 0,!0,void 0,K.onAnimationLoop?K.onAnimationLoop:void 0),s.stopAnimation(K.target))}return ms}populateRootNodes(){this.rootNodes.length=0;for(const s of this.meshes)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s);for(const s of this.transformNodes)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s);for(const s of this.lights)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s);for(const s of this.cameras)s.parent||-1!==this.rootNodes.indexOf(s)||this.rootNodes.push(s)}addAllAssetsToContainer(s){if(!s)return;const k=[],h=new Set;for(k.push(s);k.length>0;){const s=k.pop();if(s instanceof i.e?(s.mg&&-1===this.geometries.indexOf(s.mg)&&this.geometries.push(s.mg),this.meshes.push(s)):s instanceof S.e?this.meshes.push(s):s instanceof K.b?this.transformNodes.push(s):s instanceof a.e?this.lights.push(s):s instanceof r.d&&this.cameras.push(s),s instanceof H.e){if(s.material&&-1===this.materials.indexOf(s.material)){this.materials.push(s.material);for(const k of s.material.getActiveTextures())-1===this.textures.indexOf(k)&&this.textures.push(k)}s.skeleton&&-1===this.skeletons.indexOf(s.skeleton)&&this.skeletons.push(s.skeleton),s.morphTargetManager&&-1===this.morphTargetManagers.indexOf(s.morphTargetManager)&&this.morphTargetManagers.push(s.morphTargetManager)}for(const A of s.getChildren())h.has(A)||k.push(A);h.add(s)}this.populateRootNodes()}_getByTags(s,k,h){if(void 0===k)return s;const A=[];for(const g in s){const ms=s[g];d.e&&d.e.MatchesQuery(ms,k)&&(!h||h(ms))&&A.push(ms)}return A}getMeshesByTags(s,k){return this._getByTags(this.meshes,s,k)}getCamerasByTags(s,k){return this._getByTags(this.cameras,s,k)}getLightsByTags(s,k){return this._getByTags(this.lights,s,k)}getMaterialsByTags(s,k){return this._getByTags(this.materials,s,k).concat(this._getByTags(this.multiMaterials,s,k))}getTransformNodesByTags(s,k){return this._getByTags(this.transformNodes,s,k)}}var D=h(12454);class w{constructor(s){this.byteOffset=0,this.buffer=s}async loadAsync(s){const k=await this.buffer.readAsync(this.byteOffset,s);this._dataView=new DataView(k.buffer,k.byteOffset,k.byteLength),this._dataByteOffset=0}readUint32(){const s=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,s}readUint8Array(s){const k=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,s);return this._dataByteOffset+=s,this.byteOffset+=s,k}readString(s){return(0,D.j)(this.readUint8Array(s))}skipBytes(s){this._dataByteOffset+=s,this.byteOffset+=s}}var B=h(14237);const u="Z2xURg",G={name:"th",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:s=>-1!==s.indexOf("asset")&&-1!==s.indexOf("version")||s.startsWith("data:base64,"+u)||s.startsWith("data:;base64,"+u)||s.startsWith("data:application/octet-stream;base64,"+u)||s.startsWith("data:model/gltf-binary;base64,"+u)};var Q,p,I,N=h(12448),b=h(12451);function t(s,k,h){try{return Promise.resolve(new Uint8Array(s,k,h))}catch(A){return Promise.reject(A)}}!function(s){s[s.AUTO=0]="AUTO",s[s.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Q||(Q={})),function(s){s[s.NONE=0]="NONE",s[s.FIRST=1]="FIRST",s[s.ALL=2]="ALL"}(p||(p={})),function(s){s[s.LOADING=0]="LOADING",s[s.READY=1]="READY",s[s.COMPLETE=2]="COMPLETE"}(I||(I={}));class z{constructor(){this.coordinateSystemMode=Q.AUTO,this.animationStartMode=p.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=s=>Promise.resolve(s),this.extensionOptions={}}H(s){s&&(this.onParsed=s.onParsed,this.coordinateSystemMode=s.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=s.animationStartMode??this.animationStartMode,this.loadNodeAnimations=s.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=s.loadSkins??this.loadSkins,this.loadMorphTargets=s.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=s.compileMaterials??this.compileMaterials,this.useClipPlane=s.useClipPlane??this.useClipPlane,this.compileShadowGenerators=s.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=s.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=s.useRangeRequests??this.useRangeRequests,this.createInstances=s.createInstances??this.createInstances,this.alwaysComputeBoundingBox=s.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=s.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=s.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=s.skipMaterials??this.skipMaterials,this.useSRGBBuffers=s.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=s.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=s.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=s.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=s.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=s.customRootNode,this.onMeshLoaded=s.onMeshLoaded,this.onSkinLoaded=s.onSkinLoaded,this.onTextureLoaded=s.onTextureLoaded,this.onMaterialLoaded=s.onMaterialLoaded,this.onCameraLoaded=s.onCameraLoaded,this.extensionOptions=s.extensionOptions??this.extensionOptions)}}class C extends z{constructor(s){super(),this.onParsedObservable=new A.c,this.onMeshLoadedObservable=new A.c,this.onSkinLoadedObservable=new A.c,this.onTextureLoadedObservable=new A.c,this.onMaterialLoadedObservable=new A.c,this.onCameraLoadedObservable=new A.c,this.onCompleteObservable=new A.c,this.onErrorObservable=new A.c,this.Dh=new A.c,this.onExtensionLoadedObservable=new A.c,this.validate=!1,this.onValidatedObservable=new A.c,this._loader=null,this._state=null,this._requests=new Array,this.name=G.name,this.extensions=G.extensions,this.onLoaderStateChangedObservable=new A.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.H(s)}set onParsed(s){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),s&&(this._onParsedObserver=this.onParsedObservable.add(s))}set onMeshLoaded(s){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),s&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(s))}set onSkinLoaded(s){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),s&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((k=>s(k.node,k.skinnedNode))))}set onTextureLoaded(s){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),s&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(s))}set onMaterialLoaded(s){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),s&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(s))}set onCameraLoaded(s){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),s&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(s))}set onComplete(s){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(s)}set onError(s){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(s)}set onDispose(s){this._onDisposeObserver&&this.Dh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Dh.add(s)}set onExtensionLoaded(s){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(s)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(s){this._loggingEnabled!==s&&(this._loggingEnabled=s,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(s){this._capturePerformanceCounters!==s&&(this._capturePerformanceCounters=s,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(s){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(s)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const s of this._requests)s.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=s=>Promise.resolve(s),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Dh.notifyObservers(void 0),this.Dh.clear()}loadFile(s,k,h,ms,i,K,H,c){if(ArrayBuffer.isView(k))return this._loadBinary(s,k,h,ms,H,c),null;this._progressCallback=i;const S=k.name||g.Tools.GetFilename(k);if(K){if(this.useRangeRequests){this.validate&&O.c.Warn("glTF validation is not supported when range requests are enabled");const h={abort:()=>{},onCompleteObservable:new A.c},g={readAsync:(h,A)=>new Promise(((g,ms)=>{this._loadFile(s,k,(s=>{g(new Uint8Array(s))}),!0,(s=>{ms(s)}),(s=>{s.setRequestHeader("Range",`bytes=${h}-${h+A-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new w(g)).then((s=>{h.onCompleteObservable.notifyObservers(h),ms(s)}),H?s=>H(void 0,s):void 0),h}return this._loadFile(s,k,(k=>{this._validate(s,new Uint8Array(k,0,k.byteLength),h,S),this._unpackBinaryAsync(new w({readAsync:(s,h)=>t(k,s,h),byteLength:k.byteLength})).then((s=>{ms(s)}),H?s=>H(void 0,s):void 0)}),!0,H)}return this._loadFile(s,k,(k=>{try{this._validate(s,k,h,S),ms({json:this._parseJson(k)})}catch{H&&H()}}),!1,H)}_loadBinary(s,k,h,A,g,ms){this._validate(s,new Uint8Array(k.buffer,k.byteOffset,k.byteLength),h,ms),this._unpackBinaryAsync(new w({readAsync:(s,h)=>function(s,k,h){try{if(k<0||k>=s.byteLength)throw new RangeError("Offset is out of range.");if(k+h>s.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(s.buffer,s.byteOffset+k,h))}catch(A){return Promise.reject(A)}}(k,s,h),byteLength:k.byteLength})).then((s=>{A(s)}),g?s=>g(void 0,s):void 0)}importMeshAsync(s,k,h,A,g,ms){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${ms||""}`),this._loader=this._getLoader(h),this._loader.importMeshAsync(s,k,null,h,A,g,ms))))}loadAsync(s,k,h,A,g){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(k),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(k),this._loader.loadAsync(s,k,h,A,g))))}loadAssetContainerAsync(s,k,h,A,g){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(k),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(k);const ms=new R(s),i=[];this.onMaterialLoadedObservable.add((s=>{i.push(s)}));const K=[];this.onTextureLoadedObservable.add((s=>{K.push(s)}));const H=[];this.onCameraLoadedObservable.add((s=>{H.push(s)}));const O=[];return this.onMeshLoadedObservable.add((s=>{s.morphTargetManager&&O.push(s.morphTargetManager)})),this._loader.importMeshAsync(null,s,ms,k,h,A,g).then((s=>(Array.prototype.push.apply(ms.geometries,s.geometries),Array.prototype.push.apply(ms.meshes,s.meshes),Array.prototype.push.apply(ms.la,s.la),Array.prototype.push.apply(ms.skeletons,s.skeletons),Array.prototype.push.apply(ms.animationGroups,s.animationGroups),Array.prototype.push.apply(ms.materials,i),Array.prototype.push.apply(ms.textures,K),Array.prototype.push.apply(ms.lights,s.lights),Array.prototype.push.apply(ms.transformNodes,s.transformNodes),Array.prototype.push.apply(ms.cameras,H),Array.prototype.push.apply(ms.morphTargetManagers,O),ms)))}))}canDirectLoad(s){return G.canDirectLoad(s)}directLoad(s,k){if(k.startsWith("base64,"+u)||k.startsWith(";base64,"+u)||k.startsWith("application/octet-stream;base64,"+u)||k.startsWith("model/gltf-binary;base64,"+u)){const h=(0,N.c)(k);return this._validate(s,new Uint8Array(h,0,h.byteLength)),this._unpackBinaryAsync(new w({readAsync:(s,k)=>t(h,s,k),byteLength:h.byteLength}))}return this._validate(s,k),Promise.resolve({json:this._parseJson(k)})}createPlugin(s){return new C(s[G.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((s,k)=>{this.onCompleteObservable.addOnce((()=>{s()})),this.onErrorObservable.addOnce((s=>{k(s)}))}))}_setState(s){this._state!==s&&(this._state=s,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(I[this._state]))}_loadFile(s,k,h,A,g,ms){const i=s._loadFile(k,h,(s=>{this._onProgress(s,i)}),!0,A,g,ms);return i.onCompleteObservable.add((()=>{i._lengthComputable=!0,i._total=i._loaded})),this._requests.push(i),i}_onProgress(s,k){if(!this._progressCallback)return;k._lengthComputable=s.lengthComputable,k._loaded=s.loaded,k._total=s.total;let h=!0,A=0,g=0;for(const ms of this._requests){if(void 0===ms._lengthComputable||void 0===ms._loaded||void 0===ms._total)return;h=h&&ms._lengthComputable,A+=ms._loaded,g+=ms._total}this._progressCallback({lengthComputable:h,loaded:A,total:h?g:0})}_validate(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),B.d.ValidateAsync(k,h,A,(k=>this.preprocessUrlAsync(h+k).then((k=>s._loadFileAsync(k,void 0,!0,!0).then((s=>new Uint8Array(s,0,s.byteLength))))))).then((s=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(s),this.onValidatedObservable.clear()}),(s=>{this._endPerformanceCounter("Validate JSON"),g.Tools.Warn(`Failed to validate: ${s.message}`),this.onValidatedObservable.clear()})))}_getLoader(s){const k=s.json.asset||{};this._log(`Asset version: ${k.version}`),k.minVersion&&this._log(`Asset minimum version: ${k.minVersion}`),k.generator&&this._log(`Asset generator: ${k.generator}`);const h=C._parseVersion(k.version);if(!h)throw new Error("Invalid version: "+k.version);if(void 0!==k.minVersion){const s=C._parseVersion(k.minVersion);if(!s)throw new Error("Invalid minimum version: "+k.minVersion);if(C._compareVersion(s,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+k.minVersion)}const A={1:C._CreateGLTF1Loader,2:C._CreateGLTF2Loader}[h.major];if(!A)throw new Error("Unsupported version: "+k.version);return A(this)}_parseJson(s){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${s.length}`);const k=JSON.parse(s);return this._endPerformanceCounter("Parse JSON"),k}_unpackBinaryAsync(s){return this._startPerformanceCounter("Unpack Binary"),s.loadAsync(20).then((()=>{const k=s.readUint32();if(1179937895!==k)throw new b.i("Unexpected magic: "+k,b.e.GLTFLoaderUnexpectedMagicError);const h=s.readUint32();this.loggingEnabled&&this._log(`Binary version: ${h}`);const A=s.readUint32();let g;switch(this.useRangeRequests||A===s.buffer.byteLength||O.c.Warn(`Length in header does not match actual data length: ${A} != ${s.buffer.byteLength}`),h){case 1:g=this._unpackBinaryV1Async(s,A);break;case 2:g=this._unpackBinaryV2Async(s,A);break;default:throw new Error("Unsupported version: "+h)}return this._endPerformanceCounter("Unpack Binary"),g}))}_unpackBinaryV1Async(s,k){const h=s.readUint32(),A=s.readUint32();if(0!==A)throw new Error(`Unexpected content format: ${A}`);const g=k-s.byteOffset,ms={json:this._parseJson(s.readString(h)),bin:null};if(0!==g){const k=s.byteOffset;ms.bin={readAsync:(h,A)=>s.buffer.readAsync(k+h,A),byteLength:g}}return Promise.resolve(ms)}_unpackBinaryV2Async(s,k){const h=1313821514,A=5130562,g=s.readUint32();if(s.readUint32()!==h)throw new Error("First chunk format is not JSON");return s.byteOffset+g===k?s.loadAsync(g).then((()=>({json:this._parseJson(s.readString(g)),bin:null}))):s.loadAsync(g+8).then((()=>{const ms={json:this._parseJson(s.readString(g)),bin:null},i=()=>{const g=s.readUint32();switch(s.readUint32()){case h:throw new Error("Unexpected JSON chunk");case A:{const k=s.byteOffset;ms.bin={readAsync:(h,A)=>s.buffer.readAsync(k+h,A),byteLength:g},s.skipBytes(g);break}default:s.skipBytes(g)}return s.byteOffset!==k?s.loadAsync(8).then(i):Promise.resolve(ms)};return i()}))}static _parseVersion(s){if("1.0"===s||"1.0.1"===s)return{major:1,minor:0};const k=(s+"").match(/^(\d+)\.(\d+)/);return k?{major:parseInt(k[1]),minor:parseInt(k[2])}:null}static _compareVersion(s,k){return s.major>k.major?1:s.major<k.major?-1:s.minor>k.minor?1:s.minor<k.minor?-1:0}_logOpen(s){this._log(s),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(s){const k=C._logSpaces.substring(0,2*this._logIndentLevel);O.c.Log(`${k}${s}`)}_logDisabled(s){}_startPerformanceCounterEnabled(s){g.Tools.StartPerformanceCounter(s)}_startPerformanceCounterDisabled(s){}_endPerformanceCounterEnabled(s){g.Tools.EndPerformanceCounter(s)}_endPerformanceCounterDisabled(s){}}C.IncrementalLoading=!0,C.HomogeneousCoordinates=!1,C._logSpaces="                                ",(0,ms.e)(new C)},14237:(s,k,h)=>{"use strict";h.d(k,{d:()=>i});var A=h(12402);function g(s,k,h,A){const g={externalResourceFunction:A};return h&&(g.uri="file:"===k?h:k+h),ArrayBuffer.isView(s)?GLTFValidator.validateBytes(s,g):GLTFValidator.validateString(s,g)}function ms(){const s=[];onmessage=k=>{const h=k.data;switch(h.id){case"init":importScripts(h.url);break;case"validate":g(h.data,h.rootUrl,h.fileName,(k=>new Promise(((h,A)=>{const g=s.length;s.push({resolve:h,reject:A}),postMessage({id:"getExternalResource",index:g,uri:k})})))).then((s=>{postMessage({id:"validate.resolve",value:s})}),(s=>{postMessage({id:"validate.reject",reason:s})}));break;case"getExternalResource.resolve":s[h.index].resolve(h.value);break;case"getExternalResource.reject":s[h.index].reject(h.reason)}}}class i{static ValidateAsync(s,k,h,i){return"function"===typeof Worker?new Promise(((K,H)=>{const O=`${g}(${ms})()`,c=URL.createObjectURL(new Blob([O],{type:"application/javascript"})),S=new Worker(c),a=s=>{S.removeEventListener("error",a),S.removeEventListener("message",r),H(s)},r=s=>{const k=s.data;switch(k.id){case"getExternalResource":i(k.uri).then((s=>{S.postMessage({id:"getExternalResource.resolve",index:k.index,value:s},[s.buffer])}),(s=>{S.postMessage({id:"getExternalResource.reject",index:k.index,reason:s})}));break;case"validate.resolve":S.removeEventListener("error",a),S.removeEventListener("message",r),K(k.value),S.terminate();break;case"validate.reject":S.removeEventListener("error",a),S.removeEventListener("message",r),H(k.reason),S.terminate()}};if(S.addEventListener("error",a),S.addEventListener("message",r),S.postMessage({id:"init",url:A.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(s)){const A=s.slice();S.postMessage({id:"validate",data:A,rootUrl:k,fileName:h},[A.buffer])}else S.postMessage({id:"validate",data:s,rootUrl:k,fileName:h})})):(this._LoadScriptPromise||(this._LoadScriptPromise=A.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>g(s,k,h,i))))}}i.Configuration={url:`${A.Tools._DefaultCdnUrl}/gltf_validator.js`}},14792:(s,k,h)=>{"use strict";h.d(k,{d:()=>G});var A=h(12570),g=h(12579),ms=h(12623),i=h(12590),K=h(13001),H=h(12911),O=h(12664),c=h(12836),S=h(12543),a=h(12493);h(13999),h(13912),h(13934),h(13918),h(13936),h(13938),h(13941);const r="imageProcessingCompatibility",d="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";a.e.IncludesShadersStore[r]||(a.e.IncludesShadersStore[r]=d);const E="skyPixelShader",j="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";a.e.ShadersStore[E]||(a.e.ShadersStore[E]=j);h(14015),h(13950),h(13956),h(13964),h(13962);const P="skyVertexShader",R="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";a.e.ShadersStore[P]||(a.e.ShadersStore[P]=R);var D=h(12904),w=h(12976),B=h(12968);class u extends K.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class G extends H.b{constructor(s,k){super(s,k),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new i.Pk(0,100,0),this.useSunPosition=!1,this.cameraOffset=i.Pk.Zero(),this.up=i.Pk.Up(),this.dithering=!1,this._cameraPosition=i.Pk.Zero(),this._skyOrientation=new i.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(s,k){const h=k._drawWrapper;if(this.isFrozen&&h.effect&&h._wasPreviouslyReady)return!0;k.materialDefines||(k.materialDefines=new u);const A=k.materialDefines,g=this.Is();if(this._isReadyForSubMesh(k))return!0;if((0,B.P)(s,g,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,A),(0,B.E)(s,A,!0,!1),A.IMAGEPROCESSINGPOSTPROCESS!==g.imageProcessingConfiguration.applyByPostProcess&&A.markAsMiscDirty(),A.DITHER!==this.dithering&&A.markAsMiscDirty(),A.isDirty){A.markAsProcessed(),g.resetCachedMaterial();const s=new D.e;A.FOG&&s.addFallback(1,"FOG"),A.IMAGEPROCESSINGPOSTPROCESS=g.imageProcessingConfiguration.applyByPostProcess,A.DITHER=this.dithering;const h=[O.e.PositionKind];A.VERTEXCOLOR&&h.push(O.e.ColorKind);const ms="sky",i=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,w.c)(i);const K=A.toString();k.setEffect(g.getEngine().createEffect(ms,h,i,[],K,s,this.onCompiled,this.onError),A,this._materialContext)}return!(!k.effect||!k.effect.isReady())&&(A._renderId=g.getRenderId(),h._wasPreviouslyReady=!0,!0)}bindForSubMesh(s,k,h){const A=this.Is(),g=h.materialDefines;if(!g)return;const ms=h.effect;if(!ms)return;this._activeEffect=ms,this.bindOnlyWorldMatrix(s),this._activeEffect.setMatrix("viewProjection",A.getTransformMatrix()),this._mustRebind(A,ms,h)&&((0,w.d)(ms,this,A),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,B.j)(g,ms,A)),A.fogEnabled&&k.applyFog&&A.fogMode!==c.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",A.getViewMatrix()),(0,B.f)(A,k,this._activeEffect);const K=A.activeCamera;if(K){const s=K.getWorldMatrix();this._cameraPosition.x=s.m[12],this._cameraPosition.y=s.m[13],this._cameraPosition.z=s.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const s=Math.PI*(this.inclination-.5),k=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(k)*Math.cos(s),this.sunPosition.y=this.distance*Math.sin(-s),this.sunPosition.z=this.distance*Math.sin(k)*Math.cos(s),i.Quaternion.FromUnitVectorsToRef(i.Pk.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(k,this._activeEffect,h)}getAnimatables(){return[]}dispose(s){super.dispose(s)}clone(s){return ms.e.Clone((()=>new G(s,this.Is())),this)}serialize(){const s=super.serialize();return s.customType="BABYLON.SkyMaterial",s}getClassName(){return"SkyMaterial"}static Parse(s,k,h){return ms.e.Parse((()=>new G(s.name,k)),s,k,h)}}(0,A.e)([(0,g.J)()],G.prototype,"luminance",void 0),(0,A.e)([(0,g.J)()],G.prototype,"turbidity",void 0),(0,A.e)([(0,g.J)()],G.prototype,"rayleigh",void 0),(0,A.e)([(0,g.J)()],G.prototype,"mieCoefficient",void 0),(0,A.e)([(0,g.J)()],G.prototype,"mieDirectionalG",void 0),(0,A.e)([(0,g.J)()],G.prototype,"distance",void 0),(0,A.e)([(0,g.J)()],G.prototype,"inclination",void 0),(0,A.e)([(0,g.J)()],G.prototype,"azimuth",void 0),(0,A.e)([(0,g.G)()],G.prototype,"sunPosition",void 0),(0,A.e)([(0,g.J)()],G.prototype,"useSunPosition",void 0),(0,A.e)([(0,g.G)()],G.prototype,"cameraOffset",void 0),(0,A.e)([(0,g.G)()],G.prototype,"up",void 0),(0,A.e)([(0,g.J)()],G.prototype,"dithering",void 0),(0,S.f)("BABYLON.SkyMaterial",G)},13292:(s,k,h)=>{"use strict";function A(s,k){k.headers=s.headers||{},k.statusMessage=s.statusText,k.statusCode=s.status,k.data=s.response}function g(s,k,h){return new Promise((function(g,ms){h=h||{};var i,K,H,O=new XMLHttpRequest,c=h.body,S=h.headers||{};for(i in h.timeout&&(O.timeout=h.timeout),O.ontimeout=O.onerror=function(s){s.timeout="timeout"==s.type,ms(s)},O.open(s,k.href||k),O.onload=function(){for(H=O.getAllResponseHeaders().trim().split(/[\r\n]+/),A(O,O);K=H.shift();)K=K.split(": "),O.headers[K.shift().toLowerCase()]=K.join(": ");if((K=O.headers["content-type"])&&~K.indexOf("application/json"))try{O.data=JSON.parse(O.data,h.reviver)}catch(s){return A(O,s),ms(s)}(O.status>=400?ms:g)(O)},typeof FormData<"u"&&c instanceof FormData||c&&"object"==typeof c&&(S["content-type"]="application/json",c=JSON.stringify(c)),O.withCredentials=!!h.withCredentials,S)O.setRequestHeader(i,S[i]);O.send(c)}))}h.r(k),h.d(k,{del:()=>H,get:()=>ms,patch:()=>K,post:()=>i,put:()=>O,send:()=>g});var ms=g.bind(g,"GET"),i=g.bind(g,"POST"),K=g.bind(g,"PATCH"),H=g.bind(g,"DELETE"),O=g.bind(g,"PUT")},14902:(s,k,h)=>{"use strict";h.d(k,{d:()=>S});const A=.5*(Math.sqrt(3)-1),g=(3-Math.sqrt(3))/6,ms=1/3,i=1/6,K=(Math.sqrt(5)-1)/4,H=(5-Math.sqrt(5))/20,O=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),c=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const S=class{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const k="function"==typeof s?s:function(s){let k=0,h=0,A=0,g=1;const ms=function(){let s=4022871197;return function(k){k=k.toString();for(let h=0;h<k.length;h++){s+=k.charCodeAt(h);let A=.02519603282416938*s;s=A>>>0,A-=s,A*=s,s=A>>>0,A-=s,s+=4294967296*A}return 2.3283064365386963e-10*(s>>>0)}}();k=ms(" "),h=ms(" "),A=ms(" "),k-=ms(s),k<0&&(k+=1);h-=ms(s),h<0&&(h+=1);A-=ms(s),A<0&&(A+=1);return function(){const s=2091639*k+2.3283064365386963e-10*g;return k=h,h=A,A=s-(g=0|s)}}(s);this.p=function(s){const k=new Uint8Array(256);for(let h=0;h<256;h++)k[h]=h;for(let h=0;h<255;h++){const A=h+~~(s()*(256-h)),g=k[h];k[h]=k[A],k[A]=g}return k}(k),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let h=0;h<512;h++)this.perm[h]=this.p[255&h],this.permMod12[h]=this.perm[h]%12}noise2D(s,k){const h=this.permMod12,ms=this.perm;let i=0,K=0,H=0;const c=(s+k)*A,S=Math.floor(s+c),a=Math.floor(k+c),r=(S+a)*g,d=s-(S-r),E=k-(a-r);let j,P;d>E?(j=1,P=0):(j=0,P=1);const R=d-j+g,D=E-P+g,w=d-1+2*g,B=E-1+2*g,u=255&S,G=255&a;let Q=.5-d*d-E*E;if(Q>=0){const s=3*h[u+ms[G]];Q*=Q,i=Q*Q*(O[s]*d+O[s+1]*E)}let p=.5-R*R-D*D;if(p>=0){const s=3*h[u+j+ms[G+P]];p*=p,K=p*p*(O[s]*R+O[s+1]*D)}let I=.5-w*w-B*B;if(I>=0){const s=3*h[u+1+ms[G+1]];I*=I,H=I*I*(O[s]*w+O[s+1]*B)}return 70*(i+K+H)}noise3D(s,k,h){const A=this.permMod12,g=this.perm;let K,H,c,S;const a=(s+k+h)*ms,r=Math.floor(s+a),d=Math.floor(k+a),E=Math.floor(h+a),j=(r+d+E)*i,P=s-(r-j),R=k-(d-j),D=h-(E-j);let w,B,u,G,Q,p;P>=R?R>=D?(w=1,B=0,u=0,G=1,Q=1,p=0):P>=D?(w=1,B=0,u=0,G=1,Q=0,p=1):(w=0,B=0,u=1,G=1,Q=0,p=1):R<D?(w=0,B=0,u=1,G=0,Q=1,p=1):P<D?(w=0,B=1,u=0,G=0,Q=1,p=1):(w=0,B=1,u=0,G=1,Q=1,p=0);const I=P-w+i,N=R-B+i,b=D-u+i,t=P-G+2*i,z=R-Q+2*i,C=D-p+2*i,v=P-1+.5,Y=R-1+.5,n=D-1+.5,T=255&r,U=255&d,q=255&E;let M=.6-P*P-R*R-D*D;if(M<0)K=0;else{const s=3*A[T+g[U+g[q]]];M*=M,K=M*M*(O[s]*P+O[s+1]*R+O[s+2]*D)}let V=.6-I*I-N*N-b*b;if(V<0)H=0;else{const s=3*A[T+w+g[U+B+g[q+u]]];V*=V,H=V*V*(O[s]*I+O[s+1]*N+O[s+2]*b)}let X=.6-t*t-z*z-C*C;if(X<0)c=0;else{const s=3*A[T+G+g[U+Q+g[q+p]]];X*=X,c=X*X*(O[s]*t+O[s+1]*z+O[s+2]*C)}let L=.6-v*v-Y*Y-n*n;if(L<0)S=0;else{const s=3*A[T+1+g[U+1+g[q+1]]];L*=L,S=L*L*(O[s]*v+O[s+1]*Y+O[s+2]*n)}return 32*(K+H+c+S)}noise4D(s,k,h,A){const g=this.perm;let ms,i,O,S,a;const r=(s+k+h+A)*K,d=Math.floor(s+r),E=Math.floor(k+r),j=Math.floor(h+r),P=Math.floor(A+r),R=(d+E+j+P)*H,D=s-(d-R),w=k-(E-R),B=h-(j-R),u=A-(P-R);let G=0,Q=0,p=0,I=0;D>w?G++:Q++,D>B?G++:p++,D>u?G++:I++,w>B?Q++:p++,w>u?Q++:I++,B>u?p++:I++;const N=G>=3?1:0,b=Q>=3?1:0,t=p>=3?1:0,z=I>=3?1:0,C=G>=2?1:0,v=Q>=2?1:0,Y=p>=2?1:0,n=I>=2?1:0,T=G>=1?1:0,U=Q>=1?1:0,q=p>=1?1:0,M=I>=1?1:0,V=D-N+H,X=w-b+H,L=B-t+H,Z=u-z+H,x=D-C+2*H,y=w-v+2*H,W=B-Y+2*H,J=u-n+2*H,F=D-T+3*H,o=w-U+3*H,l=B-q+3*H,f=u-M+3*H,e=D-1+4*H,ss=w-1+4*H,ks=B-1+4*H,hs=u-1+4*H,As=255&d,gs=255&E,mk=255&j,is=255&P;let Ks=.6-D*D-w*w-B*B-u*u;if(Ks<0)ms=0;else{const s=g[As+g[gs+g[mk+g[is]]]]%32*4;Ks*=Ks,ms=Ks*Ks*(c[s]*D+c[s+1]*w+c[s+2]*B+c[s+3]*u)}let Hs=.6-V*V-X*X-L*L-Z*Z;if(Hs<0)i=0;else{const s=g[As+N+g[gs+b+g[mk+t+g[is+z]]]]%32*4;Hs*=Hs,i=Hs*Hs*(c[s]*V+c[s+1]*X+c[s+2]*L+c[s+3]*Z)}let Os=.6-x*x-y*y-W*W-J*J;if(Os<0)O=0;else{const s=g[As+C+g[gs+v+g[mk+Y+g[is+n]]]]%32*4;Os*=Os,O=Os*Os*(c[s]*x+c[s+1]*y+c[s+2]*W+c[s+3]*J)}let cs=.6-F*F-o*o-l*l-f*f;if(cs<0)S=0;else{const s=g[As+T+g[gs+U+g[mk+q+g[is+M]]]]%32*4;cs*=cs,S=cs*cs*(c[s]*F+c[s+1]*o+c[s+2]*l+c[s+3]*f)}let Ss=.6-e*e-ss*ss-ks*ks-hs*hs;if(Ss<0)a=0;else{const s=g[As+1+g[gs+1+g[mk+1+g[is+1]]]]%32*4;Ss*=Ss,a=Ss*Ss*(c[s]*e+c[s+1]*ss+c[s+2]*ks+c[s+3]*hs)}return 27*(ms+i+O+S+a)}}}}]);