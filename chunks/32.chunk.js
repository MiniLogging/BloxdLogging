/*! For license information please see kuaz9x.32.6f0cffec.chunk.js.LICENSE.txt */
(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[32],{13111:function(t,U){!function(t){"use strict";var U=function(t,y){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,U){t.__proto__=U}||function(t,U){for(var y in U)Object.prototype.hasOwnProperty.call(U,y)&&(t[y]=U[y])},U(t,y)};function y(t,y){if("function"!==typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function I(){this.constructor=t}U(t,y),t.prototype=null===y?Object.create(y):(I.prototype=y.prototype,new I)}function I(t,U,y,I){var r,Y=arguments.length,mt=Y<3?U:null===I?I=Object.getOwnPropertyDescriptor(U,y):I;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)mt=Reflect.decorate(t,U,y,I);else for(var X=t.length-1;X>=0;X--)(r=t[X])&&(mt=(Y<3?r(mt):Y>3?r(U,y,mt):r(U,y))||mt);return Y>3&&mt&&Object.defineProperty(U,y,mt),mt}function r(t,U,y){if(y||2===arguments.length)for(var I,r=0,Y=U.length;r<Y;r++)!I&&r in U||(I||(I=Array.prototype.slice.call(U,0,r)),I[r]=U[r]);return t.concat(I||Array.prototype.slice.call(U))}var Y,mt=255,X=213;t.OPERATION=void 0,(Y=t.OPERATION||(t.OPERATION={}))[Y.ADD=128]="ADD",Y[Y.REPLACE=0]="REPLACE",Y[Y.DELETE=64]="DELETE",Y[Y.DELETE_AND_ADD=192]="DELETE_AND_ADD",Y[Y.TOUCH=1]="TOUCH",Y[Y.CLEAR=10]="CLEAR";var P=function(){function U(t,U,y){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(U,y)}return U.prototype.setParent=function(t,U,y){var I=this;if(this.indexes||(this.indexes=this.ref instanceof qt?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=y,U)if(this.root=U,this.ref instanceof qt){var r=this.ref._definition;for(var Y in r.schema){var mt=this.ref[Y];if(mt&&mt.$changes){var X=r.indexes[Y];mt.$changes.setParent(this.ref,U,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(t,U){if(t instanceof qt){var y=t.$changes,r=I.ref.$changes.indexes[U];y.setParent(I.ref,I.root,r)}}))},U.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},U.prototype.change=function(U,y){void 0===y&&(y=t.OPERATION.ADD);var I="number"===typeof U?U:this.indexes[U];this.assertValidIndex(I,U);var r=this.changes.get(I);r&&r.op!==t.OPERATION.DELETE&&r.op!==t.OPERATION.TOUCH||this.changes.set(I,{op:r&&r.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:y,index:I}),this.allChanges.add(I),this.changed=!0,this.touchParents()},U.prototype.touch=function(U){var y="number"===typeof U?U:this.indexes[U];this.assertValidIndex(y,U),this.changes.has(y)||this.changes.set(y,{op:t.OPERATION.TOUCH,index:y}),this.allChanges.add(y),this.touchParents()},U.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},U.prototype.getType=function(t){if(this.ref._definition)return(U=this.ref._definition).schema[U.fieldsByIndex[t]];var U,y=(U=this.parent._definition).schema[U.fieldsByIndex[this.parentIndex]];return Object.values(y)[0]},U.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},U.prototype.getValue=function(t){return this.ref.getByIndex(t)},U.prototype.delete=function(U){var y="number"===typeof U?U:this.indexes[U];if(void 0!==y){var I=this.getValue(y);this.changes.set(y,{op:t.OPERATION.DELETE,index:y}),this.allChanges.delete(y),delete this.caches[y],I&&I.$changes&&(I.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(U," (").concat(y,")"))},U.prototype.discard=function(U,y){var I=this;void 0===U&&(U=!1),void 0===y&&(y=!1),this.ref instanceof qt||this.changes.forEach((function(U){if(U.op===t.OPERATION.DELETE){var y=I.ref.getIndex(U.index);delete I.indexes[y]}})),this.changes.clear(),this.changed=U,y&&this.allChanges.clear(),this.currentCustomOperation=0},U.prototype.discardAll=function(){var t=this;this.changes.forEach((function(U){var y=t.getValue(U.index);y&&y.$changes&&y.$changes.discardAll()})),this.discard()},U.prototype.cache=function(t,U){this.caches[t]=U},U.prototype.clone=function(){return new U(this.ref,this.parent,this.root)},U.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},U.prototype.assertValidIndex=function(t,U){if(void 0===t)throw new Error('ChangeTree: missing index for field "'.concat(U,'"'))},U}();function G(t,U,y,I){return t[U]||(t[U]=[]),t[U].push(y),null===I||void 0===I||I.forEach((function(t,U){return y(t,U)})),function(){return L(t[U],t[U].indexOf(y))}}function M(U){var y=this,I="string"!==typeof this.$changes.getType();this.$items.forEach((function(r,Y){U.push({refId:y.$changes.refId,op:t.OPERATION.DELETE,field:Y,value:void 0,previousValue:r}),I&&y.$changes.root.removeRef(r.$changes.refId)}))}function L(t,U){if(-1===U||U>=t.length)return!1;for(var y=t.length-1,I=U;I<y;I++)t[I]=t[I+1];return t.length=y,!0}var h=function(t,U){var y=t.toString(),I=U.toString();return y<I?-1:y>I?1:0};function Q(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,U){return"symbol"===typeof U||isNaN(U)?t[U]:t.at(U)},set:function(t,U,y){if("symbol"===typeof U||isNaN(U))t[U]=y;else{var I=Array.from(t.$items.keys()),r=parseInt(I[U]||U);void 0===y||null===y?t.deleteAt(r):t.setAt(r,y)}return!0},deleteProperty:function(t,U){return"number"===typeof U?t.deleteAt(U):delete t[U],!0}})}var F=function(){function U(){for(var t=[],U=0;U<arguments.length;U++)t[U]=arguments[U];this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return U.prototype.xX=function(U,y){return void 0===y&&(y=!0),G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,U,y?this.$items:void 0)},U.prototype.py=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,U)},U.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(U.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),U.prototype.push=function(){for(var t,U=this,y=[],I=0;I<arguments.length;I++)y[I]=arguments[I];return y.forEach((function(y){t=U.$refId++,U.setAt(t,y)})),t},U.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var U=this.$items.get(t);return this.$items.delete(t),U}},U.prototype.at=function(t){var U=Array.from(this.$items.keys())[t];return this.$items.get(U)},U.prototype.setAt=function(U,y){var I,r;if(void 0!==y&&null!==y){if(this.$items.get(U)!==y){void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,U);var Y=null!==(r=null===(I=this.$changes.indexes[U])||void 0===I?void 0:I.op)&&void 0!==r?r:t.OPERATION.ADD;this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,y),this.$changes.change(U,Y)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},U.prototype.deleteAt=function(t){var U=Array.from(this.$items.keys())[t];return void 0!==U&&this.$deleteAt(U)},U.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&M.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.concat=function(){for(var t,y=[],I=0;I<arguments.length;I++)y[I]=arguments[I];return new(U.bind.apply(U,r([void 0],(t=Array.from(this.$items.values())).concat.apply(t,y),!1)))},U.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},U.prototype.reverse=function(){var t=this,U=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(y,I){t.setAt(U[I],y)})),this},U.prototype.shift=function(){var t=Array.from(this.$items.keys()).shift();if(void 0!==t){var U=this.$items.get(t);return this.$deleteAt(t),U}},U.prototype.slice=function(t,y){var I=new U;return I.push.apply(I,Array.from(this.$items.values()).slice(t,y)),I},U.prototype.sort=function(t){var U=this;void 0===t&&(t=h);var y=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach((function(t,I){U.setAt(y[I],t)})),this},U.prototype.splice=function(t,U){void 0===U&&(U=this.length-t);for(var y=Array.from(this.$items.keys()),I=[],r=t;r<t+U;r++)I.push(this.$items.get(y[r])),this.$deleteAt(y[r]);return I},U.prototype.unshift=function(){for(var t=this,U=[],y=0;y<arguments.length;y++)U[y]=arguments[y];var I=this.length,r=U.length,Y=Array.from(this.$items.values());return U.forEach((function(U,y){t.setAt(y,U)})),Y.forEach((function(U,y){t.setAt(r+y,U)})),I+r},U.prototype.indexOf=function(t,U){return Array.from(this.$items.values()).indexOf(t,U)},U.prototype.lastIndexOf=function(t,U){return void 0===U&&(U=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,U)},U.prototype.every=function(t,U){return Array.from(this.$items.values()).every(t,U)},U.prototype.some=function(t,U){return Array.from(this.$items.values()).some(t,U)},U.prototype.forEach=function(t,U){Array.from(this.$items.values()).forEach(t,U)},U.prototype.map=function(t,U){return Array.from(this.$items.values()).map(t,U)},U.prototype.filter=function(t,U){return Array.from(this.$items.values()).filter(t,U)},U.prototype.reduce=function(t,U){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},U.prototype.reduceRight=function(t,U){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},U.prototype.find=function(t,U){return Array.from(this.$items.values()).find(t,U)},U.prototype.findIndex=function(t,U){return Array.from(this.$items.values()).findIndex(t,U)},U.prototype.fill=function(t,U,y){throw new Error("ArraySchema#fill() not implemented")},U.prototype.copyWithin=function(t,U,y){throw new Error("ArraySchema#copyWithin() not implemented")},U.prototype.toString=function(){return this.$items.toString()},U.prototype.toLocaleString=function(){return this.$items.toLocaleString()},U.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},U.prototype.includes=function(t,U){return Array.from(this.$items.values()).includes(t,U)},U.prototype.flatMap=function(t,U){throw new Error("ArraySchema#flatMap() is not supported.")},U.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},U.prototype.findLast=function(){var t=Array.from(this.$items.values());return t.findLast.apply(t,arguments)},U.prototype.findLastIndex=function(){var t=Array.from(this.$items.values());return t.findLastIndex.apply(t,arguments)},U.prototype.setIndex=function(t,U){this.$indexes.set(t,U)},U.prototype.getIndex=function(t){return this.$indexes.get(t)},U.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},U.prototype.deleteByIndex=function(t){var U=this.$indexes.get(t);this.$items.delete(U),this.$indexes.delete(t)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){return this.toArray().map((function(t){return"function"===typeof t.toJSON?t.toJSON():t}))},U.prototype.clone=function(t){return t?new(U.bind.apply(U,r([void 0],Array.from(this.$items.values()),!1))):new(U.bind.apply(U,r([void 0],this.map((function(t){return t.$changes?t.clone():t})),!1)))},U}();function E(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,U){return"symbol"!==typeof U&&"undefined"===typeof t[U]?t.get(U):t[U]},set:function(t,U,y){return"symbol"!==typeof U&&-1===U.indexOf("$")&&"xX"!==U&&"py"!==U&&"onChange"!==U?t.set(U,y):t[U]=y,!0},deleteProperty:function(t,U){return t.delete(U),!0}})}var w=function(){function U(t){var y=this;if(this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map||t instanceof U)t.forEach((function(t,U){return y.set(U,t)}));else for(var I in t)this.set(I,t[I])}return U.prototype.xX=function(U,y){return void 0===y&&(y=!0),G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,U,y?this.$items:void 0)},U.prototype.py=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,U)},U.is=function(t){return void 0!==t.map},U.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(U.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.set=function(U,y){if(void 0===y||null===y)throw new Error("MapSchema#set('".concat(U,"', ").concat(y,"): trying to set ").concat(y," value on '").concat(U,"'."));U=U.toString();var I="undefined"!==typeof this.$changes.indexes[U],r=I?this.$changes.indexes[U]:this.$refId++,Y=I?t.OPERATION.REPLACE:t.OPERATION.ADD,mt=void 0!==y.$changes;if(mt&&y.$changes.setParent(this,this.$changes.root,r),I){if(!mt&&this.$items.get(U)===y)return;mt&&this.$items.get(U)!==y&&(Y=t.OPERATION.ADD)}else this.$changes.indexes[U]=r,this.$indexes.set(r,U);return this.$items.set(U,y),this.$changes.change(U,Y),this},U.prototype.get=function(t){return this.$items.get(t)},U.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&M.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(t){return this.$items.has(t)},U.prototype.forEach=function(t){this.$items.forEach(t)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(t,U){this.$indexes.set(t,U)},U.prototype.getIndex=function(t){return this.$indexes.get(t)},U.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},U.prototype.deleteByIndex=function(t){var U=this.$indexes.get(t);this.$items.delete(U),this.$indexes.delete(t)},U.prototype.toJSON=function(){var t={};return this.forEach((function(U,y){t[y]="function"===typeof U.toJSON?U.toJSON():U})),t},U.prototype.clone=function(t){var y;return t?y=Object.assign(new U,this):(y=new U,this.forEach((function(t,U){t.$changes?y.set(U,t.clone()):y.set(U,t)}))),y},U}(),D={};function l(t,U){D[t]=U}function g(t){return D[t]}var B=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(U){var y=new t;return y.schema=Object.assign({},U&&U.schema||{}),y.indexes=Object.assign({},U&&U.indexes||{}),y.fieldsByIndex=Object.assign({},U&&U.fieldsByIndex||{}),y.descriptors=Object.assign({},U&&U.descriptors||{}),y.deprecated=Object.assign({},U&&U.deprecated||{}),y},t.prototype.addField=function(t,U){var y=this.getNextFieldIndex();this.fieldsByIndex[y]=t,this.indexes[t]=y,this.schema[t]=Array.isArray(U)?{array:U[0]}:U},t.prototype.hasField=function(t){return void 0!==this.indexes[t]},t.prototype.addFilter=function(t,U){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=U,this.indexesWithFilters.push(this.indexes[t]),!0},t.prototype.addChildrenFilter=function(t,U){var y=this.indexes[t],I=this.schema[t];if(g(Object.keys(I)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[y]=U,!0;console.warn("@filterChildren: field '".concat(t,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function b(t){return t._context&&t._context.useFilters}var p=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t,U){void 0===U&&(U=this.schemas.size),t._definition=B.create(t._definition),t._typeid=U,this.types[U]=t,this.schemas.set(t,U)},t.create=function(U){return void 0===U&&(U={}),function(y){return U.context||(U.context=new t),f(y,U)}},t}(),c=new p;function f(t,U){return void 0===U&&(U={}),function(y,I){var Y=U.context||c,mt=y.constructor;if(mt._context=Y,!t)throw new Error("".concat(mt.name,': @type() reference provided for "').concat(I,"\" is undefined. Make sure you don't have any circular dependencies."));Y.has(mt)||Y.add(mt);var X=mt._definition;if(X.addField(I,t),X.descriptors[I]){if(X.deprecated[I])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(I,"' definition on '").concat(mt.name,"'.\nCheck @type() annotation"))}catch(D){var P=D.stack.split("\n")[4].trim();throw new Error("".concat(D.message," ").concat(P))}}var G=F.is(t),M=!G&&w.is(t);if("string"!==typeof t&&!qt.is(t)){var L=Object.values(t)[0];"string"===typeof L||Y.has(L)||Y.add(L)}if(U.manual)X.descriptors[I]={enumerable:!0,configurable:!0,writable:!0};else{var h="_".concat(I);X.descriptors[h]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[I]={get:function(){return this[h]},set:function(t){t!==this[h]&&(void 0!==t&&null!==t?(!G||t instanceof F||(t=new(F.bind.apply(F,r([void 0],t,!1)))),!M||t instanceof w||(t=new w(t)),void 0===t.$proxy&&(M?t=E(t):G&&(t=Q(t))),this.$changes.change(I),t.$changes&&t.$changes.setParent(this,this.$changes.root,this._definition.indexes[I])):this[h]&&this.$changes.delete(I),this[h]=t)},enumerable:!0,configurable:!0}}}}function S(t){return function(U,y){var I=U.constructor;I._definition.addFilter(y,t)&&(I._context.useFilters=!0)}}function N(t){return function(U,y){var I=U.constructor;I._definition.addChildrenFilter(y,t)&&(I._context.useFilters=!0)}}function j(t){return void 0===t&&(t=!0),function(U,y){var I=U.constructor._definition;I.deprecated[y]=!0,t&&(I.descriptors[y]={get:function(){throw new Error("".concat(y," is deprecated."))},set:function(t){},enumerable:!1,configurable:!0})}}function J(t,U,y){for(var I in void 0===y&&(y={}),y.context||(y.context=t._context||y.context||c),U)f(U[I],y)(t.prototype,I);return t}function a(t){for(var U=0,y=0,I=0,r=t.length;I<r;I++)(U=t.charCodeAt(I))<128?y+=1:U<2048?y+=2:U<55296||U>=57344?y+=3:(I++,y+=4);return y}function d(t,U,y){for(var I=0,r=0,Y=y.length;r<Y;r++)(I=y.charCodeAt(r))<128?t[U++]=I:I<2048?(t[U++]=192|I>>6,t[U++]=128|63&I):I<55296||I>=57344?(t[U++]=224|I>>12,t[U++]=128|I>>6&63,t[U++]=128|63&I):(r++,I=65536+((1023&I)<<10|1023&y.charCodeAt(r)),t[U++]=240|I>>18,t[U++]=128|I>>12&63,t[U++]=128|I>>6&63,t[U++]=128|63&I)}function q(t,U){t.push(255&U)}function H(t,U){t.push(255&U)}function e(t,U){t.push(255&U),t.push(U>>8&255)}function o(t,U){t.push(255&U),t.push(U>>8&255)}function V(t,U){t.push(255&U),t.push(U>>8&255),t.push(U>>16&255),t.push(U>>24&255)}function n(t,U){var y=U>>24,I=U>>16,r=U>>8,Y=U;t.push(255&Y),t.push(255&r),t.push(255&I),t.push(255&y)}function i(t,U){var y=Math.floor(U/Math.pow(2,32));n(t,U>>>0),n(t,y)}function v(t,U){var y=U/Math.pow(2,32)|0;n(t,U>>>0),n(t,y)}function O(t,U){W(t,U)}function k(t,U){A(t,U)}var s=new Int32Array(2),x=new Float32Array(s.buffer),Z=new Float64Array(s.buffer);function W(t,U){x[0]=U,V(t,s[0])}function A(t,U){Z[0]=U,V(t,s[0]),V(t,s[1])}function K(t,U){return H(t,U?1:0)}function C(t,U){U||(U="");var y=a(U),I=0;if(y<32)t.push(160|y),I=1;else if(y<256)t.push(217),H(t,y),I=2;else if(y<65536)t.push(218),o(t,y),I=3;else{if(!(y<4294967296))throw new Error("String too long");t.push(219),n(t,y),I=5}return d(t,t.length,U),I+y}function R(t,U){return isNaN(U)?R(t,0):isFinite(U)?U!==(0|U)?(t.push(203),A(t,U),9):U>=0?U<128?(H(t,U),1):U<256?(t.push(204),H(t,U),2):U<65536?(t.push(205),o(t,U),3):U<4294967296?(t.push(206),n(t,U),5):(t.push(207),v(t,U),9):U>=-32?(t.push(224|U+32),1):U>=-128?(t.push(208),q(t,U),2):U>=-32768?(t.push(209),e(t,U),3):U>=-2147483648?(t.push(210),V(t,U),5):(t.push(211),i(t,U),9):R(t,U>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var u=Object.freeze({__proto__:null,utf8Write:d,int8:q,uint8:H,int16:e,uint16:o,int32:V,uint32:n,int64:i,uint64:v,float32:O,float64:k,writeFloat32:W,writeFloat64:A,boolean:K,string:C,number:R});function T(t,U,y){for(var I="",r=0,Y=U,mt=U+y;Y<mt;Y++){var X=t[Y];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(r=(7&X)<<18|(63&t[++Y])<<12|(63&t[++Y])<<6|63&t[++Y])>=65536?(r-=65536,I+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):I+=String.fromCharCode(r):I+=String.fromCharCode((15&X)<<12|(63&t[++Y])<<6|63&t[++Y]):I+=String.fromCharCode((31&X)<<6|63&t[++Y]):I+=String.fromCharCode(X)}return I}function z(t,U){return tt(t,U)<<24>>24}function tt(t,U){return t[U.offset++]}function Ut(t,U){return yt(t,U)<<16>>16}function yt(t,U){return t[U.offset++]|t[U.offset++]<<8}function It(t,U){return t[U.offset++]|t[U.offset++]<<8|t[U.offset++]<<16|t[U.offset++]<<24}function rt(t,U){return It(t,U)>>>0}function Yt(t,U){return ht(t,U)}function mU(t,U){return Qt(t,U)}function Xt(t,U){var y=rt(t,U);return It(t,U)*Math.pow(2,32)+y}function Pt(t,U){var y=rt(t,U);return rt(t,U)*Math.pow(2,32)+y}var Gt=new Int32Array(2),Mt=new Float32Array(Gt.buffer),Lt=new Float64Array(Gt.buffer);function ht(t,U){return Gt[0]=It(t,U),Mt[0]}function Qt(t,U){return Gt[0]=It(t,U),Gt[1]=It(t,U),Lt[0]}function Ft(t,U){return tt(t,U)>0}function Et(t,U){var y,I=t[U.offset++];I<192?y=31&I:217===I?y=tt(t,U):218===I?y=yt(t,U):219===I&&(y=rt(t,U));var r=T(t,U.offset,y);return U.offset+=y,r}function wt(t,U){var y=t[U.offset];return y<192&&y>160||217===y||218===y||219===y}function Dt(t,U){var y=t[U.offset++];return y<128?y:202===y?ht(t,U):203===y?Qt(t,U):204===y?tt(t,U):205===y?yt(t,U):206===y?rt(t,U):207===y?Pt(t,U):208===y?z(t,U):209===y?Ut(t,U):210===y?It(t,U):211===y?Xt(t,U):y>223?-1*(255-y+1):void 0}function lt(t,U){var y=t[U.offset];return y<128||y>=202&&y<=211}function gt(t,U){return t[U.offset]<160}function Bt(t,U){return t[U.offset-1]===mt&&(t[U.offset]<128||t[U.offset]>=202&&t[U.offset]<=211)}var bt=Object.freeze({__proto__:null,int8:z,uint8:tt,int16:Ut,uint16:yt,int32:It,uint32:rt,float32:Yt,float64:mU,int64:Xt,uint64:Pt,readFloat32:ht,readFloat64:Qt,boolean:Ft,string:Et,stringCheck:wt,number:Dt,numberCheck:lt,arrayCheck:gt,switchStructureCheck:Bt}),pt=function(){function U(t){var U=this;this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return U.add(t)}))}return U.prototype.xX=function(U,y){return void 0===y&&(y=!0),G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,U,y?this.$items:void 0)},U.prototype.py=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,U)},U.is=function(t){return void 0!==t.collection},U.prototype.add=function(t){var U=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,U),this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,t),this.$changes.change(U),U},U.prototype.at=function(t){var U=Array.from(this.$items.keys())[t];return this.$items.get(U)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(t){for(var U,y,I=this.$items.entries();(y=I.next())&&!y.done;)if(t===y.value[1]){U=y.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&M.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(t){return Array.from(this.$items.values()).some((function(U){return U===t}))},U.prototype.forEach=function(t){var U=this;this.$items.forEach((function(y,I,r){return t(y,I,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(t,U){this.$indexes.set(t,U)},U.prototype.getIndex=function(t){return this.$indexes.get(t)},U.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},U.prototype.deleteByIndex=function(t){var U=this.$indexes.get(t);this.$items.delete(U),this.$indexes.delete(t)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var t=[];return this.forEach((function(U,y){t.push("function"===typeof U.toJSON?U.toJSON():U)})),t},U.prototype.clone=function(t){var y;return t?y=Object.assign(new U,this):(y=new U,this.forEach((function(t){t.$changes?y.add(t.clone()):y.add(t)}))),y},U}(),ct=function(){function U(t){var U=this;this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return U.add(t)}))}return U.prototype.xX=function(U,y){return void 0===y&&(y=!0),G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,U,y?this.$items:void 0)},U.prototype.py=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,U)},U.is=function(t){return void 0!==t.set},U.prototype.add=function(U){var y,I;if(this.has(U))return!1;var r=this.$refId++;void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,r);var Y=null!==(I=null===(y=this.$changes.indexes[r])||void 0===y?void 0:y.op)&&void 0!==I?I:t.OPERATION.ADD;return this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,U),this.$changes.change(r,Y),r},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(t){for(var U,y,I=this.$items.entries();(y=I.next())&&!y.done;)if(t===y.value[1]){U=y.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&M.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(t){for(var U,y=this.$items.values(),I=!1;(U=y.next())&&!U.done;)if(t===U.value){I=!0;break}return I},U.prototype.forEach=function(t){var U=this;this.$items.forEach((function(y,I,r){return t(y,I,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(t,U){this.$indexes.set(t,U)},U.prototype.getIndex=function(t){return this.$indexes.get(t)},U.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},U.prototype.deleteByIndex=function(t){var U=this.$indexes.get(t);this.$items.delete(U),this.$indexes.delete(t)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var t=[];return this.forEach((function(U,y){t.push("function"===typeof U.toJSON?U.toJSON():U)})),t},U.prototype.clone=function(t){var y;return t?y=Object.assign(new U,this):(y=new U,this.forEach((function(t){t.$changes?y.add(t.clone()):y.add(t)}))),y},U}(),ft=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},t.get=function(U){return void 0===U.$filterState&&(U.$filterState=new t),U.$filterState},t}(),St=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(t,U,y){void 0===y&&(y=!0),this.refs.set(t,U),y&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},t.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach((function(U){if(!(t.refCounts[U]>0)){var y=t.refs.get(U);if(y instanceof qt)for(var I in y._definition.schema)"string"!==typeof y._definition.schema[I]&&y[I]&&y[I].$changes&&t.removeRef(y[I].$changes.refId);else{var r=y.$changes.parent._definition,Y=r.schema[r.fieldsByIndex[y.$changes.parentIndex]];"function"===typeof Object.values(Y)[0]&&Array.from(y.values()).forEach((function(U){return t.removeRef(U.$changes.refId)}))}t.refs.delete(U),delete t.refCounts[U]}})),this.deletedRefs.clear()},t}(),Nt=function(t){function U(){return null!==t&&t.apply(this,arguments)||this}return y(U,t),U}(Error);function jt(t,U,y,I){var r,Y=!1;switch(U){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(y.constructor.name,"#").concat(I));break;case"string":r="string",Y=!0;break;case"boolean":return}if(typeof t!==r&&(!Y||Y&&null!==t)){var mt="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new Nt("a '".concat(r,"' was expected, but ").concat(mt," was provided in ").concat(y.constructor.name,"#").concat(I))}}function Jt(t,U,y,I){if(!(t instanceof U))throw new Nt("a '".concat(U.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(y.constructor.name,"#").concat(I))}function at(t,U,y,I,r){jt(y,t,I,r);var Y=u[t];if(!Y)throw new Nt("a '".concat(t,"' was expected, but ").concat(y," was provided in ").concat(I.constructor.name,"#").concat(r));Y(U,y)}function dt(t,U,y){return bt[t](U,y)}var qt=function(){function U(){for(var t=[],U=0;U<arguments.length;U++)t[U]=arguments[U];Object.defineProperties(this,{$changes:{value:new P(this,void 0,new St),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var y=this._definition.descriptors;y&&Object.defineProperties(this,y),t[0]&&this.assign(t[0])}return U.onError=function(t){console.error(t)},U.is=function(t){return t._definition&&void 0!==t._definition.schema},U.prototype.onChange=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,U)},U.prototype.py=function(U){return G(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,U)},U.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(U.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),U.prototype.setDirty=function(t,U){this.$changes.change(t,U)},U.prototype.listen=function(t,U,y){var I=this;return void 0===y&&(y=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[t]||(this.$callbacks[t]=[]),this.$callbacks[t].push(U),y&&void 0!==this[t]&&U(this[t],void 0),function(){return L(I.$callbacks[t],I.$callbacks[t].indexOf(U))}},U.prototype.decode=function(y,I,r){var Y;void 0===I&&(I={offset:0}),void 0===r&&(r=this);var X=[],P=this.$changes.root,G=y.length,M=0;for(P.refs.set(M,this);I.offset<G;){var L=y[I.offset++];if(L!=mt){var h=r.$changes,Q=void 0!==r._definition,E=Q?L>>6<<6:L;if(E!==t.OPERATION.CLEAR){var D=Q?L%(E||255):Dt(y,I),l=Q?r._definition.fieldsByIndex[D]:"",B=h.getType(D),b=void 0,p=void 0,c=void 0;if(Q?p=r["_".concat(l)]:(p=r.getByIndex(D),(E&t.OPERATION.ADD)===t.OPERATION.ADD?(c=r instanceof w?Et(y,I):D,r.setIndex(D,c)):c=r.getIndex(D)),(E&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(E!==t.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(D),p&&p.$changes&&P.removeRef(p.$changes.refId),b=null),void 0!==l){if(E===t.OPERATION.DELETE);else if(U.is(B)){var f=Dt(y,I);if(b=P.refs.get(f),E!==t.OPERATION.REPLACE){var S=this.getSchemaType(y,I,B);b||((b=this.createTypeInstance(S)).$changes.refId=f,p&&(b.$callbacks=p.$callbacks,p.$changes.refId&&f!==p.$changes.refId&&P.removeRef(p.$changes.refId))),P.addRef(f,b,b!==p)}}else if("string"===typeof B)b=dt(B,y,I);else{var N=g(Object.keys(B)[0]),j=Dt(y,I),J=P.refs.has(j)?p||P.refs.get(j):new N.constructor;if((b=J.clone(!0)).$changes.refId=j,p&&(b.$callbacks=p.$callbacks,p.$changes.refId&&j!==p.$changes.refId)){P.removeRef(p.$changes.refId);for(var a=p.entries(),d=void 0;(d=a.next())&&!d.done;){var q=(Y=d.value)[0],H=Y[1];X.push({refId:j,op:t.OPERATION.DELETE,field:q,value:void 0,previousValue:H})}}P.addRef(j,b,J!==p)}if(null!==b&&void 0!==b)if(b.$changes&&b.$changes.setParent(h.ref,h.root,D),r instanceof U)r[l]=b;else if(r instanceof w)q=c,r.$items.set(q,b),r.$changes.allChanges.add(D);else if(r instanceof F)r.setAt(D,b);else if(r instanceof pt){var e=r.add(b);r.setIndex(D,e)}else r instanceof ct&&!1!==(e=r.add(b))&&r.setIndex(D,e);p!==b&&X.push({refId:M,op:E,field:l,dynamicIndex:c,value:b,previousValue:p})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:I.offset};I.offset<G&&(!Bt(y,I)||(o.offset=I.offset+1,!P.refs.has(Dt(y,o))));)I.offset++}}else r.clear(X)}else{M=Dt(y,I);var V=P.refs.get(M);if(!V)throw new Error('"refId" not found: '.concat(M));r=V}}return this._triggerChanges(X),P.garbageCollectDeletedRefs(),X},U.prototype.encode=function(y,I,r){void 0===y&&(y=!1),void 0===I&&(I=[]),void 0===r&&(r=!1);for(var Y=this.$changes,X=new WeakSet,P=[Y],G=1,M=0;M<G;M++){var L=P[M],h=L.ref,Q=h instanceof U;L.ensureRefId(),X.add(L),L!==Y&&(L.changed||y)&&(H(I,mt),R(I,L.refId));for(var F=y?Array.from(L.allChanges):Array.from(L.changes.values()),E=0,D=F.length;E<D;E++){var l=y?{op:t.OPERATION.ADD,index:F[E]}:F[E],B=l.index,b=Q?h._definition.fieldsByIndex&&h._definition.fieldsByIndex[B]:B,p=I.length;if(l.op!==t.OPERATION.TOUCH)if(Q)H(I,B|l.op);else{if(H(I,l.op),l.op===t.OPERATION.CLEAR)continue;R(I,B)}if(Q||(l.op&t.OPERATION.ADD)!=t.OPERATION.ADD||h instanceof w&&C(I,L.ref.$indexes.get(B)),l.op!==t.OPERATION.DELETE){var c=L.getType(B),f=L.getValue(B);if(f&&f.$changes&&!X.has(f.$changes)&&(P.push(f.$changes),f.$changes.ensureRefId(),G++),l.op!==t.OPERATION.TOUCH){if(U.is(c))Jt(f,c,h,b),R(I,f.$changes.refId),(l.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(I,c,f.constructor);else if("string"===typeof c)at(c,I,f,h,b);else{var S=g(Object.keys(c)[0]);Jt(h["_".concat(b)],S.constructor,h,b),R(I,f.$changes.refId)}r&&L.cache(B,I.slice(p))}}}y||r||L.discard()}return I},U.prototype.encodeAll=function(t){return this.encode(!0,[],t)},U.prototype.applyFilters=function(y,I){var r,Y;void 0===I&&(I=!1);for(var X=this,P=new Set,G=ft.get(y),M=[this.$changes],L=1,h=[],Q=function(Q){var F=M[Q];if(P.has(F.refId))return"continue";var E=F.ref,D=E instanceof U;H(h,mt),R(h,F.refId);var l=G.refIds.has(F),g=I||!l;G.addRefId(F);var B=G.containerIndexes.get(F),b=g?Array.from(F.allChanges):Array.from(F.changes.values());!I&&D&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(U){!B.has(U)&&F.allChanges.has(U)&&(g?b.push(U):b.push({op:t.OPERATION.ADD,index:U}))}));for(var p=0,c=b.length;p<c;p++){var f=g?{op:t.OPERATION.ADD,index:b[p]}:b[p];if(f.op!==t.OPERATION.CLEAR){var S=f.index;if(f.op!==t.OPERATION.DELETE){var N=F.getValue(S),j=F.getType(S);if(D){if((J=E._definition.filters&&E._definition.filters[S])&&!J.call(E,y,N,X)){N&&N.$changes&&P.add(N.$changes.refId);continue}}else{var J,a=F.parent;if((J=F.getChildrenFilter())&&!J.call(a,y,E.$indexes.get(S),N,X)){N&&N.$changes&&P.add(N.$changes.refId);continue}}if(N.$changes&&(M.push(N.$changes),L++),f.op!==t.OPERATION.TOUCH)if(f.op===t.OPERATION.ADD||D)h.push.apply(h,null!==(r=F.caches[S])&&void 0!==r?r:[]),B.add(S);else if(B.has(S))h.push.apply(h,null!==(Y=F.caches[S])&&void 0!==Y?Y:[]);else{if(B.add(S),H(h,t.OPERATION.ADD),R(h,S),E instanceof w){var d=F.ref.$indexes.get(S);C(h,d)}N.$changes?R(h,N.$changes.refId):u[j](h,N)}else N.$changes&&!D&&(H(h,t.OPERATION.ADD),R(h,S),E instanceof w&&(d=F.ref.$indexes.get(S),C(h,d)),R(h,N.$changes.refId))}else D?H(h,f.op|S):(H(h,f.op),R(h,S))}else H(h,f.op)}},F=0;F<L;F++)Q(F);return h},U.prototype.clone=function(){var t,U=new this.constructor,y=this._definition.schema;for(var I in y)"object"===typeof this[I]&&"function"===typeof(null===(t=this[I])||void 0===t?void 0:t.clone)?U[I]=this[I].clone():U[I]=this[I];return U},U.prototype.toJSON=function(){var t=this._definition.schema,U=this._definition.deprecated,y={};for(var I in t)U[I]||null===this[I]||"undefined"===typeof this[I]||(y[I]="function"===typeof this[I].toJSON?this[I].toJSON():this["_".concat(I)]);return y},U.prototype.discardAllChanges=function(){this.$changes.discardAll()},U.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},U.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},U.prototype.tryEncodeTypeId=function(t,U,y){U._typeid!==y._typeid&&(H(t,X),R(t,y._typeid))},U.prototype.getSchemaType=function(t,U,y){var I;return t[U.offset]===X&&(U.offset++,I=this.constructor._context.get(Dt(t,U))),I||y},U.prototype.createTypeInstance=function(t){var U=new t;return U.$changes.root=this.$changes.root,U},U.prototype._triggerChanges=function(y){for(var I,r,Y,mt,X,P,G,M,L,h=new Set,Q=this.$changes.root.refs,F=function(F){var E=y[F],w=E.refId,D=Q.get(w),l=D.$callbacks;if((E.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&E.previousValue instanceof U&&(null===(r=null===(I=E.previousValue.$callbacks)||void 0===I?void 0:I[t.OPERATION.DELETE])||void 0===r||r.forEach((function(t){return t()}))),!l)return"continue";if(D instanceof U){if(!h.has(w))try{null===(Y=null===l||void 0===l?void 0:l[t.OPERATION.REPLACE])||void 0===Y||Y.forEach((function(t){return t()}))}catch(g){U.onError(g)}try{l.hasOwnProperty(E.field)&&(null===(mt=l[E.field])||void 0===mt||mt.forEach((function(t){return t(E.value,E.previousValue)})))}catch(g){U.onError(g)}}else E.op===t.OPERATION.ADD&&void 0===E.previousValue?null===(X=l[t.OPERATION.ADD])||void 0===X||X.forEach((function(t){var U;return t(E.value,null!==(U=E.dynamicIndex)&&void 0!==U?U:E.field)})):E.op===t.OPERATION.DELETE?void 0!==E.previousValue&&(null===(P=l[t.OPERATION.DELETE])||void 0===P||P.forEach((function(t){var U;return t(E.previousValue,null!==(U=E.dynamicIndex)&&void 0!==U?U:E.field)}))):E.op===t.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(G=l[t.OPERATION.DELETE])||void 0===G||G.forEach((function(t){var U;return t(E.previousValue,null!==(U=E.dynamicIndex)&&void 0!==U?U:E.field)}))),null===(M=l[t.OPERATION.ADD])||void 0===M||M.forEach((function(t){var U;return t(E.value,null!==(U=E.dynamicIndex)&&void 0!==U?U:E.field)}))),E.value!==E.previousValue&&(null===(L=l[t.OPERATION.REPLACE])||void 0===L||L.forEach((function(t){var U;return t(E.value,null!==(U=E.dynamicIndex)&&void 0!==U?U:E.field)})));h.add(w)},E=0;E<y.length;E++)F(E)},U._definition=B.create(),U}();function Ht(t){for(var U=[t.$changes],y=1,I={},r=I,Y=function(t){var y=U[t];y.changes.forEach((function(t){var U=y.ref,I=t.index,Y=U._definition?U._definition.fieldsByIndex[I]:U.$indexes.get(I);r[Y]=y.getValue(I)}))},mt=0;mt<y;mt++)Y(mt);return I}var et={context:new p},ot=function(t){function U(){return null!==t&&t.apply(this,arguments)||this}return y(U,t),I([f("string",et)],U.prototype,"name",void 0),I([f("string",et)],U.prototype,"type",void 0),I([f("number",et)],U.prototype,"referencedType",void 0),U}(qt),Vt=function(t){function U(){var U=null!==t&&t.apply(this,arguments)||this;return U.fields=new F,U}return y(U,t),I([f("number",et)],U.prototype,"id",void 0),I([f([ot],et)],U.prototype,"fields",void 0),U}(qt),nt=function(t){function U(){var U=null!==t&&t.apply(this,arguments)||this;return U.types=new F,U}return y(U,t),U.encode=function(t){var y=t.constructor,I=new U;I.rootType=y._typeid;var r=function(t,U){for(var y in U){var r=new ot;r.name=y;var Y=void 0;if("string"===typeof U[y])Y=U[y];else{var mt=U[y],X=void 0;qt.is(mt)?(Y="ref",X=U[y]):"string"===typeof mt[Y=Object.keys(mt)[0]]?Y+=":"+mt[Y]:X=mt[Y],r.referencedType=X?X._typeid:-1}r.type=Y,t.fields.push(r)}I.types.push(t)},Y=y._context.types;for(var mt in Y){var X=new Vt;X.id=Number(mt),r(X,Y[mt]._definition.schema)}return I.encodeAll()},U.decode=function(t,I){var r=new p,Y=new U;Y.decode(t,I);var mt=Y.types.reduce((function(t,U){var I=function(t){function U(){return null!==t&&t.apply(this,arguments)||this}return y(U,t),U}(qt),Y=U.id;return t[Y]=I,r.add(I,Y),t}),{});Y.types.forEach((function(t){var U=mt[t.id];t.fields.forEach((function(t){var y;if(void 0!==t.referencedType){var I=t.type,Y=mt[t.referencedType];if(!Y){var X=t.type.split(":");I=X[0],Y=X[1]}"ref"===I?f(Y,{context:r})(U.prototype,t.name):f(((y={})[I]=Y,y),{context:r})(U.prototype,t.name)}else f(t.type,{context:r})(U.prototype,t.name)}))}));var X=mt[Y.rootType],P=new X;for(var G in X._definition.schema){var M=X._definition.schema[G];"string"!==typeof M&&(P[G]="function"===typeof M?new M:new(g(Object.keys(M)[0]).constructor))}return P},I([f([Vt],et)],U.prototype,"types",void 0),I([f("number",et)],U.prototype,"rootType",void 0),U}(qt);l("map",{constructor:w}),l("array",{constructor:F}),l("set",{constructor:ct}),l("collection",{constructor:pt}),t.ArraySchema=F,t.CollectionSchema=pt,t.Context=p,t.MapSchema=w,t.Reflection=nt,t.ReflectionField=ot,t.ReflectionType=Vt,t.Schema=qt,t.SchemaDefinition=B,t.SetSchema=ct,t.decode=bt,t.defineTypes=J,t.deprecated=j,t.dumpChanges=Ht,t.encode=u,t.filter=S,t.filterChildren=N,t.hasFilter=b,t.registerType=l,t.type=f,Object.defineProperty(t,"__esModule",{value:!0})}(U)},14146:t=>{t.exports=function(t){return null!=t&&null!=t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},14127:(t,U,y)=>{"use strict";var I=y(14133),r=y(14138),Y=y(14146);y.g.__TYPEDARRAY_POOL||(y.g.__TYPEDARRAY_POOL={UINT8:r([32,0]),UINT16:r([32,0]),UINT32:r([32,0]),INT8:r([32,0]),INT16:r([32,0]),INT32:r([32,0]),FLOAT:r([32,0]),DOUBLE:r([32,0]),DATA:r([32,0]),UINT8C:r([32,0]),BUFFER:r([32,0])});var mt="undefined"!==typeof Uint8ClampedArray,X=y.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=r([32,0])),X.BUFFER||(X.BUFFER=r([32,0]));var P=X.DATA,G=X.BUFFER;function M(t){if(t){var U=t.length||t.byteLength,y=I.log2(U);P[y].push(t)}}function L(t){t=I.nextPow2(t);var U=I.log2(t),y=P[U];return y.length>0?y.pop():new ArrayBuffer(t)}function h(t){return new Uint8Array(L(t),0,t)}function Q(t){return new Uint16Array(L(2*t),0,t)}function F(t){return new Uint32Array(L(4*t),0,t)}function E(t){return new Int8Array(L(t),0,t)}function w(t){return new Int16Array(L(2*t),0,t)}function D(t){return new Int32Array(L(4*t),0,t)}function l(t){return new Float32Array(L(4*t),0,t)}function g(t){return new Float64Array(L(8*t),0,t)}function B(t){return mt?new Uint8ClampedArray(L(t),0,t):h(t)}function b(t){return new DataView(L(t),0,t)}U.free=function(t){if(Y(t))G[I.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var U=t.length||t.byteLength,y=0|I.log2(U);P[y].push(t)}},U.freeUint8=U.freeUint16=U.freeUint32=U.freeInt8=U.freeInt16=U.freeInt32=U.freeFloat32=U.freeFloat=U.freeFloat64=U.freeDouble=U.freeUint8Clamped=U.freeDataView=function(t){M(t.buffer)},U.freeArrayBuffer=M,U.freeBuffer=function(t){G[I.log2(t.length)].push(t)},U.malloc=function(t,U){if(void 0===U||"arraybuffer"===U)return L(t);switch(U){case"uint8":return h(t);case"uint16":return Q(t);case"uint32":return F(t);case"int8":return E(t);case"int16":return w(t);case"int32":return D(t);case"float":case"float32":return l(t);case"double":case"float64":return g(t);case"uint8_clamped":return B(t);case"buffer":throw"Buffer not supported";case"data":case"dataview":return b(t);default:return null}return null},U.mallocArrayBuffer=L,U.mallocUint8=h,U.mallocUint16=Q,U.mallocUint32=F,U.mallocInt8=E,U.mallocInt16=w,U.mallocInt32=D,U.mallocFloat32=U.mallocFloat=l,U.mallocFloat64=U.mallocDouble=g,U.mallocUint8Clamped=B,U.mallocDataView=b,U.clearCache=function(){for(var t=0;t<32;++t)X.UINT8[t].length=0,X.UINT16[t].length=0,X.UINT32[t].length=0,X.INT8[t].length=0,X.INT16[t].length=0,X.INT32[t].length=0,X.FLOAT[t].length=0,X.DOUBLE[t].length=0,X.UINT8C[t].length=0,P[t].length=0,G[t].length=0}},14216:(t,U,y)=>{t.exports=r;var I=y(127);function r(t,U){if(!(this instanceof r))return new r(t,U);var y=I.create();I.add(y,t,U),this.base=I.min(I.create(),t,y),this.mL=I.clone(U),this.max=I.max(I.create(),t,y),this.mag=I.length(this.mL)}var Y=r.prototype;Y.width=function(){return this.mL[0]},Y.height=function(){return this.mL[1]},Y.depth=function(){return this.mL[2]},Y.x0=function(){return this.base[0]},Y.y0=function(){return this.base[1]},Y.z0=function(){return this.base[2]},Y.x1=function(){return this.max[0]},Y.y1=function(){return this.max[1]},Y.z1=function(){return this.max[2]},Y.translate=function(t){return I.add(this.max,this.max,t),I.add(this.base,this.base,t),this},Y.setPosition=function(t){return I.add(this.max,t,this.mL),I.k(this.base,t),this},Y.expand=function(t){var U=I.create(),y=I.create();return I.max(U,t.max,this.max),I.min(y,t.base,this.base),I.lU(U,U,y),new r(y,U)},Y.intersects=function(t){return!(t.base[0]>this.max[0])&&(!(t.base[1]>this.max[1])&&(!(t.base[2]>this.max[2])&&(!(t.max[0]<this.base[0])&&(!(t.max[1]<this.base[1])&&!(t.max[2]<this.base[2])))))},Y.touches=function(t){var U=this.union(t);return null!==U&&(0==U.width()||0==U.height()||0==U.depth())},Y.union=function(t){if(!this.intersects(t))return null;var U=Math.max(t.base[0],this.base[0]),y=Math.max(t.base[1],this.base[1]),I=Math.max(t.base[2],this.base[2]);return new r([U,y,I],[Math.min(t.max[0],this.max[0])-U,Math.min(t.max[1],this.max[1])-y,Math.min(t.max[2],this.max[2])-I])}},14133:(t,U)=>{"use strict";function y(t){var U=32;return(t&=-t)&&U--,65535&t&&(U-=16),16711935&t&&(U-=8),252645135&t&&(U-=4),858993459&t&&(U-=2),1431655765&t&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(t){return(t>0)-(t<0)},U.abs=function(t){var U=t>>31;return(t^U)-U},U.min=function(t,U){return U^(t^U)&-(t<U)},U.max=function(t,U){return t^(t^U)&-(t<U)},U.isPow2=function(t){return!(t&t-1)&&!!t},U.log2=function(t){var U,y;return U=(t>65535)<<4,U|=y=((t>>>=U)>255)<<3,U|=y=((t>>>=y)>15)<<2,(U|=y=((t>>>=y)>3)<<1)|(t>>>=y)>>1},U.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},U.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},U.countTrailingZeros=y,U.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},U.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},U.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var I=new Array(256);!function(t){for(var U=0;U<256;++U){var y=U,I=U,r=7;for(y>>>=1;y;y>>>=1)I<<=1,I|=1&y,--r;t[U]=I<<r&255}}(I),U.reverse=function(t){return I[255&t]<<24|I[t>>>8&255]<<16|I[t>>>16&255]<<8|I[t>>>24&255]},U.interleave2=function(t,U){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(t,U){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>U&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},U.interleave3=function(t,U,y){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<2},U.deinterleave3=function(t,U){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>U&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},U.nextCombination=function(t){var U=t|t-1;return U+1|(~U&-~U)-1>>>y(t)+1}},14119:(t,U,y)=>{"use strict";t.exports=function(t,U,y){switch(arguments.length){case 1:return I=[],G(r=t,r,M,!0),I;case 2:return"function"===typeof U?G(t,t,U,!0):function(t,U){return I=[],G(t,U,M,!1),I}(t,U);case 3:return G(t,U,y,!1);default:throw new Error("box-intersect: Invalid arguments")}var r};var I,r=y(14127),Y=y(14148),mt=y(14163);function X(t,U){for(var y=0;y<t;++y)if(!(U[y]<=U[y+t]))return!0;return!1}function P(t,U,y,I){for(var r=0,Y=0,mt=0,P=t.length;mt<P;++mt){var G=t[mt];if(!X(U,G)){for(var M=0;M<2*U;++M)y[r++]=G[M];I[Y++]=mt}}return Y}function G(t,U,y,I){var X=t.length,G=U.length;if(!(X<=0||G<=0)){var M=t[0].length>>>1;if(!(M<=0)){var L,h=r.mallocDouble(2*M*X),Q=r.mallocInt32(X);if((X=P(t,M,h,Q))>0){if(1===M&&I)Y.init(X),L=Y.sweepComplete(M,y,0,X,h,Q,0,X,h,Q);else{var F=r.mallocDouble(2*M*G),E=r.mallocInt32(G);(G=P(U,M,F,E))>0&&(Y.init(X+G),L=1===M?Y.sweepBipartite(M,y,0,X,h,Q,0,G,F,E):mt(M,y,I,X,h,Q,G,F,E),r.free(F),r.free(E))}r.free(h),r.free(Q)}return L}}}function M(t,U){I.push([t,U])}},14170:(t,U)=>{"use strict";var y="d",I="ax",r="fp",Y="es",mt="rs",X="re",P="rb",G="bs",M="be",L="bb",h=[y,I,"vv",mt,X,P,"ri",G,M,L,"bi"];function Q(t){var U="bruteForce"+(t?"Full":"Partial"),I=[],mt=h.slice();t||mt.splice(3,0,r);var X=["function "+U+"("+mt.join()+"){"];function P(U,r){var mt=function(t,U,I){var r="bruteForce"+(t?"Red":"Blue")+(U?"Flip":"")+(I?"Full":""),mt=["function ",r,"(",h.join(),"){","var ",Y,"=2*",y,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",P="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(I?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return t?mt.push(X,"Q",":",P):mt.push(P,"Q",":",X),I?mt.push("if(y1<x0||x1<y0)continue;"):U?mt.push("if(y0<=x0||x1<y0)continue;"):mt.push("if(y0<x0||x1<y0)continue;"),mt.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),U?mt.push("yi,xi"):mt.push("xi,yi"),mt.push(");if(rv!==void 0)return rv;}}}"),{name:r,code:mt.join("")}}(U,r,t);I.push(mt.code),X.push("return "+mt.name+"("+h.join()+");")}X.push("if(re-rs>be-bs){"),t?(P(!0,!1),X.push("}else{"),P(!1,!1)):(X.push("if(fp){"),P(!0,!0),X.push("}else{"),P(!0,!1),X.push("}}else{if(fp){"),P(!1,!0),X.push("}else{"),P(!1,!1),X.push("}")),X.push("}}return "+U);var G=I.join("")+X.join("");return new Function(G)()}U.partial=Q(!1),U.full=Q(!0)},14163:(t,U,y)=>{"use strict";t.exports=function(t,U,y,Y,M,j,J,a,d){!function(t,U){var y=8*r.log2(U+1)*(t+1)|0,Y=r.nextPow2(B*y);p.length<Y&&(I.free(p),p=I.mallocInt32(Y));var mt=r.nextPow2(b*y);c.length<mt&&(I.free(c),c=I.mallocDouble(mt))}(t,Y+J);var q,H=0,e=2*t;f(H++,0,0,Y,0,J,y?16:0,-1/0,1/0),y||f(H++,0,0,J,0,Y,1,-1/0,1/0);for(;H>0;){var o=(H-=1)*B,V=p[o],n=p[o+1],i=p[o+2],v=p[o+3],O=p[o+4],k=p[o+5],s=H*b,x=c[s],Z=c[s+1],W=1&k,A=!!(16&k),K=M,C=j,R=a,u=d;if(W&&(K=a,C=d,R=M,u=j),!(2&k&&n>=(i=w(t,V,n,i,K,C,Z)))&&!(4&k&&(n=D(t,V,n,i,K,C,x))>=i)){var T=i-n,z=O-v;if(A){if(t*T*(T+z)<Q){if(void 0!==(q=P.scanComplete(t,V,U,n,i,K,C,v,O,R,u)))return q;continue}}else{if(t*Math.min(T,z)<L){if(void 0!==(q=mt(t,V,U,W,n,i,K,C,v,O,R,u)))return q;continue}if(t*T*z<h){if(void 0!==(q=P.scanBipartite(t,V,U,W,n,i,K,C,v,O,R,u)))return q;continue}}var tt=F(t,V,n,i,K,C,x,Z);if(n<tt)if(t*(tt-n)<L){if(void 0!==(q=X(t,V+1,U,n,tt,K,C,v,O,R,u)))return q}else if(V===t-2){if(void 0!==(q=W?P.sweepBipartite(t,U,v,O,R,u,n,tt,K,C):P.sweepBipartite(t,U,n,tt,K,C,v,O,R,u)))return q}else f(H++,V+1,n,tt,v,O,W,-1/0,1/0),f(H++,V+1,v,O,n,tt,1^W,-1/0,1/0);if(tt<i){var Ut=G(t,V,v,O,R,u),yt=R[e*Ut+V],It=E(t,V,Ut,O,R,u,yt);if(It<O&&f(H++,V,tt,i,It,O,(4|W)+(A?16:0),yt,Z),v<Ut&&f(H++,V,tt,i,v,Ut,(2|W)+(A?16:0),x,yt),Ut+1===It){if(void 0!==(q=A?N(t,V,U,tt,i,K,C,Ut,R,u[Ut]):S(t,V,U,W,tt,i,K,C,Ut,R,u[Ut])))return q}else if(Ut<It){var rt;if(A){if(tt<(rt=l(t,V,tt,i,K,C,yt))){var Yt=E(t,V,tt,rt,K,C,yt);if(V===t-2){if(tt<Yt&&void 0!==(q=P.sweepComplete(t,U,tt,Yt,K,C,Ut,It,R,u)))return q;if(Yt<rt&&void 0!==(q=P.sweepBipartite(t,U,Yt,rt,K,C,Ut,It,R,u)))return q}else tt<Yt&&f(H++,V+1,tt,Yt,Ut,It,16,-1/0,1/0),Yt<rt&&(f(H++,V+1,Yt,rt,Ut,It,0,-1/0,1/0),f(H++,V+1,Ut,It,Yt,rt,1,-1/0,1/0))}}else tt<(rt=W?g(t,V,tt,i,K,C,yt):l(t,V,tt,i,K,C,yt))&&(V===t-2?q=W?P.sweepBipartite(t,U,Ut,It,R,u,tt,rt,K,C):P.sweepBipartite(t,U,tt,rt,K,C,Ut,It,R,u):(f(H++,V+1,tt,rt,Ut,It,W,-1/0,1/0),f(H++,V+1,Ut,It,tt,rt,1^W,-1/0,1/0)))}}}}};var I=y(14127),r=y(14133),Y=y(14170),mt=Y.partial,X=Y.full,P=y(14148),G=y(14176),M=y(14183),L=128,h=1<<22,Q=1<<22,F=M("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),E=M("lo===p0",["p0"]),w=M("lo<p0",["p0"]),D=M("hi<=p0",["p0"]),l=M("lo<=p0&&p0<=hi",["p0"]),g=M("lo<p0&&p0<=hi",["p0"]),B=6,b=2,p=I.mallocInt32(1024),c=I.mallocDouble(1024);function f(t,U,y,I,r,Y,mt,X,P){var G=B*t;p[G]=U,p[G+1]=y,p[G+2]=I,p[G+3]=r,p[G+4]=Y,p[G+5]=mt;var M=b*t;c[M]=X,c[M+1]=P}function S(t,U,y,I,r,Y,mt,X,P,G,M){var L=2*t,h=P*L,Q=G[h+U];t:for(var F=r,E=r*L;F<Y;++F,E+=L){var w=mt[E+U],D=mt[E+U+t];if(!(Q<w||D<Q)&&(!I||Q!==w)){for(var l,g=X[F],B=U+1;B<t;++B){w=mt[E+B],D=mt[E+B+t];var b=G[h+B],p=G[h+B+t];if(D<b||p<w)continue t}if(void 0!==(l=I?y(M,g):y(g,M)))return l}}}function N(t,U,y,I,r,Y,mt,X,P,G){var M=2*t,L=X*M,h=P[L+U];t:for(var Q=I,F=I*M;Q<r;++Q,F+=M){var E=mt[Q];if(E!==G){var w=Y[F+U],D=Y[F+U+t];if(!(h<w||D<h)){for(var l=U+1;l<t;++l){w=Y[F+l],D=Y[F+l+t];var g=P[L+l],B=P[L+l+t];if(D<g||B<w)continue t}var b=y(E,G);if(void 0!==b)return b}}}}},14176:(t,U,y)=>{"use strict";t.exports=function(t,U,y,mt,X,P){if(mt<=y+1)return y;var G=y,M=mt,L=mt+y>>>1,h=2*t,Q=L,F=X[h*L+U];for(;G<M;){if(M-G<r){Y(t,U,G,M,X,P),F=X[h*L+U];break}var E=M-G,w=Math.random()*E+G|0,D=X[h*w+U],l=Math.random()*E+G|0,g=X[h*l+U],B=Math.random()*E+G|0,b=X[h*B+U];D<=g?b>=g?(Q=l,F=g):D>=b?(Q=w,F=D):(Q=B,F=b):g>=b?(Q=l,F=g):b>=D?(Q=w,F=D):(Q=B,F=b);for(var p=h*(M-1),c=h*Q,f=0;f<h;++f,++p,++c){var S=X[p];X[p]=X[c],X[c]=S}var N=P[M-1];P[M-1]=P[Q],P[Q]=N;for(p=h*(M-1),c=h*(Q=I(t,U,G,M-1,X,P,F)),f=0;f<h;++f,++p,++c){S=X[p];X[p]=X[c],X[c]=S}N=P[M-1];if(P[M-1]=P[Q],P[Q]=N,L<Q){for(M=Q-1;G<M&&X[h*(M-1)+U]===F;)M-=1;M+=1}else{if(!(Q<L))break;for(G=Q+1;G<M&&X[h*G+U]===F;)G+=1}}return I(t,U,y,L,X,P,X[h*L+U])};var I=y(14183)("lo<p0",["p0"]),r=8;function Y(t,U,y,I,r,Y){for(var mt=2*t,X=mt*(y+1)+U,P=y+1;P<I;++P,X+=mt)for(var G=r[X],M=P,L=mt*(P-1);M>y&&r[L+U]>G;--M,L-=mt){for(var h=L,Q=L+mt,F=0;F<mt;++F,++h,++Q){var E=r[h];r[h]=r[Q],r[Q]=E}var w=Y[M];Y[M]=Y[M-1],Y[M-1]=w}}},14183:t=>{"use strict";t.exports=function(t,y){var I="abcdef".split("").concat(y),r=[];t.indexOf("lo")>=0&&r.push("lo=e[k+n]");t.indexOf("hi")>=0&&r.push("hi=e[k+o]");return I.push(U.replace("_",r.join()).replace("$",t)),Function.apply(void 0,I)};var U="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14157:t=>{"use strict";t.exports=function(t,I){I<=4*U?y(0,I-1,t):G(0,I-1,t)};var U=32;function y(t,U,y){for(var I=2*(t+1),r=t+1;r<=U;++r){for(var Y=y[I++],mt=y[I++],X=r,P=I-2;X-- >t;){var G=y[P-2],M=y[P-1];if(G<Y)break;if(G===Y&&M<mt)break;y[P]=G,y[P+1]=M,P-=2}y[P]=Y,y[P+1]=mt}}function I(t,U,y){U*=2;var I=y[t*=2],r=y[t+1];y[t]=y[U],y[t+1]=y[U+1],y[U]=I,y[U+1]=r}function r(t,U,y){U*=2,y[t*=2]=y[U],y[t+1]=y[U+1]}function Y(t,U,y,I){U*=2,y*=2;var r=I[t*=2],Y=I[t+1];I[t]=I[U],I[t+1]=I[U+1],I[U]=I[y],I[U+1]=I[y+1],I[y]=r,I[y+1]=Y}function mt(t,U,y,I,r){U*=2,r[t*=2]=r[U],r[U]=y,r[t+1]=r[U+1],r[U+1]=I}function X(t,U,y){U*=2;var I=y[t*=2],r=y[U];return!(I<r)&&(I!==r||y[t+1]>y[U+1])}function P(t,U,y,I){var r=I[t*=2];return r<U||r===U&&I[t+1]<y}function G(t,M,L){var h=(M-t+1)/6|0,Q=t+h,F=M-h,E=t+M>>1,w=E-h,D=E+h,l=Q,g=w,B=E,b=D,p=F,c=t+1,f=M-1,S=0;X(l,g,L)&&(S=l,l=g,g=S),X(b,p,L)&&(S=b,b=p,p=S),X(l,B,L)&&(S=l,l=B,B=S),X(g,B,L)&&(S=g,g=B,B=S),X(l,b,L)&&(S=l,l=b,b=S),X(B,b,L)&&(S=B,B=b,b=S),X(g,p,L)&&(S=g,g=p,p=S),X(g,B,L)&&(S=g,g=B,B=S),X(b,p,L)&&(S=b,b=p,p=S);for(var N=L[2*g],j=L[2*g+1],J=L[2*b],a=L[2*b+1],d=2*l,q=2*B,H=2*p,e=2*Q,o=2*E,V=2*F,n=0;n<2;++n){var i=L[d+n],v=L[q+n],O=L[H+n];L[e+n]=i,L[o+n]=v,L[V+n]=O}r(w,t,L),r(D,M,L);for(var k=c;k<=f;++k)if(P(k,N,j,L))k!==c&&I(k,c,L),++c;else if(!P(k,J,a,L))for(;;){if(P(f,J,a,L)){P(f,N,j,L)?(Y(k,c,f,L),++c,--f):(I(k,f,L),--f);break}if(--f<k)break}mt(t,c-1,N,j,L),mt(M,f+1,J,a,L),c-2-t<=U?y(t,c-2,L):G(t,c-2,L),M-(f+2)<=U?y(f+2,M,L):G(f+2,M,L),f-c<=U?y(c,f,L):G(c,f,L)}},14148:(t,U,y)=>{"use strict";t.exports={init:function(t){var U=r.nextPow2(t);P.length<U&&(I.free(P),P=I.mallocInt32(U));G.length<U&&(I.free(G),G=I.mallocInt32(U));M.length<U&&(I.free(M),M=I.mallocInt32(U));L.length<U&&(I.free(L),L=I.mallocInt32(U));h.length<U&&(I.free(h),h=I.mallocInt32(U));Q.length<U&&(I.free(Q),Q=I.mallocInt32(U));var y=8*U;F.length<y&&(I.free(F),F=I.mallocDouble(y))},sweepBipartite:function(t,U,y,I,r,X,h,Q,D,l){for(var g=0,B=2*t,b=t-1,p=B-1,c=y;c<I;++c){var f=X[c],S=B*c;F[g++]=r[S+b],F[g++]=-(f+1),F[g++]=r[S+p],F[g++]=f}for(c=h;c<Q;++c){f=l[c]+mt;var N=B*c;F[g++]=D[N+b],F[g++]=-f,F[g++]=D[N+p],F[g++]=f}var j=g>>>1;Y(F,j);var J=0,a=0;for(c=0;c<j;++c){var d=0|F[2*c+1];if(d>=mt)E(M,L,a--,d=d-mt|0);else if(d>=0)E(P,G,J--,d);else if(d<=-mt){d=-d-mt|0;for(var q=0;q<J;++q){if(void 0!==(H=U(P[q],d)))return H}w(M,L,a++,d)}else{d=-d-1|0;for(q=0;q<a;++q){var H;if(void 0!==(H=U(d,M[q])))return H}w(P,G,J++,d)}}},sweepComplete:function(t,U,y,I,r,mt,X,D,l,g){for(var B=0,b=2*t,p=t-1,c=b-1,f=y;f<I;++f){var S=mt[f]+1<<1,N=b*f;F[B++]=r[N+p],F[B++]=-S,F[B++]=r[N+c],F[B++]=S}for(f=X;f<D;++f){S=g[f]+1<<1;var j=b*f;F[B++]=l[j+p],F[B++]=1|-S,F[B++]=l[j+c],F[B++]=1|S}var J=B>>>1;Y(F,J);var a=0,d=0,q=0;for(f=0;f<J;++f){var H=0|F[2*f+1],e=1&H;if(f<J-1&&H>>1===F[2*f+3]>>1&&(e=2,f+=1),H<0){for(var o=-(H>>1)-1,V=0;V<q;++V){if(void 0!==(n=U(h[V],o)))return n}if(0!==e)for(V=0;V<a;++V){if(void 0!==(n=U(P[V],o)))return n}if(1!==e)for(V=0;V<d;++V){var n;if(void 0!==(n=U(M[V],o)))return n}0===e?w(P,G,a++,o):1===e?w(M,L,d++,o):2===e&&w(h,Q,q++,o)}else{o=(H>>1)-1;0===e?E(P,G,a--,o):1===e?E(M,L,d--,o):2===e&&E(h,Q,q--,o)}}},scanBipartite:function(t,U,y,I,r,X,M,L,h,Q,D,l){var g=0,B=2*t,b=U,p=U+t,c=1,f=1;I?f=mt:c=mt;for(var S=r;S<X;++S){var N=S+c,j=B*S;F[g++]=M[j+b],F[g++]=-N,F[g++]=M[j+p],F[g++]=N}for(S=h;S<Q;++S){N=S+f;var J=B*S;F[g++]=D[J+b],F[g++]=-N}var a=g>>>1;Y(F,a);var d=0;for(S=0;S<a;++S){var q=0|F[2*S+1];if(q<0){var H=!1;if((N=-q)>=mt?(H=!I,N-=mt):(H=!!I,N-=1),H)w(P,G,d++,N);else{var e=l[N],o=B*N,V=D[o+U+1],n=D[o+U+1+t];t:for(var i=0;i<d;++i){var v=P[i],O=B*v;if(!(n<M[O+U+1]||M[O+U+1+t]<V)){for(var k=U+2;k<t;++k)if(D[o+k+t]<M[O+k]||M[O+k+t]<D[o+k])continue t;var s,x=L[v];if(void 0!==(s=I?y(e,x):y(x,e)))return s}}}}else E(P,G,d--,q-c)}},scanComplete:function(t,U,y,I,r,X,G,M,L,h,Q){for(var E=0,w=2*t,D=U,l=U+t,g=I;g<r;++g){var B=g+mt,b=w*g;F[E++]=X[b+D],F[E++]=-B,F[E++]=X[b+l],F[E++]=B}for(g=M;g<L;++g){B=g+1;var p=w*g;F[E++]=h[p+D],F[E++]=-B}var c=E>>>1;Y(F,c);var f=0;for(g=0;g<c;++g){var S=0|F[2*g+1];if(S<0){if((B=-S)>=mt)P[f++]=B-mt;else{var N=Q[B-=1],j=w*B,J=h[j+U+1],a=h[j+U+1+t];t:for(var d=0;d<f;++d){var q=P[d],H=G[q];if(H===N)break;var e=w*q;if(!(a<X[e+U+1]||X[e+U+1+t]<J)){for(var o=U+2;o<t;++o)if(h[j+o+t]<X[e+o]||X[e+o+t]<h[j+o])continue t;var V=y(H,N);if(void 0!==V)return V}}}}else{for(B=S-mt,d=f-1;d>=0;--d)if(P[d]===B){for(o=d+1;o<f;++o)P[o-1]=P[o];break}--f}}}};var I=y(14127),r=y(14133),Y=y(14157),mt=1<<28,X=1024,P=I.mallocInt32(X),G=I.mallocInt32(X),M=I.mallocInt32(X),L=I.mallocInt32(X),h=I.mallocInt32(X),Q=I.mallocInt32(X),F=I.mallocDouble(8192);function E(t,U,y,I){var r=U[I],Y=t[y-1];t[r]=Y,U[Y]=r}function w(t,U,y,I){t[y]=I,U[I]=y}},14266:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14264:(t,U,y)=>{var I=y(14266),r=y(14269),Y=Object.hasOwnProperty,mt=Object.create(null);for(var X in I)Y.call(I,X)&&(mt[I[X]]=X);var P=t.exports={to:{},get:{}};function G(t,U,y){return Math.min(Math.max(U,t),y)}function M(t){var U=Math.round(t).toString(16).toUpperCase();return U.length<2?"0"+U:U}P.get=function(t){var U,y;switch(t.substring(0,3).toLowerCase()){case"hsl":U=P.get.hsl(t),y="hsl";break;case"hwb":U=P.get.hwb(t),y="hwb";break;default:U=P.get.rgb(t),y="rgb"}return U?{model:y,value:U}:null},P.get.rgb=function(t){if(!t)return null;var U,y,r,mt=[0,0,0,1];if(U=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=U[2],U=U[1],y=0;y<3;y++){var X=2*y;mt[y]=parseInt(U.slice(X,X+2),16)}r&&(mt[3]=parseInt(r,16)/255)}else if(U=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(U=U[1])[3],y=0;y<3;y++)mt[y]=parseInt(U[y]+U[y],16);r&&(mt[3]=parseInt(r+r,16)/255)}else if(U=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(y=0;y<3;y++)mt[y]=parseInt(U[y+1],0);U[4]&&(U[5]?mt[3]=.01*parseFloat(U[4]):mt[3]=parseFloat(U[4]))}else{if(!(U=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(U=t.match(/^(\w+)$/))?"transparent"===U[1]?[0,0,0,0]:Y.call(I,U[1])?((mt=I[U[1]])[3]=1,mt):null:null;for(y=0;y<3;y++)mt[y]=Math.round(2.55*parseFloat(U[y+1]));U[4]&&(U[5]?mt[3]=.01*parseFloat(U[4]):mt[3]=parseFloat(U[4]))}for(y=0;y<3;y++)mt[y]=G(mt[y],0,255);return mt[3]=G(mt[3],0,1),mt},P.get.hsl=function(t){if(!t)return null;var U=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var y=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,G(parseFloat(U[2]),0,100),G(parseFloat(U[3]),0,100),G(isNaN(y)?1:y,0,1)]}return null},P.get.hwb=function(t){if(!t)return null;var U=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var y=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,G(parseFloat(U[2]),0,100),G(parseFloat(U[3]),0,100),G(isNaN(y)?1:y,0,1)]}return null},P.to.hex=function(){var t=r(arguments);return"#"+M(t[0])+M(t[1])+M(t[2])+(t[3]<1?M(Math.round(255*t[3])):"")},P.to.rgb=function(){var t=r(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},P.to.rgb.percent=function(){var t=r(arguments),U=Math.round(t[0]/255*100),y=Math.round(t[1]/255*100),I=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+U+"%, "+y+"%, "+I+"%)":"rgba("+U+"%, "+y+"%, "+I+"%, "+t[3]+")"},P.to.hsl=function(){var t=r(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},P.to.hwb=function(){var t=r(arguments),U="";return t.length>=4&&1!==t[3]&&(U=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+U+")"},P.to.keyword=function(t){return mt[t.slice(0,3)]}},14257:(t,U,y)=>{const I=y(14264),r=y(14274),Y=["keyword","gray","hex"],mt={};for(const Q of Object.keys(r))mt[[...r[Q].labels].sort().join("")]=Q;const X={};function P(t,U){if(!(this instanceof P))return new P(t,U);if(U&&U in Y&&(U=null),U&&!(U in r))throw new Error("Unknown model: "+U);let y,G;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof P)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if("string"===typeof t){const U=I.get(t);if(null===U)throw new Error("Unable to parse color from string: "+t);this.model=U.model,G=r[this.model].channels,this.color=U.value.slice(0,G),this.valpha="number"===typeof U.value[G]?U.value[G]:1}else if(t.length>0){this.model=U||"rgb",G=r[this.model].channels;const y=Array.prototype.slice.call(t,0,G);this.color=h(y,G),this.valpha="number"===typeof t[G]?t[G]:1}else if("number"===typeof t)this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;const U=Object.keys(t);"alpha"in t&&(U.splice(U.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0);const I=U.sort().join("");if(!(I in mt))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=mt[I];const{labels:Y}=r[this.model],X=[];for(y=0;y<Y.length;y++)X.push(t[Y[y]]);this.color=h(X)}if(X[this.model])for(G=r[this.model].channels,y=0;y<G;y++){const t=X[this.model][y];t&&(this.color[y]=t(this.color[y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}P.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let U=this.model in I.to?this:this.rgb();U=U.round("number"===typeof t?t:1);const y=1===U.valpha?U.color:[...U.color,this.valpha];return I.to[U.model](y)},percentString(t){const U=this.rgb().round("number"===typeof t?t:1),y=1===U.valpha?U.color:[...U.color,this.valpha];return I.to.rgb.percent(y)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:U}=r[this.model],{labels:y}=r[this.model];for(let I=0;I<U;I++)t[y[I]]=this.color[I];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new P([...this.color.map(G(t)),this.valpha],this.model)},alpha(t){return void 0!==t?new P([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:M("rgb",0,L(255)),green:M("rgb",1,L(255)),blue:M("rgb",2,L(255)),hue:M(["hsl","hsv","hsl","hwb","hcg"],0,(t=>(t%360+360)%360)),saturationl:M("hsl",1,L(100)),lightness:M("hsl",2,L(100)),saturationv:M("hsv",1,L(100)),value:M("hsv",2,L(100)),chroma:M("hcg",1,L(100)),gray:M("hcg",2,L(100)),white:M("hwb",1,L(100)),wblack:M("hwb",2,L(100)),cyan:M("cmyk",0,L(100)),magenta:M("cmyk",1,L(100)),yellow:M("cmyk",2,L(100)),black:M("cmyk",3,L(100)),x:M("xyz",0,L(95.047)),y:M("xyz",1,L(100)),z:M("xyz",2,L(108.833)),l:M("lab",0,L(100)),a:M("lab",1),b:M("lab",2),keyword(t){return void 0!==t?new P(t):r[this.model].keyword(this.color)},hex(t){return void 0!==t?new P(t):I.to.hex(this.rgb().round().color)},hexa(t){if(void 0!==t)return new P(t);const U=this.rgb().round().color;let y=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===y.length&&(y="0"+y),I.to.hex(U)+y},rgbNumber(){const t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity(){const t=this.rgb().color,U=[];for(const[y,I]of t.entries()){const t=I/255;U[y]=t<=.04045?t/12.92:((t+.055)/1.055)**2.4}return.2126*U[0]+.7152*U[1]+.0722*U[2]},contrast(t){const U=this.luminosity(),y=t.luminosity();return U>y?(U+.05)/(y+.05):(y+.05)/(U+.05)},level(t){const U=this.contrast(t);return U>=7?"AAA":U>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(2126*t[0]+7152*t[1]+722*t[2])/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let U=0;U<3;U++)t.color[U]=255-t.color[U];return t},lighten(t){const U=this.hsl();return U.color[2]+=U.color[2]*t,U},darken(t){const U=this.hsl();return U.color[2]-=U.color[2]*t,U},saturate(t){const U=this.hsl();return U.color[1]+=U.color[1]*t,U},desaturate(t){const U=this.hsl();return U.color[1]-=U.color[1]*t,U},whiten(t){const U=this.hwb();return U.color[1]+=U.color[1]*t,U},blacken(t){const U=this.hwb();return U.color[2]+=U.color[2]*t,U},grayscale(){const t=this.rgb().color,U=.3*t[0]+.59*t[1]+.11*t[2];return P.rgb(U,U,U)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const U=this.hsl();let y=U.color[0];return y=(y+t)%360,y=y<0?360+y:y,U.color[0]=y,U},mix(t,U){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const y=t.rgb(),I=this.rgb(),r=void 0===U?.5:U,Y=2*r-1,mt=y.alpha()-I.alpha(),X=((Y*mt===-1?Y:(Y+mt)/(1+Y*mt))+1)/2,G=1-X;return P.rgb(X*y.red()+G*I.red(),X*y.green()+G*I.green(),X*y.blue()+G*I.blue(),y.alpha()*r+I.alpha()*(1-r))}};for(const Q of Object.keys(r)){if(Y.includes(Q))continue;const{channels:t}=r[Q];P.prototype[Q]=function(){if(this.model===Q)return new P(this);for(var t=arguments.length,U=new Array(t),y=0;y<t;y++)U[y]=arguments[y];return U.length>0?new P(U,Q):new P([...(I=r[this.model][Q].raw(this.color),Array.isArray(I)?I:[I]),this.valpha],Q);var I},P[Q]=function(){for(var U=arguments.length,y=new Array(U),I=0;I<U;I++)y[I]=arguments[I];let r=y[0];return"number"===typeof r&&(r=h(y,t)),new P(r,Q)}}function G(t){return function(U){return function(t,U){return Number(t.toFixed(U))}(U,t)}}function M(t,U,y){t=Array.isArray(t)?t:[t];for(const I of t)(X[I]||(X[I]=[]))[U]=y;return t=t[0],function(I){let r;return void 0!==I?(y&&(I=y(I)),r=this[t](),r.color[U]=I,r):(r=this[t]().color[U],y&&(r=y(r)),r)}}function L(t){return function(U){return Math.max(0,Math.min(t,U))}}function h(t,U){for(let y=0;y<U;y++)"number"!==typeof t[y]&&(t[y]=0);return t}t.exports=P},14281:(t,U,y)=>{const I=y(14284),r={};for(const mt of Object.keys(I))r[I[mt]]=mt;const Y={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};t.exports=Y;for(const mt of Object.keys(Y)){if(!("channels"in Y[mt]))throw new Error("missing channels property: "+mt);if(!("labels"in Y[mt]))throw new Error("missing channel labels property: "+mt);if(Y[mt].labels.length!==Y[mt].channels)throw new Error("channel and label counts mismatch: "+mt);const{channels:t,labels:U}=Y[mt];delete Y[mt].channels,delete Y[mt].labels,Object.defineProperty(Y[mt],"channels",{value:t}),Object.defineProperty(Y[mt],"labels",{value:U})}Y.rgb.hsl=function(t){const U=t[0]/255,y=t[1]/255,I=t[2]/255,r=Math.min(U,y,I),Y=Math.max(U,y,I),mt=Y-r;let X,P;Y===r?X=0:U===Y?X=(y-I)/mt:y===Y?X=2+(I-U)/mt:I===Y&&(X=4+(U-y)/mt),X=Math.min(60*X,360),X<0&&(X+=360);const G=(r+Y)/2;return P=Y===r?0:G<=.5?mt/(Y+r):mt/(2-Y-r),[X,100*P,100*G]},Y.rgb.hsv=function(t){let U,y,I,r,Y;const mt=t[0]/255,X=t[1]/255,P=t[2]/255,G=Math.max(mt,X,P),M=G-Math.min(mt,X,P),L=function(t){return(G-t)/6/M+.5};return 0===M?(r=0,Y=0):(Y=M/G,U=L(mt),y=L(X),I=L(P),mt===G?r=I-y:X===G?r=1/3+U-I:P===G&&(r=2/3+y-U),r<0?r+=1:r>1&&(r-=1)),[360*r,100*Y,100*G]},Y.rgb.hwb=function(t){const U=t[0],y=t[1];let I=t[2];const r=Y.rgb.hsl(t)[0],mt=1/255*Math.min(U,Math.min(y,I));return I=1-1/255*Math.max(U,Math.max(y,I)),[r,100*mt,100*I]},Y.rgb.cmyk=function(t){const U=t[0]/255,y=t[1]/255,I=t[2]/255,r=Math.min(1-U,1-y,1-I);return[100*((1-U-r)/(1-r)||0),100*((1-y-r)/(1-r)||0),100*((1-I-r)/(1-r)||0),100*r]},Y.rgb.keyword=function(t){const U=r[t];if(U)return U;let y,Y=1/0;for(const r of Object.keys(I)){const U=I[r],P=(X=U,((mt=t)[0]-X[0])**2+(mt[1]-X[1])**2+(mt[2]-X[2])**2);P<Y&&(Y=P,y=r)}var mt,X;return y},Y.keyword.rgb=function(t){return I[t]},Y.rgb.xyz=function(t){let U=t[0]/255,y=t[1]/255,I=t[2]/255;U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,y=y>.04045?((y+.055)/1.055)**2.4:y/12.92,I=I>.04045?((I+.055)/1.055)**2.4:I/12.92;return[100*(.4124*U+.3576*y+.1805*I),100*(.2126*U+.7152*y+.0722*I),100*(.0193*U+.1192*y+.9505*I)]},Y.rgb.lab=function(t){const U=Y.rgb.xyz(t);let y=U[0],I=U[1],r=U[2];y/=95.047,I/=100,r/=108.883,y=y>.008856?y**(1/3):7.787*y+16/116,I=I>.008856?I**(1/3):7.787*I+16/116,r=r>.008856?r**(1/3):7.787*r+16/116;return[116*I-16,500*(y-I),200*(I-r)]},Y.hsl.rgb=function(t){const U=t[0]/360,y=t[1]/100,I=t[2]/100;let r,Y,mt;if(0===y)return mt=255*I,[mt,mt,mt];r=I<.5?I*(1+y):I+y-I*y;const X=2*I-r,P=[0,0,0];for(let G=0;G<3;G++)Y=U+1/3*-(G-1),Y<0&&Y++,Y>1&&Y--,mt=6*Y<1?X+6*(r-X)*Y:2*Y<1?r:3*Y<2?X+(r-X)*(2/3-Y)*6:X,P[G]=255*mt;return P},Y.hsl.hsv=function(t){const U=t[0];let y=t[1]/100,I=t[2]/100,r=y;const Y=Math.max(I,.01);I*=2,y*=I<=1?I:2-I,r*=Y<=1?Y:2-Y;return[U,100*(0===I?2*r/(Y+r):2*y/(I+y)),100*((I+y)/2)]},Y.hsv.rgb=function(t){const U=t[0]/60,y=t[1]/100;let I=t[2]/100;const r=Math.floor(U)%6,Y=U-Math.floor(U),mt=255*I*(1-y),X=255*I*(1-y*Y),P=255*I*(1-y*(1-Y));switch(I*=255,r){case 0:return[I,P,mt];case 1:return[X,I,mt];case 2:return[mt,I,P];case 3:return[mt,X,I];case 4:return[P,mt,I];case 5:return[I,mt,X]}},Y.hsv.hsl=function(t){const U=t[0],y=t[1]/100,I=t[2]/100,r=Math.max(I,.01);let Y,mt;mt=(2-y)*I;const X=(2-y)*r;return Y=y*r,Y/=X<=1?X:2-X,Y=Y||0,mt/=2,[U,100*Y,100*mt]},Y.hwb.rgb=function(t){const U=t[0]/360;let y=t[1]/100,I=t[2]/100;const r=y+I;let Y;r>1&&(y/=r,I/=r);const mt=Math.floor(6*U),X=1-I;Y=6*U-mt,0!==(1&mt)&&(Y=1-Y);const P=y+Y*(X-y);let G,M,L;switch(mt){default:case 6:case 0:G=X,M=P,L=y;break;case 1:G=P,M=X,L=y;break;case 2:G=y,M=X,L=P;break;case 3:G=y,M=P,L=X;break;case 4:G=P,M=y,L=X;break;case 5:G=X,M=y,L=P}return[255*G,255*M,255*L]},Y.cmyk.rgb=function(t){const U=t[0]/100,y=t[1]/100,I=t[2]/100,r=t[3]/100;return[255*(1-Math.min(1,U*(1-r)+r)),255*(1-Math.min(1,y*(1-r)+r)),255*(1-Math.min(1,I*(1-r)+r))]},Y.xyz.rgb=function(t){const U=t[0]/100,y=t[1]/100,I=t[2]/100;let r,Y,mt;return r=3.2406*U+-1.5372*y+-.4986*I,Y=-.9689*U+1.8758*y+.0415*I,mt=.0557*U+-.204*y+1.057*I,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,mt=mt>.0031308?1.055*mt**(1/2.4)-.055:12.92*mt,r=Math.min(Math.max(0,r),1),Y=Math.min(Math.max(0,Y),1),mt=Math.min(Math.max(0,mt),1),[255*r,255*Y,255*mt]},Y.xyz.lab=function(t){let U=t[0],y=t[1],I=t[2];U/=95.047,y/=100,I/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,I=I>.008856?I**(1/3):7.787*I+16/116;return[116*y-16,500*(U-y),200*(y-I)]},Y.lab.xyz=function(t){let U,y,I;y=(t[0]+16)/116,U=t[1]/500+y,I=y-t[2]/200;const r=y**3,Y=U**3,mt=I**3;return y=r>.008856?r:(y-16/116)/7.787,U=Y>.008856?Y:(U-16/116)/7.787,I=mt>.008856?mt:(I-16/116)/7.787,U*=95.047,y*=100,I*=108.883,[U,y,I]},Y.lab.lch=function(t){const U=t[0],y=t[1],I=t[2];let r;r=360*Math.atan2(I,y)/2/Math.PI,r<0&&(r+=360);return[U,Math.sqrt(y*y+I*I),r]},Y.lch.lab=function(t){const U=t[0],y=t[1],I=t[2]/360*2*Math.PI;return[U,y*Math.cos(I),y*Math.sin(I)]},Y.rgb.ansi16=function(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[y,I,r]=t;let mt=null===U?Y.rgb.hsv(t)[2]:U;if(mt=Math.round(mt/50),0===mt)return 30;let X=30+(Math.round(r/255)<<2|Math.round(I/255)<<1|Math.round(y/255));return 2===mt&&(X+=60),X},Y.hsv.ansi16=function(t){return Y.rgb.ansi16(Y.hsv.rgb(t),t[2])},Y.rgb.ansi256=function(t){const U=t[0],y=t[1],I=t[2];if(U===y&&y===I)return U<8?16:U>248?231:Math.round((U-8)/247*24)+232;return 16+36*Math.round(U/255*5)+6*Math.round(y/255*5)+Math.round(I/255*5)},Y.ansi16.rgb=function(t){let U=t%10;if(0===U||7===U)return t>50&&(U+=3.5),U=U/10.5*255,[U,U,U];const y=.5*(1+~~(t>50));return[(1&U)*y*255,(U>>1&1)*y*255,(U>>2&1)*y*255]},Y.ansi256.rgb=function(t){if(t>=232){const U=10*(t-232)+8;return[U,U,U]}let U;t-=16;return[Math.floor(t/36)/5*255,Math.floor((U=t%36)/6)/5*255,U%6/5*255]},Y.rgb.hex=function(t){const U=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(U.length)+U},Y.hex.rgb=function(t){const U=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!U)return[0,0,0];let y=U[0];3===U[0].length&&(y=y.split("").map((t=>t+t)).join(""));const I=parseInt(y,16);return[I>>16&255,I>>8&255,255&I]},Y.rgb.hcg=function(t){const U=t[0]/255,y=t[1]/255,I=t[2]/255,r=Math.max(Math.max(U,y),I),Y=Math.min(Math.min(U,y),I),mt=r-Y;let X,P;return X=mt<1?Y/(1-mt):0,P=mt<=0?0:r===U?(y-I)/mt%6:r===y?2+(I-U)/mt:4+(U-y)/mt,P/=6,P%=1,[360*P,100*mt,100*X]},Y.hsl.hcg=function(t){const U=t[1]/100,y=t[2]/100,I=y<.5?2*U*y:2*U*(1-y);let r=0;return I<1&&(r=(y-.5*I)/(1-I)),[t[0],100*I,100*r]},Y.hsv.hcg=function(t){const U=t[1]/100,y=t[2]/100,I=U*y;let r=0;return I<1&&(r=(y-I)/(1-I)),[t[0],100*I,100*r]},Y.hcg.rgb=function(t){const U=t[0]/360,y=t[1]/100,I=t[2]/100;if(0===y)return[255*I,255*I,255*I];const r=[0,0,0],Y=U%1*6,mt=Y%1,X=1-mt;let P=0;switch(Math.floor(Y)){case 0:r[0]=1,r[1]=mt,r[2]=0;break;case 1:r[0]=X,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=mt;break;case 3:r[0]=0,r[1]=X,r[2]=1;break;case 4:r[0]=mt,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=X}return P=(1-y)*I,[255*(y*r[0]+P),255*(y*r[1]+P),255*(y*r[2]+P)]},Y.hcg.hsv=function(t){const U=t[1]/100,y=U+t[2]/100*(1-U);let I=0;return y>0&&(I=U/y),[t[0],100*I,100*y]},Y.hcg.hsl=function(t){const U=t[1]/100,y=t[2]/100*(1-U)+.5*U;let I=0;return y>0&&y<.5?I=U/(2*y):y>=.5&&y<1&&(I=U/(2*(1-y))),[t[0],100*I,100*y]},Y.hcg.hwb=function(t){const U=t[1]/100,y=U+t[2]/100*(1-U);return[t[0],100*(y-U),100*(1-y)]},Y.hwb.hcg=function(t){const U=t[1]/100,y=1-t[2]/100,I=y-U;let r=0;return I<1&&(r=(y-I)/(1-I)),[t[0],100*I,100*r]},Y.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},Y.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},Y.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},Y.gray.hsl=function(t){return[0,0,t[0]]},Y.gray.hsv=Y.gray.hsl,Y.gray.hwb=function(t){return[0,100,t[0]]},Y.gray.cmyk=function(t){return[0,0,0,t[0]]},Y.gray.lab=function(t){return[t[0],0,0]},Y.gray.hex=function(t){const U=255&Math.round(t[0]/100*255),y=((U<<16)+(U<<8)+U).toString(16).toUpperCase();return"000000".substring(y.length)+y},Y.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},14274:(t,U,y)=>{const I=y(14281),r=y(14290),Y={};Object.keys(I).forEach((t=>{Y[t]={},Object.defineProperty(Y[t],"channels",{value:I[t].channels}),Object.defineProperty(Y[t],"labels",{value:I[t].labels});const U=r(t);Object.keys(U).forEach((y=>{const I=U[y];Y[t][y]=function(t){const U=function(){for(var U=arguments.length,y=new Array(U),I=0;I<U;I++)y[I]=arguments[I];const r=y[0];if(void 0===r||null===r)return r;r.length>1&&(y=r);const Y=t(y);if("object"===typeof Y)for(let t=Y.length,mt=0;mt<t;mt++)Y[mt]=Math.round(Y[mt]);return Y};return"conversion"in t&&(U.conversion=t.conversion),U}(I),Y[t][y].raw=function(t){const U=function(){for(var U=arguments.length,y=new Array(U),I=0;I<U;I++)y[I]=arguments[I];const r=y[0];return void 0===r||null===r?r:(r.length>1&&(y=r),t(y))};return"conversion"in t&&(U.conversion=t.conversion),U}(I)}))})),t.exports=Y},14290:(t,U,y)=>{const I=y(14281);function r(t){const U=function(){const t={},U=Object.keys(I);for(let y=U.length,I=0;I<y;I++)t[U[I]]={distance:-1,parent:null};return t}(),y=[t];for(U[t].distance=0;y.length;){const t=y.pop(),r=Object.keys(I[t]);for(let I=r.length,Y=0;Y<I;Y++){const I=r[Y],mt=U[I];-1===mt.distance&&(mt.distance=U[t].distance+1,mt.parent=t,y.unshift(I))}}return U}function Y(t,U){return function(y){return U(t(y))}}function mt(t,U){const y=[U[t].parent,t];let r=I[U[t].parent][t],mt=U[t].parent;for(;U[mt].parent;)y.unshift(U[mt].parent),r=Y(I[U[mt].parent][mt],r),mt=U[mt].parent;return r.conversion=y,r}t.exports=function(t){const U=r(t),y={},I=Object.keys(U);for(let r=I.length,Y=0;Y<r;Y++){const t=I[Y];null!==U[t].parent&&(y[t]=mt(t,U))}return y}},14284:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13132:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.discordURLBuilder=void 0,U.discordURLBuilder=function(t){var U;const y=(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)||"localhost",I=t.hostname.split("."),r=!t.hostname.includes("trycloudflare.com")&&!t.hostname.includes("discordsays.com")&&I.length>2?`/${I[0]}`:"";return t.pathname.startsWith("/.proxy")?`${t.protocol}//${y}${r}${t.pathname}${t.search}`:`${t.protocol}//${y}/.proxy/colyseus${r}${t.pathname}${t.search}`}},13124:function(t,U,y){"use strict";var I,r,Y,mt,X=this&&this.__awaiter||function(t,U,y,I){return new(y||(y=Promise))((function(r,Y){function mt(t){try{P(I.next(t))}catch(U){Y(U)}}function X(t){try{P(I.throw(t))}catch(U){Y(U)}}function P(t){var U;t.done?r(t.value):(U=t.value,U instanceof y?U:new y((function(t){t(U)}))).then(mt,X)}P((I=I.apply(t,U||[])).next())}))},P=this&&this.__classPrivateFieldGet||function(t,U,y,I){if("a"===y&&!I)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof U?t!==U||!I:!U.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===y?I:"a"===y?I.call(t):I?I.value:U.get(t)},G=this&&this.__classPrivateFieldSet||function(t,U,y,I,r){if("m"===I)throw new TypeError("Private method is not writable");if("a"===I&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof U?t!==U||!r:!U.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===I?r.call(t,y):r?r.value=y:U.set(t,y),y};Object.defineProperty(U,"__esModule",{value:!0}),U.Auth=void 0;const M=y(13126),L=y(13097);U.Auth=class{constructor(t){this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},I.set(this,!1),r.set(this,void 0),Y.set(this,void 0),mt.set(this,(0,L.createNanoEvents)()),(0,M.getItem)(this.settings.key,(t=>this.token=t))}set token(t){this.http.authToken=t}get token(){return this.http.authToken}onChange(t){const U=P(this,mt,"f").on("change",t);return P(this,I,"f")||G(this,r,new Promise(((t,U)=>{this.getUserData().then((t=>{this.emitChange(Object.assign(Object.assign({},t),{token:this.token}))})).catch((t=>{this.emitChange({user:null,token:void 0})})).finally((()=>{t()}))})),"f"),G(this,I,!0,"f"),U}getUserData(){return X(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(t,U,y){return X(this,void 0,void 0,(function*(){const I=(yield this.http.post(`${this.settings.path}/register`,{body:{email:t,password:U,options:y}})).data;return this.emitChange(I),I}))}signInWithEmailAndPassword(t,U){return X(this,void 0,void 0,(function*(){const y=(yield this.http.post(`${this.settings.path}/login`,{body:{email:t,password:U}})).data;return this.emitChange(y),y}))}signInAnonymously(t){return X(this,void 0,void 0,(function*(){const U=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:t}})).data;return this.emitChange(U),U}))}sendPasswordResetEmail(t){return X(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:t}})).data}))}signInWithProvider(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return X(this,void 0,void 0,(function*(){return new Promise(((y,I)=>{const r=U.width||480,mt=U.height||768,X=this.token?`?token=${this.token}`:"",M=`Login with ${t[0].toUpperCase()+t.substring(1)}`,L=this.http.client.getHttpEndpoint(`${U.prefix||`${this.settings.path}/provider`}/${t}${X}`),h=screen.width/2-r/2,Q=screen.height/2-mt/2;G(this,Y,window.open(L,M,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+mt+", top="+Q+", left="+h),"f");const F=t=>{void 0===t.data.user&&void 0===t.data.token||(clearInterval(E),P(this,Y,"f").close(),G(this,Y,void 0,"f"),window.removeEventListener("message",F),void 0!==t.data.error?I(t.data.error):(y(t.data),this.emitChange(t.data)))},E=setInterval((()=>{P(this,Y,"f")&&!P(this,Y,"f").closed||(G(this,Y,void 0,"f"),I("uY"),window.removeEventListener("message",F))}),200);window.addEventListener("message",F)}))}))}signOut(){return X(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(t){void 0!==t.token&&(this.token=t.token,null===t.token?(0,M.removeItem)(this.settings.key):(0,M.setItem)(this.settings.key,t.token)),P(this,mt,"f").emit("change",t)}},I=new WeakMap,r=new WeakMap,Y=new WeakMap,mt=new WeakMap},13049:function(t,U,y){"use strict";var I,r=this&&this.__awaiter||function(t,U,y,I){return new(y||(y=Promise))((function(r,Y){function mt(t){try{P(I.next(t))}catch(U){Y(U)}}function X(t){try{P(I.throw(t))}catch(U){Y(U)}}function P(t){var U;t.done?r(t.value):(U=t.value,U instanceof y?U:new y((function(t){t(U)}))).then(mt,X)}P((I=I.apply(t,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=U.MatchMakeError=void 0;const Y=y(13055),mt=y(13060),X=y(13115),P=y(13124),G=y(13132);class M extends Error{constructor(t,U){super(t),this.code=U,Object.setPrototypeOf(this,M.prototype)}}U.MatchMakeError=M;const L="undefined"!==typeof window&&"undefined"!==typeof(null===(I=null===window||void 0===window?void 0:window.location)||void 0===I?void 0:I.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";U.Client=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,U=arguments.length>1?arguments[1]:void 0;var y,I;if("string"===typeof t){const U=t.startsWith("/")?new URL(t,L):new URL(t),y="https:"===U.protocol||"wss:"===U.protocol,I=Number(U.port||(y?443:80));this.settings={hostname:U.hostname,pathname:U.pathname,port:I,secure:y}}else void 0===t.port&&(t.port=t.secure?443:80),void 0===t.pathname&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new X.HTTP(this,(null===U||void 0===U?void 0:U.headers)||{}),this.auth=new P.Auth(this.http),this.urlBuilder=null===U||void 0===U?void 0:U.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(I=null===(y=null===window||void 0===window?void 0:window.location)||void 0===y?void 0:y.hostname)||void 0===I?void 0:I.includes("discordsays.com"))&&(this.urlBuilder=G.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",t,U,y)}))}create(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",t,U,y)}))}join(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",t,U,y)}))}joinById(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",t,U,y)}))}reconnect(t,U){return r(this,void 0,void 0,(function*(){if("string"===typeof t&&"string"===typeof U)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[y,I]=t.split(":");if(!y||!I)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",y,{reconnectionToken:I},U)}))}getAvailableRooms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${t}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(t,U,y){return r(this,void 0,void 0,(function*(){const I=this.createRoom(t.room.name,U);I.roomId=t.room.roomId,I.sessionId=t.sessionId;const mt={sessionId:I.sessionId};t.reconnectionToken&&(mt.reconnectionToken=t.reconnectionToken);const X=y||I;return I.connect(this.buildEndpoint(t.room,mt),t.devMode&&(()=>r(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${I.roomId}'...`);let y=0;const Y=()=>r(this,void 0,void 0,(function*(){y++;try{yield this.consumeSeatReservation(t,U,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${I.roomId}'`)}catch(r){y<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${y} out of 8)`),setTimeout(Y,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Y,2e3)}))),X,this.http.headers),new Promise(((t,U)=>{const y=(t,y)=>U(new Y.ServerError(t,y));X.onError.once(y),X.onJoin.once((()=>{X.onError.remove(y),setTimeout((()=>{try{X.sP(128,new Uint8Array([248,204,170,175,200,221,235,134,133,204,0,160,150,148,204,102,6,112,149,239]))}catch{}}),3e3),t(X)}))}))}))}createMatchMakeRequest(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},I=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0;return r(this,void 0,void 0,(function*(){const r=(yield this.http.post(`matchmake/${t}/${U}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(y)})).data;if(r.error)throw new M(r.error,r.code);return"reconnect"===t&&(r.reconnectionToken=y.reconnectionToken),yield this.consumeSeatReservation(r,I,Y)}))}createRoom(t,U){return new mt.Room(t,U)}buildEndpoint(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const y=[];for(const Y in U)U.hasOwnProperty(Y)&&y.push(`${Y}=${U[Y]}`);let I=this.settings.secure?"wss://":"ws://";t.publicAddress?I+=`${t.publicAddress}`:I+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const r=`${I}/${t.processId}/${t.roomId}?${y.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getHttpEndpoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const U=t.startsWith("/")?t:`/${t}`,y=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${U}`;return this.urlBuilder?this.urlBuilder(new URL(y)):y}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13066:(t,U,y)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Connection=void 0;const I=y(13072);U.Connection=class{constructor(){this.events={},this.transport=new I.WebSocketTransport(this.events)}send(t){this.transport.send(t)}connect(t,U){this.transport.connect(t,U)}close(t,U){this.transport.close(t,U)}get isOpen(){return this.transport.isOpen}}},13115:function(t,U,y){"use strict";var I=this&&this.__createBinding||(Object.create?function(t,U,y,I){void 0===I&&(I=y);var r=Object.getOwnPropertyDescriptor(U,y);r&&!("get"in r?!U.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return U[y]}}),Object.defineProperty(t,I,r)}:function(t,U,y,I){void 0===I&&(I=y),t[I]=U[y]}),r=this&&this.__setModuleDefault||(Object.create?function(t,U){Object.defineProperty(t,"default",{enumerable:!0,value:U})}:function(t,U){t.default=U}),Y=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var U={};if(null!=t)for(var y in t)"default"!==y&&Object.prototype.hasOwnProperty.call(t,y)&&I(U,t,y);return r(U,t),U};Object.defineProperty(U,"__esModule",{value:!0}),U.HTTP=void 0;const mt=y(13055),X=Y(y(13119));U.HTTP=class{constructor(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=t,this.headers=U}get(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",t,U)}post(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",t,U)}del(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",t,U)}put(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",t,U)}request(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return X[t](this.client.getHttpEndpoint(U),this.getOptions(y)).catch((t=>{var U;const y=t.statusCode,I=(null===(U=t.data)||void 0===U?void 0:U.error)||t.statusMessage||t.message;if(!y&&!I)throw t;throw new mt.ServerError(y,I)}))}getOptions(t){return t.headers=Object.assign({},this.headers,t.headers),this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(t.withCredentials=!0),t}}},13083:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.utf8Length=U.utf8Read=U.ErrorCode=U.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(U.Protocol||(U.Protocol={})),function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(U.ErrorCode||(U.ErrorCode={})),U.utf8Read=function(t,U){const y=t[U++];for(var I="",r=0,Y=U,mt=U+y;Y<mt;Y++){var X=t[Y];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(r=(7&X)<<18|(63&t[++Y])<<12|(63&t[++Y])<<6|63&t[++Y])>=65536?(r-=65536,I+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):I+=String.fromCharCode(r)}else I+=String.fromCharCode((15&X)<<12|(63&t[++Y])<<6|63&t[++Y]);else I+=String.fromCharCode((31&X)<<6|63&t[++Y]);else I+=String.fromCharCode(X)}return I},U.utf8Length=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",U=0,y=0;for(let I=0,r=t.length;I<r;I++)U=t.charCodeAt(I),U<128?y+=1:U<2048?y+=2:U<55296||U>=57344?y+=3:(I++,y+=4);return y+1}},13060:function(t,U,y){"use strict";var I=this&&this.__createBinding||(Object.create?function(t,U,y,I){void 0===I&&(I=y);var r=Object.getOwnPropertyDescriptor(U,y);r&&!("get"in r?!U.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return U[y]}}),Object.defineProperty(t,I,r)}:function(t,U,y,I){void 0===I&&(I=y),t[I]=U[y]}),r=this&&this.__setModuleDefault||(Object.create?function(t,U){Object.defineProperty(t,"default",{enumerable:!0,value:U})}:function(t,U){t.default=U}),Y=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var U={};if(null!=t)for(var y in t)"default"!==y&&Object.prototype.hasOwnProperty.call(t,y)&&I(U,t,y);return r(U,t),U};Object.defineProperty(U,"__esModule",{value:!0}),U.Room=void 0;const mt=Y(y(13064)),X=y(13066),P=y(13083),G=y(13091),M=y(13097),L=y(13106),h=y(13111),Q=y(13055);class F{constructor(t,U){this.onStateChange=(0,L.createSignal)(),this.onError=(0,L.createSignal)(),this.onLeave=(0,L.createSignal)(),this.onJoin=(0,L.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,M.createNanoEvents)(),this.roomId=null,this.name=t,U&&(this.serializer=new((0,G.getSerializer)("schema")),this.rootSchema=U,this.serializer.state=new U),this.onError(((t,U)=>{var y;return null===(y=console.warn)||void 0===y?void 0:y.call(console,`colyseus.js - onError => (${t}) ${U}`)})),this.onLeave((()=>this.XU()))}get id(){return this.roomId}connect(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,I=arguments.length>3?arguments[3]:void 0;const r=new X.Connection;y.connection=r,r.events.onmessage=F.prototype.onMessageCallback.bind(y),r.events.onclose=function(t){var I;if(!y.hasJoined)return null===(I=console.warn)||void 0===I||I.call(console,`Room connection was closed unexpectedly (${t.code}): ${t.reason}`),void y.onError.invoke(t.code,t.reason);t.code===Q.CloseCode.DEVMODE_RESTART&&U?U():(y.onLeave.invoke(t.code,t.reason),y.destroy())},r.events.onerror=function(t){var U;null===(U=console.warn)||void 0===U||U.call(console,`Room, onError (${t.code}): ${t.reason}`),y.onError.invoke(t.code,t.reason)},r.connect(t,I)}PX(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((U=>{this.onLeave((t=>U(t))),this.connection?t?this.connection.send([P.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Q.CloseCode.CONSENTED)}))}nU(t,U){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),U)}send(t,U){const y=[P.Protocol.ROOM_DATA];let I;if("string"===typeof t?h.encode.string(y,t):h.encode.number(y,t),void 0!==U){const t=mt.encode(U);I=new Uint8Array(y.length+t.byteLength),I.set(new Uint8Array(y),0),I.set(new Uint8Array(t),y.length)}else I=new Uint8Array(y);this.connection.send(I.buffer)}sP(t,U){const y=[P.Protocol.ROOM_DATA_BYTES];let I;"string"===typeof t?h.encode.string(y,t):h.encode.number(y,t),I=new Uint8Array(y.length+(U.byteLength||U.length)),I.set(new Uint8Array(y),0),I.set(new Uint8Array(U),y.length),this.connection.send(I.buffer)}get state(){return this.serializer.getState()}XU(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(t){const U=Array.from(new Uint8Array(t.data)),y=U[0];if(y===P.Protocol.JOIN_ROOM){let t=1;const y=(0,P.utf8Read)(U,t);if(t+=(0,P.utf8Length)(y),this.serializerId=(0,P.utf8Read)(U,t),t+=(0,P.utf8Length)(this.serializerId),!this.serializer){const t=(0,G.getSerializer)(this.serializerId);this.serializer=new t}U.length>t&&this.serializer.handshake&&this.serializer.handshake(U,{offset:t}),this.reconnectionToken=`${this.roomId}:${y}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([P.Protocol.JOIN_ROOM])}else if(y===P.Protocol.ERROR){const t={offset:1},y=h.decode.number(U,t),I=h.decode.string(U,t);this.onError.invoke(y,I)}else if(y===P.Protocol.LEAVE_ROOM)this.PX();else if(y===P.Protocol.ROOM_DATA_SCHEMA){const t={offset:1},y=this.serializer.getState().constructor._context.get(h.decode.number(U,t)),I=new y;I.decode(U,t),this.dispatchMessage(y,I)}else if(y===P.Protocol.ROOM_STATE)U.shift(),this.setState(U);else if(y===P.Protocol.ROOM_STATE_PATCH)U.shift(),this.patch(U);else if(y===P.Protocol.ROOM_DATA){const y={offset:1},I=h.decode.stringCheck(U,y)?h.decode.string(U,y):h.decode.number(U,y),r=U.length>y.offset?mt.decode(t.data,y.offset):void 0;this.dispatchMessage(I,r)}else if(y===P.Protocol.ROOM_DATA_BYTES){const t={offset:1},y=h.decode.stringCheck(U,t)?h.decode.string(U,t):h.decode.number(U,t);this.dispatchMessage(y,new Uint8Array(U.slice(t.offset)))}}setState(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())}patch(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(t,U){var y;const I=this.getMessageHandlerKey(t);this.onMessageHandlers.events[I]?this.onMessageHandlers.emit(I,U):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,U):null===(y=console.warn)||void 0===y||y.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"function":return`$${t._typeid}`;case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}}U.Room=F},13126:(t,U)=>{"use strict";let y;function I(){if(!y)try{y="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(t){}return y||(y={cache:{},setItem:function(t,U){this.cache[t]=U},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),y}Object.defineProperty(U,"__esModule",{value:!0}),U.getItem=U.removeItem=U.setItem=void 0,U.setItem=function(t,U){I().setItem(t,U)},U.removeItem=function(t){I().removeItem(t)},U.getItem=function(t,U){const y=I().getItem(t);"undefined"!==typeof Promise&&y instanceof Promise?y.then((t=>U(t))):U(y)}},13097:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createNanoEvents=void 0;U.createNanoEvents=()=>({emit(t){let U=this.events[t]||[];for(var y=arguments.length,I=new Array(y>1?y-1:0),r=1;r<y;r++)I[r-1]=arguments[r];for(let Y=0,mt=U.length;Y<mt;Y++)U[Y](...I)},events:{},on(t,U){var y;return(null===(y=this.events[t])||void 0===y?void 0:y.push(U))||(this.events[t]=[U]),()=>{var y;this.events[t]=null===(y=this.events[t])||void 0===y?void 0:y.filter((t=>U!==t))}}})},13106:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createSignal=U.EventEmitter=void 0;class y{constructor(){this.handlers=[]}register(t){return this.handlers.push(t),this}invoke(){for(var t=arguments.length,U=new Array(t),y=0;y<t;y++)U[y]=arguments[y];this.handlers.forEach((t=>t.apply(this,U)))}invokeAsync(){for(var t=arguments.length,U=new Array(t),y=0;y<t;y++)U[y]=arguments[y];return Promise.all(this.handlers.map((t=>t.apply(this,U))))}remove(t){const U=this.handlers.indexOf(t);this.handlers[U]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}U.EventEmitter=y,U.createSignal=function(){const t=new y;function U(U){return t.register(U,null===this)}return U.once=U=>{const y=function(){for(var I=arguments.length,r=new Array(I),Y=0;Y<I;Y++)r[Y]=arguments[Y];U.apply(this,r),t.remove(y)};t.register(y)},U.remove=U=>t.remove(U),U.invoke=function(){return t.invoke(...arguments)},U.invokeAsync=function(){return t.invokeAsync(...arguments)},U.clear=()=>t.clear(),U}},13055:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ServerError=U.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(U.CloseCode||(U.CloseCode={}));class y extends Error{constructor(t,U){super(U),this.name="ServerError",this.code=t}}U.ServerError=y},13041:(t,U,y)=>{"use strict";U.c=void 0,y(13044);var I=y(13049);Object.defineProperty(U,"c",{enumerable:!0,get:function(){return I.Client}});var r=y(13083);var Y=y(13060);var mt=y(13124);const X=y(13141);const P=y(13147),G=y(13091);(0,G.registerSerializer)("schema",X.SchemaSerializer),(0,G.registerSerializer)("none",P.NoneSerializer)},13044:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=t=>null!==t&&"object"===typeof t&&t.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13064:(t,U)=>{"use strict";function y(t,U){if(this._offset=U,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}Object.defineProperty(U,"__esModule",{value:!0}),U.decode=U.encode=void 0,y.prototype._array=function(t){for(var U=new Array(t),y=0;y<t;y++)U[y]=this._parse();return U},y.prototype._map=function(t){for(var U={},y=0;y<t;y++)U[this._parse()]=this._parse();return U},y.prototype._str=function(t){var U=function(t,U,y){for(var I="",r=0,Y=U,mt=U+y;Y<mt;Y++){var X=t.getUint8(Y);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(r=(7&X)<<18|(63&t.getUint8(++Y))<<12|(63&t.getUint8(++Y))<<6|63&t.getUint8(++Y))>=65536?(r-=65536,I+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):I+=String.fromCharCode(r)}else I+=String.fromCharCode((15&X)<<12|(63&t.getUint8(++Y))<<6|63&t.getUint8(++Y));else I+=String.fromCharCode((31&X)<<6|63&t.getUint8(++Y));else I+=String.fromCharCode(X)}return I}(this._view,this._offset,t);return this._offset+=t,U},y.prototype._bin=function(t){var U=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,U},y.prototype._parse=function(){var t,U=this._view.getUint8(this._offset++),y=0,I=0,r=0,Y=0;if(U<192)return U<128?U:U<144?this._map(15&U):U<160?this._array(15&U):this._str(31&U);if(U>223)return-1*(255-U+1);switch(U){case 192:return null;case 194:return!1;case 195:return!0;case 196:return y=this._view.getUint8(this._offset),this._offset+=1,this._bin(y);case 197:return y=this._view.getUint16(this._offset),this._offset+=2,this._bin(y);case 198:return y=this._view.getUint32(this._offset),this._offset+=4,this._bin(y);case 199:if(y=this._view.getUint8(this._offset),I=this._view.getInt8(this._offset+1),this._offset+=2,-1===I){var mt=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),Y=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*r+Y)+mt/1e6)}return[I,this._bin(y)];case 200:return y=this._view.getUint16(this._offset),I=this._view.getInt8(this._offset+2),this._offset+=3,[I,this._bin(y)];case 201:return y=this._view.getUint32(this._offset),I=this._view.getInt8(this._offset+4),this._offset+=5,[I,this._bin(y)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return r=this._view.getUint32(this._offset)*Math.pow(2,32),Y=this._view.getUint32(this._offset+4),this._offset+=8,r+Y;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return r=this._view.getInt32(this._offset)*Math.pow(2,32),Y=this._view.getUint32(this._offset+4),this._offset+=8,r+Y;case 212:return I=this._view.getInt8(this._offset),this._offset+=1,0===I?void(this._offset+=1):[I,this._bin(1)];case 213:return I=this._view.getInt8(this._offset),this._offset+=1,[I,this._bin(2)];case 214:return I=this._view.getInt8(this._offset),this._offset+=1,-1===I?(t=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*t)):[I,this._bin(4)];case 215:return I=this._view.getInt8(this._offset),this._offset+=1,0===I?(r=this._view.getInt32(this._offset)*Math.pow(2,32),Y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+Y)):-1===I?(r=this._view.getUint32(this._offset),Y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&r)+Y)+(r>>>2)/1e6)):[I,this._bin(8)];case 216:return I=this._view.getInt8(this._offset),this._offset+=1,[I,this._bin(16)];case 217:return y=this._view.getUint8(this._offset),this._offset+=1,this._str(y);case 218:return y=this._view.getUint16(this._offset),this._offset+=2,this._str(y);case 219:return y=this._view.getUint32(this._offset),this._offset+=4,this._str(y);case 220:return y=this._view.getUint16(this._offset),this._offset+=2,this._array(y);case 221:return y=this._view.getUint32(this._offset),this._offset+=4,this._array(y);case 222:return y=this._view.getUint16(this._offset),this._offset+=2,this._map(y);case 223:return y=this._view.getUint32(this._offset),this._offset+=4,this._map(y)}throw new Error("Could not parse")},U.decode=function(t){var U=new y(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),I=U._parse();if(U._offset!==t.byteLength)throw new Error(t.byteLength-U._offset+" trailing bytes");return I};function I(t,U,y){for(var I=0,r=0,Y=y.length;r<Y;r++)(I=y.charCodeAt(r))<128?t.setUint8(U++,I):I<2048?(t.setUint8(U++,192|I>>6),t.setUint8(U++,128|63&I)):I<55296||I>=57344?(t.setUint8(U++,224|I>>12),t.setUint8(U++,128|I>>6&63),t.setUint8(U++,128|63&I)):(r++,I=65536+((1023&I)<<10|1023&y.charCodeAt(r)),t.setUint8(U++,240|I>>18),t.setUint8(U++,128|I>>12&63),t.setUint8(U++,128|I>>6&63),t.setUint8(U++,128|63&I))}function r(t,U,y){var I=typeof y,Y=0,mt=0,X=0,P=0,G=0,M=0;if("string"===I){if(G=function(t){for(var U=0,y=0,I=0,r=t.length;I<r;I++)(U=t.charCodeAt(I))<128?y+=1:U<2048?y+=2:U<55296||U>=57344?y+=3:(I++,y+=4);return y}(y),G<32)t.push(160|G),M=1;else if(G<256)t.push(217,G),M=2;else if(G<65536)t.push(218,G>>8,G),M=3;else{if(!(G<4294967296))throw new Error("String too long");t.push(219,G>>24,G>>16,G>>8,G),M=5}return U.push({_str:y,_length:G,_offset:t.length}),M+G}if("number"===I)return Math.floor(y)===y&&isFinite(y)?y>=0?y<128?(t.push(y),1):y<256?(t.push(204,y),2):y<65536?(t.push(205,y>>8,y),3):y<4294967296?(t.push(206,y>>24,y>>16,y>>8,y),5):(X=y/Math.pow(2,32)|0,P=y>>>0,t.push(207,X>>24,X>>16,X>>8,X,P>>24,P>>16,P>>8,P),9):y>=-32?(t.push(y),1):y>=-128?(t.push(208,y),2):y>=-32768?(t.push(209,y>>8,y),3):y>=-2147483648?(t.push(210,y>>24,y>>16,y>>8,y),5):(X=Math.floor(y/Math.pow(2,32)),P=y>>>0,t.push(211,X>>24,X>>16,X>>8,X,P>>24,P>>16,P>>8,P),9):(t.push(203),U.push({_float:y,_length:8,_offset:t.length}),9);if("object"===I){if(null===y)return t.push(192),1;if(Array.isArray(y)){if((G=y.length)<16)t.push(144|G),M=1;else if(G<65536)t.push(220,G>>8,G),M=3;else{if(!(G<4294967296))throw new Error("Array too large");t.push(221,G>>24,G>>16,G>>8,G),M=5}for(Y=0;Y<G;Y++)M+=r(t,U,y[Y]);return M}if(y instanceof Date){var L=y.getTime(),h=Math.floor(L/1e3),Q=1e6*(L-1e3*h);return h>=0&&Q>=0&&h<=17179869183?0===Q&&h<=4294967295?(t.push(214,255,h>>24,h>>16,h>>8,h),6):(X=h/4294967296,P=4294967295&h,t.push(215,255,Q>>22,Q>>14,Q>>6,X,P>>24,P>>16,P>>8,P),10):(X=Math.floor(h/4294967296),P=h>>>0,t.push(199,12,255,Q>>24,Q>>16,Q>>8,Q,X>>24,X>>16,X>>8,X,P>>24,P>>16,P>>8,P),15)}if(y instanceof ArrayBuffer){if((G=y.byteLength)<256)t.push(196,G),M=2;else if(G<65536)t.push(197,G>>8,G),M=3;else{if(!(G<4294967296))throw new Error("Buffer too large");t.push(198,G>>24,G>>16,G>>8,G),M=5}return U.push({_bin:y,_length:G,_offset:t.length}),M+G}if("function"===typeof y.toJSON)return r(t,U,y.toJSON());var F=[],E="",w=Object.keys(y);for(Y=0,mt=w.length;Y<mt;Y++)void 0!==y[E=w[Y]]&&"function"!==typeof y[E]&&F.push(E);if((G=F.length)<16)t.push(128|G),M=1;else if(G<65536)t.push(222,G>>8,G),M=3;else{if(!(G<4294967296))throw new Error("Object too large");t.push(223,G>>24,G>>16,G>>8,G),M=5}for(Y=0;Y<G;Y++)M+=r(t,U,E=F[Y]),M+=r(t,U,y[E]);return M}if("boolean"===I)return t.push(y?195:194),1;if("undefined"===I)return t.push(192),1;if("function"===typeof y.toJSON)return r(t,U,y.toJSON());throw new Error("Could not encode")}U.encode=function(t){var U=[],y=[],Y=r(U,y,t),mt=new ArrayBuffer(Y),X=new DataView(mt),P=0,G=0,M=-1;y.length>0&&(M=y[0]._offset);for(var L,h=0,Q=0,F=0,E=U.length;F<E;F++)if(X.setUint8(G+F,U[F]),F+1===M){if(h=(L=y[P])._length,Q=G+M,L._bin)for(var w=new Uint8Array(L._bin),D=0;D<h;D++)X.setUint8(Q+D,w[D]);else L._str?I(X,Q,L._str):void 0!==L._float&&X.setFloat64(Q,L._float);G+=h,y[++P]&&(M=y[P]._offset)}return mt}},13147:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NoneSerializer=void 0;U.NoneSerializer=class{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}},13141:(t,U,y)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.SchemaSerializer=void 0;const I=y(13111);U.SchemaSerializer=class{setState(t){return this.state.decode(t)}getState(){return this.state}patch(t){return this.state.decode(t)}teardown(){var t,U;null===(U=null===(t=this.state)||void 0===t?void 0:t.$changes)||void 0===U||U.root.clearRefs()}handshake(t,U){if(this.state){(new I.Reflection).decode(t,U)}else this.state=I.Reflection.decode(t,U)}}},13091:(t,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getSerializer=U.registerSerializer=void 0;const y={};U.registerSerializer=function(t,U){y[t]=U},U.getSerializer=function(t){const U=y[t];if(!U)throw new Error("missing serializer: "+t);return U}},13072:function(t,U,y){"use strict";var I=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(U,"__esModule",{value:!0}),U.WebSocketTransport=void 0;const r=I(y(13079)),Y=globalThis.WebSocket||r.default;U.WebSocketTransport=class{constructor(t){this.events=t}send(t){t instanceof ArrayBuffer?this.ws.send(t):Array.isArray(t)&&this.ws.send(new Uint8Array(t).buffer)}connect(t,U){try{this.ws=new Y(t,{headers:U,protocols:this.protocols})}catch(y){this.ws=new Y(t,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,U){this.ws.close(t,U)}get isOpen(){return this.ws.readyState===Y.OPEN}}},13079:t=>{"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14138:t=>{"use strict";function U(t,y,I){var r=0|t[I];if(r<=0)return[];var Y,mt=new Array(r);if(I===t.length-1)for(Y=0;Y<r;++Y)mt[Y]=y;else for(Y=0;Y<r;++Y)mt[Y]=U(t,y,I+1);return mt}t.exports=function(t,y){switch("undefined"===typeof y&&(y=0),typeof t){case"number":if(t>0)return function(t,U){var y,I;for(y=new Array(t),I=0;I<t;++I)y[I]=U;return y}(0|t,y);break;case"object":if("number"===typeof t.length)return U(t,y,0)}return[]}},14081:(t,U,y)=>{t.exports=function(){var t=this;this.components={},this.comps=this.components;var U=this.components,y=1,r={},Y=[],mt=[],X={timeout:!1,removals:[],multiComps:[]};function P(t,y){var I=U[y],Y=r[y],mt=Y.hash[t];mt&&(Y.remove(t),I.py&&(I.multi?(mt.forEach((U=>{U&&I.py(t,U)})),mt.length=0):I.py(t,mt)),X.removals.push(Y),G())}function G(){X.timeout||(X.timeout=!0,setTimeout(M,1))}function M(){X.timeout=!1,L()}function L(){X.multiComps.length&&function(t){for(var U=0;U<t.length;U++){var{entID:y,data:I}=t[U],r=I.hash[y];if(r){for(var Y=0;Y<r.length;Y++)r[Y]||(r.splice(Y,1),Y--);0===r.length&&(I.remove(y),X.removals.push(I))}}t.length=0}(X.multiComps),X.removals.length&&function(t){for(var U=0;U<t.length;U++){t[U].flush()}t.length=0}(X.removals)}this.bL=r,this._systems=Y,this._renderSystems=mt,this.GM=function(U){var I=y++;return Array.isArray(U)&&U.forEach((U=>t.WP(I,U))),I},this.deleteEntity=function(U){return Object.keys(r).forEach((t=>{r[t].hash[U]&&P(U,t)})),t},this.fM=function(t){if(!t)throw new Error("Missing component definition");var y=t.name;if(!y)throw new Error("Component definition must have a name property.");if("string"!==typeof y)throw new Error("Component name must be a string.");if(""===y)throw new Error("Component name must be a non-empty string.");if(r[y])throw new Error(`Component ${y} already exists.`);var X={};return X.name=y,X.multi=!!t.multi,X.order=isNaN(t.order)?99:t.order,X.stateConstructor=t.stateConstructor||null,X.state=t.state||{},X.xX=t.xX||null,X.py=t.py||null,X.system=t.system||null,X.RX=t.RX||null,U[y]=X,r[y]=new I,r[y]._pendingMultiCleanup=!1,r[y]._multiCleanupIDs=X.multi?[]:null,X.system&&(Y.push(y),Y.sort(((t,y)=>U[t].order-U[y].order))),X.RX&&(mt.push(y),mt.sort(((t,y)=>U[t].order-U[y].order))),y},this.overwriteComponent=function(t,y){var I=U[t];if(!I)throw new Error(`Unknown component: ${t}`);if(!y)throw new Error("Missing component definition");if(I.name!==y.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=t,X.multi=!!y.multi,X.order=isNaN(y.order)?99:y.order,X.state=y.state||{},X.xX=y.xX||null,X.py=y.py||null,X.system=y.system||null,X.RX=y.RX||null,U[t]=X,r[t]._pendingMultiCleanup=!1,r[t]._multiCleanupIDs=X.multi?[]:null;var P=Y.indexOf(t);X.system&&P<0&&Y.push(t),!X.system&&P>=0&&Y.splice(P,1),Y.sort(((t,y)=>U[t].order-U[y].order));var G=mt.indexOf(t);X.RX&&G<0&&mt.push(t),!X.RX&&G>=0&&mt.splice(G,1),mt.sort(((t,y)=>U[t].order-U[y].order));var M=X.state;return this.xG(t).forEach((t=>{for(var U in M)U in t||(t[U]=M[U]);X.xX&&X.xX(t.KX,t)})),t},this.deleteComponent=function(y){var I=r[y];if(!I)throw new Error(`Unknown component: ${y}`);I.flush(),I.list.forEach((t=>{t&&P(t.KX||t[0].KX,y)}));var X=Y.indexOf(y),G=mt.indexOf(y);return X>-1&&Y.splice(X,1),G>-1&&mt.splice(G,1),r[y].dispose(),delete r[y],delete U[y],t},this.WP=function(t,y,I){var Y,mt=U[y],X=r[y];if(!X)throw new Error(`Unknown component: ${y}.`);if(X.hash[t]&&!mt.multi)throw new Error(`Entity ${t} already has component: ${y}.`);if(mt.stateConstructor){if(!(Y=new mt.stateConstructor).hasOwnProperty("KX"))throw new Error(`Component ${mt.name} stateConstructor type does not have property __id`)}else Y=Object.assign({},{KX:t},mt.state,I);if(Y.KX=t,mt.multi){var P=X.hash[t];P||(P=[],X.add(t,P)),P.push(Y)}else X.add(t,Y);return mt.xX&&mt.xX(t,Y),this},this.yG=function(t,U){var y=r[U];if(!y)throw new Error(`Unknown component: ${U}.`);return!!y.hash[t]},this.RP=function(U,y){if(!r[y])throw new Error(`Unknown component: ${y}.`);return P(U,y),t},this.getState=function(t,U){var y=r[U];if(!y)throw new Error(`Unknown component: ${U}.`);return y.hash[t]},this.xG=function(t){var U=r[t];if(!U)throw new Error(`Unknown component: ${t}.`);return L(),U.list},this.JQ=function(t){if(!r[t])throw new Error(`Unknown component: ${t}.`);var U=r[t].hash;return t=>U[t]},this.qQ=function(t){if(!r[t])throw new Error(`Unknown component: ${t}.`);var U=r[t].hash;return t=>!!U[t]},this.MX=function(y){L();for(var I=0;I<Y.length;I++){var mt=Y[I],X=U[mt],P=r[mt];X.system(y,P.list),L()}return t},this.render=function(y){L();for(var I=0;I<mt.length;I++){var Y=mt[I],X=U[Y],P=r[Y];X.RX(y,P.list),L()}return t},this.removeMultiComponent=function(y,I,Y){var mt=U[I],P=r[I];if(!P)throw new Error(`Unknown component: ${I}.`);if(!mt.multi)throw new Error("removeMultiComponent called on non-multi component");return function(t,U,y,I){var r=y.hash[t];if(r){var Y=r[I];Y&&(r[I]=null,U.py&&U.py(t,Y),X.multiComps.push({entID:t,data:y}),G())}}(y,mt,P,Y),t}};var I=y(14088)},14088:t=>{function U(t,U){var y=t._map[U];if(delete t.hash[U],delete t._map[U],y===t.list.length-1)t.list.pop();else{var I=t.list.pop();if(t.list[y]=I,null===I||null===I[0]){var r=t.list.length;for(var Y in t._map)if(t._map[Y]===r)return void(t._map[Y]=y)}else{var mt=I.KX||I[0].KX;t._map[mt]=y}}}t.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(t,U){if("number"===typeof this._map[t]){var y=this._map[t];this.hash[t]=U,this.list[y]=U}else this._map[t]=this.list.length,this.hash[t]=U,this.list.push(U)}remove(t){var U=this._map[t];this.hash[t]=null,this.list[U]=null,this._pendingRemovals.push(t)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var t=0;t<this._pendingRemovals.length;t++){var y=this._pendingRemovals[t];null===this.hash[y]&&U(this,y)}this._pendingRemovals.length=0}}},14351:t=>{"use strict";t.exports=function(t,U,y,I,r,Y){var mt=+U[0],X=+U[1],P=+U[2],G=+y[0],M=+y[1],L=+y[2],h=Math.sqrt(G*G+M*M+L*L);if(0===h)throw new Error("Can't raycast along a zero vector");return function(t,U,y,I,r,Y,mt,X,P,G){for(var M=0,L=Math.floor,h=0|L(U),Q=0|L(y),F=0|L(I),E=r>0?1:-1,w=Y>0?1:-1,D=mt>0?1:-1,l=Math.abs(1/r),g=Math.abs(1/Y),B=Math.abs(1/mt),b=l<1/0?l*(E>0?h+1-U:U-h):1/0,p=g<1/0?g*(w>0?Q+1-y:y-Q):1/0,c=B<1/0?B*(D>0?F+1-I:I-F):1/0,f=-1;M<=X;){var S=t(h,Q,F);if(S)return P&&(P[0]=U+M*r,P[1]=y+M*Y,P[2]=I+M*mt),G&&(G[0]=G[1]=G[2]=0,0===f&&(G[0]=-E),1===f&&(G[1]=-w),2===f&&(G[2]=-D)),S;b<p?b<c?(h+=E,M=b,b+=l,f=0):(F+=D,M=c,c+=B,f=2):p<c?(Q+=w,M=p,p+=g,f=1):(F+=D,M=c,c+=B,f=2)}return P&&(P[0]=U+M*r,P[1]=y+M*Y,P[2]=I+M*mt),G&&(G[0]=G[1]=G[2]=0),0}(t,mt,X,P,G/=h,M/=h,L/=h,I="undefined"===typeof I?64:+I,r,Y)}},14387:(t,U,y)=>{"use strict";y.d(U,{e:()=>Y});var I=y(820);function r(){this.Fh=!1,this.stopPropagation=!1,this.Eh=!1,this.disabled=!1}class Y{constructor(t,U){this.version="0.7.0";var y=Object.assign({},new r,U||{});this.element=t||document,this.Fh=!!y.Fh,this.stopPropagation=!!y.stopPropagation,this.Eh=!!y.Eh,this.disabled=!!y.disabled,this.filterEvents=(t,U)=>!0,this.down=new I.EventEmitter,this.up=new I.EventEmitter,this.state={},this.nG={dx:0,dy:0,gQ:0,VG:0,BQ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(t=>{X(this)}),{once:!0})}bind(t){for(var U=arguments.length,y=new Array(U>1?U-1:0),I=1;I<U;I++)y[I-1]=arguments[I];y.forEach((U=>{var y=this._keyBindmap[U]||[];y.includes(t)||(y.push(t),this._keyBindmap[U]=y)})),this.state[t]=!!this.state[t],this.pressCount[t]=this.pressCount[t]||0,this.releaseCount[t]=this.releaseCount[t]||0}unbind(t){for(var U in this._keyBindmap){var y=this._keyBindmap[U],I=y.indexOf(t);I>-1&&y.splice(I,1)}}getBindings(){var t={};for(var U in this._keyBindmap){this._keyBindmap[U].forEach((y=>{t[y]=t[y]||[],t[y].push(U)}))}return t}MX(){mt(this.nG),mt(this.pressCount),mt(this.releaseCount)}}function mt(t){for(var U in t)t[U]=0}function X(t){window.addEventListener("keydown",F.bind(null,t,!0),!1),window.addEventListener("keyup",F.bind(null,t,!1),!1);var U={passive:!0};t.element.addEventListener("touchstart",L.bind(void 0,t),{passive:!1}),t.element.addEventListener("touchend",Q.bind(void 0,t),U),t.element.addEventListener("mousedown",E.bind(null,t,!0),U),window.document.addEventListener("mouseup",E.bind(null,t,!1),U),t.element.addEventListener("touchmove",w.bind(null,t),U),t.element.addEventListener("mousemove",w.bind(null,t),U),window.PointerEvent,t.element.addEventListener("wheel",D.bind(null,t),U),t.element.addEventListener("contextmenu",l.bind(null,t),!1),window.addEventListener("blur",g.bind(null,t),!1)}var P=0,G=0,M=null;function L(t,U){U.preventDefault(),h(U)}function h(t){let U=!1;for(let y=0;y<t.touches.length;++y)if(t.touches[y].identifier===M){U=!0;break}if(!U){const U=t.changedTouches[0];P=U.clientX,G=U.clientY,M=U.identifier}}function Q(t,U){for(var y=U.changedTouches,I=0;I<y.length;++I)y[I].identifier===M&&(M=null)}function F(t,U,y){B(y.code,U,t,y)}function E(t,U,y){if("pointerId"in y)if(U){if(null!==t._touches.currID)return;t._touches.currID=y.pointerId}else{if(t._touches.currID!==y.pointerId)return;t._touches.currID=null}return B("Mouse"+("button"in y?y.button+1:1),U,t,y),!1}function w(t,U){var y=U.movementX||U.mozMovementX||0,I=U.movementY||U.mozMovementY||0;if(U.touches&&0===(y|I)){var r=function(t){h(t);for(let U=0;U<t.changedTouches.length;++U)if(t.changedTouches[U].identifier==M){const y=t.changedTouches[U],I=[y.clientX-P,y.clientY-G];return P=y.clientX,G=y.clientY,I}return console.error(`Did not find touch id ${M}`),[0,0]}(U);y=r[0],I=r[1]}t.nG.dx+=y,t.nG.dy+=I}function D(t,U){var y=1;switch(U.deltaMode){case 0:y=1;break;case 1:y=12;break;case 2:y=t.element.clientHeight||window.innerHeight}t.nG.gQ+=(U.deltaX||0)*y,t.nG.VG+=(U.deltaY||0)*y,t.nG.BQ+=(U.deltaZ||0)*y}function l(t,U){if(!t.Eh)return U.preventDefault(),!1}function g(t){for(var U in t._keyStates)t._keyStates[U]&&(/^Mouse\d/.test(U)||B(U,!1,t,{code:U,note:"3nxjcc7tf4u",preventDefault:()=>{},stopPropagation:()=>{}}))}function B(t,U,y,I){var r=y._keyBindmap[t];r&&(b(y._keyStates[t],U)&&(y._keyStates[t]=U,r.forEach((t=>{(!y.filterEvents||y.filterEvents(I,t))&&function(t,U,y,I){var r=U?y.pressCount:y.releaseCount;r[t]=(r[t]||0)+1;var Y=y._bindPressCount[t]||0;(Y+=U?1:-1)<0&&(Y=0);y._bindPressCount[t]=Y;var mt=y.state[t];if(b(mt,Y)){y.state[t]=Y>0;var X=U?y.down:y.up;y.disabled||X.emit(t,I)}}(t,U,y,I)}))),"button"in I||(y.Fh&&!I.defaultPrevented&&I.preventDefault(),y.stopPropagation&&I.stopPropagation()))}function b(t,U){return t?!U:U}},13269:t=>{"use strict";t.exports=function(t){for(var U=new Array(t),y=0;y<t;++y)U[y]=y;return U}},13272:t=>{function U(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(U(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&U(t.slice(0,0))}(t)||!!t._isBuffer)}},14356:(t,U,y)=>{"use strict";y.d(U,{c:()=>I});class I{constructor(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.WM=!1,this.AM=!1,this.xM=30,this.ZM=0,this.UL=!1,this.fullscreen=!1,this.CM=function(t){},this.RM=function(){},this.zM=function(){},this.ny=function(){},this.uM=function(t){},this.onFullscreenChanged=function(t){},G((()=>{!function(t,U){t._nowObject=performance||Date,t._lastTick=0,t._renderAccum=0,t._rt=0,t._frameCB=X.bind(null,t),requestAnimationFrame(t._frameCB),U>0&&(t._intervalCB=mt.bind(null,t),t._interval=setInterval(t._intervalCB,Math.max(U,1e3/t.xM/2)))}(this,U),function(t,U){if(!U)return;var y=!1,I=!1;document.addEventListener("pointerlockchange",(I=>{y=document.pointerLockElement===U,t.uM(y)})),document.addEventListener("fullscreenchange",(y=>{I=document.fullscreenElement===U,t.onFullscreenChanged(I)})),Object.defineProperty(t,"UL",{get:()=>y,set:t=>{t&&!y?P(U):y&&!t&&function(t){t.exitPointerLock&&t.exitPointerLock()}(document)}}),Object.defineProperty(t,"fullscreen",{get:()=>I,set:t=>{t&&!I?U.requestFullscreen():I&&!t&&document.exitFullscreen()}}),U.addEventListener("click",(r=>{t.WM&&!y&&P(U),t.AM&&!I&&U.requestFullscreen()}));var r=()=>t.ny();if(window.ResizeObserver){new ResizeObserver(r).observe(U)}else window.addEventListener("resize",r)}(this,t),this.zM()}))}}var r=3,Y=20;function mt(t){for(var U=1e3/t.xM,y=t._nowObject.now()+Y,I=0;t._nowObject.now()>=t._lastTick+U&&t._nowObject.now()<y&&++I<=r;)t.CM(U),t._lastTick+=U;var mt=5*(U+5),X=t._nowObject.now();if(X-t._lastTick>mt)for(;X>=t._lastTick+U;)t._lastTick+=U}function X(t){requestAnimationFrame(t._frameCB),mt(t);var U=t._nowObject.now(),y=U-t._rt;if(t._rt=U,t.ZM>0){t._renderAccum+=y;var I=1e3/t.ZM;if(t._renderAccum<I)return;t._renderAccum=Math.min(t._renderAccum-I,I)}var r=1e3/t.xM,Y=(U-t._lastTick)/r;t.RM(y,Y,r)}function P(t){t.requestPointerLock&&t.requestPointerLock()}var G=t=>{if("loading"===document.readyState){var U=()=>{document.removeEventListener("readystatechange",U),t()};document.addEventListener("readystatechange",U)}else setTimeout(t,1)}},13265:(t,U,y)=>{var I=y(13269),r=y(13272),Y="undefined"!==typeof Float64Array;function mt(t,U){return t[0]-U[0]}function X(){var t,U=this.stride,y=new Array(U.length);for(t=0;t<y.length;++t)y[t]=[Math.abs(U[t]),t];y.sort(mt);var I=new Array(y.length);for(t=0;t<I.length;++t)I[t]=y[t][1];return I}function P(t,U){var y=["View",U,"d",t].join("");U<0&&(y="View_Nil"+t);var r="generic"===t;if(-1===U){var Y="function "+y+"(a){this.data=a;};var proto="+y+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+y+"(a){return new "+y+"(a);}";return new Function(Y)()}if(0===U){Y="function "+y+"(a,d) {this.data = a;this.offset = d};var proto="+y+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+y+"_copy() {return new "+y+"(this.data,this.offset)};proto.pick=function "+y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+y+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+y+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+y+"(a,b,c,d){return new "+y+"(a,d)}";return new Function("TrivialArray",Y)(G[t][0])}Y=["'use strict'"];var mt=I(U),P=mt.map((function(t){return"i"+t})),M="this.offset+"+mt.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),L=mt.map((function(t){return"b"+t})).join(","),h=mt.map((function(t){return"c"+t})).join(",");Y.push("function "+y+"(a,"+L+","+h+",d){this.data=a","this.shape=["+L+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+y+".prototype","proto.dtype='"+t+"'","proto.dimension="+U),Y.push("Object.defineProperty(proto,'size',{get:function "+y+"_size(){return "+mt.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===U?Y.push("proto.order=[0]"):(Y.push("Object.defineProperty(proto,'order',{get:"),U<4?(Y.push("function "+y+"_order(){"),2===U?Y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&Y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Y.push("ORDER})")),Y.push("proto.set=function "+y+"_set("+P.join(",")+",v){"),r?Y.push("return this.data.set("+M+",v)}"):Y.push("return this.data["+M+"]=v}"),Y.push("proto.get=function "+y+"_get("+P.join(",")+"){"),r?Y.push("return this.data.get("+M+")}"):Y.push("return this.data["+M+"]}"),Y.push("proto.index=function "+y+"_index(",P.join(),"){return "+M+"}"),Y.push("proto.hi=function "+y+"_hi("+P.join(",")+"){return new "+y+"(this.data,"+mt.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+mt.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var Q=mt.map((function(t){return"a"+t+"=this.shape["+t+"]"})),F=mt.map((function(t){return"c"+t+"=this.stride["+t+"]"}));Y.push("proto.lo=function "+y+"_lo("+P.join(",")+"){var b=this.offset,d=0,"+Q.join(",")+","+F.join(","));for(var E=0;E<U;++E)Y.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");Y.push("return new "+y+"(this.data,"+mt.map((function(t){return"a"+t})).join(",")+","+mt.map((function(t){return"c"+t})).join(",")+",b)}"),Y.push("proto.step=function "+y+"_step("+P.join(",")+"){var "+mt.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+mt.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<U;++E)Y.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");Y.push("return new "+y+"(this.data,"+mt.map((function(t){return"a"+t})).join(",")+","+mt.map((function(t){return"b"+t})).join(",")+",c)}");var w=new Array(U),D=new Array(U);for(E=0;E<U;++E)w[E]="a[i"+E+"]",D[E]="b[i"+E+"]";Y.push("proto.transpose=function "+y+"_transpose("+P+"){"+P.map((function(t,U){return t+"=("+t+"===undefined?"+U+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+y+"(this.data,"+w.join(",")+","+D.join(",")+",this.offset)}"),Y.push("proto.pick=function "+y+"_pick("+P+"){var a=[],b=[],c=this.offset");for(E=0;E<U;++E)Y.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return Y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Y.push("return function construct_"+y+"(data,shape,stride,offset){return new "+y+"(data,"+mt.map((function(t){return"shape["+t+"]"})).join(",")+","+mt.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Y.join("\n"))(G[t],X)}var G={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,U,y,I){if(void 0===t)return(0,G.array[0])([]);"number"===typeof t&&(t=[t]),void 0===U&&(U=[t.length]);var mt=U.length;if(void 0===y){y=new Array(mt);for(var X=mt-1,M=1;X>=0;--X)y[X]=M,M*=U[X]}if(void 0===I){I=0;for(X=0;X<mt;++X)y[X]<0&&(I-=(U[X]-1)*y[X])}for(var L=function(t){if(r(t))return"buffer";if(Y)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),h=G[L];h.length<=mt+1;)h.push(P(L,h.length-1));return(0,h[mt+1])(t,U,y,I)}},14237:t=>{var U;self,U=()=>(()=>{"use strict";var t={d:(U,y)=>{for(var I in y)t.o(y,I)&&!t.o(U,I)&&Object.defineProperty(U,I,{enumerable:!0,get:y[I]})},o:(t,U)=>Object.prototype.hasOwnProperty.call(t,U)},U={};t.d(U,{default:()=>H});var y,I=function(t,U){var y=U.x-t.x,I=U.y-t.y;return Math.sqrt(y*y+I*I)},r=function(t){return t*(Math.PI/180)},Y=new Map,mt=function(t){Y.has(t)&&clearTimeout(Y.get(t)),Y.set(t,setTimeout(t,100))},X=function(t,U,y){for(var I,r=U.split(/[ ,]+/g),Y=0;Y<r.length;Y+=1)I=r[Y],t.addEventListener?t.addEventListener(I,y,!1):t.attachEvent&&t.attachEvent(I,y)},P=function(t,U,y){for(var I,r=U.split(/[ ,]+/g),Y=0;Y<r.length;Y+=1)I=r[Y],t.removeEventListener?t.removeEventListener(I,y):t.detachEvent&&t.detachEvent(I,y)},G=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},M=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},L=function(t,U){U.top||U.right||U.bottom||U.left?(t.style.top=U.top,t.style.right=U.right,t.style.bottom=U.bottom,t.style.left=U.left):(t.style.left=U.x+"px",t.style.top=U.y+"px")},h=function(t,U,y){var I=Q(t);for(var r in I)if(I.hasOwnProperty(r))if("string"==typeof U)I[r]=U+" "+y;else{for(var Y="",mt=0,X=U.length;mt<X;mt+=1)Y+=U[mt]+" "+y+", ";I[r]=Y.slice(0,-2)}return I},Q=function(t){var U={};return U[t]="",["webkit","Moz","o"].forEach((function(y){U[y+t.charAt(0).toUpperCase()+t.slice(1)]=""})),U},F=function(t,U){for(var y in U)U.hasOwnProperty(y)&&(t[y]=U[y]);return t},E=function(t,U){if(t.length)for(var y=0,I=t.length;y<I;y+=1)U(t[y]);else U(t)},w="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,D=window.matchMedia("(any-hover: none)").matches,l=!!("ontouchstart"in window),g=!!window.PointerEvent,B=!!window.MSPointerEvent,b={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},p={start:"mousedown",move:"mousemove",end:"mouseup"},c={};function f(){}w&&!D?y=b:g?y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:B?y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:l?(y=b,c=p):y=p,f.prototype.on=function(t,U){var y,I=this,r=t.split(/[ ,]+/g);I._handlers_=I._handlers_||{};for(var Y=0;Y<r.length;Y+=1)y=r[Y],I._handlers_[y]=I._handlers_[y]||[],I._handlers_[y].push(U);return I},f.prototype.off=function(t,U){var y=this;return y._handlers_=y._handlers_||{},void 0===t?y._handlers_={}:void 0===U?y._handlers_[t]=null:y._handlers_[t]&&y._handlers_[t].indexOf(U)>=0&&y._handlers_[t].splice(y._handlers_[t].indexOf(U),1),y},f.prototype.trigger=function(t,U){var y,I=this,r=t.split(/[ ,]+/g);I._handlers_=I._handlers_||{};for(var Y=0;Y<r.length;Y+=1)y=r[Y],I._handlers_[y]&&I._handlers_[y].length&&I._handlers_[y].forEach((function(t){t.call(I,{type:y,target:I},U)}))},f.prototype.config=function(t){var U=this;U.options=U.defaults||{},t&&(U.options=function(t,U){var y={};for(var I in t)t.hasOwnProperty(I)&&U.hasOwnProperty(I)?y[I]=U[I]:t.hasOwnProperty(I)&&(y[I]=t[I]);return y}(U.options,t))},f.prototype.bindEvt=function(t,U){var I=this;return I._domHandlers_=I._domHandlers_||{},I._domHandlers_[U]=function(){"function"==typeof I["on"+U]?I["on"+U].apply(I,arguments):console.warn('[WARNING] : Missing "on'+U+'" handler.')},X(t,y[U],I._domHandlers_[U]),c[U]&&X(t,c[U],I._domHandlers_[U]),I},f.prototype.unbindEvt=function(t,U){var I=this;return I._domHandlers_=I._domHandlers_||{},P(t,y[U],I._domHandlers_[U]),c[U]&&P(t,c[U],I._domHandlers_[U]),delete I._domHandlers_[U],this};const S=f;function N(t,U){return this.identifier=U.identifier,this.position=U.position,this.frontPosition=U.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(U),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=N.id,N.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}N.prototype=new S,N.constructor=N,N.id=0,N.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},N.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",U=function(){var t=Q("borderRadius");for(var U in t)t.hasOwnProperty(U)&&(t[U]="50%");return t}(),y=h("transition","opacity",t),I={};return I.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},I.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},I.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},F(I.el,y),"circle"===this.options.shape&&F(I.back,U),F(I.front,U),this.applyStyles(I),this},N.prototype.applyStyles=function(t){for(var U in this.ui)if(this.ui.hasOwnProperty(U))for(var y in t[U])this.ui[U].style[y]=t[U][y];return this},N.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},N.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},N.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},N.prototype.show=function(t){var U=this;return U.options.dataOnly||(clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.addToDom(),U.restCallback(),setTimeout((function(){U.ui.el.style.opacity=1}),0),U.showTimeout=setTimeout((function(){U.trigger("shown",U.instance),"function"==typeof t&&t.call(this)}),U.options.fadeTime)),U},N.prototype.hide=function(t){var U=this;if(U.options.dataOnly)return U;if(U.ui.el.style.opacity=U.options.restOpacity,clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.removeTimeout=setTimeout((function(){var y="dynamic"===U.options.mode?"none":"block";U.ui.el.style.display=y,"function"==typeof t&&t.call(U),U.trigger("hidden",U.instance)}),U.options.fadeTime),U.options.restJoystick){var y=U.options.restJoystick,I={};I.x=!0===y||!1!==y.x?0:U.instance.frontPosition.x,I.y=!0===y||!1!==y.y?0:U.instance.frontPosition.y,U.setPosition(t,I)}return U},N.prototype.setPosition=function(t,U){var y=this;y.frontPosition={x:U.x,y:U.y};var I=y.options.fadeTime+"ms",r={};r.front=h("transition",["transform"],I);var Y={front:{}};Y.front={transform:"translate("+y.frontPosition.x+"px,"+y.frontPosition.y+"px)"},y.applyStyles(r),y.applyStyles(Y),y.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(y),y.restCallback()}),y.options.fadeTime)},N.prototype.restCallback=function(){var t=this,U={};U.front=h("transition","none",""),t.applyStyles(U),t.trigger("rested",t.instance)},N.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},N.prototype.computeDirection=function(t){var U,y,I,r=t.angle.radian,Y=Math.PI/4,mt=Math.PI/2;if(r>Y&&r<3*Y&&!t.lockX?U="up":r>-Y&&r<=Y&&!t.lockY?U="left":r>3*-Y&&r<=-Y&&!t.lockX?U="down":t.lockY||(U="right"),t.lockY||(y=r>-mt&&r<mt?"left":"right"),t.lockX||(I=r>0?"up":"down"),t.force>this.options.threshold){var X,P={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(P[X]=this.direction[X]);var G={};for(X in this.direction={x:y,y:I,angle:U},t.direction=this.direction,P)P[X]===this.direction[X]&&(G[X]=!0);if(G.x&&G.y&&G.angle)return t;G.x&&G.y||this.trigger("plain",t),G.x||this.trigger("plain:"+y,t),G.y||this.trigger("plain:"+I,t),G.angle||this.trigger("dir dir:"+U,t)}else this.resetDirection();return t};const j=N;function J(t,U){var y=this;y.nipples=[],y.idles=[],y.actives=[],y.ids=[],y.pressureIntervals={},y.manager=t,y.id=J.id,J.id+=1,y.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},y.config(U),"static"!==y.options.mode&&"semi"!==y.options.mode||(y.options.multitouch=!1),y.options.multitouch||(y.options.maxNumberOfNipples=1);var I=getComputedStyle(y.options.zone.parentElement);return I&&"flex"===I.display&&(y.parentIsFlex=!0),y.updateBox(),y.prepareNipples(),y.gh(),y.begin(),y.nipples}J.prototype=new S,J.constructor=J,J.id=0,J.prototype.prepareNipples=function(){var t=this,U=t.nipples;U.on=t.on.bind(t),U.off=t.off.bind(t),U.options=t.options,U.destroy=t.destroy.bind(t),U.ids=t.ids,U.id=t.id,U.processOnMove=t.processOnMove.bind(t),U.processOnEnd=t.processOnEnd.bind(t),U.get=function(t){if(void 0===t)return U[0];for(var y=0,I=U.length;y<I;y+=1)if(U[y].identifier===t)return U[y];return!1}},J.prototype.gh=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},J.prototype.begin=function(){var t=this,U=t.options;if("static"===U.mode){var y=t.createNipple(U.position,t.manager.getIdentifier());y.add(),t.idles.push(y)}},J.prototype.createNipple=function(t,U){var y=this,I=y.manager.scroll,r={},Y=y.options,mt=y.parentIsFlex?I.x:I.x+y.box.left,X=y.parentIsFlex?I.y:I.y+y.box.top;if(t.x&&t.y)r={x:t.x-mt,y:t.y-X};else if(t.top||t.right||t.bottom||t.left){var P=document.createElement("DIV");P.style.display="hidden",P.style.top=t.top,P.style.right=t.right,P.style.bottom=t.bottom,P.style.left=t.left,P.style.position="absolute",Y.zone.appendChild(P);var G=P.getBoundingClientRect();Y.zone.removeChild(P),r=t,t={x:G.left+I.x,y:G.top+I.y}}var M=new j(y,{color:Y.color,size:Y.size,threshold:Y.threshold,fadeTime:Y.fadeTime,dataOnly:Y.dataOnly,restJoystick:Y.restJoystick,restOpacity:Y.restOpacity,mode:Y.mode,identifier:U,position:t,zone:Y.zone,frontPosition:{x:0,y:0},shape:Y.shape});return Y.dataOnly||(L(M.ui.el,r),L(M.ui.front,M.frontPosition)),y.nipples.push(M),y.trigger("added "+M.identifier+":added",M),y.manager.trigger("added "+M.identifier+":added",M),y.bindNipple(M),M},J.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},J.prototype.bindNipple=function(t){var U,y=this,I=function(t,I){U=t.type+" "+I.id+":"+t.type,y.trigger(U,I)};t.on("destroyed",y.onDestroyed.bind(y)),t.on("shown hidden rested dir plain",I),t.on("dir:up dir:right dir:down dir:left",I),t.on("plain:up plain:right plain:down plain:left",I)},J.prototype.pressureFn=function(t,U,y){var I=this,r=0;clearInterval(I.pressureIntervals[y]),I.pressureIntervals[y]=setInterval(function(){var y=t.force||t.pressure||t.webkitForce||0;y!==r&&(U.trigger("pressure",y),I.trigger("pressure "+U.identifier+":pressure",y),r=y)}.bind(I),100)},J.prototype.onstart=function(t){var U=this,y=U.options,I=t;return t=G(t),U.updateBox(),E(t,(function(r){U.actives.length<y.maxNumberOfNipples?U.processOnStart(r):I.type.match(/^touch/)&&(Object.keys(U.manager.ids).forEach((function(y){if(Object.values(I.touches).findIndex((function(t){return t.identifier===y}))<0){var r=[t[0]];r.identifier=y,U.processOnEnd(r)}})),U.actives.length<y.maxNumberOfNipples&&U.processOnStart(r))})),U.manager.bindDocument(),!1},J.prototype.processOnStart=function(t){var U,y=this,r=y.options,Y=y.manager.getIdentifier(t),mt=t.force||t.pressure||t.webkitForce||0,X={x:t.pageX,y:t.pageY},P=y.getOrCreate(Y,X);P.identifier!==Y&&y.manager.removeIdentifier(P.identifier),P.identifier=Y;var G=function(U){U.trigger("start",U),y.trigger("start "+U.id+":start",U),U.show(),mt>0&&y.pressureFn(t,U,U.identifier),y.processOnMove(t)};if((U=y.idles.indexOf(P))>=0&&y.idles.splice(U,1),y.actives.push(P),y.ids.push(P.identifier),"semi"!==r.mode)G(P);else{if(!(I(X,P.position)<=r.catchDistance))return P.destroy(),void y.processOnStart(t);G(P)}return P},J.prototype.getOrCreate=function(t,U){var y,I=this,r=I.options;return/(semi|static)/.test(r.mode)?(y=I.idles[0])?(I.idles.splice(0,1),y):"semi"===r.mode?I.createNipple(U,t):(console.warn("Coudln't find the needed nipple."),!1):y=I.createNipple(U,t)},J.prototype.processOnMove=function(t){var U=this,y=U.options,Y=U.manager.getIdentifier(t),mt=U.nipples.get(Y),X=U.manager.scroll;if(function(t){return isNaN(t.buttons)?0!==t.pressure:0!==t.buttons}(t)){if(!mt)return console.error("Found zombie joystick with ID "+Y),void U.manager.removeIdentifier(Y);if(y.dynamicPage){var P=mt.el.getBoundingClientRect();mt.position={x:X.x+P.left,y:X.y+P.top}}mt.identifier=Y;var G=mt.options.size/2,M={x:t.pageX,y:t.pageY};y.lockX&&(M.y=mt.position.y),y.lockY&&(M.x=mt.position.x);var L,h,Q,F,E,w,D,l,g,B,b=I(M,mt.position),p=(L=M,Q=(h=mt.position).x-L.x,F=h.y-L.y,function(t){return t*(180/Math.PI)}(Math.atan2(F,Q))),c=r(p),f=b/G,S={distance:b,position:M};if("circle"===mt.options.shape?(E=Math.min(b,G),D=mt.position,l=E,B={x:0,y:0},g=r(g=p),B.x=D.x-l*Math.cos(g),B.y=D.y-l*Math.sin(g),w=B):(w=function(t,U,y){return{x:Math.min(Math.max(t.x,U.x-y),U.x+y),y:Math.min(Math.max(t.y,U.y-y),U.y+y)}}(M,mt.position,G),E=I(w,mt.position)),y.follow){if(b>G){var N=M.x-w.x,j=M.y-w.y;mt.position.x+=N,mt.position.y+=j,mt.el.style.top=mt.position.y-(U.box.top+X.y)+"px",mt.el.style.left=mt.position.x-(U.box.left+X.x)+"px",b=I(M,mt.position)}}else M=w,b=E;var J=M.x-mt.position.x,a=M.y-mt.position.y;mt.frontPosition={x:J,y:a},y.dataOnly||(mt.ui.front.style.transform="translate("+J+"px,"+a+"px)");var d={identifier:mt.identifier,position:M,force:f,pressure:t.force||t.pressure||t.webkitForce||0,distance:b,angle:{radian:c,degree:p},vector:{x:J/G,y:-a/G},raw:S,instance:mt,lockX:y.lockX,lockY:y.lockY};(d=mt.computeDirection(d)).angle={radian:r(180-p),degree:180-p},mt.trigger("move",d),U.trigger("move "+mt.id+":move",d)}else this.processOnEnd(t)},J.prototype.processOnEnd=function(t){var U=this,y=U.options,I=U.manager.getIdentifier(t),r=U.nipples.get(I),Y=U.manager.removeIdentifier(r.identifier);r&&(y.dataOnly||r.hide((function(){"dynamic"===y.mode&&(r.trigger("removed",r),U.trigger("removed "+r.id+":removed",r),U.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(U.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),U.trigger("end "+r.id+":end",r),U.ids.indexOf(r.identifier)>=0&&U.ids.splice(U.ids.indexOf(r.identifier),1),U.actives.indexOf(r)>=0&&U.actives.splice(U.actives.indexOf(r),1),/(semi|static)/.test(y.mode)?U.idles.push(r):U.nipples.indexOf(r)>=0&&U.nipples.splice(U.nipples.indexOf(r),1),U.manager.unbindDocument(),/(semi|static)/.test(y.mode)&&(U.manager.ids[Y.id]=Y.identifier))},J.prototype.onDestroyed=function(t,U){var y=this;y.nipples.indexOf(U)>=0&&y.nipples.splice(y.nipples.indexOf(U),1),y.actives.indexOf(U)>=0&&y.actives.splice(y.actives.indexOf(U),1),y.idles.indexOf(U)>=0&&y.idles.splice(y.idles.indexOf(U),1),y.ids.indexOf(U.identifier)>=0&&y.ids.splice(y.ids.indexOf(U.identifier),1),y.manager.removeIdentifier(U.identifier),y.manager.unbindDocument()},J.prototype.destroy=function(){var t=this;for(var U in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(U)&&clearInterval(t.pressureIntervals[U]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};const a=J;function d(t){var U=this;U.ids={},U.index=0,U.collections=[],U.scroll=M(),U.config(t),U.prepareCollections();var y=function(){var t;U.collections.forEach((function(y){y.forEach((function(y){t=y.el.getBoundingClientRect(),y.position={x:U.scroll.x+t.left,y:U.scroll.y+t.top}}))}))};X(window,"resize",(function(){mt(y)}));var I=function(){U.scroll=M()};return X(window,"scroll",(function(){mt(I)})),U.collections}d.prototype=new S,d.constructor=d,d.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(U){var y;return t.collections.every((function(t){return!(y=t.get(U))})),y}},d.prototype.create=function(t){return this.createCollection(t)},d.prototype.createCollection=function(t){var U=this,y=new a(U,t);return U.bindCollection(y),U.collections.push(y),y},d.prototype.bindCollection=function(t){var U,y=this,I=function(t,I){U=t.type+" "+I.id+":"+t.type,y.trigger(U,I)};t.on("destroyed",y.onDestroyed.bind(y)),t.on("shown hidden rested dir plain",I),t.on("dir:up dir:right dir:down dir:left",I),t.on("plain:up plain:right plain:down plain:left",I)},d.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},d.prototype.unbindDocument=function(t){var U=this;Object.keys(U.ids).length&&!0!==t||(U.unbindEvt(document,"move").unbindEvt(document,"end"),U.binded=!1)},d.prototype.getIdentifier=function(t){var U;return t?void 0===(U=void 0===t.identifier?t.pointerId:t.identifier)&&(U=this.latest||0):U=this.index,void 0===this.ids[U]&&(this.ids[U]=this.index,this.index+=1),this.latest=U,this.ids[U]},d.prototype.removeIdentifier=function(t){var U={};for(var y in this.ids)if(this.ids[y]===t){U.id=y,U.identifier=this.ids[y],delete this.ids[y];break}return U},d.prototype.onmove=function(t){return this.onAny("move",t),!1},d.prototype.onend=function(t){return this.onAny("end",t),!1},d.prototype.oncancel=function(t){return this.onAny("end",t),!1},d.prototype.onAny=function(t,U){var y,I=this,r="processOn"+t.charAt(0).toUpperCase()+t.slice(1);U=G(U);var Y=function(t,U,y){y.ids.indexOf(U)>=0&&(y[r](t),t._found_=!0)};return E(U,(function(t){y=I.getIdentifier(t),E(I.collections,Y.bind(null,t,y)),t._found_||I.removeIdentifier(y)})),!1},d.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},d.prototype.onDestroyed=function(t,U){var y=this;if(y.collections.indexOf(U)<0)return!1;y.collections.splice(y.collections.indexOf(U),1)};var q=new d;const H={create:function(t){return q.create(t)},factory:q};return U.default})(),t.exports=U()},13285:(t,U,y)=>{"use strict";const{Deflate:I,deflate:r,deflateRaw:Y,gzip:mt}=y(13289),{Inflate:X,inflate:P,inflateRaw:G,ungzip:M}=y(13340),L=y(13322);t.exports.Deflate=I,t.exports.deflate=r,t.exports.deflateRaw=Y,t.exports.gzip=mt,t.exports.Inflate=X,t.exports.inflate=P,t.exports.inflateRaw=G,t.exports.ungzip=M,t.exports.constants=L},13289:(t,U,y)=>{"use strict";const I=y(13297),r=y(13325),Y=y(13331),mt=y(13314),X=y(13334),P=Object.prototype.toString,{Z_NO_FLUSH:G,Z_SYNC_FLUSH:M,Z_FULL_FLUSH:L,Z_FINISH:h,Z_OK:Q,Z_STREAM_END:F,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:w,Z_DEFLATED:D}=y(13322);function l(t){this.options=r.assign({level:E,method:D,kt:16384,windowBits:15,memLevel:8,strategy:w},t||{});let U=this.options;U.raw&&U.windowBits>0?U.windowBits=-U.windowBits:U.gzip&&U.windowBits>0&&U.windowBits<16&&(U.windowBits+=16),this.err=0,this.hU="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let y=I.deflateInit2(this.strm,U.level,U.method,U.windowBits,U.memLevel,U.strategy);if(y!==Q)throw new Error(mt[y]);if(U.header&&I.deflateSetHeader(this.strm,U.header),U.dictionary){let t;if(t="string"===typeof U.dictionary?Y.string2buf(U.dictionary):"[object ArrayBuffer]"===P.call(U.dictionary)?new Uint8Array(U.dictionary):U.dictionary,y=I.deflateSetDictionary(this.strm,t),y!==Q)throw new Error(mt[y]);this._dict_set=!0}}function g(t,U){const y=new l(U);if(y.push(t,!0),y.err)throw y.hU||mt[y.err];return y.result}l.prototype.push=function(t,U){const y=this.strm,r=this.options.kt;let mt,X;if(this.ended)return!1;for(X=U===~~U?U:!0===U?h:G,"string"===typeof t?y.input=Y.string2buf(t):"[object ArrayBuffer]"===P.call(t)?y.input=new Uint8Array(t):y.input=t,y.next_in=0,y.avail_in=y.input.length;;)if(0===y.avail_out&&(y.output=new Uint8Array(r),y.next_out=0,y.avail_out=r),(X===M||X===L)&&y.avail_out<=6)this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;else{if(mt=I.deflate(y,X),mt===F)return y.next_out>0&&this.onData(y.output.subarray(0,y.next_out)),mt=I.deflateEnd(this.strm),this.onEnd(mt),this.ended=!0,mt===Q;if(0!==y.avail_out){if(X>0&&y.next_out>0)this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;else if(0===y.avail_in)break}else this.onData(y.output)}return!0},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===Q&&(this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.hU=this.strm.hU},t.exports.Deflate=l,t.exports.deflate=g,t.exports.deflateRaw=function(t,U){return(U=U||{}).raw=!0,g(t,U)},t.exports.gzip=function(t,U){return(U=U||{}).gzip=!0,g(t,U)},t.exports.constants=y(13322)},13340:(t,U,y)=>{"use strict";const I=y(13345),r=y(13325),Y=y(13331),mt=y(13314),X=y(13334),P=y(13357),G=Object.prototype.toString,{Z_NO_FLUSH:M,Z_FINISH:L,Z_OK:h,Z_STREAM_END:Q,Z_NEED_DICT:F,Z_STREAM_ERROR:E,Z_DATA_ERROR:w,Z_MEM_ERROR:D}=y(13322);function l(t){this.options=r.assign({kt:65536,windowBits:15,to:""},t||{});const U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,0===U.windowBits&&(U.windowBits=-15)),!(U.windowBits>=0&&U.windowBits<16)||t&&t.windowBits||(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&0===(15&U.windowBits)&&(U.windowBits|=15),this.err=0,this.hU="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let y=I.inflateInit2(this.strm,U.windowBits);if(y!==h)throw new Error(mt[y]);if(this.header=new P,I.inflateGetHeader(this.strm,this.header),U.dictionary&&("string"===typeof U.dictionary?U.dictionary=Y.string2buf(U.dictionary):"[object ArrayBuffer]"===G.call(U.dictionary)&&(U.dictionary=new Uint8Array(U.dictionary)),U.raw&&(y=I.inflateSetDictionary(this.strm,U.dictionary),y!==h)))throw new Error(mt[y])}function g(t,U){const y=new l(U);if(y.push(t),y.err)throw y.hU||mt[y.err];return y.result}l.prototype.push=function(t,U){const y=this.strm,r=this.options.kt,mt=this.options.dictionary;let X,P,l;if(this.ended)return!1;for(P=U===~~U?U:!0===U?L:M,"[object ArrayBuffer]"===G.call(t)?y.input=new Uint8Array(t):y.input=t,y.next_in=0,y.avail_in=y.input.length;;){for(0===y.avail_out&&(y.output=new Uint8Array(r),y.next_out=0,y.avail_out=r),X=I.inflate(y,P),X===F&&mt&&(X=I.inflateSetDictionary(y,mt),X===h?X=I.inflate(y,P):X===w&&(X=F));y.avail_in>0&&X===Q&&y.state.wrap>0&&0!==t[y.next_in];)I.inflateReset(y),X=I.inflate(y,P);switch(X){case E:case w:case F:case D:return this.onEnd(X),this.ended=!0,!1}if(l=y.avail_out,y.next_out&&(0===y.avail_out||X===Q))if("string"===this.options.to){let t=Y.utf8border(y.output,y.next_out),U=y.next_out-t,I=Y.buf2string(y.output,t);y.next_out=U,y.avail_out=r-U,U&&y.output.set(y.output.subarray(t,t+U),0),this.onData(I)}else this.onData(y.output.length===y.next_out?y.output:y.output.subarray(0,y.next_out));if(X!==h||0!==l){if(X===Q)return X=I.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===y.avail_in)break}}return!0},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.hU=this.strm.hU},t.exports.Inflate=l,t.exports.inflate=g,t.exports.inflateRaw=function(t,U){return(U=U||{}).raw=!0,g(t,U)},t.exports.ungzip=g,t.exports.constants=y(13322)},13325:t=>{"use strict";const U=(t,U)=>Object.prototype.hasOwnProperty.call(t,U);t.exports.assign=function(t){const y=Array.prototype.slice.call(arguments,1);for(;y.length;){const I=y.shift();if(I){if("object"!==typeof I)throw new TypeError(I+"must be non-object");for(const y in I)U(I,y)&&(t[y]=I[y])}}return t},t.exports.flattenChunks=t=>{let U=0;for(let I=0,r=t.length;I<r;I++)U+=t[I].length;const y=new Uint8Array(U);for(let I=0,r=0,Y=t.length;I<Y;I++){let U=t[I];y.set(U,r),r+=U.length}return y}},13331:t=>{"use strict";let U=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(I){U=!1}const y=new Uint8Array(256);for(let r=0;r<256;r++)y[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;y[254]=y[254]=1,t.exports.string2buf=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let U,y,I,r,Y,mt=t.length,X=0;for(r=0;r<mt;r++)y=t.charCodeAt(r),55296===(64512&y)&&r+1<mt&&(I=t.charCodeAt(r+1),56320===(64512&I)&&(y=65536+(y-55296<<10)+(I-56320),r++)),X+=y<128?1:y<2048?2:y<65536?3:4;for(U=new Uint8Array(X),Y=0,r=0;Y<X;r++)y=t.charCodeAt(r),55296===(64512&y)&&r+1<mt&&(I=t.charCodeAt(r+1),56320===(64512&I)&&(y=65536+(y-55296<<10)+(I-56320),r++)),y<128?U[Y++]=y:y<2048?(U[Y++]=192|y>>>6,U[Y++]=128|63&y):y<65536?(U[Y++]=224|y>>>12,U[Y++]=128|y>>>6&63,U[Y++]=128|63&y):(U[Y++]=240|y>>>18,U[Y++]=128|y>>>12&63,U[Y++]=128|y>>>6&63,U[Y++]=128|63&y);return U};t.exports.buf2string=(t,I)=>{const r=I||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,I));let Y,mt;const X=new Array(2*r);for(mt=0,Y=0;Y<r;){let U=t[Y++];if(U<128){X[mt++]=U;continue}let I=y[U];if(I>4)X[mt++]=65533,Y+=I-1;else{for(U&=2===I?31:3===I?15:7;I>1&&Y<r;)U=U<<6|63&t[Y++],I--;I>1?X[mt++]=65533:U<65536?X[mt++]=U:(U-=65536,X[mt++]=55296|U>>10&1023,X[mt++]=56320|1023&U)}}return((t,y)=>{if(y<65534&&t.subarray&&U)return String.fromCharCode.apply(null,t.length===y?t:t.subarray(0,y));let I="";for(let U=0;U<y;U++)I+=String.fromCharCode(t[U]);return I})(X,mt)},t.exports.utf8border=(t,U)=>{(U=U||t.length)>t.length&&(U=t.length);let I=U-1;for(;I>=0&&128===(192&t[I]);)I--;return I<0||0===I?U:I+y[t[I]]>U?I:U}},13309:t=>{"use strict";t.exports=(t,U,y,I)=>{let r=65535&t,Y=t>>>16&65535,mt=0;for(;0!==y;){mt=y>2e3?2e3:y,y-=mt;do{r=r+U[I++]|0,Y=Y+r|0}while(--mt);r%=65521,Y%=65521}return r|Y<<16}},13322:t=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13311:t=>{"use strict";const U=new Uint32Array((()=>{let t,U=[];for(var y=0;y<256;y++){t=y;for(var I=0;I<8;I++)t=1&t?3988292384^t>>>1:t>>>1;U[y]=t}return U})());t.exports=(t,y,I,r)=>{const Y=U,mt=r+I;t^=-1;for(let U=r;U<mt;U++)t=t>>>8^Y[255&(t^y[U])];return~t}},13297:(t,U,y)=>{"use strict";const{_tr_init:I,_tr_stored_block:r,_tr_flush_block:Y,_tr_tally:mt,_tr_align:X}=y(13304),P=y(13309),G=y(13311),M=y(13314),{Z_NO_FLUSH:L,Z_PARTIAL_FLUSH:h,Z_FULL_FLUSH:Q,Z_FINISH:F,Z_BLOCK:E,Z_OK:w,Z_STREAM_END:D,Z_STREAM_ERROR:l,Z_DATA_ERROR:g,Z_BUF_ERROR:B,Z_DEFAULT_COMPRESSION:b,Z_FILTERED:p,Z_HUFFMAN_ONLY:c,Z_RLE:f,Z_FIXED:S,Z_DEFAULT_STRATEGY:N,Z_UNKNOWN:j,Z_DEFLATED:J}=y(13322),a=258,d=262,q=103,H=113,e=666,o=(t,U)=>(t.hU=M[U],U),V=t=>(t<<1)-(t>4?9:0),n=t=>{let U=t.length;for(;--U>=0;)t[U]=0};let i=(t,U,y)=>(U<<t.hash_shift^y)&t.hash_mask;const v=t=>{const U=t.state;let y=U.pending;y>t.avail_out&&(y=t.avail_out),0!==y&&(t.output.set(U.pending_buf.subarray(U.pending_out,U.pending_out+y),t.next_out),t.next_out+=y,U.pending_out+=y,t.total_out+=y,t.avail_out-=y,U.pending-=y,0===U.pending&&(U.pending_out=0))},O=(t,U)=>{Y(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,U),t.block_start=t.strstart,v(t.strm)},k=(t,U)=>{t.pending_buf[t.pending++]=U},s=(t,U)=>{t.pending_buf[t.pending++]=U>>>8&255,t.pending_buf[t.pending++]=255&U},x=(t,U,y,I)=>{let r=t.avail_in;return r>I&&(r=I),0===r?0:(t.avail_in-=r,U.set(t.input.subarray(t.next_in,t.next_in+r),y),1===t.state.wrap?t.adler=P(t.adler,U,r,y):2===t.state.wrap&&(t.adler=G(t.adler,U,r,y)),t.next_in+=r,t.total_in+=r,r)},Z=(t,U)=>{let y,I,r=t.max_chain_length,Y=t.strstart,mt=t.prev_length,X=t.nice_match;const P=t.strstart>t.w_size-d?t.strstart-(t.w_size-d):0,G=t.window,M=t.w_mask,L=t.prev,h=t.strstart+a;let Q=G[Y+mt-1],F=G[Y+mt];t.prev_length>=t.good_match&&(r>>=2),X>t.lookahead&&(X=t.lookahead);do{if(y=U,G[y+mt]===F&&G[y+mt-1]===Q&&G[y]===G[Y]&&G[++y]===G[Y+1]){Y+=2,y++;do{}while(G[++Y]===G[++y]&&G[++Y]===G[++y]&&G[++Y]===G[++y]&&G[++Y]===G[++y]&&G[++Y]===G[++y]&&G[++Y]===G[++y]&&G[++Y]===G[++y]&&G[++Y]===G[++y]&&Y<h);if(I=a-(h-Y),Y=h-a,I>mt){if(t.match_start=U,mt=I,I>=X)break;Q=G[Y+mt-1],F=G[Y+mt]}}}while((U=L[U&M])>P&&0!==--r);return mt<=t.lookahead?mt:t.lookahead},W=t=>{const U=t.w_size;let y,I,r,Y,mt;do{if(Y=t.window_size-t.lookahead-t.strstart,t.strstart>=U+(U-d)){t.window.set(t.window.subarray(U,U+U),0),t.match_start-=U,t.strstart-=U,t.block_start-=U,I=t.hash_size,y=I;do{r=t.head[--y],t.head[y]=r>=U?r-U:0}while(--I);I=U,y=I;do{r=t.prev[--y],t.prev[y]=r>=U?r-U:0}while(--I);Y+=U}if(0===t.strm.avail_in)break;if(I=x(t.strm,t.window,t.strstart+t.lookahead,Y),t.lookahead+=I,t.lookahead+t.insert>=3)for(mt=t.strstart-t.insert,t.ins_h=t.window[mt],t.ins_h=i(t,t.ins_h,t.window[mt+1]);t.insert&&(t.ins_h=i(t,t.ins_h,t.window[mt+3-1]),t.prev[mt&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=mt,mt++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<d&&0!==t.strm.avail_in)},A=(t,U)=>{let y,I;for(;;){if(t.lookahead<d){if(W(t),t.lookahead<d&&U===L)return 1;if(0===t.lookahead)break}if(y=0,t.lookahead>=3&&(t.ins_h=i(t,t.ins_h,t.window[t.strstart+3-1]),y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==y&&t.strstart-y<=t.w_size-d&&(t.match_length=Z(t,y)),t.match_length>=3)if(I=mt(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=i(t,t.ins_h,t.window[t.strstart+3-1]),y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=i(t,t.ins_h,t.window[t.strstart+1]);else I=mt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(I&&(O(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,U===F?(O(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(O(t,!1),0===t.strm.avail_out)?1:2},K=(t,U)=>{let y,I,r;for(;;){if(t.lookahead<d){if(W(t),t.lookahead<d&&U===L)return 1;if(0===t.lookahead)break}if(y=0,t.lookahead>=3&&(t.ins_h=i(t,t.ins_h,t.window[t.strstart+3-1]),y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==y&&t.prev_length<t.max_lazy_match&&t.strstart-y<=t.w_size-d&&(t.match_length=Z(t,y),t.match_length<=5&&(t.strategy===p||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,I=mt(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=i(t,t.ins_h,t.window[t.strstart+3-1]),y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,I&&(O(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(I=mt(t,0,t.window[t.strstart-1]),I&&O(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(I=mt(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,U===F?(O(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(O(t,!1),0===t.strm.avail_out)?1:2};function C(t,U,y,I,r){this.good_length=t,this.max_lazy=U,this.nice_length=y,this.max_chain=I,this.func=r}const R=[new C(0,0,0,0,((t,U)=>{let y=65535;for(y>t.pending_buf_size-5&&(y=t.pending_buf_size-5);;){if(t.lookahead<=1){if(W(t),0===t.lookahead&&U===L)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const I=t.block_start+y;if((0===t.strstart||t.strstart>=I)&&(t.lookahead=t.strstart-I,t.strstart=I,O(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-d&&(O(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,U===F?(O(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(O(t,!1),t.strm.avail_out),1)})),new C(4,4,8,4,A),new C(4,5,16,8,A),new C(4,6,32,32,A),new C(4,4,16,16,K),new C(8,16,32,32,K),new C(8,16,128,128,K),new C(8,32,128,256,K),new C(32,128,258,1024,K),new C(32,258,258,4096,K)];function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),n(this.dyn_ltree),n(this.dyn_dtree),n(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),n(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),n(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const T=t=>{if(!t||!t.state)return o(t,l);t.total_in=t.total_out=0,t.data_type=j;const U=t.state;return U.pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?42:H,t.adler=2===U.wrap?0:1,U.last_flush=L,I(U),w},z=t=>{const U=T(t);var y;return U===w&&((y=t.state).window_size=2*y.w_size,n(y.head),y.max_lazy_match=R[y.level].max_lazy,y.good_match=R[y.level].good_length,y.nice_match=R[y.level].nice_length,y.max_chain_length=R[y.level].max_chain,y.strstart=0,y.block_start=0,y.lookahead=0,y.insert=0,y.match_length=y.prev_length=2,y.match_available=0,y.ins_h=0),U},tt=(t,U,y,I,r,Y)=>{if(!t)return l;let mt=1;if(U===b&&(U=6),I<0?(mt=0,I=-I):I>15&&(mt=2,I-=16),r<1||r>9||y!==J||I<8||I>15||U<0||U>9||Y<0||Y>S)return o(t,l);8===I&&(I=9);const X=new u;return t.state=X,X.strm=t,X.wrap=mt,X.gzhead=null,X.w_bits=I,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=r+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<r+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=U,X.strategy=Y,X.method=y,z(t)};t.exports.deflateInit=(t,U)=>tt(t,U,J,15,8,N),t.exports.deflateInit2=tt,t.exports.deflateReset=z,t.exports.deflateResetKeep=T,t.exports.deflateSetHeader=(t,U)=>t&&t.state?2!==t.state.wrap?l:(t.state.gzhead=U,w):l,t.exports.deflate=(t,U)=>{let y,I;if(!t||!t.state||U>E||U<0)return t?o(t,l):l;const Y=t.state;if(!t.output||!t.input&&0!==t.avail_in||Y.status===e&&U!==F)return o(t,0===t.avail_out?B:l);Y.strm=t;const P=Y.last_flush;if(Y.last_flush=U,42===Y.status)if(2===Y.wrap)t.adler=0,k(Y,31),k(Y,139),k(Y,8),Y.gzhead?(k(Y,(Y.gzhead.text?1:0)+(Y.gzhead.hcrc?2:0)+(Y.gzhead.extra?4:0)+(Y.gzhead.name?8:0)+(Y.gzhead.comment?16:0)),k(Y,255&Y.gzhead.time),k(Y,Y.gzhead.time>>8&255),k(Y,Y.gzhead.time>>16&255),k(Y,Y.gzhead.time>>24&255),k(Y,9===Y.level?2:Y.strategy>=c||Y.level<2?4:0),k(Y,255&Y.gzhead.os),Y.gzhead.extra&&Y.gzhead.extra.length&&(k(Y,255&Y.gzhead.extra.length),k(Y,Y.gzhead.extra.length>>8&255)),Y.gzhead.hcrc&&(t.adler=G(t.adler,Y.pending_buf,Y.pending,0)),Y.gzindex=0,Y.status=69):(k(Y,0),k(Y,0),k(Y,0),k(Y,0),k(Y,0),k(Y,9===Y.level?2:Y.strategy>=c||Y.level<2?4:0),k(Y,3),Y.status=H);else{let U=J+(Y.w_bits-8<<4)<<8,y=-1;y=Y.strategy>=c||Y.level<2?0:Y.level<6?1:6===Y.level?2:3,U|=y<<6,0!==Y.strstart&&(U|=32),U+=31-U%31,Y.status=H,s(Y,U),0!==Y.strstart&&(s(Y,t.adler>>>16),s(Y,65535&t.adler)),t.adler=1}if(69===Y.status)if(Y.gzhead.extra){for(y=Y.pending;Y.gzindex<(65535&Y.gzhead.extra.length)&&(Y.pending!==Y.pending_buf_size||(Y.gzhead.hcrc&&Y.pending>y&&(t.adler=G(t.adler,Y.pending_buf,Y.pending-y,y)),v(t),y=Y.pending,Y.pending!==Y.pending_buf_size));)k(Y,255&Y.gzhead.extra[Y.gzindex]),Y.gzindex++;Y.gzhead.hcrc&&Y.pending>y&&(t.adler=G(t.adler,Y.pending_buf,Y.pending-y,y)),Y.gzindex===Y.gzhead.extra.length&&(Y.gzindex=0,Y.status=73)}else Y.status=73;if(73===Y.status)if(Y.gzhead.name){y=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>y&&(t.adler=G(t.adler,Y.pending_buf,Y.pending-y,y)),v(t),y=Y.pending,Y.pending===Y.pending_buf_size)){I=1;break}I=Y.gzindex<Y.gzhead.name.length?255&Y.gzhead.name.charCodeAt(Y.gzindex++):0,k(Y,I)}while(0!==I);Y.gzhead.hcrc&&Y.pending>y&&(t.adler=G(t.adler,Y.pending_buf,Y.pending-y,y)),0===I&&(Y.gzindex=0,Y.status=91)}else Y.status=91;if(91===Y.status)if(Y.gzhead.comment){y=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>y&&(t.adler=G(t.adler,Y.pending_buf,Y.pending-y,y)),v(t),y=Y.pending,Y.pending===Y.pending_buf_size)){I=1;break}I=Y.gzindex<Y.gzhead.comment.length?255&Y.gzhead.comment.charCodeAt(Y.gzindex++):0,k(Y,I)}while(0!==I);Y.gzhead.hcrc&&Y.pending>y&&(t.adler=G(t.adler,Y.pending_buf,Y.pending-y,y)),0===I&&(Y.status=q)}else Y.status=q;if(Y.status===q&&(Y.gzhead.hcrc?(Y.pending+2>Y.pending_buf_size&&v(t),Y.pending+2<=Y.pending_buf_size&&(k(Y,255&t.adler),k(Y,t.adler>>8&255),t.adler=0,Y.status=H)):Y.status=H),0!==Y.pending){if(v(t),0===t.avail_out)return Y.last_flush=-1,w}else if(0===t.avail_in&&V(U)<=V(P)&&U!==F)return o(t,B);if(Y.status===e&&0!==t.avail_in)return o(t,B);if(0!==t.avail_in||0!==Y.lookahead||U!==L&&Y.status!==e){let y=Y.strategy===c?((t,U)=>{let y;for(;;){if(0===t.lookahead&&(W(t),0===t.lookahead)){if(U===L)return 1;break}if(t.match_length=0,y=mt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,y&&(O(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,U===F?(O(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(O(t,!1),0===t.strm.avail_out)?1:2})(Y,U):Y.strategy===f?((t,U)=>{let y,I,r,Y;const X=t.window;for(;;){if(t.lookahead<=a){if(W(t),t.lookahead<=a&&U===L)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,I=X[r],I===X[++r]&&I===X[++r]&&I===X[++r])){Y=t.strstart+a;do{}while(I===X[++r]&&I===X[++r]&&I===X[++r]&&I===X[++r]&&I===X[++r]&&I===X[++r]&&I===X[++r]&&I===X[++r]&&r<Y);t.match_length=a-(Y-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(y=mt(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(y=mt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),y&&(O(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,U===F?(O(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(O(t,!1),0===t.strm.avail_out)?1:2})(Y,U):R[Y.level].func(Y,U);if(3!==y&&4!==y||(Y.status=e),1===y||3===y)return 0===t.avail_out&&(Y.last_flush=-1),w;if(2===y&&(U===h?X(Y):U!==E&&(r(Y,0,0,!1),U===Q&&(n(Y.head),0===Y.lookahead&&(Y.strstart=0,Y.block_start=0,Y.insert=0))),v(t),0===t.avail_out))return Y.last_flush=-1,w}return U!==F?w:Y.wrap<=0?D:(2===Y.wrap?(k(Y,255&t.adler),k(Y,t.adler>>8&255),k(Y,t.adler>>16&255),k(Y,t.adler>>24&255),k(Y,255&t.total_in),k(Y,t.total_in>>8&255),k(Y,t.total_in>>16&255),k(Y,t.total_in>>24&255)):(s(Y,t.adler>>>16),s(Y,65535&t.adler)),v(t),Y.wrap>0&&(Y.wrap=-Y.wrap),0!==Y.pending?w:D)},t.exports.deflateEnd=t=>{if(!t||!t.state)return l;const U=t.state.status;return 42!==U&&69!==U&&73!==U&&91!==U&&U!==q&&U!==H&&U!==e?o(t,l):(t.state=null,U===H?o(t,g):w)},t.exports.deflateSetDictionary=(t,U)=>{let y=U.length;if(!t||!t.state)return l;const I=t.state,r=I.wrap;if(2===r||1===r&&42!==I.status||I.lookahead)return l;if(1===r&&(t.adler=P(t.adler,U,y,0)),I.wrap=0,y>=I.w_size){0===r&&(n(I.head),I.strstart=0,I.block_start=0,I.insert=0);let t=new Uint8Array(I.w_size);t.set(U.subarray(y-I.w_size,y),0),U=t,y=I.w_size}const Y=t.avail_in,mt=t.next_in,X=t.input;for(t.avail_in=y,t.next_in=0,t.input=U,W(I);I.lookahead>=3;){let t=I.strstart,U=I.lookahead-2;do{I.ins_h=i(I,I.ins_h,I.window[t+3-1]),I.prev[t&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=t,t++}while(--U);I.strstart=t,I.lookahead=2,W(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=2,I.match_available=0,t.next_in=mt,t.input=X,t.avail_in=Y,I.wrap=r,w},t.exports.deflateInfo="pako deflate (from Nodeca project)"},13357:t=>{"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13352:t=>{"use strict";t.exports=function(t,U){let y,I,r,Y,mt,X,P,G,M,L,h,Q,F,E,w,D,l,g,B,b,p,c,f,S;const N=t.state;y=t.next_in,f=t.input,I=y+(t.avail_in-5),r=t.next_out,S=t.output,Y=r-(U-t.avail_out),mt=r+(t.avail_out-257),X=N.dmax,P=N.wsize,G=N.whave,M=N.wnext,L=N.window,h=N.hold,Q=N.bits,F=N.lencode,E=N.distcode,w=(1<<N.lenbits)-1,D=(1<<N.distbits)-1;t:do{Q<15&&(h+=f[y++]<<Q,Q+=8,h+=f[y++]<<Q,Q+=8),l=F[h&w];U:for(;;){if(g=l>>>24,h>>>=g,Q-=g,g=l>>>16&255,0===g)S[r++]=65535&l;else{if(!(16&g)){if(0===(64&g)){l=F[(65535&l)+(h&(1<<g)-1)];continue U}if(32&g){N.mode=12;break t}t.hU="invalid literal/length code",N.mode=30;break t}B=65535&l,g&=15,g&&(Q<g&&(h+=f[y++]<<Q,Q+=8),B+=h&(1<<g)-1,h>>>=g,Q-=g),Q<15&&(h+=f[y++]<<Q,Q+=8,h+=f[y++]<<Q,Q+=8),l=E[h&D];y:for(;;){if(g=l>>>24,h>>>=g,Q-=g,g=l>>>16&255,!(16&g)){if(0===(64&g)){l=E[(65535&l)+(h&(1<<g)-1)];continue y}t.hU="invalid distance code",N.mode=30;break t}if(b=65535&l,g&=15,Q<g&&(h+=f[y++]<<Q,Q+=8,Q<g&&(h+=f[y++]<<Q,Q+=8)),b+=h&(1<<g)-1,b>X){t.hU="invalid distance too far back",N.mode=30;break t}if(h>>>=g,Q-=g,g=r-Y,b>g){if(g=b-g,g>G&&N.sane){t.hU="invalid distance too far back",N.mode=30;break t}if(p=0,c=L,0===M){if(p+=P-g,g<B){B-=g;do{S[r++]=L[p++]}while(--g);p=r-b,c=S}}else if(M<g){if(p+=P+M-g,g-=M,g<B){B-=g;do{S[r++]=L[p++]}while(--g);if(p=0,M<B){g=M,B-=g;do{S[r++]=L[p++]}while(--g);p=r-b,c=S}}}else if(p+=M-g,g<B){B-=g;do{S[r++]=L[p++]}while(--g);p=r-b,c=S}for(;B>2;)S[r++]=c[p++],S[r++]=c[p++],S[r++]=c[p++],B-=3;B&&(S[r++]=c[p++],B>1&&(S[r++]=c[p++]))}else{p=r-b;do{S[r++]=S[p++],S[r++]=S[p++],S[r++]=S[p++],B-=3}while(B>2);B&&(S[r++]=S[p++],B>1&&(S[r++]=S[p++]))}break}}break}}while(y<I&&r<mt);B=Q>>3,y-=B,Q-=B<<3,h&=(1<<Q)-1,t.next_in=y,t.next_out=r,t.avail_in=y<I?I-y+5:5-(y-I),t.avail_out=r<mt?mt-r+257:257-(r-mt),N.hold=h,N.bits=Q}},13345:(t,U,y)=>{"use strict";const I=y(13309),r=y(13311),Y=y(13352),mt=y(13355),{Z_FINISH:X,Z_BLOCK:P,Z_TREES:G,Z_OK:M,Z_STREAM_END:L,Z_NEED_DICT:h,Z_STREAM_ERROR:Q,Z_DATA_ERROR:F,Z_MEM_ERROR:E,Z_BUF_ERROR:w,Z_DEFLATED:D}=y(13322),l=12,g=30,B=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const p=t=>{if(!t||!t.state)return Q;const U=t.state;return t.total_in=t.total_out=U.total=0,t.hU="",U.wrap&&(t.adler=1&U.wrap),U.mode=1,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new Int32Array(852),U.distcode=U.distdyn=new Int32Array(592),U.sane=1,U.back=-1,M},c=t=>{if(!t||!t.state)return Q;const U=t.state;return U.wsize=0,U.whave=0,U.wnext=0,p(t)},f=(t,U)=>{let y;if(!t||!t.state)return Q;const I=t.state;return U<0?(y=0,U=-U):(y=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?Q:(null!==I.window&&I.wbits!==U&&(I.window=null),I.wrap=y,I.wbits=U,c(t))},S=(t,U)=>{if(!t)return Q;const y=new b;t.state=y,y.window=null;const I=f(t,U);return I!==M&&(t.state=null),I};let N,j,J=!0;const a=t=>{if(J){N=new Int32Array(512),j=new Int32Array(32);let U=0;for(;U<144;)t.lens[U++]=8;for(;U<256;)t.lens[U++]=9;for(;U<280;)t.lens[U++]=7;for(;U<288;)t.lens[U++]=8;for(mt(1,t.lens,0,288,N,0,t.work,{bits:9}),U=0;U<32;)t.lens[U++]=5;mt(2,t.lens,0,32,j,0,t.work,{bits:5}),J=!1}t.lencode=N,t.lenbits=9,t.distcode=j,t.distbits=5},d=(t,U,y,I)=>{let r;const Y=t.state;return null===Y.window&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new Uint8Array(Y.wsize)),I>=Y.wsize?(Y.window.set(U.subarray(y-Y.wsize,y),0),Y.wnext=0,Y.whave=Y.wsize):(r=Y.wsize-Y.wnext,r>I&&(r=I),Y.window.set(U.subarray(y-I,y-I+r),Y.wnext),(I-=r)?(Y.window.set(U.subarray(y-I,y),0),Y.wnext=I,Y.whave=Y.wsize):(Y.wnext+=r,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=r))),0};t.exports.inflateReset=c,t.exports.inflateReset2=f,t.exports.inflateResetKeep=p,t.exports.inflateInit=t=>S(t,15),t.exports.inflateInit2=S,t.exports.inflate=(t,U)=>{let y,b,p,c,f,S,N,j,J,q,H,e,o,V,n,i,v,O,k,s,x,Z,W=0;const A=new Uint8Array(4);let K,C;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Q;y=t.state,y.mode===l&&(y.mode=13),f=t.next_out,p=t.output,N=t.avail_out,c=t.next_in,b=t.input,S=t.avail_in,j=y.hold,J=y.bits,q=S,H=N,Z=M;t:for(;;)switch(y.mode){case 1:if(0===y.wrap){y.mode=13;break}for(;J<16;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(2&y.wrap&&35615===j){y.check=0,A[0]=255&j,A[1]=j>>>8&255,y.check=r(y.check,A,2,0),j=0,J=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&j)<<8)+(j>>8))%31){t.hU="incorrect header check",y.mode=g;break}if((15&j)!==D){t.hU="unknown compression method",y.mode=g;break}if(j>>>=4,J-=4,x=8+(15&j),0===y.wbits)y.wbits=x;else if(x>y.wbits){t.hU="invalid window size",y.mode=g;break}y.dmax=1<<y.wbits,t.adler=y.check=1,y.mode=512&j?10:l,j=0,J=0;break;case 2:for(;J<16;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(y.flags=j,(255&y.flags)!==D){t.hU="unknown compression method",y.mode=g;break}if(57344&y.flags){t.hU="unknown header flags set",y.mode=g;break}y.head&&(y.head.text=j>>8&1),512&y.flags&&(A[0]=255&j,A[1]=j>>>8&255,y.check=r(y.check,A,2,0)),j=0,J=0,y.mode=3;case 3:for(;J<32;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}y.head&&(y.head.time=j),512&y.flags&&(A[0]=255&j,A[1]=j>>>8&255,A[2]=j>>>16&255,A[3]=j>>>24&255,y.check=r(y.check,A,4,0)),j=0,J=0,y.mode=4;case 4:for(;J<16;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}y.head&&(y.head.xflags=255&j,y.head.os=j>>8),512&y.flags&&(A[0]=255&j,A[1]=j>>>8&255,y.check=r(y.check,A,2,0)),j=0,J=0,y.mode=5;case 5:if(1024&y.flags){for(;J<16;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}y.length=j,y.head&&(y.head.extra_len=j),512&y.flags&&(A[0]=255&j,A[1]=j>>>8&255,y.check=r(y.check,A,2,0)),j=0,J=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(e=y.length,e>S&&(e=S),e&&(y.head&&(x=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Uint8Array(y.head.extra_len)),y.head.extra.set(b.subarray(c,c+e),x)),512&y.flags&&(y.check=r(y.check,b,e,c)),S-=e,c+=e,y.length-=e),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(0===S)break t;e=0;do{x=b[c+e++],y.head&&x&&y.length<65536&&(y.head.name+=String.fromCharCode(x))}while(x&&e<S);if(512&y.flags&&(y.check=r(y.check,b,e,c)),S-=e,c+=e,x)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(0===S)break t;e=0;do{x=b[c+e++],y.head&&x&&y.length<65536&&(y.head.comment+=String.fromCharCode(x))}while(x&&e<S);if(512&y.flags&&(y.check=r(y.check,b,e,c)),S-=e,c+=e,x)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;J<16;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(j!==(65535&y.check)){t.hU="header crc mismatch",y.mode=g;break}j=0,J=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),t.adler=y.check=0,y.mode=l;break;case 10:for(;J<32;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}t.adler=y.check=B(j),j=0,J=0,y.mode=11;case 11:if(0===y.havedict)return t.next_out=f,t.avail_out=N,t.next_in=c,t.avail_in=S,y.hold=j,y.bits=J,h;t.adler=y.check=1,y.mode=l;case l:if(U===P||U===G)break t;case 13:if(y.last){j>>>=7&J,J-=7&J,y.mode=27;break}for(;J<3;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}switch(y.last=1&j,j>>>=1,J-=1,3&j){case 0:y.mode=14;break;case 1:if(a(y),y.mode=20,U===G){j>>>=2,J-=2;break t}break;case 2:y.mode=17;break;case 3:t.hU="invalid block type",y.mode=g}j>>>=2,J-=2;break;case 14:for(j>>>=7&J,J-=7&J;J<32;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if((65535&j)!==(j>>>16^65535)){t.hU="invalid stored block lengths",y.mode=g;break}if(y.length=65535&j,j=0,J=0,y.mode=15,U===G)break t;case 15:y.mode=16;case 16:if(e=y.length,e){if(e>S&&(e=S),e>N&&(e=N),0===e)break t;p.set(b.subarray(c,c+e),f),S-=e,c+=e,N-=e,f+=e,y.length-=e;break}y.mode=l;break;case 17:for(;J<14;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(y.nlen=257+(31&j),j>>>=5,J-=5,y.ndist=1+(31&j),j>>>=5,J-=5,y.ncode=4+(15&j),j>>>=4,J-=4,y.nlen>286||y.ndist>30){t.hU="too many length or distance symbols",y.mode=g;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;J<3;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}y.lens[R[y.have++]]=7&j,j>>>=3,J-=3}for(;y.have<19;)y.lens[R[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,K={bits:y.lenbits},Z=mt(0,y.lens,0,19,y.lencode,0,y.work,K),y.lenbits=K.bits,Z){t.hU="invalid code lengths set",y.mode=g;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;W=y.lencode[j&(1<<y.lenbits)-1],n=W>>>24,i=W>>>16&255,v=65535&W,!(n<=J);){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(v<16)j>>>=n,J-=n,y.lens[y.have++]=v;else{if(16===v){for(C=n+2;J<C;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(j>>>=n,J-=n,0===y.have){t.hU="invalid bit length repeat",y.mode=g;break}x=y.lens[y.have-1],e=3+(3&j),j>>>=2,J-=2}else if(17===v){for(C=n+3;J<C;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}j>>>=n,J-=n,x=0,e=3+(7&j),j>>>=3,J-=3}else{for(C=n+7;J<C;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}j>>>=n,J-=n,x=0,e=11+(127&j),j>>>=7,J-=7}if(y.have+e>y.nlen+y.ndist){t.hU="invalid bit length repeat",y.mode=g;break}for(;e--;)y.lens[y.have++]=x}}if(y.mode===g)break;if(0===y.lens[256]){t.hU="invalid code -- missing end-of-block",y.mode=g;break}if(y.lenbits=9,K={bits:y.lenbits},Z=mt(1,y.lens,0,y.nlen,y.lencode,0,y.work,K),y.lenbits=K.bits,Z){t.hU="invalid literal/lengths set",y.mode=g;break}if(y.distbits=6,y.distcode=y.distdyn,K={bits:y.distbits},Z=mt(2,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,K),y.distbits=K.bits,Z){t.hU="invalid distances set",y.mode=g;break}if(y.mode=20,U===G)break t;case 20:y.mode=21;case 21:if(S>=6&&N>=258){t.next_out=f,t.avail_out=N,t.next_in=c,t.avail_in=S,y.hold=j,y.bits=J,Y(t,H),f=t.next_out,p=t.output,N=t.avail_out,c=t.next_in,b=t.input,S=t.avail_in,j=y.hold,J=y.bits,y.mode===l&&(y.back=-1);break}for(y.back=0;W=y.lencode[j&(1<<y.lenbits)-1],n=W>>>24,i=W>>>16&255,v=65535&W,!(n<=J);){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(i&&0===(240&i)){for(O=n,k=i,s=v;W=y.lencode[s+((j&(1<<O+k)-1)>>O)],n=W>>>24,i=W>>>16&255,v=65535&W,!(O+n<=J);){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}j>>>=O,J-=O,y.back+=O}if(j>>>=n,J-=n,y.back+=n,y.length=v,0===i){y.mode=26;break}if(32&i){y.back=-1,y.mode=l;break}if(64&i){t.hU="invalid literal/length code",y.mode=g;break}y.extra=15&i,y.mode=22;case 22:if(y.extra){for(C=y.extra;J<C;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}y.length+=j&(1<<y.extra)-1,j>>>=y.extra,J-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;W=y.distcode[j&(1<<y.distbits)-1],n=W>>>24,i=W>>>16&255,v=65535&W,!(n<=J);){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(0===(240&i)){for(O=n,k=i,s=v;W=y.distcode[s+((j&(1<<O+k)-1)>>O)],n=W>>>24,i=W>>>16&255,v=65535&W,!(O+n<=J);){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}j>>>=O,J-=O,y.back+=O}if(j>>>=n,J-=n,y.back+=n,64&i){t.hU="invalid distance code",y.mode=g;break}y.offset=v,y.extra=15&i,y.mode=24;case 24:if(y.extra){for(C=y.extra;J<C;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}y.offset+=j&(1<<y.extra)-1,j>>>=y.extra,J-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){t.hU="invalid distance too far back",y.mode=g;break}y.mode=25;case 25:if(0===N)break t;if(e=H-N,y.offset>e){if(e=y.offset-e,e>y.whave&&y.sane){t.hU="invalid distance too far back",y.mode=g;break}e>y.wnext?(e-=y.wnext,o=y.wsize-e):o=y.wnext-e,e>y.length&&(e=y.length),V=y.window}else V=p,o=f-y.offset,e=y.length;e>N&&(e=N),N-=e,y.length-=e;do{p[f++]=V[o++]}while(--e);0===y.length&&(y.mode=21);break;case 26:if(0===N)break t;p[f++]=y.length,N--,y.mode=21;break;case 27:if(y.wrap){for(;J<32;){if(0===S)break t;S--,j|=b[c++]<<J,J+=8}if(H-=N,t.total_out+=H,y.total+=H,H&&(t.adler=y.check=y.flags?r(y.check,p,H,f-H):I(y.check,p,H,f-H)),H=N,(y.flags?j:B(j))!==y.check){t.hU="incorrect data check",y.mode=g;break}j=0,J=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;J<32;){if(0===S)break t;S--,j+=b[c++]<<J,J+=8}if(j!==(4294967295&y.total)){t.hU="incorrect length check",y.mode=g;break}j=0,J=0}y.mode=29;case 29:Z=L;break t;case g:Z=F;break t;case 31:return E;default:return Q}return t.next_out=f,t.avail_out=N,t.next_in=c,t.avail_in=S,y.hold=j,y.bits=J,(y.wsize||H!==t.avail_out&&y.mode<g&&(y.mode<27||U!==X))&&d(t,t.output,t.next_out,H-t.avail_out)?(y.mode=31,E):(q-=t.avail_in,H-=t.avail_out,t.total_in+=q,t.total_out+=H,y.total+=H,y.wrap&&H&&(t.adler=y.check=y.flags?r(y.check,p,H,t.next_out-H):I(y.check,p,H,t.next_out-H)),t.data_type=y.bits+(y.last?64:0)+(y.mode===l?128:0)+(20===y.mode||15===y.mode?256:0),(0===q&&0===H||U===X)&&Z===M&&(Z=w),Z)},t.exports.inflateEnd=t=>{if(!t||!t.state)return Q;let U=t.state;return U.window&&(U.window=null),t.state=null,M},t.exports.inflateGetHeader=(t,U)=>{if(!t||!t.state)return Q;const y=t.state;return 0===(2&y.wrap)?Q:(y.head=U,U.done=!1,M)},t.exports.inflateSetDictionary=(t,U)=>{const y=U.length;let r,Y,mt;return t&&t.state?(r=t.state,0!==r.wrap&&11!==r.mode?Q:11===r.mode&&(Y=1,Y=I(Y,U,y,0),Y!==r.check)?F:(mt=d(t,U,y,y),mt?(r.mode=31,E):(r.havedict=1,M))):Q},t.exports.inflateInfo="pako inflate (from Nodeca project)"},13355:t=>{"use strict";const U=15,y=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),I=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),r=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Y=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(t,mt,X,P,G,M,L,h)=>{const Q=h.bits;let F,E,w,D,l,g,B=0,b=0,p=0,c=0,f=0,S=0,N=0,j=0,J=0,a=0,d=null,q=0;const H=new Uint16Array(16),e=new Uint16Array(16);let o,V,n,i=null,v=0;for(B=0;B<=U;B++)H[B]=0;for(b=0;b<P;b++)H[mt[X+b]]++;for(f=Q,c=U;c>=1&&0===H[c];c--);if(f>c&&(f=c),0===c)return G[M++]=20971520,G[M++]=20971520,h.bits=1,0;for(p=1;p<c&&0===H[p];p++);for(f<p&&(f=p),j=1,B=1;B<=U;B++)if(j<<=1,j-=H[B],j<0)return-1;if(j>0&&(0===t||1!==c))return-1;for(e[1]=0,B=1;B<U;B++)e[B+1]=e[B]+H[B];for(b=0;b<P;b++)0!==mt[X+b]&&(L[e[mt[X+b]]++]=b);if(0===t?(d=i=L,g=19):1===t?(d=y,q-=257,i=I,v-=257,g=256):(d=r,i=Y,g=-1),a=0,b=0,B=p,l=M,S=f,N=0,w=-1,J=1<<f,D=J-1,1===t&&J>852||2===t&&J>592)return 1;for(;;){o=B-N,L[b]<g?(V=0,n=L[b]):L[b]>g?(V=i[v+L[b]],n=d[q+L[b]]):(V=96,n=0),F=1<<B-N,E=1<<S,p=E;do{E-=F,G[l+(a>>N)+E]=o<<24|V<<16|n}while(0!==E);for(F=1<<B-1;a&F;)F>>=1;if(0!==F?(a&=F-1,a+=F):a=0,b++,0===--H[B]){if(B===c)break;B=mt[X+L[b]]}if(B>f&&(a&D)!==w){for(0===N&&(N=f),l+=p,S=B-N,j=1<<S;S+N<c&&(j-=H[S+N],!(j<=0));)S++,j<<=1;if(J+=1<<S,1===t&&J>852||2===t&&J>592)return 1;w=a&D,G[w]=f<<24|S<<16|l-M}}return 0!==a&&(G[l+a]=B-N<<24|64<<16),h.bits=f,0}},13314:t=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13304:t=>{"use strict";function U(t){let U=t.length;for(;--U>=0;)t[U]=0}const y=256,I=286,r=30,Y=15,mt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),P=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),G=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=new Array(576);U(M);const L=new Array(60);U(L);const h=new Array(512);U(h);const Q=new Array(256);U(Q);const F=new Array(29);U(F);const E=new Array(r);function w(t,U,y,I,r){this.static_tree=t,this.extra_bits=U,this.extra_base=y,this.elems=I,this.max_length=r,this.has_stree=t&&t.length}let D,l,g;function B(t,U){this.dyn_tree=t,this.max_code=0,this.stat_desc=U}U(E);const b=t=>t<256?h[t]:h[256+(t>>>7)],p=(t,U)=>{t.pending_buf[t.pending++]=255&U,t.pending_buf[t.pending++]=U>>>8&255},c=(t,U,y)=>{t.bi_valid>16-y?(t.bi_buf|=U<<t.bi_valid&65535,p(t,t.bi_buf),t.bi_buf=U>>16-t.bi_valid,t.bi_valid+=y-16):(t.bi_buf|=U<<t.bi_valid&65535,t.bi_valid+=y)},f=(t,U,y)=>{c(t,y[2*U],y[2*U+1])},S=(t,U)=>{let y=0;do{y|=1&t,t>>>=1,y<<=1}while(--U>0);return y>>>1},N=(t,U,y)=>{const I=new Array(16);let r,mt,X=0;for(r=1;r<=Y;r++)I[r]=X=X+y[r-1]<<1;for(mt=0;mt<=U;mt++){let U=t[2*mt+1];0!==U&&(t[2*mt]=S(I[U]++,U))}},j=t=>{let U;for(U=0;U<I;U++)t.dyn_ltree[2*U]=0;for(U=0;U<r;U++)t.dyn_dtree[2*U]=0;for(U=0;U<19;U++)t.bl_tree[2*U]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},J=t=>{t.bi_valid>8?p(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},a=(t,U,y,I)=>{const r=2*U,Y=2*y;return t[r]<t[Y]||t[r]===t[Y]&&I[U]<=I[y]},d=(t,U,y)=>{const I=t.heap[y];let r=y<<1;for(;r<=t.heap_len&&(r<t.heap_len&&a(U,t.heap[r+1],t.heap[r],t.depth)&&r++,!a(U,I,t.heap[r],t.depth));)t.heap[y]=t.heap[r],y=r,r<<=1;t.heap[y]=I},q=(t,U,I)=>{let r,Y,P,G,M=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*M]<<8|t.pending_buf[t.d_buf+2*M+1],Y=t.pending_buf[t.l_buf+M],M++,0===r?f(t,Y,U):(P=Q[Y],f(t,P+y+1,U),G=mt[P],0!==G&&(Y-=F[P],c(t,Y,G)),r--,P=b(r),f(t,P,I),G=X[P],0!==G&&(r-=E[P],c(t,r,G)))}while(M<t.last_lit);f(t,256,U)},H=(t,U)=>{const y=U.dyn_tree,I=U.stat_desc.static_tree,r=U.stat_desc.has_stree,mt=U.stat_desc.elems;let X,P,G,M=-1;for(t.heap_len=0,t.heap_max=573,X=0;X<mt;X++)0!==y[2*X]?(t.heap[++t.heap_len]=M=X,t.depth[X]=0):y[2*X+1]=0;for(;t.heap_len<2;)G=t.heap[++t.heap_len]=M<2?++M:0,y[2*G]=1,t.depth[G]=0,t.opt_len--,r&&(t.static_len-=I[2*G+1]);for(U.max_code=M,X=t.heap_len>>1;X>=1;X--)d(t,y,X);G=mt;do{X=t.heap[1],t.heap[1]=t.heap[t.heap_len--],d(t,y,1),P=t.heap[1],t.heap[--t.heap_max]=X,t.heap[--t.heap_max]=P,y[2*G]=y[2*X]+y[2*P],t.depth[G]=(t.depth[X]>=t.depth[P]?t.depth[X]:t.depth[P])+1,y[2*X+1]=y[2*P+1]=G,t.heap[1]=G++,d(t,y,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,U)=>{const y=U.dyn_tree,I=U.max_code,r=U.stat_desc.static_tree,mt=U.stat_desc.has_stree,X=U.stat_desc.extra_bits,P=U.stat_desc.extra_base,G=U.stat_desc.max_length;let M,L,h,Q,F,E,w=0;for(Q=0;Q<=Y;Q++)t.bl_count[Q]=0;for(y[2*t.heap[t.heap_max]+1]=0,M=t.heap_max+1;M<573;M++)L=t.heap[M],Q=y[2*y[2*L+1]+1]+1,Q>G&&(Q=G,w++),y[2*L+1]=Q,L>I||(t.bl_count[Q]++,F=0,L>=P&&(F=X[L-P]),E=y[2*L],t.opt_len+=E*(Q+F),mt&&(t.static_len+=E*(r[2*L+1]+F)));if(0!==w){do{for(Q=G-1;0===t.bl_count[Q];)Q--;t.bl_count[Q]--,t.bl_count[Q+1]+=2,t.bl_count[G]--,w-=2}while(w>0);for(Q=G;0!==Q;Q--)for(L=t.bl_count[Q];0!==L;)h=t.heap[--M],h>I||(y[2*h+1]!==Q&&(t.opt_len+=(Q-y[2*h+1])*y[2*h],y[2*h+1]=Q),L--)}})(t,U),N(y,M,t.bl_count)},e=(t,U,y)=>{let I,r,Y=-1,mt=U[1],X=0,P=7,G=4;for(0===mt&&(P=138,G=3),U[2*(y+1)+1]=65535,I=0;I<=y;I++)r=mt,mt=U[2*(I+1)+1],++X<P&&r===mt||(X<G?t.bl_tree[2*r]+=X:0!==r?(r!==Y&&t.bl_tree[2*r]++,t.bl_tree[32]++):X<=10?t.bl_tree[34]++:t.bl_tree[36]++,X=0,Y=r,0===mt?(P=138,G=3):r===mt?(P=6,G=3):(P=7,G=4))},o=(t,U,y)=>{let I,r,Y=-1,mt=U[1],X=0,P=7,G=4;for(0===mt&&(P=138,G=3),I=0;I<=y;I++)if(r=mt,mt=U[2*(I+1)+1],!(++X<P&&r===mt)){if(X<G)do{f(t,r,t.bl_tree)}while(0!==--X);else 0!==r?(r!==Y&&(f(t,r,t.bl_tree),X--),f(t,16,t.bl_tree),c(t,X-3,2)):X<=10?(f(t,17,t.bl_tree),c(t,X-3,3)):(f(t,18,t.bl_tree),c(t,X-11,7));X=0,Y=r,0===mt?(P=138,G=3):r===mt?(P=6,G=3):(P=7,G=4)}};let V=!1;const n=(t,U,y,I)=>{c(t,0+(I?1:0),3),((t,U,y,I)=>{J(t),I&&(p(t,y),p(t,~y)),t.pending_buf.set(t.window.subarray(U,U+y),t.pending),t.pending+=y})(t,U,y,!0)};t.exports._tr_init=t=>{V||((()=>{let t,U,y,G,B;const b=new Array(16);for(y=0,G=0;G<28;G++)for(F[G]=y,t=0;t<1<<mt[G];t++)Q[y++]=G;for(Q[y-1]=G,B=0,G=0;G<16;G++)for(E[G]=B,t=0;t<1<<X[G];t++)h[B++]=G;for(B>>=7;G<r;G++)for(E[G]=B<<7,t=0;t<1<<X[G]-7;t++)h[256+B++]=G;for(U=0;U<=Y;U++)b[U]=0;for(t=0;t<=143;)M[2*t+1]=8,t++,b[8]++;for(;t<=255;)M[2*t+1]=9,t++,b[9]++;for(;t<=279;)M[2*t+1]=7,t++,b[7]++;for(;t<=287;)M[2*t+1]=8,t++,b[8]++;for(N(M,287,b),t=0;t<r;t++)L[2*t+1]=5,L[2*t]=S(t,5);D=new w(M,mt,257,I,Y),l=new w(L,X,0,r,Y),g=new w(new Array(0),P,0,19,7)})(),V=!0),t.l_desc=new B(t.dyn_ltree,D),t.d_desc=new B(t.dyn_dtree,l),t.bl_desc=new B(t.bl_tree,g),t.bi_buf=0,t.bi_valid=0,j(t)},t.exports._tr_stored_block=n,t.exports._tr_flush_block=(t,U,I,r)=>{let Y,mt,X=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let U,I=4093624447;for(U=0;U<=31;U++,I>>>=1)if(1&I&&0!==t.dyn_ltree[2*U])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(U=32;U<y;U++)if(0!==t.dyn_ltree[2*U])return 1;return 0})(t)),H(t,t.l_desc),H(t,t.d_desc),X=(t=>{let U;for(e(t,t.dyn_ltree,t.l_desc.max_code),e(t,t.dyn_dtree,t.d_desc.max_code),H(t,t.bl_desc),U=18;U>=3&&0===t.bl_tree[2*G[U]+1];U--);return t.opt_len+=3*(U+1)+5+5+4,U})(t),Y=t.opt_len+3+7>>>3,mt=t.static_len+3+7>>>3,mt<=Y&&(Y=mt)):Y=mt=I+5,I+4<=Y&&-1!==U?n(t,U,I,r):4===t.strategy||mt===Y?(c(t,2+(r?1:0),3),q(t,M,L)):(c(t,4+(r?1:0),3),((t,U,y,I)=>{let r;for(c(t,U-257,5),c(t,y-1,5),c(t,I-4,4),r=0;r<I;r++)c(t,t.bl_tree[2*G[r]+1],3);o(t,t.dyn_ltree,U-1),o(t,t.dyn_dtree,y-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,X+1),q(t,t.dyn_ltree,t.dyn_dtree)),j(t),r&&J(t)},t.exports._tr_tally=(t,U,I)=>(t.pending_buf[t.d_buf+2*t.last_lit]=U>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&U,t.pending_buf[t.l_buf+t.last_lit]=255&I,t.last_lit++,0===U?t.dyn_ltree[2*I]++:(t.matches++,U--,t.dyn_ltree[2*(Q[I]+y+1)]++,t.dyn_dtree[2*b(U)]++),t.last_lit===t.lit_bufsize-1),t.exports._tr_align=t=>{c(t,2,3),f(t,256,M),(t=>{16===t.bi_valid?(p(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},13334:t=>{"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.hU="",this.state=null,this.data_type=2,this.adler=0}},13233:t=>{function U(t,U,y){for(var I=t.length,r=-1/0,Y=1/0,mt=0;mt<I;mt++){var X=(y[0][mt]-t[mt])/U[mt],P=(y[1][mt]-t[mt])/U[mt];if(X>P){var G=X;X=P,P=G}if(P<r||X>Y)return 1/0;X>r&&(r=X),P<Y&&(Y=P)}return r>Y?1/0:r}t.exports=function(t,y,I,r){var Y=U(y,I,r);if(Y===1/0)t=null;else{t=t||[];for(var mt=0;mt<y.length;mt++)t[mt]=y[mt]+I[mt]*Y}return t},t.exports.distance=U},14317:(t,U,y)=>{"use strict";y.d(U,{b:()=>mt});var I=y(32);const r=I.useLayoutEffect;const Y=function(t){var U=(0,I.useRef)(t);return r((function(){U.current=t})),U};var mt=function(t){var U=Y(t);(0,I.GU)((function(){var t=function(t){var y;if(null!=U.current&&(y=U.current(t)),t.defaultPrevented&&(t.returnValue=""),"string"===typeof y)return t.returnValue=y,y};return window.addEventListener("beforeunload",t),function(){window.removeEventListener("beforeunload",t)}}),[])}},14269:(t,U,y)=>{"use strict";var I=y(14271),r=Array.prototype.concat,Y=Array.prototype.slice,mt=t.exports=function(t){for(var U=[],y=0,mt=t.length;y<mt;y++){var X=t[y];I(X)?U=r.call(U,Y.call(X)):U.push(X)}return U};mt.wrap=function(t){return function(){return t(mt(arguments))}}},14271:t=>{t.exports=function(t){return!(!t||"string"===typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},14223:t=>{"use strict";var U=[],y=[],I=[],r=[],Y=[],mt=[],X=[],P=[],G=[],M=[],L=[],h=[];t.exports=function(t,Q,F,E,w,D){for(var l=X,g=G,B=M,b=h,p=0;p<3;p++)l[p]=+F[p],B[p]=+Q.max[p],g[p]=+Q.base[p];D||(D=1e-10);var c=function(t,X,G,M,h,Q){var F=U,E=y,w=I,D=r,l=Y,g=mt,B=P,b=Math.floor,p=0,c=0,f=0,S=0,N=0;if(j(),0===f)return 0;for(S=d();c<=f;){if(J(S)&&a())return p;S=d()}for(p+=f,N=0;N<3;N++)M[N]+=G[N],h[N]+=G[N];return p;function j(){if(c=0,0!==(f=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2])))for(var t=0;t<3;t++){var U=G[t]>=0;D[t]=U?1:-1;var y=U?h[t]:M[t];F[t]=U?M[t]:h[t],E[t]=q(y,D[t]),w[t]=H(F[t],D[t]),B[t]=G[t]/f,l[t]=Math.abs(1/B[t]);var I=U?E[t]+1-y:y-E[t];g[t]=l[t]<1/0?l[t]*I:1/0}}function J(U){for(var y=D[0],I=0===U?E[0]:w[0],r=E[0]+y,Y=D[1],mt=1===U?E[1]:w[1],X=E[1]+Y,P=D[2],G=2===U?E[2]:w[2],M=E[2]+P,L=I;L!=r;L+=y)for(var h=mt;h!=X;h+=Y)for(var Q=G;Q!=M;Q+=P)if(t(L,h,Q))return!0;return!1}function a(){p+=c;var t=D[S],U=c/f,y=L;for(N=0;N<3;N++){var I=G[N]*U;M[N]+=I,h[N]+=I,y[N]=G[N]-I}if(t>0?h[S]=Math.round(h[S]):M[S]=Math.round(M[S]),X(p,S,t,y))return!0;for(N=0;N<3;N++)G[N]=y[N];return j(),0===f}function d(){var t=g[0]<g[1]?g[0]<g[2]?0:2:g[1]<g[2]?1:2,U=g[t]-c;for(c=g[t],E[t]+=D[t],g[t]+=l[t],N=0;N<3;N++)F[N]+=U*B[N],w[N]=H(F[N],D[N]);return t}function q(t,U){return b(t-U*Q)}function H(t,U){return b(t+U*Q)}}(t,E,l,g,B,D);if(!w){for(p=0;p<3;p++)b[p]=F[p]>0?B[p]-Q.max[p]:g[p]-Q.base[p];Q.translate(b)}return c}},13257:(t,U,y)=>{var I=y(13259);function r(t){for(var U,y,r=0,Y=t.length,mt=0;mt<t.length;){for(U=t[mt],y=0;mt<Y&&t[mt]===U;)++mt,++y;r+=I.log2(y)/7|0,r+=I.log2(U>>>0)/7|0,r+=2}return r}U.size=r,U.encode=function(t,U){U||(U=new Uint8Array(r(t)));for(var y,I,Y=0,mt=U.length,X=0;X<t.length;){for(y=t[X],I=0;X<t.length&&t[X]===y;)++X,++I;for(;Y<mt&&I>=128;)U[Y++]=128+(127&I),I>>>=7;if(Y>=mt)throw new Error("RLE buffer overflow");for(U[Y++]=I,y>>>=0;Y<mt&&y>=128;)U[Y++]=128+(127&y),y>>>=7;if(Y>=mt)throw new Error("RLE buffer overflow");U[Y++]=y}return U},U.decode=function(t,U){for(var y,I,r,Y,mt=U.length,X=t.length,P=0,G=0;G<X;){for(y=0,I=0;G<X&&t[G]>=128;)y+=(127&t[G++])<<I,I+=7;if(y+=t[G++]<<I,G>=X)throw new Error("RLE buffer underrun");if(P+y>mt)throw new Error("Chunk buffer overflow");for(r=0,I=0;G<X&&t[G]>=128;)r+=(127&t[G++])<<I,I+=7;if(G>=X)throw new Error("RLE buffer underrun");for(r+=t[G++]<<I,Y=0;Y<y;++Y)U[P++]=r}return U}},13259:(t,U)=>{"use strict";function y(t){var U=32;return(t&=-t)&&U--,65535&t&&(U-=16),16711935&t&&(U-=8),252645135&t&&(U-=4),858993459&t&&(U-=2),1431655765&t&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(t){return(t>0)-(t<0)},U.abs=function(t){var U=t>>31;return(t^U)-U},U.min=function(t,U){return U^(t^U)&-(t<U)},U.max=function(t,U){return t^(t^U)&-(t<U)},U.isPow2=function(t){return!(t&t-1)&&!!t},U.log2=function(t){var U,y;return U=(t>65535)<<4,U|=y=((t>>>=U)>255)<<3,U|=y=((t>>>=y)>15)<<2,(U|=y=((t>>>=y)>3)<<1)|(t>>>=y)>>1},U.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},U.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},U.countTrailingZeros=y,U.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},U.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},U.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var I=new Array(256);!function(t){for(var U=0;U<256;++U){var y=U,I=U,r=7;for(y>>>=1;y;y>>>=1)I<<=1,I|=1&y,--r;t[U]=I<<r&255}}(I),U.reverse=function(t){return I[255&t]<<24|I[t>>>8&255]<<16|I[t>>>16&255]<<8|I[t>>>24&255]},U.interleave2=function(t,U){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(t,U){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>U&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},U.interleave3=function(t,U,y){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<2},U.deinterleave3=function(t,U){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>U&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},U.nextCombination=function(t){var U=t|t-1;return U+1|(~U&-~U)-1>>>y(t)+1}},14395:(t,U,y)=>{"use strict";y.d(U,{b:()=>L});var I=y(14216),r=y(127);class Y{constructor(t,U,y,Y,mt,X,P){this.sG=new I(t.base,t.mL),this.dr=U,this.friction=y,this.restitution=Y,this.xm=mt,this.OQ=X,this.Zm=!!P,this.YM=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.NF=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.DG=r.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=r.create(),this._impulses=r.create(),this._sleepFrameCount=10}loadFromCopy(t){r.k(this.sG.base,t.sG.base),r.k(this.sG.mL,t.sG.mL),r.k(this.sG.max,t.sG.max),this.sG.mag=t.sG.mag,this.dr=t.dr,this.friction=t.friction,this.restitution=t.restitution,this.xm=t.xm,this.OQ=t.OQ,this.Zm=t.Zm,this.YM=t.YM,this.fluidDrag=t.fluidDrag,this.NF=t.NF,this.preventFallOffEdge=t.preventFallOffEdge,this.rolledBackLastTick=t.rolledBackLastTick,r.k(this.DG,t.DG),r.k(this.resting,t.resting),this.inFluid=t.inFluid,this._ratioInFluid=t._ratioInFluid,r.k(this._forces,t._forces),r.k(this._impulses,t._impulses),this._sleepFrameCount=t._sleepFrameCount}setPosition(t){mt(t),r.lU(t,t,this.sG.base),this.sG.translate(t),this.BG()}hr(){return r.clone(this.sG.base)}applyForce(t){mt(t),r.add(this._forces,this._forces,t),this.BG()}applyImpulse(t){mt(t),r.add(this._impulses,this._impulses,t),this.BG()}BG(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var mt=t=>{};var X=y(14216),P=y(127),G=y(14223);function M(){this.YM=.1,this.fluidDrag=.4,this.Rm=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function L(t,U,y){t=Object.assign(new M,t),this.gravity=t.gravity||[0,-10,0],this.YM=t.YM||.1,this.Rm=t.Rm||2,this.fluidDrag=t.fluidDrag||.4,this.minBounceImpulse=t.minBounceImpulse,this.bodies=[],this.GQ=t.GQ,this.testSolid=U,this.testFluid=y}L.prototype.KQ=function(t,U,y,I,r,mt){t=t||new X([0,0,0],[1,1,1]),"undefined"==typeof U&&(U=1),"undefined"==typeof y&&(y=1),"undefined"==typeof I&&(I=0),"undefined"==typeof r&&(r=1);var P=new Y(t,U,y,I,r,mt);return this.bodies.push(P),P},L.prototype.CQ=function(t){var U=this.bodies.indexOf(t);U<0||(this.bodies.splice(U,1),t.sG=t.OQ=null)};var h=P.create(),Q=P.create(),F=P.create(),E=P.create(),w=P.create(),D=P.create(),l=P.create(),g=new X([0,0,0],[1,1,1]),B=new Y(g,1,1,0,1,(()=>{}),!1);function b(t,U,y){return U=y,U*=1-(1-t.ratioInFluid)**2}L.prototype.MX=function(t){t/=1e3;var U=i(0,P.squaredLength(this.gravity));this.bodies.forEach((y=>function(t,U,y,I){P.k(w,U.resting),t.GQ&&B.loadFromCopy(U);if(U.dr<=0)return P.set(U.DG,0,0,0),P.set(U._forces,0,0,0),void P.set(U._impulses,0,0,0);var r=I||0===U.xm;if(function(t,U,y,I){if(U._sleepFrameCount>0)return!1;if(I)return!0;var r=!1,Y=.5*y*y*U.xm;return P.scale(n,t.gravity,Y),G(t.testSolid,U.sG,n,(function(){return r=!0,!0}),!0),r}(t,U,y,r))return;U._sleepFrameCount--,function(t,U){var y=U.sG,I=Math.floor(y.base[0]),r=Math.floor(y.base[2]),Y=Math.floor(y.base[1]),mt=Math.floor(y.max[1]);if(!t.testFluid(I,Y,r))return U.inFluid=!1,void(U.ratioInFluid=0);var X=1,G=Y+1;for(;G<=mt&&t.testFluid(I,G,r);)X++,G++;var M=(Y+X-y.base[1])/y.mL[1];M>1&&(M=1);var L=y.mL[0]*y.mL[1]*y.mL[2]*M,h=c;P.scale(h,t.gravity,-t.Rm*L*U.xm),U.applyForce(h),U.inFluid=!0,U.ratioInFluid=M}(t,U),O(U._forces),O(U._impulses),O(U.DG),O(U.resting),P.scale(h,U._forces,1/U.dr),P.UX(h,h,t.gravity,U.xm),P.scale(Q,U._impulses,1/U.dr),P.UX(Q,Q,h,y),P.add(U.DG,U.DG,Q),U.friction&&(f(t,0,U,Q,y),f(t,1,U,Q,y),f(t,2,U,Q,y));var Y=U.fluidDrag>=0?U.fluidDrag:t.fluidDrag,mt=U.YM>=0?U.YM:t.YM,X=mt,M=mt;U.inFluid&&(X=b(U,X,U.fluidDragHoriz>=0?U.fluidDragHoriz:Y),M=b(U,M,U.fluidDragVert>=0?U.fluidDragVert:Y));X=Math.max(1-X*y/U.dr,0),M=Math.max(1-M*y/U.dr,0),P.set(p,X,M,X),P.multiply(U.DG,U.DG,p),P.scale(F,U.DG,y),P.set(U._forces,0,0,0),P.set(U._impulses,0,0,0),U.Zm&&v(j,U.sG);P.k(D,F),P.set(l,0,0,0),U.preventFallOffEdge&&function(t,U,y,I){if(!U.resting[1]||y[1]>0)return;var r=e;v(r,U.sG);for(var Y=0;Y<3;Y+=2){P.set(H,0,0,0),H[Y]=y[Y];var mt=!0;(mt=(mt=(mt=(mt=mt&&!V(t,r.base[0]+H[0]+1e-5,r.base[1],r.base[2]+H[2]+1e-5))&&!V(t,r.max[0]+H[0]-1e-5,r.base[1],r.base[2]+H[2]+1e-5))&&!V(t,r.base[0]+H[0]+1e-5,r.base[1],r.max[2]+H[2]-1e-5))&&!V(t,r.max[0]+H[0]-1e-5,r.base[1],r.max[2]+H[2]-1e-5))?(I[Y]=y[Y]>0?1:-1,y[Y]=0):0===Y&&(P.set(o,y[0],0,0),N(t,r,o,I,U.slideOnCollision))}}(t,U,F,l);N(t,U.sG,F,U.resting,U.slideOnCollision),U.Zm&&function(t,U,y,I){if(U.resting[1]>=0&&!U.inFluid)return;var r=0!==U.resting[0],Y=0!==U.resting[2];if(!r&&!Y)return;var mt=Math.abs(I[0]/I[2]),X=4;if(!r&&mt>X)return;if(!Y&&mt<1/X)return;P.add(a,y.base,I);var M=t.testSolid;G(M,y,I,(function(t,U,y,I){if(1!==U)return!0;I[U]=0}));var L=y.base[1],h=U.inFluid?1.951:1.001,Q=Math.floor(L+h)-L;P.set(d,0,Q,0);var F=!1;if(G(M,y,d,(function(t,U,y,I){return F=!0,!0})),F)return;P.lU(q,a,y.base),q[1]=0,N(t,y,q,J,!0);var E=i(y.base[0],a[0]),w=i(y.base[2],a[2]);if(r&&!E&&(!w||!Y))return;if(Y&&(!E||!r)&&!w)return;var D=!0;if(D=D&&!V(t,y.base[0]+1e-5,y.base[1],y.base[2]+1e-5),D=D&&!V(t,y.max[0]-1e-5,y.base[1],y.base[2]+1e-5),D=D&&!V(t,y.base[0]+1e-5,y.base[1],y.max[2]-1e-5),D=D&&!V(t,y.max[0]-1e-5,y.base[1],y.max[2]-1e-5),D)return;v(U.sG,y),U.resting[0]=J[0],U.resting[2]=J[2],U.NF&&U.NF()}(t,U,j,D);for(var L=0;L<3;++L)U.resting[L]=U.resting[L]||l[L],E[L]=0,U.resting[L]&&(w[L]||(E[L]=-U.DG[L]),U.DG[L]=0);var g=P.length(E);g>.001&&(P.scale(E,E,U.dr),U.OQ&&U.OQ(E),U.restitution>0&&g>t.minBounceImpulse&&(P.scale(E,E,U.restitution),U.applyImpulse(E)));var S=P.squaredLength(U.DG);S>1e-5&&U.BG();t.GQ&&t.GQ(U)?(U.loadFromCopy(B),U.rolledBackLastTick=!0):U.rolledBackLastTick=!1}(this,y,t,U)))};var p=P.create([0,0,0]);var c=P.create();function f(t,U,y,I,r){var Y=y.resting[U],mt=I[U];if(!y.alwaysApplyHorizFriction||1!==U){if(0===Y)return;if(Y*mt<=0)return}P.k(S,y.DG),S[U]=0;var X=P.length(S);if(!i(X,0)){var G=Math.abs(y.friction*t.gravity[U]*r),M=X>G?(X-G)/X:0;y.DG[(U+1)%3]*=M,y.DG[(U+2)%3]*=M}}var S=P.create();function N(t,U,y,I,r){return P.set(I,0,0,0),G(t.testSolid,U,y,(function(t,U,y,Y){I[U]=y,Y[U]=0,r||(Y[0]=0,Y[1]=0,Y[2]=0)}))}var j=new X([],[]),J=P.create(),a=P.create(),d=P.create(),q=P.create();var H=P.create(),e=new X([],[]),o=P.create();function V(t,U,y,I){return t.testSolid(Math.floor(U),Math.floor(y-1),Math.floor(I))}var n=P.create();function i(t,U){return Math.abs(t-U)<1e-5}function v(t,U){for(var y=0;y<3;y++)t.base[y]=U.base[y],t.max[y]=U.max[y],t.mL[y]=U.mL[y]}var O=function(t){}},13280:t=>{"use strict";t.exports=function(t,U,y,I){var r=self||window;try{try{var Y;try{Y=new r.Blob([t])}catch(G){(Y=new(r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder)).append(t),Y=Y.getBlob()}var mt=r.URL||r.webkitURL,X=mt.createObjectURL(Y),P=new r[U](X,y);return mt.revokeObjectURL(X),P}catch(G){return new r[U]("data:application/javascript,".concat(encodeURIComponent(t)),y)}}catch(G){if(!I)throw Error("Inline worker is not supported");return new r[U](I,y)}}},13214:(t,U,y)=>{"use strict";function I(t,U,y,I,r){var Y={};return Object.keys(I).forEach((function(t){Y[t]=I[t]})),Y.enumerable=!!Y.enumerable,Y.configurable=!!Y.configurable,("value"in Y||Y.initializer)&&(Y.writable=!0),Y=y.slice().reverse().reduce((function(y,I){return I(t,U,y)||y}),Y),r&&void 0!==Y.initializer&&(Y.value=Y.initializer?Y.initializer.call(r):void 0,Y.initializer=void 0),void 0===Y.initializer&&(Object.defineProperty(t,U,Y),Y=null),Y}y.d(U,{b:()=>I})},13212:(t,U,y)=>{"use strict";function I(t,U,y,I){y&&Object.defineProperty(t,U,{enumerable:y.enumerable,configurable:y.configurable,writable:y.writable,value:y.initializer?y.initializer.call(I):void 0})}y.d(U,{e:()=>I})},14307:(t,U,y)=>{"use strict";y.d(U,{b:()=>mt,e:()=>L,g:()=>X,i:()=>Y,j:()=>P,m:()=>r,q:()=>G,u:()=>M});var I=y(12623);class r{constructor(){this._easingMode=r.EASINGMODE_EASEIN}setEasingMode(t){const U=Math.min(Math.max(t,0),2);this._easingMode=U}getEasingMode(){return this._easingMode}easeInCore(t){throw new Error("You must implement this method")}ease(t){switch(this._easingMode){case r.EASINGMODE_EASEIN:return this.easeInCore(t);case r.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}r.EASINGMODE_EASEIN=0,r.EASINGMODE_EASEOUT=1,r.EASINGMODE_EASEINOUT=2;class Y extends r{easeInCore(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)}}class mt extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=t}easeInCore(t){const U=Math.max(0,this.amplitude);return Math.pow(t,3)-t*U*Math.sin(3.141592653589793*t)}}class X extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=t,this.bounciness=U}easeInCore(t){const U=Math.max(0,this.bounces);let y=this.bounciness;y<=1&&(y=1.001);const I=Math.pow(y,U),r=1-y,Y=(1-I)/r+.5*I,mt=t*Y,X=Math.log(-mt*(1-y)+1)/Math.log(y),P=Math.floor(X),G=P+1,M=(1-Math.pow(y,P))/(r*Y),L=.5*(M+(1-Math.pow(y,G))/(r*Y)),h=t-L,Q=L-M;return-Math.pow(1/y,U-P)/(Q*Q)*(h-Q)*(h+Q)}}class P extends r{easeInCore(t){return t*t*t}}class G extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=t,this.springiness=U}easeInCore(t){let U;const y=Math.max(0,this.oscillations),I=Math.max(0,this.springiness);return U=0==I?t:(Math.exp(I*t)-1)/(Math.exp(I)-1),U*Math.sin((6.283185307179586*y+1.5707963267948966)*t)}}class M extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=t}easeInCore(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}}class L extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=t,this.y1=U,this.x2=y,this.y2=I}easeInCore(t){return I.d.Interpolate(t,this.x1,this.y1,this.x2,this.y2)}}},13774:(t,U,y)=>{"use strict";y.d(U,{e:()=>mt});var I=y(12386),r=y(12399),Y=y(12835);class mt extends Y.c{get _matrix(){return this._compose(),this.Zh}set _matrix(t){(t.updateFlag!==this.Zh.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Zh.Y(t),this._markAsDirtyAndDecompose())}constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mt=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(t,U.St(),!1),this.name=t,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=U,this.Zh=(null===r||void 0===r?void 0:r.clone())??I.Matrix.Identity(),this._restMatrix=Y??this.Zh.clone(),this._bindMatrix=mt??this.Zh.clone(),this._index=X,this._absoluteMatrix=new I.Matrix,this._absoluteBindMatrix=new I.Matrix,this._absoluteInverseBindMatrix=new I.Matrix,this._finalMatrix=new I.Matrix,U.bones.push(this),this.setParent(y,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(t){this.setParent(t)}setParent(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==t){if(this.parent){const t=this.parent.children.indexOf(this);-1!==t&&this.parent.children.splice(t,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),U&&this._updateAbsoluteBindMatrices(),this.TG()}}getLocalMatrix(){return this._compose(),this.Zh}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(t){this._restMatrix.Y(t)}setRestPose(t){this.setRestMatrix(t)}getBindPose(){return this.getBindMatrix()}setBindMatrix(t){this.fX(t)}setBindPose(t){this.setBindMatrix(t)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const t=I.TmpVectors.DU[0],U=I.TmpVectors.Quaternion[0],y=I.TmpVectors.DU[1];this.getRestMatrix().decompose(t,U,y),this._linkedTransformNode.position.Y(y),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??I.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.Y(U),this._linkedTransformNode.dX.Y(t)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.yP}set position(t){this._decompose(),this.yP.Y(t),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(t){this.setRotationQuaternion(t)}get dX(){return this.getScale()}set dX(t){this.setScale(t)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=I.DU.Zero(),this._localRotation=I.Quaternion.Zero(),this.yP=I.DU.Zero()),this.Zh.decompose(this._localScaling,this._localRotation,this.yP))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,I.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.yP,this.Zh)):this._needToCompose=!1)}fX(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.Y(t),U&&this._updateAbsoluteBindMatrices(),y?this._matrix=t:this.TG()}_updateAbsoluteBindMatrices(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t||(t=this._bindMatrix),this.parent?t.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.Y(t),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),U)for(let y=0;y<this.children.length;y++)this.children[y]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}TG(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.TG(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.TG(),this._needToDecompose=!0}_updatePosition(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Y=this.getLocalMatrix();if(0==U)r?(Y.addAtIndex(12,t.x),Y.addAtIndex(13,t.y),Y.addAtIndex(14,t.z)):Y.setTranslationFromFloats(t.x,t.y,t.z);else{let U=null;y&&(U=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=mt._TmpMats[0],P=mt._TmpVecs[0];this.parent?y&&U?(X.Y(this.parent.getAbsoluteMatrix()),X.multiplyToRef(U,X)):X.Y(this.parent.getAbsoluteMatrix()):I.Matrix.IdentityToRef(X),r&&X.setTranslationFromFloats(0,0,0),X.invert(),I.DU.TransformCoordinatesToRef(t,X,P),r?(Y.addAtIndex(12,P.x),Y.addAtIndex(13,P.y),Y.addAtIndex(14,P.z)):Y.setTranslationFromFloats(P.x,P.y,P.z)}this._markAsDirtyAndDecompose()}translate(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,U,y,!0)}setPosition(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,U,y,!1)}setAbsolutePosition(t,U){this.setPosition(t,1,U)}scale(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Y=this.getLocalMatrix(),X=mt._TmpMats[0];I.Matrix.ScalingToRef(t,U,y,X),X.multiplyToRef(Y,Y),X.invert();for(const I of this.children){const r=I.getLocalMatrix();r.multiplyToRef(X,r),r.multiplyAtIndex(12,t),r.multiplyAtIndex(13,U),r.multiplyAtIndex(14,y),I._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(const I of this.children)I.scale(t,U,y,r)}setScale(t){this._decompose(),this._localScaling.Y(t),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(t){this._decompose(),t.Y(this._localScaling)}setYawPitchRoll(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4?arguments[4]:void 0;if(0===r){const X=mt._TmpQuat;return I.Quaternion.RotationYawPitchRollToRef(t,U,y,X),void this.setRotationQuaternion(X,r,Y)}const X=mt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,Y))return;const P=mt._TmpMats[1];I.Matrix.RotationYawPitchRollToRef(t,U,y,P),X.multiplyToRef(P,P),this._rotateWithMatrix(P,r,Y)}rotate(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const Y=mt._TmpMats[0];Y.setTranslationFromFloats(0,0,0),I.Matrix.RotationAxisToRef(t,U,Y),this._rotateWithMatrix(Y,y,r)}setAxisAngle(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;if(0===y){const Y=mt._TmpQuat;return I.Quaternion.RotationAxisToRef(t,U,Y),void this.setRotationQuaternion(Y,y,r)}const Y=mt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,r))return;const X=mt._TmpMats[1];I.Matrix.RotationAxisToRef(t,U,X),Y.multiplyToRef(X,X),this._rotateWithMatrix(X,y,r)}setRotation(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(t.y,t.x,t.z,U,y)}setRotationQuaternion(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;if(0===U)return this._decompose(),this._localRotation.Y(t),void this._markAsDirtyAndCompose();const r=mt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,y))return;const Y=mt._TmpMats[1];I.Matrix.FromQuaternionToRef(t,Y),r.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,U,y)}setRotationMatrix(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;if(0===U){const r=mt._TmpQuat;return I.Quaternion.FromRotationMatrixToRef(t,r),void this.setRotationQuaternion(r,U,y)}const r=mt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,y))return;const Y=mt._TmpMats[1];Y.Y(t),r.multiplyToRef(t,Y),this._rotateWithMatrix(Y,U,y)}_rotateWithMatrix(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;const I=this.getLocalMatrix(),r=I.m[12],Y=I.m[13],X=I.m[14],P=this.getParent(),G=mt._TmpMats[3],M=mt._TmpMats[4];P&&1==U?(y?(G.Y(y.getWorldMatrix()),P.getAbsoluteMatrix().multiplyToRef(G,G)):G.Y(P.getAbsoluteMatrix()),M.Y(G),M.invert(),I.multiplyToRef(G,I),I.multiplyToRef(t,I),I.multiplyToRef(M,I)):1==U&&y?(G.Y(y.getWorldMatrix()),M.Y(G),M.invert(),I.multiplyToRef(G,I),I.multiplyToRef(t,I),I.multiplyToRef(M,I)):I.multiplyToRef(t,I),I.setTranslationFromFloats(r,Y,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(t,U){const y=mt._TmpMats[2];return t.Y(this.getAbsoluteMatrix()),U?(t.multiplyToRef(U.getWorldMatrix(),t),I.Matrix.ScalingToRef(U.dX.x,U.dX.y,U.dX.z,y)):I.Matrix.IdentityToRef(y),t.invert(),!isNaN(t.m[0])&&(y.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(y,t),!0)}hr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=I.DU.Zero();return this.getPositionToRef(t,U,y),y}getPositionToRef(){let t=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const t=this.getLocalMatrix();U.x=t.m[12],U.y=t.m[13],U.z=t.m[14]}else{let y=null;t&&(y=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let I=mt._TmpMats[0];t&&y?(I.Y(this.getAbsoluteMatrix()),I.multiplyToRef(y,I)):I=this.getAbsoluteMatrix(),U.x=I.m[12],U.y=I.m[13],U.z=I.m[14]}}getAbsolutePosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=I.DU.Zero();return this.getPositionToRef(1,t,U),U}getAbsolutePositionToRef(t,U){this.getPositionToRef(1,t,U)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Zh.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.Y(this.Zh);const t=this._skeleton.getPoseMatrix();t&&this._absoluteMatrix.multiplyToRef(t,this._absoluteMatrix)}const t=this.children,U=t.length;for(let y=0;y<U;y++)t[y].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}aP(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=I.DU.Zero();return this.getDirectionToRef(t,U,y),y}getDirectionToRef(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,r=null;U&&(r=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=mt._TmpMats[0];Y.Y(this.getAbsoluteMatrix()),U&&r&&Y.multiplyToRef(r,Y),I.DU.TransformNormalToRef(t,Y,y),y.normalize()}getRotation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=I.DU.Zero();return this.getRotationToRef(t,U,y),y}getRotationToRef(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;const I=mt._TmpQuat;this.getRotationQuaternionToRef(t,U,I),I.toEulerAnglesToRef(y)}getRotationQuaternion(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=I.Quaternion.Identity();return this.getRotationQuaternionToRef(t,U,y),y}getRotationQuaternionToRef(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),U.Y(this._localRotation);else{const y=mt._TmpMats[0],I=this.getAbsoluteMatrix();t?I.multiplyToRef(t.getWorldMatrix(),y):y.Y(I),y.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyAtIndex(1,this._scalingDeterminant),y.multiplyAtIndex(2,this._scalingDeterminant),y.decompose(void 0,U,void 0)}}getRotationMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1?arguments[1]:void 0;const y=I.Matrix.Identity();return this.getRotationMatrixToRef(t,U,y),y}getRotationMatrixToRef(){let t=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(U);else{const y=mt._TmpMats[0],I=this.getAbsoluteMatrix();t?I.multiplyToRef(t.getWorldMatrix(),y):y.Y(I),y.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyAtIndex(1,this._scalingDeterminant),y.multiplyAtIndex(2,this._scalingDeterminant),y.getRotationMatrixToRef(U)}}getAbsolutePositionFromLocal(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=I.DU.Zero();return this.getAbsolutePositionFromLocalToRef(t,U,y),y}getAbsolutePositionFromLocalToRef(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,r=null;U&&(r=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=mt._TmpMats[0];Y.Y(this.getAbsoluteMatrix()),U&&r&&Y.multiplyToRef(r,Y),I.DU.TransformCoordinatesToRef(t,Y,y)}getLocalPositionFromAbsolute(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=I.DU.Zero();return this.getLocalPositionFromAbsoluteToRef(t,U,y),y}getLocalPositionFromAbsoluteToRef(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,r=null;U&&(r=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=mt._TmpMats[0];Y.Y(this.getAbsoluteMatrix()),U&&r&&Y.multiplyToRef(r,Y),Y.invert(),I.DU.TransformCoordinatesToRef(t,Y,y)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const t=this._skeleton.bones.indexOf(this);if(-1!==t&&this._skeleton.bones.splice(t,1),this._parentNode&&this._parentNode.children){const t=this._parentNode.children,U=t.indexOf(this);-1!==U&&t.splice(U,1)}super.dispose()}}mt._TmpVecs=(0,r.d)(2,I.DU.Zero),mt._TmpQuat=I.Quaternion.Identity(),mt._TmpMats=(0,r.d)(5,I.Matrix.Identity)},14298:(t,U,y)=>{"use strict";y.d(U,{e:()=>H});var I=y(12366),r=y(12375),Y=y(12204),mt=y(12386),X=y(12404),P=y(12835),G=y(12868),M=y(12698),L=y(12234),h=y(12392);class Q{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(t){this._idleRotationSpeed=t}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(t){this._idleRotationWaitTime=t}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(t){this._idleRotationSpinupTime=t}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(t){this._attachedCamera=t;const U=this._attachedCamera.St();this._onPrePointerObservableObserver=U.onPrePointerObservable.add((t=>{t.type!==M.d.POINTERDOWN?t.type===M.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const t=L.b.Now;let U=0;null!=this._lastFrameTime&&(U=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const y=t-this._lastInteractionTime-this._idleRotationWaitTime,I=Math.max(Math.min(y/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*I,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(U/1e3))}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.St();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(t){this._lastInteractionTime=t??L.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<h.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=L.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var F=y(14307),E=y(12956);class w{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const U=this._attachedCamera;U&&(t?this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((t=>{if(t&&(t.SX(!0),t.getBoundingInfo)){const U=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*U,this.upperRadiusTransitionRange=.05*U}})):this._onMeshTargetChangedObserver&&U.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(t){return!!this._attachedCamera&&(this._attachedCamera.radius===t&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(w.EasingFunction.setEasingMode(w.EasingMode),this._radiusBounceTransition=E.e.CreateAnimation("radius",E.e.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const U=E.e.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.St(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));U&&this._animatables.push(U)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}w.EasingFunction=new F.b(.3),w.EasingMode=F.m.EASINGMODE_EASEOUT;class D{constructor(){this.onTargetFramingAnimationEndObservable=new Y.b,this._mode=D.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(t){this._mode=t}get mode(){return this._mode}set radiusScale(t){this._radiusScale=t}get radiusScale(){return this._radiusScale}set positionScale(t){this._positionScale=t}get positionScale(){return this._positionScale}set defaultElevation(t){this._defaultElevation=t}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(t){this._elevationReturnTime=t}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(t){this._elevationReturnWaitTime=t}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(t){this._framingTime=t}get framingTime(){return this._framingTime}init(){}attach(t){this._attachedCamera=t;const U=this._attachedCamera.St();D.EasingFunction.setEasingMode(D.EasingMode),this._onPrePointerObservableObserver=U.onPrePointerObservable.add((t=>{t.type!==M.d.POINTERDOWN?t.type===M.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((t=>{t&&t.getBoundingInfo&&this.zoomOnMesh(t,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.St();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.SX(!0);const I=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(I.minimumWorld,I.maximumWorld,U,y)}zoomOnMeshHierarchy(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.SX(!0);const I=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(I.min,I.max,U,y)}zoomOnMeshesHierarchy(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new mt.DU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new mt.DU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Y=0;Y<t.length;Y++){const U=t[Y].getHierarchyBoundingVectors(!0);mt.DU.CheckExtends(U.min,I,r),mt.DU.CheckExtends(U.max,I,r)}this.zoomOnBoundingInfo(I,r,U,y)}zoomOnBoundingInfo(t,U){let y,I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Y=t.y,X=Y+(U.y-Y)*this._positionScale,P=U.lU(t).scale(.5);if(!isFinite(X))return!1;if(I)y=new mt.DU(0,X,0);else{const U=t.add(P);y=new mt.DU(U.x,X,U.z)}this._vectorTransition||(this._vectorTransition=E.e.CreateAnimation("target",E.e.ANIMATIONTYPE_VECTOR3,60,D.EasingFunction)),this._betaIsAnimating=!0;let G=E.e.TransitionTo("target",y,this._attachedCamera,this._attachedCamera.St(),60,this._vectorTransition,this._framingTime);G&&this._animatables.push(G);let M=0;if(this._mode===D.FitFrustumSidesMode){const y=this._calculateLowerRadiusFromModelBoundingSphere(t,U);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=P.length()+this._attachedCamera.cX),M=y}else this._mode===D.IgnoreBoundsSizeMode&&(M=this._calculateLowerRadiusFromModelBoundingSphere(t,U),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.cX));if(this.autoCorrectCameraLimitsAndSensibility){const y=U.lU(t).length();this._attachedCamera.panningSensibility=5e3/y,this._attachedCamera.wheelPrecision=100/M}return this._radiusTransition||(this._radiusTransition=E.e.CreateAnimation("radius",E.e.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),G=E.e.TransitionTo("radius",M,this._attachedCamera,this._attachedCamera.St(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),r&&r(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),G&&this._animatables.push(G),!0}_calculateLowerRadiusFromModelBoundingSphere(t,U){const y=this._attachedCamera;if(!y)return 0;let I=y._calculateLowerRadiusFromModelBoundingSphere(t,U,this._radiusScale);return y.lowerRadiusLimit&&this._mode===D.IgnoreBoundsSizeMode&&(I=I<y.lowerRadiusLimit?y.lowerRadiusLimit:I),y.upperRadiusLimit&&(I=I>y.upperRadiusLimit?y.upperRadiusLimit:I),I}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=L.b.Now-this._lastInteractionTime,U=.5*Math.PI-this._defaultElevation,y=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>y&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.e.CreateAnimation("beta",E.e.ANIMATIONTYPE_FLOAT,60,D.EasingFunction));const t=E.e.TransitionTo("beta",U,this._attachedCamera,this._attachedCamera.St(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=L.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}D.EasingFunction=new F.u,D.EasingMode=F.m.EASINGMODE_EASEINOUT,D.IgnoreBoundsSizeMode=0,D.FitFrustumSidesMode=1;var l=y(12876),g=y(12908),B=y(13767),b=y(12198);class p{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(t){t=b.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),y=U.getInputElement();let I=0,r=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Y=>{var mt,X;const P=Y.event,G="touch"===P.pointerType;if(Y.type!==M.d.POINTERMOVE&&-1===this.buttons.indexOf(P.button))return;const L=P.target;if(this._altKey=P.altKey,this._ctrlKey=P.ctrlKey,this._metaKey=P.metaKey,this._shiftKey=P.shiftKey,this._buttonsPressed=P.buttons,U.isPointerLock){const t=P.movementX,U=P.movementY;this.onTouch(null,t,U),this._pointA=null,this._pointB=null}else{if(Y.type!==M.d.POINTERDOWN&&Y.type!==M.d.POINTERDOUBLETAP&&G&&(null===(mt=this._pointA)||void 0===mt?void 0:mt.pointerId)!==P.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==P.pointerId)return;if(Y.type!==M.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!G)if(Y.type===M.d.POINTERDOUBLETAP)this.onDoubleTap(P.pointerType);else if(Y.type!==M.d.POINTERUP||this._currentMousePointerIdDown!==P.pointerId&&!G){if(Y.type===M.d.POINTERMOVE)if(t||P.preventDefault(),this._pointA&&null===this._pointB){const t=P.clientX-this._pointA.x,U=P.clientY-this._pointA.y;this._pointA.x=P.clientX,this._pointA.y=P.clientY,this.onTouch(this._pointA,t,U)}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===P.pointerId?this._pointA:this._pointB;t.x=P.clientX,t.y=P.clientY;const U=this._pointA.x-this._pointB.x,y=this._pointA.y-this._pointB.y,mt=U*U+y*y,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:P.pointerId,type:Y.type};this.onMultiTouch(this._pointA,this._pointB,I,mt,r,X),r=X,I=mt}}else{try{null===L||void 0===L||L.releasePointerCapture(P.pointerId)}catch(h){}G||(this._pointB=null),U._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==P.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==P.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==I||r)&&(this.onMultiTouch(this._pointA,this._pointB,I,0,r,null),I=0,r=null),this._currentMousePointerIdDown=-1,this.onButtonUp(P),t||P.preventDefault()}else{try{null===L||void 0===L||L.setPointerCapture(P.pointerId)}catch(h){}if(null===this._pointA)this._pointA={x:P.clientX,y:P.clientY,pointerId:P.pointerId,type:P.pointerType};else{if(null!==this._pointB)return;this._pointB={x:P.clientX,y:P.clientY,pointerId:P.pointerId,type:P.pointerType}}-1!==this._currentMousePointerIdDown||G||(this._currentMousePointerIdDown=P.pointerId),this.onButtonDown(P),t||(P.preventDefault(),y&&y.focus())}}},this._observer=this.camera.St()._inputManager._addCameraPointerObserver(this._pointerInput,M.d.POINTERDOWN|M.d.POINTERUP|M.d.POINTERMOVE|M.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,I=0,r=null,this.onLostFocus()},this._contextMenuBind=t=>this.onContextMenu(t),y&&y.addEventListener("contextmenu",this._contextMenuBind,!1);const Y=this.camera.St().getEngine().getHostWindow();Y&&b.Tools.RegisterTopRootEvents(Y,[{name:"blur",handler:this._onLostFocus}])}vL(){if(this._onLostFocus){const t=this.camera.St().getEngine().getHostWindow();t&&b.Tools.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.St()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.St().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,U,y){}onMultiTouch(t,U,y,I,r,Y){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,I.b)([(0,r.I)()],p.prototype,"buttons",void 0);class c extends p{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,U){if(0!==this.panningSensibility&&t&&U){const y=U.x-t.x,I=U.y-t.y;this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=I/this.panningSensibility}}_computePinchZoom(t,U){const y=this.camera.radius||c.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=y*Math.sqrt(t)/Math.sqrt(U):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(U-t)*y*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(U-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,U,y){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=y/this.panningSensibility):(this.camera.inertialAlphaOffset-=U/this.angularSensibilityX,this.camera.inertialBetaOffset-=y/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,U,y,I,r,Y){0===y&&null===r||0===I&&null===Y||(this.multiTouchPanAndZoom?(this._computePinchZoom(y,I),this._computeMultiTouchPanning(r,Y)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(I)-Math.sqrt(y))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(y,I),this._isPinching=!0):this._computeMultiTouchPanning(r,Y)):this.multiTouchPanning?this._computeMultiTouchPanning(r,Y):this.pinchZoom&&this._computePinchZoom(y,I))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(t){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}c.MinimumRadiusForPinch=.001,(0,I.b)([(0,r.I)()],c.prototype,"buttons",void 0),(0,I.b)([(0,r.I)()],c.prototype,"angularSensibilityX",void 0),(0,I.b)([(0,r.I)()],c.prototype,"angularSensibilityY",void 0),(0,I.b)([(0,r.I)()],c.prototype,"pinchPrecision",void 0),(0,I.b)([(0,r.I)()],c.prototype,"pinchDeltaPercentage",void 0),(0,I.b)([(0,r.I)()],c.prototype,"useNaturalPinchZoom",void 0),(0,I.b)([(0,r.I)()],c.prototype,"pinchZoom",void 0),(0,I.b)([(0,r.I)()],c.prototype,"panningSensibility",void 0),(0,I.b)([(0,r.I)()],c.prototype,"multiTouchPanning",void 0),(0,I.b)([(0,r.I)()],c.prototype,"multiTouchPanAndZoom",void 0),B.b.ArcRotateCameraPointersInput=c;var f=y(12706);class S{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.St(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const y=U.event;if(!y.metaKey)if(U.type===f.b.KEYDOWN){if(this._ctrlPressed=y.ctrlKey,this._altPressed=y.altKey,-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysReset.indexOf(y.keyCode)){-1===this._keys.indexOf(y.keyCode)&&this._keys.push(y.keyCode),y.preventDefault&&(t||y.preventDefault())}}else if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysReset.indexOf(y.keyCode)){const U=this._keys.indexOf(y.keyCode);U>=0&&this._keys.splice(U,1),y.preventDefault&&(t||y.preventDefault())}})))}vL(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let U=0;U<this._keys.length;U++){const y=this._keys[U];-1!==this.keysLeft.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(y)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,I.b)([(0,r.I)()],S.prototype,"keysUp",void 0),(0,I.b)([(0,r.I)()],S.prototype,"keysDown",void 0),(0,I.b)([(0,r.I)()],S.prototype,"keysLeft",void 0),(0,I.b)([(0,r.I)()],S.prototype,"keysRight",void 0),(0,I.b)([(0,r.I)()],S.prototype,"keysReset",void 0),(0,I.b)([(0,r.I)()],S.prototype,"panningSensibility",void 0),(0,I.b)([(0,r.I)()],S.prototype,"zoomingSensibility",void 0),(0,I.b)([(0,r.I)()],S.prototype,"useAltToZoom",void 0),(0,I.b)([(0,r.I)()],S.prototype,"angularSpeed",void 0),B.b.ArcRotateCameraKeyboardMoveInput=S;var N=y(12451),j=y(12708);class J{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new mt.DU(0,0,0),this._globalOffset=new mt.DU(0,0,0),this._inertialPanning=mt.DU.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,U){let y=0;const I=.01*t*this.wheelDeltaPercentage*U;return y=t>0?I/(1+this.wheelDeltaPercentage):I*(1+this.wheelDeltaPercentage),y}attachControl(t){t=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==M.d.POINTERWHEEL)return;const y=U.event;let I=0;const r=y.deltaMode===j.d.DOM_DELTA_LINE?40:1,Y=-y.deltaY*r;if(this.customComputeDeltaFromMouseWheel)I=this.customComputeDeltaFromMouseWheel(Y,this,y);else if(this.wheelDeltaPercentage){if(I=this._computeDeltaFromMouseWheelLegacyEvent(Y,this.camera.radius),I>0){let t=this.camera.radius,U=this.camera.inertialRadiusOffset+I;for(let y=0;y<20&&!(t<=U)&&!(Math.abs(U*this.camera.inertia)<.001);y++)t-=U,U*=this.camera.inertia;t=(0,X.Clamp)(t,0,Number.MAX_VALUE),I=this._computeDeltaFromMouseWheelLegacyEvent(Y,t)}}else I=Y/(40*this.wheelPrecision);I&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(I)):this.camera.inertialRadiusOffset+=I),y.preventDefault&&(t||y.preventDefault())},this._observer=this.camera.St()._inputManager._addCameraPointerObserver(this._wheel,M.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.qX(0)}vL(){this._observer&&(this.camera.St()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,U=t.target.lU(t.position);this._hitPlane=N.d.FromPositionAndNormal(t.target,U)}_getPosition(){const t=this.camera,U=t.St(),y=U.createPickingRay(U.pointerX,U.pointerY,mt.Matrix.Identity(),t,!1);0===t.targetScreenOffset.x&&0===t.targetScreenOffset.y||(this._viewOffset.set(t.targetScreenOffset.x,t.targetScreenOffset.y,0),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),this._globalOffset=mt.DU.TransformNormal(this._viewOffset,t._cameraTransformMatrix),y.origin.addInPlace(this._globalOffset));let I=0;return this._hitPlane&&(I=y.intersectsPlane(this._hitPlane)??0),y.origin.addInPlace(y.direction.scaleInPlace(I))}_zoomToMouse(t){const U=this.camera,y=1-U.inertia;if(U.lowerRadiusLimit){const I=U.lowerRadiusLimit??0;U.radius-(U.inertialRadiusOffset+t)/y<I&&(t=(U.radius-I)*y-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const I=U.upperRadiusLimit??0;U.radius-(U.inertialRadiusOffset+t)/y>I&&(t=(U.radius-I)*y-U.inertialRadiusOffset)}const I=t/y/U.radius,r=this._getPosition(),Y=mt.TmpVectors.DU[6];r.subtractToRef(U.target,Y),Y.scaleInPlace(I),Y.scaleInPlace(y),this._inertialPanning.addInPlace(Y),U.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<h.b&&(t.x=0),Math.abs(t.y)<h.b&&(t.y=0),Math.abs(t.z)<h.b&&(t.z=0)}}(0,I.b)([(0,r.I)()],J.prototype,"wheelPrecision",void 0),(0,I.b)([(0,r.I)()],J.prototype,"zoomToMouseLocation",void 0),(0,I.b)([(0,r.I)()],J.prototype,"wheelDeltaPercentage",void 0),B.b.ArcRotateCameraMouseWheelInput=J;class a extends B.c{constructor(t){super(t)}addMouseWheel(){return this.add(new J),this}addPointers(){return this.add(new c),this}addKeyboard(){return this.add(new S),this}}var d=y(12338);function q(t,U){return isNaN(t)?U:t}P.c.AddNodeConstructor("ArcRotateCamera",((t,U)=>()=>new H(t,0,0,1,mt.DU.Zero(),U)));class H extends g.c{get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new mt.Matrix,this._upToYMatrix=new mt.Matrix,this._upVector=mt.DU.Zero()),t.normalize(),this._upVector.Y(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){mt.Matrix.RotationAlignToRef(mt.DU.UpReadOnly,this._upVector,this._yToUpMatrix),mt.Matrix.RotationAlignToRef(this._upVector,mt.DU.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const U=this.inputs.attached.pointers;U&&(U.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const U=this.inputs.attached.pointers;U&&(U.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const U=this.inputs.attached.pointers;U&&(U.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const U=this.inputs.attached.pointers;U&&(U.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const U=this.inputs.attached.keyboard;U&&(U.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const U=this.inputs.attached.keyboard;U&&(U.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const U=this.inputs.attached.keyboard;U&&(U.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const U=this.inputs.attached.mousewheel;U&&(U.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const U=this.inputs.attached.mousewheel;U&&(U.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const U=this.inputs.attached.mousewheel;U&&(U.wheelDeltaPercentage=t)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new w,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new D,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new Q,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(t,U,y,I,r,X){var P;let G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(t,mt.DU.Zero(),X,G),P=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=mt.DU.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=mt.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new mt.Matrix,this.panningAxis=new mt.DU(1,1,0),this._transformedDirection=new mt.DU,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Y.b,this.checkCollisions=!1,this.collisionRadius=new mt.DU(.5,.5,.5),this._previousPosition=mt.DU.Zero(),this._collisionVelocity=mt.DU.Zero(),this._newPosition=mt.DU.Zero(),this._computationVector=mt.DU.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new mt.DU(NaN,NaN,NaN),this._goalTargetScreenOffset=new mt.Vector2(NaN,NaN),this._onCollisionPositionChange=function(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y?(P.setPosition(U),P.OQ&&P.OQ(y)):P._previousPosition.Y(P._position);const I=Math.cos(P.alpha),r=Math.sin(P.alpha),Y=Math.cos(P.beta);let mt=Math.sin(P.beta);0===mt&&(mt=1e-4);const X=P._getTargetPosition();P._computationVector.aX(P.radius*I*mt,P.radius*Y,P.radius*r*mt),X.addToRef(P._computationVector,P._newPosition),P._position.Y(P._newPosition);let G=P.upVector;P.allowUpsideDown&&P.beta<0&&(G=G.clone(),G=G.negate()),P._computeViewMatrix(P._position,X,G),P._viewMatrix.addAtIndex(12,P.targetScreenOffset.x),P._viewMatrix.addAtIndex(13,P.targetScreenOffset.y),P._collisionTriggered=!1},this._target=mt.DU.Zero(),r&&this.setTarget(r),this.alpha=U,this.beta=y,this.radius=I,this.getViewMatrix(),this.inputs=new a(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new mt.DU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=mt.Vector2.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.Y(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.Y(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.Y(t)}const t=this._getLockedTargetPosition();return t||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>h.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Y=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Y?this._currentInterpolationFactor=Y:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=q(t,this._goalAlpha),this._goalBeta=q(U,this._goalBeta),this._goalRadius=q(y,this._goalRadius),this._goalTarget.set(q(I.x,this._goalTarget.x),q(I.y,this._goalTarget.y),q(I.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(q(r.x,this._goalTargetScreenOffset.x),q(r.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,X.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,X.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,X.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,X.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const r=arguments;U=b.Tools.BackCompatCameraNoPreventDefault(r),this._useCtrlForPanning=y,this._panningMouseButton=I,"boolean"===typeof r[0]&&(r.length>1&&(this._useCtrlForPanning=r[1]),r.length>2&&(this._panningMouseButton=r[2])),this.inputs.attachElement(U),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}vL(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let t=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){t=!0;const U=this.invertRotation?-1:1,y=this._calculateHandednessMultiplier();let I=this.inertialAlphaOffset*y;this.beta<0&&(I*=-1),this.alpha+=I*U,this.beta+=this.inertialBetaOffset*U,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<h.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<h.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*h.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){t=!0;const U=new mt.DU(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),U.multiplyInPlace(this.panningAxis),mt.DU.TransformNormalToRef(U,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const t=this.upVector,U=mt.DU.CrossToRef(this._transformedDirection,t,this._transformedDirection);mt.DU.CrossToRef(t,U,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);mt.DU.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.Y(this._transformedDirection)}else{if(this.parent){const t=mt.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.transposeToRef(t),mt.DU.TransformCoordinatesToRef(this._transformedDirection,t,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*h.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*h.b&&(this.inertialPanningY=0)}if(t)this.stopInterpolation();else if(this._isInterpolating){let t=!1;const U=this._scene.getEngine().getDeltaTime()/1e3,y=1-Math.pow(2,-U/this._currentInterpolationFactor),I=q(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const U=mt.TmpVectors.DU[0].set(q(this._goalTarget.x,this._target.x),q(this._goalTarget.y,this._target.y),q(this._goalTarget.z,this._target.z));mt.DU.LerpToRef(this.target,U,y,this._target),10*mt.DU.Distance(this.target,U)/I<h.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.Y(U),this.setTarget(this.target,!1,!0,!0)):t=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const U=mt.Quaternion.RotationAlphaBetaGammaToRef(q(this._goalAlpha,this.alpha),q(this._goalBeta,this.beta),0,mt.TmpVectors.Quaternion[0]),I=mt.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,mt.TmpVectors.Quaternion[1]),r=mt.Quaternion.SlerpToRef(I,U,y,mt.TmpVectors.Quaternion[2]);r.normalize();const Y=r.toAlphaBetaGammaToRef(mt.TmpVectors.DU[0]);if(this.alpha=Y.x,this.beta=Y.y,r.isApprox(U,h.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const t=U.toAlphaBetaGammaToRef(mt.TmpVectors.DU[0]);this.alpha=t.x,this.beta=t.y}else t=!0}if(isNaN(this._goalRadius)||(this.radius+=(I-this.radius)*y,Math.abs(I/this.radius-1)<h.b?(this._goalRadius=NaN,this.radius=I):t=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const U=mt.TmpVectors.Vector2[0].set(q(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),q(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));mt.Vector2.LerpToRef(this.targetScreenOffset,U,y,this.targetScreenOffset),mt.Vector2.Distance(this.targetScreenOffset,U)<h.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.Y(U)):t=!0}this._isInterpolating=t}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||mt.DU.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;var U,y;this.alpha=function(t){let U=Math.PI/2;return 0===t.x&&0===t.z||(U=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2)))),t.z<0&&(U=2*Math.PI-U),U}(this._computationVector),this.beta=(U=this._computationVector.y,y=this.radius,Math.acos(U/y));const I=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*I*Math.PI,this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.Y(t),this.rebuildAnglesAndRadius())}setTarget(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(I=this.overrideCloneAlphaBetaRadius??I,t.SX)U&&t.getBoundingInfo?this._targetBoundingCenter=t.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,t.SX(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const U=t,I=this._getTargetPosition();if(I&&!y&&I.equals(U))return;this._targetHost=null,this._target=U,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}I||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),U=Math.sin(this.alpha),y=Math.cos(this.beta);let I=Math.sin(this.beta);0===I&&(I=1e-4),0===this.radius&&(this.radius=1e-4);const r=this._getTargetPosition();if(this._computationVector.aX(this.radius*t*I,this.radius*y,this.radius*U*I),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||mt.DU.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.St().collisionsEnabled&&this.checkCollisions){const t=this.St().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.Y(this._newPosition);let t=this.upVector;this.allowUpsideDown&&I<0&&(t=t.negate()),this._computeViewMatrix(this._position,r,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.Y(r),this._viewMatrix}zoomOn(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t||this.St().meshes;const y=G.c.MinMax(t);let I=this._calculateLowerRadiusFromModelBoundingSphere(y.min,y.max);if(I=Math.max(Math.min(I,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=I*this.zoomOnFactor,this.mode===l.e.ORTHOGRAPHIC_CAMERA){const t=this.St().getEngine().getAspectRatio(this),U=I*this.zoomOnFactor/2;this.orthoLeft=-U*t,this.orthoRight=U*t,this.orthoBottom=-U,this.orthoTop=U}this.focusOn({min:y.min,max:y.max,distance:I},U)}focusOn(t){let U,y,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===t.min){const I=t||this.St().meshes;U=G.c.MinMax(I),y=mt.DU.Distance(U.min,U.max)}else{U=t,y=t.distance}this._target=G.c.Center(U),I||(this.maxZ=2*y)}createRigCamera(t,U){let y=0;switch(this.cameraRigMode){case l.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case l.e.RIG_MODE_VR:y=this._cameraRigParams.stereoHalfAngle*(0===U?1:-1);break;case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:y=this._cameraRigParams.stereoHalfAngle*(0===U?-1:1)}const I=new H(t,this.alpha+y,this.beta,this.radius,this._target,this.St());return I._cameraRigParams={},I.isRigCamera=!0,I.rigParent=this,I.upVector=this.upVector,I.mode=this.mode,I.orthoLeft=this.orthoLeft,I.orthoRight=this.orthoRight,I.orthoBottom=this.orthoBottom,I.orthoTop=this.orthoTop,I}_updateRigCameras(){const t=this._rigCameras[0],U=this._rigCameras[1];switch(t.beta=U.beta=this.beta,this.cameraRigMode){case l.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case l.e.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const I=mt.DU.Distance(t,U),r=this.St().getEngine().getAspectRatio(this),Y=Math.tan(this.fov/2),X=Y*r,P=.5*I*y,G=P*Math.sqrt(1+1/(X*X)),M=P*Math.sqrt(1+1/(Y*Y));return Math.max(G,M)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,I.b)([(0,r.I)()],H.prototype,"alpha",void 0),(0,I.b)([(0,r.I)()],H.prototype,"beta",void 0),(0,I.b)([(0,r.I)()],H.prototype,"radius",void 0),(0,I.b)([(0,r.I)()],H.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,I.b)([(0,r.E)("target")],H.prototype,"_target",void 0),(0,I.b)([(0,r.u)("targetHost")],H.prototype,"_targetHost",void 0),(0,I.b)([(0,r.I)()],H.prototype,"inertialAlphaOffset",void 0),(0,I.b)([(0,r.I)()],H.prototype,"inertialBetaOffset",void 0),(0,I.b)([(0,r.I)()],H.prototype,"inertialRadiusOffset",void 0),(0,I.b)([(0,r.I)()],H.prototype,"lowerAlphaLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"upperAlphaLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"lowerBetaLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"upperBetaLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"lowerRadiusLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"upperRadiusLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"lowerTargetYLimit",void 0),(0,I.b)([(0,r.I)()],H.prototype,"inertialPanningX",void 0),(0,I.b)([(0,r.I)()],H.prototype,"inertialPanningY",void 0),(0,I.b)([(0,r.I)()],H.prototype,"pinchToPanMaxDistance",void 0),(0,I.b)([(0,r.I)()],H.prototype,"panningDistanceLimit",void 0),(0,I.b)([(0,r.E)()],H.prototype,"panningOriginTarget",void 0),(0,I.b)([(0,r.I)()],H.prototype,"panningInertia",void 0),(0,I.b)([(0,r.I)()],H.prototype,"zoomToMouseLocation",null),(0,I.b)([(0,r.I)()],H.prototype,"zoomOnFactor",void 0),(0,I.b)([(0,r.D)()],H.prototype,"targetScreenOffset",void 0),(0,I.b)([(0,r.I)()],H.prototype,"allowUpsideDown",void 0),(0,I.b)([(0,r.I)()],H.prototype,"useInputToRestoreState",void 0),(0,I.b)([(0,r.I)()],H.prototype,"restoreStateInterpolationFactor",void 0),(0,d.f)("BABYLON.ArcRotateCamera",H)},13767:(t,U,y)=>{"use strict";y.d(U,{b:()=>mt,c:()=>X});var I=y(12221),r=y(12426),Y=y(12876),mt={};class X{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const U=t.getSimpleName();this.attached[U]?I.b.Warn("camera input of type "+U+" already exists on camera"):(this.attached[U]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const U in this.attached){const y=this.attached[U];if(y===t)return y.vL(),y.camera=null,delete this.attached[U],void this.rebuildInputCheck()}}removeByType(t){for(const U in this.attached){const y=this.attached[U];y.getClassName()===t&&(y.vL(),y.camera=null,delete this.attached[U],this.rebuildInputCheck())}}_addCheckInputs(t){const U=this.checkInputs;return()=>{U(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){t=!Y.e.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const U in this.attached)this.attached[U].attachControl(t)}}detachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const U in this.attached)this.attached[U].vL(),t&&(this.attached[U].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const U=this.attached[t];U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const U={};for(const y in this.attached){const t=this.attached[y],I=r.b.Serialize(t);U[t.getClassName()]=I}t.inputsmgr=U}parse(t){const U=t.inputsmgr;if(U){this.clear();for(const t in U){const y=mt[t];if(y){const I=U[t],Y=r.b.Parse((()=>new y),I,null);this.add(Y)}}}else for(const y in this.attached){const U=mt[this.attached[y].getClassName()];if(U){const I=r.b.Parse((()=>new U),t,null);this.remove(this.attached[y]),this.add(I)}}}}},13764:(t,U,y)=>{"use strict";y.d(U,{d:()=>p});var I=y(12366),r=y(12375),Y=y(12386),mt=y(12908),X=y(13767),P=y(12706),G=y(12198);class M{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(t){t=G.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.St(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const y=U.event;if(!y.metaKey)if(U.type===P.b.KEYDOWN){if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysUpward.indexOf(y.keyCode)||-1!==this.keysDownward.indexOf(y.keyCode)||-1!==this.keysRotateLeft.indexOf(y.keyCode)||-1!==this.keysRotateRight.indexOf(y.keyCode)||-1!==this.keysRotateUp.indexOf(y.keyCode)||-1!==this.keysRotateDown.indexOf(y.keyCode)){-1===this._keys.indexOf(y.keyCode)&&this._keys.push(y.keyCode),t||y.preventDefault()}}else if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysUpward.indexOf(y.keyCode)||-1!==this.keysDownward.indexOf(y.keyCode)||-1!==this.keysRotateLeft.indexOf(y.keyCode)||-1!==this.keysRotateRight.indexOf(y.keyCode)||-1!==this.keysRotateUp.indexOf(y.keyCode)||-1!==this.keysRotateDown.indexOf(y.keyCode)){const U=this._keys.indexOf(y.keyCode);U>=0&&this._keys.splice(U,1),t||y.preventDefault()}})))}vL(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let U=0;U<this._keys.length;U++){const y=this._keys[U],I=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(y)?t._localDirection.aX(-I,0,0):-1!==this.keysUp.indexOf(y)?t._localDirection.aX(0,0,I):-1!==this.keysRight.indexOf(y)?t._localDirection.aX(I,0,0):-1!==this.keysDown.indexOf(y)?t._localDirection.aX(0,0,-I):-1!==this.keysUpward.indexOf(y)?t._localDirection.aX(0,I,0):-1!==this.keysDownward.indexOf(y)?t._localDirection.aX(0,-I,0):-1!==this.keysRotateLeft.indexOf(y)?(t._localDirection.aX(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(y)?(t._localDirection.aX(0,0,0),t.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(y)?(t._localDirection.aX(0,0,0),t.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(y)&&(t._localDirection.aX(0,0,0),t.cameraRotation.x+=this._getLocalRotation()),t.St().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),Y.DU.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const t=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*t}}(0,I.b)([(0,r.I)()],M.prototype,"keysUp",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysUpward",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysDown",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysDownward",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysLeft",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysRight",void 0),(0,I.b)([(0,r.I)()],M.prototype,"rotationSpeed",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysRotateLeft",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysRotateRight",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysRotateUp",void 0),(0,I.b)([(0,r.I)()],M.prototype,"keysRotateDown",void 0),X.b.FreeCameraKeyboardMoveInput=M;var L=y(12204),h=y(12698);class Q{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new L.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=G.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),y=U.getInputElement();this._pointerInput||(this._pointerInput=I=>{const r=I.event,Y="touch"===r.pointerType;if(!this.touchEnabled&&Y)return;if(I.type!==h.d.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const mt=r.target;if(I.type===h.d.POINTERDOWN){if(Y&&-1!==this._activePointerId||!Y&&-1!==this._currentActiveButton)return;this._activePointerId=r.pointerId;try{null===mt||void 0===mt||mt.setPointerCapture(r.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=r.button),this._previousPosition={x:r.clientX,y:r.clientY},t||(r.preventDefault(),y&&y.focus()),U.isPointerLock&&this._onMouseMove&&this._onMouseMove(I.event)}else if(I.type===h.d.POINTERUP){if(Y&&this._activePointerId!==r.pointerId||!Y&&this._currentActiveButton!==r.button)return;try{null===mt||void 0===mt||mt.releasePointerCapture(r.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,t||r.preventDefault(),this._activePointerId=-1}else if(I.type===h.d.POINTERMOVE&&(this._activePointerId===r.pointerId||!Y))if(U.isPointerLock&&this._onMouseMove)this._onMouseMove(I.event);else if(this._previousPosition){const U=this.camera._calculateHandednessMultiplier(),y=(r.clientX-this._previousPosition.x)*U,I=r.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=y/this.angularSensibility,this.camera.cameraRotation.x+=I/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:y,offsetY:I}),this._previousPosition={x:r.clientX,y:r.clientY},t||r.preventDefault()}}),this._onMouseMove=y=>{if(!U.isPointerLock)return;const I=this.camera._calculateHandednessMultiplier(),r=y.movementX*I;this.camera.cameraRotation.y+=r/this.angularSensibility;const Y=y.movementY;this.camera.cameraRotation.x+=Y/this.angularSensibility,this._previousPosition=null,t||y.preventDefault()},this._observer=this.camera.St()._inputManager._addCameraPointerObserver(this._pointerInput,h.d.POINTERDOWN|h.d.POINTERUP|h.d.POINTERMOVE),y&&(this._contextMenuBind=t=>this.onContextMenu(t),y.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}vL(){if(this._observer){if(this.camera.St()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,I.b)([(0,r.I)()],Q.prototype,"buttons",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"angularSensibility",void 0),X.b.FreeCameraMouseInput=Q;var F,E=y(12708);class w{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new L.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=G.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==h.d.POINTERWHEEL)return;const y=U.event,I=y.deltaMode===E.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*I*y.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*I*y.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*I*y.deltaZ/this._normalize,y.preventDefault&&(t||y.preventDefault())},this._observer=this.camera.St()._inputManager._addCameraPointerObserver(this._wheel,h.d.POINTERWHEEL)}vL(){this._observer&&(this.camera.St()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,I.b)([(0,r.I)()],w.prototype,"wheelPrecisionX",void 0),(0,I.b)([(0,r.I)()],w.prototype,"wheelPrecisionY",void 0),(0,I.b)([(0,r.I)()],w.prototype,"wheelPrecisionZ",void 0),function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(F||(F={}));class D extends w{constructor(){super(...arguments),this._moveRelative=Y.DU.Zero(),this._rotateRelative=Y.DU.Zero(),this._moveScene=Y.DU.Zero(),this._wheelXAction=F.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=F.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==F.MoveRelative||(this._wheelXAction=F.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==F.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==F.MoveRelative||(this._wheelYAction=F.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==F.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==F.MoveRelative||(this._wheelZAction=F.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==F.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==F.RotateRelative||(this._wheelXAction=F.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==F.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==F.RotateRelative||(this._wheelYAction=F.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==F.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==F.RotateRelative||(this._wheelZAction=F.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==F.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==F.MoveScene||(this._wheelXAction=F.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==F.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==F.MoveScene||(this._wheelYAction=F.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==F.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==F.MoveScene||(this._wheelZAction=F.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==F.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.qX(0),this._rotateRelative.qX(0),this._moveScene.qX(0),this._updateCamera(),this.camera.St().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=Y.Matrix.Zero();this.camera.getViewMatrix().invertToRef(t);const U=Y.DU.Zero();Y.DU.TransformNormalToRef(this._moveRelative,t,U),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(U),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,U,y){if(0===t)return;if(null===U||null===y)return;let I=null;switch(U){case F.MoveRelative:I=this._moveRelative;break;case F.RotateRelative:I=this._rotateRelative;break;case F.MoveScene:I=this._moveScene}switch(y){case 0:I.set(t,0,0);break;case 1:I.set(0,t,0);break;case 2:I.set(0,0,t)}}}(0,I.b)([(0,r.I)()],D.prototype,"wheelXMoveRelative",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelYMoveRelative",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelZMoveRelative",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelXRotateRelative",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelYRotateRelative",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelZRotateRelative",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelXMoveScene",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelYMoveScene",null),(0,I.b)([(0,r.I)()],D.prototype,"wheelZMoveScene",null),X.b.FreeCameraMouseWheelInput=D;class l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=G.Tools.IsSafari()}attachControl(t){t=G.Tools.BackCompatCameraNoPreventDefault(arguments);let U=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=y=>{const I=y.event,r="mouse"===I.pointerType||this._isSafari&&"undefined"===typeof I.pointerType;if(this.allowMouse||!r)if(y.type===h.d.POINTERDOWN){if(t||I.preventDefault(),this._pointerPressed.push(I.pointerId),1!==this._pointerPressed.length)return;U={x:I.clientX,y:I.clientY}}else if(y.type===h.d.POINTERUP){t||I.preventDefault();const y=this._pointerPressed.indexOf(I.pointerId);if(-1===y)return;if(this._pointerPressed.splice(y,1),0!=y)return;U=null,this._offsetX=null,this._offsetY=null}else if(y.type===h.d.POINTERMOVE){if(t||I.preventDefault(),!U)return;if(0!=this._pointerPressed.indexOf(I.pointerId))return;this._offsetX=I.clientX-U.x,this._offsetY=-(I.clientY-U.y)}}),this._observer=this.camera.St()._inputManager._addCameraPointerObserver(this._pointerInput,h.d.POINTERDOWN|h.d.POINTERUP|h.d.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}vL(){if(this._pointerInput){if(this._observer&&(this.camera.St()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera,U=t._calculateHandednessMultiplier();t.cameraRotation.y=U*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const U=t._computeLocalCameraSpeed(),y=new Y.DU(0,0,0!==this.touchMoveSensibility?U*this._offsetY/this.touchMoveSensibility:0);Y.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(Y.DU.TransformCoordinates(y,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,I.b)([(0,r.I)()],l.prototype,"touchAngularSensibility",void 0),(0,I.b)([(0,r.I)()],l.prototype,"touchMoveSensibility",void 0),X.b.FreeCameraTouchInput=l;class g extends X.c{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new M),this}addMouse(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Q(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new D,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new l),this}clear(){super.clear(),this._mouseInput=null}}var B=y(12338),b=y(12285);class p extends mt.c{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const U=this.inputs.attached.mouse;U&&(U.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const U=this.inputs.attached.keyboard;U&&(U.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const U=this.inputs.attached.keyboard;U&&(U.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const U=this.inputs.attached.keyboard;U&&(U.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const U=this.inputs.attached.keyboard;U&&(U.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const U=this.inputs.attached.keyboard;U&&(U.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const U=this.inputs.attached.keyboard;U&&(U.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const U=this.inputs.attached.keyboard;U&&(U.keysRotateRight=t)}get keysRotateUp(){const t=this.inputs.attached.keyboard;return t?t.keysRotateUp:[]}set keysRotateUp(t){const U=this.inputs.attached.keyboard;U&&(U.keysRotateUp=t)}get keysRotateDown(){const t=this.inputs.attached.keyboard;return t?t.keysRotateDown:[]}set keysRotateDown(t){const U=this.inputs.attached.keyboard;U&&(U.keysRotateDown=t)}constructor(t,U,y){var I;super(t,U,y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),I=this,this.ellipsoid=new Y.DU(.5,1,.5),this.ellipsoidOffset=new Y.DU(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Y.DU.Zero(),this._diffPosition=Y.DU.Zero(),this._newPosition=Y.DU.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I._newPosition.Y(U),I._newPosition.subtractToRef(I._oldPosition,I._diffPosition),I._diffPosition.length()>b.e.CollisionsEpsilon&&(I.position.addToRef(I._diffPosition,I._deferredPositionUpdate),I._deferOnly?I._deferredUpdated=!0:I.position.Y(I._deferredPositionUpdate),I.OQ&&y&&I.OQ(y))},this.inputs=new g(this),this.inputs.addKeyboard().addMouse()}attachControl(t,U){U=G.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(U)}vL(){this.inputs.detachElement(),this.cameraDirection=new Y.DU(0,0,0),this.cameraRotation=new Y.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let U;U=this.parent?Y.DU.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,U.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const y=this.St().collisionCoordinator;this._collider||(this._collider=y.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let I=t;this.applyGravity&&(I=t.add(this.St().gravity)),y.getNewPosition(this._oldPosition,I,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Y.DU.Zero(),this._transformedDirection=Y.DU.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(t){this._needMoveForGravity=t}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.St().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Gh"}}(0,I.b)([(0,r.E)()],p.prototype,"ellipsoid",void 0),(0,I.b)([(0,r.E)()],p.prototype,"ellipsoidOffset",void 0),(0,I.b)([(0,r.I)()],p.prototype,"checkCollisions",void 0),(0,I.b)([(0,r.I)()],p.prototype,"applyGravity",void 0),(0,B.f)("BABYLON.FreeCamera",p)},14359:(t,U,y)=>{"use strict";y.d(U,{b:()=>Y});var I=y(12496),r=y(14367);class Y{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=y,this.rL=[],this._maxBlockCapacity=U||64,this._selectionContent=new I.d(1024),this._creationFunc=t}update(t,U,y){r.c._CreateBlocks(t,U,y,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}LM(t){for(let U=0;U<this.cM.length;U++){this.cM[U].addEntry(t)}}MM(t){for(let U=0;U<this.cM.length;U++){this.cM[U].removeEntry(t)}}select(t,U){this._selectionContent.reset();for(let y=0;y<this.cM.length;y++){this.cM[y].select(t,this._selectionContent,U)}return U?this._selectionContent.concat(this.rL):this._selectionContent.concatWithNoDuplicate(this.rL),this._selectionContent}intersects(t,U,y){this._selectionContent.reset();for(let I=0;I<this.cM.length;I++){this.cM[I].intersects(t,U,this._selectionContent,y)}return y?this._selectionContent.concat(this.rL):this._selectionContent.concatWithNoDuplicate(this.rL),this._selectionContent}intersectsRay(t){this._selectionContent.reset();for(let U=0;U<this.cM.length;U++){this.cM[U].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.rL),this._selectionContent}}Y.CreationFuncForMeshes=(t,U)=>{const y=t.getBoundingInfo();!t.isBlocked&&y.boundingBox.intersectsMinMax(U.ML,U.LL)&&U.entries.push(t)},Y.CreationFuncForSubMeshes=(t,U)=>{t.getBoundingInfo().boundingBox.intersectsMinMax(U.ML,U.LL)&&U.entries.push(t)}},14367:(t,U,y)=>{"use strict";y.d(U,{c:()=>Y});var I=y(12386),r=y(12763);class Y{constructor(t,U,y,I,r,Y){this.entries=[],this.hL=new Array,this._capacity=y,this._depth=I,this._maxDepth=r,this._creationFunc=Y,this._minPoint=t,this._maxPoint=U,this.hL.push(t.clone()),this.hL.push(U.clone()),this.hL.push(t.clone()),this.hL[2].x=U.x,this.hL.push(t.clone()),this.hL[3].y=U.y,this.hL.push(t.clone()),this.hL[4].z=U.z,this.hL.push(U.clone()),this.hL[5].z=t.z,this.hL.push(U.clone()),this.hL[6].x=t.x,this.hL.push(U.clone()),this.hL[7].y=t.y}get fU(){return this._capacity}get ML(){return this._minPoint}get LL(){return this._maxPoint}addEntry(t){if(this.cM)for(let U=0;U<this.cM.length;U++){this.cM[U].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.fU&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(t){if(this.cM){for(let U=0;U<this.cM.length;U++){this.cM[U].removeEntry(t)}return}const U=this.entries.indexOf(t);U>-1&&this.entries.splice(U,1)}addEntries(t){for(let U=0;U<t.length;U++){const y=t[U];this.addEntry(y)}}select(t,U,y){if(r.d.IsInFrustum(this.hL,t)){if(this.cM){for(let I=0;I<this.cM.length;I++){this.cM[I].select(t,U,y)}return}y?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersects(t,U,y,I){if(r.d.IntersectsSphere(this._minPoint,this._maxPoint,t,U)){if(this.cM){for(let r=0;r<this.cM.length;r++){this.cM[r].intersects(t,U,y,I)}return}I?y.concat(this.entries):y.concatWithNoDuplicate(this.entries)}}intersectsRay(t,U){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.cM){for(let y=0;y<this.cM.length;y++){this.cM[y].intersectsRay(t,U)}return}U.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Y._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(t,U,y,r,mt,X,P,G){P.cM=new Array;const M=new I.DU((U.x-t.x)/2,(U.y-t.y)/2,(U.z-t.z)/2);for(let I=0;I<2;I++)for(let U=0;U<2;U++)for(let L=0;L<2;L++){const h=t.add(M.multiplyByFloats(I,U,L)),Q=t.add(M.multiplyByFloats(I+1,U+1,L+1)),F=new Y(h,Q,r,mt+1,X,G);F.addEntries(y),P.cM.push(F)}}}},14376:(t,U,y)=>{"use strict";y.d(U,{d:()=>M});var I=y(12653),r=y(12386),Y=y(12844),mt=y(13539),X=y(12694),P=y(14359),G=y(12250);I.e.prototype.createOrUpdateSelectionOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,y=this._getComponent(X.b.NAME_OCTREE);y||(y=new M(this),this.IX(y)),this.yL||(this.yL=new P.b(P.b.CreationFuncForMeshes,t,U));const I=this.getWorldExtends();return this.yL.update(I.min,I.max,this.meshes),this.yL},Object.defineProperty(I.e.prototype,"selectionOctree",{get:function(){return this.yL},enumerable:!0,configurable:!0}),Y.c.prototype.createOrUpdateSubmeshesOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const y=this.St();let I=y._getComponent(X.b.NAME_OCTREE);I||(I=new M(y),y.IX(I)),this._submeshesOctree||(this._submeshesOctree=new P.b(P.b.CreationFuncForSubMeshes,t,U)),this.SX(!0);const r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.BX),this._submeshesOctree};class M{constructor(t){this.name=X.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new mt.c(r.DU.Zero(),new r.DU(1,1,1)),(t=t||G.d.LastCreatedScene)&&(this.gU=t,this.gU.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.gU.getActiveSubMeshCandidates=t=>this.getActiveSubMeshCandidates(t),this.gU.getCollidingSubMeshCandidates=(t,U)=>this.getCollidingSubMeshCandidates(t,U),this.gU.getIntersectingSubMeshCandidates=(t,U)=>this.getIntersectingSubMeshCandidates(t,U))}register(){this.gU.onMeshRemovedObservable.add((t=>{const U=this.gU.selectionOctree;if(void 0!==U&&null!==U){const y=U.rL.indexOf(t);-1!==y&&U.rL.splice(y,1)}})),this.gU.onMeshImportedObservable.add((t=>{const U=this.gU.selectionOctree;void 0!==U&&null!==U&&U.LM(t)}))}getActiveMeshCandidates(){var t;return(null===(t=this.gU.yL)||void 0===t?void 0:t.select(this.gU.frustumPlanes))||this.gU._getDefaultMeshCandidates()}getActiveSubMeshCandidates(t){if(t._submeshesOctree&&t.useOctreeForRenderingSelection){return t._submeshesOctree.select(this.gU.frustumPlanes)}return this.gU._getDefaultSubMeshCandidates(t)}getIntersectingSubMeshCandidates(t,U){if(t._submeshesOctree&&t.useOctreeForPicking){mt.c.TransformToRef(U,t.getWorldMatrix(),this._tempRay);return t._submeshesOctree.intersectsRay(this._tempRay)}return this.gU._getDefaultSubMeshCandidates(t)}getCollidingSubMeshCandidates(t,U){if(t._submeshesOctree&&t.useOctreeForCollisions){const y=U._velocityWorldLength+Math.max(U._radius.x,U._radius.y,U._radius.z);return t._submeshesOctree.intersects(U._basePointWorld,y)}return this.gU._getDefaultSubMeshCandidates(t)}rebuild(){}dispose(){}}},13539:(t,U,y)=>{"use strict";y.d(U,{c:()=>Q});var I=y(12653),r=y(12876),Y=y(12392),mt=y(12386),X=y(12399),P=y(12751),G=y(12687),M=y(12250),L=y(12716);const h={internalPickerForMesh:void 0};class Q{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.b;this.origin=t,this.direction=U,this.length=y,this.epsilon=I}clone(){return new Q(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const I=Q._TmpVector3[0].aX(t.x-y,t.y-y,t.z-y),r=Q._TmpVector3[1].aX(U.x+y,U.y+y,U.z+y);let Y,mt,X,P,G=0,M=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<I.x||this.origin.x>r.x)return!1}else if(Y=1/this.direction.x,mt=(I.x-this.origin.x)*Y,X=(r.x-this.origin.x)*Y,X===-1/0&&(X=1/0),mt>X&&(P=mt,mt=X,X=P),G=Math.max(mt,G),M=Math.min(X,M),G>M)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<I.y||this.origin.y>r.y)return!1}else if(Y=1/this.direction.y,mt=(I.y-this.origin.y)*Y,X=(r.y-this.origin.y)*Y,X===-1/0&&(X=1/0),mt>X&&(P=mt,mt=X,X=P),G=Math.max(mt,G),M=Math.min(X,M),G>M)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<I.z||this.origin.z>r.z)return!1}else if(Y=1/this.direction.z,mt=(I.z-this.origin.z)*Y,X=(r.z-this.origin.z)*Y,X===-1/0&&(X=1/0),mt>X&&(P=mt,mt=X,X=P),G=Math.max(mt,G),M=Math.min(X,M),G>M)return!1;return!0}intersectsBox(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(t.minimum,t.maximum,U)}intersectsSphere(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=t.center.x-this.origin.x,I=t.center.y-this.origin.y,r=t.center.z-this.origin.z,Y=y*y+I*I+r*r,mt=t.radius+U,X=mt*mt;if(Y<=X)return!0;const P=y*this.direction.x+I*this.direction.y+r*this.direction.z;if(P<0)return!1;return Y-P*P<=X}intersectsTriangle(t,U,y){const I=Q._TmpVector3[0],r=Q._TmpVector3[1],Y=Q._TmpVector3[2],X=Q._TmpVector3[3],G=Q._TmpVector3[4];U.subtractToRef(t,I),y.subtractToRef(t,r),mt.DU.CrossToRef(this.direction,r,Y);const M=mt.DU.Dot(I,Y);if(0===M)return null;const L=1/M;this.origin.subtractToRef(t,X);const h=mt.DU.Dot(X,Y)*L;if(h<-this.epsilon||h>1+this.epsilon)return null;mt.DU.CrossToRef(X,I,G);const F=mt.DU.Dot(this.direction,G)*L;if(F<-this.epsilon||h+F>1+this.epsilon)return null;const E=mt.DU.Dot(r,G)*L;return E>this.length?null:new P.b(1-h-F,h,E)}intersectsPlane(t){let U;const y=mt.DU.Dot(t.normal,this.direction);if(Math.abs(y)<9.99999997475243e-7)return null;{const I=mt.DU.Dot(t.normal,this.origin);return U=(-t.d-I)/y,U<0?U<-9.99999997475243e-7?null:0:U}}intersectsAxis(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(t){case"y":{const t=(this.origin.y-U)/this.direction.y;return t>0?null:new mt.DU(this.origin.x+this.direction.x*-t,U,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-U)/this.direction.x;return t>0?null:new mt.DU(U,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-U)/this.direction.z;return t>0?null:new mt.DU(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,U)}default:return null}}intersectsMesh(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=mt.TmpVectors.Matrix[0];return t.getWorldMatrix().invertToRef(X),this._tmpRay?Q.TransformToRef(this,X,this._tmpRay):this._tmpRay=Q.Transform(this,X),t.intersects(this._tmpRay,U,y,I,r,Y)}intersectsMeshes(t,U,y){y?y.length=0:y=[];for(let I=0;I<t.length;I++){const r=this.intersectsMesh(t[I],U);r.hit&&y.push(r)}return y.sort(this._comparePickingInfo),y}_comparePickingInfo(t,U){return t.distance<U.distance?-1:t.distance>U.distance?1:0}intersectionSegment(t,U,y){const I=this.origin,r=mt.TmpVectors.DU[0],Y=mt.TmpVectors.DU[1],X=mt.TmpVectors.DU[2],P=mt.TmpVectors.DU[3];U.subtractToRef(t,r),this.direction.scaleToRef(Q._Rayl,X),I.addToRef(X,Y),t.subtractToRef(I,P);const G=mt.DU.Dot(r,r),M=mt.DU.Dot(r,X),L=mt.DU.Dot(X,X),h=mt.DU.Dot(r,P),F=mt.DU.Dot(X,P),E=G*L-M*M;let w,D,l=E,g=E;E<Q._Smallnum?(w=0,l=1,D=F,g=L):(w=M*F-L*h,D=G*F-M*h,w<0?(w=0,D=F,g=L):w>l&&(w=l,D=F+M,g=L)),D<0?(D=0,-h<0?w=0:-h>G?w=l:(w=-h,l=G)):D>g&&(D=g,-h+M<0?w=0:-h+M>G?w=l:(w=-h+M,l=G));const B=Math.abs(w)<Q._Smallnum?0:w/l,b=Math.abs(D)<Q._Smallnum?0:D/g,p=mt.TmpVectors.DU[4];X.scaleToRef(b,p);const c=mt.TmpVectors.DU[5];r.scaleToRef(B,c),c.addInPlace(P);const f=mt.TmpVectors.DU[6];c.subtractToRef(p,f);return b>0&&b<=this.length&&f.lengthSquared()<y*y?c.length():-1}update(t,U,y,I,r,Y,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Q._RayDistant||(Q._RayDistant=Q.Zero()),Q._RayDistant.unprojectRayToRef(t,U,y,I,mt.Matrix.IdentityReadOnly,Y,X);const P=mt.TmpVectors.Matrix[0];r.invertToRef(P),Q.TransformToRef(Q._RayDistant,P,this)}else this.unprojectRayToRef(t,U,y,I,r,Y,X);return this}static Zero(){return new Q(mt.DU.Zero(),mt.DU.Zero())}static CreateNew(t,U,y,I,r,Y,mt){return Q.Zero().update(t,U,y,I,r,Y,mt)}static CreateNewFromTo(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mt.Matrix.IdentityReadOnly;const I=new Q(new mt.DU(0,0,0),new mt.DU(0,0,0));return Q.CreateFromToToRef(t,U,I,y)}static CreateFromToToRef(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mt.Matrix.IdentityReadOnly;y.origin.Y(t);const r=U.subtractToRef(t,y.direction),Y=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return y.length=Y,y.direction.normalize(),Q.TransformToRef(y,I,y)}static Transform(t,U){const y=new Q(new mt.DU(0,0,0),new mt.DU(0,0,0));return Q.TransformToRef(t,U,y),y}static TransformToRef(t,U,y){mt.DU.TransformCoordinatesToRef(t.origin,U,y.origin),mt.DU.TransformNormalToRef(t.direction,U,y.direction),y.length=t.length,y.epsilon=t.epsilon;const I=y.direction,r=I.length();if(0!==r&&1!==r){const t=1/r;I.x*=t,I.y*=t,I.z*=t,y.length*=r}return y}unprojectRayToRef(t,U,y,I,r,Y,X){const P=mt.TmpVectors.Matrix[0];r.multiplyToRef(Y,P),P.multiplyToRef(X,P),P.invert();const G=M.d.LastCreatedEngine,L=mt.TmpVectors.DU[0];L.x=t/y*2-1,L.y=-(U/I*2-1),L.z=null!==G&&void 0!==G&&G.LX?1:null!==G&&void 0!==G&&G.isNDCHalfZRange?0:-1;const h=mt.TmpVectors.DU[1].aX(L.x,L.y,1-1e-8),Q=mt.TmpVectors.DU[2],F=mt.TmpVectors.DU[3];mt.DU._UnprojectFromInvertedMatrixToRef(L,P,Q),mt.DU._UnprojectFromInvertedMatrixToRef(h,P,F),this.origin.Y(Q),F.subtractToRef(Q,this.direction),this.direction.normalize()}}function F(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const mt=Q.Zero();return E(t,U,y,I,mt,r,Y),mt}function E(t,U,y,I,r,Y){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const G=t.getEngine();if(!Y&&!(Y=t.activeCamera))return t;const M=Y.viewport,L=G.getRenderHeight(),{x:h,y:Q,width:F,height:E}=M.toGlobal(G.getRenderWidth(),L),w=1/G.getHardwareScalingLevel();return U=U*w-h,y=y*w-(L-Q-E),r.update(U,y,F,E,I||mt.Matrix.IdentityReadOnly,X?mt.Matrix.IdentityReadOnly:Y.getViewMatrix(),Y.getProjectionMatrix(),P),t}function w(t,U,y,I,r){if(!G.c)return t;const Y=t.getEngine();if(!r&&!(r=t.activeCamera))throw new Error("Active camera not set");const X=r.viewport,P=Y.getRenderHeight(),{x:M,y:L,width:h,height:Q}=X.toGlobal(Y.getRenderWidth(),P),F=mt.Matrix.Identity(),E=1/Y.getHardwareScalingLevel();return U=U*E-M,y=y*E-(P-L-Q),I.update(U,y,h,Q,F,F,r.getProjectionMatrix()),t}function D(t,U,y,I,r,Y,mt,X){const P=U(I,y.enableDistantPicking),G=y.intersects(P,r,mt,Y,I,X);return G&&G.hit?!r&&null!=t&&G.distance>=t.distance?null:G:null}function l(t,U,y,I,r,Y){let X=null;const P=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),M=t.cameraToUseForPointers||t.activeCamera,L=h.internalPickerForMesh||D;for(let G=0;G<t.meshes.length;G++){const h=t.meshes[G];if(y){if(!y(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.KP)continue;const Q=P&&h.isWorldMatrixCameraDependent(),F=h.SX(Q,M);if(h.hasThinInstances&&h.NG){const t=L(X,U,h,F,!0,!0,Y);if(t){if(r)return t;const P=mt.TmpVectors.Matrix[1],G=h.thinInstanceGetWorldMatrices();for(let t=0;t<G.length;t++){if(y&&!y(h,t))continue;G[t].multiplyToRef(F,P);const mt=L(X,U,h,P,I,r,Y,!0);if(mt&&(X=mt,X.thinInstanceIndex=t,I))return X}}}else{const t=L(X,U,h,F,I,r,Y);if(t&&(X=t,I))return X}}return X||new G.c}function g(t,U,y,I){if(!G.c)return null;const r=[],Y=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),X=t.cameraToUseForPointers||t.activeCamera,P=h.internalPickerForMesh||D;for(let G=0;G<t.meshes.length;G++){const M=t.meshes[G];if(y){if(!y(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.KP)continue;const L=Y&&M.isWorldMatrixCameraDependent(),h=M.SX(L,X);if(M.hasThinInstances&&M.NG){if(P(null,U,M,h,!0,!0,I)){const t=mt.TmpVectors.Matrix[1],Y=M.thinInstanceGetWorldMatrices();for(let mt=0;mt<Y.length;mt++){if(y&&!y(M,mt))continue;Y[mt].multiplyToRef(h,t);const X=P(null,U,M,t,!1,!1,I,!0);X&&(X.thinInstanceIndex=mt,r.push(X))}}}else{const t=P(null,U,M,h,!1,!1,I);t&&r.push(t)}}return r}function B(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,I=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;I||(I=t.getWorldMatrix()),U.length=y,r?U.origin.Y(r):U.origin.Y(t.position);const Y=mt.TmpVectors.DU[2];Y.set(0,0,t._scene.useRightHandedSystem?-1:1);const X=mt.TmpVectors.DU[3];return mt.DU.TransformNormalToRef(Y,I,X),mt.DU.NormalizeToRef(X,U.direction),U}var b,p;Q._TmpVector3=(0,X.d)(6,mt.DU.Zero),Q._RayDistant=Q.Zero(),Q._Smallnum=1e-8,Q._Rayl=1e9,b=I.e,(p=r.e)&&(p.prototype.getForwardRay=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,U=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;return B(this,new Q(mt.DU.Zero(),mt.DU.Zero(),t),t,U,y)},p.prototype.getForwardRayToRef=function(t){return B(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),b&&(L.c._IsPickingAvailable=!0,b.prototype.createPickingRay=function(t,U,y,I){return F(this,t,U,y,I,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),I.e.prototype.createPickingRayToRef=function(t,U,y,I,r){return E(this,t,U,y,I,r,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},I.e.prototype.createPickingRayInCameraSpace=function(t,U,y){return function(t,U,y,I){const r=Q.Zero();return w(t,U,y,r,I),r}(this,t,U,y)},I.e.prototype.createPickingRayInCameraSpaceToRef=function(t,U,y,I){return w(this,t,U,y,I)},I.e.prototype.pickWithBoundingInfo=function(t,U,y,I,r){return function(t,U,y,I,r,Y){if(!G.c)return null;const X=l(t,(I=>(t._tempPickingRay||(t._tempPickingRay=Q.Zero()),E(t,U,y,I,t._tempPickingRay,Y||null),t._tempPickingRay)),I,r,!0);return X&&(X.ray=F(t,U,y,mt.Matrix.Identity(),Y||null)),X}(this,t,U,y,I,r)},I.e.prototype.wy=function(t,U,y,I,r,Y){return function(t,U,y,I,r,Y,X){const P=l(t,((I,r)=>(t._tempPickingRay||(t._tempPickingRay=Q.Zero()),E(t,U,y,I,t._tempPickingRay,Y||null,!1,r),t._tempPickingRay)),I,r,!1,X);return P&&(P.ray=F(t,U,y,mt.Matrix.Identity(),Y||null)),P}(this,t,U,y,I,r,Y)},I.e.prototype.pickWithRay=function(t,U,y,I){return function(t,U,y,I,r){const Y=l(t,(y=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=mt.Matrix.Identity()),y.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=Q.Zero()),Q.TransformToRef(U,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),y,I,!1,r);return Y&&(Y.ray=U),Y}(this,t,U,y,I)},I.e.prototype.multiPick=function(t,U,y,I,r){return function(t,U,y,I,r,Y){return g(t,(I=>F(t,U,y,I,r||null)),I,Y)}(this,t,U,y,I,r)},I.e.prototype.multiPickWithRay=function(t,U,y){return function(t,U,y,I){return g(t,(y=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=mt.Matrix.Identity()),y.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=Q.Zero()),Q.TransformToRef(U,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),y,I)}(this,t,U,y)}},13812:(t,U,y)=>{"use strict";var I=y(12320),r=y(12221),Y=y(12253),mt=y(12341),X=y(12285),P=y(12328);X.e.prototype._partialLoadFile=function(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(t,(t=>{y[U]=t,y._internalCount++,6===y._internalCount&&I(y)}),void 0,void 0,!0,((t,U)=>{r&&t&&r(t.status+" "+t.statusText,U)}))},X.e.prototype._cascadeLoadFiles=function(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=[];r._internalCount=0;for(let Y=0;Y<6;Y++)this._partialLoadFile(y[Y],Y,r,U,I)},X.e.prototype._cascadeLoadImgs=function(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5?arguments[5]:void 0;const mt=[];mt._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(I[X],X,mt,t,U,y,r,Y)},X.e.prototype._partialLoadImg=function(t,U,y,I,r,X){let P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0;const M=(0,mt.b)();(0,Y.v)(t,(t=>{y[U]=t,y._internalCount++,I&&I.removePendingData(M),6===y._internalCount&&X&&X(r,y)}),((t,U)=>{I&&I.removePendingData(M),P&&P(t,U)}),I?I.offlineProvider:null,G),I&&I.addPendingData(M)},X.e.prototype.createCubeTextureBase=function(t,U,y,Y){let mt=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6?arguments[6]:void 0,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]&&arguments[8],h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,w=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,D=arguments.length>14&&void 0!==arguments[14]&&arguments[14],l=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const g=F||new I.e(this,7);g.isCube=!0,g.url=t,g.generateMipMaps=!Y,g._lodGenerationScale=h,g._lodGenerationOffset=Q,g._useSRGBBuffer=!!D&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Y),g!==F&&(g.label=t.substring(0,60)),this._doNotHandleContextLost||(g._extension=M,g._files=y,g._buffer=l);const B=t;this._transformTextureUrl&&!F&&(t=this._transformTextureUrl(t));const b=M??function(t){const U=t.split("?")[0],y=U.lastIndexOf(".");return y>-1?U.substring(y).toLowerCase():""}(t),p=(0,P.b)(b),c=(t,U)=>{g.dispose(),X?X(t,U):t&&r.b.Warn(t)},f=(I,X)=>{t===B?I&&c(I.status+" "+I.statusText,X):(r.b.Warn(`Failed to load ${t}, falling back to the ${B}`),this.createCubeTextureBase(B,U,y,!!Y,mt,c,G,M,L,h,Q,g,E,w,D,l))};if(p)p.then((I=>{const r=t=>{E&&E(g,t),I.loadCubeData(t,g,L,mt,((t,U)=>{c(t,U)}))};l?r(l):y&&6===y.length?I.supportCascades?this._cascadeLoadFiles(U,(t=>r(t.map((t=>new Uint8Array(t))))),y,c):c("Textures type does not support cascades."):this._loadFile(t,(t=>r(new Uint8Array(t))),void 0,void 0,!0,f)}));else{if(!y||0===y.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,g,((t,U)=>{w&&w(t,U)}),y,c)}return this._internalTexturesCache.push(g),g}},14380:(t,U,y)=>{"use strict";y(12221);var I=y(12537);y(12320),y(12484),y(12313),y(12589),y(12545);I.c},13842:(t,U,y)=>{"use strict";y.d(U,{c:()=>r});var I=y(12338);class r{constructor(t){this.value=this._toInt(t)}_toInt(t){return 0|t}add(t){return new r(this.value+t.value)}lU(t){return new r(this.value-t.value)}multiply(t){return new r(Math.imul(this.value,t.value))}divide(t){return new r(this.value/t.value)}getClassName(){return r.ClassName}equals(t){return this.value===t.value}static FromValue(t){return new r(t)}toString(){return this.value.toString()}}r.ClassName="FlowGraphInteger",(0,I.f)("FlowGraphInteger",r)},13852:(t,U,y)=>{"use strict";y.d(U,{e:()=>r,g:()=>Y});var I=y(12386);class r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.wX=t}get m(){return this.wX}transformVector(t){return this.transformVectorToRef(t,new I.Vector2)}transformVectorToRef(t,U){return U.x=t.x*this.wX[0]+t.y*this.wX[1],U.y=t.x*this.wX[2]+t.y*this.wX[3],U}bX(){return this.toArray()}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<4;U++)t[U]=this.wX[U];return t}Dy(t){for(let U=0;U<4;U++)this.wX[U]=t[U];return this}multiplyToRef(t,U){const y=t.wX,I=this.wX,r=U.wX;return r[0]=y[0]*I[0]+y[1]*I[2],r[1]=y[0]*I[1]+y[1]*I[3],r[2]=y[2]*I[0]+y[3]*I[2],r[3]=y[2]*I[1]+y[3]*I[3],U}multiply(t){return this.multiplyToRef(t,new r)}divideToRef(t,U){const y=this.wX,I=t.wX,r=U.wX;return r[0]=y[0]/I[0],r[1]=y[1]/I[1],r[2]=y[2]/I[2],r[3]=y[3]/I[3],U}divide(t){return this.divideToRef(t,new r)}addToRef(t,U){const y=this.wX,I=t.m,r=U.m;return r[0]=y[0]+I[0],r[1]=y[1]+I[1],r[2]=y[2]+I[2],r[3]=y[3]+I[3],U}add(t){return this.addToRef(t,new r)}subtractToRef(t,U){const y=this.wX,I=t.m,r=U.m;return r[0]=y[0]-I[0],r[1]=y[1]-I[1],r[2]=y[2]-I[2],r[3]=y[3]-I[3],U}lU(t){return this.subtractToRef(t,new r)}transpose(){const t=this.wX;return new r([t[0],t[2],t[1],t[3]])}determinant(){const t=this.wX;return t[0]*t[3]-t[1]*t[2]}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible");const U=this.wX,y=1/t;return new r([U[3]*y,-U[1]*y,-U[2]*y,U[0]*y])}equals(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.wX,I=t.m;return 0===U?y[0]===I[0]&&y[1]===I[1]&&y[2]===I[2]&&y[3]===I[3]:Math.abs(y[0]-I[0])<U&&Math.abs(y[1]-I[1])<U&&Math.abs(y[2]-I[2])<U&&Math.abs(y[3]-I[3])<U}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.wX.join(", ")})`}}class Y{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.wX=t}get m(){return this.wX}transformVector(t){return this.transformVectorToRef(t,new I.DU)}transformVectorToRef(t,U){const y=this.wX;return U.x=t.x*y[0]+t.y*y[1]+t.z*y[2],U.y=t.x*y[3]+t.y*y[4]+t.z*y[5],U.z=t.x*y[6]+t.y*y[7]+t.z*y[8],U}multiplyToRef(t,U){const y=t.wX,I=this.wX,r=U.m;return r[0]=y[0]*I[0]+y[1]*I[3]+y[2]*I[6],r[1]=y[0]*I[1]+y[1]*I[4]+y[2]*I[7],r[2]=y[0]*I[2]+y[1]*I[5]+y[2]*I[8],r[3]=y[3]*I[0]+y[4]*I[3]+y[5]*I[6],r[4]=y[3]*I[1]+y[4]*I[4]+y[5]*I[7],r[5]=y[3]*I[2]+y[4]*I[5]+y[5]*I[8],r[6]=y[6]*I[0]+y[7]*I[3]+y[8]*I[6],r[7]=y[6]*I[1]+y[7]*I[4]+y[8]*I[7],r[8]=y[6]*I[2]+y[7]*I[5]+y[8]*I[8],U}multiply(t){return this.multiplyToRef(t,new Y)}divideToRef(t,U){const y=this.wX,I=t.m,r=U.m;return r[0]=y[0]/I[0],r[1]=y[1]/I[1],r[2]=y[2]/I[2],r[3]=y[3]/I[3],r[4]=y[4]/I[4],r[5]=y[5]/I[5],r[6]=y[6]/I[6],r[7]=y[7]/I[7],r[8]=y[8]/I[8],U}divide(t){return this.divideToRef(t,new Y)}addToRef(t,U){const y=this.wX,I=t.m,r=U.m;return r[0]=y[0]+I[0],r[1]=y[1]+I[1],r[2]=y[2]+I[2],r[3]=y[3]+I[3],r[4]=y[4]+I[4],r[5]=y[5]+I[5],r[6]=y[6]+I[6],r[7]=y[7]+I[7],r[8]=y[8]+I[8],U}add(t){return this.addToRef(t,new Y)}subtractToRef(t,U){const y=this.wX,I=t.m,r=U.m;return r[0]=y[0]-I[0],r[1]=y[1]-I[1],r[2]=y[2]-I[2],r[3]=y[3]-I[3],r[4]=y[4]-I[4],r[5]=y[5]-I[5],r[6]=y[6]-I[6],r[7]=y[7]-I[7],r[8]=y[8]-I[8],U}lU(t){return this.subtractToRef(t,new Y)}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<9;U++)t[U]=this.wX[U];return t}bX(){return this.toArray()}Dy(t){for(let U=0;U<9;U++)this.wX[U]=t[U];return this}transpose(){const t=this.wX;return new Y([t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]])}determinant(){const t=this.wX;return t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6])}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible");const U=this.wX,y=1/t;return new Y([(U[4]*U[8]-U[5]*U[7])*y,(U[2]*U[7]-U[1]*U[8])*y,(U[1]*U[5]-U[2]*U[4])*y,(U[5]*U[6]-U[3]*U[8])*y,(U[0]*U[8]-U[2]*U[6])*y,(U[2]*U[3]-U[0]*U[5])*y,(U[3]*U[7]-U[4]*U[6])*y,(U[1]*U[6]-U[0]*U[7])*y,(U[0]*U[4]-U[1]*U[3])*y])}equals(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.wX,I=t.m;return 0===U?y[0]===I[0]&&y[1]===I[1]&&y[2]===I[2]&&y[3]===I[3]&&y[4]===I[4]&&y[5]===I[5]&&y[6]===I[6]&&y[7]===I[7]&&y[8]===I[8]:Math.abs(y[0]-I[0])<U&&Math.abs(y[1]-I[1])<U&&Math.abs(y[2]-I[2])<U&&Math.abs(y[3]-I[3])<U&&Math.abs(y[4]-I[4])<U&&Math.abs(y[5]-I[5])<U&&Math.abs(y[6]-I[6])<U&&Math.abs(y[7]-I[7])<U&&Math.abs(y[8]-I[8])<U}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.wX.join(", ")})`}}},13855:(t,U,y)=>{"use strict";var I;function r(t,U,y,I){switch(U){case"Animation":return I?t.animations.find((t=>t.uniqueId===y))??null:t.animations[y]??null;case"AnimationGroup":return I?t.animationGroups.find((t=>t.uniqueId===y))??null:t.animationGroups[y]??null;case"Mesh":return I?t.meshes.find((t=>t.uniqueId===y))??null:t.meshes[y]??null;case"Material":return I?t.materials.find((t=>t.uniqueId===y))??null:t.materials[y]??null;case"gM":return I?t.cameras.find((t=>t.uniqueId===y))??null:t.cameras[y]??null;case"Light":return I?t.lights.find((t=>t.uniqueId===y))??null:t.lights[y]??null;default:return null}}y.d(U,{c:()=>r}),function(t){t.Animation="Animation",t.AnimationGroup="AnimationGroup",t.Mesh="Mesh",t.Material="Material",t.gM="gM",t.Light="Light"}(I||(I={}))},13893:(t,U,y)=>{"use strict";y.d(U,{e:()=>r});var I=y(13899);class r extends I.e{constructor(t,U){if(super(t),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),U)for(const y of U)this._eventsSignalOutputs[y]=this._registerSignalOutput(y+"Event")}_executeOnTick(t){}_startPendingTasks(t){t._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(t),this._resetAfterCanceled(t)),this._preparePendingTasks(t),t._addPendingBlock(this),this.out._activateSignal(t),t._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(t){t._deleteExecutionVariable(this,"_initialized"),t._removePendingBlock(this)}}},13865:(t,U,y)=>{"use strict";y.d(U,{c:()=>G});var I=y(12341),r=y(12338),Y=y(13872),mt=y(12204),X=y(13839);class P extends Y.c{constructor(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:I.defaultValue,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(t,U,y),this.richType=I,this._defaultValue=r,this._optional=Y,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new mt.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(t){this._isDisabled!==t&&(this._isDisabled=t,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(t,U){U._getConnectionValue(this)!==t&&(U._setConnectionValue(this,t),this.onValueChangedObservable.notifyObservers(t))}resetToDefaultValue(t){t._setConnectionValue(this,this._defaultValue)}connectTo(t){this._isDisabled||super.connectTo(t)}_getValueOrDefault(t){const U=t._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(t){if(1===this.connectionType){t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(t);const U=this._getValueOrDefault(t);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}const U=this.isConnected()?this._connectedPoint[0].getValue(t):this._getValueOrDefault(t);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.richType={},this.richType.serialize(t.richType),t.optional=this._optional,(0,X.e)("defaultValue",this._defaultValue,t)}}(0,r.f)("FlowGraphDataConnection",P);class G{constructor(t){var U;this.config=t,this.uniqueId=(0,I.b)(),this.name=(null===(U=this.config)||void 0===U?void 0:U.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(t){}registerDataInput(t,U,y){const I=new P(t,0,this,U,y);return this.dataInputs.push(I),I}registerDataOutput(t,U,y){const I=new P(t,1,this,U,y);return this.dataOutputs.push(I),I}getDataInput(t){return this.dataInputs.find((U=>U.name===t))}getDataOutput(t){return this.dataOutputs.find((U=>U.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.e;if(t.uniqueId=this.uniqueId,t.config={},this.config){const y=this.config,I=Object.keys(y);for(const r of I)U(r,y[r],t.config)}t.dataInputs=[],t.dataOutputs=[],t.className=this.getClassName();for(const y of this.dataInputs){const U={};y.serialize(U),t.dataInputs.push(U)}for(const y of this.dataOutputs){const U={};y.serialize(U),t.dataOutputs.push(U)}}deserialize(t){}_log(t,U,y){var I;null===(I=t.logger)||void 0===I||I.addLogItem({action:U,ly:y,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13872:(t,U,y)=>{"use strict";y.d(U,{c:()=>Y});var I,r=y(12341);!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(I||(I={}));class Y{constructor(t,U,y){this._ownerBlock=y,this._connectedPoint=[],this.uniqueId=(0,r.b)(),this.connectedPointIds=[],this.name=t,this._connectionType=U}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(t){if(this._connectionType===t._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||t._isSingularConnection()&&t._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(t),t._connectedPoint.push(this)}disconnectFrom(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this._connectedPoint.indexOf(t),I=t._connectedPoint.indexOf(this);-1!==y&&-1!==I&&(U&&this._connectedPoint.splice(y,1),t._connectedPoint.splice(I,1))}disconnectFromAll(){for(const t of this._connectedPoint)this.disconnectFrom(t,!1);this._connectedPoint.length=0}dispose(){for(const t of this._connectedPoint)this.disconnectFrom(t)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.uniqueId=this.uniqueId,t.name=this.name,t._connectionType=this._connectionType,t.connectedPointIds=[],t.className=this.getClassName();for(const U of this._connectedPoint)t.connectedPointIds.push(U.uniqueId)}getClassName(){return"FGConnection"}deserialize(t){this.uniqueId=t.uniqueId,this.name=t.name,this._connectionType=t._connectionType,this.connectedPointIds=t.connectedPointIds}}},13833:(t,U,y)=>{"use strict";y.d(U,{e:()=>g});var I,r=y(12204),Y=y(12366),mt=y(12375),X=y(12341),P=y(13839),G=y(13855),M=y(12221);!function(t){t.ExecuteBlock="ExecuteBlock",t.ExecuteEvent="ExecuteEvent",t.TriggerConnection="TriggerConnection",t.ContextVariableSet="ContextVariableSet",t.GlobalVariableSet="GlobalVariableSet",t.GlobalVariableDelete="GlobalVariableDelete",t.GlobalVariableGet="GlobalVariableGet",t.AddConnection="AddConnection",t.GetConnectionValue="GetConnectionValue",t.SetConnectionValue="SetConnectionValue",t.ActivateSignal="ActivateSignal",t.ContextVariableGet="ContextVariableGet"}(I||(I={}));class L{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(t){if(t.time||(t.time=Date.now()),this.log.push(t),this.logToConsole){var U;const y=null===(U=t.ly)||void 0===U?void 0:U.value;"object"===typeof y&&y.getClassName?M.b.Log(`[FGLog] ${t.className}:${t.uniqueId.split("-")[0]} ${t.action} - ${JSON.stringify(y.getClassName())}: ${y.toString()}`):M.b.Log(`[FGLog] ${t.className}:${t.uniqueId.split("-")[0]} ${t.action} - ${JSON.stringify(t.ly)}`)}}getItemsOfType(t){return this.log.filter((U=>U.action===t))}}class h{get enableLogging(){return this._enableLogging}set enableLogging(t){this._enableLogging!==t&&(this._enableLogging=t,this._enableLogging?(this.logger=new L,this.logger.logToConsole=!0):this.logger=null)}constructor(t){this.uniqueId=(0,X.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new r.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=t,this.assetsContext=t.assetsContext??t.gU}hasVariable(t){return t in this._userVariables}setVariable(t,U){var y;this._userVariables[t]=U,null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",ly:{name:t,value:U}})}getAsset(t,U){return(0,G.c)(this.assetsContext,t,U)}getVariable(t){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",ly:{name:t,value:this._userVariables[t]}}),this._userVariables[t]}get userVariables(){return this._userVariables}St(){return this._configuration.gU}_getUniqueIdPrefixedName(t,U){return`${t.uniqueId}_${U}`}_getGlobalContextVariable(t,U){var y;return null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",ly:{name:t,defaultValue:U,possibleValue:this._globalContextVariables[t]}}),this._hasGlobalContextVariable(t)?this._globalContextVariables[t]:U}_setGlobalContextVariable(t,U){var y;null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",ly:{name:t,value:U}}),this._globalContextVariables[t]=U}_deleteGlobalContextVariable(t){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",ly:{name:t}}),delete this._globalContextVariables[t]}_hasGlobalContextVariable(t){return t in this._globalContextVariables}_setExecutionVariable(t,U,y){this._executionVariables[this._getUniqueIdPrefixedName(t,U)]=y}_getExecutionVariable(t,U,y){return this._hasExecutionVariable(t,U)?this._executionVariables[this._getUniqueIdPrefixedName(t,U)]:y}_deleteExecutionVariable(t,U){delete this._executionVariables[this._getUniqueIdPrefixedName(t,U)]}_hasExecutionVariable(t,U){return this._getUniqueIdPrefixedName(t,U)in this._executionVariables}_hasConnectionValue(t){return t.uniqueId in this._connectionValues}_setConnectionValue(t,U){var y;this._connectionValues[t.uniqueId]=U,null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",ly:{connectionPointId:t.uniqueId,value:U}})}_setConnectionValueByKey(t,U){this._connectionValues[t]=U}_getConnectionValue(t){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",ly:{connectionPointId:t.uniqueId,value:this._connectionValues[t.uniqueId]}}),this._connectionValues[t.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(t){this._pendingBlocks.includes(t)||(this._pendingBlocks.push(t),this._pendingBlocks.sort(((t,U)=>t.priority-U.priority)))}_removePendingBlock(t){const U=this._pendingBlocks.indexOf(t);-1!==U&&this._pendingBlocks.splice(U,1)}_clearPendingBlocks(){for(const t of this._pendingBlocks)t._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(t){var U;this.onNodeExecutedObservable.notifyObservers(t),null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:t.getClassName(),uniqueId:t.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(t){this._setGlobalContextVariable("timeSinceStart",t.timeSinceStart),this._setGlobalContextVariable("deltaTime",t.deltaTime);for(const y of this._pendingBlocks){var U;null===(U=y._executeOnTick)||void 0===U||U.call(y,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;t.uniqueId=this.uniqueId,t._userVariables={};for(const I in this._userVariables)U(I,this._userVariables[I],t._userVariables);t._connectionValues={};for(const I in this._connectionValues)U(I,this._connectionValues[I],t._connectionValues);var y;this.assetsContext!==this.St()&&(t._assetsContext={meshes:this.assetsContext.meshes.map((t=>t.id)),materials:this.assetsContext.materials.map((t=>t.id)),textures:this.assetsContext.textures.map((t=>t.name)),animations:this.assetsContext.animations.map((t=>t.name)),lights:this.assetsContext.lights.map((t=>t.id)),cameras:this.assetsContext.cameras.map((t=>t.id)),YQ:null===(y=this.assetsContext.YQ)||void 0===y?void 0:y.map((t=>t.name)),skeletons:this.assetsContext.skeletons.map((t=>t.id)),mQ:this.assetsContext.mQ.map((t=>t.name)),geometries:this.assetsContext.geometries.map((t=>t.id)),multiMaterials:this.assetsContext.multiMaterials.map((t=>t.id)),transformNodes:this.assetsContext.transformNodes.map((t=>t.id))})}getClassName(){return"FlowGraphContext"}}(0,Y.b)([(0,mt.I)()],h.prototype,"uniqueId",void 0);var Q=y(13863),F=y(12698);class E{constructor(t){this.onEventTriggeredObservable=new r.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=t,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.FX.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const t=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",ly:{timeSinceStart:this._startingTime,deltaTime:t}}),this._startingTime+=t})),this._meshPickedObserver=this._scene.onPointerObservable.add((t=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",ly:t})}),F.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((t=>{const U=t.pointerId,y=t.mesh,I=this._pointerUnderMeshState[U];!I&&y?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",ly:{pointerId:U,mesh:y}}):I&&!y?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",ly:{pointerId:U,mesh:I}}):I&&y&&I!==y&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",ly:{pointerId:U,mesh:I,over:y}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",ly:{pointerId:U,mesh:y,out:I}})),this._pointerUnderMeshState[U]=y}),F.d.POINTERMOVE)}dispose(){var t,U,y,I,r;null===(t=this._sceneDisposeObserver)||void 0===t||t.remove(),null===(U=this._sceneReadyObserver)||void 0===U||U.remove(),null===(y=this._sceneOnBeforeRenderObserver)||void 0===y||y.remove(),null===(I=this._meshPickedObserver)||void 0===I||I.remove(),null===(r=this._meshUnderPointerObserver)||void 0===r||r.remove(),this.onEventTriggeredObservable.clear()}}var w,D=y(13879);!function(t){t[t.Stopped=0]="Stopped",t[t.Started=1]="Started"}(w||(w={}));class l{get state(){return this._state}set state(t){this._state=t,this.onStateChangedObservable.notifyObservers(t)}constructor(t){this.onStateChangedObservable=new r.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=t.gU,this._sceneEventCoordinator=new E(this._scene),this._coordinator=t.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((t=>{for(const U of this._executionContexts){const y=this._getContextualOrder(t.type,U);for(const I of y)if(!I._executeEvent(U,t.ly))break}switch(t.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const U of this._executionContexts)U._notifyOnTick(t.ly);break;case"SceneDispose":this.dispose()}}))}createContext(){const t=new h({gU:this._scene,coordinator:this._coordinator});return this._executionContexts.push(t),t}getContext(t){return this._executionContexts[t]}addEventBlock(t){if("PointerOver"!==t.type&&"PointerOut"!==t.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==t.type&&this._eventBlocks[t.type].push(t),1===this.state)for(const U of this._executionContexts)t._startPendingTasks(U);else this.onStateChangedObservable.addOnce((U=>{if(1===U)for(const y of this._executionContexts)t._startPendingTasks(y)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((t=>{1===t&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const t of this._executionContexts)for(const U in this._eventBlocks){const y=this._getContextualOrder(U,t);for(const U of y)U._startPendingTasks(t)}}_getContextualOrder(t,U){const y=this._eventBlocks[t].sort(((t,U)=>U.initPriority-t.initPriority));if("MeshPick"===t){const t=[];for(const I of y){const r=I.asset.getValue(U);let Y=0;for(;Y<y.length;Y++){const t=y[Y].asset.getValue(U);if(r&&t&&(0,D.p)(r,t))break}t.splice(Y,0,I)}return t}return y}dispose(){var t;if(0!==this.state){this.state=0;for(const t of this._executionContexts)t._clearPendingBlocks();this._executionContexts.length=0;for(const t in this._eventBlocks)this._eventBlocks[t].length=0;null===(t=this._eventObserver)||void 0===t||t.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(t){const U=[],y=new Set;for(const I in this._eventBlocks)for(const t of this._eventBlocks[I])U.push(t),y.add(t.uniqueId);for(;U.length>0;){const I=U.pop();t(I);for(const t of I.dataInputs)for(const I of t._connectedPoint)y.has(I._ownerBlock.uniqueId)||(U.push(I._ownerBlock),y.add(I._ownerBlock.uniqueId));if(I instanceof Q.d)for(const t of I.signalOutputs)for(const I of t._connectedPoint)y.has(I._ownerBlock.uniqueId)||(U.push(I._ownerBlock),y.add(I._ownerBlock.uniqueId))}}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1?arguments[1]:void 0;t.allBlocks=[],this.visitAllBlocks((U=>{const y={};U.serialize(y),t.allBlocks.push(y)})),t.executionContexts=[];for(const y of this._executionContexts){const I={};y.serialize(I,U),t.executionContexts.push(I)}}}class g{constructor(t){this.config=t,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.gU.FX.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.gU.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const t=this._executeOnNextFrame.slice(0);if(t.length)for(const U of t){this.notifyCustomEvent(U.id,U.data,!1);const t=this._executeOnNextFrame.findIndex((t=>t.uniqueId===U.uniqueId));-1!==t&&this._executeOnNextFrame.splice(t,1)}}));(g.SceneCoordinators.get(this.config.gU)??[]).push(this)}createGraph(){const t=new l({gU:this.config.gU,coordinator:this});return this._flowGraphs.push(t),t}removeGraph(t){const U=this._flowGraphs.indexOf(t);-1!==U&&(t.dispose(),this._flowGraphs.splice(U,1))}start(){for(const t of this._flowGraphs)t.start()}dispose(){var t,U;for(const r of this._flowGraphs)r.dispose();this._flowGraphs.length=0,null===(t=this._disposeObserver)||void 0===t||t.remove(),null===(U=this._onBeforeRenderObserver)||void 0===U||U.remove();const y=g.SceneCoordinators.get(this.config.gU)??[],I=y.indexOf(this);-1!==I&&y.splice(I,1)}serialize(t,U){t._flowGraphs=[];for(const y of this._flowGraphs){const I={};y.serialize(I,U),t._flowGraphs.push(I)}t.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(t){let U=this._customEventsMap.get(t);return U||(U=new r.b,this._customEventsMap.set(t,U)),U}notifyCustomEvent(t,U){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:t,data:U,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(t)){const U=this._eventExecutionCounter.get(t);if(this._eventExecutionCounter.set(t,U+1),U>=g.MaxEventTypeExecutionPerFrame)return void(U===g.MaxEventTypeExecutionPerFrame&&M.b.Warn(`FlowGraphCoordinator: Too many executions of event "${t}".`))}else this._eventExecutionCounter.set(t,1);const y=this._customEventsMap.get(t);y&&y.notifyObservers(U)}}g.MaxEventsPerType=30,g.MaxEventTypeExecutionPerFrame=30,g.SceneCoordinators=new Map},13888:(t,U,y)=>{"use strict";y.d(U,{c:()=>r});var I=y(13893);class r extends I.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(t){t._notifyExecuteNode(this),this.done._activateSignal(t)}}},13863:(t,U,y)=>{"use strict";y.d(U,{d:()=>X});var I=y(13865),r=y(13872),Y=y(12338);class mt extends r.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(t){super.connectTo(t),this._connectedPoint.sort(((t,U)=>U.priority-t.priority))}_activateSignal(t){var U;if(null===(U=t.logger)||void 0===U||U.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,ly:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(t,this),t._increaseExecutionId();else for(const y of this._connectedPoint)y._activateSignal(t)}}(0,Y.f)("FlowGraphSignalConnection",mt);class X extends I.c{constructor(t){super(t),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(t){const U=new mt(t,0,this);return this.signalInputs.push(U),U}_registerSignalOutput(t){const U=new mt(t,1,this);return this.signalOutputs.push(U),U}_unregisterSignalInput(t){const U=this.signalInputs.findIndex((U=>U.name===t));-1!==U&&(this.signalInputs[U].dispose(),this.signalInputs.splice(U,1))}_unregisterSignalOutput(t){const U=this.signalOutputs.findIndex((U=>U.name===t));-1!==U&&(this.signalOutputs[U].dispose(),this.signalOutputs.splice(U,1))}_reportError(t,U){this.error.ly="string"===typeof U?new Error(U):U,this.error._activateSignal(t)}getSignalInput(t){return this.signalInputs.find((U=>U.name===t))}getSignalOutput(t){return this.signalOutputs.find((U=>U.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.signalInputs=[],t.signalOutputs=[];for(const U of this.signalInputs){const y={};U.serialize(y),t.signalInputs.push(y)}for(const U of this.signalOutputs){const y={};U.serialize(y),t.signalOutputs.push(y)}}deserialize(t){for(let U=0;U<t.signalInputs.length;U++){const y=this.getSignalInput(t.signalInputs[U].name);if(!y)throw new Error("Could not find signal input with name "+t.signalInputs[U].name+" in block "+t.className);y.deserialize(t.signalInputs[U])}for(let U=0;U<t.signalOutputs.length;U++){const y=this.getSignalOutput(t.signalOutputs[U].name);if(!y)throw new Error("Could not find signal output with name "+t.signalOutputs[U].name+" in block "+t.className);y.deserialize(t.signalOutputs[U])}}getClassName(){return"FlowGraphExecutionBlock"}}},13899:(t,U,y)=>{"use strict";y.d(U,{e:()=>r});var I=y(13863);class r extends I.d{constructor(t){super(t),this.out=this._registerSignalOutput("out")}}},13845:(t,U,y)=>{"use strict";y.d(U,{B:()=>M,D:()=>Q,H:()=>F,J:()=>E,M:()=>S,Q:()=>N,S:()=>f,W:()=>c,e:()=>G,i:()=>h,j:()=>p,m:()=>w,q:()=>D,u:()=>l,w:()=>L,y:()=>b});var I,r=y(12386),Y=y(12442),mt=y(13842),X=y(13852);!function(t){t.Any="any",t.String="string",t.Number="number",t.Boolean="boolean",t.Object="object",t.Integer="FlowGraphInteger",t.Vector2="Vector2",t.DU="DU",t.Vector4="Vector4",t.Quaternion="Quaternion",t.Matrix="Matrix",t.Matrix2D="Matrix2D",t.Matrix3D="Matrix3D",t.bU="bU",t.HX="HX"}(I||(I={}));class P{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=t,this.defaultValue=U,this.animationType=y}serialize(t){t.typeName=this.typeName,t.defaultValue=this.defaultValue}}const G=new P("any",void 0),M=new P("string",""),L=new P("number",0,0),h=new P("boolean",!1),Q=new P("Vector2",r.Vector2.Zero(),5),F=new P("DU",r.DU.Zero(),1),E=new P("Vector4",r.Vector4.Zero()),w=new P("Matrix",r.Matrix.Identity(),3),D=new P("Matrix2D",new X.e),l=new P("Matrix3D",new X.g),g=new P("bU",Y.bU.Black(),4),B=new P("HX",new Y.HX(0,0,0,0),7),b=new P("Quaternion",r.Quaternion.Identity(),2);b.typeTransformer=t=>{if(t.getClassName){if("Vector4"===t.getClassName())return r.Quaternion.pU(t.bX());if("DU"===t.getClassName())return r.Quaternion.FromEulerVector(t);if("Matrix"===t.getClassName())return r.Quaternion.FromRotationMatrix(t)}return t};const p=new P("FlowGraphInteger",new mt.c(0),0);function c(t){const U=t;switch(typeof t){case"string":return M;case"number":return L;case"boolean":return h;case"object":if(U.getClassName)switch(U.getClassName()){case"Vector2":return Q;case"DU":return F;case"Vector4":return E;case"Matrix":return w;case"bU":return g;case"HX":return B;case"Quaternion":return b;case"FlowGraphInteger":return p;case"Matrix2D":return D;case"Matrix3D":return l}return G;default:return G}}function f(t){switch(t){case"string":return M;case"number":return L;case"boolean":return h;case"Vector2":return Q;case"DU":return F;case"Vector4":return E;case"Matrix":return w;case"bU":return g;case"HX":return B;case"Quaternion":return b;case"FlowGraphInteger":return p;case"Matrix2D":return D;case"Matrix3D":return l;default:return G}}function S(t){switch(t){case"number":default:return 0;case"Vector2":return 5;case"DU":return 1;case"Matrix":return 3;case"bU":return 4;case"HX":return 7;case"Quaternion":return 2}}function N(t){switch(t){case 0:return L;case 5:return Q;case 1:return F;case 3:return w;case 4:return g;case 7:return B;case 2:return b;default:return G}}},13839:(t,U,y)=>{"use strict";y.d(U,{d:()=>M,e:()=>G,i:()=>L});var I=y(12442),r=y(12386),Y=y(13842),mt=y(13845),X=y(13852);function P(t){return"Vector2"===t||"DU"===t||"Vector4"===t||"Quaternion"===t||"bU"===t||"HX"===t}function G(t,U,y){var I;const r=(null===U||void 0===U||null===(I=U.getClassName)||void 0===I?void 0:I.call(U))??"";if(P(r)||function(t){return"Matrix"===t||"Matrix2D"===t||"Matrix3D"===t}(r))y[t]={value:U.bX(),className:r};else if("FlowGraphInteger"===r)y[t]={value:U.value,className:r};else if(r&&(U.id||U.name))y[t]={id:U.id,name:U.name,className:r};else{if("object"===typeof U)throw new Error(`Could not serialize value ${U}`);y[t]=U}}function M(t,U,y,G){const L=U[t];let h;const Q=(null===L||void 0===L?void 0:L.type)??(null===L||void 0===L?void 0:L.className);if(function(t){return"Mesh"===t||"AbstractMesh"===t||"GroundMesh"===t||"InstanceMesh"===t||"LinesMesh"===t||"GoldbergMesh"===t||"GreasedLineMesh"===t||"TrailMesh"===t}(Q)){let t=G.meshes.filter((t=>L.id?t.id===L.id:t.name===L.name));0===t.length&&(t=G.transformNodes.filter((t=>L.id?t.id===L.id:t.name===L.name))),h=L.uniqueId?t.find((t=>t.uniqueId===L.uniqueId)):t[0]}else if(P(Q))h=function(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===t)return r.Vector2.pU(U);if("DU"===t)return y&&(U[2]*=-1),r.DU.pU(U);if("Vector4"===t)return r.Vector4.pU(U);if("Quaternion"===t)return y&&(U[2]*=-1,U[3]*=-1),r.Quaternion.pU(U);if("bU"===t)return new I.bU(U[0],U[1],U[2]);if("HX"===t)return new I.HX(U[0],U[1],U[2],U[3]);throw new Error(`Unknown vector class name ${t}`)}(Q,L.value);else if(function(t){return"AnimationGroup"===t}(Q)){const t=G.animationGroups.filter((t=>t.name===L.name));h=1===t.length?t[0]:t.find((t=>t.uniqueId===L.uniqueId))}else h="Matrix"===Q?r.Matrix.pU(L.value):"Matrix2D"===Q?new X.e(L.value):"Matrix3D"===Q?new X.g(L.value):"FlowGraphInteger"===Q?Y.c.FromValue(L.value):"number"===Q||"string"===Q||"boolean"===Q?L.value[0]:L&&void 0!==L.value?L.value:Array.isArray(L)?L.reduce(((t,U)=>U.eventData?(t[U.id]={type:(0,mt.S)(U.type)},"undefined"!==typeof U.value&&(t[U.id].value=M("value",U,y,G)),t):t),{}):L;return h}function L(t){return"FlowGraphJsonPointerParserBlock"===t}},13879:(t,U,y)=>{"use strict";function I(t,U){return!(!t.parent||t.parent!==U&&!I(t.parent,U))}function r(t){if(t.getClassName)return t.getClassName()}function Y(t,U){return t===U&&("Vector2"===t||"DU"===t||"Vector4"===t||"Quaternion"===t)}function mt(t,U){return t===U&&("Matrix"===t||"Matrix2D"===t||"Matrix3D"===t)}function X(t,U){return"FlowGraphInteger"===t&&"FlowGraphInteger"===U}function P(t,U){const y="number"===typeof t||"number"===typeof(null===t||void 0===t?void 0:t.value);return y&&!U?!isNaN(G(t)):y}function G(t){return"number"===typeof t?t:t.value}y.d(U,{d:()=>X,h:()=>mt,k:()=>Y,n:()=>r,p:()=>I,q:()=>G,t:()=>P})},13274:(t,U,y)=>{"use strict";y.r(U),y.d(U,{SceneInstrumentation:()=>Y});var I=y(12198),r=y(12629);class Y{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(t){t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.gU.onBeforeActiveMeshesEvaluationObservable.add((()=>{I.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.gU.onAfterActiveMeshesEvaluationObservable.add((()=>{I.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.gU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.gU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(t){t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.gU.onBeforeRenderTargetsRenderObservable.add((()=>{I.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.gU.onAfterRenderTargetsRenderObservable.add((()=>{I.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.gU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.gU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(t){t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.gU.onBeforeParticlesRenderingObservable.add((()=>{I.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.gU.onAfterParticlesRenderingObservable.add((()=>{I.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.gU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.gU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(t){t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.gU.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.gU.onBeforeSpritesRenderingObservable.add((()=>{I.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.gU.onAfterSpritesRenderingObservable.add((()=>{I.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.gU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.gU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(t){t!==this._capturePhysicsTime&&this.gU.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.gU.onBeforePhysicsObservable.add((()=>{I.Tools.StartPerformanceCounter("hh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.gU.onAfterPhysicsObservable.add((()=>{I.Tools.EndPerformanceCounter("hh"),this._physicsTime.endMonitoring()}))):(this.gU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.gU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(t){t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.gU.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.gU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(t){this._captureFrameTime=t}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(t){this._captureInterFrameTime=t}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(t){t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.gU.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),I.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.gU.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),I.Tools.EndPerformanceCounter("Main render")}))):(this.gU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.gU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(t){t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.gU.onBeforeCameraRenderObservable.add((t=>{this._cameraRenderTime.beginMonitoring(),I.Tools.StartPerformanceCounter(`Rendering camera ${t.name}`)})),this._onAfterCameraRenderObserver=this.gU.onAfterCameraRenderObservable.add((t=>{this._cameraRenderTime.endMonitoring(!1),I.Tools.EndPerformanceCounter(`Rendering camera ${t.name}`)}))):(this.gU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.gU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.gU.getEngine()._drawCalls}constructor(t){this.gU=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new r.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new r.e,this._captureFrameTime=!1,this._frameTime=new r.e,this._captureRenderTime=!1,this._renderTime=new r.e,this._captureInterFrameTime=!1,this._interFrameTime=new r.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new r.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new r.e,this._capturePhysicsTime=!1,this._physicsTime=new r.e,this._captureAnimationsTime=!1,this._animationsTime=new r.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new r.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(I.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.gU.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=t.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(I.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.QX(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.QX(),this._captureParticlesRenderTime&&this._particlesRenderTime.QX(),this._captureSpritesRenderTime&&this._spritesRenderTime.QX(),this._captureRenderTime&&this._renderTime.QX(),this._captureCameraRenderTime&&this._cameraRenderTime.QX()}))}dispose(){this._disposed||(this.gU.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.gU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.gU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.gU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.gU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.gU.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.gU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.gU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.gU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.gU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.gU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.gU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.gU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.gU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.gU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.gU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.gU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.gU=null,this._disposed=!0)}}},13828:(t,U,y)=>{"use strict";y.d(U,{d:()=>M});var I=y(12366),r=y(12375),Y=y(12386),mt=y(12835),X=y(12978),P=y(13026),G=y(12338);mt.c.AddNodeConstructor("Light_Type_1",((t,U)=>()=>new M(t,Y.DU.Zero(),U)));class M extends P.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(t){this._shadowFrustumSize=t,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(t){this._shadowOrthoScale=t,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(t){this._orthoLeft=t}get orthoRight(){return this._orthoRight}set orthoRight(t){this._orthoRight=t}get orthoTop(){return this._orthoTop}set orthoTop(t){this._orthoTop=t}get orthoBottom(){return this._orthoBottom}set orthoBottom(t){this._orthoBottom=t}constructor(t,U,y){super(t,y),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=U.scale(-1),this.direction=U}getClassName(){return"wh"}getTypeID(){return X.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(t,U,y){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(t):this._setDefaultAutoExtendShadowProjectionMatrix(t,U,y)}_setDefaultFixedFrustumShadowProjectionMatrix(t){const U=this.St().activeCamera;U&&Y.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:U.cX,void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,t,this.St().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(t,U,y){const I=this.St().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const t=Y.DU.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let I=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let mt=0;mt<y.length;mt++){const X=y[mt];if(!X)continue;const P=X.getBoundingInfo().boundingBox;for(let y=0;y<P.vectorsWorld.length;y++)Y.DU.TransformCoordinatesToRef(P.vectorsWorld[y],U,t),t.x<this._orthoLeft&&(this._orthoLeft=t.x),t.y<this._orthoBottom&&(this._orthoBottom=t.y),t.x>this._orthoRight&&(this._orthoRight=t.x),t.y>this._orthoTop&&(this._orthoTop=t.y),this.autoCalcShadowZBounds&&(t.z<I&&(I=t.z),t.z>r&&(r=t.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=I,this._shadowMaxZ=r)}const r=this._orthoRight-this._orthoLeft,mt=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:(null===I||void 0===I?void 0:I.cX)||0,P=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===I||void 0===I?void 0:I.maxZ)||1e4,G=this.St().getEngine().LX;Y.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-r*this.shadowOrthoScale,this._orthoRight+r*this.shadowOrthoScale,this._orthoBottom-mt*this.shadowOrthoScale,this._orthoTop+mt*this.shadowOrthoScale,G?P:X,G?X:P,t,this.St().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,U){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,U),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,U),this)}transferToNodeMaterialEffect(t,U){return this.computeTransformedInformation()?(t.setFloat3(U,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(t.setFloat3(U,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(t){const U=this._scene.getEngine();return!U.LX&&U.isNDCHalfZRange?0:1}getDepthMaxZ(t){const U=this._scene.getEngine();return U.LX&&U.isNDCHalfZRange?0:1}prepareLightSpecificDefines(t,U){t["DIRLIGHT"+U]=!0}}(0,I.b)([(0,r.I)()],M.prototype,"shadowFrustumSize",null),(0,I.b)([(0,r.I)()],M.prototype,"shadowOrthoScale",null),(0,I.b)([(0,r.I)()],M.prototype,"autoUpdateExtends",void 0),(0,I.b)([(0,r.I)()],M.prototype,"autoCalcShadowZBounds",void 0),(0,I.b)([(0,r.I)("orthoLeft")],M.prototype,"_orthoLeft",void 0),(0,I.b)([(0,r.I)("orthoRight")],M.prototype,"_orthoRight",void 0),(0,I.b)([(0,r.I)("orthoTop")],M.prototype,"_orthoTop",void 0),(0,I.b)([(0,r.I)("orthoBottom")],M.prototype,"_orthoBottom",void 0),(0,G.f)("BABYLON.DirectionalLight",M)},14314:(t,U,y)=>{"use strict";y.d(U,{d:()=>M});var I=y(12366),r=y(12375),Y=y(12386),mt=y(12442),X=y(12835),P=y(12978),G=y(12338);X.c.AddNodeConstructor("Light_Type_3",((t,U)=>()=>new M(t,Y.DU.Zero(),U)));class M extends P.c{constructor(t,U,y){super(t,y),this.groundColor=new mt.bU(0,0,0),this.direction=U||Y.DU.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Dh"}setDirectionToTarget(t){return this.direction=Y.DU.Normalize(t.lU(Y.DU.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,U){const y=Y.DU.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",y.x,y.y,y.z,0,U),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.VX),U),this}transferToNodeMaterialEffect(t,U){const y=Y.DU.Normalize(this.direction);return t.setFloat3(U,y.x,y.y,y.z),this}SX(){return this._worldMatrix||(this._worldMatrix=Y.Matrix.Identity()),this._worldMatrix}getTypeID(){return P.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,U){t["HEMILIGHT"+U]=!0}}(0,I.b)([(0,r.k)()],M.prototype,"groundColor",void 0),(0,I.b)([(0,r.E)()],M.prototype,"direction",void 0),(0,G.f)("BABYLON.HemisphericLight",M)},13791:(t,U,y)=>{"use strict";y.d(U,{c:()=>L});var I=y(12366),r=y(12375),Y=y(12386),mt=y(12835),X=y(12978),P=y(13026),G=y(12361),M=y(12338);mt.c.AddNodeConstructor("Light_Type_2",((t,U)=>()=>new L(t,Y.DU.Zero(),Y.DU.Zero(),0,0,U)));class L extends P.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(t){this._iesProfileTexture!==t&&(this._iesProfileTexture=t,this._iesProfileTexture&&L._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(t){this._angle=t,this._cosHalfAngle=Math.cos(.5*t),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(t){this._innerAngle=t,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(t){this._shadowAngleScale=t,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(t){this._projectionTextureLightNear=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(t){this._projectionTextureLightFar=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(t){this._projectionTextureUpDirection=t,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(t){this._projectionTexture!==t&&(this._projectionTexture=t,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(L._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):L._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(t){return void 0!==t.onGeneratedObservable}static _IsTexture(t){return void 0!==t.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(t){this._projectionTextureProjectionLightMatrix=t,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(t,U,y,I,r,mt){super(t,mt),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Y.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Y.DU.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Y.DU.Zero(),this._projectionTextureViewLightMatrix=Y.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=Y.Matrix.Zero(),this._projectionTextureScalingMatrix=Y.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=U,this.direction=y,this.angle=I,this.exponent=r}getClassName(){return"SpotLight"}getTypeID(){return X.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(t){super._setDirection(t),this._projectionTextureViewLightDirty=!0}_setPosition(t){super._setPosition(t),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(t,U,y){const I=this.St().activeCamera;if(!I)return;this._shadowAngleScale=this._shadowAngleScale||1;const r=this._shadowAngleScale*this._angle,mt=void 0!==this.shadowMinZ?this.shadowMinZ:I.cX,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:I.maxZ,P=this.St().getEngine().LX;Y.Matrix.PerspectiveFovLHToRef(r,1,P?X:mt,P?mt:X,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,P)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Y.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const t=this.projectionTextureLightFar,U=this.projectionTextureLightNear,y=t/(t-U),I=-y*U,r=1/Math.tan(this._angle/2);Y.Matrix.FromValuesToRef(r/1,0,0,0,0,r,0,0,0,0,y,1,0,0,I,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof G.d){const t=this._projectionTexture.uScale/2,U=this._projectionTexture.vScale/2;Y.Matrix.FromValuesToRef(t,0,0,0,0,U,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(t,U){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),t.setMatrix("textureProjectionMatrix"+U,this._projectionTextureMatrix),t.setTexture("projectionLightTexture"+U,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&t.setTexture("iesLightTexture"+U,this._iesProfileTexture),this}transferToEffect(t,U){let y;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,U),y=Y.DU.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,U),y=Y.DU.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",y.x,y.y,y.z,this._cosHalfAngle,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,U),this}transferToNodeMaterialEffect(t,U){let y;return y=this.computeTransformedInformation()?Y.DU.Normalize(this.transformedDirection):Y.DU.Normalize(this.direction),this.St().useRightHandedSystem?t.setFloat3(U,-y.x,-y.y,-y.z):t.setFloat3(U,y.x,y.y,y.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(t){const U=this._scene.getEngine(),y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===t||void 0===t?void 0:t.cX)??0;return U.LX&&U.isNDCHalfZRange?y:this._scene.getEngine().isNDCHalfZRange?0:y}getDepthMaxZ(t){const U=this._scene.getEngine(),y=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===t||void 0===t?void 0:t.maxZ)??1e4;return U.LX&&U.isNDCHalfZRange?0:y}prepareLightSpecificDefines(t,U){t["SPOTLIGHT"+U]=!0,t["PROJECTEDLIGHTTEXTURE"+U]=!(!this.projectionTexture||!this.projectionTexture.isReady()),t["IESLIGHTTEXTURE"+U]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,I.b)([(0,r.I)()],L.prototype,"angle",null),(0,I.b)([(0,r.I)()],L.prototype,"innerAngle",null),(0,I.b)([(0,r.I)()],L.prototype,"shadowAngleScale",null),(0,I.b)([(0,r.I)()],L.prototype,"exponent",void 0),(0,I.b)([(0,r.I)()],L.prototype,"projectionTextureLightNear",null),(0,I.b)([(0,r.I)()],L.prototype,"projectionTextureLightFar",null),(0,I.b)([(0,r.I)()],L.prototype,"projectionTextureUpDirection",null),(0,I.b)([(0,r.B)("projectedLightTexture")],L.prototype,"_projectionTexture",void 0),(0,M.f)("BABYLON.SpotLight",L)},13534:(t,U,y)=>{"use strict";y.d(U,{c:()=>mt,g:()=>Y,j:()=>X});const I={},r={};function Y(t,U){I[t]=U}function mt(t,U){r[t]=U}function X(t){return r[t]?r[t]:null}},13435:(t,U,y)=>{"use strict";y.d(U,{c:()=>c,e:()=>o});var I,r=y(12198),Y=y(12204),mt=y(12653),X=y(12250),P=y(12221),G=y(12881),M=y(12253),L=y(12257),h=y(12341),Q=y(12285),F=y(12248);!function(t){t[t.Clean=0]="Clean",t[t.Stop=1]="Stop",t[t.Sync=2]="Sync",t[t.NoSync=3]="NoSync"}(I||(I={}));const E=new Y.b,w={};let D=!1;function l(){return w[".babylon"]}function g(t,U){const y=w[t];return y||(P.b.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U?l():void 0)}function B(t,U,y){let I="Unable to load from "+(t.rawData?"binary data":t.url);return U?I+=`: ${U}`:y&&(I+=`: ${y}`),I}async function b(t,U,y,I,r,Y,mt,X,P){var G;const L="data:"===(h=t.url).substring(0,5)?h.substring(5):null;var h;if(t.rawData&&!mt)throw"When using ArrayBufferView to load data the file extension must be provided.";const D=L||mt?"":function(t){const U=t.indexOf("?");-1!==U&&(t=t.substring(0,U));const y=t.lastIndexOf(".");return t.substring(y,t.length).toLowerCase()}(t.url);let B=mt?g(mt,!0):L?function(t){for(const U in w){const y=w[U].plugin;if(y.canDirectLoad&&y.canDirectLoad(t))return w[U]}return l()}(t.url):g(D,!1);if(!B&&D){if(t.url&&!t.url.startsWith("blob:")){const U=await async function(t,U){const y=U.method||"GET";return await new Promise(((I,r)=>{const Y=new F.d;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const t={};if(U.responseHeaders)for(const y of U.responseHeaders)t[y]=Y.getResponseHeader(y)||"";I({response:Y.response,headerValues:t})}else r(`Unable to fetch data from ${t}. Error code: ${Y.status}`)})),Y.open(y,t),Y.send()}))}(t.url,{method:"HEAD",responseHeaders:["Content-Type"]}),y=U.headerValues?U.headerValues["Content-Type"]:"";y&&(B=function(t){for(const U in w){const y=w[U];if(y.mimeType===t)return y}}(y))}B||(B=l())}if(!B)throw new Error(`No plugin or fallback for ${mt??t.url}`);if(!1===(null===P||void 0===P||null===(G=P[B.plugin.name])||void 0===G?void 0:G.enabled))throw new Error(`The '${B.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(t.rawData&&!B.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(t=>{if(B.plugin.createPlugin){const U=B.plugin.createPlugin(P??{});return U instanceof Promise?(U.then(t).catch((t=>{r("Error instantiating plugin.",t)})),null):(t(U),U)}return t(B.plugin),B.plugin})((P=>{var G;if(!P)throw`The loader plugin corresponding to the '${mt}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(E.notifyObservers(P),L&&(P.canDirectLoad&&P.canDirectLoad(t.url)||!(0,M.l)(t.url))){if(P.directLoad){const t=P.directLoad(U,L);t instanceof Promise?t.then((t=>{y(P,t)})).catch((t=>{r("Error in directLoad of _loadData: "+t,t)})):y(P,t)}else y(P,L);return}const h=B.isBinary,F=(t,I)=>{U.G?r("Scene has been disposed"):y(P,t,I)};let w=null,D=!1;null===(G=P.FX)||void 0===G||G.add((()=>{D=!0,w&&(w.abort(),w=null),Y()}));const l=()=>{if(D)return;const y=(t,U)=>{r(null===t||void 0===t?void 0:t.statusText,U)};if(!P.loadFile&&t.rawData)throw"Plugin does not support loading ArrayBufferView.";w=P.loadFile?P.loadFile(U,t.rawData||t.file||t.url,t.rootUrl,F,I,h,y,X):U._loadFile(t.file||t.url,F,I,!0,h,y)},g=U.getEngine();let b=g.enableOfflineSupport;if(b){let y=!1;for(const I of U.disableOfflineSupportExceptionRules)if(I.test(t.url)){y=!0;break}b=!y}b&&Q.e.OfflineProviderFactory?U.offlineProvider=Q.e.OfflineProviderFactory(t.url,l,g.disableManifestCheck):l()}))}function p(t,U){let y,I,Y=null,mt=null;if(U)if(U.name)y=`file:${U.name}`,I=U.name,Y=U;else if(ArrayBuffer.isView(U))y="",I=(0,h.b)(),mt=U;else if(U.startsWith("data:"))y=U,I="";else if(t){const Y=U;if("/"===Y.substring(0,1))return r.Tools.Error("Wrong sceneFilename parameter"),null;y=t+Y,I=Y}else y=U,I=r.Tools.GetFilename(U),t=r.Tools.GetFolderPath(U);else y=t,I=r.Tools.GetFilename(t),t=r.Tools.GetFolderPath(t);return{url:y,rootUrl:t,name:I,file:Y,rawData:mt}}function c(t){if("string"===typeof t.extensions){const U=t.extensions;w[U.toLowerCase()]={plugin:t,isBinary:!1}}else{const U=t.extensions,y=Object.keys(U);for(const I of y)w[I.toLowerCase()]={plugin:t,isBinary:U[I].isBinary,mimeType:U[I].mimeType}}}async function f(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.d.LastCreatedScene,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!I)return P.b.Error("No scene available to import mesh to"),null;const Q=p(U,y);if(!Q)return null;const F={};I.addPendingData(F);const E=()=>{I.removePendingData(F)},w=(t,U)=>{const y=B(Q,t,U);mt?mt(I,y,new L.k(y,L.h.SceneLoaderError,U)):P.b.Error(y),E()},D=Y?t=>{try{Y(t)}catch(U){w("Error in onProgress callback: "+U,U)}}:void 0,l=(t,U,y,Y,mt,X,P,G)=>{if(I.importedMeshesFiles.push(Q.url),r)try{r(t,U,y,Y,mt,X,P,G)}catch(M){w("Error in onSuccess callback: "+M,M)}I.removePendingData(F)};return await b(Q,I,((U,y,r)=>{if(U.rewriteRootURL&&(Q.rootUrl=U.rewriteRootURL(Q.rootUrl,r)),U.importMesh){const r=[],Y=[],mt=[];if(!U.importMesh(t,I,y,Q.rootUrl,r,Y,mt,w))return;I.loadingPluginName=U.name,l(r,Y,mt,[],[],[],[],[])}else{U.importMeshAsync(t,I,y,Q.rootUrl,D,Q.name).then((t=>{I.loadingPluginName=U.name,l(t.meshes,t.mQ,t.skeletons,t.animationGroups,t.transformNodes,t.geometries,t.lights,t.spriteManagers)})).catch((t=>{w(t.message,t)}))}}),D,w,E,G,M,h)}async function S(t,U,y,I,r,Y,mt,X){return await new Promise(((P,G)=>{try{f(t,U,y,I,((t,U,y,I,r,Y,mt,X)=>{P({meshes:t,mQ:U,skeletons:y,animationGroups:I,transformNodes:r,geometries:Y,lights:mt,spriteManagers:X})}),r,((t,U,y)=>{G(y||new Error(U))}),Y,mt,X).catch(G)}catch(L){G(L)}}))}async function N(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedEngine,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};y?await J(t,U,new mt.e(y),I,Y,P,G,M,L):r.Tools.Error("No engine available")}async function j(t,U,y,I,r,Y,mt){return await new Promise(((X,P)=>{N(t,U,y,(t=>{X(t)}),I,((t,U,y)=>{P(y||new Error(U))}),r,Y,mt)}))}async function J(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!y)return P.b.Error("No scene available to append to"),null;const Q=p(t,U);if(!Q)return null;const F={};y.addPendingData(F);const E=()=>{y.removePendingData(F)};G.b.ShowLoadingScreen&&!D&&(D=!0,y.getEngine().displayLoadingUI(),y.executeWhenReady((()=>{y.getEngine().hideLoadingUI(),D=!1})));const w=(t,U)=>{const I=B(Q,t,U);Y?Y(y,I,new L.k(I,L.h.SceneLoaderError,U)):P.b.Error(I),E()},l=r?t=>{try{r(t)}catch(U){w("Error in onProgress callback",U)}}:void 0,g=()=>{if(I)try{I(y)}catch(t){w("Error in onSuccess callback",t)}y.removePendingData(F)};return await b(Q,y,((t,U)=>{if(t.load){if(!t.load(y,U,Q.rootUrl,w))return;y.loadingPluginName=t.name,g()}else{t.loadAsync(y,U,Q.rootUrl,l,Q.name).then((()=>{y.loadingPluginName=t.name,g()})).catch((t=>{w(t.message,t)}))}}),l,w,E,mt,M,h)}async function a(t,U,y,I,r,Y,mt){return await new Promise(((X,P)=>{try{J(t,U,y,(t=>{X(t)}),I,((t,U,y)=>{P(y||new Error(U))}),r,Y,mt).catch(P)}catch(L){P(L)}}))}async function d(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!y)return P.b.Error("No scene available to load asset container to"),null;const h=p(t,U);if(!h)return null;const Q={};y.addPendingData(Q);const F=()=>{y.removePendingData(Q)},E=(t,U)=>{const I=B(h,t,U);Y?Y(y,I,new L.k(I,L.h.SceneLoaderError,U)):P.b.Error(I),F()},w=r?t=>{try{r(t)}catch(U){E("Error in onProgress callback",U)}}:void 0,D=t=>{if(I)try{I(t)}catch(U){E("Error in onSuccess callback",U)}y.removePendingData(Q)};return await b(h,y,((t,U)=>{if(t.loadAssetContainer){const I=t.loadAssetContainer(y,U,h.rootUrl,E);if(!I)return;I.populateRootNodes(),y.loadingPluginName=t.name,D(I)}else if(t.loadAssetContainerAsync){t.loadAssetContainerAsync(y,U,h.rootUrl,w,h.name).then((U=>{U.populateRootNodes(),y.loadingPluginName=t.name,D(U)})).catch((t=>{E(t.message,t)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),w,E,F,mt,G,M)}async function q(t,U,y,I,r,Y,mt){return await new Promise(((X,P)=>{try{d(t,U,y,(t=>{X(t)}),I,((t,U,y)=>{P(y||new Error(U))}),r,Y,mt).catch(P)}catch(L){P(L)}}))}async function H(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!y)return void P.b.Error("No scene available to load animations to");if(I){for(const I of y.animatables)I.reset();y.stopAllAnimations();const t=y.animationGroups.slice();for(const y of t)y.dispose();const U=y.getNodes();for(const y of U)y.animations&&(y.animations=[])}else switch(r){case 0:const t=y.animationGroups.slice();for(const U of t)U.dispose();break;case 1:for(const U of y.animationGroups)U.stop();break;case 2:for(const U of y.animationGroups)U.reset(),U.restart();break;case 3:break;default:return void P.b.Error("Unknown animation group loading mode value '"+r+"'")}const F=y.animatables.length;await d(t,U,y,(t=>{t.mergeAnimationsTo(y,y.animatables.slice(F),Y),t.dispose(),y.onAnimationFileImportedObservable.notifyObservers(y),mt&&mt(y)}),G,M,L,h,Q)}async function e(t,U,y,I,r,Y,mt,X,P,G){return await new Promise(((M,h)=>{try{H(t,U,y,I,r,Y,(t=>{M(t)}),mt,((t,U,y)=>{h(y||new Error(U))}),X,P,G).catch(h)}catch(L){h(L)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return G.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(t){G.b.ForceFullSceneLoadingForIncremental=t}static get ShowLoadingScreen(){return G.b.ShowLoadingScreen}static set ShowLoadingScreen(t){G.b.ShowLoadingScreen=t}static get loggingLevel(){return G.b.loggingLevel}static set loggingLevel(t){G.b.loggingLevel=t}static get CleanBoneMatrixWeights(){return G.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(t){G.b.CleanBoneMatrixWeights=t}static GetDefaultPlugin(){return l()}static GetPluginForExtension(t){var U;return null===(U=g(t,!0))||void 0===U?void 0:U.plugin}static IsPluginForExtensionAvailable(t){return function(t){return!!w[t]}(t)}static RegisterPlugin(t){c(t)}static ImportMesh(t,U,y,I,r,Y,mt,P,G){f(t,U,y,I,r,Y,mt,P,G).catch((t=>null===mt||void 0===mt?void 0:mt(X.d.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async ImportMeshAsync(t,U,y,I,r,Y,mt){return await S(t,U,y,I,r,Y,mt)}static Load(t,U,y,I,r,Y,mt,P){N(t,U,y,I,r,Y,mt,P).catch((t=>null===Y||void 0===Y?void 0:Y(X.d.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async LoadAsync(t,U,y,I,r,Y){return await j(t,U,y,I,r,Y)}static Append(t,U,y,I,r,Y,mt,P){J(t,U,y,I,r,Y,mt,P).catch((t=>null===Y||void 0===Y?void 0:Y(y??X.d.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async AppendAsync(t,U,y,I,r,Y){return await a(t,U,y,I,r,Y)}static LoadAssetContainer(t,U,y,I,r,Y,mt,P){d(t,U,y,I,r,Y,mt,P).catch((t=>null===Y||void 0===Y?void 0:Y(y??X.d.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async LoadAssetContainerAsync(t,U,y,I,r,Y){return await q(t,U,y,I,r,Y)}static ImportAnimations(t,U,y,I,r,Y,mt,P,G,M,L){H(t,U,y,I,r,Y,mt,P,G,M,L).catch((t=>null===G||void 0===G?void 0:G(y??X.d.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async ImportAnimationsAsync(t,U,y,I,r,Y,mt,X,P,G,M){return await e(t,U,y,I,r,Y,X,G,M)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=E},13807:(t,U,y)=>{"use strict";y.d(U,{c:()=>h});var I=y(12366),r=y(12375),Y=y(12198),mt=y(12386),X=y(12413),P=y(12361),G=y(12338),M=y(12204),L=y(12426);y(13812);class h extends X.d{set boundingBoxSize(t){if(this._boundingBoxSize&&this._boundingBoxSize.equals(t))return;this._boundingBoxSize=t;const U=this.St();U&&U.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(t){this._rotationY=t,this.setReflectionTextureMatrix(mt.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,U,y){let I="";for(const r of t)I+=r;return new h(I,U,null,y,t)}static CreateFromPrefilteredData(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const Y=new h(t,U,null,!1,null,null,null,void 0,!0,y,I);return U.useDelayedTextureLoading=r,Y}constructor(t,U){var y;let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,w=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,D=arguments.length>13?arguments[13]:void 0,l=arguments.length>14?arguments[14]:void 0;super(U),this.onLoadObservable=new M.b,this.boundingBoxPosition=mt.DU.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new mt.Matrix,this._buffer=null,this.name=t,this.url=t,this._noMipmap=r,this.pX=!1,this.isCube=!0,this._textureMatrix=mt.Matrix.Identity(),this.coordinatesMode=P.d.CUBIC_MODE;let g=null,B=null;null===I||Array.isArray(I)?(this._noMipmap=r,this._format=L,this._createPolynomials=F,g=I,this._loaderOptions=D,this._useSRGBBuffer=l,this._lodScale=E,this._lodOffset=w):(g=I.extensions??null,this._noMipmap=I.noMipmap??!1,Y=I.files??null,B=I.buffer??null,this._format=I.format??5,h=I.prefiltered??!1,Q=I.forcedExtension??null,this._createPolynomials=I.createPolynomials??!1,this._lodScale=I.lodScale??.8,this._lodOffset=I.lodOffset??0,this._loaderOptions=I.loaderOptions,this._useSRGBBuffer=I.useSRGBBuffer,X=I.u??null,G=I.onError??null),(t||Y)&&this.updateURL(t,Q,X,h,G,g,null===(y=this.St())||void 0===y?void 0:y.useDelayedTextureLoading,Y,B)}getClassName(){return"CubeTexture"}updateURL(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,U&&(this._forcedExtension=U);const G=t.lastIndexOf("."),M=U||(G>-1?t.substring(G).toLowerCase():""),L=0===M.indexOf(".dds"),h=0===M.indexOf(".env"),Q=0===M.indexOf(".basis");if(h?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=I,I&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(Q||h||L||Y||(Y=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Y){for(let U=0;U<Y.length;U++)this._files.push(t+Y[U]);this._extensions=Y}this._buffer=P,mt?(this.delayLoadState=4,this._delayedOnLoad=y,this._delayedOnError=r):this._loadTexture(y,r)}delayLoad(t){4===this.delayLoadState&&(t&&(this._forcedExtension=t),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(t){var U,y;if(t.updateFlag===this._textureMatrix.updateFlag)return;t.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(y=this.St())||void 0===y||y.markAllMaterialsAsDirty(1,(t=>-1!==t.getActiveTextures().indexOf(this))));if(this._textureMatrix=t,null===(U=this.St())||void 0===U||!U.useRightHandedSystem)return;const I=mt.TmpVectors.DU[0],r=mt.TmpVectors.Quaternion[0],Y=mt.TmpVectors.DU[1];this._textureMatrix.decompose(I,r,Y),r.z*=-1,r.w*=-1,mt.Matrix.ComposeToRef(I,r,Y,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var t;return null!==(t=this.St())&&void 0!==t&&t.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this.St(),I=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const r=()=>{var U;(this.onLoadObservable.notifyObservers(this),I)&&(I.dispose(),null===(U=this.St())||void 0===U||U.markAllMaterialsAsDirty(1));t&&t()},mt=(t,y)=>{this._loadingError=!0,this._errorObject={message:t,exception:y},U&&U(t,y),P.d.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?Y.Tools.SetImmediate((()=>r())):this._texture.onLoadedObservable.add((()=>r())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,y,this._lodScale,this._lodOffset,t,mt,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,y,this._files,this._noMipmap,t,mt,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(t,U,y){const I=L.b.Parse((()=>{let I=!1;return t.prefiltered&&(I=t.prefiltered),new h(y+(t.url??t.name),U,t.extensions,!1,t.files||null,null,null,void 0,I,t.forcedExtension)}),t,U);if(t.boundingBoxPosition&&(I.boundingBoxPosition=mt.DU.pU(t.boundingBoxPosition)),t.boundingBoxSize&&(I.boundingBoxSize=mt.DU.pU(t.boundingBoxSize)),t.animations)for(let r=0;r<t.animations.length;r++){const U=t.animations[r],y=(0,G.d)("BABYLON.Animation");y&&I.animations.push(y.Parse(U))}return I}clone(){let t=0;const U=L.b.Clone((()=>{const U=new h(this.url,this.St()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=U.uniqueId,U}),this);return U.uniqueId=t,U}}(0,I.b)([(0,r.I)()],h.prototype,"url",void 0),(0,I.b)([(0,r.E)()],h.prototype,"boundingBoxPosition",void 0),(0,I.b)([(0,r.E)()],h.prototype,"boundingBoxSize",null),(0,I.b)([(0,r.I)("rotationY")],h.prototype,"rotationY",null),(0,I.b)([(0,r.I)("files")],h.prototype,"_files",void 0),(0,I.b)([(0,r.I)("forcedExtension")],h.prototype,"_forcedExtension",void 0),(0,I.b)([(0,r.I)("extensions")],h.prototype,"_extensions",void 0),(0,I.b)([(0,r.t)("textureMatrix")],h.prototype,"_textureMatrix",void 0),(0,I.b)([(0,r.t)("textureMatrixRefraction")],h.prototype,"_textureMatrixRefraction",void 0),P.d._CubeTextureParser=h.Parse,(0,G.f)("BABYLON.CubeTexture",h)},14320:(t,U,y)=>{"use strict";y.d(U,{d:()=>P});var I=y(12221),r=y(12361),Y=y(12349),mt=y(12543),X=y(12320);mt.ThinEngine.prototype.createDynamicTexture=function(t,U,y,I){const r=new X.e(this,4);return r.baseWidth=t,r.baseHeight=U,y&&(t=this.needPOTTextures?(0,Y.f)(t,this._caps.maxTextureSize):t,U=this.needPOTTextures?(0,Y.f)(U,this._caps.maxTextureSize):U),r.width=t,r.height=U,r.isReady=!1,r.generateMipMaps=y,r.samplingMode=I,this.updateTextureSamplingMode(I,r),this._internalTexturesCache.push(r),r},mt.ThinEngine.prototype.updateDynamicTexture=function(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!t)return;const mt=this._gl,X=mt.TEXTURE_2D,P=this._bindTextureDirectly(X,t,!0,Y);this._unpackFlipY(void 0===y?t.invertY:y),I&&mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const G=this._getWebGLTextureType(t.type),M=this._getInternalFormat(r||t.format),L=this._getRGBABufferInternalSizedFormat(t.type,M);mt.texImage2D(X,0,L,M,G,U),t.generateMipMaps&&mt.generateMipmap(X),P||this._bindTextureDirectly(X,null),I&&mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),r&&(t.format=r),t._dynamicTextureSource=U,t._premulAlpha=I,t.invertY=y||!1,t.isReady=!0};class P extends r.d{constructor(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,mt=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const P=!y||y._isScene;super(null,P?y:null===y||void 0===y?void 0:y.gU,P?!I:y,X,Y,void 0,void 0,void 0,void 0,mt),this.name=t,this.wrapU=r.d.CLAMP_ADDRESSMODE,this.wrapV=r.d.CLAMP_ADDRESSMODE,this._generateMipMaps=I;const G=this._getEngine();if(!G)return;if(U.getContext)this._canvas=U,this._ownCanvas=!1,this._texture=G.createDynamicTexture(this._canvas.width,this._canvas.height,I,Y);else{this._canvas=G.createCanvas(1,1),this._ownCanvas=!0;const t=U;t.width||0===t.width?this._texture=G.createDynamicTexture(t.width,t.height,I,Y):this._texture=G.createDynamicTexture(U,U,I,Y)}const M=this.getSize();this._canvas.width!==M.width&&(this._canvas.width=M.width),this._canvas.height!==M.height&&(this._canvas.height=M.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(t){this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this.samplingMode)}scale(t){const U=this.getSize();U.width*=t,U.height*=t,this._recreate(U)}scaleTo(t,U){const y=this.getSize();y.width=t,y.height=U,this._recreate(y)}getContext(){return this._context}clear(t){const U=this.getSize();t&&(this._context.fillStyle=t),this._context.clearRect(0,0,U.width,U.height)}update(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===t||t,U,this._format||void 0,void 0,y)}drawText(t,U,y,I,r,Y,mt){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const P=this.getSize();if(Y&&(this._context.fillStyle=Y,this._context.fillRect(0,0,P.width,P.height)),this._context.font=I,null===U||void 0===U){const y=this._context.measureText(t);U=(P.width-y.width)/2}if(null===y||void 0===y){const t=parseInt(I.replace(/\D/g,""));y=P.height/2+t/3.65}this._context.fillStyle=r||"",this._context.fillText(t,U,y),X&&this.update(mt)}dispose(){var t,U;(super.dispose(),this._ownCanvas)&&(null===(t=this._canvas)||void 0===t||null===(U=t.remove)||void 0===U||U.call(t));this._canvas=null,this._context=null}clone(){const t=this.St();if(!t)return this;const U=this.getSize(),y=new P(this.name,U,t,this._generateMipMaps);return y.pX=this.pX,y.level=this.level,y.wrapU=this.wrapU,y.wrapV=this.wrapV,y}serialize(){const t=this.St();t&&!t.isReady()&&I.b.Warn("The scene must be ready before serializing the dynamic texture");const U=super.serialize();return P._IsCanvasElement(this._canvas)&&(U.base64String=this._canvas.toDataURL()),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U}static _IsCanvasElement(t){return void 0!==t.toDataURL}_rebuild(){this.update()}}},13729:(t,U,y)=>{"use strict";y.d(U,{e:()=>r});var I=y(12361);class r extends I.d{get depth(){return this._depth}constructor(t,U,y,r,Y,mt){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:I.d.TRILINEAR_SAMPLINGMODE,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10?arguments[10]:void 0;super(null,mt,!X,P),this.format=Y,this._texture=mt.getEngine().createRawTexture2DArray(t,U,y,r,Y,X,P,G,null,M,L),this._depth=r,this.is2DArray=!0}update(t){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,t,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(t,U,y,I,Y){return new r(t,U,y,I,5,Y,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13547:(t,U,y)=>{"use strict";y.d(U,{c:()=>X,e:()=>P,g:()=>Y,i:()=>mt});var I=y(12404),r=y(12386);function Y(t,U){return`{X: ${t.x.toFixed(U)} Y: ${t.y.toFixed(U)}}`}function mt(t,U){return`{X: ${t._x.toFixed(U)} Y: ${t._y.toFixed(U)} Z: ${t._z.toFixed(U)}}`}function X(t,U){return 2*Math.acos((0,I.Clamp)(r.Quaternion.Dot(t,U)))}function P(t,U){const y=new r.Quaternion;return function(t,U,y){const Y=r.DU.Cross(t,U),mt=Math.acos((0,I.Clamp)(r.DU.Dot(t,U),-1,1));r.Quaternion.RotationAxisToRef(Y,mt,y)}(t,U,y),y}},13388:(t,U,y)=>{"use strict";y.d(U,{e:()=>G});var I=y(12386),r=y(12442),Y=y(12868),mt=y(12853),X=y(12460);y(13394);function P(t){let U=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const y=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Y=[];let P=[];const G=t.width||t.size||1,M=t.height||t.size||1,L=t.depth||t.size||1,h=t.wrap||!1;let Q=void 0===t.topBaseAt?1:t.topBaseAt,F=void 0===t.bottomBaseAt?0:t.bottomBaseAt;Q=(Q+4)%4,F=(F+4)%4;let E=[2,0,3,1][Q],w=[2,0,1,3][F],D=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){U=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],D=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let t=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const I=[17,18,19,16],r=[22,23,20,21];for(;E>0;)t.unshift(t.pop()),I.unshift(I.pop()),E--;for(;w>0;)y.unshift(y.pop()),r.unshift(r.pop()),w--;t=t.flat(),y=y.flat(),D=D.concat(t).concat(y),U.push(I[0],I[2],I[3],I[0],I[1],I[2]),U.push(r[0],r[2],r[3],r[0],r[1],r[2])}const l=[G/2,M/2,L/2];P=D.reduce(((t,U,y)=>t.concat(U*l[y%3])),[]);const g=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,B=t.faceUV||new Array(6),b=t.faceColors,p=[];for(let mt=0;mt<6;mt++)void 0===B[mt]&&(B[mt]=new I.Vector4(0,0,1,1)),b&&void 0===b[mt]&&(b[mt]=new r.HX(1,1,1,1));for(let I=0;I<6;I++)if(Y.push(B[I].z,X.e?1-B[I].w:B[I].w),Y.push(B[I].x,X.e?1-B[I].w:B[I].w),Y.push(B[I].x,X.e?1-B[I].y:B[I].y),Y.push(B[I].z,X.e?1-B[I].y:B[I].y),b)for(let t=0;t<4;t++)p.push(b[I].r,b[I].g,b[I].b,b[I].a);mt.b._ComputeSides(g,P,U,y,Y,t.frontUVs,t.backUVs);const c=new mt.b;if(c.indices=U,c.jt=P,c.Jt=y,c.qt=Y,b){const t=g===mt.b.DOUBLESIDE?p.concat(p):p;c.dt=t}return c}function G(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new Y.c(t,y);U.sideOrientation=Y.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return P(U).et(I,U.updatable),I}mt.b.CreateBox=P,Y.c.CreateBox=function(t,U){return G(t,{size:U,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13537:(t,U,y)=>{"use strict";y.d(U,{e:()=>X});var I=y(12868),r=y(12853),Y=y(12460);function mt(t){const U=[],y=[],I=[],mt=[],X=t.radius||.5,P=t.tessellation||64,G=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,M=0===t.sideOrientation?0:t.sideOrientation||r.b.DEFAULTSIDE;U.push(0,0,0),mt.push(.5,.5);const L=2*Math.PI*G,h=1===G?L/P:L/(P-1);let Q=0;for(let r=0;r<P;r++){const t=Math.cos(Q),y=Math.sin(Q),I=(t+1)/2,r=(1-y)/2;U.push(X*t,X*y,0),mt.push(I,Y.e?1-r:r),Q+=h}1===G&&(U.push(U[3],U[4],U[5]),mt.push(mt[2],Y.e?1-mt[3]:mt[3]));const F=U.length/3;for(let r=1;r<F-1;r++)y.push(r+1,0,r);r.b.ComputeNormals(U,y,I),r.b._ComputeSides(M,U,y,I,mt,t.frontUVs,t.backUVs);const E=new r.b;return E.indices=y,E.jt=U,E.Jt=I,E.qt=mt,E}function X(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(t,y);U.sideOrientation=I.c._GetDefaultSideOrientation(U.sideOrientation),r._originalBuilderSideOrientation=U.sideOrientation;return mt(U).et(r,U.updatable),r}r.b.CreateDisc=mt,I.c.CreateDisc=function(t,U,y){return X(t,{radius:U,tessellation:y,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13394:(t,U,y)=>{"use strict";y.d(U,{d:()=>w,c:()=>l,h:()=>D});var I=y(12386),r=y(12442),Y=y(12868),mt=y(12853),X=y(12480);Y.c._GroundMeshParser=(t,U)=>P.Parse(t,U);class P extends Y.c{constructor(t,U){super(t,U),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);const y=this;y.createOrUpdateSubmeshesOctree&&y.createOrUpdateSubmeshesOctree(U)}getHeightAtCoordinates(t,U){const y=this.getWorldMatrix(),r=I.TmpVectors.Matrix[5];y.invertToRef(r);const Y=I.TmpVectors.DU[8];if(I.DU.TransformCoordinatesFromFloatsToRef(t,0,U,r,Y),t=Y.x,U=Y.z,t<this._minX||t>=this._maxX||U<=this._minZ||U>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const mt=this._getFacetAt(t,U),X=-(mt.x*t+mt.z*U+mt.w)/mt.y;return I.DU.TransformCoordinatesFromFloatsToRef(0,X,0,y,Y),Y.y}getNormalAtCoordinates(t,U){const y=new I.DU(0,1,0);return this.getNormalAtCoordinatesToRef(t,U,y),y}getNormalAtCoordinatesToRef(t,U,y){const r=this.getWorldMatrix(),Y=I.TmpVectors.Matrix[5];r.invertToRef(Y);const mt=I.TmpVectors.DU[8];if(I.DU.TransformCoordinatesFromFloatsToRef(t,0,U,Y,mt),t=mt.x,U=mt.z,t<this._minX||t>this._maxX||U<this._minZ||U>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(t,U);return I.DU.TransformNormalFromFloatsToRef(X.x,X.y,X.z,r,y),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(t,U){const y=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),I=Math.floor(-(U+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[I*this._subdivisionsX+y];let Y;return Y=U<r.slope.x*t+r.slope.y?r.facet1:r.facet2,Y}_initHeightQuads(){const t=this._subdivisionsX,U=this._subdivisionsY;this._heightQuads=[];for(let y=0;y<U;y++)for(let U=0;U<t;U++){const r={slope:I.Vector2.Zero(),facet1:new I.Vector4(0,0,0,0),facet2:new I.Vector4(0,0,0,0)};this._heightQuads[y*t+U]=r}return this}_computeHeightQuads(){const t=this.getVerticesData(X.e.PositionKind);if(!t)return this;const U=I.TmpVectors.DU[3],y=I.TmpVectors.DU[2],r=I.TmpVectors.DU[1],Y=I.TmpVectors.DU[0],mt=I.TmpVectors.DU[4],P=I.TmpVectors.DU[5],G=I.TmpVectors.DU[6],M=I.TmpVectors.DU[7],L=I.TmpVectors.DU[8];let h=0,Q=0,F=0,E=0,w=0,D=0,l=0;const g=this._subdivisionsX,B=this._subdivisionsY;for(let X=0;X<B;X++)for(let B=0;B<g;B++){h=3*B,Q=X*(g+1)*3,F=(X+1)*(g+1)*3,U.x=t[Q+h],U.y=t[Q+h+1],U.z=t[Q+h+2],y.x=t[Q+h+3],y.y=t[Q+h+4],y.z=t[Q+h+5],r.x=t[F+h],r.y=t[F+h+1],r.z=t[F+h+2],Y.x=t[F+h+3],Y.y=t[F+h+4],Y.z=t[F+h+5],E=(Y.z-U.z)/(Y.x-U.x),w=U.z-E*U.x,y.subtractToRef(U,mt),r.subtractToRef(U,P),Y.subtractToRef(U,G),I.DU.CrossToRef(G,P,M),I.DU.CrossToRef(mt,G,L),M.normalize(),L.normalize(),D=-(M.x*U.x+M.y*U.y+M.z*U.z),l=-(L.x*y.x+L.y*y.y+L.z*y.z);const b=this._heightQuads[X*g+B];b.slope.aX(E,w),b.facet1.aX(M.x,M.y,M.z,D),b.facet2.aX(L.x,L.y,L.z,l)}return this}serialize(t){super.serialize(t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.cX=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height}static Parse(t,U){const y=new P(t.name,U);return y._subdivisionsX=t.subdivisionsX||1,y._subdivisionsY=t.subdivisionsY||1,y._minX=t.minX,y._maxX=t.maxX,y._minZ=t.cX,y._maxZ=t.maxZ,y._width=t.width,y._height=t.height,y}}var G=y(12198),M=y(12250),L=y(12392),h=y(12460);function Q(t){const U=[],y=[],r=[],Y=[];let X,P;const G=t.width||t.size||1,M=t.height||t.size||1,L=0|(t.subdivisionsX||t.subdivisions||1),Q=0|(t.subdivisionsY||t.subdivisions||1);for(X=0;X<=Q;X++)for(P=0;P<=L;P++){const t=new I.DU(P*G/L-G/2,0,(Q-X)*M/Q-M/2),U=new I.DU(0,1,0);y.push(t.x,t.y,t.z),r.push(U.x,U.y,U.z),Y.push(P/L,h.e?X/Q:1-X/Q)}for(X=0;X<Q;X++)for(P=0;P<L;P++)U.push(P+1+(X+1)*(L+1)),U.push(P+1+X*(L+1)),U.push(P+X*(L+1)),U.push(P+(X+1)*(L+1)),U.push(P+1+(X+1)*(L+1)),U.push(P+X*(L+1));const F=new mt.b;return F.indices=U,F.jt=y,F.Jt=r,F.qt=Y,F}function F(t){const U=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,y=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,r=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,Y=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,X=t.subdivisions||{w:1,h:1},P=t.precision||{w:1,h:1},G=[],M=[],L=[],h=[];let Q,F,E,w;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,P.w=P.w<1?1:P.w,P.h=P.h<1?1:P.h;const D=(r-U)/X.w,l=(Y-y)/X.h;function g(t,U,y,r){const Y=M.length/3,mt=P.w+1;for(Q=0;Q<P.h;Q++)for(F=0;F<P.w;F++){const t=[Y+F+Q*mt,Y+(F+1)+Q*mt,Y+(F+1)+(Q+1)*mt,Y+F+(Q+1)*mt];G.push(t[1]),G.push(t[2]),G.push(t[3]),G.push(t[0]),G.push(t[1]),G.push(t[3])}const X=I.DU.Zero(),E=new I.DU(0,1,0);for(Q=0;Q<=P.h;Q++)for(X.z=Q*(r-U)/P.h+U,F=0;F<=P.w;F++)X.x=F*(y-t)/P.w+t,X.y=0,M.push(X.x,X.y,X.z),L.push(E.x,E.y,E.z),h.push(F/P.w,Q/P.h)}for(E=0;E<X.h;E++)for(w=0;w<X.w;w++)g(U+w*D,y+E*l,U+(w+1)*D,y+(E+1)*l);const B=new mt.b;return B.indices=G,B.jt=M,B.Jt=L,B.qt=h,B}function E(t){const U=[],y=[],Y=[],X=[];let P,G;const M=t.colorFilter||new r.bU(.3,.59,.11),h=t.alphaFilter||0;let Q=!1;if(t.minHeight>t.maxHeight){Q=!0;const U=t.maxHeight;t.maxHeight=t.minHeight,t.minHeight=U}for(P=0;P<=t.subdivisions;P++)for(G=0;G<=t.subdivisions;G++){const U=new I.DU(G*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-P)*t.height/t.subdivisions-t.height/2),r=4*(((U.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(U.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth);let mt=t.buffer[r]/255,F=t.buffer[r+1]/255,E=t.buffer[r+2]/255;const w=t.buffer[r+3]/255;Q&&(mt=1-mt,F=1-F,E=1-E);const D=mt*M.r+F*M.g+E*M.b;U.y=w>=h?t.minHeight+(t.maxHeight-t.minHeight)*D:t.minHeight-L.b,t.heightBuffer&&(t.heightBuffer[P*(t.subdivisions+1)+G]=U.y),y.push(U.x,U.y,U.z),Y.push(0,0,0),X.push(G/t.subdivisions,1-P/t.subdivisions)}for(P=0;P<t.subdivisions;P++)for(G=0;G<t.subdivisions;G++){const I=G+1+(P+1)*(t.subdivisions+1),r=G+1+P*(t.subdivisions+1),Y=G+P*(t.subdivisions+1),mt=G+(P+1)*(t.subdivisions+1),X=y[3*I+1]>=t.minHeight,M=y[3*r+1]>=t.minHeight,L=y[3*Y+1]>=t.minHeight;X&&M&&L&&(U.push(I),U.push(r),U.push(Y));y[3*mt+1]>=t.minHeight&&X&&L&&(U.push(mt),U.push(I),U.push(Y))}mt.b.ComputeNormals(y,U,Y);const F=new mt.b;return F.indices=U,F.jt=y,F.Jt=Y,F.qt=X,F}function w(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const y=new P(t,arguments.length>2?arguments[2]:void 0);y._setReady(!1),y._subdivisionsX=U.subdivisionsX||U.subdivisions||1,y._subdivisionsY=U.subdivisionsY||U.subdivisions||1,y._width=U.width||1,y._height=U.height||1,y._maxX=y._width/2,y._maxZ=y._height/2,y._minX=-y._maxX,y._minZ=-y._maxZ;return Q(U).et(y,U.updatable),y._setReady(!0),y}function D(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new Y.c(t,y);return F(U).et(I,U.updatable),I}function l(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Y=y.width||10,mt=y.height||10,X=y.subdivisions||1,L=y.minHeight||0,h=y.maxHeight||1,Q=y.colorFilter||new r.bU(.3,.59,.11),F=y.alphaFilter||0,w=y.updatable,D=y.onReady;I=I||M.d.LastCreatedScene;const l=new P(t,I);let g;l._subdivisionsX=X,l._subdivisionsY=X,l._width=Y,l._height=mt,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ,l._setReady(!1),y.passHeightBufferInCallback&&(g=new Float32Array((X+1)*(X+1)));const B=(t,U,y)=>{E({width:Y,height:mt,subdivisions:X,minHeight:L,maxHeight:h,colorFilter:Q,buffer:t,bufferWidth:U,bufferHeight:y,alphaFilter:F,heightBuffer:g}).et(l,w),D&&D(l,g),l._setReady(!0)};if("string"===typeof U){const t=t=>{var U;const y=t.width,r=t.height;if(I.G)return;const Y=null===(U=I)||void 0===U?void 0:U.getEngine().resizeImageBitmap(t,y,r);B(Y,y,r)};G.Tools.LoadImage(U,t,y.onError?y.onError:()=>{},I.offlineProvider)}else B(U.data,U.width,U.height);return l}mt.b.CreateGround=Q,mt.b.CreateTiledGround=F,mt.b.CreateGroundFromHeightMap=E,Y.c.CreateGround=(t,U,y,I,r,Y)=>w(t,{width:U,height:y,subdivisions:I,updatable:Y},r),Y.c.CreateTiledGround=(t,U,y,I,r,Y,mt,X,P)=>D(t,{xmin:U,zmin:y,xmax:I,zmax:r,subdivisions:Y,precision:mt,updatable:P},X),Y.c.CreateGroundFromHeightMap=(t,U,y,I,r,Y,mt,X,P,G,M)=>l(t,U,{width:y,height:I,subdivisions:r,minHeight:Y,maxHeight:mt,updatable:P,onReady:G,alphaFilter:M},X)},14043:(t,U,y)=>{"use strict";y.d(U,{b:()=>Q,d:()=>L,g:()=>h});var I=y(12386),r=y(12868),Y=y(12853),mt=y(12982),X=y(12480),P=y(12221);function G(t){const U=[],y=[],I=t.lines,r=t.dt,mt=[];let X=0;for(let Y=0;Y<I.length;Y++){const t=I[Y];for(let I=0;I<t.length;I++){const{x:P,y:G,z:M}=t[I];if(y.push(P,G,M),r){const t=r[Y],{r:U,g:y,b:X,a:P}=t[I];mt.push(U,y,X,P)}I>0&&(U.push(X-1),U.push(X)),X++}}const P=new Y.b;return P.indices=U,P.jt=y,r&&(P.dt=mt),P}function M(t){const U=t.dashSize||3,y=t.gapSize||1,r=t.dashNb||200,mt=t.points,X=[],P=[],G=I.DU.Zero();let M=0,L=0,h=0,Q=0,F=0,E=0,w=0;for(w=0;w<mt.length-1;w++)mt[w+1].subtractToRef(mt[w],G),M+=G.length();for(h=M/r,Q=U*h/(U+y),w=0;w<mt.length-1;w++){mt[w+1].subtractToRef(mt[w],G),L=Math.floor(G.length()/h),G.normalize();for(let t=0;t<L;t++)F=h*t,X.push(mt[w].x+F*G.x,mt[w].y+F*G.y,mt[w].z+F*G.z),X.push(mt[w].x+(F+Q)*G.x,mt[w].y+(F+Q)*G.y,mt[w].z+(F+Q)*G.z),P.push(E,E+1),E+=2}const D=new Y.b;return D.jt=X,D.indices=P,D}function L(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=U.instance,r=U.lines,Y=U.dt;if(I){const t=I.getVerticesData(X.e.PositionKind);let U,y;Y&&(U=I.getVerticesData(X.e.ColorKind));let mt=0,P=0;for(let I=0;I<r.length;I++){const X=r[I];for(let r=0;r<X.length;r++)t[mt]=X[r].x,t[mt+1]=X[r].y,t[mt+2]=X[r].z,Y&&U&&(y=Y[I],U[P]=y[r].r,U[P+1]=y[r].g,U[P+2]=y[r].b,U[P+3]=y[r].a,P+=4),mt+=3}return I.updateVerticesData(X.e.PositionKind,t,!1,!1),Y&&U&&I.updateVerticesData(X.e.ColorKind,U,!1,!1),I.refreshBoundingInfo(),I}const P=!!Y,M=new mt.d(t,y,null,void 0,void 0,P,U.useVertexAlpha,U.material);return G(U).et(M,U.updatable),M}function h(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=U.dt?[U.dt]:null;return L(t,{lines:[U.points],updatable:U.updatable,instance:U.instance,dt:I,useVertexAlpha:U.useVertexAlpha,material:U.material},y)}function Q(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=U.points,X=U.instance,G=U.gapSize||1,L=U.dashSize||3;if(X){const t=t=>{const U=I.DU.Zero(),y=t.length/6;let r=0,mt=0,P=0,G=0,M=0,L=0,h=0,Q=0;for(h=0;h<Y.length-1;h++)Y[h+1].subtractToRef(Y[h],U),r+=U.length();P=r/y;const F=X._creationDataStorage.dashSize;for(G=F*P/(F+X._creationDataStorage.gapSize),h=0;h<Y.length-1;h++)for(Y[h+1].subtractToRef(Y[h],U),mt=Math.floor(U.length()/P),U.normalize(),Q=0;Q<mt&&L<t.length;)M=P*Q,t[L]=Y[h].x+M*U.x,t[L+1]=Y[h].y+M*U.y,t[L+2]=Y[h].z+M*U.z,t[L+3]=Y[h].x+(M+G)*U.x,t[L+4]=Y[h].y+(M+G)*U.y,t[L+5]=Y[h].z+(M+G)*U.z,L+=6,Q++;for(;L<t.length;)t[L]=Y[h].x,t[L+1]=Y[h].y,t[L+2]=Y[h].z,L+=3};return(U.dashNb||U.dashSize||U.gapSize||U.useVertexAlpha||U.material)&&P.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),X.updateMeshPositions(t,!1),X}const h=new mt.d(t,y,null,void 0,void 0,void 0,U.useVertexAlpha,U.material);return M(U).et(h,U.updatable),h._creationDataStorage=new r.d,h._creationDataStorage.dashSize=L,h._creationDataStorage.gapSize=G,h}Y.b.CreateLineSystem=G,Y.b.CreateDashedLines=M,r.c.SG=function(t,U){return h(t,{points:U,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},r.c.CreateDashedLines=function(t,U,y,I,r){return Q(t,{points:U,dashSize:y,gapSize:I,dashNb:r,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13437:(t,U,y)=>{"use strict";y.d(U,{b:()=>X,e:()=>P});var I=y(12868),r=y(12853),Y=y(12460);function mt(t){const U=[],y=[],I=[],mt=[],X=void 0!==t.width?t.width:void 0!==t.size?t.size:1,P=void 0!==t.height?t.height:void 0!==t.size?t.size:1,G=0===t.sideOrientation?0:t.sideOrientation||r.b.DEFAULTSIDE,M=X/2,L=P/2;y.push(-M,-L,0),I.push(0,0,-1),mt.push(0,Y.e?1:0),y.push(M,-L,0),I.push(0,0,-1),mt.push(1,Y.e?1:0),y.push(M,L,0),I.push(0,0,-1),mt.push(1,Y.e?0:1),y.push(-M,L,0),I.push(0,0,-1),mt.push(0,Y.e?0:1),U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),r.b._ComputeSides(G,y,U,I,mt,t.frontUVs,t.backUVs);const h=new r.b;return h.indices=U,h.jt=y,h.Jt=I,h.qt=mt,h}function X(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(t,y);U.sideOrientation=I.c._GetDefaultSideOrientation(U.sideOrientation),r._originalBuilderSideOrientation=U.sideOrientation;return mt(U).et(r,U.updatable),U.sourcePlane&&(r.translate(U.sourcePlane.normal,-U.sourcePlane.d),r.setDirection(U.sourcePlane.normal.scale(-1))),r}const P={JG:X};r.b.JG=mt,I.c.JG=(t,U,y,I,r)=>X(t,{size:U,width:U,height:U,sideOrientation:r,updatable:I},y)},13527:(t,U,y)=>{"use strict";y.d(U,{d:()=>P});var I=y(12386),r=y(12868),Y=y(12853),mt=y(12460);function X(t){const U=0|(t.segments||32),y=t.diameterX||t.diameter||1,r=t.diameterY||t.diameter||1,X=t.diameterZ||t.diameter||1,P=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,G=t.slice&&t.slice<=0?1:t.slice||1,M=0===t.sideOrientation?0:t.sideOrientation||Y.b.DEFAULTSIDE,L=!!t.dedupTopBottomIndices,h=new I.DU(y/2,r/2,X/2),Q=2+U,F=2*Q,E=[],w=[],D=[],l=[];for(let Y=0;Y<=Q;Y++){const t=Y/Q,U=t*Math.PI*G;for(let y=0;y<=F;y++){const r=y/F,Y=r*Math.PI*2*P,X=I.Matrix.RotationZ(-U),G=I.Matrix.RotationY(Y),M=I.DU.TransformCoordinates(I.DU.Up(),X),L=I.DU.TransformCoordinates(M,G),Q=L.multiply(h),E=L.divide(h).normalize();w.push(Q.x,Q.y,Q.z),D.push(E.x,E.y,E.z),l.push(r,mt.e?1-t:t)}if(Y>0){const t=w.length/3;for(let U=t-2*(F+1);U+F+2<t;U++)L?(Y>1&&(E.push(U),E.push(U+1),E.push(U+F+1)),(Y<Q||G<1)&&(E.push(U+F+1),E.push(U+1),E.push(U+F+2))):(E.push(U),E.push(U+1),E.push(U+F+1),E.push(U+F+1),E.push(U+1),E.push(U+F+2))}}Y.b._ComputeSides(M,w,E,D,l,t.frontUVs,t.backUVs);const g=new Y.b;return g.indices=E,g.jt=w,g.Jt=D,g.qt=l,g}function P(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return X(U).et(I,U.updatable),I}Y.b.CreateSphere=X,r.c.CreateSphere=(t,U,y,I,r,Y)=>P(t,{segments:U,diameterX:y,diameterY:y,diameterZ:y,sideOrientation:Y,updatable:r},I)},14329:(t,U,y)=>{"use strict";y.d(U,{b:()=>X});var I=y(12998),r=y(13821),Y=y(13015),mt=y(12853);class X{static get Configuration(){return{get decoder(){return r.b.DefaultConfiguration},set decoder(t){r.b.DefaultConfiguration=t}}}static set Configuration(t){r.b.DefaultConfiguration=t.decoder}static get DecoderAvailable(){return(0,I.i)(r.b.DefaultConfiguration)}static get Default(){return X._Default??(X._Default=new X),X._Default}static ResetDefault(t){X._Default&&(t||X._Default.dispose(),X._Default=null)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const U="number"===typeof t?{...r.b.DefaultConfiguration,numWorkers:t}:{...r.b.DefaultConfiguration,...t};this._decoder=new r.b(U)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(t,U,y){return this._decoder.decodeMeshToMeshDataAsync(t,U,y)}async decodeMeshToGeometryAsync(t,U,y,I){return await this._decoder.decodeMeshToGeometryAsync(t,U,y,I)}async _decodeMeshToGeometryForGltfAsync(t,U,y,I,r,Y){return await this._decoder._decodeMeshToGeometryForGltfAsync(t,U,y,I,r,Y)}async decodeMeshAsync(t,U){const y=await this._decoder.decodeMeshToMeshDataAsync(t,U),I=new mt.b;y.indices&&(I.indices=y.indices);for(const r of y.attributes){const t=Y.e.GetFloatData(r.data,r.size,Y.e.GetDataType(r.data),r.byteOffset,r.byteStride,r.normalized,y.totalVertices);I.set(t,r.kind)}return I}}X.DefaultNumWorkers=(0,I.f)(),X._Default=null},13821:(t,U,y)=>{"use strict";y.d(U,{b:()=>G});var I=y(12998),r=y(12198),Y=y(12879),mt=y(13015),X=y(12221),P=y(13008);class G extends I.e{static get DefaultAvailable(){return(0,I.i)(G.DefaultConfiguration)}static get Default(){return G._Default??(G._Default=new G),G._Default}static ResetDefault(t){G._Default&&(t||G._Default.dispose(),G._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(t,U){return{module:await(U||DracoDecoderModule)({wasmBinary:t})}}_getWorkerContent(){return`${P.b}(${P.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.DefaultConfiguration)}decodeMeshToMeshDataAsync(t,U,y){const I=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t.buffer,t.byteOffset,t.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async t=>await new Promise(((r,Y)=>{t.push(((t,mt)=>{let P=null;const G=[],M=U=>{t.removeEventListener("error",M),t.removeEventListener("message",L),Y(U),mt()},L=U=>{const I=U.data;switch(I.id){case"indices":P=I.data;break;case"attribute":G.push({kind:I.kind,data:I.data,size:I.size,byteOffset:I.byteOffset,byteStride:I.byteStride,normalized:(Y=I.kind,h=I.normalized,y&&void 0!==y[Y]?(h!==y[Y]&&X.b.Warn(`Normalized flag from Draco data (${h}) does not match normalized flag from glTF accessor (${y[Y]}). Using flag from glTF accessor.`),y[Y]):h)});break;case"decodeMeshDone":t.removeEventListener("error",M),t.removeEventListener("message",L),r({indices:P,attributes:G,totalVertices:I.totalVertices}),mt()}var Y,h};t.addEventListener("error",M),t.addEventListener("message",L);const h=I.slice();t.postMessage({id:"decodeMesh",dataView:h,attributes:U},[h.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((t=>{let y=null;const r=[],Y=(0,P.b)(t.module,I,U,(t=>{y=t}),((t,U,y,I,Y,mt)=>{r.push({kind:t,data:U,size:y,byteOffset:I,byteStride:Y,normalized:mt})}));return{indices:y,attributes:r,totalVertices:Y}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(t,U,y,I){const r=await this.decodeMeshToMeshDataAsync(y,I),X=new Y.c(t,U);r.indices&&X.setIndices(r.indices);for(const Y of r.attributes)X.setVerticesBuffer(new mt.e(U.getEngine(),Y.data,Y.kind,!1,void 0,Y.byteStride,void 0,Y.byteOffset,Y.size,void 0,Y.normalized,!0),r.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(t,U,y,I,r,X){const P=await this.decodeMeshToMeshDataAsync(y,I,r),G=new Y.c(t,U);X&&(G._boundingInfo=X,G.useBoundingInfoFromGeometry=!0),P.indices&&G.setIndices(P.indices);for(const Y of P.attributes)G.setVerticesBuffer(new mt.e(U.getEngine(),Y.data,Y.kind,!1,void 0,Y.byteStride,void 0,Y.byteOffset,Y.size,void 0,Y.normalized,!0),P.totalVertices);return G}}G.DefaultConfiguration={wasmUrl:`${r.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${r.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${r.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},G._Default=null},14041:(t,U,y)=>{"use strict";y.d(U,{b:()=>Xt});var I=y(12386),r=y(12868),Y=y(12480),mt=y(12853),X=y(12460);function P(t){let U=t.pathArray;const y=t.closeArray||!1,I=t.closePath||!1,r=t.invertUV||!1,P=Math.floor(U[0].length/2);let G=t.offset||P;G=G>P?P:Math.floor(G);const M=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,L=t.qt,h=t.dt,Q=[],F=[],E=[],w=[],D=[],l=[],g=[],B=[];let b;const p=[],c=[];let f,S,N;if(U.length<2){const t=[],y=[];for(S=0;S<U[0].length-G;S++)t.push(U[0][S]),y.push(U[0][S+G]);U=[t,y]}let j=0;const J=I?1:0,a=y?1:0;let d,q,H,e,o,V;for(b=U[0].length,f=0;f<U.length+a;f++){for(g[f]=0,D[f]=[0],d=f===U.length?U[0]:U[f],q=d.length,b=b<q?b:q,N=0;N<q;)Q.push(d[N].x,d[N].y,d[N].z),N>0&&(H=d[N].lU(d[N-1]).length(),e=H+g[f],D[f].push(e),g[f]=e),N++;I&&(N--,Q.push(d[0].x,d[0].y,d[0].z),H=d[N].lU(d[0]).length(),e=H+g[f],D[f].push(e),g[f]=e),p[f]=q+J,c[f]=j,j+=q+J}let n,i,v=null,O=null;for(S=0;S<b+J;S++)for(B[S]=0,l[S]=[0],f=0;f<U.length-1+a;f++)o=U[f],V=f===U.length-1?U[0]:U[f+1],S===b?(v=o[0],O=V[0]):(v=o[S],O=V[S]),H=O.lU(v).length(),e=H+B[S],l[S].push(e),B[S]=e;if(L)for(f=0;f<L.length;f++)w.push(L[f].x,X.e?1-L[f].y:L[f].y);else for(f=0;f<U.length+a;f++)for(S=0;S<b+J;S++)n=0!=g[f]?D[f][S]/g[f]:0,i=0!=B[S]?l[S][f]/B[S]:0,r?w.push(i,n):w.push(n,X.e?1-i:i);f=0;let k=0,s=p[f]-1,x=p[f+1]-1,Z=s<x?s:x,W=c[1]-c[0];const A=p.length-1;for(;k<=Z&&f<A;)F.push(k,k+W,k+1),F.push(k+W+1,k+1,k+W),k+=1,k===Z&&(f++,W=c[f+1]-c[f],s=p[f]-1,x=p[f+1]-1,k=c[f],Z=s<x?s+k:x+k);if(mt.b.ComputeNormals(Q,F,E),I){let t=0,y=0;for(f=0;f<U.length;f++){t=3*c[f],y=f+1<U.length?3*(c[f+1]-1):E.length-3,E[t]=.5*(E[t]+E[y]),E[t+1]=.5*(E[t+1]+E[y+1]),E[t+2]=.5*(E[t+2]+E[y+2]);const I=Math.sqrt(E[t]*E[t]+E[t+1]*E[t+1]+E[t+2]*E[t+2]);E[t]/=I,E[t+1]/=I,E[t+2]/=I,E[y]=E[t],E[y+1]=E[t+1],E[y+2]=E[t+2]}}if(y){let t=3*c[0],y=3*c[U.length];for(S=0;S<b+J;S++){E[t]=.5*(E[t]+E[y]),E[t+1]=.5*(E[t+1]+E[y+1]),E[t+2]=.5*(E[t+2]+E[y+2]);const U=Math.sqrt(E[t]*E[t]+E[t+1]*E[t+1]+E[t+2]*E[t+2]);E[t]/=U,E[t+1]/=U,E[t+2]/=U,E[y]=E[t],E[y+1]=E[t+1],E[y+2]=E[t+2],t+=3,y+=3}}mt.b._ComputeSides(M,Q,F,E,w,t.frontUVs,t.backUVs);let K=null;if(h){K=new Float32Array(4*h.length);for(let t=0;t<h.length;t++)K[4*t]=h[t].r,K[4*t+1]=h[t].g,K[4*t+2]=h[t].b,K[4*t+3]=h[t].a}const C=new mt.b,R=new Float32Array(Q),u=new Float32Array(E),T=new Float32Array(w);return C.indices=F,C.jt=R,C.Jt=u,C.qt=T,K&&C.set(K,Y.e.ColorKind),I&&(C._idx=c),C}function G(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=U.pathArray,M=U.closeArray,L=U.closePath,h=r.c._GetDefaultSideOrientation(U.sideOrientation),Q=U.instance,F=U.updatable;if(Q){const t=I.TmpVectors.DU[0].qX(Number.MAX_VALUE),y=I.TmpVectors.DU[1].qX(-Number.MAX_VALUE),P=U=>{let I=G[0].length;const Y=Q;let mt=0;const X=Y._originalBuilderSideOrientation===r.c.DOUBLESIDE?2:1;for(let r=1;r<=X;++r)for(let X=0;X<G.length;++X){const r=G[X],P=r.length;I=I<P?I:P;for(let Y=0;Y<I;++Y){const I=r[Y];U[mt]=I.x,U[mt+1]=I.y,U[mt+2]=I.z,t.minimizeInPlaceFromFloats(I.x,I.y,I.z),y.maximizeInPlaceFromFloats(I.x,I.y,I.z),mt+=3}if(Y._creationDataStorage&&Y._creationDataStorage.closePath){const t=r[0];U[mt]=t.x,U[mt+1]=t.y,U[mt+2]=t.z,mt+=3}}},M=Q.getVerticesData(Y.e.PositionKind);if(P(M),Q.hasBoundingInfo?Q.getBoundingInfo().reConstruct(t,y,Q._worldMatrix):Q.buildBoundingInfo(t,y,Q._worldMatrix),Q.updateVerticesData(Y.e.PositionKind,M,!1,!1),U.dt){const t=Q.getVerticesData(Y.e.ColorKind);for(let y=0,I=0;y<U.dt.length;y++,I+=4){const r=U.dt[y];t[I]=r.r,t[I+1]=r.g,t[I+2]=r.b,t[I+3]=r.a}Q.updateVerticesData(Y.e.ColorKind,t,!1,!1)}if(U.qt){const t=Q.getVerticesData(Y.e.UVKind);for(let y=0;y<U.qt.length;y++)t[2*y]=U.qt[y].x,t[2*y+1]=X.e?1-U.qt[y].y:U.qt[y].y;Q.updateVerticesData(Y.e.UVKind,t,!1,!1)}if(!Q.areNormalsFrozen||Q.isFacetDataEnabled){const t=Q.jX(),U=Q.getVerticesData(Y.e.NormalKind),y=Q.isFacetDataEnabled?Q.getFacetDataParameters():null;if(mt.b.ComputeNormals(M,t,U,y),Q._creationDataStorage&&Q._creationDataStorage.closePath){let t=0,y=0;for(let I=0;I<G.length;I++)t=3*Q._creationDataStorage.idx[I],y=I+1<G.length?3*(Q._creationDataStorage.idx[I+1]-1):U.length-3,U[t]=.5*(U[t]+U[y]),U[t+1]=.5*(U[t+1]+U[y+1]),U[t+2]=.5*(U[t+2]+U[y+2]),U[y]=U[t],U[y+1]=U[t+1],U[y+2]=U[t+2]}Q.areNormalsFrozen||Q.updateVerticesData(Y.e.NormalKind,U,!1,!1)}return Q}{const I=new r.c(t,y);I._originalBuilderSideOrientation=h,I._creationDataStorage=new r.d;const Y=P(U);return L&&(I._creationDataStorage.idx=Y._idx),I._creationDataStorage.closePath=L,I._creationDataStorage.closeArray=M,Y.et(I,F),I}}mt.b.CreateRibbon=P,r.c.CreateRibbon=function(t,U){return G(t,{pathArray:U,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var M=y(13537),L=y(13388),h=y(12442);function Q(t){const U=t.pattern||r.c.NO_FLIP,y=t.tileWidth||t.tileSize||1,I=t.tileHeight||t.tileSize||1,Y=t.alignHorizontal||0,X=t.alignVertical||0,P=t.width||t.size||1,G=Math.floor(P/y);let M=P-G*y;const L=t.height||t.size||1,h=Math.floor(L/I);let Q=L-h*I;const F=y*G/2,E=I*h/2;let w=0,D=0,l=0,g=0,B=0,b=0;if(M>0||Q>0){switch(l=-F,g=-E,B=F,b=E,Y){case r.c.CENTER:M/=2,l-=M,B+=M;break;case r.c.LEFT:B+=M,w=-M/2;break;case r.c.RIGHT:l-=M,w=M/2}switch(X){case r.c.CENTER:Q/=2,g-=Q,b+=Q;break;case r.c.BOTTOM:b+=Q,D=-Q/2;break;case r.c.TOP:g-=Q,D=Q/2}}const p=[],c=[],f=[];f[0]=[0,0,1,0,1,1,0,1],f[1]=[0,0,1,0,1,1,0,1],U!==r.c.ROTATE_TILE&&U!==r.c.ROTATE_ROW||(f[1]=[1,1,0,1,0,0,1,0]),U!==r.c.FLIP_TILE&&U!==r.c.FLIP_ROW||(f[1]=[1,0,0,0,0,1,1,1]),U!==r.c.FLIP_N_ROTATE_TILE&&U!==r.c.FLIP_N_ROTATE_ROW||(f[1]=[0,1,1,1,1,0,0,0]);let S=[];const N=[],j=[];let J=0;for(let mt=0;mt<h;mt++)for(let t=0;t<G;t++)p.push(t*y-F+w,mt*I-E+D,0),p.push((t+1)*y-F+w,mt*I-E+D,0),p.push((t+1)*y-F+w,(mt+1)*I-E+D,0),p.push(t*y-F+w,(mt+1)*I-E+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),S=U===r.c.FLIP_TILE||U===r.c.ROTATE_TILE||U===r.c.FLIP_N_ROTATE_TILE?S.concat(f[(t%2+mt%2)%2]):U===r.c.FLIP_ROW||U===r.c.ROTATE_ROW||U===r.c.FLIP_N_ROTATE_ROW?S.concat(f[mt%2]):S.concat(f[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),J+=4;if(M>0||Q>0){const t=Q>0&&(X===r.c.CENTER||X===r.c.TOP),mt=Q>0&&(X===r.c.CENTER||X===r.c.BOTTOM),P=M>0&&(Y===r.c.CENTER||Y===r.c.RIGHT),L=M>0&&(Y===r.c.CENTER||Y===r.c.LEFT);let f,a,d,q,H=[];if(t&&P&&(p.push(l+w,g+D,0),p.push(-F+w,g+D,0),p.push(-F+w,g+Q+D,0),p.push(l+w,g+Q+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,f=1-M/y,a=1-Q/I,d=1,q=1,H=[f,a,d,a,d,q,f,q],U===r.c.ROTATE_ROW&&(H=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),U===r.c.FLIP_ROW&&(H=[1-f,a,1-d,a,1-d,q,1-f,q]),U===r.c.FLIP_N_ROTATE_ROW&&(H=[f,1-a,d,1-a,d,1-q,f,1-q]),S=S.concat(H),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&L&&(p.push(F+w,g+D,0),p.push(B+w,g+D,0),p.push(B+w,g+Q+D,0),p.push(F+w,g+Q+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,f=0,a=1-Q/I,d=M/y,q=1,H=[f,a,d,a,d,q,f,q],(U===r.c.ROTATE_ROW||U===r.c.ROTATE_TILE&&G%2===0)&&(H=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),(U===r.c.FLIP_ROW||U===r.c.FLIP_TILE&&G%2===0)&&(H=[1-f,a,1-d,a,1-d,q,1-f,q]),(U===r.c.FLIP_N_ROTATE_ROW||U===r.c.FLIP_N_ROTATE_TILE&&G%2===0)&&(H=[f,1-a,d,1-a,d,1-q,f,1-q]),S=S.concat(H),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),mt&&P&&(p.push(l+w,E+D,0),p.push(-F+w,E+D,0),p.push(-F+w,b+D,0),p.push(l+w,b+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,f=1-M/y,a=0,d=1,q=Q/I,H=[f,a,d,a,d,q,f,q],(U===r.c.ROTATE_ROW&&h%2===1||U===r.c.ROTATE_TILE&&h%1===0)&&(H=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),(U===r.c.FLIP_ROW&&h%2===1||U===r.c.FLIP_TILE&&h%2===0)&&(H=[1-f,a,1-d,a,1-d,q,1-f,q]),(U===r.c.FLIP_N_ROTATE_ROW&&h%2===1||U===r.c.FLIP_N_ROTATE_TILE&&h%2===0)&&(H=[f,1-a,d,1-a,d,1-q,f,1-q]),S=S.concat(H),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),mt&&L&&(p.push(F+w,E+D,0),p.push(B+w,E+D,0),p.push(B+w,b+D,0),p.push(F+w,b+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,f=0,a=0,d=M/y,q=Q/I,H=[f,a,d,a,d,q,f,q],(U===r.c.ROTATE_ROW&&h%2===1||U===r.c.ROTATE_TILE&&(h+G)%2===1)&&(H=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),(U===r.c.FLIP_ROW&&h%2===1||U===r.c.FLIP_TILE&&(h+G)%2===1)&&(H=[1-f,a,1-d,a,1-d,q,1-f,q]),(U===r.c.FLIP_N_ROTATE_ROW&&h%2===1||U===r.c.FLIP_N_ROTATE_TILE&&(h+G)%2===1)&&(H=[f,1-a,d,1-a,d,1-q,f,1-q]),S=S.concat(H),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t){const t=[];f=0,a=1-Q/I,d=1,q=1,t[0]=[f,a,d,a,d,q,f,q],t[1]=[f,a,d,a,d,q,f,q],U!==r.c.ROTATE_TILE&&U!==r.c.ROTATE_ROW||(t[1]=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),U!==r.c.FLIP_TILE&&U!==r.c.FLIP_ROW||(t[1]=[1-f,a,1-d,a,1-d,q,1-f,q]),U!==r.c.FLIP_N_ROTATE_TILE&&U!==r.c.FLIP_N_ROTATE_ROW||(t[1]=[f,1-a,d,1-a,d,1-q,f,1-q]);for(let I=0;I<G;I++)p.push(I*y-F+w,g+D,0),p.push((I+1)*y-F+w,g+D,0),p.push((I+1)*y-F+w,g+Q+D,0),p.push(I*y-F+w,g+Q+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,S=U===r.c.FLIP_TILE||U===r.c.ROTATE_TILE||U===r.c.FLIP_N_ROTATE_TILE?S.concat(t[(I+1)%2]):U===r.c.FLIP_ROW||U===r.c.ROTATE_ROW||U===r.c.FLIP_N_ROTATE_ROW?S.concat(t[1]):S.concat(t[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(mt){const t=[];f=0,a=0,d=1,q=Q/I,t[0]=[f,a,d,a,d,q,f,q],t[1]=[f,a,d,a,d,q,f,q],U!==r.c.ROTATE_TILE&&U!==r.c.ROTATE_ROW||(t[1]=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),U!==r.c.FLIP_TILE&&U!==r.c.FLIP_ROW||(t[1]=[1-f,a,1-d,a,1-d,q,1-f,q]),U!==r.c.FLIP_N_ROTATE_TILE&&U!==r.c.FLIP_N_ROTATE_ROW||(t[1]=[f,1-a,d,1-a,d,1-q,f,1-q]);for(let I=0;I<G;I++)p.push(I*y-F+w,b-Q+D,0),p.push((I+1)*y-F+w,b-Q+D,0),p.push((I+1)*y-F+w,b+D,0),p.push(I*y-F+w,b+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,S=U===r.c.FLIP_TILE||U===r.c.ROTATE_TILE||U===r.c.FLIP_N_ROTATE_TILE?S.concat(t[(I+h)%2]):U===r.c.FLIP_ROW||U===r.c.ROTATE_ROW||U===r.c.FLIP_N_ROTATE_ROW?S.concat(t[h%2]):S.concat(t[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const t=[];f=1-M/y,a=0,d=1,q=1,t[0]=[f,a,d,a,d,q,f,q],t[1]=[f,a,d,a,d,q,f,q],U!==r.c.ROTATE_TILE&&U!==r.c.ROTATE_ROW||(t[1]=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),U!==r.c.FLIP_TILE&&U!==r.c.FLIP_ROW||(t[1]=[1-f,a,1-d,a,1-d,q,1-f,q]),U!==r.c.FLIP_N_ROTATE_TILE&&U!==r.c.FLIP_N_ROTATE_ROW||(t[1]=[f,1-a,d,1-a,d,1-q,f,1-q]);for(let y=0;y<h;y++)p.push(l+w,y*I-E+D,0),p.push(l+M+w,y*I-E+D,0),p.push(l+M+w,(y+1)*I-E+D,0),p.push(l+w,(y+1)*I-E+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,S=U===r.c.FLIP_TILE||U===r.c.ROTATE_TILE||U===r.c.FLIP_N_ROTATE_TILE?S.concat(t[(y+1)%2]):U===r.c.FLIP_ROW||U===r.c.ROTATE_ROW||U===r.c.FLIP_N_ROTATE_ROW?S.concat(t[y%2]):S.concat(t[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const t=[];f=0,a=0,d=M/I,q=1,t[0]=[f,a,d,a,d,q,f,q],t[1]=[f,a,d,a,d,q,f,q],U!==r.c.ROTATE_TILE&&U!==r.c.ROTATE_ROW||(t[1]=[1-f,1-a,1-d,1-a,1-d,1-q,1-f,1-q]),U!==r.c.FLIP_TILE&&U!==r.c.FLIP_ROW||(t[1]=[1-f,a,1-d,a,1-d,q,1-f,q]),U!==r.c.FLIP_N_ROTATE_TILE&&U!==r.c.FLIP_N_ROTATE_ROW||(t[1]=[f,1-a,d,1-a,d,1-q,f,1-q]);for(let y=0;y<h;y++)p.push(B-M+w,y*I-E+D,0),p.push(B+w,y*I-E+D,0),p.push(B+w,(y+1)*I-E+D,0),p.push(B-M+w,(y+1)*I-E+D,0),j.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,S=U===r.c.FLIP_TILE||U===r.c.ROTATE_TILE||U===r.c.FLIP_N_ROTATE_TILE?S.concat(t[(y+G)%2]):U===r.c.FLIP_ROW||U===r.c.ROTATE_ROW||U===r.c.FLIP_N_ROTATE_ROW?S.concat(t[y%2]):S.concat(t[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const a=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE;mt.b._ComputeSides(a,p,j,c,S,t.frontUVs,t.backUVs);const d=new mt.b;d.indices=j,d.jt=p,d.Jt=c,d.qt=S;const q=a===mt.b.DOUBLESIDE?N.concat(N):N;return d.dt=q,d}function F(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return Q(U).et(I,U.updatable),I}function E(t){const U=t.faceUV||new Array(6),y=t.faceColors,Y=t.pattern||r.c.NO_FLIP,P=t.width||t.size||1,G=t.height||t.size||1,M=t.depth||t.size||1,L=t.tileWidth||t.tileSize||1,F=t.tileHeight||t.tileSize||1,E=t.alignHorizontal||0,w=t.alignVertical||0,D=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE;for(let r=0;r<6;r++)void 0===U[r]&&(U[r]=new I.Vector4(0,0,1,1)),y&&void 0===y[r]&&(y[r]=new h.HX(1,1,1,1));const l=P/2,g=G/2,B=M/2,b=[];for(let I=0;I<2;I++)b[I]=Q({pattern:Y,tileWidth:L,tileHeight:F,width:P,height:G,alignVertical:w,alignHorizontal:E,sideOrientation:D});for(let I=2;I<4;I++)b[I]=Q({pattern:Y,tileWidth:L,tileHeight:F,width:M,height:G,alignVertical:w,alignHorizontal:E,sideOrientation:D});let p=w;w===r.c.BOTTOM?p=r.c.TOP:w===r.c.TOP&&(p=r.c.BOTTOM);for(let I=4;I<6;I++)b[I]=Q({pattern:Y,tileWidth:L,tileHeight:F,width:P,height:M,alignVertical:p,alignHorizontal:E,sideOrientation:D});let c=[],f=[],S=[],N=[];const j=[],J=[],a=[],d=[];let q=0,H=0;for(let r=0;r<6;r++){const t=b[r].jt.length;J[r]=[],a[r]=[];for(let U=0;U<t/3;U++)J[r].push(new I.DU(b[r].jt[3*U],b[r].jt[3*U+1],b[r].jt[3*U+2])),a[r].push(new I.DU(b[r].Jt[3*U],b[r].Jt[3*U+1],b[r].Jt[3*U+2]));q=b[r].qt.length,d[r]=[];for(let y=0;y<q;y+=2)d[r][y]=U[r].x+(U[r].z-U[r].x)*b[r].qt[y],d[r][y+1]=U[r].y+(U[r].w-U[r].y)*b[r].qt[y+1],X.e&&(d[r][y+1]=1-d[r][y+1]);if(S=S.concat(d[r]),N=N.concat(b[r].indices.map((t=>t+H))),H+=J[r].length,y)for(let U=0;U<4;U++)j.push(y[r].r,y[r].g,y[r].b,y[r].a)}const e=new I.DU(0,0,B),o=I.Matrix.RotationY(Math.PI);c=J[0].map((t=>I.DU.TransformNormal(t,o).add(e))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[]),f=a[0].map((t=>I.DU.TransformNormal(t,o))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[]),c=c.concat(J[1].map((t=>t.lU(e))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[])),f=f.concat(a[1].map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[]));const V=new I.DU(l,0,0),n=I.Matrix.RotationY(-Math.PI/2);c=c.concat(J[2].map((t=>I.DU.TransformNormal(t,n).add(V))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[])),f=f.concat(a[2].map((t=>I.DU.TransformNormal(t,n))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[]));const i=I.Matrix.RotationY(Math.PI/2);c=c.concat(J[3].map((t=>I.DU.TransformNormal(t,i).lU(V))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[])),f=f.concat(a[3].map((t=>I.DU.TransformNormal(t,i))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[]));const v=new I.DU(0,g,0),O=I.Matrix.RotationX(Math.PI/2);c=c.concat(J[4].map((t=>I.DU.TransformNormal(t,O).add(v))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[])),f=f.concat(a[4].map((t=>I.DU.TransformNormal(t,O))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[]));const k=I.Matrix.RotationX(-Math.PI/2);c=c.concat(J[5].map((t=>I.DU.TransformNormal(t,k).lU(v))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[])),f=f.concat(a[5].map((t=>I.DU.TransformNormal(t,k))).map((t=>[t.x,t.y,t.z])).reduce(((t,U)=>t.concat(U)),[])),mt.b._ComputeSides(D,c,N,f,S);const s=new mt.b;if(s.indices=N,s.jt=c,s.Jt=f,s.qt=S,y){const t=D===mt.b.DOUBLESIDE?j.concat(j):j;s.dt=t}return s}function w(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return E(U).et(I,U.updatable),I}mt.b.CreateTiledPlane=Q;mt.b.CreateTiledBox=E;var D=y(13527),l=y(12653),g=y(12612);function B(t){const U=t.height||2;let y=0===t.diameterTop?0:t.diameterTop||t.diameter||1,Y=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1;y=y||1e-5,Y=Y||1e-5;const P=0|(t.tessellation||24),G=0|(t.subdivisions||1),M=!!t.hasRings,L=!!t.enclose,Q=0===t.cap?0:t.cap||r.c.CAP_ALL,F=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,E=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,w=t.faceUV||new Array(3),D=t.faceColors,l=2+(1+(1!==F&&L?2:0))*(M?G:1);let B;for(B=0;B<l;B++)D&&void 0===D[B]&&(D[B]=new h.HX(1,1,1,1));for(B=0;B<l;B++)w&&void 0===w[B]&&(w[B]=new I.Vector4(0,0,1,1));const b=[],p=[],c=[],f=[],S=[],N=2*Math.PI*F/P;let j,J,a;const d=(Y-y)/2/U,q=I.DU.Zero(),H=I.DU.Zero(),e=I.DU.Zero(),o=I.DU.Zero(),V=I.DU.Zero(),n=g.d.Y;let i,v,O,k=1,s=1,x=0,Z=0;for(i=0;i<=G;i++)for(J=i/G,a=(J*(y-Y)+Y)/2,k=M&&0!==i&&i!==G?2:1,O=0;O<k;O++){for(M&&(s+=O),L&&(s+=2*O),v=0;v<=P;v++)j=v*N,q.x=Math.cos(-j)*a,q.y=-U/2+J*U,q.z=Math.sin(-j)*a,0===y&&i===G?(H.x=c[c.length-3*(P+1)],H.y=c[c.length-3*(P+1)+1],H.z=c[c.length-3*(P+1)+2]):(H.x=q.x,H.z=q.z,H.y=Math.sqrt(H.x*H.x+H.z*H.z)*d,H.normalize()),0===v&&(e.Y(q),o.Y(H)),p.push(q.x,q.y,q.z),c.push(H.x,H.y,H.z),Z=M?x!==s?w[s].y:w[s].w:w[s].y+(w[s].w-w[s].y)*J,f.push(w[s].x+(w[s].z-w[s].x)*v/P,X.e?1-Z:Z),D&&S.push(D[s].r,D[s].g,D[s].b,D[s].a);1!==F&&L&&(p.push(q.x,q.y,q.z),p.push(0,q.y,0),p.push(0,q.y,0),p.push(e.x,e.y,e.z),I.DU.CrossToRef(n,H,V),V.normalize(),c.push(V.x,V.y,V.z,V.x,V.y,V.z),I.DU.CrossToRef(o,n,V),V.normalize(),c.push(V.x,V.y,V.z,V.x,V.y,V.z),Z=M?x!==s?w[s+1].y:w[s+1].w:w[s+1].y+(w[s+1].w-w[s+1].y)*J,f.push(w[s+1].x,X.e?1-Z:Z),f.push(w[s+1].z,X.e?1-Z:Z),Z=M?x!==s?w[s+2].y:w[s+2].w:w[s+2].y+(w[s+2].w-w[s+2].y)*J,f.push(w[s+2].x,X.e?1-Z:Z),f.push(w[s+2].z,X.e?1-Z:Z),D&&(S.push(D[s+1].r,D[s+1].g,D[s+1].b,D[s+1].a),S.push(D[s+1].r,D[s+1].g,D[s+1].b,D[s+1].a),S.push(D[s+2].r,D[s+2].g,D[s+2].b,D[s+2].a),S.push(D[s+2].r,D[s+2].g,D[s+2].b,D[s+2].a))),x!==s&&(x=s)}const W=1!==F&&L?P+4:P;for(i=0,s=0;s<G;s++){let t=0,U=0,y=0,I=0;for(v=0;v<P;v++)t=i*(W+1)+v,U=(i+1)*(W+1)+v,y=i*(W+1)+(v+1),I=(i+1)*(W+1)+(v+1),b.push(t,U,y),b.push(I,y,U);1!==F&&L&&(b.push(t+2,U+2,y+2),b.push(I+2,y+2,U+2),b.push(t+4,U+4,y+4),b.push(I+4,y+4,U+4)),i=M?i+2:i+1}const A=t=>{const r=t?y/2:Y/2;if(0===r)return;let mt,G,M;const L=t?w[l-1]:w[0];let h=null;D&&(h=t?D[l-1]:D[0]);const Q=p.length/3,E=t?U/2:-U/2,g=new I.DU(0,E,0);p.push(g.x,g.y,g.z),c.push(0,t?1:-1,0);const B=L.y+.5*(L.w-L.y);f.push(L.x+.5*(L.z-L.x),X.e?1-B:B),h&&S.push(h.r,h.g,h.b,h.a);const N=new I.Vector2(.5,.5);for(M=0;M<=P;M++){mt=2*Math.PI*M*F/P;const U=Math.cos(-mt),y=Math.sin(-mt);G=new I.DU(U*r,E,y*r);const Y=new I.Vector2(U*N.x+.5,y*N.y+.5);p.push(G.x,G.y,G.z),c.push(0,t?1:-1,0);const Q=L.y+(L.w-L.y)*Y.y;f.push(L.x+(L.z-L.x)*Y.x,X.e?1-Q:Q),h&&S.push(h.r,h.g,h.b,h.a)}for(M=0;M<P;M++)t?(b.push(Q),b.push(Q+(M+2)),b.push(Q+(M+1))):(b.push(Q),b.push(Q+(M+1)),b.push(Q+(M+2)))};Q!==r.c.CAP_START&&Q!==r.c.CAP_ALL||A(!1),Q!==r.c.CAP_END&&Q!==r.c.CAP_ALL||A(!0),mt.b._ComputeSides(E,p,b,c,f,t.frontUVs,t.backUVs);const K=new mt.b;return K.indices=b,K.jt=p,K.Jt=c,K.qt=f,D&&(K.dt=S),K}function b(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return B(U).et(I,U.updatable),I}function p(t){const U=[],y=[],r=[],Y=[],P=t.diameter||1,G=t.thickness||.5,M=0|(t.tessellation||16),L=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,h=M+1;for(let mt=0;mt<=M;mt++){const t=mt/M,L=mt*Math.PI*2/M-Math.PI/2,Q=I.Matrix.Translation(P/2,0,0).multiply(I.Matrix.RotationY(L));for(let P=0;P<=M;P++){const L=1-P/M,F=P*Math.PI*2/M+Math.PI,E=Math.cos(F),w=Math.sin(F);let D=new I.DU(E,w,0),l=D.scale(G/2);const g=new I.Vector2(t,L);l=I.DU.TransformCoordinates(l,Q),D=I.DU.TransformNormal(D,Q),y.push(l.x,l.y,l.z),r.push(D.x,D.y,D.z),Y.push(g.x,X.e?1-g.y:g.y);const B=(mt+1)%h,b=(P+1)%h;U.push(mt*h+P),U.push(mt*h+b),U.push(B*h+P),U.push(mt*h+b),U.push(B*h+b),U.push(B*h+P)}}mt.b._ComputeSides(L,y,U,r,Y,t.frontUVs,t.backUVs);const Q=new mt.b;return Q.indices=U,Q.jt=y,Q.Jt=r,Q.qt=Y,Q}function c(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return p(U).et(I,U.updatable),I}mt.b.CreateCylinder=B,r.c.CreateCylinder=(t,U,y,I,Y,mt,X,P,G)=>{void 0!==X&&X instanceof l.e||(void 0!==X&&(G=P||r.c.DEFAULTSIDE,P=X),X=mt,mt=1);return b(t,{height:U,diameterTop:y,diameterBottom:I,tessellation:Y,subdivisions:mt,sideOrientation:G,updatable:P},X)};function f(t){const U=[],y=[],r=[],Y=[],P=t.radius||2,G=t.tube||.5,M=t.radialSegments||32,L=t.tubularSegments||32,h=t.p||2,Q=t.q||3,F=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,E=t=>{const U=Math.cos(t),y=Math.sin(t),r=Q/h*t,Y=Math.cos(r),mt=P*(2+Y)*.5*U,X=P*(2+Y)*y*.5,G=P*Math.sin(r)*.5;return new I.DU(mt,X,G)};let w,D;for(w=0;w<=M;w++){const t=w%M/M*2*h*Math.PI,U=E(t),r=E(t+.01),mt=r.lU(U);let P=r.add(U);const Q=I.DU.Cross(mt,P);for(P=I.DU.Cross(Q,mt),Q.normalize(),P.normalize(),D=0;D<L;D++){const t=D%L/L*2*Math.PI,I=-G*Math.cos(t),r=G*Math.sin(t);y.push(U.x+I*P.x+r*Q.x),y.push(U.y+I*P.y+r*Q.y),y.push(U.z+I*P.z+r*Q.z),Y.push(w/M),Y.push(X.e?1-D/L:D/L)}}for(w=0;w<M;w++)for(D=0;D<L;D++){const t=(D+1)%L,y=w*L+D,I=(w+1)*L+D,r=(w+1)*L+t,Y=w*L+t;U.push(Y),U.push(I),U.push(y),U.push(Y),U.push(r),U.push(I)}mt.b.ComputeNormals(y,U,r),mt.b._ComputeSides(F,y,U,r,Y,t.frontUVs,t.backUVs);const l=new mt.b;return l.indices=U,l.jt=y,l.Jt=r,l.qt=Y,l}function S(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return f(U).et(I,U.updatable),I}mt.b.CreateTorus=p,r.c.CreateTorus=(t,U,y,I,r,Y,mt)=>c(t,{diameter:U,thickness:y,tessellation:I,sideOrientation:mt,updatable:Y},r);mt.b.CreateTorusKnot=f,r.c.CreateTorusKnot=(t,U,y,I,r,Y,mt,X,P,G)=>S(t,{radius:U,tube:y,radialSegments:I,tubularSegments:r,p:Y,q:mt,sideOrientation:G,updatable:P},X);var N=y(14043),j=y(12993),J=y(12623);function a(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=U.path,Y=U.shape,mt=U.scale||1,X=U.rotation||0,P=0===U.cap?0:U.cap||r.c.NO_CAP,G=U.updatable,M=r.c._GetDefaultSideOrientation(U.sideOrientation),L=U.instance||null,h=U.invertUV||!1,Q=U.closeShape||!1,F=U.closePath||!1,E=U.capFunction||null;return q(t,Y,I,mt,X,null,null,F,Q,P,!1,y,!!G,M,L,h,U.frontUVs||null,U.backUVs||null,U.firstNormal||null,!!U.adjustFrame,E)}function d(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=U.path,Y=U.shape,mt=U.scaleFunction||(()=>1),X=U.rotationFunction||(()=>0),P=U.closePath||U.ribbonCloseArray||!1,G=U.closeShape||U.ribbonClosePath||!1,M=0===U.cap?0:U.cap||r.c.NO_CAP,L=U.updatable,h=U.firstNormal||null,Q=U.adjustFrame||!1,F=r.c._GetDefaultSideOrientation(U.sideOrientation),E=U.instance,w=U.invertUV||!1,D=U.capFunction||null;return q(t,Y,I,null,null,mt,X,P,G,M,!0,y,!!L,F,E||null,w,U.frontUVs||null,U.backUVs||null,h,Q,D||null)}function q(t,U,y,Y,mt,X,P,M,L,h,Q,F,E,w,D,l,g,B,b,p,c){const f=(t,U,y,Y,mt,X,P,G,M,L,h)=>{const Q=y.getTangents(),F=y.getNormals(),E=y.getBinormals(),w=y.getDistances();if(h)for(let r=0;r<Q.length;r++)if(0==Q[r].x&&0==Q[r].y&&0==Q[r].z&&Q[r].Y(Q[r-1]),0==F[r].x&&0==F[r].y&&0==F[r].z&&F[r].Y(F[r-1]),0==E[r].x&&0==E[r].y&&0==E[r].z&&E[r].Y(E[r-1]),r>0){let t=Q[r-1];I.DU.Dot(t,Q[r])<0&&Q[r].scaleInPlace(-1),t=F[r-1],I.DU.Dot(t,F[r])<0&&F[r].scaleInPlace(-1),t=E[r-1],I.DU.Dot(t,E[r])<0&&E[r].scaleInPlace(-1)}let D=0;const l=L&&G?G:()=>null!==X?X:0,g=L&&P?P:()=>null!==mt?mt:1;let B=M===r.c.NO_CAP||M===r.c.CAP_END?0:2;const b=I.TmpVectors.Matrix[0];for(let r=0;r<U.length;r++){const y=[],mt=l(r,w[r]),X=g(r,w[r]);I.Matrix.RotationAxisToRef(Q[r],D,b);for(let Y=0;Y<t.length;Y++){const mt=Q[r].scale(t[Y].z).add(F[r].scale(t[Y].x)).add(E[r].scale(t[Y].y)),P=I.DU.Zero();I.DU.TransformCoordinatesToRef(mt,b,P),P.scaleInPlace(X).addInPlace(U[r]),y[Y]=P}Y[B]=y,D+=mt,B++}const p=c||(t=>{const U=Array(),y=I.DU.Zero();let r;for(r=0;r<t.length;r++)y.addInPlace(t[r]);for(y.scaleInPlace(1/t.length),r=0;r<t.length;r++)U.push(y);return U});switch(M){case r.c.NO_CAP:break;case r.c.CAP_START:Y[0]=p(Y[2]),Y[1]=Y[2];break;case r.c.CAP_END:Y[B]=Y[B-1],Y[B+1]=p(Y[B-1]);break;case r.c.CAP_ALL:Y[0]=p(Y[2]),Y[1]=Y[2],Y[B]=Y[B-1],Y[B+1]=p(Y[B-1])}return Y};let S,N;if(D){const t=D._creationDataStorage;return S=b?t.path3D.update(y,b):t.path3D.update(y),N=f(U,y,t.path3D,t.pathArray,Y,mt,X,P,t.cap,Q,p),D=G("",{pathArray:N,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:D},F||void 0)}S=b?new J.k(y,b):new J.k(y);N=f(U,y,S,new Array,Y,mt,X,P,h=h<0||h>3?0:h,Q,p);const j=G(t,{pathArray:N,closeArray:M,closePath:L,updatable:E,sideOrientation:w,invertUV:l,frontUVs:g||void 0,backUVs:B||void 0},F);return j._creationDataStorage.pathArray=N,j._creationDataStorage.path3D=S,j._creationDataStorage.cap=h,j}function H(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=U.arc?U.arc<=0||U.arc>1?1:U.arc:1,mt=void 0===U.closed||U.closed,X=U.shape,P=U.radius||1,M=U.tessellation||64,L=U.clip||0,h=U.updatable,Q=r.c._GetDefaultSideOrientation(U.sideOrientation),F=U.cap||r.c.NO_CAP,E=2*Math.PI,w=[],D=U.invertUV||!1;let l=0,g=0;const B=E/M*Y;let b,p;for(l=0;l<=M-L;l++){for(p=[],F!=r.c.CAP_START&&F!=r.c.CAP_ALL||(p.push(new I.DU(0,X[0].y,0)),p.push(new I.DU(Math.cos(l*B)*X[0].x*P,X[0].y,Math.sin(l*B)*X[0].x*P))),g=0;g<X.length;g++)b=new I.DU(Math.cos(l*B)*X[g].x*P,X[g].y,Math.sin(l*B)*X[g].x*P),p.push(b);F!=r.c.CAP_END&&F!=r.c.CAP_ALL||(p.push(new I.DU(Math.cos(l*B)*X[X.length-1].x*P,X[X.length-1].y,Math.sin(l*B)*X[X.length-1].x*P)),p.push(new I.DU(0,X[X.length-1].y,0))),w.push(p)}return G(t,{pathArray:w,closeArray:mt,sideOrientation:Q,updatable:h,invertUV:D,frontUVs:U.frontUVs,backUVs:U.backUVs},y)}r.c.ExtrudeShape=function(t,U,y,I,Y,mt){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7?arguments[7]:void 0,G=arguments.length>8?arguments[8]:void 0,M=arguments.length>9?arguments[9]:void 0;return a(t,{shape:U,path:y,scale:I,rotation:Y,cap:0===mt?0:mt||r.c.NO_CAP,sideOrientation:G,instance:M,updatable:P},X)},r.c.ExtrudeShapeCustom=(t,U,y,I,Y,mt,X,P,G,M,L,h)=>d(t,{shape:U,path:y,scaleFunction:I,rotationFunction:Y,ribbonCloseArray:mt,ribbonClosePath:X,cap:0===P?0:P||r.c.NO_CAP,sideOrientation:L,instance:h,updatable:M},G);r.c.CreateLathe=(t,U,y,I,r,Y,mt)=>H(t,{shape:U,radius:y,tessellation:I,sideOrientation:mt,updatable:Y},r);var e=y(13437),o=y(13394);function V(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=U.path;let mt=U.instance,X=1;void 0!==U.radius?X=U.radius:mt&&(X=mt._creationDataStorage.radius);const P=U.tessellation||64,M=U.radiusFunction||null;let L=U.cap||r.c.NO_CAP;const h=U.invertUV||!1,Q=U.updatable,F=r.c._GetDefaultSideOrientation(U.sideOrientation);U.arc=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1;const E=(t,U,y,Y,mt,X,P,G)=>{const M=U.getTangents(),L=U.getNormals(),h=U.getDistances(),Q=2*Math.PI/mt*G,F=X||(()=>Y);let E,w,D,l;const g=I.TmpVectors.Matrix[0];let B=P===r.c.NO_CAP||P===r.c.CAP_END?0:2;for(let r=0;r<t.length;r++){w=F(r,h[r]),E=Array(),D=L[r];for(let U=0;U<mt;U++)I.Matrix.RotationAxisToRef(M[r],Q*U,g),l=E[U]?E[U]:I.DU.Zero(),I.DU.TransformCoordinatesToRef(D,g,l),l.scaleInPlace(w).addInPlace(t[r]),E[U]=l;y[B]=E,B++}const b=(U,y)=>{const I=Array();for(let r=0;r<U;r++)I.push(t[y]);return I};switch(P){case r.c.NO_CAP:break;case r.c.CAP_START:y[0]=b(mt,0),y[1]=y[2].slice(0);break;case r.c.CAP_END:y[B]=y[B-1].slice(0),y[B+1]=b(mt,t.length-1);break;case r.c.CAP_ALL:y[0]=b(mt,0),y[1]=y[2].slice(0),y[B]=y[B-1].slice(0),y[B+1]=b(mt,t.length-1)}return y};let w,D;if(mt){const t=mt._creationDataStorage,y=U.arc||t.arc;return w=t.path3D.update(Y),D=E(Y,w,t.pathArray,X,t.tessellation,M,t.cap,y),mt=G("",{pathArray:D,instance:mt}),t.path3D=w,t.pathArray=D,t.arc=y,t.radius=X,mt}w=new J.k(Y);L=L<0||L>3?0:L,D=E(Y,w,new Array,X,P,M,L,U.arc);const l=G(t,{pathArray:D,closePath:!0,closeArray:!1,updatable:Q,sideOrientation:F,invertUV:h,frontUVs:U.frontUVs,backUVs:U.backUVs},y);return l._creationDataStorage.pathArray=D,l._creationDataStorage.path3D=w,l._creationDataStorage.tessellation=P,l._creationDataStorage.cap=L,l._creationDataStorage.arc=U.arc,l._creationDataStorage.radius=X,l}function n(t){const U=[];U[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},U[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},U[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},U[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},U[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},U[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},U[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},U[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},U[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},U[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},U[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},U[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},U[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},U[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},U[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const y=t.type&&(t.type<0||t.type>=U.length)?0:t.type||0,r=t.size,Y=t.sizeX||r||1,P=t.sizeY||r||1,G=t.sizeZ||r||1,M=t.custom||U[y],L=M.face.length,Q=t.faceUV||new Array(L),F=t.faceColors,E=void 0===t.flat||t.flat,w=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,D=[],l=[],g=[],B=[],b=[];let p=0,c=0;const f=[];let S,N,j,J,a,d,q=0,H=0;if(E)for(H=0;H<L;H++)F&&void 0===F[H]&&(F[H]=new h.HX(1,1,1,1)),Q&&void 0===Q[H]&&(Q[H]=new I.Vector4(0,0,1,1));if(E)for(H=0;H<L;H++){const t=M.face[H].length;for(j=2*Math.PI/t,J=.5*Math.tan(j/2),a=.5,q=0;q<t;q++)D.push(M.vertex[M.face[H][q]][0]*Y,M.vertex[M.face[H][q]][1]*P,M.vertex[M.face[H][q]][2]*G),f.push(p),p++,S=Q[H].x+(Q[H].z-Q[H].x)*(.5+J),N=Q[H].y+(Q[H].w-Q[H].y)*(a-.5),B.push(S,X.e?1-N:N),d=J*Math.cos(j)-a*Math.sin(j),a=J*Math.sin(j)+a*Math.cos(j),J=d,F&&b.push(F[H].r,F[H].g,F[H].b,F[H].a);for(q=0;q<t-2;q++)l.push(f[0+c],f[q+2+c],f[q+1+c]);c+=t}else{for(q=0;q<M.vertex.length;q++)D.push(M.vertex[q][0]*Y,M.vertex[q][1]*P,M.vertex[q][2]*G),B.push(0,X.e?1:0);for(H=0;H<L;H++)for(q=0;q<M.face[H].length-2;q++)l.push(M.face[H][0],M.face[H][q+2],M.face[H][q+1])}mt.b.ComputeNormals(D,l,g),mt.b._ComputeSides(w,D,l,g,B,t.frontUVs,t.backUVs);const e=new mt.b;return e.jt=D,e.indices=l,e.Jt=g,e.qt=B,F&&E&&(e.dt=b),e}function i(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return n(U).et(I,U.updatable),I}r.c.CreateTube=(t,U,y,I,r,Y,mt,X,P,G)=>V(t,{path:U,radius:y,tessellation:I,radiusFunction:r,arc:1,cap:Y,updatable:X,sideOrientation:P,instance:G},mt);function v(t){const U=t.sideOrientation||mt.b.DEFAULTSIDE,y=t.radius||1,r=void 0===t.flat||t.flat,Y=0|(t.subdivisions||4),P=t.radiusX||y,G=t.radiusY||y,M=t.radiusZ||y,L=(1+Math.sqrt(5))/2,h=[-1,L,-0,1,L,0,-1,-L,0,1,-L,0,0,-1,-L,0,1,-L,0,-1,L,0,1,L,L,0,1,L,0,-1,-L,0,1,-L,0,-1],Q=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],F=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],w=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],D=[],l=[],g=[],B=[];let b=0;const p=new Array(3),c=new Array(3);let f;for(f=0;f<3;f++)p[f]=I.DU.Zero(),c[f]=I.Vector2.Zero();for(let mt=0;mt<20;mt++){for(f=0;f<3;f++){const t=Q[3*mt+f];p[f].aX(h[3*F[t]],h[3*F[t]+1],h[3*F[t]+2]),p[f].normalize(),c[f].aX(.134765625*E[2*t]+.05859375+-.0390625*w[mt],.2333984375*E[2*t+1]+.025390625+.01953125*w[mt])}const t=(t,U,y,mt)=>{const L=I.DU.Lerp(p[0],p[2],U/Y),h=I.DU.Lerp(p[1],p[2],U/Y),Q=Y===U?p[2]:I.DU.Lerp(L,h,t/(Y-U));let F;if(Q.normalize(),r){const t=I.DU.Lerp(p[0],p[2],mt/Y),U=I.DU.Lerp(p[1],p[2],mt/Y);F=I.DU.Lerp(t,U,y/(Y-mt))}else F=new I.DU(Q.x,Q.y,Q.z);F.x/=P,F.y/=G,F.z/=M,F.normalize();const E=I.Vector2.Lerp(c[0],c[2],U/Y),w=I.Vector2.Lerp(c[1],c[2],U/Y),f=Y===U?c[2]:I.Vector2.Lerp(E,w,t/(Y-U));l.push(Q.x*P,Q.y*G,Q.z*M),g.push(F.x,F.y,F.z),B.push(f.x,X.e?1-f.y:f.y),D.push(b),b++};for(let U=0;U<Y;U++)for(let y=0;y+U<Y;y++)t(y,U,y+1/3,U+1/3),t(y+1,U,y+1/3,U+1/3),t(y,U+1,y+1/3,U+1/3),y+U+1<Y&&(t(y+1,U,y+2/3,U+2/3),t(y+1,U+1,y+2/3,U+2/3),t(y,U+1,y+2/3,U+2/3))}mt.b._ComputeSides(U,l,D,g,B,t.frontUVs,t.backUVs);const S=new mt.b;return S.indices=D,S.jt=l,S.Jt=g,S.qt=B,S}function O(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),I._originalBuilderSideOrientation=U.sideOrientation;return v(U).et(I,U.updatable),I}mt.b.CreatePolyhedron=n,r.c.CreatePolyhedron=(t,U,y)=>i(t,U,y);mt.b.CreateIcoSphere=v,r.c.CreateIcoSphere=(t,U,y)=>O(t,U,y);var k=y(12404);const s=new I.DU(1,0,0),x=new I.DU(-1,0,0),Z=new I.DU(0,1,0),W=new I.DU(0,-1,0),A=new I.DU(0,0,1),K=new I.DU(0,0,-1);class C{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.DU.Zero(),U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.DU.Up(),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I.Vector2.Zero(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,mt=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=t,this.normal=U,this.uv=y,this.vertexIdx=r,this.vertexIdxForBones=Y,this.localPositionOverride=mt,this.localNormalOverride=X,this.matrixIndicesOverride=P,this.matrixWeightsOverride=G}clone(){var t,U,y,I;return new C(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(t=this.localPositionOverride)||void 0===t?void 0:t.slice(),null===(U=this.localNormalOverride)||void 0===U?void 0:U.slice(),null===(y=this.matrixIndicesOverride)||void 0===y?void 0:y.slice(),null===(I=this.matrixWeightsOverride)||void 0===I?void 0:I.slice())}}function R(t,U,y){var P,G,M,L,h;const Q=!!U.skeleton,F=!(null===(P=U.morphTargetManager)||void 0===P||!P.numTargets),E=y.localMode||Q,w=U.jX(),D=Q||F?U.WX(!0,!0):U.getVerticesData(Y.e.PositionKind),l=Q||F?U.getNormalsData(!0,!0):U.getVerticesData(Y.e.NormalKind),g=E?Q?U.getVerticesData(Y.e.PositionKind):D:null,B=E?Q?U.getVerticesData(Y.e.NormalKind):l:null,b=U.getVerticesData(Y.e.UVKind),p=Q?U.getVerticesData(Y.e.MatricesIndicesKind):null,c=Q?U.getVerticesData(Y.e.MatricesWeightsKind):null,f=Q?U.getVerticesData(Y.e.MatricesIndicesExtraKind):null,S=Q?U.getVerticesData(Y.e.MatricesWeightsExtraKind):null,N=y.position||I.DU.Zero();let j=y.normal||I.DU.Up();const J=y.size||I.DU.One(),a=y.angle||0;if(!j){const t=new I.DU(0,0,1),y=U.St().activeCamera,r=I.DU.TransformCoordinates(t,y.getWorldMatrix());j=y.globalPosition.lU(r)}const d=-Math.atan2(j.z,j.x)-Math.PI/2,q=Math.sqrt(j.x*j.x+j.z*j.z),H=Math.atan2(j.y,q),e=new mt.b;e.indices=[],e.jt=[],e.Jt=[],e.qt=[],e.matricesIndices=Q?[]:null,e.matricesWeights=Q?[]:null,e.matricesIndicesExtra=f?[]:null,e.matricesWeightsExtra=S?[]:null;let o=0;const V=(t,U)=>{const r=new C;if(!w||!D||!l)return r;const Y=w[t];if(r.vertexIdx=3*Y,r.vertexIdxForBones=4*Y,r.position=new I.DU(D[3*Y],D[3*Y+1],D[3*Y+2]),I.DU.TransformCoordinatesToRef(r.position,U,r.position),r.normal=new I.DU(l[3*Y],l[3*Y+1],l[3*Y+2]),I.DU.TransformNormalToRef(r.normal,U,r.normal),y.captureUVS&&b){const t=b[2*Y+1];r.uv=new I.Vector2(b[2*Y],X.e?1-t:t)}return r},n=[0,0,0,0],i=(t,U)=>{if(0===t.length)return t;const y=.5*Math.abs(I.DU.Dot(J,U)),r=(t,U,y,I)=>{for(let r=0;r<I;++r)if(t[y+r]===U)return y+r;return-1},Y=(t,Y)=>{const mt=I.DU.GetClipFactor(t.position,Y.position,U,y);let X=n,P=n;if(p&&c){const U=t.matrixIndicesOverride?0:t.vertexIdxForBones,y=t.matrixIndicesOverride??p,I=t.matrixWeightsOverride??c,G=Y.matrixIndicesOverride?0:Y.vertexIdxForBones,M=Y.matrixIndicesOverride??p,L=Y.matrixWeightsOverride??c;X=[0,0,0,0],P=[0,0,0,0];let h=0;for(let t=0;t<4;++t)if(I[U+t]>0){const Y=r(M,y[U+t],G,4);X[h]=y[U+t],P[h]=(0,k.Lerp)(I[U+t],Y>=0?L[Y]:0,mt),h++}for(let t=0;t<4&&h<4;++t){const I=M[G+t];-1===r(y,I,U,4)&&(X[h]=I,P[h]=(0,k.Lerp)(0,L[G+t],mt),h++)}const Q=P[0]+P[1]+P[2]+P[3];P[0]/=Q,P[1]/=Q,P[2]/=Q,P[3]/=Q}const G=t.localPositionOverride?t.localPositionOverride[0]:(null===g||void 0===g?void 0:g[t.vertexIdx])??0,M=t.localPositionOverride?t.localPositionOverride[1]:(null===g||void 0===g?void 0:g[t.vertexIdx+1])??0,L=t.localPositionOverride?t.localPositionOverride[2]:(null===g||void 0===g?void 0:g[t.vertexIdx+2])??0,h=Y.localPositionOverride?Y.localPositionOverride[0]:(null===g||void 0===g?void 0:g[Y.vertexIdx])??0,Q=Y.localPositionOverride?Y.localPositionOverride[1]:(null===g||void 0===g?void 0:g[Y.vertexIdx+1])??0,F=Y.localPositionOverride?Y.localPositionOverride[2]:(null===g||void 0===g?void 0:g[Y.vertexIdx+2])??0,E=t.localNormalOverride?t.localNormalOverride[0]:(null===B||void 0===B?void 0:B[t.vertexIdx])??0,w=t.localNormalOverride?t.localNormalOverride[1]:(null===B||void 0===B?void 0:B[t.vertexIdx+1])??0,D=t.localNormalOverride?t.localNormalOverride[2]:(null===B||void 0===B?void 0:B[t.vertexIdx+2])??0,l=E+((Y.localNormalOverride?Y.localNormalOverride[0]:(null===B||void 0===B?void 0:B[Y.vertexIdx])??0)-E)*mt,b=w+((Y.localNormalOverride?Y.localNormalOverride[1]:(null===B||void 0===B?void 0:B[Y.vertexIdx+1])??0)-w)*mt,f=D+((Y.localNormalOverride?Y.localNormalOverride[2]:(null===B||void 0===B?void 0:B[Y.vertexIdx+2])??0)-D)*mt,S=Math.sqrt(l*l+b*b+f*f);return new C(I.DU.Lerp(t.position,Y.position,mt),I.DU.Lerp(t.normal,Y.normal,mt).normalize(),I.Vector2.Lerp(t.uv,Y.uv,mt),-1,-1,g?[G+(h-G)*mt,M+(Q-M)*mt,L+(F-L)*mt]:null,B?[l/S,b/S,f/S]:null,X,P)};let mt=null;t.length>3&&(mt=[]);for(let X=0;X<t.length;X+=3){let r=0,P=null,G=null,M=null,L=null;const h=I.DU.Dot(t[X].position,U)-y>0,Q=I.DU.Dot(t[X+1].position,U)-y>0,F=I.DU.Dot(t[X+2].position,U)-y>0;switch(r=(h?1:0)+(Q?1:0)+(F?1:0),r){case 0:t.length>3?(mt.push(t[X]),mt.push(t[X+1]),mt.push(t[X+2])):mt=t;break;case 1:if(mt=mt??new Array,h&&(P=t[X+1],G=t[X+2],M=Y(t[X],P),L=Y(t[X],G)),Q){P=t[X],G=t[X+2],M=Y(t[X+1],P),L=Y(t[X+1],G),mt.push(M),mt.push(G.clone()),mt.push(P.clone()),mt.push(G.clone()),mt.push(M.clone()),mt.push(L);break}F&&(P=t[X],G=t[X+1],M=Y(t[X+2],P),L=Y(t[X+2],G)),P&&G&&M&&L&&(mt.push(P.clone()),mt.push(G.clone()),mt.push(M),mt.push(L),mt.push(M.clone()),mt.push(G.clone()));break;case 2:mt=mt??new Array,h||(P=t[X].clone(),G=Y(P,t[X+1]),M=Y(P,t[X+2]),mt.push(P),mt.push(G),mt.push(M)),Q||(P=t[X+1].clone(),G=Y(P,t[X+2]),M=Y(P,t[X]),mt.push(P),mt.push(G),mt.push(M)),F||(P=t[X+2].clone(),G=Y(P,t[X]),M=Y(P,t[X+1]),mt.push(P),mt.push(G),mt.push(M))}}return mt},v=U instanceof r.c?U:null,O=null===v||void 0===v?void 0:v._thinInstanceDataStorage.matrixData,R=(null===v||void 0===v?void 0:v.oX)||1,u=I.TmpVectors.Matrix[0];u.Y(I.Matrix.IdentityReadOnly);for(let r=0;r<R;++r){if(null!==v&&void 0!==v&&v.hasThinInstances&&O){const t=16*r;u.setRowFromFloats(0,O[t+0],O[t+1],O[t+2],O[t+3]),u.setRowFromFloats(1,O[t+4],O[t+5],O[t+6],O[t+7]),u.setRowFromFloats(2,O[t+8],O[t+9],O[t+10],O[t+11]),u.setRowFromFloats(3,O[t+12],O[t+13],O[t+14],O[t+15])}const t=I.Matrix.RotationYawPitchRoll(d,H,a).multiply(I.Matrix.Translation(N.x,N.y,N.z)),Y=I.Matrix.Invert(t),mt=U.getWorldMatrix(),P=u.multiply(mt).multiply(Y),G=new Array(3);for(let U=0;U<w.length;U+=3){let t=G;if(t[0]=V(U,P),t[1]=V(U+1,P),t[2]=V(U+2,P),!(y.cullBackFaces&&-t[0].normal.z<=0&&-t[1].normal.z<=0&&-t[2].normal.z<=0)&&(t=i(t,s),t&&(t=i(t,x),t&&(t=i(t,Z),t&&(t=i(t,W),t&&(t=i(t,A),t&&(t=i(t,K),t)))))))for(let U=0;U<t.length;U++){const I=t[U];if(e.indices.push(o),E?(I.localPositionOverride?(e.jt[3*o]=I.localPositionOverride[0],e.jt[3*o+1]=I.localPositionOverride[1],e.jt[3*o+2]=I.localPositionOverride[2]):g&&(e.jt[3*o]=g[I.vertexIdx],e.jt[3*o+1]=g[I.vertexIdx+1],e.jt[3*o+2]=g[I.vertexIdx+2]),I.localNormalOverride?(e.Jt[3*o]=I.localNormalOverride[0],e.Jt[3*o+1]=I.localNormalOverride[1],e.Jt[3*o+2]=I.localNormalOverride[2]):B&&(e.Jt[3*o]=B[I.vertexIdx],e.Jt[3*o+1]=B[I.vertexIdx+1],e.Jt[3*o+2]=B[I.vertexIdx+2])):(I.position.toArray(e.jt,3*o),I.normal.toArray(e.Jt,3*o)),e.matricesIndices&&e.matricesWeights&&(I.matrixIndicesOverride?(e.matricesIndices[4*o]=I.matrixIndicesOverride[0],e.matricesIndices[4*o+1]=I.matrixIndicesOverride[1],e.matricesIndices[4*o+2]=I.matrixIndicesOverride[2],e.matricesIndices[4*o+3]=I.matrixIndicesOverride[3]):(p&&(e.matricesIndices[4*o]=p[I.vertexIdxForBones],e.matricesIndices[4*o+1]=p[I.vertexIdxForBones+1],e.matricesIndices[4*o+2]=p[I.vertexIdxForBones+2],e.matricesIndices[4*o+3]=p[I.vertexIdxForBones+3]),f&&e.matricesIndicesExtra&&(e.matricesIndicesExtra[4*o]=f[I.vertexIdxForBones],e.matricesIndicesExtra[4*o+1]=f[I.vertexIdxForBones+1],e.matricesIndicesExtra[4*o+2]=f[I.vertexIdxForBones+2],e.matricesIndicesExtra[4*o+3]=f[I.vertexIdxForBones+3])),I.matrixWeightsOverride?(e.matricesWeights[4*o]=I.matrixWeightsOverride[0],e.matricesWeights[4*o+1]=I.matrixWeightsOverride[1],e.matricesWeights[4*o+2]=I.matrixWeightsOverride[2],e.matricesWeights[4*o+3]=I.matrixWeightsOverride[3]):(c&&(e.matricesWeights[4*o]=c[I.vertexIdxForBones],e.matricesWeights[4*o+1]=c[I.vertexIdxForBones+1],e.matricesWeights[4*o+2]=c[I.vertexIdxForBones+2],e.matricesWeights[4*o+3]=c[I.vertexIdxForBones+3]),S&&e.matricesWeightsExtra&&(e.matricesWeightsExtra[4*o]=S[I.vertexIdxForBones],e.matricesWeightsExtra[4*o+1]=S[I.vertexIdxForBones+1],e.matricesWeightsExtra[4*o+2]=S[I.vertexIdxForBones+2],e.matricesWeightsExtra[4*o+3]=S[I.vertexIdxForBones+3]))),y.captureUVS)I.uv.toArray(e.qt,2*o);else{e.qt.push(.5+I.position.x/J.x);const t=.5+I.position.y/J.y;e.qt.push(X.e?1-t:t)}o++}}}0===e.indices.length&&(e.indices=null),0===e.jt.length&&(e.jt=null),0===e.Jt.length&&(e.Jt=null),0===e.qt.length&&(e.qt=null),0===(null===(G=e.matricesIndices)||void 0===G?void 0:G.length)&&(e.matricesIndices=null),0===(null===(M=e.matricesWeights)||void 0===M?void 0:M.length)&&(e.matricesWeights=null),0===(null===(L=e.matricesIndicesExtra)||void 0===L?void 0:L.length)&&(e.matricesIndicesExtra=null),0===(null===(h=e.matricesWeightsExtra)||void 0===h?void 0:h.length)&&(e.matricesWeightsExtra=null);const T=new r.c(t,U.St());return e.et(T),E?(T.skeleton=U.skeleton,T.parent=U):(T.position=N.clone(),T.rotation=new I.DU(H,d,a)),T.SX(!0),T.refreshBoundingInfo(!0,!0),T}function u(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const U=0|Math.max(t.subdivisions?t.subdivisions:2,1),y=0|Math.max(t.tessellation?t.tessellation:16,3),r=Math.max(t.height?t.height:1,0),Y=Math.max(t.radius?t.radius:.25,0),P=0|Math.max(t.capSubdivisions?t.capSubdivisions:6,1),G=y,M=U,L=Math.max(t.radiusTop?t.radiusTop:Y,0),h=Math.max(t.radiusBottom?t.radiusBottom:Y,0),Q=r-(L+h),F=2*Math.PI,E=Math.max(t.topCapSubdivisions?t.topCapSubdivisions:P,1),w=Math.max(t.bottomCapSubdivisions?t.bottomCapSubdivisions:P,1),D=Math.acos((h-L)/r);let l=[];const g=[],B=[],b=[];let p=0;const c=[],f=.5*Q,S=.5*Math.PI;let N,j;const J=I.DU.Zero(),a=I.DU.Zero(),d=Math.cos(D),q=Math.sin(D),H=new I.Vector2(L*q,f+L*d).lU(new I.Vector2(h*q,h*d-f)).length(),e=L*D+H+h*(S-D);let o=0;for(j=0;j<=E;j++){const t=[],U=S-D*(j/E);o+=L*D/E;const y=Math.cos(U),I=Math.sin(U),r=y*L;for(N=0;N<=G;N++){const U=N/G,Y=U*F+0,mt=Math.sin(Y),P=Math.cos(Y);a.x=r*mt,a.y=f+I*L,a.z=r*P,g.push(a.x,a.y,a.z),J.set(y*mt,I,y*P),B.push(J.x,J.y,J.z),b.push(U,X.e?o/e:1-o/e),t.push(p),p++}c.push(t)}const V=r-L-h+d*L-d*h,n=q*(h-L)/V;for(j=1;j<=M;j++){const t=[];o+=H/M;const U=q*(j*(h-L)/M+L);for(N=0;N<=G;N++){const y=N/G,I=y*F+0,r=Math.sin(I),Y=Math.cos(I);a.x=U*r,a.y=f+d*L-j*V/M,a.z=U*Y,g.push(a.x,a.y,a.z),J.set(r,n,Y).normalize(),B.push(J.x,J.y,J.z),b.push(y,X.e?o/e:1-o/e),t.push(p),p++}c.push(t)}for(j=1;j<=w;j++){const t=[],U=S-D-(Math.PI-D)*(j/w);o+=h*D/w;const y=Math.cos(U),I=Math.sin(U),r=y*h;for(N=0;N<=G;N++){const U=N/G,Y=U*F+0,mt=Math.sin(Y),P=Math.cos(Y);a.x=r*mt,a.y=I*h-f,a.z=r*P,g.push(a.x,a.y,a.z),J.set(y*mt,I,y*P),B.push(J.x,J.y,J.z),b.push(U,X.e?o/e:1-o/e),t.push(p),p++}c.push(t)}for(N=0;N<G;N++)for(j=0;j<E+M+w;j++){const t=c[j][N],U=c[j+1][N],y=c[j+1][N+1],I=c[j][N+1];l.push(t),l.push(U),l.push(I),l.push(U),l.push(y),l.push(I)}if(l=l.reverse(),t.orientation&&!t.orientation.equals(I.DU.Up())){const U=new I.Matrix;t.orientation.clone().scale(.5*Math.PI).cross(I.DU.Up()).toQuaternion().toRotationMatrix(U);const y=I.DU.Zero();for(let t=0;t<g.length;t+=3)y.set(g[t],g[t+1],g[t+2]),I.DU.TransformCoordinatesToRef(y.clone(),U,y),g[t]=y.x,g[t+1]=y.y,g[t+2]=y.z}const i=new mt.b;return i.jt=g,i.Jt=B,i.qt=b,i.indices=l,i}function T(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:I.DU.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new r.c(t,y);return u(U).et(Y,U.updatable),Y}r.c.CreateDecal=(t,U,y,I,r,Y)=>R(t,U,{position:y,normal:I,size:r,angle:Y});r.c.CreateCapsule=(t,U,y)=>T(t,U,y),mt.b.CreateCapsule=u;var z=y(12221),tt=y(12392);class Ut{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=U,t!==Math.floor(t)&&(t=Math.floor(t),z.b.Warn("x is not an integer, floor(x) used")),U!==Math.floor(U)&&(U=Math.floor(U),z.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Ut(this.x,this.y)}rotate60About(t){const U=this.x;return this.x=t.x+t.y-this.y,this.y=U+this.y-t.x,this}rotateNeg60About(t){const U=this.x;return this.x=U+this.y-t.y,this.y=t.x+t.y-U,this}rotate120(t,U){t!==Math.floor(t)&&(t=Math.floor(t),z.b.Warn("m not an integer only floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),z.b.Warn("n not an integer only floor(n) used"));const y=this.x;return this.x=t-y-this.y,this.y=U+y,this}rotateNeg120(t,U){t!==Math.floor(t)&&(t=Math.floor(t),z.b.Warn("m is not an integer, floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),z.b.Warn("n is not an integer,   floor(n) used"));const y=this.x;return this.x=this.y-U,this.y=t+U-y-this.y,this}toCartesianOrigin(t,U){const y=I.DU.Zero();return y.x=t.x+2*this.x*U+this.y*U,y.y=t.y+Math.sqrt(3)*this.y*U,y}static Zero(){return new Ut(0,0)}}class yt{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new It("icosahedron","Regular",[[0,tt.c,-1],[-tt.c,1,0],[-1,0,-tt.c],[1,0,-tt.c],[tt.c,1,0],[0,tt.c,1],[-1,0,tt.c],[-tt.c,-1,0],[0,-tt.c,-1],[tt.c,-1,0],[1,0,tt.c],[0,-tt.c,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let t=12;const U={},y=this.m,I=this.n;let r,Y,mt,X,P,G=y,M=1,L=0;0!==I&&(G=(0,k.HighestCommonFactor)(y,I)),M=y/G,L=I/G;const h=Ut.Zero(),Q=new Ut(y,I),F=new Ut(-I,y+I),E=Ut.Zero(),w=Ut.Zero(),D=Ut.Zero();let l,g,B,b,p=[];const c=[],f=this.vertByDist,S=(y,I,r,Y)=>{l=y+"|"+r,g=I+"|"+Y,l in U||g in U?l in U&&!(g in U)?U[g]=U[l]:g in U&&!(l in U)&&(U[l]=U[g]):(U[l]=t,U[g]=t,t++),f[r][0]>2?c[U[l]]=[-f[r][0],f[r][1],U[l]]:c[U[l]]=[p[f[r][0]],f[r][1],U[l]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let N=0;N<20;N++){if(p=this.IDATA.face[N],mt=p[2],X=p[1],P=p[0],B=h.x+"|"+h.y,l=N+"|"+B,l in U||(U[l]=mt,c[mt]=[p[f[B][0]],f[B][1]]),B=Q.x+"|"+Q.y,l=N+"|"+B,l in U||(U[l]=X,c[X]=[p[f[B][0]],f[B][1]]),B=F.x+"|"+F.y,l=N+"|"+B,l in U||(U[l]=P,c[P]=[p[f[B][0]],f[B][1]]),r=this.IDATA.edgematch[N][0],Y=this.IDATA.edgematch[N][1],"B"===Y)for(let t=1;t<G;t++)w.x=y-t*(M+L),w.y=I+t*M,D.x=-t*L,D.y=t*(M+L),B=w.x+"|"+w.y,b=D.x+"|"+D.y,S(N,r,B,b);if("O"===Y)for(let t=1;t<G;t++)D.x=-t*L,D.y=t*(M+L),E.x=t*M,E.y=t*L,B=D.x+"|"+D.y,b=E.x+"|"+E.y,S(N,r,B,b);if(r=this.IDATA.edgematch[N][2],Y=this.IDATA.edgematch[N][3],Y&&"A"===Y)for(let t=1;t<G;t++)E.x=t*M,E.y=t*L,w.x=y-(G-t)*(M+L),w.y=I+(G-t)*M,B=E.x+"|"+E.y,b=w.x+"|"+w.y,S(N,r,B,b);for(let y=0;y<this.vertices.length;y++)B=this.vertices[y].x+"|"+this.vertices[y].y,l=N+"|"+B,l in U||(U[l]=t++,f[B][0]>2?c[U[l]]=[-f[B][0],f[B][1],U[l]]:c[U[l]]=[p[f[B][0]],f[B][1],U[l]])}this.closestTo=c,this.vecToidx=U}calcCoeffs(){const t=this.m,U=this.n,y=Math.sqrt(3)/3,I=t*t+U*U+t*U;this.coau=(t+U)/I,this.cobu=-U/I,this.coav=-y*(t-U)/I,this.cobv=y*(2*t+U)/I}createInnerFacets(){const t=this.m,U=this.n;for(let y=0;y<U+t+1;y++)for(let t=this.min[y];t<this.max[y]+1;t++)t<this.max[y]&&t<this.max[y+1]+1&&this.innerFacets.push(["|"+t+"|"+y,"|"+t+"|"+(y+1),"|"+(t+1)+"|"+y]),y>0&&t<this.max[y-1]&&t+1<this.max[y]+1&&this.innerFacets.push(["|"+t+"|"+y,"|"+(t+1)+"|"+y,"|"+(t+1)+"|"+(y-1)])}edgeVecsABOB(){const t=this.m,U=this.n,y=new Ut(-U,t+U);for(let I=1;I<t+U;I++){const t=new Ut(this.min[I],I),U=new Ut(this.min[I-1],I-1),r=new Ut(this.min[I+1],I+1),Y=t.clone(),mt=U.clone(),X=r.clone();Y.rotate60About(y),mt.rotate60About(y),X.rotate60About(y);const P=new Ut(this.max[Y.y],Y.y),G=new Ut(this.max[Y.y-1],Y.y-1),M=new Ut(this.max[Y.y-1]-1,Y.y-1);Y.x===P.x&&Y.y===P.y||(Y.x!==G.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,G,M]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,M,P])):Y.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,U,G]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([t,G,r])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,U,G]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,G,P])))}}mapABOBtoOBOA(){const t=new Ut(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const y=[];for(let I=0;I<3;I++)t.x=this.isoVecsABOB[U][I].x,t.y=this.isoVecsABOB[U][I].y,0===this.vertexTypes[U][I]&&t.rotateNeg120(this.m,this.n),y.push(t.clone());this.isoVecsOBOA.push(y)}}mapABOBtoBAOA(){const t=new Ut(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const y=[];for(let I=0;I<3;I++)t.x=this.isoVecsABOB[U][I].x,t.y=this.isoVecsABOB[U][I].y,1===this.vertexTypes[U][I]&&t.rotate120(this.m,this.n),y.push(t.clone());this.isoVecsBAOA.push(y)}}MapToFace(t,U){const y=this.IDATA.face[t],r=y[2],Y=y[1],mt=y[0],X=I.DU.pU(this.IDATA.vertex[r]),P=I.DU.pU(this.IDATA.vertex[Y]),G=I.DU.pU(this.IDATA.vertex[mt]),M=P.lU(X),L=G.lU(X),h=M.scale(this.coau).add(L.scale(this.cobu)),Q=M.scale(this.coav).add(L.scale(this.cobv)),F=[];let E,w=I.TmpVectors.DU[0];for(let I=0;I<this.cartesian.length;I++)w=h.scale(this.cartesian[I].x).add(Q.scale(this.cartesian[I].y)).add(X),F[I]=[w.x,w.y,w.z],E=t+"|"+this.vertices[I].x+"|"+this.vertices[I].y,U.vertex[this.vecToidx[E]]=[w.x,w.y,w.z]}build(t,U){const y=[],I=Ut.Zero(),r=new Ut(t,U),Y=new Ut(-U,t+U);y.push(I,r,Y);for(let B=U;B<t+1;B++)for(let U=0;U<t+1-B;U++)y.push(new Ut(U,B));if(U>0){const I=(0,k.HighestCommonFactor)(t,U),r=t/I,Y=U/I;for(let X=1;X<I;X++)y.push(new Ut(X*r,X*Y)),y.push(new Ut(-X*Y,X*(r+Y))),y.push(new Ut(t-X*(r+Y),U+X*r));const mt=t/U;for(let X=1;X<U;X++)for(let I=0;I<X*mt;I++)y.push(new Ut(I,X)),y.push(new Ut(I,X).rotate120(t,U)),y.push(new Ut(I,X).rotateNeg120(t,U))}y.sort(((t,U)=>t.x-U.x)),y.sort(((t,U)=>t.y-U.y));const mt=new Array(t+U+1),X=new Array(t+U+1);for(let B=0;B<mt.length;B++)mt[B]=1/0,X[B]=-1/0;let P=0,G=0;const M=y.length;for(let B=0;B<M;B++)G=y[B].x,P=y[B].y,mt[P]=Math.min(G,mt[P]),X[P]=Math.max(G,X[P]);const L=(y,I)=>{const r=y.clone();return"A"===I&&r.rotateNeg120(t,U),"B"===I&&r.rotate120(t,U),r.x<0?r.y:r.x+r.y},h=[],Q=[],F=[],E=[],w={},D=[];let l=-1,g=-1;for(let B=0;B<M;B++)h[B]=y[B].toCartesianOrigin(new Ut(0,0),.5),Q[B]=L(y[B],"O"),F[B]=L(y[B],"A"),E[B]=L(y[B],"B"),Q[B]===F[B]&&F[B]===E[B]?(l=3,g=Q[B]):Q[B]===F[B]?(l=4,g=Q[B]):F[B]===E[B]?(l=5,g=F[B]):E[B]===Q[B]&&(l=6,g=Q[B]),Q[B]<F[B]&&Q[B]<E[B]&&(l=2,g=Q[B]),F[B]<Q[B]&&F[B]<E[B]&&(l=1,g=F[B]),E[B]<F[B]&&E[B]<Q[B]&&(l=0,g=E[B]),D.push([l,g,y[B].x,y[B].y]);D.sort(((t,U)=>t[2]-U[2])),D.sort(((t,U)=>t[3]-U[3])),D.sort(((t,U)=>t[1]-U[1])),D.sort(((t,U)=>t[0]-U[0]));for(let B=0;B<D.length;B++)w[D[B][2]+"|"+D[B][3]]=[D[B][0],D[B][1],B];return this.m=t,this.n=U,this.vertices=y,this.vertByDist=w,this.cartesian=h,this.min=mt,this.max=X,this}}class It{constructor(t,U,y,I){this.name=t,this.category=U,this.vertex=y,this.face=I}}class rt extends It{innerToData(t,U){for(let y=0;y<U.innerFacets.length;y++)this.face.push(U.innerFacets[y].map((y=>U.vecToidx[t+y])))}mapABOBtoDATA(t,U){const y=U.IDATA.edgematch[t][0];for(let I=0;I<U.isoVecsABOB.length;I++){const r=[];for(let Y=0;Y<3;Y++)0===U.vertexTypes[I][Y]?r.push(t+"|"+U.isoVecsABOB[I][Y].x+"|"+U.isoVecsABOB[I][Y].y):r.push(y+"|"+U.isoVecsABOB[I][Y].x+"|"+U.isoVecsABOB[I][Y].y);this.face.push([U.vecToidx[r[0]],U.vecToidx[r[1]],U.vecToidx[r[2]]])}}mapOBOAtoDATA(t,U){const y=U.IDATA.edgematch[t][0];for(let I=0;I<U.isoVecsOBOA.length;I++){const r=[];for(let Y=0;Y<3;Y++)1===U.vertexTypes[I][Y]?r.push(t+"|"+U.isoVecsOBOA[I][Y].x+"|"+U.isoVecsOBOA[I][Y].y):r.push(y+"|"+U.isoVecsOBOA[I][Y].x+"|"+U.isoVecsOBOA[I][Y].y);this.face.push([U.vecToidx[r[0]],U.vecToidx[r[1]],U.vecToidx[r[2]]])}}mapBAOAtoDATA(t,U){const y=U.IDATA.edgematch[t][2];for(let I=0;I<U.isoVecsBAOA.length;I++){const r=[];for(let Y=0;Y<3;Y++)1===U.vertexTypes[I][Y]?r.push(t+"|"+U.isoVecsBAOA[I][Y].x+"|"+U.isoVecsBAOA[I][Y].y):r.push(y+"|"+U.isoVecsBAOA[I][Y].x+"|"+U.isoVecsBAOA[I][Y].y);this.face.push([U.vecToidx[r[0]],U.vecToidx[r[1]],U.vecToidx[r[2]]])}}orderData(t){const U=[];for(let Y=0;Y<13;Y++)U[Y]=[];const y=t.closestTo;for(let Y=0;Y<y.length;Y++)y[Y][0]>-1?y[Y][1]>0&&U[y[Y][0]].push([Y,y[Y][1]]):U[12].push([Y,y[Y][0]]);const I=[];for(let Y=0;Y<12;Y++)I[Y]=Y;let r=12;for(let Y=0;Y<12;Y++){U[Y].sort(((t,U)=>t[1]-U[1]));for(let t=0;t<U[Y].length;t++)I[U[Y][t][0]]=r++}for(let Y=0;Y<U[12].length;Y++)I[U[12][Y][0]]=r++;for(let Y=0;Y<this.vertex.length;Y++)this.vertex[Y].push(I[Y]);this.vertex.sort(((t,U)=>t[3]-U[3]));for(let Y=0;Y<this.vertex.length;Y++)this.vertex[Y].pop();for(let Y=0;Y<this.face.length;Y++)for(let t=0;t<this.face[Y].length;t++)this.face[Y][t]=I[this.face[Y][t]];this.sharedNodes=U[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(t,U){const y=[],I=[];let r=U.pop();I.push(r);let Y=this.face[r].indexOf(t);Y=(Y+2)%3;let mt=this.face[r][Y];y.push(mt);let X=0;for(;U.length>0;)r=U[X],this.face[r].indexOf(mt)>-1?(Y=(this.face[r].indexOf(mt)+1)%3,mt=this.face[r][Y],y.push(mt),I.push(r),U.splice(X,1),X=0):X++;return this.adjacentFaces.push(y),I}toGoldbergPolyhedronData(){const t=new It("GeoDual","Goldberg",[],[]);t.name="GD dual";const U=this.vertex.length,y=new Array(U);for(let P=0;P<U;P++)y[P]=[];for(let P=0;P<this.face.length;P++)for(let t=0;t<3;t++)y[this.face[P][t]].push(P);let I=0,r=0,Y=0,mt=[],X=[];this.adjacentFaces=[];for(let P=0;P<y.length;P++){t.face[P]=this.setOrder(P,y[P].concat([]));for(const U of y[P]){I=0,r=0,Y=0,mt=this.face[U];for(let t=0;t<3;t++)X=this.vertex[mt[t]],I+=X[0],r+=X[1],Y+=X[2];t.vertex[U]=[I/3,r/3,Y/3]}}return t}static BuildGeodesicData(t){const U=new rt("Geodesic-m-n","Geodesic",[[0,tt.c,-1],[-tt.c,1,0],[-1,0,-tt.c],[1,0,-tt.c],[tt.c,1,0],[0,tt.c,1],[-1,0,tt.c],[-tt.c,-1,0],[0,-tt.c,-1],[tt.c,-1,0],[1,0,tt.c],[0,-tt.c,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let y=0;y<t.IDATA.face.length;y++)t.MapToFace(y,U),U.innerToData(y,t),"B"===t.IDATA.edgematch[y][1]&&U.mapABOBtoDATA(y,t),"O"===t.IDATA.edgematch[y][1]&&U.mapOBOAtoDATA(y,t),"A"===t.IDATA.edgematch[y][3]&&U.mapBAOAtoDATA(y,t);U.orderData(t);return U.vertex=U.vertex.map((function(t){const U=t[0],y=t[1],I=t[2],r=Math.sqrt(U*U+y*y+I*I);return t[0]*=1/r,t[1]*=1/r,t[2]*=1/r,t})),U}}r.c._GoldbergMeshParser=(t,U)=>Yt.Parse(t,U);class Yt extends r.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(t,U){return void 0===U?(t>this.goldbergData.nbUnsharedFaces-1&&(z.b.Warn("Maximum number of unshared faces used"),t=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+t):(t>11&&(z.b.Warn("Last pole used"),t=11),U>this.goldbergData.nbFacesAtPole-1&&(z.b.Warn("Maximum number of faces at a pole used"),U=this.goldbergData.nbFacesAtPole-1),12+t*this.goldbergData.nbFacesAtPole+U)}_changeGoldbergFaceColors(t){for(let y=0;y<t.length;y++){const U=t[y][0],I=t[y][1],r=t[y][2];for(let t=U;t<I+1;t++)this.goldbergData.faceColors[t]=r}const U=[];for(let y=0;y<12;y++)for(let t=0;t<5;t++)U.push(this.goldbergData.faceColors[y].r,this.goldbergData.faceColors[y].g,this.goldbergData.faceColors[y].b,this.goldbergData.faceColors[y].a);for(let y=12;y<this.goldbergData.faceColors.length;y++)for(let t=0;t<6;t++)U.push(this.goldbergData.faceColors[y].r,this.goldbergData.faceColors[y].g,this.goldbergData.faceColors[y].b,this.goldbergData.faceColors[y].a);return U}setGoldbergFaceColors(t){const U=this._changeGoldbergFaceColors(t);this.it(Y.e.ColorKind,U)}updateGoldbergFaceColors(t){const U=this._changeGoldbergFaceColors(t);this.updateVerticesData(Y.e.ColorKind,U)}_changeGoldbergFaceUVs(t){const U=this.getVerticesData(Y.e.UVKind);for(let y=0;y<t.length;y++){const I=t[y][0],r=t[y][1],Y=t[y][2],mt=t[y][3],X=t[y][4],P=[],G=[];let M,L;for(let t=0;t<5;t++)M=Y.x+mt*Math.cos(X+t*Math.PI/2.5),L=Y.y+mt*Math.sin(X+t*Math.PI/2.5),M<0&&(M=0),M>1&&(M=1),P.push(M,L);for(let t=0;t<6;t++)M=Y.x+mt*Math.cos(X+t*Math.PI/3),L=Y.y+mt*Math.sin(X+t*Math.PI/3),M<0&&(M=0),M>1&&(M=1),G.push(M,L);for(let t=I;t<Math.min(12,r+1);t++)for(let y=0;y<5;y++)U[10*t+2*y]=P[2*y],U[10*t+2*y+1]=P[2*y+1];for(let t=Math.max(12,I);t<r+1;t++)for(let y=0;y<6;y++)U[12*t-24+2*y]=G[2*y],U[12*t-23+2*y]=G[2*y+1]}return U}setGoldbergFaceUVs(t){const U=this._changeGoldbergFaceUVs(t);this.it(Y.e.UVKind,U)}updateGoldbergFaceUVs(t){const U=this._changeGoldbergFaceUVs(t);this.updateVerticesData(Y.e.UVKind,U)}placeOnGoldbergFaceAt(t,U,y){const r=I.DU.RotationFromAxis(this.goldbergData.faceXaxis[U],this.goldbergData.faceYaxis[U],this.goldbergData.faceZaxis[U]);t.rotation=r,t.position=this.goldbergData.faceCenters[U].add(this.goldbergData.faceXaxis[U].scale(y.x)).add(this.goldbergData.faceYaxis[U].scale(y.y)).add(this.goldbergData.faceZaxis[U].scale(y.z))}serialize(t){super.serialize(t),t.type="GoldbergMesh";const U={};if(U.adjacentFaces=this.goldbergData.adjacentFaces,U.nbSharedFaces=this.goldbergData.nbSharedFaces,U.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,U.nbFaces=this.goldbergData.nbFaces,U.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){U.faceColors=[];for(const t of this.goldbergData.faceColors)U.faceColors.push(t.bX())}if(this.goldbergData.faceCenters){U.faceCenters=[];for(const t of this.goldbergData.faceCenters)U.faceCenters.push(t.bX())}if(this.goldbergData.faceZaxis){U.faceZaxis=[];for(const t of this.goldbergData.faceZaxis)U.faceZaxis.push(t.bX())}if(this.goldbergData.faceYaxis){U.faceYaxis=[];for(const t of this.goldbergData.faceYaxis)U.faceYaxis.push(t.bX())}if(this.goldbergData.faceXaxis){U.faceXaxis=[];for(const t of this.goldbergData.faceXaxis)U.faceXaxis.push(t.bX())}t.goldbergData=U}static Parse(t,U){const y=t.goldbergData;y.faceColors=y.faceColors.map((t=>h.HX.pU(t))),y.faceCenters=y.faceCenters.map((t=>I.DU.pU(t))),y.faceZaxis=y.faceZaxis.map((t=>I.DU.pU(t))),y.faceXaxis=y.faceXaxis.map((t=>I.DU.pU(t))),y.faceYaxis=y.faceYaxis.map((t=>I.DU.pU(t)));const r=new Yt(t.name,U);return r.goldbergData=y,r}}var mU=y(12986);const Xt={CreateBox:L.e,CreateTiledBox:w,CreateSphere:D.d,CreateDisc:M.e,CreateIcoSphere:O,CreateRibbon:G,CreateCylinder:b,CreateTorus:c,CreateTorusKnot:S,CreateLineSystem:N.d,SG:N.g,CreateDashedLines:N.b,ExtrudeShape:a,ExtrudeShapeCustom:d,CreateLathe:H,CreateTiledPlane:F,JG:e.b,CreateGround:o.d,CreateTiledGround:o.h,CreateGroundFromHeightMap:o.c,CreatePolygon:j.e,ExtrudePolygon:j.g,CreateTube:V,CreatePolyhedron:i,CreateGeodesic:function(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=U.m||1;I!==Math.floor(I)&&(I=Math.floor(I),z.b.Warn("m not an integer only floor(m) used"));let r=U.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),z.b.Warn("n not an integer only floor(n) used")),r>I){const t=r;r=I,I=t,z.b.Warn("n > m therefore m and n swapped")}const Y=new yt;return Y.build(I,r),i(t,{custom:rt.BuildGeodesicData(Y),size:U.size,sizeX:U.sizeX,sizeY:U.sizeY,sizeZ:U.sizeZ,faceUV:U.faceUV,faceColors:U.faceColors,flat:U.flat,updatable:U.updatable,sideOrientation:U.sideOrientation,frontUVs:U.frontUVs,backUVs:U.backUVs},y)},CreateGoldberg:function(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=U.size,P=U.sizeX||Y||1,G=U.sizeY||Y||1,M=U.sizeZ||Y||1;let L=U.m||1;L!==Math.floor(L)&&(L=Math.floor(L),z.b.Warn("m not an integer only floor(m) used"));let Q=U.n||0;if(Q!==Math.floor(Q)&&(Q=Math.floor(Q),z.b.Warn("n not an integer only floor(n) used")),Q>L){const t=Q;Q=L,L=t,z.b.Warn("n > m therefore m and n swapped")}const F=new yt;F.build(L,Q);const E=rt.BuildGeodesicData(F),w=E.toGoldbergPolyhedronData(),D=new Yt(t,y);U.sideOrientation=r.c._GetDefaultSideOrientation(U.sideOrientation),D._originalBuilderSideOrientation=U.sideOrientation;(function(t,U){const y=t.size,r=t.sizeX||y||1,Y=t.sizeY||y||1,P=t.sizeZ||y||1,G=0===t.sideOrientation?0:t.sideOrientation||mt.b.DEFAULTSIDE,M=[],L=[],h=[],Q=[];let F=1/0,E=-1/0,w=1/0,D=-1/0;for(let I=0;I<U.vertex.length;I++)F=Math.min(F,U.vertex[I][0]*r),E=Math.max(E,U.vertex[I][0]*r),w=Math.min(w,U.vertex[I][1]*Y),D=Math.max(D,U.vertex[I][1]*Y);let l=0;for(let mt=0;mt<U.face.length;mt++){const t=U.face[mt],y=I.DU.pU(U.vertex[t[0]]),G=I.DU.pU(U.vertex[t[2]]),g=I.DU.pU(U.vertex[t[1]]),B=G.lU(y),b=g.lU(y),p=I.DU.Cross(b,B).normalize();for(let I=0;I<t.length;I++){h.push(p.x,p.y,p.z);const y=U.vertex[t[I]];M.push(y[0]*r,y[1]*Y,y[2]*P);const mt=(y[1]*Y-w)/(D-w);Q.push((y[0]*r-F)/(E-F),X.e?1-mt:mt)}for(let U=0;U<t.length-2;U++)L.push(l,l+U+2,l+U+1);l+=t.length}mt.b._ComputeSides(G,M,L,h,Q);const g=new mt.b;return g.jt=M,g.indices=L,g.Jt=h,g.qt=Q,g})(U,w).et(D,U.updatable),D.goldbergData.nbSharedFaces=E.sharedNodes,D.goldbergData.nbUnsharedFaces=E.poleNodes,D.goldbergData.adjacentFaces=E.adjacentFaces,D.goldbergData.nbFaces=D.goldbergData.nbSharedFaces+D.goldbergData.nbUnsharedFaces,D.goldbergData.nbFacesAtPole=(D.goldbergData.nbUnsharedFaces-12)/12;for(let r=0;r<E.vertex.length;r++)D.goldbergData.faceCenters.push(I.DU.pU(E.vertex[r])),D.goldbergData.faceCenters[r].x*=P,D.goldbergData.faceCenters[r].y*=G,D.goldbergData.faceCenters[r].z*=M,D.goldbergData.faceColors.push(new h.HX(1,1,1,1));for(let r=0;r<w.face.length;r++){const t=w.face[r],U=I.DU.pU(w.vertex[t[0]]),y=I.DU.pU(w.vertex[t[2]]),Y=I.DU.pU(w.vertex[t[1]]),mt=y.lU(U),X=Y.lU(U),P=I.DU.Cross(X,mt).normalize(),G=I.DU.Cross(X,P).normalize();D.goldbergData.faceXaxis.push(X.normalize()),D.goldbergData.faceYaxis.push(P),D.goldbergData.faceZaxis.push(G)}return D},CreateDecal:R,CreateCapsule:T,CreateText:mU.d}},13458:(t,U,y)=>{"use strict";y.d(U,{c:()=>XU});var I=y(12386),r=y(12800);class Y extends r.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var mt=y(12442),X=(y(12579),y(12338));class P{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(t){this._targetStopDuration!==t&&(this._targetStopDuration=t)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(t){this._animationSheetEnabled!==t&&(this._animationSheetEnabled=t)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){this._useLogarithmicDepth=t&&this.St().getEngine().getCaps().fragmentDepthSupported}St(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(t){switch(t){case P.BLENDMODE_MULTIPLYADD:return;case P.BLENDMODE_ADD:t=1;break;case P.BLENDMODE_ONEONE:t=6;break;case P.BLENDMODE_STANDARD:t=2;break;case P.BLENDMODE_MULTIPLY:t=4;break;case P.BLENDMODE_SUBTRACT:t=3}this._engine.setAlphaMode(t)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:I.DU.Zero()}set direction1(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:I.DU.Zero()}set direction2(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:I.DU.Zero()}set minEmitBox(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:I.DU.Zero()}set maxEmitBox(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)}get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(t){this._attachImageProcessingConfiguration(t)}_attachImageProcessingConfiguration(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)}_reset(){}_removeGradientAndTexture(t,U,y){if(!U)return this;let I=0;for(const r of U){if(r.gradient===t){U.splice(I,1);break}I++}return y&&y.dispose(),this}constructor(t){this.animations=[],this.renderingGroupId=0,this.my=I.DU.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new I.DU(10,10,10),this.onAnimationEnd=null,this.blendMode=P.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new I.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.pG=new I.DU(0,0,0),this._useLogarithmicDepth=!1,this.gravity=I.DU.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new mt.HX(1,1,1,1),this.color2=new mt.HX(1,1,1,1),this.colorDead=new mt.HX(0,0,0,1),this.textureMask=new mt.HX(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Y,this.id=t,this.name=t}createPointEmitter(t,U){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new I.DU(0,1,0),arguments.length>2&&void 0!==arguments[2]||new I.DU(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new I.DU(0,1,0),arguments.length>4&&void 0!==arguments[4]||new I.DU(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new I.DU(0,1,0),arguments.length>3&&void 0!==arguments[3]||new I.DU(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(t,U,y,I){throw new Error("Method not implemented.")}}P.BLENDMODE_ONEONE=0,P.BLENDMODE_STANDARD=1,P.BLENDMODE_ADD=2,P.BLENDMODE_MULTIPLY=3,P.BLENDMODE_MULTIPLYADD=4,P.BLENDMODE_SUBTRACT=-1,(0,X.f)("BABYLON.BaseParticleSystem",P);var G=y(12404),M=y(12229);class L{constructor(){this.direction1=new I.DU(0,1,0),this.direction2=new I.DU(0,1,0),this.minEmitBox=new I.DU(-.5,-.5,-.5),this.maxEmitBox=new I.DU(.5,.5,.5)}startDirectionFunction(t,U,y,r){const Y=(0,G.RandomRange)(this.direction1.x,this.direction2.x),mt=(0,G.RandomRange)(this.direction1.y,this.direction2.y),X=(0,G.RandomRange)(this.direction1.z,this.direction2.z);if(r)return U.x=Y,U.y=mt,void(U.z=X);I.DU.TransformNormalFromFloatsToRef(Y,mt,X,t,U)}startPositionFunction(t,U,y,r){const Y=(0,G.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),mt=(0,G.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,G.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(r)return U.x=Y,U.y=mt,void(U.z=X);I.DU.TransformCoordinatesFromFloatsToRef(Y,mt,X,t,U)}clone(){const t=new L;return M.d.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3),t.addUniform("minEmitBox",3),t.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.bX(),t.direction2=this.direction2.bX(),t.minEmitBox=this.minEmitBox.bX(),t.maxEmitBox=this.maxEmitBox.bX(),t}parse(t){I.DU.FromArrayToRef(t.direction1,0,this.direction1),I.DU.FromArrayToRef(t.direction2,0,this.direction2),I.DU.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),I.DU.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)}}class h{get radius(){return this._radius}set radius(t){this._radius=t,this._buildHeight()}get angle(){return this._angle}set angle(t){this._angle=t,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=y,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=U,this.radius=t}startDirectionFunction(t,U,y,r){r?I.TmpVectors.DU[0].Y(y.yP).normalize():y.position.subtractToRef(t.getTranslation(),I.TmpVectors.DU[0]).normalize();const Y=(0,G.RandomRange)(0,this.directionRandomizer),mt=(0,G.RandomRange)(0,this.directionRandomizer),X=(0,G.RandomRange)(0,this.directionRandomizer);U.x=I.TmpVectors.DU[0].x+Y,U.y=I.TmpVectors.DU[0].y+mt,U.z=I.TmpVectors.DU[0].z+X,U.normalize()}startPositionFunction(t,U,y,r){const Y=(0,G.RandomRange)(0,2*Math.PI);let mt;this.emitFromSpawnPointOnly?mt=1e-4:(mt=(0,G.RandomRange)(0,this.heightRange),mt=1-mt*mt);let X=this._radius-(0,G.RandomRange)(0,this._radius*this.radiusRange);X*=mt;const P=X*Math.sin(Y),M=X*Math.cos(Y),L=mt*this._height;if(r)return U.x=P,U.y=L,void(U.z=M);I.DU.TransformCoordinatesFromFloatsToRef(P,L,M,t,U)}clone(){const t=new h(this._radius,this._angle,this.directionRandomizer);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",2),t.addUniform("coneAngle",1),t.addUniform("height",2),t.addUniform("directionRandomizer",1)}getEffectDefines(){let t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+="\n#define CONEEMITTERSPAWNPOINT"),t}getClassName(){return"ConeParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t}parse(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=void 0!==t.radiusRange?t.radiusRange:1,this.heightRange=void 0!==t.radiusRange?t.heightRange:1,this.emitFromSpawnPointOnly=void 0!==t.emitFromSpawnPointOnly&&t.emitFromSpawnPointOnly}}class Q extends h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0);super(t,U),this.direction1=y,this.direction2=r}startDirectionFunction(t,U){const y=(0,G.RandomRange)(this.direction1.x,this.direction2.x),r=(0,G.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,G.RandomRange)(this.direction1.z,this.direction2.z);I.DU.TransformNormalFromFloatsToRef(y,r,Y,t,U)}clone(){const t=new Q(this.radius,this.angle,this.direction1,this.direction2);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.bX(),t.direction2=this.direction2.bX(),t}parse(t){super.parse(t),this.direction1.Y(t.direction1),this.direction2.Y(t.direction2)}}class F{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=t,this.height=U,this.radiusRange=y,this.directionRandomizer=r,this._tempVector=I.DU.Zero()}startDirectionFunction(t,U,y,r,Y){y.position.subtractToRef(t.getTranslation(),this._tempVector),this._tempVector.normalize(),I.DU.TransformNormalToRef(this._tempVector,Y,this._tempVector);const mt=(0,G.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,G.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=mt,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),r?U.Y(this._tempVector):I.DU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t,U)}startPositionFunction(t,U,y,r){const Y=(0,G.RandomRange)(-this.height/2,this.height/2),mt=(0,G.RandomRange)(0,2*Math.PI),X=(0,G.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),P=Math.sqrt(X)*this.radius,M=P*Math.cos(mt),L=P*Math.sin(mt);r?U.aX(M,Y,L):I.DU.TransformCoordinatesFromFloatsToRef(M,Y,L,t,U)}clone(){const t=new F(this.radius,this.directionRandomizer);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class E extends F{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0),Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new I.DU(0,1,0);super(t,U,y),this.direction1=r,this.direction2=Y}startDirectionFunction(t,U,y,r){const Y=(0,G.RandomRange)(this.direction1.x,this.direction2.x),mt=(0,G.RandomRange)(this.direction1.y,this.direction2.y),X=(0,G.RandomRange)(this.direction1.z,this.direction2.z);r?U.aX(Y,mt,X):I.DU.TransformNormalFromFloatsToRef(Y,mt,X,t,U)}clone(){const t=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.bX(),t.direction2=this.direction2.bX(),t}parse(t){super.parse(t),I.DU.FromArrayToRef(t.direction1,0,this.direction1),I.DU.FromArrayToRef(t.direction2,0,this.direction2)}}class w{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.radiusRange=U,this.directionRandomizer=y}startDirectionFunction(t,U,y,r){const Y=y.position.lU(t.getTranslation()).normalize(),mt=(0,G.RandomRange)(0,this.directionRandomizer),X=(0,G.RandomRange)(0,this.directionRandomizer),P=(0,G.RandomRange)(0,this.directionRandomizer);Y.x+=mt,Y.y+=X,Y.z+=P,Y.normalize(),r?U.Y(Y):I.DU.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,t,U)}startPositionFunction(t,U,y,r){const Y=this.radius-(0,G.RandomRange)(0,this.radius*this.radiusRange),mt=(0,G.RandomRange)(0,1),X=(0,G.RandomRange)(0,2*Math.PI),P=Math.acos(2*mt-1),M=Y*Math.cos(X)*Math.sin(P),L=Y*Math.cos(P),h=Y*Math.sin(X)*Math.sin(P);r?U.aX(M,Math.abs(L),h):I.DU.TransformCoordinatesFromFloatsToRef(M,Math.abs(L),h,t,U)}clone(){const t=new w(this.radius,this.directionRandomizer);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class D{constructor(){this.direction1=new I.DU(0,1,0),this.direction2=new I.DU(0,1,0)}startDirectionFunction(t,U,y,r){const Y=(0,G.RandomRange)(this.direction1.x,this.direction2.x),mt=(0,G.RandomRange)(this.direction1.y,this.direction2.y),X=(0,G.RandomRange)(this.direction1.z,this.direction2.z);r?U.aX(Y,mt,X):I.DU.TransformNormalFromFloatsToRef(Y,mt,X,t,U)}startPositionFunction(t,U,y,r){r?U.aX(0,0,0):I.DU.TransformCoordinatesFromFloatsToRef(0,0,0,t,U)}clone(){const t=new D;return M.d.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.bX(),t.direction2=this.direction2.bX(),t}parse(t){I.DU.FromArrayToRef(t.direction1,0,this.direction1),I.DU.FromArrayToRef(t.direction2,0,this.direction2)}}class l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.radiusRange=U,this.directionRandomizer=y}startDirectionFunction(t,U,y,r){const Y=y.position.lU(t.getTranslation()).normalize(),mt=(0,G.RandomRange)(0,this.directionRandomizer),X=(0,G.RandomRange)(0,this.directionRandomizer),P=(0,G.RandomRange)(0,this.directionRandomizer);Y.x+=mt,Y.y+=X,Y.z+=P,Y.normalize(),r?U.Y(Y):I.DU.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,t,U)}startPositionFunction(t,U,y,r){const Y=this.radius-(0,G.RandomRange)(0,this.radius*this.radiusRange),mt=(0,G.RandomRange)(0,1),X=(0,G.RandomRange)(0,2*Math.PI),P=Math.acos(2*mt-1),M=Y*Math.cos(X)*Math.sin(P),L=Y*Math.cos(P),h=Y*Math.sin(X)*Math.sin(P);r?U.aX(M,L,h):I.DU.TransformCoordinatesFromFloatsToRef(M,L,h,t,U)}clone(){const t=new l(this.radius,this.directionRandomizer);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class g extends l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new I.DU(0,1,0),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0);super(t),this.direction1=U,this.direction2=y}startDirectionFunction(t,U){const y=(0,G.RandomRange)(this.direction1.x,this.direction2.x),r=(0,G.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,G.RandomRange)(this.direction1.z,this.direction2.z);I.DU.TransformNormalFromFloatsToRef(y,r,Y,t,U)}clone(){const t=new g(this.radius,this.direction1,this.direction2);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.bX(),t.direction2=this.direction2.bX(),t}parse(t){super.parse(t),this.direction1.Y(t.direction1),this.direction2.Y(t.direction2)}}class B{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(t,U,y,r){const Y=I.TmpVectors.DU[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,y,Y);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,y,Y);const t=I.TmpVectors.DU[1];Y.subtractToRef(y.position,t),t.scaleToRef(1/y.lifeTime,Y)}else Y.set(0,0,0);r?U.Y(Y):I.DU.TransformNormalToRef(Y,t,U)}startPositionFunction(t,U,y,r){const Y=I.TmpVectors.DU[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,y,Y):Y.set(0,0,0),r?U.Y(Y):I.DU.TransformCoordinatesToRef(Y,t,U)}clone(){const t=new B;return M.d.DeepCopy(this,t),t}applyToShader(t){}buildUniformLayout(t){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.particlePositionGenerator=this.particlePositionGenerator,t.particleDestinationGenerator=this.particleDestinationGenerator,t}parse(t){t.particlePositionGenerator&&(this.particlePositionGenerator=t.particlePositionGenerator),t.particleDestinationGenerator&&(this.particleDestinationGenerator=t.particleDestinationGenerator)}}var b=y(12480);class p{get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.jX(),this._positions=t.getVerticesData(b.e.PositionKind),this._normals=t.getVerticesData(b.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=I.DU.Zero(),this._mesh=null,this.direction1=new I.DU(0,1,0),this.direction2=new I.DU(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}startDirectionFunction(t,U,y,r){if(this.useMeshNormalsForDirection&&this._normals)return void I.DU.TransformNormalToRef(this._storedNormal,t,U);const Y=(0,G.RandomRange)(this.direction1.x,this.direction2.x),mt=(0,G.RandomRange)(this.direction1.y,this.direction2.y),X=(0,G.RandomRange)(this.direction1.z,this.direction2.z);r?U.aX(Y,mt,X):I.DU.TransformNormalFromFloatsToRef(Y,mt,X,t,U)}startPositionFunction(t,U,y,r){if(!this._indices||!this._positions)return;const Y=3*(Math.random()*(this._indices.length/3)|0),mt=Math.random(),X=Math.random()*(1-mt),P=1-mt-X,G=this._indices[Y],M=this._indices[Y+1],L=this._indices[Y+2],h=I.TmpVectors.DU[0],Q=I.TmpVectors.DU[1],F=I.TmpVectors.DU[2],E=I.TmpVectors.DU[3];I.DU.FromArrayToRef(this._positions,3*G,h),I.DU.FromArrayToRef(this._positions,3*M,Q),I.DU.FromArrayToRef(this._positions,3*L,F),E.x=mt*h.x+X*Q.x+P*F.x,E.y=mt*h.y+X*Q.y+P*F.y,E.z=mt*h.z+X*Q.z+P*F.z,r?U.aX(E.x,E.y,E.z):I.DU.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,t,U),this.useMeshNormalsForDirection&&this._normals&&(I.DU.FromArrayToRef(this._normals,3*G,h),I.DU.FromArrayToRef(this._normals,3*M,Q),I.DU.FromArrayToRef(this._normals,3*L,F),this._storedNormal.x=mt*h.x+X*Q.x+P*F.x,this._storedNormal.y=mt*h.y+X*Q.y+P*F.y,this._storedNormal.z=mt*h.z+X*Q.z+P*F.z)}clone(){const t=new p(this.mesh);return M.d.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var t;const U={};return U.type=this.getClassName(),U.direction1=this.direction1.bX(),U.direction2=this.direction2.bX(),U.meshId=null===(t=this.mesh)||void 0===t?void 0:t.id,U.useMeshNormalsForDirection=this.useMeshNormalsForDirection,U}parse(t,U){I.DU.FromArrayToRef(t.direction1,0,this.direction1),I.DU.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&U&&(this.mesh=U.getLastMeshById(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection}}class c{_isUbo(t){return void 0!==t.addUniform}constructor(t){this._isUbo(t)?(this.setMatrix3x3=t.updateMatrix3x3.bind(t),this.setMatrix2x2=t.updateMatrix2x2.bind(t),this.setFloat=t.updateFloat.bind(t),this.setFloat2=t.updateFloat2.bind(t),this.setFloat3=t.updateFloat3.bind(t),this.setFloat4=t.updateFloat4.bind(t),this.setFloatArray=t.updateFloatArray.bind(t),this.setArray=t.updateArray.bind(t),this.setIntArray=t.updateIntArray.bind(t),this.setMatrix=t.fX.bind(t),this.setMatrices=t.updateMatrices.bind(t),this.setVector3=t.updateVector3.bind(t),this.setVector4=t.updateVector4.bind(t),this.setColor3=t.updateColor3.bind(t),this.setColor4=t.updateColor4.bind(t),this.setDirectColor4=t.updateDirectColor4.bind(t),this.setInt=t.updateInt.bind(t),this.setInt2=t.updateInt2.bind(t),this.setInt3=t.updateInt3.bind(t),this.setInt4=t.updateInt4.bind(t)):(this.setMatrix3x3=t.setMatrix3x3.bind(t),this.setMatrix2x2=t.setMatrix2x2.bind(t),this.setFloat=t.setFloat.bind(t),this.setFloat2=t.setFloat2.bind(t),this.setFloat3=t.setFloat3.bind(t),this.setFloat4=t.setFloat4.bind(t),this.setFloatArray=t.setFloatArray.bind(t),this.setArray=t.setArray.bind(t),this.setIntArray=t.setIntArray.bind(t),this.setMatrix=t.setMatrix.bind(t),this.setMatrices=t.setMatrices.bind(t),this.setVector3=t.setVector3.bind(t),this.setVector4=t.setVector4.bind(t),this.setColor3=t.setColor3.bind(t),this.setColor4=t.setColor4.bind(t),this.setDirectColor4=t.setDirectColor4.bind(t),this.setInt=t.setInt.bind(t),this.setInt2=t.setInt2.bind(t),this.setInt3=t.setInt3.bind(t),this.setInt4=t.setInt4.bind(t))}}var f=y(12296);const S="gpuUpdateParticlesPixelShader",N="#version 300 es\nvoid main() {discard;}\n";f.e.ShadersStore[S]||(f.e.ShadersStore[S]=N);const j="gpuUpdateParticlesVertexShader",J="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";f.e.ShadersStore[j]||(f.e.ShadersStore[j]=J);(0,X.f)("BABYLON.WebGL2ParticleSystem",class{constructor(t,U){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=t,this._engine=U,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var t;return(null===(t=this._updateEffect)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof B&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=t,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new c(this._updateEffect)}createVertexBuffers(t,U){this._updateVAO.push(this._createUpdateVAO(t)),this._renderVAO.push(this._engine.recordVertexArrayObject(U,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=U}createParticleBuffer(t){return t}bindDrawBuffers(t,U,y){y?this._engine.bindBuffers(this._renderVertexBuffers,y,U):this._engine.bindVertexArrayObject(this._renderVAO[t],null)}preUpdateParticleBuffer(){const t=this._engine;if(this._engine.enableEffect(this._updateEffect),!t.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(t,U,y){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[t],null);const I=this._engine;I.bindTransformFeedbackBuffer(U.getBuffer()),I.setRasterizerState(!1),I.beginTransformFeedback(!0),I.drawArraysType(3,0,y),I.endTransformFeedback(),I.setRasterizerState(!0),I.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let t=0;t<this._updateVAO.length;t++)this._engine.releaseVertexArrayObject(this._updateVAO[t]);this._updateVAO.length=0;for(let t=0;t<this._renderVAO.length;t++)this._engine.releaseVertexArrayObject(this._renderVAO[t]);this._renderVAO.length=0}_createUpdateVAO(t){const U={};U.position=t.createVertexBuffer("position",0,3);let y=3;U.age=t.createVertexBuffer("age",y,1),y+=1,U.size=t.createVertexBuffer("size",y,3),y+=3,U.life=t.createVertexBuffer("life",y,1),y+=1,U.seed=t.createVertexBuffer("seed",y,4),y+=4,U.direction=t.createVertexBuffer("direction",y,3),y+=3,this._parent.particleEmitterType instanceof B&&(U.initialPosition=t.createVertexBuffer("initialPosition",y,3),y+=3),this._parent._colorGradientsTexture||(U.color=t.createVertexBuffer("color",y,4),y+=4),this._parent._isBillboardBased||(U.initialDirection=t.createVertexBuffer("initialDirection",y,3),y+=3),this._parent.noiseTexture&&(U.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",y,3),y+=3,U.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",y,3),y+=3),this._parent._angularSpeedGradientsTexture?(U.angle=t.createVertexBuffer("angle",y,1),y+=1):(U.angle=t.createVertexBuffer("angle",y,2),y+=2),this._parent._isAnimationSheetEnabled&&(U.cellIndex=t.createVertexBuffer("cellIndex",y,1),y+=1,this._parent.spriteRandomStartCell&&(U.cellStartOffset=t.createVertexBuffer("cellStartOffset",y,1),y+=1));const I=this._engine.recordVertexArrayObject(U,null,this._updateEffect);return this._engine.bindArrayBuffer(null),I}});class a{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,I=arguments.length>3?arguments[3]:void 0;this._engine=t,this._label=I,this._engine._storageBuffers.push(this),this._create(U,y)}_create(t,U){this._bufferSize=t,this._creationFlags=U,this._buffer=this._engine.createStorageBuffer(t,U,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(t,U,y){this._buffer&&this._engine.updateStorageBuffer(this._buffer,t,U,y)}async read(t,U,y,I){return await this._engine.readFromStorageBuffer(this._buffer,t,U,y,I)}dispose(){const t=this._engine._storageBuffers,U=t.indexOf(this);-1!==U&&(t[U]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var d=y(12366),q=y(12375),H=y(12426),e=y(12361),o=y(12718),V=y(12221),n=y(12324),i=y(12629);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new i.e}_addDuration(t,U){t<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==t?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(U,!1),this._gpuTimeInFrameId=t):this.counter.addCount(U,!1))}}var O=y(12277);class k{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=t,this._engine=U,this.uniqueId=o.e.UniqueId,U.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?I.bindingsMapping?(this._context=U.createComputeContext(),this._shaderPath=y,this._options={bindingsMapping:{},defines:[],...I}):V.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):V.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const I=this._bindings[t];this._bindings[t]={type:y?0:4,object:U,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!I||I.object!==U||I.type!==this._bindings[t].type)}setStorageTexture(t,U){const y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==U),this._bindings[t]={type:1,object:U,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setExternalTexture(t,U){const y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==U),this._bindings[t]={type:6,object:U,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setVideoTexture(t,U){return!!U.externalTexture&&(this.setExternalTexture(t,U.externalTexture),!0)}setUniformBuffer(t,U){const y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==U),this._bindings[t]={type:k._BufferIsDataBuffer(U)?7:2,object:U,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setStorageBuffer(t,U){const y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==U),this._bindings[t]={type:k._BufferIsDataBuffer(U)?7:3,object:U,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setTextureSampler(t,U){const y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!y||!U.compareSampler(y.object)),this._bindings[t]={type:5,object:U,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}isReady(){let t=this._effect;for(const r in this._bindings){const t=this._bindings[r],U=t.type,y=t.object;switch(U){case 0:case 4:case 1:if(!y.isReady())return!1;break;case 6:if(!y.isReady())return!1;break}}const U=[],y=this._shaderPath;if(this._options.defines)for(let r=0;r<this._options.defines.length;r++)U.push(this._options.defines[r]);const I=U.join("\n");return this._cachedDefines!==I&&(this._cachedDefines=I,t=this._engine.createComputeEffect(y,{defines:I,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=t),!!t.isReady()}dispatch(t,U,y){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,t,U,y,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const y=k._BufferIsDataBuffer(t)?t:t.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,y,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const U in this._bindings){const y=this._bindings[U];if(!this._options.bindingsMapping[U])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+U+"'");switch(y.type){case 0:{const I=this._samplers[U],r=y.object;var t;if(!I||!r._texture||!I.compareSampler(r._texture))this._samplers[U]=(new n.e).setParameters(r.wrapU,r.wrapV,r.wrapR,r.anisotropicFilteringLevel,r._texture.samplingMode,null===(t=r._texture)||void 0===t?void 0:t._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const t=y.object;t.getBuffer()!==y.buffer&&(y.buffer=t.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((r=>{(0,O.g)((()=>this.dispatch(t,U,y)),r,void 0,I)}))}serialize(){const t=H.b.Serialize(this);t.options=this._options,t.shaderPath=this._shaderPath,t.gh={},t.textures={};for(const U in this._bindings){const y=this._bindings[U],I=y.object;switch(y.type){case 0:case 4:case 1:{const r=I.serialize();r&&(t.textures[U]=r,t.gh[U]={type:y.type});break}}}return t}static Parse(t,U,y){const I=H.b.Parse((()=>new k(t.name,U.getEngine(),t.shaderPath,t.options)),t,U,y);for(const r in t.textures){const Y=t.gh[r],mt=e.d.Parse(t.textures[r],U,y);0===Y.type?I.setTexture(r,mt):4===Y.type?I.setTexture(r,mt,!1):I.setStorageTexture(r,mt)}return I}static _BufferIsDataBuffer(t){return void 0!==t.underlyingResource}}(0,d.b)([(0,q.I)()],k.prototype,"name",void 0),(0,d.b)([(0,q.I)()],k.prototype,"fastMode",void 0),(0,X.f)("BABYLON.ComputeShader",k);var s=y(12679);const x="gpuUpdateParticlesComputeShader",Z="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";f.e.ShadersStoreWGSL[x]||(f.e.ShadersStoreWGSL[x]=Z);(0,X.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(t,U){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=t,this._engine=U}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var t;return(null===(t=this._updateComputeShader)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){var U;const y={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(y.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(y.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(y.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(y.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(y.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(y.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(y.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new k("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:y,defines:t.split("\n")}),null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=new s.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new c(this._simParamsComputeShader)}createVertexBuffers(t,U){this._renderVertexBuffers.push(U)}createParticleBuffer(t){const U=new a(this._engine,4*t.length,11,"ComputeShaderParticleSystemBuffer");return U.update(t),this._bufferComputeShader.push(U),U.getBuffer()}bindDrawBuffers(t,U,y){this._engine.bindBuffers(this._renderVertexBuffers[t],y,U)}preUpdateParticleBuffer(){}updateParticleBuffer(t,U,y){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[t]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^t]),this._updateComputeShader.dispatch(Math.ceil(y/64))}releaseBuffers(){var t;for(let U=0;U<this._bufferComputeShader.length;++U)this._bufferComputeShader[U].dispose();this._bufferComputeShader.length=0,null===(t=this._simParamsComputeShader)||void 0===t||t.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class W{constructor(t,U,y){this.gradient=t,this.color1=U,this.color2=y}getColorToRef(t){this.color2?mt.HX.LerpToRef(this.color1,this.color2,Math.random(),t):t.Y(this.color1)}}class A{constructor(t,U){this.gradient=t,this.color=U}}class K{constructor(t,U,y){this.gradient=t,this.factor1=U,this.factor2=y}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class C{static GetCurrentGradient(t,U,y){if(U[0].gradient>t)return void y(U[0],U[0],1);for(let r=0;r<U.length-1;r++){const I=U[r],Y=U[r+1];if(t>=I.gradient&&t<=Y.gradient){return void y(I,Y,(t-I.gradient)/(Y.gradient-I.gradient))}}const I=U.length-1;y(U[I],U[I],1)}}var R=y(12204),u=y(12899),T=y(12250);class z{constructor(t){this.particleSystem=t,this.position=I.DU.Zero(),this.direction=I.DU.Zero(),this.color=new mt.HX(0,0,0,0),this.colorStep=new mt.HX(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new I.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new mt.HX(0,0,0,0),this._currentColor2=new mt.HX(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=z._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let t=this.age,U=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===U?(U=1,t=this._randomCellOffset):t+=this._randomCellOffset);const y=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let I;I=this._initialSpriteCellLoop?(0,G.Clamp)(t*U%this.lifeTime/this.lifeTime):(0,G.Clamp)(t*U/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+I*y|0}_inheritParticleInfoToSubEmitter(t){if(t.particleSystem.my.position){const U=t.particleSystem.my;if(U.position.Y(this.position),t.inheritDirection){const t=I.TmpVectors.DU[0];this.direction.normalizeToRef(t),U.setDirection(t,0,Math.PI/2)}}else{t.particleSystem.my.Y(this.position)}this.direction.scaleToRef(t.inheritedVelocityAmount/2,I.TmpVectors.DU[0]),t.particleSystem._inheritedVelocityOffset.Y(I.TmpVectors.DU[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const t of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(t)}_reset(){this.age=0,this.id=z._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(t){t.position.Y(this.position),this._initialDirection?t._initialDirection?t._initialDirection.Y(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.Y(this.direction),this.yP&&(t.yP?t.yP.Y(this.yP):t.yP=this.yP.clone()),t.color.Y(this.color),t.colorStep.Y(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.Y(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.Y(this._currentColor1),t._currentColor2.Y(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellId=this._initialStartSpriteCellId,t._initialEndSpriteCellId=this._initialEndSpriteCellId,t._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.Y(this.remapData):t.remapData=new I.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.Y(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.Y(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}z._Count=0;var tt=y(12521),Ut=(y(12572),y(12788)),yt=y(12785),It=y(12671);function rt(t,U){const y=(0,G.RandomRange)(0,1);mt.HX.LerpToRef(U.color1,U.color2,y,t.color),U.colorDead.subtractToRef(t.color,U._colorDiff),U._colorDiff.scaleToRef(1/t.lifeTime,t.colorStep)}function Yt(t,U){t._currentColorGradient=U._colorGradients[0],t._currentColorGradient.getColorToRef(t.color),t._currentColor1.Y(t.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(t._currentColor2):t._currentColor2.Y(t.color)}function mU(t,U){const y=U._colorGradients;C.GetCurrentGradient(U._ratio,y,((U,y,I)=>{U!==t._currentColorGradient&&(t._currentColor1.Y(t._currentColor2),y.getColorToRef(t._currentColor2),t._currentColorGradient=U),mt.HX.LerpToRef(t._currentColor1,t._currentColor2,I,t.color)}))}function Xt(t,U){t.colorStep.scaleToRef(U._scaledUpdateSpeed,U._scaledColorStep),t.color.addInPlace(U._scaledColorStep),t.color.a<0&&(t.color.a=0)}function Pt(t,U){C.GetCurrentGradient(U._ratio,U._angularSpeedGradients,((U,y,I)=>{U!==t._currentAngularSpeedGradient&&(t._currentAngularSpeed1=t._currentAngularSpeed2,t._currentAngularSpeed2=y.getFactor(),t._currentAngularSpeedGradient=U),t.angularSpeed=(0,G.Lerp)(t._currentAngularSpeed1,t._currentAngularSpeed2,I)}))}function Gt(t,U){t.angle+=t.angularSpeed*U._scaledUpdateSpeed}function Mt(t,U){U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,t.direction,t,U.isLocal,U._emitterInverseWorldMatrix)}function Lt(t,U){U.startDirectionFunction(U._emitterWorldMatrix,t.direction,t,U.isLocal)}function ht(t,U){t._currentVelocityGradient=U._velocityGradients[0],t._currentVelocity1=t._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?t._currentVelocity2=U._velocityGradients[1].getFactor():t._currentVelocity2=t._currentVelocity1}function Qt(t,U){t._currentLimitVelocityGradient=U._limitVelocityGradients[0],t._currentLimitVelocity1=t._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?t._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():t._currentLimitVelocity2=t._currentLimitVelocity1}function Ft(t,U){C.GetCurrentGradient(U._ratio,U._velocityGradients,((y,I,r)=>{y!==t._currentVelocityGradient&&(t._currentVelocity1=t._currentVelocity2,t._currentVelocity2=I.getFactor(),t._currentVelocityGradient=y),U._directionScale*=(0,G.Lerp)(t._currentVelocity1,t._currentVelocity2,r)}))}function Et(t,U){C.GetCurrentGradient(U._ratio,U._limitVelocityGradients,((y,I,r)=>{y!==t._currentLimitVelocityGradient&&(t._currentLimitVelocity1=t._currentLimitVelocity2,t._currentLimitVelocity2=I.getFactor(),t._currentLimitVelocityGradient=y);const Y=(0,G.Lerp)(t._currentLimitVelocity1,t._currentLimitVelocity2,r);t.direction.length()>Y&&t.direction.scaleInPlace(U.limitVelocityDamping)}))}function wt(t,U){t.direction.scaleToRef(U._directionScale,U._scaledDirection)}function Dt(t,U){U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,t.position,t,U.isLocal)}function lt(t,U){U.startPositionFunction(U._emitterWorldMatrix,t.position,t,U.isLocal)}function gt(t,U){t.yP?t.yP.Y(t.position):t.yP=t.position.clone(),I.DU.TransformCoordinatesToRef(t.yP,U._emitterWorldMatrix,t.position)}function Bt(t,U){U.isLocal&&t.yP?(t.yP.addInPlace(U._scaledDirection),I.DU.TransformCoordinatesToRef(t.yP,U._emitterWorldMatrix,t.position)):t.position.addInPlace(U._scaledDirection)}function bt(t,U){t._currentDragGradient=U._dragGradients[0],t._currentDrag1=t._currentDragGradient.getFactor(),U._dragGradients.length>1?t._currentDrag2=U._dragGradients[1].getFactor():t._currentDrag2=t._currentDrag1}function pt(t,U){C.GetCurrentGradient(U._ratio,U._dragGradients,((y,I,r)=>{y!==t._currentDragGradient&&(t._currentDrag1=t._currentDrag2,t._currentDrag2=I.getFactor(),t._currentDragGradient=y);const Y=(0,G.Lerp)(t._currentDrag1,t._currentDrag2,r);U._scaledDirection.scaleInPlace(1-Y)}))}function ct(t,U){t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.aX(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2.aX(Math.random(),Math.random(),Math.random())):(t._randomNoiseCoordinates1=new I.DU(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2=new I.DU(Math.random(),Math.random(),Math.random()))}function ft(t,U){const y=U._noiseTextureData,r=U._noiseTextureSize;if(y&&r&&t._randomNoiseCoordinates1){const Y=U._fetchR(t._randomNoiseCoordinates1.x,t._randomNoiseCoordinates1.y,r.width,r.height,y),mt=U._fetchR(t._randomNoiseCoordinates1.z,t._randomNoiseCoordinates2.x,r.width,r.height,y),X=U._fetchR(t._randomNoiseCoordinates2.y,t._randomNoiseCoordinates2.z,r.width,r.height,y),P=I.TmpVectors.DU[0],G=I.TmpVectors.DU[1];P.aX((2*Y-1)*U.noiseStrength.x,(2*mt-1)*U.noiseStrength.y,(2*X-1)*U.noiseStrength.z),P.scaleToRef(U._tempScaledUpdateSpeed,G),t.direction.addInPlace(G)}}function St(t,U){U.gravity.scaleToRef(U._tempScaledUpdateSpeed,U._scaledGravity),t.direction.addInPlace(U._scaledGravity)}function Nt(t,U){t.size=(0,G.RandomRange)(U.minSize,U.maxSize),t.scale.aX((0,G.RandomRange)(U.minScaleX,U.maxScaleX),(0,G.RandomRange)(U.minScaleY,U.maxScaleY))}function jt(t,U){t._currentSizeGradient=U._sizeGradients[0],t._currentSize1=t._currentSizeGradient.getFactor(),t.size=t._currentSize1,U._sizeGradients.length>1?t._currentSize2=U._sizeGradients[1].getFactor():t._currentSize2=t._currentSize1,t.scale.aX((0,G.RandomRange)(U.minScaleX,U.maxScaleX),(0,G.RandomRange)(U.minScaleY,U.maxScaleY))}function Jt(t,U){const y=U._actualFrame/U.targetStopDuration;C.GetCurrentGradient(y,U._startSizeGradients,((y,I,r)=>{y!==U._currentStartSizeGradient&&(U._currentStartSize1=U._currentStartSize2,U._currentStartSize2=I.getFactor(),U._currentStartSizeGradient=y);const Y=(0,G.Lerp)(U._currentStartSize1,U._currentStartSize2,r);t.scale.scaleInPlace(Y)}))}function at(t,U){C.GetCurrentGradient(U._ratio,U._sizeGradients,((U,y,I)=>{U!==t._currentSizeGradient&&(t._currentSize1=t._currentSize2,t._currentSize2=y.getFactor(),t._currentSizeGradient=U),t.size=(0,G.Lerp)(t._currentSize1,t._currentSize2,I)}))}function dt(t,U){t.remapData=new I.Vector4(0,1,0,1)}function qt(t,U){U._colorRemapGradients&&U._colorRemapGradients.length>0&&C.GetCurrentGradient(U._ratio,U._colorRemapGradients,((U,y,I)=>{const r=(0,G.Lerp)(U.factor1,y.factor1,I),Y=(0,G.Lerp)(U.factor2,y.factor2,I);t.remapData.x=r,t.remapData.y=Y-r})),U._alphaRemapGradients&&U._alphaRemapGradients.length>0&&C.GetCurrentGradient(U._ratio,U._alphaRemapGradients,((U,y,I)=>{const r=(0,G.Lerp)(U.factor1,y.factor1,I),Y=(0,G.Lerp)(U.factor2,y.factor2,I);t.remapData.z=r,t.remapData.w=Y-r}))}function Ht(t,U){const y=(0,G.Clamp)(U._actualFrame/U.targetStopDuration);C.GetCurrentGradient(y,U._lifeTimeGradients,((U,I)=>{const r=U,Y=I,mt=r.getFactor(),X=Y.getFactor(),P=(y-r.gradient)/(Y.gradient-r.gradient);t.lifeTime=(0,G.Lerp)(mt,X,P)})),U._emitPower=(0,G.RandomRange)(U.minEmitPower,U.maxEmitPower)}function et(t,U){t.lifeTime=(0,G.RandomRange)(U.minLifeTime,U.maxLifeTime),U._emitPower=(0,G.RandomRange)(U.minEmitPower,U.maxEmitPower)}function ot(t,U){0===U._emitPower?(t._initialDirection?t._initialDirection.Y(t.direction):t._initialDirection=t.direction.clone(),t.direction.set(0,0,0)):(t._initialDirection=null,t.direction.scaleInPlace(U._emitPower)),t.direction.addInPlace(U._inheritedVelocityOffset)}function Vt(t,U){t.angularSpeed=(0,G.RandomRange)(U.minAngularSpeed,U.maxAngularSpeed),t.angle=(0,G.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function nt(t,U){t._currentAngularSpeedGradient=U._angularSpeedGradients[0],t.angularSpeed=t._currentAngularSpeedGradient.getFactor(),t._currentAngularSpeed1=t.angularSpeed,U._angularSpeedGradients.length>1?t._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():t._currentAngularSpeed2=t._currentAngularSpeed1,t.angle=(0,G.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function it(t,U){t._initialStartSpriteCellId=U.startSpriteCellID,t._initialEndSpriteCellId=U.endSpriteCellID,t._initialSpriteCellLoop=U.spriteCellLoop}function vt(t,U){t.previousItem=U.previousItem,t.nextItem=U,U.previousItem&&(U.previousItem.nextItem=t),U.previousItem=t}function Ot(t,U){t.previousItem=U,t.nextItem=U.nextItem,U.nextItem&&(U.nextItem.previousItem=t),U.nextItem=t}function kt(t,U){let y=U;for(;y.nextItem;)y=y.nextItem;t.previousItem=y,t.nextItem=y.nextItem,y.nextItem=t}function st(t){t.previousItem&&(t.previousItem.nextItem=t.nextItem),t.nextItem&&(t.nextItem.previousItem=t.previousItem)}class xt extends P{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(t){this._startDirectionFunction!==t&&(this._startDirectionFunction=t,this._directionProcessing.process=t?Lt:Mt)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(t){this._startPositionFunction!==t&&(this._startPositionFunction=t,this._positionCreation.process=t?lt:Dt)}set onDispose(t){this._onDisposeObserver&&this.FX.remove(this._onDisposeObserver),this._onDisposeObserver=this.FX.add(t)}get G(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(t){this._useRampGradients!==t&&(this._useRampGradients=t,this._resetEffect(),t?(this._rampCreation={process:dt,previousItem:null,nextItem:null},Ot(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:qt,previousItem:null,nextItem:null},Ot(this._remapGradientProcessing,this._gravityProcessing)):(st(this._rampCreation),st(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(t){this._isLocal!==t&&(this._isLocal=t,t?(this._isLocalCreation={process:gt,previousItem:null,nextItem:null},Ot(this._isLocalCreation,this._positionCreation)):st(this._isLocalCreation))}get particles(){return this.Mh}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(t){this._animationSheetEnabled!==t&&(this._animationSheetEnabled=t,t?(this._sheetCreation={process:it,previousItem:null,nextItem:null},Ot(this._sheetCreation,this._colorCreation)):st(this._sheetCreation),this._reset())}getActiveCount(){return this.Mh.length}getClassName(){return"mh"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var t;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[U])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new tt.e(this._engine),this._customWrappers[U].effect=t,this._customWrappers[U].drawContext&&(this._customWrappers[U].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(t){if(this.noiseTexture!==t){if(this._noiseTexture=t,!t)return st(this._noiseCreation),void st(this._noiseProcessing);this._noiseCreation={process:ct,previousItem:null,nextItem:null},Ot(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ft,previousItem:null,nextItem:null},Ot(this._noiseProcessing,this._positionProcessing)}}constructor(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(t),this._emitterInverseWorldMatrix=I.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new I.DU,this.FX=new R.b,this.onStoppedObservable=new R.b,this.onStartedObservable=new R.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Mh=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new mt.HX(0,0,0,0),this._colorDiff=new mt.HX(0,0,0,0),this._scaledDirection=I.DU.Zero(),this._scaledGravity=I.DU.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=t=>{},this.recycleParticle=t=>{const U=this.Mh.pop();U!==t&&U.copyTo(t),this._stockParticles.push(U)},this._createParticle=()=>{let t;return 0!==this._stockParticles.length?(t=this._stockParticles.pop(),t._reset()):t=new z(this),this._prepareParticle(t),t},this.paused=!1,this._shadersLoaded=!1,this._capacity=U,this._epsilon=X,y&&"Scene"!==y.getClassName()?(this._engine=y,this.defaultProjectionMatrix=I.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=y||T.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.mQ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:et,previousItem:null,nextItem:null},this._positionCreation={process:Dt,previousItem:null,nextItem:null},Ot(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Mt,previousItem:null,nextItem:null},Ot(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:ot,previousItem:null,nextItem:null},Ot(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Nt,previousItem:null,nextItem:null},Ot(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Vt,previousItem:null,nextItem:null},Ot(this._angleCreation,this._sizeCreation),this._colorCreation={process:rt,previousItem:null,nextItem:null},Ot(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,P||(this._colorProcessing={process:Xt,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Gt,previousItem:null,nextItem:null},Ot(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:wt,previousItem:null,nextItem:null},Ot(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Bt,previousItem:null,nextItem:null},Ot(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:St,previousItem:null,nextItem:null},Ot(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Y,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=r,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new L,this.updateFunction=t=>{var U;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(U=this.noiseTexture.getContent())||void 0===U||U.then((t=>{this._noiseTextureData=t})));const y=t===this.Mh;for(let I=0;I<t.length;I++){const U=t[I];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const r=U.age;if(U.age+=this._tempScaledUpdateSpeed,U.age>U.lifeTime){const t=U.age-r,y=U.lifeTime-r;this._tempScaledUpdateSpeed=y*this._tempScaledUpdateSpeed/t,U.age=U.lifeTime}this._ratio=U.age/U.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Y=this._updateQueueStart;for(;Y;)Y.process(U,this),Y=Y.nextItem;if(this._isAnimationSheetEnabled&&!P&&U.updateCellIndex(),U._inheritParticleInfoToSubEmitters(),U.age>=U.lifeTime){if(this._emitFromParticle(U),U._attachedSubEmitters){for(const t of U._attachedSubEmitters)t.particleSystem.disposeOnStop=!0,t.particleSystem.stop();U._attachedSubEmitters=null}this.recycleParticle(U),y&&I--}else;}}}serialize(t){throw new Error("Method not implemented.")}clone(t,U){throw new Error("Method not implemented.")}_addFactorGradient(t,U,y,I){const r=new K(U,y,I);t.push(r),t.sort(((t,U)=>t.gradient<U.gradient?-1:t.gradient>U.gradient?1:0))}_removeFactorGradient(t,U){if(!t)return;let y=0;for(const I of t){if(I.gradient===U){t.splice(y,1);break}y++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Ht:this._lifeTimeCreation.process=et}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Jt,previousItem:null,nextItem:null},Ot(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(st(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(t){this.targetStopDuration!==t&&(this._targetStopDuration=t,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(t,U,y){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,t,U,y),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(t){return this._removeFactorGradient(this._lifeTimeGradients,t),this._syncLifeTimeCreation(),this}addSizeGradient(t,U,y){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=jt,this._sizeGradientProcessing={process:at,previousItem:null,nextItem:null},vt(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,t,U,y),this}removeSizeGradient(t){var U;return this._removeFactorGradient(this._sizeGradients,t),0===(null===(U=this._sizeGradients)||void 0===U?void 0:U.length)&&(st(this._sizeGradientProcessing),this._sizeCreation.process=Nt),this}addColorRemapGradient(t,U,y){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,t,U,y),this}removeColorRemapGradient(t){return this._removeFactorGradient(this._colorRemapGradients,t),this}addAlphaRemapGradient(t,U,y){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,t,U,y),this}removeAlphaRemapGradient(t){return this._removeFactorGradient(this._alphaRemapGradients,t),this}addAngularSpeedGradient(t,U,y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=nt,this._angularSpeedGradientProcessing={process:Pt,previousItem:null,nextItem:null},vt(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,t,U,y),this}removeAngularSpeedGradient(t){var U;return this._removeFactorGradient(this._angularSpeedGradients,t),0===(null===(U=this._angularSpeedGradients)||void 0===U?void 0:U.length)&&(this._angleCreation.process=Vt,st(this._angularSpeedGradientProcessing)),this}addVelocityGradient(t,U,y){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ht,previousItem:null,nextItem:null},Ot(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Ft,previousItem:null,nextItem:null},vt(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,t,U,y),this}removeVelocityGradient(t){var U;return this._removeFactorGradient(this._velocityGradients,t),0===(null===(U=this._velocityGradients)||void 0===U?void 0:U.length)&&(st(this._velocityCreation),st(this._velocityGradientProcessing)),this}addLimitVelocityGradient(t,U,y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Qt,previousItem:null,nextItem:null},Ot(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Et,previousItem:null,nextItem:null},Ot(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,t,U,y),this}removeLimitVelocityGradient(t){var U;return this._removeFactorGradient(this._limitVelocityGradients,t),0===(null===(U=this._limitVelocityGradients)||void 0===U?void 0:U.length)&&(st(this._limitVelocityCreation),st(this._limitVelocityGradientProcessing)),this}addDragGradient(t,U,y){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:bt,previousItem:null,nextItem:null},vt(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:pt,previousItem:null,nextItem:null},vt(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,t,U,y),this}removeDragGradient(t){var U;return this._removeFactorGradient(this._dragGradients,t),0===(null===(U=this._dragGradients)||void 0===U?void 0:U.length)&&(st(this._dragCreation),st(this._dragGradientProcessing)),this}addEmitRateGradient(t,U,y){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,t,U,y),this}removeEmitRateGradient(t){return this._removeFactorGradient(this._emitRateGradients,t),this}addStartSizeGradient(t,U,y){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,t,U,y),this._syncStartSizeCreation(),this}removeStartSizeGradient(t){return this._removeFactorGradient(this._startSizeGradients,t),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const t=new Uint8Array(4*this._rawTextureWidth),U=mt.TmpColors.bU[0];for(let y=0;y<this._rawTextureWidth;y++){const I=y/this._rawTextureWidth;C.GetCurrentGradient(I,this._rampGradients,((I,r,Y)=>{mt.bU.LerpToRef(I.color,r.color,Y,U),t[4*y]=255*U.r,t[4*y+1]=255*U.g,t[4*y+2]=255*U.b,t[4*y+3]=255}))}this._rampGradientsTexture=u.b.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((t,U)=>t.gradient<U.gradient?-1:t.gradient>U.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(t,U){this._rampGradients||(this._rampGradients=[]);const y=new A(t,U);return this._rampGradients.push(y),this._syncRampGradientTexture(),this}removeRampGradient(t){return this._removeGradientAndTexture(t,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(t,U,y){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Yt,this._colorProcessing.process=mU);const I=new W(t,U,y);return this._colorGradients.push(I),this._colorGradients.sort(((t,U)=>t.gradient<U.gradient?-1:t.gradient>U.gradient?1:0)),this}removeColorGradient(t){if(!this._colorGradients)return this;let U=0;for(const y of this._colorGradients){if(y.gradient===t){this._colorGradients.splice(U,1);break}U++}return 0===this._colorGradients.length&&(this._colorCreation.process=rt,this._colorProcessing.process=Xt),this}resetDrawCache(){if(this._drawWrappers){for(const t of this._drawWrappers)if(t)for(const U of t)null===U||void 0===U||U.dispose();this._drawWrappers=[]}}_fetchR(t,U,y,I,r){return r[4*(((t=.5*Math.abs(t)+.5)*y%y|0)+((U=.5*Math.abs(U)+.5)*I%I|0)*y)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const t=this._engine,U=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*U),this._vertexBuffer=new b.b(t,this._vertexData,!0,U);let y=0;const I=this._vertexBuffer.createVertexBuffer(b.e.PositionKind,y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[b.e.PositionKind]=I,y+=3;const r=this._vertexBuffer.createVertexBuffer(b.e.ColorKind,y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[b.e.ColorKind]=r,y+=4;const Y=this._vertexBuffer.createVertexBuffer("angle",y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Y,y+=1;const mt=this._vertexBuffer.createVertexBuffer("size",y,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=mt,y+=2,this._isAnimationSheetEnabled){const t=this._vertexBuffer.createVertexBuffer("cellIndex",y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=t,y+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const t=this._vertexBuffer.createVertexBuffer("direction",y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=t,y+=3}if(this._useRampGradients){const t=this._vertexBuffer.createVertexBuffer("remapData",y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=t,y+=4}let X;if(this._useInstancing){const U=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new b.b(t,U,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",y,2,this._vertexBufferSize,this._useInstancing),y+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const t=[],U=[];let y=0;for(let I=0;I<this._capacity;I++)t.push(y),t.push(y+1),t.push(y+2),t.push(y),t.push(y+2),t.push(y+3),U.push(y,y+1,y+1,y+2,y+2,y+3,y+3,y,y,y+3),y+=4;this._indexBuffer=this._engine.createIndexBuffer(t),this._linesIndexBuffer=this._engine.createIndexBuffer(U)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(t)setTimeout((()=>{this.start(0)}),t);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var U;-1!==(null===(U=this.my)||void 0===U?void 0:U.getClassName().indexOf("Mesh"))&&this.my.SX(!0);const t=this.noiseTexture;if(t&&t.onGeneratedObservable)t.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),t.render()}))}));else for(let U=0;U<this.preWarmCycles;U++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(t))}_postStop(t){}reset(){this._stockParticles.length=0,this.Mh.length=0}_appendParticleVertex(t,U,y,r){let Y=t*this._vertexBufferSize;if(this._vertexData[Y++]=U.position.x+this.pG.x,this._vertexData[Y++]=U.position.y+this.pG.y,this._vertexData[Y++]=U.position.z+this.pG.z,this._vertexData[Y++]=U.color.r,this._vertexData[Y++]=U.color.g,this._vertexData[Y++]=U.color.b,this._vertexData[Y++]=U.color.a,this._vertexData[Y++]=U.angle,this._vertexData[Y++]=U.scale.x*U.size,this._vertexData[Y++]=U.scale.y*U.size,this._isAnimationSheetEnabled&&(this._vertexData[Y++]=U.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Y++]=U.direction.x,this._vertexData[Y++]=U.direction.y,this._vertexData[Y++]=U.direction.z);else if(U._initialDirection){let t=U._initialDirection;this.isLocal&&(I.DU.TransformNormalToRef(t,this._emitterWorldMatrix,I.TmpVectors.DU[0]),t=I.TmpVectors.DU[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[Y++]=t.x,this._vertexData[Y++]=t.y,this._vertexData[Y++]=t.z}else{let t=U.direction;this.isLocal&&(I.DU.TransformNormalToRef(t,this._emitterWorldMatrix,I.TmpVectors.DU[0]),t=I.TmpVectors.DU[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[Y++]=t.x,this._vertexData[Y++]=t.y,this._vertexData[Y++]=t.z}this._useRampGradients&&U.remapData&&(this._vertexData[Y++]=U.remapData.x,this._vertexData[Y++]=U.remapData.y,this._vertexData[Y++]=U.remapData.z,this._vertexData[Y++]=U.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===y?y=this._epsilon:1===y&&(y=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon)),this._vertexData[Y++]=y,this._vertexData[Y++]=r)}_prepareParticle(t){}_createNewOnes(t){let U;for(let y=0;y<t&&this.Mh.length!==this._capacity;y++){U=this._createParticle(),this.Mh.push(U);let t=this._createQueueStart;for(;t;)t.process(U,this),t=t.nextItem;U._inheritParticleInfoToSubEmitters()}}_update(t){if(this._alive=this.Mh.length>0,this.my.position){const t=this.my;this._emitterWorldMatrix=t.getWorldMatrix()}else{const t=this.my;this._emitterWorldMatrix=I.Matrix.Translation(t.x,t.y,t.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Mh),this._createNewOnes(t)}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const I=[b.e.PositionKind,b.e.ColorKind,"angle","offset","size"];return t&&I.push("cellIndex"),U||I.push("direction"),y&&I.push("remapData"),I}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const I=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Ut.d)(I),t&&I.push("particlesInfos"),U&&I.push("logarithmicDepthConstant"),y&&(I.push("vFogInfos"),I.push("vFogColor")),I}fillDefines(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ut.k)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&t.push("#define FOG")),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),U===P.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&t.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case 2:t.push("#define BILLBOARDY");break;case 8:case 9:t.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&t.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:t.push("#define BILLBOARDMODE_ALL")}y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,U,y){U.push(...xt._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),t.push(...xt._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),y.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,It.h)(t,this._imageProcessingConfigurationDefines),(0,It.d)(y,this._imageProcessingConfigurationDefines))}_getWrapper(t){const U=this._getCustomDrawWrapper(t);if(null!==U&&void 0!==U&&U.effect)return U;const y=[];this.fillDefines(y,t);const I=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let r=this._drawWrappers[I];r||(r=this._drawWrappers[I]=[]);let Y=r[t];Y||(Y=new tt.e(this._engine),Y.drawContext&&(Y.drawContext.useInstancing=this._useInstancing),r[t]=Y);const mt=y.join("\n");if(Y.defines!==mt){const t=[],U=[],y=[];this.fillUniformsAttributesAndSamplerNames(U,t,y),Y.setEffect(this._engine.createEffect("particles",t,U,y,mt,void 0,void 0,void 0,void 0,this._shaderLanguage),mt)}return Y}animate(){var t;let U,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!y&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(y?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this.manualEmitCount>-1)U=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let t=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const U=this._actualFrame/this.targetStopDuration;C.GetCurrentGradient(U,this._emitRateGradients,((U,y,I)=>{U!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=y.getFactor(),this._currentEmitRateGradient=U),t=(0,G.Lerp)(this._currentEmitRate1,this._currentEmitRate2,I)}))}U=t*this._scaledUpdateSpeed|0,this._newPartsExcess+=t*this._scaledUpdateSpeed-U}if(this._newPartsExcess>1&&(U+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?U=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(U),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!y){let t=0;for(let U=0;U<this.Mh.length;U++){const y=this.Mh[U];this._appendParticleVertices(t,y),t+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Mh.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(t,U){this._appendParticleVertex(t++,U,0,0),this._useInstancing||(this._appendParticleVertex(t++,U,1,0),this._appendParticleVertex(t++,U,1,1),this._appendParticleVertex(t++,U,0,1))}rebuild(){var t;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(t=this._spriteBuffer)||void 0===t||t._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!xt.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(y.bind(y,13637)),Promise.resolve().then(y.bind(y,13578))])):await Promise.all([Promise.resolve().then(y.bind(y,13568)),Promise.resolve().then(y.bind(y,13555))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.my||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==P.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(P.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(P.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(t){const U=this._getWrapper(t),y=U.effect,r=this._engine;r.enableEffect(U);const Y=this.defaultViewMatrix??this._scene.getViewMatrix();if(y.setTexture("diffuseSampler",this.particleTexture),y.setMatrix("view",Y),y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();y.setFloat3("particlesInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,this.spriteCellWidth/t.width)}if(y.setVector2("translationPivot",this.translationPivot),y.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;y.setVector3("eyePosition",t.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),y.setTexture("rampSampler",this._rampGradientsTexture));const mt=y.defines;var X,P,G,M,L,h;(this._scene&&((0,Ut.e)(y,this,this._scene),this.applyFog&&(0,yt.e)(this._scene,void 0,y)),mt.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Y.invertToRef(I.TmpVectors.Matrix[0]),y.setMatrix("invView",I.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?r.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,y):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,y)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?r.bindBuffers(this._vertexBuffers,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBuffer:this._indexBuffer,y):r.bindBuffers(this._vertexBuffers,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:null,y);(this.useLogarithmicDepth&&this._scene&&(0,yt.h)(mt,y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(y),this._setEngineBasedOnBlendMode(t),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(y),this._useInstancing)?null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?r.drawElementsType(6,0,10,this.Mh.length):r.drawArraysType(7,0,4,this.Mh.length):null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?r.drawElementsType(1,0,10*this.Mh.length):r.drawElementsType(0,0,6*this.Mh.length);return this.Mh.length}render(){if(!this.isReady()||!this.Mh.length)return 0;const t=this._engine;t.setState&&(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0));let U=0;return U=this.blendMode===P.BLENDMODE_MULTIPLYADD?this._render(P.BLENDMODE_MULTIPLY)+this._render(P.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),U}_onDispose(){}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(U,y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const t=this._scene.mQ.indexOf(this);t>-1&&this._scene.mQ.splice(t,1),this._scene._activeParticleSystems.dispose()}this.FX.notifyObservers(this),this.FX.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}xt.ForceGLSL=!1;var Zt,Wt=y(12242);!function(t){t[t.ATTACHED=0]="ATTACHED",t[t.END=1]="END"}(Zt||(Zt={}));class At{constructor(t){if(this.particleSystem=t,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.my||!t.my.dispose){const U=(0,X.d)("BABYLON.AbstractMesh");t.my=new U("SubemitterSystemEmitter",t.St()),t._disposeEmitterOnDispose=!0}}clone(){let t=this.particleSystem.my;if(t){if(t instanceof I.DU)t=t.clone();else if(-1!==t.getClassName().indexOf("Mesh")){t=new((0,X.d)("BABYLON.Mesh"))("",t.St()),t.isVisible=!1}}else t=new I.DU;const U=new At(this.particleSystem.clone(this.particleSystem.name,t));return U.particleSystem.name+="Clone",U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem._disposeEmitterOnDispose=!0,U.particleSystem.disposeOnStop=!0,U}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem=this.particleSystem.serialize(t),U}static _ParseParticleSystem(t,U,y){throw(0,Wt.c)("ParseParticle")}static Parse(t,U,y){const I=t.particleSystem,r=new At(At._ParseParticleSystem(I,U,y,!0));return r.type=t.type,r.inheritDirection=t.inheritDirection,r.inheritedVelocityAmount=t.inheritedVelocityAmount,r.particleSystem._isSubEmitter=!0,r}dispose(){this.particleSystem.dispose()}}var Kt=y(12285);function Ct(t,U){const y=new D;return y.direction1=t,y.direction2=U,y}function Rt(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ut(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Tt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new I.DU(0,1,0),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0);return new g(t,U,y)}function zt(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function tU(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0),Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new I.DU(0,1,0);return new E(t,U,y,r,Y)}function UU(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new h(t,U)}function yU(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0);return new Q(t,U,y,r)}const IU=I.DU.Zero(),rU=I.DU.Zero(),YU=I.DU.Zero();class my{constructor(){this.strength=0,this.position=I.DU.Zero()}_processParticle(t,U){this.position.subtractToRef(t.position,IU);const y=IU.lengthSquared()+1;IU.normalize().scaleToRef(this.strength/y,rU),rU.scaleToRef(U._tempScaledUpdateSpeed,YU),t.direction.addInPlace(YU)}serialize(){return{position:this.position.bX(),strength:this.strength}}}class XU extends xt{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=t=>{if(!this._subEmitters||0===this._subEmitters.length)return;const U=Math.floor(Math.random()*this._subEmitters.length);for(const y of this._subEmitters[U])if(1===y.type){const U=y.clone();t._inheritParticleInfoToSubEmitter(U),U.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(U.particleSystem),U.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(t,U){const y=Ct(t,U);return this.particleEmitterType=y,y}get flowMap(){return this._flowMap}set flowMap(t){this._flowMap!==t&&(this._flowMap=t,this._flowMapUpdate&&(st(this._flowMapUpdate),this._flowMapUpdate=null),t&&(this._flowMapUpdate={process:t=>{var U;const y=null===(U=this.St())||void 0===U?void 0:U.getTransformMatrix();this._flowMap._processParticle(t,this.flowMapStrength*this._tempScaledUpdateSpeed,y)},previousItem:null,nextItem:null},Ot(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(t){this._attractors.push(t),1===this._attractors.length&&(this._attractorUpdate={process:t=>{for(const U of this._attractors)U._processParticle(t,this)},previousItem:null,nextItem:null},Ot(this._attractorUpdate,this._directionProcessing))}removeAttractor(t){const U=this._attractors.indexOf(t);-1!==U&&this._attractors.splice(U,1),0===this._attractors.length&&st(this._attractorUpdate)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(t)}createHemisphericEmitter(){const t=Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=ut(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=Tt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new I.DU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=zt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=tU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new I.DU(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=yU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,U,y,I){const r=new L;return this.particleEmitterType=r,this.direction1=t,this.direction2=U,this.minEmitBox=y,this.maxEmitBox=I,r}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const t of this.subEmitters)t instanceof XU?this._subEmitters.push([new At(t)]):t instanceof At?this._subEmitters.push([t]):t instanceof Array&&this._subEmitters.push(t)}_stopSubEmitters(){if(this.activeSubSystems){for(const t of this.activeSubSystems)t.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const t=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==t&&this._rootParticleSystem.activeSubSystems.splice(t,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(t){t&&this._stopSubEmitters()}_prepareParticle(t){if(this._subEmitters&&this._subEmitters.length>0){const U=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];t._attachedSubEmitters=[];for(const y of U)if(0===y.type){const U=y.clone();t._attachedSubEmitters.push(U),U.particleSystem.start()}}}_onDispose(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),t&&this.particles)for(const y of this.particles)if(y._attachedSubEmitters)for(let t=y._attachedSubEmitters.length-1;t>=0;t-=1)y._attachedSubEmitters[t].dispose();if(U&&this.activeSubSystems)for(let y=this.activeSubSystems.length-1;y>=0;y-=1)this.activeSubSystems[y].dispose();if(this._subEmitters&&this._subEmitters.length){for(let t=0;t<this._subEmitters.length;t++)for(const U of this._subEmitters[t])U.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.my&&this.my.dispose&&this.my.dispose(!0)}static _Parse(t,U,y,r){let Y;Y=y instanceof Kt.e?null:y;const P=(0,X.d)("BABYLON.Texture");if(P&&Y&&(t.texture?U.particleTexture=P.Parse(t.texture,Y,r):t.textureName&&(U.particleTexture=new P(r+t.textureName,Y,!1,void 0===t.invertY||t.invertY),U.particleTexture.name=t.textureName)),t.emitterId||0===t.emitterId||void 0!==t.my?t.emitterId&&Y?U.my=Y.getLastMeshById(t.emitterId):U.my=I.DU.pU(t.my):U.my=I.DU.Zero(),U.isLocal=!!t.isLocal,void 0!==t.renderingGroupId&&(U.renderingGroupId=t.renderingGroupId),void 0!==t.isBillboardBased&&(U.isBillboardBased=t.isBillboardBased),void 0!==t.billboardMode&&(U.billboardMode=t.billboardMode),void 0!==t.useLogarithmicDepth&&(U.useLogarithmicDepth=t.useLogarithmicDepth),t.animations){for(let y=0;y<t.animations.length;y++){const I=t.animations[y],r=(0,X.d)("BABYLON.Animation");r&&U.animations.push(r.Parse(I))}U.beginAnimationOnStart=t.beginAnimationOnStart,U.beginAnimationFrom=t.beginAnimationFrom,U.beginAnimationTo=t.beginAnimationTo,U.beginAnimationLoop=t.beginAnimationLoop}if(t.autoAnimate&&Y&&Y.beginAnimation(U,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),U.startDelay=0|t.startDelay,U.minAngularSpeed=t.minAngularSpeed,U.maxAngularSpeed=t.maxAngularSpeed,U.minSize=t.minSize,U.maxSize=t.maxSize,t.minScaleX&&(U.minScaleX=t.minScaleX,U.maxScaleX=t.maxScaleX,U.minScaleY=t.minScaleY,U.maxScaleY=t.maxScaleY),void 0!==t.preWarmCycles&&(U.preWarmCycles=t.preWarmCycles,U.preWarmStepOffset=t.preWarmStepOffset),void 0!==t.minInitialRotation&&(U.minInitialRotation=t.minInitialRotation,U.maxInitialRotation=t.maxInitialRotation),U.minLifeTime=t.minLifeTime,U.maxLifeTime=t.maxLifeTime,U.minEmitPower=t.minEmitPower,U.maxEmitPower=t.maxEmitPower,U.emitRate=t.emitRate,U.gravity=I.DU.pU(t.gravity),t.noiseStrength&&(U.noiseStrength=I.DU.pU(t.noiseStrength)),U.color1=mt.HX.pU(t.color1),U.color2=mt.HX.pU(t.color2),U.colorDead=mt.HX.pU(t.colorDead),U.updateSpeed=t.updateSpeed,U.targetStopDuration=t.targetStopDuration,U.blendMode=t.blendMode,t.colorGradients)for(const I of t.colorGradients)U.addColorGradient(I.gradient,mt.HX.pU(I.color1),I.color2?mt.HX.pU(I.color2):void 0);if(t.rampGradients){for(const y of t.rampGradients)U.addRampGradient(y.gradient,mt.bU.pU(y.color));U.useRampGradients=t.useRampGradients}if(t.colorRemapGradients)for(const I of t.colorRemapGradients)U.addColorRemapGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.alphaRemapGradients)for(const I of t.alphaRemapGradients)U.addAlphaRemapGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.sizeGradients)for(const I of t.sizeGradients)U.addSizeGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.angularSpeedGradients)for(const I of t.angularSpeedGradients)U.addAngularSpeedGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.velocityGradients)for(const I of t.velocityGradients)U.addVelocityGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.dragGradients)for(const I of t.dragGradients)U.addDragGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.emitRateGradients)for(const I of t.emitRateGradients)U.addEmitRateGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.startSizeGradients)for(const I of t.startSizeGradients)U.addStartSizeGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.lifeTimeGradients)for(const I of t.lifeTimeGradients)U.addLifeTimeGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);if(t.limitVelocityGradients){for(const y of t.limitVelocityGradients)U.addLimitVelocityGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);U.limitVelocityDamping=t.limitVelocityDamping}if(t.noiseTexture&&Y){const y=(0,X.d)("BABYLON.ProceduralTexture");U.noiseTexture=y.Parse(t.noiseTexture,Y,r)}let G;if(t.particleEmitterType){switch(t.particleEmitterType.type){case"SphereParticleEmitter":G=new l;break;case"SphereDirectedParticleEmitter":G=new g;break;case"ConeEmitter":case"ConeParticleEmitter":G=new h;break;case"ConeDirectedParticleEmitter":G=new Q;break;case"CylinderParticleEmitter":G=new F;break;case"CylinderDirectedParticleEmitter":G=new E;break;case"HemisphericParticleEmitter":G=new w;break;case"PointParticleEmitter":G=new D;break;case"MeshParticleEmitter":G=new p;break;case"CustomParticleEmitter":G=new B;break;default:G=new L}G.parse(t.particleEmitterType,Y)}else G=new L,G.parse(t,Y);U.particleEmitterType=G,U.startSpriteCellID=t.startSpriteCellID,U.endSpriteCellID=t.endSpriteCellID,U.spriteCellLoop=t.spriteCellLoop??!0,U.spriteCellWidth=t.spriteCellWidth,U.spriteCellHeight=t.spriteCellHeight,U.spriteCellChangeSpeed=t.spriteCellChangeSpeed,U.spriteRandomStartCell=t.spriteRandomStartCell,U.disposeOnStop=t.disposeOnStop??!1,U.manualEmitCount=t.manualEmitCount??-1}static Parse(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4?arguments[4]:void 0;const X=t.name;let P,G,M=null,L=null;if(U instanceof Kt.e?P=U:(G=U,P=G.getEngine()),t.customShader&&P.createEffectForParticles){L=t.customShader;const U=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";M=P.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,U)}const h=new XU(X,Y||t.fU,U,M,t.isAnimationSheetEnabled);if(h.customShader=L,h._rootUrl=y,t.id&&(h.id=t.id),t.subEmitters){h.subEmitters=[];for(const I of t.subEmitters){const t=[];for(const r of I)t.push(At.Parse(r,U,y));h.subEmitters.push(t)}}if(t.attractors)for(const mt of t.attractors){const t=new my;t.position=I.DU.pU(mt.position),t.strength=mt.strength,h.addAttractor(t)}return XU._Parse(t,h,U,y),t.textureMask&&(h.textureMask=mt.HX.pU(t.textureMask)),t.pG&&(h.pG=I.DU.pU(t.pG)),t.preventAutoStart&&(h.preventAutoStart=t.preventAutoStart),r||h.preventAutoStart||h.start(),h}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};if(XU._Serialize(U,this,t),U.textureMask=this.textureMask.bX(),U.customShader=this.customShader,U.preventAutoStart=this.preventAutoStart,U.pG=this.pG.bX(),this.subEmitters){U.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const y of this._subEmitters){const I=[];for(const U of y)I.push(U.serialize(t));U.subEmitters.push(I)}}if(this._attractors&&this._attractors.length){U.attractors=[];for(const t of this._attractors)U.attractors.push(t.serialize())}return U}static _Serialize(t,U,y){if(t.name=U.name,t.id=U.id,t.fU=U.getCapacity(),t.disposeOnStop=U.disposeOnStop,t.manualEmitCount=U.manualEmitCount,U.my.position){const y=U.my;t.emitterId=y.id}else{const y=U.my;t.my=y.bX()}U.particleEmitterType&&(t.particleEmitterType=U.particleEmitterType.serialize()),U.particleTexture&&(y?t.texture=U.particleTexture.serialize():(t.textureName=U.particleTexture.name,t.invertY=!!U.particleTexture._invertY)),t.isLocal=U.isLocal,H.b.AppendSerializedAnimations(U,t),t.beginAnimationOnStart=U.beginAnimationOnStart,t.beginAnimationFrom=U.beginAnimationFrom,t.beginAnimationTo=U.beginAnimationTo,t.beginAnimationLoop=U.beginAnimationLoop,t.startDelay=U.startDelay,t.renderingGroupId=U.renderingGroupId,t.isBillboardBased=U.isBillboardBased,t.billboardMode=U.billboardMode,t.minAngularSpeed=U.minAngularSpeed,t.maxAngularSpeed=U.maxAngularSpeed,t.minSize=U.minSize,t.maxSize=U.maxSize,t.minScaleX=U.minScaleX,t.maxScaleX=U.maxScaleX,t.minScaleY=U.minScaleY,t.maxScaleY=U.maxScaleY,t.minEmitPower=U.minEmitPower,t.maxEmitPower=U.maxEmitPower,t.minLifeTime=U.minLifeTime,t.maxLifeTime=U.maxLifeTime,t.emitRate=U.emitRate,t.gravity=U.gravity.bX(),t.noiseStrength=U.noiseStrength.bX(),t.color1=U.color1.bX(),t.color2=U.color2.bX(),t.colorDead=U.colorDead.bX(),t.updateSpeed=U.updateSpeed,t.targetStopDuration=U.targetStopDuration,t.blendMode=U.blendMode,t.preWarmCycles=U.preWarmCycles,t.preWarmStepOffset=U.preWarmStepOffset,t.minInitialRotation=U.minInitialRotation,t.maxInitialRotation=U.maxInitialRotation,t.startSpriteCellID=U.startSpriteCellID,t.spriteCellLoop=U.spriteCellLoop,t.endSpriteCellID=U.endSpriteCellID,t.spriteCellChangeSpeed=U.spriteCellChangeSpeed,t.spriteCellWidth=U.spriteCellWidth,t.spriteCellHeight=U.spriteCellHeight,t.spriteRandomStartCell=U.spriteRandomStartCell,t.isAnimationSheetEnabled=U.isAnimationSheetEnabled,t.useLogarithmicDepth=U.useLogarithmicDepth;const I=U.getColorGradients();if(I){t.colorGradients=[];for(const U of I){const y={gradient:U.gradient,color1:U.color1.bX()};U.color2?y.color2=U.color2.bX():y.color2=U.color1.bX(),t.colorGradients.push(y)}}const r=U.getRampGradients();if(r){t.rampGradients=[];for(const U of r){const y={gradient:U.gradient,color:U.color.bX()};t.rampGradients.push(y)}t.useRampGradients=U.useRampGradients}const Y=U.getColorRemapGradients();if(Y){t.colorRemapGradients=[];for(const U of Y){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.colorRemapGradients.push(y)}}const mt=U.getAlphaRemapGradients();if(mt){t.alphaRemapGradients=[];for(const U of mt){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.alphaRemapGradients.push(y)}}const X=U.getSizeGradients();if(X){t.sizeGradients=[];for(const U of X){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.sizeGradients.push(y)}}const P=U.getAngularSpeedGradients();if(P){t.angularSpeedGradients=[];for(const U of P){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.angularSpeedGradients.push(y)}}const G=U.getVelocityGradients();if(G){t.velocityGradients=[];for(const U of G){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.velocityGradients.push(y)}}const M=U.getDragGradients();if(M){t.dragGradients=[];for(const U of M){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.dragGradients.push(y)}}const L=U.getEmitRateGradients();if(L){t.emitRateGradients=[];for(const U of L){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.emitRateGradients.push(y)}}const h=U.getStartSizeGradients();if(h){t.startSizeGradients=[];for(const U of h){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.startSizeGradients.push(y)}}const Q=U.getLifeTimeGradients();if(Q){t.lifeTimeGradients=[];for(const U of Q){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.lifeTimeGradients.push(y)}}const F=U.getLimitVelocityGradients();if(F){t.limitVelocityGradients=[];for(const U of F){const y={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?y.factor2=U.factor2:y.factor2=U.factor1,t.limitVelocityGradients.push(y)}t.limitVelocityDamping=U.limitVelocityDamping}U.noiseTexture&&(t.noiseTexture=U.noiseTexture.serialize())}clone(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const I={...this._customWrappers};let r=null;const Y=this._engine;if(Y.createEffectForParticles&&null!=this.customShader){r=this.customShader;const t=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"",U=Y.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,t);I[0]?I[0].effect=U:this.setCustomEffect(U,0)}const mt=this.serialize(y),X=XU.Parse(mt,this._scene||this._engine,this._rootUrl);return X.name=t,X.customShader=r,X._customWrappers=I,void 0===U&&(U=this.my),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.my=U,this.preventAutoStart||X.start(),X}}XU.BILLBOARDMODE_Y=2,XU.BILLBOARDMODE_ALL=7,XU.BILLBOARDMODE_STRETCHED=8,XU.BILLBOARDMODE_STRETCHED_LOCAL=9,At._ParseParticleSystem=XU.Parse;var PU=y(12662),GU=y(12653),MU=y(12537);MU.c.prototype.createTransformFeedback=function(){const t=this._gl.createTransformFeedback();if(!t)throw new Error("Unable to create Transform Feedback");return t},MU.c.prototype.deleteTransformFeedback=function(t){this._gl.deleteTransformFeedback(t)},MU.c.prototype.bindTransformFeedback=function(t){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,t)},MU.c.prototype.beginTransformFeedback=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(t?this._gl.POINTS:this._gl.TRIANGLES)},MU.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},MU.c.prototype.setTranformFeedbackVaryings=function(t,U){this._gl.transformFeedbackVaryings(t,U,this._gl.INTERLEAVED_ATTRIBS)},MU.c.prototype.bindTransformFeedbackBuffer=function(t){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t?t.underlyingResource:null)},MU.c.prototype.readTransformFeedbackBuffer=function(t){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t)};const LU="clipPlaneFragmentDeclaration2",hU="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";f.e.IncludesShadersStore[LU]||(f.e.IncludesShadersStore[LU]=hU);y(13461),y(13464),y(13468),y(13470),y(13476),y(13482),y(13485),y(13489);const QU="gpuRenderParticlesPixelShader",FU="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";f.e.ShadersStore[QU]||(f.e.ShadersStore[QU]=FU);const EU="clipPlaneVertexDeclaration2",wU="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";f.e.IncludesShadersStore[EU]||(f.e.IncludesShadersStore[EU]=wU);y(13498),y(13507),y(13515),y(13519);const DU="gpuRenderParticlesVertexShader",lU="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";f.e.ShadersStore[DU]||(f.e.ShadersStore[DU]=lU);class gU extends P{static get IsSupported(){if(!T.d.LastCreatedEngine)return!1;const t=T.d.LastCreatedEngine.getCaps();return t.supportTransformFeedbacks||t.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(t){this._maxActiveParticleCount=Math.min(t,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(t){this.maxActiveParticleCount=t}createPointEmitter(t,U){const y=Ct(t,U);return this.particleEmitterType=y,y}createHemisphericEmitter(){const t=Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=ut(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=Tt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new I.DU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=zt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=tU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new I.DU(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=yU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I.DU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I.DU(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,U,y,I){const r=new L;return this.particleEmitterType=r,this.direction1=t,this.direction2=U,this.minEmitBox=y,this.maxEmitBox=I,r}get flowMap(){return this._flowMap}set flowMap(t){this._flowMap!==t&&(this._flowMap=t)}isReady(){if(!this.my||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==XU.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(XU.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(XU.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";t?setTimeout((()=>{this.start(0)}),t):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var t;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[U])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new tt.e(this._engine),this._customWrappers[U].effect=t}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(t,U,y){return super._removeGradientAndTexture(t,U,y),this._releaseBuffers(),this}addColorGradient(t,U){this._colorGradients||(this._colorGradients=[]);const y=new W(t,U);return this._colorGradients.push(y),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(t&&this._colorGradients.sort(((t,U)=>t.gradient<U.gradient?-1:t.gradient>U.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(t){return this._removeGradientAndTexture(t,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const U in this._drawWrappers){var t;null===(t=this._drawWrappers[U].drawContext)||void 0===t||t.reset()}}_addFactorGradient(t,U,y){const I=new K(U,y);t.push(I),this._releaseBuffers()}addSizeGradient(t,U){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,t,U),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(t){return this._removeGradientAndTexture(t,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(t,U){if(!t)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&t.sort(((t,U)=>t.gradient<U.gradient?-1:t.gradient>U.gradient?1:0));const y=this;y[U]&&(y[U].dispose(),y[U]=null)}addAngularSpeedGradient(t,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,t,U),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(t){return this._removeGradientAndTexture(t,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(t,U){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,t,U),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(t){return this._removeGradientAndTexture(t,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(t,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,t,U),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(t){return this._removeGradientAndTexture(t,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(t,U){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,t,U),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(t){return this._removeGradientAndTexture(t,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(t){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(t),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.FX=new R.b,this.onStoppedObservable=new R.b,this.onStartedObservable=new R.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,y&&"Scene"!==y.getClassName()?(this._engine=y,this.defaultProjectionMatrix=I.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=y||T.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.mQ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=r,this._drawWrappers={0:new tt.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(U=U??{}).randomTextureSize||delete U.randomTextureSize;const mt={fU:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...U},P=U;isFinite(P)&&(mt.fU=P),this._capacity=mt.fU,this._maxActiveParticleCount=mt.fU,this._currentActiveCount=0,this._isAnimationSheetEnabled=Y,this.particleEmitterType=new L;const G=Math.min(this._engine.getCaps().maxTextureSize,mt.randomTextureSize);let M=[];for(let I=0;I<G;++I)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture=new u.b(new Float32Array(M),G,1,5,y,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,M=[];for(let I=0;I<G;++I)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture2=new u.b(new Float32Array(M),G,1,5,y,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=G}_reset(){this._releaseBuffers()}_createVertexBuffers(t,U,y){const I={};I.position=U.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let r=3;I.age=U.createVertexBuffer("age",r,1,this._attributesStrideSize,!0),r+=1,I.size=U.createVertexBuffer("size",r,3,this._attributesStrideSize,!0),r+=3,I.life=U.createVertexBuffer("life",r,1,this._attributesStrideSize,!0),r+=1,r+=4,this.billboardMode===XU.BILLBOARDMODE_STRETCHED&&(I.direction=U.createVertexBuffer("direction",r,3,this._attributesStrideSize,!0)),r+=3,this._platform.alignDataInBuffer&&(r+=1),this.particleEmitterType instanceof B&&(r+=3,this._platform.alignDataInBuffer&&(r+=1)),this._colorGradientsTexture||(I.color=U.createVertexBuffer("color",r,4,this._attributesStrideSize,!0),r+=4),this._isBillboardBased||(I.initialDirection=U.createVertexBuffer("initialDirection",r,3,this._attributesStrideSize,!0),r+=3,this._platform.alignDataInBuffer&&(r+=1)),this.noiseTexture&&(I.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",r,3,this._attributesStrideSize,!0),r+=3,this._platform.alignDataInBuffer&&(r+=1),I.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",r,3,this._attributesStrideSize,!0),r+=3,this._platform.alignDataInBuffer&&(r+=1)),I.angle=U.createVertexBuffer("angle",r,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?r++:r+=2,this._isAnimationSheetEnabled&&(I.cellIndex=U.createVertexBuffer("cellIndex",r,1,this._attributesStrideSize,!0),r+=1,this.spriteRandomStartCell&&(I.cellStartOffset=U.createVertexBuffer("cellStartOffset",r,1,this._attributesStrideSize,!0),r+=1)),I.offset=y.createVertexBuffer("offset",0,2),I.uv=y.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(I),this._platform.createVertexBuffers(t,I),this.resetDrawCache()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!t)return;const U=this._engine,y=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof B&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const r=this.particleEmitterType instanceof B,Y=I.TmpVectors.DU[0];let mt=0;for(let I=0;I<this._capacity;I++)if(y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),r?(this.particleEmitterType.particleDestinationGenerator(I,null,Y),y.push(Y.x),y.push(Y.y),y.push(Y.z)):(y.push(0),y.push(0),y.push(0)),this._platform.alignDataInBuffer&&y.push(0),mt+=16,r&&(this.particleEmitterType.particlePositionGenerator(I,null,Y),y.push(Y.x),y.push(Y.y),y.push(Y.z),this._platform.alignDataInBuffer&&y.push(0),mt+=4),this._colorGradientsTexture||(y.push(0),y.push(0),y.push(0),y.push(0),mt+=4),this.isBillboardBased||(y.push(0),y.push(0),y.push(0),this._platform.alignDataInBuffer&&y.push(0),mt+=4),this.noiseTexture&&(y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),this._platform.alignDataInBuffer&&y.push(0),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),this._platform.alignDataInBuffer&&y.push(0),mt+=8),y.push(0),mt+=1,this._angularSpeedGradientsTexture||(y.push(0),mt+=1),this._isAnimationSheetEnabled&&(y.push(0),mt+=1,this.spriteRandomStartCell&&(y.push(0),mt+=1)),this._platform.alignDataInBuffer){let t=3-(mt+3&3);for(mt+=t;t-- >0;)y.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),P=this._platform.createParticleBuffer(y),G=this._platform.createParticleBuffer(y);this._buffer0=new b.b(U,P,!1,this._attributesStrideSize),this._buffer1=new b.b(U,G,!1,this._attributesStrideSize),this._spriteBuffer=new b.b(U,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let t=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(t+="\n#define BILLBOARD"),this._colorGradientsTexture&&(t+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(t+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(t+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(t+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(t+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(t+="\n#define DRAGGRADIENTS"),this._flowMap&&(t+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(t+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(t+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(t+="\n#define NOISE"),this.isLocal&&(t+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===t||(this._cachedUpdateDefines=t,this._updateBuffer=this._platform.createUpdateBuffer(t)),this._platform.isUpdateBufferReady()}_getWrapper(t){const U=this._getCustomDrawWrapper(t);if(null!==U&&void 0!==U&&U.effect)return U;const y=[];this.fillDefines(y,t);let I=this._drawWrappers[t];I||(I=new tt.e(this._engine),I.drawContext&&(I.drawContext.useInstancing=!0),this._drawWrappers[t]=I);const r=y.join("\n");if(I.defines!==r){const t=[],U=[],y=[];this.fillUniformsAttributesAndSamplerNames(U,t,y),I.setEffect(this._engine.createEffect("gpuRenderParticles",t,U,y,r),r)}return I}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=[b.e.PositionKind,"age","life","size","angle"];return t||r.push(b.e.ColorKind),U&&r.push("cellIndex"),y||r.push("initialDirection"),I&&r.push("direction"),r.push("offset",b.e.UVKind),r}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const I=["emitterWM","pG","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Ut.d)(I),t&&I.push("sheetInfos"),U&&I.push("logarithmicDepthConstant"),y&&(I.push("vFogInfos"),I.push("vFogColor")),I}fillDefines(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ut.k)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==GU.e.FOGMODE_NONE&&t.push("#define FOG")),U===XU.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this.isLocal&&t.push("#define LOCAL"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case XU.BILLBOARDMODE_Y:t.push("#define BILLBOARDY");break;case XU.BILLBOARDMODE_STRETCHED:t.push("#define BILLBOARDSTRETCHED");break;case XU.BILLBOARDMODE_ALL:t.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&t.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,U,y){U.push(...gU._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===XU.BILLBOARDMODE_STRETCHED)),t.push(...gU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),y.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(PU.e.PrepareUniforms(t,this._imageProcessingConfigurationDefines),PU.e.PrepareSamplers(y,this._imageProcessingConfigurationDefines))}animate(){var t;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(U?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(t,U){const y=this[U];if(!t||!t.length||y)return;const I=new Float32Array(this._rawTextureWidth);for(let r=0;r<this._rawTextureWidth;r++){const U=r/this._rawTextureWidth;C.GetCurrentGradient(U,t,((t,U,y)=>{I[r]=(0,G.Lerp)(t.factor1,U.factor1,y)}))}this[U]=u.b.CreateRTexture(I,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[U].name=U.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const t=new Uint8Array(4*this._rawTextureWidth),U=mt.TmpColors.HX[0];for(let y=0;y<this._rawTextureWidth;y++){const I=y/this._rawTextureWidth;C.GetCurrentGradient(I,this._colorGradients,((I,r,Y)=>{mt.HX.LerpToRef(I.color1,r.color1,Y,U),t[4*y]=255*U.r,t[4*y+1]=255*U.g,t[4*y+2]=255*U.b,t[4*y+3]=255*U.a}))}this._colorGradientsTexture=u.b.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(t,U){var y,r,Y,mt;const X=this._getWrapper(t),P=X.effect;this._engine.enableEffect(X);const G=(null===(y=this._scene)||void 0===y?void 0:y.getViewMatrix())||I.Matrix.IdentityReadOnly;if(P.setMatrix("view",G),P.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),P.setTexture("diffuseSampler",this.particleTexture),P.setVector2("translationPivot",this.translationPivot),P.setVector3("pG",this.pG),this.isLocal&&P.setMatrix("emitterWM",U),this._colorGradientsTexture?P.setTexture("colorGradientSampler",this._colorGradientsTexture):P.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();P.setFloat3("sheetInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,t.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;P.setVector3("eyePosition",t.globalPosition)}const M=P.defines;if(this._scene&&((0,Ut.e)(P,this,this._scene),this.applyFog&&(0,yt.e)(this._scene,void 0,P)),M.indexOf("#define BILLBOARDMODE_ALL")>=0){const t=G.clone();t.invert(),P.setMatrix("invView",t)}return this.useLogarithmicDepth&&this._scene&&(0,yt.h)(M,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),this._setEngineBasedOnBlendMode(t),this._platform.bindDrawBuffers(this._targetIndex,P,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(mt=this._scene)&&void 0!==mt&&mt.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(t){if(!this.my||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!t)if(this.my.position){t=this.my.getWorldMatrix()}else{const U=this.my;t=I.TmpVectors.Matrix[0],I.Matrix.TranslationToRef(U.x,U.y,U.z,t)}const U=this._engine,y=U.getDepthWrite();if(U.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const t=this.St();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",t.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",t),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const r=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=r,U.setDepthWrite(y)}render(){let t,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!U&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let t=0;t<this.preWarmCycles;t++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const t=0|this._accumulatedCount;this._accumulatedCount-=t,this._currentActiveCount+=t}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.my.position){t=this.my.getWorldMatrix()}else{const U=this.my;t=I.TmpVectors.Matrix[0],I.Matrix.TranslationToRef(U.x,U.y,U.z,t)}const r=this._engine;this.updateInAnimate||this._update(t);let Y=0;return U||y||(r.setState(!1),this.forceDepthWrite&&r.setDepthWrite(!0),Y=this.blendMode===XU.BLENDMODE_MULTIPLYADD?this._render(XU.BLENDMODE_MULTIPLY,t)+this._render(XU.BLENDMODE_ADD,t):this._render(this.blendMode,t),this._engine.setAlphaMode(0)),Y}rebuild(){const t=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(t,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,t()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const U in this._drawWrappers){this._drawWrappers[U].dispose()}if(this._drawWrappers={},this._scene){const t=this._scene.mQ.indexOf(this);t>-1&&this._scene.mQ.splice(t,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let U=0;U<this._renderVertexBuffers.length;++U){const t=this._renderVertexBuffers[U];for(const U in t)t[U].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.FX.notifyObservers(this),this.FX.clear()}clone(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const I={...this._customWrappers};let r=null;const Y=this._engine;if(Y.createEffectForParticles&&null!=this.customShader){r=this.customShader;const t=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"";I[0]=Y.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,t,void 0,void 0,void 0,this)}const mt=this.serialize(y),X=gU.Parse(mt,this._scene||this._engine,this._rootUrl);return X.name=t,X.customShader=r,X._customWrappers=I,void 0===U&&(U=this.my),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.my=U,X}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return XU._Serialize(U,this,t),U.activeParticleCount=this.activeParticleCount,U.randomTextureSize=this._randomTextureSize,U.customShader=this.customShader,U}static Parse(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;const Y=t.name;let mt,X;U instanceof Kt.e?mt=U:(X=U,mt=X.getEngine());const P=new gU(Y,{fU:r||t.fU,randomTextureSize:t.randomTextureSize},U,null,t.isAnimationSheetEnabled);if(P._rootUrl=y,t.customShader&&mt.createEffectForParticles){const U=t.customShader,y=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",I=mt.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,y,void 0,void 0,void 0,P);P.setCustomEffect(I,0),P.customShader=U}return t.id&&(P.id=t.id),t.activeParticleCount&&(P.activeParticleCount=t.activeParticleCount),XU._Parse(t,P,U,y),t.preventAutoStart&&(P.preventAutoStart=t.preventAutoStart),I||P.preventAutoStart||P.start(),P}}var BU=y(12198),bU=y(13527),pU=y(12794);class cU{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(t){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const U of this.systems)U.my=t;this._emitterNode=t}setEmitterAsSphere(t,U,y){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:U};const I=(0,bU.d)("emitterSphere",{diameter:t.diameter,segments:t.segments},y);I.renderingGroupId=U;const r=new pU.BU("emitterSphereMaterial",y);r.emissiveColor=t.color,I.material=r;for(const Y of this.systems)Y.my=I;this._emitterNode=I}start(t){for(const U of this.systems)t&&(U.my=t),U.start()}dispose(){for(const t of this.systems)t.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={systems:[]};for(const y of this.systems)U.systems.push(y.serialize(t));return this._emitterNode&&(U.my=this._emitterCreationOptions),U}static Parse(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3?arguments[3]:void 0;const r=new cU,Y=this.BaseAssetsUrl+"/textures/";U=U||T.d.LastCreatedScene;for(const mt of t.systems)r.systems.push(y?gU.Parse(mt,U,Y,!0,I):XU.Parse(mt,U,Y,!0,I));if(t.my){const y=t.my.options;if("Sphere"===t.my.kind)r.setEmitterAsSphere({diameter:y.diameter,segments:y.segments,color:mt.bU.pU(y.color)},t.my.renderingGroupId,U)}return r}}cU.BaseAssetsUrl="https://assets.babylonjs.com/particles";var fU=y(12248);class SU{static CreateDefault(t){let U,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,I=arguments.length>2?arguments[2]:void 0;U=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new gU("default system",{fU:y},I):new XU("default system",y,I),U.my=t;const r=BU.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return U.particleTexture=new e.d(r,U.St()),U.createConeEmitter(.1,Math.PI/4),U.color1=new mt.HX(1,1,1,1),U.color2=new mt.HX(1,1,1,1),U.colorDead=new mt.HX(1,1,1,0),U.minSize=.1,U.maxSize=.1,U.minEmitPower=2,U.maxEmitPower=2,U.updateSpeed=1/60,U.emitRate=30,U}static CreateAsync(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3?arguments[3]:void 0;U||(U=T.d.LastCreatedScene);const r={};return U.addPendingData(r),new Promise(((Y,mt)=>{if(y&&!gU.IsSupported)return U.removePendingData(r),mt("Particle system with GPU is not supported.");BU.Tools.LoadFile(`${SU.BaseAssetsUrl}/systems/${t}.json`,(t=>{U.removePendingData(r);const mt=JSON.parse(t.toString());return Y(cU.Parse(mt,U,y,I))}),void 0,void 0,void 0,(()=>(U.removePendingData(r),mt(`An error occurred with the creation of your particle system. Check if your type '${t}' exists.`))))}))}static ExportSet(t){const U=new cU;for(const y of t)U.systems.push(y);return U}static ParseFromFileAsync(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Y=arguments.length>5?arguments[5]:void 0;return new Promise(((mt,X)=>{const P=new fU.d;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const U=JSON.parse(P.responseText);let X;X=I?gU.Parse(U,y,r,!1,Y):XU.Parse(U,y,r,!1,Y),t&&(X.name=t),mt(X)}else X("Unable to load the particle system")})),P.open("GET",U),P.send()}))}static ParseFromSnippetAsync(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4?arguments[4]:void 0;if("_BLANK"===t){const t=this.CreateDefault(null);return t.start(),Promise.resolve(t)}return new Promise(((Y,mt)=>{const X=new fU.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const mt=JSON.parse(JSON.parse(X.responseText).jsonPayload),P=JSON.parse(mt.particleSystem);let G;G=y?gU.Parse(P,U,I,!1,r):XU.Parse(P,U,I,!1,r),G.snippetId=t,Y(G)}else mt("Unable to load the snippet "+t)})),X.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),X.send()}))}}SU.BaseAssetsUrl=cU.BaseAssetsUrl,SU.SnippetUrl="https://snippet.babylonjs.com",SU.CreateFromSnippetAsync=SU.ParseFromSnippetAsync;var NU=y(12868),jU=y(12694),JU=y(13534);(0,JU.g)(jU.b.NAME_PARTICLESYSTEM,((t,U,y,I)=>{const r=(0,JU.j)(jU.b.NAME_PARTICLESYSTEM);if(r&&void 0!==t.mQ&&null!==t.mQ)for(let Y=0,mt=t.mQ.length;Y<mt;Y++){const mt=t.mQ[Y];y.mQ.push(r(mt,U,I))}})),(0,JU.c)(jU.b.NAME_PARTICLESYSTEM,((t,U,y)=>{if(t.activeParticleCount){return gU.Parse(t,U,y)}return XU.Parse(t,U,y)})),Kt.e.prototype.createEffectForParticles=function(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Y=arguments.length>4?arguments[4]:void 0,mt=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,P=arguments.length>7?arguments[7]:void 0,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9?arguments[9]:void 0,L=[],h=[];const Q=[];return P?P.fillUniformsAttributesAndSamplerNames(h,L,Q):(L=XU._GetAttributeNamesOrOptions(),h=XU._GetEffectCreationOptions()),-1===r.indexOf(" BILLBOARD")&&(r+="\n#define BILLBOARD\n"),null!==P&&void 0!==P&&P.isAnimationSheetEnabled&&-1===r.indexOf(" ANIMATESHEET")&&(r+="\n#define ANIMATESHEET\n"),-1===I.indexOf("diffuseSampler")&&I.push("diffuseSampler"),this.createEffect({vertex:M??(null===P||void 0===P?void 0:P.vertexShaderName)??"particles",fragmentElement:t},L,h.concat(U),Q.concat(I),r,Y,mt,X,void 0,G,(async()=>{0===G?await Promise.resolve().then(y.bind(y,13568)):await Promise.resolve().then(y.bind(y,13637))}))},NU.c.prototype.getEmittedParticleSystems=function(){const t=[];for(let U=0;U<this.St().mQ.length;U++){const y=this.St().mQ[U];y.my===this&&t.push(y)}return t},NU.c.prototype.getHierarchyEmittedParticleSystems=function(){const t=[],U=this.getDescendants();U.push(this);for(let y=0;y<this.St().mQ.length;y++){const I=this.St().mQ[y],r=I.my;r.position&&-1!==U.indexOf(r)&&t.push(I)}return t};y(12758),y(12772),y(12844);y(12853),y(13537),y(12612),y(12743),y(12890);y(12605);var aU;y(13539),y(12413);!function(t){t[t.Color=2]="Color",t[t.UV=1]="UV",t[t.Random=0]="Random",t[t.Stated=3]="Stated"}(aU||(aU={}));var dU=y(12640);const qU=new I.DU(0,0,0),HU=new I.DU(0,0,0),eU=new I.DU(0,0,0);class oU{constructor(t,U,y){this.width=t,this.height=U,this.data=y}processFlowable(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;if(!y)return;y instanceof I.Matrix?I.DU.TransformCoordinatesToRef(t.position,y,eU):(eU.x=y.x,eU.y=y.y,eU.z=y.z);const r=.5*eU.x+.5,Y=1-(.5*eU.y+.5),mt=Math.floor(r*this.width),X=Math.floor(Y*this.height);if(mt<0||mt>=this.width||X<0||X>=this.height)return;const P=4*(X*this.width+mt),G=this.data[P]/255*2-1,M=this.data[P+1]/255*2-1,L=this.data[P+2]/255*2-1,h=this.data[P+3]/255;qU.set(G,M,L),qU.scaleToRef(U*h,HU),t.direction.addInPlace(HU)}_processParticle(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;this.processFlowable(t,U,y)}static async FromUrlAsync(t){return await new Promise(((U,y)=>{const I=document.createElement("canvas"),r=I.getContext("2d");let Y=null;const mt=new Image;mt.crossOrigin="anonymous",mt.src=t,mt.onerror=U=>{y(new Error(`Failed to load image: ${t} : ${U}`))},mt.onload=()=>{I.width=mt.width,I.height=mt.height,r.drawImage(mt,0,0),Y=r.getImageData(0,0,I.width,I.height),U(new oU(I.width,I.height,Y.data))}}))}static async ExtractFromTextureAsync(t){return await new Promise(((U,y)=>{if(!t.isReady())return void t.onLoadObservable.addOnce((async()=>{try{const y=await this.ExtractFromTextureAsync(t);U(y)}catch(I){y(I)}}));const I=t.getSize();dU.j.GetTextureDataAsync(t,I.width,I.height).then((t=>{U(new oU(I.width,I.height,new Uint8ClampedArray(t)))})).catch(y)}))}}var VU,nU,iU,vU,OU,kU,sU,xU,ZU;!function(t){t[t.Int=1]="Int",t[t.Float=2]="Float",t[t.Vector2=4]="Vector2",t[t.DU=8]="DU",t[t.Matrix=16]="Matrix",t[t.Particle=32]="Particle",t[t.Texture=64]="Texture",t[t.HX=128]="HX",t[t.FloatGradient=256]="FloatGradient",t[t.Vector2Gradient=512]="Vector2Gradient",t[t.Vector3Gradient=1024]="Vector3Gradient",t[t.Color4Gradient=2048]="Color4Gradient",t[t.System=4096]="System",t[t.AutoDetect=8192]="AutoDetect",t[t.BasedOnInput=16384]="BasedOnInput",t[t.Undefined=32768]="Undefined",t[t.All=65535]="All"}(VU||(VU={})),function(t){t[t.Compatible=0]="Compatible",t[t.TypeIncompatible=1]="TypeIncompatible",t[t.HierarchyIssue=2]="HierarchyIssue"}(nU||(nU={})),function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(iU||(iU={}));class WU{get direction(){return this._direction}get type(){if(this._type===VU.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===VU.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(t){this._type=t}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((t=>t.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(t,U,y){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=VU.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new R.b,this.onDisconnectionObservable=new R.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=U,this.name=t,this._direction=y}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(t){var U;return this.isConnected?null!==(U=this._connectedPoint)&&void 0!==U&&U._storedFunction?this._connectedPoint._storedFunction(t):this._connectedPoint._storedValue:this.value}canConnectTo(t){return 0===this.checkCompatibilityState(t)}checkCompatibilityState(t){const U=this._ownerBlock,y=t.ownerBlock;if(this.type!==t.type&&t.innerType!==VU.AutoDetect)return t.acceptedConnectionPointTypes&&-1!==t.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(t.excludedConnectionPointTypes&&-1!==t.excludedConnectionPointTypes.indexOf(this.type))return 1;let I=y,r=U;return 0===this.direction&&(I=U,r=y),I.isAnAncestorOf(r)?2:0}connectTo(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(t))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${t.ownerBlock.name}".${t.name}`;return this._endpoints.push(t),t._connectedPoint=this,this.onConnectionObservable.notifyObservers(t),t.onConnectionObservable.notifyObservers(this),this}disconnectFrom(t){const U=this._endpoints.indexOf(t);return-1===U||(this._endpoints.splice(U,1),t._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(t),t.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(t){let U=1;for(;U<VU.All;)t&U||this.excludedConnectionPointTypes.push(U),U<<=1}serialize(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U={};return U.name=this.name,U.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.bX?(U.valueType="BABYLON."+this.value.getClassName(),U.value=this.value.bX()):(U.valueType="number",U.value=this.value)),t&&this.connectedPoint&&(U.inputName=this.name,U.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,U.targetConnectionName=this.connectedPoint.name,U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),U}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class AU{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(t){this._name=t}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(t){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new R.b,this.FX=new R.b,this.onInputChangedObservable=new R.b,this.visibleOnFrame=!1,this._name=t,this.uniqueId=o.e.UniqueId}_inputRename(t){return t}_outputRename(t){return t}isAnAncestorOf(t){for(const U of this._outputs)if(U.hasEndpoints)for(const y of U.endpoints){if(y.ownerBlock===t)return!0;if(y.ownerBlock.isAnAncestorOf(t))return!0}return!1}isAnAncestorOfType(t){if(this.getClassName()===t)return!0;for(const U of this._outputs)if(U.hasEndpoints)for(const y of U.endpoints)if(y.ownerBlock.isAnAncestorOfType(t))return!0;return!1}getInputByName(t){const U=this._inputs.filter((U=>U.name===t));return U.length?U[0]:null}_linkConnectionTypes(t,U){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[U]._acceptedConnectionPointType=this._inputs[t]:(this._inputs[t]._linkedConnectionSource=this._inputs[U],this._inputs[t]._isMainLinkSource=!0),this._inputs[U]._linkedConnectionSource=this._inputs[t]}registerInput(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const mt=new WU(t,this,0);return mt.type=U,mt.isOptional=y,mt.defaultValue=I,mt.value=I,mt.valueMin=r,mt.valueMax=Y,this._inputs.push(mt),this.onInputChangedObservable.notifyObservers(mt),this}registerOutput(t,U,y){return(y=y??new WU(t,this,1)).type=U,this._outputs.push(y),this}_build(t){}_customBuildStep(t){}build(t){if(this._buildId===t.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((t=>t.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=t.buildId;for(const U of this._inputs){if(!U.connectedPoint){U.isOptional||t.notConnectedNonOptionalInputs.push(U);continue}const y=U.connectedPoint.ownerBlock;y&&y!==this&&!y.isSystem&&y.build(t)}return this._customBuildStep(t),t.verbose&&V.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(t),this.onBuildObservable.notifyObservers(this),!1}serialize(){const t={};t.customType="BABYLON."+this.getClassName(),t.id=this.uniqueId,t.name=this.name,t.visibleOnFrame=this.visibleOnFrame,t.inputs=[],t.outputs=[];for(const U of this.inputs)t.inputs.push(U.serialize());for(const U of this.outputs)t.outputs.push(U.serialize(!1));return t}_deserialize(t){this._name=t.name,this.comments=t.comments,this.visibleOnFrame=!!t.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(t)}_deserializePortDisplayNamesAndExposedOnFrame(t){const U=t.inputs,y=t.outputs;if(U)for(const I of U){const t=this.inputs.find((t=>t.name===I.name));if(!t)return;if(I.displayName&&(t.displayName=I.displayName),I.isExposedOnFrame&&(t.isExposedOnFrame=I.isExposedOnFrame,t.exposedPortPosition=I.exposedPortPosition),void 0!==I.value&&null!==I.value)if("number"===I.valueType)t.value=I.value;else{const U=(0,X.d)(I.valueType);U&&(t.value=U.pU(I.value))}}if(y)for(let I=0;I<y.length;I++){const t=y[I];t.displayName&&(this.outputs[I].displayName=t.displayName),t.isExposedOnFrame&&(this.outputs[I].isExposedOnFrame=t.isExposedOnFrame,this.outputs[I].exposedPortPosition=t.exposedPortPosition)}}clone(){const t=this.serialize(),U=(0,X.d)(t.customType);if(U){const y=new U;return y._deserialize(t),y}return null}dispose(){this.FX.notifyObservers(this),this.FX.clear();for(const t of this.inputs)t.dispose();for(const t of this.outputs)t.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function KU(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",I=arguments.length>3?arguments[3]:void 0;return(r,Y)=>{let mt=r._propStore;mt||(mt=[],r._propStore=mt),mt.push({propertyName:Y,displayName:t,type:U,groupName:y,options:I??{},className:r.getClassName()})}}(0,d.b)([(0,q.I)("comment")],AU.prototype,"comments",void 0),function(t){t[t.Boolean=0]="Boolean",t[t.Float=1]="Float",t[t.Int=2]="Int",t[t.Vector2=3]="Vector2",t[t.List=4]="List",t[t.HX=5]="HX",t[t.SamplingMode=6]="SamplingMode",t[t.TextureFormat=7]="TextureFormat",t[t.TextureType=8]="TextureType"}(vU||(vU={})),function(t){t[t.None=0]="None",t[t.Position=1]="Position",t[t.Direction=2]="Direction",t[t.Age=3]="Age",t[t.Lifetime=4]="Lifetime",t[t.Color=5]="Color",t[t.ScaledDirection=6]="ScaledDirection",t[t.Scale=7]="Scale",t[t.AgeGradient=8]="AgeGradient",t[t.Angle=9]="Angle",t[t.SpriteCellIndex=16]="SpriteCellIndex",t[t.SpriteCellStart=17]="SpriteCellStart",t[t.SpriteCellEnd=18]="SpriteCellEnd"}(OU||(OU={})),function(t){t[t.None=0]="None",t[t.Time=1]="Time",t[t.Delta=2]="Delta",t[t.Emitter=3]="Emitter"}(kU||(kU={}));class CU{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let t="";for(const U of this.notConnectedNonOptionalInputs)t+=`input ${U.name} from block ${U.ownerBlock.name}[${U.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(t)throw"Build of Node Particle System Set failed:\n"+t}adapt(t,U){const y=t.getConnectedValue(this)||0;if(t.type===U)return y;switch(U){case VU.Vector2:return new I.Vector2(y,y);case VU.DU:return new I.DU(y,y,y);case VU.HX:return new mt.HX(y,y,y,y)}return null}getContextualValue(t){if(!this.particleContext||!this.systemContext)return null;switch(t){case OU.Position:return this.particleContext.position;case OU.Direction:return this.particleContext.direction;case OU.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case OU.Color:return this.particleContext.color;case OU.Age:return this.particleContext.age;case OU.Lifetime:return this.particleContext.lifeTime;case OU.Angle:return this.particleContext.angle;case OU.Scale:return this.particleContext.scale;case OU.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case OU.SpriteCellEnd:return this.systemContext.endSpriteCellID;case OU.SpriteCellIndex:return this.particleContext.cellIndex;case OU.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.my.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.my.absolutePosition:this.systemContext.my:null}getSystemValue(t){if(!this.particleContext||!this.systemContext)return null;switch(t){case kU.Time:return this.systemContext._actualFrame;case kU.Delta:return this.systemContext._scaledUpdateSpeed;case kU.Emitter:if(this.isEmitterTransformNode){return this.systemContext.my.absolutePosition}return this.systemContext.my}return null}}function RU(t,U,y){const I=new CU;I.gU=U;const r=t.createSystem(I);return r.canStart=()=>!0,r.my=y.clone(),r.disposeOnStop=!0,r.start(),r}class uU extends AU{constructor(t){super(t),this.blendMode=P.BLENDMODE_ONEONE,this.fU=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",VU.Particle),this.registerInput("texture",VU.Texture),this.registerInput("onStart",VU.System,!0),this.registerInput("onEnd",VU.System,!0),this.registerOutput("system",VU.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(t){t.fU=this.fU,t.buildId=this._buildId++,this.build(t);const U=this.particle.getConnectedValue(t);return U.particleTexture=this.texture.getConnectedValue(t),U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.name=this.name,U._nodeGenerated=!0,U._targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,this.system._storedValue=this,U.canStart=()=>!this.doNoStart,U.onStartedObservable.add((y=>{const I=this.onStart.getConnectedValue(t);I&&y.onStartedObservable.addOnce((()=>{t.systemContext=U;const y=RU(I,t.gU,t.emitterPosition);this.FX.addOnce((()=>{y.dispose()}))}));const r=this.onEnd.getConnectedValue(t);r&&y.onStoppedObservable.addOnce((()=>{t.systemContext=U;const y=RU(r,t.gU,t.emitterPosition);this.FX.addOnce((()=>{y.dispose()}))}))})),this.FX.addOnce((()=>{U.dispose()})),U}serialize(){const t=super.serialize();return t.fU=this.fU,t.emitRate=this.emitRate,t.blendMode=this.blendMode,t.doNoStart=this.doNoStart,t.targetStopDuration=this.targetStopDuration,t.startDelay=this.startDelay,t}_deserialize(t){super._deserialize(t),this.fU=t.fU,this.emitRate=t.emitRate,this.doNoStart=!!t.doNoStart,void 0!==t.blendMode&&(this.blendMode=t.blendMode),void 0!==t.targetStopDuration&&(this.targetStopDuration=t.targetStopDuration),void 0!==t.startDelay&&(this.startDelay=t.startDelay)}}(0,d.b)([KU("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:P.BLENDMODE_ONEONE},{label:"Standard",value:P.BLENDMODE_STANDARD},{label:"Add",value:P.BLENDMODE_ADD},{label:"Multiply",value:P.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:P.BLENDMODE_MULTIPLYADD}]})],uU.prototype,"blendMode",void 0),(0,d.b)([KU("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],uU.prototype,"fU",void 0),(0,d.b)([KU("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uU.prototype,"emitRate",void 0),(0,d.b)([KU("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uU.prototype,"targetStopDuration",void 0),(0,d.b)([KU("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uU.prototype,"startDelay",void 0),(0,d.b)([KU("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uU.prototype,"doNoStart",void 0),(0,X.f)("BABYLON.SystemBlock",uU);class TU extends AU{get type(){if(this._type===VU.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=VU.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=VU.Vector2,this._type;case"DU":return this._type=VU.DU,this._type;case"HX":return this._type=VU.HX,this._type;case"Matrix":return this._type=VU.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===OU.None&&this._systemSource!==kU.None}get systemSource(){return this._systemSource}set systemSource(t){if(this._systemSource=t,t!==kU.None){switch(this._contextualSource=OU.None,this._type=VU.Float,t){case kU.Time:case kU.Delta:this._type=VU.Float;break;case kU.Emitter:this._type=VU.DU}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==OU.None}get contextualValue(){return this._contextualSource}set contextualValue(t){if(this._contextualSource=t,t!==OU.None){switch(this._systemSource=kU.None,t){case OU.Scale:this._type=VU.Vector2;break;case OU.Position:case OU.Direction:case OU.ScaledDirection:this._type=VU.DU;break;case OU.Color:this._type=VU.HX;break;case OU.Age:case OU.Lifetime:case OU.Angle:case OU.AgeGradient:this._type=VU.Float;break;case OU.SpriteCellEnd:case OU.SpriteCellStart:case OU.SpriteCellIndex:this._type=VU.Int}this.output&&(this.output.type=this._type)}}constructor(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:VU.AutoDetect;super(t),this._type=VU.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new R.b,this._systemSource=kU.None,this._contextualSource=OU.None,this._type=U,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",U)}get value(){return this._storedValue}set value(t){this.type===VU.Float&&this.min!==this.max&&(t=Math.max(this.min,t),t=Math.min(this.max,t)),this._storedValue=t,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(t){this._valueCallback=t}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case VU.Int:case VU.Float:this.value=0;break;case VU.Vector2:this.value=I.Vector2.Zero();break;case VU.DU:this.value=I.DU.Zero();break;case VU.HX:this.value=new mt.HX(1,1,1,1);break;case VU.Matrix:this.value=I.Matrix.Identity()}}_build(t){super._build(t),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=t=>t.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=t=>t.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const t=super.serialize();return t.type=this.type,t.contextualValue=this.contextualValue,t.systemSource=this.systemSource,t.min=this.min,t.max=this.max,t.groupInInspector=this.groupInInspector,t.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.bX?(t.valueType="BABYLON."+this._storedValue.getClassName(),t.value=this._storedValue.bX()):(t.valueType="number",t.value=this._storedValue)),t}_deserialize(t){if(super._deserialize(t),this._type=t.type,this.contextualValue=t.contextualValue,this.systemSource=t.systemSource||kU.None,this.min=t.min||0,this.max=t.max||0,this.groupInInspector=t.groupInInspector||"",void 0!==t.displayInInspector&&(this.displayInInspector=t.displayInInspector),t.valueType)if("number"===t.valueType)this._storedValue=t.value;else{const U=(0,X.d)(t.valueType);U&&(this._storedValue=U.pU(t.value))}}}(0,X.f)("BABYLON.ParticleInputBlock",TU);class zU extends AU{get url(){return this._url}set url(t){this._url!==t&&(this._cachedData=null,this._url=t,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(t){this._textureDataUrl!==t&&(this._cachedData=null,this._textureDataUrl=t,this._url="",this._sourceTexture=null)}set sourceTexture(t){this._sourceTexture!==t&&(this._cachedData=null,this._sourceTexture=t,this._url="",this._textureDataUrl="")}constructor(t){super(t),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",VU.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const t=this.texture._storedValue;return await new Promise(((U,y)=>{if(!t.isReady())return void t.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),U(this._cachedData)}catch(t){y(t)}}));const I=t.getSize();dU.j.GetTextureDataAsync(t,I.width,I.height).then((y=>{this._cachedData={width:I.width,height:I.height,data:new Uint8ClampedArray(y)},t.dispose(),U(this._cachedData)})).catch(y)}))}_build(t){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new e.d(this._textureDataUrl,t.gU):this.texture._storedValue=new e.d(this._url,t.gU):this.texture._storedValue=null}serialize(){const t=super.serialize();return t.url=this.url,t.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(t.textureDataUrl=this.textureDataUrl),t}_deserialize(t){super._deserialize(t),this.url=t.url,this.serializedCachedData=!!t.serializedCachedData,t.textureDataUrl&&(this.textureDataUrl=t.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,X.f)("BABYLON.ParticleTextureSourceBlock",zU);class ty extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("position",VU.DU),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(t){const U=this.particle.getConnectedValue(t);if(this.output._storedValue=U,!this.position.isConnected)return;const y={process:y=>{t.particleContext=y,t.systemContext=U,y.position.Y(this.position.getConnectedValue(t))},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y}}(0,X.f)("BABYLON.UpdatePositionBlock",ty),function(t){t[t.Add=0]="Add",t[t.Subtract=1]="Subtract",t[t.Multiply=2]="Multiply",t[t.Divide=3]="Divide",t[t.Max=4]="Max",t[t.Min=5]="Min"}(sU||(sU={}));class Uy extends AU{constructor(t){super(t),this.operation=sU.Add,this.registerInput("left",VU.AutoDetect),this.registerInput("right",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this.output._typeConnectionSource=this.left;const U=[VU.Matrix,VU.Particle,VU.Texture,VU.System,VU.FloatGradient,VU.Color4Gradient,VU.Vector2Gradient,VU.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...U),this.right.excludedConnectionPointTypes.push(...U),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(t){let U;const y=this.left,r=this.right;if(!y.isConnected||!r.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Y=y.type===VU.Float||y.type===VU.Int,X=r.type===VU.Float||r.type===VU.Int,P=Y&&X;switch(this.operation){case sU.Add:U=P?t=>y.getConnectedValue(t)+r.getConnectedValue(t):Y?t=>t.adapt(y,r.type).add(r.getConnectedValue(t)):t=>y.getConnectedValue(t).add(t.adapt(r,y.type));break;case sU.Subtract:U=P?t=>y.getConnectedValue(t)-r.getConnectedValue(t):Y?t=>t.adapt(y,r.type).lU(r.getConnectedValue(t)):t=>y.getConnectedValue(t).lU(t.adapt(r,y.type));break;case sU.Multiply:U=P?t=>y.getConnectedValue(t)*r.getConnectedValue(t):Y?t=>t.adapt(y,r.type).multiply(r.getConnectedValue(t)):t=>y.getConnectedValue(t).multiply(t.adapt(r,y.type));break;case sU.Divide:U=P?t=>y.getConnectedValue(t)/r.getConnectedValue(t):Y?t=>t.adapt(y,r.type).divide(r.getConnectedValue(t)):t=>y.getConnectedValue(t).divide(t.adapt(r,y.type));break;case sU.Min:if(P)U=t=>Math.min(y.getConnectedValue(t),r.getConnectedValue(t));else{const[t,X]=Y?[r,y]:[y,r];switch(t.type){case VU.Vector2:U=U=>I.Vector2.Minimize(t.getConnectedValue(U),U.adapt(X,t.type));break;case VU.DU:U=U=>I.DU.Minimize(t.getConnectedValue(U),U.adapt(X,t.type));break;case VU.HX:U=U=>{const y=t.getConnectedValue(U),{r:I,g:r,b:Y,a:P}=U.adapt(X,t.type);return new mt.HX(Math.min(y.r,I),Math.min(y.g,r),Math.min(y.b,Y),Math.min(y.a,P))}}}break;case sU.Max:if(!P){const[t,X]=Y?[r,y]:[y,r];switch(t.type){case VU.Vector2:U=U=>I.Vector2.Maximize(t.getConnectedValue(U),U.adapt(X,t.type));break;case VU.DU:U=U=>I.DU.Maximize(t.getConnectedValue(U),U.adapt(X,t.type));break;case VU.HX:U=U=>{const y=t.getConnectedValue(U),{r:I,g:r,b:Y,a:P}=U.adapt(X,t.type);return new mt.HX(Math.max(y.r,I),Math.min(y.g,r),Math.min(y.b,Y),Math.min(y.a,P))}}break}U=t=>Math.max(y.getConnectedValue(t),r.getConnectedValue(t))}this.output._storedFunction=t=>y.type===VU.Int?0|U(t):U(t)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===VU.Int||this.left.type===VU.Float&&this.right.type!==VU.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[t,U]of[[this.left,this.right],[this.right,this.left]])t.acceptedConnectionPointTypes=[VU.Int,VU.Float],U.isConnected&&(t.acceptedConnectionPointTypes.push(U.type),U.type!==VU.Int&&U.type!==VU.Float||t.acceptedConnectionPointTypes.push(VU.Vector2,VU.DU,VU.HX))}dispose(){super.dispose();for(const t of this._connectionObservers)t.remove();this._connectionObservers.length=0}serialize(){const t=super.serialize();return t.operation=this.operation,t}_deserialize(t){super._deserialize(t),this.operation=t.operation}}(0,d.b)([KU("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:sU.Add},{label:"Subtract",value:sU.Subtract},{label:"Multiply",value:sU.Multiply},{label:"Divide",value:sU.Divide},{label:"Max",value:sU.Max},{label:"Min",value:sU.Min}]})],Uy.prototype,"operation",void 0),(0,X.f)("BABYLON.ParticleMathBlock",Uy);class yy extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("direction1",VU.DU,!0,new I.DU(0,1,0)),this.registerInput("direction2",VU.DU,!0,new I.DU(0,1,0)),this.registerInput("minEmitBox",VU.DU,!0,new I.DU(-.5,-.5,-.5)),this.registerInput("maxEmitBox",VU.DU,!0,new I.DU(.5,.5,.5)),this.registerOutput("output",VU.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(t){const U=this.particle.getConnectedValue(t);U._directionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.direction1.getConnectedValue(t),Y=this.direction2.getConnectedValue(t),mt=(0,G.RandomRange)(r.x,Y.x),X=(0,G.RandomRange)(r.y,Y.y),P=(0,G.RandomRange)(r.z,Y.z);t.isEmitterTransformNode?I.DU.TransformNormalFromFloatsToRef(mt,X,P,t.emitterWorldMatrix,y.direction):y.direction.aX(mt,X,P)},U._positionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.minEmitBox.getConnectedValue(t),Y=this.maxEmitBox.getConnectedValue(t),mt=(0,G.RandomRange)(r.x,Y.x),X=(0,G.RandomRange)(r.y,Y.y),P=(0,G.RandomRange)(r.z,Y.z);t.isEmitterTransformNode?I.DU.TransformCoordinatesFromFloatsToRef(mt,X,P,t.emitterWorldMatrix,y.position):(y.position.aX(mt,X,P),y.position.addInPlace(t.emitterPosition))},this.output._storedValue=U}}(0,X.f)("BABYLON.BoxShapeBlock",yy);class Iy extends AU{constructor(t){super(t),this.registerInput("emitPower",VU.Float,!0,1),this.registerInput("lifeTime",VU.Float,!0,1),this.registerInput("color",VU.HX,!0,new mt.HX(1,1,1,1)),this.registerInput("scale",VU.Vector2,!0,new I.Vector2(1,1)),this.registerInput("angle",VU.Float,!0,0),this.registerOutput("particle",VU.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(t){const U=new XU(this.name,t.fU,t.gU,null,!1,void 0,!0);U.particleEmitterType=new D,U._lifeTimeCreation.process=(U,y)=>{t.particleContext=U,U.lifeTime=this.lifeTime.getConnectedValue(t),y._emitPower=this.emitPower.getConnectedValue(t)},U._colorCreation.process=U=>{t.particleContext=U,U.color.Y(this.color.getConnectedValue(t))},U._sizeCreation.process=U=>{t.particleContext=U,U.size=1,U.scale.Y(this.scale.getConnectedValue(t))},U._angleCreation.process=U=>{t.particleContext=U,U.angle=this.angle.getConnectedValue(t)},this.particle._storedValue=U}}(0,X.f)("BABYLON.CreateParticleBlock",Iy);class ry{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const t=[];for(const U of this.attachedBlocks)U.isInput&&t.push(U);return t}constructor(t){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new R.b,this.name=t}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(t)&&this.attachedBlocks.push(t);for(const y of t.inputs){const I=y.connectedPoint;if(I){const y=I.ownerBlock;y!==t&&this._initializeBlock(y,U)}}}async buildAsync(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((y=>{const I=new cU;for(const t of this._systemBlocks)this._initializeBlock(t);for(const r of this.systemBlocks){const y=new CU;y.buildId=this._buildId++,y.gU=t,y.verbose=U;const Y=r.createSystem(y);y.emitErrors(),I.systems.push(Y)}this.onBuildObservable.notifyObservers(this),y(I)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const t=new uU("Particle system"),U=new ty("Update position");U.output.connectTo(t.particle);const y=new TU("Position");y.contextualValue=OU.Position;const I=new TU("Scaled direction");I.contextualValue=OU.ScaledDirection;const r=new Uy("Add");r.operation=sU.Add,y.output.connectTo(r.left),I.output.connectTo(r.right),r.output.connectTo(U.position);const Y=new Iy("Create particle"),mt=new yy("Box shape");Y.particle.connectTo(mt.particle),mt.output.connectTo(U.particle);const X=new zU("Texture");X.texture.connectTo(t.texture),X.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(t)}removeBlock(t){const U=this.attachedBlocks.indexOf(t);if(U>-1&&this.attachedBlocks.splice(U,1),t.isSystem){const U=this._systemBlocks.indexOf(t);U>-1&&this._systemBlocks.splice(U,1)}}parseSerializedObject(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U||this.clear();const y={};for(const I of t.cM){const t=(0,X.d)(I.customType);if(t){const U=new t;U._deserialize(I),y[I.id]=U,this.attachedBlocks.push(U),U.isSystem&&this._systemBlocks.push(U)}}for(const I of this.attachedBlocks)if(I.isTeleportOut){const t=I,U=t._tempEntryPointUniqueId;if(U){const I=y[U];I&&I.attachToEndpoint(t)}}for(let I=0;I<t.cM.length;I++){const r=t.cM[I],Y=y[r.id];Y&&(Y.inputs.length&&r.inputs.some((t=>t.targetConnectionName))&&!U||this._restoreConnections(Y,t,y))}if(t.locations||t.editorData&&t.editorData.locations){const I=t.locations||t.editorData.locations;for(const t of I)y[t.bI]&&(t.bI=y[t.bI].uniqueId);U&&this.editorData&&this.editorData.locations&&I.concat(this.editorData.locations),t.locations?this.editorData={locations:I}:(this.editorData=t.editorData,this.editorData.locations=I);const r=[];for(const t in y)r[t]=y[t].uniqueId;this.editorData.map=r}this.comment=t.comment}_restoreConnections(t,U,y){for(const I of t.outputs)for(const r of U.cM){const Y=y[r.id];if(Y)for(const mt of r.inputs)if(y[mt.targetBlockId]!==t||mt.targetConnectionName!==I.name);else{const t=Y.getInputByName(mt.inputName);if(!t||t.isConnected)continue;I.connectTo(t,!0),this._restoreConnections(Y,U,y)}}}serialize(t){const U=t?{}:H.b.Serialize(this);U.editorData=JSON.parse(JSON.stringify(this.editorData));let y=[];t?y=t:U.customType="BABYLON.NodeParticleSystemSet",U.cM=[];for(const I of y)U.cM.push(I.serialize());if(!t)for(const I of this.attachedBlocks)-1===y.indexOf(I)&&U.cM.push(I.serialize());return U}dispose(){for(const t of this.attachedBlocks)t.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(t){const U=new ry(t);return U.setToDefault(),U}static Parse(t){const U=H.b.Parse((()=>new ry(t.name)),t,null);return U.parseSerializedObject(t),U}static ParseFromSnippetAsync(t,U){return"_BLANK"===t?Promise.resolve(ry.CreateDefault("blank")):new Promise(((y,I)=>{const r=new fU.d;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const mt=JSON.parse(JSON.parse(r.responseText).jsonPayload),X=JSON.parse(mt.nodeParticle);U||(U=H.b.Parse((()=>new ry(t)),X,null)),U.parseSerializedObject(X),U.snippetId=t;try{y(U)}catch(Y){I(Y)}}else I("Unable to load the snippet "+t)})),r.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),r.send()}))}}ry.EditorURL=`${BU.Tools._DefaultCdnUrl}/v${Kt.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,ry.SnippetUrl="https://snippet.babylonjs.com",(0,d.b)([(0,q.I)()],ry.prototype,"name",void 0),(0,d.b)([(0,q.I)("comment")],ry.prototype,"comment",void 0),function(t){t[t.None=0]="None",t[t.PerParticle=1]="PerParticle",t[t.PerSystem=2]="PerSystem"}(xU||(xU={}));class Yy extends AU{constructor(t){super(t),this._currentLockId=-2,this.lockMode=xU.PerParticle,this.registerInput("min",VU.AutoDetect,!0,0),this.registerInput("max",VU.AutoDetect,!0,1),this.registerOutput("output",VU.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VU.Float|VU.Int|VU.Vector2|VU.DU|VU.HX),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(VU.Float|VU.Int|VU.Vector2|VU.DU|VU.HX),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=VU.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let t=null;switch(this._currentLockId=-2,this.min.type){case VU.AutoDetect:case VU.Int:case VU.Float:t=t=>{const U=this.min.getConnectedValue(t)||0,y=this.max.getConnectedValue(t)||1;return U+Math.random()*(y-U)};break;case VU.Vector2:t=t=>{const U=this.min.getConnectedValue(t)||I.Vector2.Zero(),y=this.max.getConnectedValue(t)||I.Vector2.One();return new I.Vector2(U.x+Math.random()*(y.x-U.x),U.y+Math.random()*(y.y-U.y))};break;case VU.DU:t=t=>{const U=this.min.getConnectedValue(t)||I.DU.Zero(),y=this.max.getConnectedValue(t)||I.DU.One();return new I.DU(U.x+Math.random()*(y.x-U.x),U.y+Math.random()*(y.y-U.y),U.z+Math.random()*(y.z-U.z))};break;case VU.HX:t=t=>{const U=this.min.getConnectedValue(t)||new mt.HX(0,0,0,0),y=this.max.getConnectedValue(t)||new mt.HX(1,1,1,1);return new mt.HX(U.x+Math.random()*(y.x-U.x),U.y+Math.random()*(y.y-U.y),U.z+Math.random()*(y.z-U.z),U.w+Math.random()*(y.w-U.w))}}this.output._storedFunction=U=>{var y;let I=0;switch(this.lockMode){case xU.PerParticle:I=(null===(y=U.particleContext)||void 0===y?void 0:y.id)||-1;break;case xU.PerSystem:I=U.buildId||0}return this._currentLockId!==I&&(this.lockMode!==xU.None&&(this._currentLockId=I),this.output._storedValue=t(U)),this.output._storedValue}}serialize(){const t=super.serialize();return t.lockMode=this.lockMode,t}_deserialize(t){super._deserialize(t),this.lockMode=t.lockMode}}(0,d.b)([KU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:xU.None},{label:"Per particle",value:xU.PerParticle},{label:"Per system",value:xU.PerSystem}]})],Yy.prototype,"lockMode",void 0),(0,X.f)("BABYLON.ParticleRandomBlock",Yy);class mI extends AU{constructor(t){super(t),this._currentLockId=-2,this.lockMode=xU.PerParticle,this.registerInput("min",VU.AutoDetect),this.registerInput("max",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const U=[VU.Matrix,VU.Particle,VU.Texture,VU.System,VU.FloatGradient,VU.Color4Gradient,VU.Vector2Gradient,VU.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...U),this.max.excludedConnectionPointTypes.push(...U)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let t=null;switch(this._currentLockId=-2,this.min.type){case VU.Float:case VU.Int:t=t=>{const U=this.min.getConnectedValue(t),y=this.max.getConnectedValue(t);return Math.random()*(y-U)+U};break;case VU.Vector2:t=t=>{const U=this.min.getConnectedValue(t),y=this.max.getConnectedValue(t);return new I.Vector2(Math.random()*(y.x-U.x)+U.x,Math.random()*(y.y-U.y)+U.y)};break;case VU.DU:t=t=>{const U=this.min.getConnectedValue(t),y=this.max.getConnectedValue(t);return new I.DU(Math.random()*(y.x-U.x)+U.x,Math.random()*(y.y-U.y)+U.y,Math.random()*(y.z-U.z)+U.z)};break;case VU.HX:t=t=>{const U=this.min.getConnectedValue(t),y=this.max.getConnectedValue(t);return new mt.HX(Math.random()*(y.r-U.r)+U.r,Math.random()*(y.g-U.g)+U.g,Math.random()*(y.b-U.b)+U.b,Math.random()*(y.a-U.a)+U.a)}}this.output._storedFunction=U=>{var y;let I=0;switch(this.lockMode){case xU.PerParticle:I=(null===(y=U.particleContext)||void 0===y?void 0:y.id)||-1;break;case xU.PerSystem:I=U.buildId||0}return this._currentLockId!==I&&(this.lockMode!==xU.None&&(this._currentLockId=I),this.output._storedValue=t(U)),this.output._storedValue}}serialize(){const t=super.serialize();return t.lockMode=this.lockMode,t}_deserialize(t){super._deserialize(t),void 0!==t.lockMode&&(this.lockMode=t.lockMode)}}(0,d.b)([KU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:xU.None},{label:"Per particle",value:xU.PerParticle},{label:"Per system",value:xU.PerSystem}]})],mI.prototype,"lockMode",void 0),(0,X.f)("BABYLON.RandomRangeBlock",mI);(0,X.f)("BABYLON.ParticleLerpBlock",class extends AU{constructor(t){super(t),this.registerInput("left",VU.AutoDetect),this.registerInput("right",VU.AutoDetect),this.registerInput("gradient",VU.Float,!0,0,0,1),this.registerOutput("output",VU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VU.Float|VU.Int|VU.Vector2|VU.DU|VU.HX)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=(t,U,y)=>(1-t)*U+t*y;this.output._storedFunction=U=>{const y=this.left.getConnectedValue(U),r=this.right.getConnectedValue(U),Y=this.gradient.getConnectedValue(U);switch(this.left.type){case VU.Int:case VU.Float:return t(Y,y,r);case VU.Vector2:return new I.Vector2(t(Y,y.x,r.x),t(Y,y.y,r.y));case VU.DU:return new I.DU(t(Y,y.x,r.x),t(Y,y.y,r.y),t(Y,y.z,r.z));case VU.HX:return new mt.HX(t(Y,y.r,r.r),t(Y,y.g,r.g),t(Y,y.b,r.b),t(Y,y.a,r.a))}return 0}}});(0,X.f)("BABYLON.UpdateDirectionBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("direction",VU.DU),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(t){const U=this.particle.getConnectedValue(t);if(this.output._storedValue=U,!this.direction.isConnected)return;const y={process:y=>{t.particleContext=y,t.systemContext=U,y.direction.Y(this.direction.getConnectedValue(t))},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y}});(0,X.f)("BABYLON.UpdateColorBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("color",VU.HX),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(t){const U=this.particle.getConnectedValue(t);if(this.output._storedValue=U,!this.color.isConnected)return;const y={process:y=>{t.particleContext=y,t.systemContext=U,y.color.Y(this.color.getConnectedValue(t))},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y}});(0,X.f)("BABYLON.UpdateScaleBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("scale",VU.Vector2),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(t){const U=this.particle.getConnectedValue(t);if(this.output._storedValue=U,!this.scale.isConnected)return;const y={process:y=>{t.particleContext=y,t.systemContext=U,y.scale.Y(this.scale.getConnectedValue(t))},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y}});(0,X.f)("BABYLON.UpdateAngleBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("angle",VU.Float),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(t){const U=this.particle.getConnectedValue(t);if(this.output._storedValue=U,!this.angle.isConnected)return;const y={process:y=>{t.particleContext=y,t.systemContext=U,y.angle=this.angle.getConnectedValue(t)},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y}});(0,X.f)("BABYLON.BasicPositionUpdateBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(t){const U=this.particle.getConnectedValue(t),y={process:y=>{t.particleContext=y,t.systemContext=U,y.direction.scaleToRef(U._directionScale,U._scaledDirection),y.position.addInPlace(U._scaledDirection)},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y,this.output._storedValue=U}});(0,X.f)("BABYLON.BasicSpriteUpdateBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(t){const U=this.particle.getConnectedValue(t),y={process:y=>{t.particleContext=y,t.systemContext=U,y.updateCellIndex()},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y,this.output._storedValue=U}});(0,X.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("cellIndex",VU.Int),this.registerOutput("output",VU.Particle),this.cellIndex.acceptedConnectionPointTypes=[VU.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(t){const U=this.particle.getConnectedValue(t);if(this.output._storedValue=U,!this.cellIndex.isConnected)return;const y={process:y=>{t.particleContext=y,t.systemContext=U,y.cellIndex=Math.floor(this.cellIndex.getConnectedValue(t))},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y}});class Xy extends AU{constructor(t){super(t),this.strength=1,this.registerInput("particle",VU.Particle),this.registerInput("flowMap",VU.Texture),this.registerOutput("output",VU.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(t){var U;const y=this.particle.getConnectedValue(t),I=t.gU;let r;(null===(U=this.flowMap.connectedPoint)||void 0===U?void 0:U.ownerBlock).extractTextureContentAsync().then((t=>{t&&(r=new oU(t.width,t.height,t.data))}));const Y={process:t=>{const U=I.getTransformMatrix();r&&r._processParticle(t,this.strength*y._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null};y._updateQueueStart?kt(Y,y._updateQueueStart):y._updateQueueStart=Y,this.output._storedValue=y}serialize(){const t=super.serialize();return t.strength=this.strength,t}_deserialize(t){super._deserialize(t),this.strength=t.strength}}(0,d.b)([KU("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Xy.prototype,"strength",void 0),(0,X.f)("BABYLON.UpdateFlowMapBlock",Xy);(0,X.f)("BABYLON.SphereShapeBlock",class extends AU{constructor(t){super(t),this.registerInput("input",VU.Particle),this.registerInput("radius",VU.Float,!0,1),this.registerInput("radiusRange",VU.Float,!0,1,0,1),this.registerInput("directionRandomizer",VU.Float,!0,0,0,1),this.registerOutput("output",VU.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(t){const U=this.input.getConnectedValue(t);U._directionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.directionRandomizer.getConnectedValue(t),Y=y.position.lU(t.emitterPosition).normalize(),mt=(0,G.RandomRange)(0,r),X=(0,G.RandomRange)(0,r),P=(0,G.RandomRange)(0,r);Y.x+=mt,Y.y+=X,Y.z+=P,Y.normalize(),t.isEmitterTransformNode?I.DU.TransformNormalFromFloatsToRef(mt,X,P,t.emitterWorldMatrix,y.direction):y.direction.aX(mt,X,P)},U._positionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.radius.getConnectedValue(t),Y=this.radiusRange.getConnectedValue(t),mt=r-(0,G.RandomRange)(0,r*Y),X=(0,G.RandomRange)(0,1),P=(0,G.RandomRange)(0,2*Math.PI),M=Math.acos(2*X-1),L=mt*Math.cos(P)*Math.sin(M),h=mt*Math.cos(M),Q=mt*Math.sin(P)*Math.sin(M);t.isEmitterTransformNode?I.DU.TransformCoordinatesFromFloatsToRef(L,h,Q,t.emitterWorldMatrix,y.position):(y.position.aX(L,h,Q),y.position.addInPlace(t.emitterPosition))},this.output._storedValue=U}});(0,X.f)("BABYLON.PointShapeBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("direction1",VU.DU,!0,new I.DU(0,1,0)),this.registerInput("direction2",VU.DU,!0,new I.DU(0,1,0)),this.registerOutput("output",VU.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){const U=this.particle.getConnectedValue(t);U._directionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.direction1.getConnectedValue(t),Y=this.direction2.getConnectedValue(t),mt=(0,G.RandomRange)(r.x,Y.x),X=(0,G.RandomRange)(r.y,Y.y),P=(0,G.RandomRange)(r.z,Y.z);t.isEmitterTransformNode?I.DU.TransformNormalFromFloatsToRef(mt,X,P,t.emitterWorldMatrix,y.direction):y.direction.aX(mt,X,P)},U._positionCreation.process=y=>{t.systemContext=U,t.isEmitterTransformNode?I.DU.TransformCoordinatesFromFloatsToRef(0,0,0,t.emitterWorldMatrix,y.position):y.position.Y(t.emitterPosition)},this.output._storedValue=U}});(0,X.f)("BABYLON.CustomShapeBlock",class extends AU{constructor(t){super(t),this.registerInput("particle",VU.Particle),this.registerInput("position",VU.DU,!0,new I.DU(0,0,0)),this.registerInput("direction",VU.DU,!0,new I.DU(0,1,0)),this.registerOutput("output",VU.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){const U=this.particle.getConnectedValue(t);U._directionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.direction.getConnectedValue(t);t.isEmitterTransformNode?I.DU.TransformNormalToRef(r,t.emitterWorldMatrix,y.direction):y.direction.Y(r)},U._positionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.position.getConnectedValue(t);t.isEmitterTransformNode?I.DU.TransformCoordinatesToRef(r,t.emitterWorldMatrix,y.position):(y.position.Y(r),y.position.addInPlace(t.emitterPosition))},this.output._storedValue=U}});(0,X.f)("BABYLON.CylinderShapeBlock",class extends AU{constructor(t){super(t),this._tempVector=I.DU.Zero(),this.registerInput("particle",VU.Particle),this.registerInput("radius",VU.Float,!0,1),this.registerInput("height",VU.Float,!0,1,0),this.registerInput("radiusRange",VU.Float,!0,1,0,1),this.registerInput("directionRandomizer",VU.Float,!0,0,0,1),this.registerOutput("output",VU.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(t){const U=this.particle.getConnectedValue(t);U._directionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.directionRandomizer.getConnectedValue(t);y.position.subtractToRef(t.emitterPosition,this._tempVector),this._tempVector.normalize(),t.isEmitterTransformNode&&I.DU.TransformNormalToRef(this._tempVector,t.emitterInverseWorldMatrix,this._tempVector);const Y=(0,G.RandomRange)(-r/2,r/2);let mt=Math.atan2(this._tempVector.x,this._tempVector.z);mt+=(0,G.RandomRange)(-Math.PI/2,Math.PI/2)*r,this._tempVector.y=Y,this._tempVector.x=Math.sin(mt),this._tempVector.z=Math.cos(mt),this._tempVector.normalize(),t.isEmitterTransformNode?I.DU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t.emitterWorldMatrix,y.direction):y.direction.Y(this._tempVector)},U._positionCreation.process=y=>{t.particleContext=y,t.systemContext=U;const r=this.height.getConnectedValue(t),Y=this.radiusRange.getConnectedValue(t),mt=this.radius.getConnectedValue(t),X=(0,G.RandomRange)(-r/2,r/2),P=(0,G.RandomRange)(0,2*Math.PI),M=(0,G.RandomRange)((1-Y)*(1-Y),1),L=Math.sqrt(M)*mt,h=L*Math.cos(P),Q=L*Math.sin(P);t.isEmitterTransformNode?I.DU.TransformCoordinatesFromFloatsToRef(h,X,Q,t.emitterWorldMatrix,y.position):(y.position.aX(h,X,Q),y.position.addInPlace(t.emitterPosition))},this.output._storedValue=U}});class Py extends AU{constructor(t){super(t),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",VU.Particle),this.registerOutput("output",VU.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);const U=this.particle.getConnectedValue(t);U._isAnimationSheetEnabled=!0,U.spriteCellWidth=this.width,U.spriteCellHeight=this.height,U.startSpriteCellID=this.start,U.endSpriteCellID=this.end,U.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=U}serialize(){const t=super.serialize();return t.width=this.width,t.height=this.height,t.start=this.start,t.end=this.end,t.randomStartCell=this.randomStartCell,t}_deserialize(t){super._deserialize(t),this.width=t.width,this.height=t.height,this.start=t.start,this.end=t.end,this.randomStartCell=t.randomStartCell}}(0,d.b)([KU("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Py.prototype,"start",void 0),(0,d.b)([KU("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Py.prototype,"end",void 0),(0,d.b)([KU("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Py.prototype,"width",void 0),(0,d.b)([KU("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Py.prototype,"height",void 0),(0,d.b)([KU("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Py.prototype,"loop",void 0),(0,d.b)([KU("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Py.prototype,"randomStartCell",void 0),(0,X.f)("BABYLON.SetupSpriteSheetBlock",Py);class Gy extends AU{constructor(t){super(t),this.reference=0,this.registerInput("value",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=t=>{switch(t){case VU.Float:return VU.FloatGradient;case VU.Vector2:return VU.Vector2Gradient;case VU.DU:return VU.Vector3Gradient;case VU.HX:return VU.Color4Gradient}return t},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VU.Float|VU.Vector2|VU.DU|VU.HX)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=t=>null}serialize(){const t=super.serialize();return t.reference=this.reference,t}_deserialize(t){super._deserialize(t),this.reference=t.reference}}(0,d.b)([KU("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Gy.prototype,"reference",void 0),(0,X.f)("BABYLON.ParticleGradientValueBlock",Gy);(0,X.f)("BABYLON.ParticleGradientBlock",class extends AU{constructor(t){super(t),this._entryCount=1,this.registerInput("gradient",VU.Float,!0,1,0,1),this.registerInput("value0",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=t=>{switch(t){case VU.FloatGradient:return VU.Float;case VU.Vector2Gradient:return VU.Vector2;case VU.Vector3Gradient:return VU.DU;case VU.Color4Gradient:return VU.HX}return t},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(VU.FloatGradient|VU.Vector2Gradient|VU.Vector3Gradient|VU.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(t){this._inputs[t].onConnectionObservable.add((()=>{this._entryCount>t||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),VU.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const t=[];for(let y=1;y<this._inputs.length;y++){var U;if(this._inputs[y].isConnected)t.push(null===(U=this._inputs[y].connectedPoint)||void 0===U?void 0:U.ownerBlock)}t.sort(((t,U)=>t.reference-U.reference)),this.output._storedFunction=U=>{const y=this.gradient.getConnectedValue(U);if(1===t.length)return t[0].value.getConnectedValue(U);let r=null;for(let Y=t.length-1;Y>=0;Y--){const X=t[Y];if(X.reference<=y){const t=X.value.getConnectedValue(U);if(r){const Y=r.value.getConnectedValue(U),P=r.reference,M=X.reference,L=Math.max(0,Math.min(1,(y-M)/(P-M)));switch(this.output.type){case VU.Float:return(0,G.Lerp)(t,Y,L);case VU.Vector2:return I.Vector2.Lerp(t,Y,L);case VU.DU:return I.DU.Lerp(t,Y,L);case VU.HX:return mt.HX.Lerp(t,Y,L)}}return t}r=X}return 0}}});(0,X.f)("BABYLON.ParticleConverterBlock",class extends AU{constructor(t){super(t),this.registerInput("color ",VU.HX,!0),this.registerInput("xyz ",VU.DU,!0),this.registerInput("xy ",VU.Vector2,!0),this.registerInput("zw ",VU.Vector2,!0),this.registerInput("x ",VU.Float,!0),this.registerInput("y ",VU.Float,!0),this.registerInput("z ",VU.Float,!0),this.registerInput("w ",VU.Float,!0),this.registerOutput("color",VU.HX),this.registerOutput("xyz",VU.DU),this.registerOutput("xy",VU.Vector2),this.registerOutput("zw",VU.Vector2),this.registerOutput("x",VU.Float),this.registerOutput("y",VU.Float),this.registerOutput("z",VU.Float),this.registerOutput("w",VU.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(t){return"color "===t?"colorIn":"xyz "===t?"xyzIn":"xy "===t?"xyIn":"zw "===t?"zwIn":"x "===t?"xIn":"y "===t?"yIn":"z "===t?"zIn":"w "===t?"wIn":t}_outputRename(t){switch(t){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return t}}_build(t){super._build(t);const U=this.xIn,y=this.yIn,r=this.zIn,Y=this.wIn,X=this.xyIn,P=this.zwIn,G=this.xyzIn,M=this.colorIn,L=this.colorOut,h=this.xyzOut,Q=this.xyOut,F=this.zwOut,E=this.xOut,w=this.yOut,D=this.zOut,l=this.wOut,g=t=>{if(M.isConnected)return M.getConnectedValue(t);let I=0,L=0,h=0,Q=0;if(U.isConnected&&(I=U.getConnectedValue(t)),y.isConnected&&(L=y.getConnectedValue(t)),r.isConnected&&(h=r.getConnectedValue(t)),Y.isConnected&&(Q=Y.getConnectedValue(t)),X.isConnected){const U=X.getConnectedValue(t);U&&(I=U.x,L=U.y)}if(P.isConnected){const U=P.getConnectedValue(t);U&&(h=U.x,Q=U.y)}if(G.isConnected){const U=G.getConnectedValue(t);U&&(I=U.x,L=U.y,h=U.z)}return new mt.HX(I,L,h,Q)};L._storedFunction=t=>g(t),h._storedFunction=t=>{const U=g(t);return new I.DU(U.r,U.g,U.b)},Q._storedFunction=t=>{const U=g(t);return new I.Vector2(U.r,U.g)},F._storedFunction=t=>{const U=g(t);return new I.Vector2(U.b,U.a)},E._storedFunction=t=>g(t).r,w._storedFunction=t=>g(t).g,D._storedFunction=t=>g(t).b,l._storedFunction=t=>g(t).a}}),function(t){t[t.Cos=0]="Cos",t[t.Sin=1]="Sin",t[t.Abs=2]="Abs",t[t.Exp=3]="Exp",t[t.Exp2=4]="Exp2",t[t.Round=5]="Round",t[t.Floor=6]="Floor",t[t.Ceiling=7]="Ceiling",t[t.Sqrt=8]="Sqrt",t[t.Log=9]="Log",t[t.Tan=10]="Tan",t[t.ArcTan=11]="ArcTan",t[t.ArcCos=12]="ArcCos",t[t.ArcSin=13]="ArcSin",t[t.Sign=14]="Sign",t[t.Negate=15]="Negate",t[t.OneMinus=16]="OneMinus",t[t.Reciprocal=17]="Reciprocal",t[t.ToDegrees=18]="ToDegrees",t[t.ToRadians=19]="ToRadians",t[t.Fract=20]="Fract"}(ZU||(ZU={}));class My extends AU{constructor(t){super(t),this.operation=ZU.Cos,this.registerInput("input",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VU.Float|VU.Int|VU.Vector2|VU.DU|VU.HX)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);let U=null;switch(this.operation){case ZU.Cos:U=t=>Math.cos(t);break;case ZU.Sin:U=t=>Math.sin(t);break;case ZU.Abs:U=t=>Math.abs(t);break;case ZU.Exp:U=t=>Math.exp(t);break;case ZU.Exp2:U=t=>Math.pow(2,t);break;case ZU.Round:U=t=>Math.round(t);break;case ZU.Floor:U=t=>Math.floor(t);break;case ZU.Ceiling:U=t=>Math.ceil(t);break;case ZU.Sqrt:U=t=>Math.sqrt(t);break;case ZU.Log:U=t=>Math.log(t);break;case ZU.Tan:U=t=>Math.tan(t);break;case ZU.ArcTan:U=t=>Math.atan(t);break;case ZU.ArcCos:U=t=>Math.acos(t);break;case ZU.ArcSin:U=t=>Math.asin(t);break;case ZU.Sign:U=t=>Math.sign(t);break;case ZU.Negate:U=t=>-t;break;case ZU.OneMinus:U=t=>1-t;break;case ZU.Reciprocal:U=t=>1/t;break;case ZU.ToRadians:U=t=>t*Math.PI/180;break;case ZU.ToDegrees:U=t=>180*t/Math.PI;break;case ZU.Fract:U=t=>t>=0?t-Math.floor(t):t-Math.ceil(t)}if(!U)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case VU.Int:case VU.Float:this.output._storedFunction=t=>{const y=this.input.getConnectedValue(t);return U(y)};break;case VU.Vector2:this.output._storedFunction=t=>{const y=this.input.getConnectedValue(t);return new I.Vector2(U(y.x),U(y.y))};break;case VU.DU:this.output._storedFunction=t=>{const y=this.input.getConnectedValue(t);return new I.DU(U(y.x),U(y.y),U(y.z))};break;case VU.HX:this.output._storedFunction=t=>{const y=this.input.getConnectedValue(t);return new mt.HX(U(y.r),U(y.g),U(y.b),U(y.a))}}return this}serialize(){const t=super.serialize();return t.operation=this.operation,t}_deserialize(t){super._deserialize(t),this.operation=t.operation}}(0,d.b)([KU("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ZU.Cos},{label:"Sin",value:ZU.Sin},{label:"Abs",value:ZU.Abs},{label:"Exp",value:ZU.Exp},{label:"Exp2",value:ZU.Exp2},{label:"Round",value:ZU.Round},{label:"Floor",value:ZU.Floor},{label:"Ceiling",value:ZU.Ceiling},{label:"Sqrt",value:ZU.Sqrt},{label:"Log",value:ZU.Log},{label:"Tan",value:ZU.Tan},{label:"ArcTan",value:ZU.ArcTan},{label:"ArcCos",value:ZU.ArcCos},{label:"ArcSin",value:ZU.ArcSin},{label:"Sign",value:ZU.Sign},{label:"Negate",value:ZU.Negate},{label:"OneMinus",value:ZU.OneMinus},{label:"Reciprocal",value:ZU.Reciprocal},{label:"ToDegrees",value:ZU.ToDegrees},{label:"ToRadians",value:ZU.ToRadians},{label:"Fract",value:ZU.Fract}]})],My.prototype,"operation",void 0),(0,X.f)("BABYLON.ParticleTrigonometryBlock",My);var Ly,hy=y(13547);class Qy extends AU{constructor(t){super(t),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(VU.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(VU.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(VU.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(VU.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(VU.System),this._inputs[0].excludedConnectionPointTypes.push(VU.Particle),this._inputs[0].excludedConnectionPointTypes.push(VU.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const U=t=>{const U=this.input.getConnectedValue(t);if(this.log.length>=this.stackSize)return U;if(null===U||void 0===U)return this.log.push(["null",""]),U;switch(this.input.type){case VU.Vector2:this.log.push([(0,hy.g)(U,4),U.toString()]);break;case VU.DU:this.log.push([(0,hy.i)(U,4),U.toString()]);break;case VU.HX:this.log.push([`{R: ${U.r.toFixed(4)} G: ${U.g.toFixed(4)} B: ${U.b.toFixed(4)} A: ${U.a.toFixed(4)}}`,U.toString()]);break;default:this.log.push([U.toString(),U.toString()])}return U};this.output.isConnected?this.output._storedFunction=U:this.output._storedValue=U(t)}serialize(){const t=super.serialize();return t.stackSize=this.stackSize,t}_deserialize(t){super._deserialize(t),this.stackSize=t.stackSize}}(0,d.b)([KU("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Qy.prototype,"stackSize",void 0),(0,X.f)("BABYLON.ParticleDebugBlock",Qy);(0,X.f)("BABYLON.ParticleElbowBlock",class extends AU{constructor(t){super(t),this.registerInput("input",VU.AutoDetect),this.registerOutput("output",VU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);const U=this._outputs[0],y=this._inputs[0];U._storedFunction=t=>y.getConnectedValue(t)}});(0,X.f)("BABYLON.ParticleTeleportInBlock",class extends AU{get endpoints(){return this._endpoints}constructor(t){super(t),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",VU.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(t){if(this.getClassName()===t)return!0;for(const U of this.endpoints)if(U.isAnAncestorOfType(t))return!0;return!1}isAnAncestorOf(t){for(const U of this.endpoints){if(U===t)return!0;if(U.isAnAncestorOf(t))return!0}return!1}attachToEndpoint(t){t.detach(),this._endpoints.push(t),t._entryPoint=this,t._outputs[0]._typeConnectionSource=this._inputs[0],t._tempEntryPointUniqueId=null,t.name="> "+this.name}detachFromEndpoint(t){const U=this._endpoints.indexOf(t);-1!==U&&(this._endpoints.splice(U,1),t._outputs[0]._typeConnectionSource=null,t._entryPoint=null)}_build(){for(const t of this._endpoints)t.output._storedFunction=t=>this.input.getConnectedValue(t)}});(0,X.f)("BABYLON.ParticleTeleportOutBlock",class extends AU{constructor(t){super(t),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",VU.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(t){this.entryPoint&&this.entryPoint.build(t)}clone(){const t=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(t),t}serialize(){var t;const U=super.serialize();return U.entryPoint=(null===(t=this.entryPoint)||void 0===t?void 0:t.uniqueId)??"",U}_deserialize(t){super._deserialize(t),this._tempEntryPointUniqueId=t.entryPoint}}),function(t){t[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.LessThan=2]="LessThan",t[t.GreaterThan=3]="GreaterThan",t[t.LessOrEqual=4]="LessOrEqual",t[t.GreaterOrEqual=5]="GreaterOrEqual",t[t.Xor=6]="Xor",t[t.Or=7]="Or",t[t.And=8]="And"}(Ly||(Ly={}));class Fy extends AU{constructor(t){super(t),this.test=Ly.Equal,this.epsilon=0,this.registerInput("left",VU.Float),this.registerInput("right",VU.Float,!0,0),this.registerInput("ifTrue",VU.AutoDetect,!0,1),this.registerInput("ifFalse",VU.AutoDetect,!0,0),this.registerOutput("output",VU.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=VU.Float,this._inputs[0].acceptedConnectionPointTypes.push(VU.Int),this._inputs[1].acceptedConnectionPointTypes.push(VU.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const t=t=>{const U=this.left.getConnectedValue(t),y=this.right.getConnectedValue(t);let I=!1;switch(this.test){case Ly.Equal:I=(0,G.WithinEpsilon)(U,y,this.epsilon);break;case Ly.NotEqual:I=!(0,G.WithinEpsilon)(U,y,this.epsilon);break;case Ly.LessThan:I=U<y+this.epsilon;break;case Ly.GreaterThan:I=U>y-this.epsilon;break;case Ly.LessOrEqual:I=U<=y+this.epsilon;break;case Ly.GreaterOrEqual:I=U>=y-this.epsilon;break;case Ly.Xor:I=!!U&&!y||!U&&!!y;break;case Ly.Or:I=!!U||!!y;break;case Ly.And:I=!!U&&!!y}return I};this.output._storedFunction=U=>t(U)?this.ifTrue.getConnectedValue(U):this.ifFalse.getConnectedValue(U)}serialize(){const t=super.serialize();return t.test=this.test,t.epsilon=this.epsilon,t}_deserialize(t){super._deserialize(t),this.test=t.test,void 0!==t.epsilon&&(this.epsilon=t.epsilon)}}(0,d.b)([KU("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ly.Equal},{label:"NotEqual",value:Ly.NotEqual},{label:"LessThan",value:Ly.LessThan},{label:"GreaterThan",value:Ly.GreaterThan},{label:"LessOrEqual",value:Ly.LessOrEqual},{label:"GreaterOrEqual",value:Ly.GreaterOrEqual},{label:"Xor",value:Ly.Xor},{label:"Or",value:Ly.Or},{label:"And",value:Ly.And}]})],Fy.prototype,"test",void 0),(0,d.b)([KU("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Fy.prototype,"epsilon",void 0),(0,X.f)("BABYLON.ParticleConditionBlock",Fy);class Ey extends AU{constructor(t){super(t),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",VU.Particle),this.registerInput("condition",VU.Float,!0,0),this.registerInput("system",VU.System),this.registerOutput("output",VU.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){this._triggerCount=0;const U=this.input.getConnectedValue(t),y={process:y=>{if(t.particleContext=y,t.systemContext=U,0!==this.condition.getConnectedValue(t)&&(0===this.limit||this._triggerCount<this.limit)){const I=(new Date).getTime();if(this._previousOne&&I-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=I;const r=this.system.getConnectedValue(t);if(r){const I=RU(r,t.gU,y.position);I.FX.addOnce((()=>{this._triggerCount--})),U.FX.addOnce((()=>{I.dispose()}))}}},previousItem:null,nextItem:null};U._updateQueueStart?kt(y,U._updateQueueStart):U._updateQueueStart=y,this.output._storedValue=U}serialize(){const t=super.serialize();return t.limit=this.limit,t.delay=this.delay,t}_deserialize(t){super._deserialize(t),void 0!==t.limit&&(this.limit=t.limit),void 0!==t.delay&&(this.delay=t.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,d.b)([KU("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ey.prototype,"limit",void 0),(0,d.b)([KU("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ey.prototype,"delay",void 0),(0,X.f)("BABYLON.ParticleTriggerBlock",Ey);y(13555),y(13568),y(13578),y(13637)},13623:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneFragment",Y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13587:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneFragmentDeclaration",Y="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13645:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneVertex",Y="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13639:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneVertexDeclaration",Y="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13635:(t,U,y)=>{"use strict";var I=y(12296);const r="fogFragment",Y="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13614:(t,U,y)=>{"use strict";var I=y(12296);const r="fogFragmentDeclaration",Y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13654:(t,U,y)=>{"use strict";var I=y(12296);const r="fogVertex",Y="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13642:(t,U,y)=>{"use strict";var I=y(12296);const r="fogVertexDeclaration",Y="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13605:(t,U,y)=>{"use strict";var I=y(12296);const r="helperFunctions",Y="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13593:(t,U,y)=>{"use strict";var I=y(12296);const r="imageProcessingDeclaration",Y="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13607:(t,U,y)=>{"use strict";var I=y(12296);const r="imageProcessingFunctions",Y="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13596:(t,U,y)=>{"use strict";var I=y(12296);const r="logDepthDeclaration",Y="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13630:(t,U,y)=>{"use strict";var I=y(12296);const r="logDepthFragment",Y="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13656:(t,U,y)=>{"use strict";var I=y(12296);const r="logDepthVertex",Y="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";I.e.IncludesShadersStoreWGSL[r]||(I.e.IncludesShadersStoreWGSL[r]=Y)},13578:(t,U,y)=>{"use strict";y.r(U),y.d(U,{particlesPixelShaderWGSL:()=>mt});var I=y(12296);y(13587),y(13593),y(13596),y(13605),y(13607),y(13614),y(13623),y(13630),y(13635);const r="particlesPixelShader",Y="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";I.e.ShadersStoreWGSL[r]||(I.e.ShadersStoreWGSL[r]=Y);const mt={name:r,shader:Y}},13637:(t,U,y)=>{"use strict";y.r(U),y.d(U,{particlesVertexShaderWGSL:()=>mt});var I=y(12296);y(13639),y(13642),y(13596),y(13645),y(13654),y(13656);const r="particlesVertexShader",Y="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";I.e.ShadersStoreWGSL[r]||(I.e.ShadersStoreWGSL[r]=Y);const mt={name:r,shader:Y}},13482:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneFragment",Y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13563:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneFragmentDeclaration",Y="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13507:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneVertex",Y="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13576:(t,U,y)=>{"use strict";var I=y(12296);const r="clipPlaneVertexDeclaration",Y="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13489:(t,U,y)=>{"use strict";var I=y(12296);const r="fogFragment",Y="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13476:(t,U,y)=>{"use strict";var I=y(12296);const r="fogFragmentDeclaration",Y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13515:(t,U,y)=>{"use strict";var I=y(12296);const r="fogVertex",Y="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13498:(t,U,y)=>{"use strict";var I=y(12296);const r="fogVertexDeclaration",Y="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13468:(t,U,y)=>{"use strict";var I=y(12296);const r="helperFunctions",Y="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13461:(t,U,y)=>{"use strict";var I=y(12296);const r="imageProcessingDeclaration",Y="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13470:(t,U,y)=>{"use strict";var I=y(12296);const r="imageProcessingFunctions",Y="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13464:(t,U,y)=>{"use strict";var I=y(12296);const r="logDepthDeclaration",Y="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13485:(t,U,y)=>{"use strict";var I=y(12296);const r="logDepthFragment",Y="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13519:(t,U,y)=>{"use strict";var I=y(12296);const r="logDepthVertex",Y="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";I.e.IncludesShadersStore[r]||(I.e.IncludesShadersStore[r]=Y)},13555:(t,U,y)=>{"use strict";y.r(U),y.d(U,{particlesPixelShader:()=>mt});var I=y(12296);y(13563),y(13461),y(13464),y(13468),y(13470),y(13476),y(13482),y(13485),y(13489);const r="particlesPixelShader",Y="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";I.e.ShadersStore[r]||(I.e.ShadersStore[r]=Y);const mt={name:r,shader:Y}},13568:(t,U,y)=>{"use strict";y.r(U),y.d(U,{particlesVertexShader:()=>mt});var I=y(12296);y(13576),y(13498),y(13464),y(13507),y(13515),y(13519);const r="particlesVertexShader",Y="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";I.e.ShadersStore[r]||(I.e.ShadersStore[r]=Y);const mt={name:r,shader:Y}},13908:(t,U,y)=>{"use strict";y.r(U),y.d(U,{FlowGraphGLTFDataProvider:()=>Y});var I=y(13865),r=y(13845);class Y extends I.c{constructor(t){var U,y;super();const I=t.glTF,Y=(null===(U=I.animations)||void 0===U?void 0:U.map((t=>t._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",r.e,Y);const mt=(null===(y=I.nodes)||void 0===y?void 0:y.map((t=>t._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",r.e,mt)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13789:(t,U,y)=>{"use strict";y.d(U,{d:()=>w,e:()=>F,g:()=>Q,k:()=>E});var I=y(12386),r=y(12906),Y=y(12442),mt=y(13791);const X=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class P{constructor(t,U){this._gltf=t,this._infoTree=U}convert(t){let U,y=this._gltf,I=this._infoTree;if(!t.startsWith("/"))throw new Error("Path must start with a /");const r=t.split("/");if(r.shift(),r[r.length-1].includes(".length")){const t=r[r.length-1].split(".");r.pop(),r.push(...t)}let Y=!1;for(const P of r){const r="length"===P;if(r&&!I.__array__)throw new Error(`Path ${t} is invalid`);if(I.__ignoreObjectTree__&&(Y=!0),I.__array__&&!r)I=I.__array__;else if(I=I[P],!I)throw new Error(`Path ${t} is invalid`);if(!Y)if(void 0===y){if(!X.find((U=>U.regex.test(t))))throw new Error(`Path ${t} is invalid`)}else if(!r){var mt;y=null===(mt=y)||void 0===mt?void 0:mt[P]}(I.__target__||r)&&(U=y)}return{object:U,info:I}}}function G(t,U,y,I){const r=M(t,U);return I?r[y][I]:r[y]}function M(t,U,y){var I,Y;return null===(I=t._data)||void 0===I||null===(Y=I[(null===y||void 0===y?void 0:y.fillMode)??r.b.MATERIAL_TriangleFillMode])||void 0===Y?void 0:Y.babylonMaterial}function L(t,U){return{offset:{componentsCount:2,type:"Vector2",get:(y,r,Y)=>{const mt=G(y,Y,t,U);return new I.Vector2(null===mt||void 0===mt?void 0:mt.uOffset,null===mt||void 0===mt?void 0:mt.vOffset)},getTarget:M,set:(y,I,r,Y)=>{const mt=G(I,Y,t,U);mt.uOffset=y.x,mt.vOffset=y.y},getPropertyName:[()=>`${t}${U?"."+U:""}.uOffset`,()=>`${t}${U?"."+U:""}.vOffset`]},rotation:{type:"number",get:(y,I,r)=>{var Y;return null===(Y=G(y,r,t,U))||void 0===Y?void 0:Y.wAng},getTarget:M,set:(y,I,r,Y)=>G(I,Y,t,U).wAng=y,getPropertyName:[()=>`${t}${U?"."+U:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(y,r,Y)=>{const mt=G(y,Y,t,U);return new I.Vector2(null===mt||void 0===mt?void 0:mt.uScale,null===mt||void 0===mt?void 0:mt.vScale)},getTarget:M,set:(y,I,r,Y)=>{const mt=G(I,Y,t,U);mt.uScale=y.x,mt.vScale=y.y},getPropertyName:[()=>`${t}${U?"."+U:""}.uScale`,()=>`${t}${U?"."+U:""}.vScale`]}}}const h={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:t=>{var U,y;return new I.Vector2((null===(U=t._babylonCamera)||void 0===U?void 0:U.orthoLeft)??0,(null===(y=t._babylonCamera)||void 0===y?void 0:y.orthoRight)??0)},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.orthoLeft=t.x,U._babylonCamera.orthoRight=t.y)},getTarget:t=>t,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:t=>{var U,y;return new I.Vector2((null===(U=t._babylonCamera)||void 0===U?void 0:U.orthoBottom)??0,(null===(y=t._babylonCamera)||void 0===y?void 0:y.orthoTop)??0)},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.orthoBottom=t.x,U._babylonCamera.orthoTop=t.y)},getTarget:t=>t,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:t=>{var U;return null===(U=t._babylonCamera)||void 0===U?void 0:U.maxZ},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=t)},getTarget:t=>t,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:t=>{var U;return null===(U=t._babylonCamera)||void 0===U?void 0:U.cX},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.cX=t)},getTarget:t=>t,getPropertyName:[()=>"cX"]}},perspective:{aspectRatio:{type:"number",get:t=>{var U;return null===(U=t._babylonCamera)||void 0===U?void 0:U.getEngine().getAspectRatio(t._babylonCamera)},getTarget:t=>t,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:t=>{var U;return null===(U=t._babylonCamera)||void 0===U?void 0:U.fov},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.fov=t)},getTarget:t=>t,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:t=>{var U;return null===(U=t._babylonCamera)||void 0===U?void 0:U.maxZ},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=t)},getTarget:t=>t,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:t=>{var U;return null===(U=t._babylonCamera)||void 0===U?void 0:U.cX},set:(t,U)=>{U._babylonCamera&&(U._babylonCamera.cX=t)},getTarget:t=>t,getPropertyName:[()=>"cX"]}}}},nodes:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"DU",get:t=>{var U;return null===(U=t._babylonTransformNode)||void 0===U?void 0:U.position},set:(t,U)=>{var y;return null===(y=U._babylonTransformNode)||void 0===y?void 0:y.position.Y(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:t=>{var U;return null===(U=t._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion},set:(t,U)=>{var y,I;return null===(y=U._babylonTransformNode)||void 0===y||null===(I=y.rotationQuaternion)||void 0===I?void 0:I.Y(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"DU",get:t=>{var U;return null===(U=t._babylonTransformNode)||void 0===U?void 0:U.dX},set:(t,U)=>{var y;return null===(y=U._babylonTransformNode)||void 0===y?void 0:y.dX.Y(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"dX"]},weights:{length:{type:"number",get:t=>t._numMorphTargets,getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(t,U)=>{var y,I;return void 0!==U?null===(y=t._primitiveBabylonMeshes)||void 0===y||null===(I=y[0].morphTargetManager)||void 0===I?void 0:I.getTarget(U).influence:void 0},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(t,U)=>[0],getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:t=>{var U,y,r;return I.Matrix.Compose(null===(U=t._babylonTransformNode)||void 0===U?void 0:U.dX,null===(y=t._babylonTransformNode)||void 0===y?void 0:y.rotationQuaternion,null===(r=t._babylonTransformNode)||void 0===r?void 0:r.position)},getTarget:t=>t._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:t=>{var U,y,r,Y;const mt=I.Matrix.Identity();let X=t.parent;for(;X&&X.parent;)X=X.parent;const P=(null===(U=t._babylonTransformNode)||void 0===U?void 0:U.position._isDirty)||(null===(y=t._babylonTransformNode)||void 0===y||null===(r=y.rotationQuaternion)||void 0===r?void 0:r._isDirty)||(null===(Y=t._babylonTransformNode)||void 0===Y?void 0:Y.dX._isDirty);if(X){var G;const U=null===(G=X._babylonTransformNode)||void 0===G?void 0:G.SX(!0).invert();var M,L;if(U)null===(M=t._babylonTransformNode)||void 0===M||null===(L=M.SX(P))||void 0===L||L.multiplyToRef(U,mt)}else t._babylonTransformNode&&mt.Y(t._babylonTransformNode.SX(P));return mt},getTarget:t=>t._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:t=>{var U,y;return null===(U=t._babylonTransformNode)||void 0===U||null===(y=U.getChildren((t=>t instanceof mt.c),!0)[0])||void 0===y?void 0:y.VX},getTarget:t=>{var U;return null===(U=t._babylonTransformNode)||void 0===U?void 0:U.getChildren((t=>t instanceof mt.c),!0)[0]},set:(t,U)=>{if(U._babylonTransformNode){const y=U._babylonTransformNode.getChildren((t=>t instanceof mt.c),!0)[0];y&&(y.VX=t)}}},color:{type:"bU",get:t=>{var U,y;return null===(U=t._babylonTransformNode)||void 0===U||null===(y=U.getChildren((t=>t instanceof mt.c),!0)[0])||void 0===y?void 0:y.nX},getTarget:t=>{var U;return null===(U=t._babylonTransformNode)||void 0===U?void 0:U.getChildren((t=>t instanceof mt.c),!0)[0]},set:(t,U)=>{if(U._babylonTransformNode){const y=U._babylonTransformNode.getChildren((t=>t instanceof mt.c),!0)[0];y&&(y.nX=t)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"bU",get:(t,U,y)=>M(t,U,y).emissiveColor,set:(t,U,y,I)=>M(U,y,I).emissiveColor.Y(t),getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:L("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(t,U,y)=>{var I;return null===(I=G(t,y,"bumpTexture"))||void 0===I?void 0:I.level},set:(t,U,y,I)=>{const r=G(U,I,"bumpTexture");r&&(r.level=t)},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:L("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(t,U,y)=>M(t,U,y).ambientTextureStrength,set:(t,U,y,I)=>{const r=M(U,y,I);r&&(r.ambientTextureStrength=t)},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:L("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"HX",get:(t,U,y)=>{const I=M(t,U,y);return Y.HX.FromColor3(I.albedoColor,I.alpha)},set:(t,U,y,I)=>{const r=M(U,y,I);r.albedoColor.set(t.r,t.g,t.b),r.alpha=t.a},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:L("albedoTexture")}},metallicFactor:{type:"number",get:(t,U,y)=>M(t,U,y).metallic,set:(t,U,y,I)=>{const r=M(U,y,I);r&&(r.metallic=t)},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(t,U,y)=>M(t,U,y).roughness,set:(t,U,y,I)=>{const r=M(U,y,I);r&&(r.roughness=t)},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:L("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(t,U,y)=>M(t,U,y).anisotropy.VX,set:(t,U,y,I)=>{M(U,y,I).anisotropy.VX=t},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(t,U,y)=>M(t,U,y).anisotropy.angle,set:(t,U,y,I)=>{M(U,y,I).anisotropy.angle=t},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:L("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(t,U,y)=>M(t,U,y).clearCoat.VX,set:(t,U,y,I)=>{M(U,y,I).clearCoat.VX=t},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(t,U,y)=>M(t,U,y).clearCoat.roughness,set:(t,U,y,I)=>{M(U,y,I).clearCoat.roughness=t},getTarget:(t,U,y)=>M(t,U,y),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:L("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(t,U,y)=>{var I;return null===(I=M(t,U,y).clearCoat.bumpTexture)||void 0===I?void 0:I.level},getTarget:M,set:(t,U,y,I)=>M(U,y,I).clearCoat.bumpTexture.level=t},extensions:{KHR_texture_transform:L("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:L("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(t,U,y)=>M(t,U,y).subSurface.dispersion,getTarget:M,set:(t,U,y,I)=>M(U,y,I).subSurface.dispersion=t}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(t,U,y)=>M(t,U,y).emissiveIntensity,getTarget:M,set:(t,U,y,I)=>M(U,y,I).emissiveIntensity=t}},KHR_materials_ior:{ior:{type:"number",get:(t,U,y)=>M(t,U,y).indexOfRefraction,getTarget:M,set:(t,U,y,I)=>M(U,y,I).indexOfRefraction=t}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(t,U,y)=>M(t,U,y).iridescence.VX,getTarget:M,set:(t,U,y,I)=>M(U,y,I).iridescence.VX=t},iridescenceIor:{type:"number",get:(t,U,y)=>M(t,U,y).iridescence.indexOfRefraction,getTarget:M,set:(t,U,y,I)=>M(U,y,I).iridescence.indexOfRefraction=t},iridescenceTexture:{extensions:{KHR_texture_transform:L("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(t,U,y)=>M(t,U,y).iridescence.maximumThickness,getTarget:M,set:(t,U,y,I)=>M(U,y,I).iridescence.maximumThickness=t},iridescenceThicknessMinimum:{type:"number",get:(t,U,y)=>M(t,U,y).iridescence.minimumThickness,getTarget:M,set:(t,U,y,I)=>M(U,y,I).iridescence.minimumThickness=t},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:L("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"bU",get:(t,U,y)=>M(t,U,y).sheen.color,getTarget:M,set:(t,U,y,I)=>M(U,y,I).sheen.color.Y(t)},sheenColorTexture:{extensions:{KHR_texture_transform:L("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(t,U,y)=>M(t,U,y).sheen.VX,getTarget:M,set:(t,U,y,I)=>M(U,y,I).sheen.VX=t},sheenRoughnessTexture:{extensions:{KHR_texture_transform:L("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(t,U,y)=>M(t,U,y).metallicF0Factor,getTarget:M,set:(t,U,y,I)=>M(U,y,I).metallicF0Factor=t,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"bU",get:(t,U,y)=>M(t,U,y).metallicReflectanceColor,getTarget:M,set:(t,U,y,I)=>M(U,y,I).metallicReflectanceColor.Y(t),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:L("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:L("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(t,U,y)=>M(t,U,y).subSurface.refractionIntensity,getTarget:M,set:(t,U,y,I)=>M(U,y,I).subSurface.refractionIntensity=t,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:L("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(t,U,y)=>M(t,U,y).subSurface.translucencyIntensity,getTarget:M,set:(t,U,y,I)=>M(U,y,I).subSurface.translucencyIntensity=t},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:L("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"bU",get:(t,U,y)=>M(t,U,y).subSurface.translucencyColor,getTarget:M,set:(t,U,y,I)=>{var r;return t&&(null===(r=M(U,y,I).subSurface.translucencyColor)||void 0===r?void 0:r.Y(t))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:L("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"bU",get:(t,U,y)=>M(t,U,y).subSurface.tintColor,getTarget:M,set:(t,U,y,I)=>M(U,y,I).subSurface.tintColor.Y(t)},attenuationDistance:{type:"number",get:(t,U,y)=>M(t,U,y).subSurface.tintColorAtDistance,getTarget:M,set:(t,U,y,I)=>M(U,y,I).subSurface.tintColorAtDistance=t},thicknessFactor:{type:"number",get:(t,U,y)=>M(t,U,y).subSurface.maximumThickness,getTarget:M,set:(t,U,y,I)=>M(U,y,I).subSurface.maximumThickness=t},thicknessTexture:{extensions:{KHR_texture_transform:L("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonLight)),getPropertyName:[t=>"length"]},__array__:{__target__:!0,color:{type:"bU",get:t=>{var U;return null===(U=t._babylonLight)||void 0===U?void 0:U.nX},set:(t,U)=>{var y;return null===(y=U._babylonLight)||void 0===y?void 0:y.nX.Y(t)},getTarget:t=>t._babylonLight,getPropertyName:[t=>"diffuse"]},VX:{type:"number",get:t=>{var U;return null===(U=t._babylonLight)||void 0===U?void 0:U.VX},set:(t,U)=>U._babylonLight?U._babylonLight.VX=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"intensity"]},range:{type:"number",get:t=>{var U;return null===(U=t._babylonLight)||void 0===U?void 0:U.range},set:(t,U)=>U._babylonLight?U._babylonLight.range=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"range"]},spot:{innerConeAngle:{type:"number",get:t=>{var U;return null===(U=t._babylonLight)||void 0===U?void 0:U.innerAngle},set:(t,U)=>U._babylonLight?U._babylonLight.innerAngle=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"innerConeAngle"]},outerConeAngle:{type:"number",get:t=>{var U;return null===(U=t._babylonLight)||void 0===U?void 0:U.angle},set:(t,U)=>U._babylonLight?U._babylonLight.angle=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonLight)),getPropertyName:[t=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonTexture)),getPropertyName:[t=>"length"]},__array__:{__target__:!0,VX:{type:"number",get:t=>{var U;return null===(U=t._babylonTexture)||void 0===U?void 0:U.level},set:(t,U)=>{U._babylonTexture&&(U._babylonTexture.level=t)},getTarget:t=>t._babylonTexture},rotation:{type:"Quaternion",get:t=>{var U;return t._babylonTexture&&I.Quaternion.FromRotationMatrix(null===(U=t._babylonTexture)||void 0===U?void 0:U.getReflectionTextureMatrix())},set:(t,U)=>{var y;U._babylonTexture&&(null!==(y=U._babylonTexture.St())&&void 0!==y&&y.useRightHandedSystem||(t=I.Quaternion.Inverse(t)),I.Matrix.FromQuaternionToRef(t,U._babylonTexture.getReflectionTextureMatrix()))},getTarget:t=>t._babylonTexture}}}}},animations:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>{var U;return null===(U=t.primitives[0]._instanceData)||void 0===U?void 0:U.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Q(t){return new P(t,h)}function F(t){const U=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let y=h;for(const I of U)I&&(y=y[I]);if(y&&y.type&&y.get)return y}function E(t,U){const y=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let I=h;for(const r of y)r&&(I=I[r]);I&&I.type&&I.get&&(I.interpolation=U)}function w(t,U){const y=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let I=h;for(const r of y)if(r){if(!I[r]){if("?"===r){I.__ignoreObjectTree__=!0;continue}I[r]={},"__array__"===r&&(I[r].__target__=!0)}I=I[r]}Object.assign(I,U)}},13793:(t,U,y)=>{"use strict";y.r(U),y.d(U,{AnimationPropertyInfo:()=>G,TransformNodeAnimationPropertyInfo:()=>M,WeightAnimationPropertyInfo:()=>L,getQuaternion:()=>X,getVector3:()=>mt,getWeights:()=>P});var I=y(12956),r=y(12386),Y=y(13789);function mt(t,U,y,I){return r.DU.pU(U,y).scaleInPlace(I)}function X(t,U,y,I){return r.Quaternion.pU(U,y).scaleInPlace(I)}function P(t,U,y,I){const r=new Array(t._numMorphTargets);for(let Y=0;Y<r.length;Y++)r[Y]=U[y++]*I;return r}class G{constructor(t,U,y,I){this.type=t,this.name=U,this.getValue=y,this.getStride=I}_buildAnimation(t,U,y){const r=new I.e(t,this.name,U,this.type);return r.setKeys(y),r}}class M extends G{buildAnimations(t,U,y,I){const r=[];return r.push({babylonAnimatable:t._babylonTransformNode,babylonAnimation:this._buildAnimation(U,y,I)}),r}}class L extends G{buildAnimations(t,U,y,r){const Y=[];if(t._numMorphTargets)for(let mt=0;mt<t._numMorphTargets;mt++){const X=new I.e(`${U}_${mt}`,this.name,y,this.type);if(X.setKeys(r.map((t=>({frame:t.frame,inTangent:t.inTangent?t.inTangent[mt]:void 0,value:t.value[mt],outTangent:t.outTangent?t.outTangent[mt]:void 0,interpolation:t.interpolation})))),t._primitiveBabylonMeshes)for(const U of t._primitiveBabylonMeshes)if(U.morphTargetManager){const t=U.morphTargetManager.getTarget(mt),y=X.clone();t.animations.push(y),Y.push({babylonAnimatable:t,babylonAnimation:y})}}return Y}}(0,Y.k)("/nodes/{}/translation",[new M(I.e.ANIMATIONTYPE_VECTOR3,"position",mt,(()=>3))]),(0,Y.k)("/nodes/{}/rotation",[new M(I.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",X,(()=>4))]),(0,Y.k)("/nodes/{}/scale",[new M(I.e.ANIMATIONTYPE_VECTOR3,"dX",mt,(()=>3))]),(0,Y.k)("/nodes/{}/weights",[new L(I.e.ANIMATIONTYPE_FLOAT,"influence",P,(t=>t._numMorphTargets))])},13760:(t,U,y)=>{"use strict";class I{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((t,U)=>{this._resolve=t,this._reject=U}))}}var r=y(12386),Y=y(12442),mt=y(12198),X=y(12876),P=y(13764),G=y(13774),M=y(12204),L=y(12899),h=y(12956),Q=y(12963),F=y(12250),E=y(12221),w=y(12229);class D{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(t,U,y){this.name=t,this.id=U,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=r.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new M.b,this.bones=[],this._scene=y||F.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const I=this._scene.getEngine().getCaps();this._canUseTextureForBones=I.textureFloat&&I.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((t=>!t.getParent()))}getTransformMatrices(t){if(this.needInitialSkinMatrix){if(!t)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return t._bonesTransformMatrices||this.prepare(!0),t._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture}St(){return this._scene}toString(t){let U=`Name: ${this.name}, nBones: ${this.bones.length}`;if(U+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,t){U+=", Ranges: {";let t=!0;for(const y in this._ranges)t&&(U+=", ",t=!1),U+=y;U+="}"}return U}getBoneIndexByName(t){for(let U=0,y=this.bones.length;U<y;U++)if(this.bones[U].name===t)return U;return-1}createAnimationRange(t,U,y){if(!this._ranges[t]){this._ranges[t]=new Q.e(t,U,y);for(let I=0,r=this.bones.length;I<r;I++)this.bones[I].animations[0]&&this.bones[I].animations[0].createRange(t,U,y)}}deleteAnimationRange(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let y=0,I=this.bones.length;y<I;y++)this.bones[y].animations[0]&&this.bones[y].animations[0].deleteRange(t,U);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}getAnimationRanges(){const t=[];let U;for(U in this._ranges)t.push(this._ranges[U]);return t}copyAnimationRange(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[U]||!t.getAnimationRange(U))return!1;let I=!0;const r=this._getHighestAnimationFrame()+1,Y={},mt=t.bones;let X,P;for(P=0,X=mt.length;P<X;P++)Y[mt[P].name]=mt[P];this.bones.length!==mt.length&&(E.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${mt.length}`),I=!1);const G=y&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(P=0,X=this.bones.length;P<X;P++){const t=this.bones[P].name,mt=Y[t];mt?I=I&&this.bones[P].copyAnimationRange(mt,U,r,y,G):(E.b.Warn("copyAnimationRange: not same rig, missing source bone "+t),I=!1)}const M=t.getAnimationRange(U);return M&&(this._ranges[U]=new Q.e(U,M.from+r,M.to+r)),I}returnToRest(){for(const t of this.bones)-1!==t._index&&t.returnToRest()}_getHighestAnimationFrame(){let t=0;for(let U=0,y=this.bones.length;U<y;U++)if(this.bones[U].animations[0]){const y=this.bones[U].animations[0].getHighestFrame();t<y&&(t=y)}return t}beginAnimation(t,U,y,I){const r=this.getAnimationRange(t);return r?this._scene.beginAnimation(this,r.from,r.to,U,y,I):null}static MakeAnimationAdditive(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;const I=t.getAnimationRange(y);if(!I)return null;const r=t._scene.getAllAnimatablesByTarget(t);let Y=null;for(let X=0;X<r.length;X++){const t=r[X];if(t.fromFrame===(null===I||void 0===I?void 0:I.from)&&t.toFrame===(null===I||void 0===I?void 0:I.to)){Y=t;break}}const mt=t.getAnimatables();for(let X=0;X<mt.length;X++){const t=mt[X].animations;if(t)for(let I=0;I<t.length;I++)h.e.MakeAnimationAdditive(t[I],U,y)}return Y&&(Y.isAdditive=!0),t}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(t){this._meshesWithPoseMatrix.push(t)}_unregisterMeshWithPoseMatrix(t){const U=this._meshesWithPoseMatrix.indexOf(t);U>-1&&this._meshesWithPoseMatrix.splice(U,1)}_computeTransformMatrices(t,U){this.onBeforeComputeObservable.notifyObservers(this);for(let y=0;y<this.bones.length;y++){const I=this.bones[y];I._childUpdateId++;const r=I.getParent();if(r?I.getLocalMatrix().multiplyToRef(r.getFinalMatrix(),I.getFinalMatrix()):U?I.getLocalMatrix().multiplyToRef(U,I.getFinalMatrix()):I.getFinalMatrix().Y(I.getLocalMatrix()),-1!==I._index){const U=null===I._index?y:I._index;I.getAbsoluteInverseBindMatrix().multiplyToArray(I.getFinalMatrix(),t,16*U)}}this._identity.copyToArray(t,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const t=this.St().getRenderId();if(this._currentRenderId===t)return;this._currentRenderId=t}if(this._numBonesWithLinkedTransformNode>0)for(const t of this.bones)if(t._linkedTransformNode){const U=t._linkedTransformNode;t.position=U.position,U.rotationQuaternion?t.rotationQuaternion=U.rotationQuaternion:t.rotation=U.rotation,t.dX=U.dX}if(this.needInitialSkinMatrix)for(const t of this._meshesWithPoseMatrix){const U=t.getPoseMatrix();let y=this._isDirty;if(t._bonesTransformMatrices&&t._bonesTransformMatrices.length===16*(this.bones.length+1)||(t._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),y=!0),y){if(this._synchronizedWithMesh!==t){this._synchronizedWithMesh=t;for(const t of this.bones)if(!t.getParent()){t.getBindMatrix().multiplyToRef(U,r.TmpVectors.Matrix[1]),t._updateAbsoluteBindMatrices(r.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const U=4*(this.bones.length+1);t._transformMatrixTexture&&t._transformMatrixTexture.getSize().width===U||(t._transformMatrixTexture&&t._transformMatrixTexture.dispose(),t._transformMatrixTexture=L.b.CreateRGBATexture(t._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(t._bonesTransformMatrices,U),this.isUsingTextureForMatrices&&t._transformMatrixTexture&&t._transformMatrixTexture.update(t._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=L.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables}clone(t,U){const y=new D(t,U||t,this._scene);y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let I=0;I<this.bones.length;I++){const t=this.bones[I];let U=null;const r=t.getParent();if(r){const t=this.bones.indexOf(r);U=y.bones[t]}const Y=new G.e(t.name,y,U,t.getBindMatrix().clone(),t.getRestMatrix().clone());Y._index=t._index,t._linkedTransformNode&&Y.linkTransformNode(t._linkedTransformNode),w.d.DeepCopy(t.animations,Y.animations)}if(this._ranges){y._ranges={};for(const t in this._ranges){const U=this._ranges[t];U&&(y._ranges[t]=U.clone())}}return this._isDirty=!0,y.prepare(!0),y}enableBlending(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const U of this.bones)for(const y of U.animations)y.enableBlending=!0,y.blendingSpeed=t}dispose(){if(this._meshesWithPoseMatrix.length=0,this.St().stopAnimation(this),this.St().removeSkeleton(this),this._parentContainer){const t=this._parentContainer.skeletons.indexOf(this);t>-1&&this._parentContainer.skeletons.splice(t,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.bX()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let y=0;y<this.bones.length;y++){var U;const I=this.bones[y],r=I.getParent(),Y={parentBoneIndex:r?this.bones.indexOf(r):-1,index:I.getIndex(),name:I.name,id:I.id,matrix:I.getBindMatrix().bX(),rest:I.getRestMatrix().bX(),linkedTransformNodeId:null===(U=I.getTransformNode())||void 0===U?void 0:U.id};t.bones.push(Y),I.length&&(Y.length=I.length),I.metadata&&(Y.metadata=I.metadata),I.animations&&I.animations.length>0&&(Y.animation=I.animations[0].serialize()),t.ranges=[];for(const U in this._ranges){const y=this._ranges[U];if(!y)continue;const I={};I.name=U,I.from=y.from,I.to=y.to,t.ranges.push(I)}}return t}static Parse(t,U){const y=new D(t.name,t.id,U);let I;for(t.dimensionsAtRest&&(y.dimensionsAtRest=r.DU.pU(t.dimensionsAtRest)),y.needInitialSkinMatrix=t.needInitialSkinMatrix,I=0;I<t.bones.length;I++){const U=t.bones[I],Y=t.bones[I].index;let mt=null;U.parentBoneIndex>-1&&(mt=y.bones[U.parentBoneIndex]);const X=U.rest?r.Matrix.pU(U.rest):null,P=new G.e(U.name,y,mt,r.Matrix.pU(U.matrix),X,null,Y);void 0!==U.id&&null!==U.id&&(P.id=U.id),U.length&&(P.length=U.length),U.metadata&&(P.metadata=U.metadata),U.animation&&P.animations.push(h.e.Parse(U.animation)),void 0!==U.linkedTransformNodeId&&null!==U.linkedTransformNodeId&&(y._hasWaitingData=!0,P._waitingTransformNodeId=U.linkedTransformNodeId)}if(t.ranges)for(I=0;I<t.ranges.length;I++){const U=t.ranges[I];y.createAnimationRange(U.name,U.from,U.to)}return y}computeAbsoluteMatrices(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||t)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(t)}getPoseMatrix(){let t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t}sortBones(){const t=[],U=new Array(this.bones.length);for(let y=0;y<this.bones.length;y++)this._sortBones(y,t,U);this.bones=t}_sortBones(t,U,y){if(y[t])return;y[t]=!0;const I=this.bones[t];if(!I)return;void 0===I._index&&(I._index=t);const r=I.getParent();r&&this._sortBones(this.bones.indexOf(r),U,y),U.push(I)}setCurrentPoseAsRest(){for(const t of this.bones)t.setCurrentPoseAsRest()}}var l=y(12741),g=y(12915),B=y(12361),b=y(12831),p=y(12480),c=y(12879),f=y(12844),S=y(12868),N=y(12969),j=y(12496),J=y(13729);class a{set areUpdatesFrozen(t){t?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new j.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,t||(t=F.d.LastCreatedScene),this._scene=t,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const t=this._scene.getEngine().getCaps();this._canUseTextureForTargets=t.canUseGLVertexID&&t.textureFloat&&t.maxVertexTextureImageUnits>0&&t.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return a.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?a.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(t){this._numMaxInfluencers!==t&&(this._numMaxInfluencers=t,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(t){this._useTextureToStoreTargets!==t&&(this._useTextureToStoreTargets=t,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var t;return a.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(t=this._scene)&&void 0!==t&&t.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(t){return this._activeTargets.data[t]}getTarget(t){return this._targets[t]}getTargetByName(t){for(const U of this._targets)if(U.name===t)return U;return null}addTarget(t){this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add((t=>{this.areUpdatesFrozen&&t&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(t)}))),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(t){const U=this._targets.indexOf(t);U>=0&&(this._targets.splice(U,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(U,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(U,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(t)}_bind(t){t.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),t.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),t.setTexture("morphTargets",this._targetStoreTexture),t.setInt("morphTargetCount",this.numInfluencers)}clone(){const t=new a(this._scene);for(const U of this._targets)t.addTarget(U.clone());return t.enablePositionMorphing=this.enablePositionMorphing,t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t.enableUV2Morphing=this.enableUV2Morphing,t.enableColorMorphing=this.enableColorMorphing,t}serialize(){const t={};t.id=this.uniqueId,t.targets=[];for(const U of this._targets)t.targets.push(U.serialize());return t}_syncActiveTargets(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const U=!!this._targetStoreTexture,y=this.isUsingTextureForTargets;(this._mustSynchronize||U!==y)&&(this._mustSynchronize=!1,this.synchronize());let I=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let r=-1;for(const Y of this._targets)if(r++,0!==Y.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=a.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Y),this._morphTargetTextureIndices[I]=r,this._tempInfluences[I++]=Y.influence}this._morphTargetTextureIndices.length!==I&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,I)),this._influences&&this._influences.length===I||(this._influences=new Float32Array(I));for(let Y=0;Y<I;Y++)this._influences[Y]=this._tempInfluences[Y];if(t&&this._scene)for(const Y of this._scene.meshes)Y.morphTargetManager===this&&(y?Y._markSubMeshesAsAttributesDirty():Y._syncGeometryWithMorphTargetManager())}synchronize(){var t;if(!this._scene||this.areUpdatesFrozen)return;const U=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(t=this._targetStoreTexture)||void 0===t||t.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>U.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const y of this._targets){this._supportsPositions=this._supportsPositions&&y.hasPositions,this._supportsNormals=this._supportsNormals&&y.hasNormals,this._supportsTangents=this._supportsTangents&&y.hasTangents,this._supportsUVs=this._supportsUVs&&y.hasUVs,this._supportsUV2s=this._supportsUV2s&&y.hasUV2s,this._supportsColors=this._supportsColors&&y.hasColors;const t=y.vertexCount;if(0===this._vertexCount)this._vertexCount=t;else if(this._vertexCount!==t)return void E.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${y.name}": ${t}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const t=U.getCaps().maxTextureSize;this._textureWidth>t&&(this._textureHeight=Math.ceil(this._textureWidth/t),this._textureWidth=t);const y=this._targets.length,I=new Float32Array(y*this._textureWidth*this._textureHeight*4);let r=0;for(let U=0;U<y;U++){const t=this._targets[U],y=t.getPositions(),Y=t.getNormals(),mt=t.getUVs(),X=t.getTangents(),P=t.getUV2s(),G=t.getColors();r=U*this._textureWidth*this._textureHeight*4;for(let U=0;U<this._vertexCount;U++)this._supportsPositions&&y&&(I[r]=y[3*U],I[r+1]=y[3*U+1],I[r+2]=y[3*U+2],r+=4),this._supportsNormals&&Y&&(I[r]=Y[3*U],I[r+1]=Y[3*U+1],I[r+2]=Y[3*U+2],r+=4),this._supportsUVs&&mt&&(I[r]=mt[2*U],I[r+1]=mt[2*U+1],r+=4),this._supportsTangents&&X&&(I[r]=X[3*U],I[r+1]=X[3*U+1],I[r+2]=X[3*U+2],r+=4),this._supportsUV2s&&P&&(I[r]=P[2*U],I[r+1]=P[2*U+1],r+=4),this._supportsColors&&G&&(I[r]=G[4*U],I[r+1]=G[4*U+1],I[r+2]=G[4*U+2],I[r+3]=G[4*U+3],r+=4)}this._targetStoreTexture=J.e.CreateRGBATexture(I,this._textureWidth,this._textureHeight,y,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const y of this._scene.meshes)y.morphTargetManager===this&&y._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const t=this._parentContainer.morphTargetManagers.indexOf(this);t>-1&&this._parentContainer.morphTargetManagers.splice(t,1),this._parentContainer=null}for(const t of this._targets)this._scene.stopAnimation(t)}}static Parse(t,U){const y=new a(U);for(const I of t.targets)y.addTarget(N.d.Parse(I,U));return y}}a.EnableTextureStorage=!0,a.MaxActiveMorphTargetsInVertexAttributeMode=8,a.ConstantTargetCountForTextureMode=0;var d=y(13779),q=y(12253),H=y(12758);const e=new Map,o=e;function V(t,U,y){n(t)&&E.b.Warn(`Extension with the name '${t}' already exists`),e.set(t,{isGLTFExtension:U,factory:y})}function n(t){return e.delete(t)}var i=y(13789),v=y(13020),O=y(12491);class k{static Get(t,U,y){if(!U||void 0==y||!U[y])throw new Error(`${t}: Failed to find index (${y})`);return U[y]}static TryGet(t,U){return t&&void 0!=U&&t[U]?t[U]:null}static Assign(t){if(t)for(let U=0;U<t.length;U++)t[U].index=U}}function s(t){if(t.min&&t.max){const U=t.min,y=t.max,I=r.TmpVectors.DU[0].aX(U[0],U[1],U[2]),Y=r.TmpVectors.DU[1].aX(y[0],y[1],y[2]);if(t.normalized&&5126!==t.componentType){let U=1;switch(t.componentType){case 5120:U=127;break;case 5121:U=255;break;case 5122:U=32767;break;case 5123:U=65535}const y=1/U;I.scaleInPlace(y),Y.scaleInPlace(y)}return new H.c(I,Y)}return null}class x{static RegisterExtension(t,U){V(t,!1,U)}static UnregisterExtension(t){return n(t)}get lX(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((t=>t.dispose&&t.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(t,U,y,I,r,Y){let mt=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=U,this._assetContainer=y,this._loadData(I);let Y=null;if(t){const U={};if(this._gltf.nodes)for(const t of this._gltf.nodes)t.name&&(U[t.name]=t.index);Y=(t instanceof Array?t:[t]).map((t=>{const y=U[t];if(void 0===y)throw new Error(`Failed to find node '${t}'`);return y}))}return await this._loadAsync(r,mt,Y,(()=>({meshes:this._getMeshes(),mQ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=t,this._loadData(U),await this._loadAsync(y,r,null,(()=>{}))}async _loadAsync(t,U,y,I){return await Promise.resolve().then((async()=>{this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&U?t:`${t}${Date.now()}/`,this._fileName=U,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const r=`${d.j[d.j.LOADING]} => ${d.j[d.j.READY]}`,Y=`${d.j[d.j.LOADING]} => ${d.j[d.j.COMPLETE]}`;this._parent._startPerformanceCounter(r),this._parent._startPerformanceCounter(Y),this._parent._setState(d.j.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(y)X.push(this.loadSceneAsync("/nodes",{nodes:y,index:-1}));else if(void 0!=this._gltf.gU||this._gltf.scenes&&this._gltf.scenes[0]){const t=k.Get("/scene",this._gltf.scenes,this._gltf.gU||0);X.push(this.loadSceneAsync(`/scenes/${t.index}`,t))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let t=0;t<this._gltf.materials.length;++t){const U=this._gltf.materials[t],y="/materials/"+t,I=l.e.TriangleFillMode;X.push(this._loadMaterialAsync(y,U,null,I,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());const P=Promise.all(X).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.tP(!0);for(const t of this._babylonScene.materials){const U=t;void 0!==U.maxSimultaneousLights&&(U.maxSimultaneousLights=Math.max(U.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(d.j.READY),this._skipStartAnimationStep||this._startAnimations(),I()}));return await P.then((t=>(this._parent._endPerformanceCounter(r),mt.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Y),this._parent._setState(d.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(t=>{this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()}))})),t)))})).catch((t=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()),t}))}_loadData(t){if(this._gltf=t.json,this._setupData(),t.bin){const U=this._gltf.buffers;if(U&&U[0]&&!U[0].uri){const y=U[0];(y.byteLength<t.bin.byteLength-3||y.byteLength>t.bin.byteLength)&&E.b.Warn(`Binary buffer length (${y.byteLength}) from JSON does not match chunk length (${t.bin.byteLength})`),this._bin=t.bin}else E.b.Warn("Unexpected BIN chunk")}}_setupData(){if(k.Assign(this._gltf.accessors),k.Assign(this._gltf.animations),k.Assign(this._gltf.buffers),k.Assign(this._gltf.bufferViews),k.Assign(this._gltf.cameras),k.Assign(this._gltf.images),k.Assign(this._gltf.materials),k.Assign(this._gltf.meshes),k.Assign(this._gltf.nodes),k.Assign(this._gltf.samplers),k.Assign(this._gltf.scenes),k.Assign(this._gltf.skins),k.Assign(this._gltf.textures),this._gltf.nodes){const t={};for(const y of this._gltf.nodes)if(y.children)for(const U of y.children)t[U]=y.index;const U=this._createRootNode();for(const y of this._gltf.nodes){const I=t[y.index];y.parent=void 0===I?U:this._gltf.nodes[I]}}}async _loadExtensionsAsync(){const t=[];if(o.forEach(((U,y)=>{var I;!1===(null===(I=this.parent.extensionOptions[y])||void 0===I?void 0:I.enabled)?U.isGLTFExtension&&this.isExtensionUsed(y)&&E.b.Warn(`Extension ${y} is used but has been explicitly disabled.`):U.isGLTFExtension&&!this.isExtensionUsed(y)||t.push((async()=>{const t=await U.factory(this);return t.name!==y&&E.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${t.name} !== ${y}`),this._parent.onExtensionLoadedObservable.notifyObservers(t),t})())})),this._extensions.push(...await Promise.all(t)),this._extensions.sort(((t,U)=>(t.order||Number.MAX_VALUE)-(U.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const y of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===y&&t.enabled))){var U;if(!1===(null===(U=this.parent.extensionOptions[y])||void 0===U?void 0:U.enabled))throw new Error(`Required extension ${y} is disabled`);throw new Error(`Required extension ${y} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new S.c("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.tP(!1);const U={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case d.h.AUTO:this._babylonScene.useRightHandedSystem||(U.rotation=[0,1,0,0],U.scale=[1,1,-1],x._LoadTransform(U,this._rootBabylonMesh));break;case d.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),U}loadSceneAsync(t,U){const y=this._extensionsLoadSceneAsync(t,U);if(y)return y;const I=new Array;if(this.logOpen(`${t} ${U.name||""}`),U.nodes)for(const r of U.nodes){const U=k.Get(`${t}/nodes/${r}`,this._gltf.nodes,r);I.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(t=>{t.parent=this._rootBabylonMesh})))}for(const r of this._postSceneLoadActions)r();return I.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(I).then((()=>{}))}_forEachPrimitive(t,U){if(t._primitiveBabylonMeshes)for(const y of t._primitiveBabylonMeshes)U(y)}_getGeometries(){const t=[],U=this._gltf.nodes;if(U)for(const y of U)this._forEachPrimitive(y,(U=>{const y=U.NX;y&&-1===t.indexOf(y)&&t.push(y)}));return t}_getMeshes(){const t=[];this._rootBabylonMesh instanceof f.c&&t.push(this._rootBabylonMesh);const U=this._gltf.nodes;if(U)for(const y of U)this._forEachPrimitive(y,(U=>{t.push(U)}));return t}_getTransformNodes(){const t=[],U=this._gltf.nodes;if(U)for(const y of U)y._babylonTransformNode&&"Ph"===y._babylonTransformNode.getClassName()&&t.push(y._babylonTransformNode),y._babylonTransformNodeForSkin&&t.push(y._babylonTransformNodeForSkin);return t}_getSkeletons(){const t=[],U=this._gltf.skins;if(U)for(const y of U)y._data&&t.push(y._data.babylonSkeleton);return t}_getAnimationGroups(){const t=[],U=this._gltf.animations;if(U)for(const y of U)y._babylonAnimationGroup&&t.push(y._babylonAnimationGroup);return t}_startAnimations(){switch(this._parent.animationStartMode){case d.f.NONE:break;case d.f.FIRST:{const t=this._getAnimationGroups();0!==t.length&&t[0].start(!0);break}case d.f.ALL:{const t=this._getAnimationGroups();for(const U of t)U.start(!0);break}default:return void E.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const I=this._extensionsLoadNodeAsync(t,U,y);if(I)return I;if(U._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const r=new Array;this.logOpen(`${t} ${U.name||""}`);const Y=I=>{if(x.AddPointerMetadata(I,t),x._LoadTransform(U,I),void 0!=U.camera){const y=k.Get(`${t}/camera`,this._gltf.cameras,U.camera);r.push(this.loadCameraAsync(`/cameras/${y.index}`,y,(t=>{t.parent=I,this._babylonScene.useRightHandedSystem||(I.dX.x=-1)})))}if(U.children)for(const y of U.children){const U=k.Get(`${t}/children/${y}`,this._gltf.nodes,y);r.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(t=>{t.parent=I})))}y(I)},mt=void 0!=U.mesh,X=this._parent.loadSkins&&void 0!=U.skin;if(!mt||X){const t=U.name||`node${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new b.d(t,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==U.mesh?U._babylonTransformNode=y:U._babylonTransformNodeForSkin=y,Y(y)}if(mt)if(X){const y=k.Get(`${t}/mesh`,this._gltf.meshes,U.mesh);r.push(this._loadMeshAsync(`/meshes/${y.index}`,U,y,(y=>{const I=U._babylonTransformNodeForSkin;y.metadata=(0,v.d)(I.metadata,y.metadata||{});const Y=k.Get(`${t}/skin`,this._gltf.skins,U.skin);r.push(this._loadSkinAsync(`/skins/${Y.index}`,U,Y,(t=>{this._forEachPrimitive(U,(U=>{U.skeleton=t})),this._postSceneLoadActions.push((()=>{if(void 0!=Y.skeleton){const t=k.Get(`/skins/${Y.index}/skeleton`,this._gltf.nodes,Y.skeleton).parent;U.index===t.index?y.parent=I.parent:y.parent=t._babylonTransformNode}else y.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:I,skinnedNode:y})}))})))})))}else{const y=k.Get(`${t}/mesh`,this._gltf.meshes,U.mesh);r.push(this._loadMeshAsync(`/meshes/${y.index}`,U,y,Y))}return this.logClose(),Promise.all(r).then((()=>(this._forEachPrimitive(U,(t=>{const U=t;!U.isAnInstance&&U.NX&&U.NX.useBoundingInfoFromGeometry?t.Vt():t.refreshBoundingInfo(!0,!0)})),U._babylonTransformNode)))}_loadMeshAsync(t,U,y,I){const r=y.primitives;if(!r||!r.length)throw new Error(`${t}: Primitives are missing`);void 0==r[0].index&&k.Assign(r);const Y=new Array;this.logOpen(`${t} ${y.name||""}`);const mt=U.name||`node${U.index}`;if(1===r.length){const I=y.primitives[0];Y.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${I.index}`,mt,U,y,I,(t=>{U._babylonTransformNode=t,U._primitiveBabylonMeshes=[t]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,U._babylonTransformNode=new b.d(mt,this._babylonScene),U._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._primitiveBabylonMeshes=[];for(const I of r)Y.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${I.index}`,`${mt}_primitive${I.index}`,U,y,I,(t=>{t.parent=U._babylonTransformNode,U._primitiveBabylonMeshes.push(t)})))}return I(U._babylonTransformNode),this.logClose(),Promise.all(Y).then((()=>U._babylonTransformNode))}_loadMeshPrimitiveAsync(t,U,y,I,r,Y){const mt=this._extensionsLoadMeshPrimitiveAsync(t,U,y,I,r,Y);if(mt)return mt;this.logOpen(`${t}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==y.skin&&!I.primitives[0].targets;let P,G;if(X&&r._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,P=r._instanceData.babylonSourceMesh.createInstance(U),P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G=r._instanceData.promise;else{const Y=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const mt=new S.c(U,this._babylonScene);mt._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,mt.sideOrientation=this._babylonScene.useRightHandedSystem?l.e.CounterClockWiseSideOrientation:l.e.ClockWiseSideOrientation,this._createMorphTargets(t,y,I,r,mt),Y.push(this._loadVertexDataAsync(t,r,mt).then((async U=>await this._loadMorphTargetsAsync(t,r,mt,U).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,U.et(mt),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const M=x._GetDrawMode(t,r.mode);if(void 0==r.material){let t=this._defaultBabylonMaterialData[M];t||(t=this._createDefaultMaterial("__GLTFLoader._default",M),this._parent.onMaterialLoadedObservable.notifyObservers(t),this._defaultBabylonMaterialData[M]=t),mt.material=t}else if(!this.parent.skipMaterials){const U=k.Get(`${t}/material`,this._gltf.materials,r.material);Y.push(this._loadMaterialAsync(`/materials/${U.index}`,U,mt,M,(t=>{mt.material=t})))}G=Promise.all(Y),X&&(r._instanceData={babylonSourceMesh:mt,promise:G}),P=mt}return x.AddPointerMetadata(P,t),this._parent.onMeshLoadedObservable.notifyObservers(P),Y(P),this.logClose(),G.then((()=>P))}_loadVertexDataAsync(t,U,y){const I=this._extensionsLoadVertexDataAsync(t,U,y);if(I)return I;const r=U.attributes;if(!r)throw new Error(`${t}: Attributes are missing`);const Y=new Array,mt=new c.c(y.name,this._babylonScene);if(void 0==U.indices)y.isUnIndexed=!0;else{const y=k.Get(`${t}/indices`,this._gltf.accessors,U.indices);Y.push(this._loadIndicesAccessorAsync(`/accessors/${y.index}`,y).then((t=>{mt.setIndices(t)})))}const X=(U,I,X)=>{if(void 0==r[U])return;y._delayInfo=y._delayInfo||[],-1===y._delayInfo.indexOf(I)&&y._delayInfo.push(I);const P=k.Get(`${t}/attributes/${U}`,this._gltf.accessors,r[U]);Y.push(this._loadVertexAccessorAsync(`/accessors/${P.index}`,P,I).then((t=>{if(t.getKind()===p.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!y.skeleton){const t=s(P);t&&(mt._boundingInfo=t,mt.useBoundingInfoFromGeometry=!0)}mt.setVerticesBuffer(t,P.count)}))),I==p.e.MatricesIndicesExtraKind&&(y.numBoneInfluencers=8),X&&X(P)};return X("POSITION",p.e.PositionKind),X("NORMAL",p.e.NormalKind),X("TANGENT",p.e.TangentKind),X("TEXCOORD_0",p.e.UVKind),X("TEXCOORD_1",p.e.UV2Kind),X("TEXCOORD_2",p.e.UV3Kind),X("TEXCOORD_3",p.e.UV4Kind),X("TEXCOORD_4",p.e.UV5Kind),X("TEXCOORD_5",p.e.UV6Kind),X("JOINTS_0",p.e.MatricesIndicesKind),X("WEIGHTS_0",p.e.MatricesWeightsKind),X("JOINTS_1",p.e.MatricesIndicesExtraKind),X("WEIGHTS_1",p.e.MatricesWeightsExtraKind),X("COLOR_0",p.e.ColorKind,(t=>{"VEC4"===t.type&&(y.hasVertexAlpha=!0)})),Promise.all(Y).then((()=>mt))}_createMorphTargets(t,U,y,I,r){if(!I.targets||!this._parent.loadMorphTargets)return;if(void 0==U._numMorphTargets)U._numMorphTargets=I.targets.length;else if(I.targets.length!==U._numMorphTargets)throw new Error(`${t}: Primitives do not have the same number of targets`);const Y=y.extras?y.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,r.morphTargetManager=new a(this._babylonScene),r.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.morphTargetManager.areUpdatesFrozen=!0;for(let mt=0;mt<I.targets.length;mt++){const t=U.weights?U.weights[mt]:y.weights?y.weights[mt]:0,I=Y?Y[mt]:`morphTarget${mt}`;r.morphTargetManager.addTarget(new N.d(I,t,r.St()))}}_loadMorphTargetsAsync(t,U,y,I){if(!U.targets||!this._parent.loadMorphTargets)return Promise.resolve();const r=new Array,Y=y.morphTargetManager;for(let mt=0;mt<Y.numTargets;mt++){const y=Y.getTarget(mt);r.push(this._loadMorphTargetVertexDataAsync(`${t}/targets/${mt}`,I,U.targets[mt],y))}return Promise.all(r).then((()=>{Y.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(t,U,y,I){const r=new Array,Y=(I,Y,mt)=>{if(void 0==y[I])return;const X=U.getVertexBuffer(Y);if(!X)return;const P=k.Get(`${t}/${I}`,this._gltf.accessors,y[I]);r.push(this._loadFloatAccessorAsync(`/accessors/${P.index}`,P).then((t=>{mt(X,t)})))};return Y("POSITION",p.e.PositionKind,((t,U)=>{const y=new Float32Array(U.length);t.forEach(U.length,((t,I)=>{y[I]=U[I]+t})),I.setPositions(y)})),Y("NORMAL",p.e.NormalKind,((t,U)=>{const y=new Float32Array(U.length);t.forEach(y.length,((t,I)=>{y[I]=U[I]+t})),I.setNormals(y)})),Y("TANGENT",p.e.TangentKind,((t,U)=>{const y=new Float32Array(U.length/3*4);let r=0;t.forEach(U.length/3*4,((t,I)=>{(I+1)%4!==0&&(y[r]=U[r]+t,r++)})),I.setTangents(y)})),Y("TEXCOORD_0",p.e.UVKind,((t,U)=>{const y=new Float32Array(U.length);t.forEach(U.length,((t,I)=>{y[I]=U[I]+t})),I.setUVs(y)})),Y("TEXCOORD_1",p.e.UV2Kind,((t,U)=>{const y=new Float32Array(U.length);t.forEach(U.length,((t,I)=>{y[I]=U[I]+t})),I.setUV2s(y)})),Y("COLOR_0",p.e.ColorKind,((U,y)=>{let r=null;const Y=U.getSize();if(3===Y){r=new Float32Array(y.length/3*4),U.forEach(y.length,((t,U)=>{const I=Math.floor(U/3),Y=U%3;r[4*I+Y]=y[3*I+Y]+t}));for(let t=0;t<y.length/3;++t)r[4*t+3]=1}else{if(4!==Y)throw new Error(`${t}: Invalid number of components (${Y}) for COLOR_0 attribute`);r=new Float32Array(y.length),U.forEach(y.length,((t,U)=>{r[U]=y[U]+t}))}I.setColors(r)})),await Promise.all(r).then((()=>{}))}static _LoadTransform(t,U){if(void 0!=t.skin)return;let y=r.DU.Zero(),I=r.Quaternion.Identity(),Y=r.DU.One();if(t.matrix){r.Matrix.pU(t.matrix).decompose(Y,I,y)}else t.translation&&(y=r.DU.pU(t.translation)),t.rotation&&(I=r.Quaternion.pU(t.rotation)),t.scale&&(Y=r.DU.pU(t.scale));U.position=y,U.rotationQuaternion=I,U.dX=Y}_loadSkinAsync(t,U,y,I){if(!this._parent.loadSkins)return Promise.resolve();const r=this._extensionsLoadSkinAsync(t,U,y);if(r)return r;if(y._data)return I(y._data.babylonSkeleton),y._data.promise;const Y=`skeleton${y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const mt=new D(y.name||Y,Y,this._babylonScene);mt._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,y,mt);const X=this._loadSkinInverseBindMatricesDataAsync(t,y).then((t=>{this._updateBoneMatrices(mt,t)}));return y._data={babylonSkeleton:mt,promise:X},I(mt),X}_loadBones(t,U,y){if(void 0==U.skeleton||this._parent.alwaysComputeSkeletonRootNode){const y=this._findSkeletonRootNode(`${t}/joints`,U.joints);if(y)if(void 0===U.skeleton)U.skeleton=y.index;else{const I=(t,U)=>{for(;U.parent;U=U.parent)if(U.parent===t)return!0;return!1},r=k.Get(`${t}/skeleton`,this._gltf.nodes,U.skeleton);r===y||I(r,y)||(E.b.Warn(`${t}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),U.skeleton=y.index)}else E.b.Warn(`${t}: Failed to find common root`)}const I={};for(const r of U.joints){const Y=k.Get(`${t}/joints/${r}`,this._gltf.nodes,r);this._loadBone(Y,U,y,I)}}_findSkeletonRootNode(t,U){if(0===U.length)return null;const y={};for(const r of U){const U=[];let I=k.Get(`${t}/${r}`,this._gltf.nodes,r);for(;-1!==I.index;)U.unshift(I),I=I.parent;y[r]=U}let I=null;for(let r=0;;++r){let t=y[U[0]];if(r>=t.length)return I;const Y=t[r];for(let mt=1;mt<U.length;++mt)if(t=y[U[mt]],r>=t.length||Y!==t[r])return I;I=Y}}_loadBone(t,U,y,I){t._isJoint=!0;let r=I[t.index];if(r)return r;let Y=null;t.index!==U.skeleton&&(t.parent&&-1!==t.parent.index?Y=this._loadBone(t.parent,U,y,I):void 0!==U.skeleton&&E.b.Warn(`/skins/${U.index}/skeleton: Skeleton node is not a common root`));const mt=U.joints.indexOf(t.index);return r=new G.e(t.name||`joint${t.index}`,y,Y,this._getNodeMatrix(t),null,null,mt),I[t.index]=r,this._postSceneLoadActions.push((()=>{r.linkTransformNode(t._babylonTransformNode)})),r}_loadSkinInverseBindMatricesDataAsync(t,U){if(void 0==U.inverseBindMatrices)return Promise.resolve(null);const y=k.Get(`${t}/inverseBindMatrices`,this._gltf.accessors,U.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${y.index}`,y)}_updateBoneMatrices(t,U){for(const y of t.bones){const t=r.Matrix.Identity(),I=y._index;U&&-1!==I&&(r.Matrix.FromArrayToRef(U,16*I,t),t.invertToRef(t));const Y=y.getParent();Y&&t.multiplyToRef(Y.getAbsoluteInverseBindMatrix(),t),y.fX(t,!1,!1),y._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(t){return t.matrix?r.Matrix.pU(t.matrix):r.Matrix.Compose(t.scale?r.DU.pU(t.scale):r.DU.One(),t.rotation?r.Quaternion.pU(t.rotation):r.Quaternion.Identity(),t.translation?r.DU.pU(t.translation):r.DU.Zero())}loadCameraAsync(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const I=this._extensionsLoadCameraAsync(t,U,y);if(I)return I;const Y=new Array;this.logOpen(`${t} ${U.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const mt=new P.d(U.name||`camera${U.index}`,r.DU.Zero(),this._babylonScene,!1);switch(mt._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonCamera=mt,mt.setTarget(new r.DU(0,0,-1)),U.type){case"perspective":{const y=U.perspective;if(!y)throw new Error(`${t}: Camera perspective properties are missing`);mt.fov=y.yfov,mt.cX=y.znear,mt.maxZ=y.zfar||0;break}case"orthographic":if(!U.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);mt.mode=X.e.ORTHOGRAPHIC_CAMERA,mt.orthoLeft=-U.orthographic.xmag,mt.orthoRight=U.orthographic.xmag,mt.orthoBottom=-U.orthographic.ymag,mt.orthoTop=U.orthographic.ymag,mt.cX=U.orthographic.znear,mt.maxZ=U.orthographic.zfar;break;default:throw new Error(`${t}: Invalid camera type (${U.type})`)}return x.AddPointerMetadata(mt,t),this._parent.onCameraLoadedObservable.notifyObservers(mt),y(mt),this.logClose(),Promise.all(Y).then((()=>mt))}_loadAnimationsAsync(){const t=this._gltf.animations;if(!t)return Promise.resolve();const U=new Array;for(let y=0;y<t.length;y++){const I=t[y];U.push(this.loadAnimationAsync(`/animations/${I.index}`,I).then((t=>{0===t.targetedAnimations.length&&t.dispose()})))}return Promise.all(U).then((()=>{}))}loadAnimationAsync(t,U){const I=this._extensionsLoadAnimationAsync(t,U);return I||y.e(78).then(y.bind(y,15319)).then((y=>{let{AnimationGroup:I}=y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new I(U.name||`animation${U.index}`,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonAnimationGroup=r;const Y=new Array;k.Assign(U.channels),k.Assign(U.samplers);for(const mt of U.channels)Y.push(this._loadAnimationChannelAsync(`${t}/channels/${mt.index}`,t,U,mt,((t,U)=>{t.animations=t.animations||[],t.animations.push(U),r.addTargetedAnimation(U,t)})));return Promise.all(Y).then((()=>(r.normalize(0),r)))}))}async _loadAnimationChannelAsync(t,U,I,r,Y){const mt=this._extensionsLoadAnimationChannelAsync(t,U,I,r,Y);if(mt)return await mt;if(void 0==r.target.node)return await Promise.resolve();const X=k.Get(`${t}/target/node`,this._gltf.nodes,r.target.node),P=r.target.path,G="weights"===P;if(G&&!X._numMorphTargets||!G&&!X._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!G&&!X._isJoint)return await Promise.resolve();let M;switch(await Promise.resolve().then(y.bind(y,13793)),P){case"translation":var L;M=null===(L=(0,i.e)("/nodes/{}/translation"))||void 0===L?void 0:L.interpolation;break;case"rotation":var h;M=null===(h=(0,i.e)("/nodes/{}/rotation"))||void 0===h?void 0:h.interpolation;break;case"scale":var Q;M=null===(Q=(0,i.e)("/nodes/{}/scale"))||void 0===Q?void 0:Q.interpolation;break;case"weights":var F;M=null===(F=(0,i.e)("/nodes/{}/weights"))||void 0===F?void 0:F.interpolation;break;default:throw new Error(`${t}/target/path: Invalid value (${r.target.path})`)}if(!M)throw new Error(`${t}/target/path: Could not find interpolation properties for target path (${r.target.path})`);const E={object:X,info:M};return await this._loadAnimationChannelFromTargetInfoAsync(t,U,I,r,E,Y)}_loadAnimationChannelFromTargetInfoAsync(t,U,y,I,r,Y){const mt=this.parent.targetFps,X=1/mt,P=k.Get(`${t}/sampler`,y.samplers,I.sampler);return this._loadAnimationSamplerAsync(`${U}/samplers/${I.sampler}`,P).then((t=>{let U=0;const P=r.object,G=r.info;for(const r of G){const G=r.getStride(P),M=t.input,L=t.output,h=new Array(M.length);let Q=0;switch(t.interpolation){case"STEP":for(let t=0;t<M.length;t++){const U=r.getValue(P,L,Q,1);Q+=G,h[t]={frame:M[t]*mt,value:U,interpolation:1}}break;case"CUBICSPLINE":for(let t=0;t<M.length;t++){const U=r.getValue(P,L,Q,X);Q+=G;const y=r.getValue(P,L,Q,1);Q+=G;const I=r.getValue(P,L,Q,X);Q+=G,h[t]={frame:M[t]*mt,inTangent:U,value:y,outTangent:I}}break;case"LINEAR":for(let t=0;t<M.length;t++){const U=r.getValue(P,L,Q,1);Q+=G,h[t]={frame:M[t]*mt,value:U}}}if(Q>0){const t=`${y.name||`animation${y.index}`}_channel${I.index}_${U}`,X=r.buildAnimations(P,t,mt,h);for(const y of X)U++,Y(y.babylonAnimatable,y.babylonAnimation)}}}))}_loadAnimationSamplerAsync(t,U){if(U._data)return U._data;const y=U.interpolation||"LINEAR";switch(y){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${t}/interpolation: Invalid value (${U.interpolation})`)}const I=k.Get(`${t}/input`,this._gltf.accessors,U.input),r=k.Get(`${t}/output`,this._gltf.accessors,U.output);return U._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${I.index}`,I),this._loadFloatAccessorAsync(`/accessors/${r.index}`,r)]).then((t=>{let[U,I]=t;return{input:U,interpolation:y,output:I}})),U._data}loadBufferAsync(t,U,y,I){const r=this._extensionsLoadBufferAsync(t,U,y,I);if(r)return r;if(!U._data)if(U.uri)U._data=this.loadUriAsync(`${t}/uri`,U,U.uri);else{if(!this._bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);U._data=this._bin.readAsync(0,U.byteLength)}return U._data.then((U=>{try{return new Uint8Array(U.buffer,U.byteOffset+y,I)}catch(r){throw new Error(`${t}: ${r.message}`)}}))}loadBufferViewAsync(t,U){const y=this._extensionsLoadBufferViewAsync(t,U);if(y)return y;if(U._data)return U._data;const I=k.Get(`${t}/buffer`,this._gltf.buffers,U.buffer);return U._data=this.loadBufferAsync(`/buffers/${I.index}`,I,U.byteOffset||0,U.byteLength),U._data}_loadAccessorAsync(t,U,y){if(U._data)return U._data;const I=x._GetNumComponents(t,U.type),r=I*p.e.GetTypeByteLength(U.componentType),Y=I*U.count;if(void 0==U.bufferView)U._data=Promise.resolve(new y(Y));else{const mt=k.Get(`${t}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${mt.index}`,mt).then((X=>{if(5126!==U.componentType||U.normalized||mt.byteStride&&mt.byteStride!==r){const t=new y(Y);return p.e.ForEach(X,U.byteOffset||0,mt.byteStride||r,I,U.componentType,t.length,U.normalized||!1,((U,y)=>{t[y]=U})),t}return x._GetTypedArray(t,U.componentType,X,U.byteOffset,Y)}))}if(U.sparse){const Y=U.sparse;U._data=U._data.then((mt=>{const X=mt,P=k.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,Y.indices.bufferView),G=k.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,Y.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${P.index}`,P),this.loadBufferViewAsync(`/bufferViews/${G.index}`,G)]).then((mt=>{let[P,G]=mt;const M=x._GetTypedArray(`${t}/sparse/indices`,Y.indices.componentType,P,Y.indices.byteOffset,Y.count),L=I*Y.count;let h;if(5126!==U.componentType||U.normalized){const mt=x._GetTypedArray(`${t}/sparse/values`,U.componentType,G,Y.values.byteOffset,L);h=new y(L),p.e.ForEach(mt,0,r,I,U.componentType,h.length,U.normalized||!1,((t,U)=>{h[U]=t}))}else h=x._GetTypedArray(`${t}/sparse/values`,U.componentType,G,Y.values.byteOffset,L);let Q=0;for(let t=0;t<M.length;t++){let U=M[t]*I;for(let t=0;t<I;t++)X[U++]=h[Q++]}return X}))}))}return U._data}_loadFloatAccessorAsync(t,U){return this._loadAccessorAsync(t,U,Float32Array)}_loadIndicesAccessorAsync(t,U){if("SCALAR"!==U.type)throw new Error(`${t}/type: Invalid value ${U.type}`);if(5121!==U.componentType&&5123!==U.componentType&&5125!==U.componentType)throw new Error(`${t}/componentType: Invalid value ${U.componentType}`);if(U._data)return U._data;if(U.sparse){const y=x._GetTypedArrayConstructor(`${t}/componentType`,U.componentType);U._data=this._loadAccessorAsync(t,U,y)}else{const y=k.Get(`${t}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((y=>x._GetTypedArray(t,U.componentType,y,U.byteOffset,U.count)))}return U._data}_loadVertexBufferViewAsync(t){if(t._babylonBuffer)return t._babylonBuffer;const U=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((t=>new p.b(U,t,!1))),t._babylonBuffer}_loadVertexAccessorAsync(t,U,y){var I;if(null!==(I=U._babylonVertexBuffer)&&void 0!==I&&I[y])return U._babylonVertexBuffer[y];U._babylonVertexBuffer||(U._babylonVertexBuffer={});const r=this._babylonScene.getEngine();if(U.sparse||void 0==U.bufferView)U._babylonVertexBuffer[y]=this._loadFloatAccessorAsync(t,U).then((t=>new p.e(r,t,y,!1)));else{const I=k.Get(`${t}/bufferView`,this._gltf.bufferViews,U.bufferView);U._babylonVertexBuffer[y]=this._loadVertexBufferViewAsync(I).then((Y=>{const mt=x._GetNumComponents(t,U.type);return new p.e(r,Y,y,!1,void 0,I.byteStride,void 0,U.byteOffset,mt,U.componentType,U.normalized,!0,void 0,!0)}))}return U._babylonVertexBuffer[y]}_loadMaterialMetallicRoughnessPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return U&&(U.baseColorFactor?(y.albedoColor=Y.bU.pU(U.baseColorFactor),y.alpha=U.baseColorFactor[3]):y.albedoColor=Y.bU.White(),y.metallic=void 0==U.metallicFactor?1:U.metallicFactor,y.roughness=void 0==U.roughnessFactor?1:U.roughnessFactor,U.baseColorTexture&&I.push(this.loadTextureInfoAsync(`${t}/baseColorTexture`,U.baseColorTexture,(t=>{t.name=`${y.name} (Base Color)`,y.albedoTexture=t}))),U.metallicRoughnessTexture&&(U.metallicRoughnessTexture.nonColorData=!0,I.push(this.loadTextureInfoAsync(`${t}/metallicRoughnessTexture`,U.metallicRoughnessTexture,(t=>{t.name=`${y.name} (Metallic Roughness)`,y.metallicTexture=t}))),y.useMetallnessFromMetallicTextureBlue=!0,y.useRoughnessFromMetallicTextureGreen=!0,y.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(I).then((()=>{}))}_loadMaterialAsync(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Y=this._extensionsLoadMaterialAsync(t,U,y,I,r);if(Y)return Y;U._data=U._data||{};let mt=U._data[I];if(!mt){this.logOpen(`${t} ${U.name||""}`);const y=this.createMaterial(t,U,I);mt={babylonMaterial:y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,U,y)},U._data[I]=mt,x.AddPointerMetadata(y,t),this._parent.onMaterialLoadedObservable.notifyObservers(y),this.logClose()}return y&&(mt.babylonMeshes.push(y),y.FX.addOnce((()=>{const t=mt.babylonMeshes.indexOf(y);-1!==t&&mt.babylonMeshes.splice(t,1)}))),r(mt.babylonMaterial),mt.promise.then((()=>mt.babylonMaterial))}_createDefaultMaterial(t,U){this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new g.d(t,this._babylonScene);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.fillMode=U,y.enableSpecularAntiAliasing=!0,y.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,y.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,y.transparencyMode=g.d.PBRMATERIAL_OPAQUE,y.metallic=1,y.roughness=1,y}createMaterial(t,U,y){const I=this._extensionsCreateMaterial(t,U,y);if(I)return I;const r=U.name||`material${U.index}`;return this._createDefaultMaterial(r,y)}loadMaterialPropertiesAsync(t,U,y){const I=this._extensionsLoadMaterialPropertiesAsync(t,U,y);if(I)return I;const r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(t,U,y)),U.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${t}/pbrMetallicRoughness`,U.pbrMetallicRoughness,y)),this.loadMaterialAlphaProperties(t,U,y),Promise.all(r).then((()=>{}))}loadMaterialBasePropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return y.emissiveColor=U.emissiveFactor?Y.bU.pU(U.emissiveFactor):new Y.bU(0,0,0),U.doubleSided&&(y.JX=!1,y.twoSidedLighting=!0),U.normalTexture&&(U.normalTexture.nonColorData=!0,I.push(this.loadTextureInfoAsync(`${t}/normalTexture`,U.normalTexture,(t=>{t.name=`${y.name} (Normal)`,y.bumpTexture=t}))),y.invertNormalMapX=!this._babylonScene.useRightHandedSystem,y.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=U.normalTexture.scale&&y.bumpTexture&&(y.bumpTexture.level=U.normalTexture.scale),y.forceIrradianceInFragment=!0),U.occlusionTexture&&(U.occlusionTexture.nonColorData=!0,I.push(this.loadTextureInfoAsync(`${t}/occlusionTexture`,U.occlusionTexture,(t=>{t.name=`${y.name} (Occlusion)`,y.ambientTexture=t}))),y.useAmbientInGrayScale=!0,void 0!=U.occlusionTexture.strength&&(y.ambientTextureStrength=U.occlusionTexture.strength)),U.emissiveTexture&&I.push(this.loadTextureInfoAsync(`${t}/emissiveTexture`,U.emissiveTexture,(t=>{t.name=`${y.name} (Emissive)`,y.emissiveTexture=t}))),Promise.all(I).then((()=>{}))}loadMaterialAlphaProperties(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);switch(U.alphaMode||"OPAQUE"){case"OPAQUE":y.transparencyMode=g.d.PBRMATERIAL_OPAQUE,y.alpha=1;break;case"MASK":y.transparencyMode=g.d.PBRMATERIAL_ALPHATEST,y.alphaCutOff=void 0==U.alphaCutoff?.5:U.alphaCutoff,y.albedoTexture&&(y.albedoTexture.pX=!0);break;case"BLEND":y.transparencyMode=g.d.PBRMATERIAL_ALPHABLEND,y.albedoTexture&&(y.albedoTexture.pX=!0,y.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${t}/alphaMode: Invalid value (${U.alphaMode})`)}}loadTextureInfoAsync(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const I=this._extensionsLoadTextureInfoAsync(t,U,y);if(I)return I;if(this.logOpen(`${t}`),U.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${U.texCoord})`);const r=k.Get(`${t}/index`,this._gltf.textures,U.index);r._textureInfo=U;const Y=this._loadTextureAsync(`/textures/${U.index}`,r,(I=>{I.coordinatesIndex=U.texCoord||0,x.AddPointerMetadata(I,t),this._parent.onTextureLoadedObservable.notifyObservers(I),y(I)}));return this.logClose(),Y}_loadTextureAsync(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const I=this._extensionsLoadTextureAsync(t,U,y);if(I)return I;this.logOpen(`${t} ${U.name||""}`);const r=void 0==U.sampler?x.DefaultSampler:k.Get(`${t}/sampler`,this._gltf.samplers,U.sampler),Y=k.Get(`${t}/source`,this._gltf.images,U.source),mt=this._createTextureAsync(t,r,Y,y,void 0,!U._textureInfo.nonColorData);return this.logClose(),mt}_createTextureAsync(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Y=arguments.length>4?arguments[4]:void 0,mt=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${U.index}`,U),P=new Array,G=new I;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,u:()=>{this._disposed||G.resolve()},onError:(U,y)=>{this._disposed||G.reject(new Error(`${t}: ${y&&y.message?y.message:U||"Failed to load texture"}`))},mimeType:y.mimeType??(0,q.i)(y.uri??""),loaderOptions:Y,useSRGBBuffer:!!mt&&this._parent.useSRGBBuffers},L=new B.d(null,this._babylonScene,M);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.push(G.promise),P.push(this.loadImageAsync(`/images/${y.index}`,y).then((t=>{const U=y.uri||`${this._fileName}#image${y.index}`,I=`data:${this._uniqueRootUrl}${U}`;L.updateURL(I,t);const r=L.getInternalTexture();r&&(r.label=y.name)}))),L.wrapU=X.wrapU,L.wrapV=X.wrapV,r(L),this._parent.useGltfTextureNames&&(L.name=y.name||y.uri||`image${y.index}`),Promise.all(P).then((()=>L))}_loadSampler(t,U){return U._data||(U._data={noMipMaps:9728===U.minFilter||9729===U.minFilter,samplingMode:x._GetTextureSamplingMode(t,U),wrapU:x._GetTextureWrapMode(`${t}/wrapS`,U.wrapS),wrapV:x._GetTextureWrapMode(`${t}/wrapT`,U.wrapT)}),U._data}loadImageAsync(t,U){if(!U._data){if(this.logOpen(`${t} ${U.name||""}`),U.uri)U._data=this.loadUriAsync(`${t}/uri`,U,U.uri);else{const y=k.Get(`${t}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y)}this.logClose()}return U._data}loadUriAsync(t,U,y){const I=this._extensionsLoadUriAsync(t,U,y);if(I)return I;if(!x._ValidateUri(y))throw new Error(`${t}: '${y}' is invalid`);if((0,q.l)(y)){const U=new Uint8Array((0,q.d)(y));return this.log(`${t}: Decoded ${y.substring(0,64)}... (${U.length} bytes)`),Promise.resolve(U)}return this.log(`${t}: Loading ${y}`),this._parent.preprocessUrlAsync(this._rootUrl+y).then((U=>new Promise(((I,r)=>{this._parent._loadFile(this._babylonScene,U,(U=>{this._disposed||(this.log(`${t}: Loaded ${y} (${U.byteLength} bytes)`),I(new Uint8Array(U)))}),!0,(U=>{r(new q.p(`${t}: Failed to load '${y}'${U?": "+U.status+" "+U.statusText:""}`,U))}))}))))}static AddPointerMetadata(t,U){t.metadata=t.metadata||{};const y=t._internalMetadata=t._internalMetadata||{},I=y.lX=y.lX||{};(I.pointers=I.pointers||[]).push(U)}static _GetTextureWrapMode(t,U){switch(U=void 0==U?10497:U){case 33071:return B.d.CLAMP_ADDRESSMODE;case 33648:return B.d.MIRROR_ADDRESSMODE;case 10497:return B.d.WRAP_ADDRESSMODE;default:return E.b.Warn(`${t}: Invalid value (${U})`),B.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(t,U){const y=void 0==U.magFilter?9729:U.magFilter,I=void 0==U.minFilter?9987:U.minFilter;if(9729===y)switch(I){case 9728:return B.d.LINEAR_NEAREST;case 9729:return B.d.LINEAR_LINEAR;case 9984:return B.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return B.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return B.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return B.d.LINEAR_LINEAR_MIPLINEAR;default:return E.b.Warn(`${t}/minFilter: Invalid value (${I})`),B.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==y&&E.b.Warn(`${t}/magFilter: Invalid value (${y})`),I){case 9728:return B.d.NEAREST_NEAREST;case 9729:return B.d.NEAREST_LINEAR;case 9984:return B.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return B.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return B.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return B.d.NEAREST_LINEAR_MIPLINEAR;default:return E.b.Warn(`${t}/minFilter: Invalid value (${I})`),B.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(t,U){try{return(0,O.r)(U)}catch(y){throw new Error(`${t}: ${y.message}`)}}static _GetTypedArray(t,U,y,I,r){const Y=y.buffer;I=y.byteOffset+(I||0);const mt=x._GetTypedArrayConstructor(`${t}/componentType`,U),X=p.e.GetTypeByteLength(U);return I%X!==0?(E.b.Warn(`${t}: Copying buffer as byte offset (${I}) is not a multiple of component type byte length (${X})`),new mt(Y.slice(I,I+r*X),0)):new mt(Y,I,r)}static _GetNumComponents(t,U){switch(U){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${t}: Invalid type (${U})`)}static _ValidateUri(t){return mt.Tools.IsBase64(t)||-1===t.indexOf("..")}static _GetDrawMode(t,U){switch(void 0==U&&(U=4),U){case 0:return l.e.PointListDrawMode;case 1:return l.e.LineListDrawMode;case 2:return l.e.LineLoopDrawMode;case 3:return l.e.LineStripDrawMode;case 4:return l.e.TriangleFillMode;case 5:return l.e.TriangleStripDrawMode;case 6:return l.e.TriangleFanDrawMode}throw new Error(`${t}: Invalid mesh primitive mode (${U})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const t=new Array;if(this._gltf.materials)for(const U of this._gltf.materials)if(U._data)for(const y in U._data){const I=U._data[y];for(const U of I.babylonMeshes){U.SX(!0);const y=I.babylonMaterial;t.push(y.forceCompilationAsync(U)),t.push(y.forceCompilationAsync(U,{useInstances:!0})),this._parent.useClipPlane&&(t.push(y.forceCompilationAsync(U,{clipPlane:!0})),t.push(y.forceCompilationAsync(U,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const t=new Array,U=this._babylonScene.lights;for(const y of U){const U=y.getShadowGenerator();U&&t.push(U.forceCompilationAsync())}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(t){for(const U of this._extensions)U.enabled&&t(U)}_applyExtensions(t,U,y){for(const I of this._extensions)if(I.enabled){const r=`${I.name}.${U}`,Y=t;Y._activeLoaderExtensionFunctions=Y._activeLoaderExtensionFunctions||{};const mt=Y._activeLoaderExtensionFunctions;if(!mt[r]){mt[r]=!0;try{const t=y(I);if(t)return t}finally{delete mt[r]}}}return null}_extensionsOnLoading(){this._forEachExtensions((t=>t.onLoading&&t.onLoading()))}_extensionsOnReady(){this._forEachExtensions((t=>t.onReady&&t.onReady()))}_extensionsLoadSceneAsync(t,U){return this._applyExtensions(U,"loadScene",(y=>y.loadSceneAsync&&y.loadSceneAsync(t,U)))}_extensionsLoadNodeAsync(t,U,y){return this._applyExtensions(U,"loadNode",(I=>I.loadNodeAsync&&I.loadNodeAsync(t,U,y)))}_extensionsLoadCameraAsync(t,U,y){return this._applyExtensions(U,"loadCamera",(I=>I.loadCameraAsync&&I.loadCameraAsync(t,U,y)))}_extensionsLoadVertexDataAsync(t,U,y){return this._applyExtensions(U,"loadVertexData",(I=>I._loadVertexDataAsync&&I._loadVertexDataAsync(t,U,y)))}_extensionsLoadMeshPrimitiveAsync(t,U,y,I,r,Y){return this._applyExtensions(r,"loadMeshPrimitive",(mt=>mt._loadMeshPrimitiveAsync&&mt._loadMeshPrimitiveAsync(t,U,y,I,r,Y)))}_extensionsLoadMaterialAsync(t,U,y,I,r){return this._applyExtensions(U,"loadMaterial",(Y=>Y._loadMaterialAsync&&Y._loadMaterialAsync(t,U,y,I,r)))}_extensionsCreateMaterial(t,U,y){return this._applyExtensions(U,"createMaterial",(I=>I.createMaterial&&I.createMaterial(t,U,y)))}_extensionsLoadMaterialPropertiesAsync(t,U,y){return this._applyExtensions(U,"loadMaterialProperties",(I=>I.loadMaterialPropertiesAsync&&I.loadMaterialPropertiesAsync(t,U,y)))}_extensionsLoadTextureInfoAsync(t,U,y){return this._applyExtensions(U,"loadTextureInfo",(I=>I.loadTextureInfoAsync&&I.loadTextureInfoAsync(t,U,y)))}_extensionsLoadTextureAsync(t,U,y){return this._applyExtensions(U,"loadTexture",(I=>I._loadTextureAsync&&I._loadTextureAsync(t,U,y)))}_extensionsLoadAnimationAsync(t,U){return this._applyExtensions(U,"loadAnimation",(y=>y.loadAnimationAsync&&y.loadAnimationAsync(t,U)))}_extensionsLoadAnimationChannelAsync(t,U,y,I,r){return this._applyExtensions(y,"loadAnimationChannel",(Y=>Y._loadAnimationChannelAsync&&Y._loadAnimationChannelAsync(t,U,y,I,r)))}_extensionsLoadSkinAsync(t,U,y){return this._applyExtensions(y,"loadSkin",(I=>I._loadSkinAsync&&I._loadSkinAsync(t,U,y)))}_extensionsLoadUriAsync(t,U,y){return this._applyExtensions(U,"loadUri",(I=>I._loadUriAsync&&I._loadUriAsync(t,U,y)))}_extensionsLoadBufferViewAsync(t,U){return this._applyExtensions(U,"loadBufferView",(y=>y.loadBufferViewAsync&&y.loadBufferViewAsync(t,U)))}_extensionsLoadBufferAsync(t,U,y,I){return this._applyExtensions(U,"loadBuffer",(r=>r.loadBufferAsync&&r.loadBufferAsync(t,U,y,I)))}static LoadExtensionAsync(t,U,y,I){if(!U.extensions)return null;const r=U.extensions[y];return r?I(`${t}/extensions/${y}`,r):null}static LoadExtraAsync(t,U,y,I){if(!U.extras)return null;const r=U.extras[y];return r?I(`${t}/extras/${y}`,r):null}isExtensionUsed(t){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(t)}logOpen(t){this._parent._logOpen(t)}logClose(){this._parent._logClose()}log(t){this._parent._log(t)}startPerformanceCounter(t){this._parent._startPerformanceCounter(t)}endPerformanceCounter(t){this._parent._endPerformanceCounter(t)}}x.DefaultSampler={index:-1},d.e._CreateGLTF2Loader=t=>new x(t);var Z=y(13793),W=y(12597),A=y(12426),K=y(13802),C=y(13807);class R extends C.c{constructor(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",t),this._texture=t.getEngine().createRawCubeTexture(U,y,I,r,Y,mt,X,P)}update(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,t,U,y,I,r)}updateRGBDAsync(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,K.h)(this._texture,t,U,y,I).then((()=>{}))}clone(){return A.b.Clone((()=>{const t=this.St(),U=this._texture,y=new R(t,U._bufferViewArray,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression);return 13===U.source&&y.updateRGBDAsync(U._bufferViewArrayArray,U._sphericalPolynomial,U._lodGenerationScale,U._lodGenerationOffset),y}),this)}}const u="EXT_lights_image_based";class T{constructor(t){this.name=u,this._loader=t,this.enabled=this._loader.isExtensionUsed(u)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.lX.extensions;if(t&&t[this.name]){const U=t[this.name];this._lights=U.lights}}loadSceneAsync(t,U){return x.LoadExtensionAsync(t,U,this.name,(async(y,I)=>{this._loader._allMaterialsDirtyRequired=!0;const r=new Array;r.push(this._loader.loadSceneAsync(t,U)),this._loader.logOpen(`${y}`);const Y=k.Get(`${y}/light`,this._lights,I.br);return r.push(this._loadLightAsync(`/extensions/${this.name}/lights/${I.br}`,Y).then((t=>{this._loader.babylonScene.environmentTexture=t}))),this._loader.logClose(),await Promise.all(r).then((()=>{}))}))}_loadLightAsync(t,U){if(!U._loaded){const y=new Array;this._loader.logOpen(`${t}`);const I=new Array(U.specularImages.length);for(let r=0;r<U.specularImages.length;r++){const Y=U.specularImages[r];I[r]=new Array(Y.length);for(let U=0;U<Y.length;U++){const mt=`${t}/specularImages/${r}/${U}`;this._loader.logOpen(`${mt}`);const X=Y[U],P=k.Get(mt,this._loader.lX.images,X);y.push(this._loader.loadImageAsync(`/images/${X}`,P).then((t=>{I[r][U]=t}))),this._loader.logClose()}}this._loader.logClose(),U._loaded=Promise.all(y).then((async()=>{const y=new R(this._loader.babylonScene,null,U.specularImageSize);if(y.name=U.name||"environment",U._babylonTexture=y,void 0!=U.VX&&(y.level=U.VX),U.rotation){let t=r.Quaternion.pU(U.rotation);this._loader.babylonScene.useRightHandedSystem||(t=r.Quaternion.Inverse(t)),r.Matrix.FromQuaternionToRef(t,y.getReflectionTextureMatrix())}if(!U.irradianceCoefficients)throw new Error(`${t}: Irradiance coefficients are missing`);const Y=W.b.pU(U.irradianceCoefficients);Y.scaleInPlace(U.VX),Y.convertIrradianceToLambertianRadiance();const mt=W.e.FromHarmonics(Y),X=(I.length-1)/Math.log2(U.specularImageSize);return await y.updateRGBDAsync(I,mt,X)}))}return U._loaded.then((()=>U._babylonTexture))}}n(u),V(u,!0,(t=>new T(t)));y(12995);const z="EXT_mesh_gpu_instancing";class tt{constructor(t){this.name=z,this._loader=t,this.enabled=this._loader.isExtensionUsed(z)}dispose(){this._loader=null}loadNodeAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(t,I)=>{this._loader._disableInstancedMesh++;const Y=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,y);if(this._loader._disableInstancedMesh--,!U._primitiveBabylonMeshes)return await Y;const mt=new Array;let X=0;const P=U=>{if(void 0==I.attributes[U])return void mt.push(Promise.resolve(null));const y=k.Get(`${t}/attributes/${U}`,this._loader.lX.accessors,I.attributes[U]);if(mt.push(this._loader._loadFloatAccessorAsync(`/accessors/${y.bufferView}`,y)),0===X)X=y.count;else if(X!==y.count)throw new Error(`${t}/attributes: Instance buffer accessors do not have the same count.`)};return P("TRANSLATION"),P("ROTATION"),P("SCALE"),await Y.then((async t=>{const[y,I,Y]=await Promise.all(mt),P=new Float32Array(16*X);r.TmpVectors.DU[0].aX(0,0,0),r.TmpVectors.Quaternion[0].aX(0,0,0,1),r.TmpVectors.DU[1].aX(1,1,1);for(let U=0;U<X;++U)y&&r.DU.FromArrayToRef(y,3*U,r.TmpVectors.DU[0]),I&&r.Quaternion.FromArrayToRef(I,4*U,r.TmpVectors.Quaternion[0]),Y&&r.DU.FromArrayToRef(Y,3*U,r.TmpVectors.DU[1]),r.Matrix.ComposeToRef(r.TmpVectors.DU[1],r.TmpVectors.Quaternion[0],r.TmpVectors.DU[0],r.TmpVectors.Matrix[0]),r.TmpVectors.Matrix[0].copyToArray(P,16*U);for(const r of U._primitiveBabylonMeshes)r.SL("matrix",P,16,!0);return t}))}))}}n(z),V(z,!0,(t=>new tt(t)));let Ut=0,yt=null;class It{static get Default(){return It._Default||(It._Default=new It),It._Default}constructor(){const t=It.Configuration.decoder;this._decoderModulePromise=mt.Tools.LoadBabylonScriptAsync(t.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(t,U,y,I,r){await this._decoderModulePromise,0===Ut&&(MeshoptDecoder.useWorkers(1),Ut=1);const Y=await MeshoptDecoder.decodeGltfBufferAsync(U,y,t,I,r);return null!==yt&&clearTimeout(yt),yt=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Ut=0,yt=null}),1e3),Y}}It.Configuration={decoder:{url:`${mt.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},It._Default=null;const rt="EXT_meshopt_compression";class Yt{constructor(t){this.name=rt,this.enabled=t.isExtensionUsed(rt),this._loader=t}dispose(){this._loader=null}loadBufferViewAsync(t,U){return x.LoadExtensionAsync(t,U,this.name,(async(y,I)=>{const r=U;if(r._meshOptData)return await r._meshOptData;const Y=k.Get(`${t}/buffer`,this._loader.lX.buffers,I.buffer);return r._meshOptData=this._loader.loadBufferAsync(`/buffers/${Y.index}`,Y,I.byteOffset||0,I.byteLength).then((async t=>await It.Default.decodeGltfBufferAsync(t,I.count,I.byteStride,I.mode,I.filter))),await r._meshOptData}))}}n(rt),V(rt,!0,(t=>new Yt(t)));const mU="EXT_texture_webp";class Xt{constructor(t){this.name=mU,this._loader=t,this.enabled=t.isExtensionUsed(mU)}dispose(){this._loader=null}_loadTextureAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=void 0==U.sampler?x.DefaultSampler:k.Get(`${t}/sampler`,this._loader.lX.samplers,U.sampler),mt=k.Get(`${I}/source`,this._loader.lX.images,r.source);return await this._loader._createTextureAsync(t,Y,mt,(t=>{y(t)}),void 0,!U._textureInfo.nonColorData)}))}}n(mU),V(mU,!0,(t=>new Xt(t)));const Pt="EXT_texture_avif";class Gt{constructor(t){this.name=Pt,this._loader=t,this.enabled=t.isExtensionUsed(Pt)}dispose(){this._loader=null}_loadTextureAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=void 0==U.sampler?x.DefaultSampler:k.Get(`${t}/sampler`,this._loader.lX.samplers,U.sampler),mt=k.Get(`${I}/source`,this._loader.lX.images,r.source);return await this._loader._createTextureAsync(t,Y,mt,(t=>{y(t)}),void 0,!U._textureInfo.nonColorData)}))}}n(Pt),V(Pt,!0,(t=>new Gt(t)));var Mt=y(13791),Lt=y(12978);const ht="EXT_lights_ies";class Qt{constructor(t){this.name=ht,this._loader=t,this.enabled=this._loader.isExtensionUsed(ht)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.lX.extensions;if(t&&t[this.name]){const U=t[this.name];this._lights=U.lights,k.Assign(this._lights)}}loadNodeAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,mt)=>{let X,P;this._loader._allMaterialsDirtyRequired=!0;const G=await this._loader.loadNodeAsync(t,U,(t=>{P=k.Get(I,this._lights,mt.br);const U=P.name||t.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X=new Mt.c(U,r.DU.Zero(),r.DU.Backward(),0,1,this._loader.babylonScene),X.angle=Math.PI/2,X.innerAngle=0,X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,P._babylonLight=X,X.falloffType=Lt.c.FALLOFF_GLTF,X.nX=mt.color?Y.bU.pU(mt.color):Y.bU.White(),X.VX=mt.multiplier||1,X.range=Number.MAX_VALUE,X.parent=t,this._loader._babylonLights.push(X),x.AddPointerMetadata(X,I),y(t)}));let M;if(P.uri)M=await this._loader.loadUriAsync(t,P,P.uri);else{const U=k.Get(`${t}/bufferView`,this._loader.lX.bufferViews,P.bufferView);M=await this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return X.iesProfileTexture=new B.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,M,!0,void 0,void 0,void 0,void 0,".ies"),G}))}}n(ht),V(ht,!0,(t=>new Qt(t)));var Ft=y(13821);const Et="KHR_draco_mesh_compression";class wt{constructor(t){this.name=Et,this.useNormalizedFlagFromAccessor=!0,this._loader=t,this.enabled=Ft.b.DefaultAvailable&&this._loader.isExtensionUsed(Et)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{if(void 0!=U.mode&&4!==U.mode&&5!==U.mode)throw new Error(`${t}: Unsupported mode ${U.mode}`);const Y={},mt={},X=(t,I)=>{const X=r.attributes[t];if(void 0!=X&&(y._delayInfo=y._delayInfo||[],-1===y._delayInfo.indexOf(I)&&y._delayInfo.push(I),Y[I]=X,this.useNormalizedFlagFromAccessor)){const y=k.TryGet(this._loader.lX.accessors,U.attributes[t]);y&&(mt[I]=y.normalized||!1)}};X("POSITION",p.e.PositionKind),X("NORMAL",p.e.NormalKind),X("TANGENT",p.e.TangentKind),X("TEXCOORD_0",p.e.UVKind),X("TEXCOORD_1",p.e.UV2Kind),X("TEXCOORD_2",p.e.UV3Kind),X("TEXCOORD_3",p.e.UV4Kind),X("TEXCOORD_4",p.e.UV5Kind),X("TEXCOORD_5",p.e.UV6Kind),X("JOINTS_0",p.e.MatricesIndicesKind),X("WEIGHTS_0",p.e.MatricesWeightsKind),X("COLOR_0",p.e.ColorKind);const P=k.Get(I,this._loader.lX.bufferViews,r.bufferView);return P._dracoBabylonGeometry||(P._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((async I=>{const r=this.dracoDecoder||Ft.b.Default,X=k.TryGet(this._loader.lX.accessors,U.attributes.POSITION),P=this._loader.parent.alwaysComputeBoundingBox||y.skeleton||!X?null:s(X);return await r._decodeMeshToGeometryForGltfAsync(y.name,this._loader.babylonScene,I,Y,mt,P).catch((U=>{throw new Error(`${t}: ${U.message}`)}))}))),await P._dracoBabylonGeometry}))}}n(Et),V(Et,!0,(t=>new wt(t)));var Dt=y(13828),lt=y(12366),gt=y(12375),Bt=y(12835),bt=y(13026),pt=y(12338);Bt.c.AddNodeConstructor("Light_Type_0",((t,U)=>()=>new ct(t,r.DU.Zero(),U)));class ct extends bt.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(t){this._shadowAngle=t,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(t){const U=this.needCube();if(this._direction=t,this.needCube()!==U&&this._shadowGenerators){const t=this._shadowGenerators.values();for(let U=t.next();!0!==U.done;U=t.next()){U.value.recreateShadowMap()}}}constructor(t,U,y){super(t,y),this._shadowAngle=Math.PI/2,this.position=U}getClassName(){return"PointLight"}getTypeID(){return Lt.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(t){if(this.direction)return super.getShadowDirection(t);switch(t){case 0:return new r.DU(1,0,0);case 1:return new r.DU(-1,0,0);case 2:return new r.DU(0,-1,0);case 3:return new r.DU(0,1,0);case 4:return new r.DU(0,0,1);case 5:return new r.DU(0,0,-1)}return r.DU.Zero()}_setDefaultShadowProjectionMatrix(t,U,y){const I=this.St().activeCamera;if(!I)return;const Y=void 0!==this.shadowMinZ?this.shadowMinZ:I.cX,mt=void 0!==this.shadowMaxZ?this.shadowMaxZ:I.maxZ,X=this.St().getEngine().LX;r.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,X?mt:Y,X?Y:mt,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,U){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,U):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,U),this}transferToNodeMaterialEffect(t,U){return this.computeTransformedInformation()?t.setFloat3(U,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):t.setFloat3(U,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(t,U){t["POINTLIGHT"+U]=!0}}(0,lt.b)([(0,gt.I)()],ct.prototype,"shadowAngle",null),(0,pt.f)("BABYLON.PointLight",ct);const ft="KHR_lights_punctual";class St{constructor(t){this.name=ft,this._loader=t,this.enabled=this._loader.isExtensionUsed(ft)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.lX.extensions;if(t&&t[this.name]){const U=t[this.name];this._lights=U.lights,k.Assign(this._lights)}}loadNodeAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,mt)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(t,U,(t=>{let U;const X=k.Get(I,this._lights,mt.br),P=X.name||t.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const t=new Dt.d(P,r.DU.Backward(),this._loader.babylonScene);t.position.qX(0),U=t;break}case"point":U=new ct(P,r.DU.Zero(),this._loader.babylonScene);break;case"spot":{const t=new Mt.c(P,r.DU.Zero(),r.DU.Backward(),0,1,this._loader.babylonScene);t.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),t.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),U=t;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${I}: Invalid light type (${X.type})`)}U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=U,U.falloffType=Lt.c.FALLOFF_GLTF,U.nX=X.color?Y.bU.pU(X.color):Y.bU.White(),U.VX=void 0==X.VX?1:X.VX,U.range=void 0==X.range?Number.MAX_VALUE:X.range,U.parent=t,this._loader._babylonLights.push(U),x.AddPointerMetadata(U,I),y(t)})))))}}n(ft),V(ft,!0,(t=>new St(t)));const Nt="KHR_materials_pbrSpecularGlossiness";class jt{constructor(t){this.name=Nt,this.order=200,this._loader=t,this.enabled=this._loader.isExtensionUsed(Nt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialBasePropertiesAsync(t,U,y)),Y.push(this._loadSpecularGlossinessPropertiesAsync(I,r,y)),this._loader.loadMaterialAlphaProperties(t,U,y),await Promise.all(Y).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return y.metallic=null,y.roughness=null,U.diffuseFactor?(y.albedoColor=Y.bU.pU(U.diffuseFactor),y.alpha=U.diffuseFactor[3]):y.albedoColor=Y.bU.White(),y.reflectivityColor=U.specularFactor?Y.bU.pU(U.specularFactor):Y.bU.White(),y.microSurface=void 0==U.glossinessFactor?1:U.glossinessFactor,U.diffuseTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTexture`,U.diffuseTexture,(t=>{t.name=`${y.name} (Diffuse)`,y.albedoTexture=t}))),U.specularGlossinessTexture&&(I.push(this._loader.loadTextureInfoAsync(`${t}/specularGlossinessTexture`,U.specularGlossinessTexture,(t=>{t.name=`${y.name} (Specular Glossiness)`,y.reflectivityTexture=t,y.reflectivityTexture.pX=!0}))),y.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(I).then((()=>{}))}}n(Nt),V(Nt,!0,(t=>new jt(t)));const Jt="KHR_materials_unlit";class at{constructor(t){this.name=Jt,this.order=210,this._loader=t,this.enabled=this._loader.isExtensionUsed(Jt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async()=>await this._loadUnlitPropertiesAsync(t,U,y)))}_loadUnlitPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;y.unlit=!0;const r=U.pbrMetallicRoughness;return r&&(r.baseColorFactor?(y.albedoColor=Y.bU.pU(r.baseColorFactor),y.alpha=r.baseColorFactor[3]):y.albedoColor=Y.bU.White(),r.baseColorTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/baseColorTexture`,r.baseColorTexture,(t=>{t.name=`${y.name} (Base Color)`,y.albedoTexture=t})))),U.doubleSided&&(y.JX=!1,y.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(t,U,y),Promise.all(I).then((()=>{}))}}n(Jt),V(Jt,!0,(t=>new at(t)));const dt="KHR_materials_clearcoat";class qt{constructor(t){this.name=dt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(dt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadClearCoatPropertiesAsync(I,r,y)),await Promise.all(Y)}))}_loadClearCoatPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return y.clearCoat.isEnabled=!0,y.clearCoat.useRoughnessFromMainTexture=!1,y.clearCoat.remapF0OnInterfaceChange=!1,void 0!=U.clearcoatFactor?y.clearCoat.VX=U.clearcoatFactor:y.clearCoat.VX=0,U.clearcoatTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatTexture`,U.clearcoatTexture,(t=>{t.name=`${y.name} (ClearCoat)`,y.clearCoat.texture=t}))),void 0!=U.clearcoatRoughnessFactor?y.clearCoat.roughness=U.clearcoatRoughnessFactor:y.clearCoat.roughness=0,U.clearcoatRoughnessTexture&&(U.clearcoatRoughnessTexture.nonColorData=!0,I.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatRoughnessTexture`,U.clearcoatRoughnessTexture,(t=>{t.name=`${y.name} (ClearCoat Roughness)`,y.clearCoat.textureRoughness=t})))),U.clearcoatNormalTexture&&(U.clearcoatNormalTexture.nonColorData=!0,I.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatNormalTexture`,U.clearcoatNormalTexture,(t=>{t.name=`${y.name} (ClearCoat Normal)`,y.clearCoat.bumpTexture=t}))),y.invertNormalMapX=!y.St().useRightHandedSystem,y.invertNormalMapY=y.St().useRightHandedSystem,void 0!=U.clearcoatNormalTexture.scale&&(y.clearCoat.bumpTexture.level=U.clearcoatNormalTexture.scale)),Promise.all(I).then((()=>{}))}}n(dt),V(dt,!0,(t=>new qt(t)));const Ht="KHR_materials_iridescence";class et{constructor(t){this.name=Ht,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ht)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadIridescencePropertiesAsync(I,r,y)),await Promise.all(Y).then((()=>{}))}))}_loadIridescencePropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return y.iridescence.isEnabled=!0,y.iridescence.VX=U.iridescenceFactor??0,y.iridescence.indexOfRefraction=U.iridescenceIor??U.iridescenceIOR??1.3,y.iridescence.minimumThickness=U.iridescenceThicknessMinimum??100,y.iridescence.maximumThickness=U.iridescenceThicknessMaximum??400,U.iridescenceTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceTexture`,U.iridescenceTexture,(t=>{t.name=`${y.name} (Iridescence)`,y.iridescence.texture=t}))),U.iridescenceThicknessTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceThicknessTexture`,U.iridescenceThicknessTexture,(t=>{t.name=`${y.name} (Iridescence Thickness)`,y.iridescence.thicknessTexture=t}))),Promise.all(I).then((()=>{}))}}n(Ht),V(Ht,!0,(t=>new et(t)));const ot="KHR_materials_anisotropy";class Vt{constructor(t){this.name=ot,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(ot)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadIridescencePropertiesAsync(I,r,y)),await Promise.all(Y)}))}async _loadIridescencePropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;y.anisotropy.isEnabled=!0,y.anisotropy.VX=U.anisotropyStrength??0,y.anisotropy.angle=U.anisotropyRotation??0,U.anisotropyTexture&&(U.anisotropyTexture.nonColorData=!0,I.push(this._loader.loadTextureInfoAsync(`${t}/anisotropyTexture`,U.anisotropyTexture,(t=>{t.name=`${y.name} (Anisotropy Intensity)`,y.anisotropy.texture=t})))),await Promise.all(I)}}n(ot),V(ot,!0,(t=>new Vt(t)));const nt="KHR_materials_emissive_strength";class it{constructor(t){this.name=nt,this.order=170,this._loader=t,this.enabled=this._loader.isExtensionUsed(nt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>await this._loader.loadMaterialPropertiesAsync(t,U,y).then((()=>{this._loadEmissiveProperties(I,r,y)}))))}_loadEmissiveProperties(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);void 0!==U.emissiveStrength&&(y.emissiveIntensity=U.emissiveStrength)}}n(nt),V(nt,!0,(t=>new it(t)));const vt="KHR_materials_sheen";class Ot{constructor(t){this.name=vt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(vt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadSheenPropertiesAsync(I,r,y)),await Promise.all(Y).then((()=>{}))}))}_loadSheenPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return y.sheen.isEnabled=!0,y.sheen.VX=1,void 0!=U.sheenColorFactor?y.sheen.color=Y.bU.pU(U.sheenColorFactor):y.sheen.color=Y.bU.Black(),U.sheenColorTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/sheenColorTexture`,U.sheenColorTexture,(t=>{t.name=`${y.name} (Sheen Color)`,y.sheen.texture=t}))),void 0!==U.sheenRoughnessFactor?y.sheen.roughness=U.sheenRoughnessFactor:y.sheen.roughness=0,U.sheenRoughnessTexture&&(U.sheenRoughnessTexture.nonColorData=!0,I.push(this._loader.loadTextureInfoAsync(`${t}/sheenRoughnessTexture`,U.sheenRoughnessTexture,(t=>{t.name=`${y.name} (Sheen Roughness)`,y.sheen.textureRoughness=t})))),y.sheen.albedoScaling=!0,y.sheen.useRoughnessFromMainTexture=!1,Promise.all(I).then((()=>{}))}}n(vt),V(vt,!0,(t=>new Ot(t)));var kt=y(12906);const st="KHR_materials_specular";class xt{constructor(t){this.name=st,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(st)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;if(Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadSpecularPropertiesAsync(I,r,y)),r.extensions&&r.extensions.EXT_materials_specular_edge_color&&y instanceof g.d){r.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(y.brdf.dielectricSpecularModel=kt.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,y.brdf.conductorSpecularModel=kt.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Y).then((()=>{}))}))}_loadSpecularPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return void 0!==U.specularFactor&&(y.metallicF0Factor=U.specularFactor),void 0!==U.specularColorFactor&&(y.metallicReflectanceColor=Y.bU.pU(U.specularColorFactor)),U.specularTexture&&(U.specularTexture.nonColorData=!0,I.push(this._loader.loadTextureInfoAsync(`${t}/specularTexture`,U.specularTexture,(t=>{t.name=`${y.name} (Specular)`,y.metallicReflectanceTexture=t,y.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),U.specularColorTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/specularColorTexture`,U.specularColorTexture,(t=>{t.name=`${y.name} (Specular Color)`,y.reflectanceTexture=t}))),Promise.all(I).then((()=>{}))}}n(st),V(st,!0,(t=>new xt(t)));const Zt="KHR_materials_ior";class Wt{constructor(t){this.name=Zt,this.order=180,this._loader=t,this.enabled=this._loader.isExtensionUsed(Zt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadIorPropertiesAsync(I,r,y)),await Promise.all(Y).then((()=>{}))}))}_loadIorPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);return void 0!==U.ior?y.indexOfRefraction=U.ior:y.indexOfRefraction=Wt._DEFAULT_IOR,Promise.resolve()}}Wt._DEFAULT_IOR=1.5,n(Zt),V(Zt,!0,(t=>new Wt(t)));const At="KHR_materials_variants";class Kt{constructor(t){this.name=At,this._loader=t,this.enabled=this._loader.isExtensionUsed(At)}dispose(){this._loader=null}static GetAvailableVariants(t){const U=this._GetExtensionMetadata(t);return U?Object.keys(U.variants):[]}getAvailableVariants(t){return Kt.GetAvailableVariants(t)}static SelectVariant(t,U){const y=this._GetExtensionMetadata(t);if(!y)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${At} extension`);const I=t=>{const U=y.variants[t];if(U)for(const y of U)y.mesh.material=y.material};if(U instanceof Array)for(const r of U)I(r);else I(U);y.lastSelected=U}selectVariant(t,U){Kt.SelectVariant(t,U)}static Reset(t){const U=this._GetExtensionMetadata(t);if(!U)throw new Error(`Cannot reset on a glTF mesh that does not have the ${At} extension`);for(const y of U.original)y.mesh.material=y.material;U.lastSelected=null}reset(t){Kt.Reset(t)}static GetLastSelectedVariant(t){const U=this._GetExtensionMetadata(t);if(!U)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${At} extension`);return U.lastSelected}getLastSelectedVariant(t){return Kt.GetLastSelectedVariant(t)}static _GetExtensionMetadata(t){var U,y;return(null===t||void 0===t||null===(U=t._internalMetadata)||void 0===U||null===(y=U.lX)||void 0===y?void 0:y[At])||null}onLoading(){const t=this._loader.lX.extensions;if(t&&t[this.name]){const U=t[this.name];this._variants=U.variants}}onReady(){const t=this._loader.rootBabylonMesh;if(t){var U;const y=this._loader.parent.extensionOptions[At];null!==y&&void 0!==y&&y.defaultVariant&&Kt.SelectVariant(t,y.defaultVariant),null===y||void 0===y||null===(U=y.onLoaded)||void 0===U||U.call(y,{get variants(){return Kt.GetAvailableVariants(t)},get selectedVariant(){const U=Kt.GetLastSelectedVariant(t);return U?Array.isArray(U)?U[0]:U:Kt.GetAvailableVariants(t)[0]},set selectedVariant(U){Kt.SelectVariant(t,U)}})}}_loadMeshPrimitiveAsync(t,U,y,I,r,Y){return x.LoadExtensionAsync(t,r,this.name,(async(mt,X)=>{const P=new Array;return P.push(this._loader._loadMeshPrimitiveAsync(t,U,y,I,r,(U=>{if(Y(U),U instanceof S.c){const y=x._GetDrawMode(t,r.mode),I=this._loader.rootBabylonMesh,Y=I?I._internalMetadata=I._internalMetadata||{}:{},G=Y.lX=Y.lX||{},M=G[At]=G[At]||{lastSelected:null,original:[],variants:{}};M.original.push({mesh:U,material:U.material});for(let t=0;t<X.mappings.length;++t){const r=X.mappings[t],Y=k.Get(`${mt}/mappings/${t}/material`,this._loader.lX.materials,r.material);P.push(this._loader._loadMaterialAsync(`#/materials/${r.material}`,Y,U,y,(t=>{for(let y=0;y<r.variants.length;++y){const Y=r.variants[y],mt=k.Get(`/extensions/${At}/variants/${Y}`,this._variants,Y);M.variants[mt.name]=M.variants[mt.name]||[],M.variants[mt.name].push({mesh:U,material:t}),U.onClonedObservable.add((t=>{const y=t;let r=null,Y=y;do{if(Y=Y.parent,!Y)return;r=Kt._GetExtensionMetadata(Y)}while(null===r);if(I&&r===Kt._GetExtensionMetadata(I)){Y._internalMetadata={};for(const t in I._internalMetadata)Y._internalMetadata[t]=I._internalMetadata[t];Y._internalMetadata.lX=[];for(const t in I._internalMetadata.lX)Y._internalMetadata.lX[t]=I._internalMetadata.lX[t];Y._internalMetadata.lX[At]={lastSelected:null,original:[],variants:{}};for(const t of r.original)Y._internalMetadata.lX[At].original.push({mesh:t.mesh,material:t.material});for(const t in r.variants)if(Object.prototype.hasOwnProperty.call(r.variants,t)){Y._internalMetadata.lX[At].variants[t]=[];for(const U of r.variants[t])Y._internalMetadata.lX[At].variants[t].push({mesh:U.mesh,material:U.material})}r=Y._internalMetadata.lX[At]}for(const I of r.original)I.mesh===U&&(I.mesh=y);for(const I of r.variants[mt.name])I.mesh===U&&(I.mesh=y)}))}})))}}}))),await Promise.all(P).then((t=>{let[U]=t;return U}))}))}}n(At),V(At,!0,(t=>new Kt(t)));var Ct=y(12469);class Rt{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:kt.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(t,U){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Rt._GetDefaultOptions(),...t},this._scene=U,this._scene._transmissionHelper=this,this.onErrorObservable=new M.b,this._scene.FX.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(t){if(!Object.keys(t).filter((U=>this._options[U]!==t[U])).length)return;const U={...this._options,...t},y=this._options;this._options=U,U.renderSize===y.renderSize&&U.renderTargetTextureType===y.renderTargetTextureType&&U.generateMipmaps===y.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=U.samples,this._opaqueRenderTarget.lodGenerationScale=U.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=U.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(t){return!!t&&!!(t instanceof g.d&&t.subSurface.isRefractionEnabled)}_addMesh(t){this._materialObservers[t.uniqueId]=t.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),mt.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(t.material)?(t.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(t)&&this._transparentMeshesCache.push(t)):-1===this._opaqueMeshesCache.indexOf(t)&&this._opaqueMeshesCache.push(t)}))}_removeMesh(t){t.onMaterialChangedObservable.remove(this._materialObservers[t.uniqueId]),delete this._materialObservers[t.uniqueId];let U=this._transparentMeshesCache.indexOf(t);-1!==U&&this._transparentMeshesCache.splice(U,1),U=this._opaqueMeshesCache.indexOf(t),-1!==U&&this._opaqueMeshesCache.splice(U,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(t){const U=this._transparentMeshesCache.indexOf(t),y=this._opaqueMeshesCache.indexOf(t);this._shouldRenderAsTransmission(t.material)?(t.material instanceof g.d&&(t.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==y?(this._opaqueMeshesCache.splice(y,1),this._transparentMeshesCache.push(t)):-1===U&&this._transparentMeshesCache.push(t)):-1!==U?(this._transparentMeshesCache.splice(U,1),this._opaqueMeshesCache.push(t)):-1===y&&this._opaqueMeshesCache.push(t)}_isRenderTargetValid(){var t;return null!==(null===(t=this._opaqueRenderTarget)||void 0===t?void 0:t.getInternalTexture())}_setupRenderTargets(){var t;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ct.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(t=this._options.clearColor)||void 0===t?void 0:t.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((t=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?t.clearColor.Y(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const y of this._transparentMeshesCache)this._shouldRenderAsTransmission(y.material)&&(y.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ut="KHR_materials_transmission";class Tt{constructor(t){this.name=ut,this.order=175,this._loader=t,this.enabled=this._loader.isExtensionUsed(ut),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadTransparentPropertiesAsync(I,U,y,r)),await Promise.all(Y).then((()=>{}))}))}_loadTransparentPropertiesAsync(t,U,y,I){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const r=y;if(r.subSurface.isRefractionEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.useAlbedoToTintRefraction=!0,void 0===I.transmissionFactor)return r.subSurface.refractionIntensity=0,r.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Y;r.subSurface.refractionIntensity=I.transmissionFactor;const t=r.St();if(r.subSurface.refractionIntensity&&!t._transmissionHelper)new Rt({},r.St());else if(r.subSurface.refractionIntensity&&(null===(Y=t._transmissionHelper)||void 0===Y||!Y._isRenderTargetValid())){var mt;null===(mt=t._transmissionHelper)||void 0===mt||mt._setupRenderTargets()}}return r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,I.transmissionTexture?(I.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/transmissionTexture`,I.transmissionTexture,void 0).then((t=>{t.name=`${y.name} (Transmission)`,r.subSurface.refractionIntensityTexture=t,r.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}n(ut),V(ut,!0,(t=>new Tt(t)));const zt="KHR_materials_diffuse_transmission";class tU{constructor(t){this.name=zt,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(zt),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadTranslucentPropertiesAsync(I,U,y,r)),await Promise.all(Y).then((()=>{}))}))}_loadTranslucentPropertiesAsync(t,U,y,I){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const r=y;if(r.subSurface.isTranslucencyEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,r.subSurface.useAlbedoToTintTranslucency=!1,void 0===I.diffuseTransmissionFactor)return r.subSurface.translucencyIntensity=0,r.subSurface.isTranslucencyEnabled=!1,Promise.resolve();r.subSurface.translucencyIntensity=I.diffuseTransmissionFactor;const mt=new Array;return r.subSurface.useGltfStyleTextures=!0,I.diffuseTransmissionTexture&&(I.diffuseTransmissionTexture.nonColorData=!0,mt.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionTexture`,I.diffuseTransmissionTexture).then((t=>{t.name=`${y.name} (Diffuse Transmission)`,r.subSurface.translucencyIntensityTexture=t})))),void 0!==I.diffuseTransmissionColorFactor?r.subSurface.translucencyColor=Y.bU.pU(I.diffuseTransmissionColorFactor):r.subSurface.translucencyColor=Y.bU.White(),I.diffuseTransmissionColorTexture&&mt.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionColorTexture`,I.diffuseTransmissionColorTexture).then((t=>{t.name=`${y.name} (Diffuse Transmission Color)`,r.subSurface.translucencyColorTexture=t}))),Promise.all(mt).then((()=>{}))}}n(zt),V(zt,!0,(t=>new tU(t)));const UU="KHR_materials_volume";class yU{constructor(t){this.name=UU,this.order=173,this._loader=t,this.enabled=this._loader.isExtensionUsed(UU),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadVolumePropertiesAsync(I,U,y,r)),await Promise.all(Y).then((()=>{}))}))}_loadVolumePropertiesAsync(t,U,y,I){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);if(!y.subSurface.isRefractionEnabled&&!y.subSurface.isTranslucencyEnabled||!I.thicknessFactor)return Promise.resolve();y.subSurface.volumeIndexOfRefraction=y.indexOfRefraction;const r=void 0!==I.attenuationDistance?I.attenuationDistance:Number.MAX_VALUE;return y.subSurface.tintColorAtDistance=r,void 0!==I.attenuationColor&&3==I.attenuationColor.length&&y.subSurface.tintColor.aX(I.attenuationColor[0],I.attenuationColor[1],I.attenuationColor[2]),y.subSurface.minimumThickness=0,y.subSurface.maximumThickness=I.thicknessFactor,y.subSurface.useThicknessAsDepth=!0,I.thicknessTexture?(I.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/thicknessTexture`,I.thicknessTexture).then((t=>{t.name=`${y.name} (Thickness)`,y.subSurface.thicknessTexture=t,y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}n(UU),V(UU,!0,(t=>new yU(t)));const IU="KHR_materials_dispersion";class rU{constructor(t){this.name=IU,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(IU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadDispersionPropertiesAsync(I,U,y,r)),await Promise.all(Y).then((()=>{}))}))}_loadDispersionPropertiesAsync(t,U,y,I){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);return y.subSurface.isRefractionEnabled&&I.dispersion?(y.subSurface.isDispersionEnabled=!0,y.subSurface.dispersion=I.dispersion,Promise.resolve()):Promise.resolve()}}n(IU),V(IU,!0,(t=>new rU(t)));const YU="EXT_materials_diffuse_roughness";class my{constructor(t){this.name=YU,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(YU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=new Array;return Y.push(this._loader.loadMaterialPropertiesAsync(t,U,y)),Y.push(this._loadDiffuseRoughnessPropertiesAsync(I,r,y)),await Promise.all(Y).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(t,U,y){if(!(y instanceof g.d))throw new Error(`${t}: Material type not supported`);const I=new Array;return y.brdf.baseDiffuseModel=kt.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=U.diffuseRoughnessFactor?y.baseDiffuseRoughness=U.diffuseRoughnessFactor:y.baseDiffuseRoughness=0,U.diffuseRoughnessTexture&&I.push(this._loader.loadTextureInfoAsync(`${t}/diffuseRoughnessTexture`,U.diffuseRoughnessTexture,(t=>{t.name=`${y.name} (Diffuse Roughness)`,y.baseDiffuseRoughnessTexture=t}))),Promise.all(I).then((()=>{}))}}n(YU),V(YU,!0,(t=>new my(t)));const XU="KHR_mesh_quantization";class PU{constructor(t){this.name=XU,this.enabled=t.isExtensionUsed(XU)}dispose(){}}n(XU),V(XU,!0,(t=>new PU(t)));const GU="KHR_texture_basisu";class MU{constructor(t){this.name=GU,this._loader=t,this.enabled=t.isExtensionUsed(GU)}dispose(){this._loader=null}_loadTextureAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>{const Y=void 0==U.sampler?x.DefaultSampler:k.Get(`${t}/sampler`,this._loader.lX.samplers,U.sampler),mt=k.Get(`${I}/source`,this._loader.lX.images,r.source);return await this._loader._createTextureAsync(t,Y,mt,(t=>{y(t)}),U._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!U._textureInfo.nonColorData)}))}}n(GU),V(GU,!0,(t=>new MU(t)));const LU="KHR_texture_transform";class hU{constructor(t){this.name=LU,this._loader=t,this.enabled=this._loader.isExtensionUsed(LU)}dispose(){this._loader=null}loadTextureInfoAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(I,r)=>await this._loader.loadTextureInfoAsync(t,U,(t=>{if(!(t instanceof B.d))throw new Error(`${I}: Texture type not supported`);r.offset&&(t.uOffset=r.offset[0],t.vOffset=r.offset[1]),t.uRotationCenter=0,t.vRotationCenter=0,r.rotation&&(t.wAng=-r.rotation),r.scale&&(t.uScale=r.scale[0],t.vScale=r.scale[1]),void 0!=r.texCoord&&(t.coordinatesIndex=r.texCoord),y(t)}))))}}n(LU),V(LU,!0,(t=>new hU(t)));const QU="KHR_xmp_json_ld";class FU{constructor(t){this.name=QU,this.order=100,this._loader=t,this.enabled=this._loader.isExtensionUsed(QU)}dispose(){this._loader=null}onLoading(){var t,U,y;if(null===this._loader.rootBabylonMesh)return;const I=null===(t=this._loader.lX.extensions)||void 0===t?void 0:t.KHR_xmp_json_ld,r=null===(U=this._loader.lX.asset)||void 0===U||null===(y=U.extensions)||void 0===y?void 0:y.KHR_xmp_json_ld;if(I&&r){const t=+r.packet;I.packets&&t<I.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=I.packets[t])}}}function EU(t,U,y,I){return Y.bU.pU(U,y).scale(I)}function wU(t,U,y,I){return U[y]*I}function DU(t,U,y,I){return-U[y]*I}function lU(t,U,y,I){return U[y+1]*I}function gU(t,U,y,I){return U[y]*I*2}function BU(t){return{scale:[new pU(h.e.ANIMATIONTYPE_FLOAT,`${t}.uScale`,wU,(()=>2)),new pU(h.e.ANIMATIONTYPE_FLOAT,`${t}.vScale`,lU,(()=>2))],offset:[new pU(h.e.ANIMATIONTYPE_FLOAT,`${t}.uOffset`,wU,(()=>2)),new pU(h.e.ANIMATIONTYPE_FLOAT,`${t}.vOffset`,lU,(()=>2))],rotation:[new pU(h.e.ANIMATIONTYPE_FLOAT,`${t}.wAng`,DU,(()=>1))]}}n(QU),V(QU,!0,(t=>new FU(t)));class bU extends Z.AnimationPropertyInfo{buildAnimations(t,U,y,I){return[{babylonAnimatable:t._babylonCamera,babylonAnimation:this._buildAnimation(U,y,I)}]}}class pU extends Z.AnimationPropertyInfo{buildAnimations(t,U,y,I){const r=[];for(const Y in t._data)r.push({babylonAnimatable:t._data[Y].babylonMaterial,babylonAnimation:this._buildAnimation(U,y,I)});return r}}class cU extends Z.AnimationPropertyInfo{buildAnimations(t,U,y,I){return[{babylonAnimatable:t._babylonLight,babylonAnimation:this._buildAnimation(U,y,I)}]}}(0,i.k)("/cameras/{}/orthographic/xmag",[new bU(h.e.ANIMATIONTYPE_FLOAT,"orthoLeft",DU,(()=>1)),new bU(h.e.ANIMATIONTYPE_FLOAT,"orthoRight",lU,(()=>1))]),(0,i.k)("/cameras/{}/orthographic/ymag",[new bU(h.e.ANIMATIONTYPE_FLOAT,"orthoBottom",DU,(()=>1)),new bU(h.e.ANIMATIONTYPE_FLOAT,"orthoTop",lU,(()=>1))]),(0,i.k)("/cameras/{}/orthographic/zfar",[new bU(h.e.ANIMATIONTYPE_FLOAT,"maxZ",wU,(()=>1))]),(0,i.k)("/cameras/{}/orthographic/znear",[new bU(h.e.ANIMATIONTYPE_FLOAT,"cX",wU,(()=>1))]),(0,i.k)("/cameras/{}/perspective/yfov",[new bU(h.e.ANIMATIONTYPE_FLOAT,"fov",wU,(()=>1))]),(0,i.k)("/cameras/{}/perspective/zfar",[new bU(h.e.ANIMATIONTYPE_FLOAT,"maxZ",wU,(()=>1))]),(0,i.k)("/cameras/{}/perspective/znear",[new bU(h.e.ANIMATIONTYPE_FLOAT,"cX",wU,(()=>1))]),(0,i.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new pU(h.e.ANIMATIONTYPE_COLOR3,"albedoColor",EU,(()=>4)),new pU(h.e.ANIMATIONTYPE_FLOAT,"alpha",(function(t,U,y,I){return U[y+3]*I}),(()=>4))]),(0,i.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"metallic",wU,(()=>1))]),(0,i.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"roughness",wU,(()=>1))]);const fU=BU("albedoTexture");(0,i.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",fU.scale),(0,i.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",fU.offset),(0,i.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",fU.rotation);const SU=BU("metallicTexture");(0,i.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",SU.scale),(0,i.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",SU.offset),(0,i.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",SU.rotation),(0,i.k)("/materials/{}/emissiveFactor",[new pU(h.e.ANIMATIONTYPE_COLOR3,"emissiveColor",EU,(()=>3))]);const NU=BU("bumpTexture");(0,i.k)("/materials/{}/normalTexture/scale",[new pU(h.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",wU,(()=>1))]),(0,i.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",NU.scale),(0,i.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",NU.offset),(0,i.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",NU.rotation),(0,i.k)("/materials/{}/occlusionTexture/strength",[new pU(h.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",wU,(()=>1))]);const jU=BU("ambientTexture");(0,i.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",jU.scale),(0,i.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",jU.offset),(0,i.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",jU.rotation);const JU=BU("emissiveTexture");(0,i.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",JU.scale),(0,i.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",JU.offset),(0,i.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",JU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new pU(h.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new pU(h.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",wU,(()=>1))]);const aU=BU("anisotropy.texture");(0,i.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",aU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",aU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",aU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",wU,(()=>1))]);const dU=BU("clearCoat.texture");(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",dU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",dU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",dU.rotation);const qU=BU("clearCoat.bumpTexture");(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new pU(h.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",qU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",qU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",qU.rotation);const HU=BU("clearCoat.textureRoughness");(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",HU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",HU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",HU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new pU(h.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new pU(h.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new pU(h.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new pU(h.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",wU,(()=>1))]);const eU=BU("iridescence.texture");(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",eU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",eU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",eU.rotation);const oU=BU("iridescence.thicknessTexture");(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",oU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",oU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",oU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new pU(h.e.ANIMATIONTYPE_COLOR3,"sheen.color",EU,(()=>3))]),(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",wU,(()=>1))]);const VU=BU("sheen.texture");(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",VU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",VU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",VU.rotation);const nU=BU("sheen.textureRoughness");(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",nU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",nU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",nU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new pU(h.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",EU,(()=>3))]);const iU=BU("metallicReflectanceTexture");(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",iU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",iU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",iU.rotation);const vU=BU("reflectanceTexture");(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",vU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",vU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",vU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",wU,(()=>1))]);const OU=BU("subSurface.refractionIntensityTexture");(0,i.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",OU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",OU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",OU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new pU(h.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",EU,(()=>3))]),(0,i.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new pU(h.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",wU,(()=>1))]),(0,i.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",wU,(()=>1))]);const kU=BU("subSurface.thicknessTexture");(0,i.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",kU.scale),(0,i.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",kU.offset),(0,i.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",kU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new pU(h.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",wU,(()=>1))]);const sU=BU("subSurface.translucencyIntensityTexture");(0,i.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",sU.scale),(0,i.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",sU.offset),(0,i.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",sU.rotation),(0,i.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new pU(h.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",EU,(()=>3))]);const xU=BU("subSurface.translucencyColorTexture");(0,i.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",xU.scale),(0,i.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",xU.offset),(0,i.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",xU.rotation),(0,i.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new cU(h.e.ANIMATIONTYPE_COLOR3,"diffuse",EU,(()=>3))]),(0,i.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new cU(h.e.ANIMATIONTYPE_FLOAT,"intensity",wU,(()=>1))]),(0,i.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new cU(h.e.ANIMATIONTYPE_FLOAT,"range",wU,(()=>1))]),(0,i.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new cU(h.e.ANIMATIONTYPE_FLOAT,"innerAngle",gU,(()=>1))]),(0,i.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new cU(h.e.ANIMATIONTYPE_FLOAT,"angle",gU,(()=>1))]),(0,i.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new cU(h.e.ANIMATIONTYPE_COLOR3,"diffuse",EU,(()=>3))]),(0,i.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new cU(h.e.ANIMATIONTYPE_FLOAT,"intensity",wU,(()=>1))]);const ZU="KHR_animation_pointer";class WU{constructor(t){this.name=ZU,this._loader=t,this._pathToObjectConverter=(0,i.g)(this._loader.lX)}get enabled(){return this._loader.isExtensionUsed(ZU)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(t,U,y,I,r){var Y;const mt=null===(Y=I.target.extensions)||void 0===Y?void 0:Y.KHR_animation_pointer;if(!mt||!this._pathToObjectConverter)return null;"pointer"!==I.target.path&&E.b.Warn(`${t}/target/path: Value (${I.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=I.target.node&&E.b.Warn(`${t}/target/node: Value (${I.target.node}) must not be present when using the ${this.name} extension`);const X=`${t}/extensions/${this.name}`,P=mt.pointer;if(!P)throw new Error(`${X}: Pointer is missing`);try{const Y=this._pathToObjectConverter.convert(P);if(!Y.info.interpolation)throw new Error(`${X}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(t,U,y,I,{object:Y.object,info:Y.info.interpolation},r)}catch(G){return E.b.Warn(`${X}/pointer: Invalid pointer (${P}) skipped`),null}}}n(ZU),V(ZU,!0,(t=>new WU(t)));class AU{constructor(t,U,y){this.frame=t,this.action=U,this.onlyOnce=y,this.isDone=!1}_clone(){return new AU(this.frame,this.action,this.onlyOnce)}}var KU=y(12242),CU=y(12285),RU=y(12277);class uU{get loop(){return this._loop}set loop(t){t!==this._loop&&(this._loop=t,this.updateOptions({loop:t}))}get currentTime(){var t;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(t=CU.e.audioEngine)&&void 0!==t&&t.audioContext&&(this.isPlaying||this.isPaused)){const t=this.isPaused?0:CU.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+t}return 0}get spatialSound(){return this._spatialSound}set spatialSound(t){if(t==this._spatialSound)return;const U=this.isPlaying;this.pause(),t?(this._spatialSound=t,this._updateSpatialParameters()):this._disableSpatialSound(),U&&this.play()}constructor(t,U,y){var I;let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new M.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=r.DU.Zero(),this._localDirection=new r.DU(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,y=y||F.d.LastCreatedScene)if(this._scene=y,uU._SceneComponentInitialization(y),this._readyToPlayCallback=Y,this._customAttenuationFunction=(t,U,y,I,r)=>U<y?t*(1-U/y):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(I=CU.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&CU.e.audioEngine.audioContext){this._soundGain=CU.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let t=!0;if(U)try{"string"===typeof U?(this._urlType="String",this._url=U):U instanceof ArrayBuffer?this._urlType="ArrayBuffer":U instanceof HTMLMediaElement?this._urlType="MediaElement":U instanceof MediaStream?this._urlType="MediaStream":U instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(U)&&(this._urlType="Array");let y=[],I=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=CU.e.audioEngine.audioContext.createMediaElementSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=CU.e.audioEngine.audioContext.createMediaStreamSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":U.byteLength>0&&(I=!0,this._soundLoaded(U));break;case"AudioBuffer":this._audioBufferLoaded(U);break;case"String":y.push(U);case"Array":0===y.length&&(y=U);for(let t=0;t<y.length;t++){const U=y[t];if(I=X&&X.skipCodecCheck||-1!==U.indexOf(".mp3",U.length-4)&&CU.e.audioEngine.isMP3supported||-1!==U.indexOf(".ogg",U.length-4)&&CU.e.audioEngine.isOGGsupported||-1!==U.indexOf(".wav",U.length-4)||-1!==U.indexOf(".m4a",U.length-4)||-1!==U.indexOf(".mp4",U.length-4)||-1!==U.indexOf("blob:"),I){this._streaming?(this._htmlAudioElement=new Audio(U),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,mt.Tools.SetCorsBehavior(U,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(U,(t=>{this._soundLoaded(t)}),void 0,!0,!0,(t=>{t&&E.b.Error("XHR "+t.status+" error on: "+U+"."),E.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:t=!1}t?I||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(P){E.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),CU.e.audioEngine&&!CU.e.audioEngine.WarnedWebAudioUnsupported&&(E.b.Error("Web Audio is not supported by your browser."),CU.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var t;null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(t){var U;null!==(U=CU.e.audioEngine)&&void 0!==U&&U.audioContext&&(this._audioBuffer=t,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(t){var U;null!==(U=CU.e.audioEngine)&&void 0!==U&&U.audioContext&&CU.e.audioEngine.audioContext.decodeAudioData(t,(t=>{this._audioBufferLoaded(t)}),(t=>{E.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+t)}))}setAudioBuffer(t){var U;null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)}updateOptions(t){t&&(this.loop=t.loop??this.loop,this.maxDistance=t.maxDistance??this.maxDistance,this.useCustomAttenuation=t.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=t.rolloffFactor??this.rolloffFactor,this.refDistance=t.refDistance??this.refDistance,this.distanceModel=t.distanceModel??this.distanceModel,this._playbackRate=t.playbackRate??this._playbackRate,this._length=t.length??void 0,this.spatialSound=t.spatialSound??this._spatialSound,this._setOffset(t.offset??void 0),this.setVolume(t.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var t;null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&CU.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??CU.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var t;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(t=this._soundPanner)||void 0===t||t.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var t;null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(t){var U;null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)}setDirectionalCone(t,U,y){U<t?E.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=U,this._coneOuterGain=y,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!=this._coneInnerAngle){var U;if(this._coneOuterAngle<t)return void E.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!=this._coneOuterAngle){var U;if(t<this._coneInnerAngle)return void E.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(t){var U;t.equals(this._position)||(this._position.Y(t),null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(t){var U;this._localDirection=t,null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const t=this._connectedTransformNode.getWorldMatrix(),U=r.DU.TransformNormal(this._localDirection,t);U.normalize(),this._soundPanner.orientationX.value=U.x,this._soundPanner.orientationY.value=U.y,this._soundPanner.orientationZ.value=U.z}updateDistanceFromListener(){var t;if(null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const t=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.lU(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(t){this._customAttenuationFunction=t}play(t,U,y){var I;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(I=CU.e.audioEngine)&&void 0!==I&&I.audioContext)try{var r,Y;this._clearTimeoutsAndObservers();let I=t?(null===(r=CU.e.audioEngine)||void 0===r?void 0:r.audioContext.currentTime)+t:null===(Y=CU.e.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=CU.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const t=()=>{var y;if(null!==(y=CU.e.audioEngine)&&void 0!==y&&y.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=U??0;const y=this._htmlAudioElement.play();void 0!==y&&y.catch((()=>{var U,y;(null===(U=CU.e.audioEngine)||void 0===U||U.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(y=CU.e.audioEngine)||void 0===y?void 0:y.onAudioUnlockedObservable.addOnce((()=>{t()})))}))}else{var I;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(I=CU.e.audioEngine)||void 0===I?void 0:I.onAudioUnlockedObservable.addOnce((()=>{t()}))}};t()}}else{var mt;const r=()=>{var r;if(null!==(r=CU.e.audioEngine)&&void 0!==r&&r.audioContext){var Y;if(y=y||this._length,void 0!==U&&this._setOffset(U),this._soundSource){const t=this._soundSource;t.onended=()=>{t.disconnect()}}if(this._soundSource=null===(Y=CU.e.audioEngine)||void 0===Y?void 0:Y.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var mt;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==U&&(this._soundSource.loopStart=U),void 0!==y&&(this._soundSource.loopEnd=(0|U)+y),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},I=t?(null===(mt=CU.e.audioEngine)||void 0===mt?void 0:mt.audioContext.currentTime)+t:CU.e.audioEngine.audioContext.currentTime;const r=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(I,r,this.loop?void 0:y)}}};"suspended"===(null===(mt=CU.e.audioEngine)||void 0===mt?void 0:mt.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var t;"suspended"===(null===(t=CU.e.audioEngine)||void 0===t?void 0:t.audioContext.state)?(CU.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=CU.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{r()})))):r()}),500):r()}this._startTime=I,this.isPlaying=!0,this.isPaused=!1}catch(X){E.b.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(t){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var y;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(y=this._streamingSource)||void 0===y||y.disconnect();this.isPlaying=!1}else if(null!==(U=CU.e.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource){const U=t?CU.e.audioEngine.audioContext.currentTime+t:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(U)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var t;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(t=CU.e.audioEngine)&&void 0!==t&&t.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=CU.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(t,U){var y;null!==(y=CU.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._soundGain&&(U&&CU.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(CU.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,CU.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,CU.e.audioEngine.audioContext.currentTime+U)):this._soundGain.gain.value=t),this._volume=t}setPlaybackRate(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(t){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=t=>this._onRegisterAfterWorldMatrixUpdate(t),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(t){var U;if(t.getBoundingInfo){const U=t.getBoundingInfo();this.setPosition(U.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const t=()=>{(0,RU.g)((()=>this._isReadyToPlay),(()=>{y._audioBuffer=this.getAudioBuffer(),y._isReadyToPlay=!0,y.autoplay&&y.play(0,this._offset,this._length)}),void 0,300)},U={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},y=new uU(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,U);return this.useCustomAttenuation&&y.setAttenuationFunction(this._customAttenuationFunction),y.setPosition(this._position),y.setPlaybackRate(this._playbackRate),t(),y}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const t={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.bX(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.bX(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t}static Parse(t,U,y,I){const Y=t.name;let mt;mt=t.url?y+t.url:y+Y;const X={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let P;if(I){const t=()=>{(0,RU.g)((()=>I._isReadyToPlay),(()=>{P._audioBuffer=I.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,P._offset,P._length)}),void 0,300)};P=new uU(Y,new ArrayBuffer(0),U,null,X),t()}else P=new uU(Y,mt,U,(()=>{U.removePendingData(P)}),X),U.addPendingData(P);if(t.position){const U=r.DU.pU(t.position);P.setPosition(U)}if(t.isDirectional&&(P.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const U=r.DU.pU(t.localDirectionToMesh);P.setLocalDirectionToMesh(U)}if(t.connectedMeshId){const y=U.getMeshById(t.connectedMeshId);y&&P.attachToMesh(y)}return t.metadata&&(P.metadata=t.metadata),P}_setOffset(t){this._offset!==t&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=t)}_clearTimeoutsAndObservers(){var t;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(t=CU.e.audioEngine)||void 0===t||t.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}uU._SceneComponentInitialization=t=>{throw(0,KU.c)("AudioSceneComponent")},(0,pt.f)("BABYLON.Sound",uU);class TU{constructor(t,U,y){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],U.length!==y.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=y;let I=0;for(const Y of y)I+=Y;const r=I>0?1/I:0;for(let Y=0;Y<this._weights.length;Y++)this._weights[Y]*=r;this._sounds=U;for(const Y of this._sounds)Y.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void E.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(const U of this._sounds)U.directionalConeInnerAngle=t}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void E.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(const U of this._sounds)U.directionalConeOuterAngle=t}}get volume(){return this._volume}set volume(t){if(t!==this._volume)for(const U of this._sounds)U.setVolume(t)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(t){if(!this.isPaused){this.stop();const t=Math.random();let U=0;for(let y=0;y<this._weights.length;y++)if(U+=this._weights[y],t<=U){this._currentIndex=y;break}}const U=this._sounds[this._currentIndex??0];U.isReady()?U.play(0,this.isPaused?void 0:t):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class zU{constructor(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(t=t||F.d.LastCreatedScene)&&(this._scene=t,this.soundCollection=[],this._options=U,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var t;null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&CU.e.audioEngine.audioContext&&(this._outputAudioNode=CU.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(CU.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(CU.e.audioEngine&&CU.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(t){var U;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id}removeSound(t){const U=this.soundCollection.indexOf(t);-1!==U&&this.soundCollection.splice(U,1)}setVolume(t){var U;null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)}switchPanningModelToHRTF(){var t;if(null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var t;if(null!==(t=CU.e.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToEqualPower()}connectToAnalyser(t){var U;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,null!==(U=CU.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,CU.e.audioEngine.masterGain))}}var ty=y(12694),Uy=y(12653),yy=y(12212);CU.e.AudioEngineFactory=(t,U,y)=>new Iy(t,U,y);class Iy{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new M.b,this.onAudioLockedObservable=new M.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,yy.p)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const I=document.createElement("audio");this._hostElement=t,this._audioContext=U,this._audioDestination=y;try{I&&I.canPlayType&&(I.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||I.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(r){}try{I&&I.canPlayType&&I.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(r){}}lock(){this._triggerSuspendedState()}unlock(){var t,U;if("running"===(null===(t=this._audioContext)||void 0===t?void 0:t.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(U=this._audioContext)||void 0===U||U.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var t;null===(t=this._audioContext)||void 0===t||t.addEventListener("statechange",(()=>{var t;this.unlocked&&"running"!==(null===(t=this._audioContext)||void 0===t?void 0:t.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var t;return null!==(t=this._audioContext)&&void 0!==t&&t.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(t){this.canUseWebAudio=!1,E.b.Error("Web Audio: "+t.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(t){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const t=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",U=document.createElement("style");U.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(U),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var t;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(t=this._audioContext)||void 0===t||t.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var ry=y(12234);(0,y(13534).g)(ty.b.NAME_AUDIO,((t,U,y,I)=>{let r,Y=[];if(y.YQ=y.YQ||[],void 0!==t.YQ&&null!==t.YQ)for(let X=0,P=t.YQ.length;X<P;X++){var mt;const P=t.YQ[X];null!==(mt=CU.e.audioEngine)&&void 0!==mt&&mt.canUseWebAudio?(P.url||(P.url=P.name),Y[P.url]?y.YQ.push(uU.Parse(P,U,I,Y[P.url])):(r=uU.Parse(P,U,I),Y[P.url]=r,y.YQ.push(r))):y.YQ.push(new uU(P.name,null,U))}Y=[]})),Object.defineProperty(Uy.e.prototype,"mainSoundTrack",{get:function(){let t=this._getComponent(ty.b.NAME_AUDIO);return t||(t=new Yy(this),this.IX(t)),this._mainSoundTrack||(this._mainSoundTrack=new zU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Uy.e.prototype.getSoundByName=function(t){let U;for(U=0;U<this.mainSoundTrack.soundCollection.length;U++)if(this.mainSoundTrack.soundCollection[U].name===t)return this.mainSoundTrack.soundCollection[U];if(this.soundTracks)for(let y=0;y<this.soundTracks.length;y++)for(U=0;U<this.soundTracks[y].soundCollection.length;U++)if(this.soundTracks[y].soundCollection[U].name===t)return this.soundTracks[y].soundCollection[U];return null},Object.defineProperty(Uy.e.prototype,"audioEnabled",{get:function(){let t=this._getComponent(ty.b.NAME_AUDIO);return t||(t=new Yy(this),this.IX(t)),t.audioEnabled},set:function(t){let U=this._getComponent(ty.b.NAME_AUDIO);U||(U=new Yy(this),this.IX(U)),t?U.enableAudio():U.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Uy.e.prototype,"headphone",{get:function(){let t=this._getComponent(ty.b.NAME_AUDIO);return t||(t=new Yy(this),this.IX(t)),t.headphone},set:function(t){let U=this._getComponent(ty.b.NAME_AUDIO);U||(U=new Yy(this),this.IX(U)),t?U.switchAudioModeForHeadphones():U.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Uy.e.prototype,"audioListenerPositionProvider",{get:function(){let t=this._getComponent(ty.b.NAME_AUDIO);return t||(t=new Yy(this),this.IX(t)),t.audioListenerPositionProvider},set:function(t){let U=this._getComponent(ty.b.NAME_AUDIO);if(U||(U=new Yy(this),this.IX(U)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");U.audioListenerPositionProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(Uy.e.prototype,"audioListenerRotationProvider",{get:function(){let t=this._getComponent(ty.b.NAME_AUDIO);return t||(t=new Yy(this),this.IX(t)),t.audioListenerRotationProvider},set:function(t){let U=this._getComponent(ty.b.NAME_AUDIO);if(U||(U=new Yy(this),this.IX(U)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");U.audioListenerRotationProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(Uy.e.prototype,"audioPositioningRefreshRate",{get:function(){let t=this._getComponent(ty.b.NAME_AUDIO);return t||(t=new Yy(this),this.IX(t)),t.audioPositioningRefreshRate},set:function(t){let U=this._getComponent(ty.b.NAME_AUDIO);U||(U=new Yy(this),this.IX(U)),U.audioPositioningRefreshRate=t},enumerable:!0,configurable:!0});class Yy{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(t){this.name=ty.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new r.DU,this._cachedCameraPosition=new r.DU,this._lastCheck=0,this._invertMatrixTemp=new r.Matrix,this._cameraDirectionTemp=new r.DU,(t=t||F.d.LastCreatedScene)&&(this.gU=t,t.soundTracks=[],t.YQ=[])}register(){this.gU._afterRenderStage.registerStep(ty.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(t){if(t.YQ=[],this.gU.soundTracks)for(let U=0;U<this.gU.soundTracks.length;U++){const y=this.gU.soundTracks[U];for(let U=0;U<y.soundCollection.length;U++)t.YQ.push(y.soundCollection[U].serialize())}}addFromContainer(t){if(t.YQ)for(const U of t.YQ)U.play(),U.autoplay=!0,this.gU.mainSoundTrack.addSound(U)}removeFromContainer(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.YQ)for(const y of t.YQ)y.stop(),y.autoplay=!1,this.gU.mainSoundTrack.removeSound(y),U&&y.dispose()}dispose(){const t=this.gU;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(let U=0;U<t.soundTracks.length;U++)t.soundTracks[U].dispose()}disableAudio(){const t=this.gU;let U;for(this._audioEnabled=!1,CU.e.audioEngine&&CU.e.audioEngine.audioContext&&CU.e.audioEngine.audioContext.suspend(),U=0;U<t.mainSoundTrack.soundCollection.length;U++)t.mainSoundTrack.soundCollection[U].pause();if(t.soundTracks)for(U=0;U<t.soundTracks.length;U++)for(let y=0;y<t.soundTracks[U].soundCollection.length;y++)t.soundTracks[U].soundCollection[y].pause()}enableAudio(){const t=this.gU;let U;for(this._audioEnabled=!0,CU.e.audioEngine&&CU.e.audioEngine.audioContext&&CU.e.audioEngine.audioContext.resume(),U=0;U<t.mainSoundTrack.soundCollection.length;U++)t.mainSoundTrack.soundCollection[U].isPaused&&t.mainSoundTrack.soundCollection[U].play();if(t.soundTracks)for(U=0;U<t.soundTracks.length;U++)for(let y=0;y<t.soundTracks[U].soundCollection.length;y++)t.soundTracks[U].soundCollection[y].isPaused&&t.soundTracks[U].soundCollection[y].play()}switchAudioModeForHeadphones(){const t=this.gU;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(let U=0;U<t.soundTracks.length;U++)t.soundTracks[U].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const t=this.gU;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(let U=0;U<t.soundTracks.length;U++)t.soundTracks[U].switchPanningModelToEqualPower()}_afterRender(){const t=ry.b.Now;if(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=t;const U=this.gU;if(!this._audioEnabled||!U._mainSoundTrack||!U.soundTracks||0===U._mainSoundTrack.soundCollection.length&&1===U.soundTracks.length)return;const y=CU.e.audioEngine;if(y&&y.audioContext){let t,I=U.activeCamera;if(U.activeCameras&&U.activeCameras.length>0&&(I=U.activeCameras[0]),this.audioListenerPositionProvider){const t=this.audioListenerPositionProvider();y.audioContext.listener.setPosition(t.x||0,t.y||0,t.z||0)}else I?this._cachedCameraPosition.equals(I.globalPosition)||(this._cachedCameraPosition.Y(I.globalPosition),y.audioContext.listener.setPosition(I.globalPosition.x,I.globalPosition.y,I.globalPosition.z)):y.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const t=this.audioListenerRotationProvider();y.audioContext.listener.setOrientation(t.x||0,t.y||0,t.z||0,0,1,0)}else I?(I.rigCameras&&I.rigCameras.length>0&&(I=I.rigCameras[0]),I.getViewMatrix().invertToRef(this._invertMatrixTemp),r.DU.TransformNormalToRef(Yy._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.Y(this._cameraDirectionTemp),y.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):y.audioContext.listener.setOrientation(0,0,0,0,1,0);for(t=0;t<U.mainSoundTrack.soundCollection.length;t++){const y=U.mainSoundTrack.soundCollection[t];y.useCustomAttenuation&&y.updateDistanceFromListener()}if(U.soundTracks)for(t=0;t<U.soundTracks.length;t++)for(let y=0;y<U.soundTracks[t].soundCollection.length;y++){const I=U.soundTracks[t].soundCollection[y];I.useCustomAttenuation&&I.updateDistanceFromListener()}}}}Yy._CameraDirection=new r.DU(0,0,-1),uU._SceneComponentInitialization=t=>{let U=t._getComponent(ty.b.NAME_AUDIO);U||(U=new Yy(t),t.IX(U))};const mI="MSFT_audio_emitter";class Xy{constructor(t){this.name=mI,this._loader=t,this.enabled=this._loader.isExtensionUsed(mI)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const t=this._loader.lX.extensions;if(t&&t[this.name]){const U=t[this.name];this._clips=U.clips,this._emitters=U.emitters,k.Assign(this._clips),k.Assign(this._emitters)}}loadSceneAsync(t,U){return x.LoadExtensionAsync(t,U,this.name,(async(y,I)=>{const r=new Array;r.push(this._loader.loadSceneAsync(t,U));for(const t of I.emitters){const U=k.Get(`${y}/emitters`,this._emitters,t);if(void 0!=U.refDistance||void 0!=U.maxDistance||void 0!=U.rolloffFactor||void 0!=U.distanceModel||void 0!=U.innerAngle||void 0!=U.outerAngle)throw new Error(`${y}: Direction or Distance properties are not allowed on emitters attached to a scene`);r.push(this._loadEmitterAsync(`${y}/emitters/${U.index}`,U))}await Promise.all(r)}))}loadNodeAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(t,I)=>{const Y=new Array,X=await this._loader.loadNodeAsync(t,U,(U=>{for(const y of I.emitters){const I=k.Get(`${t}/emitters`,this._emitters,y);Y.push(this._loadEmitterAsync(`${t}/emitters/${I.index}`,I).then((()=>{for(const t of I._babylonSounds)t.attachToMesh(U),void 0==I.innerAngle&&void 0==I.outerAngle||(t.setLocalDirectionToMesh(r.DU.Forward()),t.setDirectionalCone(2*mt.Tools.ToDegrees(void 0==I.innerAngle?Math.PI:I.innerAngle),2*mt.Tools.ToDegrees(void 0==I.outerAngle?Math.PI:I.outerAngle),0))})))}y(U)}));return await Promise.all(Y),X}))}loadAnimationAsync(t,U){return x.LoadExtensionAsync(t,U,this.name,(async(y,I)=>{const r=await this._loader.loadAnimationAsync(t,U),Y=new Array;k.Assign(I.events);for(const mt of I.events)Y.push(this._loadAnimationEventAsync(`${y}/events/${mt.index}`,t,U,mt,r));return await Promise.all(Y),r}))}_loadClipAsync(t,U){if(U._objectURL)return U._objectURL;let y;if(U.uri)y=this._loader.loadUriAsync(t,U,U.uri);else{const I=k.Get(`${t}/bufferView`,this._loader.lX.bufferViews,U.bufferView);y=this._loader.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}return U._objectURL=y.then((t=>URL.createObjectURL(new Blob([t],{type:U.mimeType})))),U._objectURL}_loadEmitterAsync(t,U){if(U._babylonSounds=U._babylonSounds||[],!U._babylonData){const t=new Array,y=U.name||`emitter${U.index}`,I={loop:!1,autoplay:!1,volume:void 0==U.volume?1:U.volume};for(let Y=0;Y<U.clips.length;Y++){const r=`/extensions/${this.name}/clips`,mt=k.Get(r,this._clips,U.clips[Y].clip);t.push(this._loadClipAsync(`${r}/${U.clips[Y].clip}`,mt).then((t=>{const r=U._babylonSounds[Y]=new uU(y,t,this._loader.babylonScene,null,I);r.refDistance=U.refDistance||1,r.maxDistance=U.maxDistance||256,r.rolloffFactor=U.rolloffFactor||1,r.distanceModel=U.distanceModel||"exponential"})))}const r=Promise.all(t).then((()=>{const t=U.clips.map((t=>t.weight||1)),y=new TU(U.loop||!1,U._babylonSounds,t);U.innerAngle&&(y.directionalConeInnerAngle=2*mt.Tools.ToDegrees(U.innerAngle)),U.outerAngle&&(y.directionalConeOuterAngle=2*mt.Tools.ToDegrees(U.outerAngle)),U.volume&&(y.volume=U.volume),U._babylonData.sound=y}));U._babylonData={loaded:r}}return U._babylonData.loaded}_getEventAction(t,U,y,I,r){switch(y){case"play":return t=>{const y=(r||0)+(t-I);U.play(y)};case"stop":return()=>{U.stop()};case"pause":return()=>{U.pause()};default:throw new Error(`${t}: Unsupported action ${y}`)}}_loadAnimationEventAsync(t,U,y,I,r){if(0==r.targetedAnimations.length)return Promise.resolve();const Y=r.targetedAnimations[0],mt=I.my,X=k.Get(`/extensions/${this.name}/emitters`,this._emitters,mt);return this._loadEmitterAsync(t,X).then((()=>{const U=X._babylonData.sound;if(U){const y=new AU(I.time,this._getEventAction(t,U,I.action,I.time,I.startOffset));Y.animation.addEvent(y),r.onAnimationGroupEndObservable.add((()=>{U.stop()})),r.onAnimationGroupPauseObservable.add((()=>{U.pause()}))}}))}}n(mI),V(mI,!0,(t=>new Xy(t)));const Py="MSFT_lod";class Gy{constructor(t){var U;this.name=Py,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new M.b,this.onMaterialLODsLoadedObservable=new M.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=t,this.maxLODsToLoad=(null===(U=this._loader.parent.extensionOptions[Py])||void 0===U?void 0:U.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Py)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let t=0;t<this._nodePromiseLODs.length;t++){const U=Promise.all(this._nodePromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Node LOD ${t}`),this._loader.log(`Loaded node LOD ${t}`)),this.onNodeLODsLoadedObservable.notifyObservers(t),t!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${t+1}`),this._loadBufferLOD(this._nodeBufferLODs,t+1),this._nodeSignalLODs[t]&&this._nodeSignalLODs[t].resolve())}));this._loader._completePromises.push(U)}for(let t=0;t<this._materialPromiseLODs.length;t++){const U=Promise.all(this._materialPromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Material LOD ${t}`),this._loader.log(`Loaded material LOD ${t}`)),this.onMaterialLODsLoadedObservable.notifyObservers(t),t!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${t+1}`),this._loadBufferLOD(this._materialBufferLODs,t+1),this._materialSignalLODs[t]&&this._materialSignalLODs[t].resolve())}));this._loader._completePromises.push(U)}}loadSceneAsync(t,U){const y=this._loader.loadSceneAsync(t,U);return this._loadBufferLOD(this._bufferLODs,0),y}loadNodeAsync(t,U,y){return x.LoadExtensionAsync(t,U,this.name,(async(t,r)=>{let Y;const mt=this._getLODs(t,U,this._loader.lX.nodes,r.ids);this._loader.logOpen(`${t}`);for(let U=0;U<mt.length;U++){const t=mt[U];0!==U&&(this._nodeIndexLOD=U,this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new I);const r=t=>{y(t),t.tP(!1)},X=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,r).then((t=>{if(0!==U){const t=mt[U-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.tP(!0),t}));this._nodePromiseLODs[U]=this._nodePromiseLODs[U]||[],0===U?Y=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[U].push(X))}return this._loader.logClose(),await Y}))}_loadMaterialAsync(t,U,y,I,r){return this._nodeIndexLOD?null:x.LoadExtensionAsync(t,U,this.name,(async(t,Y)=>{let mt;const X=this._getLODs(t,U,this._loader.lX.materials,Y.ids);this._loader.logOpen(`${t}`);for(let U=0;U<X.length;U++){const t=X[U];0!==U&&(this._materialIndexLOD=U);const Y=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,y,I,(t=>{0===U&&r(t)})).then((t=>{if(0!==U){r(t);const y=X[U-1]._data;y[I]&&(this._disposeMaterials([y[I].babylonMaterial]),delete y[I])}return t}));this._materialPromiseLODs[U]=this._materialPromiseLODs[U]||[],0===U?mt=Y:(this._materialIndexLOD=null,this._materialPromiseLODs[U].push(Y))}return this._loader.logClose(),await mt}))}_loadUriAsync(t,U,y){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const r=this._nodeIndexLOD-1;return this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new I,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(t,U,y)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const r=this._materialIndexLOD-1;return this._materialSignalLODs[r]=this._materialSignalLODs[r]||new I,this._materialSignalLODs[r].promise.then((async()=>await this._loader.loadUriAsync(t,U,y)))}return null}loadBufferAsync(t,U,y,r){if(this._loader.parent.useRangeRequests&&!U.uri){if(!this._loader.bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);const U=async(t,U)=>{const Y=y,mt=Y+r-1;let X=t[U];return X?(X.start=Math.min(X.start,Y),X.end=Math.max(X.end,mt)):(X={start:Y,end:mt,loaded:new I},t[U]=X),await X.loaded.promise.then((t=>new Uint8Array(t.buffer,t.byteOffset+y-X.start,r)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?U(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?U(this._materialBufferLODs,this._materialIndexLOD):U(this._bufferLODs,0)}return null}_loadBufferLOD(t,U){const y=t[U];y&&(this._loader.log(`Loading buffer range [${y.start}-${y.end}]`),this._loader.bin.readAsync(y.start,y.end-y.start+1).then((t=>{y.loaded.resolve(t)}),(t=>{y.loaded.reject(t)})))}_getLODs(t,U,y,I){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const r=[];for(let Y=I.length-1;Y>=0;Y--)if(r.push(k.Get(`${t}/ids/${I[Y]}`,y,I[Y])),r.length===this.maxLODsToLoad)return r;return r.push(U),r}_disposeTransformNode(t){const U=[],y=t.material;y&&U.push(y);for(const r of t.getChildMeshes())r.material&&U.push(r.material);t.dispose();const I=U.filter((t=>this._loader.babylonScene.meshes.every((U=>U.material!=t))));this._disposeMaterials(I)}_disposeMaterials(t){const U={};for(const y of t){for(const t of y.getActiveTextures())U[t.uniqueId]=t;y.dispose()}for(const y in U)for(const t of this._loader.babylonScene.materials)t.hasTexture(U[y])&&delete U[y];for(const y in U)U[y].dispose()}}n(Py),V(Py,!0,(t=>new Gy(t)));const My="MSFT_minecraftMesh";class Ly{constructor(t){this.name=My,this._loader=t,this.enabled=this._loader.isExtensionUsed(My)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtraAsync(t,U,this.name,(async(I,r)=>{if(r){if(!(y instanceof g.d))throw new Error(`${I}: Material type not supported`);const r=this._loader.loadMaterialPropertiesAsync(t,U,y);return y.needAlphaBlending()&&(y.forceDepthWrite=!0,y.separateCullingPass=!0),y.JX=y.forceDepthWrite,y.twoSidedLighting=!0,await r}}))}}n(My),V(My,!0,(t=>new Ly(t)));const hy="MSFT_sRGBFactors";class Qy{constructor(t){this.name=hy,this._loader=t,this.enabled=this._loader.isExtensionUsed(hy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,U,y){return x.LoadExtraAsync(t,U,this.name,(async(I,r)=>{if(r){if(!(y instanceof g.d))throw new Error(`${I}: Material type not supported`);const r=this._loader.loadMaterialPropertiesAsync(t,U,y),Y=y.St().getEngine().useExactSrgbConversions;return y.albedoTexture||y.albedoColor.toLinearSpaceToRef(y.albedoColor,Y),y.reflectivityTexture||y.reflectivityColor.toLinearSpaceToRef(y.reflectivityColor,Y),await r}}))}}n(hy),V(hy,!0,(t=>new Qy(t)));var Fy=y(13833);const Ey={};var wy=y(13888),Dy=y(13863),ly=y(13839),gy=y(13845);function By(t,U){for(const y of t)for(const t of y.dataOutputs)if(t.uniqueId===U)return t;throw new Error("Could not find data out connection with unique id "+U)}function by(t,U){for(const y of t)if(y instanceof Dy.d)for(const t of y.signalInputs)if(t.uniqueId===U)return t;throw new Error("Could not find signal in connection with unique id "+U)}async function py(t,U){const I=await Promise.all(t.allBlocks.map((async t=>{const U=function(t){switch(t){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([y.e(78),y.e(79)]).then(y.bind(y,15328))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await y.e(80).then(y.bind(y,15331))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await y.e(81).then(y.bind(y,15337))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await y.e(82).then(y.bind(y,15343))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await y.e(83).then(y.bind(y,15350))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await y.e(84).then(y.bind(y,15357))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await y.e(85).then(y.bind(y,15366))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await y.e(86).then(y.bind(y,15368))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await y.e(87).then(y.bind(y,15376))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await y.e(90).then(y.bind(y,15412))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await y.e(90).then(y.bind(y,15412))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await y.e(90).then(y.bind(y,15412))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await y.e(90).then(y.bind(y,15412))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await y.e(95).then(y.bind(y,15419))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await y.e(96).then(y.bind(y,15421))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await y.e(97).then(y.bind(y,15430))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await y.e(98).then(y.bind(y,15437))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await y.e(99).then(y.bind(y,15444))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await y.e(100).then(y.bind(y,15453))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await y.e(101).then(y.bind(y,15461))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await y.e(102).then(y.bind(y,15469))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await y.e(103).then(y.bind(y,15476))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await y.e(104).then(y.bind(y,15481))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await y.e(105).then(y.bind(y,15484))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await y.e(106).then(y.bind(y,15491))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await y.e(107).then(y.bind(y,15495))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await y.e(108).then(y.bind(y,15497))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await y.e(109).then(y.bind(y,15499))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await y.e(110).then(y.bind(y,15501))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await y.e(111).then(y.bind(y,15507))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await y.e(112).then(y.bind(y,15510))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await y.e(113).then(y.bind(y,15512))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await y.e(92).then(y.bind(y,15514))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await y.e(114).then(y.bind(y,15517))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await y.e(115).then(y.bind(y,15521))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await y.e(116).then(y.bind(y,15525))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await y.e(93).then(y.bind(y,15527))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await y.e(88).then(y.bind(y,15384))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await y.e(94).then(y.bind(y,15533))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await y.e(89).then(y.bind(y,15406))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await y.e(90).then(y.bind(y,15412))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await y.e(90).then(y.bind(y,15412))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await y.e(91).then(y.bind(y,15536))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await y.e(91).then(y.bind(y,15536))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await y.e(91).then(y.bind(y,15536))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await y.e(91).then(y.bind(y,15536))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await y.e(91).then(y.bind(y,15536))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await y.e(91).then(y.bind(y,15536))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await y.e(117).then(y.bind(y,15543))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await y.e(118).then(y.bind(y,15547))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await y.e(119).then(y.bind(y,15552))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await y.e(120).then(y.bind(y,15554))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await y.e(121).then(y.bind(y,15560))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await y.e(122).then(y.bind(y,15563))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await y.e(123).then(y.bind(y,15570))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await y.e(124).then(y.bind(y,15573))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await y.e(125).then(y.bind(y,15579))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await y.e(126).then(y.bind(y,15583))).FlowGraphDataSwitchBlock;default:if(Ey[t])return Ey[t];throw new Error(`Unknown block name ${t}`)}}(t.className);return await U()})));return function(t,U,y){const I=U.coordinator.createGraph(),r=[],Y=U.valueParseFunction??ly.d;for(let mt=0;mt<t.allBlocks.length;mt++){const X=fy(t.allBlocks[mt],{gU:U.coordinator.config.gU,pathConverter:U.pathConverter,assetsContainer:U.coordinator.config.gU,valueParseFunction:Y},y[mt]);r.push(X),X instanceof wy.c&&I.addEventBlock(X)}for(const mt of r){for(const t of mt.dataInputs)for(const U of t.connectedPointIds){const y=By(r,U);t.connectTo(y)}if(mt instanceof Dy.d)for(const t of mt.signalOutputs)for(const U of t.connectedPointIds){const y=by(r,U);t.connectTo(y)}}for(const mt of t.executionContexts)cy(mt,{graph:I,valueParseFunction:Y},t.rightHanded);return I}(t,U,I)}function cy(t,U,y){const I=U.graph.createContext();t.enableLogging&&(I.enableLogging=!0),I.treatDataAsRightHanded=y||!1;const r=U.valueParseFunction??ly.d;I.uniqueId=t.uniqueId;const Y=I.St();if(t._assetsContext){var mt,X,P,G,M,L,h,Q,F,E;const U=t._assetsContext,y={meshes:null===(mt=U.meshes)||void 0===mt?void 0:mt.map((t=>Y.getMeshById(t))),lights:null===(X=U.lights)||void 0===X?void 0:X.map((t=>Y.getLightByName(t))),cameras:null===(P=U.cameras)||void 0===P?void 0:P.map((t=>Y.getCameraByName(t))),materials:null===(G=U.materials)||void 0===G?void 0:G.map((t=>Y.getMaterialById(t))),textures:null===(M=U.textures)||void 0===M?void 0:M.map((t=>Y.getTextureByName(t))),animations:null===(L=U.animations)||void 0===L?void 0:L.map((t=>Y.animations.find((U=>U.name===t)))),skeletons:null===(h=U.skeletons)||void 0===h?void 0:h.map((t=>Y.getSkeletonByName(t))),mQ:null===(Q=U.mQ)||void 0===Q?void 0:Q.map((t=>Y.getParticleSystemById(t))),animationGroups:null===(F=U.animationGroups)||void 0===F?void 0:F.map((t=>Y.getAnimationGroupByName(t))),transformNodes:null===(E=U.transformNodes)||void 0===E?void 0:E.map((t=>Y.getTransformNodeById(t))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],YQ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};I.assetsContext=y}for(const w in t._userVariables){const U=r(w,t._userVariables,I.assetsContext,Y);I.userVariables[w]=U}for(const w in t._connectionValues){const U=r(w,t._connectionValues,I.assetsContext,Y);I._setConnectionValueByKey(w,U)}return I}function fy(t,U,y){const I={},r=U.valueParseFunction??ly.d;if(t.config)for(const mt in t.config)I[mt]=r(mt,t.config,U.assetsContainer||U.gU,U.gU);if((0,ly.i)(t.className)){if(!U.pathConverter)throw new Error("Path converter is required for this block");I.pathConverter=U.pathConverter}const Y=new y(I);Y.uniqueId=t.uniqueId;for(let mt=0;mt<t.dataInputs.length;mt++){const U=Y.getDataInput(t.dataInputs[mt].name);if(!U)throw new Error("Could not find data input with name "+t.dataInputs[mt].name+" in block "+t.className);U.deserialize(t.dataInputs[mt])}for(let mt=0;mt<t.dataOutputs.length;mt++){const U=Y.getDataOutput(t.dataOutputs[mt].name);if(!U)throw new Error("Could not find data output with name "+t.dataOutputs[mt].name+" in block "+t.className);U.deserialize(t.dataOutputs[mt])}return Y.metadata=t.metadata,Y.deserialize&&Y.deserialize(t),Y}function Sy(t){const[U,y]=t.split(":");return Ny({op:U,extension:y})}function Ny(t){var U;let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const I=t.extension?null===(U=Jy[t.extension])||void 0===U?void 0:U[t.op]:ay[t.op];if(!I&&(E.b.Warn(`No mapping found for operation ${t.op} and extension ${t.extension||"KHR_interactivity"}`),y)){const U={},y={flows:{}};if(t.inputValueSockets){U.values={};for(const y in t.inputValueSockets)U.values[y]={name:y}}return t.outputValueSockets&&(y.values={},Object.keys(t.outputValueSockets).forEach((t=>{y.values[t]={name:t}}))),{cM:[],inputs:U,outputs:y}}return I}function jy(t,U,y){Jy[U]||(Jy[U]={}),Jy[U][t]=y}const Jy={BABYLON:{"flow/log":{cM:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},ay={"event/onStart":{cM:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{cM:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{cM:["FlowGraphSendCustomEventBlock"],extraProcessor(t,U,y,I,r){if("event/send"!==U.op||!t.configuration||1!==Object.keys(t.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Y=t.configuration.event.value[0];if("number"!==typeof Y)throw new Error("Event id should be a number");const mt=I.arrays.events[Y],X=r[0];return X.config||(X.config={}),X.config.eventId=mt.eventId,X.config.eventData=mt.eventData,r}},"event/receive":{cM:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(t,U){var y;if(!t.configuration)return E.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const I=t.configuration.event;if(!I)return E.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const r=I.value[0];if("number"!==typeof r)return E.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(y=U.events)||void 0===y?void 0:y[r])?{valid:!0}:(E.b.Error(`Event with id ${r} not found`),{valid:!1,error:`Event with id ${r} not found`})},extraProcessor(t,U,y,I,r){if("event/receive"!==U.op||!t.configuration||1!==Object.keys(t.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Y=t.configuration.event.value[0];if("number"!==typeof Y)throw new Error("Event id should be a number");const mt=I.arrays.events[Y],X=r[0];return X.config||(X.config={}),X.config.eventId=mt.eventId,X.config.eventData=mt.eventData,r}},"math/e":dy("FlowGraphEBlock"),"math/pi":dy("FlowGraphPIBlock"),"math/inf":dy("FlowGraphInfBlock"),"math/nan":dy("FlowGraphNaNBlock"),"math/abs":dy("FlowGraphAbsBlock"),"math/sign":dy("FlowGraphSignBlock"),"math/trunc":dy("FlowGraphTruncBlock"),"math/floor":dy("FlowGraphFloorBlock"),"math/ceil":dy("FlowGraphCeilBlock"),"math/round":{cM:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r){var Y;return(Y=r[0]).config||(Y.config={}),r[0].config.roundHalfAwayFromZero=!0,r}},"math/fract":dy("FlowGraphFractBlock"),"math/neg":dy("FlowGraphNegationBlock"),"math/add":dy("FlowGraphAddBlock",["a","b"],!0),"math/sub":dy("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{cM:["FlowGraphMultiplyBlock"],extraProcessor(t,U,y,I,r){var Y;(Y=r[0]).config||(Y.config={}),r[0].config.useMatrixPerComponent=!0,r[0].config.preventIntegerFloatArithmetic=!0;let mt=-1;return Object.keys(t.values||{}).find((U=>{var y;return void 0!==(null===(y=t.values)||void 0===y?void 0:y[U].type)&&(mt=t.values[U].type,!0)})),-1!==mt&&(r[0].config.type=I.arrays.types[mt].flowGraphType),r},validation:t=>t.values?qy(t):{valid:!0}},"math/div":dy("FlowGraphDivideBlock",["a","b"],!0),"math/rem":dy("FlowGraphModuloBlock",["a","b"]),"math/min":dy("FlowGraphMinBlock",["a","b"]),"math/max":dy("FlowGraphMaxBlock",["a","b"]),"math/clamp":dy("FlowGraphClampBlock",["a","b","c"]),"math/saturate":dy("FlowGraphSaturateBlock"),"math/mix":dy("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":dy("FlowGraphEqualityBlock",["a","b"]),"math/lt":dy("FlowGraphLessThanBlock",["a","b"]),"math/le":dy("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":dy("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":dy("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":dy("FlowGraphIsNaNBlock"),"math/isinf":dy("FlowGraphIsInfBlock"),"math/select":{cM:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{cM:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":dy("FlowGraphSinBlock"),"math/cos":dy("FlowGraphCosBlock"),"math/tan":dy("FlowGraphTanBlock"),"math/asin":dy("FlowGraphASinBlock"),"math/acos":dy("FlowGraphACosBlock"),"math/atan":dy("FlowGraphATanBlock"),"math/atan2":dy("FlowGraphATan2Block",["a","b"]),"math/sinh":dy("FlowGraphSinhBlock"),"math/cosh":dy("FlowGraphCoshBlock"),"math/tanh":dy("FlowGraphTanhBlock"),"math/asinh":dy("FlowGraphASinhBlock"),"math/acosh":dy("FlowGraphACoshBlock"),"math/atanh":dy("FlowGraphATanhBlock"),"math/exp":dy("FlowGraphExponentialBlock"),"math/log":dy("FlowGraphLogBlock"),"math/log2":dy("FlowGraphLog2Block"),"math/log10":dy("FlowGraphLog10Block"),"math/sqrt":dy("FlowGraphSquareRootBlock"),"math/cbrt":dy("FlowGraphCubeRootBlock"),"math/pow":dy("FlowGraphPowerBlock",["a","b"]),"math/length":dy("FlowGraphLengthBlock"),"math/normalize":dy("FlowGraphNormalizeBlock"),"math/dot":dy("FlowGraphDotBlock",["a","b"]),"math/cross":dy("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":dy("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":dy("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{cM:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{cM:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{cM:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{cM:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{cM:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{cM:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{cM:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":dy("FlowGraphTransposeBlock"),"math/determinant":dy("FlowGraphDeterminantBlock"),"math/inverse":dy("FlowGraphInvertMatrixBlock"),"math/matmul":dy("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{cM:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"dX",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r,Y){const mt=r[0].dataInputs.find((t=>"rotationQuaternion"===t.name));if(!mt)throw new Error("Rotation quaternion input not found");return Y._connectionValues[mt.uniqueId]&&(Y._connectionValues[mt.uniqueId].type="Quaternion"),r}},"math/matDecompose":{cM:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"dX"}}}},"math/quatConjugate":dy("FlowGraphConjugateBlock",["a"]),"math/quatMul":{cM:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r){var Y;return(Y=r[0]).config||(Y.config={}),r[0].config.type="Quaternion",r}},"math/quatAngleBetween":dy("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{cM:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":dy("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":dy("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{cM:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r){var Y;return(Y=r[0]).config||(Y.config={}),r[0].config.inputIsColumnMajor=!0,r}},"math/extract2x2":{cM:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{cM:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r){var Y;return(Y=r[0]).config||(Y.config={}),r[0].config.inputIsColumnMajor=!0,r}},"math/extract3x3":{cM:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{cM:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r){var Y;return(Y=r[0]).config||(Y.config={}),r[0].config.inputIsColumnMajor=!0,r}},"math/extract4x4":{cM:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{cM:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r,Y){var mt,X;(X=r[0]).config||(X.config={});const P=r[0].dataInputs[0];return r[0].config.valueType=(null===(mt=Y._connectionValues[P.uniqueId])||void 0===mt?void 0:mt.type)??"FlowGraphInteger",r}},"math/and":{cM:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r,Y){var mt,X,P;(P=r[0]).config||(P.config={});const G=r[0].dataInputs[0],M=r[0].dataInputs[1];return r[0].config.valueType=(null===(mt=Y._connectionValues[G.uniqueId])||void 0===mt?void 0:mt.type)??(null===(X=Y._connectionValues[M.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",r}},"math/or":{cM:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r,Y){var mt,X,P;(P=r[0]).config||(P.config={});const G=r[0].dataInputs[0],M=r[0].dataInputs[1];return r[0].config.valueType=(null===(mt=Y._connectionValues[G.uniqueId])||void 0===mt?void 0:mt.type)??(null===(X=Y._connectionValues[M.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",r}},"math/xor":{cM:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,U,y,I,r,Y){var mt,X,P;(P=r[0]).config||(P.config={});const G=r[0].dataInputs[0],M=r[0].dataInputs[1];return r[0].config.valueType=(null===(mt=Y._connectionValues[G.uniqueId])||void 0===mt?void 0:mt.type)??(null===(X=Y._connectionValues[M.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",r}},"math/asr":dy("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":dy("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":dy("FlowGraphLeadingZerosBlock"),"math/ctz":dy("FlowGraphTrailingZerosBlock"),"math/popcnt":dy("FlowGraphOneBitsCounterBlock"),"math/rad":dy("FlowGraphDegToRadBlock"),"math/deg":dy("FlowGraphRadToDegBlock"),"type/boolToInt":dy("FlowGraphBooleanToInt"),"type/boolToFloat":dy("FlowGraphBooleanToFloat"),"type/intToBool":dy("FlowGraphIntToBoolean"),"type/intToFloat":dy("FlowGraphIntToFloat"),"type/floatToInt":dy("FlowGraphFloatToInt"),"type/floatToBool":dy("FlowGraphFloatToBoolean"),"flow/sequence":{cM:["FlowGraphSequenceBlock"],extraProcessor(t,U,y,I,r){const Y=r[0];return Y.config||(Y.config={}),Y.config.outputSignalCount=Object.keys(t.flows||[]).length,Y.signalOutputs.forEach(((t,U)=>{t.name="out_"+U})),r}},"flow/branch":{cM:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{cM:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(t){if(t.configuration&&t.configuration.cases){const U=t.configuration.cases.value;if(!U.every((t=>"number"===typeof t&&/^-?\d+$/.test(t.toString()))))return E.b.Warn("Switch cases should be integers. Using empty array instead."),t.configuration.cases.value=[],{valid:!0};const y=new Set(U);t.configuration.cases.value=Array.from(y)}return{valid:!0}},extraProcessor(t,U,y,I,r){if("flow/switch"!==U.op||!t.flows||0===Object.keys(t.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return r[0].signalOutputs.forEach((t=>{"default"!==t.name&&(t.name="out_"+t.name)})),r}},"flow/while":{cM:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{cM:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(t,U,y,I,r){const Y=r[0];return Y.config||(Y.config={}),Y.config.incrementIndexWhenLoopDone=!0,r}},"flow/doN":{cM:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{cM:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(t,U,y,I,r){if("flow/multiGate"!==U.op||!t.flows||0===Object.keys(t.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Y=r[0];return Y.config||(Y.config={}),Y.config.outputSignalCount=Object.keys(t.flows).length,Y.signalOutputs.forEach(((t,U)=>{t.name="out_"+U})),r}},"flow/waitAll":{cM:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(t){var U,y;return"number"!==typeof(null===(U=t.configuration)||void 0===U||null===(y=U.inputFlows)||void 0===y?void 0:y.value[0])&&(t.configuration=t.configuration||{inputFlows:{value:[0]}},t.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{cM:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{cM:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{cM:["FlowGraphCancelDelayBlock"]},"variable/get":{cM:["FlowGraphGetVariableBlock"],validation(t){var U,y;return null!==(U=t.configuration)&&void 0!==U&&null!==(y=U.variable)&&void 0!==y&&y.value?{valid:!0}:(E.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(t,U)=>[U.getVariableName(t[0])]}}},"variable/set":{cM:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(t,U)=>[U.getVariableName(t[0])]}}},"variable/setMultiple":{cM:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(t,U)=>[t[0].map((t=>U.getVariableName(t)))]}},extraProcessor:(t,U,y,I,r)=>(r[0].dataInputs.forEach((t=>{t.name=I.getVariableName(+t.name)})),r)},"variable/interpolate":{cM:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(t,U)=>[U.getVariableName(t[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:t=>!0===t[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",jy:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",jy:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",jy:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",jy:"FlowGraphPlayAnimationBlock"},out:{name:"out",jy:"FlowGraphPlayAnimationBlock"},done:{name:"done",jy:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(t,U,y,I,r){var Y,mt,X;const P=r[0],G=null===(Y=t.configuration)||void 0===Y?void 0:Y.variable.value[0];if("number"!==typeof G)throw E.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const M=I.arrays.staticVariables[G];"undefined"===typeof P.config.animationType.value&&(I.arrays.staticVariables,P.config.animationType.value=(0,gy.M)(M.type));const L=r[4];return L.config||(L.config={}),(mt=L.config).variable||(mt.variable={}),L.config.variable.value=I.getVariableName(G),(X=r[3]).config||(X.config={}),r}},"pointer/get":{cM:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",jy:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",jy:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,U,y,I,r)=>(r.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className&&(t.config||(t.config={}),t.config.outputValue=!0)})),r)},"pointer/set":{cM:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",jy:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",jy:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,U,y,I,r)=>(r.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className&&(t.config||(t.config={}),t.config.outputValue=!0)})),r)},"pointer/interpolate":{cM:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",jy:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",jy:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",jy:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",jy:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",jy:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",jy:"FlowGraphPlayAnimationBlock"},out:{name:"out",jy:"FlowGraphPlayAnimationBlock"},done:{name:"done",jy:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,U,y,I,r)=>(r.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className?(U.config||(U.config={}),U.config.outputValue=!0):"FlowGraphInterpolationBlock"===U.className&&(U.config||(U.config={}),Object.keys(t.values||[]).forEach((y=>{var r;const Y=null===(r=t.values)||void 0===r?void 0:r[y];if("value"===y&&Y){const t=Y.type;void 0!==t&&(U.config.animationType=I.arrays.types[t].flowGraphType)}})))})),r)},"animation/start":{cM:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",jy:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(t,U)=>[t[0]*U._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(t,U)=>[t[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,U,y,I,r,Y,mt){const X=r[r.length-1];return X.config||(X.config={}),X.config.glTF=mt,r}},"animation/stop":{cM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",jy:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,U,y,I,r,Y,mt){const X=r[r.length-1];return X.config||(X.config={}),X.config.glTF=mt,r}},"animation/stopAt":{cM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",jy:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(t,U)=>[t[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,U,y,I,r,Y,mt){const X=r[r.length-1];return X.config||(X.config={}),X.config.glTF=mt,r}},"math/switch":{cM:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(t){if(t.configuration&&t.configuration.cases){const U=t.configuration.cases.value;if(!U.every((t=>"number"===typeof t&&/^-?\d+$/.test(t.toString()))))return E.b.Warn("Switch cases should be integers. Using empty array instead."),t.configuration.cases.value=[],{valid:!0};const y=new Set(U);t.configuration.cases.value=Array.from(y)}return{valid:!0}},extraProcessor(t,U,y,I,r){const Y=r[0];return Y.dataInputs.forEach((t=>{"default"!==t.name&&"case"!==t.name&&(t.name="in_"+t.name)})),Y.config||(Y.config={}),Y.config.treatCasesAsIntegers=!0,r}},"debug/log":{cM:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function dy(t){let U=arguments.length>2?arguments[2]:void 0;return{cM:[t],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((t,U)=>(t[U]={name:U},t)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(t,y,I,r,Y){var mt;if(U){(mt=Y[0]).config||(mt.config={}),Y[0].config.preventIntegerFloatArithmetic=!0;let U=-1;Object.keys(t.values||{}).find((y=>{var I;return void 0!==(null===(I=t.values)||void 0===I?void 0:I[y].type)&&(U=t.values[y].type,!0)})),-1!==U&&(Y[0].config.type=r.arrays.types[U].flowGraphType)}return Y},validation:t=>U?qy(t):{valid:!0}}}function qy(t){if(t.values){const U=Object.keys(t.values).map((U=>t.values[U].type)).filter((t=>void 0!==t));if(!U.every((t=>t===U[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}ay["math/compose"]=ay["math/matCompose"],ay["math/decompose"]=ay["math/matDecompose"];var Hy=y(12341);const ey={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"DU",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class oy{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=t,this._gltf=U,this._animationTargetFps=y,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const t of this._interactivityGraph.types)this._types.push(ey[t.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const t of this._interactivityGraph.declarations){const U=Ny(t);if(!U)throw E.b.Error(["No mapping found for declaration",t]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:U,fullOperationName:t.extension?t.op+":"+t.extension:t.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const t of this._interactivityGraph.variables){const U=this._parseVariable(t);this._staticVariables.push(U)}}_parseVariable(t,U){const y=this._types[t.type];if(!y)throw E.b.Error(["No type found for variable",t]),new Error("Error parsing variables");if(t.value&&t.value.length!==y.length)throw E.b.Error(["Invalid value length for variable",t,y]),new Error("Error parsing variables");const I=t.value||[];if(!I.length)switch(y.flowGraphType){case"boolean":I.push(!1);break;case"FlowGraphInteger":I.push(0);break;case"number":I.push(NaN);break;case"Vector2":I.push(NaN,NaN);break;case"DU":I.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":I.fill(NaN,0,4);break;case"Matrix":I.fill(NaN,0,16);break;case"Matrix3D":I.fill(NaN,0,9)}return"number"===y.elementType&&"string"===typeof I[0]&&(I[0]=parseFloat(I[0])),{type:y.flowGraphType,value:U?U(I,this):I}}_parseEvents(){if(this._interactivityGraph.events)for(const t of this._interactivityGraph.events){const U={eventId:t.id||"internalEvent_"+this._internalEventsCounter++};t.values&&(U.eventData=Object.keys(t.values).map((U=>{var y;const I=null===(y=t.values)||void 0===y?void 0:y[U];if(!I)throw E.b.Error(["No value found for event key",U]),new Error("Error parsing events");const r=this._types[I.type];if(!r)throw E.b.Error(["No type found for event value",I]),new Error("Error parsing events");const Y="undefined"!==typeof I.value?this._parseVariable(I):void 0;return{id:U,type:r.flowGraphType,eventData:!0,value:Y}}))),this._events.push(U)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const U of this._interactivityGraph.nodes){if("number"!==typeof U.declaration)throw E.b.Error(["No declaration found for node",U]),new Error("Error parsing nodes");const y=this._mappings[U.declaration];if(!y)throw E.b.Error(["No mapping found for node",U]),new Error("Error parsing nodes");if(y.flowGraphMapping.validation){const I=y.flowGraphMapping.validation(U,this._interactivityGraph,this._gltf);var t;if(!I.valid)throw new Error(`Error validating interactivity node ${null===(t=this._interactivityGraph.declarations)||void 0===t?void 0:t[U.declaration].op} - ${I.error}`)}const I=[];for(const t of y.flowGraphMapping.cM){const r=this._getEmptyBlock(t,y.fullOperationName);this._parseNodeConfiguration(U,r,y.flowGraphMapping,t),I.push(r)}this._nodes.push({cM:I,fullOperationName:y.fullOperationName})}}_getEmptyBlock(t,U){return{uniqueId:(0,Hy.b)(),className:t,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:U,metadata:{}}}_parseNodeConfiguration(t,U,y,I){const r=U.config;if(t.configuration){const U=Object.keys(t.configuration);for(const X of U){var Y,mt;const U=null===(Y=t.configuration)||void 0===Y?void 0:Y[X];if(!U)throw E.b.Error(["No value found for node configuration",X]),new Error("Error parsing node configuration");const P=null===(mt=y.configuration)||void 0===mt?void 0:mt[X];if(P&&P.jy?P.jy===I:0===y.cM.indexOf(I)){const t=(null===P||void 0===P?void 0:P.name)||X;U&&"undefined"!==typeof U.value||"undefined"===typeof(null===P||void 0===P?void 0:P.defaultValue)?U.value.length>=0?r[t]={value:1===U.value.length?U.value[0]:U.value}:E.b.Warn(["Invalid value for node configuration",U]):r[t]={value:P.defaultValue},P&&P.dataTransformer&&(r[t].value=P.dataTransformer([r[t].value],this)[0])}}}}_parseNodeConnections(t){for(let p=0;p<this._nodes.length;p++){var U;const c=null===(U=this._interactivityGraph.nodes)||void 0===U?void 0:U[p];if(!c)throw E.b.Error(["No node found for interactivity node",this._nodes[p]]),new Error("Error parsing node connections");const f=this._nodes[p],S=this._mappings[c.declaration];if(!S)throw E.b.Error(["No mapping found for node",c]),new Error("Error parsing node connections");const N=c.flows||{},j=Object.keys(N).sort();for(const t of j){var y,I,r,Y;const U=N[t],G=null===(y=S.flowGraphMapping.outputs)||void 0===y||null===(I=y.flows)||void 0===I?void 0:I[t],M=(null===G||void 0===G?void 0:G.name)||t,L=this._createNewSocketConnection(M,!0);(G&&G.jy&&f.cM.find((t=>t.className===G.jy))||f.cM[0]).signalOutputs.push(L);const h=U.node,Q=this._nodes[h];if(!Q)throw E.b.Error(["No node found for input node id",h]),new Error("Error parsing node connections");const F=Sy(Q.fullOperationName);if(!F)throw E.b.Error(["No mapping found for input node",Q]),new Error("Error parsing node connections");let w=null===(r=F.inputs)||void 0===r||null===(Y=r.flows)||void 0===Y?void 0:Y[U.socket||"in"],D=!1;if(!w)for(const t in null===(mt=F.inputs)||void 0===mt?void 0:mt.flows){var mt,X,P;if(t.startsWith("[")&&t.endsWith("]"))D=!0,w=null===(X=F.inputs)||void 0===X||null===(P=X.flows)||void 0===P?void 0:P[t]}const l=w?D?w.name.replace("$1",U.socket||""):w.name:U.socket||"in",g=w&&w.jy&&Q.cM.find((t=>t.className===w.jy))||Q.cM[0];let B=g.signalInputs.find((t=>t.name===l));B||(B=this._createNewSocketConnection(l),g.signalInputs.push(B)),B.connectedPointIds.push(L.uniqueId),L.connectedPointIds.push(B.uniqueId)}const J=c.values||{},a=Object.keys(J);for(const U of a){var G,M;const y=J[U];let I=null===(G=S.flowGraphMapping.inputs)||void 0===G||null===(M=G.values)||void 0===M?void 0:M[U],r=!1;if(!I)for(const t in null===(L=S.flowGraphMapping.inputs)||void 0===L?void 0:L.values){var L,h,Q;if(t.startsWith("[")&&t.endsWith("]"))r=!0,I=null===(h=S.flowGraphMapping.inputs)||void 0===h||null===(Q=h.values)||void 0===Q?void 0:Q[t]}const Y=I?r?I.name.replace("$1",U):I.name:U,mt=this._createNewSocketConnection(Y);if((I&&I.jy&&f.cM.find((t=>t.className===I.jy))||f.cM[0]).dataInputs.push(mt),void 0!==y.value){const U=this._parseVariable(y,I&&I.dataTransformer);t._connectionValues[mt.uniqueId]=U}else{if("undefined"===typeof y.node)throw E.b.Error(["Invalid value for value connection",y]),new Error("Error parsing node connections");{var F,w,D;const t=y.node,U=y.socket||"value",I=this._nodes[t];if(!I)throw E.b.Error(["No node found for output socket reference",y]),new Error("Error parsing node connections");const r=Sy(I.fullOperationName);if(!r)throw E.b.Error(["No mapping found for output socket reference",y]),new Error("Error parsing node connections");let Y=null===(F=r.outputs)||void 0===F||null===(w=F.values)||void 0===w?void 0:w[U],X=!1;if(!Y)for(const y in null===(l=r.outputs)||void 0===l?void 0:l.values){var l,g,B;if(y.startsWith("[")&&y.endsWith("]"))X=!0,Y=null===(g=r.outputs)||void 0===g||null===(B=g.values)||void 0===B?void 0:B[y]}const P=Y?X?Y.name.replace("$1",U):null===(D=Y)||void 0===D?void 0:D.name:U,G=Y&&Y.jy&&I.cM.find((t=>t.className===Y.jy))||I.cM[0];let M=G.dataOutputs.find((t=>t.name===P));M||(M=this._createNewSocketConnection(P,!0),G.dataOutputs.push(M)),mt.connectedPointIds.push(M.uniqueId),M.connectedPointIds.push(mt.uniqueId)}}}if(S.flowGraphMapping.interBlockConnectors)for(const t of S.flowGraphMapping.interBlockConnectors){const U=t.input,y=t.output,I=t.isVariable;this._connectFlowGraphNodes(U,y,f.cM[t.inputBlockIndex],f.cM[t.outputBlockIndex],I)}if(S.flowGraphMapping.extraProcessor){var b;const U=null===(b=this._interactivityGraph.declarations)||void 0===b?void 0:b[c.declaration];if(!U)throw E.b.Error(["No declaration found for extra processor",c]),new Error("Error parsing node connections");f.cM=S.flowGraphMapping.extraProcessor(c,U,S.flowGraphMapping,this,f.cM,t,this._gltf)}}}_createNewSocketConnection(t,U){return{uniqueId:(0,Hy.b)(),name:t,_connectionType:U?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(t,U,y,I,r){const Y=r?y.dataInputs:y.signalInputs,mt=r?I.dataOutputs:I.signalOutputs,X=Y.find((U=>U.name===t))||this._createNewSocketConnection(t),P=mt.find((t=>t.name===U))||this._createNewSocketConnection(U,!0);Y.find((U=>U.name===t))||Y.push(X),mt.find((t=>t.name===U))||mt.push(P),X.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(X.uniqueId)}getVariableName(t){return"staticVariable_"+t}serializeToFlowGraph(){const t={uniqueId:(0,Hy.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(t);for(let U=0;U<this._staticVariables.length;U++){const y=this._staticVariables[U];t._userVariables[this.getVariableName(U)]=y}return{rightHanded:!0,allBlocks:this._nodes.reduce(((t,U)=>t.concat(U.cM)),[]),executionContexts:[t]}}}const Vy="KHR_interactivity";class ny{constructor(t){this._loader=t,this.name=Vy,this.enabled=this._loader.isExtensionUsed(Vy),this._pathConverter=(0,i.g)(this._loader.lX),t._skipStartAnimationStep=!0;const U=t.babylonScene;U&&function(t){(0,i.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!t.activeCamera)return new r.Quaternion(NaN,NaN,NaN,NaN);const U=r.Quaternion.FromRotationMatrix(t.activeCamera.getWorldMatrix()).normalize();return t.useRightHandedSystem||(U.w*=-1,U.x*=-1),U},type:"Quaternion",getTarget:()=>t.activeCamera}),(0,i.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!t.activeCamera)return new r.DU(NaN,NaN,NaN);const U=t.activeCamera.getWorldMatrix().getTranslation();return t.useRightHandedSystem||(U.x*=-1),U},type:"DU",getTarget:()=>t.activeCamera}),(0,i.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:t=>{var U;return(null===(U=t._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)??!1},type:"boolean",getTarget:t=>t._babylonAnimationGroup}),(0,i.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:t=>{var U;return((null===(U=t._babylonAnimationGroup)||void 0===U?void 0:U.from)??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,i.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:t=>{var U;return((null===(U=t._babylonAnimationGroup)||void 0===U?void 0:U.to)??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,i.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:t=>{var U;return((null===(U=t._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,i.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:t=>{var U;return((null===(U=t._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup})}(U)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var t;if(!this._loader.babylonScene||!this._pathConverter)return;const U=this._loader.babylonScene,y=null===(t=this._loader.lX.extensions)||void 0===t?void 0:t.KHR_interactivity;if(!y)return;const I=new Fy.e({gU:U});I.dispatchEventsSynchronously=!1;const r=y.graphs.map((t=>new oy(t,this._loader.lX,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(r.map((async t=>await py(t,{coordinator:I,pathConverter:this._pathConverter})))),I.start()}}var iy;iy=async()=>(await Promise.resolve().then(y.bind(y,13908))).FlowGraphGLTFDataProvider,Ey[`${Vy}/${"FlowGraphGLTFDataProvider"}`]=iy,n(Vy),V(Vy,!0,(t=>new ny(t)));const vy="KHR_node_visibility";(0,i.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:t=>{const U=t._babylonTransformNode;return!U||void 0===U.isVisible||U.isVisible},set:(t,U)=>{var y,I;null===(y=U._primitiveBabylonMeshes)||void 0===y||y.forEach((t=>{t.inheritVisibility=!0})),U._babylonTransformNode&&(U._babylonTransformNode.isVisible=t),null===(I=U._primitiveBabylonMeshes)||void 0===I||I.forEach((U=>{U.isVisible=t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Oy{constructor(t){this.name=vy,this._loader=t,this.enabled=t.isExtensionUsed(vy)}async onReady(){var t;null===(t=this._loader.lX.nodes)||void 0===t||t.forEach((t=>{var U,y,I,r;(null===(U=t._primitiveBabylonMeshes)||void 0===U||U.forEach((t=>{t.inheritVisibility=!0})),null!==(y=t.extensions)&&void 0!==y&&y.KHR_node_visibility)&&(!1===(null===(I=t.extensions)||void 0===I?void 0:I.KHR_node_visibility.visible)&&(t._babylonTransformNode&&(t._babylonTransformNode.isVisible=!1),null===(r=t._primitiveBabylonMeshes)||void 0===r||r.forEach((t=>{t.isVisible=!1}))))}))}dispose(){this._loader=null}}n(vy),V(vy,!0,(t=>new Oy(t)));const ky="KHR_node_selectability";jy("event/onSelect",ky,{cM:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",jy:"FlowGraphGetVariableBlock",dataTransformer:t=>["pickedMesh_"+t[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",jy:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,U,y,I,r,Y,mt){var X,P,G,M,L,h;const Q=r[r.length-1];Q.config=Q.config||{},Q.config.glTF=mt;const F=null===(X=t.configuration)||void 0===X||null===(P=X.nodeIndex)||void 0===P?void 0:P.value[0];if(void 0===F||"number"!==typeof F)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+F;return r[1].config.variable=E,Y._userVariables[E]={className:"Mesh",id:null===mt||void 0===mt||null===(G=mt.nodes)||void 0===G||null===(M=G[F]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===mt||void 0===mt||null===(L=mt.nodes)||void 0===L||null===(h=L[F]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},r}}),(0,i.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:t=>{const U=t._babylonTransformNode;return!U||void 0===U.KP||U.KP},set:(t,U)=>{var y;null===(y=U._primitiveBabylonMeshes)||void 0===y||y.forEach((U=>{U.KP=t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"KP"],type:"boolean"});class sy{constructor(t){this.name=ky,this._loader=t,this.enabled=t.isExtensionUsed(ky)}async onReady(){var t;null===(t=this._loader.lX.nodes)||void 0===t||t.forEach((t=>{var U,y,I;null!==(U=t.extensions)&&void 0!==U&&U.KHR_node_selectability&&!1===(null===(y=t.extensions)||void 0===y?void 0:y.KHR_node_selectability.selectable)&&(null===(I=t._babylonTransformNode)||void 0===I||I.getChildMeshes().forEach((t=>{t.KP=!1})))}))}dispose(){this._loader=null}}n(ky),V(ky,!0,(t=>new sy(t)));const xy="KHR_node_hoverability",Zy="targetMeshPointerOver_";jy("event/onHoverIn",xy,{cM:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",jy:"FlowGraphGetVariableBlock",dataTransformer:t=>[Zy+t[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",jy:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,U,y,I,r,Y,mt){var X,P,G,M,L,h;const Q=r[r.length-1];Q.config=Q.config||{},Q.config.glTF=mt;const F=null===(X=t.configuration)||void 0===X||null===(P=X.nodeIndex)||void 0===P?void 0:P.value[0];if(void 0===F||"number"!==typeof F)throw new Error("nodeIndex not found in configuration");const E=Zy+F;return r[1].config.variable=E,Y._userVariables[E]={className:"Mesh",id:null===mt||void 0===mt||null===(G=mt.nodes)||void 0===G||null===(M=G[F]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===mt||void 0===mt||null===(L=mt.nodes)||void 0===L||null===(h=L[F]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},r}});const Wy="targetMeshPointerOut_";jy("event/onHoverOut",xy,{cM:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",jy:"FlowGraphGetVariableBlock",dataTransformer:t=>[Wy+t[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",jy:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,U,y,I,r,Y,mt){var X,P,G,M,L,h;const Q=r[r.length-1];Q.config=Q.config||{},Q.config.glTF=mt;const F=null===(X=t.configuration)||void 0===X||null===(P=X.nodeIndex)||void 0===P?void 0:P.value[0];if(void 0===F||"number"!==typeof F)throw new Error("nodeIndex not found in configuration");const E=Wy+F;return r[1].config.variable=E,Y._userVariables[E]={className:"Mesh",id:null===mt||void 0===mt||null===(G=mt.nodes)||void 0===G||null===(M=G[F]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===mt||void 0===mt||null===(L=mt.nodes)||void 0===L||null===(h=L[F]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},r}}),(0,i.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:t=>{const U=t._babylonTransformNode;return!U||void 0===U.pointerOverDisableMeshTesting||U.pointerOverDisableMeshTesting},set:(t,U)=>{var y;null===(y=U._primitiveBabylonMeshes)||void 0===y||y.forEach((U=>{U.pointerOverDisableMeshTesting=!t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Ay{constructor(t){this.name=xy,this._loader=t,this.enabled=t.isExtensionUsed(xy)}async onReady(){var t;null===(t=this._loader.lX.nodes)||void 0===t||t.forEach((t=>{var U,y,I;null!==(U=t.extensions)&&void 0!==U&&U.KHR_node_hoverability&&!1===(null===(y=t.extensions)||void 0===y?void 0:y.KHR_node_hoverability.hoverable)&&(null===(I=t._babylonTransformNode)||void 0===I||I.getChildMeshes().forEach((t=>{t.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}n(xy),V(xy,!0,(t=>new Ay(t)));const Ky="ExtrasAsMetadata";class Cy{_assignExtras(t,U){if(U.extras&&Object.keys(U.extras).length>0){const y=t.metadata=t.metadata||{};(y.lX=y.lX||{}).extras=U.extras}}constructor(t){this.name=Ky,this.enabled=!0,this._loader=t}dispose(){this._loader=null}loadNodeAsync(t,U,y){return this._loader.loadNodeAsync(t,U,(t=>{this._assignExtras(t,U),y(t)}))}loadCameraAsync(t,U,y){return this._loader.loadCameraAsync(t,U,(t=>{this._assignExtras(t,U),y(t)}))}createMaterial(t,U,y){const I=this._loader.createMaterial(t,U,y);return this._assignExtras(I,U),I}}n(Ky),V(Ky,!1,(t=>new Cy(t)));y(13908)},13779:(t,U,y)=>{"use strict";y.d(U,{e:()=>q,f:()=>S,h:()=>f,j:()=>N});var I=y(12204),r=y(12198),Y=y(13435),mt=y(12868),X=y(12831),P=y(12844),G=y(12221),M=y(12250),L=y(12864),h=y(12978),Q=y(12876),F=y(12434);class E{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.mQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.YQ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(t){this._environmentTexture=t}getNodes(){let t=[];t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes);for(const U of this.skeletons)t=t.concat(U.bones);return t}}class w extends E{}class D{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const t=this.rootNodes;for(const I of t)I.dispose();t.length=0;const U=this.skeletons;for(const I of U)I.dispose();U.length=0;const y=this.animationGroups;for(const I of y)I.dispose();y.length=0}}class l extends E{constructor(t){super(),this._wasAddedToScene=!1,(t=t||M.d.LastCreatedScene)&&(this.gU=t,this.proceduralTextures=[],t.FX.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=t.getEngine().onContextRestoredObservable.add((()=>{for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();for(const t of this.mQ)t.rebuild();for(const t of this.textures)t._rebuild()})))}_topologicalSort(t){const U=new Map;for(const mt of t)U.set(mt.uniqueId,mt);const y={dependsOn:new Map,dependedBy:new Map};for(const mt of t){const t=mt.uniqueId;y.dependsOn.set(t,new Set),y.dependedBy.set(t,new Set)}for(const mt of t){const t=mt.uniqueId,I=y.dependsOn.get(t);if(mt instanceof L.c){const r=mt.sourceMesh;U.has(r.uniqueId)&&(I.add(r.uniqueId),y.dependedBy.get(r.uniqueId).add(t))}const r=y.dependedBy.get(t);for(const Y of mt.getDescendants()){const I=Y.uniqueId;if(U.has(I)){r.add(I);y.dependsOn.get(I).add(t)}}}const I=[],r=[];for(const mt of t){const t=mt.uniqueId;0===y.dependsOn.get(t).size&&(r.push(mt),U.delete(t))}const Y=r;for(;Y.length>0;){const t=Y.shift();I.push(t);const r=y.dependedBy.get(t.uniqueId);for(const I of Array.from(r.values())){const r=y.dependsOn.get(I);r.delete(t.uniqueId),0===r.size&&U.get(I)&&(Y.push(U.get(I)),U.delete(I))}}return U.size>0&&(G.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),U.forEach((t=>{G.b.Error(t.name)}))),I}_addNodeAndDescendantsToList(t,U,y,I){if(y&&(!I||I(y))&&!U.has(y.uniqueId)){t.push(y),U.add(y.uniqueId);for(const r of y.getDescendants(!0))this._addNodeAndDescendantsToList(t,U,r,I)}}_isNodeInContainer(t){return t instanceof P.c&&-1!==this.meshes.indexOf(t)||(t instanceof X.d&&-1!==this.transformNodes.indexOf(t)||(t instanceof h.c&&-1!==this.lights.indexOf(t)||t instanceof Q.e&&-1!==this.cameras.indexOf(t)))}_isValidHierarchy(){for(const t of this.meshes)if(t.parent&&!this._isNodeInContainer(t.parent))return G.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.transformNodes)if(t.parent&&!this._isNodeInContainer(t.parent))return G.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.lights)if(t.parent&&!this._isNodeInContainer(t.parent))return G.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.cameras)if(t.parent&&!this._isNodeInContainer(t.parent))return G.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||r.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const I={},Y={},X=new D,P=[],G=[],M={doNotInstantiate:!0,...y},L=[],h=new Set;for(const r of this.transformNodes)null===r.parent&&this._addNodeAndDescendantsToList(L,h,r,M.predicate);for(const r of this.meshes)null===r.parent&&this._addNodeAndDescendantsToList(L,h,r,M.predicate);const Q=this._topologicalSort(L),F=(y,r)=>{if(((U,y)=>{if(I[U.uniqueId]=y.uniqueId,Y[y.uniqueId]=y,t&&(y.name=t(U.name)),y instanceof mt.c){const t=y;if(t.morphTargetManager){const y=U.morphTargetManager;t.morphTargetManager=y.clone();for(let U=0;U<y.numTargets;U++){const r=y.getTarget(U),mt=t.morphTargetManager.getTarget(U);I[r.uniqueId]=mt.uniqueId,Y[mt.uniqueId]=mt}}}})(y,r),y.parent){const t=I[y.parent.uniqueId],U=Y[t];r.parent=U||y.parent}if(r.position&&y.position&&r.position.Y(y.position),r.rotationQuaternion&&y.rotationQuaternion&&r.rotationQuaternion.Y(y.rotationQuaternion),r.rotation&&y.rotation&&r.rotation.Y(y.rotation),r.dX&&y.dX&&r.dX.Y(y.dX),r.material){const mt=r;if(mt.material)if(U){const U=y.material;if(-1===G.indexOf(U)){let y=U.clone(t?t(U.name):"Clone of "+U.name);if(G.push(U),I[U.uniqueId]=y.uniqueId,Y[y.uniqueId]=y,"MultiMaterial"===U.getClassName()){const r=U;for(const U of r.eX)U&&(y=U.clone(t?t(U.name):"Clone of "+U.name),G.push(U),I[U.uniqueId]=y.uniqueId,Y[y.uniqueId]=y);r.eX=r.eX.map((t=>t&&Y[I[t.uniqueId]]))}}"InstancedMesh"!==mt.getClassName()&&(mt.material=Y[I[U.uniqueId]])}else"MultiMaterial"===mt.material.getClassName()?-1===this.gU.multiMaterials.indexOf(mt.material)&&this.gU.addMultiMaterial(mt.material):-1===this.gU.materials.indexOf(mt.material)&&this.gU.addMaterial(mt.material)}null===r.parent&&X.rootNodes.push(r)};for(const r of Q)if("InstancedMesh"===r.getClassName()){const t=r,U=t.sourceMesh,y=I[U.uniqueId];F(t,("number"===typeof y?Y[y]:U).createInstance(t.name))}else{let t=!0;"Ph"===r.getClassName()||"Node"===r.getClassName()||r.skeleton||!r.getTotalVertices||0===r.getTotalVertices()?t=!1:M.doNotInstantiate&&(t="function"===typeof M.doNotInstantiate?!M.doNotInstantiate(r):!M.doNotInstantiate);const U=t?r.createInstance(`instance of ${r.name}`):r.clone(`Clone of ${r.name}`,null,!0);if(!U)throw new Error(`Could not clone or instantiate node on Asset Container ${r.name}`);F(r,U)}for(const r of this.skeletons){if(M.predicate&&!M.predicate(r))continue;const U=r.clone(t?t(r.name):"Clone of "+r.name);for(const t of this.meshes)if(t.skeleton===r&&!t.isAnInstance){const y=Y[I[t.uniqueId]];if(!y||y.isAnInstance)continue;if(y.skeleton=U,-1!==P.indexOf(U))continue;P.push(U);for(const t of U.bones)t._linkedTransformNode&&(t._linkedTransformNode=Y[I[t._linkedTransformNode.uniqueId]])}X.skeletons.push(U)}for(const r of this.animationGroups){if(M.predicate&&!M.predicate(r))continue;const U=r.clone(t?t(r.name):"Clone of "+r.name,(t=>Y[I[t.uniqueId]]||t));X.animationGroups.push(U)}return X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||r.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.gU.environmentTexture=this.environmentTexture);for(const t of this.gU._serializableComponents)t.addFromContainer(this);this.gU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=[];for(const y of this.cameras)t&&!t(y)||(this.gU.addCamera(y),U.push(y));for(const y of this.lights)t&&!t(y)||(this.gU.addLight(y),U.push(y));for(const y of this.meshes)t&&!t(y)||(this.gU.LM(y),U.push(y));for(const y of this.skeletons)t&&!t(y)||this.gU.addSkeleton(y);for(const y of this.animations)t&&!t(y)||this.gU.addAnimation(y);for(const y of this.animationGroups)t&&!t(y)||this.gU.addAnimationGroup(y);for(const y of this.multiMaterials)t&&!t(y)||this.gU.addMultiMaterial(y);for(const y of this.materials)t&&!t(y)||this.gU.addMaterial(y);for(const y of this.morphTargetManagers)t&&!t(y)||this.gU.addMorphTargetManager(y);for(const y of this.geometries)t&&!t(y)||this.gU.addGeometry(y);for(const y of this.transformNodes)t&&!t(y)||(this.gU.addTransformNode(y),U.push(y));for(const y of this.actionManagers)t&&!t(y)||this.gU.addActionManager(y);for(const y of this.textures)t&&!t(y)||this.gU.addTexture(y);for(const y of this.reflectionProbes)t&&!t(y)||this.gU.addReflectionProbe(y);for(const y of U)y.parent&&-1===this.gU.getNodes().indexOf(y.parent)&&(y.setParent?y.setParent(null):y.parent=null)}removeAllFromScene(){this._isValidHierarchy()||r.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.gU.environmentTexture&&(this.gU.environmentTexture=null);for(const t of this.gU._serializableComponents)t.removeFromContainer(this)}removeFromScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const U of this.cameras)t&&!t(U)||this.gU.removeCamera(U);for(const U of this.lights)t&&!t(U)||this.gU.removeLight(U);for(const U of this.meshes)t&&!t(U)||this.gU.MM(U,!0);for(const U of this.skeletons)t&&!t(U)||this.gU.removeSkeleton(U);for(const U of this.animations)t&&!t(U)||this.gU.removeAnimation(U);for(const U of this.animationGroups)t&&!t(U)||this.gU.removeAnimationGroup(U);for(const U of this.multiMaterials)t&&!t(U)||this.gU.removeMultiMaterial(U);for(const U of this.materials)t&&!t(U)||this.gU.removeMaterial(U);for(const U of this.morphTargetManagers)t&&!t(U)||this.gU.removeMorphTargetManager(U);for(const U of this.geometries)t&&!t(U)||this.gU.removeGeometry(U);for(const U of this.transformNodes)t&&!t(U)||this.gU.removeTransformNode(U);for(const U of this.actionManagers)t&&!t(U)||this.gU.removeActionManager(U);for(const U of this.textures)t&&!t(U)||this.gU.removeTexture(U);for(const U of this.reflectionProbes)t&&!t(U)||this.gU.removeReflectionProbe(U)}dispose(){const t=this.cameras.slice(0);for(const Q of t)Q.dispose();this.cameras.length=0;const U=this.lights.slice(0);for(const Q of U)Q.dispose();this.lights.length=0;const y=this.meshes.slice(0);for(const Q of y)Q.dispose();this.meshes.length=0;const I=this.skeletons.slice(0);for(const Q of I)Q.dispose();this.skeletons.length=0;const r=this.animationGroups.slice(0);for(const Q of r)Q.dispose();this.animationGroups.length=0;const Y=this.multiMaterials.slice(0);for(const Q of Y)Q.dispose();this.multiMaterials.length=0;const mt=this.materials.slice(0);for(const Q of mt)Q.dispose();this.materials.length=0;const X=this.geometries.slice(0);for(const Q of X)Q.dispose();this.geometries.length=0;const P=this.transformNodes.slice(0);for(const Q of P)Q.dispose();this.transformNodes.length=0;const G=this.actionManagers.slice(0);for(const Q of G)Q.dispose();this.actionManagers.length=0;const M=this.textures.slice(0);for(const Q of M)Q.dispose();this.textures.length=0;const L=this.reflectionProbes.slice(0);for(const Q of L)Q.dispose();this.reflectionProbes.length=0;const h=this.morphTargetManagers.slice(0);for(const Q of h)Q.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Q of this.gU._serializableComponents)Q.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.gU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(t,U,y){if(t&&U)for(const I of t){let t=!0;if(y)for(const U of y)if(I===U){t=!1;break}t&&(U.push(I),I._parentContainer=this)}}moveAllFromScene(t){this._wasAddedToScene=!1,void 0===t&&(t=new w);for(const U in this)Object.prototype.hasOwnProperty.call(this,U)&&(this[U]=this[U]||("_environmentTexture"===U?null:[]),this._moveAssets(this.gU[U],this[U],t[U]));this.environmentTexture=this.gU.environmentTexture,this.removeAllFromScene()}createRootMesh(){const t=new mt.c("assetContainerRootMesh",this.gU);for(const U of this.meshes)U.parent||t.addChild(U);return this.meshes.unshift(t),t}mergeAnimationsTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.d.LastCreatedScene,U=arguments.length>1?arguments[1]:void 0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return G.b.Error("No scene available to merge animations to"),[];const I=y||(U=>{let y=null;const I=U.animations.length?U.animations[0].targetProperty:"",r=U.name.split(".").join("").split("_primitive")[0];switch(I){case"position":case"rotationQuaternion":y=t.getTransformNodeByName(U.name)||t.getTransformNodeByName(r);break;case"influence":y=t.getMorphTargetByName(U.name)||t.getMorphTargetByName(r);break;default:y=t.getNodeByName(U.name)||t.getNodeByName(r)}return y}),r=this.getNodes();for(const X of r){const t=I(X);if(null!==t){for(const U of X.animations){const y=t.animations.filter((t=>t.targetProperty===U.targetProperty));for(const U of y){const y=t.animations.indexOf(U,0);y>-1&&t.animations.splice(y,1)}}t.animations=t.animations.concat(X.animations)}}const Y=[],mt=this.animationGroups.slice();for(const X of mt){Y.push(X.clone(X.name,I));for(const t of X.animatables)t.stop()}for(const X of U){const U=I(X.target);U&&(t.beginAnimation(U,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),t.stopAnimation(X.target))}return Y}populateRootNodes(){this.rootNodes.length=0;for(const t of this.meshes)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.transformNodes)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.lights)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.cameras)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)}addAllAssetsToContainer(t){if(!t)return;const U=[],y=new Set;for(U.push(t);U.length>0;){const t=U.pop();if(t instanceof mt.c?(t.NX&&-1===this.geometries.indexOf(t.NX)&&this.geometries.push(t.NX),this.meshes.push(t)):t instanceof L.c?this.meshes.push(t):t instanceof X.d?this.transformNodes.push(t):t instanceof h.c?this.lights.push(t):t instanceof Q.e&&this.cameras.push(t),t instanceof P.c){if(t.material&&-1===this.materials.indexOf(t.material)){this.materials.push(t.material);for(const U of t.material.getActiveTextures())-1===this.textures.indexOf(U)&&this.textures.push(U)}t.skeleton&&-1===this.skeletons.indexOf(t.skeleton)&&this.skeletons.push(t.skeleton),t.morphTargetManager&&-1===this.morphTargetManagers.indexOf(t.morphTargetManager)&&this.morphTargetManagers.push(t.morphTargetManager)}for(const I of t.getChildren())y.has(I)||U.push(I);y.add(t)}this.populateRootNodes()}_getByTags(t,U,y){if(void 0===U)return t;const I=[];for(const r in t){const Y=t[r];F.d&&F.d.MatchesQuery(Y,U)&&(!y||y(Y))&&I.push(Y)}return I}getMeshesByTags(t,U){return this._getByTags(this.meshes,t,U)}getCamerasByTags(t,U){return this._getByTags(this.cameras,t,U)}getLightsByTags(t,U){return this._getByTags(this.lights,t,U)}getMaterialsByTags(t,U){return this._getByTags(this.materials,t,U).concat(this._getByTags(this.multiMaterials,t,U))}getTransformNodesByTags(t,U){return this._getByTags(this.transformNodes,t,U)}}var g=y(12259);class B{constructor(t){this.byteOffset=0,this.buffer=t}async loadAsync(t){const U=await this.buffer.readAsync(this.byteOffset,t);this._dataView=new DataView(U.buffer,U.byteOffset,U.byteLength),this._dataByteOffset=0}readUint32(){const t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t}readUint8Array(t){const U=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,U}readString(t){return(0,g.h)(this.readUint8Array(t))}skipBytes(t){this._dataByteOffset+=t,this.byteOffset+=t}}var b=y(13783);const p="Z2xURg",c={name:"lX",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:t=>-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+p)||t.startsWith("data:;base64,"+p)||t.startsWith("data:application/octet-stream;base64,"+p)||t.startsWith("data:model/gltf-binary;base64,"+p)};var f,S,N,j=y(12253),J=y(12257);function a(t,U,y){try{return Promise.resolve(new Uint8Array(t,U,y))}catch(I){return Promise.reject(I)}}!function(t){t[t.AUTO=0]="AUTO",t[t.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(f||(f={})),function(t){t[t.NONE=0]="NONE",t[t.FIRST=1]="FIRST",t[t.ALL=2]="ALL"}(S||(S={})),function(t){t[t.LOADING=0]="LOADING",t[t.READY=1]="READY",t[t.COMPLETE=2]="COMPLETE"}(N||(N={}));class d{constructor(){this.coordinateSystemMode=f.AUTO,this.animationStartMode=S.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=t=>Promise.resolve(t),this.extensionOptions={}}Y(t){t&&(this.onParsed=t.onParsed,this.coordinateSystemMode=t.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=t.animationStartMode??this.animationStartMode,this.loadNodeAnimations=t.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=t.loadSkins??this.loadSkins,this.loadMorphTargets=t.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=t.compileMaterials??this.compileMaterials,this.useClipPlane=t.useClipPlane??this.useClipPlane,this.compileShadowGenerators=t.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=t.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=t.useRangeRequests??this.useRangeRequests,this.createInstances=t.createInstances??this.createInstances,this.alwaysComputeBoundingBox=t.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=t.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=t.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=t.skipMaterials??this.skipMaterials,this.useSRGBBuffers=t.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=t.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=t.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=t.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=t.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=t.customRootNode,this.onMeshLoaded=t.onMeshLoaded,this.onSkinLoaded=t.onSkinLoaded,this.onTextureLoaded=t.onTextureLoaded,this.onMaterialLoaded=t.onMaterialLoaded,this.onCameraLoaded=t.onCameraLoaded,this.extensionOptions=t.extensionOptions??this.extensionOptions)}}class q extends d{constructor(t){super(),this.onParsedObservable=new I.b,this.onMeshLoadedObservable=new I.b,this.onSkinLoadedObservable=new I.b,this.onTextureLoadedObservable=new I.b,this.onMaterialLoadedObservable=new I.b,this.onCameraLoadedObservable=new I.b,this.onCompleteObservable=new I.b,this.onErrorObservable=new I.b,this.FX=new I.b,this.onExtensionLoadedObservable=new I.b,this.validate=!1,this.onValidatedObservable=new I.b,this._loader=null,this._state=null,this._requests=new Array,this.name=c.name,this.extensions=c.extensions,this.onLoaderStateChangedObservable=new I.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.Y(t)}set onParsed(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))}set onMeshLoaded(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))}set onSkinLoaded(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((U=>t(U.node,U.skinnedNode))))}set onTextureLoaded(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))}set onMaterialLoaded(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))}set onCameraLoaded(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))}set onComplete(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)}set onError(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)}set onDispose(t){this._onDisposeObserver&&this.FX.remove(this._onDisposeObserver),this._onDisposeObserver=this.FX.add(t)}set onExtensionLoaded(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const t of this._requests)t.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=t=>Promise.resolve(t),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.FX.notifyObservers(void 0),this.FX.clear()}loadFile(t,U,y,Y,mt,X,P,M){if(ArrayBuffer.isView(U))return this._loadBinary(t,U,y,Y,P,M),null;this._progressCallback=mt;const L=U.name||r.Tools.GetFilename(U);if(X){if(this.useRangeRequests){this.validate&&G.b.Warn("glTF validation is not supported when range requests are enabled");const y={abort:()=>{},onCompleteObservable:new I.b},r={readAsync:(y,I)=>new Promise(((r,Y)=>{this._loadFile(t,U,(t=>{r(new Uint8Array(t))}),!0,(t=>{Y(t)}),(t=>{t.setRequestHeader("Range",`bytes=${y}-${y+I-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new B(r)).then((t=>{y.onCompleteObservable.notifyObservers(y),Y(t)}),P?t=>P(void 0,t):void 0),y}return this._loadFile(t,U,(U=>{this._validate(t,new Uint8Array(U,0,U.byteLength),y,L),this._unpackBinaryAsync(new B({readAsync:(t,y)=>a(U,t,y),byteLength:U.byteLength})).then((t=>{Y(t)}),P?t=>P(void 0,t):void 0)}),!0,P)}return this._loadFile(t,U,(U=>{try{this._validate(t,U,y,L),Y({json:this._parseJson(U)})}catch{P&&P()}}),!1,P)}_loadBinary(t,U,y,I,r,Y){this._validate(t,new Uint8Array(U.buffer,U.byteOffset,U.byteLength),y,Y),this._unpackBinaryAsync(new B({readAsync:(t,y)=>function(t,U,y){try{if(U<0||U>=t.byteLength)throw new RangeError("Offset is out of range.");if(U+y>t.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(t.buffer,t.byteOffset+U,y))}catch(I){return Promise.reject(I)}}(U,t,y),byteLength:U.byteLength})).then((t=>{I(t)}),r?t=>r(void 0,t):void 0)}importMeshAsync(t,U,y,I,r,Y){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${Y||""}`),this._loader=this._getLoader(y),this._loader.importMeshAsync(t,U,null,y,I,r,Y))))}loadAsync(t,U,y,I,r){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(U),this._loader.loadAsync(t,U,y,I,r))))}loadAssetContainerAsync(t,U,y,I,r){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(U);const Y=new l(t),mt=[];this.onMaterialLoadedObservable.add((t=>{mt.push(t)}));const X=[];this.onTextureLoadedObservable.add((t=>{X.push(t)}));const P=[];this.onCameraLoadedObservable.add((t=>{P.push(t)}));const G=[];return this.onMeshLoadedObservable.add((t=>{t.morphTargetManager&&G.push(t.morphTargetManager)})),this._loader.importMeshAsync(null,t,Y,U,y,I,r).then((t=>(Array.prototype.push.apply(Y.geometries,t.geometries),Array.prototype.push.apply(Y.meshes,t.meshes),Array.prototype.push.apply(Y.mQ,t.mQ),Array.prototype.push.apply(Y.skeletons,t.skeletons),Array.prototype.push.apply(Y.animationGroups,t.animationGroups),Array.prototype.push.apply(Y.materials,mt),Array.prototype.push.apply(Y.textures,X),Array.prototype.push.apply(Y.lights,t.lights),Array.prototype.push.apply(Y.transformNodes,t.transformNodes),Array.prototype.push.apply(Y.cameras,P),Array.prototype.push.apply(Y.morphTargetManagers,G),Y)))}))}canDirectLoad(t){return c.canDirectLoad(t)}directLoad(t,U){if(U.startsWith("base64,"+p)||U.startsWith(";base64,"+p)||U.startsWith("application/octet-stream;base64,"+p)||U.startsWith("model/gltf-binary;base64,"+p)){const y=(0,j.d)(U);return this._validate(t,new Uint8Array(y,0,y.byteLength)),this._unpackBinaryAsync(new B({readAsync:(t,U)=>a(y,t,U),byteLength:y.byteLength}))}return this._validate(t,U),Promise.resolve({json:this._parseJson(U)})}createPlugin(t){return new q(t[c.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((t,U)=>{this.onCompleteObservable.addOnce((()=>{t()})),this.onErrorObservable.addOnce((t=>{U(t)}))}))}_setState(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(N[this._state]))}_loadFile(t,U,y,I,r,Y){const mt=t._loadFile(U,y,(t=>{this._onProgress(t,mt)}),!0,I,r,Y);return mt.onCompleteObservable.add((()=>{mt._lengthComputable=!0,mt._total=mt._loaded})),this._requests.push(mt),mt}_onProgress(t,U){if(!this._progressCallback)return;U._lengthComputable=t.lengthComputable,U._loaded=t.loaded,U._total=t.total;let y=!0,I=0,r=0;for(const Y of this._requests){if(void 0===Y._lengthComputable||void 0===Y._loaded||void 0===Y._total)return;y=y&&Y._lengthComputable,I+=Y._loaded,r+=Y._total}this._progressCallback({lengthComputable:y,loaded:I,total:y?r:0})}_validate(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),b.b.ValidateAsync(U,y,I,(U=>this.preprocessUrlAsync(y+U).then((U=>t._loadFileAsync(U,void 0,!0,!0).then((t=>new Uint8Array(t,0,t.byteLength))))))).then((t=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(t),this.onValidatedObservable.clear()}),(t=>{this._endPerformanceCounter("Validate JSON"),r.Tools.Warn(`Failed to validate: ${t.message}`),this.onValidatedObservable.clear()})))}_getLoader(t){const U=t.json.asset||{};this._log(`Asset version: ${U.version}`),U.minVersion&&this._log(`Asset minimum version: ${U.minVersion}`),U.generator&&this._log(`Asset generator: ${U.generator}`);const y=q._parseVersion(U.version);if(!y)throw new Error("Invalid version: "+U.version);if(void 0!==U.minVersion){const t=q._parseVersion(U.minVersion);if(!t)throw new Error("Invalid minimum version: "+U.minVersion);if(q._compareVersion(t,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+U.minVersion)}const I={1:q._CreateGLTF1Loader,2:q._CreateGLTF2Loader}[y.major];if(!I)throw new Error("Unsupported version: "+U.version);return I(this)}_parseJson(t){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${t.length}`);const U=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),U}_unpackBinaryAsync(t){return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then((()=>{const U=t.readUint32();if(1179937895!==U)throw new J.k("Unexpected magic: "+U,J.h.GLTFLoaderUnexpectedMagicError);const y=t.readUint32();this.loggingEnabled&&this._log(`Binary version: ${y}`);const I=t.readUint32();let r;switch(this.useRangeRequests||I===t.buffer.byteLength||G.b.Warn(`Length in header does not match actual data length: ${I} != ${t.buffer.byteLength}`),y){case 1:r=this._unpackBinaryV1Async(t,I);break;case 2:r=this._unpackBinaryV2Async(t,I);break;default:throw new Error("Unsupported version: "+y)}return this._endPerformanceCounter("Unpack Binary"),r}))}_unpackBinaryV1Async(t,U){const y=t.readUint32(),I=t.readUint32();if(0!==I)throw new Error(`Unexpected content format: ${I}`);const r=U-t.byteOffset,Y={json:this._parseJson(t.readString(y)),bin:null};if(0!==r){const U=t.byteOffset;Y.bin={readAsync:(y,I)=>t.buffer.readAsync(U+y,I),byteLength:r}}return Promise.resolve(Y)}_unpackBinaryV2Async(t,U){const y=1313821514,I=5130562,r=t.readUint32();if(t.readUint32()!==y)throw new Error("First chunk format is not JSON");return t.byteOffset+r===U?t.loadAsync(r).then((()=>({json:this._parseJson(t.readString(r)),bin:null}))):t.loadAsync(r+8).then((()=>{const Y={json:this._parseJson(t.readString(r)),bin:null},mt=()=>{const r=t.readUint32();switch(t.readUint32()){case y:throw new Error("Unexpected JSON chunk");case I:{const U=t.byteOffset;Y.bin={readAsync:(y,I)=>t.buffer.readAsync(U+y,I),byteLength:r},t.skipBytes(r);break}default:t.skipBytes(r)}return t.byteOffset!==U?t.loadAsync(8).then(mt):Promise.resolve(Y)};return mt()}))}static _parseVersion(t){if("1.0"===t||"1.0.1"===t)return{major:1,minor:0};const U=(t+"").match(/^(\d+)\.(\d+)/);return U?{major:parseInt(U[1]),minor:parseInt(U[2])}:null}static _compareVersion(t,U){return t.major>U.major?1:t.major<U.major?-1:t.minor>U.minor?1:t.minor<U.minor?-1:0}_logOpen(t){this._log(t),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(t){const U=q._logSpaces.substring(0,2*this._logIndentLevel);G.b.Log(`${U}${t}`)}_logDisabled(t){}_startPerformanceCounterEnabled(t){r.Tools.StartPerformanceCounter(t)}_startPerformanceCounterDisabled(t){}_endPerformanceCounterEnabled(t){r.Tools.EndPerformanceCounter(t)}_endPerformanceCounterDisabled(t){}}q.IncrementalLoading=!0,q.HomogeneousCoordinates=!1,q._logSpaces="                                ",(0,Y.c)(new q)},13783:(t,U,y)=>{"use strict";y.d(U,{b:()=>mt});var I=y(12198);function r(t,U,y,I){const r={externalResourceFunction:I};return y&&(r.uri="file:"===U?y:U+y),ArrayBuffer.isView(t)?GLTFValidator.validateBytes(t,r):GLTFValidator.validateString(t,r)}function Y(){const t=[];onmessage=U=>{const y=U.data;switch(y.id){case"init":importScripts(y.url);break;case"validate":r(y.data,y.rootUrl,y.fileName,(U=>new Promise(((y,I)=>{const r=t.length;t.push({resolve:y,reject:I}),postMessage({id:"getExternalResource",index:r,uri:U})})))).then((t=>{postMessage({id:"validate.resolve",value:t})}),(t=>{postMessage({id:"validate.reject",reason:t})}));break;case"getExternalResource.resolve":t[y.index].resolve(y.value);break;case"getExternalResource.reject":t[y.index].reject(y.reason)}}}class mt{static ValidateAsync(t,U,y,mt){return"function"===typeof Worker?new Promise(((X,P)=>{const G=`${r}(${Y})()`,M=URL.createObjectURL(new Blob([G],{type:"application/javascript"})),L=new Worker(M),h=t=>{L.removeEventListener("error",h),L.removeEventListener("message",Q),P(t)},Q=t=>{const U=t.data;switch(U.id){case"getExternalResource":mt(U.uri).then((t=>{L.postMessage({id:"getExternalResource.resolve",index:U.index,value:t},[t.buffer])}),(t=>{L.postMessage({id:"getExternalResource.reject",index:U.index,reason:t})}));break;case"validate.resolve":L.removeEventListener("error",h),L.removeEventListener("message",Q),X(U.value),L.terminate();break;case"validate.reject":L.removeEventListener("error",h),L.removeEventListener("message",Q),P(U.reason),L.terminate()}};if(L.addEventListener("error",h),L.addEventListener("message",Q),L.postMessage({id:"init",url:I.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(t)){const I=t.slice();L.postMessage({id:"validate",data:I,rootUrl:U,fileName:y},[I.buffer])}else L.postMessage({id:"validate",data:t,rootUrl:U,fileName:y})})):(this._LoadScriptPromise||(this._LoadScriptPromise=I.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>r(t,U,y,mt))))}}mt.Configuration={url:`${I.Tools._DefaultCdnUrl}/gltf_validator.js`}},14326:(t,U,y)=>{"use strict";y.d(U,{c:()=>c});var I=y(12366),r=y(12375),Y=y(12426),mt=y(12386),X=y(12800),P=y(12737),G=y(12480),M=y(12653),L=y(12338),h=y(12296);y(13563),y(13464),y(13476),y(13468),y(13482),y(13485),y(13489);const Q="imageProcessingCompatibility",F="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";h.e.IncludesShadersStore[Q]||(h.e.IncludesShadersStore[Q]=F);const E="skyPixelShader",w="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";h.e.ShadersStore[E]||(h.e.ShadersStore[E]=w);y(13576),y(13498),y(13507),y(13519),y(13515);const D="skyVertexShader",l="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.e.ShadersStore[D]||(h.e.ShadersStore[D]=l);var g=y(12731),B=y(12788),b=y(12785);class p extends X.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class c extends P.e{constructor(t,U){super(t,U),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new mt.DU(0,100,0),this.useSunPosition=!1,this.cameraOffset=mt.DU.Zero(),this.up=mt.DU.Up(),this.dithering=!1,this._cameraPosition=mt.DU.Zero(),this._skyOrientation=new mt.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,U){const y=U._drawWrapper;if(this.isFrozen&&y.effect&&y._wasPreviouslyReady)return!0;U.materialDefines||(U.materialDefines=new p);const I=U.materialDefines,r=this.St();if(this._isReadyForSubMesh(U))return!0;if((0,b.S)(t,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,I),(0,b.G)(t,I,!0,!1),I.IMAGEPROCESSINGPOSTPROCESS!==r.imageProcessingConfiguration.applyByPostProcess&&I.markAsMiscDirty(),I.DITHER!==this.dithering&&I.markAsMiscDirty(),I.isDirty){I.markAsProcessed(),r.resetCachedMaterial();const t=new g.b;I.FOG&&t.addFallback(1,"FOG"),I.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess,I.DITHER=this.dithering;const y=[G.e.PositionKind];I.VERTEXCOLOR&&y.push(G.e.ColorKind);const Y="sky",mt=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,B.d)(mt);const X=I.toString();U.setEffect(r.getEngine().createEffect(Y,y,mt,[],X,t,this.onCompiled,this.onError),I,this._materialContext)}return!(!U.effect||!U.effect.isReady())&&(I._renderId=r.getRenderId(),y._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,U,y){const I=this.St(),r=y.materialDefines;if(!r)return;const Y=y.effect;if(!Y)return;this._activeEffect=Y,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",I.getTransformMatrix()),this._mustRebind(I,Y,y)&&((0,B.e)(Y,this,I),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,b.h)(r,Y,I)),I.fogEnabled&&U.applyFog&&I.fogMode!==M.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",I.getViewMatrix()),(0,b.e)(I,U,this._activeEffect);const X=I.activeCamera;if(X){const t=X.getWorldMatrix();this._cameraPosition.x=t.m[12],this._cameraPosition.y=t.m[13],this._cameraPosition.z=t.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const t=Math.PI*(this.inclination-.5),U=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(U)*Math.cos(t),this.sunPosition.y=this.distance*Math.sin(-t),this.sunPosition.z=this.distance*Math.sin(U)*Math.cos(t),mt.Quaternion.FromUnitVectorsToRef(mt.DU.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(U,this._activeEffect,y)}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return Y.b.Clone((()=>new c(t,this.St())),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.SkyMaterial",t}getClassName(){return"SkyMaterial"}static Parse(t,U,y){return Y.b.Parse((()=>new c(t.name,U)),t,U,y)}}(0,I.b)([(0,r.I)()],c.prototype,"luminance",void 0),(0,I.b)([(0,r.I)()],c.prototype,"turbidity",void 0),(0,I.b)([(0,r.I)()],c.prototype,"rayleigh",void 0),(0,I.b)([(0,r.I)()],c.prototype,"mieCoefficient",void 0),(0,I.b)([(0,r.I)()],c.prototype,"mieDirectionalG",void 0),(0,I.b)([(0,r.I)()],c.prototype,"distance",void 0),(0,I.b)([(0,r.I)()],c.prototype,"inclination",void 0),(0,I.b)([(0,r.I)()],c.prototype,"azimuth",void 0),(0,I.b)([(0,r.E)()],c.prototype,"sunPosition",void 0),(0,I.b)([(0,r.I)()],c.prototype,"useSunPosition",void 0),(0,I.b)([(0,r.E)()],c.prototype,"cameraOffset",void 0),(0,I.b)([(0,r.E)()],c.prototype,"up",void 0),(0,I.b)([(0,r.I)()],c.prototype,"dithering",void 0),(0,L.f)("BABYLON.SkyMaterial",c)},13119:(t,U,y)=>{"use strict";function I(t,U){U.headers=t.headers||{},U.statusMessage=t.statusText,U.statusCode=t.status,U.data=t.response}function r(t,U,y){return new Promise((function(r,Y){y=y||{};var mt,X,P,G=new XMLHttpRequest,M=y.body,L=y.headers||{};for(mt in y.timeout&&(G.timeout=y.timeout),G.ontimeout=G.onerror=function(t){t.timeout="timeout"==t.type,Y(t)},G.open(t,U.href||U),G.onload=function(){for(P=G.getAllResponseHeaders().trim().split(/[\r\n]+/),I(G,G);X=P.shift();)X=X.split(": "),G.headers[X.shift().toLowerCase()]=X.join(": ");if((X=G.headers["content-type"])&&~X.indexOf("application/json"))try{G.data=JSON.parse(G.data,y.reviver)}catch(t){return I(G,t),Y(t)}(G.status>=400?Y:r)(G)},typeof FormData<"u"&&M instanceof FormData||M&&"object"==typeof M&&(L["content-type"]="application/json",M=JSON.stringify(M)),G.withCredentials=!!y.withCredentials,L)G.setRequestHeader(mt,L[mt]);G.send(M)}))}y.r(U),y.d(U,{del:()=>P,get:()=>Y,patch:()=>X,post:()=>mt,put:()=>G,send:()=>r});var Y=r.bind(r,"GET"),mt=r.bind(r,"POST"),X=r.bind(r,"PATCH"),P=r.bind(r,"DELETE"),G=r.bind(r,"PUT")},14445:(t,U,y)=>{"use strict";y.d(U,{e:()=>L});const I=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,Y=1/3,mt=1/6,X=(Math.sqrt(5)-1)/4,P=(5-Math.sqrt(5))/20,G=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),M=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const L=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const U="function"==typeof t?t:function(t){let U=0,y=0,I=0,r=1;const Y=function(){let t=4022871197;return function(U){U=U.toString();for(let y=0;y<U.length;y++){t+=U.charCodeAt(y);let I=.02519603282416938*t;t=I>>>0,I-=t,I*=t,t=I>>>0,I-=t,t+=4294967296*I}return 2.3283064365386963e-10*(t>>>0)}}();U=Y(" "),y=Y(" "),I=Y(" "),U-=Y(t),U<0&&(U+=1);y-=Y(t),y<0&&(y+=1);I-=Y(t),I<0&&(I+=1);return function(){const t=2091639*U+2.3283064365386963e-10*r;return U=y,y=I,I=t-(r=0|t)}}(t);this.p=function(t){const U=new Uint8Array(256);for(let y=0;y<256;y++)U[y]=y;for(let y=0;y<255;y++){const I=y+~~(t()*(256-y)),r=U[y];U[y]=U[I],U[I]=r}return U}(U),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let y=0;y<512;y++)this.perm[y]=this.p[255&y],this.permMod12[y]=this.perm[y]%12}noise2D(t,U){const y=this.permMod12,Y=this.perm;let mt=0,X=0,P=0;const M=(t+U)*I,L=Math.floor(t+M),h=Math.floor(U+M),Q=(L+h)*r,F=t-(L-Q),E=U-(h-Q);let w,D;F>E?(w=1,D=0):(w=0,D=1);const l=F-w+r,g=E-D+r,B=F-1+2*r,b=E-1+2*r,p=255&L,c=255&h;let f=.5-F*F-E*E;if(f>=0){const t=3*y[p+Y[c]];f*=f,mt=f*f*(G[t]*F+G[t+1]*E)}let S=.5-l*l-g*g;if(S>=0){const t=3*y[p+w+Y[c+D]];S*=S,X=S*S*(G[t]*l+G[t+1]*g)}let N=.5-B*B-b*b;if(N>=0){const t=3*y[p+1+Y[c+1]];N*=N,P=N*N*(G[t]*B+G[t+1]*b)}return 70*(mt+X+P)}noise3D(t,U,y){const I=this.permMod12,r=this.perm;let X,P,M,L;const h=(t+U+y)*Y,Q=Math.floor(t+h),F=Math.floor(U+h),E=Math.floor(y+h),w=(Q+F+E)*mt,D=t-(Q-w),l=U-(F-w),g=y-(E-w);let B,b,p,c,f,S;D>=l?l>=g?(B=1,b=0,p=0,c=1,f=1,S=0):D>=g?(B=1,b=0,p=0,c=1,f=0,S=1):(B=0,b=0,p=1,c=1,f=0,S=1):l<g?(B=0,b=0,p=1,c=0,f=1,S=1):D<g?(B=0,b=1,p=0,c=0,f=1,S=1):(B=0,b=1,p=0,c=1,f=1,S=0);const N=D-B+mt,j=l-b+mt,J=g-p+mt,a=D-c+2*mt,d=l-f+2*mt,q=g-S+2*mt,H=D-1+.5,e=l-1+.5,o=g-1+.5,V=255&Q,n=255&F,i=255&E;let v=.6-D*D-l*l-g*g;if(v<0)X=0;else{const t=3*I[V+r[n+r[i]]];v*=v,X=v*v*(G[t]*D+G[t+1]*l+G[t+2]*g)}let O=.6-N*N-j*j-J*J;if(O<0)P=0;else{const t=3*I[V+B+r[n+b+r[i+p]]];O*=O,P=O*O*(G[t]*N+G[t+1]*j+G[t+2]*J)}let k=.6-a*a-d*d-q*q;if(k<0)M=0;else{const t=3*I[V+c+r[n+f+r[i+S]]];k*=k,M=k*k*(G[t]*a+G[t+1]*d+G[t+2]*q)}let s=.6-H*H-e*e-o*o;if(s<0)L=0;else{const t=3*I[V+1+r[n+1+r[i+1]]];s*=s,L=s*s*(G[t]*H+G[t+1]*e+G[t+2]*o)}return 32*(X+P+M+L)}noise4D(t,U,y,I){const r=this.perm;let Y,mt,G,L,h;const Q=(t+U+y+I)*X,F=Math.floor(t+Q),E=Math.floor(U+Q),w=Math.floor(y+Q),D=Math.floor(I+Q),l=(F+E+w+D)*P,g=t-(F-l),B=U-(E-l),b=y-(w-l),p=I-(D-l);let c=0,f=0,S=0,N=0;g>B?c++:f++,g>b?c++:S++,g>p?c++:N++,B>b?f++:S++,B>p?f++:N++,b>p?S++:N++;const j=c>=3?1:0,J=f>=3?1:0,a=S>=3?1:0,d=N>=3?1:0,q=c>=2?1:0,H=f>=2?1:0,e=S>=2?1:0,o=N>=2?1:0,V=c>=1?1:0,n=f>=1?1:0,i=S>=1?1:0,v=N>=1?1:0,O=g-j+P,k=B-J+P,s=b-a+P,x=p-d+P,Z=g-q+2*P,W=B-H+2*P,A=b-e+2*P,K=p-o+2*P,C=g-V+3*P,R=B-n+3*P,u=b-i+3*P,T=p-v+3*P,z=g-1+4*P,tt=B-1+4*P,Ut=b-1+4*P,yt=p-1+4*P,It=255&F,rt=255&E,Yt=255&w,mU=255&D;let Xt=.6-g*g-B*B-b*b-p*p;if(Xt<0)Y=0;else{const t=r[It+r[rt+r[Yt+r[mU]]]]%32*4;Xt*=Xt,Y=Xt*Xt*(M[t]*g+M[t+1]*B+M[t+2]*b+M[t+3]*p)}let Pt=.6-O*O-k*k-s*s-x*x;if(Pt<0)mt=0;else{const t=r[It+j+r[rt+J+r[Yt+a+r[mU+d]]]]%32*4;Pt*=Pt,mt=Pt*Pt*(M[t]*O+M[t+1]*k+M[t+2]*s+M[t+3]*x)}let Gt=.6-Z*Z-W*W-A*A-K*K;if(Gt<0)G=0;else{const t=r[It+q+r[rt+H+r[Yt+e+r[mU+o]]]]%32*4;Gt*=Gt,G=Gt*Gt*(M[t]*Z+M[t+1]*W+M[t+2]*A+M[t+3]*K)}let Mt=.6-C*C-R*R-u*u-T*T;if(Mt<0)L=0;else{const t=r[It+V+r[rt+n+r[Yt+i+r[mU+v]]]]%32*4;Mt*=Mt,L=Mt*Mt*(M[t]*C+M[t+1]*R+M[t+2]*u+M[t+3]*T)}let Lt=.6-z*z-tt*tt-Ut*Ut-yt*yt;if(Lt<0)h=0;else{const t=r[It+1+r[rt+1+r[Yt+1+r[mU+1]]]]%32*4;Lt*=Lt,h=Lt*Lt*(M[t]*z+M[t+1]*tt+M[t+2]*Ut+M[t+3]*yt)}return 27*(Y+mt+G+L+h)}}}}]);