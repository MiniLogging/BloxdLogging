/*! For license information please see 1o5xb.32.d0958311.chunk.js.LICENSE.txt */
(self.pp3k1ov3ibi=self.pp3k1ov3ibi||[]).push([[32],{14346:(M,Z,P)=>{"use strict";var x=P(14351),c=P(14360),w=P(14368);P.g.__TYPEDARRAY_POOL||(P.g.__TYPEDARRAY_POOL={UINT8:c([32,0]),UINT16:c([32,0]),UINT32:c([32,0]),INT8:c([32,0]),INT16:c([32,0]),INT32:c([32,0]),FLOAT:c([32,0]),DOUBLE:c([32,0]),DATA:c([32,0]),UINT8C:c([32,0]),BUFFER:c([32,0])});var v="undefined"!==typeof Uint8ClampedArray,G=P.g.__TYPEDARRAY_POOL;G.UINT8C||(G.UINT8C=c([32,0])),G.BUFFER||(G.BUFFER=c([32,0]));var mM=G.DATA,K=G.BUFFER;function d(M){if(M){var Z=M.length||M.byteLength,P=x.log2(Z);mM[P].push(M)}}function O(M){M=x.nextPow2(M);var Z=x.log2(M),P=mM[Z];return P.length>0?P.pop():new ArrayBuffer(M)}function H(M){return new Uint8Array(O(M),0,M)}function j(M){return new Uint16Array(O(2*M),0,M)}function B(M){return new Uint32Array(O(4*M),0,M)}function U(M){return new Int8Array(O(M),0,M)}function n(M){return new Int16Array(O(2*M),0,M)}function L(M){return new Int32Array(O(4*M),0,M)}function u(M){return new Float32Array(O(4*M),0,M)}function N(M){return new Float64Array(O(8*M),0,M)}function J(M){return v?new Uint8ClampedArray(O(M),0,M):H(M)}function t(M){return new DataView(O(M),0,M)}Z.free=function(M){if(w(M))K[x.log2(M.length)].push(M);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(M)&&(M=M.buffer),!M)return;var Z=M.length||M.byteLength,P=0|x.log2(Z);mM[P].push(M)}},Z.freeUint8=Z.freeUint16=Z.freeUint32=Z.freeInt8=Z.freeInt16=Z.freeInt32=Z.freeFloat32=Z.freeFloat=Z.freeFloat64=Z.freeDouble=Z.freeUint8Clamped=Z.freeDataView=function(M){d(M.buffer)},Z.freeArrayBuffer=d,Z.freeBuffer=function(M){K[x.log2(M.length)].push(M)},Z.malloc=function(M,Z){if(void 0===Z||"arraybuffer"===Z)return O(M);switch(Z){case"uint8":return H(M);case"uint16":return j(M);case"uint32":return B(M);case"int8":return U(M);case"int16":return n(M);case"int32":return L(M);case"float":case"float32":return u(M);case"double":case"float64":return N(M);case"uint8_clamped":return J(M);case"buffer":throw"Buffer not supported";case"data":case"dataview":return t(M);default:return null}return null},Z.mallocArrayBuffer=O,Z.mallocUint8=H,Z.mallocUint16=j,Z.mallocUint32=B,Z.mallocInt8=U,Z.mallocInt16=n,Z.mallocInt32=L,Z.mallocFloat32=Z.mallocFloat=u,Z.mallocFloat64=Z.mallocDouble=N,Z.mallocUint8Clamped=J,Z.mallocDataView=t,Z.clearCache=function(){for(var M=0;M<32;++M)G.UINT8[M].length=0,G.UINT16[M].length=0,G.UINT32[M].length=0,G.INT8[M].length=0,G.INT16[M].length=0,G.INT32[M].length=0,G.FLOAT[M].length=0,G.DOUBLE[M].length=0,G.UINT8C[M].length=0,mM[M].length=0,K[M].length=0}},14459:(M,Z,P)=>{M.exports=c;var x=P(13205);function c(M,Z){if(!(this instanceof c))return new c(M,Z);var P=x.create();x.add(P,M,Z),this.base=x.min(x.create(),M,P),this.Xd=x.clone(Z),this.max=x.max(x.create(),M,P),this.mag=x.length(this.Xd)}var w=c.prototype;w.width=function(){return this.Xd[0]},w.height=function(){return this.Xd[1]},w.depth=function(){return this.Xd[2]},w.x0=function(){return this.base[0]},w.y0=function(){return this.base[1]},w.z0=function(){return this.base[2]},w.x1=function(){return this.max[0]},w.y1=function(){return this.max[1]},w.z1=function(){return this.max[2]},w.translate=function(M){return x.add(this.max,this.max,M),x.add(this.base,this.base,M),this},w.setPosition=function(M){return x.add(this.max,M,this.Xd),x.i(this.base,M),this},w.expand=function(M){var Z=x.create(),P=x.create();return x.max(Z,M.max,this.max),x.min(P,M.base,this.base),x.UZ(Z,Z,P),new c(P,Z)},w.intersects=function(M){return!(M.base[0]>this.max[0])&&(!(M.base[1]>this.max[1])&&(!(M.base[2]>this.max[2])&&(!(M.max[0]<this.base[0])&&(!(M.max[1]<this.base[1])&&!(M.max[2]<this.base[2])))))},w.touches=function(M){var Z=this.union(M);return null!==Z&&(0==Z.width()||0==Z.height()||0==Z.depth())},w.union=function(M){if(!this.intersects(M))return null;var Z=Math.max(M.base[0],this.base[0]),P=Math.max(M.base[1],this.base[1]),x=Math.max(M.base[2],this.base[2]);return new c([Z,P,x],[Math.min(M.max[0],this.max[0])-Z,Math.min(M.max[1],this.max[1])-P,Math.min(M.max[2],this.max[2])-x])}},14351:(M,Z)=>{"use strict";function P(M){var Z=32;return(M&=-M)&&Z--,65535&M&&(Z-=16),16711935&M&&(Z-=8),252645135&M&&(Z-=4),858993459&M&&(Z-=2),1431655765&M&&(Z-=1),Z}Z.INT_BITS=32,Z.INT_MAX=2147483647,Z.INT_MIN=-1<<31,Z.sign=function(M){return(M>0)-(M<0)},Z.abs=function(M){var Z=M>>31;return(M^Z)-Z},Z.min=function(M,Z){return Z^(M^Z)&-(M<Z)},Z.max=function(M,Z){return M^(M^Z)&-(M<Z)},Z.isPow2=function(M){return!(M&M-1)&&!!M},Z.log2=function(M){var Z,P;return Z=(M>65535)<<4,Z|=P=((M>>>=Z)>255)<<3,Z|=P=((M>>>=P)>15)<<2,(Z|=P=((M>>>=P)>3)<<1)|(M>>>=P)>>1},Z.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},Z.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},Z.countTrailingZeros=P,Z.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},Z.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},Z.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var x=new Array(256);!function(M){for(var Z=0;Z<256;++Z){var P=Z,x=Z,c=7;for(P>>>=1;P;P>>>=1)x<<=1,x|=1&P,--c;M[Z]=x<<c&255}}(x),Z.reverse=function(M){return x[255&M]<<24|x[M>>>8&255]<<16|x[M>>>16&255]<<8|x[M>>>24&255]},Z.interleave2=function(M,Z){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))<<1},Z.deinterleave2=function(M,Z){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>Z&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},Z.interleave3=function(M,Z,P){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},Z.deinterleave3=function(M,Z){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>Z&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},Z.nextCombination=function(M){var Z=M|M-1;return Z+1|(~Z&-~Z)-1>>>P(M)+1}},14344:(M,Z,P)=>{"use strict";M.exports=function(M,Z,P){switch(arguments.length){case 1:return x=[],K(c=M,c,d,!0),x;case 2:return"function"===typeof Z?K(M,M,Z,!0):function(M,Z){return x=[],K(M,Z,d,!1),x}(M,Z);case 3:return K(M,Z,P,!1);default:throw new Error("box-intersect: Invalid arguments")}var c};var x,c=P(14346),w=P(14377),v=P(14391);function G(M,Z){for(var P=0;P<M;++P)if(!(Z[P]<=Z[P+M]))return!0;return!1}function mM(M,Z,P,x){for(var c=0,w=0,v=0,mM=M.length;v<mM;++v){var K=M[v];if(!G(Z,K)){for(var d=0;d<2*Z;++d)P[c++]=K[d];x[w++]=v}}return w}function K(M,Z,P,x){var G=M.length,K=Z.length;if(!(G<=0||K<=0)){var d=M[0].length>>>1;if(!(d<=0)){var O,H=c.mallocDouble(2*d*G),j=c.mallocInt32(G);if((G=mM(M,d,H,j))>0){if(1===d&&x)w.init(G),O=w.sweepComplete(d,P,0,G,H,j,0,G,H,j);else{var B=c.mallocDouble(2*d*K),U=c.mallocInt32(K);(K=mM(Z,d,B,U))>0&&(w.init(G+K),O=1===d?w.sweepBipartite(d,P,0,G,H,j,0,K,B,U):v(d,P,x,G,H,j,K,B,U),c.free(B),c.free(U))}c.free(H),c.free(j)}return O}}}function d(M,Z){x.push([M,Z])}},14396:(M,Z)=>{"use strict";var P="d",x="ax",c="fp",w="es",v="rs",G="re",mM="rb",K="bs",d="be",O="bb",H=[P,x,"vv",v,G,mM,"ri",K,d,O,"bi"];function j(M){var Z="bruteForce"+(M?"Full":"Partial"),x=[],v=H.slice();M||v.splice(3,0,c);var G=["function "+Z+"("+v.join()+"){"];function mM(Z,c){var v=function(M,Z,x){var c="bruteForce"+(M?"Red":"Blue")+(Z?"Flip":"")+(x?"Full":""),v=["function ",c,"(",H.join(),"){","var ",w,"=2*",P,";"],G="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",mM="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(x?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return M?v.push(G,"Q",":",mM):v.push(mM,"Q",":",G),x?v.push("if(y1<x0||x1<y0)continue;"):Z?v.push("if(y0<=x0||x1<y0)continue;"):v.push("if(y0<x0||x1<y0)continue;"),v.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),Z?v.push("yi,xi"):v.push("xi,yi"),v.push(");if(rv!==void 0)return rv;}}}"),{name:c,code:v.join("")}}(Z,c,M);x.push(v.code),G.push("return "+v.name+"("+H.join()+");")}G.push("if(re-rs>be-bs){"),M?(mM(!0,!1),G.push("}else{"),mM(!1,!1)):(G.push("if(fp){"),mM(!0,!0),G.push("}else{"),mM(!0,!1),G.push("}}else{if(fp){"),mM(!1,!0),G.push("}else{"),mM(!1,!1),G.push("}")),G.push("}}return "+Z);var K=x.join("")+G.join("");return new Function(K)()}Z.partial=j(!1),Z.full=j(!0)},14391:(M,Z,P)=>{"use strict";M.exports=function(M,Z,P,w,d,I,s,C,R){!function(M,Z){var P=8*c.log2(Z+1)*(M+1)|0,w=c.nextPow2(J*P);F.length<w&&(x.free(F),F=x.mallocInt32(w));var v=c.nextPow2(t*P);D.length<v&&(x.free(D),D=x.mallocDouble(v))}(M,w+s);var W,k=0,A=2*M;l(k++,0,0,w,0,s,P?16:0,-1/0,1/0),P||l(k++,0,0,s,0,w,1,-1/0,1/0);for(;k>0;){var o=(k-=1)*J,E=F[o],r=F[o+1],q=F[o+2],e=F[o+3],b=F[o+4],a=F[o+5],y=k*t,f=D[y],Y=D[y+1],z=1&a,i=!!(16&a),T=d,p=I,S=C,X=R;if(z&&(T=C,p=R,S=d,X=I),!(2&a&&r>=(q=n(M,E,r,q,T,p,Y)))&&!(4&a&&(r=L(M,E,r,q,T,p,f))>=q)){var V=q-r,g=b-e;if(i){if(M*V*(V+g)<j){if(void 0!==(W=mM.scanComplete(M,E,Z,r,q,T,p,e,b,S,X)))return W;continue}}else{if(M*Math.min(V,g)<O){if(void 0!==(W=v(M,E,Z,z,r,q,T,p,e,b,S,X)))return W;continue}if(M*V*g<H){if(void 0!==(W=mM.scanBipartite(M,E,Z,z,r,q,T,p,e,b,S,X)))return W;continue}}var MM=B(M,E,r,q,T,p,f,Y);if(r<MM)if(M*(MM-r)<O){if(void 0!==(W=G(M,E+1,Z,r,MM,T,p,e,b,S,X)))return W}else if(E===M-2){if(void 0!==(W=z?mM.sweepBipartite(M,Z,e,b,S,X,r,MM,T,p):mM.sweepBipartite(M,Z,r,MM,T,p,e,b,S,X)))return W}else l(k++,E+1,r,MM,e,b,z,-1/0,1/0),l(k++,E+1,e,b,r,MM,1^z,-1/0,1/0);if(MM<q){var ZM=K(M,E,e,b,S,X),PM=S[A*ZM+E],xM=U(M,E,ZM,b,S,X,PM);if(xM<b&&l(k++,E,MM,q,xM,b,(4|z)+(i?16:0),PM,Y),e<ZM&&l(k++,E,MM,q,e,ZM,(2|z)+(i?16:0),f,PM),ZM+1===xM){if(void 0!==(W=i?Q(M,E,Z,MM,q,T,p,ZM,S,X[ZM]):h(M,E,Z,z,MM,q,T,p,ZM,S,X[ZM])))return W}else if(ZM<xM){var cM;if(i){if(MM<(cM=u(M,E,MM,q,T,p,PM))){var wM=U(M,E,MM,cM,T,p,PM);if(E===M-2){if(MM<wM&&void 0!==(W=mM.sweepComplete(M,Z,MM,wM,T,p,ZM,xM,S,X)))return W;if(wM<cM&&void 0!==(W=mM.sweepBipartite(M,Z,wM,cM,T,p,ZM,xM,S,X)))return W}else MM<wM&&l(k++,E+1,MM,wM,ZM,xM,16,-1/0,1/0),wM<cM&&(l(k++,E+1,wM,cM,ZM,xM,0,-1/0,1/0),l(k++,E+1,ZM,xM,wM,cM,1,-1/0,1/0))}}else MM<(cM=z?N(M,E,MM,q,T,p,PM):u(M,E,MM,q,T,p,PM))&&(E===M-2?W=z?mM.sweepBipartite(M,Z,ZM,xM,S,X,MM,cM,T,p):mM.sweepBipartite(M,Z,MM,cM,T,p,ZM,xM,S,X):(l(k++,E+1,MM,cM,ZM,xM,z,-1/0,1/0),l(k++,E+1,ZM,xM,MM,cM,1^z,-1/0,1/0)))}}}}};var x=P(14346),c=P(14351),w=P(14396),v=w.partial,G=w.full,mM=P(14377),K=P(14400),d=P(14405),O=128,H=1<<22,j=1<<22,B=d("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),U=d("lo===p0",["p0"]),n=d("lo<p0",["p0"]),L=d("hi<=p0",["p0"]),u=d("lo<=p0&&p0<=hi",["p0"]),N=d("lo<p0&&p0<=hi",["p0"]),J=6,t=2,F=x.mallocInt32(1024),D=x.mallocDouble(1024);function l(M,Z,P,x,c,w,v,G,mM){var K=J*M;F[K]=Z,F[K+1]=P,F[K+2]=x,F[K+3]=c,F[K+4]=w,F[K+5]=v;var d=t*M;D[d]=G,D[d+1]=mM}function h(M,Z,P,x,c,w,v,G,mM,K,d){var O=2*M,H=mM*O,j=K[H+Z];M:for(var B=c,U=c*O;B<w;++B,U+=O){var n=v[U+Z],L=v[U+Z+M];if(!(j<n||L<j)&&(!x||j!==n)){for(var u,N=G[B],J=Z+1;J<M;++J){n=v[U+J],L=v[U+J+M];var t=K[H+J],F=K[H+J+M];if(L<t||F<n)continue M}if(void 0!==(u=x?P(d,N):P(N,d)))return u}}}function Q(M,Z,P,x,c,w,v,G,mM,K){var d=2*M,O=G*d,H=mM[O+Z];M:for(var j=x,B=x*d;j<c;++j,B+=d){var U=v[j];if(U!==K){var n=w[B+Z],L=w[B+Z+M];if(!(H<n||L<H)){for(var u=Z+1;u<M;++u){n=w[B+u],L=w[B+u+M];var N=mM[O+u],J=mM[O+u+M];if(L<N||J<n)continue M}var t=P(U,K);if(void 0!==t)return t}}}}},14400:(M,Z,P)=>{"use strict";M.exports=function(M,Z,P,v,G,mM){if(v<=P+1)return P;var K=P,d=v,O=v+P>>>1,H=2*M,j=O,B=G[H*O+Z];for(;K<d;){if(d-K<c){w(M,Z,K,d,G,mM),B=G[H*O+Z];break}var U=d-K,n=Math.random()*U+K|0,L=G[H*n+Z],u=Math.random()*U+K|0,N=G[H*u+Z],J=Math.random()*U+K|0,t=G[H*J+Z];L<=N?t>=N?(j=u,B=N):L>=t?(j=n,B=L):(j=J,B=t):N>=t?(j=u,B=N):t>=L?(j=n,B=L):(j=J,B=t);for(var F=H*(d-1),D=H*j,l=0;l<H;++l,++F,++D){var h=G[F];G[F]=G[D],G[D]=h}var Q=mM[d-1];mM[d-1]=mM[j],mM[j]=Q;for(F=H*(d-1),D=H*(j=x(M,Z,K,d-1,G,mM,B)),l=0;l<H;++l,++F,++D){h=G[F];G[F]=G[D],G[D]=h}Q=mM[d-1];if(mM[d-1]=mM[j],mM[j]=Q,O<j){for(d=j-1;K<d&&G[H*(d-1)+Z]===B;)d-=1;d+=1}else{if(!(j<O))break;for(K=j+1;K<d&&G[H*K+Z]===B;)K+=1}}return x(M,Z,P,O,G,mM,G[H*O+Z])};var x=P(14405)("lo<p0",["p0"]),c=8;function w(M,Z,P,x,c,w){for(var v=2*M,G=v*(P+1)+Z,mM=P+1;mM<x;++mM,G+=v)for(var K=c[G],d=mM,O=v*(mM-1);d>P&&c[O+Z]>K;--d,O-=v){for(var H=O,j=O+v,B=0;B<v;++B,++H,++j){var U=c[H];c[H]=c[j],c[j]=U}var n=w[d];w[d]=w[d-1],w[d-1]=n}}},14405:M=>{"use strict";M.exports=function(M,P){var x="abcdef".split("").concat(P),c=[];M.indexOf("lo")>=0&&c.push("lo=e[k+n]");M.indexOf("hi")>=0&&c.push("hi=e[k+o]");return x.push(Z.replace("_",c.join()).replace("$",M)),Function.apply(void 0,x)};var Z="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14386:M=>{"use strict";M.exports=function(M,x){x<=4*Z?P(0,x-1,M):K(0,x-1,M)};var Z=32;function P(M,Z,P){for(var x=2*(M+1),c=M+1;c<=Z;++c){for(var w=P[x++],v=P[x++],G=c,mM=x-2;G-- >M;){var K=P[mM-2],d=P[mM-1];if(K<w)break;if(K===w&&d<v)break;P[mM]=K,P[mM+1]=d,mM-=2}P[mM]=w,P[mM+1]=v}}function x(M,Z,P){Z*=2;var x=P[M*=2],c=P[M+1];P[M]=P[Z],P[M+1]=P[Z+1],P[Z]=x,P[Z+1]=c}function c(M,Z,P){Z*=2,P[M*=2]=P[Z],P[M+1]=P[Z+1]}function w(M,Z,P,x){Z*=2,P*=2;var c=x[M*=2],w=x[M+1];x[M]=x[Z],x[M+1]=x[Z+1],x[Z]=x[P],x[Z+1]=x[P+1],x[P]=c,x[P+1]=w}function v(M,Z,P,x,c){Z*=2,c[M*=2]=c[Z],c[Z]=P,c[M+1]=c[Z+1],c[Z+1]=x}function G(M,Z,P){Z*=2;var x=P[M*=2],c=P[Z];return!(x<c)&&(x!==c||P[M+1]>P[Z+1])}function mM(M,Z,P,x){var c=x[M*=2];return c<Z||c===Z&&x[M+1]<P}function K(M,d,O){var H=(d-M+1)/6|0,j=M+H,B=d-H,U=M+d>>1,n=U-H,L=U+H,u=j,N=n,J=U,t=L,F=B,D=M+1,l=d-1,h=0;G(u,N,O)&&(h=u,u=N,N=h),G(t,F,O)&&(h=t,t=F,F=h),G(u,J,O)&&(h=u,u=J,J=h),G(N,J,O)&&(h=N,N=J,J=h),G(u,t,O)&&(h=u,u=t,t=h),G(J,t,O)&&(h=J,J=t,t=h),G(N,F,O)&&(h=N,N=F,F=h),G(N,J,O)&&(h=N,N=J,J=h),G(t,F,O)&&(h=t,t=F,F=h);for(var Q=O[2*N],I=O[2*N+1],s=O[2*t],C=O[2*t+1],R=2*u,W=2*J,k=2*F,A=2*j,o=2*U,E=2*B,r=0;r<2;++r){var q=O[R+r],e=O[W+r],b=O[k+r];O[A+r]=q,O[o+r]=e,O[E+r]=b}c(n,M,O),c(L,d,O);for(var a=D;a<=l;++a)if(mM(a,Q,I,O))a!==D&&x(a,D,O),++D;else if(!mM(a,s,C,O))for(;;){if(mM(l,s,C,O)){mM(l,Q,I,O)?(w(a,D,l,O),++D,--l):(x(a,l,O),--l);break}if(--l<a)break}v(M,D-1,Q,I,O),v(d,l+1,s,C,O),D-2-M<=Z?P(M,D-2,O):K(M,D-2,O),d-(l+2)<=Z?P(l+2,d,O):K(l+2,d,O),l-D<=Z?P(D,l,O):K(D,l,O)}},14377:(M,Z,P)=>{"use strict";M.exports={init:function(M){var Z=c.nextPow2(M);mM.length<Z&&(x.free(mM),mM=x.mallocInt32(Z));K.length<Z&&(x.free(K),K=x.mallocInt32(Z));d.length<Z&&(x.free(d),d=x.mallocInt32(Z));O.length<Z&&(x.free(O),O=x.mallocInt32(Z));H.length<Z&&(x.free(H),H=x.mallocInt32(Z));j.length<Z&&(x.free(j),j=x.mallocInt32(Z));var P=8*Z;B.length<P&&(x.free(B),B=x.mallocDouble(P))},sweepBipartite:function(M,Z,P,x,c,G,H,j,L,u){for(var N=0,J=2*M,t=M-1,F=J-1,D=P;D<x;++D){var l=G[D],h=J*D;B[N++]=c[h+t],B[N++]=-(l+1),B[N++]=c[h+F],B[N++]=l}for(D=H;D<j;++D){l=u[D]+v;var Q=J*D;B[N++]=L[Q+t],B[N++]=-l,B[N++]=L[Q+F],B[N++]=l}var I=N>>>1;w(B,I);var s=0,C=0;for(D=0;D<I;++D){var R=0|B[2*D+1];if(R>=v)U(d,O,C--,R=R-v|0);else if(R>=0)U(mM,K,s--,R);else if(R<=-v){R=-R-v|0;for(var W=0;W<s;++W){if(void 0!==(k=Z(mM[W],R)))return k}n(d,O,C++,R)}else{R=-R-1|0;for(W=0;W<C;++W){var k;if(void 0!==(k=Z(R,d[W])))return k}n(mM,K,s++,R)}}},sweepComplete:function(M,Z,P,x,c,v,G,L,u,N){for(var J=0,t=2*M,F=M-1,D=t-1,l=P;l<x;++l){var h=v[l]+1<<1,Q=t*l;B[J++]=c[Q+F],B[J++]=-h,B[J++]=c[Q+D],B[J++]=h}for(l=G;l<L;++l){h=N[l]+1<<1;var I=t*l;B[J++]=u[I+F],B[J++]=1|-h,B[J++]=u[I+D],B[J++]=1|h}var s=J>>>1;w(B,s);var C=0,R=0,W=0;for(l=0;l<s;++l){var k=0|B[2*l+1],A=1&k;if(l<s-1&&k>>1===B[2*l+3]>>1&&(A=2,l+=1),k<0){for(var o=-(k>>1)-1,E=0;E<W;++E){if(void 0!==(r=Z(H[E],o)))return r}if(0!==A)for(E=0;E<C;++E){if(void 0!==(r=Z(mM[E],o)))return r}if(1!==A)for(E=0;E<R;++E){var r;if(void 0!==(r=Z(d[E],o)))return r}0===A?n(mM,K,C++,o):1===A?n(d,O,R++,o):2===A&&n(H,j,W++,o)}else{o=(k>>1)-1;0===A?U(mM,K,C--,o):1===A?U(d,O,R--,o):2===A&&U(H,j,W--,o)}}},scanBipartite:function(M,Z,P,x,c,G,d,O,H,j,L,u){var N=0,J=2*M,t=Z,F=Z+M,D=1,l=1;x?l=v:D=v;for(var h=c;h<G;++h){var Q=h+D,I=J*h;B[N++]=d[I+t],B[N++]=-Q,B[N++]=d[I+F],B[N++]=Q}for(h=H;h<j;++h){Q=h+l;var s=J*h;B[N++]=L[s+t],B[N++]=-Q}var C=N>>>1;w(B,C);var R=0;for(h=0;h<C;++h){var W=0|B[2*h+1];if(W<0){var k=!1;if((Q=-W)>=v?(k=!x,Q-=v):(k=!!x,Q-=1),k)n(mM,K,R++,Q);else{var A=u[Q],o=J*Q,E=L[o+Z+1],r=L[o+Z+1+M];M:for(var q=0;q<R;++q){var e=mM[q],b=J*e;if(!(r<d[b+Z+1]||d[b+Z+1+M]<E)){for(var a=Z+2;a<M;++a)if(L[o+a+M]<d[b+a]||d[b+a+M]<L[o+a])continue M;var y,f=O[e];if(void 0!==(y=x?P(A,f):P(f,A)))return y}}}}else U(mM,K,R--,W-D)}},scanComplete:function(M,Z,P,x,c,G,K,d,O,H,j){for(var U=0,n=2*M,L=Z,u=Z+M,N=x;N<c;++N){var J=N+v,t=n*N;B[U++]=G[t+L],B[U++]=-J,B[U++]=G[t+u],B[U++]=J}for(N=d;N<O;++N){J=N+1;var F=n*N;B[U++]=H[F+L],B[U++]=-J}var D=U>>>1;w(B,D);var l=0;for(N=0;N<D;++N){var h=0|B[2*N+1];if(h<0){if((J=-h)>=v)mM[l++]=J-v;else{var Q=j[J-=1],I=n*J,s=H[I+Z+1],C=H[I+Z+1+M];M:for(var R=0;R<l;++R){var W=mM[R],k=K[W];if(k===Q)break;var A=n*W;if(!(C<G[A+Z+1]||G[A+Z+1+M]<s)){for(var o=Z+2;o<M;++o)if(H[I+o+M]<G[A+o]||G[A+o+M]<H[I+o])continue M;var E=P(k,Q);if(void 0!==E)return E}}}}else{for(J=h-v,R=l-1;R>=0;--R)if(mM[R]===J){for(o=R+1;o<l;++o)mM[o-1]=mM[o];break}--l}}}};var x=P(14346),c=P(14351),w=P(14386),v=1<<28,G=1024,mM=x.mallocInt32(G),K=x.mallocInt32(G),d=x.mallocInt32(G),O=x.mallocInt32(G),H=x.mallocInt32(G),j=x.mallocInt32(G),B=x.mallocDouble(8192);function U(M,Z,P,x){var c=Z[x],w=M[P-1];M[c]=w,Z[w]=c}function n(M,Z,P,x){M[P]=x,Z[x]=P}},14360:M=>{"use strict";function Z(M,P,x){var c=0|M[x];if(c<=0)return[];var w,v=new Array(c);if(x===M.length-1)for(w=0;w<c;++w)v[w]=P;else for(w=0;w<c;++w)v[w]=Z(M,P,x+1);return v}M.exports=function(M,P){switch("undefined"===typeof P&&(P=0),typeof M){case"number":if(M>0)return function(M,Z){var P,x;for(P=new Array(M),x=0;x<M;++x)P[x]=Z;return P}(0|M,P);break;case"object":if("number"===typeof M.length)return Z(M,P,0)}return[]}},14309:(M,Z,P)=>{M.exports=function(){var M=this;this.components={},this.comps=this.components;var Z=this.components,P=1,c={},w=[],v=[],G={timeout:!1,removals:[],multiComps:[]};function mM(M,P){var x=Z[P],w=c[P],v=w.hash[M];v&&(w.remove(M),x.mc&&(x.multi?(v.forEach((Z=>{Z&&x.mc(M,Z)})),v.length=0):x.mc(M,v)),G.removals.push(w),K())}function K(){G.timeout||(G.timeout=!0,setTimeout(d,1))}function d(){G.timeout=!1,O()}function O(){G.multiComps.length&&function(M){for(var Z=0;Z<M.length;Z++){var{entID:P,data:x}=M[Z],c=x.hash[P];if(c){for(var w=0;w<c.length;w++)c[w]||(c.splice(w,1),w--);0===c.length&&(x.remove(P),G.removals.push(x))}}M.length=0}(G.multiComps),G.removals.length&&function(M){for(var Z=0;Z<M.length;Z++){M[Z].flush()}M.length=0}(G.removals)}this.HH=c,this._systems=w,this._renderSystems=v,this.NK=function(Z){var x=P++;return Array.isArray(Z)&&Z.forEach((Z=>M.dK(x,Z))),x},this.deleteEntity=function(Z){return Object.keys(c).forEach((M=>{c[M].hash[Z]&&mM(Z,M)})),M},this.nO=function(M){if(!M)throw new Error("Missing component definition");var P=M.name;if(!P)throw new Error("Component definition must have a name property.");if("string"!==typeof P)throw new Error("Component name must be a string.");if(""===P)throw new Error("Component name must be a non-empty string.");if(c[P])throw new Error(`Component ${P} already exists.`);var G={};return G.name=P,G.multi=!!M.multi,G.order=isNaN(M.order)?99:M.order,G.stateConstructor=M.stateConstructor||null,G.state=M.state||{},G.Gm=M.Gm||null,G.mc=M.mc||null,G.system=M.system||null,G.jm=M.jm||null,Z[P]=G,c[P]=new x,c[P]._pendingMultiCleanup=!1,c[P]._multiCleanupIDs=G.multi?[]:null,G.system&&(w.push(P),w.sort(((M,P)=>Z[M].order-Z[P].order))),G.jm&&(v.push(P),v.sort(((M,P)=>Z[M].order-Z[P].order))),P},this.overwriteComponent=function(M,P){var x=Z[M];if(!x)throw new Error(`Unknown component: ${M}`);if(!P)throw new Error("Missing component definition");if(x.name!==P.name)throw new Error("Overwriting component must use the same name property.");var G={};G.name=M,G.multi=!!P.multi,G.order=isNaN(P.order)?99:P.order,G.state=P.state||{},G.Gm=P.Gm||null,G.mc=P.mc||null,G.system=P.system||null,G.jm=P.jm||null,Z[M]=G,c[M]._pendingMultiCleanup=!1,c[M]._multiCleanupIDs=G.multi?[]:null;var mM=w.indexOf(M);G.system&&mM<0&&w.push(M),!G.system&&mM>=0&&w.splice(mM,1),w.sort(((M,P)=>Z[M].order-Z[P].order));var K=v.indexOf(M);G.jm&&K<0&&v.push(M),!G.jm&&K>=0&&v.splice(K,1),v.sort(((M,P)=>Z[M].order-Z[P].order));var d=G.state;return this.Nd(M).forEach((M=>{for(var Z in d)Z in M||(M[Z]=d[Z]);G.Gm&&G.Gm(M.Om,M)})),M},this.deleteComponent=function(P){var x=c[P];if(!x)throw new Error(`Unknown component: ${P}`);x.flush(),x.list.forEach((M=>{M&&mM(M.Om||M[0].Om,P)}));var G=w.indexOf(P),K=v.indexOf(P);return G>-1&&w.splice(G,1),K>-1&&v.splice(K,1),c[P].dispose(),delete c[P],delete Z[P],M},this.dK=function(M,P,x){var w,v=Z[P],G=c[P];if(!G)throw new Error(`Unknown component: ${P}.`);if(G.hash[M]&&!v.multi)throw new Error(`Entity ${M} already has component: ${P}.`);if(v.stateConstructor){if(!(w=new v.stateConstructor).hasOwnProperty("Om"))throw new Error(`Component ${v.name} stateConstructor type does not have property __id`)}else w=Object.assign({},{Om:M},v.state,x);if(w.Om=M,v.multi){var mM=G.hash[M];mM||(mM=[],G.add(M,mM)),mM.push(w)}else G.add(M,w);return v.Gm&&v.Gm(M,w),this},this.FK=function(M,Z){var P=c[Z];if(!P)throw new Error(`Unknown component: ${Z}.`);return!!P.hash[M]},this.UK=function(Z,P){if(!c[P])throw new Error(`Unknown component: ${P}.`);return mM(Z,P),M},this.getState=function(M,Z){var P=c[Z];if(!P)throw new Error(`Unknown component: ${Z}.`);return P.hash[M]},this.Nd=function(M){var Z=c[M];if(!Z)throw new Error(`Unknown component: ${M}.`);return O(),Z.list},this.MB=function(M){if(!c[M])throw new Error(`Unknown component: ${M}.`);var Z=c[M].hash;return M=>Z[M]},this.xB=function(M){if(!c[M])throw new Error(`Unknown component: ${M}.`);var Z=c[M].hash;return M=>!!Z[M]},this.wm=function(P){O();for(var x=0;x<w.length;x++){var v=w[x],G=Z[v],mM=c[v];G.system(P,mM.list),O()}return M},this.render=function(P){O();for(var x=0;x<v.length;x++){var w=v[x],G=Z[w],mM=c[w];G.jm(P,mM.list),O()}return M},this.removeMultiComponent=function(P,x,w){var v=Z[x],mM=c[x];if(!mM)throw new Error(`Unknown component: ${x}.`);if(!v.multi)throw new Error("removeMultiComponent called on non-multi component");return function(M,Z,P,x){var c=P.hash[M];if(c){var w=c[x];w&&(c[x]=null,Z.mc&&Z.mc(M,w),G.multiComps.push({entID:M,data:P}),K())}}(P,v,mM,w),M}};var x=P(14315)},14315:M=>{function Z(M,Z){var P=M._map[Z];if(delete M.hash[Z],delete M._map[Z],P===M.list.length-1)M.list.pop();else{var x=M.list.pop();if(M.list[P]=x,null===x||null===x[0]){var c=M.list.length;for(var w in M._map)if(M._map[w]===c)return void(M._map[w]=P)}else{var v=x.Om||x[0].Om;M._map[v]=P}}}M.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(M,Z){if("number"===typeof this._map[M]){var P=this._map[M];this.hash[M]=Z,this.list[P]=Z}else this._map[M]=this.list.length,this.hash[M]=Z,this.list.push(Z)}remove(M){var Z=this._map[M];this.hash[M]=null,this.list[Z]=null,this._pendingRemovals.push(M)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var M=0;M<this._pendingRemovals.length;M++){var P=this._pendingRemovals[M];null===this.hash[P]&&Z(this,P)}this._pendingRemovals.length=0}}},14269:M=>{"use strict";var Z,P="object"===typeof Reflect?Reflect:null,x=function(M,Z,P){return Function.prototype.apply.call(M,Z,P)};Z=P&&"function"===typeof P.ownKeys?P.ownKeys:Object.getOwnPropertySymbols?function(M){return Object.getOwnPropertyNames(M).concat(Object.getOwnPropertySymbols(M))}:function(M){return Object.getOwnPropertyNames(M)};var c=Number.isNaN||function(M){return M!==M};function w(){w.init.call(this)}M.exports=w,M.exports.once=function(M,Z){return new Promise((function(P,x){function c(P){M.removeListener(Z,w),x(P)}function w(){"function"===typeof M.removeListener&&M.removeListener("error",c),P([].slice.call(arguments))}U(M,Z,w,{once:!0}),"error"!==Z&&function(M,Z,P){"function"===typeof M.on&&U(M,"error",Z,P)}(M,c,{once:!0})}))},w.EventEmitter=w,w.prototype._events=void 0,w.prototype._eventsCount=0,w.prototype._maxListeners=void 0;var v=10;function G(M){if("function"!==typeof M)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}function mM(M){return void 0===M._maxListeners?w.defaultMaxListeners:M._maxListeners}function K(M,Z,P,x){var c,w,v,K;if(G(P),void 0===(w=M._events)?(w=M._events=Object.create(null),M._eventsCount=0):(void 0!==w.newListener&&(M.emit("newListener",Z,P.listener?P.listener:P),w=M._events),v=w[Z]),void 0===v)v=w[Z]=P,++M._eventsCount;else if("function"===typeof v?v=w[Z]=x?[P,v]:[v,P]:x?v.unshift(P):v.push(P),(c=mM(M))>0&&v.length>c&&!v.warned){v.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(Z)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.xZ=M,d.type=Z,d.count=v.length,K=d,console&&console.warn&&console.warn(K)}return M}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function O(M,Z,P){var x={fired:!1,wrapFn:void 0,target:M,type:Z,listener:P},c=d.bind(x);return c.listener=P,x.wrapFn=c,c}function H(M,Z,P){var x=M._events;if(void 0===x)return[];var c=x[Z];return void 0===c?[]:"function"===typeof c?P?[c.listener||c]:[c]:P?function(M){for(var Z=new Array(M.length),P=0;P<Z.length;++P)Z[P]=M[P].listener||M[P];return Z}(c):B(c,c.length)}function j(M){var Z=this._events;if(void 0!==Z){var P=Z[M];if("function"===typeof P)return 1;if(void 0!==P)return P.length}return 0}function B(M,Z){for(var P=new Array(Z),x=0;x<Z;++x)P[x]=M[x];return P}function U(M,Z,P,x){if("function"===typeof M.on)x.once?M.once(Z,P):M.on(Z,P);else{if("function"!==typeof M.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M);M.addEventListener(Z,(function c(w){x.once&&M.removeEventListener(Z,c),P(w)}))}}Object.defineProperty(w,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(M){if("number"!==typeof M||M<0||c(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");v=M}}),w.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},w.prototype.setMaxListeners=function(M){if("number"!==typeof M||M<0||c(M))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+M+".");return this._maxListeners=M,this},w.prototype.getMaxListeners=function(){return mM(this)},w.prototype.emit=function(M){for(var Z=[],P=1;P<arguments.length;P++)Z.push(arguments[P]);var c="error"===M,w=this._events;if(void 0!==w)c=c&&void 0===w.error;else if(!c)return!1;if(c){var v;if(Z.length>0&&(v=Z[0]),v instanceof Error)throw v;var G=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw G.context=v,G}var mM=w[M];if(void 0===mM)return!1;if("function"===typeof mM)x(mM,this,Z);else{var K=mM.length,d=B(mM,K);for(P=0;P<K;++P)x(d[P],this,Z)}return!0},w.prototype.addListener=function(M,Z){return K(this,M,Z,!1)},w.prototype.on=w.prototype.addListener,w.prototype.prependListener=function(M,Z){return K(this,M,Z,!0)},w.prototype.once=function(M,Z){return G(Z),this.on(M,O(this,M,Z)),this},w.prototype.prependOnceListener=function(M,Z){return G(Z),this.prependListener(M,O(this,M,Z)),this},w.prototype.removeListener=function(M,Z){var P,x,c,w,v;if(G(Z),void 0===(x=this._events))return this;if(void 0===(P=x[M]))return this;if(P===Z||P.listener===Z)0===--this._eventsCount?this._events=Object.create(null):(delete x[M],x.removeListener&&this.emit("removeListener",M,P.listener||Z));else if("function"!==typeof P){for(c=-1,w=P.length-1;w>=0;w--)if(P[w]===Z||P[w].listener===Z){v=P[w].listener,c=w;break}if(c<0)return this;0===c?P.shift():function(M,Z){for(;Z+1<M.length;Z++)M[Z]=M[Z+1];M.pop()}(P,c),1===P.length&&(x[M]=P[0]),void 0!==x.removeListener&&this.emit("removeListener",M,v||Z)}return this},w.prototype.off=w.prototype.removeListener,w.prototype.cZ=function(M){var Z,P,x;if(void 0===(P=this._events))return this;if(void 0===P.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==P[M]&&(0===--this._eventsCount?this._events=Object.create(null):delete P[M]),this;if(0===arguments.length){var c,w=Object.keys(P);for(x=0;x<w.length;++x)"removeListener"!==(c=w[x])&&this.cZ(c);return this.cZ("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(Z=P[M]))this.removeListener(M,Z);else if(void 0!==Z)for(x=Z.length-1;x>=0;x--)this.removeListener(M,Z[x]);return this},w.prototype.listeners=function(M){return H(this,M,!0)},w.prototype.rawListeners=function(M){return H(this,M,!1)},w.listenerCount=function(M,Z){return"function"===typeof M.listenerCount?M.listenerCount(Z):j.call(M,Z)},w.prototype.listenerCount=j,w.prototype.eventNames=function(){return this._eventsCount>0?Z(this._events):[]}},14601:M=>{"use strict";M.exports=function(M,Z,P,x,c,w){var v=+Z[0],G=+Z[1],mM=+Z[2],K=+P[0],d=+P[1],O=+P[2],H=Math.sqrt(K*K+d*d+O*O);if(0===H)throw new Error("Can't raycast along a zero vector");return function(M,Z,P,x,c,w,v,G,mM,K){for(var d=0,O=Math.floor,H=0|O(Z),j=0|O(P),B=0|O(x),U=c>0?1:-1,n=w>0?1:-1,L=v>0?1:-1,u=Math.abs(1/c),N=Math.abs(1/w),J=Math.abs(1/v),t=u<1/0?u*(U>0?H+1-Z:Z-H):1/0,F=N<1/0?N*(n>0?j+1-P:P-j):1/0,D=J<1/0?J*(L>0?B+1-x:x-B):1/0,l=-1;d<=G;){var h=M(H,j,B);if(h)return mM&&(mM[0]=Z+d*c,mM[1]=P+d*w,mM[2]=x+d*v),K&&(K[0]=K[1]=K[2]=0,0===l&&(K[0]=-U),1===l&&(K[1]=-n),2===l&&(K[2]=-L)),h;t<F?t<D?(H+=U,d=t,t+=u,l=0):(B+=L,d=D,D+=J,l=2):F<D?(j+=n,d=F,F+=N,l=1):(B+=L,d=D,D+=J,l=2)}return mM&&(mM[0]=Z+d*c,mM[1]=P+d*w,mM[2]=x+d*v),K&&(K[0]=K[1]=K[2]=0),0}(M,v,G,mM,K/=H,d/=H,O/=H,x="undefined"===typeof x?64:+x,c,w)}},14633:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>w});var x=P(14269);function c(){this.Zj=!1,this.stopPropagation=!1,this.Pj=!1,this.disabled=!1}class w{constructor(M,Z){this.version="0.7.0";var P=Object.assign({},new c,Z||{});this.element=M||document,this.Zj=!!P.Zj,this.stopPropagation=!!P.stopPropagation,this.Pj=!!P.Pj,this.disabled=!!P.disabled,this.filterEvents=(M,Z)=>!0,this.down=new x.EventEmitter,this.up=new x.EventEmitter,this.state={},this.Gd={dx:0,dy:0,Yj:0,vd:0,zj:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?G(this):document.addEventListener("DOMContentLoaded",(M=>{G(this)}),{once:!0})}bind(M){for(var Z=arguments.length,P=new Array(Z>1?Z-1:0),x=1;x<Z;x++)P[x-1]=arguments[x];P.forEach((Z=>{var P=this._keyBindmap[Z]||[];P.includes(M)||(P.push(M),this._keyBindmap[Z]=P)})),this.state[M]=!!this.state[M],this.pressCount[M]=this.pressCount[M]||0,this.releaseCount[M]=this.releaseCount[M]||0}unbind(M){for(var Z in this._keyBindmap){var P=this._keyBindmap[Z],x=P.indexOf(M);x>-1&&P.splice(x,1)}}getBindings(){var M={};for(var Z in this._keyBindmap){this._keyBindmap[Z].forEach((P=>{M[P]=M[P]||[],M[P].push(Z)}))}return M}wm(){v(this.Gd),v(this.pressCount),v(this.releaseCount)}}function v(M){for(var Z in M)M[Z]=0}function G(M){window.addEventListener("keydown",B.bind(null,M,!0),!1),window.addEventListener("keyup",B.bind(null,M,!1),!1);var Z={passive:!0};M.element.addEventListener("touchstart",O.bind(void 0,M),{passive:!1}),M.element.addEventListener("touchend",j.bind(void 0,M),Z),M.element.addEventListener("mousedown",U.bind(null,M,!0),Z),window.document.addEventListener("mouseup",U.bind(null,M,!1),Z),M.element.addEventListener("touchmove",n.bind(null,M),Z),M.element.addEventListener("mousemove",n.bind(null,M),Z),window.PointerEvent,M.element.addEventListener("wheel",L.bind(null,M),Z),M.element.addEventListener("contextmenu",u.bind(null,M),!1),window.addEventListener("blur",N.bind(null,M),!1)}var mM=0,K=0,d=null;function O(M,Z){Z.preventDefault(),H(Z)}function H(M){let Z=!1;for(let P=0;P<M.touches.length;++P)if(M.touches[P].identifier===d){Z=!0;break}if(!Z){const Z=M.changedTouches[0];mM=Z.clientX,K=Z.clientY,d=Z.identifier}}function j(M,Z){for(var P=Z.changedTouches,x=0;x<P.length;++x)P[x].identifier===d&&(d=null)}function B(M,Z,P){J(P.code,Z,M,P)}function U(M,Z,P){if("pointerId"in P)if(Z){if(null!==M._touches.currID)return;M._touches.currID=P.pointerId}else{if(M._touches.currID!==P.pointerId)return;M._touches.currID=null}return J("Mouse"+("button"in P?P.button+1:1),Z,M,P),!1}function n(M,Z){var P=Z.movementX||Z.mozMovementX||0,x=Z.movementY||Z.mozMovementY||0;if(Z.touches&&0===(P|x)){var c=function(M){H(M);for(let Z=0;Z<M.changedTouches.length;++Z)if(M.changedTouches[Z].identifier==d){const P=M.changedTouches[Z],x=[P.clientX-mM,P.clientY-K];return mM=P.clientX,K=P.clientY,x}return console.error(`Did not find touch id ${d}`),[0,0]}(Z);P=c[0],x=c[1]}M.Gd.dx+=P,M.Gd.dy+=x}function L(M,Z){var P=1;switch(Z.deltaMode){case 0:P=1;break;case 1:P=12;break;case 2:P=M.element.clientHeight||window.innerHeight}M.Gd.Yj+=(Z.deltaX||0)*P,M.Gd.vd+=(Z.deltaY||0)*P,M.Gd.zj+=(Z.deltaZ||0)*P}function u(M,Z){if(!M.Pj)return Z.preventDefault(),!1}function N(M){for(var Z in M._keyStates)M._keyStates[Z]&&(/^Mouse\d/.test(Z)||J(Z,!1,M,{code:Z,note:"z0s4n0tuqvj",preventDefault:()=>{},stopPropagation:()=>{}}))}function J(M,Z,P,x){var c=P._keyBindmap[M];c&&(t(P._keyStates[M],Z)&&(P._keyStates[M]=Z,c.forEach((M=>{(!P.filterEvents||P.filterEvents(x,M))&&function(M,Z,P,x){var c=Z?P.pressCount:P.releaseCount;c[M]=(c[M]||0)+1;var w=P._bindPressCount[M]||0;(w+=Z?1:-1)<0&&(w=0);P._bindPressCount[M]=w;var v=P.state[M];if(t(v,w)){P.state[M]=w>0;var G=Z?P.down:P.up;P.disabled||G.emit(M,x)}}(M,Z,P,x)}))),"button"in x||(P.Zj&&!x.defaultPrevented&&x.preventDefault(),P.stopPropagation&&x.stopPropagation()))}function t(M,Z){return M?!Z:Z}},13277:M=>{M.exports=function(M,Z,P){return M[0]=Z[0]+P[0],M[1]=Z[1]+P[1],M[2]=Z[2]+P[2],M}},13234:(M,Z,P)=>{M.exports=function(M,Z){var P=x(M[0],M[1],M[2]),v=x(Z[0],Z[1],Z[2]);c(P,P),c(v,v);var G=w(P,v);return G>1?0:Math.acos(G)};var x=P(13243),c=P(13251),w=P(13253)},13334:M=>{M.exports=function(M,Z){return M[0]=Math.ceil(Z[0]),M[1]=Math.ceil(Z[1]),M[2]=Math.ceil(Z[2]),M}},13226:M=>{M.exports=function(M){var Z=new Float32Array(3);return Z[0]=M[0],Z[1]=M[1],Z[2]=M[2],Z}},13255:M=>{M.exports=function(M,Z){return M[0]=Z[0],M[1]=Z[1],M[2]=Z[2],M}},13220:M=>{M.exports=function(){var M=new Float32Array(3);return M[0]=0,M[1]=0,M[2]=0,M}},13406:M=>{M.exports=function(M,Z,P){var x=Z[0],c=Z[1],w=Z[2],v=P[0],G=P[1],mM=P[2];return M[0]=c*mM-w*G,M[1]=w*v-x*mM,M[2]=x*G-c*v,M}},13356:(M,Z,P)=>{M.exports=P(13353)},13353:M=>{M.exports=function(M,Z){var P=Z[0]-M[0],x=Z[1]-M[1],c=Z[2]-M[2];return Math.sqrt(P*P+x*x+c*c)}},13311:(M,Z,P)=>{M.exports=P(13304)},13304:M=>{M.exports=function(M,Z,P){return M[0]=Z[0]/P[0],M[1]=Z[1]/P[1],M[2]=Z[2]/P[2],M}},13253:M=>{M.exports=function(M,Z){return M[0]*Z[0]+M[1]*Z[1]+M[2]*Z[2]}},13212:M=>{M.exports=1e-6},13263:(M,Z,P)=>{M.exports=function(M,Z){var P=M[0],c=M[1],w=M[2],v=Z[0],G=Z[1],mM=Z[2];return Math.abs(P-v)<=x*Math.max(1,Math.abs(P),Math.abs(v))&&Math.abs(c-G)<=x*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(w-mM)<=x*Math.max(1,Math.abs(w),Math.abs(mM))};var x=P(13212)},13271:M=>{M.exports=function(M,Z){return M[0]===Z[0]&&M[1]===Z[1]&&M[2]===Z[2]}},13332:M=>{M.exports=function(M,Z){return M[0]=Math.floor(Z[0]),M[1]=Math.floor(Z[1]),M[2]=Math.floor(Z[2]),M}},13443:(M,Z,P)=>{M.exports=function(M,Z,P,c,w,v){var G,mM;Z||(Z=3);P||(P=0);mM=c?Math.min(c*Z+P,M.length):M.length;for(G=P;G<mM;G+=Z)x[0]=M[G],x[1]=M[G+1],x[2]=M[G+2],w(x,x,v),M[G]=x[0],M[G+1]=x[1],M[G+2]=x[2];return M};var x=P(13220)()},13243:M=>{M.exports=function(M,Z,P){var x=new Float32Array(3);return x[0]=M,x[1]=Z,x[2]=P,x}},13205:(M,Z,P)=>{M.exports={EPSILON:P(13212),create:P(13220),clone:P(13226),angle:P(13234),pG:P(13243),i:P(13255),set:P(13261),equals:P(13263),exactEquals:P(13271),add:P(13277),UZ:P(13285),sub:P(13293),multiply:P(13295),mul:P(13301),divide:P(13304),div:P(13311),min:P(13319),max:P(13326),floor:P(13332),ceil:P(13334),round:P(13341),scale:P(13343),SG:P(13351),distance:P(13353),j:P(13356),squaredDistance:P(13363),sqrDist:P(13372),length:P(13381),len:P(13386),squaredLength:P(13388),XG:P(13393),negate:P(13398),inverse:P(13401),normalize:P(13251),dot:P(13253),cross:P(13406),eG:P(13412),random:P(13414),transformMat4:P(13416),transformMat3:P(13422),transformQuat:P(13429),VG:P(13431),gG:P(13439),Mm:P(13441),forEach:P(13443)}},13401:M=>{M.exports=function(M,Z){return M[0]=1/Z[0],M[1]=1/Z[1],M[2]=1/Z[2],M}},13386:(M,Z,P)=>{M.exports=P(13381)},13381:M=>{M.exports=function(M){var Z=M[0],P=M[1],x=M[2];return Math.sqrt(Z*Z+P*P+x*x)}},13412:M=>{M.exports=function(M,Z,P,x){var c=Z[0],w=Z[1],v=Z[2];return M[0]=c+x*(P[0]-c),M[1]=w+x*(P[1]-w),M[2]=v+x*(P[2]-v),M}},13326:M=>{M.exports=function(M,Z,P){return M[0]=Math.max(Z[0],P[0]),M[1]=Math.max(Z[1],P[1]),M[2]=Math.max(Z[2],P[2]),M}},13319:M=>{M.exports=function(M,Z,P){return M[0]=Math.min(Z[0],P[0]),M[1]=Math.min(Z[1],P[1]),M[2]=Math.min(Z[2],P[2]),M}},13301:(M,Z,P)=>{M.exports=P(13295)},13295:M=>{M.exports=function(M,Z,P){return M[0]=Z[0]*P[0],M[1]=Z[1]*P[1],M[2]=Z[2]*P[2],M}},13398:M=>{M.exports=function(M,Z){return M[0]=-Z[0],M[1]=-Z[1],M[2]=-Z[2],M}},13251:M=>{M.exports=function(M,Z){var P=Z[0],x=Z[1],c=Z[2],w=P*P+x*x+c*c;w>0&&(w=1/Math.sqrt(w),M[0]=Z[0]*w,M[1]=Z[1]*w,M[2]=Z[2]*w);return M}},13414:M=>{M.exports=function(M,Z){Z=Z||1;var P=2*Math.random()*Math.PI,x=2*Math.random()-1,c=Math.sqrt(1-x*x)*Z;return M[0]=Math.cos(P)*c,M[1]=Math.sin(P)*c,M[2]=x*Z,M}},13431:M=>{M.exports=function(M,Z,P,x){var c=P[1],w=P[2],v=Z[1]-c,G=Z[2]-w,mM=Math.sin(x),K=Math.cos(x);return M[0]=Z[0],M[1]=c+v*K-G*mM,M[2]=w+v*mM+G*K,M}},13439:M=>{M.exports=function(M,Z,P,x){var c=P[0],w=P[2],v=Z[0]-c,G=Z[2]-w,mM=Math.sin(x),K=Math.cos(x);return M[0]=c+G*mM+v*K,M[1]=Z[1],M[2]=w+G*K-v*mM,M}},13441:M=>{M.exports=function(M,Z,P,x){var c=P[0],w=P[1],v=Z[0]-c,G=Z[1]-w,mM=Math.sin(x),K=Math.cos(x);return M[0]=c+v*K-G*mM,M[1]=w+v*mM+G*K,M[2]=Z[2],M}},13341:M=>{M.exports=function(M,Z){return M[0]=Math.round(Z[0]),M[1]=Math.round(Z[1]),M[2]=Math.round(Z[2]),M}},13343:M=>{M.exports=function(M,Z,P){return M[0]=Z[0]*P,M[1]=Z[1]*P,M[2]=Z[2]*P,M}},13351:M=>{M.exports=function(M,Z,P,x){return M[0]=Z[0]+P[0]*x,M[1]=Z[1]+P[1]*x,M[2]=Z[2]+P[2]*x,M}},13261:M=>{M.exports=function(M,Z,P,x){return M[0]=Z,M[1]=P,M[2]=x,M}},13372:(M,Z,P)=>{M.exports=P(13363)},13393:(M,Z,P)=>{M.exports=P(13388)},13363:M=>{M.exports=function(M,Z){var P=Z[0]-M[0],x=Z[1]-M[1],c=Z[2]-M[2];return P*P+x*x+c*c}},13388:M=>{M.exports=function(M){var Z=M[0],P=M[1],x=M[2];return Z*Z+P*P+x*x}},13293:(M,Z,P)=>{M.exports=P(13285)},13285:M=>{M.exports=function(M,Z,P){return M[0]=Z[0]-P[0],M[1]=Z[1]-P[1],M[2]=Z[2]-P[2],M}},13422:M=>{M.exports=function(M,Z,P){var x=Z[0],c=Z[1],w=Z[2];return M[0]=x*P[0]+c*P[3]+w*P[6],M[1]=x*P[1]+c*P[4]+w*P[7],M[2]=x*P[2]+c*P[5]+w*P[8],M}},13416:M=>{M.exports=function(M,Z,P){var x=Z[0],c=Z[1],w=Z[2],v=P[3]*x+P[7]*c+P[11]*w+P[15];return v=v||1,M[0]=(P[0]*x+P[4]*c+P[8]*w+P[12])/v,M[1]=(P[1]*x+P[5]*c+P[9]*w+P[13])/v,M[2]=(P[2]*x+P[6]*c+P[10]*w+P[14])/v,M}},13429:M=>{M.exports=function(M,Z,P){var x=Z[0],c=Z[1],w=Z[2],v=P[0],G=P[1],mM=P[2],K=P[3],d=K*x+G*w-mM*c,O=K*c+mM*x-v*w,H=K*w+v*c-G*x,j=-v*x-G*c-mM*w;return M[0]=d*K+j*-v+O*-mM-H*-G,M[1]=O*K+j*-G+H*-v-d*-mM,M[2]=H*K+j*-mM+d*-G-O*-v,M}},14288:M=>{"use strict";M.exports=function(M){for(var Z=new Array(M),P=0;P<M;++P)Z[P]=P;return Z}},14368:M=>{M.exports=function(M){return null!=M&&null!=M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}},14609:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>x});class x{constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.rO=!1,this.qO=!1,this.oO=30,this.EO=0,this.iO=!1,this.fullscreen=!1,this.bO=function(M){},this.aO=function(){},this.YO=function(){},this.nx=function(){},this.yO=function(M){},this.onFullscreenChanged=function(M){},K((()=>{!function(M,Z){M._nowObject=performance||Date,M._lastTick=0,M._renderAccum=0,M._rt=0,M._frameCB=G.bind(null,M),requestAnimationFrame(M._frameCB),Z>0&&(M._intervalCB=v.bind(null,M),M._interval=setInterval(M._intervalCB,Math.max(Z,1e3/M.oO/2)))}(this,Z),function(M,Z){if(!Z)return;var P=!1,x=!1;document.addEventListener("pointerlockchange",(x=>{P=document.pointerLockElement===Z,M.yO(P)})),document.addEventListener("fullscreenchange",(P=>{x=document.fullscreenElement===Z,M.onFullscreenChanged(x)})),Object.defineProperty(M,"iO",{get:()=>P,set:M=>{M&&!P?mM(Z):P&&!M&&function(M){M.exitPointerLock&&M.exitPointerLock()}(document)}}),Object.defineProperty(M,"fullscreen",{get:()=>x,set:M=>{M&&!x?Z.requestFullscreen():x&&!M&&document.exitFullscreen()}}),Z.addEventListener("click",(c=>{M.rO&&!P&&mM(Z),M.qO&&!x&&Z.requestFullscreen()}));var c=()=>M.nx();if(window.ResizeObserver){new ResizeObserver(c).observe(Z)}else window.addEventListener("resize",c)}(this,M),this.YO()}))}}var c=3,w=20;function v(M){for(var Z=1e3/M.oO,P=M._nowObject.now()+w,x=0;M._nowObject.now()>=M._lastTick+Z&&M._nowObject.now()<P&&++x<=c;)M.bO(Z),M._lastTick+=Z;var v=5*(Z+5),G=M._nowObject.now();if(G-M._lastTick>v)for(;G>=M._lastTick+Z;)M._lastTick+=Z}function G(M){requestAnimationFrame(M._frameCB),v(M);var Z=M._nowObject.now(),P=Z-M._rt;if(M._rt=Z,M.EO>0){M._renderAccum+=P;var x=1e3/M.EO;if(M._renderAccum<x)return;M._renderAccum=Math.min(M._renderAccum-x,x)}var c=1e3/M.oO,w=(Z-M._lastTick)/c;M.aO(P,w,c)}function mM(M){M.requestPointerLock&&M.requestPointerLock()}var K=M=>{if("loading"===document.readyState){var Z=()=>{document.removeEventListener("readystatechange",Z),M()};document.addEventListener("readystatechange",Z)}else setTimeout(M,1)}},14285:(M,Z,P)=>{var x=P(14288),c=P(14296),w="undefined"!==typeof Float64Array;function v(M,Z){return M[0]-Z[0]}function G(){var M,Z=this.stride,P=new Array(Z.length);for(M=0;M<P.length;++M)P[M]=[Math.abs(Z[M]),M];P.sort(v);var x=new Array(P.length);for(M=0;M<x.length;++M)x[M]=P[M][1];return x}function mM(M,Z){var P=["View",Z,"d",M].join("");Z<0&&(P="View_Nil"+M);var c="generic"===M;if(-1===Z){var w="function "+P+"(a){this.data=a;};var proto="+P+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+P+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+P+"(a){return new "+P+"(a);}";return new Function(w)()}if(0===Z){w="function "+P+"(a,d) {this.data = a;this.offset = d};var proto="+P+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+P+"_copy() {return new "+P+"(this.data,this.offset)};proto.pick=function "+P+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+P+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+P+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+P+"(a,b,c,d){return new "+P+"(a,d)}";return new Function("TrivialArray",w)(K[M][0])}w=["'use strict'"];var v=x(Z),mM=v.map((function(M){return"i"+M})),d="this.offset+"+v.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),O=v.map((function(M){return"b"+M})).join(","),H=v.map((function(M){return"c"+M})).join(",");w.push("function "+P+"(a,"+O+","+H+",d){this.data=a","this.shape=["+O+"]","this.stride=["+H+"]","this.offset=d|0}","var proto="+P+".prototype","proto.dtype='"+M+"'","proto.dimension="+Z),w.push("Object.defineProperty(proto,'size',{get:function "+P+"_size(){return "+v.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===Z?w.push("proto.order=[0]"):(w.push("Object.defineProperty(proto,'order',{get:"),Z<4?(w.push("function "+P+"_order(){"),2===Z?w.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Z&&w.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):w.push("ORDER})")),w.push("proto.set=function "+P+"_set("+mM.join(",")+",v){"),c?w.push("return this.data.set("+d+",v)}"):w.push("return this.data["+d+"]=v}"),w.push("proto.get=function "+P+"_get("+mM.join(",")+"){"),c?w.push("return this.data.get("+d+")}"):w.push("return this.data["+d+"]}"),w.push("proto.index=function "+P+"_index(",mM.join(),"){return "+d+"}"),w.push("proto.hi=function "+P+"_hi("+mM.join(",")+"){return new "+P+"(this.data,"+v.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+v.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var j=v.map((function(M){return"a"+M+"=this.shape["+M+"]"})),B=v.map((function(M){return"c"+M+"=this.stride["+M+"]"}));w.push("proto.lo=function "+P+"_lo("+mM.join(",")+"){var b=this.offset,d=0,"+j.join(",")+","+B.join(","));for(var U=0;U<Z;++U)w.push("if(typeof i"+U+"==='number'&&i"+U+">=0){d=i"+U+"|0;b+=c"+U+"*d;a"+U+"-=d}");w.push("return new "+P+"(this.data,"+v.map((function(M){return"a"+M})).join(",")+","+v.map((function(M){return"c"+M})).join(",")+",b)}"),w.push("proto.step=function "+P+"_step("+mM.join(",")+"){var "+v.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+v.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(U=0;U<Z;++U)w.push("if(typeof i"+U+"==='number'){d=i"+U+"|0;if(d<0){c+=b"+U+"*(a"+U+"-1);a"+U+"=ceil(-a"+U+"/d)}else{a"+U+"=ceil(a"+U+"/d)}b"+U+"*=d}");w.push("return new "+P+"(this.data,"+v.map((function(M){return"a"+M})).join(",")+","+v.map((function(M){return"b"+M})).join(",")+",c)}");var n=new Array(Z),L=new Array(Z);for(U=0;U<Z;++U)n[U]="a[i"+U+"]",L[U]="b[i"+U+"]";w.push("proto.transpose=function "+P+"_transpose("+mM+"){"+mM.map((function(M,Z){return M+"=("+M+"===undefined?"+Z+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+P+"(this.data,"+n.join(",")+","+L.join(",")+",this.offset)}"),w.push("proto.pick=function "+P+"_pick("+mM+"){var a=[],b=[],c=this.offset");for(U=0;U<Z;++U)w.push("if(typeof i"+U+"==='number'&&i"+U+">=0){c=(c+this.stride["+U+"]*i"+U+")|0}else{a.push(this.shape["+U+"]);b.push(this.stride["+U+"])}");return w.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),w.push("return function construct_"+P+"(data,shape,stride,offset){return new "+P+"(data,"+v.map((function(M){return"shape["+M+"]"})).join(",")+","+v.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",w.join("\n"))(K[M],G)}var K={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,Z,P,x){if(void 0===M)return(0,K.array[0])([]);"number"===typeof M&&(M=[M]),void 0===Z&&(Z=[M.length]);var v=Z.length;if(void 0===P){P=new Array(v);for(var G=v-1,d=1;G>=0;--G)P[G]=d,d*=Z[G]}if(void 0===x){x=0;for(G=0;G<v;++G)P[G]<0&&(x-=(Z[G]-1)*P[G])}for(var O=function(M){if(c(M))return"buffer";if(w)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),H=K[O];H.length<=v+1;)H.push(mM(O,H.length-1));return(0,H[v+1])(M,Z,P,x)}},14296:M=>{function Z(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(Z(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&Z(M.slice(0,0))}(M)||!!M._isBuffer)}},14461:M=>{"use strict";var Z=[],P=[],x=[],c=[],w=[],v=[],G=[],mM=[],K=[],d=[],O=[],H=[];M.exports=function(M,j,B,U,n,L){for(var u=G,N=K,J=d,t=H,F=0;F<3;F++)u[F]=+B[F],J[F]=+j.max[F],N[F]=+j.base[F];L||(L=1e-10);var D=function(M,G,K,d,H,j){var B=Z,U=P,n=x,L=c,u=w,N=v,J=mM,t=Math.floor,F=0,D=0,l=0,h=0,Q=0;if(I(),0===l)return 0;for(h=R();D<=l;){if(s(h)&&C())return F;h=R()}for(F+=l,Q=0;Q<3;Q++)d[Q]+=K[Q],H[Q]+=K[Q];return F;function I(){if(D=0,0!==(l=Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2])))for(var M=0;M<3;M++){var Z=K[M]>=0;L[M]=Z?1:-1;var P=Z?H[M]:d[M];B[M]=Z?d[M]:H[M],U[M]=W(P,L[M]),n[M]=k(B[M],L[M]),J[M]=K[M]/l,u[M]=Math.abs(1/J[M]);var x=Z?U[M]+1-P:P-U[M];N[M]=u[M]<1/0?u[M]*x:1/0}}function s(Z){for(var P=L[0],x=0===Z?U[0]:n[0],c=U[0]+P,w=L[1],v=1===Z?U[1]:n[1],G=U[1]+w,mM=L[2],K=2===Z?U[2]:n[2],d=U[2]+mM,O=x;O!=c;O+=P)for(var H=v;H!=G;H+=w)for(var j=K;j!=d;j+=mM)if(M(O,H,j))return!0;return!1}function C(){F+=D;var M=L[h],Z=D/l,P=O;for(Q=0;Q<3;Q++){var x=K[Q]*Z;d[Q]+=x,H[Q]+=x,P[Q]=K[Q]-x}if(M>0?H[h]=Math.round(H[h]):d[h]=Math.round(d[h]),G(F,h,M,P))return!0;for(Q=0;Q<3;Q++)K[Q]=P[Q];return I(),0===l}function R(){var M=N[0]<N[1]?N[0]<N[2]?0:2:N[1]<N[2]?1:2,Z=N[M]-D;for(D=N[M],U[M]+=L[M],N[M]+=u[M],Q=0;Q<3;Q++)B[Q]+=Z*J[Q],n[Q]=k(B[Q],L[Q]);return M}function W(M,Z){return t(M-Z*j)}function k(M,Z){return t(M+Z*j)}}(M,U,u,N,J,L);if(!n){for(F=0;F<3;F++)t[F]=B[F]>0?J[F]-j.max[F]:N[F]-j.base[F];j.translate(t)}return D}},14641:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>O});var x=P(14459),c=P(13205);class w{constructor(M,Z,P,w,v,G,mM){this.nd=new x(M.base,M.Xd),this.Qx=Z,this.friction=P,this.restitution=w,this.WG=v,this.OB=G,this.kG=!!mM,this.Td=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.VB=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.qK=c.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=c.create(),this._impulses=c.create(),this._sleepFrameCount=10}loadFromCopy(M){c.i(this.nd.base,M.nd.base),c.i(this.nd.Xd,M.nd.Xd),c.i(this.nd.max,M.nd.max),this.nd.mag=M.nd.mag,this.Qx=M.Qx,this.friction=M.friction,this.restitution=M.restitution,this.WG=M.WG,this.OB=M.OB,this.kG=M.kG,this.Td=M.Td,this.fluidDrag=M.fluidDrag,this.VB=M.VB,this.preventFallOffEdge=M.preventFallOffEdge,this.rolledBackLastTick=M.rolledBackLastTick,c.i(this.qK,M.qK),c.i(this.resting,M.resting),this.inFluid=M.inFluid,this._ratioInFluid=M._ratioInFluid,c.i(this._forces,M._forces),c.i(this._impulses,M._impulses),this._sleepFrameCount=M._sleepFrameCount}setPosition(M){v(M),c.UZ(M,M,this.nd.base),this.nd.translate(M),this.aK()}Mc(){return c.clone(this.nd.base)}applyForce(M){v(M),c.add(this._forces,this._forces,M),this.aK()}applyImpulse(M){v(M),c.add(this._impulses,this._impulses,M),this.aK()}aK(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var v=M=>{};var G=P(14459),mM=P(13205),K=P(14461);function d(){this.Td=.1,this.fluidDrag=.4,this.qG=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function O(M,Z,P){M=Object.assign(new d,M),this.gravity=M.gravity||[0,-10,0],this.Td=M.Td||.1,this.qG=M.qG||2,this.fluidDrag=M.fluidDrag||.4,this.minBounceImpulse=M.minBounceImpulse,this.bodies=[],this.Aj=M.Aj,this.testSolid=Z,this.testFluid=P}O.prototype.uB=function(M,Z,P,x,c,v){M=M||new G([0,0,0],[1,1,1]),"undefined"==typeof Z&&(Z=1),"undefined"==typeof P&&(P=1),"undefined"==typeof x&&(x=0),"undefined"==typeof c&&(c=1);var mM=new w(M,Z,P,x,c,v);return this.bodies.push(mM),mM},O.prototype.NB=function(M){var Z=this.bodies.indexOf(M);Z<0||(this.bodies.splice(Z,1),M.nd=M.OB=null)};var H=mM.create(),j=mM.create(),B=mM.create(),U=mM.create(),n=mM.create(),L=mM.create(),u=mM.create(),N=new G([0,0,0],[1,1,1]),J=new w(N,1,1,0,1,(()=>{}),!1);function t(M,Z,P){return Z=P,Z*=1-(1-M.ratioInFluid)**2}O.prototype.wm=function(M){M/=1e3;var Z=q(0,mM.squaredLength(this.gravity));this.bodies.forEach((P=>function(M,Z,P,x){mM.i(n,Z.resting),M.Aj&&J.loadFromCopy(Z);if(Z.Qx<=0)return mM.set(Z.qK,0,0,0),mM.set(Z._forces,0,0,0),void mM.set(Z._impulses,0,0,0);var c=x||0===Z.WG;if(function(M,Z,P,x){if(Z._sleepFrameCount>0)return!1;if(x)return!0;var c=!1,w=.5*P*P*Z.WG;return mM.scale(r,M.gravity,w),K(M.testSolid,Z.nd,r,(function(){return c=!0,!0}),!0),c}(M,Z,P,c))return;Z._sleepFrameCount--,function(M,Z){var P=Z.nd,x=Math.floor(P.base[0]),c=Math.floor(P.base[2]),w=Math.floor(P.base[1]),v=Math.floor(P.max[1]);if(!M.testFluid(x,w,c))return Z.inFluid=!1,void(Z.ratioInFluid=0);var G=1,K=w+1;for(;K<=v&&M.testFluid(x,K,c);)G++,K++;var d=(w+G-P.base[1])/P.Xd[1];d>1&&(d=1);var O=P.Xd[0]*P.Xd[1]*P.Xd[2]*d,H=D;mM.scale(H,M.gravity,-M.qG*O*Z.WG),Z.applyForce(H),Z.inFluid=!0,Z.ratioInFluid=d}(M,Z),b(Z._forces),b(Z._impulses),b(Z.qK),b(Z.resting),mM.scale(H,Z._forces,1/Z.Qx),mM.SG(H,H,M.gravity,Z.WG),mM.scale(j,Z._impulses,1/Z.Qx),mM.SG(j,j,H,P),mM.add(Z.qK,Z.qK,j),Z.friction&&(l(M,0,Z,j,P),l(M,1,Z,j,P),l(M,2,Z,j,P));var w=Z.fluidDrag>=0?Z.fluidDrag:M.fluidDrag,v=Z.Td>=0?Z.Td:M.Td,G=v,d=v;Z.inFluid&&(G=t(Z,G,Z.fluidDragHoriz>=0?Z.fluidDragHoriz:w),d=t(Z,d,Z.fluidDragVert>=0?Z.fluidDragVert:w));G=Math.max(1-G*P/Z.Qx,0),d=Math.max(1-d*P/Z.Qx,0),mM.set(F,G,d,G),mM.multiply(Z.qK,Z.qK,F),mM.scale(B,Z.qK,P),mM.set(Z._forces,0,0,0),mM.set(Z._impulses,0,0,0),Z.kG&&e(I,Z.nd);mM.i(L,B),mM.set(u,0,0,0),Z.preventFallOffEdge&&function(M,Z,P,x){if(!Z.resting[1]||P[1]>0)return;var c=A;e(c,Z.nd);for(var w=0;w<3;w+=2){mM.set(k,0,0,0),k[w]=P[w];var v=!0;(v=(v=(v=(v=v&&!E(M,c.base[0]+k[0]+1e-5,c.base[1],c.base[2]+k[2]+1e-5))&&!E(M,c.max[0]+k[0]-1e-5,c.base[1],c.base[2]+k[2]+1e-5))&&!E(M,c.base[0]+k[0]+1e-5,c.base[1],c.max[2]+k[2]-1e-5))&&!E(M,c.max[0]+k[0]-1e-5,c.base[1],c.max[2]+k[2]-1e-5))?(x[w]=P[w]>0?1:-1,P[w]=0):0===w&&(mM.set(o,P[0],0,0),Q(M,c,o,x,Z.slideOnCollision))}}(M,Z,B,u);Q(M,Z.nd,B,Z.resting,Z.slideOnCollision),Z.kG&&function(M,Z,P,x){if(Z.resting[1]>=0&&!Z.inFluid)return;var c=0!==Z.resting[0],w=0!==Z.resting[2];if(!c&&!w)return;var v=Math.abs(x[0]/x[2]),G=4;if(!c&&v>G)return;if(!w&&v<1/G)return;mM.add(C,P.base,x);var d=M.testSolid;K(d,P,x,(function(M,Z,P,x){if(1!==Z)return!0;x[Z]=0}));var O=P.base[1],H=Z.inFluid?1.951:1.001,j=Math.floor(O+H)-O;mM.set(R,0,j,0);var B=!1;if(K(d,P,R,(function(M,Z,P,x){return B=!0,!0})),B)return;mM.UZ(W,C,P.base),W[1]=0,Q(M,P,W,s,!0);var U=q(P.base[0],C[0]),n=q(P.base[2],C[2]);if(c&&!U&&(!n||!w))return;if(w&&(!U||!c)&&!n)return;var L=!0;if(L=L&&!E(M,P.base[0]+1e-5,P.base[1],P.base[2]+1e-5),L=L&&!E(M,P.max[0]-1e-5,P.base[1],P.base[2]+1e-5),L=L&&!E(M,P.base[0]+1e-5,P.base[1],P.max[2]-1e-5),L=L&&!E(M,P.max[0]-1e-5,P.base[1],P.max[2]-1e-5),L)return;e(Z.nd,P),Z.resting[0]=s[0],Z.resting[2]=s[2],Z.VB&&Z.VB()}(M,Z,I,L);for(var O=0;O<3;++O)Z.resting[O]=Z.resting[O]||u[O],U[O]=0,Z.resting[O]&&(n[O]||(U[O]=-Z.qK[O]),Z.qK[O]=0);var N=mM.length(U);N>.001&&(mM.scale(U,U,Z.Qx),Z.OB&&Z.OB(U),Z.restitution>0&&N>M.minBounceImpulse&&(mM.scale(U,U,Z.restitution),Z.applyImpulse(U)));var h=mM.squaredLength(Z.qK);h>1e-5&&Z.aK();M.Aj&&M.Aj(Z)?(Z.loadFromCopy(J),Z.rolledBackLastTick=!0):Z.rolledBackLastTick=!1}(this,P,M,Z)))};var F=mM.create([0,0,0]);var D=mM.create();function l(M,Z,P,x,c){var w=P.resting[Z],v=x[Z];if(!P.alwaysApplyHorizFriction||1!==Z){if(0===w)return;if(w*v<=0)return}mM.i(h,P.qK),h[Z]=0;var G=mM.length(h);if(!q(G,0)){var K=Math.abs(P.friction*M.gravity[Z]*c),d=G>K?(G-K)/G:0;P.qK[(Z+1)%3]*=d,P.qK[(Z+2)%3]*=d}}var h=mM.create();function Q(M,Z,P,x,c){return mM.set(x,0,0,0),K(M.testSolid,Z,P,(function(M,Z,P,w){x[Z]=P,w[Z]=0,c||(w[0]=0,w[1]=0,w[2]=0)}))}var I=new G([],[]),s=mM.create(),C=mM.create(),R=mM.create(),W=mM.create();var k=mM.create(),A=new G([],[]),o=mM.create();function E(M,Z,P,x){return M.testSolid(Math.floor(Z),Math.floor(P-1),Math.floor(x))}var r=mM.create();function q(M,Z){return Math.abs(M-Z)<1e-5}function e(M,Z){for(var P=0;P<3;P++)M.base[P]=Z.base[P],M.max[P]=Z.max[P],M.Xd[P]=Z.Xd[P]}var b=function(M){}},13062:function(M,Z){!function(M){"use strict";var Z=function(M,P){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,Z){M.__proto__=Z}||function(M,Z){for(var P in Z)Object.prototype.hasOwnProperty.call(Z,P)&&(M[P]=Z[P])},Z(M,P)};function P(M,P){if("function"!==typeof P&&null!==P)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function x(){this.constructor=M}Z(M,P),M.prototype=null===P?Object.create(P):(x.prototype=P.prototype,new x)}function x(M,Z,P,x){var c,w=arguments.length,v=w<3?Z:null===x?x=Object.getOwnPropertyDescriptor(Z,P):x;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)v=Reflect.decorate(M,Z,P,x);else for(var G=M.length-1;G>=0;G--)(c=M[G])&&(v=(w<3?c(v):w>3?c(Z,P,v):c(Z,P))||v);return w>3&&v&&Object.defineProperty(Z,P,v),v}function c(M,Z,P){if(P||2===arguments.length)for(var x,c=0,w=Z.length;c<w;c++)!x&&c in Z||(x||(x=Array.prototype.slice.call(Z,0,c)),x[c]=Z[c]);return M.concat(x||Array.prototype.slice.call(Z))}var w,v=255,G=213;M.OPERATION=void 0,(w=M.OPERATION||(M.OPERATION={}))[w.ADD=128]="ADD",w[w.REPLACE=0]="REPLACE",w[w.DELETE=64]="DELETE",w[w.DELETE_AND_ADD=192]="DELETE_AND_ADD",w[w.TOUCH=1]="TOUCH",w[w.CLEAR=10]="CLEAR";var mM=function(){function Z(M,Z,P){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=M,this.setParent(Z,P)}return Z.prototype.setParent=function(M,Z,P){var x=this;if(this.indexes||(this.indexes=this.ref instanceof WM?this.ref._definition.indexes:{}),this.parent=M,this.parentIndex=P,Z)if(this.root=Z,this.ref instanceof WM){var c=this.ref._definition;for(var w in c.schema){var v=this.ref[w];if(v&&v.$changes){var G=c.indexes[w];v.$changes.setParent(this.ref,Z,G)}}}else"object"===typeof this.ref&&this.ref.forEach((function(M,Z){if(M instanceof WM){var P=M.$changes,c=x.ref.$changes.indexes[Z];P.setParent(x.ref,x.root,c)}}))},Z.prototype.operation=function(M){this.changes.set(--this.currentCustomOperation,M)},Z.prototype.change=function(Z,P){void 0===P&&(P=M.OPERATION.ADD);var x="number"===typeof Z?Z:this.indexes[Z];this.assertValidIndex(x,Z);var c=this.changes.get(x);c&&c.op!==M.OPERATION.DELETE&&c.op!==M.OPERATION.TOUCH||this.changes.set(x,{op:c&&c.op===M.OPERATION.DELETE?M.OPERATION.DELETE_AND_ADD:P,index:x}),this.allChanges.add(x),this.changed=!0,this.touchParents()},Z.prototype.touch=function(Z){var P="number"===typeof Z?Z:this.indexes[Z];this.assertValidIndex(P,Z),this.changes.has(P)||this.changes.set(P,{op:M.OPERATION.TOUCH,index:P}),this.allChanges.add(P),this.touchParents()},Z.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},Z.prototype.getType=function(M){if(this.ref._definition)return(Z=this.ref._definition).schema[Z.fieldsByIndex[M]];var Z,P=(Z=this.parent._definition).schema[Z.fieldsByIndex[this.parentIndex]];return Object.values(P)[0]},Z.prototype.getChildrenFilter=function(){var M=this.parent._definition.childFilters;return M&&M[this.parentIndex]},Z.prototype.getValue=function(M){return this.ref.getByIndex(M)},Z.prototype.delete=function(Z){var P="number"===typeof Z?Z:this.indexes[Z];if(void 0!==P){var x=this.getValue(P);this.changes.set(P,{op:M.OPERATION.DELETE,index:P}),this.allChanges.delete(P),delete this.caches[P],x&&x.$changes&&(x.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(Z," (").concat(P,")"))},Z.prototype.discard=function(Z,P){var x=this;void 0===Z&&(Z=!1),void 0===P&&(P=!1),this.ref instanceof WM||this.changes.forEach((function(Z){if(Z.op===M.OPERATION.DELETE){var P=x.ref.getIndex(Z.index);delete x.indexes[P]}})),this.changes.clear(),this.changed=Z,P&&this.allChanges.clear(),this.currentCustomOperation=0},Z.prototype.discardAll=function(){var M=this;this.changes.forEach((function(Z){var P=M.getValue(Z.index);P&&P.$changes&&P.$changes.discardAll()})),this.discard()},Z.prototype.cache=function(M,Z){this.caches[M]=Z},Z.prototype.clone=function(){return new Z(this.ref,this.parent,this.root)},Z.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},Z.prototype.assertValidIndex=function(M,Z){if(void 0===M)throw new Error('ChangeTree: missing index for field "'.concat(Z,'"'))},Z}();function K(M,Z,P,x){return M[Z]||(M[Z]=[]),M[Z].push(P),null===x||void 0===x||x.forEach((function(M,Z){return P(M,Z)})),function(){return O(M[Z],M[Z].indexOf(P))}}function d(Z){var P=this,x="string"!==typeof this.$changes.getType();this.$items.forEach((function(c,w){Z.push({refId:P.$changes.refId,op:M.OPERATION.DELETE,field:w,value:void 0,previousValue:c}),x&&P.$changes.root.removeRef(c.$changes.refId)}))}function O(M,Z){if(-1===Z||Z>=M.length)return!1;for(var P=M.length-1,x=Z;x<P;x++)M[x]=M[x+1];return M.length=P,!0}var H=function(M,Z){var P=M.toString(),x=Z.toString();return P<x?-1:P>x?1:0};function j(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,Z){return"symbol"===typeof Z||isNaN(Z)?M[Z]:M.at(Z)},set:function(M,Z,P){if("symbol"===typeof Z||isNaN(Z))M[Z]=P;else{var x=Array.from(M.$items.keys()),c=parseInt(x[Z]||Z);void 0===P||null===P?M.deleteAt(c):M.setAt(c,P)}return!0},deleteProperty:function(M,Z){return"number"===typeof Z?M.deleteAt(Z):delete M[Z],!0}})}var B=function(){function Z(){for(var M=[],Z=0;Z<arguments.length;Z++)M[Z]=arguments[Z];this.$changes=new mM(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,M)}return Z.prototype.Gm=function(Z,P){return void 0===P&&(P=!0),K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,Z,P?this.$items:void 0)},Z.prototype.mc=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,Z)},Z.is=function(M){return Array.isArray(M)||void 0!==M.array},Object.defineProperty(Z.prototype,"length",{get:function(){return this.$items.size},set:function(M){0===M?this.clear():this.splice(M,this.length-M)},enumerable:!1,configurable:!0}),Z.prototype.push=function(){for(var M,Z=this,P=[],x=0;x<arguments.length;x++)P[x]=arguments[x];return P.forEach((function(P){M=Z.$refId++,Z.setAt(M,P)})),M},Z.prototype.pop=function(){var M=Array.from(this.$indexes.values()).pop();if(void 0!==M){this.$changes.delete(M),this.$indexes.delete(M);var Z=this.$items.get(M);return this.$items.delete(M),Z}},Z.prototype.at=function(M){var Z=Array.from(this.$items.keys())[M];return this.$items.get(Z)},Z.prototype.setAt=function(Z,P){var x,c;if(void 0!==P&&null!==P){if(this.$items.get(Z)!==P){void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,Z);var w=null!==(c=null===(x=this.$changes.indexes[Z])||void 0===x?void 0:x.op)&&void 0!==c?c:M.OPERATION.ADD;this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,P),this.$changes.change(Z,w)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},Z.prototype.deleteAt=function(M){var Z=Array.from(this.$items.keys())[M];return void 0!==Z&&this.$deleteAt(Z)},Z.prototype.$deleteAt=function(M){return this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M)},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&d.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.concat=function(){for(var M,P=[],x=0;x<arguments.length;x++)P[x]=arguments[x];return new(Z.bind.apply(Z,c([void 0],(M=Array.from(this.$items.values())).concat.apply(M,P),!1)))},Z.prototype.join=function(M){return Array.from(this.$items.values()).join(M)},Z.prototype.reverse=function(){var M=this,Z=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(P,x){M.setAt(Z[x],P)})),this},Z.prototype.shift=function(){var M=Array.from(this.$items.keys()).shift();if(void 0!==M){var Z=this.$items.get(M);return this.$deleteAt(M),Z}},Z.prototype.slice=function(M,P){var x=new Z;return x.push.apply(x,Array.from(this.$items.values()).slice(M,P)),x},Z.prototype.sort=function(M){var Z=this;void 0===M&&(M=H);var P=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(M).forEach((function(M,x){Z.setAt(P[x],M)})),this},Z.prototype.splice=function(M,Z){void 0===Z&&(Z=this.length-M);for(var P=Array.from(this.$items.keys()),x=[],c=M;c<M+Z;c++)x.push(this.$items.get(P[c])),this.$deleteAt(P[c]);return x},Z.prototype.unshift=function(){for(var M=this,Z=[],P=0;P<arguments.length;P++)Z[P]=arguments[P];var x=this.length,c=Z.length,w=Array.from(this.$items.values());return Z.forEach((function(Z,P){M.setAt(P,Z)})),w.forEach((function(Z,P){M.setAt(c+P,Z)})),x+c},Z.prototype.indexOf=function(M,Z){return Array.from(this.$items.values()).indexOf(M,Z)},Z.prototype.lastIndexOf=function(M,Z){return void 0===Z&&(Z=this.length-1),Array.from(this.$items.values()).lastIndexOf(M,Z)},Z.prototype.every=function(M,Z){return Array.from(this.$items.values()).every(M,Z)},Z.prototype.some=function(M,Z){return Array.from(this.$items.values()).some(M,Z)},Z.prototype.forEach=function(M,Z){Array.from(this.$items.values()).forEach(M,Z)},Z.prototype.map=function(M,Z){return Array.from(this.$items.values()).map(M,Z)},Z.prototype.filter=function(M,Z){return Array.from(this.$items.values()).filter(M,Z)},Z.prototype.reduce=function(M,Z){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},Z.prototype.reduceRight=function(M,Z){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},Z.prototype.find=function(M,Z){return Array.from(this.$items.values()).find(M,Z)},Z.prototype.findIndex=function(M,Z){return Array.from(this.$items.values()).findIndex(M,Z)},Z.prototype.fill=function(M,Z,P){throw new Error("ArraySchema#fill() not implemented")},Z.prototype.copyWithin=function(M,Z,P){throw new Error("ArraySchema#copyWithin() not implemented")},Z.prototype.toString=function(){return this.$items.toString()},Z.prototype.toLocaleString=function(){return this.$items.toLocaleString()},Z.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(Z,Symbol.species,{get:function(){return Z},enumerable:!1,configurable:!0}),Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.keys=function(){return this.$items.keys()},Z.prototype.values=function(){return this.$items.values()},Z.prototype.includes=function(M,Z){return Array.from(this.$items.values()).includes(M,Z)},Z.prototype.flatMap=function(M,Z){throw new Error("ArraySchema#flatMap() is not supported.")},Z.prototype.flat=function(M){throw new Error("ArraySchema#flat() is not supported.")},Z.prototype.findLast=function(){var M=Array.from(this.$items.values());return M.findLast.apply(M,arguments)},Z.prototype.findLastIndex=function(){var M=Array.from(this.$items.values());return M.findLastIndex.apply(M,arguments)},Z.prototype.setIndex=function(M,Z){this.$indexes.set(M,Z)},Z.prototype.getIndex=function(M){return this.$indexes.get(M)},Z.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},Z.prototype.deleteByIndex=function(M){var Z=this.$indexes.get(M);this.$items.delete(Z),this.$indexes.delete(M)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){return this.toArray().map((function(M){return"function"===typeof M.toJSON?M.toJSON():M}))},Z.prototype.clone=function(M){return M?new(Z.bind.apply(Z,c([void 0],Array.from(this.$items.values()),!1))):new(Z.bind.apply(Z,c([void 0],this.map((function(M){return M.$changes?M.clone():M})),!1)))},Z}();function U(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,Z){return"symbol"!==typeof Z&&"undefined"===typeof M[Z]?M.get(Z):M[Z]},set:function(M,Z,P){return"symbol"!==typeof Z&&-1===Z.indexOf("$")&&"Gm"!==Z&&"mc"!==Z&&"onChange"!==Z?M.set(Z,P):M[Z]=P,!0},deleteProperty:function(M,Z){return M.delete(Z),!0}})}var n=function(){function Z(M){var P=this;if(this.$changes=new mM(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M)if(M instanceof Map||M instanceof Z)M.forEach((function(M,Z){return P.set(Z,M)}));else for(var x in M)this.set(x,M[x])}return Z.prototype.Gm=function(Z,P){return void 0===P&&(P=!0),K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,Z,P?this.$items:void 0)},Z.prototype.mc=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,Z)},Z.is=function(M){return void 0!==M.map},Z.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(Z.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(Z,Symbol.species,{get:function(){return Z},enumerable:!1,configurable:!0}),Z.prototype.set=function(Z,P){if(void 0===P||null===P)throw new Error("MapSchema#set('".concat(Z,"', ").concat(P,"): trying to set ").concat(P," value on '").concat(Z,"'."));Z=Z.toString();var x="undefined"!==typeof this.$changes.indexes[Z],c=x?this.$changes.indexes[Z]:this.$refId++,w=x?M.OPERATION.REPLACE:M.OPERATION.ADD,v=void 0!==P.$changes;if(v&&P.$changes.setParent(this,this.$changes.root,c),x){if(!v&&this.$items.get(Z)===P)return;v&&this.$items.get(Z)!==P&&(w=M.OPERATION.ADD)}else this.$changes.indexes[Z]=c,this.$indexes.set(c,Z);return this.$items.set(Z,P),this.$changes.change(Z,w),this},Z.prototype.get=function(M){return this.$items.get(M)},Z.prototype.delete=function(M){return this.$changes.delete(M),this.$items.delete(M)},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&d.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(M){return this.$items.has(M)},Z.prototype.forEach=function(M){this.$items.forEach(M)},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.keys=function(){return this.$items.keys()},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(M,Z){this.$indexes.set(M,Z)},Z.prototype.getIndex=function(M){return this.$indexes.get(M)},Z.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},Z.prototype.deleteByIndex=function(M){var Z=this.$indexes.get(M);this.$items.delete(Z),this.$indexes.delete(M)},Z.prototype.toJSON=function(){var M={};return this.forEach((function(Z,P){M[P]="function"===typeof Z.toJSON?Z.toJSON():Z})),M},Z.prototype.clone=function(M){var P;return M?P=Object.assign(new Z,this):(P=new Z,this.forEach((function(M,Z){M.$changes?P.set(Z,M.clone()):P.set(Z,M)}))),P},Z}(),L={};function u(M,Z){L[M]=Z}function N(M){return L[M]}var J=function(){function M(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return M.create=function(Z){var P=new M;return P.schema=Object.assign({},Z&&Z.schema||{}),P.indexes=Object.assign({},Z&&Z.indexes||{}),P.fieldsByIndex=Object.assign({},Z&&Z.fieldsByIndex||{}),P.descriptors=Object.assign({},Z&&Z.descriptors||{}),P.deprecated=Object.assign({},Z&&Z.deprecated||{}),P},M.prototype.addField=function(M,Z){var P=this.getNextFieldIndex();this.fieldsByIndex[P]=M,this.indexes[M]=P,this.schema[M]=Array.isArray(Z)?{array:Z[0]}:Z},M.prototype.hasField=function(M){return void 0!==this.indexes[M]},M.prototype.addFilter=function(M,Z){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[M]]=Z,this.indexesWithFilters.push(this.indexes[M]),!0},M.prototype.addChildrenFilter=function(M,Z){var P=this.indexes[M],x=this.schema[M];if(N(Object.keys(x)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[P]=Z,!0;console.warn("@filterChildren: field '".concat(M,"' can't have children. Ignoring filter."))},M.prototype.getChildrenFilter=function(M){return this.childFilters&&this.childFilters[this.indexes[M]]},M.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},M}();function t(M){return M._context&&M._context.useFilters}var F=function(){function M(){this.types={},this.schemas=new Map,this.useFilters=!1}return M.prototype.has=function(M){return this.schemas.has(M)},M.prototype.get=function(M){return this.types[M]},M.prototype.add=function(M,Z){void 0===Z&&(Z=this.schemas.size),M._definition=J.create(M._definition),M._typeid=Z,this.types[Z]=M,this.schemas.set(M,Z)},M.create=function(Z){return void 0===Z&&(Z={}),function(P){return Z.context||(Z.context=new M),l(P,Z)}},M}(),D=new F;function l(M,Z){return void 0===Z&&(Z={}),function(P,x){var w=Z.context||D,v=P.constructor;if(v._context=w,!M)throw new Error("".concat(v.name,': @type() reference provided for "').concat(x,"\" is undefined. Make sure you don't have any circular dependencies."));w.has(v)||w.add(v);var G=v._definition;if(G.addField(x,M),G.descriptors[x]){if(G.deprecated[x])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(x,"' definition on '").concat(v.name,"'.\nCheck @type() annotation"))}catch(L){var mM=L.stack.split("\n")[4].trim();throw new Error("".concat(L.message," ").concat(mM))}}var K=B.is(M),d=!K&&n.is(M);if("string"!==typeof M&&!WM.is(M)){var O=Object.values(M)[0];"string"===typeof O||w.has(O)||w.add(O)}if(Z.manual)G.descriptors[x]={enumerable:!0,configurable:!0,writable:!0};else{var H="_".concat(x);G.descriptors[H]={enumerable:!1,configurable:!1,writable:!0},G.descriptors[x]={get:function(){return this[H]},set:function(M){M!==this[H]&&(void 0!==M&&null!==M?(!K||M instanceof B||(M=new(B.bind.apply(B,c([void 0],M,!1)))),!d||M instanceof n||(M=new n(M)),void 0===M.$proxy&&(d?M=U(M):K&&(M=j(M))),this.$changes.change(x),M.$changes&&M.$changes.setParent(this,this.$changes.root,this._definition.indexes[x])):this[H]&&this.$changes.delete(x),this[H]=M)},enumerable:!0,configurable:!0}}}}function h(M){return function(Z,P){var x=Z.constructor;x._definition.addFilter(P,M)&&(x._context.useFilters=!0)}}function Q(M){return function(Z,P){var x=Z.constructor;x._definition.addChildrenFilter(P,M)&&(x._context.useFilters=!0)}}function I(M){return void 0===M&&(M=!0),function(Z,P){var x=Z.constructor._definition;x.deprecated[P]=!0,M&&(x.descriptors[P]={get:function(){throw new Error("".concat(P," is deprecated."))},set:function(M){},enumerable:!1,configurable:!0})}}function s(M,Z,P){for(var x in void 0===P&&(P={}),P.context||(P.context=M._context||P.context||D),Z)l(Z[x],P)(M.prototype,x);return M}function C(M){for(var Z=0,P=0,x=0,c=M.length;x<c;x++)(Z=M.charCodeAt(x))<128?P+=1:Z<2048?P+=2:Z<55296||Z>=57344?P+=3:(x++,P+=4);return P}function R(M,Z,P){for(var x=0,c=0,w=P.length;c<w;c++)(x=P.charCodeAt(c))<128?M[Z++]=x:x<2048?(M[Z++]=192|x>>6,M[Z++]=128|63&x):x<55296||x>=57344?(M[Z++]=224|x>>12,M[Z++]=128|x>>6&63,M[Z++]=128|63&x):(c++,x=65536+((1023&x)<<10|1023&P.charCodeAt(c)),M[Z++]=240|x>>18,M[Z++]=128|x>>12&63,M[Z++]=128|x>>6&63,M[Z++]=128|63&x)}function W(M,Z){M.push(255&Z)}function k(M,Z){M.push(255&Z)}function A(M,Z){M.push(255&Z),M.push(Z>>8&255)}function o(M,Z){M.push(255&Z),M.push(Z>>8&255)}function E(M,Z){M.push(255&Z),M.push(Z>>8&255),M.push(Z>>16&255),M.push(Z>>24&255)}function r(M,Z){var P=Z>>24,x=Z>>16,c=Z>>8,w=Z;M.push(255&w),M.push(255&c),M.push(255&x),M.push(255&P)}function q(M,Z){var P=Math.floor(Z/Math.pow(2,32));r(M,Z>>>0),r(M,P)}function e(M,Z){var P=Z/Math.pow(2,32)|0;r(M,Z>>>0),r(M,P)}function b(M,Z){z(M,Z)}function a(M,Z){i(M,Z)}var y=new Int32Array(2),f=new Float32Array(y.buffer),Y=new Float64Array(y.buffer);function z(M,Z){f[0]=Z,E(M,y[0])}function i(M,Z){Y[0]=Z,E(M,y[0]),E(M,y[1])}function T(M,Z){return k(M,Z?1:0)}function p(M,Z){Z||(Z="");var P=C(Z),x=0;if(P<32)M.push(160|P),x=1;else if(P<256)M.push(217),k(M,P),x=2;else if(P<65536)M.push(218),o(M,P),x=3;else{if(!(P<4294967296))throw new Error("String too long");M.push(219),r(M,P),x=5}return R(M,M.length,Z),x+P}function S(M,Z){return isNaN(Z)?S(M,0):isFinite(Z)?Z!==(0|Z)?(M.push(203),i(M,Z),9):Z>=0?Z<128?(k(M,Z),1):Z<256?(M.push(204),k(M,Z),2):Z<65536?(M.push(205),o(M,Z),3):Z<4294967296?(M.push(206),r(M,Z),5):(M.push(207),e(M,Z),9):Z>=-32?(M.push(224|Z+32),1):Z>=-128?(M.push(208),W(M,Z),2):Z>=-32768?(M.push(209),A(M,Z),3):Z>=-2147483648?(M.push(210),E(M,Z),5):(M.push(211),q(M,Z),9):S(M,Z>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var X=Object.freeze({__proto__:null,utf8Write:R,int8:W,uint8:k,int16:A,uint16:o,int32:E,uint32:r,int64:q,uint64:e,float32:b,float64:a,writeFloat32:z,writeFloat64:i,boolean:T,string:p,number:S});function V(M,Z,P){for(var x="",c=0,w=Z,v=Z+P;w<v;w++){var G=M[w];0!==(128&G)?192!==(224&G)?224!==(240&G)?240!==(248&G)?console.error("Invalid byte "+G.toString(16)):(c=(7&G)<<18|(63&M[++w])<<12|(63&M[++w])<<6|63&M[++w])>=65536?(c-=65536,x+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):x+=String.fromCharCode(c):x+=String.fromCharCode((15&G)<<12|(63&M[++w])<<6|63&M[++w]):x+=String.fromCharCode((31&G)<<6|63&M[++w]):x+=String.fromCharCode(G)}return x}function g(M,Z){return MM(M,Z)<<24>>24}function MM(M,Z){return M[Z.offset++]}function ZM(M,Z){return PM(M,Z)<<16>>16}function PM(M,Z){return M[Z.offset++]|M[Z.offset++]<<8}function xM(M,Z){return M[Z.offset++]|M[Z.offset++]<<8|M[Z.offset++]<<16|M[Z.offset++]<<24}function cM(M,Z){return xM(M,Z)>>>0}function wM(M,Z){return HM(M,Z)}function vM(M,Z){return jM(M,Z)}function GM(M,Z){var P=cM(M,Z);return xM(M,Z)*Math.pow(2,32)+P}function mZ(M,Z){var P=cM(M,Z);return cM(M,Z)*Math.pow(2,32)+P}var KM=new Int32Array(2),dM=new Float32Array(KM.buffer),OM=new Float64Array(KM.buffer);function HM(M,Z){return KM[0]=xM(M,Z),dM[0]}function jM(M,Z){return KM[0]=xM(M,Z),KM[1]=xM(M,Z),OM[0]}function BM(M,Z){return MM(M,Z)>0}function UM(M,Z){var P,x=M[Z.offset++];x<192?P=31&x:217===x?P=MM(M,Z):218===x?P=PM(M,Z):219===x&&(P=cM(M,Z));var c=V(M,Z.offset,P);return Z.offset+=P,c}function nM(M,Z){var P=M[Z.offset];return P<192&&P>160||217===P||218===P||219===P}function LM(M,Z){var P=M[Z.offset++];return P<128?P:202===P?HM(M,Z):203===P?jM(M,Z):204===P?MM(M,Z):205===P?PM(M,Z):206===P?cM(M,Z):207===P?mZ(M,Z):208===P?g(M,Z):209===P?ZM(M,Z):210===P?xM(M,Z):211===P?GM(M,Z):P>223?-1*(255-P+1):void 0}function uM(M,Z){var P=M[Z.offset];return P<128||P>=202&&P<=211}function NM(M,Z){return M[Z.offset]<160}function JM(M,Z){return M[Z.offset-1]===v&&(M[Z.offset]<128||M[Z.offset]>=202&&M[Z.offset]<=211)}var tM=Object.freeze({__proto__:null,int8:g,uint8:MM,int16:ZM,uint16:PM,int32:xM,uint32:cM,float32:wM,float64:vM,int64:GM,uint64:mZ,readFloat32:HM,readFloat64:jM,boolean:BM,string:UM,stringCheck:nM,number:LM,numberCheck:uM,arrayCheck:NM,switchStructureCheck:JM}),FM=function(){function Z(M){var Z=this;this.$changes=new mM(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return Z.add(M)}))}return Z.prototype.Gm=function(Z,P){return void 0===P&&(P=!0),K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,Z,P?this.$items:void 0)},Z.prototype.mc=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,Z)},Z.is=function(M){return void 0!==M.collection},Z.prototype.add=function(M){var Z=this.$refId++;return void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,Z),this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,M),this.$changes.change(Z),Z},Z.prototype.at=function(M){var Z=Array.from(this.$items.keys())[M];return this.$items.get(Z)},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.delete=function(M){for(var Z,P,x=this.$items.entries();(P=x.next())&&!P.done;)if(M===P.value[1]){Z=P.value[0];break}return void 0!==Z&&(this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z))},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&d.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(M){return Array.from(this.$items.values()).some((function(Z){return Z===M}))},Z.prototype.forEach=function(M){var Z=this;this.$items.forEach((function(P,x,c){return M(P,x,Z)}))},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(M,Z){this.$indexes.set(M,Z)},Z.prototype.getIndex=function(M){return this.$indexes.get(M)},Z.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},Z.prototype.deleteByIndex=function(M){var Z=this.$indexes.get(M);this.$items.delete(Z),this.$indexes.delete(M)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){var M=[];return this.forEach((function(Z,P){M.push("function"===typeof Z.toJSON?Z.toJSON():Z)})),M},Z.prototype.clone=function(M){var P;return M?P=Object.assign(new Z,this):(P=new Z,this.forEach((function(M){M.$changes?P.add(M.clone()):P.add(M)}))),P},Z}(),DM=function(){function Z(M){var Z=this;this.$changes=new mM(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return Z.add(M)}))}return Z.prototype.Gm=function(Z,P){return void 0===P&&(P=!0),K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,Z,P?this.$items:void 0)},Z.prototype.mc=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,Z)},Z.is=function(M){return void 0!==M.set},Z.prototype.add=function(Z){var P,x;if(this.has(Z))return!1;var c=this.$refId++;void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,c);var w=null!==(x=null===(P=this.$changes.indexes[c])||void 0===P?void 0:P.op)&&void 0!==x?x:M.OPERATION.ADD;return this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,Z),this.$changes.change(c,w),c},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.delete=function(M){for(var Z,P,x=this.$items.entries();(P=x.next())&&!P.done;)if(M===P.value[1]){Z=P.value[0];break}return void 0!==Z&&(this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z))},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&d.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(M){for(var Z,P=this.$items.values(),x=!1;(Z=P.next())&&!Z.done;)if(M===Z.value){x=!0;break}return x},Z.prototype.forEach=function(M){var Z=this;this.$items.forEach((function(P,x,c){return M(P,x,Z)}))},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(M,Z){this.$indexes.set(M,Z)},Z.prototype.getIndex=function(M){return this.$indexes.get(M)},Z.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},Z.prototype.deleteByIndex=function(M){var Z=this.$indexes.get(M);this.$items.delete(Z),this.$indexes.delete(M)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){var M=[];return this.forEach((function(Z,P){M.push("function"===typeof Z.toJSON?Z.toJSON():Z)})),M},Z.prototype.clone=function(M){var P;return M?P=Object.assign(new Z,this):(P=new Z,this.forEach((function(M){M.$changes?P.add(M.clone()):P.add(M)}))),P},Z}(),lM=function(){function M(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return M.prototype.addRefId=function(M){this.refIds.has(M)||(this.refIds.add(M),this.containerIndexes.set(M,new Set))},M.get=function(Z){return void 0===Z.$filterState&&(Z.$filterState=new M),Z.$filterState},M}(),hM=function(){function M(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return M.prototype.getNextUniqueId=function(){return this.nextUniqueId++},M.prototype.addRef=function(M,Z,P){void 0===P&&(P=!0),this.refs.set(M,Z),P&&(this.refCounts[M]=(this.refCounts[M]||0)+1)},M.prototype.removeRef=function(M){this.refCounts[M]=this.refCounts[M]-1,this.deletedRefs.add(M)},M.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},M.prototype.garbageCollectDeletedRefs=function(){var M=this;this.deletedRefs.forEach((function(Z){if(!(M.refCounts[Z]>0)){var P=M.refs.get(Z);if(P instanceof WM)for(var x in P._definition.schema)"string"!==typeof P._definition.schema[x]&&P[x]&&P[x].$changes&&M.removeRef(P[x].$changes.refId);else{var c=P.$changes.parent._definition,w=c.schema[c.fieldsByIndex[P.$changes.parentIndex]];"function"===typeof Object.values(w)[0]&&Array.from(P.values()).forEach((function(Z){return M.removeRef(Z.$changes.refId)}))}M.refs.delete(Z),delete M.refCounts[Z]}})),this.deletedRefs.clear()},M}(),QM=function(M){function Z(){return null!==M&&M.apply(this,arguments)||this}return P(Z,M),Z}(Error);function IM(M,Z,P,x){var c,w=!1;switch(Z){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(M)&&console.log('trying to encode "NaN" in '.concat(P.constructor.name,"#").concat(x));break;case"string":c="string",w=!0;break;case"boolean":return}if(typeof M!==c&&(!w||w&&null!==M)){var v="'".concat(JSON.stringify(M),"'").concat(M&&M.constructor&&" (".concat(M.constructor.name,")")||"");throw new QM("a '".concat(c,"' was expected, but ").concat(v," was provided in ").concat(P.constructor.name,"#").concat(x))}}function sM(M,Z,P,x){if(!(M instanceof Z))throw new QM("a '".concat(Z.name,"' was expected, but '").concat(M.constructor.name,"' was provided in ").concat(P.constructor.name,"#").concat(x))}function CM(M,Z,P,x,c){IM(P,M,x,c);var w=X[M];if(!w)throw new QM("a '".concat(M,"' was expected, but ").concat(P," was provided in ").concat(x.constructor.name,"#").concat(c));w(Z,P)}function RM(M,Z,P){return tM[M](Z,P)}var WM=function(){function Z(){for(var M=[],Z=0;Z<arguments.length;Z++)M[Z]=arguments[Z];Object.defineProperties(this,{$changes:{value:new mM(this,void 0,new hM),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var P=this._definition.descriptors;P&&Object.defineProperties(this,P),M[0]&&this.assign(M[0])}return Z.onError=function(M){console.error(M)},Z.is=function(M){return M._definition&&void 0!==M._definition.schema},Z.prototype.onChange=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,Z)},Z.prototype.mc=function(Z){return K(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,Z)},Z.prototype.assign=function(M){return Object.assign(this,M),this},Object.defineProperty(Z.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Z.prototype.setDirty=function(M,Z){this.$changes.change(M,Z)},Z.prototype.listen=function(M,Z,P){var x=this;return void 0===P&&(P=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[M]||(this.$callbacks[M]=[]),this.$callbacks[M].push(Z),P&&void 0!==this[M]&&Z(this[M],void 0),function(){return O(x.$callbacks[M],x.$callbacks[M].indexOf(Z))}},Z.prototype.decode=function(P,x,c){var w;void 0===x&&(x={offset:0}),void 0===c&&(c=this);var G=[],mM=this.$changes.root,K=P.length,d=0;for(mM.refs.set(d,this);x.offset<K;){var O=P[x.offset++];if(O!=v){var H=c.$changes,j=void 0!==c._definition,U=j?O>>6<<6:O;if(U!==M.OPERATION.CLEAR){var L=j?O%(U||255):LM(P,x),u=j?c._definition.fieldsByIndex[L]:"",J=H.getType(L),t=void 0,F=void 0,D=void 0;if(j?F=c["_".concat(u)]:(F=c.getByIndex(L),(U&M.OPERATION.ADD)===M.OPERATION.ADD?(D=c instanceof n?UM(P,x):L,c.setIndex(L,D)):D=c.getIndex(L)),(U&M.OPERATION.DELETE)===M.OPERATION.DELETE&&(U!==M.OPERATION.DELETE_AND_ADD&&c.deleteByIndex(L),F&&F.$changes&&mM.removeRef(F.$changes.refId),t=null),void 0!==u){if(U===M.OPERATION.DELETE);else if(Z.is(J)){var l=LM(P,x);if(t=mM.refs.get(l),U!==M.OPERATION.REPLACE){var h=this.getSchemaType(P,x,J);t||((t=this.createTypeInstance(h)).$changes.refId=l,F&&(t.$callbacks=F.$callbacks,F.$changes.refId&&l!==F.$changes.refId&&mM.removeRef(F.$changes.refId))),mM.addRef(l,t,t!==F)}}else if("string"===typeof J)t=RM(J,P,x);else{var Q=N(Object.keys(J)[0]),I=LM(P,x),s=mM.refs.has(I)?F||mM.refs.get(I):new Q.constructor;if((t=s.clone(!0)).$changes.refId=I,F&&(t.$callbacks=F.$callbacks,F.$changes.refId&&I!==F.$changes.refId)){mM.removeRef(F.$changes.refId);for(var C=F.entries(),R=void 0;(R=C.next())&&!R.done;){var W=(w=R.value)[0],k=w[1];G.push({refId:I,op:M.OPERATION.DELETE,field:W,value:void 0,previousValue:k})}}mM.addRef(I,t,s!==F)}if(null!==t&&void 0!==t)if(t.$changes&&t.$changes.setParent(H.ref,H.root,L),c instanceof Z)c[u]=t;else if(c instanceof n)W=D,c.$items.set(W,t),c.$changes.allChanges.add(L);else if(c instanceof B)c.setAt(L,t);else if(c instanceof FM){var A=c.add(t);c.setIndex(L,A)}else c instanceof DM&&!1!==(A=c.add(t))&&c.setIndex(L,A);F!==t&&G.push({refId:d,op:U,field:u,dynamicIndex:D,value:t,previousValue:F})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:x.offset};x.offset<K&&(!JM(P,x)||(o.offset=x.offset+1,!mM.refs.has(LM(P,o))));)x.offset++}}else c.clear(G)}else{d=LM(P,x);var E=mM.refs.get(d);if(!E)throw new Error('"refId" not found: '.concat(d));c=E}}return this._triggerChanges(G),mM.garbageCollectDeletedRefs(),G},Z.prototype.encode=function(P,x,c){void 0===P&&(P=!1),void 0===x&&(x=[]),void 0===c&&(c=!1);for(var w=this.$changes,G=new WeakSet,mM=[w],K=1,d=0;d<K;d++){var O=mM[d],H=O.ref,j=H instanceof Z;O.ensureRefId(),G.add(O),O!==w&&(O.changed||P)&&(k(x,v),S(x,O.refId));for(var B=P?Array.from(O.allChanges):Array.from(O.changes.values()),U=0,L=B.length;U<L;U++){var u=P?{op:M.OPERATION.ADD,index:B[U]}:B[U],J=u.index,t=j?H._definition.fieldsByIndex&&H._definition.fieldsByIndex[J]:J,F=x.length;if(u.op!==M.OPERATION.TOUCH)if(j)k(x,J|u.op);else{if(k(x,u.op),u.op===M.OPERATION.CLEAR)continue;S(x,J)}if(j||(u.op&M.OPERATION.ADD)!=M.OPERATION.ADD||H instanceof n&&p(x,O.ref.$indexes.get(J)),u.op!==M.OPERATION.DELETE){var D=O.getType(J),l=O.getValue(J);if(l&&l.$changes&&!G.has(l.$changes)&&(mM.push(l.$changes),l.$changes.ensureRefId(),K++),u.op!==M.OPERATION.TOUCH){if(Z.is(D))sM(l,D,H,t),S(x,l.$changes.refId),(u.op&M.OPERATION.ADD)===M.OPERATION.ADD&&this.tryEncodeTypeId(x,D,l.constructor);else if("string"===typeof D)CM(D,x,l,H,t);else{var h=N(Object.keys(D)[0]);sM(H["_".concat(t)],h.constructor,H,t),S(x,l.$changes.refId)}c&&O.cache(J,x.slice(F))}}}P||c||O.discard()}return x},Z.prototype.encodeAll=function(M){return this.encode(!0,[],M)},Z.prototype.applyFilters=function(P,x){var c,w;void 0===x&&(x=!1);for(var G=this,mM=new Set,K=lM.get(P),d=[this.$changes],O=1,H=[],j=function(j){var B=d[j];if(mM.has(B.refId))return"continue";var U=B.ref,L=U instanceof Z;k(H,v),S(H,B.refId);var u=K.refIds.has(B),N=x||!u;K.addRefId(B);var J=K.containerIndexes.get(B),t=N?Array.from(B.allChanges):Array.from(B.changes.values());!x&&L&&U._definition.indexesWithFilters&&U._definition.indexesWithFilters.forEach((function(Z){!J.has(Z)&&B.allChanges.has(Z)&&(N?t.push(Z):t.push({op:M.OPERATION.ADD,index:Z}))}));for(var F=0,D=t.length;F<D;F++){var l=N?{op:M.OPERATION.ADD,index:t[F]}:t[F];if(l.op!==M.OPERATION.CLEAR){var h=l.index;if(l.op!==M.OPERATION.DELETE){var Q=B.getValue(h),I=B.getType(h);if(L){if((s=U._definition.filters&&U._definition.filters[h])&&!s.call(U,P,Q,G)){Q&&Q.$changes&&mM.add(Q.$changes.refId);continue}}else{var s,C=B.parent;if((s=B.getChildrenFilter())&&!s.call(C,P,U.$indexes.get(h),Q,G)){Q&&Q.$changes&&mM.add(Q.$changes.refId);continue}}if(Q.$changes&&(d.push(Q.$changes),O++),l.op!==M.OPERATION.TOUCH)if(l.op===M.OPERATION.ADD||L)H.push.apply(H,null!==(c=B.caches[h])&&void 0!==c?c:[]),J.add(h);else if(J.has(h))H.push.apply(H,null!==(w=B.caches[h])&&void 0!==w?w:[]);else{if(J.add(h),k(H,M.OPERATION.ADD),S(H,h),U instanceof n){var R=B.ref.$indexes.get(h);p(H,R)}Q.$changes?S(H,Q.$changes.refId):X[I](H,Q)}else Q.$changes&&!L&&(k(H,M.OPERATION.ADD),S(H,h),U instanceof n&&(R=B.ref.$indexes.get(h),p(H,R)),S(H,Q.$changes.refId))}else L?k(H,l.op|h):(k(H,l.op),S(H,h))}else k(H,l.op)}},B=0;B<O;B++)j(B);return H},Z.prototype.clone=function(){var M,Z=new this.constructor,P=this._definition.schema;for(var x in P)"object"===typeof this[x]&&"function"===typeof(null===(M=this[x])||void 0===M?void 0:M.clone)?Z[x]=this[x].clone():Z[x]=this[x];return Z},Z.prototype.toJSON=function(){var M=this._definition.schema,Z=this._definition.deprecated,P={};for(var x in M)Z[x]||null===this[x]||"undefined"===typeof this[x]||(P[x]="function"===typeof this[x].toJSON?this[x].toJSON():this["_".concat(x)]);return P},Z.prototype.discardAllChanges=function(){this.$changes.discardAll()},Z.prototype.getByIndex=function(M){return this[this._definition.fieldsByIndex[M]]},Z.prototype.deleteByIndex=function(M){this[this._definition.fieldsByIndex[M]]=void 0},Z.prototype.tryEncodeTypeId=function(M,Z,P){Z._typeid!==P._typeid&&(k(M,G),S(M,P._typeid))},Z.prototype.getSchemaType=function(M,Z,P){var x;return M[Z.offset]===G&&(Z.offset++,x=this.constructor._context.get(LM(M,Z))),x||P},Z.prototype.createTypeInstance=function(M){var Z=new M;return Z.$changes.root=this.$changes.root,Z},Z.prototype._triggerChanges=function(P){for(var x,c,w,v,G,mM,K,d,O,H=new Set,j=this.$changes.root.refs,B=function(B){var U=P[B],n=U.refId,L=j.get(n),u=L.$callbacks;if((U.op&M.OPERATION.DELETE)===M.OPERATION.DELETE&&U.previousValue instanceof Z&&(null===(c=null===(x=U.previousValue.$callbacks)||void 0===x?void 0:x[M.OPERATION.DELETE])||void 0===c||c.forEach((function(M){return M()}))),!u)return"continue";if(L instanceof Z){if(!H.has(n))try{null===(w=null===u||void 0===u?void 0:u[M.OPERATION.REPLACE])||void 0===w||w.forEach((function(M){return M()}))}catch(N){Z.onError(N)}try{u.hasOwnProperty(U.field)&&(null===(v=u[U.field])||void 0===v||v.forEach((function(M){return M(U.value,U.previousValue)})))}catch(N){Z.onError(N)}}else U.op===M.OPERATION.ADD&&void 0===U.previousValue?null===(G=u[M.OPERATION.ADD])||void 0===G||G.forEach((function(M){var Z;return M(U.value,null!==(Z=U.dynamicIndex)&&void 0!==Z?Z:U.field)})):U.op===M.OPERATION.DELETE?void 0!==U.previousValue&&(null===(mM=u[M.OPERATION.DELETE])||void 0===mM||mM.forEach((function(M){var Z;return M(U.previousValue,null!==(Z=U.dynamicIndex)&&void 0!==Z?Z:U.field)}))):U.op===M.OPERATION.DELETE_AND_ADD&&(void 0!==U.previousValue&&(null===(K=u[M.OPERATION.DELETE])||void 0===K||K.forEach((function(M){var Z;return M(U.previousValue,null!==(Z=U.dynamicIndex)&&void 0!==Z?Z:U.field)}))),null===(d=u[M.OPERATION.ADD])||void 0===d||d.forEach((function(M){var Z;return M(U.value,null!==(Z=U.dynamicIndex)&&void 0!==Z?Z:U.field)}))),U.value!==U.previousValue&&(null===(O=u[M.OPERATION.REPLACE])||void 0===O||O.forEach((function(M){var Z;return M(U.value,null!==(Z=U.dynamicIndex)&&void 0!==Z?Z:U.field)})));H.add(n)},U=0;U<P.length;U++)B(U)},Z._definition=J.create(),Z}();function kM(M){for(var Z=[M.$changes],P=1,x={},c=x,w=function(M){var P=Z[M];P.changes.forEach((function(M){var Z=P.ref,x=M.index,w=Z._definition?Z._definition.fieldsByIndex[x]:Z.$indexes.get(x);c[w]=P.getValue(x)}))},v=0;v<P;v++)w(v);return x}var AM={context:new F},oM=function(M){function Z(){return null!==M&&M.apply(this,arguments)||this}return P(Z,M),x([l("string",AM)],Z.prototype,"name",void 0),x([l("string",AM)],Z.prototype,"type",void 0),x([l("number",AM)],Z.prototype,"referencedType",void 0),Z}(WM),EM=function(M){function Z(){var Z=null!==M&&M.apply(this,arguments)||this;return Z.fields=new B,Z}return P(Z,M),x([l("number",AM)],Z.prototype,"id",void 0),x([l([oM],AM)],Z.prototype,"fields",void 0),Z}(WM),rM=function(M){function Z(){var Z=null!==M&&M.apply(this,arguments)||this;return Z.types=new B,Z}return P(Z,M),Z.encode=function(M){var P=M.constructor,x=new Z;x.rootType=P._typeid;var c=function(M,Z){for(var P in Z){var c=new oM;c.name=P;var w=void 0;if("string"===typeof Z[P])w=Z[P];else{var v=Z[P],G=void 0;WM.is(v)?(w="ref",G=Z[P]):"string"===typeof v[w=Object.keys(v)[0]]?w+=":"+v[w]:G=v[w],c.referencedType=G?G._typeid:-1}c.type=w,M.fields.push(c)}x.types.push(M)},w=P._context.types;for(var v in w){var G=new EM;G.id=Number(v),c(G,w[v]._definition.schema)}return x.encodeAll()},Z.decode=function(M,x){var c=new F,w=new Z;w.decode(M,x);var v=w.types.reduce((function(M,Z){var x=function(M){function Z(){return null!==M&&M.apply(this,arguments)||this}return P(Z,M),Z}(WM),w=Z.id;return M[w]=x,c.add(x,w),M}),{});w.types.forEach((function(M){var Z=v[M.id];M.fields.forEach((function(M){var P;if(void 0!==M.referencedType){var x=M.type,w=v[M.referencedType];if(!w){var G=M.type.split(":");x=G[0],w=G[1]}"ref"===x?l(w,{context:c})(Z.prototype,M.name):l(((P={})[x]=w,P),{context:c})(Z.prototype,M.name)}else l(M.type,{context:c})(Z.prototype,M.name)}))}));var G=v[w.rootType],mM=new G;for(var K in G._definition.schema){var d=G._definition.schema[K];"string"!==typeof d&&(mM[K]="function"===typeof d?new d:new(N(Object.keys(d)[0]).constructor))}return mM},x([l([EM],AM)],Z.prototype,"types",void 0),x([l("number",AM)],Z.prototype,"rootType",void 0),Z}(WM);u("map",{constructor:n}),u("array",{constructor:B}),u("set",{constructor:DM}),u("collection",{constructor:FM}),M.ArraySchema=B,M.CollectionSchema=FM,M.Context=F,M.MapSchema=n,M.Reflection=rM,M.ReflectionField=oM,M.ReflectionType=EM,M.Schema=WM,M.SchemaDefinition=J,M.SetSchema=DM,M.decode=tM,M.defineTypes=s,M.deprecated=I,M.dumpChanges=kM,M.encode=X,M.filter=h,M.filterChildren=Q,M.hasFilter=t,M.registerType=u,M.type=l,Object.defineProperty(M,"__esModule",{value:!0})}(Z)},14488:function(M,Z,P){var x,c,w;function v(){const M=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(v=function(){return M})()}function G(M,Z){const P=v();return(G=function(M,Z){return P[M-=212]})(M,Z)}M=P.nmd(M),function(M){const Z=G,P=M();for(;;)try{if(368192===parseInt(Z(328))/1+parseInt(Z(379))/2*(-parseInt(Z(226))/3)+parseInt(Z(348))/4*(parseInt(Z(264))/5)+parseInt(Z(224))/6*(-parseInt(Z(223))/7)+-parseInt(Z(345))/8*(parseInt(Z(325))/9)+-parseInt(Z(215))/10+-parseInt(Z(275))/11*(-parseInt(Z(383))/12))break;P.push(P.shift())}catch(x){P.push(P.shift())}}(v),function(v,mM){const K=G;K(262)==typeof Z&&"object"==K(262)?M[K(337)]=mM():"function"==K(237)&&P.amdD[K(400)]?(c=[],void 0===(w="function"===typeof(x=mM)?x.apply(Z,c):x)||(M.exports=w)):K(262)==typeof Z?Z[K(277)]=mM():v[K(277)]=mM()}(this,(()=>(()=>{var M={646:function(M){M[G(337)]=function(){"use strict";function M(M){const Z=G;for(var P=1;P<arguments[Z(302)];P++){var x=arguments[P];for(var c in x)M[c]=x[c]}return M}return function Z(P,x){const c=G;function w(Z,c,w){const v=G;if(v(363)!=typeof document){"number"==typeof(w=M({},x,w))[v(278)]&&(w[v(278)]=new Date(Date[v(235)]()+864e5*w[v(278)])),w[v(278)]&&(w[v(278)]=w[v(278)][v(351)]()),Z=encodeURIComponent(Z).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[v(320)](/[()]/g,escape);var mM="";for(var K in w)w[K]&&(mM+="; "+K,!0!==w[K]&&(mM+="="+w[K][v(335)](";")[0]));return document[v(295)]=Z+"="+P[v(349)](c,Z)+mM}}return Object[c(260)]({set:w,get:function(M){const Z=G;if(Z(363)!=typeof document&&(!arguments[Z(302)]||M)){for(var x=document.cookie?document[Z(295)][Z(335)]("; "):[],c={},w=0;w<x[Z(302)];w++){var v=x[w][Z(335)]("="),mM=v[Z(396)](1)[Z(323)]("=");try{var K=decodeURIComponent(v[0]);if(c[K]=P[Z(366)](mM,K),M===K)break}catch(d){}}return M?c[M]:c}},remove:function(Z,P){w(Z,"",M({},P,{expires:-1}))},withAttributes:function(P){return Z(this[c(359)],M({},this.attributes,P))},withConverter:function(P){const x=c;return Z(M({},this[x(359)],P),this[x(398)])}},{attributes:{value:Object[c(315)](x)},converter:{value:Object.freeze(P)}})}({read:function(M){const Z=G;return'"'===M[0]&&(M=M[Z(396)](1,-1)),M.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(M){const Z=G;return encodeURIComponent(M)[Z(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(382)]=void 0;const c=P(284);class w{static[x(218)](){const M=x;console[M(395)](M(212)),window.addEventListener(M(297),w[M(258)])}static onBeforeUnload(){const M=x;c[M(313)][M(236)]()}}Z[x(382)]=w},719:(M,Z,P)=>{"use strict";const x=G;Object.defineProperty(Z,"__esModule",{value:!0}),Z[x(290)]=void 0;const c=P(284),w=P(878);Z[x(290)]=class{static[x(307)](M,Z,P){const w=x;c.ByteBrewCore[w(307)](M,Z,P)}static[x(339)](){const M=x;return c[M(313)][M(393)]}static[x(239)](M,Z){const P=x;void 0===Z?c.ByteBrewCore[P(239)](M):P(240)==typeof Z?c.ByteBrewCore[P(247)](M,Z):P(270)==typeof Z?c[P(313)][P(243)](M,Z):P(262)==typeof Z&&c[P(313)][P(286)](M,Z)}static loadRemoteConfigs(M){const Z=x;w.RemoteConfigHandler[Z(282)](M)}static[x(233)](M,Z){const P=x;return w[P(272)][P(233)](M,Z)}static[x(369)](){const M=x;return w[M(272)][M(369)]()}static[x(391)](){const M=x;c[M(313)][M(391)]()}static[x(384)](){const M=x;c[M(313)][M(384)]()}static[x(213)](){return c.ByteBrewCore.userID}}},441:function(M,Z,P){"use strict";const x=G;var c=this&&this[x(329)]||function(M){return M&&M[x(220)]?M:{default:M}};Object[x(228)](Z,x(220),{value:!0}),Z[x(397)]=void 0;const w=c(P(646)),v=P(429);class mM{static[x(332)](){const M=x,Z=w[M(334)][M(311)](mM[M(231)]);return Z?{userID:Z,isNewUser:!1,hasSuccessfullyInitialized:mM[M(394)]()}:{userID:mM.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[x(230)](){const M=x,Z=(0,v.v4)();return w.default[M(242)](mM[M(231)],Z,{expires:365}),Z}static setTrackingSettingsCookie(M){const Z=x,P=Z(M?248:367);w[Z(334)].set(mM[Z(225)],P,{expires:365})}static[x(314)](){const M=x,Z=w[M(334)][M(311)](mM.trackingSettingsIDCookieKey);return!Z||"true"===Z}static[x(356)](){return mM.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const M=x,Z=w.default[M(311)](mM[M(231)]);Z&&w.default[M(242)](mM.userHasInitializedSuccessfullyCookieKey,Z,{expires:365})}static[x(330)](){const M=x,Z=w[M(334)][M(311)](mM[M(326)]),P=w[M(334)][M(311)](mM[M(231)]);return!(!Z||!P)&&Z===P}static hasUserInitialized(){return mM[x(330)]()}}Z.ByteBrewCookieManager=mM,mM.userIDCookieKey=x(361),mM.trackingSettingsIDCookieKey=x(357),mM[x(326)]="bb_u_h_init"},284:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(313)]=void 0;const c=P(441),w=P(797),v=P(334),mM=P(429),K=P(147);class d{static[x(246)](){const M=x;let Z=navigator[M(281)][M(335)]("-");return Z.length<2?"??":Z[Z.length-1]||"??"}static[x(307)](M,Z,P){const w=x;if(d[w(393)])return;if(console[w(395)]("ByteBrew: Starting Initialization"),!M||!Z)return void console.log(w(256));if(d[w(221)]=c[w(397)][w(356)](),!d.trackingEnabled)return void console[w(395)](w(362));d[w(399)]=M,d[w(249)]=Z,d[w(336)]=P,d.sessionID=(0,mM.v4)(),d.sessionKey="",d[w(300)]=K[w(305)],d.language=navigator[w(281)],d[w(385)]=d[w(246)]();const G=c[w(397)][w(332)]();d[w(308)]=G[w(308)],G.isNewUser||!G[w(293)]?d.createNewUserEvent():d[w(344)](),d[w(331)]=new Date,v[w(382)][w(218)]()}static reinitializeByteBrew(){const M=x;console[M(395)](M(306)),d.initializeByteBrew(d[M(399)],d[M(249)],d[M(336)])}static[x(387)](M){const Z=x;d[Z(214)]=M,d[Z(393)]=!0,d.hasBeenInitializedWhilePageOpen=!0,c[Z(397)][Z(296)](),console[Z(395)](Z(386))}static[x(301)](){const M=x;d[M(303)]&&(console.log(M(341)),this[M(217)]())}static[x(372)](){return d[x(393)]&&d.trackingEnabled}static getScreenResolution(){return window[x(227)]+"x"+window.innerHeight}static[x(241)](){const M=x;return{game_id:d[M(399)],user_id:d[M(308)],session_id:d[M(318)],session_key:d.sessionKey,platform:d.platform}}static[x(244)](){const M=x;return Object[M(219)](Object[M(219)]({},d[M(241)]()),{version_number:d[M(336)],sdk_version:d[M(300)],deviceScreenSize:d[M(280)](),tracking_enabled:d[M(221)]})}static[x(283)](M,Z){const P=x;w.ByteBrewWebRequestor[P(380)](M,Z).then((M=>{const Z=P;if(M&&M.ok){const P=M.headers.get(Z(354));P?d.onInitializationSuccessful(P):console[Z(395)](Z(381))}else console[Z(395)](Z(232)+(M?M[Z(259)]:"No Response"))}))}static createUserEvent(){const M=x;if(!d[M(221)])return;console.log(M(353));let Z={eventType:"game_open",userLocale:d[M(281)]};const P=Object[M(219)](Object[M(219)]({},d[M(244)]()),{category:M(269),geo:d[M(385)],externalData:Z});d[M(283)](w.ByteBrewWebRequestor[M(238)],P)}static[x(285)](){const M=x;if(!d[M(221)])return;console[M(395)](M(352));let Z={eventType:M(309),userLocale:d[M(281)]};const P=Object.assign(Object.assign({},d.getFullEventObject()),{category:M(269),geo:d[M(385)],externalData:Z});d[M(283)](w[M(265)][M(238)],P)}static endCurrentSession(){const M=x;if(!d[M(372)]())return;d[M(393)]=!1,console.log(M(350));const Z=new Date;let P={sessionLength:Math[M(287)]((Z[M(253)]()-d[M(331)].getTime())/1e3)[M(251)]()};const c=Object[M(219)](Object[M(219)]({},d[M(244)]()),{category:M(401),externalData:P});w.ByteBrewWebRequestor[M(380)](w[M(265)][M(238)],c)}static[x(252)](M){const Z=x;let P="";if(!M)return P;for(const[x,c]of Object.entries(M))P+=x+"="+c+";";return P[Z(302)]>0&&(P=P[Z(396)](0,-1)),P}static[x(368)](M,Z){const P=x;if(!d.canSendData())return;console[P(395)](P(374)+M);let c={eventType:M};Z&&(c=Object.assign(Object[P(219)]({},c),{value:"object"==typeof Z?d[P(252)](Z):Z[P(251)]()}));const v=Object[P(219)](Object[P(219)]({},d[P(244)]()),{category:"custom",externalData:c});w.ByteBrewWebRequestor[P(380)](w[P(265)][P(238)],v)[P(378)]((M=>{const Z=P;M&&M.ok?console.log(Z(274)):console[Z(395)](Z(294)+(M?M.status:Z(267)))}))}static[x(239)](M){d[x(368)](M,null)}static[x(247)](M,Z){d.sendCustomEvent(M,Z)}static newCustomEventWithNumber(M,Z){d.sendCustomEvent(M,Z)}static[x(286)](M,Z){d[x(368)](M,Z)}static[x(391)](){const M=x;console[M(395)]("ByteBrew: Restarting Tracking"),d[M(221)]=!0,c[M(397)][M(360)](!0),d[M(217)]()}static[x(384)](){const M=x;console[M(395)](M(257)),d[M(221)]=!1,c.ByteBrewCookieManager[M(360)](!1)}}Z[x(313)]=d,d[x(393)]=!1,d[x(303)]=!1,d[x(261)]="Web"},797:function(M,Z,P){"use strict";const x=G;var c=this&&this[x(342)]||function(M,Z,P,x){return new(P||(P=Promise))((function(c,w){const v=G;function mM(M){try{d(x.next(M))}catch(Z){w(Z)}}function K(M){try{d(x.throw(M))}catch(Z){w(Z)}}function d(M){const Z=G;var x;M.done?c(M.value):(x=M[Z(234)],x instanceof P?x:new P((function(M){M(x)})))[Z(378)](mM,K)}d((x=x[v(222)](M,Z||[]))[v(255)]())}))};Object[x(228)](Z,x(220),{value:!0}),Z[x(265)]=void 0;const w=P(284);class v{static sendBasicRequest(M,Z){return c(this,void 0,void 0,(function*(){const P=G;try{const x={method:"POST",mode:P(358),headers:{Accept:P(304),"Content-Type":P(289),"sdk-key":w[P(313)][P(249)]},body:JSON.stringify(Z),keepalive:!0};return yield v[P(298)](M,x)}catch(x){console[P(284)](x)}}))}static[x(343)](M){return c(this,void 0,void 0,(function*(){const Z=G;try{const P={method:Z(392),mode:"cors",headers:{Accept:Z(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":w[Z(313)][Z(249)],user_id:w[Z(313)][Z(308)]}};return yield v[Z(298)](M,P)}catch(P){console[Z(284)](P)}}))}static[x(298)](M,Z){return c(this,void 0,void 0,(function*(){const P=G;try{const x=yield fetch(M,Z);return x.ok||console[P(284)]("Request failed with status "+x[P(259)]),x}catch(x){console[P(284)](x)}}))}}Z.ByteBrewWebRequestor=v,v[x(238)]=x(390),v[x(268)]=x(389)},878:(M,Z,P)=>{"use strict";const x=G;Object.defineProperty(Z,x(220),{value:!0}),Z[x(272)]=void 0;const c=P(284),w=P(797);class v{static[x(292)](M){v.remoteConfigs=M}static hasRemoteConfigsBeenSet(){return!!v[x(216)]}static loadRemoteConfigs(M){const Z=x;w[Z(265)][Z(343)](w[Z(265)][Z(268)]+c[Z(313)].appID)[Z(378)]((P=>{const x=Z;P&&P.ok?P[x(371)]()[x(378)]((Z=>{const P=x;let c=null;try{c=new Map(Object[P(370)](JSON[P(250)](Z))),console[P(395)](P(266))}catch(w){c=null,console[P(284)](P(388))}finally{v[P(292)](c),c&&M(c)}})):P?console.error(x(322)+(P?P[x(259)]:x(267))+" "+(P?P.statusText:"")):console[x(284)](x(279))}))}static[x(233)](M,Z){const P=x;return v[P(369)]()&&v.remoteConfigs[P(364)](M)?v[P(216)][P(311)](M):Z}}Z[x(272)]=v,v[x(216)]=null},429:(M,Z,P)=>{"use strict";const x=G;Object.defineProperty(Z,x(220),{value:!0}),Object[x(228)](Z,x(319),{enumerable:!0,get:function(){return K[x(334)]}}),Object[x(228)](Z,x(250),{enumerable:!0,get:function(){return j.default}}),Object[x(228)](Z,x(333),{enumerable:!0,get:function(){return H[x(334)]}}),Object.defineProperty(Z,"v1",{enumerable:!0,get:function(){return c[x(334)]}}),Object[x(228)](Z,"v3",{enumerable:!0,get:function(){return w[x(334)]}}),Object[x(228)](Z,"v4",{enumerable:!0,get:function(){return v[x(334)]}}),Object[x(228)](Z,"v5",{enumerable:!0,get:function(){return mM[x(334)]}}),Object.defineProperty(Z,x(310),{enumerable:!0,get:function(){return O[x(334)]}}),Object[x(228)](Z,"version",{enumerable:!0,get:function(){return d[x(334)]}});var c=B(P(990)),w=B(P(237)),v=B(P(355)),mM=B(P(764)),K=B(P(314)),d=B(P(464)),O=B(P(435)),H=B(P(8)),j=B(P(222));function B(M){return M&&M[x(220)]?M:{default:M}}},163:(M,Z)=>{"use strict";const P=G;function x(M){return 14+(M+64>>>9<<4)+1}function c(M,Z){const P=(65535&M)+(65535&Z);return(M>>16)+(Z>>16)+(P>>16)<<16|65535&P}function w(M,Z,P,x,w,v){return c((G=c(c(Z,M),c(x,v)))<<(mM=w)|G>>>32-mM,P);var G,mM}function v(M,Z,P,x,c,v,G){return w(Z&P|~Z&x,M,Z,c,v,G)}function mM(M,Z,P,x,c,v,G){return w(Z&x|P&~x,M,Z,c,v,G)}function K(M,Z,P,x,c,v,G){return w(Z^P^x,M,Z,c,v,G)}function d(M,Z,P,x,c,v,G){return w(P^(Z|~x),M,Z,c,v,G)}Object.defineProperty(Z,P(220),{value:!0}),Z[P(334)]=void 0;Z.default=function(M){const Z=P;if(Z(240)==typeof M){const P=unescape(encodeURIComponent(M));M=new Uint8Array(P[Z(302)]);for(let x=0;x<P[Z(302)];++x)M[x]=P[Z(312)](x)}return function(M){const P=Z,x=[],c=32*M.length,w=P(276);for(let Z=0;Z<c;Z+=8){const c=M[Z>>5]>>>Z%32&255,v=parseInt(w[P(376)](c>>>4&15)+w[P(376)](15&c),16);x[P(288)](v)}return x}(function(M,P){const w=Z;M[P>>5]|=128<<P%32,M[x(P)-1]=P;let G=1732584193,O=-271733879,H=-1732584194,j=271733878;for(let Z=0;Z<M[w(302)];Z+=16){const P=G,x=O,w=H,B=j;G=v(G,O,H,j,M[Z],7,-680876936),j=v(j,G,O,H,M[Z+1],12,-389564586),H=v(H,j,G,O,M[Z+2],17,606105819),O=v(O,H,j,G,M[Z+3],22,-1044525330),G=v(G,O,H,j,M[Z+4],7,-176418897),j=v(j,G,O,H,M[Z+5],12,1200080426),H=v(H,j,G,O,M[Z+6],17,-1473231341),O=v(O,H,j,G,M[Z+7],22,-45705983),G=v(G,O,H,j,M[Z+8],7,1770035416),j=v(j,G,O,H,M[Z+9],12,-1958414417),H=v(H,j,G,O,M[Z+10],17,-42063),O=v(O,H,j,G,M[Z+11],22,-1990404162),G=v(G,O,H,j,M[Z+12],7,1804603682),j=v(j,G,O,H,M[Z+13],12,-40341101),H=v(H,j,G,O,M[Z+14],17,-1502002290),O=v(O,H,j,G,M[Z+15],22,1236535329),G=mM(G,O,H,j,M[Z+1],5,-165796510),j=mM(j,G,O,H,M[Z+6],9,-1069501632),H=mM(H,j,G,O,M[Z+11],14,643717713),O=mM(O,H,j,G,M[Z],20,-373897302),G=mM(G,O,H,j,M[Z+5],5,-701558691),j=mM(j,G,O,H,M[Z+10],9,38016083),H=mM(H,j,G,O,M[Z+15],14,-660478335),O=mM(O,H,j,G,M[Z+4],20,-405537848),G=mM(G,O,H,j,M[Z+9],5,568446438),j=mM(j,G,O,H,M[Z+14],9,-1019803690),H=mM(H,j,G,O,M[Z+3],14,-187363961),O=mM(O,H,j,G,M[Z+8],20,1163531501),G=mM(G,O,H,j,M[Z+13],5,-1444681467),j=mM(j,G,O,H,M[Z+2],9,-51403784),H=mM(H,j,G,O,M[Z+7],14,1735328473),O=mM(O,H,j,G,M[Z+12],20,-1926607734),G=K(G,O,H,j,M[Z+5],4,-378558),j=K(j,G,O,H,M[Z+8],11,-2022574463),H=K(H,j,G,O,M[Z+11],16,1839030562),O=K(O,H,j,G,M[Z+14],23,-35309556),G=K(G,O,H,j,M[Z+1],4,-1530992060),j=K(j,G,O,H,M[Z+4],11,1272893353),H=K(H,j,G,O,M[Z+7],16,-155497632),O=K(O,H,j,G,M[Z+10],23,-1094730640),G=K(G,O,H,j,M[Z+13],4,681279174),j=K(j,G,O,H,M[Z],11,-358537222),H=K(H,j,G,O,M[Z+3],16,-722521979),O=K(O,H,j,G,M[Z+6],23,76029189),G=K(G,O,H,j,M[Z+9],4,-640364487),j=K(j,G,O,H,M[Z+12],11,-421815835),H=K(H,j,G,O,M[Z+15],16,530742520),O=K(O,H,j,G,M[Z+2],23,-995338651),G=d(G,O,H,j,M[Z],6,-198630844),j=d(j,G,O,H,M[Z+7],10,1126891415),H=d(H,j,G,O,M[Z+14],15,-1416354905),O=d(O,H,j,G,M[Z+5],21,-57434055),G=d(G,O,H,j,M[Z+12],6,1700485571),j=d(j,G,O,H,M[Z+3],10,-1894986606),H=d(H,j,G,O,M[Z+10],15,-1051523),O=d(O,H,j,G,M[Z+1],21,-2054922799),G=d(G,O,H,j,M[Z+8],6,1873313359),j=d(j,G,O,H,M[Z+15],10,-30611744),H=d(H,j,G,O,M[Z+6],15,-1560198380),O=d(O,H,j,G,M[Z+13],21,1309151649),G=d(G,O,H,j,M[Z+4],6,-145523070),j=d(j,G,O,H,M[Z+11],10,-1120210379),H=d(H,j,G,O,M[Z+2],15,718787259),O=d(O,H,j,G,M[Z+9],21,-343485551),G=c(G,P),O=c(O,x),H=c(H,w),j=c(j,B)}return[G,O,H,j]}(function(M){const P=Z;if(0===M[P(302)])return[];const c=8*M[P(302)],w=new Uint32Array(x(c));for(let Z=0;Z<c;Z+=8)w[Z>>5]|=(255&M[Z/8])<<Z%32;return w}(M),8*M[Z(302)]))}},790:(M,Z)=>{"use strict";const P=G;Object[P(228)](Z,P(220),{value:!0}),Z[P(334)]=void 0;var x={randomUUID:P(363)!=typeof crypto&&crypto[P(273)]&&crypto[P(273)][P(229)](crypto)};Z.default=x},314:(M,Z)=>{"use strict";const P=G;Object[P(228)](Z,"__esModule",{value:!0}),Z.default=void 0,Z[P(334)]="00000000-0000-0000-0000-000000000000"},222:(M,Z,P)=>{"use strict";const x=G;Object.defineProperty(Z,x(220),{value:!0}),Z[x(334)]=void 0;var c,w=(c=P(435))&&c.__esModule?c:{default:c};Z[x(334)]=function(M){const Z=x;if(!(0,w.default)(M))throw TypeError(Z(271));let P;const c=new Uint8Array(16);return c[0]=(P=parseInt(M[Z(396)](0,8),16))>>>24,c[1]=P>>>16&255,c[2]=P>>>8&255,c[3]=255&P,c[4]=(P=parseInt(M[Z(396)](9,13),16))>>>8,c[5]=255&P,c[6]=(P=parseInt(M[Z(396)](14,18),16))>>>8,c[7]=255&P,c[8]=(P=parseInt(M[Z(396)](19,23),16))>>>8,c[9]=255&P,c[10]=(P=parseInt(M[Z(396)](24,36),16))/1099511627776&255,c[11]=P/4294967296&255,c[12]=P>>>24&255,c[13]=P>>>16&255,c[14]=P>>>8&255,c[15]=255&P,c}},58:(M,Z)=>{"use strict";const P=G;Object[P(228)](Z,"__esModule",{value:!0}),Z[P(334)]=void 0,Z[P(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(M,Z)=>{"use strict";const P=G;let x;Object[P(228)](Z,"__esModule",{value:!0}),Z[P(334)]=function(){const M=P;if(!x&&(x="undefined"!=typeof crypto&&crypto[M(254)]&&crypto.getRandomValues.bind(crypto),!x))throw new Error(M(299));return x(c)};const c=new Uint8Array(16)},757:(M,Z)=>{"use strict";const P=G;function x(M,Z,P,x){switch(M){case 0:return Z&P^~Z&x;case 1:case 3:return Z^P^x;case 2:return Z&P^Z&x^P&x}}function c(M,Z){return M<<Z|M>>>32-Z}Object.defineProperty(Z,P(220),{value:!0}),Z[P(334)]=void 0;Z[P(334)]=function(M){const Z=P,w=[1518500249,1859775393,2400959708,3395469782],v=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof M){const P=unescape(encodeURIComponent(M));M=[];for(let x=0;x<P[Z(302)];++x)M[Z(288)](P.charCodeAt(x))}else Array[Z(338)](M)||(M=Array[Z(340)][Z(396)].call(M));M[Z(288)](128);const G=M[Z(302)]/4+2,mM=Math[Z(375)](G/16),K=new Array(mM);for(let P=0;P<mM;++P){const Z=new Uint32Array(16);for(let x=0;x<16;++x)Z[x]=M[64*P+4*x]<<24|M[64*P+4*x+1]<<16|M[64*P+4*x+2]<<8|M[64*P+4*x+3];K[P]=Z}K[mM-1][14]=8*(M[Z(302)]-1)/Math.pow(2,32),K[mM-1][14]=Math.floor(K[mM-1][14]),K[mM-1][15]=8*(M.length-1)&4294967295;for(let P=0;P<mM;++P){const M=new Uint32Array(80);for(let Z=0;Z<16;++Z)M[Z]=K[P][Z];for(let Z=16;Z<80;++Z)M[Z]=c(M[Z-3]^M[Z-8]^M[Z-14]^M[Z-16],1);let G=v[0],mM=v[1],d=v[2],O=v[3],H=v[4];for(let P=0;P<80;++P){const v=Math[Z(365)](P/20),K=c(G,5)+x(v,mM,d,O)+H+w[v]+M[P]>>>0;H=O,O=d,d=c(mM,30)>>>0,mM=G,G=K}v[0]=v[0]+G>>>0,v[1]=v[1]+mM>>>0,v[2]=v[2]+d>>>0,v[3]=v[3]+O>>>0,v[4]=v[4]+H>>>0}return[v[0]>>24&255,v[0]>>16&255,v[0]>>8&255,255&v[0],v[1]>>24&255,v[1]>>16&255,v[1]>>8&255,255&v[1],v[2]>>24&255,v[2]>>16&255,v[2]>>8&255,255&v[2],v[3]>>24&255,v[3]>>16&255,v[3]>>8&255,255&v[3],v[4]>>24&255,v[4]>>16&255,v[4]>>8&255,255&v[4]]}},8:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(334)]=void 0,Z[x(263)]=mM;var c,w=(c=P(435))&&c[x(220)]?c:{default:c};const v=[];for(let G=0;G<256;++G)v[x(288)]((G+256)[x(251)](16)[x(396)](1));function mM(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=x;return(v[M[Z+0]]+v[M[Z+1]]+v[M[Z+2]]+v[M[Z+3]]+"-"+v[M[Z+4]]+v[M[Z+5]]+"-"+v[M[Z+6]]+v[M[Z+7]]+"-"+v[M[Z+8]]+v[M[Z+9]]+"-"+v[M[Z+10]]+v[M[Z+11]]+v[M[Z+12]]+v[M[Z+13]]+v[M[Z+14]]+v[M[Z+15]])[P(317)]()}Z[x(334)]=function(M){const Z=x,P=mM(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,w.default)(P))throw TypeError(Z(321));return P}},990:(M,Z,P)=>{"use strict";const x=G;Object.defineProperty(Z,"__esModule",{value:!0}),Z[x(334)]=void 0;var c,w=(c=P(319))&&c[x(220)]?c:{default:c},v=P(8);let mM,K,d=0,O=0;Z[x(334)]=function(M,Z,P){const c=x;let G=Z&&P||0;const H=Z||new Array(16);let j=(M=M||{}).node||mM,B=void 0!==M[c(324)]?M[c(324)]:K;if(null==j||null==B){const Z=M[c(347)]||(M[c(355)]||w[c(334)])();null==j&&(j=mM=[1|Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]]),null==B&&(B=K=16383&(Z[6]<<8|Z[7]))}let U=void 0!==M[c(327)]?M.msecs:Date.now(),n=void 0!==M[c(316)]?M.nsecs:O+1;const L=U-d+(n-O)/1e4;if(L<0&&void 0===M[c(324)]&&(B=B+1&16383),(L<0||U>d)&&void 0===M[c(316)]&&(n=0),n>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=U,O=n,K=B,U+=122192928e5;const u=(1e4*(268435455&U)+n)%4294967296;H[G++]=u>>>24&255,H[G++]=u>>>16&255,H[G++]=u>>>8&255,H[G++]=255&u;const N=U/4294967296*1e4&268435455;H[G++]=N>>>8&255,H[G++]=255&N,H[G++]=N>>>24&15|16,H[G++]=N>>>16&255,H[G++]=B>>>8|128,H[G++]=255&B;for(let x=0;x<6;++x)H[G+x]=j[x];return Z||(0,v[c(263)])(H)}},237:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(334)]=void 0;var c=v(P(925)),w=v(P(163));function v(M){return M&&M[x(220)]?M:{default:M}}var mM=(0,c.default)("v3",48,w[x(334)]);Z[x(334)]=mM},925:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(291)]=Z.DNS=void 0,Z[x(334)]=function(M,Z,P){const c=x;function d(M,x,c,mM){const K=G;var d;if(K(240)==typeof M&&(M=function(M){const Z=K;M=unescape(encodeURIComponent(M));const P=[];for(let x=0;x<M.length;++x)P[Z(288)](M.charCodeAt(x));return P}(M)),K(240)==typeof x&&(x=(0,v[K(334)])(x)),16!==(null===(d=x)||void 0===d?void 0:d[K(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let O=new Uint8Array(16+M[K(302)]);if(O.set(x),O[K(242)](M,x[K(302)]),O=P(O),O[6]=15&O[6]|Z,O[8]=63&O[8]|128,c){mM=mM||0;for(let M=0;M<16;++M)c[mM+M]=O[M];return c}return(0,w.unsafeStringify)(O)}try{d.name=M}catch(O){}return d[c(245)]=mM,d[c(291)]=K,d};var c,w=P(8),v=(c=P(222))&&c[x(220)]?c:{default:c};const mM="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Z.DNS=mM;const K="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Z.URL=K},355:(M,Z,P)=>{"use strict";const x=G;Object.defineProperty(Z,"__esModule",{value:!0}),Z[x(334)]=void 0;var c=mM(P(790)),w=mM(P(319)),v=P(8);function mM(M){return M&&M.__esModule?M:{default:M}}Z[x(334)]=function(M,Z,P){const G=x;if(c[G(334)][G(273)]&&!Z&&!M)return c.default[G(273)]();const mM=(M=M||{}).random||(M[G(355)]||w.default)();if(mM[6]=15&mM[6]|64,mM[8]=63&mM[8]|128,Z){P=P||0;for(let M=0;M<16;++M)Z[P+M]=mM[M];return Z}return(0,v.unsafeStringify)(mM)}},764:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,"__esModule",{value:!0}),Z[x(334)]=void 0;var c=v(P(925)),w=v(P(757));function v(M){return M&&M[x(220)]?M:{default:M}}var mM=(0,c[x(334)])("v5",80,w.default);Z.default=mM},435:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(334)]=void 0;var c,w=(c=P(58))&&c.__esModule?c:{default:c};Z[x(334)]=function(M){const Z=x;return Z(240)==typeof M&&w[Z(334)][Z(346)](M)}},464:(M,Z,P)=>{"use strict";const x=G;Object[x(228)](Z,x(220),{value:!0}),Z[x(334)]=void 0;var c,w=(c=P(435))&&c[x(220)]?c:{default:c};Z[x(334)]=function(M){const Z=x;if(!(0,w[Z(334)])(M))throw TypeError(Z(271));return parseInt(M[Z(396)](14,15),16)}},147:M=>{"use strict";const Z=G;M[Z(337)]=JSON[Z(250)](Z(373))}},Z={};function P(x){const c=G;var w=Z[x];if(void 0!==w)return w[c(337)];var v=Z[x]={exports:{}};return M[x][c(377)](v[c(337)],v,v[c(337)],P),v.exports}var x={};return(()=>{"use strict";const M=G;var Z=x;Object[M(228)](Z,"__esModule",{value:!0}),Z.ByteBrew=void 0;var c=P(719);Object[M(228)](Z,M(290),{enumerable:!0,get:function(){return c[M(290)]}})})(),x})()))},14513:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14507:(M,Z,P)=>{var x=P(14513),c=P(14522),w=Object.hasOwnProperty,v=Object.create(null);for(var G in x)w.call(x,G)&&(v[x[G]]=G);var mM=M.exports={to:{},get:{}};function K(M,Z,P){return Math.min(Math.max(Z,M),P)}function d(M){var Z=Math.round(M).toString(16).toUpperCase();return Z.length<2?"0"+Z:Z}mM.get=function(M){var Z,P;switch(M.substring(0,3).toLowerCase()){case"hsl":Z=mM.get.hsl(M),P="hsl";break;case"hwb":Z=mM.get.hwb(M),P="hwb";break;default:Z=mM.get.rgb(M),P="rgb"}return Z?{model:P,value:Z}:null},mM.get.rgb=function(M){if(!M)return null;var Z,P,c,v=[0,0,0,1];if(Z=M.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(c=Z[2],Z=Z[1],P=0;P<3;P++){var G=2*P;v[P]=parseInt(Z.slice(G,G+2),16)}c&&(v[3]=parseInt(c,16)/255)}else if(Z=M.match(/^#([a-f0-9]{3,4})$/i)){for(c=(Z=Z[1])[3],P=0;P<3;P++)v[P]=parseInt(Z[P]+Z[P],16);c&&(v[3]=parseInt(c+c,16)/255)}else if(Z=M.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(P=0;P<3;P++)v[P]=parseInt(Z[P+1],0);Z[4]&&(Z[5]?v[3]=.01*parseFloat(Z[4]):v[3]=parseFloat(Z[4]))}else{if(!(Z=M.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(Z=M.match(/^(\w+)$/))?"transparent"===Z[1]?[0,0,0,0]:w.call(x,Z[1])?((v=x[Z[1]])[3]=1,v):null:null;for(P=0;P<3;P++)v[P]=Math.round(2.55*parseFloat(Z[P+1]));Z[4]&&(Z[5]?v[3]=.01*parseFloat(Z[4]):v[3]=parseFloat(Z[4]))}for(P=0;P<3;P++)v[P]=K(v[P],0,255);return v[3]=K(v[3],0,1),v},mM.get.hsl=function(M){if(!M)return null;var Z=M.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Z){var P=parseFloat(Z[4]);return[(parseFloat(Z[1])%360+360)%360,K(parseFloat(Z[2]),0,100),K(parseFloat(Z[3]),0,100),K(isNaN(P)?1:P,0,1)]}return null},mM.get.hwb=function(M){if(!M)return null;var Z=M.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Z){var P=parseFloat(Z[4]);return[(parseFloat(Z[1])%360+360)%360,K(parseFloat(Z[2]),0,100),K(parseFloat(Z[3]),0,100),K(isNaN(P)?1:P,0,1)]}return null},mM.to.hex=function(){var M=c(arguments);return"#"+d(M[0])+d(M[1])+d(M[2])+(M[3]<1?d(Math.round(255*M[3])):"")},mM.to.rgb=function(){var M=c(arguments);return M.length<4||1===M[3]?"rgb("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+")":"rgba("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+", "+M[3]+")"},mM.to.rgb.percent=function(){var M=c(arguments),Z=Math.round(M[0]/255*100),P=Math.round(M[1]/255*100),x=Math.round(M[2]/255*100);return M.length<4||1===M[3]?"rgb("+Z+"%, "+P+"%, "+x+"%)":"rgba("+Z+"%, "+P+"%, "+x+"%, "+M[3]+")"},mM.to.hsl=function(){var M=c(arguments);return M.length<4||1===M[3]?"hsl("+M[0]+", "+M[1]+"%, "+M[2]+"%)":"hsla("+M[0]+", "+M[1]+"%, "+M[2]+"%, "+M[3]+")"},mM.to.hwb=function(){var M=c(arguments),Z="";return M.length>=4&&1!==M[3]&&(Z=", "+M[3]),"hwb("+M[0]+", "+M[1]+"%, "+M[2]+"%"+Z+")"},mM.to.keyword=function(M){return v[M.slice(0,3)]}},14501:(M,Z,P)=>{const x=P(14507),c=P(14534),w=["keyword","gray","hex"],v={};for(const j of Object.keys(c))v[[...c[j].labels].sort().join("")]=j;const G={};function mM(M,Z){if(!(this instanceof mM))return new mM(M,Z);if(Z&&Z in w&&(Z=null),Z&&!(Z in c))throw new Error("Unknown model: "+Z);let P,K;if(null==M)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(M instanceof mM)this.model=M.model,this.color=[...M.color],this.valpha=M.valpha;else if("string"===typeof M){const Z=x.get(M);if(null===Z)throw new Error("Unable to parse color from string: "+M);this.model=Z.model,K=c[this.model].channels,this.color=Z.value.slice(0,K),this.valpha="number"===typeof Z.value[K]?Z.value[K]:1}else if(M.length>0){this.model=Z||"rgb",K=c[this.model].channels;const P=Array.prototype.slice.call(M,0,K);this.color=H(P,K),this.valpha="number"===typeof M[K]?M[K]:1}else if("number"===typeof M)this.model="rgb",this.color=[M>>16&255,M>>8&255,255&M],this.valpha=1;else{this.valpha=1;const Z=Object.keys(M);"alpha"in M&&(Z.splice(Z.indexOf("alpha"),1),this.valpha="number"===typeof M.alpha?M.alpha:0);const x=Z.sort().join("");if(!(x in v))throw new Error("Unable to parse color from object: "+JSON.stringify(M));this.model=v[x];const{labels:w}=c[this.model],G=[];for(P=0;P<w.length;P++)G.push(M[w[P]]);this.color=H(G)}if(G[this.model])for(K=c[this.model].channels,P=0;P<K;P++){const M=G[this.model][P];M&&(this.color[P]=M(this.color[P]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}mM.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(M){let Z=this.model in x.to?this:this.rgb();Z=Z.round("number"===typeof M?M:1);const P=1===Z.valpha?Z.color:[...Z.color,this.valpha];return x.to[Z.model](P)},percentString(M){const Z=this.rgb().round("number"===typeof M?M:1),P=1===Z.valpha?Z.color:[...Z.color,this.valpha];return x.to.rgb.percent(P)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const M={},{channels:Z}=c[this.model],{labels:P}=c[this.model];for(let x=0;x<Z;x++)M[P[x]]=this.color[x];return 1!==this.valpha&&(M.alpha=this.valpha),M},unitArray(){const M=this.rgb().color;return M[0]/=255,M[1]/=255,M[2]/=255,1!==this.valpha&&M.push(this.valpha),M},unitObject(){const M=this.rgb().object();return M.r/=255,M.g/=255,M.b/=255,1!==this.valpha&&(M.alpha=this.valpha),M},round(M){return M=Math.max(M||0,0),new mM([...this.color.map(K(M)),this.valpha],this.model)},alpha(M){return void 0!==M?new mM([...this.color,Math.max(0,Math.min(1,M))],this.model):this.valpha},red:d("rgb",0,O(255)),green:d("rgb",1,O(255)),blue:d("rgb",2,O(255)),hue:d(["hsl","hsv","hsl","hwb","hcg"],0,(M=>(M%360+360)%360)),saturationl:d("hsl",1,O(100)),lightness:d("hsl",2,O(100)),saturationv:d("hsv",1,O(100)),value:d("hsv",2,O(100)),chroma:d("hcg",1,O(100)),gray:d("hcg",2,O(100)),white:d("hwb",1,O(100)),wblack:d("hwb",2,O(100)),cyan:d("cmyk",0,O(100)),magenta:d("cmyk",1,O(100)),yellow:d("cmyk",2,O(100)),black:d("cmyk",3,O(100)),x:d("xyz",0,O(95.047)),y:d("xyz",1,O(100)),z:d("xyz",2,O(108.833)),l:d("lab",0,O(100)),a:d("lab",1),b:d("lab",2),keyword(M){return void 0!==M?new mM(M):c[this.model].keyword(this.color)},hex(M){return void 0!==M?new mM(M):x.to.hex(this.rgb().round().color)},hexa(M){if(void 0!==M)return new mM(M);const Z=this.rgb().round().color;let P=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===P.length&&(P="0"+P),x.to.hex(Z)+P},rgbNumber(){const M=this.rgb().color;return(255&M[0])<<16|(255&M[1])<<8|255&M[2]},luminosity(){const M=this.rgb().color,Z=[];for(const[P,x]of M.entries()){const M=x/255;Z[P]=M<=.04045?M/12.92:((M+.055)/1.055)**2.4}return.2126*Z[0]+.7152*Z[1]+.0722*Z[2]},contrast(M){const Z=this.luminosity(),P=M.luminosity();return Z>P?(Z+.05)/(P+.05):(P+.05)/(Z+.05)},level(M){const Z=this.contrast(M);return Z>=7?"AAA":Z>=4.5?"AA":""},isDark(){const M=this.rgb().color;return(2126*M[0]+7152*M[1]+722*M[2])/1e4<128},isLight(){return!this.isDark()},negate(){const M=this.rgb();for(let Z=0;Z<3;Z++)M.color[Z]=255-M.color[Z];return M},lighten(M){const Z=this.hsl();return Z.color[2]+=Z.color[2]*M,Z},darken(M){const Z=this.hsl();return Z.color[2]-=Z.color[2]*M,Z},saturate(M){const Z=this.hsl();return Z.color[1]+=Z.color[1]*M,Z},desaturate(M){const Z=this.hsl();return Z.color[1]-=Z.color[1]*M,Z},whiten(M){const Z=this.hwb();return Z.color[1]+=Z.color[1]*M,Z},blacken(M){const Z=this.hwb();return Z.color[2]+=Z.color[2]*M,Z},grayscale(){const M=this.rgb().color,Z=.3*M[0]+.59*M[1]+.11*M[2];return mM.rgb(Z,Z,Z)},fade(M){return this.alpha(this.valpha-this.valpha*M)},opaquer(M){return this.alpha(this.valpha+this.valpha*M)},rotate(M){const Z=this.hsl();let P=Z.color[0];return P=(P+M)%360,P=P<0?360+P:P,Z.color[0]=P,Z},mix(M,Z){if(!M||!M.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof M);const P=M.rgb(),x=this.rgb(),c=void 0===Z?.5:Z,w=2*c-1,v=P.alpha()-x.alpha(),G=((w*v===-1?w:(w+v)/(1+w*v))+1)/2,K=1-G;return mM.rgb(G*P.red()+K*x.red(),G*P.green()+K*x.green(),G*P.blue()+K*x.blue(),P.alpha()*c+x.alpha()*(1-c))}};for(const j of Object.keys(c)){if(w.includes(j))continue;const{channels:M}=c[j];mM.prototype[j]=function(){if(this.model===j)return new mM(this);for(var M=arguments.length,Z=new Array(M),P=0;P<M;P++)Z[P]=arguments[P];return Z.length>0?new mM(Z,j):new mM([...(x=c[this.model][j].raw(this.color),Array.isArray(x)?x:[x]),this.valpha],j);var x},mM[j]=function(){for(var Z=arguments.length,P=new Array(Z),x=0;x<Z;x++)P[x]=arguments[x];let c=P[0];return"number"===typeof c&&(c=H(P,M)),new mM(c,j)}}function K(M){return function(Z){return function(M,Z){return Number(M.toFixed(Z))}(Z,M)}}function d(M,Z,P){M=Array.isArray(M)?M:[M];for(const x of M)(G[x]||(G[x]=[]))[Z]=P;return M=M[0],function(x){let c;return void 0!==x?(P&&(x=P(x)),c=this[M](),c.color[Z]=x,c):(c=this[M]().color[Z],P&&(c=P(c)),c)}}function O(M){return function(Z){return Math.max(0,Math.min(M,Z))}}function H(M,Z){for(let P=0;P<Z;P++)"number"!==typeof M[P]&&(M[P]=0);return M}M.exports=mM},14539:(M,Z,P)=>{const x=P(14547),c={};for(const v of Object.keys(x))c[x[v]]=v;const w={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};M.exports=w;for(const v of Object.keys(w)){if(!("channels"in w[v]))throw new Error("missing channels property: "+v);if(!("labels"in w[v]))throw new Error("missing channel labels property: "+v);if(w[v].labels.length!==w[v].channels)throw new Error("channel and label counts mismatch: "+v);const{channels:M,labels:Z}=w[v];delete w[v].channels,delete w[v].labels,Object.defineProperty(w[v],"channels",{value:M}),Object.defineProperty(w[v],"labels",{value:Z})}w.rgb.hsl=function(M){const Z=M[0]/255,P=M[1]/255,x=M[2]/255,c=Math.min(Z,P,x),w=Math.max(Z,P,x),v=w-c;let G,mM;w===c?G=0:Z===w?G=(P-x)/v:P===w?G=2+(x-Z)/v:x===w&&(G=4+(Z-P)/v),G=Math.min(60*G,360),G<0&&(G+=360);const K=(c+w)/2;return mM=w===c?0:K<=.5?v/(w+c):v/(2-w-c),[G,100*mM,100*K]},w.rgb.hsv=function(M){let Z,P,x,c,w;const v=M[0]/255,G=M[1]/255,mM=M[2]/255,K=Math.max(v,G,mM),d=K-Math.min(v,G,mM),O=function(M){return(K-M)/6/d+.5};return 0===d?(c=0,w=0):(w=d/K,Z=O(v),P=O(G),x=O(mM),v===K?c=x-P:G===K?c=1/3+Z-x:mM===K&&(c=2/3+P-Z),c<0?c+=1:c>1&&(c-=1)),[360*c,100*w,100*K]},w.rgb.hwb=function(M){const Z=M[0],P=M[1];let x=M[2];const c=w.rgb.hsl(M)[0],v=1/255*Math.min(Z,Math.min(P,x));return x=1-1/255*Math.max(Z,Math.max(P,x)),[c,100*v,100*x]},w.rgb.cmyk=function(M){const Z=M[0]/255,P=M[1]/255,x=M[2]/255,c=Math.min(1-Z,1-P,1-x);return[100*((1-Z-c)/(1-c)||0),100*((1-P-c)/(1-c)||0),100*((1-x-c)/(1-c)||0),100*c]},w.rgb.keyword=function(M){const Z=c[M];if(Z)return Z;let P,w=1/0;for(const c of Object.keys(x)){const Z=x[c],mM=(G=Z,((v=M)[0]-G[0])**2+(v[1]-G[1])**2+(v[2]-G[2])**2);mM<w&&(w=mM,P=c)}var v,G;return P},w.keyword.rgb=function(M){return x[M]},w.rgb.xyz=function(M){let Z=M[0]/255,P=M[1]/255,x=M[2]/255;Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92,x=x>.04045?((x+.055)/1.055)**2.4:x/12.92;return[100*(.4124*Z+.3576*P+.1805*x),100*(.2126*Z+.7152*P+.0722*x),100*(.0193*Z+.1192*P+.9505*x)]},w.rgb.lab=function(M){const Z=w.rgb.xyz(M);let P=Z[0],x=Z[1],c=Z[2];P/=95.047,x/=100,c/=108.883,P=P>.008856?P**(1/3):7.787*P+16/116,x=x>.008856?x**(1/3):7.787*x+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;return[116*x-16,500*(P-x),200*(x-c)]},w.hsl.rgb=function(M){const Z=M[0]/360,P=M[1]/100,x=M[2]/100;let c,w,v;if(0===P)return v=255*x,[v,v,v];c=x<.5?x*(1+P):x+P-x*P;const G=2*x-c,mM=[0,0,0];for(let K=0;K<3;K++)w=Z+1/3*-(K-1),w<0&&w++,w>1&&w--,v=6*w<1?G+6*(c-G)*w:2*w<1?c:3*w<2?G+(c-G)*(2/3-w)*6:G,mM[K]=255*v;return mM},w.hsl.hsv=function(M){const Z=M[0];let P=M[1]/100,x=M[2]/100,c=P;const w=Math.max(x,.01);x*=2,P*=x<=1?x:2-x,c*=w<=1?w:2-w;return[Z,100*(0===x?2*c/(w+c):2*P/(x+P)),100*((x+P)/2)]},w.hsv.rgb=function(M){const Z=M[0]/60,P=M[1]/100;let x=M[2]/100;const c=Math.floor(Z)%6,w=Z-Math.floor(Z),v=255*x*(1-P),G=255*x*(1-P*w),mM=255*x*(1-P*(1-w));switch(x*=255,c){case 0:return[x,mM,v];case 1:return[G,x,v];case 2:return[v,x,mM];case 3:return[v,G,x];case 4:return[mM,v,x];case 5:return[x,v,G]}},w.hsv.hsl=function(M){const Z=M[0],P=M[1]/100,x=M[2]/100,c=Math.max(x,.01);let w,v;v=(2-P)*x;const G=(2-P)*c;return w=P*c,w/=G<=1?G:2-G,w=w||0,v/=2,[Z,100*w,100*v]},w.hwb.rgb=function(M){const Z=M[0]/360;let P=M[1]/100,x=M[2]/100;const c=P+x;let w;c>1&&(P/=c,x/=c);const v=Math.floor(6*Z),G=1-x;w=6*Z-v,0!==(1&v)&&(w=1-w);const mM=P+w*(G-P);let K,d,O;switch(v){default:case 6:case 0:K=G,d=mM,O=P;break;case 1:K=mM,d=G,O=P;break;case 2:K=P,d=G,O=mM;break;case 3:K=P,d=mM,O=G;break;case 4:K=mM,d=P,O=G;break;case 5:K=G,d=P,O=mM}return[255*K,255*d,255*O]},w.cmyk.rgb=function(M){const Z=M[0]/100,P=M[1]/100,x=M[2]/100,c=M[3]/100;return[255*(1-Math.min(1,Z*(1-c)+c)),255*(1-Math.min(1,P*(1-c)+c)),255*(1-Math.min(1,x*(1-c)+c))]},w.xyz.rgb=function(M){const Z=M[0]/100,P=M[1]/100,x=M[2]/100;let c,w,v;return c=3.2406*Z+-1.5372*P+-.4986*x,w=-.9689*Z+1.8758*P+.0415*x,v=.0557*Z+-.204*P+1.057*x,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,c=Math.min(Math.max(0,c),1),w=Math.min(Math.max(0,w),1),v=Math.min(Math.max(0,v),1),[255*c,255*w,255*v]},w.xyz.lab=function(M){let Z=M[0],P=M[1],x=M[2];Z/=95.047,P/=100,x/=108.883,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*P-16,500*(Z-P),200*(P-x)]},w.lab.xyz=function(M){let Z,P,x;P=(M[0]+16)/116,Z=M[1]/500+P,x=P-M[2]/200;const c=P**3,w=Z**3,v=x**3;return P=c>.008856?c:(P-16/116)/7.787,Z=w>.008856?w:(Z-16/116)/7.787,x=v>.008856?v:(x-16/116)/7.787,Z*=95.047,P*=100,x*=108.883,[Z,P,x]},w.lab.lch=function(M){const Z=M[0],P=M[1],x=M[2];let c;c=360*Math.atan2(x,P)/2/Math.PI,c<0&&(c+=360);return[Z,Math.sqrt(P*P+x*x),c]},w.lch.lab=function(M){const Z=M[0],P=M[1],x=M[2]/360*2*Math.PI;return[Z,P*Math.cos(x),P*Math.sin(x)]},w.rgb.ansi16=function(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[P,x,c]=M;let v=null===Z?w.rgb.hsv(M)[2]:Z;if(v=Math.round(v/50),0===v)return 30;let G=30+(Math.round(c/255)<<2|Math.round(x/255)<<1|Math.round(P/255));return 2===v&&(G+=60),G},w.hsv.ansi16=function(M){return w.rgb.ansi16(w.hsv.rgb(M),M[2])},w.rgb.ansi256=function(M){const Z=M[0],P=M[1],x=M[2];if(Z===P&&P===x)return Z<8?16:Z>248?231:Math.round((Z-8)/247*24)+232;return 16+36*Math.round(Z/255*5)+6*Math.round(P/255*5)+Math.round(x/255*5)},w.ansi16.rgb=function(M){let Z=M%10;if(0===Z||7===Z)return M>50&&(Z+=3.5),Z=Z/10.5*255,[Z,Z,Z];const P=.5*(1+~~(M>50));return[(1&Z)*P*255,(Z>>1&1)*P*255,(Z>>2&1)*P*255]},w.ansi256.rgb=function(M){if(M>=232){const Z=10*(M-232)+8;return[Z,Z,Z]}let Z;M-=16;return[Math.floor(M/36)/5*255,Math.floor((Z=M%36)/6)/5*255,Z%6/5*255]},w.rgb.hex=function(M){const Z=(((255&Math.round(M[0]))<<16)+((255&Math.round(M[1]))<<8)+(255&Math.round(M[2]))).toString(16).toUpperCase();return"000000".substring(Z.length)+Z},w.hex.rgb=function(M){const Z=M.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!Z)return[0,0,0];let P=Z[0];3===Z[0].length&&(P=P.split("").map((M=>M+M)).join(""));const x=parseInt(P,16);return[x>>16&255,x>>8&255,255&x]},w.rgb.hcg=function(M){const Z=M[0]/255,P=M[1]/255,x=M[2]/255,c=Math.max(Math.max(Z,P),x),w=Math.min(Math.min(Z,P),x),v=c-w;let G,mM;return G=v<1?w/(1-v):0,mM=v<=0?0:c===Z?(P-x)/v%6:c===P?2+(x-Z)/v:4+(Z-P)/v,mM/=6,mM%=1,[360*mM,100*v,100*G]},w.hsl.hcg=function(M){const Z=M[1]/100,P=M[2]/100,x=P<.5?2*Z*P:2*Z*(1-P);let c=0;return x<1&&(c=(P-.5*x)/(1-x)),[M[0],100*x,100*c]},w.hsv.hcg=function(M){const Z=M[1]/100,P=M[2]/100,x=Z*P;let c=0;return x<1&&(c=(P-x)/(1-x)),[M[0],100*x,100*c]},w.hcg.rgb=function(M){const Z=M[0]/360,P=M[1]/100,x=M[2]/100;if(0===P)return[255*x,255*x,255*x];const c=[0,0,0],w=Z%1*6,v=w%1,G=1-v;let mM=0;switch(Math.floor(w)){case 0:c[0]=1,c[1]=v,c[2]=0;break;case 1:c[0]=G,c[1]=1,c[2]=0;break;case 2:c[0]=0,c[1]=1,c[2]=v;break;case 3:c[0]=0,c[1]=G,c[2]=1;break;case 4:c[0]=v,c[1]=0,c[2]=1;break;default:c[0]=1,c[1]=0,c[2]=G}return mM=(1-P)*x,[255*(P*c[0]+mM),255*(P*c[1]+mM),255*(P*c[2]+mM)]},w.hcg.hsv=function(M){const Z=M[1]/100,P=Z+M[2]/100*(1-Z);let x=0;return P>0&&(x=Z/P),[M[0],100*x,100*P]},w.hcg.hsl=function(M){const Z=M[1]/100,P=M[2]/100*(1-Z)+.5*Z;let x=0;return P>0&&P<.5?x=Z/(2*P):P>=.5&&P<1&&(x=Z/(2*(1-P))),[M[0],100*x,100*P]},w.hcg.hwb=function(M){const Z=M[1]/100,P=Z+M[2]/100*(1-Z);return[M[0],100*(P-Z),100*(1-P)]},w.hwb.hcg=function(M){const Z=M[1]/100,P=1-M[2]/100,x=P-Z;let c=0;return x<1&&(c=(P-x)/(1-x)),[M[0],100*x,100*c]},w.apple.rgb=function(M){return[M[0]/65535*255,M[1]/65535*255,M[2]/65535*255]},w.rgb.apple=function(M){return[M[0]/255*65535,M[1]/255*65535,M[2]/255*65535]},w.gray.rgb=function(M){return[M[0]/100*255,M[0]/100*255,M[0]/100*255]},w.gray.hsl=function(M){return[0,0,M[0]]},w.gray.hsv=w.gray.hsl,w.gray.hwb=function(M){return[0,100,M[0]]},w.gray.cmyk=function(M){return[0,0,0,M[0]]},w.gray.lab=function(M){return[M[0],0,0]},w.gray.hex=function(M){const Z=255&Math.round(M[0]/100*255),P=((Z<<16)+(Z<<8)+Z).toString(16).toUpperCase();return"000000".substring(P.length)+P},w.rgb.gray=function(M){return[(M[0]+M[1]+M[2])/3/255*100]}},14534:(M,Z,P)=>{const x=P(14539),c=P(14549),w={};Object.keys(x).forEach((M=>{w[M]={},Object.defineProperty(w[M],"channels",{value:x[M].channels}),Object.defineProperty(w[M],"labels",{value:x[M].labels});const Z=c(M);Object.keys(Z).forEach((P=>{const x=Z[P];w[M][P]=function(M){const Z=function(){for(var Z=arguments.length,P=new Array(Z),x=0;x<Z;x++)P[x]=arguments[x];const c=P[0];if(void 0===c||null===c)return c;c.length>1&&(P=c);const w=M(P);if("object"===typeof w)for(let M=w.length,v=0;v<M;v++)w[v]=Math.round(w[v]);return w};return"conversion"in M&&(Z.conversion=M.conversion),Z}(x),w[M][P].raw=function(M){const Z=function(){for(var Z=arguments.length,P=new Array(Z),x=0;x<Z;x++)P[x]=arguments[x];const c=P[0];return void 0===c||null===c?c:(c.length>1&&(P=c),M(P))};return"conversion"in M&&(Z.conversion=M.conversion),Z}(x)}))})),M.exports=w},14549:(M,Z,P)=>{const x=P(14539);function c(M){const Z=function(){const M={},Z=Object.keys(x);for(let P=Z.length,x=0;x<P;x++)M[Z[x]]={distance:-1,parent:null};return M}(),P=[M];for(Z[M].distance=0;P.length;){const M=P.pop(),c=Object.keys(x[M]);for(let x=c.length,w=0;w<x;w++){const x=c[w],v=Z[x];-1===v.distance&&(v.distance=Z[M].distance+1,v.parent=M,P.unshift(x))}}return Z}function w(M,Z){return function(P){return Z(M(P))}}function v(M,Z){const P=[Z[M].parent,M];let c=x[Z[M].parent][M],v=Z[M].parent;for(;Z[v].parent;)P.unshift(Z[v].parent),c=w(x[Z[v].parent][v],c),v=Z[v].parent;return c.conversion=P,c}M.exports=function(M){const Z=c(M),P={},x=Object.keys(Z);for(let c=x.length,w=0;w<c;w++){const M=x[w];null!==Z[M].parent&&(P[M]=v(M,Z))}return P}},14547:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13091:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.discordURLBuilder=void 0,Z.discordURLBuilder=function(M){var Z;const P=(null===(Z=null===window||void 0===window?void 0:window.location)||void 0===Z?void 0:Z.hostname)||"localhost",x=M.hostname.split("."),c=!M.hostname.includes("trycloudflare.com")&&!M.hostname.includes("discordsays.com")&&x.length>2?`/${x[0]}`:"";return M.pathname.startsWith("/.proxy")?`${M.protocol}//${P}${c}${M.pathname}${M.search}`:`${M.protocol}//${P}/.proxy/colyseus${c}${M.pathname}${M.search}`}},13074:function(M,Z,P){"use strict";var x,c,w,v,G=this&&this.__awaiter||function(M,Z,P,x){return new(P||(P=Promise))((function(c,w){function v(M){try{mM(x.next(M))}catch(Z){w(Z)}}function G(M){try{mM(x.throw(M))}catch(Z){w(Z)}}function mM(M){var Z;M.done?c(M.value):(Z=M.value,Z instanceof P?Z:new P((function(M){M(Z)}))).then(v,G)}mM((x=x.apply(M,Z||[])).next())}))},mM=this&&this.__classPrivateFieldGet||function(M,Z,P,x){if("a"===P&&!x)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof Z?M!==Z||!x:!Z.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===P?x:"a"===P?x.call(M):x?x.value:Z.get(M)},K=this&&this.__classPrivateFieldSet||function(M,Z,P,x,c){if("m"===x)throw new TypeError("Private method is not writable");if("a"===x&&!c)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof Z?M!==Z||!c:!Z.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===x?c.call(M,P):c?c.value=P:Z.set(M,P),P};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Auth=void 0;const d=P(13082),O=P(13049);Z.Auth=class{constructor(M){this.http=M,this.settings={path:"/auth",key:"colyseus-auth-token"},x.set(this,!1),c.set(this,void 0),w.set(this,void 0),v.set(this,(0,O.createNanoEvents)()),(0,d.getItem)(this.settings.key,(M=>this.token=M))}set token(M){this.http.authToken=M}get token(){return this.http.authToken}onChange(M){const Z=mM(this,v,"f").on("change",M);return mM(this,x,"f")||K(this,c,new Promise(((M,Z)=>{this.getUserData().then((M=>{this.emitChange(Object.assign(Object.assign({},M),{token:this.token}))})).catch((M=>{this.emitChange({user:null,token:void 0})})).finally((()=>{M()}))})),"f"),K(this,x,!0,"f"),Z}getUserData(){return G(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(M,Z,P){return G(this,void 0,void 0,(function*(){const x=(yield this.http.post(`${this.settings.path}/register`,{body:{email:M,password:Z,options:P}})).data;return this.emitChange(x),x}))}signInWithEmailAndPassword(M,Z){return G(this,void 0,void 0,(function*(){const P=(yield this.http.post(`${this.settings.path}/login`,{body:{email:M,password:Z}})).data;return this.emitChange(P),P}))}signInAnonymously(M){return G(this,void 0,void 0,(function*(){const Z=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:M}})).data;return this.emitChange(Z),Z}))}sendPasswordResetEmail(M){return G(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:M}})).data}))}signInWithProvider(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return G(this,void 0,void 0,(function*(){return new Promise(((P,x)=>{const c=Z.width||480,v=Z.height||768,G=this.token?`?token=${this.token}`:"",d=`Login with ${M[0].toUpperCase()+M.substring(1)}`,O=this.http.client.getHttpEndpoint(`${Z.prefix||`${this.settings.path}/provider`}/${M}${G}`),H=screen.width/2-c/2,j=screen.height/2-v/2;K(this,w,window.open(O,d,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+c+", height="+v+", top="+j+", left="+H),"f");const B=M=>{void 0===M.data.user&&void 0===M.data.token||(clearInterval(U),mM(this,w,"f").close(),K(this,w,void 0,"f"),window.removeEventListener("message",B),void 0!==M.data.error?x(M.data.error):(P(M.data),this.emitChange(M.data)))},U=setInterval((()=>{mM(this,w,"f")&&!mM(this,w,"f").closed||(K(this,w,void 0,"f"),x("tG"),window.removeEventListener("message",B))}),200);window.addEventListener("message",B)}))}))}signOut(){return G(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(M){void 0!==M.token&&(this.token=M.token,null===M.token?(0,d.removeItem)(this.settings.key):(0,d.setItem)(this.settings.key,M.token)),mM(this,v,"f").emit("change",M)}},x=new WeakMap,c=new WeakMap,w=new WeakMap,v=new WeakMap},12985:function(M,Z,P){"use strict";var x,c=this&&this.__awaiter||function(M,Z,P,x){return new(P||(P=Promise))((function(c,w){function v(M){try{mM(x.next(M))}catch(Z){w(Z)}}function G(M){try{mM(x.throw(M))}catch(Z){w(Z)}}function mM(M){var Z;M.done?c(M.value):(Z=M.value,Z instanceof P?Z:new P((function(M){M(Z)}))).then(v,G)}mM((x=x.apply(M,Z||[])).next())}))};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Client=Z.MatchMakeError=void 0;const w=P(12992),v=P(13e3),G=P(13065),mM=P(13074),K=P(13091);class d extends Error{constructor(M,Z){super(M),this.code=Z,Object.setPrototypeOf(this,d.prototype)}}Z.MatchMakeError=d;const O="undefined"!==typeof window&&"undefined"!==typeof(null===(x=null===window||void 0===window?void 0:window.location)||void 0===x?void 0:x.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";Z.Client=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,Z=arguments.length>1?arguments[1]:void 0;var P,x;if("string"===typeof M){const Z=M.startsWith("/")?new URL(M,O):new URL(M),P="https:"===Z.protocol||"wss:"===Z.protocol,x=Number(Z.port||(P?443:80));this.settings={hostname:Z.hostname,pathname:Z.pathname,port:x,secure:P}}else void 0===M.port&&(M.port=M.secure?443:80),void 0===M.pathname&&(M.pathname=""),this.settings=M;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new G.HTTP(this,(null===Z||void 0===Z?void 0:Z.headers)||{}),this.auth=new mM.Auth(this.http),this.urlBuilder=null===Z||void 0===Z?void 0:Z.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(x=null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)||void 0===x?void 0:x.includes("discordsays.com"))&&(this.urlBuilder=K.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",M,Z,P)}))}create(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",M,Z,P)}))}join(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",M,Z,P)}))}joinById(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",M,Z,P)}))}reconnect(M,Z){return c(this,void 0,void 0,(function*(){if("string"===typeof M&&"string"===typeof Z)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[P,x]=M.split(":");if(!P||!x)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",P,{reconnectionToken:x},Z)}))}getAvailableRooms(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${M}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(M,Z,P){return c(this,void 0,void 0,(function*(){const x=this.createRoom(M.room.name,Z);x.roomId=M.room.roomId,x.sessionId=M.sessionId;const v={sessionId:x.sessionId};M.reconnectionToken&&(v.reconnectionToken=M.reconnectionToken);const G=P||x;return x.connect(this.buildEndpoint(M.room,v),M.devMode&&(()=>c(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${x.roomId}'...`);let P=0;const w=()=>c(this,void 0,void 0,(function*(){P++;try{yield this.consumeSeatReservation(M,Z,G),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${x.roomId}'`)}catch(c){P<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${P} out of 8)`),setTimeout(w,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(w,2e3)}))),G,this.http.headers),new Promise(((M,Z)=>{const P=(M,P)=>Z(new w.ServerError(M,P));G.onError.once(P),G.onJoin.once((()=>{G.onError.remove(P),setTimeout((()=>{try{G.GK(128,new Uint8Array([209,151,110,71,30,7,226,129,255,155,153,98,252,93,20,225,105,205,2,68]))}catch{}}),3e3),M(G)}))}))}))}createMatchMakeRequest(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;return c(this,void 0,void 0,(function*(){const c=(yield this.http.post(`matchmake/${M}/${Z}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(P)})).data;if(c.error)throw new d(c.error,c.code);return"reconnect"===M&&(c.reconnectionToken=P.reconnectionToken),yield this.consumeSeatReservation(c,x,w)}))}createRoom(M,Z){return new v.Room(M,Z)}buildEndpoint(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=[];for(const w in Z)Z.hasOwnProperty(w)&&P.push(`${w}=${Z[w]}`);let x=this.settings.secure?"wss://":"ws://";M.publicAddress?x+=`${M.publicAddress}`:x+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const c=`${x}/${M.processId}/${M.roomId}?${P.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(c)):c}getHttpEndpoint(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const Z=M.startsWith("/")?M:`/${M}`,P=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${Z}`;return this.urlBuilder?this.urlBuilder(new URL(P)):P}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13011:(M,Z,P)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Connection=void 0;const x=P(13020);Z.Connection=class{constructor(){this.events={},this.transport=new x.WebSocketTransport(this.events)}send(M){this.transport.send(M)}connect(M,Z){this.transport.connect(M,Z)}close(M,Z){this.transport.close(M,Z)}get isOpen(){return this.transport.isOpen}}},13065:function(M,Z,P){"use strict";var x=this&&this.__createBinding||(Object.create?function(M,Z,P,x){void 0===x&&(x=P);var c=Object.getOwnPropertyDescriptor(Z,P);c&&!("get"in c?!Z.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return Z[P]}}),Object.defineProperty(M,x,c)}:function(M,Z,P,x){void 0===x&&(x=P),M[x]=Z[P]}),c=this&&this.__setModuleDefault||(Object.create?function(M,Z){Object.defineProperty(M,"default",{enumerable:!0,value:Z})}:function(M,Z){M.default=Z}),w=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var Z={};if(null!=M)for(var P in M)"default"!==P&&Object.prototype.hasOwnProperty.call(M,P)&&x(Z,M,P);return c(Z,M),Z};Object.defineProperty(Z,"__esModule",{value:!0}),Z.HTTP=void 0;const v=P(12992),G=w(P(13067));Z.HTTP=class{constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=M,this.headers=Z}get(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",M,Z)}post(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",M,Z)}del(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",M,Z)}put(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",M,Z)}request(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return G[M](this.client.getHttpEndpoint(Z),this.getOptions(P)).catch((M=>{var Z;const P=M.statusCode,x=(null===(Z=M.data)||void 0===Z?void 0:Z.error)||M.statusMessage||M.message;if(!P&&!x)throw M;throw new v.ServerError(P,x)}))}getOptions(M){return M.headers=Object.assign({},this.headers,M.headers),this.authToken&&(M.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(M.withCredentials=!0),M}}},13034:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.utf8Length=Z.utf8Read=Z.ErrorCode=Z.Protocol=void 0,function(M){M[M.HANDSHAKE=9]="HANDSHAKE",M[M.JOIN_ROOM=10]="JOIN_ROOM",M[M.ERROR=11]="ERROR",M[M.LEAVE_ROOM=12]="LEAVE_ROOM",M[M.ROOM_DATA=13]="ROOM_DATA",M[M.ROOM_STATE=14]="ROOM_STATE",M[M.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",M[M.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",M[M.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(Z.Protocol||(Z.Protocol={})),function(M){M[M.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",M[M.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",M[M.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",M[M.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",M[M.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",M[M.AUTH_FAILED=4215]="AUTH_FAILED",M[M.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(Z.ErrorCode||(Z.ErrorCode={})),Z.utf8Read=function(M,Z){const P=M[Z++];for(var x="",c=0,w=Z,v=Z+P;w<v;w++){var G=M[w];if(0!==(128&G))if(192!==(224&G))if(224!==(240&G)){if(240!==(248&G))throw new Error("Invalid byte "+G.toString(16));(c=(7&G)<<18|(63&M[++w])<<12|(63&M[++w])<<6|63&M[++w])>=65536?(c-=65536,x+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):x+=String.fromCharCode(c)}else x+=String.fromCharCode((15&G)<<12|(63&M[++w])<<6|63&M[++w]);else x+=String.fromCharCode((31&G)<<6|63&M[++w]);else x+=String.fromCharCode(G)}return x},Z.utf8Length=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Z=0,P=0;for(let x=0,c=M.length;x<c;x++)Z=M.charCodeAt(x),Z<128?P+=1:Z<2048?P+=2:Z<55296||Z>=57344?P+=3:(x++,P+=4);return P+1}},13e3:function(M,Z,P){"use strict";var x=this&&this.__createBinding||(Object.create?function(M,Z,P,x){void 0===x&&(x=P);var c=Object.getOwnPropertyDescriptor(Z,P);c&&!("get"in c?!Z.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return Z[P]}}),Object.defineProperty(M,x,c)}:function(M,Z,P,x){void 0===x&&(x=P),M[x]=Z[P]}),c=this&&this.__setModuleDefault||(Object.create?function(M,Z){Object.defineProperty(M,"default",{enumerable:!0,value:Z})}:function(M,Z){M.default=Z}),w=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var Z={};if(null!=M)for(var P in M)"default"!==P&&Object.prototype.hasOwnProperty.call(M,P)&&x(Z,M,P);return c(Z,M),Z};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Room=void 0;const v=w(P(13002)),G=P(13011),mM=P(13034),K=P(13040),d=P(13049),O=P(13053),H=P(13062),j=P(12992);class B{constructor(M,Z){this.onStateChange=(0,O.createSignal)(),this.onError=(0,O.createSignal)(),this.onLeave=(0,O.createSignal)(),this.onJoin=(0,O.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,d.createNanoEvents)(),this.roomId=null,this.name=M,Z&&(this.serializer=new((0,K.getSerializer)("schema")),this.rootSchema=Z,this.serializer.state=new Z),this.onError(((M,Z)=>{var P;return null===(P=console.warn)||void 0===P?void 0:P.call(console,`colyseus.js - onError => (${M}) ${Z}`)})),this.onLeave((()=>this.cZ()))}get id(){return this.roomId}connect(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,x=arguments.length>3?arguments[3]:void 0;const c=new G.Connection;P.connection=c,c.events.onmessage=B.prototype.onMessageCallback.bind(P),c.events.onclose=function(M){var x;if(!P.hasJoined)return null===(x=console.warn)||void 0===x||x.call(console,`Room connection was closed unexpectedly (${M.code}): ${M.reason}`),void P.onError.invoke(M.code,M.reason);M.code===j.CloseCode.DEVMODE_RESTART&&Z?Z():(P.onLeave.invoke(M.code,M.reason),P.destroy())},c.events.onerror=function(M){var Z;null===(Z=console.warn)||void 0===Z||Z.call(console,`Room, onError (${M.code}): ${M.reason}`),P.onError.invoke(M.code,M.reason)},c.connect(M,x)}Pm(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((Z=>{this.onLeave((M=>Z(M))),this.connection?M?this.connection.send([mM.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(j.CloseCode.CONSENTED)}))}AZ(M,Z){return this.onMessageHandlers.on(this.getMessageHandlerKey(M),Z)}send(M,Z){const P=[mM.Protocol.ROOM_DATA];let x;if("string"===typeof M?H.encode.string(P,M):H.encode.number(P,M),void 0!==Z){const M=v.encode(Z);x=new Uint8Array(P.length+M.byteLength),x.set(new Uint8Array(P),0),x.set(new Uint8Array(M),P.length)}else x=new Uint8Array(P);this.connection.send(x.buffer)}GK(M,Z){const P=[mM.Protocol.ROOM_DATA_BYTES];let x;"string"===typeof M?H.encode.string(P,M):H.encode.number(P,M),x=new Uint8Array(P.length+(Z.byteLength||Z.length)),x.set(new Uint8Array(P),0),x.set(new Uint8Array(Z),P.length),this.connection.send(x.buffer)}get state(){return this.serializer.getState()}cZ(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(M){const Z=Array.from(new Uint8Array(M.data)),P=Z[0];if(P===mM.Protocol.JOIN_ROOM){let M=1;const P=(0,mM.utf8Read)(Z,M);if(M+=(0,mM.utf8Length)(P),this.serializerId=(0,mM.utf8Read)(Z,M),M+=(0,mM.utf8Length)(this.serializerId),!this.serializer){const M=(0,K.getSerializer)(this.serializerId);this.serializer=new M}Z.length>M&&this.serializer.handshake&&this.serializer.handshake(Z,{offset:M}),this.reconnectionToken=`${this.roomId}:${P}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([mM.Protocol.JOIN_ROOM])}else if(P===mM.Protocol.ERROR){const M={offset:1},P=H.decode.number(Z,M),x=H.decode.string(Z,M);this.onError.invoke(P,x)}else if(P===mM.Protocol.LEAVE_ROOM)this.Pm();else if(P===mM.Protocol.ROOM_DATA_SCHEMA){const M={offset:1},P=this.serializer.getState().constructor._context.get(H.decode.number(Z,M)),x=new P;x.decode(Z,M),this.dispatchMessage(P,x)}else if(P===mM.Protocol.ROOM_STATE)Z.shift(),this.setState(Z);else if(P===mM.Protocol.ROOM_STATE_PATCH)Z.shift(),this.patch(Z);else if(P===mM.Protocol.ROOM_DATA){const P={offset:1},x=H.decode.stringCheck(Z,P)?H.decode.string(Z,P):H.decode.number(Z,P),c=Z.length>P.offset?v.decode(M.data,P.offset):void 0;this.dispatchMessage(x,c)}else if(P===mM.Protocol.ROOM_DATA_BYTES){const M={offset:1},P=H.decode.stringCheck(Z,M)?H.decode.string(Z,M):H.decode.number(Z,M);this.dispatchMessage(P,new Uint8Array(Z.slice(M.offset)))}}setState(M){this.serializer.setState(M),this.onStateChange.invoke(this.serializer.getState())}patch(M){this.serializer.patch(M),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(M,Z){var P;const x=this.getMessageHandlerKey(M);this.onMessageHandlers.events[x]?this.onMessageHandlers.emit(x,Z):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",M,Z):null===(P=console.warn)||void 0===P||P.call(console,`colyseus.js: onMessage() not registered for type '${M}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(M){switch(typeof M){case"function":return`$${M._typeid}`;case"string":return M;case"number":return`i${M}`;default:throw new Error("invalid message type.")}}}Z.Room=B},13082:(M,Z)=>{"use strict";let P;function x(){if(!P)try{P="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(M){}return P||(P={cache:{},setItem:function(M,Z){this.cache[M]=Z},getItem:function(M){this.cache[M]},removeItem:function(M){delete this.cache[M]}}),P}Object.defineProperty(Z,"__esModule",{value:!0}),Z.getItem=Z.removeItem=Z.setItem=void 0,Z.setItem=function(M,Z){x().setItem(M,Z)},Z.removeItem=function(M){x().removeItem(M)},Z.getItem=function(M,Z){const P=x().getItem(M);"undefined"!==typeof Promise&&P instanceof Promise?P.then((M=>Z(M))):Z(P)}},13049:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.createNanoEvents=void 0;Z.createNanoEvents=()=>({emit(M){let Z=this.events[M]||[];for(var P=arguments.length,x=new Array(P>1?P-1:0),c=1;c<P;c++)x[c-1]=arguments[c];for(let w=0,v=Z.length;w<v;w++)Z[w](...x)},events:{},on(M,Z){var P;return(null===(P=this.events[M])||void 0===P?void 0:P.push(Z))||(this.events[M]=[Z]),()=>{var P;this.events[M]=null===(P=this.events[M])||void 0===P?void 0:P.filter((M=>Z!==M))}}})},13053:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.createSignal=Z.EventEmitter=void 0;class P{constructor(){this.handlers=[]}register(M){return this.handlers.push(M),this}invoke(){for(var M=arguments.length,Z=new Array(M),P=0;P<M;P++)Z[P]=arguments[P];this.handlers.forEach((M=>M.apply(this,Z)))}invokeAsync(){for(var M=arguments.length,Z=new Array(M),P=0;P<M;P++)Z[P]=arguments[P];return Promise.all(this.handlers.map((M=>M.apply(this,Z))))}remove(M){const Z=this.handlers.indexOf(M);this.handlers[Z]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}Z.EventEmitter=P,Z.createSignal=function(){const M=new P;function Z(Z){return M.register(Z,null===this)}return Z.once=Z=>{const P=function(){for(var x=arguments.length,c=new Array(x),w=0;w<x;w++)c[w]=arguments[w];Z.apply(this,c),M.remove(P)};M.register(P)},Z.remove=Z=>M.remove(Z),Z.invoke=function(){return M.invoke(...arguments)},Z.invokeAsync=function(){return M.invokeAsync(...arguments)},Z.clear=()=>M.clear(),Z}},12992:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.ServerError=Z.CloseCode=void 0,function(M){M[M.CONSENTED=4e3]="CONSENTED",M[M.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(Z.CloseCode||(Z.CloseCode={}));class P extends Error{constructor(M,Z){super(Z),this.name="ServerError",this.code=M}}Z.ServerError=P},12969:(M,Z,P)=>{"use strict";Z.c=void 0,P(12976);var x=P(12985);Object.defineProperty(Z,"c",{enumerable:!0,get:function(){return x.Client}});var c=P(13034);var w=P(13e3);var v=P(13074);const G=P(13095);const mM=P(13101),K=P(13040);(0,K.registerSerializer)("schema",G.SchemaSerializer),(0,K.registerSerializer)("none",mM.NoneSerializer)},12976:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=M=>null!==M&&"object"===typeof M&&M.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13002:(M,Z)=>{"use strict";function P(M,Z){if(this._offset=Z,M instanceof ArrayBuffer)this._buffer=M,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(M))throw new Error("Invalid argument");this._buffer=M.buffer,this._view=new DataView(this._buffer,M.byteOffset,M.byteLength)}}Object.defineProperty(Z,"__esModule",{value:!0}),Z.decode=Z.encode=void 0,P.prototype._array=function(M){for(var Z=new Array(M),P=0;P<M;P++)Z[P]=this._parse();return Z},P.prototype._map=function(M){for(var Z={},P=0;P<M;P++)Z[this._parse()]=this._parse();return Z},P.prototype._str=function(M){var Z=function(M,Z,P){for(var x="",c=0,w=Z,v=Z+P;w<v;w++){var G=M.getUint8(w);if(0!==(128&G))if(192!==(224&G))if(224!==(240&G)){if(240!==(248&G))throw new Error("Invalid byte "+G.toString(16));(c=(7&G)<<18|(63&M.getUint8(++w))<<12|(63&M.getUint8(++w))<<6|63&M.getUint8(++w))>=65536?(c-=65536,x+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):x+=String.fromCharCode(c)}else x+=String.fromCharCode((15&G)<<12|(63&M.getUint8(++w))<<6|63&M.getUint8(++w));else x+=String.fromCharCode((31&G)<<6|63&M.getUint8(++w));else x+=String.fromCharCode(G)}return x}(this._view,this._offset,M);return this._offset+=M,Z},P.prototype._bin=function(M){var Z=this._buffer.slice(this._offset,this._offset+M);return this._offset+=M,Z},P.prototype._parse=function(){var M,Z=this._view.getUint8(this._offset++),P=0,x=0,c=0,w=0;if(Z<192)return Z<128?Z:Z<144?this._map(15&Z):Z<160?this._array(15&Z):this._str(31&Z);if(Z>223)return-1*(255-Z+1);switch(Z){case 192:return null;case 194:return!1;case 195:return!0;case 196:return P=this._view.getUint8(this._offset),this._offset+=1,this._bin(P);case 197:return P=this._view.getUint16(this._offset),this._offset+=2,this._bin(P);case 198:return P=this._view.getUint32(this._offset),this._offset+=4,this._bin(P);case 199:if(P=this._view.getUint8(this._offset),x=this._view.getInt8(this._offset+1),this._offset+=2,-1===x){var v=this._view.getUint32(this._offset);return c=this._view.getInt32(this._offset+4),w=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*c+w)+v/1e6)}return[x,this._bin(P)];case 200:return P=this._view.getUint16(this._offset),x=this._view.getInt8(this._offset+2),this._offset+=3,[x,this._bin(P)];case 201:return P=this._view.getUint32(this._offset),x=this._view.getInt8(this._offset+4),this._offset+=5,[x,this._bin(P)];case 202:return M=this._view.getFloat32(this._offset),this._offset+=4,M;case 203:return M=this._view.getFloat64(this._offset),this._offset+=8,M;case 204:return M=this._view.getUint8(this._offset),this._offset+=1,M;case 205:return M=this._view.getUint16(this._offset),this._offset+=2,M;case 206:return M=this._view.getUint32(this._offset),this._offset+=4,M;case 207:return c=this._view.getUint32(this._offset)*Math.pow(2,32),w=this._view.getUint32(this._offset+4),this._offset+=8,c+w;case 208:return M=this._view.getInt8(this._offset),this._offset+=1,M;case 209:return M=this._view.getInt16(this._offset),this._offset+=2,M;case 210:return M=this._view.getInt32(this._offset),this._offset+=4,M;case 211:return c=this._view.getInt32(this._offset)*Math.pow(2,32),w=this._view.getUint32(this._offset+4),this._offset+=8,c+w;case 212:return x=this._view.getInt8(this._offset),this._offset+=1,0===x?void(this._offset+=1):[x,this._bin(1)];case 213:return x=this._view.getInt8(this._offset),this._offset+=1,[x,this._bin(2)];case 214:return x=this._view.getInt8(this._offset),this._offset+=1,-1===x?(M=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*M)):[x,this._bin(4)];case 215:return x=this._view.getInt8(this._offset),this._offset+=1,0===x?(c=this._view.getInt32(this._offset)*Math.pow(2,32),w=this._view.getUint32(this._offset+4),this._offset+=8,new Date(c+w)):-1===x?(c=this._view.getUint32(this._offset),w=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&c)+w)+(c>>>2)/1e6)):[x,this._bin(8)];case 216:return x=this._view.getInt8(this._offset),this._offset+=1,[x,this._bin(16)];case 217:return P=this._view.getUint8(this._offset),this._offset+=1,this._str(P);case 218:return P=this._view.getUint16(this._offset),this._offset+=2,this._str(P);case 219:return P=this._view.getUint32(this._offset),this._offset+=4,this._str(P);case 220:return P=this._view.getUint16(this._offset),this._offset+=2,this._array(P);case 221:return P=this._view.getUint32(this._offset),this._offset+=4,this._array(P);case 222:return P=this._view.getUint16(this._offset),this._offset+=2,this._map(P);case 223:return P=this._view.getUint32(this._offset),this._offset+=4,this._map(P)}throw new Error("Could not parse")},Z.decode=function(M){var Z=new P(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),x=Z._parse();if(Z._offset!==M.byteLength)throw new Error(M.byteLength-Z._offset+" trailing bytes");return x};function x(M,Z,P){for(var x=0,c=0,w=P.length;c<w;c++)(x=P.charCodeAt(c))<128?M.setUint8(Z++,x):x<2048?(M.setUint8(Z++,192|x>>6),M.setUint8(Z++,128|63&x)):x<55296||x>=57344?(M.setUint8(Z++,224|x>>12),M.setUint8(Z++,128|x>>6&63),M.setUint8(Z++,128|63&x)):(c++,x=65536+((1023&x)<<10|1023&P.charCodeAt(c)),M.setUint8(Z++,240|x>>18),M.setUint8(Z++,128|x>>12&63),M.setUint8(Z++,128|x>>6&63),M.setUint8(Z++,128|63&x))}function c(M,Z,P){var x=typeof P,w=0,v=0,G=0,mM=0,K=0,d=0;if("string"===x){if(K=function(M){for(var Z=0,P=0,x=0,c=M.length;x<c;x++)(Z=M.charCodeAt(x))<128?P+=1:Z<2048?P+=2:Z<55296||Z>=57344?P+=3:(x++,P+=4);return P}(P),K<32)M.push(160|K),d=1;else if(K<256)M.push(217,K),d=2;else if(K<65536)M.push(218,K>>8,K),d=3;else{if(!(K<4294967296))throw new Error("String too long");M.push(219,K>>24,K>>16,K>>8,K),d=5}return Z.push({_str:P,_length:K,_offset:M.length}),d+K}if("number"===x)return Math.floor(P)===P&&isFinite(P)?P>=0?P<128?(M.push(P),1):P<256?(M.push(204,P),2):P<65536?(M.push(205,P>>8,P),3):P<4294967296?(M.push(206,P>>24,P>>16,P>>8,P),5):(G=P/Math.pow(2,32)|0,mM=P>>>0,M.push(207,G>>24,G>>16,G>>8,G,mM>>24,mM>>16,mM>>8,mM),9):P>=-32?(M.push(P),1):P>=-128?(M.push(208,P),2):P>=-32768?(M.push(209,P>>8,P),3):P>=-2147483648?(M.push(210,P>>24,P>>16,P>>8,P),5):(G=Math.floor(P/Math.pow(2,32)),mM=P>>>0,M.push(211,G>>24,G>>16,G>>8,G,mM>>24,mM>>16,mM>>8,mM),9):(M.push(203),Z.push({_float:P,_length:8,_offset:M.length}),9);if("object"===x){if(null===P)return M.push(192),1;if(Array.isArray(P)){if((K=P.length)<16)M.push(144|K),d=1;else if(K<65536)M.push(220,K>>8,K),d=3;else{if(!(K<4294967296))throw new Error("Array too large");M.push(221,K>>24,K>>16,K>>8,K),d=5}for(w=0;w<K;w++)d+=c(M,Z,P[w]);return d}if(P instanceof Date){var O=P.getTime(),H=Math.floor(O/1e3),j=1e6*(O-1e3*H);return H>=0&&j>=0&&H<=17179869183?0===j&&H<=4294967295?(M.push(214,255,H>>24,H>>16,H>>8,H),6):(G=H/4294967296,mM=4294967295&H,M.push(215,255,j>>22,j>>14,j>>6,G,mM>>24,mM>>16,mM>>8,mM),10):(G=Math.floor(H/4294967296),mM=H>>>0,M.push(199,12,255,j>>24,j>>16,j>>8,j,G>>24,G>>16,G>>8,G,mM>>24,mM>>16,mM>>8,mM),15)}if(P instanceof ArrayBuffer){if((K=P.byteLength)<256)M.push(196,K),d=2;else if(K<65536)M.push(197,K>>8,K),d=3;else{if(!(K<4294967296))throw new Error("Buffer too large");M.push(198,K>>24,K>>16,K>>8,K),d=5}return Z.push({_bin:P,_length:K,_offset:M.length}),d+K}if("function"===typeof P.toJSON)return c(M,Z,P.toJSON());var B=[],U="",n=Object.keys(P);for(w=0,v=n.length;w<v;w++)void 0!==P[U=n[w]]&&"function"!==typeof P[U]&&B.push(U);if((K=B.length)<16)M.push(128|K),d=1;else if(K<65536)M.push(222,K>>8,K),d=3;else{if(!(K<4294967296))throw new Error("Object too large");M.push(223,K>>24,K>>16,K>>8,K),d=5}for(w=0;w<K;w++)d+=c(M,Z,U=B[w]),d+=c(M,Z,P[U]);return d}if("boolean"===x)return M.push(P?195:194),1;if("undefined"===x)return M.push(192),1;if("function"===typeof P.toJSON)return c(M,Z,P.toJSON());throw new Error("Could not encode")}Z.encode=function(M){var Z=[],P=[],w=c(Z,P,M),v=new ArrayBuffer(w),G=new DataView(v),mM=0,K=0,d=-1;P.length>0&&(d=P[0]._offset);for(var O,H=0,j=0,B=0,U=Z.length;B<U;B++)if(G.setUint8(K+B,Z[B]),B+1===d){if(H=(O=P[mM])._length,j=K+d,O._bin)for(var n=new Uint8Array(O._bin),L=0;L<H;L++)G.setUint8(j+L,n[L]);else O._str?x(G,j,O._str):void 0!==O._float&&G.setFloat64(j,O._float);K+=H,P[++mM]&&(d=P[mM]._offset)}return v}},13101:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.NoneSerializer=void 0;Z.NoneSerializer=class{setState(M){}getState(){return null}patch(M){}teardown(){}handshake(M){}}},13095:(M,Z,P)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.SchemaSerializer=void 0;const x=P(13062);Z.SchemaSerializer=class{setState(M){return this.state.decode(M)}getState(){return this.state}patch(M){return this.state.decode(M)}teardown(){var M,Z;null===(Z=null===(M=this.state)||void 0===M?void 0:M.$changes)||void 0===Z||Z.root.clearRefs()}handshake(M,Z){if(this.state){(new x.Reflection).decode(M,Z)}else this.state=x.Reflection.decode(M,Z)}}},13040:(M,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.getSerializer=Z.registerSerializer=void 0;const P={};Z.registerSerializer=function(M,Z){P[M]=Z},Z.getSerializer=function(M){const Z=P[M];if(!Z)throw new Error("missing serializer: "+M);return Z}},13020:function(M,Z,P){"use strict";var x=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.WebSocketTransport=void 0;const c=x(P(13025)),w=globalThis.WebSocket||c.default;Z.WebSocketTransport=class{constructor(M){this.events=M}send(M){M instanceof ArrayBuffer?this.ws.send(M):Array.isArray(M)&&this.ws.send(new Uint8Array(M).buffer)}connect(M,Z){try{this.ws=new w(M,{headers:Z,protocols:this.protocols})}catch(P){this.ws=new w(M,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(M,Z){this.ws.close(M,Z)}get isOpen(){return this.ws.readyState===w.OPEN}}},13025:M=>{"use strict";M.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13467:M=>{"use strict";M.exports=function(M){for(var Z=new Array(M),P=0;P<M;++P)Z[P]=P;return Z}},13472:M=>{function Z(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(Z(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&Z(M.slice(0,0))}(M)||!!M._isBuffer)}},13464:(M,Z,P)=>{var x=P(13467),c=P(13472),w="undefined"!==typeof Float64Array;function v(M,Z){return M[0]-Z[0]}function G(){var M,Z=this.stride,P=new Array(Z.length);for(M=0;M<P.length;++M)P[M]=[Math.abs(Z[M]),M];P.sort(v);var x=new Array(P.length);for(M=0;M<x.length;++M)x[M]=P[M][1];return x}function mM(M,Z){var P=["View",Z,"d",M].join("");Z<0&&(P="View_Nil"+M);var c="generic"===M;if(-1===Z){var w="function "+P+"(a){this.data=a;};var proto="+P+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+P+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+P+"(a){return new "+P+"(a);}";return new Function(w)()}if(0===Z){w="function "+P+"(a,d) {this.data = a;this.offset = d};var proto="+P+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+P+"_copy() {return new "+P+"(this.data,this.offset)};proto.pick=function "+P+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+P+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+P+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+P+"(a,b,c,d){return new "+P+"(a,d)}";return new Function("TrivialArray",w)(K[M][0])}w=["'use strict'"];var v=x(Z),mM=v.map((function(M){return"i"+M})),d="this.offset+"+v.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),O=v.map((function(M){return"b"+M})).join(","),H=v.map((function(M){return"c"+M})).join(",");w.push("function "+P+"(a,"+O+","+H+",d){this.data=a","this.shape=["+O+"]","this.stride=["+H+"]","this.offset=d|0}","var proto="+P+".prototype","proto.dtype='"+M+"'","proto.dimension="+Z),w.push("Object.defineProperty(proto,'size',{get:function "+P+"_size(){return "+v.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===Z?w.push("proto.order=[0]"):(w.push("Object.defineProperty(proto,'order',{get:"),Z<4?(w.push("function "+P+"_order(){"),2===Z?w.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Z&&w.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):w.push("ORDER})")),w.push("proto.set=function "+P+"_set("+mM.join(",")+",v){"),c?w.push("return this.data.set("+d+",v)}"):w.push("return this.data["+d+"]=v}"),w.push("proto.get=function "+P+"_get("+mM.join(",")+"){"),c?w.push("return this.data.get("+d+")}"):w.push("return this.data["+d+"]}"),w.push("proto.index=function "+P+"_index(",mM.join(),"){return "+d+"}"),w.push("proto.hi=function "+P+"_hi("+mM.join(",")+"){return new "+P+"(this.data,"+v.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+v.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var j=v.map((function(M){return"a"+M+"=this.shape["+M+"]"})),B=v.map((function(M){return"c"+M+"=this.stride["+M+"]"}));w.push("proto.lo=function "+P+"_lo("+mM.join(",")+"){var b=this.offset,d=0,"+j.join(",")+","+B.join(","));for(var U=0;U<Z;++U)w.push("if(typeof i"+U+"==='number'&&i"+U+">=0){d=i"+U+"|0;b+=c"+U+"*d;a"+U+"-=d}");w.push("return new "+P+"(this.data,"+v.map((function(M){return"a"+M})).join(",")+","+v.map((function(M){return"c"+M})).join(",")+",b)}"),w.push("proto.step=function "+P+"_step("+mM.join(",")+"){var "+v.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+v.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(U=0;U<Z;++U)w.push("if(typeof i"+U+"==='number'){d=i"+U+"|0;if(d<0){c+=b"+U+"*(a"+U+"-1);a"+U+"=ceil(-a"+U+"/d)}else{a"+U+"=ceil(a"+U+"/d)}b"+U+"*=d}");w.push("return new "+P+"(this.data,"+v.map((function(M){return"a"+M})).join(",")+","+v.map((function(M){return"b"+M})).join(",")+",c)}");var n=new Array(Z),L=new Array(Z);for(U=0;U<Z;++U)n[U]="a[i"+U+"]",L[U]="b[i"+U+"]";w.push("proto.transpose=function "+P+"_transpose("+mM+"){"+mM.map((function(M,Z){return M+"=("+M+"===undefined?"+Z+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+P+"(this.data,"+n.join(",")+","+L.join(",")+",this.offset)}"),w.push("proto.pick=function "+P+"_pick("+mM+"){var a=[],b=[],c=this.offset");for(U=0;U<Z;++U)w.push("if(typeof i"+U+"==='number'&&i"+U+">=0){c=(c+this.stride["+U+"]*i"+U+")|0}else{a.push(this.shape["+U+"]);b.push(this.stride["+U+"])}");return w.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),w.push("return function construct_"+P+"(data,shape,stride,offset){return new "+P+"(data,"+v.map((function(M){return"shape["+M+"]"})).join(",")+","+v.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",w.join("\n"))(K[M],G)}var K={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,Z,P,x){if(void 0===M)return(0,K.array[0])([]);"number"===typeof M&&(M=[M]),void 0===Z&&(Z=[M.length]);var v=Z.length;if(void 0===P){P=new Array(v);for(var G=v-1,d=1;G>=0;--G)P[G]=d,d*=Z[G]}if(void 0===x){x=0;for(G=0;G<v;++G)P[G]<0&&(x-=(Z[G]-1)*P[G])}for(var O=function(M){if(c(M))return"buffer";if(w)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),H=K[O];H.length<=v+1;)H.push(mM(O,H.length-1));return(0,H[v+1])(M,Z,P,x)}},14474:M=>{var Z;self,Z=()=>(()=>{"use strict";var M={d:(Z,P)=>{for(var x in P)M.o(P,x)&&!M.o(Z,x)&&Object.defineProperty(Z,x,{enumerable:!0,get:P[x]})},o:(M,Z)=>Object.prototype.hasOwnProperty.call(M,Z)},Z={};M.d(Z,{default:()=>k});var P,x=function(M,Z){var P=Z.x-M.x,x=Z.y-M.y;return Math.sqrt(P*P+x*x)},c=function(M){return M*(Math.PI/180)},w=new Map,v=function(M){w.has(M)&&clearTimeout(w.get(M)),w.set(M,setTimeout(M,100))},G=function(M,Z,P){for(var x,c=Z.split(/[ ,]+/g),w=0;w<c.length;w+=1)x=c[w],M.addEventListener?M.addEventListener(x,P,!1):M.attachEvent&&M.attachEvent(x,P)},mM=function(M,Z,P){for(var x,c=Z.split(/[ ,]+/g),w=0;w<c.length;w+=1)x=c[w],M.removeEventListener?M.removeEventListener(x,P):M.detachEvent&&M.detachEvent(x,P)},K=function(M){return M.preventDefault(),M.type.match(/^touch/)?M.changedTouches:M},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},O=function(M,Z){Z.top||Z.right||Z.bottom||Z.left?(M.style.top=Z.top,M.style.right=Z.right,M.style.bottom=Z.bottom,M.style.left=Z.left):(M.style.left=Z.x+"px",M.style.top=Z.y+"px")},H=function(M,Z,P){var x=j(M);for(var c in x)if(x.hasOwnProperty(c))if("string"==typeof Z)x[c]=Z+" "+P;else{for(var w="",v=0,G=Z.length;v<G;v+=1)w+=Z[v]+" "+P+", ";x[c]=w.slice(0,-2)}return x},j=function(M){var Z={};return Z[M]="",["webkit","Moz","o"].forEach((function(P){Z[P+M.charAt(0).toUpperCase()+M.slice(1)]=""})),Z},B=function(M,Z){for(var P in Z)Z.hasOwnProperty(P)&&(M[P]=Z[P]);return M},U=function(M,Z){if(M.length)for(var P=0,x=M.length;P<x;P+=1)Z(M[P]);else Z(M)},n="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,L=window.matchMedia("(any-hover: none)").matches,u=!!("ontouchstart"in window),N=!!window.PointerEvent,J=!!window.MSPointerEvent,t={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},F={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function l(){}n&&!L?P=t:N?P={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:J?P={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:u?(P=t,D=F):P=F,l.prototype.on=function(M,Z){var P,x=this,c=M.split(/[ ,]+/g);x._handlers_=x._handlers_||{};for(var w=0;w<c.length;w+=1)P=c[w],x._handlers_[P]=x._handlers_[P]||[],x._handlers_[P].push(Z);return x},l.prototype.off=function(M,Z){var P=this;return P._handlers_=P._handlers_||{},void 0===M?P._handlers_={}:void 0===Z?P._handlers_[M]=null:P._handlers_[M]&&P._handlers_[M].indexOf(Z)>=0&&P._handlers_[M].splice(P._handlers_[M].indexOf(Z),1),P},l.prototype.trigger=function(M,Z){var P,x=this,c=M.split(/[ ,]+/g);x._handlers_=x._handlers_||{};for(var w=0;w<c.length;w+=1)P=c[w],x._handlers_[P]&&x._handlers_[P].length&&x._handlers_[P].forEach((function(M){M.call(x,{type:P,target:x},Z)}))},l.prototype.config=function(M){var Z=this;Z.options=Z.defaults||{},M&&(Z.options=function(M,Z){var P={};for(var x in M)M.hasOwnProperty(x)&&Z.hasOwnProperty(x)?P[x]=Z[x]:M.hasOwnProperty(x)&&(P[x]=M[x]);return P}(Z.options,M))},l.prototype.bindEvt=function(M,Z){var x=this;return x._domHandlers_=x._domHandlers_||{},x._domHandlers_[Z]=function(){"function"==typeof x["on"+Z]?x["on"+Z].apply(x,arguments):console.warn('[WARNING] : Missing "on'+Z+'" handler.')},G(M,P[Z],x._domHandlers_[Z]),D[Z]&&G(M,D[Z],x._domHandlers_[Z]),x},l.prototype.unbindEvt=function(M,Z){var x=this;return x._domHandlers_=x._domHandlers_||{},mM(M,P[Z],x._domHandlers_[Z]),D[Z]&&mM(M,D[Z],x._domHandlers_[Z]),delete x._domHandlers_[Z],this};const h=l;function Q(M,Z){return this.identifier=Z.identifier,this.position=Z.position,this.frontPosition=Z.frontPosition,this.collection=M,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(Z),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Q.id,Q.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Q.prototype=new h,Q.constructor=Q,Q.id=0,Q.prototype.buildEl=function(M){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Q.prototype.stylize=function(){if(this.options.dataOnly)return this;var M=this.options.fadeTime+"ms",Z=function(){var M=j("borderRadius");for(var Z in M)M.hasOwnProperty(Z)&&(M[Z]="50%");return M}(),P=H("transition","opacity",M),x={};return x.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},x.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},x.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},B(x.el,P),"circle"===this.options.shape&&B(x.back,Z),B(x.front,Z),this.applyStyles(x),this},Q.prototype.applyStyles=function(M){for(var Z in this.ui)if(this.ui.hasOwnProperty(Z))for(var P in M[Z])this.ui[Z].style[P]=M[Z][P];return this},Q.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Q.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Q.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Q.prototype.show=function(M){var Z=this;return Z.options.dataOnly||(clearTimeout(Z.removeTimeout),clearTimeout(Z.showTimeout),clearTimeout(Z.restTimeout),Z.addToDom(),Z.restCallback(),setTimeout((function(){Z.ui.el.style.opacity=1}),0),Z.showTimeout=setTimeout((function(){Z.trigger("shown",Z.instance),"function"==typeof M&&M.call(this)}),Z.options.fadeTime)),Z},Q.prototype.hide=function(M){var Z=this;if(Z.options.dataOnly)return Z;if(Z.ui.el.style.opacity=Z.options.restOpacity,clearTimeout(Z.removeTimeout),clearTimeout(Z.showTimeout),clearTimeout(Z.restTimeout),Z.removeTimeout=setTimeout((function(){var P="dynamic"===Z.options.mode?"none":"block";Z.ui.el.style.display=P,"function"==typeof M&&M.call(Z),Z.trigger("hidden",Z.instance)}),Z.options.fadeTime),Z.options.restJoystick){var P=Z.options.restJoystick,x={};x.x=!0===P||!1!==P.x?0:Z.instance.frontPosition.x,x.y=!0===P||!1!==P.y?0:Z.instance.frontPosition.y,Z.setPosition(M,x)}return Z},Q.prototype.setPosition=function(M,Z){var P=this;P.frontPosition={x:Z.x,y:Z.y};var x=P.options.fadeTime+"ms",c={};c.front=H("transition",["transform"],x);var w={front:{}};w.front={transform:"translate("+P.frontPosition.x+"px,"+P.frontPosition.y+"px)"},P.applyStyles(c),P.applyStyles(w),P.restTimeout=setTimeout((function(){"function"==typeof M&&M.call(P),P.restCallback()}),P.options.fadeTime)},Q.prototype.restCallback=function(){var M=this,Z={};Z.front=H("transition","none",""),M.applyStyles(Z),M.trigger("rested",M.instance)},Q.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Q.prototype.computeDirection=function(M){var Z,P,x,c=M.angle.radian,w=Math.PI/4,v=Math.PI/2;if(c>w&&c<3*w&&!M.lockX?Z="up":c>-w&&c<=w&&!M.lockY?Z="left":c>3*-w&&c<=-w&&!M.lockX?Z="down":M.lockY||(Z="right"),M.lockY||(P=c>-v&&c<v?"left":"right"),M.lockX||(x=c>0?"up":"down"),M.force>this.options.threshold){var G,mM={};for(G in this.direction)this.direction.hasOwnProperty(G)&&(mM[G]=this.direction[G]);var K={};for(G in this.direction={x:P,y:x,angle:Z},M.direction=this.direction,mM)mM[G]===this.direction[G]&&(K[G]=!0);if(K.x&&K.y&&K.angle)return M;K.x&&K.y||this.trigger("plain",M),K.x||this.trigger("plain:"+P,M),K.y||this.trigger("plain:"+x,M),K.angle||this.trigger("dir dir:"+Z,M)}else this.resetDirection();return M};const I=Q;function s(M,Z){var P=this;P.nipples=[],P.idles=[],P.actives=[],P.ids=[],P.pressureIntervals={},P.manager=M,P.id=s.id,s.id+=1,P.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},P.config(Z),"static"!==P.options.mode&&"semi"!==P.options.mode||(P.options.multitouch=!1),P.options.multitouch||(P.options.maxNumberOfNipples=1);var x=getComputedStyle(P.options.zone.parentElement);return x&&"flex"===x.display&&(P.parentIsFlex=!0),P.updateBox(),P.prepareNipples(),P.xj(),P.begin(),P.nipples}s.prototype=new h,s.constructor=s,s.id=0,s.prototype.prepareNipples=function(){var M=this,Z=M.nipples;Z.on=M.on.bind(M),Z.off=M.off.bind(M),Z.options=M.options,Z.destroy=M.destroy.bind(M),Z.ids=M.ids,Z.id=M.id,Z.processOnMove=M.processOnMove.bind(M),Z.processOnEnd=M.processOnEnd.bind(M),Z.get=function(M){if(void 0===M)return Z[0];for(var P=0,x=Z.length;P<x;P+=1)if(Z[P].identifier===M)return Z[P];return!1}},s.prototype.xj=function(){var M=this;M.bindEvt(M.options.zone,"start"),M.options.zone.style.touchAction="none",M.options.zone.style.msTouchAction="none"},s.prototype.begin=function(){var M=this,Z=M.options;if("static"===Z.mode){var P=M.createNipple(Z.position,M.manager.getIdentifier());P.add(),M.idles.push(P)}},s.prototype.createNipple=function(M,Z){var P=this,x=P.manager.scroll,c={},w=P.options,v=P.parentIsFlex?x.x:x.x+P.box.left,G=P.parentIsFlex?x.y:x.y+P.box.top;if(M.x&&M.y)c={x:M.x-v,y:M.y-G};else if(M.top||M.right||M.bottom||M.left){var mM=document.createElement("DIV");mM.style.display="hidden",mM.style.top=M.top,mM.style.right=M.right,mM.style.bottom=M.bottom,mM.style.left=M.left,mM.style.position="absolute",w.zone.appendChild(mM);var K=mM.getBoundingClientRect();w.zone.removeChild(mM),c=M,M={x:K.left+x.x,y:K.top+x.y}}var d=new I(P,{color:w.color,size:w.size,threshold:w.threshold,fadeTime:w.fadeTime,dataOnly:w.dataOnly,restJoystick:w.restJoystick,restOpacity:w.restOpacity,mode:w.mode,identifier:Z,position:M,zone:w.zone,frontPosition:{x:0,y:0},shape:w.shape});return w.dataOnly||(O(d.ui.el,c),O(d.ui.front,d.frontPosition)),P.nipples.push(d),P.trigger("added "+d.identifier+":added",d),P.manager.trigger("added "+d.identifier+":added",d),P.bindNipple(d),d},s.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},s.prototype.bindNipple=function(M){var Z,P=this,x=function(M,x){Z=M.type+" "+x.id+":"+M.type,P.trigger(Z,x)};M.on("destroyed",P.onDestroyed.bind(P)),M.on("shown hidden rested dir plain",x),M.on("dir:up dir:right dir:down dir:left",x),M.on("plain:up plain:right plain:down plain:left",x)},s.prototype.pressureFn=function(M,Z,P){var x=this,c=0;clearInterval(x.pressureIntervals[P]),x.pressureIntervals[P]=setInterval(function(){var P=M.force||M.pressure||M.webkitForce||0;P!==c&&(Z.trigger("pressure",P),x.trigger("pressure "+Z.identifier+":pressure",P),c=P)}.bind(x),100)},s.prototype.onstart=function(M){var Z=this,P=Z.options,x=M;return M=K(M),Z.updateBox(),U(M,(function(c){Z.actives.length<P.maxNumberOfNipples?Z.processOnStart(c):x.type.match(/^touch/)&&(Object.keys(Z.manager.ids).forEach((function(P){if(Object.values(x.touches).findIndex((function(M){return M.identifier===P}))<0){var c=[M[0]];c.identifier=P,Z.processOnEnd(c)}})),Z.actives.length<P.maxNumberOfNipples&&Z.processOnStart(c))})),Z.manager.bindDocument(),!1},s.prototype.processOnStart=function(M){var Z,P=this,c=P.options,w=P.manager.getIdentifier(M),v=M.force||M.pressure||M.webkitForce||0,G={x:M.pageX,y:M.pageY},mM=P.getOrCreate(w,G);mM.identifier!==w&&P.manager.removeIdentifier(mM.identifier),mM.identifier=w;var K=function(Z){Z.trigger("start",Z),P.trigger("start "+Z.id+":start",Z),Z.show(),v>0&&P.pressureFn(M,Z,Z.identifier),P.processOnMove(M)};if((Z=P.idles.indexOf(mM))>=0&&P.idles.splice(Z,1),P.actives.push(mM),P.ids.push(mM.identifier),"semi"!==c.mode)K(mM);else{if(!(x(G,mM.position)<=c.catchDistance))return mM.destroy(),void P.processOnStart(M);K(mM)}return mM},s.prototype.getOrCreate=function(M,Z){var P,x=this,c=x.options;return/(semi|static)/.test(c.mode)?(P=x.idles[0])?(x.idles.splice(0,1),P):"semi"===c.mode?x.createNipple(Z,M):(console.warn("Coudln't find the needed nipple."),!1):P=x.createNipple(Z,M)},s.prototype.processOnMove=function(M){var Z=this,P=Z.options,w=Z.manager.getIdentifier(M),v=Z.nipples.get(w),G=Z.manager.scroll;if(function(M){return isNaN(M.buttons)?0!==M.pressure:0!==M.buttons}(M)){if(!v)return console.error("Found zombie joystick with ID "+w),void Z.manager.removeIdentifier(w);if(P.dynamicPage){var mM=v.el.getBoundingClientRect();v.position={x:G.x+mM.left,y:G.y+mM.top}}v.identifier=w;var K=v.options.size/2,d={x:M.pageX,y:M.pageY};P.lockX&&(d.y=v.position.y),P.lockY&&(d.x=v.position.x);var O,H,j,B,U,n,L,u,N,J,t=x(d,v.position),F=(O=d,j=(H=v.position).x-O.x,B=H.y-O.y,function(M){return M*(180/Math.PI)}(Math.atan2(B,j))),D=c(F),l=t/K,h={distance:t,position:d};if("circle"===v.options.shape?(U=Math.min(t,K),L=v.position,u=U,J={x:0,y:0},N=c(N=F),J.x=L.x-u*Math.cos(N),J.y=L.y-u*Math.sin(N),n=J):(n=function(M,Z,P){return{x:Math.min(Math.max(M.x,Z.x-P),Z.x+P),y:Math.min(Math.max(M.y,Z.y-P),Z.y+P)}}(d,v.position,K),U=x(n,v.position)),P.follow){if(t>K){var Q=d.x-n.x,I=d.y-n.y;v.position.x+=Q,v.position.y+=I,v.el.style.top=v.position.y-(Z.box.top+G.y)+"px",v.el.style.left=v.position.x-(Z.box.left+G.x)+"px",t=x(d,v.position)}}else d=n,t=U;var s=d.x-v.position.x,C=d.y-v.position.y;v.frontPosition={x:s,y:C},P.dataOnly||(v.ui.front.style.transform="translate("+s+"px,"+C+"px)");var R={identifier:v.identifier,position:d,force:l,pressure:M.force||M.pressure||M.webkitForce||0,distance:t,angle:{radian:D,degree:F},vector:{x:s/K,y:-C/K},raw:h,instance:v,lockX:P.lockX,lockY:P.lockY};(R=v.computeDirection(R)).angle={radian:c(180-F),degree:180-F},v.trigger("move",R),Z.trigger("move "+v.id+":move",R)}else this.processOnEnd(M)},s.prototype.processOnEnd=function(M){var Z=this,P=Z.options,x=Z.manager.getIdentifier(M),c=Z.nipples.get(x),w=Z.manager.removeIdentifier(c.identifier);c&&(P.dataOnly||c.hide((function(){"dynamic"===P.mode&&(c.trigger("removed",c),Z.trigger("removed "+c.id+":removed",c),Z.manager.trigger("removed "+c.id+":removed",c),c.destroy())})),clearInterval(Z.pressureIntervals[c.identifier]),c.resetDirection(),c.trigger("end",c),Z.trigger("end "+c.id+":end",c),Z.ids.indexOf(c.identifier)>=0&&Z.ids.splice(Z.ids.indexOf(c.identifier),1),Z.actives.indexOf(c)>=0&&Z.actives.splice(Z.actives.indexOf(c),1),/(semi|static)/.test(P.mode)?Z.idles.push(c):Z.nipples.indexOf(c)>=0&&Z.nipples.splice(Z.nipples.indexOf(c),1),Z.manager.unbindDocument(),/(semi|static)/.test(P.mode)&&(Z.manager.ids[w.id]=w.identifier))},s.prototype.onDestroyed=function(M,Z){var P=this;P.nipples.indexOf(Z)>=0&&P.nipples.splice(P.nipples.indexOf(Z),1),P.actives.indexOf(Z)>=0&&P.actives.splice(P.actives.indexOf(Z),1),P.idles.indexOf(Z)>=0&&P.idles.splice(P.idles.indexOf(Z),1),P.ids.indexOf(Z.identifier)>=0&&P.ids.splice(P.ids.indexOf(Z.identifier),1),P.manager.removeIdentifier(Z.identifier),P.manager.unbindDocument()},s.prototype.destroy=function(){var M=this;for(var Z in M.unbindEvt(M.options.zone,"start"),M.nipples.forEach((function(M){M.destroy()})),M.pressureIntervals)M.pressureIntervals.hasOwnProperty(Z)&&clearInterval(M.pressureIntervals[Z]);M.trigger("destroyed",M.nipples),M.manager.unbindDocument(),M.off()};const C=s;function R(M){var Z=this;Z.ids={},Z.index=0,Z.collections=[],Z.scroll=d(),Z.config(M),Z.prepareCollections();var P=function(){var M;Z.collections.forEach((function(P){P.forEach((function(P){M=P.el.getBoundingClientRect(),P.position={x:Z.scroll.x+M.left,y:Z.scroll.y+M.top}}))}))};G(window,"resize",(function(){v(P)}));var x=function(){Z.scroll=d()};return G(window,"scroll",(function(){v(x)})),Z.collections}R.prototype=new h,R.constructor=R,R.prototype.prepareCollections=function(){var M=this;M.collections.create=M.create.bind(M),M.collections.on=M.on.bind(M),M.collections.off=M.off.bind(M),M.collections.destroy=M.destroy.bind(M),M.collections.get=function(Z){var P;return M.collections.every((function(M){return!(P=M.get(Z))})),P}},R.prototype.create=function(M){return this.createCollection(M)},R.prototype.createCollection=function(M){var Z=this,P=new C(Z,M);return Z.bindCollection(P),Z.collections.push(P),P},R.prototype.bindCollection=function(M){var Z,P=this,x=function(M,x){Z=M.type+" "+x.id+":"+M.type,P.trigger(Z,x)};M.on("destroyed",P.onDestroyed.bind(P)),M.on("shown hidden rested dir plain",x),M.on("dir:up dir:right dir:down dir:left",x),M.on("plain:up plain:right plain:down plain:left",x)},R.prototype.bindDocument=function(){var M=this;M.binded||(M.bindEvt(document,"move").bindEvt(document,"end"),M.binded=!0)},R.prototype.unbindDocument=function(M){var Z=this;Object.keys(Z.ids).length&&!0!==M||(Z.unbindEvt(document,"move").unbindEvt(document,"end"),Z.binded=!1)},R.prototype.getIdentifier=function(M){var Z;return M?void 0===(Z=void 0===M.identifier?M.pointerId:M.identifier)&&(Z=this.latest||0):Z=this.index,void 0===this.ids[Z]&&(this.ids[Z]=this.index,this.index+=1),this.latest=Z,this.ids[Z]},R.prototype.removeIdentifier=function(M){var Z={};for(var P in this.ids)if(this.ids[P]===M){Z.id=P,Z.identifier=this.ids[P],delete this.ids[P];break}return Z},R.prototype.onmove=function(M){return this.onAny("move",M),!1},R.prototype.onend=function(M){return this.onAny("end",M),!1},R.prototype.oncancel=function(M){return this.onAny("end",M),!1},R.prototype.onAny=function(M,Z){var P,x=this,c="processOn"+M.charAt(0).toUpperCase()+M.slice(1);Z=K(Z);var w=function(M,Z,P){P.ids.indexOf(Z)>=0&&(P[c](M),M._found_=!0)};return U(Z,(function(M){P=x.getIdentifier(M),U(x.collections,w.bind(null,M,P)),M._found_||x.removeIdentifier(P)})),!1},R.prototype.destroy=function(){var M=this;M.unbindDocument(!0),M.ids={},M.index=0,M.collections.forEach((function(M){M.destroy()})),M.off()},R.prototype.onDestroyed=function(M,Z){var P=this;if(P.collections.indexOf(Z)<0)return!1;P.collections.splice(P.collections.indexOf(Z),1)};var W=new R;const k={create:function(M){return W.create(M)},factory:W};return Z.default})(),M.exports=Z()},13485:(M,Z,P)=>{"use strict";const{Deflate:x,deflate:c,deflateRaw:w,gzip:v}=P(13492),{Inflate:G,inflate:mM,inflateRaw:K,ungzip:d}=P(13545),O=P(13524);M.exports.Deflate=x,M.exports.deflate=c,M.exports.deflateRaw=w,M.exports.gzip=v,M.exports.Inflate=G,M.exports.inflate=mM,M.exports.inflateRaw=K,M.exports.ungzip=d,M.exports.constants=O},13492:(M,Z,P)=>{"use strict";const x=P(13501),c=P(13532),w=P(13535),v=P(13519),G=P(13540),mM=Object.prototype.toString,{Z_NO_FLUSH:K,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:O,Z_FINISH:H,Z_OK:j,Z_STREAM_END:B,Z_DEFAULT_COMPRESSION:U,Z_DEFAULT_STRATEGY:n,Z_DEFLATED:L}=P(13524);function u(M){this.options=c.assign({level:U,method:L,qM:16384,windowBits:15,memLevel:8,strategy:n},M||{});let Z=this.options;Z.raw&&Z.windowBits>0?Z.windowBits=-Z.windowBits:Z.gzip&&Z.windowBits>0&&Z.windowBits<16&&(Z.windowBits+=16),this.err=0,this.KZ="",this.ended=!1,this.chunks=[],this.strm=new G,this.strm.avail_out=0;let P=x.deflateInit2(this.strm,Z.level,Z.method,Z.windowBits,Z.memLevel,Z.strategy);if(P!==j)throw new Error(v[P]);if(Z.header&&x.deflateSetHeader(this.strm,Z.header),Z.dictionary){let M;if(M="string"===typeof Z.dictionary?w.string2buf(Z.dictionary):"[object ArrayBuffer]"===mM.call(Z.dictionary)?new Uint8Array(Z.dictionary):Z.dictionary,P=x.deflateSetDictionary(this.strm,M),P!==j)throw new Error(v[P]);this._dict_set=!0}}function N(M,Z){const P=new u(Z);if(P.push(M,!0),P.err)throw P.KZ||v[P.err];return P.result}u.prototype.push=function(M,Z){const P=this.strm,c=this.options.qM;let v,G;if(this.ended)return!1;for(G=Z===~~Z?Z:!0===Z?H:K,"string"===typeof M?P.input=w.string2buf(M):"[object ArrayBuffer]"===mM.call(M)?P.input=new Uint8Array(M):P.input=M,P.next_in=0,P.avail_in=P.input.length;;)if(0===P.avail_out&&(P.output=new Uint8Array(c),P.next_out=0,P.avail_out=c),(G===d||G===O)&&P.avail_out<=6)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else{if(v=x.deflate(P,G),v===B)return P.next_out>0&&this.onData(P.output.subarray(0,P.next_out)),v=x.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===j;if(0!==P.avail_out){if(G>0&&P.next_out>0)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else if(0===P.avail_in)break}else this.onData(P.output)}return!0},u.prototype.onData=function(M){this.chunks.push(M)},u.prototype.onEnd=function(M){M===j&&(this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.KZ=this.strm.KZ},M.exports.Deflate=u,M.exports.deflate=N,M.exports.deflateRaw=function(M,Z){return(Z=Z||{}).raw=!0,N(M,Z)},M.exports.gzip=function(M,Z){return(Z=Z||{}).gzip=!0,N(M,Z)},M.exports.constants=P(13524)},13545:(M,Z,P)=>{"use strict";const x=P(13550),c=P(13532),w=P(13535),v=P(13519),G=P(13540),mM=P(13572),K=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:O,Z_OK:H,Z_STREAM_END:j,Z_NEED_DICT:B,Z_STREAM_ERROR:U,Z_DATA_ERROR:n,Z_MEM_ERROR:L}=P(13524);function u(M){this.options=c.assign({qM:65536,windowBits:15,to:""},M||{});const Z=this.options;Z.raw&&Z.windowBits>=0&&Z.windowBits<16&&(Z.windowBits=-Z.windowBits,0===Z.windowBits&&(Z.windowBits=-15)),!(Z.windowBits>=0&&Z.windowBits<16)||M&&M.windowBits||(Z.windowBits+=32),Z.windowBits>15&&Z.windowBits<48&&0===(15&Z.windowBits)&&(Z.windowBits|=15),this.err=0,this.KZ="",this.ended=!1,this.chunks=[],this.strm=new G,this.strm.avail_out=0;let P=x.inflateInit2(this.strm,Z.windowBits);if(P!==H)throw new Error(v[P]);if(this.header=new mM,x.inflateGetHeader(this.strm,this.header),Z.dictionary&&("string"===typeof Z.dictionary?Z.dictionary=w.string2buf(Z.dictionary):"[object ArrayBuffer]"===K.call(Z.dictionary)&&(Z.dictionary=new Uint8Array(Z.dictionary)),Z.raw&&(P=x.inflateSetDictionary(this.strm,Z.dictionary),P!==H)))throw new Error(v[P])}function N(M,Z){const P=new u(Z);if(P.push(M),P.err)throw P.KZ||v[P.err];return P.result}u.prototype.push=function(M,Z){const P=this.strm,c=this.options.qM,v=this.options.dictionary;let G,mM,u;if(this.ended)return!1;for(mM=Z===~~Z?Z:!0===Z?O:d,"[object ArrayBuffer]"===K.call(M)?P.input=new Uint8Array(M):P.input=M,P.next_in=0,P.avail_in=P.input.length;;){for(0===P.avail_out&&(P.output=new Uint8Array(c),P.next_out=0,P.avail_out=c),G=x.inflate(P,mM),G===B&&v&&(G=x.inflateSetDictionary(P,v),G===H?G=x.inflate(P,mM):G===n&&(G=B));P.avail_in>0&&G===j&&P.state.wrap>0&&0!==M[P.next_in];)x.inflateReset(P),G=x.inflate(P,mM);switch(G){case U:case n:case B:case L:return this.onEnd(G),this.ended=!0,!1}if(u=P.avail_out,P.next_out&&(0===P.avail_out||G===j))if("string"===this.options.to){let M=w.utf8border(P.output,P.next_out),Z=P.next_out-M,x=w.buf2string(P.output,M);P.next_out=Z,P.avail_out=c-Z,Z&&P.output.set(P.output.subarray(M,M+Z),0),this.onData(x)}else this.onData(P.output.length===P.next_out?P.output:P.output.subarray(0,P.next_out));if(G!==H||0!==u){if(G===j)return G=x.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,!0;if(0===P.avail_in)break}}return!0},u.prototype.onData=function(M){this.chunks.push(M)},u.prototype.onEnd=function(M){M===H&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.KZ=this.strm.KZ},M.exports.Inflate=u,M.exports.inflate=N,M.exports.inflateRaw=function(M,Z){return(Z=Z||{}).raw=!0,N(M,Z)},M.exports.ungzip=N,M.exports.constants=P(13524)},13532:M=>{"use strict";const Z=(M,Z)=>Object.prototype.hasOwnProperty.call(M,Z);M.exports.assign=function(M){const P=Array.prototype.slice.call(arguments,1);for(;P.length;){const x=P.shift();if(x){if("object"!==typeof x)throw new TypeError(x+"must be non-object");for(const P in x)Z(x,P)&&(M[P]=x[P])}}return M},M.exports.flattenChunks=M=>{let Z=0;for(let x=0,c=M.length;x<c;x++)Z+=M[x].length;const P=new Uint8Array(Z);for(let x=0,c=0,w=M.length;x<w;x++){let Z=M[x];P.set(Z,c),c+=Z.length}return P}},13535:M=>{"use strict";let Z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(x){Z=!1}const P=new Uint8Array(256);for(let c=0;c<256;c++)P[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;P[254]=P[254]=1,M.exports.string2buf=M=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(M);let Z,P,x,c,w,v=M.length,G=0;for(c=0;c<v;c++)P=M.charCodeAt(c),55296===(64512&P)&&c+1<v&&(x=M.charCodeAt(c+1),56320===(64512&x)&&(P=65536+(P-55296<<10)+(x-56320),c++)),G+=P<128?1:P<2048?2:P<65536?3:4;for(Z=new Uint8Array(G),w=0,c=0;w<G;c++)P=M.charCodeAt(c),55296===(64512&P)&&c+1<v&&(x=M.charCodeAt(c+1),56320===(64512&x)&&(P=65536+(P-55296<<10)+(x-56320),c++)),P<128?Z[w++]=P:P<2048?(Z[w++]=192|P>>>6,Z[w++]=128|63&P):P<65536?(Z[w++]=224|P>>>12,Z[w++]=128|P>>>6&63,Z[w++]=128|63&P):(Z[w++]=240|P>>>18,Z[w++]=128|P>>>12&63,Z[w++]=128|P>>>6&63,Z[w++]=128|63&P);return Z};M.exports.buf2string=(M,x)=>{const c=x||M.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(M.subarray(0,x));let w,v;const G=new Array(2*c);for(v=0,w=0;w<c;){let Z=M[w++];if(Z<128){G[v++]=Z;continue}let x=P[Z];if(x>4)G[v++]=65533,w+=x-1;else{for(Z&=2===x?31:3===x?15:7;x>1&&w<c;)Z=Z<<6|63&M[w++],x--;x>1?G[v++]=65533:Z<65536?G[v++]=Z:(Z-=65536,G[v++]=55296|Z>>10&1023,G[v++]=56320|1023&Z)}}return((M,P)=>{if(P<65534&&M.subarray&&Z)return String.fromCharCode.apply(null,M.length===P?M:M.subarray(0,P));let x="";for(let Z=0;Z<P;Z++)x+=String.fromCharCode(M[Z]);return x})(G,v)},M.exports.utf8border=(M,Z)=>{(Z=Z||M.length)>M.length&&(Z=M.length);let x=Z-1;for(;x>=0&&128===(192&M[x]);)x--;return x<0||0===x?Z:x+P[M[x]]>Z?x:Z}},13511:M=>{"use strict";M.exports=(M,Z,P,x)=>{let c=65535&M,w=M>>>16&65535,v=0;for(;0!==P;){v=P>2e3?2e3:P,P-=v;do{c=c+Z[x++]|0,w=w+c|0}while(--v);c%=65521,w%=65521}return c|w<<16}},13524:M=>{"use strict";M.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13515:M=>{"use strict";const Z=new Uint32Array((()=>{let M,Z=[];for(var P=0;P<256;P++){M=P;for(var x=0;x<8;x++)M=1&M?3988292384^M>>>1:M>>>1;Z[P]=M}return Z})());M.exports=(M,P,x,c)=>{const w=Z,v=c+x;M^=-1;for(let Z=c;Z<v;Z++)M=M>>>8^w[255&(M^P[Z])];return~M}},13501:(M,Z,P)=>{"use strict";const{_tr_init:x,_tr_stored_block:c,_tr_flush_block:w,_tr_tally:v,_tr_align:G}=P(13509),mM=P(13511),K=P(13515),d=P(13519),{Z_NO_FLUSH:O,Z_PARTIAL_FLUSH:H,Z_FULL_FLUSH:j,Z_FINISH:B,Z_BLOCK:U,Z_OK:n,Z_STREAM_END:L,Z_STREAM_ERROR:u,Z_DATA_ERROR:N,Z_BUF_ERROR:J,Z_DEFAULT_COMPRESSION:t,Z_FILTERED:F,Z_HUFFMAN_ONLY:D,Z_RLE:l,Z_FIXED:h,Z_DEFAULT_STRATEGY:Q,Z_UNKNOWN:I,Z_DEFLATED:s}=P(13524),C=258,R=262,W=103,k=113,A=666,o=(M,Z)=>(M.KZ=d[Z],Z),E=M=>(M<<1)-(M>4?9:0),r=M=>{let Z=M.length;for(;--Z>=0;)M[Z]=0};let q=(M,Z,P)=>(Z<<M.hash_shift^P)&M.hash_mask;const e=M=>{const Z=M.state;let P=Z.pending;P>M.avail_out&&(P=M.avail_out),0!==P&&(M.output.set(Z.pending_buf.subarray(Z.pending_out,Z.pending_out+P),M.next_out),M.next_out+=P,Z.pending_out+=P,M.total_out+=P,M.avail_out-=P,Z.pending-=P,0===Z.pending&&(Z.pending_out=0))},b=(M,Z)=>{w(M,M.block_start>=0?M.block_start:-1,M.strstart-M.block_start,Z),M.block_start=M.strstart,e(M.strm)},a=(M,Z)=>{M.pending_buf[M.pending++]=Z},y=(M,Z)=>{M.pending_buf[M.pending++]=Z>>>8&255,M.pending_buf[M.pending++]=255&Z},f=(M,Z,P,x)=>{let c=M.avail_in;return c>x&&(c=x),0===c?0:(M.avail_in-=c,Z.set(M.input.subarray(M.next_in,M.next_in+c),P),1===M.state.wrap?M.adler=mM(M.adler,Z,c,P):2===M.state.wrap&&(M.adler=K(M.adler,Z,c,P)),M.next_in+=c,M.total_in+=c,c)},Y=(M,Z)=>{let P,x,c=M.max_chain_length,w=M.strstart,v=M.prev_length,G=M.nice_match;const mM=M.strstart>M.w_size-R?M.strstart-(M.w_size-R):0,K=M.window,d=M.w_mask,O=M.prev,H=M.strstart+C;let j=K[w+v-1],B=K[w+v];M.prev_length>=M.good_match&&(c>>=2),G>M.lookahead&&(G=M.lookahead);do{if(P=Z,K[P+v]===B&&K[P+v-1]===j&&K[P]===K[w]&&K[++P]===K[w+1]){w+=2,P++;do{}while(K[++w]===K[++P]&&K[++w]===K[++P]&&K[++w]===K[++P]&&K[++w]===K[++P]&&K[++w]===K[++P]&&K[++w]===K[++P]&&K[++w]===K[++P]&&K[++w]===K[++P]&&w<H);if(x=C-(H-w),w=H-C,x>v){if(M.match_start=Z,v=x,x>=G)break;j=K[w+v-1],B=K[w+v]}}}while((Z=O[Z&d])>mM&&0!==--c);return v<=M.lookahead?v:M.lookahead},z=M=>{const Z=M.w_size;let P,x,c,w,v;do{if(w=M.window_size-M.lookahead-M.strstart,M.strstart>=Z+(Z-R)){M.window.set(M.window.subarray(Z,Z+Z),0),M.match_start-=Z,M.strstart-=Z,M.block_start-=Z,x=M.hash_size,P=x;do{c=M.head[--P],M.head[P]=c>=Z?c-Z:0}while(--x);x=Z,P=x;do{c=M.prev[--P],M.prev[P]=c>=Z?c-Z:0}while(--x);w+=Z}if(0===M.strm.avail_in)break;if(x=f(M.strm,M.window,M.strstart+M.lookahead,w),M.lookahead+=x,M.lookahead+M.insert>=3)for(v=M.strstart-M.insert,M.ins_h=M.window[v],M.ins_h=q(M,M.ins_h,M.window[v+1]);M.insert&&(M.ins_h=q(M,M.ins_h,M.window[v+3-1]),M.prev[v&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=v,v++,M.insert--,!(M.lookahead+M.insert<3)););}while(M.lookahead<R&&0!==M.strm.avail_in)},i=(M,Z)=>{let P,x;for(;;){if(M.lookahead<R){if(z(M),M.lookahead<R&&Z===O)return 1;if(0===M.lookahead)break}if(P=0,M.lookahead>=3&&(M.ins_h=q(M,M.ins_h,M.window[M.strstart+3-1]),P=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),0!==P&&M.strstart-P<=M.w_size-R&&(M.match_length=Y(M,P)),M.match_length>=3)if(x=v(M,M.strstart-M.match_start,M.match_length-3),M.lookahead-=M.match_length,M.match_length<=M.max_lazy_match&&M.lookahead>=3){M.match_length--;do{M.strstart++,M.ins_h=q(M,M.ins_h,M.window[M.strstart+3-1]),P=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart}while(0!==--M.match_length);M.strstart++}else M.strstart+=M.match_length,M.match_length=0,M.ins_h=M.window[M.strstart],M.ins_h=q(M,M.ins_h,M.window[M.strstart+1]);else x=v(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++;if(x&&(b(M,!1),0===M.strm.avail_out))return 1}return M.insert=M.strstart<2?M.strstart:2,Z===B?(b(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(b(M,!1),0===M.strm.avail_out)?1:2},T=(M,Z)=>{let P,x,c;for(;;){if(M.lookahead<R){if(z(M),M.lookahead<R&&Z===O)return 1;if(0===M.lookahead)break}if(P=0,M.lookahead>=3&&(M.ins_h=q(M,M.ins_h,M.window[M.strstart+3-1]),P=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),M.prev_length=M.match_length,M.prev_match=M.match_start,M.match_length=2,0!==P&&M.prev_length<M.max_lazy_match&&M.strstart-P<=M.w_size-R&&(M.match_length=Y(M,P),M.match_length<=5&&(M.strategy===F||3===M.match_length&&M.strstart-M.match_start>4096)&&(M.match_length=2)),M.prev_length>=3&&M.match_length<=M.prev_length){c=M.strstart+M.lookahead-3,x=v(M,M.strstart-1-M.prev_match,M.prev_length-3),M.lookahead-=M.prev_length-1,M.prev_length-=2;do{++M.strstart<=c&&(M.ins_h=q(M,M.ins_h,M.window[M.strstart+3-1]),P=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart)}while(0!==--M.prev_length);if(M.match_available=0,M.match_length=2,M.strstart++,x&&(b(M,!1),0===M.strm.avail_out))return 1}else if(M.match_available){if(x=v(M,0,M.window[M.strstart-1]),x&&b(M,!1),M.strstart++,M.lookahead--,0===M.strm.avail_out)return 1}else M.match_available=1,M.strstart++,M.lookahead--}return M.match_available&&(x=v(M,0,M.window[M.strstart-1]),M.match_available=0),M.insert=M.strstart<2?M.strstart:2,Z===B?(b(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(b(M,!1),0===M.strm.avail_out)?1:2};function p(M,Z,P,x,c){this.good_length=M,this.max_lazy=Z,this.nice_length=P,this.max_chain=x,this.func=c}const S=[new p(0,0,0,0,((M,Z)=>{let P=65535;for(P>M.pending_buf_size-5&&(P=M.pending_buf_size-5);;){if(M.lookahead<=1){if(z(M),0===M.lookahead&&Z===O)return 1;if(0===M.lookahead)break}M.strstart+=M.lookahead,M.lookahead=0;const x=M.block_start+P;if((0===M.strstart||M.strstart>=x)&&(M.lookahead=M.strstart-x,M.strstart=x,b(M,!1),0===M.strm.avail_out))return 1;if(M.strstart-M.block_start>=M.w_size-R&&(b(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,Z===B?(b(M,!0),0===M.strm.avail_out?3:4):(M.strstart>M.block_start&&(b(M,!1),M.strm.avail_out),1)})),new p(4,4,8,4,i),new p(4,5,16,8,i),new p(4,6,32,32,i),new p(4,4,16,16,T),new p(8,16,32,32,T),new p(8,16,128,128,T),new p(8,32,128,256,T),new p(32,128,258,1024,T),new p(32,258,258,4096,T)];function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=s,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),r(this.dyn_ltree),r(this.dyn_dtree),r(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),r(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),r(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const V=M=>{if(!M||!M.state)return o(M,u);M.total_in=M.total_out=0,M.data_type=I;const Z=M.state;return Z.pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?42:k,M.adler=2===Z.wrap?0:1,Z.last_flush=O,x(Z),n},g=M=>{const Z=V(M);var P;return Z===n&&((P=M.state).window_size=2*P.w_size,r(P.head),P.max_lazy_match=S[P.level].max_lazy,P.good_match=S[P.level].good_length,P.nice_match=S[P.level].nice_length,P.max_chain_length=S[P.level].max_chain,P.strstart=0,P.block_start=0,P.lookahead=0,P.insert=0,P.match_length=P.prev_length=2,P.match_available=0,P.ins_h=0),Z},MM=(M,Z,P,x,c,w)=>{if(!M)return u;let v=1;if(Z===t&&(Z=6),x<0?(v=0,x=-x):x>15&&(v=2,x-=16),c<1||c>9||P!==s||x<8||x>15||Z<0||Z>9||w<0||w>h)return o(M,u);8===x&&(x=9);const G=new X;return M.state=G,G.strm=M,G.wrap=v,G.gzhead=null,G.w_bits=x,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=c+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+3-1)/3),G.window=new Uint8Array(2*G.w_size),G.head=new Uint16Array(G.hash_size),G.prev=new Uint16Array(G.w_size),G.lit_bufsize=1<<c+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new Uint8Array(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=Z,G.strategy=w,G.method=P,g(M)};M.exports.deflateInit=(M,Z)=>MM(M,Z,s,15,8,Q),M.exports.deflateInit2=MM,M.exports.deflateReset=g,M.exports.deflateResetKeep=V,M.exports.deflateSetHeader=(M,Z)=>M&&M.state?2!==M.state.wrap?u:(M.state.gzhead=Z,n):u,M.exports.deflate=(M,Z)=>{let P,x;if(!M||!M.state||Z>U||Z<0)return M?o(M,u):u;const w=M.state;if(!M.output||!M.input&&0!==M.avail_in||w.status===A&&Z!==B)return o(M,0===M.avail_out?J:u);w.strm=M;const mM=w.last_flush;if(w.last_flush=Z,42===w.status)if(2===w.wrap)M.adler=0,a(w,31),a(w,139),a(w,8),w.gzhead?(a(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),a(w,255&w.gzhead.time),a(w,w.gzhead.time>>8&255),a(w,w.gzhead.time>>16&255),a(w,w.gzhead.time>>24&255),a(w,9===w.level?2:w.strategy>=D||w.level<2?4:0),a(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(a(w,255&w.gzhead.extra.length),a(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(M.adler=K(M.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(a(w,0),a(w,0),a(w,0),a(w,0),a(w,0),a(w,9===w.level?2:w.strategy>=D||w.level<2?4:0),a(w,3),w.status=k);else{let Z=s+(w.w_bits-8<<4)<<8,P=-1;P=w.strategy>=D||w.level<2?0:w.level<6?1:6===w.level?2:3,Z|=P<<6,0!==w.strstart&&(Z|=32),Z+=31-Z%31,w.status=k,y(w,Z),0!==w.strstart&&(y(w,M.adler>>>16),y(w,65535&M.adler)),M.adler=1}if(69===w.status)if(w.gzhead.extra){for(P=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>P&&(M.adler=K(M.adler,w.pending_buf,w.pending-P,P)),e(M),P=w.pending,w.pending!==w.pending_buf_size));)a(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>P&&(M.adler=K(M.adler,w.pending_buf,w.pending-P,P)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(73===w.status)if(w.gzhead.name){P=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>P&&(M.adler=K(M.adler,w.pending_buf,w.pending-P,P)),e(M),P=w.pending,w.pending===w.pending_buf_size)){x=1;break}x=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,a(w,x)}while(0!==x);w.gzhead.hcrc&&w.pending>P&&(M.adler=K(M.adler,w.pending_buf,w.pending-P,P)),0===x&&(w.gzindex=0,w.status=91)}else w.status=91;if(91===w.status)if(w.gzhead.comment){P=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>P&&(M.adler=K(M.adler,w.pending_buf,w.pending-P,P)),e(M),P=w.pending,w.pending===w.pending_buf_size)){x=1;break}x=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,a(w,x)}while(0!==x);w.gzhead.hcrc&&w.pending>P&&(M.adler=K(M.adler,w.pending_buf,w.pending-P,P)),0===x&&(w.status=W)}else w.status=W;if(w.status===W&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&e(M),w.pending+2<=w.pending_buf_size&&(a(w,255&M.adler),a(w,M.adler>>8&255),M.adler=0,w.status=k)):w.status=k),0!==w.pending){if(e(M),0===M.avail_out)return w.last_flush=-1,n}else if(0===M.avail_in&&E(Z)<=E(mM)&&Z!==B)return o(M,J);if(w.status===A&&0!==M.avail_in)return o(M,J);if(0!==M.avail_in||0!==w.lookahead||Z!==O&&w.status!==A){let P=w.strategy===D?((M,Z)=>{let P;for(;;){if(0===M.lookahead&&(z(M),0===M.lookahead)){if(Z===O)return 1;break}if(M.match_length=0,P=v(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,P&&(b(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,Z===B?(b(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(b(M,!1),0===M.strm.avail_out)?1:2})(w,Z):w.strategy===l?((M,Z)=>{let P,x,c,w;const G=M.window;for(;;){if(M.lookahead<=C){if(z(M),M.lookahead<=C&&Z===O)return 1;if(0===M.lookahead)break}if(M.match_length=0,M.lookahead>=3&&M.strstart>0&&(c=M.strstart-1,x=G[c],x===G[++c]&&x===G[++c]&&x===G[++c])){w=M.strstart+C;do{}while(x===G[++c]&&x===G[++c]&&x===G[++c]&&x===G[++c]&&x===G[++c]&&x===G[++c]&&x===G[++c]&&x===G[++c]&&c<w);M.match_length=C-(w-c),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=3?(P=v(M,1,M.match_length-3),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(P=v(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),P&&(b(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,Z===B?(b(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(b(M,!1),0===M.strm.avail_out)?1:2})(w,Z):S[w.level].func(w,Z);if(3!==P&&4!==P||(w.status=A),1===P||3===P)return 0===M.avail_out&&(w.last_flush=-1),n;if(2===P&&(Z===H?G(w):Z!==U&&(c(w,0,0,!1),Z===j&&(r(w.head),0===w.lookahead&&(w.strstart=0,w.block_start=0,w.insert=0))),e(M),0===M.avail_out))return w.last_flush=-1,n}return Z!==B?n:w.wrap<=0?L:(2===w.wrap?(a(w,255&M.adler),a(w,M.adler>>8&255),a(w,M.adler>>16&255),a(w,M.adler>>24&255),a(w,255&M.total_in),a(w,M.total_in>>8&255),a(w,M.total_in>>16&255),a(w,M.total_in>>24&255)):(y(w,M.adler>>>16),y(w,65535&M.adler)),e(M),w.wrap>0&&(w.wrap=-w.wrap),0!==w.pending?n:L)},M.exports.deflateEnd=M=>{if(!M||!M.state)return u;const Z=M.state.status;return 42!==Z&&69!==Z&&73!==Z&&91!==Z&&Z!==W&&Z!==k&&Z!==A?o(M,u):(M.state=null,Z===k?o(M,N):n)},M.exports.deflateSetDictionary=(M,Z)=>{let P=Z.length;if(!M||!M.state)return u;const x=M.state,c=x.wrap;if(2===c||1===c&&42!==x.status||x.lookahead)return u;if(1===c&&(M.adler=mM(M.adler,Z,P,0)),x.wrap=0,P>=x.w_size){0===c&&(r(x.head),x.strstart=0,x.block_start=0,x.insert=0);let M=new Uint8Array(x.w_size);M.set(Z.subarray(P-x.w_size,P),0),Z=M,P=x.w_size}const w=M.avail_in,v=M.next_in,G=M.input;for(M.avail_in=P,M.next_in=0,M.input=Z,z(x);x.lookahead>=3;){let M=x.strstart,Z=x.lookahead-2;do{x.ins_h=q(x,x.ins_h,x.window[M+3-1]),x.prev[M&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=M,M++}while(--Z);x.strstart=M,x.lookahead=2,z(x)}return x.strstart+=x.lookahead,x.block_start=x.strstart,x.insert=x.lookahead,x.lookahead=0,x.match_length=x.prev_length=2,x.match_available=0,M.next_in=v,M.input=G,M.avail_in=w,x.wrap=c,n},M.exports.deflateInfo="pako deflate (from Nodeca project)"},13572:M=>{"use strict";M.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13559:M=>{"use strict";M.exports=function(M,Z){let P,x,c,w,v,G,mM,K,d,O,H,j,B,U,n,L,u,N,J,t,F,D,l,h;const Q=M.state;P=M.next_in,l=M.input,x=P+(M.avail_in-5),c=M.next_out,h=M.output,w=c-(Z-M.avail_out),v=c+(M.avail_out-257),G=Q.dmax,mM=Q.wsize,K=Q.whave,d=Q.wnext,O=Q.window,H=Q.hold,j=Q.bits,B=Q.lencode,U=Q.distcode,n=(1<<Q.lenbits)-1,L=(1<<Q.distbits)-1;M:do{j<15&&(H+=l[P++]<<j,j+=8,H+=l[P++]<<j,j+=8),u=B[H&n];Z:for(;;){if(N=u>>>24,H>>>=N,j-=N,N=u>>>16&255,0===N)h[c++]=65535&u;else{if(!(16&N)){if(0===(64&N)){u=B[(65535&u)+(H&(1<<N)-1)];continue Z}if(32&N){Q.mode=12;break M}M.KZ="invalid literal/length code",Q.mode=30;break M}J=65535&u,N&=15,N&&(j<N&&(H+=l[P++]<<j,j+=8),J+=H&(1<<N)-1,H>>>=N,j-=N),j<15&&(H+=l[P++]<<j,j+=8,H+=l[P++]<<j,j+=8),u=U[H&L];P:for(;;){if(N=u>>>24,H>>>=N,j-=N,N=u>>>16&255,!(16&N)){if(0===(64&N)){u=U[(65535&u)+(H&(1<<N)-1)];continue P}M.KZ="invalid distance code",Q.mode=30;break M}if(t=65535&u,N&=15,j<N&&(H+=l[P++]<<j,j+=8,j<N&&(H+=l[P++]<<j,j+=8)),t+=H&(1<<N)-1,t>G){M.KZ="invalid distance too far back",Q.mode=30;break M}if(H>>>=N,j-=N,N=c-w,t>N){if(N=t-N,N>K&&Q.sane){M.KZ="invalid distance too far back",Q.mode=30;break M}if(F=0,D=O,0===d){if(F+=mM-N,N<J){J-=N;do{h[c++]=O[F++]}while(--N);F=c-t,D=h}}else if(d<N){if(F+=mM+d-N,N-=d,N<J){J-=N;do{h[c++]=O[F++]}while(--N);if(F=0,d<J){N=d,J-=N;do{h[c++]=O[F++]}while(--N);F=c-t,D=h}}}else if(F+=d-N,N<J){J-=N;do{h[c++]=O[F++]}while(--N);F=c-t,D=h}for(;J>2;)h[c++]=D[F++],h[c++]=D[F++],h[c++]=D[F++],J-=3;J&&(h[c++]=D[F++],J>1&&(h[c++]=D[F++]))}else{F=c-t;do{h[c++]=h[F++],h[c++]=h[F++],h[c++]=h[F++],J-=3}while(J>2);J&&(h[c++]=h[F++],J>1&&(h[c++]=h[F++]))}break}}break}}while(P<x&&c<v);J=j>>3,P-=J,j-=J<<3,H&=(1<<j)-1,M.next_in=P,M.next_out=c,M.avail_in=P<x?x-P+5:5-(P-x),M.avail_out=c<v?v-c+257:257-(c-v),Q.hold=H,Q.bits=j}},13550:(M,Z,P)=>{"use strict";const x=P(13511),c=P(13515),w=P(13559),v=P(13566),{Z_FINISH:G,Z_BLOCK:mM,Z_TREES:K,Z_OK:d,Z_STREAM_END:O,Z_NEED_DICT:H,Z_STREAM_ERROR:j,Z_DATA_ERROR:B,Z_MEM_ERROR:U,Z_BUF_ERROR:n,Z_DEFLATED:L}=P(13524),u=12,N=30,J=M=>(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24);function t(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const F=M=>{if(!M||!M.state)return j;const Z=M.state;return M.total_in=M.total_out=Z.total=0,M.KZ="",Z.wrap&&(M.adler=1&Z.wrap),Z.mode=1,Z.last=0,Z.havedict=0,Z.dmax=32768,Z.head=null,Z.hold=0,Z.bits=0,Z.lencode=Z.lendyn=new Int32Array(852),Z.distcode=Z.distdyn=new Int32Array(592),Z.sane=1,Z.back=-1,d},D=M=>{if(!M||!M.state)return j;const Z=M.state;return Z.wsize=0,Z.whave=0,Z.wnext=0,F(M)},l=(M,Z)=>{let P;if(!M||!M.state)return j;const x=M.state;return Z<0?(P=0,Z=-Z):(P=1+(Z>>4),Z<48&&(Z&=15)),Z&&(Z<8||Z>15)?j:(null!==x.window&&x.wbits!==Z&&(x.window=null),x.wrap=P,x.wbits=Z,D(M))},h=(M,Z)=>{if(!M)return j;const P=new t;M.state=P,P.window=null;const x=l(M,Z);return x!==d&&(M.state=null),x};let Q,I,s=!0;const C=M=>{if(s){Q=new Int32Array(512),I=new Int32Array(32);let Z=0;for(;Z<144;)M.lens[Z++]=8;for(;Z<256;)M.lens[Z++]=9;for(;Z<280;)M.lens[Z++]=7;for(;Z<288;)M.lens[Z++]=8;for(v(1,M.lens,0,288,Q,0,M.work,{bits:9}),Z=0;Z<32;)M.lens[Z++]=5;v(2,M.lens,0,32,I,0,M.work,{bits:5}),s=!1}M.lencode=Q,M.lenbits=9,M.distcode=I,M.distbits=5},R=(M,Z,P,x)=>{let c;const w=M.state;return null===w.window&&(w.wsize=1<<w.wbits,w.wnext=0,w.whave=0,w.window=new Uint8Array(w.wsize)),x>=w.wsize?(w.window.set(Z.subarray(P-w.wsize,P),0),w.wnext=0,w.whave=w.wsize):(c=w.wsize-w.wnext,c>x&&(c=x),w.window.set(Z.subarray(P-x,P-x+c),w.wnext),(x-=c)?(w.window.set(Z.subarray(P-x,P),0),w.wnext=x,w.whave=w.wsize):(w.wnext+=c,w.wnext===w.wsize&&(w.wnext=0),w.whave<w.wsize&&(w.whave+=c))),0};M.exports.inflateReset=D,M.exports.inflateReset2=l,M.exports.inflateResetKeep=F,M.exports.inflateInit=M=>h(M,15),M.exports.inflateInit2=h,M.exports.inflate=(M,Z)=>{let P,t,F,D,l,h,Q,I,s,W,k,A,o,E,r,q,e,b,a,y,f,Y,z=0;const i=new Uint8Array(4);let T,p;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!M||!M.state||!M.output||!M.input&&0!==M.avail_in)return j;P=M.state,P.mode===u&&(P.mode=13),l=M.next_out,F=M.output,Q=M.avail_out,D=M.next_in,t=M.input,h=M.avail_in,I=P.hold,s=P.bits,W=h,k=Q,Y=d;M:for(;;)switch(P.mode){case 1:if(0===P.wrap){P.mode=13;break}for(;s<16;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(2&P.wrap&&35615===I){P.check=0,i[0]=255&I,i[1]=I>>>8&255,P.check=c(P.check,i,2,0),I=0,s=0,P.mode=2;break}if(P.flags=0,P.head&&(P.head.done=!1),!(1&P.wrap)||(((255&I)<<8)+(I>>8))%31){M.KZ="incorrect header check",P.mode=N;break}if((15&I)!==L){M.KZ="unknown compression method",P.mode=N;break}if(I>>>=4,s-=4,f=8+(15&I),0===P.wbits)P.wbits=f;else if(f>P.wbits){M.KZ="invalid window size",P.mode=N;break}P.dmax=1<<P.wbits,M.adler=P.check=1,P.mode=512&I?10:u,I=0,s=0;break;case 2:for(;s<16;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(P.flags=I,(255&P.flags)!==L){M.KZ="unknown compression method",P.mode=N;break}if(57344&P.flags){M.KZ="unknown header flags set",P.mode=N;break}P.head&&(P.head.text=I>>8&1),512&P.flags&&(i[0]=255&I,i[1]=I>>>8&255,P.check=c(P.check,i,2,0)),I=0,s=0,P.mode=3;case 3:for(;s<32;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}P.head&&(P.head.time=I),512&P.flags&&(i[0]=255&I,i[1]=I>>>8&255,i[2]=I>>>16&255,i[3]=I>>>24&255,P.check=c(P.check,i,4,0)),I=0,s=0,P.mode=4;case 4:for(;s<16;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}P.head&&(P.head.xflags=255&I,P.head.os=I>>8),512&P.flags&&(i[0]=255&I,i[1]=I>>>8&255,P.check=c(P.check,i,2,0)),I=0,s=0,P.mode=5;case 5:if(1024&P.flags){for(;s<16;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}P.length=I,P.head&&(P.head.extra_len=I),512&P.flags&&(i[0]=255&I,i[1]=I>>>8&255,P.check=c(P.check,i,2,0)),I=0,s=0}else P.head&&(P.head.extra=null);P.mode=6;case 6:if(1024&P.flags&&(A=P.length,A>h&&(A=h),A&&(P.head&&(f=P.head.extra_len-P.length,P.head.extra||(P.head.extra=new Uint8Array(P.head.extra_len)),P.head.extra.set(t.subarray(D,D+A),f)),512&P.flags&&(P.check=c(P.check,t,A,D)),h-=A,D+=A,P.length-=A),P.length))break M;P.length=0,P.mode=7;case 7:if(2048&P.flags){if(0===h)break M;A=0;do{f=t[D+A++],P.head&&f&&P.length<65536&&(P.head.name+=String.fromCharCode(f))}while(f&&A<h);if(512&P.flags&&(P.check=c(P.check,t,A,D)),h-=A,D+=A,f)break M}else P.head&&(P.head.name=null);P.length=0,P.mode=8;case 8:if(4096&P.flags){if(0===h)break M;A=0;do{f=t[D+A++],P.head&&f&&P.length<65536&&(P.head.comment+=String.fromCharCode(f))}while(f&&A<h);if(512&P.flags&&(P.check=c(P.check,t,A,D)),h-=A,D+=A,f)break M}else P.head&&(P.head.comment=null);P.mode=9;case 9:if(512&P.flags){for(;s<16;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(I!==(65535&P.check)){M.KZ="header crc mismatch",P.mode=N;break}I=0,s=0}P.head&&(P.head.hcrc=P.flags>>9&1,P.head.done=!0),M.adler=P.check=0,P.mode=u;break;case 10:for(;s<32;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}M.adler=P.check=J(I),I=0,s=0,P.mode=11;case 11:if(0===P.havedict)return M.next_out=l,M.avail_out=Q,M.next_in=D,M.avail_in=h,P.hold=I,P.bits=s,H;M.adler=P.check=1,P.mode=u;case u:if(Z===mM||Z===K)break M;case 13:if(P.last){I>>>=7&s,s-=7&s,P.mode=27;break}for(;s<3;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}switch(P.last=1&I,I>>>=1,s-=1,3&I){case 0:P.mode=14;break;case 1:if(C(P),P.mode=20,Z===K){I>>>=2,s-=2;break M}break;case 2:P.mode=17;break;case 3:M.KZ="invalid block type",P.mode=N}I>>>=2,s-=2;break;case 14:for(I>>>=7&s,s-=7&s;s<32;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if((65535&I)!==(I>>>16^65535)){M.KZ="invalid stored block lengths",P.mode=N;break}if(P.length=65535&I,I=0,s=0,P.mode=15,Z===K)break M;case 15:P.mode=16;case 16:if(A=P.length,A){if(A>h&&(A=h),A>Q&&(A=Q),0===A)break M;F.set(t.subarray(D,D+A),l),h-=A,D+=A,Q-=A,l+=A,P.length-=A;break}P.mode=u;break;case 17:for(;s<14;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(P.nlen=257+(31&I),I>>>=5,s-=5,P.ndist=1+(31&I),I>>>=5,s-=5,P.ncode=4+(15&I),I>>>=4,s-=4,P.nlen>286||P.ndist>30){M.KZ="too many length or distance symbols",P.mode=N;break}P.have=0,P.mode=18;case 18:for(;P.have<P.ncode;){for(;s<3;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}P.lens[S[P.have++]]=7&I,I>>>=3,s-=3}for(;P.have<19;)P.lens[S[P.have++]]=0;if(P.lencode=P.lendyn,P.lenbits=7,T={bits:P.lenbits},Y=v(0,P.lens,0,19,P.lencode,0,P.work,T),P.lenbits=T.bits,Y){M.KZ="invalid code lengths set",P.mode=N;break}P.have=0,P.mode=19;case 19:for(;P.have<P.nlen+P.ndist;){for(;z=P.lencode[I&(1<<P.lenbits)-1],r=z>>>24,q=z>>>16&255,e=65535&z,!(r<=s);){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(e<16)I>>>=r,s-=r,P.lens[P.have++]=e;else{if(16===e){for(p=r+2;s<p;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(I>>>=r,s-=r,0===P.have){M.KZ="invalid bit length repeat",P.mode=N;break}f=P.lens[P.have-1],A=3+(3&I),I>>>=2,s-=2}else if(17===e){for(p=r+3;s<p;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}I>>>=r,s-=r,f=0,A=3+(7&I),I>>>=3,s-=3}else{for(p=r+7;s<p;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}I>>>=r,s-=r,f=0,A=11+(127&I),I>>>=7,s-=7}if(P.have+A>P.nlen+P.ndist){M.KZ="invalid bit length repeat",P.mode=N;break}for(;A--;)P.lens[P.have++]=f}}if(P.mode===N)break;if(0===P.lens[256]){M.KZ="invalid code -- missing end-of-block",P.mode=N;break}if(P.lenbits=9,T={bits:P.lenbits},Y=v(1,P.lens,0,P.nlen,P.lencode,0,P.work,T),P.lenbits=T.bits,Y){M.KZ="invalid literal/lengths set",P.mode=N;break}if(P.distbits=6,P.distcode=P.distdyn,T={bits:P.distbits},Y=v(2,P.lens,P.nlen,P.ndist,P.distcode,0,P.work,T),P.distbits=T.bits,Y){M.KZ="invalid distances set",P.mode=N;break}if(P.mode=20,Z===K)break M;case 20:P.mode=21;case 21:if(h>=6&&Q>=258){M.next_out=l,M.avail_out=Q,M.next_in=D,M.avail_in=h,P.hold=I,P.bits=s,w(M,k),l=M.next_out,F=M.output,Q=M.avail_out,D=M.next_in,t=M.input,h=M.avail_in,I=P.hold,s=P.bits,P.mode===u&&(P.back=-1);break}for(P.back=0;z=P.lencode[I&(1<<P.lenbits)-1],r=z>>>24,q=z>>>16&255,e=65535&z,!(r<=s);){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(q&&0===(240&q)){for(b=r,a=q,y=e;z=P.lencode[y+((I&(1<<b+a)-1)>>b)],r=z>>>24,q=z>>>16&255,e=65535&z,!(b+r<=s);){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}I>>>=b,s-=b,P.back+=b}if(I>>>=r,s-=r,P.back+=r,P.length=e,0===q){P.mode=26;break}if(32&q){P.back=-1,P.mode=u;break}if(64&q){M.KZ="invalid literal/length code",P.mode=N;break}P.extra=15&q,P.mode=22;case 22:if(P.extra){for(p=P.extra;s<p;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}P.length+=I&(1<<P.extra)-1,I>>>=P.extra,s-=P.extra,P.back+=P.extra}P.was=P.length,P.mode=23;case 23:for(;z=P.distcode[I&(1<<P.distbits)-1],r=z>>>24,q=z>>>16&255,e=65535&z,!(r<=s);){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(0===(240&q)){for(b=r,a=q,y=e;z=P.distcode[y+((I&(1<<b+a)-1)>>b)],r=z>>>24,q=z>>>16&255,e=65535&z,!(b+r<=s);){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}I>>>=b,s-=b,P.back+=b}if(I>>>=r,s-=r,P.back+=r,64&q){M.KZ="invalid distance code",P.mode=N;break}P.offset=e,P.extra=15&q,P.mode=24;case 24:if(P.extra){for(p=P.extra;s<p;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}P.offset+=I&(1<<P.extra)-1,I>>>=P.extra,s-=P.extra,P.back+=P.extra}if(P.offset>P.dmax){M.KZ="invalid distance too far back",P.mode=N;break}P.mode=25;case 25:if(0===Q)break M;if(A=k-Q,P.offset>A){if(A=P.offset-A,A>P.whave&&P.sane){M.KZ="invalid distance too far back",P.mode=N;break}A>P.wnext?(A-=P.wnext,o=P.wsize-A):o=P.wnext-A,A>P.length&&(A=P.length),E=P.window}else E=F,o=l-P.offset,A=P.length;A>Q&&(A=Q),Q-=A,P.length-=A;do{F[l++]=E[o++]}while(--A);0===P.length&&(P.mode=21);break;case 26:if(0===Q)break M;F[l++]=P.length,Q--,P.mode=21;break;case 27:if(P.wrap){for(;s<32;){if(0===h)break M;h--,I|=t[D++]<<s,s+=8}if(k-=Q,M.total_out+=k,P.total+=k,k&&(M.adler=P.check=P.flags?c(P.check,F,k,l-k):x(P.check,F,k,l-k)),k=Q,(P.flags?I:J(I))!==P.check){M.KZ="incorrect data check",P.mode=N;break}I=0,s=0}P.mode=28;case 28:if(P.wrap&&P.flags){for(;s<32;){if(0===h)break M;h--,I+=t[D++]<<s,s+=8}if(I!==(4294967295&P.total)){M.KZ="incorrect length check",P.mode=N;break}I=0,s=0}P.mode=29;case 29:Y=O;break M;case N:Y=B;break M;case 31:return U;default:return j}return M.next_out=l,M.avail_out=Q,M.next_in=D,M.avail_in=h,P.hold=I,P.bits=s,(P.wsize||k!==M.avail_out&&P.mode<N&&(P.mode<27||Z!==G))&&R(M,M.output,M.next_out,k-M.avail_out)?(P.mode=31,U):(W-=M.avail_in,k-=M.avail_out,M.total_in+=W,M.total_out+=k,P.total+=k,P.wrap&&k&&(M.adler=P.check=P.flags?c(P.check,F,k,M.next_out-k):x(P.check,F,k,M.next_out-k)),M.data_type=P.bits+(P.last?64:0)+(P.mode===u?128:0)+(20===P.mode||15===P.mode?256:0),(0===W&&0===k||Z===G)&&Y===d&&(Y=n),Y)},M.exports.inflateEnd=M=>{if(!M||!M.state)return j;let Z=M.state;return Z.window&&(Z.window=null),M.state=null,d},M.exports.inflateGetHeader=(M,Z)=>{if(!M||!M.state)return j;const P=M.state;return 0===(2&P.wrap)?j:(P.head=Z,Z.done=!1,d)},M.exports.inflateSetDictionary=(M,Z)=>{const P=Z.length;let c,w,v;return M&&M.state?(c=M.state,0!==c.wrap&&11!==c.mode?j:11===c.mode&&(w=1,w=x(w,Z,P,0),w!==c.check)?B:(v=R(M,Z,P,P),v?(c.mode=31,U):(c.havedict=1,d))):j},M.exports.inflateInfo="pako inflate (from Nodeca project)"},13566:M=>{"use strict";const Z=15,P=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),x=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),c=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),w=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);M.exports=(M,v,G,mM,K,d,O,H)=>{const j=H.bits;let B,U,n,L,u,N,J=0,t=0,F=0,D=0,l=0,h=0,Q=0,I=0,s=0,C=0,R=null,W=0;const k=new Uint16Array(16),A=new Uint16Array(16);let o,E,r,q=null,e=0;for(J=0;J<=Z;J++)k[J]=0;for(t=0;t<mM;t++)k[v[G+t]]++;for(l=j,D=Z;D>=1&&0===k[D];D--);if(l>D&&(l=D),0===D)return K[d++]=20971520,K[d++]=20971520,H.bits=1,0;for(F=1;F<D&&0===k[F];F++);for(l<F&&(l=F),I=1,J=1;J<=Z;J++)if(I<<=1,I-=k[J],I<0)return-1;if(I>0&&(0===M||1!==D))return-1;for(A[1]=0,J=1;J<Z;J++)A[J+1]=A[J]+k[J];for(t=0;t<mM;t++)0!==v[G+t]&&(O[A[v[G+t]]++]=t);if(0===M?(R=q=O,N=19):1===M?(R=P,W-=257,q=x,e-=257,N=256):(R=c,q=w,N=-1),C=0,t=0,J=F,u=d,h=l,Q=0,n=-1,s=1<<l,L=s-1,1===M&&s>852||2===M&&s>592)return 1;for(;;){o=J-Q,O[t]<N?(E=0,r=O[t]):O[t]>N?(E=q[e+O[t]],r=R[W+O[t]]):(E=96,r=0),B=1<<J-Q,U=1<<h,F=U;do{U-=B,K[u+(C>>Q)+U]=o<<24|E<<16|r}while(0!==U);for(B=1<<J-1;C&B;)B>>=1;if(0!==B?(C&=B-1,C+=B):C=0,t++,0===--k[J]){if(J===D)break;J=v[G+O[t]]}if(J>l&&(C&L)!==n){for(0===Q&&(Q=l),u+=F,h=J-Q,I=1<<h;h+Q<D&&(I-=k[h+Q],!(I<=0));)h++,I<<=1;if(s+=1<<h,1===M&&s>852||2===M&&s>592)return 1;n=C&L,K[n]=l<<24|h<<16|u-d}}return 0!==C&&(K[u+C]=J-Q<<24|64<<16),H.bits=l,0}},13519:M=>{"use strict";M.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13509:M=>{"use strict";function Z(M){let Z=M.length;for(;--Z>=0;)M[Z]=0}const P=256,x=286,c=30,w=15,v=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),G=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),mM=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),K=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);Z(d);const O=new Array(60);Z(O);const H=new Array(512);Z(H);const j=new Array(256);Z(j);const B=new Array(29);Z(B);const U=new Array(c);function n(M,Z,P,x,c){this.static_tree=M,this.extra_bits=Z,this.extra_base=P,this.elems=x,this.max_length=c,this.has_stree=M&&M.length}let L,u,N;function J(M,Z){this.dyn_tree=M,this.max_code=0,this.stat_desc=Z}Z(U);const t=M=>M<256?H[M]:H[256+(M>>>7)],F=(M,Z)=>{M.pending_buf[M.pending++]=255&Z,M.pending_buf[M.pending++]=Z>>>8&255},D=(M,Z,P)=>{M.bi_valid>16-P?(M.bi_buf|=Z<<M.bi_valid&65535,F(M,M.bi_buf),M.bi_buf=Z>>16-M.bi_valid,M.bi_valid+=P-16):(M.bi_buf|=Z<<M.bi_valid&65535,M.bi_valid+=P)},l=(M,Z,P)=>{D(M,P[2*Z],P[2*Z+1])},h=(M,Z)=>{let P=0;do{P|=1&M,M>>>=1,P<<=1}while(--Z>0);return P>>>1},Q=(M,Z,P)=>{const x=new Array(16);let c,v,G=0;for(c=1;c<=w;c++)x[c]=G=G+P[c-1]<<1;for(v=0;v<=Z;v++){let Z=M[2*v+1];0!==Z&&(M[2*v]=h(x[Z]++,Z))}},I=M=>{let Z;for(Z=0;Z<x;Z++)M.dyn_ltree[2*Z]=0;for(Z=0;Z<c;Z++)M.dyn_dtree[2*Z]=0;for(Z=0;Z<19;Z++)M.bl_tree[2*Z]=0;M.dyn_ltree[512]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0},s=M=>{M.bi_valid>8?F(M,M.bi_buf):M.bi_valid>0&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0},C=(M,Z,P,x)=>{const c=2*Z,w=2*P;return M[c]<M[w]||M[c]===M[w]&&x[Z]<=x[P]},R=(M,Z,P)=>{const x=M.heap[P];let c=P<<1;for(;c<=M.heap_len&&(c<M.heap_len&&C(Z,M.heap[c+1],M.heap[c],M.depth)&&c++,!C(Z,x,M.heap[c],M.depth));)M.heap[P]=M.heap[c],P=c,c<<=1;M.heap[P]=x},W=(M,Z,x)=>{let c,w,mM,K,d=0;if(0!==M.last_lit)do{c=M.pending_buf[M.d_buf+2*d]<<8|M.pending_buf[M.d_buf+2*d+1],w=M.pending_buf[M.l_buf+d],d++,0===c?l(M,w,Z):(mM=j[w],l(M,mM+P+1,Z),K=v[mM],0!==K&&(w-=B[mM],D(M,w,K)),c--,mM=t(c),l(M,mM,x),K=G[mM],0!==K&&(c-=U[mM],D(M,c,K)))}while(d<M.last_lit);l(M,256,Z)},k=(M,Z)=>{const P=Z.dyn_tree,x=Z.stat_desc.static_tree,c=Z.stat_desc.has_stree,v=Z.stat_desc.elems;let G,mM,K,d=-1;for(M.heap_len=0,M.heap_max=573,G=0;G<v;G++)0!==P[2*G]?(M.heap[++M.heap_len]=d=G,M.depth[G]=0):P[2*G+1]=0;for(;M.heap_len<2;)K=M.heap[++M.heap_len]=d<2?++d:0,P[2*K]=1,M.depth[K]=0,M.opt_len--,c&&(M.static_len-=x[2*K+1]);for(Z.max_code=d,G=M.heap_len>>1;G>=1;G--)R(M,P,G);K=v;do{G=M.heap[1],M.heap[1]=M.heap[M.heap_len--],R(M,P,1),mM=M.heap[1],M.heap[--M.heap_max]=G,M.heap[--M.heap_max]=mM,P[2*K]=P[2*G]+P[2*mM],M.depth[K]=(M.depth[G]>=M.depth[mM]?M.depth[G]:M.depth[mM])+1,P[2*G+1]=P[2*mM+1]=K,M.heap[1]=K++,R(M,P,1)}while(M.heap_len>=2);M.heap[--M.heap_max]=M.heap[1],((M,Z)=>{const P=Z.dyn_tree,x=Z.max_code,c=Z.stat_desc.static_tree,v=Z.stat_desc.has_stree,G=Z.stat_desc.extra_bits,mM=Z.stat_desc.extra_base,K=Z.stat_desc.max_length;let d,O,H,j,B,U,n=0;for(j=0;j<=w;j++)M.bl_count[j]=0;for(P[2*M.heap[M.heap_max]+1]=0,d=M.heap_max+1;d<573;d++)O=M.heap[d],j=P[2*P[2*O+1]+1]+1,j>K&&(j=K,n++),P[2*O+1]=j,O>x||(M.bl_count[j]++,B=0,O>=mM&&(B=G[O-mM]),U=P[2*O],M.opt_len+=U*(j+B),v&&(M.static_len+=U*(c[2*O+1]+B)));if(0!==n){do{for(j=K-1;0===M.bl_count[j];)j--;M.bl_count[j]--,M.bl_count[j+1]+=2,M.bl_count[K]--,n-=2}while(n>0);for(j=K;0!==j;j--)for(O=M.bl_count[j];0!==O;)H=M.heap[--d],H>x||(P[2*H+1]!==j&&(M.opt_len+=(j-P[2*H+1])*P[2*H],P[2*H+1]=j),O--)}})(M,Z),Q(P,d,M.bl_count)},A=(M,Z,P)=>{let x,c,w=-1,v=Z[1],G=0,mM=7,K=4;for(0===v&&(mM=138,K=3),Z[2*(P+1)+1]=65535,x=0;x<=P;x++)c=v,v=Z[2*(x+1)+1],++G<mM&&c===v||(G<K?M.bl_tree[2*c]+=G:0!==c?(c!==w&&M.bl_tree[2*c]++,M.bl_tree[32]++):G<=10?M.bl_tree[34]++:M.bl_tree[36]++,G=0,w=c,0===v?(mM=138,K=3):c===v?(mM=6,K=3):(mM=7,K=4))},o=(M,Z,P)=>{let x,c,w=-1,v=Z[1],G=0,mM=7,K=4;for(0===v&&(mM=138,K=3),x=0;x<=P;x++)if(c=v,v=Z[2*(x+1)+1],!(++G<mM&&c===v)){if(G<K)do{l(M,c,M.bl_tree)}while(0!==--G);else 0!==c?(c!==w&&(l(M,c,M.bl_tree),G--),l(M,16,M.bl_tree),D(M,G-3,2)):G<=10?(l(M,17,M.bl_tree),D(M,G-3,3)):(l(M,18,M.bl_tree),D(M,G-11,7));G=0,w=c,0===v?(mM=138,K=3):c===v?(mM=6,K=3):(mM=7,K=4)}};let E=!1;const r=(M,Z,P,x)=>{D(M,0+(x?1:0),3),((M,Z,P,x)=>{s(M),x&&(F(M,P),F(M,~P)),M.pending_buf.set(M.window.subarray(Z,Z+P),M.pending),M.pending+=P})(M,Z,P,!0)};M.exports._tr_init=M=>{E||((()=>{let M,Z,P,K,J;const t=new Array(16);for(P=0,K=0;K<28;K++)for(B[K]=P,M=0;M<1<<v[K];M++)j[P++]=K;for(j[P-1]=K,J=0,K=0;K<16;K++)for(U[K]=J,M=0;M<1<<G[K];M++)H[J++]=K;for(J>>=7;K<c;K++)for(U[K]=J<<7,M=0;M<1<<G[K]-7;M++)H[256+J++]=K;for(Z=0;Z<=w;Z++)t[Z]=0;for(M=0;M<=143;)d[2*M+1]=8,M++,t[8]++;for(;M<=255;)d[2*M+1]=9,M++,t[9]++;for(;M<=279;)d[2*M+1]=7,M++,t[7]++;for(;M<=287;)d[2*M+1]=8,M++,t[8]++;for(Q(d,287,t),M=0;M<c;M++)O[2*M+1]=5,O[2*M]=h(M,5);L=new n(d,v,257,x,w),u=new n(O,G,0,c,w),N=new n(new Array(0),mM,0,19,7)})(),E=!0),M.l_desc=new J(M.dyn_ltree,L),M.d_desc=new J(M.dyn_dtree,u),M.bl_desc=new J(M.bl_tree,N),M.bi_buf=0,M.bi_valid=0,I(M)},M.exports._tr_stored_block=r,M.exports._tr_flush_block=(M,Z,x,c)=>{let w,v,G=0;M.level>0?(2===M.strm.data_type&&(M.strm.data_type=(M=>{let Z,x=4093624447;for(Z=0;Z<=31;Z++,x>>>=1)if(1&x&&0!==M.dyn_ltree[2*Z])return 0;if(0!==M.dyn_ltree[18]||0!==M.dyn_ltree[20]||0!==M.dyn_ltree[26])return 1;for(Z=32;Z<P;Z++)if(0!==M.dyn_ltree[2*Z])return 1;return 0})(M)),k(M,M.l_desc),k(M,M.d_desc),G=(M=>{let Z;for(A(M,M.dyn_ltree,M.l_desc.max_code),A(M,M.dyn_dtree,M.d_desc.max_code),k(M,M.bl_desc),Z=18;Z>=3&&0===M.bl_tree[2*K[Z]+1];Z--);return M.opt_len+=3*(Z+1)+5+5+4,Z})(M),w=M.opt_len+3+7>>>3,v=M.static_len+3+7>>>3,v<=w&&(w=v)):w=v=x+5,x+4<=w&&-1!==Z?r(M,Z,x,c):4===M.strategy||v===w?(D(M,2+(c?1:0),3),W(M,d,O)):(D(M,4+(c?1:0),3),((M,Z,P,x)=>{let c;for(D(M,Z-257,5),D(M,P-1,5),D(M,x-4,4),c=0;c<x;c++)D(M,M.bl_tree[2*K[c]+1],3);o(M,M.dyn_ltree,Z-1),o(M,M.dyn_dtree,P-1)})(M,M.l_desc.max_code+1,M.d_desc.max_code+1,G+1),W(M,M.dyn_ltree,M.dyn_dtree)),I(M),c&&s(M)},M.exports._tr_tally=(M,Z,x)=>(M.pending_buf[M.d_buf+2*M.last_lit]=Z>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&Z,M.pending_buf[M.l_buf+M.last_lit]=255&x,M.last_lit++,0===Z?M.dyn_ltree[2*x]++:(M.matches++,Z--,M.dyn_ltree[2*(j[x]+P+1)]++,M.dyn_dtree[2*t(Z)]++),M.last_lit===M.lit_bufsize-1),M.exports._tr_align=M=>{D(M,2,3),l(M,256,d),(M=>{16===M.bi_valid?(F(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):M.bi_valid>=8&&(M.pending_buf[M.pending++]=255&M.bi_buf,M.bi_buf>>=8,M.bi_valid-=8)})(M)}},13540:M=>{"use strict";M.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.KZ="",this.state=null,this.data_type=2,this.adler=0}},13198:M=>{function Z(M,Z,P){for(var x=M.length,c=-1/0,w=1/0,v=0;v<x;v++){var G=(P[0][v]-M[v])/Z[v],mM=(P[1][v]-M[v])/Z[v];if(G>mM){var K=G;G=mM,mM=K}if(mM<c||G>w)return 1/0;G>c&&(c=G),mM<w&&(w=mM)}return c>w?1/0:c}M.exports=function(M,P,x,c){var w=Z(P,x,c);if(w===1/0)M=null;else{M=M||[];for(var v=0;v<P.length;v++)M[v]=P[v]+x[v]*w}return M},M.exports.distance=Z},14580:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>v});var x=P(31);const c=x.useLayoutEffect;const w=function(M){var Z=(0,x.useRef)(M);return c((function(){Z.current=M})),Z};var v=function(M){var Z=w(M);(0,x.vZ)((function(){var M=function(M){var P;if(null!=Z.current&&(P=Z.current(M)),M.defaultPrevented&&(M.returnValue=""),"string"===typeof P)return M.returnValue=P,P};return window.addEventListener("beforeunload",M),function(){window.removeEventListener("beforeunload",M)}}),[])}},14522:(M,Z,P)=>{"use strict";var x=P(14531),c=Array.prototype.concat,w=Array.prototype.slice,v=M.exports=function(M){for(var Z=[],P=0,v=M.length;P<v;P++){var G=M[P];x(G)?Z=c.call(Z,w.call(G)):Z.push(G)}return Z};v.wrap=function(M){return function(){return M(v(arguments))}}},14531:M=>{M.exports=function(M){return!(!M||"string"===typeof M)&&(M instanceof Array||Array.isArray(M)||M.length>=0&&(M.splice instanceof Function||Object.getOwnPropertyDescriptor(M,M.length-1)&&"String"!==M.constructor.name))}},13456:(M,Z,P)=>{var x=P(13459);function c(M){for(var Z,P,c=0,w=M.length,v=0;v<M.length;){for(Z=M[v],P=0;v<w&&M[v]===Z;)++v,++P;c+=x.log2(P)/7|0,c+=x.log2(Z>>>0)/7|0,c+=2}return c}Z.size=c,Z.encode=function(M,Z){Z||(Z=new Uint8Array(c(M)));for(var P,x,w=0,v=Z.length,G=0;G<M.length;){for(P=M[G],x=0;G<M.length&&M[G]===P;)++G,++x;for(;w<v&&x>=128;)Z[w++]=128+(127&x),x>>>=7;if(w>=v)throw new Error("RLE buffer overflow");for(Z[w++]=x,P>>>=0;w<v&&P>=128;)Z[w++]=128+(127&P),P>>>=7;if(w>=v)throw new Error("RLE buffer overflow");Z[w++]=P}return Z},Z.decode=function(M,Z){for(var P,x,c,w,v=Z.length,G=M.length,mM=0,K=0;K<G;){for(P=0,x=0;K<G&&M[K]>=128;)P+=(127&M[K++])<<x,x+=7;if(P+=M[K++]<<x,K>=G)throw new Error("RLE buffer underrun");if(mM+P>v)throw new Error("Chunk buffer overflow");for(c=0,x=0;K<G&&M[K]>=128;)c+=(127&M[K++])<<x,x+=7;if(K>=G)throw new Error("RLE buffer underrun");for(c+=M[K++]<<x,w=0;w<P;++w)Z[mM++]=c}return Z}},13459:(M,Z)=>{"use strict";function P(M){var Z=32;return(M&=-M)&&Z--,65535&M&&(Z-=16),16711935&M&&(Z-=8),252645135&M&&(Z-=4),858993459&M&&(Z-=2),1431655765&M&&(Z-=1),Z}Z.INT_BITS=32,Z.INT_MAX=2147483647,Z.INT_MIN=-1<<31,Z.sign=function(M){return(M>0)-(M<0)},Z.abs=function(M){var Z=M>>31;return(M^Z)-Z},Z.min=function(M,Z){return Z^(M^Z)&-(M<Z)},Z.max=function(M,Z){return M^(M^Z)&-(M<Z)},Z.isPow2=function(M){return!(M&M-1)&&!!M},Z.log2=function(M){var Z,P;return Z=(M>65535)<<4,Z|=P=((M>>>=Z)>255)<<3,Z|=P=((M>>>=P)>15)<<2,(Z|=P=((M>>>=P)>3)<<1)|(M>>>=P)>>1},Z.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},Z.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},Z.countTrailingZeros=P,Z.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},Z.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},Z.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var x=new Array(256);!function(M){for(var Z=0;Z<256;++Z){var P=Z,x=Z,c=7;for(P>>>=1;P;P>>>=1)x<<=1,x|=1&P,--c;M[Z]=x<<c&255}}(x),Z.reverse=function(M){return x[255&M]<<24|x[M>>>8&255]<<16|x[M>>>16&255]<<8|x[M>>>24&255]},Z.interleave2=function(M,Z){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))<<1},Z.deinterleave2=function(M,Z){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>Z&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},Z.interleave3=function(M,Z,P){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},Z.deinterleave3=function(M,Z){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>Z&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},Z.nextCombination=function(M){var Z=M|M-1;return Z+1|(~Z&-~Z)-1>>>P(M)+1}},13477:M=>{"use strict";M.exports=function(M,Z,P,x){var c=self||window;try{try{var w;try{w=new c.Blob([M])}catch(K){(w=new(c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder)).append(M),w=w.getBlob()}var v=c.URL||c.webkitURL,G=v.createObjectURL(w),mM=new c[Z](G,P);return v.revokeObjectURL(G),mM}catch(K){return new c[Z]("data:application/javascript,".concat(encodeURIComponent(M)),P)}}catch(K){if(!x)throw Error("Inline worker is not supported");return new c[Z](x,P)}}},13176:(M,Z,P)=>{"use strict";function x(M,Z,P,x,c){var w={};return Object.keys(x).forEach((function(M){w[M]=x[M]})),w.enumerable=!!w.enumerable,w.configurable=!!w.configurable,("value"in w||w.initializer)&&(w.writable=!0),w=P.slice().reverse().reduce((function(P,x){return x(M,Z,P)||P}),w),c&&void 0!==w.initializer&&(w.value=w.initializer?w.initializer.call(c):void 0,w.initializer=void 0),void 0===w.initializer&&(Object.defineProperty(M,Z,w),w=null),w}P.d(Z,{b:()=>x})},13170:(M,Z,P)=>{"use strict";function x(M,Z,P,x){P&&Object.defineProperty(M,Z,{enumerable:P.enumerable,configurable:P.configurable,writable:P.writable,value:P.initializer?P.initializer.call(x):void 0})}P.d(Z,{b:()=>x})},14564:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>v,d:()=>O,h:()=>G,i:()=>w,k:()=>mM,m:()=>c,o:()=>K,s:()=>d});var x=P(12570);class c{constructor(){this._easingMode=c.EASINGMODE_EASEIN}setEasingMode(M){const Z=Math.min(Math.max(M,0),2);this._easingMode=Z}getEasingMode(){return this._easingMode}easeInCore(M){throw new Error("You must implement this method")}ease(M){switch(this._easingMode){case c.EASINGMODE_EASEIN:return this.easeInCore(M);case c.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-M)}return M>=.5?.5*(1-this.easeInCore(2*(1-M)))+.5:.5*this.easeInCore(2*M)}}c.EASINGMODE_EASEIN=0,c.EASINGMODE_EASEOUT=1,c.EASINGMODE_EASEINOUT=2;class w extends c{easeInCore(M){return M=Math.max(0,Math.min(1,M)),1-Math.sqrt(1-M*M)}}class v extends c{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=M}easeInCore(M){const Z=Math.max(0,this.amplitude);return Math.pow(M,3)-M*Z*Math.sin(3.141592653589793*M)}}class G extends c{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=M,this.bounciness=Z}easeInCore(M){const Z=Math.max(0,this.bounces);let P=this.bounciness;P<=1&&(P=1.001);const x=Math.pow(P,Z),c=1-P,w=(1-x)/c+.5*x,v=M*w,G=Math.log(-v*(1-P)+1)/Math.log(P),mM=Math.floor(G),K=mM+1,d=(1-Math.pow(P,mM))/(c*w),O=.5*(d+(1-Math.pow(P,K))/(c*w)),H=M-O,j=O-d;return-Math.pow(1/P,Z-mM)/(j*j)*(H-j)*(H+j)}}class mM extends c{easeInCore(M){return M*M*M}}class K extends c{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=M,this.springiness=Z}easeInCore(M){let Z;const P=Math.max(0,this.oscillations),x=Math.max(0,this.springiness);return Z=0==x?M:(Math.exp(x*M)-1)/(Math.exp(x)-1),Z*Math.sin((6.283185307179586*P+1.5707963267948966)*M)}}class d extends c{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=M}easeInCore(M){return this.exponent<=0?M:(Math.exp(this.exponent*M)-1)/(Math.exp(this.exponent)-1)}}class O extends c{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=M,this.y1=Z,this.x2=P,this.y2=x}easeInCore(M){return x.d.Interpolate(M,this.x1,this.y1,this.x2,this.y2)}}},13995:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>v});var x=P(12373),c=P(12379),w=P(12791);class v extends w.c{get _matrix(){return this._compose(),this.uj}set _matrix(M){(M.updateFlag!==this.uj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.uj.v(M),this._markAsDirtyAndDecompose())}constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(M,Z.DM(),!1),this.name=M,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=Z,this.uj=(null===c||void 0===c?void 0:c.clone())??x.Matrix.Identity(),this._restMatrix=w??this.uj.clone(),this._bindMatrix=v??this.uj.clone(),this._index=G,this._absoluteMatrix=new x.Matrix,this._absoluteBindMatrix=new x.Matrix,this._absoluteInverseBindMatrix=new x.Matrix,this._finalMatrix=new x.Matrix,Z.bones.push(this),this.setParent(P,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(M){this.setParent(M)}setParent(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==M){if(this.parent){const M=this.parent.children.indexOf(this);-1!==M&&this.parent.children.splice(M,1)}this._parentNode=M,this.parent&&this.parent.children.push(this),Z&&this._updateAbsoluteBindMatrices(),this.Ad()}}getLocalMatrix(){return this._compose(),this.uj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(M){this._restMatrix.v(M)}setRestPose(M){this.setRestMatrix(M)}getBindPose(){return this.getBindMatrix()}setBindMatrix(M){this.Nc(M)}setBindPose(M){this.setBindMatrix(M)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const M=x.TmpVectors.BZ[0],Z=x.TmpVectors.Quaternion[0],P=x.TmpVectors.BZ[1];this.getRestMatrix().decompose(M,Z,P),this._linkedTransformNode.position.v(P),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??x.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.v(Z),this._linkedTransformNode.hc.v(M)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(M){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=M,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Nm}set position(M){this._decompose(),this.Nm.v(M),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(M){this.setRotation(M)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(M){this.setRotationQuaternion(M)}get hc(){return this.getScale()}set hc(M){this.setScale(M)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=x.BZ.Zero(),this._localRotation=x.Quaternion.Zero(),this.Nm=x.BZ.Zero()),this.uj.decompose(this._localScaling,this._localRotation,this.Nm))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,x.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Nm,this.uj)):this._needToCompose=!1)}Nc(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.v(M),Z&&this._updateAbsoluteBindMatrices(),P?this._matrix=M:this.Ad()}_updateAbsoluteBindMatrices(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(M||(M=this._bindMatrix),this.parent?M.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.v(M),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),Z)for(let P=0;P<this.children.length;P++)this.children[P]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ad(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ad(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ad(),this._needToDecompose=!0}_updatePosition(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=this.getLocalMatrix();if(0==Z)c?(w.addAtIndex(12,M.x),w.addAtIndex(13,M.y),w.addAtIndex(14,M.z)):w.setTranslationFromFloats(M.x,M.y,M.z);else{let Z=null;P&&(Z=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=v._TmpMats[0],mM=v._TmpVecs[0];this.parent?P&&Z?(G.v(this.parent.getAbsoluteMatrix()),G.multiplyToRef(Z,G)):G.v(this.parent.getAbsoluteMatrix()):x.Matrix.IdentityToRef(G),c&&G.setTranslationFromFloats(0,0,0),G.invert(),x.BZ.TransformCoordinatesToRef(M,G,mM),c?(w.addAtIndex(12,mM.x),w.addAtIndex(13,mM.y),w.addAtIndex(14,mM.z)):w.setTranslationFromFloats(mM.x,mM.y,mM.z)}this._markAsDirtyAndDecompose()}translate(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,Z,P,!0)}setPosition(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,Z,P,!1)}setAbsolutePosition(M,Z){this.setPosition(M,1,Z)}scale(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=this.getLocalMatrix(),G=v._TmpMats[0];x.Matrix.ScalingToRef(M,Z,P,G),G.multiplyToRef(w,w),G.invert();for(const x of this.children){const c=x.getLocalMatrix();c.multiplyToRef(G,c),c.multiplyAtIndex(12,M),c.multiplyAtIndex(13,Z),c.multiplyAtIndex(14,P),x._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),c)for(const x of this.children)x.scale(M,Z,P,c)}setScale(M){this._decompose(),this._localScaling.v(M),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(M){this._decompose(),M.v(this._localScaling)}setYawPitchRoll(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4?arguments[4]:void 0;if(0===c){const G=v._TmpQuat;return x.Quaternion.RotationYawPitchRollToRef(M,Z,P,G),void this.setRotationQuaternion(G,c,w)}const G=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,w))return;const mM=v._TmpMats[1];x.Matrix.RotationYawPitchRollToRef(M,Z,P,mM),G.multiplyToRef(mM,mM),this._rotateWithMatrix(mM,c,w)}rotate(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;const w=v._TmpMats[0];w.setTranslationFromFloats(0,0,0),x.Matrix.RotationAxisToRef(M,Z,w),this._rotateWithMatrix(w,P,c)}setAxisAngle(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;if(0===P){const w=v._TmpQuat;return x.Quaternion.RotationAxisToRef(M,Z,w),void this.setRotationQuaternion(w,P,c)}const w=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,c))return;const G=v._TmpMats[1];x.Matrix.RotationAxisToRef(M,Z,G),w.multiplyToRef(G,G),this._rotateWithMatrix(G,P,c)}setRotation(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(M.y,M.x,M.z,Z,P)}setRotationQuaternion(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===Z)return this._decompose(),this._localRotation.v(M),void this._markAsDirtyAndCompose();const c=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,P))return;const w=v._TmpMats[1];x.Matrix.FromQuaternionToRef(M,w),c.multiplyToRef(w,w),this._rotateWithMatrix(w,Z,P)}setRotationMatrix(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===Z){const c=v._TmpQuat;return x.Quaternion.FromRotationMatrixToRef(M,c),void this.setRotationQuaternion(c,Z,P)}const c=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,P))return;const w=v._TmpMats[1];w.v(M),c.multiplyToRef(M,w),this._rotateWithMatrix(w,Z,P)}_rotateWithMatrix(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const x=this.getLocalMatrix(),c=x.m[12],w=x.m[13],G=x.m[14],mM=this.getParent(),K=v._TmpMats[3],d=v._TmpMats[4];mM&&1==Z?(P?(K.v(P.getWorldMatrix()),mM.getAbsoluteMatrix().multiplyToRef(K,K)):K.v(mM.getAbsoluteMatrix()),d.v(K),d.invert(),x.multiplyToRef(K,x),x.multiplyToRef(M,x),x.multiplyToRef(d,x)):1==Z&&P?(K.v(P.getWorldMatrix()),d.v(K),d.invert(),x.multiplyToRef(K,x),x.multiplyToRef(M,x),x.multiplyToRef(d,x)):x.multiplyToRef(M,x),x.setTranslationFromFloats(c,w,G),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(M,Z){const P=v._TmpMats[2];return M.v(this.getAbsoluteMatrix()),Z?(M.multiplyToRef(Z.getWorldMatrix(),M),x.Matrix.ScalingToRef(Z.hc.x,Z.hc.y,Z.hc.z,P)):x.Matrix.IdentityToRef(P),M.invert(),!isNaN(M.m[0])&&(P.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyToRef(P,M),!0)}Mc(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=x.BZ.Zero();return this.getPositionToRef(M,Z,P),P}getPositionToRef(){let M=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const M=this.getLocalMatrix();Z.x=M.m[12],Z.y=M.m[13],Z.z=M.m[14]}else{let P=null;M&&(P=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let x=v._TmpMats[0];M&&P?(x.v(this.getAbsoluteMatrix()),x.multiplyToRef(P,x)):x=this.getAbsoluteMatrix(),Z.x=x.m[12],Z.y=x.m[13],Z.z=x.m[14]}}getAbsolutePosition(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Z=x.BZ.Zero();return this.getPositionToRef(1,M,Z),Z}getAbsolutePositionToRef(M,Z){this.getPositionToRef(1,M,Z)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.uj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.v(this.uj);const M=this._skeleton.getPoseMatrix();M&&this._absoluteMatrix.multiplyToRef(M,this._absoluteMatrix)}const M=this.children,Z=M.length;for(let P=0;P<Z;P++)M[P].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}pm(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=x.BZ.Zero();return this.getDirectionToRef(M,Z,P),P}getDirectionToRef(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,c=null;Z&&(c=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=v._TmpMats[0];w.v(this.getAbsoluteMatrix()),Z&&c&&w.multiplyToRef(c,w),x.BZ.TransformNormalToRef(M,w,P),P.normalize()}getRotation(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=x.BZ.Zero();return this.getRotationToRef(M,Z,P),P}getRotationToRef(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;const x=v._TmpQuat;this.getRotationQuaternionToRef(M,Z,x),x.toEulerAnglesToRef(P)}getRotationQuaternion(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=x.Quaternion.Identity();return this.getRotationQuaternionToRef(M,Z,P),P}getRotationQuaternionToRef(){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),Z.v(this._localRotation);else{const P=v._TmpMats[0],x=this.getAbsoluteMatrix();M?x.multiplyToRef(M.getWorldMatrix(),P):P.v(x),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.decompose(void 0,Z,void 0)}}getRotationMatrix(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1?arguments[1]:void 0;const P=x.Matrix.Identity();return this.getRotationMatrixToRef(M,Z,P),P}getRotationMatrixToRef(){let M=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(Z);else{const P=v._TmpMats[0],x=this.getAbsoluteMatrix();M?x.multiplyToRef(M.getWorldMatrix(),P):P.v(x),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.getRotationMatrixToRef(Z)}}getAbsolutePositionFromLocal(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=x.BZ.Zero();return this.getAbsolutePositionFromLocalToRef(M,Z,P),P}getAbsolutePositionFromLocalToRef(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,c=null;Z&&(c=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=v._TmpMats[0];w.v(this.getAbsoluteMatrix()),Z&&c&&w.multiplyToRef(c,w),x.BZ.TransformCoordinatesToRef(M,w,P)}getLocalPositionFromAbsolute(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=x.BZ.Zero();return this.getLocalPositionFromAbsoluteToRef(M,Z,P),P}getLocalPositionFromAbsoluteToRef(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,c=null;Z&&(c=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=v._TmpMats[0];w.v(this.getAbsoluteMatrix()),Z&&c&&w.multiplyToRef(c,w),w.invert(),x.BZ.TransformCoordinatesToRef(M,w,P)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const M=this._skeleton.bones.indexOf(this);if(-1!==M&&this._skeleton.bones.splice(M,1),this._parentNode&&this._parentNode.children){const M=this._parentNode.children,Z=M.indexOf(this);-1!==Z&&M.splice(Z,1)}super.dispose()}}v._TmpVecs=(0,c.c)(2,x.BZ.Zero),v._TmpQuat=x.Quaternion.Identity(),v._TmpMats=(0,c.c)(5,x.Matrix.Identity)},14557:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>k});var x=P(12351),c=P(12359),w=P(12184),v=P(12373),G=P(12387),mM=P(12791),K=P(12825),d=P(12648),O=P(12209),H=P(12377);class j{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(M){this._idleRotationSpeed=M}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(M){this._idleRotationWaitTime=M}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(M){this._idleRotationSpinupTime=M}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(M){this._attachedCamera=M;const Z=this._attachedCamera.DM();this._onPrePointerObservableObserver=Z.onPrePointerObservable.add((M=>{M.type!==d.c.POINTERDOWN?M.type===d.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const M=O.c.Now;let Z=0;null!=this._lastFrameTime&&(Z=M-this._lastFrameTime),this._lastFrameTime=M,this._applyUserInteraction();const P=M-this._lastInteractionTime-this._idleRotationWaitTime,x=Math.max(Math.min(P/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*x,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(Z/1e3))}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.DM();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(M){this._lastInteractionTime=M??O.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<H.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let M=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(M=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?M:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=O.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var B=P(14564),U=P(12890);class n{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(M){if(this._autoTransitionRange===M)return;this._autoTransitionRange=M;const Z=this._attachedCamera;Z&&(M?this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((M=>{if(M&&(M.Jc(!0),M.getBoundingInfo)){const Z=M.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*Z,this.upperRadiusTransitionRange=.05*Z}})):this._onMeshTargetChangedObserver&&Z.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(M){this._attachedCamera=M,this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(M){return!!this._attachedCamera&&(this._attachedCamera.radius===M&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(M){if(!this._attachedCamera)return;this._radiusBounceTransition||(n.EasingFunction.setEasingMode(n.EasingMode),this._radiusBounceTransition=U.d.CreateAnimation("radius",U.d.ANIMATIONTYPE_FLOAT,60,n.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const Z=U.d.TransitionTo("radius",this._attachedCamera.radius+M,this._attachedCamera,this._attachedCamera.DM(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));Z&&this._animatables.push(Z)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}n.EasingFunction=new B.c(.3),n.EasingMode=B.m.EASINGMODE_EASEOUT;class L{constructor(){this.onTargetFramingAnimationEndObservable=new w.b,this._mode=L.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(M){this._mode=M}get mode(){return this._mode}set radiusScale(M){this._radiusScale=M}get radiusScale(){return this._radiusScale}set positionScale(M){this._positionScale=M}get positionScale(){return this._positionScale}set defaultElevation(M){this._defaultElevation=M}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(M){this._elevationReturnTime=M}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(M){this._elevationReturnWaitTime=M}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(M){this._framingTime=M}get framingTime(){return this._framingTime}init(){}attach(M){this._attachedCamera=M;const Z=this._attachedCamera.DM();L.EasingFunction.setEasingMode(L.EasingMode),this._onPrePointerObservableObserver=Z.onPrePointerObservable.add((M=>{M.type!==d.c.POINTERDOWN?M.type===d.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((M=>{M&&M.getBoundingInfo&&this.zoomOnMesh(M,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.DM();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.Jc(!0);const x=M.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(x.minimumWorld,x.maximumWorld,Z,P)}zoomOnMeshHierarchy(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.Jc(!0);const x=M.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(x.min,x.max,Z,P)}zoomOnMeshesHierarchy(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new v.BZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new v.BZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let w=0;w<M.length;w++){const Z=M[w].getHierarchyBoundingVectors(!0);v.BZ.CheckExtends(Z.min,x,c),v.BZ.CheckExtends(Z.max,x,c)}this.zoomOnBoundingInfo(x,c,Z,P)}zoomOnBoundingInfo(M,Z){let P,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const w=M.y,G=w+(Z.y-w)*this._positionScale,mM=Z.UZ(M).scale(.5);if(!isFinite(G))return!1;if(x)P=new v.BZ(0,G,0);else{const Z=M.add(mM);P=new v.BZ(Z.x,G,Z.z)}this._vectorTransition||(this._vectorTransition=U.d.CreateAnimation("target",U.d.ANIMATIONTYPE_VECTOR3,60,L.EasingFunction)),this._betaIsAnimating=!0;let K=U.d.TransitionTo("target",P,this._attachedCamera,this._attachedCamera.DM(),60,this._vectorTransition,this._framingTime);K&&this._animatables.push(K);let d=0;if(this._mode===L.FitFrustumSidesMode){const P=this._calculateLowerRadiusFromModelBoundingSphere(M,Z);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=mM.length()+this._attachedCamera.uc),d=P}else this._mode===L.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(M,Z),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.uc));if(this.autoCorrectCameraLimitsAndSensibility){const P=Z.UZ(M).length();this._attachedCamera.panningSensibility=5e3/P,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=U.d.CreateAnimation("radius",U.d.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),K=U.d.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.DM(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),c&&c(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),K&&this._animatables.push(K),!0}_calculateLowerRadiusFromModelBoundingSphere(M,Z){const P=this._attachedCamera;if(!P)return 0;let x=P._calculateLowerRadiusFromModelBoundingSphere(M,Z,this._radiusScale);return P.lowerRadiusLimit&&this._mode===L.IgnoreBoundsSizeMode&&(x=x<P.lowerRadiusLimit?P.lowerRadiusLimit:x),P.upperRadiusLimit&&(x=x>P.upperRadiusLimit?P.upperRadiusLimit:x),x}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const M=O.c.Now-this._lastInteractionTime,Z=.5*Math.PI-this._defaultElevation,P=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>P&&M>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=U.d.CreateAnimation("beta",U.d.ANIMATIONTYPE_FLOAT,60,L.EasingFunction));const M=U.d.TransitionTo("beta",Z,this._attachedCamera,this._attachedCamera.DM(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));M&&this._animatables.push(M)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=O.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}L.EasingFunction=new B.s,L.EasingMode=B.m.EASINGMODE_EASEINOUT,L.IgnoreBoundsSizeMode=0,L.FitFrustumSidesMode=1;var u=P(12828),N=P(12847),J=P(13991),t=P(12175);class F{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(M){M=t.Tools.BackCompatCameraNoPreventDefault(arguments);const Z=this.camera.getEngine(),P=Z.getInputElement();let x=0,c=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=w=>{var v,G;const mM=w.event,K="touch"===mM.pointerType;if(w.type!==d.c.POINTERMOVE&&-1===this.buttons.indexOf(mM.button))return;const O=mM.target;if(this._altKey=mM.altKey,this._ctrlKey=mM.ctrlKey,this._metaKey=mM.metaKey,this._shiftKey=mM.shiftKey,this._buttonsPressed=mM.buttons,Z.isPointerLock){const M=mM.movementX,Z=mM.movementY;this.onTouch(null,M,Z),this._pointA=null,this._pointB=null}else{if(w.type!==d.c.POINTERDOWN&&w.type!==d.c.POINTERDOUBLETAP&&K&&(null===(v=this._pointA)||void 0===v?void 0:v.pointerId)!==mM.pointerId&&(null===(G=this._pointB)||void 0===G?void 0:G.pointerId)!==mM.pointerId)return;if(w.type!==d.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!K)if(w.type===d.c.POINTERDOUBLETAP)this.onDoubleTap(mM.pointerType);else if(w.type!==d.c.POINTERUP||this._currentMousePointerIdDown!==mM.pointerId&&!K){if(w.type===d.c.POINTERMOVE)if(M||mM.preventDefault(),this._pointA&&null===this._pointB){const M=mM.clientX-this._pointA.x,Z=mM.clientY-this._pointA.y;this._pointA.x=mM.clientX,this._pointA.y=mM.clientY,this.onTouch(this._pointA,M,Z)}else if(this._pointA&&this._pointB){const M=this._pointA.pointerId===mM.pointerId?this._pointA:this._pointB;M.x=mM.clientX,M.y=mM.clientY;const Z=this._pointA.x-this._pointB.x,P=this._pointA.y-this._pointB.y,v=Z*Z+P*P,G={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:mM.pointerId,type:w.type};this.onMultiTouch(this._pointA,this._pointB,x,v,c,G),c=G,x=v}}else{try{null===O||void 0===O||O.releasePointerCapture(mM.pointerId)}catch(H){}K||(this._pointB=null),Z._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==mM.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==mM.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==x||c)&&(this.onMultiTouch(this._pointA,this._pointB,x,0,c,null),x=0,c=null),this._currentMousePointerIdDown=-1,this.onButtonUp(mM),M||mM.preventDefault()}else{try{null===O||void 0===O||O.setPointerCapture(mM.pointerId)}catch(H){}if(null===this._pointA)this._pointA={x:mM.clientX,y:mM.clientY,pointerId:mM.pointerId,type:mM.pointerType};else{if(null!==this._pointB)return;this._pointB={x:mM.clientX,y:mM.clientY,pointerId:mM.pointerId,type:mM.pointerType}}-1!==this._currentMousePointerIdDown||K||(this._currentMousePointerIdDown=mM.pointerId),this.onButtonDown(mM),M||(mM.preventDefault(),P&&P.focus())}}},this._observer=this.camera.DM()._inputManager._addCameraPointerObserver(this._pointerInput,d.c.POINTERDOWN|d.c.POINTERUP|d.c.POINTERMOVE|d.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,x=0,c=null,this.onLostFocus()},this._contextMenuBind=M=>this.onContextMenu(M),P&&P.addEventListener("contextmenu",this._contextMenuBind,!1);const w=this.camera.DM().getEngine().getHostWindow();w&&t.Tools.RegisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}CH(){if(this._onLostFocus){const M=this.camera.DM().getEngine().getHostWindow();M&&t.Tools.UnregisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.DM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const M=this.camera.DM().getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(M){}onTouch(M,Z,P){}onMultiTouch(M,Z,P,x,c,w){}onContextMenu(M){M.preventDefault()}onButtonDown(M){}onButtonUp(M){}onLostFocus(){}}(0,x.c)([(0,c.H)()],F.prototype,"buttons",void 0);class D extends F{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(M,Z){if(0!==this.panningSensibility&&M&&Z){const P=Z.x-M.x,x=Z.y-M.y;this.camera.inertialPanningX+=-P/this.panningSensibility,this.camera.inertialPanningY+=x/this.panningSensibility}}_computePinchZoom(M,Z){const P=this.camera.radius||D.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=P*Math.sqrt(M)/Math.sqrt(Z):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(Z-M)*P*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(Z-M)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(M,Z,P){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-Z/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility):(this.camera.inertialAlphaOffset-=Z/this.angularSensibilityX,this.camera.inertialBetaOffset-=P/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(M,Z,P,x,c,w){0===P&&null===c||0===x&&null===w||(this.multiTouchPanAndZoom?(this._computePinchZoom(P,x),this._computeMultiTouchPanning(c,w)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(x)-Math.sqrt(P))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(P,x),this._isPinching=!0):this._computeMultiTouchPanning(c,w)):this.multiTouchPanning?this._computeMultiTouchPanning(c,w):this.pinchZoom&&this._computePinchZoom(P,x))}onButtonDown(M){this._isPanClick=M.button===this.camera._panningMouseButton}onButtonUp(M){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}D.MinimumRadiusForPinch=.001,(0,x.c)([(0,c.H)()],D.prototype,"buttons",void 0),(0,x.c)([(0,c.H)()],D.prototype,"angularSensibilityX",void 0),(0,x.c)([(0,c.H)()],D.prototype,"angularSensibilityY",void 0),(0,x.c)([(0,c.H)()],D.prototype,"pinchPrecision",void 0),(0,x.c)([(0,c.H)()],D.prototype,"pinchDeltaPercentage",void 0),(0,x.c)([(0,c.H)()],D.prototype,"useNaturalPinchZoom",void 0),(0,x.c)([(0,c.H)()],D.prototype,"pinchZoom",void 0),(0,x.c)([(0,c.H)()],D.prototype,"panningSensibility",void 0),(0,x.c)([(0,c.H)()],D.prototype,"multiTouchPanning",void 0),(0,x.c)([(0,c.H)()],D.prototype,"multiTouchPanAndZoom",void 0),J.b.ArcRotateCameraPointersInput=D;var l=P(12651);class h{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(M){M=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.DM(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Z=>{const P=Z.event;if(!P.metaKey)if(Z.type===l.d.KEYDOWN){if(this._ctrlPressed=P.ctrlKey,this._altPressed=P.altKey,-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),P.preventDefault&&(M||P.preventDefault())}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){const Z=this._keys.indexOf(P.keyCode);Z>=0&&this._keys.splice(Z,1),P.preventDefault&&(M||P.preventDefault())}})))}CH(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let Z=0;Z<this._keys.length;Z++){const P=this._keys[Z];-1!==this.keysLeft.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX-=1/this.panningSensibility:M.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset+=1/this.zoomingSensibility:M.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX+=1/this.panningSensibility:M.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset-=1/this.zoomingSensibility:M.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(P)&&M.useInputToRestoreState&&M.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,x.c)([(0,c.H)()],h.prototype,"keysUp",void 0),(0,x.c)([(0,c.H)()],h.prototype,"keysDown",void 0),(0,x.c)([(0,c.H)()],h.prototype,"keysLeft",void 0),(0,x.c)([(0,c.H)()],h.prototype,"keysRight",void 0),(0,x.c)([(0,c.H)()],h.prototype,"keysReset",void 0),(0,x.c)([(0,c.H)()],h.prototype,"panningSensibility",void 0),(0,x.c)([(0,c.H)()],h.prototype,"zoomingSensibility",void 0),(0,x.c)([(0,c.H)()],h.prototype,"useAltToZoom",void 0),(0,x.c)([(0,c.H)()],h.prototype,"angularSpeed",void 0),J.b.ArcRotateCameraKeyboardMoveInput=h;var Q=P(12408),I=P(12653);class s{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new v.BZ(0,0,0),this._globalOffset=new v.BZ(0,0,0),this._inertialPanning=v.BZ.Zero()}_computeDeltaFromMouseWheelLegacyEvent(M,Z){let P=0;const x=.01*M*this.wheelDeltaPercentage*Z;return P=M>0?x/(1+this.wheelDeltaPercentage):x*(1+this.wheelDeltaPercentage),P}attachControl(M){M=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=Z=>{if(Z.type!==d.c.POINTERWHEEL)return;const P=Z.event;let x=0;const c=P.deltaMode===I.c.DOM_DELTA_LINE?40:1,w=-P.deltaY*c;if(this.customComputeDeltaFromMouseWheel)x=this.customComputeDeltaFromMouseWheel(w,this,P);else if(this.wheelDeltaPercentage){if(x=this._computeDeltaFromMouseWheelLegacyEvent(w,this.camera.radius),x>0){let M=this.camera.radius,Z=this.camera.inertialRadiusOffset+x;for(let P=0;P<20&&!(M<=Z)&&!(Math.abs(Z*this.camera.inertia)<.001);P++)M-=Z,Z*=this.camera.inertia;M=(0,G.Clamp)(M,0,Number.MAX_VALUE),x=this._computeDeltaFromMouseWheelLegacyEvent(w,M)}}else x=w/(40*this.wheelPrecision);x&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(x)):this.camera.inertialRadiusOffset+=x),P.preventDefault&&(M||P.preventDefault())},this._observer=this.camera.DM()._inputManager._addCameraPointerObserver(this._wheel,d.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Qc(0)}CH(){this._observer&&(this.camera.DM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const M=this.camera;0+M.inertialAlphaOffset+M.inertialBetaOffset+M.inertialRadiusOffset&&(this._updateHitPlane(),M.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(M.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const M=this.camera,Z=M.target.UZ(M.position);this._hitPlane=Q.c.FromPositionAndNormal(M.target,Z)}_getPosition(){const M=this.camera,Z=M.DM(),P=Z.createPickingRay(Z.pointerX,Z.pointerY,v.Matrix.Identity(),M,!1);0===M.targetScreenOffset.x&&0===M.targetScreenOffset.y||(this._viewOffset.set(M.targetScreenOffset.x,M.targetScreenOffset.y,0),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),this._globalOffset=v.BZ.TransformNormal(this._viewOffset,M._cameraTransformMatrix),P.origin.addInPlace(this._globalOffset));let x=0;return this._hitPlane&&(x=P.intersectsPlane(this._hitPlane)??0),P.origin.addInPlace(P.direction.scaleInPlace(x))}_zoomToMouse(M){const Z=this.camera,P=1-Z.inertia;if(Z.lowerRadiusLimit){const x=Z.lowerRadiusLimit??0;Z.radius-(Z.inertialRadiusOffset+M)/P<x&&(M=(Z.radius-x)*P-Z.inertialRadiusOffset)}if(Z.upperRadiusLimit){const x=Z.upperRadiusLimit??0;Z.radius-(Z.inertialRadiusOffset+M)/P>x&&(M=(Z.radius-x)*P-Z.inertialRadiusOffset)}const x=M/P/Z.radius,c=this._getPosition(),w=v.TmpVectors.BZ[6];c.subtractToRef(Z.target,w),w.scaleInPlace(x),w.scaleInPlace(P),this._inertialPanning.addInPlace(w),Z.inertialRadiusOffset+=M}_zeroIfClose(M){Math.abs(M.x)<H.c&&(M.x=0),Math.abs(M.y)<H.c&&(M.y=0),Math.abs(M.z)<H.c&&(M.z=0)}}(0,x.c)([(0,c.H)()],s.prototype,"wheelPrecision",void 0),(0,x.c)([(0,c.H)()],s.prototype,"zoomToMouseLocation",void 0),(0,x.c)([(0,c.H)()],s.prototype,"wheelDeltaPercentage",void 0),J.b.ArcRotateCameraMouseWheelInput=s;class C extends J.c{constructor(M){super(M)}addMouseWheel(){return this.add(new s),this}addPointers(){return this.add(new D),this}addKeyboard(){return this.add(new h),this}}var R=P(12317);function W(M,Z){return isNaN(M)?Z:M}mM.c.AddNodeConstructor("ArcRotateCamera",((M,Z)=>()=>new k(M,0,0,1,v.BZ.Zero(),Z)));class k extends N.b{get target(){return this._target}set target(M){this.setTarget(M)}get targetHost(){return this._targetHost}set targetHost(M){M&&this.setTarget(M)}getTarget(){return this.target}get position(){return this._position}set position(M){this.setPosition(M)}set upVector(M){this._upToYMatrix||(this._yToUpMatrix=new v.Matrix,this._upToYMatrix=new v.Matrix,this._upVector=v.BZ.Zero()),M.normalize(),this._upVector.v(M),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){v.Matrix.RotationAlignToRef(v.BZ.UpReadOnly,this._upVector,this._yToUpMatrix),v.Matrix.RotationAlignToRef(this._upVector,v.BZ.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityX:0}set angularSensibilityX(M){const Z=this.inputs.attached.pointers;Z&&(Z.angularSensibilityX=M)}get angularSensibilityY(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityY:0}set angularSensibilityY(M){const Z=this.inputs.attached.pointers;Z&&(Z.angularSensibilityY=M)}get pinchPrecision(){const M=this.inputs.attached.pointers;return M?M.pinchPrecision:0}set pinchPrecision(M){const Z=this.inputs.attached.pointers;Z&&(Z.pinchPrecision=M)}get pinchDeltaPercentage(){const M=this.inputs.attached.pointers;return M?M.pinchDeltaPercentage:0}set pinchDeltaPercentage(M){const Z=this.inputs.attached.pointers;Z&&(Z.pinchDeltaPercentage=M)}get useNaturalPinchZoom(){const M=this.inputs.attached.pointers;return!!M&&M.useNaturalPinchZoom}set useNaturalPinchZoom(M){const Z=this.inputs.attached.pointers;Z&&(Z.useNaturalPinchZoom=M)}get panningSensibility(){const M=this.inputs.attached.pointers;return M?M.panningSensibility:0}set panningSensibility(M){const Z=this.inputs.attached.pointers;Z&&(Z.panningSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUp=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDown=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRight=M)}get wheelPrecision(){const M=this.inputs.attached.mousewheel;return M?M.wheelPrecision:0}set wheelPrecision(M){const Z=this.inputs.attached.mousewheel;Z&&(Z.wheelPrecision=M)}get zoomToMouseLocation(){const M=this.inputs.attached.mousewheel;return!!M&&M.zoomToMouseLocation}set zoomToMouseLocation(M){const Z=this.inputs.attached.mousewheel;Z&&(Z.zoomToMouseLocation=M)}get wheelDeltaPercentage(){const M=this.inputs.attached.mousewheel;return M?M.wheelDeltaPercentage:0}set wheelDeltaPercentage(M){const Z=this.inputs.attached.mousewheel;Z&&(Z.wheelDeltaPercentage=M)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(M){M!==this.useBouncingBehavior&&(M?(this._bouncingBehavior=new n,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(M){M!==this.useFramingBehavior&&(M?(this._framingBehavior=new L,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(M){M!==this.useAutoRotationBehavior&&(M?(this._autoRotationBehavior=new j,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(M,Z,P,x,c,G){var mM;let K=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(M,v.BZ.Zero(),G,K),mM=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=v.BZ.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=v.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new v.Matrix,this.panningAxis=new v.BZ(1,1,0),this._transformedDirection=new v.BZ,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new w.b,this.checkCollisions=!1,this.collisionRadius=new v.BZ(.5,.5,.5),this._previousPosition=v.BZ.Zero(),this._collisionVelocity=v.BZ.Zero(),this._newPosition=v.BZ.Zero(),this._computationVector=v.BZ.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new v.BZ(NaN,NaN,NaN),this._goalTargetScreenOffset=new v.Vector2(NaN,NaN),this._onCollisionPositionChange=function(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P?(mM.setPosition(Z),mM.OB&&mM.OB(P)):mM._previousPosition.v(mM._position);const x=Math.cos(mM.alpha),c=Math.sin(mM.alpha),w=Math.cos(mM.beta);let v=Math.sin(mM.beta);0===v&&(v=1e-4);const G=mM._getTargetPosition();mM._computationVector.lc(mM.radius*x*v,mM.radius*w,mM.radius*c*v),G.addToRef(mM._computationVector,mM._newPosition),mM._position.v(mM._newPosition);let K=mM.upVector;mM.allowUpsideDown&&mM.beta<0&&(K=K.clone(),K=K.negate()),mM._computeViewMatrix(mM._position,G,K),mM._viewMatrix.addAtIndex(12,mM.targetScreenOffset.x),mM._viewMatrix.addAtIndex(13,mM.targetScreenOffset.y),mM._collisionTriggered=!1},this._target=v.BZ.Zero(),c&&this.setTarget(c),this.alpha=Z,this.beta=P,this.radius=x,this.getViewMatrix(),this.inputs=new C(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new v.BZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=v.Vector2.Zero()}_updateCache(M){M||super._updateCache(),this._cache._target.v(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.v(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const M=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?M.addToRef(this._targetBoundingCenter,this._target):this._target.v(M)}const M=this._getLockedTargetPosition();return M||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>H.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,w=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=w?this._currentInterpolationFactor=w:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=W(M,this._goalAlpha),this._goalBeta=W(Z,this._goalBeta),this._goalRadius=W(P,this._goalRadius),this._goalTarget.set(W(x.x,this._goalTarget.x),W(x.y,this._goalTarget.y),W(x.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(W(c.x,this._goalTargetScreenOffset.x),W(c.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,G.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,G.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,G.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,G.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(M,Z){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const c=arguments;Z=t.Tools.BackCompatCameraNoPreventDefault(c),this._useCtrlForPanning=P,this._panningMouseButton=x,"boolean"===typeof c[0]&&(c.length>1&&(this._useCtrlForPanning=c[1]),c.length>2&&(this._panningMouseButton=c[2])),this.inputs.attachElement(Z),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}CH(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let M=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){M=!0;const Z=this.invertRotation?-1:1,P=this._calculateHandednessMultiplier();let x=this.inertialAlphaOffset*P;this.beta<0&&(x*=-1),this.alpha+=x*Z,this.beta+=this.inertialBetaOffset*Z,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<H.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<H.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*H.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){M=!0;const Z=new v.BZ(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),Z.multiplyInPlace(this.panningAxis),v.BZ.TransformNormalToRef(Z,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const M=this.upVector,Z=v.BZ.CrossToRef(this._transformedDirection,M,this._transformedDirection);v.BZ.CrossToRef(M,Z,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);v.BZ.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.v(this._transformedDirection)}else{if(this.parent){const M=v.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(M),M.transposeToRef(M),v.BZ.TransformCoordinatesToRef(this._transformedDirection,M,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*H.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*H.c&&(this.inertialPanningY=0)}if(M)this.stopInterpolation();else if(this._isInterpolating){let M=!1;const Z=this._scene.getEngine().getDeltaTime()/1e3,P=1-Math.pow(2,-Z/this._currentInterpolationFactor),x=W(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const Z=v.TmpVectors.BZ[0].set(W(this._goalTarget.x,this._target.x),W(this._goalTarget.y,this._target.y),W(this._goalTarget.z,this._target.z));v.BZ.LerpToRef(this.target,Z,P,this._target),10*v.BZ.Distance(this.target,Z)/x<H.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.v(Z),this.setTarget(this.target,!1,!0,!0)):M=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const Z=v.Quaternion.RotationAlphaBetaGammaToRef(W(this._goalAlpha,this.alpha),W(this._goalBeta,this.beta),0,v.TmpVectors.Quaternion[0]),x=v.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,v.TmpVectors.Quaternion[1]),c=v.Quaternion.SlerpToRef(x,Z,P,v.TmpVectors.Quaternion[2]);c.normalize();const w=c.toAlphaBetaGammaToRef(v.TmpVectors.BZ[0]);if(this.alpha=w.x,this.beta=w.y,c.isApprox(Z,H.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const M=Z.toAlphaBetaGammaToRef(v.TmpVectors.BZ[0]);this.alpha=M.x,this.beta=M.y}else M=!0}if(isNaN(this._goalRadius)||(this.radius+=(x-this.radius)*P,Math.abs(x/this.radius-1)<H.c?(this._goalRadius=NaN,this.radius=x):M=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const Z=v.TmpVectors.Vector2[0].set(W(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),W(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));v.Vector2.LerpToRef(this.targetScreenOffset,Z,P,this.targetScreenOffset),v.Vector2.Distance(this.targetScreenOffset,Z)<H.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.v(Z)):M=!0}this._isInterpolating=M}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||v.BZ.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const M=this.alpha;var Z,P;this.alpha=function(M){let Z=Math.PI/2;return 0===M.x&&0===M.z||(Z=Math.acos(M.x/Math.sqrt(Math.pow(M.x,2)+Math.pow(M.z,2)))),M.z<0&&(Z=2*Math.PI-Z),Z}(this._computationVector),this.beta=(Z=this._computationVector.y,P=this.radius,Math.acos(Z/P));const x=Math.round((M-this.alpha)/(2*Math.PI));this.alpha+=2*x*Math.PI,this._checkLimits()}setPosition(M){this._position.equals(M)||(this._position.v(M),this.rebuildAnglesAndRadius())}setTarget(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(x=this.overrideCloneAlphaBetaRadius??x,M.Jc)Z&&M.getBoundingInfo?this._targetBoundingCenter=M.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,M.Jc(),this._targetHost=M,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const Z=M,x=this._getTargetPosition();if(x&&!P&&x.equals(Z))return;this._targetHost=null,this._target=Z,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}x||this.rebuildAnglesAndRadius()}_getViewMatrix(){const M=Math.cos(this.alpha),Z=Math.sin(this.alpha),P=Math.cos(this.beta);let x=Math.sin(this.beta);0===x&&(x=1e-4),0===this.radius&&(this.radius=1e-4);const c=this._getTargetPosition();if(this._computationVector.lc(this.radius*M*x,this.radius*P,this.radius*Z*x),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||v.BZ.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),c.addToRef(this._computationVector,this._newPosition),this.DM().collisionsEnabled&&this.checkCollisions){const M=this.DM().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,M.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.v(this._newPosition);let M=this.upVector;this.allowUpsideDown&&x<0&&(M=M.negate()),this._computeViewMatrix(this._position,c,M),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.v(c),this._viewMatrix}zoomOn(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M=M||this.DM().meshes;const P=K.c.MinMax(M);let x=this._calculateLowerRadiusFromModelBoundingSphere(P.min,P.max);if(x=Math.max(Math.min(x,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=x*this.zoomOnFactor,this.mode===u.e.ORTHOGRAPHIC_CAMERA){const M=this.DM().getEngine().getAspectRatio(this),Z=x*this.zoomOnFactor/2;this.orthoLeft=-Z*M,this.orthoRight=Z*M,this.orthoBottom=-Z,this.orthoTop=Z}this.focusOn({min:P.min,max:P.max,distance:x},Z)}focusOn(M){let Z,P,x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===M.min){const x=M||this.DM().meshes;Z=K.c.MinMax(x),P=v.BZ.Distance(Z.min,Z.max)}else{Z=M,P=M.distance}this._target=K.c.Center(Z),x||(this.maxZ=2*P)}createRigCamera(M,Z){let P=0;switch(this.cameraRigMode){case u.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case u.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case u.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case u.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case u.e.RIG_MODE_VR:P=this._cameraRigParams.stereoHalfAngle*(0===Z?1:-1);break;case u.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P=this._cameraRigParams.stereoHalfAngle*(0===Z?-1:1)}const x=new k(M,this.alpha+P,this.beta,this.radius,this._target,this.DM());return x._cameraRigParams={},x.isRigCamera=!0,x.rigParent=this,x.upVector=this.upVector,x.mode=this.mode,x.orthoLeft=this.orthoLeft,x.orthoRight=this.orthoRight,x.orthoBottom=this.orthoBottom,x.orthoTop=this.orthoTop,x}_updateRigCameras(){const M=this._rigCameras[0],Z=this._rigCameras[1];switch(M.beta=Z.beta=this.beta,this.cameraRigMode){case u.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case u.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case u.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case u.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case u.e.RIG_MODE_VR:M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case u.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const x=v.BZ.Distance(M,Z),c=this.DM().getEngine().getAspectRatio(this),w=Math.tan(this.fov/2),G=w*c,mM=.5*x*P,K=mM*Math.sqrt(1+1/(G*G)),d=mM*Math.sqrt(1+1/(w*w));return Math.max(K,d)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,x.c)([(0,c.H)()],k.prototype,"alpha",void 0),(0,x.c)([(0,c.H)()],k.prototype,"beta",void 0),(0,x.c)([(0,c.H)()],k.prototype,"radius",void 0),(0,x.c)([(0,c.H)()],k.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,x.c)([(0,c.E)("target")],k.prototype,"_target",void 0),(0,x.c)([(0,c.v)("targetHost")],k.prototype,"_targetHost",void 0),(0,x.c)([(0,c.H)()],k.prototype,"inertialAlphaOffset",void 0),(0,x.c)([(0,c.H)()],k.prototype,"inertialBetaOffset",void 0),(0,x.c)([(0,c.H)()],k.prototype,"inertialRadiusOffset",void 0),(0,x.c)([(0,c.H)()],k.prototype,"lowerAlphaLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"upperAlphaLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"lowerBetaLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"upperBetaLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"lowerRadiusLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"upperRadiusLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"lowerTargetYLimit",void 0),(0,x.c)([(0,c.H)()],k.prototype,"inertialPanningX",void 0),(0,x.c)([(0,c.H)()],k.prototype,"inertialPanningY",void 0),(0,x.c)([(0,c.H)()],k.prototype,"pinchToPanMaxDistance",void 0),(0,x.c)([(0,c.H)()],k.prototype,"panningDistanceLimit",void 0),(0,x.c)([(0,c.E)()],k.prototype,"panningOriginTarget",void 0),(0,x.c)([(0,c.H)()],k.prototype,"panningInertia",void 0),(0,x.c)([(0,c.H)()],k.prototype,"zoomToMouseLocation",null),(0,x.c)([(0,c.H)()],k.prototype,"zoomOnFactor",void 0),(0,x.c)([(0,c.D)()],k.prototype,"targetScreenOffset",void 0),(0,x.c)([(0,c.H)()],k.prototype,"allowUpsideDown",void 0),(0,x.c)([(0,c.H)()],k.prototype,"useInputToRestoreState",void 0),(0,x.c)([(0,c.H)()],k.prototype,"restoreStateInterpolationFactor",void 0),(0,R.g)("BABYLON.ArcRotateCamera",k)},13991:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>v,c:()=>G});var x=P(12199),c=P(12394),w=P(12828),v={};class G{constructor(M){this.attachedToElement=!1,this.attached={},this.camera=M,this.checkInputs=()=>{}}add(M){const Z=M.getSimpleName();this.attached[Z]?x.d.Warn("camera input of type "+Z+" already exists on camera"):(this.attached[Z]=M,M.camera=this.camera,M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M))),this.attachedToElement&&M.attachControl(this.noPreventDefault))}remove(M){for(const Z in this.attached){const P=this.attached[Z];if(P===M)return P.CH(),P.camera=null,delete this.attached[Z],void this.rebuildInputCheck()}}removeByType(M){for(const Z in this.attached){const P=this.attached[Z];P.getClassName()===M&&(P.CH(),P.camera=null,delete this.attached[Z],this.rebuildInputCheck())}}_addCheckInputs(M){const Z=this.checkInputs;return()=>{Z(),M()}}attachInput(M){this.attachedToElement&&M.attachControl(this.noPreventDefault)}attachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){M=!w.e.ForceAttachControlToAlwaysPreventDefault&&M,this.attachedToElement=!0,this.noPreventDefault=M;for(const Z in this.attached)this.attached[Z].attachControl(M)}}detachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const Z in this.attached)this.attached[Z].CH(),M&&(this.attached[Z].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const M in this.attached){const Z=this.attached[M];Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(M){const Z={};for(const P in this.attached){const M=this.attached[P],x=c.b.Serialize(M);Z[M.getClassName()]=x}M.inputsmgr=Z}parse(M){const Z=M.inputsmgr;if(Z){this.clear();for(const M in Z){const P=v[M];if(P){const x=Z[M],w=c.b.Parse((()=>new P),x,null);this.add(w)}}}else for(const P in this.attached){const Z=v[this.attached[P].getClassName()];if(Z){const x=c.b.Parse((()=>new Z),M,null);this.remove(this.attached[P]),this.add(x)}}}}},13982:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>F});var x=P(12351),c=P(12359),w=P(12373),v=P(12847),G=P(13991),mM=P(12651),K=P(12175);class d{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(M){M=K.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.DM(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Z=>{const P=Z.event;if(!P.metaKey)if(Z.type===mM.d.KEYDOWN){if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),M||P.preventDefault()}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){const Z=this._keys.indexOf(P.keyCode);Z>=0&&this._keys.splice(Z,1),M||P.preventDefault()}})))}CH(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let Z=0;Z<this._keys.length;Z++){const P=this._keys[Z],x=M._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(P)?M._localDirection.lc(-x,0,0):-1!==this.keysUp.indexOf(P)?M._localDirection.lc(0,0,x):-1!==this.keysRight.indexOf(P)?M._localDirection.lc(x,0,0):-1!==this.keysDown.indexOf(P)?M._localDirection.lc(0,0,-x):-1!==this.keysUpward.indexOf(P)?M._localDirection.lc(0,x,0):-1!==this.keysDownward.indexOf(P)?M._localDirection.lc(0,-x,0):-1!==this.keysRotateLeft.indexOf(P)?(M._localDirection.lc(0,0,0),M.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(P)?(M._localDirection.lc(0,0,0),M.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(P)?(M._localDirection.lc(0,0,0),M.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(P)&&(M._localDirection.lc(0,0,0),M.cameraRotation.x+=this._getLocalRotation()),M.DM().useRightHandedSystem&&(M._localDirection.z*=-1),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),w.BZ.TransformNormalToRef(M._localDirection,M._cameraTransformMatrix,M._transformedDirection),M.cameraDirection.addInPlace(M._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const M=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*M}}(0,x.c)([(0,c.H)()],d.prototype,"keysUp",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysUpward",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysDown",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysDownward",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysLeft",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysRight",void 0),(0,x.c)([(0,c.H)()],d.prototype,"rotationSpeed",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysRotateLeft",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysRotateRight",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysRotateUp",void 0),(0,x.c)([(0,c.H)()],d.prototype,"keysRotateDown",void 0),G.b.FreeCameraKeyboardMoveInput=d;var O=P(12184),H=P(12648);class j{constructor(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=M,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new O.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(M){M=K.Tools.BackCompatCameraNoPreventDefault(arguments);const Z=this.camera.getEngine(),P=Z.getInputElement();this._pointerInput||(this._pointerInput=x=>{const c=x.event,w="touch"===c.pointerType;if(!this.touchEnabled&&w)return;if(x.type!==H.c.POINTERMOVE&&-1===this.buttons.indexOf(c.button))return;const v=c.target;if(x.type===H.c.POINTERDOWN){if(w&&-1!==this._activePointerId||!w&&-1!==this._currentActiveButton)return;this._activePointerId=c.pointerId;try{null===v||void 0===v||v.setPointerCapture(c.pointerId)}catch(G){}-1===this._currentActiveButton&&(this._currentActiveButton=c.button),this._previousPosition={x:c.clientX,y:c.clientY},M||(c.preventDefault(),P&&P.focus()),Z.isPointerLock&&this._onMouseMove&&this._onMouseMove(x.event)}else if(x.type===H.c.POINTERUP){if(w&&this._activePointerId!==c.pointerId||!w&&this._currentActiveButton!==c.button)return;try{null===v||void 0===v||v.releasePointerCapture(c.pointerId)}catch(G){}this._currentActiveButton=-1,this._previousPosition=null,M||c.preventDefault(),this._activePointerId=-1}else if(x.type===H.c.POINTERMOVE&&(this._activePointerId===c.pointerId||!w))if(Z.isPointerLock&&this._onMouseMove)this._onMouseMove(x.event);else if(this._previousPosition){const Z=this.camera._calculateHandednessMultiplier(),P=(c.clientX-this._previousPosition.x)*Z,x=c.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=P/this.angularSensibility,this.camera.cameraRotation.x+=x/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:P,offsetY:x}),this._previousPosition={x:c.clientX,y:c.clientY},M||c.preventDefault()}}),this._onMouseMove=P=>{if(!Z.isPointerLock)return;const x=this.camera._calculateHandednessMultiplier(),c=P.movementX*x;this.camera.cameraRotation.y+=c/this.angularSensibility;const w=P.movementY;this.camera.cameraRotation.x+=w/this.angularSensibility,this._previousPosition=null,M||P.preventDefault()},this._observer=this.camera.DM()._inputManager._addCameraPointerObserver(this._pointerInput,H.c.POINTERDOWN|H.c.POINTERUP|H.c.POINTERMOVE),P&&(this._contextMenuBind=M=>this.onContextMenu(M),P.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(M){M.preventDefault()}CH(){if(this._observer){if(this.camera.DM()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,x.c)([(0,c.H)()],j.prototype,"buttons",void 0),(0,x.c)([(0,c.H)()],j.prototype,"angularSensibility",void 0),G.b.FreeCameraMouseInput=j;var B,U=P(12653);class n{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new O.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(M){M=K.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=Z=>{if(Z.type!==H.c.POINTERWHEEL)return;const P=Z.event,x=P.deltaMode===U.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*x*P.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*x*P.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*x*P.deltaZ/this._normalize,P.preventDefault&&(M||P.preventDefault())},this._observer=this.camera.DM()._inputManager._addCameraPointerObserver(this._wheel,H.c.POINTERWHEEL)}CH(){this._observer&&(this.camera.DM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,x.c)([(0,c.H)()],n.prototype,"wheelPrecisionX",void 0),(0,x.c)([(0,c.H)()],n.prototype,"wheelPrecisionY",void 0),(0,x.c)([(0,c.H)()],n.prototype,"wheelPrecisionZ",void 0),function(M){M[M.MoveRelative=0]="MoveRelative",M[M.RotateRelative=1]="RotateRelative",M[M.MoveScene=2]="MoveScene"}(B||(B={}));class L extends n{constructor(){super(...arguments),this._moveRelative=w.BZ.Zero(),this._rotateRelative=w.BZ.Zero(),this._moveScene=w.BZ.Zero(),this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(M){null===M&&this._wheelXAction!==B.MoveRelative||(this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=M)}get wheelXMoveRelative(){return this._wheelXAction!==B.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(M){null===M&&this._wheelYAction!==B.MoveRelative||(this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=M)}get wheelYMoveRelative(){return this._wheelYAction!==B.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(M){null===M&&this._wheelZAction!==B.MoveRelative||(this._wheelZAction=B.MoveRelative,this._wheelZActionCoordinate=M)}get wheelZMoveRelative(){return this._wheelZAction!==B.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(M){null===M&&this._wheelXAction!==B.RotateRelative||(this._wheelXAction=B.RotateRelative,this._wheelXActionCoordinate=M)}get wheelXRotateRelative(){return this._wheelXAction!==B.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(M){null===M&&this._wheelYAction!==B.RotateRelative||(this._wheelYAction=B.RotateRelative,this._wheelYActionCoordinate=M)}get wheelYRotateRelative(){return this._wheelYAction!==B.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(M){null===M&&this._wheelZAction!==B.RotateRelative||(this._wheelZAction=B.RotateRelative,this._wheelZActionCoordinate=M)}get wheelZRotateRelative(){return this._wheelZAction!==B.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(M){null===M&&this._wheelXAction!==B.MoveScene||(this._wheelXAction=B.MoveScene,this._wheelXActionCoordinate=M)}get wheelXMoveScene(){return this._wheelXAction!==B.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(M){null===M&&this._wheelYAction!==B.MoveScene||(this._wheelYAction=B.MoveScene,this._wheelYActionCoordinate=M)}get wheelYMoveScene(){return this._wheelYAction!==B.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(M){null===M&&this._wheelZAction!==B.MoveScene||(this._wheelZAction=B.MoveScene,this._wheelZActionCoordinate=M)}get wheelZMoveScene(){return this._wheelZAction!==B.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Qc(0),this._rotateRelative.Qc(0),this._moveScene.Qc(0),this._updateCamera(),this.camera.DM().useRightHandedSystem&&(this._moveRelative.z*=-1);const M=w.Matrix.Zero();this.camera.getViewMatrix().invertToRef(M);const Z=w.BZ.Zero();w.BZ.TransformNormalToRef(this._moveRelative,M,Z),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(Z),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(M,Z,P){if(0===M)return;if(null===Z||null===P)return;let x=null;switch(Z){case B.MoveRelative:x=this._moveRelative;break;case B.RotateRelative:x=this._rotateRelative;break;case B.MoveScene:x=this._moveScene}switch(P){case 0:x.set(M,0,0);break;case 1:x.set(0,M,0);break;case 2:x.set(0,0,M)}}}(0,x.c)([(0,c.H)()],L.prototype,"wheelXMoveRelative",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelYMoveRelative",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelZMoveRelative",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelXRotateRelative",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelYRotateRelative",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelZRotateRelative",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelXMoveScene",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelYMoveScene",null),(0,x.c)([(0,c.H)()],L.prototype,"wheelZMoveScene",null),G.b.FreeCameraMouseWheelInput=L;class u{constructor(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=M,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=K.Tools.IsSafari()}attachControl(M){M=K.Tools.BackCompatCameraNoPreventDefault(arguments);let Z=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=P=>{const x=P.event,c="mouse"===x.pointerType||this._isSafari&&"undefined"===typeof x.pointerType;if(this.allowMouse||!c)if(P.type===H.c.POINTERDOWN){if(M||x.preventDefault(),this._pointerPressed.push(x.pointerId),1!==this._pointerPressed.length)return;Z={x:x.clientX,y:x.clientY}}else if(P.type===H.c.POINTERUP){M||x.preventDefault();const P=this._pointerPressed.indexOf(x.pointerId);if(-1===P)return;if(this._pointerPressed.splice(P,1),0!=P)return;Z=null,this._offsetX=null,this._offsetY=null}else if(P.type===H.c.POINTERMOVE){if(M||x.preventDefault(),!Z)return;if(0!=this._pointerPressed.indexOf(x.pointerId))return;this._offsetX=x.clientX-Z.x,this._offsetY=-(x.clientY-Z.y)}}),this._observer=this.camera.DM()._inputManager._addCameraPointerObserver(this._pointerInput,H.c.POINTERDOWN|H.c.POINTERUP|H.c.POINTERMOVE),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.addEventListener("blur",this._onLostFocus)}}CH(){if(this._pointerInput){if(this._observer&&(this.camera.DM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const M=this.camera,Z=M._calculateHandednessMultiplier();M.cameraRotation.y=Z*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)M.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const Z=M._computeLocalCameraSpeed(),P=new w.BZ(0,0,0!==this.touchMoveSensibility?Z*this._offsetY/this.touchMoveSensibility:0);w.Matrix.RotationYawPitchRollToRef(M.rotation.y,M.rotation.x,0,M._cameraRotationMatrix),M.cameraDirection.addInPlace(w.BZ.TransformCoordinates(P,M._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,x.c)([(0,c.H)()],u.prototype,"touchAngularSensibility",void 0),(0,x.c)([(0,c.H)()],u.prototype,"touchMoveSensibility",void 0),G.b.FreeCameraTouchInput=u;class N extends G.c{constructor(M){super(M),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new d),this}addMouse(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new j(M),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new L,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new u),this}clear(){super.clear(),this._mouseInput=null}}var J=P(12317),t=P(12260);class F extends v.b{get angularSensibility(){const M=this.inputs.attached.mouse;return M?M.angularSensibility:0}set angularSensibility(M){const Z=this.inputs.attached.mouse;Z&&(Z.angularSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUp=M)}get keysUpward(){const M=this.inputs.attached.keyboard;return M?M.keysUpward:[]}set keysUpward(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUpward=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDown=M)}get keysDownward(){const M=this.inputs.attached.keyboard;return M?M.keysDownward:[]}set keysDownward(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDownward=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRight=M)}get keysRotateLeft(){const M=this.inputs.attached.keyboard;return M?M.keysRotateLeft:[]}set keysRotateLeft(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateLeft=M)}get keysRotateRight(){const M=this.inputs.attached.keyboard;return M?M.keysRotateRight:[]}set keysRotateRight(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateRight=M)}get keysRotateUp(){const M=this.inputs.attached.keyboard;return M?M.keysRotateUp:[]}set keysRotateUp(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateUp=M)}get keysRotateDown(){const M=this.inputs.attached.keyboard;return M?M.keysRotateDown:[]}set keysRotateDown(M){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateDown=M)}constructor(M,Z,P){var x;super(M,Z,P,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),x=this,this.ellipsoid=new w.BZ(.5,1,.5),this.ellipsoidOffset=new w.BZ(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=w.BZ.Zero(),this._diffPosition=w.BZ.Zero(),this._newPosition=w.BZ.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x._newPosition.v(Z),x._newPosition.subtractToRef(x._oldPosition,x._diffPosition),x._diffPosition.length()>t.e.CollisionsEpsilon&&(x.position.addToRef(x._diffPosition,x._deferredPositionUpdate),x._deferOnly?x._deferredUpdated=!0:x.position.v(x._deferredPositionUpdate),x.OB&&P&&x.OB(P))},this.inputs=new N(this),this.inputs.addKeyboard().addMouse()}attachControl(M,Z){Z=K.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(Z)}CH(){this.inputs.detachElement(),this.cameraDirection=new w.BZ(0,0,0),this.cameraRotation=new w.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(M){this._collisionMask=isNaN(M)?-1:M}_collideWithWorld(M){let Z;Z=this.parent?w.BZ.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,Z.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const P=this.DM().collisionCoordinator;this._collider||(this._collider=P.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let x=M;this.applyGravity&&(x=M.add(this.DM().gravity)),P.getNewPosition(this._oldPosition,x,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=w.BZ.Zero(),this._transformedDirection=w.BZ.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(M){this._needMoveForGravity=M}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.DM().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"qc"}}(0,x.c)([(0,c.E)()],F.prototype,"ellipsoid",void 0),(0,x.c)([(0,c.E)()],F.prototype,"ellipsoidOffset",void 0),(0,x.c)([(0,c.H)()],F.prototype,"checkCollisions",void 0),(0,x.c)([(0,c.H)()],F.prototype,"applyGravity",void 0),(0,J.g)("BABYLON.FreeCamera",F)},14615:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>w});var x=P(12457),c=P(14620);class w{constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=P,this.SO=[],this._maxBlockCapacity=Z||64,this._selectionContent=new x.d(1024),this._creationFunc=M}update(M,Z,P){c.e._CreateBlocks(M,Z,P,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}PO(M){for(let Z=0;Z<this.UO.length;Z++){this.UO[Z].addEntry(M)}}ZO(M){for(let Z=0;Z<this.UO.length;Z++){this.UO[Z].removeEntry(M)}}select(M,Z){this._selectionContent.reset();for(let P=0;P<this.UO.length;P++){this.UO[P].select(M,this._selectionContent,Z)}return Z?this._selectionContent.concat(this.SO):this._selectionContent.concatWithNoDuplicate(this.SO),this._selectionContent}intersects(M,Z,P){this._selectionContent.reset();for(let x=0;x<this.UO.length;x++){this.UO[x].intersects(M,Z,this._selectionContent,P)}return P?this._selectionContent.concat(this.SO):this._selectionContent.concatWithNoDuplicate(this.SO),this._selectionContent}intersectsRay(M){this._selectionContent.reset();for(let Z=0;Z<this.UO.length;Z++){this.UO[Z].intersectsRay(M,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.SO),this._selectionContent}}w.CreationFuncForMeshes=(M,Z)=>{const P=M.getBoundingInfo();!M.isBlocked&&P.boundingBox.intersectsMinMax(Z.ZH,Z.PH)&&Z.entries.push(M)},w.CreationFuncForSubMeshes=(M,Z)=>{M.getBoundingInfo().boundingBox.intersectsMinMax(Z.ZH,Z.PH)&&Z.entries.push(M)}},14620:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>w});var x=P(12373),c=P(12710);class w{constructor(M,Z,P,x,c,w){this.entries=[],this.xH=new Array,this._capacity=P,this._depth=x,this._maxDepth=c,this._creationFunc=w,this._minPoint=M,this._maxPoint=Z,this.xH.push(M.clone()),this.xH.push(Z.clone()),this.xH.push(M.clone()),this.xH[2].x=Z.x,this.xH.push(M.clone()),this.xH[3].y=Z.y,this.xH.push(M.clone()),this.xH[4].z=Z.z,this.xH.push(Z.clone()),this.xH[5].z=M.z,this.xH.push(Z.clone()),this.xH[6].x=M.x,this.xH.push(Z.clone()),this.xH[7].y=M.y}get tZ(){return this._capacity}get ZH(){return this._minPoint}get PH(){return this._maxPoint}addEntry(M){if(this.UO)for(let Z=0;Z<this.UO.length;Z++){this.UO[Z].addEntry(M)}else this._creationFunc(M,this),this.entries.length>this.tZ&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(M){if(this.UO){for(let Z=0;Z<this.UO.length;Z++){this.UO[Z].removeEntry(M)}return}const Z=this.entries.indexOf(M);Z>-1&&this.entries.splice(Z,1)}addEntries(M){for(let Z=0;Z<M.length;Z++){const P=M[Z];this.addEntry(P)}}select(M,Z,P){if(c.e.IsInFrustum(this.xH,M)){if(this.UO){for(let x=0;x<this.UO.length;x++){this.UO[x].select(M,Z,P)}return}P?Z.concat(this.entries):Z.concatWithNoDuplicate(this.entries)}}intersects(M,Z,P,x){if(c.e.IntersectsSphere(this._minPoint,this._maxPoint,M,Z)){if(this.UO){for(let c=0;c<this.UO.length;c++){this.UO[c].intersects(M,Z,P,x)}return}x?P.concat(this.entries):P.concatWithNoDuplicate(this.entries)}}intersectsRay(M,Z){if(M.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.UO){for(let P=0;P<this.UO.length;P++){this.UO[P].intersectsRay(M,Z)}return}Z.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){w._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(M,Z,P,c,v,G,mM,K){mM.UO=new Array;const d=new x.BZ((Z.x-M.x)/2,(Z.y-M.y)/2,(Z.z-M.z)/2);for(let x=0;x<2;x++)for(let Z=0;Z<2;Z++)for(let O=0;O<2;O++){const H=M.add(d.multiplyByFloats(x,Z,O)),j=M.add(d.multiplyByFloats(x+1,Z+1,O+1)),B=new w(H,j,c,v+1,G,K);B.addEntries(P),mM.UO.push(B)}}}},14622:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>d});var x=P(12596),c=P(12373),w=P(12800),v=P(13754),G=P(12639),mM=P(14615),K=P(12225);x.e.prototype.createOrUpdateSelectionOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,P=this._getComponent(G.d.NAME_OCTREE);P||(P=new d(this),this.xc(P)),this.TO||(this.TO=new mM.e(mM.e.CreationFuncForMeshes,M,Z));const x=this.getWorldExtends();return this.TO.update(x.min,x.max,this.meshes),this.TO},Object.defineProperty(x.e.prototype,"selectionOctree",{get:function(){return this.TO},enumerable:!0,configurable:!0}),w.b.prototype.createOrUpdateSubmeshesOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const P=this.DM();let x=P._getComponent(G.d.NAME_OCTREE);x||(x=new d(P),P.xc(x)),this._submeshesOctree||(this._submeshesOctree=new mM.e(mM.e.CreationFuncForSubMeshes,M,Z)),this.Jc(!0);const c=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(c.minimumWorld,c.maximumWorld,this.Uc),this._submeshesOctree};class d{constructor(M){this.name=G.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new v.d(c.BZ.Zero(),new c.BZ(1,1,1)),(M=M||K.b.LastCreatedScene)&&(this.nZ=M,this.nZ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.nZ.getActiveSubMeshCandidates=M=>this.getActiveSubMeshCandidates(M),this.nZ.getCollidingSubMeshCandidates=(M,Z)=>this.getCollidingSubMeshCandidates(M,Z),this.nZ.getIntersectingSubMeshCandidates=(M,Z)=>this.getIntersectingSubMeshCandidates(M,Z))}register(){this.nZ.onMeshRemovedObservable.add((M=>{const Z=this.nZ.selectionOctree;if(void 0!==Z&&null!==Z){const P=Z.SO.indexOf(M);-1!==P&&Z.SO.splice(P,1)}})),this.nZ.onMeshImportedObservable.add((M=>{const Z=this.nZ.selectionOctree;void 0!==Z&&null!==Z&&Z.PO(M)}))}getActiveMeshCandidates(){var M;return(null===(M=this.nZ.TO)||void 0===M?void 0:M.select(this.nZ.frustumPlanes))||this.nZ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(M){if(M._submeshesOctree&&M.useOctreeForRenderingSelection){return M._submeshesOctree.select(this.nZ.frustumPlanes)}return this.nZ._getDefaultSubMeshCandidates(M)}getIntersectingSubMeshCandidates(M,Z){if(M._submeshesOctree&&M.useOctreeForPicking){v.d.TransformToRef(Z,M.getWorldMatrix(),this._tempRay);return M._submeshesOctree.intersectsRay(this._tempRay)}return this.nZ._getDefaultSubMeshCandidates(M)}getCollidingSubMeshCandidates(M,Z){if(M._submeshesOctree&&M.useOctreeForCollisions){const P=Z._velocityWorldLength+Math.max(Z._radius.x,Z._radius.y,Z._radius.z);return M._submeshesOctree.intersects(Z._basePointWorld,P)}return this.nZ._getDefaultSubMeshCandidates(M)}rebuild(){}dispose(){}}},13754:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>j});var x=P(12596),c=P(12828),w=P(12377),v=P(12373),G=P(12379),mM=P(12698),K=P(12630),d=P(12225),O=P(12657);const H={internalPickerForMesh:void 0};class j{constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.c;this.origin=M,this.direction=Z,this.length=P,this.epsilon=x}clone(){return new j(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const x=j._TmpVector3[0].lc(M.x-P,M.y-P,M.z-P),c=j._TmpVector3[1].lc(Z.x+P,Z.y+P,Z.z+P);let w,v,G,mM,K=0,d=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<x.x||this.origin.x>c.x)return!1}else if(w=1/this.direction.x,v=(x.x-this.origin.x)*w,G=(c.x-this.origin.x)*w,G===-1/0&&(G=1/0),v>G&&(mM=v,v=G,G=mM),K=Math.max(v,K),d=Math.min(G,d),K>d)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<x.y||this.origin.y>c.y)return!1}else if(w=1/this.direction.y,v=(x.y-this.origin.y)*w,G=(c.y-this.origin.y)*w,G===-1/0&&(G=1/0),v>G&&(mM=v,v=G,G=mM),K=Math.max(v,K),d=Math.min(G,d),K>d)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<x.z||this.origin.z>c.z)return!1}else if(w=1/this.direction.z,v=(x.z-this.origin.z)*w,G=(c.z-this.origin.z)*w,G===-1/0&&(G=1/0),v>G&&(mM=v,v=G,G=mM),K=Math.max(v,K),d=Math.min(G,d),K>d)return!1;return!0}intersectsBox(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(M.minimum,M.maximum,Z)}intersectsSphere(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=M.center.x-this.origin.x,x=M.center.y-this.origin.y,c=M.center.z-this.origin.z,w=P*P+x*x+c*c,v=M.radius+Z,G=v*v;if(w<=G)return!0;const mM=P*this.direction.x+x*this.direction.y+c*this.direction.z;if(mM<0)return!1;return w-mM*mM<=G}intersectsTriangle(M,Z,P){const x=j._TmpVector3[0],c=j._TmpVector3[1],w=j._TmpVector3[2],G=j._TmpVector3[3],K=j._TmpVector3[4];Z.subtractToRef(M,x),P.subtractToRef(M,c),v.BZ.CrossToRef(this.direction,c,w);const d=v.BZ.Dot(x,w);if(0===d)return null;const O=1/d;this.origin.subtractToRef(M,G);const H=v.BZ.Dot(G,w)*O;if(H<-this.epsilon||H>1+this.epsilon)return null;v.BZ.CrossToRef(G,x,K);const B=v.BZ.Dot(this.direction,K)*O;if(B<-this.epsilon||H+B>1+this.epsilon)return null;const U=v.BZ.Dot(c,K)*O;return U>this.length?null:new mM.d(1-H-B,H,U)}intersectsPlane(M){let Z;const P=v.BZ.Dot(M.normal,this.direction);if(Math.abs(P)<9.99999997475243e-7)return null;{const x=v.BZ.Dot(M.normal,this.origin);return Z=(-M.d-x)/P,Z<0?Z<-9.99999997475243e-7?null:0:Z}}intersectsAxis(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(M){case"y":{const M=(this.origin.y-Z)/this.direction.y;return M>0?null:new v.BZ(this.origin.x+this.direction.x*-M,Z,this.origin.z+this.direction.z*-M)}case"x":{const M=(this.origin.x-Z)/this.direction.x;return M>0?null:new v.BZ(Z,this.origin.y+this.direction.y*-M,this.origin.z+this.direction.z*-M)}case"z":{const M=(this.origin.z-Z)/this.direction.z;return M>0?null:new v.BZ(this.origin.x+this.direction.x*-M,this.origin.y+this.direction.y*-M,Z)}default:return null}}intersectsMesh(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=v.TmpVectors.Matrix[0];return M.getWorldMatrix().invertToRef(G),this._tmpRay?j.TransformToRef(this,G,this._tmpRay):this._tmpRay=j.Transform(this,G),M.intersects(this._tmpRay,Z,P,x,c,w)}intersectsMeshes(M,Z,P){P?P.length=0:P=[];for(let x=0;x<M.length;x++){const c=this.intersectsMesh(M[x],Z);c.hit&&P.push(c)}return P.sort(this._comparePickingInfo),P}_comparePickingInfo(M,Z){return M.distance<Z.distance?-1:M.distance>Z.distance?1:0}intersectionSegment(M,Z,P){const x=this.origin,c=v.TmpVectors.BZ[0],w=v.TmpVectors.BZ[1],G=v.TmpVectors.BZ[2],mM=v.TmpVectors.BZ[3];Z.subtractToRef(M,c),this.direction.scaleToRef(j._Rayl,G),x.addToRef(G,w),M.subtractToRef(x,mM);const K=v.BZ.Dot(c,c),d=v.BZ.Dot(c,G),O=v.BZ.Dot(G,G),H=v.BZ.Dot(c,mM),B=v.BZ.Dot(G,mM),U=K*O-d*d;let n,L,u=U,N=U;U<j._Smallnum?(n=0,u=1,L=B,N=O):(n=d*B-O*H,L=K*B-d*H,n<0?(n=0,L=B,N=O):n>u&&(n=u,L=B+d,N=O)),L<0?(L=0,-H<0?n=0:-H>K?n=u:(n=-H,u=K)):L>N&&(L=N,-H+d<0?n=0:-H+d>K?n=u:(n=-H+d,u=K));const J=Math.abs(n)<j._Smallnum?0:n/u,t=Math.abs(L)<j._Smallnum?0:L/N,F=v.TmpVectors.BZ[4];G.scaleToRef(t,F);const D=v.TmpVectors.BZ[5];c.scaleToRef(J,D),D.addInPlace(mM);const l=v.TmpVectors.BZ[6];D.subtractToRef(F,l);return t>0&&t<=this.length&&l.lengthSquared()<P*P?D.length():-1}update(M,Z,P,x,c,w,G){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){j._RayDistant||(j._RayDistant=j.Zero()),j._RayDistant.unprojectRayToRef(M,Z,P,x,v.Matrix.IdentityReadOnly,w,G);const mM=v.TmpVectors.Matrix[0];c.invertToRef(mM),j.TransformToRef(j._RayDistant,mM,this)}else this.unprojectRayToRef(M,Z,P,x,c,w,G);return this}static Zero(){return new j(v.BZ.Zero(),v.BZ.Zero())}static CreateNew(M,Z,P,x,c,w,v){return j.Zero().update(M,Z,P,x,c,w,v)}static CreateNewFromTo(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.Matrix.IdentityReadOnly;const x=new j(new v.BZ(0,0,0),new v.BZ(0,0,0));return j.CreateFromToToRef(M,Z,x,P)}static CreateFromToToRef(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.Matrix.IdentityReadOnly;P.origin.v(M);const c=Z.subtractToRef(M,P.direction),w=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);return P.length=w,P.direction.normalize(),j.TransformToRef(P,x,P)}static Transform(M,Z){const P=new j(new v.BZ(0,0,0),new v.BZ(0,0,0));return j.TransformToRef(M,Z,P),P}static TransformToRef(M,Z,P){v.BZ.TransformCoordinatesToRef(M.origin,Z,P.origin),v.BZ.TransformNormalToRef(M.direction,Z,P.direction),P.length=M.length,P.epsilon=M.epsilon;const x=P.direction,c=x.length();if(0!==c&&1!==c){const M=1/c;x.x*=M,x.y*=M,x.z*=M,P.length*=c}return P}unprojectRayToRef(M,Z,P,x,c,w,G){const mM=v.TmpVectors.Matrix[0];c.multiplyToRef(w,mM),mM.multiplyToRef(G,mM),mM.invert();const K=d.b.LastCreatedEngine,O=v.TmpVectors.BZ[0];O.x=M/P*2-1,O.y=-(Z/x*2-1),O.z=null!==K&&void 0!==K&&K.cc?1:null!==K&&void 0!==K&&K.isNDCHalfZRange?0:-1;const H=v.TmpVectors.BZ[1].lc(O.x,O.y,1-1e-8),j=v.TmpVectors.BZ[2],B=v.TmpVectors.BZ[3];v.BZ._UnprojectFromInvertedMatrixToRef(O,mM,j),v.BZ._UnprojectFromInvertedMatrixToRef(H,mM,B),this.origin.v(j),B.subtractToRef(j,this.direction),this.direction.normalize()}}function B(M,Z,P,x,c){let w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const v=j.Zero();return U(M,Z,P,x,v,c,w),v}function U(M,Z,P,x,c,w){let G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],mM=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const K=M.getEngine();if(!w&&!(w=M.activeCamera))return M;const d=w.viewport,O=K.getRenderHeight(),{x:H,y:j,width:B,height:U}=d.toGlobal(K.getRenderWidth(),O),n=1/K.getHardwareScalingLevel();return Z=Z*n-H,P=P*n-(O-j-U),c.update(Z,P,B,U,x||v.Matrix.IdentityReadOnly,G?v.Matrix.IdentityReadOnly:w.getViewMatrix(),w.getProjectionMatrix(),mM),M}function n(M,Z,P,x,c){if(!K.e)return M;const w=M.getEngine();if(!c&&!(c=M.activeCamera))throw new Error("Active camera not set");const G=c.viewport,mM=w.getRenderHeight(),{x:d,y:O,width:H,height:j}=G.toGlobal(w.getRenderWidth(),mM),B=v.Matrix.Identity(),U=1/w.getHardwareScalingLevel();return Z=Z*U-d,P=P*U-(mM-O-j),x.update(Z,P,H,j,B,B,c.getProjectionMatrix()),M}function L(M,Z,P,x,c,w,v,G){const mM=Z(x,P.enableDistantPicking),K=P.intersects(mM,c,v,w,x,G);return K&&K.hit?!c&&null!=M&&K.distance>=M.distance?null:K:null}function u(M,Z,P,x,c,w){let G=null;const mM=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),d=M.cameraToUseForPointers||M.activeCamera,O=H.internalPickerForMesh||L;for(let K=0;K<M.meshes.length;K++){const H=M.meshes[K];if(P){if(!P(H,-1))continue}else if(!H.isEnabled()||!H.isVisible||!H.jK)continue;const j=mM&&H.isWorldMatrixCameraDependent(),B=H.Jc(j,d);if(H.hasThinInstances&&H.TK){const M=O(G,Z,H,B,!0,!0,w);if(M){if(c)return M;const mM=v.TmpVectors.Matrix[1],K=H.thinInstanceGetWorldMatrices();for(let M=0;M<K.length;M++){if(P&&!P(H,M))continue;K[M].multiplyToRef(B,mM);const v=O(G,Z,H,mM,x,c,w,!0);if(v&&(G=v,G.thinInstanceIndex=M,x))return G}}}else{const M=O(G,Z,H,B,x,c,w);if(M&&(G=M,x))return G}}return G||new K.e}function N(M,Z,P,x){if(!K.e)return null;const c=[],w=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),G=M.cameraToUseForPointers||M.activeCamera,mM=H.internalPickerForMesh||L;for(let K=0;K<M.meshes.length;K++){const d=M.meshes[K];if(P){if(!P(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.jK)continue;const O=w&&d.isWorldMatrixCameraDependent(),H=d.Jc(O,G);if(d.hasThinInstances&&d.TK){if(mM(null,Z,d,H,!0,!0,x)){const M=v.TmpVectors.Matrix[1],w=d.thinInstanceGetWorldMatrices();for(let v=0;v<w.length;v++){if(P&&!P(d,v))continue;w[v].multiplyToRef(H,M);const G=mM(null,Z,d,M,!1,!1,x,!0);G&&(G.thinInstanceIndex=v,c.push(G))}}}else{const M=mM(null,Z,d,H,!1,!1,x);M&&c.push(M)}}return c}function J(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,x=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;x||(x=M.getWorldMatrix()),Z.length=P,c?Z.origin.v(c):Z.origin.v(M.position);const w=v.TmpVectors.BZ[2];w.set(0,0,M._scene.useRightHandedSystem?-1:1);const G=v.TmpVectors.BZ[3];return v.BZ.TransformNormalToRef(w,x,G),v.BZ.NormalizeToRef(G,Z.direction),Z}var t,F;j._TmpVector3=(0,G.c)(6,v.BZ.Zero),j._RayDistant=j.Zero(),j._Smallnum=1e-8,j._Rayl=1e9,t=x.e,(F=c.e)&&(F.prototype.getForwardRay=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,Z=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;return J(this,new j(v.BZ.Zero(),v.BZ.Zero(),M),M,Z,P)},F.prototype.getForwardRayToRef=function(M){return J(this,M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),t&&(O.d._IsPickingAvailable=!0,t.prototype.createPickingRay=function(M,Z,P,x){return B(this,M,Z,P,x,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),x.e.prototype.createPickingRayToRef=function(M,Z,P,x,c){return U(this,M,Z,P,x,c,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},x.e.prototype.createPickingRayInCameraSpace=function(M,Z,P){return function(M,Z,P,x){const c=j.Zero();return n(M,Z,P,c,x),c}(this,M,Z,P)},x.e.prototype.createPickingRayInCameraSpaceToRef=function(M,Z,P,x){return n(this,M,Z,P,x)},x.e.prototype.pickWithBoundingInfo=function(M,Z,P,x,c){return function(M,Z,P,x,c,w){if(!K.e)return null;const G=u(M,(x=>(M._tempPickingRay||(M._tempPickingRay=j.Zero()),U(M,Z,P,x,M._tempPickingRay,w||null),M._tempPickingRay)),x,c,!0);return G&&(G.ray=B(M,Z,P,v.Matrix.Identity(),w||null)),G}(this,M,Z,P,x,c)},x.e.prototype.HP=function(M,Z,P,x,c,w){return function(M,Z,P,x,c,w,G){const mM=u(M,((x,c)=>(M._tempPickingRay||(M._tempPickingRay=j.Zero()),U(M,Z,P,x,M._tempPickingRay,w||null,!1,c),M._tempPickingRay)),x,c,!1,G);return mM&&(mM.ray=B(M,Z,P,v.Matrix.Identity(),w||null)),mM}(this,M,Z,P,x,c,w)},x.e.prototype.pickWithRay=function(M,Z,P,x){return function(M,Z,P,x,c){const w=u(M,(P=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=v.Matrix.Identity()),P.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=j.Zero()),j.TransformToRef(Z,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),P,x,!1,c);return w&&(w.ray=Z),w}(this,M,Z,P,x)},x.e.prototype.multiPick=function(M,Z,P,x,c){return function(M,Z,P,x,c,w){return N(M,(x=>B(M,Z,P,x,c||null)),x,w)}(this,M,Z,P,x,c)},x.e.prototype.multiPickWithRay=function(M,Z,P){return function(M,Z,P,x){return N(M,(P=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=v.Matrix.Identity()),P.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=j.Zero()),j.TransformToRef(Z,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),P,x)}(this,M,Z,P)}},14038:(M,Z,P)=>{"use strict";var x=P(12291),c=P(12199),w=P(12230),v=P(12325),G=P(12260),mM=P(12304);G.e.prototype._partialLoadFile=function(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(M,(M=>{P[Z]=M,P._internalCount++,6===P._internalCount&&x(P)}),void 0,void 0,!0,((M,Z)=>{c&&M&&c(M.status+" "+M.statusText,Z)}))},G.e.prototype._cascadeLoadFiles=function(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const c=[];c._internalCount=0;for(let w=0;w<6;w++)this._partialLoadFile(P[w],w,c,Z,x)},G.e.prototype._cascadeLoadImgs=function(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5?arguments[5]:void 0;const v=[];v._internalCount=0;for(let G=0;G<6;G++)this._partialLoadImg(x[G],G,v,M,Z,P,c,w)},G.e.prototype._partialLoadImg=function(M,Z,P,x,c,G){let mM=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7?arguments[7]:void 0;const d=(0,v.c)();(0,w.p)(M,(M=>{P[Z]=M,P._internalCount++,x&&x.removePendingData(d),6===P._internalCount&&G&&G(c,P)}),((M,Z)=>{x&&x.removePendingData(d),mM&&mM(M,Z)}),x?x.offlineProvider:null,K),x&&x.addPendingData(d)},G.e.prototype.createCubeTextureBase=function(M,Z,P,w){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,U=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,n=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,L=arguments.length>14&&void 0!==arguments[14]&&arguments[14],u=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const N=B||new x.d(this,7);N.isCube=!0,N.url=M,N.generateMipMaps=!w,N._lodGenerationScale=H,N._lodGenerationOffset=j,N._useSRGBBuffer=!!L&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!w),N!==B&&(N.label=M.substring(0,60)),this._doNotHandleContextLost||(N._extension=d,N._files=P,N._buffer=u);const J=M;this._transformTextureUrl&&!B&&(M=this._transformTextureUrl(M));const t=d??function(M){const Z=M.split("?")[0],P=Z.lastIndexOf(".");return P>-1?Z.substring(P).toLowerCase():""}(M),F=(0,mM.b)(t),D=(M,Z)=>{N.dispose(),G?G(M,Z):M&&c.d.Warn(M)},l=(x,G)=>{M===J?x&&D(x.status+" "+x.statusText,G):(c.d.Warn(`Failed to load ${M}, falling back to the ${J}`),this.createCubeTextureBase(J,Z,P,!!w,v,D,K,d,O,H,j,N,U,n,L,u))};if(F)F.then((x=>{const c=M=>{U&&U(N,M),x.loadCubeData(M,N,O,v,((M,Z)=>{D(M,Z)}))};u?c(u):P&&6===P.length?x.supportCascades?this._cascadeLoadFiles(Z,(M=>c(M.map((M=>new Uint8Array(M))))),P,D):D("Textures type does not support cascades."):this._loadFile(M,(M=>c(new Uint8Array(M))),void 0,void 0,!0,l)}));else{if(!P||0===P.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(Z,N,((M,Z)=>{n&&n(M,Z)}),P,D)}return this._internalTexturesCache.push(N),N}},14625:(M,Z,P)=>{"use strict";P(12199);var x=P(12482);P(12291),P(12439),P(12282),P(12544),P(12497);x.d},14067:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>c});var x=P(12317);class c{constructor(M){this.value=this._toInt(M)}_toInt(M){return 0|M}add(M){return new c(this.value+M.value)}UZ(M){return new c(this.value-M.value)}multiply(M){return new c(Math.imul(this.value,M.value))}divide(M){return new c(this.value/M.value)}getClassName(){return c.ClassName}equals(M){return this.value===M.value}static FromValue(M){return new c(M)}toString(){return this.value.toString()}}c.ClassName="FlowGraphInteger",(0,x.g)("FlowGraphInteger",c)},14078:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>c,h:()=>w});var x=P(12373);class c{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.dc=M}get m(){return this.dc}transformVector(M){return this.transformVectorToRef(M,new x.Vector2)}transformVectorToRef(M,Z){return Z.x=M.x*this.dc[0]+M.y*this.dc[1],Z.y=M.x*this.dc[2]+M.y*this.dc[3],Z}nc(){return this.toArray()}toArray(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let Z=0;Z<4;Z++)M[Z]=this.dc[Z];return M}jP(M){for(let Z=0;Z<4;Z++)this.dc[Z]=M[Z];return this}multiplyToRef(M,Z){const P=M.dc,x=this.dc,c=Z.dc;return c[0]=P[0]*x[0]+P[1]*x[2],c[1]=P[0]*x[1]+P[1]*x[3],c[2]=P[2]*x[0]+P[3]*x[2],c[3]=P[2]*x[1]+P[3]*x[3],Z}multiply(M){return this.multiplyToRef(M,new c)}divideToRef(M,Z){const P=this.dc,x=M.dc,c=Z.dc;return c[0]=P[0]/x[0],c[1]=P[1]/x[1],c[2]=P[2]/x[2],c[3]=P[3]/x[3],Z}divide(M){return this.divideToRef(M,new c)}addToRef(M,Z){const P=this.dc,x=M.m,c=Z.m;return c[0]=P[0]+x[0],c[1]=P[1]+x[1],c[2]=P[2]+x[2],c[3]=P[3]+x[3],Z}add(M){return this.addToRef(M,new c)}subtractToRef(M,Z){const P=this.dc,x=M.m,c=Z.m;return c[0]=P[0]-x[0],c[1]=P[1]-x[1],c[2]=P[2]-x[2],c[3]=P[3]-x[3],Z}UZ(M){return this.subtractToRef(M,new c)}transpose(){const M=this.dc;return new c([M[0],M[2],M[1],M[3]])}determinant(){const M=this.dc;return M[0]*M[3]-M[1]*M[2]}inverse(){const M=this.determinant();if(0===M)throw new Error("Matrix is not invertible");const Z=this.dc,P=1/M;return new c([Z[3]*P,-Z[1]*P,-Z[2]*P,Z[0]*P])}equals(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.dc,x=M.m;return 0===Z?P[0]===x[0]&&P[1]===x[1]&&P[2]===x[2]&&P[3]===x[3]:Math.abs(P[0]-x[0])<Z&&Math.abs(P[1]-x[1])<Z&&Math.abs(P[2]-x[2])<Z&&Math.abs(P[3]-x[3])<Z}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.dc.join(", ")})`}}class w{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.dc=M}get m(){return this.dc}transformVector(M){return this.transformVectorToRef(M,new x.BZ)}transformVectorToRef(M,Z){const P=this.dc;return Z.x=M.x*P[0]+M.y*P[1]+M.z*P[2],Z.y=M.x*P[3]+M.y*P[4]+M.z*P[5],Z.z=M.x*P[6]+M.y*P[7]+M.z*P[8],Z}multiplyToRef(M,Z){const P=M.dc,x=this.dc,c=Z.m;return c[0]=P[0]*x[0]+P[1]*x[3]+P[2]*x[6],c[1]=P[0]*x[1]+P[1]*x[4]+P[2]*x[7],c[2]=P[0]*x[2]+P[1]*x[5]+P[2]*x[8],c[3]=P[3]*x[0]+P[4]*x[3]+P[5]*x[6],c[4]=P[3]*x[1]+P[4]*x[4]+P[5]*x[7],c[5]=P[3]*x[2]+P[4]*x[5]+P[5]*x[8],c[6]=P[6]*x[0]+P[7]*x[3]+P[8]*x[6],c[7]=P[6]*x[1]+P[7]*x[4]+P[8]*x[7],c[8]=P[6]*x[2]+P[7]*x[5]+P[8]*x[8],Z}multiply(M){return this.multiplyToRef(M,new w)}divideToRef(M,Z){const P=this.dc,x=M.m,c=Z.m;return c[0]=P[0]/x[0],c[1]=P[1]/x[1],c[2]=P[2]/x[2],c[3]=P[3]/x[3],c[4]=P[4]/x[4],c[5]=P[5]/x[5],c[6]=P[6]/x[6],c[7]=P[7]/x[7],c[8]=P[8]/x[8],Z}divide(M){return this.divideToRef(M,new w)}addToRef(M,Z){const P=this.dc,x=M.m,c=Z.m;return c[0]=P[0]+x[0],c[1]=P[1]+x[1],c[2]=P[2]+x[2],c[3]=P[3]+x[3],c[4]=P[4]+x[4],c[5]=P[5]+x[5],c[6]=P[6]+x[6],c[7]=P[7]+x[7],c[8]=P[8]+x[8],Z}add(M){return this.addToRef(M,new w)}subtractToRef(M,Z){const P=this.dc,x=M.m,c=Z.m;return c[0]=P[0]-x[0],c[1]=P[1]-x[1],c[2]=P[2]-x[2],c[3]=P[3]-x[3],c[4]=P[4]-x[4],c[5]=P[5]-x[5],c[6]=P[6]-x[6],c[7]=P[7]-x[7],c[8]=P[8]-x[8],Z}UZ(M){return this.subtractToRef(M,new w)}toArray(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let Z=0;Z<9;Z++)M[Z]=this.dc[Z];return M}nc(){return this.toArray()}jP(M){for(let Z=0;Z<9;Z++)this.dc[Z]=M[Z];return this}transpose(){const M=this.dc;return new w([M[0],M[3],M[6],M[1],M[4],M[7],M[2],M[5],M[8]])}determinant(){const M=this.dc;return M[0]*(M[4]*M[8]-M[5]*M[7])-M[1]*(M[3]*M[8]-M[5]*M[6])+M[2]*(M[3]*M[7]-M[4]*M[6])}inverse(){const M=this.determinant();if(0===M)throw new Error("Matrix is not invertible");const Z=this.dc,P=1/M;return new w([(Z[4]*Z[8]-Z[5]*Z[7])*P,(Z[2]*Z[7]-Z[1]*Z[8])*P,(Z[1]*Z[5]-Z[2]*Z[4])*P,(Z[5]*Z[6]-Z[3]*Z[8])*P,(Z[0]*Z[8]-Z[2]*Z[6])*P,(Z[2]*Z[3]-Z[0]*Z[5])*P,(Z[3]*Z[7]-Z[4]*Z[6])*P,(Z[1]*Z[6]-Z[0]*Z[7])*P,(Z[0]*Z[4]-Z[1]*Z[3])*P])}equals(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.dc,x=M.m;return 0===Z?P[0]===x[0]&&P[1]===x[1]&&P[2]===x[2]&&P[3]===x[3]&&P[4]===x[4]&&P[5]===x[5]&&P[6]===x[6]&&P[7]===x[7]&&P[8]===x[8]:Math.abs(P[0]-x[0])<Z&&Math.abs(P[1]-x[1])<Z&&Math.abs(P[2]-x[2])<Z&&Math.abs(P[3]-x[3])<Z&&Math.abs(P[4]-x[4])<Z&&Math.abs(P[5]-x[5])<Z&&Math.abs(P[6]-x[6])<Z&&Math.abs(P[7]-x[7])<Z&&Math.abs(P[8]-x[8])<Z}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.dc.join(", ")})`}}},14084:(M,Z,P)=>{"use strict";var x;function c(M,Z,P,x){switch(Z){case"Animation":return x?M.animations.find((M=>M.uniqueId===P))??null:M.animations[P]??null;case"AnimationGroup":return x?M.animationGroups.find((M=>M.uniqueId===P))??null:M.animationGroups[P]??null;case"Mesh":return x?M.meshes.find((M=>M.uniqueId===P))??null:M.meshes[P]??null;case"Material":return x?M.materials.find((M=>M.uniqueId===P))??null:M.materials[P]??null;case"OO":return x?M.cameras.find((M=>M.uniqueId===P))??null:M.cameras[P]??null;case"Light":return x?M.lights.find((M=>M.uniqueId===P))??null:M.lights[P]??null;default:return null}}P.d(Z,{e:()=>c}),function(M){M.Animation="Animation",M.AnimationGroup="AnimationGroup",M.Mesh="Mesh",M.Material="Material",M.OO="OO",M.Light="Light"}(x||(x={}))},14115:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>c});var x=P(14117);class c extends x.e{constructor(M,Z){if(super(M),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),Z)for(const P of Z)this._eventsSignalOutputs[P]=this._registerSignalOutput(P+"Event")}_executeOnTick(M){}_startPendingTasks(M){M._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(M),this._resetAfterCanceled(M)),this._preparePendingTasks(M),M._addPendingBlock(this),this.out._activateSignal(M),M._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(M){M._deleteExecutionVariable(this,"_initialized"),M._removePendingBlock(this)}}},14093:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>K});var x=P(12325),c=P(12317),w=P(14102),v=P(12184),G=P(14059);class mM extends w.e{constructor(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x.defaultValue,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(M,Z,P),this.richType=x,this._defaultValue=c,this._optional=w,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new v.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(M){this._isDisabled!==M&&(this._isDisabled=M,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(M,Z){Z._getConnectionValue(this)!==M&&(Z._setConnectionValue(this,M),this.onValueChangedObservable.notifyObservers(M))}resetToDefaultValue(M){M._setConnectionValue(this,this._defaultValue)}connectTo(M){this._isDisabled||super.connectTo(M)}_getValueOrDefault(M){const Z=M._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(Z):Z}getValue(M){if(1===this.connectionType){M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(M);const Z=this._getValueOrDefault(M);return this._lastValue=Z,this.richType.typeTransformer?this.richType.typeTransformer(Z):Z}const Z=this.isConnected()?this._connectedPoint[0].getValue(M):this._getValueOrDefault(M);return this._lastValue=Z,this.richType.typeTransformer?this.richType.typeTransformer(Z):Z}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.richType={},this.richType.serialize(M.richType),M.optional=this._optional,(0,G.g)("defaultValue",this._defaultValue,M)}}(0,c.g)("FlowGraphDataConnection",mM);class K{constructor(M){var Z;this.config=M,this.uniqueId=(0,x.c)(),this.name=(null===(Z=this.config)||void 0===Z?void 0:Z.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(M){}registerDataInput(M,Z,P){const x=new mM(M,0,this,Z,P);return this.dataInputs.push(x),x}registerDataOutput(M,Z,P){const x=new mM(M,1,this,Z,P);return this.dataOutputs.push(x),x}getDataInput(M){return this.dataInputs.find((Z=>Z.name===M))}getDataOutput(M){return this.dataOutputs.find((Z=>Z.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.g;if(M.uniqueId=this.uniqueId,M.config={},this.config){const P=this.config,x=Object.keys(P);for(const c of x)Z(c,P[c],M.config)}M.dataInputs=[],M.dataOutputs=[],M.className=this.getClassName();for(const P of this.dataInputs){const Z={};P.serialize(Z),M.dataInputs.push(Z)}for(const P of this.dataOutputs){const Z={};P.serialize(Z),M.dataOutputs.push(Z)}}deserialize(M){}_log(M,Z,P){var x;null===(x=M.logger)||void 0===x||x.addLogItem({action:Z,BP:P,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14102:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>w});var x,c=P(12325);!function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(x||(x={}));class w{constructor(M,Z,P){this._ownerBlock=P,this._connectedPoint=[],this.uniqueId=(0,c.c)(),this.connectedPointIds=[],this.name=M,this._connectionType=Z}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(M){if(this._connectionType===M._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||M._isSingularConnection()&&M._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(M),M._connectedPoint.push(this)}disconnectFrom(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const P=this._connectedPoint.indexOf(M),x=M._connectedPoint.indexOf(this);-1!==P&&-1!==x&&(Z&&this._connectedPoint.splice(P,1),M._connectedPoint.splice(x,1))}disconnectFromAll(){for(const M of this._connectedPoint)this.disconnectFrom(M,!1);this._connectedPoint.length=0}dispose(){for(const M of this._connectedPoint)this.disconnectFrom(M)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M.uniqueId=this.uniqueId,M.name=this.name,M._connectionType=this._connectionType,M.connectedPointIds=[],M.className=this.getClassName();for(const Z of this._connectedPoint)M.connectedPointIds.push(Z.uniqueId)}getClassName(){return"FGConnection"}deserialize(M){this.uniqueId=M.uniqueId,this.name=M.name,this._connectionType=M._connectionType,this.connectedPointIds=M.connectedPointIds}}},14051:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>N});var x,c=P(12184),w=P(12351),v=P(12359),G=P(12325),mM=P(14059),K=P(14084),d=P(12199);!function(M){M.ExecuteBlock="ExecuteBlock",M.ExecuteEvent="ExecuteEvent",M.TriggerConnection="TriggerConnection",M.ContextVariableSet="ContextVariableSet",M.GlobalVariableSet="GlobalVariableSet",M.GlobalVariableDelete="GlobalVariableDelete",M.GlobalVariableGet="GlobalVariableGet",M.AddConnection="AddConnection",M.GetConnectionValue="GetConnectionValue",M.SetConnectionValue="SetConnectionValue",M.ActivateSignal="ActivateSignal",M.ContextVariableGet="ContextVariableGet"}(x||(x={}));class O{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(M){if(M.time||(M.time=Date.now()),this.log.push(M),this.logToConsole){var Z;const P=null===(Z=M.BP)||void 0===Z?void 0:Z.value;"object"===typeof P&&P.getClassName?d.d.Log(`[FGLog] ${M.className}:${M.uniqueId.split("-")[0]} ${M.action} - ${JSON.stringify(P.getClassName())}: ${P.toString()}`):d.d.Log(`[FGLog] ${M.className}:${M.uniqueId.split("-")[0]} ${M.action} - ${JSON.stringify(M.BP)}`)}}getItemsOfType(M){return this.log.filter((Z=>Z.action===M))}}class H{get enableLogging(){return this._enableLogging}set enableLogging(M){this._enableLogging!==M&&(this._enableLogging=M,this._enableLogging?(this.logger=new O,this.logger.logToConsole=!0):this.logger=null)}constructor(M){this.uniqueId=(0,G.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new c.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=M,this.assetsContext=M.assetsContext??M.nZ}hasVariable(M){return M in this._userVariables}setVariable(M,Z){var P;this._userVariables[M]=Z,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",BP:{name:M,value:Z}})}getAsset(M,Z){return(0,K.e)(this.assetsContext,M,Z)}getVariable(M){var Z;return null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",BP:{name:M,value:this._userVariables[M]}}),this._userVariables[M]}get userVariables(){return this._userVariables}DM(){return this._configuration.nZ}_getUniqueIdPrefixedName(M,Z){return`${M.uniqueId}_${Z}`}_getGlobalContextVariable(M,Z){var P;return null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",BP:{name:M,defaultValue:Z,possibleValue:this._globalContextVariables[M]}}),this._hasGlobalContextVariable(M)?this._globalContextVariables[M]:Z}_setGlobalContextVariable(M,Z){var P;null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",BP:{name:M,value:Z}}),this._globalContextVariables[M]=Z}_deleteGlobalContextVariable(M){var Z;null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",BP:{name:M}}),delete this._globalContextVariables[M]}_hasGlobalContextVariable(M){return M in this._globalContextVariables}_setExecutionVariable(M,Z,P){this._executionVariables[this._getUniqueIdPrefixedName(M,Z)]=P}_getExecutionVariable(M,Z,P){return this._hasExecutionVariable(M,Z)?this._executionVariables[this._getUniqueIdPrefixedName(M,Z)]:P}_deleteExecutionVariable(M,Z){delete this._executionVariables[this._getUniqueIdPrefixedName(M,Z)]}_hasExecutionVariable(M,Z){return this._getUniqueIdPrefixedName(M,Z)in this._executionVariables}_hasConnectionValue(M){return M.uniqueId in this._connectionValues}_setConnectionValue(M,Z){var P;this._connectionValues[M.uniqueId]=Z,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",BP:{connectionPointId:M.uniqueId,value:Z}})}_setConnectionValueByKey(M,Z){this._connectionValues[M]=Z}_getConnectionValue(M){var Z;return null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",BP:{connectionPointId:M.uniqueId,value:this._connectionValues[M.uniqueId]}}),this._connectionValues[M.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(M){this._pendingBlocks.includes(M)||(this._pendingBlocks.push(M),this._pendingBlocks.sort(((M,Z)=>M.priority-Z.priority)))}_removePendingBlock(M){const Z=this._pendingBlocks.indexOf(M);-1!==Z&&this._pendingBlocks.splice(Z,1)}_clearPendingBlocks(){for(const M of this._pendingBlocks)M._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(M){var Z;this.onNodeExecutedObservable.notifyObservers(M),null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:M.getClassName(),uniqueId:M.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(M){this._setGlobalContextVariable("timeSinceStart",M.timeSinceStart),this._setGlobalContextVariable("deltaTime",M.deltaTime);for(const P of this._pendingBlocks){var Z;null===(Z=P._executeOnTick)||void 0===Z||Z.call(P,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mM.g;M.uniqueId=this.uniqueId,M._userVariables={};for(const x in this._userVariables)Z(x,this._userVariables[x],M._userVariables);M._connectionValues={};for(const x in this._connectionValues)Z(x,this._connectionValues[x],M._connectionValues);var P;this.assetsContext!==this.DM()&&(M._assetsContext={meshes:this.assetsContext.meshes.map((M=>M.id)),materials:this.assetsContext.materials.map((M=>M.id)),textures:this.assetsContext.textures.map((M=>M.name)),animations:this.assetsContext.animations.map((M=>M.name)),lights:this.assetsContext.lights.map((M=>M.id)),cameras:this.assetsContext.cameras.map((M=>M.id)),Cj:null===(P=this.assetsContext.Cj)||void 0===P?void 0:P.map((M=>M.name)),skeletons:this.assetsContext.skeletons.map((M=>M.id)),SH:this.assetsContext.SH.map((M=>M.name)),geometries:this.assetsContext.geometries.map((M=>M.id)),multiMaterials:this.assetsContext.multiMaterials.map((M=>M.id)),transformNodes:this.assetsContext.transformNodes.map((M=>M.id))})}getClassName(){return"FlowGraphContext"}}(0,w.c)([(0,v.H)()],H.prototype,"uniqueId",void 0);var j=P(14090),B=P(12648);class U{constructor(M){this.onEventTriggeredObservable=new c.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=M,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Gc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const M=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",BP:{timeSinceStart:this._startingTime,deltaTime:M}}),this._startingTime+=M})),this._meshPickedObserver=this._scene.onPointerObservable.add((M=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",BP:M})}),B.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((M=>{const Z=M.pointerId,P=M.mesh,x=this._pointerUnderMeshState[Z];!x&&P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",BP:{pointerId:Z,mesh:P}}):x&&!P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",BP:{pointerId:Z,mesh:x}}):x&&P&&x!==P&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",BP:{pointerId:Z,mesh:x,over:P}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",BP:{pointerId:Z,mesh:P,out:x}})),this._pointerUnderMeshState[Z]=P}),B.c.POINTERMOVE)}dispose(){var M,Z,P,x,c;null===(M=this._sceneDisposeObserver)||void 0===M||M.remove(),null===(Z=this._sceneReadyObserver)||void 0===Z||Z.remove(),null===(P=this._sceneOnBeforeRenderObserver)||void 0===P||P.remove(),null===(x=this._meshPickedObserver)||void 0===x||x.remove(),null===(c=this._meshUnderPointerObserver)||void 0===c||c.remove(),this.onEventTriggeredObservable.clear()}}var n,L=P(14105);!function(M){M[M.Stopped=0]="Stopped",M[M.Started=1]="Started"}(n||(n={}));class u{get state(){return this._state}set state(M){this._state=M,this.onStateChangedObservable.notifyObservers(M)}constructor(M){this.onStateChangedObservable=new c.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=M.nZ,this._sceneEventCoordinator=new U(this._scene),this._coordinator=M.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((M=>{for(const Z of this._executionContexts){const P=this._getContextualOrder(M.type,Z);for(const x of P)if(!x._executeEvent(Z,M.BP))break}switch(M.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const Z of this._executionContexts)Z._notifyOnTick(M.BP);break;case"SceneDispose":this.dispose()}}))}createContext(){const M=new H({nZ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(M),M}getContext(M){return this._executionContexts[M]}addEventBlock(M){if("PointerOver"!==M.type&&"PointerOut"!==M.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==M.type&&this._eventBlocks[M.type].push(M),1===this.state)for(const Z of this._executionContexts)M._startPendingTasks(Z);else this.onStateChangedObservable.addOnce((Z=>{if(1===Z)for(const P of this._executionContexts)M._startPendingTasks(P)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((M=>{1===M&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const M of this._executionContexts)for(const Z in this._eventBlocks){const P=this._getContextualOrder(Z,M);for(const Z of P)Z._startPendingTasks(M)}}_getContextualOrder(M,Z){const P=this._eventBlocks[M].sort(((M,Z)=>Z.initPriority-M.initPriority));if("MeshPick"===M){const M=[];for(const x of P){const c=x.asset.getValue(Z);let w=0;for(;w<P.length;w++){const M=P[w].asset.getValue(Z);if(c&&M&&(0,L.o)(c,M))break}M.splice(w,0,x)}return M}return P}dispose(){var M;if(0!==this.state){this.state=0;for(const M of this._executionContexts)M._clearPendingBlocks();this._executionContexts.length=0;for(const M in this._eventBlocks)this._eventBlocks[M].length=0;null===(M=this._eventObserver)||void 0===M||M.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(M){const Z=[],P=new Set;for(const x in this._eventBlocks)for(const M of this._eventBlocks[x])Z.push(M),P.add(M.uniqueId);for(;Z.length>0;){const x=Z.pop();M(x);for(const M of x.dataInputs)for(const x of M._connectedPoint)P.has(x._ownerBlock.uniqueId)||(Z.push(x._ownerBlock),P.add(x._ownerBlock.uniqueId));if(x instanceof j.b)for(const M of x.signalOutputs)for(const x of M._connectedPoint)P.has(x._ownerBlock.uniqueId)||(Z.push(x._ownerBlock),P.add(x._ownerBlock.uniqueId))}}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1?arguments[1]:void 0;M.allBlocks=[],this.visitAllBlocks((Z=>{const P={};Z.serialize(P),M.allBlocks.push(P)})),M.executionContexts=[];for(const P of this._executionContexts){const x={};P.serialize(x,Z),M.executionContexts.push(x)}}}class N{constructor(M){this.config=M,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.nZ.Gc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.nZ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const M=this._executeOnNextFrame.slice(0);if(M.length)for(const Z of M){this.notifyCustomEvent(Z.id,Z.data,!1);const M=this._executeOnNextFrame.findIndex((M=>M.uniqueId===Z.uniqueId));-1!==M&&this._executeOnNextFrame.splice(M,1)}}));(N.SceneCoordinators.get(this.config.nZ)??[]).push(this)}createGraph(){const M=new u({nZ:this.config.nZ,coordinator:this});return this._flowGraphs.push(M),M}removeGraph(M){const Z=this._flowGraphs.indexOf(M);-1!==Z&&(M.dispose(),this._flowGraphs.splice(Z,1))}start(){for(const M of this._flowGraphs)M.start()}dispose(){var M,Z;for(const c of this._flowGraphs)c.dispose();this._flowGraphs.length=0,null===(M=this._disposeObserver)||void 0===M||M.remove(),null===(Z=this._onBeforeRenderObserver)||void 0===Z||Z.remove();const P=N.SceneCoordinators.get(this.config.nZ)??[],x=P.indexOf(this);-1!==x&&P.splice(x,1)}serialize(M,Z){M._flowGraphs=[];for(const P of this._flowGraphs){const x={};P.serialize(x,Z),M._flowGraphs.push(x)}M.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(M){let Z=this._customEventsMap.get(M);return Z||(Z=new c.b,this._customEventsMap.set(M,Z)),Z}notifyCustomEvent(M,Z){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:M,data:Z,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(M)){const Z=this._eventExecutionCounter.get(M);if(this._eventExecutionCounter.set(M,Z+1),Z>=N.MaxEventTypeExecutionPerFrame)return void(Z===N.MaxEventTypeExecutionPerFrame&&d.d.Warn(`FlowGraphCoordinator: Too many executions of event "${M}".`))}else this._eventExecutionCounter.set(M,1);const P=this._customEventsMap.get(M);P&&P.notifyObservers(Z)}}N.MaxEventsPerType=30,N.MaxEventTypeExecutionPerFrame=30,N.SceneCoordinators=new Map},14109:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>c});var x=P(14115);class c extends x.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(M){M._notifyExecuteNode(this),this.done._activateSignal(M)}}},14090:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>G});var x=P(14093),c=P(14102),w=P(12317);class v extends c.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(M){super.connectTo(M),this._connectedPoint.sort(((M,Z)=>Z.priority-M.priority))}_activateSignal(M){var Z;if(null===(Z=M.logger)||void 0===Z||Z.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,BP:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(M,this),M._increaseExecutionId();else for(const P of this._connectedPoint)P._activateSignal(M)}}(0,w.g)("FlowGraphSignalConnection",v);class G extends x.c{constructor(M){super(M),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(M){const Z=new v(M,0,this);return this.signalInputs.push(Z),Z}_registerSignalOutput(M){const Z=new v(M,1,this);return this.signalOutputs.push(Z),Z}_unregisterSignalInput(M){const Z=this.signalInputs.findIndex((Z=>Z.name===M));-1!==Z&&(this.signalInputs[Z].dispose(),this.signalInputs.splice(Z,1))}_unregisterSignalOutput(M){const Z=this.signalOutputs.findIndex((Z=>Z.name===M));-1!==Z&&(this.signalOutputs[Z].dispose(),this.signalOutputs.splice(Z,1))}_reportError(M,Z){this.error.BP="string"===typeof Z?new Error(Z):Z,this.error._activateSignal(M)}getSignalInput(M){return this.signalInputs.find((Z=>Z.name===M))}getSignalOutput(M){return this.signalOutputs.find((Z=>Z.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.signalInputs=[],M.signalOutputs=[];for(const Z of this.signalInputs){const P={};Z.serialize(P),M.signalInputs.push(P)}for(const Z of this.signalOutputs){const P={};Z.serialize(P),M.signalOutputs.push(P)}}deserialize(M){for(let Z=0;Z<M.signalInputs.length;Z++){const P=this.getSignalInput(M.signalInputs[Z].name);if(!P)throw new Error("Could not find signal input with name "+M.signalInputs[Z].name+" in block "+M.className);P.deserialize(M.signalInputs[Z])}for(let Z=0;Z<M.signalOutputs.length;Z++){const P=this.getSignalOutput(M.signalOutputs[Z].name);if(!P)throw new Error("Could not find signal output with name "+M.signalOutputs[Z].name+" in block "+M.className);P.deserialize(M.signalOutputs[Z])}}getClassName(){return"FlowGraphExecutionBlock"}}},14117:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>c});var x=P(14090);class c extends x.b{constructor(M){super(M),this.out=this._registerSignalOutput("out")}}},14073:(M,Z,P)=>{"use strict";P.d(Z,{B:()=>d,F:()=>j,H:()=>B,J:()=>U,N:()=>h,O:()=>Q,R:()=>l,T:()=>D,e:()=>K,g:()=>H,j:()=>F,m:()=>n,p:()=>L,r:()=>u,u:()=>O,x:()=>t});var x,c=P(12373),w=P(12406),v=P(14067),G=P(14078);!function(M){M.Any="any",M.String="string",M.Number="number",M.Boolean="boolean",M.Object="object",M.Integer="FlowGraphInteger",M.Vector2="Vector2",M.BZ="BZ",M.Vector4="Vector4",M.Quaternion="Quaternion",M.Matrix="Matrix",M.Matrix2D="Matrix2D",M.Matrix3D="Matrix3D",M.uZ="uZ",M.Ic="Ic"}(x||(x={}));class mM{constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=M,this.defaultValue=Z,this.animationType=P}serialize(M){M.typeName=this.typeName,M.defaultValue=this.defaultValue}}const K=new mM("any",void 0),d=new mM("string",""),O=new mM("number",0,0),H=new mM("boolean",!1),j=new mM("Vector2",c.Vector2.Zero(),5),B=new mM("BZ",c.BZ.Zero(),1),U=new mM("Vector4",c.Vector4.Zero()),n=new mM("Matrix",c.Matrix.Identity(),3),L=new mM("Matrix2D",new G.d),u=new mM("Matrix3D",new G.h),N=new mM("uZ",w.uZ.Black(),4),J=new mM("Ic",new w.Ic(0,0,0,0),7),t=new mM("Quaternion",c.Quaternion.Identity(),2);t.typeTransformer=M=>{if(M.getClassName){if("Vector4"===M.getClassName())return c.Quaternion.NZ(M.nc());if("BZ"===M.getClassName())return c.Quaternion.FromEulerVector(M);if("Matrix"===M.getClassName())return c.Quaternion.FromRotationMatrix(M)}return M};const F=new mM("FlowGraphInteger",new v.e(0),0);function D(M){const Z=M;switch(typeof M){case"string":return d;case"number":return O;case"boolean":return H;case"object":if(Z.getClassName)switch(Z.getClassName()){case"Vector2":return j;case"BZ":return B;case"Vector4":return U;case"Matrix":return n;case"uZ":return N;case"Ic":return J;case"Quaternion":return t;case"FlowGraphInteger":return F;case"Matrix2D":return L;case"Matrix3D":return u}return K;default:return K}}function l(M){switch(M){case"string":return d;case"number":return O;case"boolean":return H;case"Vector2":return j;case"BZ":return B;case"Vector4":return U;case"Matrix":return n;case"uZ":return N;case"Ic":return J;case"Quaternion":return t;case"FlowGraphInteger":return F;case"Matrix2D":return L;case"Matrix3D":return u;default:return K}}function h(M){switch(M){case"number":default:return 0;case"Vector2":return 5;case"BZ":return 1;case"Matrix":return 3;case"uZ":return 4;case"Ic":return 7;case"Quaternion":return 2}}function Q(M){switch(M){case 0:return O;case 5:return j;case 1:return B;case 3:return n;case 4:return N;case 7:return J;case 2:return t;default:return K}}},14059:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>d,g:()=>K,j:()=>O});var x=P(12406),c=P(12373),w=P(14067),v=P(14073),G=P(14078);function mM(M){return"Vector2"===M||"BZ"===M||"Vector4"===M||"Quaternion"===M||"uZ"===M||"Ic"===M}function K(M,Z,P){var x;const c=(null===Z||void 0===Z||null===(x=Z.getClassName)||void 0===x?void 0:x.call(Z))??"";if(mM(c)||function(M){return"Matrix"===M||"Matrix2D"===M||"Matrix3D"===M}(c))P[M]={value:Z.nc(),className:c};else if("FlowGraphInteger"===c)P[M]={value:Z.value,className:c};else if(c&&(Z.id||Z.name))P[M]={id:Z.id,name:Z.name,className:c};else{if("object"===typeof Z)throw new Error(`Could not serialize value ${Z}`);P[M]=Z}}function d(M,Z,P,K){const O=Z[M];let H;const j=(null===O||void 0===O?void 0:O.type)??(null===O||void 0===O?void 0:O.className);if(function(M){return"Mesh"===M||"AbstractMesh"===M||"GroundMesh"===M||"InstanceMesh"===M||"LinesMesh"===M||"GoldbergMesh"===M||"GreasedLineMesh"===M||"TrailMesh"===M}(j)){let M=K.meshes.filter((M=>O.id?M.id===O.id:M.name===O.name));0===M.length&&(M=K.transformNodes.filter((M=>O.id?M.id===O.id:M.name===O.name))),H=O.uniqueId?M.find((M=>M.uniqueId===O.uniqueId)):M[0]}else if(mM(j))H=function(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===M)return c.Vector2.NZ(Z);if("BZ"===M)return P&&(Z[2]*=-1),c.BZ.NZ(Z);if("Vector4"===M)return c.Vector4.NZ(Z);if("Quaternion"===M)return P&&(Z[2]*=-1,Z[3]*=-1),c.Quaternion.NZ(Z);if("uZ"===M)return new x.uZ(Z[0],Z[1],Z[2]);if("Ic"===M)return new x.Ic(Z[0],Z[1],Z[2],Z[3]);throw new Error(`Unknown vector class name ${M}`)}(j,O.value);else if(function(M){return"AnimationGroup"===M}(j)){const M=K.animationGroups.filter((M=>M.name===O.name));H=1===M.length?M[0]:M.find((M=>M.uniqueId===O.uniqueId))}else H="Matrix"===j?c.Matrix.NZ(O.value):"Matrix2D"===j?new G.d(O.value):"Matrix3D"===j?new G.h(O.value):"FlowGraphInteger"===j?w.e.FromValue(O.value):"number"===j||"string"===j||"boolean"===j?O.value[0]:O&&void 0!==O.value?O.value:Array.isArray(O)?O.reduce(((M,Z)=>Z.eventData?(M[Z.id]={type:(0,v.R)(Z.type)},"undefined"!==typeof Z.value&&(M[Z.id].value=d("value",Z,P,K)),M):M),{}):O;return H}function O(M){return"FlowGraphJsonPointerParserBlock"===M}},14105:(M,Z,P)=>{"use strict";function x(M,Z){return!(!M.parent||M.parent!==Z&&!x(M.parent,Z))}function c(M){if(M.getClassName)return M.getClassName()}function w(M,Z){return M===Z&&("Vector2"===M||"BZ"===M||"Vector4"===M||"Quaternion"===M)}function v(M,Z){return M===Z&&("Matrix"===M||"Matrix2D"===M||"Matrix3D"===M)}function G(M,Z){return"FlowGraphInteger"===M&&"FlowGraphInteger"===Z}function mM(M,Z){const P="number"===typeof M||"number"===typeof(null===M||void 0===M?void 0:M.value);return P&&!Z?!isNaN(K(M)):P}function K(M){return"number"===typeof M?M:M.value}P.d(Z,{d:()=>G,g:()=>v,k:()=>w,l:()=>c,o:()=>x,q:()=>K,s:()=>mM})},13474:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{SceneInstrumentation:()=>w});var x=P(12175),c=P(12572);class w{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(M){M!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=M,M?(this._onBeforeActiveMeshesEvaluationObserver=this.nZ.onBeforeActiveMeshesEvaluationObservable.add((()=>{x.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.nZ.onAfterActiveMeshesEvaluationObservable.add((()=>{x.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.nZ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.nZ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(M){M!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=M,M?(this._onBeforeRenderTargetsRenderObserver=this.nZ.onBeforeRenderTargetsRenderObservable.add((()=>{x.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.nZ.onAfterRenderTargetsRenderObservable.add((()=>{x.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.nZ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.nZ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(M){M!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=M,M?(this._onBeforeParticlesRenderingObserver=this.nZ.onBeforeParticlesRenderingObservable.add((()=>{x.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.nZ.onAfterParticlesRenderingObservable.add((()=>{x.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.nZ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.nZ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(M){M!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=M,this.nZ.spriteManagers&&(M?(this._onBeforeSpritesRenderingObserver=this.nZ.onBeforeSpritesRenderingObservable.add((()=>{x.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.nZ.onAfterSpritesRenderingObservable.add((()=>{x.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.nZ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.nZ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(M){M!==this._capturePhysicsTime&&this.nZ.onBeforePhysicsObservable&&(this._capturePhysicsTime=M,M?(this._onBeforePhysicsObserver=this.nZ.onBeforePhysicsObservable.add((()=>{x.Tools.StartPerformanceCounter("ec"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.nZ.onAfterPhysicsObservable.add((()=>{x.Tools.EndPerformanceCounter("ec"),this._physicsTime.endMonitoring()}))):(this.nZ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.nZ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(M){M!==this._captureAnimationsTime&&(this._captureAnimationsTime=M,M?this._onAfterAnimationsObserver=this.nZ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.nZ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(M){this._captureFrameTime=M}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(M){this._captureInterFrameTime=M}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(M){M!==this._captureRenderTime&&(this._captureRenderTime=M,M?(this._onBeforeDrawPhaseObserver=this.nZ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),x.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.nZ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),x.Tools.EndPerformanceCounter("Main render")}))):(this.nZ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.nZ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(M){M!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=M,M?(this._onBeforeCameraRenderObserver=this.nZ.onBeforeCameraRenderObservable.add((M=>{this._cameraRenderTime.beginMonitoring(),x.Tools.StartPerformanceCounter(`Rendering camera ${M.name}`)})),this._onAfterCameraRenderObserver=this.nZ.onAfterCameraRenderObservable.add((M=>{this._cameraRenderTime.endMonitoring(!1),x.Tools.EndPerformanceCounter(`Rendering camera ${M.name}`)}))):(this.nZ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.nZ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.nZ.getEngine()._drawCalls}constructor(M){this.nZ=M,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new c.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new c.b,this._captureFrameTime=!1,this._frameTime=new c.b,this._captureRenderTime=!1,this._renderTime=new c.b,this._captureInterFrameTime=!1,this._interFrameTime=new c.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new c.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new c.b,this._capturePhysicsTime=!1,this._physicsTime=new c.b,this._captureAnimationsTime=!1,this._animationsTime=new c.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new c.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=M.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(x.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.nZ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=M.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(x.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.vc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.vc(),this._captureParticlesRenderTime&&this._particlesRenderTime.vc(),this._captureSpritesRenderTime&&this._spritesRenderTime.vc(),this._captureRenderTime&&this._renderTime.vc(),this._captureCameraRenderTime&&this._cameraRenderTime.vc()}))}dispose(){this._disposed||(this.nZ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.nZ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.nZ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.nZ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.nZ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.nZ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.nZ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.nZ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.nZ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.nZ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.nZ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.nZ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.nZ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.nZ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.nZ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.nZ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.nZ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.nZ=null,this._disposed=!0)}}},14047:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>d});var x=P(12351),c=P(12359),w=P(12373),v=P(12791),G=P(12902),mM=P(12962),K=P(12317);v.c.AddNodeConstructor("Light_Type_1",((M,Z)=>()=>new d(M,w.BZ.Zero(),Z)));class d extends mM.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(M){this._shadowFrustumSize=M,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(M){this._shadowOrthoScale=M,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(M){this._orthoLeft=M}get orthoRight(){return this._orthoRight}set orthoRight(M){this._orthoRight=M}get orthoTop(){return this._orthoTop}set orthoTop(M){this._orthoTop=M}get orthoBottom(){return this._orthoBottom}set orthoBottom(M){this._orthoBottom=M}constructor(M,Z,P){super(M,P),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=Z.scale(-1),this.direction=Z}getClassName(){return"bc"}getTypeID(){return G.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(M,Z,P){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(M):this._setDefaultAutoExtendShadowProjectionMatrix(M,Z,P)}_setDefaultFixedFrustumShadowProjectionMatrix(M){const Z=this.DM().activeCamera;Z&&w.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:Z.uc,void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,M,this.DM().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(M,Z,P){const x=this.DM().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const M=w.BZ.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let x=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let v=0;v<P.length;v++){const G=P[v];if(!G)continue;const mM=G.getBoundingInfo().boundingBox;for(let P=0;P<mM.vectorsWorld.length;P++)w.BZ.TransformCoordinatesToRef(mM.vectorsWorld[P],Z,M),M.x<this._orthoLeft&&(this._orthoLeft=M.x),M.y<this._orthoBottom&&(this._orthoBottom=M.y),M.x>this._orthoRight&&(this._orthoRight=M.x),M.y>this._orthoTop&&(this._orthoTop=M.y),this.autoCalcShadowZBounds&&(M.z<x&&(x=M.z),M.z>c&&(c=M.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=x,this._shadowMaxZ=c)}const c=this._orthoRight-this._orthoLeft,v=this._orthoTop-this._orthoBottom,G=void 0!==this.shadowMinZ?this.shadowMinZ:(null===x||void 0===x?void 0:x.uc)||0,mM=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===x||void 0===x?void 0:x.maxZ)||1e4,K=this.DM().getEngine().cc;w.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-c*this.shadowOrthoScale,this._orthoRight+c*this.shadowOrthoScale,this._orthoBottom-v*this.shadowOrthoScale,this._orthoTop+v*this.shadowOrthoScale,K?mM:G,K?G:mM,M,this.DM().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,Z){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,Z),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,Z),this)}transferToNodeMaterialEffect(M,Z){return this.computeTransformedInformation()?(M.setFloat3(Z,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(M.setFloat3(Z,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(M){const Z=this._scene.getEngine();return!Z.cc&&Z.isNDCHalfZRange?0:1}getDepthMaxZ(M){const Z=this._scene.getEngine();return Z.cc&&Z.isNDCHalfZRange?0:1}prepareLightSpecificDefines(M,Z){M["DIRLIGHT"+Z]=!0}}(0,x.c)([(0,c.H)()],d.prototype,"shadowFrustumSize",null),(0,x.c)([(0,c.H)()],d.prototype,"shadowOrthoScale",null),(0,x.c)([(0,c.H)()],d.prototype,"autoUpdateExtends",void 0),(0,x.c)([(0,c.H)()],d.prototype,"autoCalcShadowZBounds",void 0),(0,x.c)([(0,c.H)("orthoLeft")],d.prototype,"_orthoLeft",void 0),(0,x.c)([(0,c.H)("orthoRight")],d.prototype,"_orthoRight",void 0),(0,x.c)([(0,c.H)("orthoTop")],d.prototype,"_orthoTop",void 0),(0,x.c)([(0,c.H)("orthoBottom")],d.prototype,"_orthoBottom",void 0),(0,K.g)("BABYLON.DirectionalLight",d)},14571:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>d});var x=P(12351),c=P(12359),w=P(12373),v=P(12406),G=P(12791),mM=P(12902),K=P(12317);G.c.AddNodeConstructor("Light_Type_3",((M,Z)=>()=>new d(M,w.BZ.Zero(),Z)));class d extends mM.d{constructor(M,Z,P){super(M,P),this.groundColor=new v.uZ(0,0,0),this.direction=Z||w.BZ.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"fc"}setDirectionToTarget(M){return this.direction=w.BZ.Normalize(M.UZ(w.BZ.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(M,Z){const P=w.BZ.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",P.x,P.y,P.z,0,Z),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Rc),Z),this}transferToNodeMaterialEffect(M,Z){const P=w.BZ.Normalize(this.direction);return M.setFloat3(Z,P.x,P.y,P.z),this}Jc(){return this._worldMatrix||(this._worldMatrix=w.Matrix.Identity()),this._worldMatrix}getTypeID(){return mM.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(M,Z){M["HEMILIGHT"+Z]=!0}}(0,x.c)([(0,c.i)()],d.prototype,"groundColor",void 0),(0,x.c)([(0,c.E)()],d.prototype,"direction",void 0),(0,K.g)("BABYLON.HemisphericLight",d)},14015:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>O});var x=P(12351),c=P(12359),w=P(12373),v=P(12791),G=P(12902),mM=P(12962),K=P(12344),d=P(12317);v.c.AddNodeConstructor("Light_Type_2",((M,Z)=>()=>new O(M,w.BZ.Zero(),w.BZ.Zero(),0,0,Z)));class O extends mM.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(M){this._iesProfileTexture!==M&&(this._iesProfileTexture=M,this._iesProfileTexture&&O._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(M){this._angle=M,this._cosHalfAngle=Math.cos(.5*M),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(M){this._innerAngle=M,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(M){this._shadowAngleScale=M,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(M){this._projectionTextureLightNear=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(M){this._projectionTextureLightFar=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(M){this._projectionTextureUpDirection=M,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(M){this._projectionTexture!==M&&(this._projectionTexture=M,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(O._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):O._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(M){return void 0!==M.onGeneratedObservable}static _IsTexture(M){return void 0!==M.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(M){this._projectionTextureProjectionLightMatrix=M,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(M,Z,P,x,c,v){super(M,v),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=w.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=w.BZ.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=w.BZ.Zero(),this._projectionTextureViewLightMatrix=w.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=w.Matrix.Zero(),this._projectionTextureScalingMatrix=w.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=Z,this.direction=P,this.angle=x,this.exponent=c}getClassName(){return"SpotLight"}getTypeID(){return G.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(M){super._setDirection(M),this._projectionTextureViewLightDirty=!0}_setPosition(M){super._setPosition(M),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(M,Z,P){const x=this.DM().activeCamera;if(!x)return;this._shadowAngleScale=this._shadowAngleScale||1;const c=this._shadowAngleScale*this._angle,v=void 0!==this.shadowMinZ?this.shadowMinZ:x.uc,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,mM=this.DM().getEngine().cc;w.Matrix.PerspectiveFovLHToRef(c,1,mM?G:v,mM?v:G,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,mM)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),w.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const M=this.projectionTextureLightFar,Z=this.projectionTextureLightNear,P=M/(M-Z),x=-P*Z,c=1/Math.tan(this._angle/2);w.Matrix.FromValuesToRef(c/1,0,0,0,0,c,0,0,0,0,P,1,0,0,x,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof K.e){const M=this._projectionTexture.uScale/2,Z=this._projectionTexture.vScale/2;w.Matrix.FromValuesToRef(M,0,0,0,0,Z,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(M,Z){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),M.setMatrix("textureProjectionMatrix"+Z,this._projectionTextureMatrix),M.setTexture("projectionLightTexture"+Z,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&M.setTexture("iesLightTexture"+Z,this._iesProfileTexture),this}transferToEffect(M,Z){let P;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,Z),P=w.BZ.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,Z),P=w.BZ.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",P.x,P.y,P.z,this._cosHalfAngle,Z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,Z),this}transferToNodeMaterialEffect(M,Z){let P;return P=this.computeTransformedInformation()?w.BZ.Normalize(this.transformedDirection):w.BZ.Normalize(this.direction),this.DM().useRightHandedSystem?M.setFloat3(Z,-P.x,-P.y,-P.z):M.setFloat3(Z,P.x,P.y,P.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(M){const Z=this._scene.getEngine(),P=void 0!==this.shadowMinZ?this.shadowMinZ:(null===M||void 0===M?void 0:M.uc)??0;return Z.cc&&Z.isNDCHalfZRange?P:this._scene.getEngine().isNDCHalfZRange?0:P}getDepthMaxZ(M){const Z=this._scene.getEngine(),P=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===M||void 0===M?void 0:M.maxZ)??1e4;return Z.cc&&Z.isNDCHalfZRange?0:P}prepareLightSpecificDefines(M,Z){M["SPOTLIGHT"+Z]=!0,M["PROJECTEDLIGHTTEXTURE"+Z]=!(!this.projectionTexture||!this.projectionTexture.isReady()),M["IESLIGHTTEXTURE"+Z]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,x.c)([(0,c.H)()],O.prototype,"angle",null),(0,x.c)([(0,c.H)()],O.prototype,"innerAngle",null),(0,x.c)([(0,c.H)()],O.prototype,"shadowAngleScale",null),(0,x.c)([(0,c.H)()],O.prototype,"exponent",void 0),(0,x.c)([(0,c.H)()],O.prototype,"projectionTextureLightNear",null),(0,x.c)([(0,c.H)()],O.prototype,"projectionTextureLightFar",null),(0,x.c)([(0,c.H)()],O.prototype,"projectionTextureUpDirection",null),(0,x.c)([(0,c.A)("projectedLightTexture")],O.prototype,"_projectionTexture",void 0),(0,d.g)("BABYLON.SpotLight",O)},13743:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>v,e:()=>w,h:()=>G});const x={},c={};function w(M,Z){x[M]=Z}function v(M,Z){c[M]=Z}function G(M){return c[M]?c[M]:null}},13642:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>D,g:()=>o});var x,c=P(12175),w=P(12184),v=P(12596),G=P(12225),mM=P(12199),K=P(12837),d=P(12230),O=P(12238),H=P(12325),j=P(12260),B=P(12220);!function(M){M[M.Clean=0]="Clean",M[M.Stop=1]="Stop",M[M.Sync=2]="Sync",M[M.NoSync=3]="NoSync"}(x||(x={}));const U=new w.b,n={};let L=!1;function u(){return n[".babylon"]}function N(M,Z){const P=n[M];return P||(mM.d.Warn("Unable to find a plugin to load "+M+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),Z?u():void 0)}function J(M,Z,P){let x="Unable to load from "+(M.rawData?"binary data":M.url);return Z?x+=`: ${Z}`:P&&(x+=`: ${P}`),x}async function t(M,Z,P,x,c,w,v,G,mM){var K;const O="data:"===(H=M.url).substring(0,5)?H.substring(5):null;var H;if(M.rawData&&!v)throw"When using ArrayBufferView to load data the file extension must be provided.";const L=O||v?"":function(M){const Z=M.indexOf("?");-1!==Z&&(M=M.substring(0,Z));const P=M.lastIndexOf(".");return M.substring(P,M.length).toLowerCase()}(M.url);let J=v?N(v,!0):O?function(M){for(const Z in n){const P=n[Z].plugin;if(P.canDirectLoad&&P.canDirectLoad(M))return n[Z]}return u()}(M.url):N(L,!1);if(!J&&L){if(M.url&&!M.url.startsWith("blob:")){const Z=await async function(M,Z){const P=Z.method||"GET";return await new Promise(((x,c)=>{const w=new B.c;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const M={};if(Z.responseHeaders)for(const P of Z.responseHeaders)M[P]=w.getResponseHeader(P)||"";x({response:w.response,headerValues:M})}else c(`Unable to fetch data from ${M}. Error code: ${w.status}`)})),w.open(P,M),w.send()}))}(M.url,{method:"HEAD",responseHeaders:["Content-Type"]}),P=Z.headerValues?Z.headerValues["Content-Type"]:"";P&&(J=function(M){for(const Z in n){const P=n[Z];if(P.mimeType===M)return P}}(P))}J||(J=u())}if(!J)throw new Error(`No plugin or fallback for ${v??M.url}`);if(!1===(null===mM||void 0===mM||null===(K=mM[J.plugin.name])||void 0===K?void 0:K.enabled))throw new Error(`The '${J.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(M.rawData&&!J.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(M=>{if(J.plugin.createPlugin){const Z=J.plugin.createPlugin(mM??{});return Z instanceof Promise?(Z.then(M).catch((M=>{c("Error instantiating plugin.",M)})),null):(M(Z),Z)}return M(J.plugin),J.plugin})((mM=>{var K;if(!mM)throw`The loader plugin corresponding to the '${v}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(U.notifyObservers(mM),O&&(mM.canDirectLoad&&mM.canDirectLoad(M.url)||!(0,d.k)(M.url))){if(mM.directLoad){const M=mM.directLoad(Z,O);M instanceof Promise?M.then((M=>{P(mM,M)})).catch((M=>{c("Error in directLoad of _loadData: "+M,M)})):P(mM,M)}else P(mM,O);return}const H=J.isBinary,B=(M,x)=>{Z.K?c("Scene has been disposed"):P(mM,M,x)};let n=null,L=!1;null===(K=mM.Gc)||void 0===K||K.add((()=>{L=!0,n&&(n.abort(),n=null),w()}));const u=()=>{if(L)return;const P=(M,Z)=>{c(null===M||void 0===M?void 0:M.statusText,Z)};if(!mM.loadFile&&M.rawData)throw"Plugin does not support loading ArrayBufferView.";n=mM.loadFile?mM.loadFile(Z,M.rawData||M.file||M.url,M.rootUrl,B,x,H,P,G):Z._loadFile(M.file||M.url,B,x,!0,H,P)},N=Z.getEngine();let t=N.enableOfflineSupport;if(t){let P=!1;for(const x of Z.disableOfflineSupportExceptionRules)if(x.test(M.url)){P=!0;break}t=!P}t&&j.e.OfflineProviderFactory?Z.offlineProvider=j.e.OfflineProviderFactory(M.url,u,N.disableManifestCheck):u()}))}function F(M,Z){let P,x,w=null,v=null;if(Z)if(Z.name)P=`file:${Z.name}`,x=Z.name,w=Z;else if(ArrayBuffer.isView(Z))P="",x=(0,H.c)(),v=Z;else if(Z.startsWith("data:"))P=Z,x="";else if(M){const w=Z;if("/"===w.substring(0,1))return c.Tools.Error("Wrong sceneFilename parameter"),null;P=M+w,x=w}else P=Z,x=c.Tools.GetFilename(Z),M=c.Tools.GetFolderPath(Z);else P=M,x=c.Tools.GetFilename(M),M=c.Tools.GetFolderPath(M);return{url:P,rootUrl:M,name:x,file:w,rawData:v}}function D(M){if("string"===typeof M.extensions){const Z=M.extensions;n[Z.toLowerCase()]={plugin:M,isBinary:!1}}else{const Z=M.extensions,P=Object.keys(Z);for(const x of P)n[x.toLowerCase()]={plugin:M,isBinary:Z[x].isBinary,mimeType:Z[x].mimeType}}}async function l(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.b.LastCreatedScene,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!x)return mM.d.Error("No scene available to import mesh to"),null;const j=F(Z,P);if(!j)return null;const B={};x.addPendingData(B);const U=()=>{x.removePendingData(B)},n=(M,Z)=>{const P=J(j,M,Z);v?v(x,P,new O.m(P,O.i.SceneLoaderError,Z)):mM.d.Error(P),U()},L=w?M=>{try{w(M)}catch(Z){n("Error in onProgress callback: "+Z,Z)}}:void 0,u=(M,Z,P,w,v,G,mM,K)=>{if(x.importedMeshesFiles.push(j.url),c)try{c(M,Z,P,w,v,G,mM,K)}catch(d){n("Error in onSuccess callback: "+d,d)}x.removePendingData(B)};return await t(j,x,((Z,P,c)=>{if(Z.rewriteRootURL&&(j.rootUrl=Z.rewriteRootURL(j.rootUrl,c)),Z.importMesh){const c=[],w=[],v=[];if(!Z.importMesh(M,x,P,j.rootUrl,c,w,v,n))return;x.loadingPluginName=Z.name,u(c,w,v,[],[],[],[],[])}else{Z.importMeshAsync(M,x,P,j.rootUrl,L,j.name).then((M=>{x.loadingPluginName=Z.name,u(M.meshes,M.SH,M.skeletons,M.animationGroups,M.transformNodes,M.geometries,M.lights,M.spriteManagers)})).catch((M=>{n(M.message,M)}))}}),L,n,U,K,d,H)}async function h(M,Z,P,x,c,w,v,G){return await new Promise(((mM,K)=>{try{l(M,Z,P,x,((M,Z,P,x,c,w,v,G)=>{mM({meshes:M,SH:Z,skeletons:P,animationGroups:x,transformNodes:c,geometries:w,lights:v,spriteManagers:G})}),c,((M,Z,P)=>{K(P||new Error(Z))}),w,v,G).catch(K)}catch(O){K(O)}}))}async function Q(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.b.LastCreatedEngine,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mM=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};P?await s(M,Z,new v.e(P),x,w,mM,K,d,O):c.Tools.Error("No engine available")}async function I(M,Z,P,x,c,w,v){return await new Promise(((G,mM)=>{Q(M,Z,P,(M=>{G(M)}),x,((M,Z,P)=>{mM(P||new Error(Z))}),c,w,v)}))}async function s(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.b.LastCreatedScene,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return mM.d.Error("No scene available to append to"),null;const j=F(M,Z);if(!j)return null;const B={};P.addPendingData(B);const U=()=>{P.removePendingData(B)};K.e.ShowLoadingScreen&&!L&&(L=!0,P.getEngine().displayLoadingUI(),P.executeWhenReady((()=>{P.getEngine().hideLoadingUI(),L=!1})));const n=(M,Z)=>{const x=J(j,M,Z);w?w(P,x,new O.m(x,O.i.SceneLoaderError,Z)):mM.d.Error(x),U()},u=c?M=>{try{c(M)}catch(Z){n("Error in onProgress callback",Z)}}:void 0,N=()=>{if(x)try{x(P)}catch(M){n("Error in onSuccess callback",M)}P.removePendingData(B)};return await t(j,P,((M,Z)=>{if(M.load){if(!M.load(P,Z,j.rootUrl,n))return;P.loadingPluginName=M.name,N()}else{M.loadAsync(P,Z,j.rootUrl,u,j.name).then((()=>{P.loadingPluginName=M.name,N()})).catch((M=>{n(M.message,M)}))}}),u,n,U,v,d,H)}async function C(M,Z,P,x,c,w,v){return await new Promise(((G,mM)=>{try{s(M,Z,P,(M=>{G(M)}),x,((M,Z,P)=>{mM(P||new Error(Z))}),c,w,v).catch(mM)}catch(O){mM(O)}}))}async function R(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.b.LastCreatedScene,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return mM.d.Error("No scene available to load asset container to"),null;const H=F(M,Z);if(!H)return null;const j={};P.addPendingData(j);const B=()=>{P.removePendingData(j)},U=(M,Z)=>{const x=J(H,M,Z);w?w(P,x,new O.m(x,O.i.SceneLoaderError,Z)):mM.d.Error(x),B()},n=c?M=>{try{c(M)}catch(Z){U("Error in onProgress callback",Z)}}:void 0,L=M=>{if(x)try{x(M)}catch(Z){U("Error in onSuccess callback",Z)}P.removePendingData(j)};return await t(H,P,((M,Z)=>{if(M.loadAssetContainer){const x=M.loadAssetContainer(P,Z,H.rootUrl,U);if(!x)return;x.populateRootNodes(),P.loadingPluginName=M.name,L(x)}else if(M.loadAssetContainerAsync){M.loadAssetContainerAsync(P,Z,H.rootUrl,n,H.name).then((Z=>{Z.populateRootNodes(),P.loadingPluginName=M.name,L(Z)})).catch((M=>{U(M.message,M)}))}else U("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),n,U,B,v,K,d)}async function W(M,Z,P,x,c,w,v){return await new Promise(((G,mM)=>{try{R(M,Z,P,(M=>{G(M)}),x,((M,Z,P)=>{mM(P||new Error(Z))}),c,w,v).catch(mM)}catch(O){mM(O)}}))}async function k(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.b.LastCreatedScene,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",j=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!P)return void mM.d.Error("No scene available to load animations to");if(x){for(const x of P.animatables)x.reset();P.stopAllAnimations();const M=P.animationGroups.slice();for(const P of M)P.dispose();const Z=P.getNodes();for(const P of Z)P.animations&&(P.animations=[])}else switch(c){case 0:const M=P.animationGroups.slice();for(const Z of M)Z.dispose();break;case 1:for(const Z of P.animationGroups)Z.stop();break;case 2:for(const Z of P.animationGroups)Z.reset(),Z.restart();break;case 3:break;default:return void mM.d.Error("Unknown animation group loading mode value '"+c+"'")}const B=P.animatables.length;await R(M,Z,P,(M=>{M.mergeAnimationsTo(P,P.animatables.slice(B),w),M.dispose(),P.onAnimationFileImportedObservable.notifyObservers(P),v&&v(P)}),K,d,O,H,j)}async function A(M,Z,P,x,c,w,v,G,mM,K){return await new Promise(((d,H)=>{try{k(M,Z,P,x,c,w,(M=>{d(M)}),v,((M,Z,P)=>{H(P||new Error(Z))}),G,mM,K).catch(H)}catch(O){H(O)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return K.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(M){K.e.ForceFullSceneLoadingForIncremental=M}static get ShowLoadingScreen(){return K.e.ShowLoadingScreen}static set ShowLoadingScreen(M){K.e.ShowLoadingScreen=M}static get loggingLevel(){return K.e.loggingLevel}static set loggingLevel(M){K.e.loggingLevel=M}static get CleanBoneMatrixWeights(){return K.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(M){K.e.CleanBoneMatrixWeights=M}static GetDefaultPlugin(){return u()}static GetPluginForExtension(M){var Z;return null===(Z=N(M,!0))||void 0===Z?void 0:Z.plugin}static IsPluginForExtensionAvailable(M){return function(M){return!!n[M]}(M)}static RegisterPlugin(M){D(M)}static ImportMesh(M,Z,P,x,c,w,v,mM,K){l(M,Z,P,x,c,w,v,mM,K).catch((M=>null===v||void 0===v?void 0:v(G.b.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async ImportMeshAsync(M,Z,P,x,c,w,v){return await h(M,Z,P,x,c,w,v)}static Load(M,Z,P,x,c,w,v,mM){Q(M,Z,P,x,c,w,v,mM).catch((M=>null===w||void 0===w?void 0:w(G.b.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async LoadAsync(M,Z,P,x,c,w){return await I(M,Z,P,x,c,w)}static Append(M,Z,P,x,c,w,v,mM){s(M,Z,P,x,c,w,v,mM).catch((M=>null===w||void 0===w?void 0:w(P??G.b.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async AppendAsync(M,Z,P,x,c,w){return await C(M,Z,P,x,c,w)}static LoadAssetContainer(M,Z,P,x,c,w,v,mM){R(M,Z,P,x,c,w,v,mM).catch((M=>null===w||void 0===w?void 0:w(P??G.b.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async LoadAssetContainerAsync(M,Z,P,x,c,w){return await W(M,Z,P,x,c,w)}static ImportAnimations(M,Z,P,x,c,w,v,mM,K,d,O){k(M,Z,P,x,c,w,v,mM,K,d,O).catch((M=>null===K||void 0===K?void 0:K(P??G.b.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async ImportAnimationsAsync(M,Z,P,x,c,w,v,G,mM,K,d){return await A(M,Z,P,x,c,w,G,K,d)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=U},14035:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>H});var x=P(12351),c=P(12359),w=P(12175),v=P(12373),G=P(12390),mM=P(12344),K=P(12317),d=P(12184),O=P(12394);P(14038);class H extends G.b{set boundingBoxSize(M){if(this._boundingBoxSize&&this._boundingBoxSize.equals(M))return;this._boundingBoxSize=M;const Z=this.DM();Z&&Z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(M){this._rotationY=M,this.setReflectionTextureMatrix(v.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(M,Z,P){let x="";for(const c of M)x+=c;return new H(x,Z,null,P,M)}static CreateFromPrefilteredData(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=Z.useDelayedTextureLoading;Z.useDelayedTextureLoading=!1;const w=new H(M,Z,null,!1,null,null,null,void 0,!0,P,x);return Z.useDelayedTextureLoading=c,w}constructor(M,Z){var P;let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,n=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,L=arguments.length>13?arguments[13]:void 0,u=arguments.length>14?arguments[14]:void 0;super(Z),this.onLoadObservable=new d.b,this.boundingBoxPosition=v.BZ.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new v.Matrix,this._buffer=null,this.name=M,this.url=M,this._noMipmap=c,this.Lc=!1,this.isCube=!0,this._textureMatrix=v.Matrix.Identity(),this.coordinatesMode=mM.e.CUBIC_MODE;let N=null,J=null;null===x||Array.isArray(x)?(this._noMipmap=c,this._format=O,this._createPolynomials=B,N=x,this._loaderOptions=L,this._useSRGBBuffer=u,this._lodScale=U,this._lodOffset=n):(N=x.extensions??null,this._noMipmap=x.noMipmap??!1,w=x.files??null,J=x.buffer??null,this._format=x.format??5,H=x.prefiltered??!1,j=x.forcedExtension??null,this._createPolynomials=x.createPolynomials??!1,this._lodScale=x.lodScale??.8,this._lodOffset=x.lodOffset??0,this._loaderOptions=x.loaderOptions,this._useSRGBBuffer=x.useSRGBBuffer,G=x.S??null,K=x.onError??null),(M||w)&&this.updateURL(M,j,G,H,K,N,null===(P=this.DM())||void 0===P?void 0:P.useDelayedTextureLoading,w,J)}getClassName(){return"CubeTexture"}updateURL(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,mM=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=M),this.url=M,Z&&(this._forcedExtension=Z);const K=M.lastIndexOf("."),d=Z||(K>-1?M.substring(K).toLowerCase():""),O=0===d.indexOf(".dds"),H=0===d.indexOf(".env"),j=0===d.indexOf(".basis");if(H?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=x,x&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),G)this._files=G;else if(j||H||O||w||(w=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,w){for(let Z=0;Z<w.length;Z++)this._files.push(M+w[Z]);this._extensions=w}this._buffer=mM,v?(this.delayLoadState=4,this._delayedOnLoad=P,this._delayedOnError=c):this._loadTexture(P,c)}delayLoad(M){4===this.delayLoadState&&(M&&(this._forcedExtension=M),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(M){var Z,P;if(M.updateFlag===this._textureMatrix.updateFlag)return;M.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(P=this.DM())||void 0===P||P.markAllMaterialsAsDirty(1,(M=>-1!==M.getActiveTextures().indexOf(this))));if(this._textureMatrix=M,null===(Z=this.DM())||void 0===Z||!Z.useRightHandedSystem)return;const x=v.TmpVectors.BZ[0],c=v.TmpVectors.Quaternion[0],w=v.TmpVectors.BZ[1];this._textureMatrix.decompose(x,c,w),c.z*=-1,c.w*=-1,v.Matrix.ComposeToRef(x,c,w,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var M;return null!==(M=this.DM())&&void 0!==M&&M.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this.DM(),x=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const c=()=>{var Z;(this.onLoadObservable.notifyObservers(this),x)&&(x.dispose(),null===(Z=this.DM())||void 0===Z||Z.markAllMaterialsAsDirty(1));M&&M()},v=(M,P)=>{this._loadingError=!0,this._errorObject={message:M,exception:P},Z&&Z(M,P),mM.e.OnTextureLoadErrorObservable.notifyObservers(this)};var G;this._texture?this._texture.isReady?w.Tools.SetImmediate((()=>c())):this._texture.onLoadedObservable.add((()=>c())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,P,this._lodScale,this._lodOffset,M,v,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,P,this._files,this._noMipmap,M,v,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(G=this._texture)||void 0===G||G.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(M,Z,P){const x=O.b.Parse((()=>{let x=!1;return M.prefiltered&&(x=M.prefiltered),new H(P+(M.url??M.name),Z,M.extensions,!1,M.files||null,null,null,void 0,x,M.forcedExtension)}),M,Z);if(M.boundingBoxPosition&&(x.boundingBoxPosition=v.BZ.NZ(M.boundingBoxPosition)),M.boundingBoxSize&&(x.boundingBoxSize=v.BZ.NZ(M.boundingBoxSize)),M.animations)for(let c=0;c<M.animations.length;c++){const Z=M.animations[c],P=(0,K.e)("BABYLON.Animation");P&&x.animations.push(P.Parse(Z))}return x}clone(){let M=0;const Z=O.b.Clone((()=>{const Z=new H(this.url,this.DM()||this._getEngine(),this._extensions,this._noMipmap,this._files);return M=Z.uniqueId,Z}),this);return Z.uniqueId=M,Z}}(0,x.c)([(0,c.H)()],H.prototype,"url",void 0),(0,x.c)([(0,c.E)()],H.prototype,"boundingBoxPosition",void 0),(0,x.c)([(0,c.E)()],H.prototype,"boundingBoxSize",null),(0,x.c)([(0,c.H)("rotationY")],H.prototype,"rotationY",null),(0,x.c)([(0,c.H)("files")],H.prototype,"_files",void 0),(0,x.c)([(0,c.H)("forcedExtension")],H.prototype,"_forcedExtension",void 0),(0,x.c)([(0,c.H)("extensions")],H.prototype,"_extensions",void 0),(0,x.c)([(0,c.s)("textureMatrix")],H.prototype,"_textureMatrix",void 0),(0,x.c)([(0,c.s)("textureMatrixRefraction")],H.prototype,"_textureMatrixRefraction",void 0),mM.e._CubeTextureParser=H.Parse,(0,K.g)("BABYLON.CubeTexture",H)},14582:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>mM});var x=P(12199),c=P(12344),w=P(12332),v=P(12490),G=P(12291);v.ThinEngine.prototype.createDynamicTexture=function(M,Z,P,x){const c=new G.d(this,4);return c.baseWidth=M,c.baseHeight=Z,P&&(M=this.needPOTTextures?(0,w.e)(M,this._caps.maxTextureSize):M,Z=this.needPOTTextures?(0,w.e)(Z,this._caps.maxTextureSize):Z),c.width=M,c.height=Z,c.isReady=!1,c.generateMipMaps=P,c.samplingMode=x,this.updateTextureSamplingMode(x,c),this._internalTexturesCache.push(c),c},v.ThinEngine.prototype.updateDynamicTexture=function(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!M)return;const v=this._gl,G=v.TEXTURE_2D,mM=this._bindTextureDirectly(G,M,!0,w);this._unpackFlipY(void 0===P?M.invertY:P),x&&v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const K=this._getWebGLTextureType(M.type),d=this._getInternalFormat(c||M.format),O=this._getRGBABufferInternalSizedFormat(M.type,d);v.texImage2D(G,0,O,d,K,Z),M.generateMipMaps&&v.generateMipmap(G),mM||this._bindTextureDirectly(G,null),x&&v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),c&&(M.format=c),M._dynamicTextureSource=Z,M._premulAlpha=x,M.invertY=P||!1,M.isReady=!0};class mM extends c.e{constructor(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,G=arguments.length>6?arguments[6]:void 0;const mM=!P||P._isScene;super(null,mM?P:null===P||void 0===P?void 0:P.nZ,mM?!x:P,G,w,void 0,void 0,void 0,void 0,v),this.name=M,this.wrapU=c.e.CLAMP_ADDRESSMODE,this.wrapV=c.e.CLAMP_ADDRESSMODE,this._generateMipMaps=x;const K=this._getEngine();if(!K)return;if(Z.getContext)this._canvas=Z,this._ownCanvas=!1,this._texture=K.createDynamicTexture(this._canvas.width,this._canvas.height,x,w);else{this._canvas=K.createCanvas(1,1),this._ownCanvas=!0;const M=Z;M.width||0===M.width?this._texture=K.createDynamicTexture(M.width,M.height,x,w):this._texture=K.createDynamicTexture(Z,Z,x,w)}const d=this.getSize();this._canvas.width!==d.width&&(this._canvas.width=d.width),this._canvas.height!==d.height&&(this._canvas.height=d.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(M){this._canvas.width=M.width,this._canvas.height=M.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(M.width,M.height,this._generateMipMaps,this.samplingMode)}scale(M){const Z=this.getSize();Z.width*=M,Z.height*=M,this._recreate(Z)}scaleTo(M,Z){const P=this.getSize();P.width=M,P.height=Z,this._recreate(P)}getContext(){return this._context}clear(M){const Z=this.getSize();M&&(this._context.fillStyle=M),this._context.clearRect(0,0,Z.width,Z.height)}update(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===M||M,Z,this._format||void 0,void 0,P)}drawText(M,Z,P,x,c,w,v){let G=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const mM=this.getSize();if(w&&(this._context.fillStyle=w,this._context.fillRect(0,0,mM.width,mM.height)),this._context.font=x,null===Z||void 0===Z){const P=this._context.measureText(M);Z=(mM.width-P.width)/2}if(null===P||void 0===P){const M=parseInt(x.replace(/\D/g,""));P=mM.height/2+M/3.65}this._context.fillStyle=c||"",this._context.fillText(M,Z,P),G&&this.update(v)}dispose(){var M,Z;(super.dispose(),this._ownCanvas)&&(null===(M=this._canvas)||void 0===M||null===(Z=M.remove)||void 0===Z||Z.call(M));this._canvas=null,this._context=null}clone(){const M=this.DM();if(!M)return this;const Z=this.getSize(),P=new mM(this.name,Z,M,this._generateMipMaps);return P.Lc=this.Lc,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P}serialize(){const M=this.DM();M&&!M.isReady()&&x.d.Warn("The scene must be ready before serializing the dynamic texture");const Z=super.serialize();return mM._IsCanvasElement(this._canvas)&&(Z.base64String=this._canvas.toDataURL()),Z.invertY=this._invertY,Z.samplingMode=this.samplingMode,Z}static _IsCanvasElement(M){return void 0!==M.toDataURL}_rebuild(){this.update()}}},13948:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>c});var x=P(12344);class c extends x.e{get depth(){return this._depth}constructor(M,Z,P,c,w,v){let G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],mM=arguments.length>7&&void 0!==arguments[7]&&arguments[7],K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:x.e.TRILINEAR_SAMPLINGMODE,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,O=arguments.length>10?arguments[10]:void 0;super(null,v,!G,mM),this.format=w,this._texture=v.getEngine().createRawTexture2DArray(M,Z,P,c,w,G,mM,K,null,d,O),this._depth=c,this.is2DArray=!0}update(M){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,M,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(M,Z,P,x,w){return new c(M,Z,P,x,5,w,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13759:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>G,h:()=>mM,i:()=>w,m:()=>v});var x=P(12387),c=P(12373);function w(M,Z){return`{X: ${M.x.toFixed(Z)} Y: ${M.y.toFixed(Z)}}`}function v(M,Z){return`{X: ${M._x.toFixed(Z)} Y: ${M._y.toFixed(Z)} Z: ${M._z.toFixed(Z)}}`}function G(M,Z){return 2*Math.acos((0,x.Clamp)(c.Quaternion.Dot(M,Z)))}function mM(M,Z){const P=new c.Quaternion;return function(M,Z,P){const w=c.BZ.Cross(M,Z),v=Math.acos((0,x.Clamp)(c.BZ.Dot(M,Z),-1,1));c.Quaternion.RotationAxisToRef(w,v,P)}(M,Z,P),P}},13600:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>K});var x=P(12373),c=P(12406),w=P(12825),v=P(12805),G=P(12416);P(13602);function mM(M){let Z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const P=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],w=[];let mM=[];const K=M.width||M.size||1,d=M.height||M.size||1,O=M.depth||M.size||1,H=M.wrap||!1;let j=void 0===M.topBaseAt?1:M.topBaseAt,B=void 0===M.bottomBaseAt?0:M.bottomBaseAt;j=(j+4)%4,B=(B+4)%4;let U=[2,0,3,1][j],n=[2,0,1,3][B],L=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(H){Z=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],L=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let M=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],P=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const x=[17,18,19,16],c=[22,23,20,21];for(;U>0;)M.unshift(M.pop()),x.unshift(x.pop()),U--;for(;n>0;)P.unshift(P.pop()),c.unshift(c.pop()),n--;M=M.flat(),P=P.flat(),L=L.concat(M).concat(P),Z.push(x[0],x[2],x[3],x[0],x[1],x[2]),Z.push(c[0],c[2],c[3],c[0],c[1],c[2])}const u=[K/2,d/2,O/2];mM=L.reduce(((M,Z,P)=>M.concat(Z*u[P%3])),[]);const N=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,J=M.faceUV||new Array(6),t=M.faceColors,F=[];for(let v=0;v<6;v++)void 0===J[v]&&(J[v]=new x.Vector4(0,0,1,1)),t&&void 0===t[v]&&(t[v]=new c.Ic(1,1,1,1));for(let x=0;x<6;x++)if(w.push(J[x].z,G.e?1-J[x].w:J[x].w),w.push(J[x].x,G.e?1-J[x].w:J[x].w),w.push(J[x].x,G.e?1-J[x].y:J[x].y),w.push(J[x].z,G.e?1-J[x].y:J[x].y),t)for(let M=0;M<4;M++)F.push(t[x].r,t[x].g,t[x].b,t[x].a);v.b._ComputeSides(N,mM,Z,P,w,M.frontUVs,M.backUVs);const D=new v.b;if(D.indices=Z,D.hM=mM,D.QM=P,D.sM=w,t){const M=N===v.b.DOUBLESIDE?F.concat(F):F;D.IM=M}return D}function K(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new w.c(M,P);Z.sideOrientation=w.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return mM(Z).RM(x,Z.updatable),x}v.b.CreateBox=mM,w.c.CreateBox=function(M,Z){return K(M,{size:Z,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13750:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>G});var x=P(12825),c=P(12805),w=P(12416);function v(M){const Z=[],P=[],x=[],v=[],G=M.radius||.5,mM=M.tessellation||64,K=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,d=0===M.sideOrientation?0:M.sideOrientation||c.b.DEFAULTSIDE;Z.push(0,0,0),v.push(.5,.5);const O=2*Math.PI*K,H=1===K?O/mM:O/(mM-1);let j=0;for(let c=0;c<mM;c++){const M=Math.cos(j),P=Math.sin(j),x=(M+1)/2,c=(1-P)/2;Z.push(G*M,G*P,0),v.push(x,w.e?1-c:c),j+=H}1===K&&(Z.push(Z[3],Z[4],Z[5]),v.push(v[2],w.e?1-v[3]:v[3]));const B=Z.length/3;for(let c=1;c<B-1;c++)P.push(c+1,0,c);c.b.ComputeNormals(Z,P,x),c.b._ComputeSides(d,Z,P,x,v,M.frontUVs,M.backUVs);const U=new c.b;return U.indices=P,U.hM=Z,U.QM=x,U.sM=v,U}function G(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new x.c(M,P);Z.sideOrientation=x.c._GetDefaultSideOrientation(Z.sideOrientation),c._originalBuilderSideOrientation=Z.sideOrientation;return v(Z).RM(c,Z.updatable),c}c.b.CreateDisc=v,x.c.CreateDisc=function(M,Z,P){return G(M,{radius:Z,tessellation:P,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13602:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>n,d:()=>u,i:()=>L});var x=P(12373),c=P(12406),w=P(12825),v=P(12805),G=P(12430);w.c._GroundMeshParser=(M,Z)=>mM.Parse(M,Z);class mM extends w.c{constructor(M,Z){super(M,Z),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=M,this._subdivisionsY=M,this.subdivide(M);const P=this;P.createOrUpdateSubmeshesOctree&&P.createOrUpdateSubmeshesOctree(Z)}getHeightAtCoordinates(M,Z){const P=this.getWorldMatrix(),c=x.TmpVectors.Matrix[5];P.invertToRef(c);const w=x.TmpVectors.BZ[8];if(x.BZ.TransformCoordinatesFromFloatsToRef(M,0,Z,c,w),M=w.x,Z=w.z,M<this._minX||M>=this._maxX||Z<=this._minZ||Z>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const v=this._getFacetAt(M,Z),G=-(v.x*M+v.z*Z+v.w)/v.y;return x.BZ.TransformCoordinatesFromFloatsToRef(0,G,0,P,w),w.y}getNormalAtCoordinates(M,Z){const P=new x.BZ(0,1,0);return this.getNormalAtCoordinatesToRef(M,Z,P),P}getNormalAtCoordinatesToRef(M,Z,P){const c=this.getWorldMatrix(),w=x.TmpVectors.Matrix[5];c.invertToRef(w);const v=x.TmpVectors.BZ[8];if(x.BZ.TransformCoordinatesFromFloatsToRef(M,0,Z,w,v),M=v.x,Z=v.z,M<this._minX||M>this._maxX||Z<this._minZ||Z>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const G=this._getFacetAt(M,Z);return x.BZ.TransformNormalFromFloatsToRef(G.x,G.y,G.z,c,P),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(M,Z){const P=Math.floor((M+this._maxX)*this._subdivisionsX/this._width),x=Math.floor(-(Z+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),c=this._heightQuads[x*this._subdivisionsX+P];let w;return w=Z<c.slope.x*M+c.slope.y?c.facet1:c.facet2,w}_initHeightQuads(){const M=this._subdivisionsX,Z=this._subdivisionsY;this._heightQuads=[];for(let P=0;P<Z;P++)for(let Z=0;Z<M;Z++){const c={slope:x.Vector2.Zero(),facet1:new x.Vector4(0,0,0,0),facet2:new x.Vector4(0,0,0,0)};this._heightQuads[P*M+Z]=c}return this}_computeHeightQuads(){const M=this.getVerticesData(G.g.PositionKind);if(!M)return this;const Z=x.TmpVectors.BZ[3],P=x.TmpVectors.BZ[2],c=x.TmpVectors.BZ[1],w=x.TmpVectors.BZ[0],v=x.TmpVectors.BZ[4],mM=x.TmpVectors.BZ[5],K=x.TmpVectors.BZ[6],d=x.TmpVectors.BZ[7],O=x.TmpVectors.BZ[8];let H=0,j=0,B=0,U=0,n=0,L=0,u=0;const N=this._subdivisionsX,J=this._subdivisionsY;for(let G=0;G<J;G++)for(let J=0;J<N;J++){H=3*J,j=G*(N+1)*3,B=(G+1)*(N+1)*3,Z.x=M[j+H],Z.y=M[j+H+1],Z.z=M[j+H+2],P.x=M[j+H+3],P.y=M[j+H+4],P.z=M[j+H+5],c.x=M[B+H],c.y=M[B+H+1],c.z=M[B+H+2],w.x=M[B+H+3],w.y=M[B+H+4],w.z=M[B+H+5],U=(w.z-Z.z)/(w.x-Z.x),n=Z.z-U*Z.x,P.subtractToRef(Z,v),c.subtractToRef(Z,mM),w.subtractToRef(Z,K),x.BZ.CrossToRef(K,mM,d),x.BZ.CrossToRef(v,K,O),d.normalize(),O.normalize(),L=-(d.x*Z.x+d.y*Z.y+d.z*Z.z),u=-(O.x*P.x+O.y*P.y+O.z*P.z);const t=this._heightQuads[G*N+J];t.slope.lc(U,n),t.facet1.lc(d.x,d.y,d.z,L),t.facet2.lc(O.x,O.y,O.z,u)}return this}serialize(M){super.serialize(M),M.subdivisionsX=this._subdivisionsX,M.subdivisionsY=this._subdivisionsY,M.minX=this._minX,M.maxX=this._maxX,M.uc=this._minZ,M.maxZ=this._maxZ,M.width=this._width,M.height=this._height}static Parse(M,Z){const P=new mM(M.name,Z);return P._subdivisionsX=M.subdivisionsX||1,P._subdivisionsY=M.subdivisionsY||1,P._minX=M.minX,P._maxX=M.maxX,P._minZ=M.uc,P._maxZ=M.maxZ,P._width=M.width,P._height=M.height,P}}var K=P(12175),d=P(12225),O=P(12377),H=P(12416);function j(M){const Z=[],P=[],c=[],w=[];let G,mM;const K=M.width||M.size||1,d=M.height||M.size||1,O=0|(M.subdivisionsX||M.subdivisions||1),j=0|(M.subdivisionsY||M.subdivisions||1);for(G=0;G<=j;G++)for(mM=0;mM<=O;mM++){const M=new x.BZ(mM*K/O-K/2,0,(j-G)*d/j-d/2),Z=new x.BZ(0,1,0);P.push(M.x,M.y,M.z),c.push(Z.x,Z.y,Z.z),w.push(mM/O,H.e?G/j:1-G/j)}for(G=0;G<j;G++)for(mM=0;mM<O;mM++)Z.push(mM+1+(G+1)*(O+1)),Z.push(mM+1+G*(O+1)),Z.push(mM+G*(O+1)),Z.push(mM+(G+1)*(O+1)),Z.push(mM+1+(G+1)*(O+1)),Z.push(mM+G*(O+1));const B=new v.b;return B.indices=Z,B.hM=P,B.QM=c,B.sM=w,B}function B(M){const Z=void 0!==M.xmin&&null!==M.xmin?M.xmin:-1,P=void 0!==M.zmin&&null!==M.zmin?M.zmin:-1,c=void 0!==M.xmax&&null!==M.xmax?M.xmax:1,w=void 0!==M.zmax&&null!==M.zmax?M.zmax:1,G=M.subdivisions||{w:1,h:1},mM=M.precision||{w:1,h:1},K=[],d=[],O=[],H=[];let j,B,U,n;G.h=G.h<1?1:G.h,G.w=G.w<1?1:G.w,mM.w=mM.w<1?1:mM.w,mM.h=mM.h<1?1:mM.h;const L=(c-Z)/G.w,u=(w-P)/G.h;function N(M,Z,P,c){const w=d.length/3,v=mM.w+1;for(j=0;j<mM.h;j++)for(B=0;B<mM.w;B++){const M=[w+B+j*v,w+(B+1)+j*v,w+(B+1)+(j+1)*v,w+B+(j+1)*v];K.push(M[1]),K.push(M[2]),K.push(M[3]),K.push(M[0]),K.push(M[1]),K.push(M[3])}const G=x.BZ.Zero(),U=new x.BZ(0,1,0);for(j=0;j<=mM.h;j++)for(G.z=j*(c-Z)/mM.h+Z,B=0;B<=mM.w;B++)G.x=B*(P-M)/mM.w+M,G.y=0,d.push(G.x,G.y,G.z),O.push(U.x,U.y,U.z),H.push(B/mM.w,j/mM.h)}for(U=0;U<G.h;U++)for(n=0;n<G.w;n++)N(Z+n*L,P+U*u,Z+(n+1)*L,P+(U+1)*u);const J=new v.b;return J.indices=K,J.hM=d,J.QM=O,J.sM=H,J}function U(M){const Z=[],P=[],w=[],G=[];let mM,K;const d=M.colorFilter||new c.uZ(.3,.59,.11),H=M.alphaFilter||0;let j=!1;if(M.minHeight>M.maxHeight){j=!0;const Z=M.maxHeight;M.maxHeight=M.minHeight,M.minHeight=Z}for(mM=0;mM<=M.subdivisions;mM++)for(K=0;K<=M.subdivisions;K++){const Z=new x.BZ(K*M.width/M.subdivisions-M.width/2,0,(M.subdivisions-mM)*M.height/M.subdivisions-M.height/2),c=4*(((Z.x+M.width/2)/M.width*(M.bufferWidth-1)|0)+((1-(Z.z+M.height/2)/M.height)*(M.bufferHeight-1)|0)*M.bufferWidth);let v=M.buffer[c]/255,B=M.buffer[c+1]/255,U=M.buffer[c+2]/255;const n=M.buffer[c+3]/255;j&&(v=1-v,B=1-B,U=1-U);const L=v*d.r+B*d.g+U*d.b;Z.y=n>=H?M.minHeight+(M.maxHeight-M.minHeight)*L:M.minHeight-O.c,M.heightBuffer&&(M.heightBuffer[mM*(M.subdivisions+1)+K]=Z.y),P.push(Z.x,Z.y,Z.z),w.push(0,0,0),G.push(K/M.subdivisions,1-mM/M.subdivisions)}for(mM=0;mM<M.subdivisions;mM++)for(K=0;K<M.subdivisions;K++){const x=K+1+(mM+1)*(M.subdivisions+1),c=K+1+mM*(M.subdivisions+1),w=K+mM*(M.subdivisions+1),v=K+(mM+1)*(M.subdivisions+1),G=P[3*x+1]>=M.minHeight,d=P[3*c+1]>=M.minHeight,O=P[3*w+1]>=M.minHeight;G&&d&&O&&(Z.push(x),Z.push(c),Z.push(w));P[3*v+1]>=M.minHeight&&G&&O&&(Z.push(v),Z.push(x),Z.push(w))}v.b.ComputeNormals(P,Z,w);const B=new v.b;return B.indices=Z,B.hM=P,B.QM=w,B.sM=G,B}function n(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=new mM(M,arguments.length>2?arguments[2]:void 0);P._setReady(!1),P._subdivisionsX=Z.subdivisionsX||Z.subdivisions||1,P._subdivisionsY=Z.subdivisionsY||Z.subdivisions||1,P._width=Z.width||1,P._height=Z.height||1,P._maxX=P._width/2,P._maxZ=P._height/2,P._minX=-P._maxX,P._minZ=-P._maxZ;return j(Z).RM(P,Z.updatable),P._setReady(!0),P}function L(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new w.c(M,P);return B(Z).RM(x,Z.updatable),x}function u(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const w=P.width||10,v=P.height||10,G=P.subdivisions||1,O=P.minHeight||0,H=P.maxHeight||1,j=P.colorFilter||new c.uZ(.3,.59,.11),B=P.alphaFilter||0,n=P.updatable,L=P.onReady;x=x||d.b.LastCreatedScene;const u=new mM(M,x);let N;u._subdivisionsX=G,u._subdivisionsY=G,u._width=w,u._height=v,u._maxX=u._width/2,u._maxZ=u._height/2,u._minX=-u._maxX,u._minZ=-u._maxZ,u._setReady(!1),P.passHeightBufferInCallback&&(N=new Float32Array((G+1)*(G+1)));const J=(M,Z,P)=>{U({width:w,height:v,subdivisions:G,minHeight:O,maxHeight:H,colorFilter:j,buffer:M,bufferWidth:Z,bufferHeight:P,alphaFilter:B,heightBuffer:N}).RM(u,n),L&&L(u,N),u._setReady(!0)};if("string"===typeof Z){const M=M=>{var Z;const P=M.width,c=M.height;if(x.K)return;const w=null===(Z=x)||void 0===Z?void 0:Z.getEngine().resizeImageBitmap(M,P,c);J(w,P,c)};K.Tools.LoadImage(Z,M,P.onError?P.onError:()=>{},x.offlineProvider)}else J(Z.data,Z.width,Z.height);return u}v.b.CreateGround=j,v.b.CreateTiledGround=B,v.b.CreateGroundFromHeightMap=U,w.c.CreateGround=(M,Z,P,x,c,w)=>n(M,{width:Z,height:P,subdivisions:x,updatable:w},c),w.c.CreateTiledGround=(M,Z,P,x,c,w,v,G,mM)=>L(M,{xmin:Z,zmin:P,xmax:x,zmax:c,subdivisions:w,precision:v,updatable:mM},G),w.c.CreateGroundFromHeightMap=(M,Z,P,x,c,w,v,G,mM,K,d)=>u(M,Z,{width:P,height:x,subdivisions:c,minHeight:w,maxHeight:v,updatable:mM,onReady:K,alphaFilter:d},G)},14247:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>j,g:()=>O,j:()=>H});var x=P(12373),c=P(12825),w=P(12805),v=P(12909),G=P(12430),mM=P(12199);function K(M){const Z=[],P=[],x=M.lines,c=M.IM,v=[];let G=0;for(let w=0;w<x.length;w++){const M=x[w];for(let x=0;x<M.length;x++){const{x:mM,y:K,z:d}=M[x];if(P.push(mM,K,d),c){const M=c[w],{r:Z,g:P,b:G,a:mM}=M[x];v.push(Z,P,G,mM)}x>0&&(Z.push(G-1),Z.push(G)),G++}}const mM=new w.b;return mM.indices=Z,mM.hM=P,c&&(mM.IM=v),mM}function d(M){const Z=M.dashSize||3,P=M.gapSize||1,c=M.dashNb||200,v=M.points,G=[],mM=[],K=x.BZ.Zero();let d=0,O=0,H=0,j=0,B=0,U=0,n=0;for(n=0;n<v.length-1;n++)v[n+1].subtractToRef(v[n],K),d+=K.length();for(H=d/c,j=Z*H/(Z+P),n=0;n<v.length-1;n++){v[n+1].subtractToRef(v[n],K),O=Math.floor(K.length()/H),K.normalize();for(let M=0;M<O;M++)B=H*M,G.push(v[n].x+B*K.x,v[n].y+B*K.y,v[n].z+B*K.z),G.push(v[n].x+(B+j)*K.x,v[n].y+(B+j)*K.y,v[n].z+(B+j)*K.z),mM.push(U,U+1),U+=2}const L=new w.b;return L.hM=G,L.indices=mM,L}function O(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=Z.instance,c=Z.lines,w=Z.IM;if(x){const M=x.getVerticesData(G.g.PositionKind);let Z,P;w&&(Z=x.getVerticesData(G.g.ColorKind));let v=0,mM=0;for(let x=0;x<c.length;x++){const G=c[x];for(let c=0;c<G.length;c++)M[v]=G[c].x,M[v+1]=G[c].y,M[v+2]=G[c].z,w&&Z&&(P=w[x],Z[mM]=P[c].r,Z[mM+1]=P[c].g,Z[mM+2]=P[c].b,Z[mM+3]=P[c].a,mM+=4),v+=3}return x.updateVerticesData(G.g.PositionKind,M,!1,!1),w&&Z&&x.updateVerticesData(G.g.ColorKind,Z,!1,!1),x.refreshBoundingInfo(),x}const mM=!!w,d=new v.d(M,P,null,void 0,void 0,mM,Z.useVertexAlpha,Z.material);return K(Z).RM(d,Z.updatable),d}function H(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=Z.IM?[Z.IM]:null;return O(M,{lines:[Z.points],updatable:Z.updatable,instance:Z.instance,IM:x,useVertexAlpha:Z.useVertexAlpha,material:Z.material},P)}function j(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=Z.points,G=Z.instance,K=Z.gapSize||1,O=Z.dashSize||3;if(G){const M=M=>{const Z=x.BZ.Zero(),P=M.length/6;let c=0,v=0,mM=0,K=0,d=0,O=0,H=0,j=0;for(H=0;H<w.length-1;H++)w[H+1].subtractToRef(w[H],Z),c+=Z.length();mM=c/P;const B=G._creationDataStorage.dashSize;for(K=B*mM/(B+G._creationDataStorage.gapSize),H=0;H<w.length-1;H++)for(w[H+1].subtractToRef(w[H],Z),v=Math.floor(Z.length()/mM),Z.normalize(),j=0;j<v&&O<M.length;)d=mM*j,M[O]=w[H].x+d*Z.x,M[O+1]=w[H].y+d*Z.y,M[O+2]=w[H].z+d*Z.z,M[O+3]=w[H].x+(d+K)*Z.x,M[O+4]=w[H].y+(d+K)*Z.y,M[O+5]=w[H].z+(d+K)*Z.z,O+=6,j++;for(;O<M.length;)M[O]=w[H].x,M[O+1]=w[H].y,M[O+2]=w[H].z,O+=3};return(Z.dashNb||Z.dashSize||Z.gapSize||Z.useVertexAlpha||Z.material)&&mM.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),G.updateMeshPositions(M,!1),G}const H=new v.d(M,P,null,void 0,void 0,void 0,Z.useVertexAlpha,Z.material);return d(Z).RM(H,Z.updatable),H._creationDataStorage=new c.d,H._creationDataStorage.dashSize=O,H._creationDataStorage.gapSize=K,H}w.b.CreateLineSystem=K,w.b.CreateDashedLines=d,c.c.iK=function(M,Z){return H(M,{points:Z,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},c.c.CreateDashedLines=function(M,Z,P,x,c){return j(M,{points:Z,dashSize:P,gapSize:x,dashNb:c,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13651:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>G,e:()=>mM});var x=P(12825),c=P(12805),w=P(12416);function v(M){const Z=[],P=[],x=[],v=[],G=void 0!==M.width?M.width:void 0!==M.size?M.size:1,mM=void 0!==M.height?M.height:void 0!==M.size?M.size:1,K=0===M.sideOrientation?0:M.sideOrientation||c.b.DEFAULTSIDE,d=G/2,O=mM/2;P.push(-d,-O,0),x.push(0,0,-1),v.push(0,w.e?1:0),P.push(d,-O,0),x.push(0,0,-1),v.push(1,w.e?1:0),P.push(d,O,0),x.push(0,0,-1),v.push(1,w.e?0:1),P.push(-d,O,0),x.push(0,0,-1),v.push(0,w.e?0:1),Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),c.b._ComputeSides(K,P,Z,x,v,M.frontUVs,M.backUVs);const H=new c.b;return H.indices=Z,H.hM=P,H.QM=x,H.sM=v,H}function G(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new x.c(M,P);Z.sideOrientation=x.c._GetDefaultSideOrientation(Z.sideOrientation),c._originalBuilderSideOrientation=Z.sideOrientation;return v(Z).RM(c,Z.updatable),Z.sourcePlane&&(c.translate(Z.sourcePlane.normal,-Z.sourcePlane.d),c.setDirection(Z.sourcePlane.normal.scale(-1))),c}const mM={SK:G};c.b.SK=v,x.c.SK=(M,Z,P,x,c)=>G(M,{size:Z,width:Z,height:Z,sideOrientation:c,updatable:x},P)},13736:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>mM});var x=P(12373),c=P(12825),w=P(12805),v=P(12416);function G(M){const Z=0|(M.segments||32),P=M.diameterX||M.diameter||1,c=M.diameterY||M.diameter||1,G=M.diameterZ||M.diameter||1,mM=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,K=M.slice&&M.slice<=0?1:M.slice||1,d=0===M.sideOrientation?0:M.sideOrientation||w.b.DEFAULTSIDE,O=!!M.dedupTopBottomIndices,H=new x.BZ(P/2,c/2,G/2),j=2+Z,B=2*j,U=[],n=[],L=[],u=[];for(let w=0;w<=j;w++){const M=w/j,Z=M*Math.PI*K;for(let P=0;P<=B;P++){const c=P/B,w=c*Math.PI*2*mM,G=x.Matrix.RotationZ(-Z),K=x.Matrix.RotationY(w),d=x.BZ.TransformCoordinates(x.BZ.Up(),G),O=x.BZ.TransformCoordinates(d,K),j=O.multiply(H),U=O.divide(H).normalize();n.push(j.x,j.y,j.z),L.push(U.x,U.y,U.z),u.push(c,v.e?1-M:M)}if(w>0){const M=n.length/3;for(let Z=M-2*(B+1);Z+B+2<M;Z++)O?(w>1&&(U.push(Z),U.push(Z+1),U.push(Z+B+1)),(w<j||K<1)&&(U.push(Z+B+1),U.push(Z+1),U.push(Z+B+2))):(U.push(Z),U.push(Z+1),U.push(Z+B+1),U.push(Z+B+1),U.push(Z+1),U.push(Z+B+2))}}w.b._ComputeSides(d,n,U,L,u,M.frontUVs,M.backUVs);const N=new w.b;return N.indices=U,N.hM=n,N.QM=L,N.sM=u,N}function mM(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return G(Z).RM(x,Z.updatable),x}w.b.CreateSphere=G,c.c.CreateSphere=(M,Z,P,x,c,w)=>mM(M,{segments:Z,diameterX:P,diameterY:P,diameterZ:P,sideOrientation:w,updatable:c},x)},14587:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>G});var x=P(12939),c=P(14042),w=P(12953),v=P(12805);class G{static get Configuration(){return{get decoder(){return c.b.DefaultConfiguration},set decoder(M){c.b.DefaultConfiguration=M}}}static set Configuration(M){c.b.DefaultConfiguration=M.decoder}static get DecoderAvailable(){return(0,x.h)(c.b.DefaultConfiguration)}static get Default(){return G._Default??(G._Default=new G),G._Default}static ResetDefault(M){G._Default&&(M||G._Default.dispose(),G._Default=null)}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.DefaultNumWorkers;const Z="number"===typeof M?{...c.b.DefaultConfiguration,numWorkers:M}:{...c.b.DefaultConfiguration,...M};this._decoder=new c.b(Z)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(M,Z,P){return this._decoder.decodeMeshToMeshDataAsync(M,Z,P)}async decodeMeshToGeometryAsync(M,Z,P,x){return await this._decoder.decodeMeshToGeometryAsync(M,Z,P,x)}async _decodeMeshToGeometryForGltfAsync(M,Z,P,x,c,w){return await this._decoder._decodeMeshToGeometryForGltfAsync(M,Z,P,x,c,w)}async decodeMeshAsync(M,Z){const P=await this._decoder.decodeMeshToMeshDataAsync(M,Z),x=new v.b;P.indices&&(x.indices=P.indices);for(const c of P.attributes){const M=w.d.GetFloatData(c.data,c.size,w.d.GetDataType(c.data),c.byteOffset,c.byteStride,c.normalized,P.totalVertices);x.set(M,c.kind)}return x}}G.DefaultNumWorkers=(0,x.e)(),G._Default=null},14042:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>K});var x=P(12939),c=P(12175),w=P(12835),v=P(12953),G=P(12199),mM=P(12945);class K extends x.c{static get DefaultAvailable(){return(0,x.h)(K.DefaultConfiguration)}static get Default(){return K._Default??(K._Default=new K),K._Default}static ResetDefault(M){K._Default&&(M||K._Default.dispose(),K._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(M,Z){return{module:await(Z||DracoDecoderModule)({wasmBinary:M})}}_getWorkerContent(){return`${mM.d}(${mM.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.DefaultConfiguration)}decodeMeshToMeshDataAsync(M,Z,P){const x=M instanceof ArrayBuffer?new Int8Array(M):new Int8Array(M.buffer,M.byteOffset,M.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async M=>await new Promise(((c,w)=>{M.push(((M,v)=>{let mM=null;const K=[],d=Z=>{M.removeEventListener("error",d),M.removeEventListener("message",O),w(Z),v()},O=Z=>{const x=Z.data;switch(x.id){case"indices":mM=x.data;break;case"attribute":K.push({kind:x.kind,data:x.data,size:x.size,byteOffset:x.byteOffset,byteStride:x.byteStride,normalized:(w=x.kind,H=x.normalized,P&&void 0!==P[w]?(H!==P[w]&&G.d.Warn(`Normalized flag from Draco data (${H}) does not match normalized flag from glTF accessor (${P[w]}). Using flag from glTF accessor.`),P[w]):H)});break;case"decodeMeshDone":M.removeEventListener("error",d),M.removeEventListener("message",O),c({indices:mM,attributes:K,totalVertices:x.totalVertices}),v()}var w,H};M.addEventListener("error",d),M.addEventListener("message",O);const H=x.slice();M.postMessage({id:"decodeMesh",dataView:H,attributes:Z},[H.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((M=>{let P=null;const c=[],w=(0,mM.d)(M.module,x,Z,(M=>{P=M}),((M,Z,P,x,w,v)=>{c.push({kind:M,data:Z,size:P,byteOffset:x,byteStride:w,normalized:v})}));return{indices:P,attributes:c,totalVertices:w}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(M,Z,P,x){const c=await this.decodeMeshToMeshDataAsync(P,x),G=new w.d(M,Z);c.indices&&G.setIndices(c.indices);for(const w of c.attributes)G.setVerticesBuffer(new v.d(Z.getEngine(),w.data,w.kind,!1,void 0,w.byteStride,void 0,w.byteOffset,w.size,void 0,w.normalized,!0),c.totalVertices);return G}async _decodeMeshToGeometryForGltfAsync(M,Z,P,x,c,G){const mM=await this.decodeMeshToMeshDataAsync(P,x,c),K=new w.d(M,Z);G&&(K._boundingInfo=G,K.useBoundingInfoFromGeometry=!0),mM.indices&&K.setIndices(mM.indices);for(const w of mM.attributes)K.setVerticesBuffer(new v.d(Z.getEngine(),w.data,w.kind,!1,void 0,w.byteStride,void 0,w.byteOffset,w.size,void 0,w.normalized,!0),mM.totalVertices);return K}}K.DefaultConfiguration={wasmUrl:`${c.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${c.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${c.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},K._Default=null},14240:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>GM});var x=P(12373),c=P(12825),w=P(12430),v=P(12805),G=P(12416);function mM(M){let Z=M.pathArray;const P=M.closeArray||!1,x=M.closePath||!1,c=M.invertUV||!1,mM=Math.floor(Z[0].length/2);let K=M.offset||mM;K=K>mM?mM:Math.floor(K);const d=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,O=M.sM,H=M.IM,j=[],B=[],U=[],n=[],L=[],u=[],N=[],J=[];let t;const F=[],D=[];let l,h,Q;if(Z.length<2){const M=[],P=[];for(h=0;h<Z[0].length-K;h++)M.push(Z[0][h]),P.push(Z[0][h+K]);Z=[M,P]}let I=0;const s=x?1:0,C=P?1:0;let R,W,k,A,o,E;for(t=Z[0].length,l=0;l<Z.length+C;l++){for(N[l]=0,L[l]=[0],R=l===Z.length?Z[0]:Z[l],W=R.length,t=t<W?t:W,Q=0;Q<W;)j.push(R[Q].x,R[Q].y,R[Q].z),Q>0&&(k=R[Q].UZ(R[Q-1]).length(),A=k+N[l],L[l].push(A),N[l]=A),Q++;x&&(Q--,j.push(R[0].x,R[0].y,R[0].z),k=R[Q].UZ(R[0]).length(),A=k+N[l],L[l].push(A),N[l]=A),F[l]=W+s,D[l]=I,I+=W+s}let r,q,e=null,b=null;for(h=0;h<t+s;h++)for(J[h]=0,u[h]=[0],l=0;l<Z.length-1+C;l++)o=Z[l],E=l===Z.length-1?Z[0]:Z[l+1],h===t?(e=o[0],b=E[0]):(e=o[h],b=E[h]),k=b.UZ(e).length(),A=k+J[h],u[h].push(A),J[h]=A;if(O)for(l=0;l<O.length;l++)n.push(O[l].x,G.e?1-O[l].y:O[l].y);else for(l=0;l<Z.length+C;l++)for(h=0;h<t+s;h++)r=0!=N[l]?L[l][h]/N[l]:0,q=0!=J[h]?u[h][l]/J[h]:0,c?n.push(q,r):n.push(r,G.e?1-q:q);l=0;let a=0,y=F[l]-1,f=F[l+1]-1,Y=y<f?y:f,z=D[1]-D[0];const i=F.length-1;for(;a<=Y&&l<i;)B.push(a,a+z,a+1),B.push(a+z+1,a+1,a+z),a+=1,a===Y&&(l++,z=D[l+1]-D[l],y=F[l]-1,f=F[l+1]-1,a=D[l],Y=y<f?y+a:f+a);if(v.b.ComputeNormals(j,B,U),x){let M=0,P=0;for(l=0;l<Z.length;l++){M=3*D[l],P=l+1<Z.length?3*(D[l+1]-1):U.length-3,U[M]=.5*(U[M]+U[P]),U[M+1]=.5*(U[M+1]+U[P+1]),U[M+2]=.5*(U[M+2]+U[P+2]);const x=Math.sqrt(U[M]*U[M]+U[M+1]*U[M+1]+U[M+2]*U[M+2]);U[M]/=x,U[M+1]/=x,U[M+2]/=x,U[P]=U[M],U[P+1]=U[M+1],U[P+2]=U[M+2]}}if(P){let M=3*D[0],P=3*D[Z.length];for(h=0;h<t+s;h++){U[M]=.5*(U[M]+U[P]),U[M+1]=.5*(U[M+1]+U[P+1]),U[M+2]=.5*(U[M+2]+U[P+2]);const Z=Math.sqrt(U[M]*U[M]+U[M+1]*U[M+1]+U[M+2]*U[M+2]);U[M]/=Z,U[M+1]/=Z,U[M+2]/=Z,U[P]=U[M],U[P+1]=U[M+1],U[P+2]=U[M+2],M+=3,P+=3}}v.b._ComputeSides(d,j,B,U,n,M.frontUVs,M.backUVs);let T=null;if(H){T=new Float32Array(4*H.length);for(let M=0;M<H.length;M++)T[4*M]=H[M].r,T[4*M+1]=H[M].g,T[4*M+2]=H[M].b,T[4*M+3]=H[M].a}const p=new v.b,S=new Float32Array(j),X=new Float32Array(U),V=new Float32Array(n);return p.indices=B,p.hM=S,p.QM=X,p.sM=V,T&&p.set(T,w.g.ColorKind),x&&(p._idx=D),p}function K(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=Z.pathArray,d=Z.closeArray,O=Z.closePath,H=c.c._GetDefaultSideOrientation(Z.sideOrientation),j=Z.instance,B=Z.updatable;if(j){const M=x.TmpVectors.BZ[0].Qc(Number.MAX_VALUE),P=x.TmpVectors.BZ[1].Qc(-Number.MAX_VALUE),mM=Z=>{let x=K[0].length;const w=j;let v=0;const G=w._originalBuilderSideOrientation===c.c.DOUBLESIDE?2:1;for(let c=1;c<=G;++c)for(let G=0;G<K.length;++G){const c=K[G],mM=c.length;x=x<mM?x:mM;for(let w=0;w<x;++w){const x=c[w];Z[v]=x.x,Z[v+1]=x.y,Z[v+2]=x.z,M.minimizeInPlaceFromFloats(x.x,x.y,x.z),P.maximizeInPlaceFromFloats(x.x,x.y,x.z),v+=3}if(w._creationDataStorage&&w._creationDataStorage.closePath){const M=c[0];Z[v]=M.x,Z[v+1]=M.y,Z[v+2]=M.z,v+=3}}},d=j.getVerticesData(w.g.PositionKind);if(mM(d),j.hasBoundingInfo?j.getBoundingInfo().reConstruct(M,P,j._worldMatrix):j.buildBoundingInfo(M,P,j._worldMatrix),j.updateVerticesData(w.g.PositionKind,d,!1,!1),Z.IM){const M=j.getVerticesData(w.g.ColorKind);for(let P=0,x=0;P<Z.IM.length;P++,x+=4){const c=Z.IM[P];M[x]=c.r,M[x+1]=c.g,M[x+2]=c.b,M[x+3]=c.a}j.updateVerticesData(w.g.ColorKind,M,!1,!1)}if(Z.sM){const M=j.getVerticesData(w.g.UVKind);for(let P=0;P<Z.sM.length;P++)M[2*P]=Z.sM[P].x,M[2*P+1]=G.e?1-Z.sM[P].y:Z.sM[P].y;j.updateVerticesData(w.g.UVKind,M,!1,!1)}if(!j.areNormalsFrozen||j.isFacetDataEnabled){const M=j.Fc(),Z=j.getVerticesData(w.g.NormalKind),P=j.isFacetDataEnabled?j.getFacetDataParameters():null;if(v.b.ComputeNormals(d,M,Z,P),j._creationDataStorage&&j._creationDataStorage.closePath){let M=0,P=0;for(let x=0;x<K.length;x++)M=3*j._creationDataStorage.idx[x],P=x+1<K.length?3*(j._creationDataStorage.idx[x+1]-1):Z.length-3,Z[M]=.5*(Z[M]+Z[P]),Z[M+1]=.5*(Z[M+1]+Z[P+1]),Z[M+2]=.5*(Z[M+2]+Z[P+2]),Z[P]=Z[M],Z[P+1]=Z[M+1],Z[P+2]=Z[M+2]}j.areNormalsFrozen||j.updateVerticesData(w.g.NormalKind,Z,!1,!1)}return j}{const x=new c.c(M,P);x._originalBuilderSideOrientation=H,x._creationDataStorage=new c.d;const w=mM(Z);return O&&(x._creationDataStorage.idx=w._idx),x._creationDataStorage.closePath=O,x._creationDataStorage.closeArray=d,w.RM(x,B),x}}v.b.CreateRibbon=mM,c.c.CreateRibbon=function(M,Z){return K(M,{pathArray:Z,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var d=P(13750),O=P(13600),H=P(12406);function j(M){const Z=M.pattern||c.c.NO_FLIP,P=M.tileWidth||M.tileSize||1,x=M.tileHeight||M.tileSize||1,w=M.alignHorizontal||0,G=M.alignVertical||0,mM=M.width||M.size||1,K=Math.floor(mM/P);let d=mM-K*P;const O=M.height||M.size||1,H=Math.floor(O/x);let j=O-H*x;const B=P*K/2,U=x*H/2;let n=0,L=0,u=0,N=0,J=0,t=0;if(d>0||j>0){switch(u=-B,N=-U,J=B,t=U,w){case c.c.CENTER:d/=2,u-=d,J+=d;break;case c.c.LEFT:J+=d,n=-d/2;break;case c.c.RIGHT:u-=d,n=d/2}switch(G){case c.c.CENTER:j/=2,N-=j,t+=j;break;case c.c.BOTTOM:t+=j,L=-j/2;break;case c.c.TOP:N-=j,L=j/2}}const F=[],D=[],l=[];l[0]=[0,0,1,0,1,1,0,1],l[1]=[0,0,1,0,1,1,0,1],Z!==c.c.ROTATE_TILE&&Z!==c.c.ROTATE_ROW||(l[1]=[1,1,0,1,0,0,1,0]),Z!==c.c.FLIP_TILE&&Z!==c.c.FLIP_ROW||(l[1]=[1,0,0,0,0,1,1,1]),Z!==c.c.FLIP_N_ROTATE_TILE&&Z!==c.c.FLIP_N_ROTATE_ROW||(l[1]=[0,1,1,1,1,0,0,0]);let h=[];const Q=[],I=[];let s=0;for(let v=0;v<H;v++)for(let M=0;M<K;M++)F.push(M*P-B+n,v*x-U+L,0),F.push((M+1)*P-B+n,v*x-U+L,0),F.push((M+1)*P-B+n,(v+1)*x-U+L,0),F.push(M*P-B+n,(v+1)*x-U+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),h=Z===c.c.FLIP_TILE||Z===c.c.ROTATE_TILE||Z===c.c.FLIP_N_ROTATE_TILE?h.concat(l[(M%2+v%2)%2]):Z===c.c.FLIP_ROW||Z===c.c.ROTATE_ROW||Z===c.c.FLIP_N_ROTATE_ROW?h.concat(l[v%2]):h.concat(l[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),s+=4;if(d>0||j>0){const M=j>0&&(G===c.c.CENTER||G===c.c.TOP),v=j>0&&(G===c.c.CENTER||G===c.c.BOTTOM),mM=d>0&&(w===c.c.CENTER||w===c.c.RIGHT),O=d>0&&(w===c.c.CENTER||w===c.c.LEFT);let l,C,R,W,k=[];if(M&&mM&&(F.push(u+n,N+L,0),F.push(-B+n,N+L,0),F.push(-B+n,N+j+L,0),F.push(u+n,N+j+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,l=1-d/P,C=1-j/x,R=1,W=1,k=[l,C,R,C,R,W,l,W],Z===c.c.ROTATE_ROW&&(k=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),Z===c.c.FLIP_ROW&&(k=[1-l,C,1-R,C,1-R,W,1-l,W]),Z===c.c.FLIP_N_ROTATE_ROW&&(k=[l,1-C,R,1-C,R,1-W,l,1-W]),h=h.concat(k),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&O&&(F.push(B+n,N+L,0),F.push(J+n,N+L,0),F.push(J+n,N+j+L,0),F.push(B+n,N+j+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,l=0,C=1-j/x,R=d/P,W=1,k=[l,C,R,C,R,W,l,W],(Z===c.c.ROTATE_ROW||Z===c.c.ROTATE_TILE&&K%2===0)&&(k=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),(Z===c.c.FLIP_ROW||Z===c.c.FLIP_TILE&&K%2===0)&&(k=[1-l,C,1-R,C,1-R,W,1-l,W]),(Z===c.c.FLIP_N_ROTATE_ROW||Z===c.c.FLIP_N_ROTATE_TILE&&K%2===0)&&(k=[l,1-C,R,1-C,R,1-W,l,1-W]),h=h.concat(k),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&mM&&(F.push(u+n,U+L,0),F.push(-B+n,U+L,0),F.push(-B+n,t+L,0),F.push(u+n,t+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,l=1-d/P,C=0,R=1,W=j/x,k=[l,C,R,C,R,W,l,W],(Z===c.c.ROTATE_ROW&&H%2===1||Z===c.c.ROTATE_TILE&&H%1===0)&&(k=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),(Z===c.c.FLIP_ROW&&H%2===1||Z===c.c.FLIP_TILE&&H%2===0)&&(k=[1-l,C,1-R,C,1-R,W,1-l,W]),(Z===c.c.FLIP_N_ROTATE_ROW&&H%2===1||Z===c.c.FLIP_N_ROTATE_TILE&&H%2===0)&&(k=[l,1-C,R,1-C,R,1-W,l,1-W]),h=h.concat(k),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&O&&(F.push(B+n,U+L,0),F.push(J+n,U+L,0),F.push(J+n,t+L,0),F.push(B+n,t+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,l=0,C=0,R=d/P,W=j/x,k=[l,C,R,C,R,W,l,W],(Z===c.c.ROTATE_ROW&&H%2===1||Z===c.c.ROTATE_TILE&&(H+K)%2===1)&&(k=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),(Z===c.c.FLIP_ROW&&H%2===1||Z===c.c.FLIP_TILE&&(H+K)%2===1)&&(k=[1-l,C,1-R,C,1-R,W,1-l,W]),(Z===c.c.FLIP_N_ROTATE_ROW&&H%2===1||Z===c.c.FLIP_N_ROTATE_TILE&&(H+K)%2===1)&&(k=[l,1-C,R,1-C,R,1-W,l,1-W]),h=h.concat(k),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M){const M=[];l=0,C=1-j/x,R=1,W=1,M[0]=[l,C,R,C,R,W,l,W],M[1]=[l,C,R,C,R,W,l,W],Z!==c.c.ROTATE_TILE&&Z!==c.c.ROTATE_ROW||(M[1]=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),Z!==c.c.FLIP_TILE&&Z!==c.c.FLIP_ROW||(M[1]=[1-l,C,1-R,C,1-R,W,1-l,W]),Z!==c.c.FLIP_N_ROTATE_TILE&&Z!==c.c.FLIP_N_ROTATE_ROW||(M[1]=[l,1-C,R,1-C,R,1-W,l,1-W]);for(let x=0;x<K;x++)F.push(x*P-B+n,N+L,0),F.push((x+1)*P-B+n,N+L,0),F.push((x+1)*P-B+n,N+j+L,0),F.push(x*P-B+n,N+j+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,h=Z===c.c.FLIP_TILE||Z===c.c.ROTATE_TILE||Z===c.c.FLIP_N_ROTATE_TILE?h.concat(M[(x+1)%2]):Z===c.c.FLIP_ROW||Z===c.c.ROTATE_ROW||Z===c.c.FLIP_N_ROTATE_ROW?h.concat(M[1]):h.concat(M[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const M=[];l=0,C=0,R=1,W=j/x,M[0]=[l,C,R,C,R,W,l,W],M[1]=[l,C,R,C,R,W,l,W],Z!==c.c.ROTATE_TILE&&Z!==c.c.ROTATE_ROW||(M[1]=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),Z!==c.c.FLIP_TILE&&Z!==c.c.FLIP_ROW||(M[1]=[1-l,C,1-R,C,1-R,W,1-l,W]),Z!==c.c.FLIP_N_ROTATE_TILE&&Z!==c.c.FLIP_N_ROTATE_ROW||(M[1]=[l,1-C,R,1-C,R,1-W,l,1-W]);for(let x=0;x<K;x++)F.push(x*P-B+n,t-j+L,0),F.push((x+1)*P-B+n,t-j+L,0),F.push((x+1)*P-B+n,t+L,0),F.push(x*P-B+n,t+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,h=Z===c.c.FLIP_TILE||Z===c.c.ROTATE_TILE||Z===c.c.FLIP_N_ROTATE_TILE?h.concat(M[(x+H)%2]):Z===c.c.FLIP_ROW||Z===c.c.ROTATE_ROW||Z===c.c.FLIP_N_ROTATE_ROW?h.concat(M[H%2]):h.concat(M[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(mM){const M=[];l=1-d/P,C=0,R=1,W=1,M[0]=[l,C,R,C,R,W,l,W],M[1]=[l,C,R,C,R,W,l,W],Z!==c.c.ROTATE_TILE&&Z!==c.c.ROTATE_ROW||(M[1]=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),Z!==c.c.FLIP_TILE&&Z!==c.c.FLIP_ROW||(M[1]=[1-l,C,1-R,C,1-R,W,1-l,W]),Z!==c.c.FLIP_N_ROTATE_TILE&&Z!==c.c.FLIP_N_ROTATE_ROW||(M[1]=[l,1-C,R,1-C,R,1-W,l,1-W]);for(let P=0;P<H;P++)F.push(u+n,P*x-U+L,0),F.push(u+d+n,P*x-U+L,0),F.push(u+d+n,(P+1)*x-U+L,0),F.push(u+n,(P+1)*x-U+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,h=Z===c.c.FLIP_TILE||Z===c.c.ROTATE_TILE||Z===c.c.FLIP_N_ROTATE_TILE?h.concat(M[(P+1)%2]):Z===c.c.FLIP_ROW||Z===c.c.ROTATE_ROW||Z===c.c.FLIP_N_ROTATE_ROW?h.concat(M[P%2]):h.concat(M[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const M=[];l=0,C=0,R=d/x,W=1,M[0]=[l,C,R,C,R,W,l,W],M[1]=[l,C,R,C,R,W,l,W],Z!==c.c.ROTATE_TILE&&Z!==c.c.ROTATE_ROW||(M[1]=[1-l,1-C,1-R,1-C,1-R,1-W,1-l,1-W]),Z!==c.c.FLIP_TILE&&Z!==c.c.FLIP_ROW||(M[1]=[1-l,C,1-R,C,1-R,W,1-l,W]),Z!==c.c.FLIP_N_ROTATE_TILE&&Z!==c.c.FLIP_N_ROTATE_ROW||(M[1]=[l,1-C,R,1-C,R,1-W,l,1-W]);for(let P=0;P<H;P++)F.push(J-d+n,P*x-U+L,0),F.push(J+n,P*x-U+L,0),F.push(J+n,(P+1)*x-U+L,0),F.push(J-d+n,(P+1)*x-U+L,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,h=Z===c.c.FLIP_TILE||Z===c.c.ROTATE_TILE||Z===c.c.FLIP_N_ROTATE_TILE?h.concat(M[(P+K)%2]):Z===c.c.FLIP_ROW||Z===c.c.ROTATE_ROW||Z===c.c.FLIP_N_ROTATE_ROW?h.concat(M[P%2]):h.concat(M[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const C=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE;v.b._ComputeSides(C,F,I,D,h,M.frontUVs,M.backUVs);const R=new v.b;R.indices=I,R.hM=F,R.QM=D,R.sM=h;const W=C===v.b.DOUBLESIDE?Q.concat(Q):Q;return R.IM=W,R}function B(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return j(Z).RM(x,Z.updatable),x}function U(M){const Z=M.faceUV||new Array(6),P=M.faceColors,w=M.pattern||c.c.NO_FLIP,mM=M.width||M.size||1,K=M.height||M.size||1,d=M.depth||M.size||1,O=M.tileWidth||M.tileSize||1,B=M.tileHeight||M.tileSize||1,U=M.alignHorizontal||0,n=M.alignVertical||0,L=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE;for(let c=0;c<6;c++)void 0===Z[c]&&(Z[c]=new x.Vector4(0,0,1,1)),P&&void 0===P[c]&&(P[c]=new H.Ic(1,1,1,1));const u=mM/2,N=K/2,J=d/2,t=[];for(let x=0;x<2;x++)t[x]=j({pattern:w,tileWidth:O,tileHeight:B,width:mM,height:K,alignVertical:n,alignHorizontal:U,sideOrientation:L});for(let x=2;x<4;x++)t[x]=j({pattern:w,tileWidth:O,tileHeight:B,width:d,height:K,alignVertical:n,alignHorizontal:U,sideOrientation:L});let F=n;n===c.c.BOTTOM?F=c.c.TOP:n===c.c.TOP&&(F=c.c.BOTTOM);for(let x=4;x<6;x++)t[x]=j({pattern:w,tileWidth:O,tileHeight:B,width:mM,height:d,alignVertical:F,alignHorizontal:U,sideOrientation:L});let D=[],l=[],h=[],Q=[];const I=[],s=[],C=[],R=[];let W=0,k=0;for(let c=0;c<6;c++){const M=t[c].hM.length;s[c]=[],C[c]=[];for(let Z=0;Z<M/3;Z++)s[c].push(new x.BZ(t[c].hM[3*Z],t[c].hM[3*Z+1],t[c].hM[3*Z+2])),C[c].push(new x.BZ(t[c].QM[3*Z],t[c].QM[3*Z+1],t[c].QM[3*Z+2]));W=t[c].sM.length,R[c]=[];for(let P=0;P<W;P+=2)R[c][P]=Z[c].x+(Z[c].z-Z[c].x)*t[c].sM[P],R[c][P+1]=Z[c].y+(Z[c].w-Z[c].y)*t[c].sM[P+1],G.e&&(R[c][P+1]=1-R[c][P+1]);if(h=h.concat(R[c]),Q=Q.concat(t[c].indices.map((M=>M+k))),k+=s[c].length,P)for(let Z=0;Z<4;Z++)I.push(P[c].r,P[c].g,P[c].b,P[c].a)}const A=new x.BZ(0,0,J),o=x.Matrix.RotationY(Math.PI);D=s[0].map((M=>x.BZ.TransformNormal(M,o).add(A))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[]),l=C[0].map((M=>x.BZ.TransformNormal(M,o))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[]),D=D.concat(s[1].map((M=>M.UZ(A))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[])),l=l.concat(C[1].map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[]));const E=new x.BZ(u,0,0),r=x.Matrix.RotationY(-Math.PI/2);D=D.concat(s[2].map((M=>x.BZ.TransformNormal(M,r).add(E))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[])),l=l.concat(C[2].map((M=>x.BZ.TransformNormal(M,r))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[]));const q=x.Matrix.RotationY(Math.PI/2);D=D.concat(s[3].map((M=>x.BZ.TransformNormal(M,q).UZ(E))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[])),l=l.concat(C[3].map((M=>x.BZ.TransformNormal(M,q))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[]));const e=new x.BZ(0,N,0),b=x.Matrix.RotationX(Math.PI/2);D=D.concat(s[4].map((M=>x.BZ.TransformNormal(M,b).add(e))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[])),l=l.concat(C[4].map((M=>x.BZ.TransformNormal(M,b))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[]));const a=x.Matrix.RotationX(-Math.PI/2);D=D.concat(s[5].map((M=>x.BZ.TransformNormal(M,a).UZ(e))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[])),l=l.concat(C[5].map((M=>x.BZ.TransformNormal(M,a))).map((M=>[M.x,M.y,M.z])).reduce(((M,Z)=>M.concat(Z)),[])),v.b._ComputeSides(L,D,Q,l,h);const y=new v.b;if(y.indices=Q,y.hM=D,y.QM=l,y.sM=h,P){const M=L===v.b.DOUBLESIDE?I.concat(I):I;y.IM=M}return y}function n(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return U(Z).RM(x,Z.updatable),x}v.b.CreateTiledPlane=j;v.b.CreateTiledBox=U;var L=P(13736),u=P(12596),N=P(12561);function J(M){const Z=M.height||2;let P=0===M.diameterTop?0:M.diameterTop||M.diameter||1,w=0===M.diameterBottom?0:M.diameterBottom||M.diameter||1;P=P||1e-5,w=w||1e-5;const mM=0|(M.tessellation||24),K=0|(M.subdivisions||1),d=!!M.hasRings,O=!!M.enclose,j=0===M.cap?0:M.cap||c.c.CAP_ALL,B=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,U=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,n=M.faceUV||new Array(3),L=M.faceColors,u=2+(1+(1!==B&&O?2:0))*(d?K:1);let J;for(J=0;J<u;J++)L&&void 0===L[J]&&(L[J]=new H.Ic(1,1,1,1));for(J=0;J<u;J++)n&&void 0===n[J]&&(n[J]=new x.Vector4(0,0,1,1));const t=[],F=[],D=[],l=[],h=[],Q=2*Math.PI*B/mM;let I,s,C;const R=(w-P)/2/Z,W=x.BZ.Zero(),k=x.BZ.Zero(),A=x.BZ.Zero(),o=x.BZ.Zero(),E=x.BZ.Zero(),r=N.c.Y;let q,e,b,a=1,y=1,f=0,Y=0;for(q=0;q<=K;q++)for(s=q/K,C=(s*(P-w)+w)/2,a=d&&0!==q&&q!==K?2:1,b=0;b<a;b++){for(d&&(y+=b),O&&(y+=2*b),e=0;e<=mM;e++)I=e*Q,W.x=Math.cos(-I)*C,W.y=-Z/2+s*Z,W.z=Math.sin(-I)*C,0===P&&q===K?(k.x=D[D.length-3*(mM+1)],k.y=D[D.length-3*(mM+1)+1],k.z=D[D.length-3*(mM+1)+2]):(k.x=W.x,k.z=W.z,k.y=Math.sqrt(k.x*k.x+k.z*k.z)*R,k.normalize()),0===e&&(A.v(W),o.v(k)),F.push(W.x,W.y,W.z),D.push(k.x,k.y,k.z),Y=d?f!==y?n[y].y:n[y].w:n[y].y+(n[y].w-n[y].y)*s,l.push(n[y].x+(n[y].z-n[y].x)*e/mM,G.e?1-Y:Y),L&&h.push(L[y].r,L[y].g,L[y].b,L[y].a);1!==B&&O&&(F.push(W.x,W.y,W.z),F.push(0,W.y,0),F.push(0,W.y,0),F.push(A.x,A.y,A.z),x.BZ.CrossToRef(r,k,E),E.normalize(),D.push(E.x,E.y,E.z,E.x,E.y,E.z),x.BZ.CrossToRef(o,r,E),E.normalize(),D.push(E.x,E.y,E.z,E.x,E.y,E.z),Y=d?f!==y?n[y+1].y:n[y+1].w:n[y+1].y+(n[y+1].w-n[y+1].y)*s,l.push(n[y+1].x,G.e?1-Y:Y),l.push(n[y+1].z,G.e?1-Y:Y),Y=d?f!==y?n[y+2].y:n[y+2].w:n[y+2].y+(n[y+2].w-n[y+2].y)*s,l.push(n[y+2].x,G.e?1-Y:Y),l.push(n[y+2].z,G.e?1-Y:Y),L&&(h.push(L[y+1].r,L[y+1].g,L[y+1].b,L[y+1].a),h.push(L[y+1].r,L[y+1].g,L[y+1].b,L[y+1].a),h.push(L[y+2].r,L[y+2].g,L[y+2].b,L[y+2].a),h.push(L[y+2].r,L[y+2].g,L[y+2].b,L[y+2].a))),f!==y&&(f=y)}const z=1!==B&&O?mM+4:mM;for(q=0,y=0;y<K;y++){let M=0,Z=0,P=0,x=0;for(e=0;e<mM;e++)M=q*(z+1)+e,Z=(q+1)*(z+1)+e,P=q*(z+1)+(e+1),x=(q+1)*(z+1)+(e+1),t.push(M,Z,P),t.push(x,P,Z);1!==B&&O&&(t.push(M+2,Z+2,P+2),t.push(x+2,P+2,Z+2),t.push(M+4,Z+4,P+4),t.push(x+4,P+4,Z+4)),q=d?q+2:q+1}const i=M=>{const c=M?P/2:w/2;if(0===c)return;let v,K,d;const O=M?n[u-1]:n[0];let H=null;L&&(H=M?L[u-1]:L[0]);const j=F.length/3,U=M?Z/2:-Z/2,N=new x.BZ(0,U,0);F.push(N.x,N.y,N.z),D.push(0,M?1:-1,0);const J=O.y+.5*(O.w-O.y);l.push(O.x+.5*(O.z-O.x),G.e?1-J:J),H&&h.push(H.r,H.g,H.b,H.a);const Q=new x.Vector2(.5,.5);for(d=0;d<=mM;d++){v=2*Math.PI*d*B/mM;const Z=Math.cos(-v),P=Math.sin(-v);K=new x.BZ(Z*c,U,P*c);const w=new x.Vector2(Z*Q.x+.5,P*Q.y+.5);F.push(K.x,K.y,K.z),D.push(0,M?1:-1,0);const j=O.y+(O.w-O.y)*w.y;l.push(O.x+(O.z-O.x)*w.x,G.e?1-j:j),H&&h.push(H.r,H.g,H.b,H.a)}for(d=0;d<mM;d++)M?(t.push(j),t.push(j+(d+2)),t.push(j+(d+1))):(t.push(j),t.push(j+(d+1)),t.push(j+(d+2)))};j!==c.c.CAP_START&&j!==c.c.CAP_ALL||i(!1),j!==c.c.CAP_END&&j!==c.c.CAP_ALL||i(!0),v.b._ComputeSides(U,F,t,D,l,M.frontUVs,M.backUVs);const T=new v.b;return T.indices=t,T.hM=F,T.QM=D,T.sM=l,L&&(T.IM=h),T}function t(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return J(Z).RM(x,Z.updatable),x}function F(M){const Z=[],P=[],c=[],w=[],mM=M.diameter||1,K=M.thickness||.5,d=0|(M.tessellation||16),O=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,H=d+1;for(let v=0;v<=d;v++){const M=v/d,O=v*Math.PI*2/d-Math.PI/2,j=x.Matrix.Translation(mM/2,0,0).multiply(x.Matrix.RotationY(O));for(let mM=0;mM<=d;mM++){const O=1-mM/d,B=mM*Math.PI*2/d+Math.PI,U=Math.cos(B),n=Math.sin(B);let L=new x.BZ(U,n,0),u=L.scale(K/2);const N=new x.Vector2(M,O);u=x.BZ.TransformCoordinates(u,j),L=x.BZ.TransformNormal(L,j),P.push(u.x,u.y,u.z),c.push(L.x,L.y,L.z),w.push(N.x,G.e?1-N.y:N.y);const J=(v+1)%H,t=(mM+1)%H;Z.push(v*H+mM),Z.push(v*H+t),Z.push(J*H+mM),Z.push(v*H+t),Z.push(J*H+t),Z.push(J*H+mM)}}v.b._ComputeSides(O,P,Z,c,w,M.frontUVs,M.backUVs);const j=new v.b;return j.indices=Z,j.hM=P,j.QM=c,j.sM=w,j}function D(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return F(Z).RM(x,Z.updatable),x}v.b.CreateCylinder=J,c.c.CreateCylinder=(M,Z,P,x,w,v,G,mM,K)=>{void 0!==G&&G instanceof u.e||(void 0!==G&&(K=mM||c.c.DEFAULTSIDE,mM=G),G=v,v=1);return t(M,{height:Z,diameterTop:P,diameterBottom:x,tessellation:w,subdivisions:v,sideOrientation:K,updatable:mM},G)};function l(M){const Z=[],P=[],c=[],w=[],mM=M.radius||2,K=M.tube||.5,d=M.radialSegments||32,O=M.tubularSegments||32,H=M.p||2,j=M.q||3,B=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,U=M=>{const Z=Math.cos(M),P=Math.sin(M),c=j/H*M,w=Math.cos(c),v=mM*(2+w)*.5*Z,G=mM*(2+w)*P*.5,K=mM*Math.sin(c)*.5;return new x.BZ(v,G,K)};let n,L;for(n=0;n<=d;n++){const M=n%d/d*2*H*Math.PI,Z=U(M),c=U(M+.01),v=c.UZ(Z);let mM=c.add(Z);const j=x.BZ.Cross(v,mM);for(mM=x.BZ.Cross(j,v),j.normalize(),mM.normalize(),L=0;L<O;L++){const M=L%O/O*2*Math.PI,x=-K*Math.cos(M),c=K*Math.sin(M);P.push(Z.x+x*mM.x+c*j.x),P.push(Z.y+x*mM.y+c*j.y),P.push(Z.z+x*mM.z+c*j.z),w.push(n/d),w.push(G.e?1-L/O:L/O)}}for(n=0;n<d;n++)for(L=0;L<O;L++){const M=(L+1)%O,P=n*O+L,x=(n+1)*O+L,c=(n+1)*O+M,w=n*O+M;Z.push(w),Z.push(x),Z.push(P),Z.push(w),Z.push(c),Z.push(x)}v.b.ComputeNormals(P,Z,c),v.b._ComputeSides(B,P,Z,c,w,M.frontUVs,M.backUVs);const u=new v.b;return u.indices=Z,u.hM=P,u.QM=c,u.sM=w,u}function h(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return l(Z).RM(x,Z.updatable),x}v.b.CreateTorus=F,c.c.CreateTorus=(M,Z,P,x,c,w,v)=>D(M,{diameter:Z,thickness:P,tessellation:x,sideOrientation:v,updatable:w},c);v.b.CreateTorusKnot=l,c.c.CreateTorusKnot=(M,Z,P,x,c,w,v,G,mM,K)=>h(M,{radius:Z,tube:P,radialSegments:x,tubularSegments:c,p:w,q:v,sideOrientation:K,updatable:mM},G);var Q=P(14247),I=P(12925),s=P(12570);function C(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=Z.path,w=Z.shape,v=Z.scale||1,G=Z.rotation||0,mM=0===Z.cap?0:Z.cap||c.c.NO_CAP,K=Z.updatable,d=c.c._GetDefaultSideOrientation(Z.sideOrientation),O=Z.instance||null,H=Z.invertUV||!1,j=Z.closeShape||!1,B=Z.closePath||!1,U=Z.capFunction||null;return W(M,w,x,v,G,null,null,B,j,mM,!1,P,!!K,d,O,H,Z.frontUVs||null,Z.backUVs||null,Z.firstNormal||null,!!Z.adjustFrame,U)}function R(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=Z.path,w=Z.shape,v=Z.scaleFunction||(()=>1),G=Z.rotationFunction||(()=>0),mM=Z.closePath||Z.ribbonCloseArray||!1,K=Z.closeShape||Z.ribbonClosePath||!1,d=0===Z.cap?0:Z.cap||c.c.NO_CAP,O=Z.updatable,H=Z.firstNormal||null,j=Z.adjustFrame||!1,B=c.c._GetDefaultSideOrientation(Z.sideOrientation),U=Z.instance,n=Z.invertUV||!1,L=Z.capFunction||null;return W(M,w,x,null,null,v,G,mM,K,d,!0,P,!!O,B,U||null,n,Z.frontUVs||null,Z.backUVs||null,H,j,L||null)}function W(M,Z,P,w,v,G,mM,d,O,H,j,B,U,n,L,u,N,J,t,F,D){const l=(M,Z,P,w,v,G,mM,K,d,O,H)=>{const j=P.getTangents(),B=P.getNormals(),U=P.getBinormals(),n=P.getDistances();if(H)for(let c=0;c<j.length;c++)if(0==j[c].x&&0==j[c].y&&0==j[c].z&&j[c].v(j[c-1]),0==B[c].x&&0==B[c].y&&0==B[c].z&&B[c].v(B[c-1]),0==U[c].x&&0==U[c].y&&0==U[c].z&&U[c].v(U[c-1]),c>0){let M=j[c-1];x.BZ.Dot(M,j[c])<0&&j[c].scaleInPlace(-1),M=B[c-1],x.BZ.Dot(M,B[c])<0&&B[c].scaleInPlace(-1),M=U[c-1],x.BZ.Dot(M,U[c])<0&&U[c].scaleInPlace(-1)}let L=0;const u=O&&K?K:()=>null!==G?G:0,N=O&&mM?mM:()=>null!==v?v:1;let J=d===c.c.NO_CAP||d===c.c.CAP_END?0:2;const t=x.TmpVectors.Matrix[0];for(let c=0;c<Z.length;c++){const P=[],v=u(c,n[c]),G=N(c,n[c]);x.Matrix.RotationAxisToRef(j[c],L,t);for(let w=0;w<M.length;w++){const v=j[c].scale(M[w].z).add(B[c].scale(M[w].x)).add(U[c].scale(M[w].y)),mM=x.BZ.Zero();x.BZ.TransformCoordinatesToRef(v,t,mM),mM.scaleInPlace(G).addInPlace(Z[c]),P[w]=mM}w[J]=P,L+=v,J++}const F=D||(M=>{const Z=Array(),P=x.BZ.Zero();let c;for(c=0;c<M.length;c++)P.addInPlace(M[c]);for(P.scaleInPlace(1/M.length),c=0;c<M.length;c++)Z.push(P);return Z});switch(d){case c.c.NO_CAP:break;case c.c.CAP_START:w[0]=F(w[2]),w[1]=w[2];break;case c.c.CAP_END:w[J]=w[J-1],w[J+1]=F(w[J-1]);break;case c.c.CAP_ALL:w[0]=F(w[2]),w[1]=w[2],w[J]=w[J-1],w[J+1]=F(w[J-1])}return w};let h,Q;if(L){const M=L._creationDataStorage;return h=t?M.path3D.update(P,t):M.path3D.update(P),Q=l(Z,P,M.path3D,M.pathArray,w,v,G,mM,M.cap,j,F),L=K("",{pathArray:Q,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:L},B||void 0)}h=t?new s.m(P,t):new s.m(P);Q=l(Z,P,h,new Array,w,v,G,mM,H=H<0||H>3?0:H,j,F);const I=K(M,{pathArray:Q,closeArray:d,closePath:O,updatable:U,sideOrientation:n,invertUV:u,frontUVs:N||void 0,backUVs:J||void 0},B);return I._creationDataStorage.pathArray=Q,I._creationDataStorage.path3D=h,I._creationDataStorage.cap=H,I}function k(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=Z.arc?Z.arc<=0||Z.arc>1?1:Z.arc:1,v=void 0===Z.closed||Z.closed,G=Z.shape,mM=Z.radius||1,d=Z.tessellation||64,O=Z.clip||0,H=Z.updatable,j=c.c._GetDefaultSideOrientation(Z.sideOrientation),B=Z.cap||c.c.NO_CAP,U=2*Math.PI,n=[],L=Z.invertUV||!1;let u=0,N=0;const J=U/d*w;let t,F;for(u=0;u<=d-O;u++){for(F=[],B!=c.c.CAP_START&&B!=c.c.CAP_ALL||(F.push(new x.BZ(0,G[0].y,0)),F.push(new x.BZ(Math.cos(u*J)*G[0].x*mM,G[0].y,Math.sin(u*J)*G[0].x*mM))),N=0;N<G.length;N++)t=new x.BZ(Math.cos(u*J)*G[N].x*mM,G[N].y,Math.sin(u*J)*G[N].x*mM),F.push(t);B!=c.c.CAP_END&&B!=c.c.CAP_ALL||(F.push(new x.BZ(Math.cos(u*J)*G[G.length-1].x*mM,G[G.length-1].y,Math.sin(u*J)*G[G.length-1].x*mM)),F.push(new x.BZ(0,G[G.length-1].y,0))),n.push(F)}return K(M,{pathArray:n,closeArray:v,sideOrientation:j,updatable:H,invertUV:L,frontUVs:Z.frontUVs,backUVs:Z.backUVs},P)}c.c.ExtrudeShape=function(M,Z,P,x,w,v){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mM=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0;return C(M,{shape:Z,path:P,scale:x,rotation:w,cap:0===v?0:v||c.c.NO_CAP,sideOrientation:K,instance:d,updatable:mM},G)},c.c.ExtrudeShapeCustom=(M,Z,P,x,w,v,G,mM,K,d,O,H)=>R(M,{shape:Z,path:P,scaleFunction:x,rotationFunction:w,ribbonCloseArray:v,ribbonClosePath:G,cap:0===mM?0:mM||c.c.NO_CAP,sideOrientation:O,instance:H,updatable:d},K);c.c.CreateLathe=(M,Z,P,x,c,w,v)=>k(M,{shape:Z,radius:P,tessellation:x,sideOrientation:v,updatable:w},c);var A=P(13651),o=P(13602);function E(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=Z.path;let v=Z.instance,G=1;void 0!==Z.radius?G=Z.radius:v&&(G=v._creationDataStorage.radius);const mM=Z.tessellation||64,d=Z.radiusFunction||null;let O=Z.cap||c.c.NO_CAP;const H=Z.invertUV||!1,j=Z.updatable,B=c.c._GetDefaultSideOrientation(Z.sideOrientation);Z.arc=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1;const U=(M,Z,P,w,v,G,mM,K)=>{const d=Z.getTangents(),O=Z.getNormals(),H=Z.getDistances(),j=2*Math.PI/v*K,B=G||(()=>w);let U,n,L,u;const N=x.TmpVectors.Matrix[0];let J=mM===c.c.NO_CAP||mM===c.c.CAP_END?0:2;for(let c=0;c<M.length;c++){n=B(c,H[c]),U=Array(),L=O[c];for(let Z=0;Z<v;Z++)x.Matrix.RotationAxisToRef(d[c],j*Z,N),u=U[Z]?U[Z]:x.BZ.Zero(),x.BZ.TransformCoordinatesToRef(L,N,u),u.scaleInPlace(n).addInPlace(M[c]),U[Z]=u;P[J]=U,J++}const t=(Z,P)=>{const x=Array();for(let c=0;c<Z;c++)x.push(M[P]);return x};switch(mM){case c.c.NO_CAP:break;case c.c.CAP_START:P[0]=t(v,0),P[1]=P[2].slice(0);break;case c.c.CAP_END:P[J]=P[J-1].slice(0),P[J+1]=t(v,M.length-1);break;case c.c.CAP_ALL:P[0]=t(v,0),P[1]=P[2].slice(0),P[J]=P[J-1].slice(0),P[J+1]=t(v,M.length-1)}return P};let n,L;if(v){const M=v._creationDataStorage,P=Z.arc||M.arc;return n=M.path3D.update(w),L=U(w,n,M.pathArray,G,M.tessellation,d,M.cap,P),v=K("",{pathArray:L,instance:v}),M.path3D=n,M.pathArray=L,M.arc=P,M.radius=G,v}n=new s.m(w);O=O<0||O>3?0:O,L=U(w,n,new Array,G,mM,d,O,Z.arc);const u=K(M,{pathArray:L,closePath:!0,closeArray:!1,updatable:j,sideOrientation:B,invertUV:H,frontUVs:Z.frontUVs,backUVs:Z.backUVs},P);return u._creationDataStorage.pathArray=L,u._creationDataStorage.path3D=n,u._creationDataStorage.tessellation=mM,u._creationDataStorage.cap=O,u._creationDataStorage.arc=Z.arc,u._creationDataStorage.radius=G,u}function r(M){const Z=[];Z[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},Z[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},Z[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},Z[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},Z[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},Z[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},Z[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},Z[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},Z[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},Z[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},Z[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},Z[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},Z[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},Z[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},Z[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const P=M.type&&(M.type<0||M.type>=Z.length)?0:M.type||0,c=M.size,w=M.sizeX||c||1,mM=M.sizeY||c||1,K=M.sizeZ||c||1,d=M.custom||Z[P],O=d.face.length,j=M.faceUV||new Array(O),B=M.faceColors,U=void 0===M.flat||M.flat,n=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,L=[],u=[],N=[],J=[],t=[];let F=0,D=0;const l=[];let h,Q,I,s,C,R,W=0,k=0;if(U)for(k=0;k<O;k++)B&&void 0===B[k]&&(B[k]=new H.Ic(1,1,1,1)),j&&void 0===j[k]&&(j[k]=new x.Vector4(0,0,1,1));if(U)for(k=0;k<O;k++){const M=d.face[k].length;for(I=2*Math.PI/M,s=.5*Math.tan(I/2),C=.5,W=0;W<M;W++)L.push(d.vertex[d.face[k][W]][0]*w,d.vertex[d.face[k][W]][1]*mM,d.vertex[d.face[k][W]][2]*K),l.push(F),F++,h=j[k].x+(j[k].z-j[k].x)*(.5+s),Q=j[k].y+(j[k].w-j[k].y)*(C-.5),J.push(h,G.e?1-Q:Q),R=s*Math.cos(I)-C*Math.sin(I),C=s*Math.sin(I)+C*Math.cos(I),s=R,B&&t.push(B[k].r,B[k].g,B[k].b,B[k].a);for(W=0;W<M-2;W++)u.push(l[0+D],l[W+2+D],l[W+1+D]);D+=M}else{for(W=0;W<d.vertex.length;W++)L.push(d.vertex[W][0]*w,d.vertex[W][1]*mM,d.vertex[W][2]*K),J.push(0,G.e?1:0);for(k=0;k<O;k++)for(W=0;W<d.face[k].length-2;W++)u.push(d.face[k][0],d.face[k][W+2],d.face[k][W+1])}v.b.ComputeNormals(L,u,N),v.b._ComputeSides(n,L,u,N,J,M.frontUVs,M.backUVs);const A=new v.b;return A.hM=L,A.indices=u,A.QM=N,A.sM=J,B&&U&&(A.IM=t),A}function q(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return r(Z).RM(x,Z.updatable),x}c.c.CreateTube=(M,Z,P,x,c,w,v,G,mM,K)=>E(M,{path:Z,radius:P,tessellation:x,radiusFunction:c,arc:1,cap:w,updatable:G,sideOrientation:mM,instance:K},v);function e(M){const Z=M.sideOrientation||v.b.DEFAULTSIDE,P=M.radius||1,c=void 0===M.flat||M.flat,w=0|(M.subdivisions||4),mM=M.radiusX||P,K=M.radiusY||P,d=M.radiusZ||P,O=(1+Math.sqrt(5))/2,H=[-1,O,-0,1,O,0,-1,-O,0,1,-O,0,0,-1,-O,0,1,-O,0,-1,O,0,1,O,O,0,1,O,0,-1,-O,0,1,-O,0,-1],j=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],B=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],U=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],n=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],L=[],u=[],N=[],J=[];let t=0;const F=new Array(3),D=new Array(3);let l;for(l=0;l<3;l++)F[l]=x.BZ.Zero(),D[l]=x.Vector2.Zero();for(let v=0;v<20;v++){for(l=0;l<3;l++){const M=j[3*v+l];F[l].lc(H[3*B[M]],H[3*B[M]+1],H[3*B[M]+2]),F[l].normalize(),D[l].lc(.134765625*U[2*M]+.05859375+-.0390625*n[v],.2333984375*U[2*M+1]+.025390625+.01953125*n[v])}const M=(M,Z,P,v)=>{const O=x.BZ.Lerp(F[0],F[2],Z/w),H=x.BZ.Lerp(F[1],F[2],Z/w),j=w===Z?F[2]:x.BZ.Lerp(O,H,M/(w-Z));let B;if(j.normalize(),c){const M=x.BZ.Lerp(F[0],F[2],v/w),Z=x.BZ.Lerp(F[1],F[2],v/w);B=x.BZ.Lerp(M,Z,P/(w-v))}else B=new x.BZ(j.x,j.y,j.z);B.x/=mM,B.y/=K,B.z/=d,B.normalize();const U=x.Vector2.Lerp(D[0],D[2],Z/w),n=x.Vector2.Lerp(D[1],D[2],Z/w),l=w===Z?D[2]:x.Vector2.Lerp(U,n,M/(w-Z));u.push(j.x*mM,j.y*K,j.z*d),N.push(B.x,B.y,B.z),J.push(l.x,G.e?1-l.y:l.y),L.push(t),t++};for(let Z=0;Z<w;Z++)for(let P=0;P+Z<w;P++)M(P,Z,P+1/3,Z+1/3),M(P+1,Z,P+1/3,Z+1/3),M(P,Z+1,P+1/3,Z+1/3),P+Z+1<w&&(M(P+1,Z,P+2/3,Z+2/3),M(P+1,Z+1,P+2/3,Z+2/3),M(P,Z+1,P+2/3,Z+2/3))}v.b._ComputeSides(Z,u,L,N,J,M.frontUVs,M.backUVs);const h=new v.b;return h.indices=L,h.hM=u,h.QM=N,h.sM=J,h}function b(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new c.c(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),x._originalBuilderSideOrientation=Z.sideOrientation;return e(Z).RM(x,Z.updatable),x}v.b.CreatePolyhedron=r,c.c.CreatePolyhedron=(M,Z,P)=>q(M,Z,P);v.b.CreateIcoSphere=e,c.c.CreateIcoSphere=(M,Z,P)=>b(M,Z,P);var a=P(12387);const y=new x.BZ(1,0,0),f=new x.BZ(-1,0,0),Y=new x.BZ(0,1,0),z=new x.BZ(0,-1,0),i=new x.BZ(0,0,1),T=new x.BZ(0,0,-1);class p{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.BZ.Zero(),Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.BZ.Up(),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.Vector2.Zero(),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mM=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=M,this.normal=Z,this.uv=P,this.vertexIdx=c,this.vertexIdxForBones=w,this.localPositionOverride=v,this.localNormalOverride=G,this.matrixIndicesOverride=mM,this.matrixWeightsOverride=K}clone(){var M,Z,P,x;return new p(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(M=this.localPositionOverride)||void 0===M?void 0:M.slice(),null===(Z=this.localNormalOverride)||void 0===Z?void 0:Z.slice(),null===(P=this.matrixIndicesOverride)||void 0===P?void 0:P.slice(),null===(x=this.matrixWeightsOverride)||void 0===x?void 0:x.slice())}}function S(M,Z,P){var mM,K,d,O,H;const j=!!Z.skeleton,B=!(null===(mM=Z.morphTargetManager)||void 0===mM||!mM.numTargets),U=P.localMode||j,n=Z.Fc(),L=j||B?Z.Km(!0,!0):Z.getVerticesData(w.g.PositionKind),u=j||B?Z.getNormalsData(!0,!0):Z.getVerticesData(w.g.NormalKind),N=U?j?Z.getVerticesData(w.g.PositionKind):L:null,J=U?j?Z.getVerticesData(w.g.NormalKind):u:null,t=Z.getVerticesData(w.g.UVKind),F=j?Z.getVerticesData(w.g.MatricesIndicesKind):null,D=j?Z.getVerticesData(w.g.MatricesWeightsKind):null,l=j?Z.getVerticesData(w.g.MatricesIndicesExtraKind):null,h=j?Z.getVerticesData(w.g.MatricesWeightsExtraKind):null,Q=P.position||x.BZ.Zero();let I=P.normal||x.BZ.Up();const s=P.size||x.BZ.One(),C=P.angle||0;if(!I){const M=new x.BZ(0,0,1),P=Z.DM().activeCamera,c=x.BZ.TransformCoordinates(M,P.getWorldMatrix());I=P.globalPosition.UZ(c)}const R=-Math.atan2(I.z,I.x)-Math.PI/2,W=Math.sqrt(I.x*I.x+I.z*I.z),k=Math.atan2(I.y,W),A=new v.b;A.indices=[],A.hM=[],A.QM=[],A.sM=[],A.matricesIndices=j?[]:null,A.matricesWeights=j?[]:null,A.matricesIndicesExtra=l?[]:null,A.matricesWeightsExtra=h?[]:null;let o=0;const E=(M,Z)=>{const c=new p;if(!n||!L||!u)return c;const w=n[M];if(c.vertexIdx=3*w,c.vertexIdxForBones=4*w,c.position=new x.BZ(L[3*w],L[3*w+1],L[3*w+2]),x.BZ.TransformCoordinatesToRef(c.position,Z,c.position),c.normal=new x.BZ(u[3*w],u[3*w+1],u[3*w+2]),x.BZ.TransformNormalToRef(c.normal,Z,c.normal),P.captureUVS&&t){const M=t[2*w+1];c.uv=new x.Vector2(t[2*w],G.e?1-M:M)}return c},r=[0,0,0,0],q=(M,Z)=>{if(0===M.length)return M;const P=.5*Math.abs(x.BZ.Dot(s,Z)),c=(M,Z,P,x)=>{for(let c=0;c<x;++c)if(M[P+c]===Z)return P+c;return-1},w=(M,w)=>{const v=x.BZ.GetClipFactor(M.position,w.position,Z,P);let G=r,mM=r;if(F&&D){const Z=M.matrixIndicesOverride?0:M.vertexIdxForBones,P=M.matrixIndicesOverride??F,x=M.matrixWeightsOverride??D,K=w.matrixIndicesOverride?0:w.vertexIdxForBones,d=w.matrixIndicesOverride??F,O=w.matrixWeightsOverride??D;G=[0,0,0,0],mM=[0,0,0,0];let H=0;for(let M=0;M<4;++M)if(x[Z+M]>0){const w=c(d,P[Z+M],K,4);G[H]=P[Z+M],mM[H]=(0,a.Lerp)(x[Z+M],w>=0?O[w]:0,v),H++}for(let M=0;M<4&&H<4;++M){const x=d[K+M];-1===c(P,x,Z,4)&&(G[H]=x,mM[H]=(0,a.Lerp)(0,O[K+M],v),H++)}const j=mM[0]+mM[1]+mM[2]+mM[3];mM[0]/=j,mM[1]/=j,mM[2]/=j,mM[3]/=j}const K=M.localPositionOverride?M.localPositionOverride[0]:(null===N||void 0===N?void 0:N[M.vertexIdx])??0,d=M.localPositionOverride?M.localPositionOverride[1]:(null===N||void 0===N?void 0:N[M.vertexIdx+1])??0,O=M.localPositionOverride?M.localPositionOverride[2]:(null===N||void 0===N?void 0:N[M.vertexIdx+2])??0,H=w.localPositionOverride?w.localPositionOverride[0]:(null===N||void 0===N?void 0:N[w.vertexIdx])??0,j=w.localPositionOverride?w.localPositionOverride[1]:(null===N||void 0===N?void 0:N[w.vertexIdx+1])??0,B=w.localPositionOverride?w.localPositionOverride[2]:(null===N||void 0===N?void 0:N[w.vertexIdx+2])??0,U=M.localNormalOverride?M.localNormalOverride[0]:(null===J||void 0===J?void 0:J[M.vertexIdx])??0,n=M.localNormalOverride?M.localNormalOverride[1]:(null===J||void 0===J?void 0:J[M.vertexIdx+1])??0,L=M.localNormalOverride?M.localNormalOverride[2]:(null===J||void 0===J?void 0:J[M.vertexIdx+2])??0,u=U+((w.localNormalOverride?w.localNormalOverride[0]:(null===J||void 0===J?void 0:J[w.vertexIdx])??0)-U)*v,t=n+((w.localNormalOverride?w.localNormalOverride[1]:(null===J||void 0===J?void 0:J[w.vertexIdx+1])??0)-n)*v,l=L+((w.localNormalOverride?w.localNormalOverride[2]:(null===J||void 0===J?void 0:J[w.vertexIdx+2])??0)-L)*v,h=Math.sqrt(u*u+t*t+l*l);return new p(x.BZ.Lerp(M.position,w.position,v),x.BZ.Lerp(M.normal,w.normal,v).normalize(),x.Vector2.Lerp(M.uv,w.uv,v),-1,-1,N?[K+(H-K)*v,d+(j-d)*v,O+(B-O)*v]:null,J?[u/h,t/h,l/h]:null,G,mM)};let v=null;M.length>3&&(v=[]);for(let G=0;G<M.length;G+=3){let c=0,mM=null,K=null,d=null,O=null;const H=x.BZ.Dot(M[G].position,Z)-P>0,j=x.BZ.Dot(M[G+1].position,Z)-P>0,B=x.BZ.Dot(M[G+2].position,Z)-P>0;switch(c=(H?1:0)+(j?1:0)+(B?1:0),c){case 0:M.length>3?(v.push(M[G]),v.push(M[G+1]),v.push(M[G+2])):v=M;break;case 1:if(v=v??new Array,H&&(mM=M[G+1],K=M[G+2],d=w(M[G],mM),O=w(M[G],K)),j){mM=M[G],K=M[G+2],d=w(M[G+1],mM),O=w(M[G+1],K),v.push(d),v.push(K.clone()),v.push(mM.clone()),v.push(K.clone()),v.push(d.clone()),v.push(O);break}B&&(mM=M[G],K=M[G+1],d=w(M[G+2],mM),O=w(M[G+2],K)),mM&&K&&d&&O&&(v.push(mM.clone()),v.push(K.clone()),v.push(d),v.push(O),v.push(d.clone()),v.push(K.clone()));break;case 2:v=v??new Array,H||(mM=M[G].clone(),K=w(mM,M[G+1]),d=w(mM,M[G+2]),v.push(mM),v.push(K),v.push(d)),j||(mM=M[G+1].clone(),K=w(mM,M[G+2]),d=w(mM,M[G]),v.push(mM),v.push(K),v.push(d)),B||(mM=M[G+2].clone(),K=w(mM,M[G]),d=w(mM,M[G+1]),v.push(mM),v.push(K),v.push(d))}}return v},e=Z instanceof c.c?Z:null,b=null===e||void 0===e?void 0:e._thinInstanceDataStorage.matrixData,S=(null===e||void 0===e?void 0:e.Cc)||1,X=x.TmpVectors.Matrix[0];X.v(x.Matrix.IdentityReadOnly);for(let c=0;c<S;++c){if(null!==e&&void 0!==e&&e.hasThinInstances&&b){const M=16*c;X.setRowFromFloats(0,b[M+0],b[M+1],b[M+2],b[M+3]),X.setRowFromFloats(1,b[M+4],b[M+5],b[M+6],b[M+7]),X.setRowFromFloats(2,b[M+8],b[M+9],b[M+10],b[M+11]),X.setRowFromFloats(3,b[M+12],b[M+13],b[M+14],b[M+15])}const M=x.Matrix.RotationYawPitchRoll(R,k,C).multiply(x.Matrix.Translation(Q.x,Q.y,Q.z)),w=x.Matrix.Invert(M),v=Z.getWorldMatrix(),mM=X.multiply(v).multiply(w),K=new Array(3);for(let Z=0;Z<n.length;Z+=3){let M=K;if(M[0]=E(Z,mM),M[1]=E(Z+1,mM),M[2]=E(Z+2,mM),!(P.cullBackFaces&&-M[0].normal.z<=0&&-M[1].normal.z<=0&&-M[2].normal.z<=0)&&(M=q(M,y),M&&(M=q(M,f),M&&(M=q(M,Y),M&&(M=q(M,z),M&&(M=q(M,i),M&&(M=q(M,T),M)))))))for(let Z=0;Z<M.length;Z++){const x=M[Z];if(A.indices.push(o),U?(x.localPositionOverride?(A.hM[3*o]=x.localPositionOverride[0],A.hM[3*o+1]=x.localPositionOverride[1],A.hM[3*o+2]=x.localPositionOverride[2]):N&&(A.hM[3*o]=N[x.vertexIdx],A.hM[3*o+1]=N[x.vertexIdx+1],A.hM[3*o+2]=N[x.vertexIdx+2]),x.localNormalOverride?(A.QM[3*o]=x.localNormalOverride[0],A.QM[3*o+1]=x.localNormalOverride[1],A.QM[3*o+2]=x.localNormalOverride[2]):J&&(A.QM[3*o]=J[x.vertexIdx],A.QM[3*o+1]=J[x.vertexIdx+1],A.QM[3*o+2]=J[x.vertexIdx+2])):(x.position.toArray(A.hM,3*o),x.normal.toArray(A.QM,3*o)),A.matricesIndices&&A.matricesWeights&&(x.matrixIndicesOverride?(A.matricesIndices[4*o]=x.matrixIndicesOverride[0],A.matricesIndices[4*o+1]=x.matrixIndicesOverride[1],A.matricesIndices[4*o+2]=x.matrixIndicesOverride[2],A.matricesIndices[4*o+3]=x.matrixIndicesOverride[3]):(F&&(A.matricesIndices[4*o]=F[x.vertexIdxForBones],A.matricesIndices[4*o+1]=F[x.vertexIdxForBones+1],A.matricesIndices[4*o+2]=F[x.vertexIdxForBones+2],A.matricesIndices[4*o+3]=F[x.vertexIdxForBones+3]),l&&A.matricesIndicesExtra&&(A.matricesIndicesExtra[4*o]=l[x.vertexIdxForBones],A.matricesIndicesExtra[4*o+1]=l[x.vertexIdxForBones+1],A.matricesIndicesExtra[4*o+2]=l[x.vertexIdxForBones+2],A.matricesIndicesExtra[4*o+3]=l[x.vertexIdxForBones+3])),x.matrixWeightsOverride?(A.matricesWeights[4*o]=x.matrixWeightsOverride[0],A.matricesWeights[4*o+1]=x.matrixWeightsOverride[1],A.matricesWeights[4*o+2]=x.matrixWeightsOverride[2],A.matricesWeights[4*o+3]=x.matrixWeightsOverride[3]):(D&&(A.matricesWeights[4*o]=D[x.vertexIdxForBones],A.matricesWeights[4*o+1]=D[x.vertexIdxForBones+1],A.matricesWeights[4*o+2]=D[x.vertexIdxForBones+2],A.matricesWeights[4*o+3]=D[x.vertexIdxForBones+3]),h&&A.matricesWeightsExtra&&(A.matricesWeightsExtra[4*o]=h[x.vertexIdxForBones],A.matricesWeightsExtra[4*o+1]=h[x.vertexIdxForBones+1],A.matricesWeightsExtra[4*o+2]=h[x.vertexIdxForBones+2],A.matricesWeightsExtra[4*o+3]=h[x.vertexIdxForBones+3]))),P.captureUVS)x.uv.toArray(A.sM,2*o);else{A.sM.push(.5+x.position.x/s.x);const M=.5+x.position.y/s.y;A.sM.push(G.e?1-M:M)}o++}}}0===A.indices.length&&(A.indices=null),0===A.hM.length&&(A.hM=null),0===A.QM.length&&(A.QM=null),0===A.sM.length&&(A.sM=null),0===(null===(K=A.matricesIndices)||void 0===K?void 0:K.length)&&(A.matricesIndices=null),0===(null===(d=A.matricesWeights)||void 0===d?void 0:d.length)&&(A.matricesWeights=null),0===(null===(O=A.matricesIndicesExtra)||void 0===O?void 0:O.length)&&(A.matricesIndicesExtra=null),0===(null===(H=A.matricesWeightsExtra)||void 0===H?void 0:H.length)&&(A.matricesWeightsExtra=null);const V=new c.c(M,Z.DM());return A.RM(V),U?(V.skeleton=Z.skeleton,V.parent=Z):(V.position=Q.clone(),V.rotation=new x.BZ(k,R,C)),V.Jc(!0),V.refreshBoundingInfo(!0,!0),V}function X(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const Z=0|Math.max(M.subdivisions?M.subdivisions:2,1),P=0|Math.max(M.tessellation?M.tessellation:16,3),c=Math.max(M.height?M.height:1,0),w=Math.max(M.radius?M.radius:.25,0),mM=0|Math.max(M.capSubdivisions?M.capSubdivisions:6,1),K=P,d=Z,O=Math.max(M.radiusTop?M.radiusTop:w,0),H=Math.max(M.radiusBottom?M.radiusBottom:w,0),j=c-(O+H),B=2*Math.PI,U=Math.max(M.topCapSubdivisions?M.topCapSubdivisions:mM,1),n=Math.max(M.bottomCapSubdivisions?M.bottomCapSubdivisions:mM,1),L=Math.acos((H-O)/c);let u=[];const N=[],J=[],t=[];let F=0;const D=[],l=.5*j,h=.5*Math.PI;let Q,I;const s=x.BZ.Zero(),C=x.BZ.Zero(),R=Math.cos(L),W=Math.sin(L),k=new x.Vector2(O*W,l+O*R).UZ(new x.Vector2(H*W,H*R-l)).length(),A=O*L+k+H*(h-L);let o=0;for(I=0;I<=U;I++){const M=[],Z=h-L*(I/U);o+=O*L/U;const P=Math.cos(Z),x=Math.sin(Z),c=P*O;for(Q=0;Q<=K;Q++){const Z=Q/K,w=Z*B+0,v=Math.sin(w),mM=Math.cos(w);C.x=c*v,C.y=l+x*O,C.z=c*mM,N.push(C.x,C.y,C.z),s.set(P*v,x,P*mM),J.push(s.x,s.y,s.z),t.push(Z,G.e?o/A:1-o/A),M.push(F),F++}D.push(M)}const E=c-O-H+R*O-R*H,r=W*(H-O)/E;for(I=1;I<=d;I++){const M=[];o+=k/d;const Z=W*(I*(H-O)/d+O);for(Q=0;Q<=K;Q++){const P=Q/K,x=P*B+0,c=Math.sin(x),w=Math.cos(x);C.x=Z*c,C.y=l+R*O-I*E/d,C.z=Z*w,N.push(C.x,C.y,C.z),s.set(c,r,w).normalize(),J.push(s.x,s.y,s.z),t.push(P,G.e?o/A:1-o/A),M.push(F),F++}D.push(M)}for(I=1;I<=n;I++){const M=[],Z=h-L-(Math.PI-L)*(I/n);o+=H*L/n;const P=Math.cos(Z),x=Math.sin(Z),c=P*H;for(Q=0;Q<=K;Q++){const Z=Q/K,w=Z*B+0,v=Math.sin(w),mM=Math.cos(w);C.x=c*v,C.y=x*H-l,C.z=c*mM,N.push(C.x,C.y,C.z),s.set(P*v,x,P*mM),J.push(s.x,s.y,s.z),t.push(Z,G.e?o/A:1-o/A),M.push(F),F++}D.push(M)}for(Q=0;Q<K;Q++)for(I=0;I<U+d+n;I++){const M=D[I][Q],Z=D[I+1][Q],P=D[I+1][Q+1],x=D[I][Q+1];u.push(M),u.push(Z),u.push(x),u.push(Z),u.push(P),u.push(x)}if(u=u.reverse(),M.orientation&&!M.orientation.equals(x.BZ.Up())){const Z=new x.Matrix;M.orientation.clone().scale(.5*Math.PI).cross(x.BZ.Up()).toQuaternion().toRotationMatrix(Z);const P=x.BZ.Zero();for(let M=0;M<N.length;M+=3)P.set(N[M],N[M+1],N[M+2]),x.BZ.TransformCoordinatesToRef(P.clone(),Z,P),N[M]=P.x,N[M+1]=P.y,N[M+2]=P.z}const q=new v.b;return q.hM=N,q.QM=J,q.sM=t,q.indices=u,q}function V(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:x.BZ.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new c.c(M,P);return X(Z).RM(w,Z.updatable),w}c.c.CreateDecal=(M,Z,P,x,c,w)=>S(M,Z,{position:P,normal:x,size:c,angle:w});c.c.CreateCapsule=(M,Z,P)=>V(M,Z,P),v.b.CreateCapsule=X;var g=P(12199),MM=P(12377);class ZM{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=M,this.y=Z,M!==Math.floor(M)&&(M=Math.floor(M),g.d.Warn("x is not an integer, floor(x) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),g.d.Warn("y is not an integer, floor(y) used"))}clone(){return new ZM(this.x,this.y)}rotate60About(M){const Z=this.x;return this.x=M.x+M.y-this.y,this.y=Z+this.y-M.x,this}rotateNeg60About(M){const Z=this.x;return this.x=Z+this.y-M.y,this.y=M.x+M.y-Z,this}rotate120(M,Z){M!==Math.floor(M)&&(M=Math.floor(M),g.d.Warn("m not an integer only floor(m) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),g.d.Warn("n not an integer only floor(n) used"));const P=this.x;return this.x=M-P-this.y,this.y=Z+P,this}rotateNeg120(M,Z){M!==Math.floor(M)&&(M=Math.floor(M),g.d.Warn("m is not an integer, floor(m) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),g.d.Warn("n is not an integer,   floor(n) used"));const P=this.x;return this.x=this.y-Z,this.y=M+Z-P-this.y,this}toCartesianOrigin(M,Z){const P=x.BZ.Zero();return P.x=M.x+2*this.x*Z+this.y*Z,P.y=M.y+Math.sqrt(3)*this.y*Z,P}static Zero(){return new ZM(0,0)}}class PM{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new xM("icosahedron","Regular",[[0,MM.d,-1],[-MM.d,1,0],[-1,0,-MM.d],[1,0,-MM.d],[MM.d,1,0],[0,MM.d,1],[-1,0,MM.d],[-MM.d,-1,0],[0,-MM.d,-1],[MM.d,-1,0],[1,0,MM.d],[0,-MM.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let M=12;const Z={},P=this.m,x=this.n;let c,w,v,G,mM,K=P,d=1,O=0;0!==x&&(K=(0,a.HighestCommonFactor)(P,x)),d=P/K,O=x/K;const H=ZM.Zero(),j=new ZM(P,x),B=new ZM(-x,P+x),U=ZM.Zero(),n=ZM.Zero(),L=ZM.Zero();let u,N,J,t,F=[];const D=[],l=this.vertByDist,h=(P,x,c,w)=>{u=P+"|"+c,N=x+"|"+w,u in Z||N in Z?u in Z&&!(N in Z)?Z[N]=Z[u]:N in Z&&!(u in Z)&&(Z[u]=Z[N]):(Z[u]=M,Z[N]=M,M++),l[c][0]>2?D[Z[u]]=[-l[c][0],l[c][1],Z[u]]:D[Z[u]]=[F[l[c][0]],l[c][1],Z[u]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let Q=0;Q<20;Q++){if(F=this.IDATA.face[Q],v=F[2],G=F[1],mM=F[0],J=H.x+"|"+H.y,u=Q+"|"+J,u in Z||(Z[u]=v,D[v]=[F[l[J][0]],l[J][1]]),J=j.x+"|"+j.y,u=Q+"|"+J,u in Z||(Z[u]=G,D[G]=[F[l[J][0]],l[J][1]]),J=B.x+"|"+B.y,u=Q+"|"+J,u in Z||(Z[u]=mM,D[mM]=[F[l[J][0]],l[J][1]]),c=this.IDATA.edgematch[Q][0],w=this.IDATA.edgematch[Q][1],"B"===w)for(let M=1;M<K;M++)n.x=P-M*(d+O),n.y=x+M*d,L.x=-M*O,L.y=M*(d+O),J=n.x+"|"+n.y,t=L.x+"|"+L.y,h(Q,c,J,t);if("O"===w)for(let M=1;M<K;M++)L.x=-M*O,L.y=M*(d+O),U.x=M*d,U.y=M*O,J=L.x+"|"+L.y,t=U.x+"|"+U.y,h(Q,c,J,t);if(c=this.IDATA.edgematch[Q][2],w=this.IDATA.edgematch[Q][3],w&&"A"===w)for(let M=1;M<K;M++)U.x=M*d,U.y=M*O,n.x=P-(K-M)*(d+O),n.y=x+(K-M)*d,J=U.x+"|"+U.y,t=n.x+"|"+n.y,h(Q,c,J,t);for(let P=0;P<this.vertices.length;P++)J=this.vertices[P].x+"|"+this.vertices[P].y,u=Q+"|"+J,u in Z||(Z[u]=M++,l[J][0]>2?D[Z[u]]=[-l[J][0],l[J][1],Z[u]]:D[Z[u]]=[F[l[J][0]],l[J][1],Z[u]])}this.closestTo=D,this.vecToidx=Z}calcCoeffs(){const M=this.m,Z=this.n,P=Math.sqrt(3)/3,x=M*M+Z*Z+M*Z;this.coau=(M+Z)/x,this.cobu=-Z/x,this.coav=-P*(M-Z)/x,this.cobv=P*(2*M+Z)/x}createInnerFacets(){const M=this.m,Z=this.n;for(let P=0;P<Z+M+1;P++)for(let M=this.min[P];M<this.max[P]+1;M++)M<this.max[P]&&M<this.max[P+1]+1&&this.innerFacets.push(["|"+M+"|"+P,"|"+M+"|"+(P+1),"|"+(M+1)+"|"+P]),P>0&&M<this.max[P-1]&&M+1<this.max[P]+1&&this.innerFacets.push(["|"+M+"|"+P,"|"+(M+1)+"|"+P,"|"+(M+1)+"|"+(P-1)])}edgeVecsABOB(){const M=this.m,Z=this.n,P=new ZM(-Z,M+Z);for(let x=1;x<M+Z;x++){const M=new ZM(this.min[x],x),Z=new ZM(this.min[x-1],x-1),c=new ZM(this.min[x+1],x+1),w=M.clone(),v=Z.clone(),G=c.clone();w.rotate60About(P),v.rotate60About(P),G.rotate60About(P);const mM=new ZM(this.max[w.y],w.y),K=new ZM(this.max[w.y-1],w.y-1),d=new ZM(this.max[w.y-1]-1,w.y-1);w.x===mM.x&&w.y===mM.y||(w.x!==K.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,K,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,d,mM])):w.y===G.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,Z,K]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([M,K,c])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,Z,K]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,K,mM])))}}mapABOBtoOBOA(){const M=new ZM(0,0);for(let Z=0;Z<this.isoVecsABOB.length;Z++){const P=[];for(let x=0;x<3;x++)M.x=this.isoVecsABOB[Z][x].x,M.y=this.isoVecsABOB[Z][x].y,0===this.vertexTypes[Z][x]&&M.rotateNeg120(this.m,this.n),P.push(M.clone());this.isoVecsOBOA.push(P)}}mapABOBtoBAOA(){const M=new ZM(0,0);for(let Z=0;Z<this.isoVecsABOB.length;Z++){const P=[];for(let x=0;x<3;x++)M.x=this.isoVecsABOB[Z][x].x,M.y=this.isoVecsABOB[Z][x].y,1===this.vertexTypes[Z][x]&&M.rotate120(this.m,this.n),P.push(M.clone());this.isoVecsBAOA.push(P)}}MapToFace(M,Z){const P=this.IDATA.face[M],c=P[2],w=P[1],v=P[0],G=x.BZ.NZ(this.IDATA.vertex[c]),mM=x.BZ.NZ(this.IDATA.vertex[w]),K=x.BZ.NZ(this.IDATA.vertex[v]),d=mM.UZ(G),O=K.UZ(G),H=d.scale(this.coau).add(O.scale(this.cobu)),j=d.scale(this.coav).add(O.scale(this.cobv)),B=[];let U,n=x.TmpVectors.BZ[0];for(let x=0;x<this.cartesian.length;x++)n=H.scale(this.cartesian[x].x).add(j.scale(this.cartesian[x].y)).add(G),B[x]=[n.x,n.y,n.z],U=M+"|"+this.vertices[x].x+"|"+this.vertices[x].y,Z.vertex[this.vecToidx[U]]=[n.x,n.y,n.z]}build(M,Z){const P=[],x=ZM.Zero(),c=new ZM(M,Z),w=new ZM(-Z,M+Z);P.push(x,c,w);for(let J=Z;J<M+1;J++)for(let Z=0;Z<M+1-J;Z++)P.push(new ZM(Z,J));if(Z>0){const x=(0,a.HighestCommonFactor)(M,Z),c=M/x,w=Z/x;for(let G=1;G<x;G++)P.push(new ZM(G*c,G*w)),P.push(new ZM(-G*w,G*(c+w))),P.push(new ZM(M-G*(c+w),Z+G*c));const v=M/Z;for(let G=1;G<Z;G++)for(let x=0;x<G*v;x++)P.push(new ZM(x,G)),P.push(new ZM(x,G).rotate120(M,Z)),P.push(new ZM(x,G).rotateNeg120(M,Z))}P.sort(((M,Z)=>M.x-Z.x)),P.sort(((M,Z)=>M.y-Z.y));const v=new Array(M+Z+1),G=new Array(M+Z+1);for(let J=0;J<v.length;J++)v[J]=1/0,G[J]=-1/0;let mM=0,K=0;const d=P.length;for(let J=0;J<d;J++)K=P[J].x,mM=P[J].y,v[mM]=Math.min(K,v[mM]),G[mM]=Math.max(K,G[mM]);const O=(P,x)=>{const c=P.clone();return"A"===x&&c.rotateNeg120(M,Z),"B"===x&&c.rotate120(M,Z),c.x<0?c.y:c.x+c.y},H=[],j=[],B=[],U=[],n={},L=[];let u=-1,N=-1;for(let J=0;J<d;J++)H[J]=P[J].toCartesianOrigin(new ZM(0,0),.5),j[J]=O(P[J],"O"),B[J]=O(P[J],"A"),U[J]=O(P[J],"B"),j[J]===B[J]&&B[J]===U[J]?(u=3,N=j[J]):j[J]===B[J]?(u=4,N=j[J]):B[J]===U[J]?(u=5,N=B[J]):U[J]===j[J]&&(u=6,N=j[J]),j[J]<B[J]&&j[J]<U[J]&&(u=2,N=j[J]),B[J]<j[J]&&B[J]<U[J]&&(u=1,N=B[J]),U[J]<B[J]&&U[J]<j[J]&&(u=0,N=U[J]),L.push([u,N,P[J].x,P[J].y]);L.sort(((M,Z)=>M[2]-Z[2])),L.sort(((M,Z)=>M[3]-Z[3])),L.sort(((M,Z)=>M[1]-Z[1])),L.sort(((M,Z)=>M[0]-Z[0]));for(let J=0;J<L.length;J++)n[L[J][2]+"|"+L[J][3]]=[L[J][0],L[J][1],J];return this.m=M,this.n=Z,this.vertices=P,this.vertByDist=n,this.cartesian=H,this.min=v,this.max=G,this}}class xM{constructor(M,Z,P,x){this.name=M,this.category=Z,this.vertex=P,this.face=x}}class cM extends xM{innerToData(M,Z){for(let P=0;P<Z.innerFacets.length;P++)this.face.push(Z.innerFacets[P].map((P=>Z.vecToidx[M+P])))}mapABOBtoDATA(M,Z){const P=Z.IDATA.edgematch[M][0];for(let x=0;x<Z.isoVecsABOB.length;x++){const c=[];for(let w=0;w<3;w++)0===Z.vertexTypes[x][w]?c.push(M+"|"+Z.isoVecsABOB[x][w].x+"|"+Z.isoVecsABOB[x][w].y):c.push(P+"|"+Z.isoVecsABOB[x][w].x+"|"+Z.isoVecsABOB[x][w].y);this.face.push([Z.vecToidx[c[0]],Z.vecToidx[c[1]],Z.vecToidx[c[2]]])}}mapOBOAtoDATA(M,Z){const P=Z.IDATA.edgematch[M][0];for(let x=0;x<Z.isoVecsOBOA.length;x++){const c=[];for(let w=0;w<3;w++)1===Z.vertexTypes[x][w]?c.push(M+"|"+Z.isoVecsOBOA[x][w].x+"|"+Z.isoVecsOBOA[x][w].y):c.push(P+"|"+Z.isoVecsOBOA[x][w].x+"|"+Z.isoVecsOBOA[x][w].y);this.face.push([Z.vecToidx[c[0]],Z.vecToidx[c[1]],Z.vecToidx[c[2]]])}}mapBAOAtoDATA(M,Z){const P=Z.IDATA.edgematch[M][2];for(let x=0;x<Z.isoVecsBAOA.length;x++){const c=[];for(let w=0;w<3;w++)1===Z.vertexTypes[x][w]?c.push(M+"|"+Z.isoVecsBAOA[x][w].x+"|"+Z.isoVecsBAOA[x][w].y):c.push(P+"|"+Z.isoVecsBAOA[x][w].x+"|"+Z.isoVecsBAOA[x][w].y);this.face.push([Z.vecToidx[c[0]],Z.vecToidx[c[1]],Z.vecToidx[c[2]]])}}orderData(M){const Z=[];for(let w=0;w<13;w++)Z[w]=[];const P=M.closestTo;for(let w=0;w<P.length;w++)P[w][0]>-1?P[w][1]>0&&Z[P[w][0]].push([w,P[w][1]]):Z[12].push([w,P[w][0]]);const x=[];for(let w=0;w<12;w++)x[w]=w;let c=12;for(let w=0;w<12;w++){Z[w].sort(((M,Z)=>M[1]-Z[1]));for(let M=0;M<Z[w].length;M++)x[Z[w][M][0]]=c++}for(let w=0;w<Z[12].length;w++)x[Z[12][w][0]]=c++;for(let w=0;w<this.vertex.length;w++)this.vertex[w].push(x[w]);this.vertex.sort(((M,Z)=>M[3]-Z[3]));for(let w=0;w<this.vertex.length;w++)this.vertex[w].pop();for(let w=0;w<this.face.length;w++)for(let M=0;M<this.face[w].length;M++)this.face[w][M]=x[this.face[w][M]];this.sharedNodes=Z[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(M,Z){const P=[],x=[];let c=Z.pop();x.push(c);let w=this.face[c].indexOf(M);w=(w+2)%3;let v=this.face[c][w];P.push(v);let G=0;for(;Z.length>0;)c=Z[G],this.face[c].indexOf(v)>-1?(w=(this.face[c].indexOf(v)+1)%3,v=this.face[c][w],P.push(v),x.push(c),Z.splice(G,1),G=0):G++;return this.adjacentFaces.push(P),x}toGoldbergPolyhedronData(){const M=new xM("GeoDual","Goldberg",[],[]);M.name="GD dual";const Z=this.vertex.length,P=new Array(Z);for(let mM=0;mM<Z;mM++)P[mM]=[];for(let mM=0;mM<this.face.length;mM++)for(let M=0;M<3;M++)P[this.face[mM][M]].push(mM);let x=0,c=0,w=0,v=[],G=[];this.adjacentFaces=[];for(let mM=0;mM<P.length;mM++){M.face[mM]=this.setOrder(mM,P[mM].concat([]));for(const Z of P[mM]){x=0,c=0,w=0,v=this.face[Z];for(let M=0;M<3;M++)G=this.vertex[v[M]],x+=G[0],c+=G[1],w+=G[2];M.vertex[Z]=[x/3,c/3,w/3]}}return M}static BuildGeodesicData(M){const Z=new cM("Geodesic-m-n","Geodesic",[[0,MM.d,-1],[-MM.d,1,0],[-1,0,-MM.d],[1,0,-MM.d],[MM.d,1,0],[0,MM.d,1],[-1,0,MM.d],[-MM.d,-1,0],[0,-MM.d,-1],[MM.d,-1,0],[1,0,MM.d],[0,-MM.d,1]],[]);M.setIndices(),M.calcCoeffs(),M.createInnerFacets(),M.edgeVecsABOB(),M.mapABOBtoOBOA(),M.mapABOBtoBAOA();for(let P=0;P<M.IDATA.face.length;P++)M.MapToFace(P,Z),Z.innerToData(P,M),"B"===M.IDATA.edgematch[P][1]&&Z.mapABOBtoDATA(P,M),"O"===M.IDATA.edgematch[P][1]&&Z.mapOBOAtoDATA(P,M),"A"===M.IDATA.edgematch[P][3]&&Z.mapBAOAtoDATA(P,M);Z.orderData(M);return Z.vertex=Z.vertex.map((function(M){const Z=M[0],P=M[1],x=M[2],c=Math.sqrt(Z*Z+P*P+x*x);return M[0]*=1/c,M[1]*=1/c,M[2]*=1/c,M})),Z}}c.c._GoldbergMeshParser=(M,Z)=>wM.Parse(M,Z);class wM extends c.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(M,Z){return void 0===Z?(M>this.goldbergData.nbUnsharedFaces-1&&(g.d.Warn("Maximum number of unshared faces used"),M=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+M):(M>11&&(g.d.Warn("Last pole used"),M=11),Z>this.goldbergData.nbFacesAtPole-1&&(g.d.Warn("Maximum number of faces at a pole used"),Z=this.goldbergData.nbFacesAtPole-1),12+M*this.goldbergData.nbFacesAtPole+Z)}_changeGoldbergFaceColors(M){for(let P=0;P<M.length;P++){const Z=M[P][0],x=M[P][1],c=M[P][2];for(let M=Z;M<x+1;M++)this.goldbergData.faceColors[M]=c}const Z=[];for(let P=0;P<12;P++)for(let M=0;M<5;M++)Z.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);for(let P=12;P<this.goldbergData.faceColors.length;P++)for(let M=0;M<6;M++)Z.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);return Z}setGoldbergFaceColors(M){const Z=this._changeGoldbergFaceColors(M);this.oM(w.g.ColorKind,Z)}updateGoldbergFaceColors(M){const Z=this._changeGoldbergFaceColors(M);this.updateVerticesData(w.g.ColorKind,Z)}_changeGoldbergFaceUVs(M){const Z=this.getVerticesData(w.g.UVKind);for(let P=0;P<M.length;P++){const x=M[P][0],c=M[P][1],w=M[P][2],v=M[P][3],G=M[P][4],mM=[],K=[];let d,O;for(let M=0;M<5;M++)d=w.x+v*Math.cos(G+M*Math.PI/2.5),O=w.y+v*Math.sin(G+M*Math.PI/2.5),d<0&&(d=0),d>1&&(d=1),mM.push(d,O);for(let M=0;M<6;M++)d=w.x+v*Math.cos(G+M*Math.PI/3),O=w.y+v*Math.sin(G+M*Math.PI/3),d<0&&(d=0),d>1&&(d=1),K.push(d,O);for(let M=x;M<Math.min(12,c+1);M++)for(let P=0;P<5;P++)Z[10*M+2*P]=mM[2*P],Z[10*M+2*P+1]=mM[2*P+1];for(let M=Math.max(12,x);M<c+1;M++)for(let P=0;P<6;P++)Z[12*M-24+2*P]=K[2*P],Z[12*M-23+2*P]=K[2*P+1]}return Z}setGoldbergFaceUVs(M){const Z=this._changeGoldbergFaceUVs(M);this.oM(w.g.UVKind,Z)}updateGoldbergFaceUVs(M){const Z=this._changeGoldbergFaceUVs(M);this.updateVerticesData(w.g.UVKind,Z)}placeOnGoldbergFaceAt(M,Z,P){const c=x.BZ.RotationFromAxis(this.goldbergData.faceXaxis[Z],this.goldbergData.faceYaxis[Z],this.goldbergData.faceZaxis[Z]);M.rotation=c,M.position=this.goldbergData.faceCenters[Z].add(this.goldbergData.faceXaxis[Z].scale(P.x)).add(this.goldbergData.faceYaxis[Z].scale(P.y)).add(this.goldbergData.faceZaxis[Z].scale(P.z))}serialize(M){super.serialize(M),M.type="GoldbergMesh";const Z={};if(Z.adjacentFaces=this.goldbergData.adjacentFaces,Z.nbSharedFaces=this.goldbergData.nbSharedFaces,Z.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,Z.nbFaces=this.goldbergData.nbFaces,Z.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){Z.faceColors=[];for(const M of this.goldbergData.faceColors)Z.faceColors.push(M.nc())}if(this.goldbergData.faceCenters){Z.faceCenters=[];for(const M of this.goldbergData.faceCenters)Z.faceCenters.push(M.nc())}if(this.goldbergData.faceZaxis){Z.faceZaxis=[];for(const M of this.goldbergData.faceZaxis)Z.faceZaxis.push(M.nc())}if(this.goldbergData.faceYaxis){Z.faceYaxis=[];for(const M of this.goldbergData.faceYaxis)Z.faceYaxis.push(M.nc())}if(this.goldbergData.faceXaxis){Z.faceXaxis=[];for(const M of this.goldbergData.faceXaxis)Z.faceXaxis.push(M.nc())}M.goldbergData=Z}static Parse(M,Z){const P=M.goldbergData;P.faceColors=P.faceColors.map((M=>H.Ic.NZ(M))),P.faceCenters=P.faceCenters.map((M=>x.BZ.NZ(M))),P.faceZaxis=P.faceZaxis.map((M=>x.BZ.NZ(M))),P.faceXaxis=P.faceXaxis.map((M=>x.BZ.NZ(M))),P.faceYaxis=P.faceYaxis.map((M=>x.BZ.NZ(M)));const c=new wM(M.name,Z);return c.goldbergData=P,c}}var vM=P(12916);const GM={CreateBox:O.e,CreateTiledBox:n,CreateSphere:L.b,CreateDisc:d.e,CreateIcoSphere:b,CreateRibbon:K,CreateCylinder:t,CreateTorus:D,CreateTorusKnot:h,CreateLineSystem:Q.g,iK:Q.j,CreateDashedLines:Q.d,ExtrudeShape:C,ExtrudeShapeCustom:R,CreateLathe:k,CreateTiledPlane:B,SK:A.c,CreateGround:o.e,CreateTiledGround:o.i,CreateGroundFromHeightMap:o.d,CreatePolygon:I.d,ExtrudePolygon:I.e,CreateTube:E,CreatePolyhedron:q,CreateGeodesic:function(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=Z.m||1;x!==Math.floor(x)&&(x=Math.floor(x),g.d.Warn("m not an integer only floor(m) used"));let c=Z.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),g.d.Warn("n not an integer only floor(n) used")),c>x){const M=c;c=x,x=M,g.d.Warn("n > m therefore m and n swapped")}const w=new PM;return w.build(x,c),q(M,{custom:cM.BuildGeodesicData(w),size:Z.size,sizeX:Z.sizeX,sizeY:Z.sizeY,sizeZ:Z.sizeZ,faceUV:Z.faceUV,faceColors:Z.faceColors,flat:Z.flat,updatable:Z.updatable,sideOrientation:Z.sideOrientation,frontUVs:Z.frontUVs,backUVs:Z.backUVs},P)},CreateGoldberg:function(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=Z.size,mM=Z.sizeX||w||1,K=Z.sizeY||w||1,d=Z.sizeZ||w||1;let O=Z.m||1;O!==Math.floor(O)&&(O=Math.floor(O),g.d.Warn("m not an integer only floor(m) used"));let j=Z.n||0;if(j!==Math.floor(j)&&(j=Math.floor(j),g.d.Warn("n not an integer only floor(n) used")),j>O){const M=j;j=O,O=M,g.d.Warn("n > m therefore m and n swapped")}const B=new PM;B.build(O,j);const U=cM.BuildGeodesicData(B),n=U.toGoldbergPolyhedronData(),L=new wM(M,P);Z.sideOrientation=c.c._GetDefaultSideOrientation(Z.sideOrientation),L._originalBuilderSideOrientation=Z.sideOrientation;(function(M,Z){const P=M.size,c=M.sizeX||P||1,w=M.sizeY||P||1,mM=M.sizeZ||P||1,K=0===M.sideOrientation?0:M.sideOrientation||v.b.DEFAULTSIDE,d=[],O=[],H=[],j=[];let B=1/0,U=-1/0,n=1/0,L=-1/0;for(let x=0;x<Z.vertex.length;x++)B=Math.min(B,Z.vertex[x][0]*c),U=Math.max(U,Z.vertex[x][0]*c),n=Math.min(n,Z.vertex[x][1]*w),L=Math.max(L,Z.vertex[x][1]*w);let u=0;for(let v=0;v<Z.face.length;v++){const M=Z.face[v],P=x.BZ.NZ(Z.vertex[M[0]]),K=x.BZ.NZ(Z.vertex[M[2]]),N=x.BZ.NZ(Z.vertex[M[1]]),J=K.UZ(P),t=N.UZ(P),F=x.BZ.Cross(t,J).normalize();for(let x=0;x<M.length;x++){H.push(F.x,F.y,F.z);const P=Z.vertex[M[x]];d.push(P[0]*c,P[1]*w,P[2]*mM);const v=(P[1]*w-n)/(L-n);j.push((P[0]*c-B)/(U-B),G.e?1-v:v)}for(let Z=0;Z<M.length-2;Z++)O.push(u,u+Z+2,u+Z+1);u+=M.length}v.b._ComputeSides(K,d,O,H,j);const N=new v.b;return N.hM=d,N.indices=O,N.QM=H,N.sM=j,N})(Z,n).RM(L,Z.updatable),L.goldbergData.nbSharedFaces=U.sharedNodes,L.goldbergData.nbUnsharedFaces=U.poleNodes,L.goldbergData.adjacentFaces=U.adjacentFaces,L.goldbergData.nbFaces=L.goldbergData.nbSharedFaces+L.goldbergData.nbUnsharedFaces,L.goldbergData.nbFacesAtPole=(L.goldbergData.nbUnsharedFaces-12)/12;for(let c=0;c<U.vertex.length;c++)L.goldbergData.faceCenters.push(x.BZ.NZ(U.vertex[c])),L.goldbergData.faceCenters[c].x*=mM,L.goldbergData.faceCenters[c].y*=K,L.goldbergData.faceCenters[c].z*=d,L.goldbergData.faceColors.push(new H.Ic(1,1,1,1));for(let c=0;c<n.face.length;c++){const M=n.face[c],Z=x.BZ.NZ(n.vertex[M[0]]),P=x.BZ.NZ(n.vertex[M[2]]),w=x.BZ.NZ(n.vertex[M[1]]),v=P.UZ(Z),G=w.UZ(Z),mM=x.BZ.Cross(G,v).normalize(),K=x.BZ.Cross(G,mM).normalize();L.goldbergData.faceXaxis.push(G.normalize()),L.goldbergData.faceYaxis.push(mM),L.goldbergData.faceZaxis.push(K)}return L},CreateDecal:S,CreateCapsule:V,CreateText:vM.e}},13665:(M,Z,P)=>{"use strict";P.d(Z,{c:()=>GZ});var x=P(12373),c=P(12759);class w extends c.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var v=P(12406),G=(P(12533),P(12317));class mM{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(M){this._targetStopDuration!==M&&(this._targetStopDuration=M)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(M){this._noiseTexture!==M&&(this._noiseTexture=M,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(M){this._animationSheetEnabled!==M&&(this._animationSheetEnabled=M)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(M){this._isAnimationSheetEnabled!=M&&(this._isAnimationSheetEnabled=M,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(M){this._useLogarithmicDepth=M&&this.DM().getEngine().getCaps().fragmentDepthSupported}DM(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(M){switch(M){case mM.BLENDMODE_MULTIPLYADD:return;case mM.BLENDMODE_ADD:M=1;break;case mM.BLENDMODE_ONEONE:M=6;break;case mM.BLENDMODE_STANDARD:M=2;break;case mM.BLENDMODE_MULTIPLY:M=4;break;case mM.BLENDMODE_SUBTRACT:M=3}this._engine.setAlphaMode(M)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:x.BZ.Zero()}set direction1(M){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=M)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:x.BZ.Zero()}set direction2(M){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=M)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:x.BZ.Zero()}set minEmitBox(M){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=M)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:x.BZ.Zero()}set maxEmitBox(M){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=M)}get billboardMode(){return this._billboardMode}set billboardMode(M){this._billboardMode!==M&&(this._billboardMode=M,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(M){this._isBillboardBased!==M&&(this._isBillboardBased=M,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(M){this._attachImageProcessingConfiguration(M)}_attachImageProcessingConfiguration(M){M!==this._imageProcessingConfiguration&&(!M&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=M)}_reset(){}_removeGradientAndTexture(M,Z,P){if(!Z)return this;let x=0;for(const c of Z){if(c.gradient===M){Z.splice(x,1);break}x++}return P&&P.dispose(),this}constructor(M){this.animations=[],this.renderingGroupId=0,this.xZ=x.BZ.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new x.BZ(10,10,10),this.onAnimationEnd=null,this.blendMode=mM.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new x.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.fK=new x.BZ(0,0,0),this._useLogarithmicDepth=!1,this.gravity=x.BZ.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new v.Ic(1,1,1,1),this.color2=new v.Ic(1,1,1,1),this.colorDead=new v.Ic(0,0,0,1),this.textureMask=new v.Ic(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new w,this.id=M,this.name=M}createPointEmitter(M,Z){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new x.BZ(0,1,0),arguments.length>2&&void 0!==arguments[2]||new x.BZ(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new x.BZ(0,1,0),arguments.length>4&&void 0!==arguments[4]||new x.BZ(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new x.BZ(0,1,0),arguments.length>3&&void 0!==arguments[3]||new x.BZ(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(M,Z,P,x){throw new Error("Method not implemented.")}}mM.BLENDMODE_ONEONE=0,mM.BLENDMODE_STANDARD=1,mM.BLENDMODE_ADD=2,mM.BLENDMODE_MULTIPLY=3,mM.BLENDMODE_MULTIPLYADD=4,mM.BLENDMODE_SUBTRACT=-1,(0,G.g)("BABYLON.BaseParticleSystem",mM);var K=P(12387),d=P(12207);class O{constructor(){this.direction1=new x.BZ(0,1,0),this.direction2=new x.BZ(0,1,0),this.minEmitBox=new x.BZ(-.5,-.5,-.5),this.maxEmitBox=new x.BZ(.5,.5,.5)}startDirectionFunction(M,Z,P,c){const w=(0,K.RandomRange)(this.direction1.x,this.direction2.x),v=(0,K.RandomRange)(this.direction1.y,this.direction2.y),G=(0,K.RandomRange)(this.direction1.z,this.direction2.z);if(c)return Z.x=w,Z.y=v,void(Z.z=G);x.BZ.TransformNormalFromFloatsToRef(w,v,G,M,Z)}startPositionFunction(M,Z,P,c){const w=(0,K.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),v=(0,K.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),G=(0,K.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(c)return Z.x=w,Z.y=v,void(Z.z=G);x.BZ.TransformCoordinatesFromFloatsToRef(w,v,G,M,Z)}clone(){const M=new O;return d.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2),M.setVector3("minEmitBox",this.minEmitBox),M.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3),M.addUniform("minEmitBox",3),M.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.nc(),M.direction2=this.direction2.nc(),M.minEmitBox=this.minEmitBox.nc(),M.maxEmitBox=this.maxEmitBox.nc(),M}parse(M){x.BZ.FromArrayToRef(M.direction1,0,this.direction1),x.BZ.FromArrayToRef(M.direction2,0,this.direction2),x.BZ.FromArrayToRef(M.minEmitBox,0,this.minEmitBox),x.BZ.FromArrayToRef(M.maxEmitBox,0,this.maxEmitBox)}}class H{get radius(){return this._radius}set radius(M){this._radius=M,this._buildHeight()}get angle(){return this._angle}set angle(M){this._angle=M,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=P,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=Z,this.radius=M}startDirectionFunction(M,Z,P,c){c?x.TmpVectors.BZ[0].v(P.Nm).normalize():P.position.subtractToRef(M.getTranslation(),x.TmpVectors.BZ[0]).normalize();const w=(0,K.RandomRange)(0,this.directionRandomizer),v=(0,K.RandomRange)(0,this.directionRandomizer),G=(0,K.RandomRange)(0,this.directionRandomizer);Z.x=x.TmpVectors.BZ[0].x+w,Z.y=x.TmpVectors.BZ[0].y+v,Z.z=x.TmpVectors.BZ[0].z+G,Z.normalize()}startPositionFunction(M,Z,P,c){const w=(0,K.RandomRange)(0,2*Math.PI);let v;this.emitFromSpawnPointOnly?v=1e-4:(v=(0,K.RandomRange)(0,this.heightRange),v=1-v*v);let G=this._radius-(0,K.RandomRange)(0,this._radius*this.radiusRange);G*=v;const mM=G*Math.sin(w),d=G*Math.cos(w),O=v*this._height;if(c)return Z.x=mM,Z.y=O,void(Z.z=d);x.BZ.TransformCoordinatesFromFloatsToRef(mM,O,d,M,Z)}clone(){const M=new H(this._radius,this._angle,this.directionRandomizer);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat2("radius",this._radius,this.radiusRange),M.setFloat("coneAngle",this._angle),M.setFloat2("height",this._height,this.heightRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",2),M.addUniform("coneAngle",1),M.addUniform("height",2),M.addUniform("directionRandomizer",1)}getEffectDefines(){let M="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(M+="\n#define CONEEMITTERSPAWNPOINT"),M}getClassName(){return"ConeParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this._radius,M.angle=this._angle,M.directionRandomizer=this.directionRandomizer,M.radiusRange=this.radiusRange,M.heightRange=this.heightRange,M.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,M}parse(M){this.radius=M.radius,this.angle=M.angle,this.directionRandomizer=M.directionRandomizer,this.radiusRange=void 0!==M.radiusRange?M.radiusRange:1,this.heightRange=void 0!==M.radiusRange?M.heightRange:1,this.emitFromSpawnPointOnly=void 0!==M.emitFromSpawnPointOnly&&M.emitFromSpawnPointOnly}}class j extends H{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0);super(M,Z),this.direction1=P,this.direction2=c}startDirectionFunction(M,Z){const P=(0,K.RandomRange)(this.direction1.x,this.direction2.x),c=(0,K.RandomRange)(this.direction1.y,this.direction2.y),w=(0,K.RandomRange)(this.direction1.z,this.direction2.z);x.BZ.TransformNormalFromFloatsToRef(P,c,w,M,Z)}clone(){const M=new j(this.radius,this.angle,this.direction1,this.direction2);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.nc(),M.direction2=this.direction2.nc(),M}parse(M){super.parse(M),this.direction1.v(M.direction1),this.direction2.v(M.direction2)}}class B{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=M,this.height=Z,this.radiusRange=P,this.directionRandomizer=c,this._tempVector=x.BZ.Zero()}startDirectionFunction(M,Z,P,c,w){P.position.subtractToRef(M.getTranslation(),this._tempVector),this._tempVector.normalize(),x.BZ.TransformNormalToRef(this._tempVector,w,this._tempVector);const v=(0,K.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let G=Math.atan2(this._tempVector.x,this._tempVector.z);G+=(0,K.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=v,this._tempVector.x=Math.sin(G),this._tempVector.z=Math.cos(G),this._tempVector.normalize(),c?Z.v(this._tempVector):x.BZ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M,Z)}startPositionFunction(M,Z,P,c){const w=(0,K.RandomRange)(-this.height/2,this.height/2),v=(0,K.RandomRange)(0,2*Math.PI),G=(0,K.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),mM=Math.sqrt(G)*this.radius,d=mM*Math.cos(v),O=mM*Math.sin(v);c?Z.lc(d,w,O):x.BZ.TransformCoordinatesFromFloatsToRef(d,w,O,M,Z)}clone(){const M=new B(this.radius,this.directionRandomizer);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.height=this.height,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.height=M.height,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class U extends B{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0),w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.BZ(0,1,0);super(M,Z,P),this.direction1=c,this.direction2=w}startDirectionFunction(M,Z,P,c){const w=(0,K.RandomRange)(this.direction1.x,this.direction2.x),v=(0,K.RandomRange)(this.direction1.y,this.direction2.y),G=(0,K.RandomRange)(this.direction1.z,this.direction2.z);c?Z.lc(w,v,G):x.BZ.TransformNormalFromFloatsToRef(w,v,G,M,Z)}clone(){const M=new U(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.nc(),M.direction2=this.direction2.nc(),M}parse(M){super.parse(M),x.BZ.FromArrayToRef(M.direction1,0,this.direction1),x.BZ.FromArrayToRef(M.direction2,0,this.direction2)}}class n{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=M,this.radiusRange=Z,this.directionRandomizer=P}startDirectionFunction(M,Z,P,c){const w=P.position.UZ(M.getTranslation()).normalize(),v=(0,K.RandomRange)(0,this.directionRandomizer),G=(0,K.RandomRange)(0,this.directionRandomizer),mM=(0,K.RandomRange)(0,this.directionRandomizer);w.x+=v,w.y+=G,w.z+=mM,w.normalize(),c?Z.v(w):x.BZ.TransformNormalFromFloatsToRef(w.x,w.y,w.z,M,Z)}startPositionFunction(M,Z,P,c){const w=this.radius-(0,K.RandomRange)(0,this.radius*this.radiusRange),v=(0,K.RandomRange)(0,1),G=(0,K.RandomRange)(0,2*Math.PI),mM=Math.acos(2*v-1),d=w*Math.cos(G)*Math.sin(mM),O=w*Math.cos(mM),H=w*Math.sin(G)*Math.sin(mM);c?Z.lc(d,Math.abs(O),H):x.BZ.TransformCoordinatesFromFloatsToRef(d,Math.abs(O),H,M,Z)}clone(){const M=new n(this.radius,this.directionRandomizer);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class L{constructor(){this.direction1=new x.BZ(0,1,0),this.direction2=new x.BZ(0,1,0)}startDirectionFunction(M,Z,P,c){const w=(0,K.RandomRange)(this.direction1.x,this.direction2.x),v=(0,K.RandomRange)(this.direction1.y,this.direction2.y),G=(0,K.RandomRange)(this.direction1.z,this.direction2.z);c?Z.lc(w,v,G):x.BZ.TransformNormalFromFloatsToRef(w,v,G,M,Z)}startPositionFunction(M,Z,P,c){c?Z.lc(0,0,0):x.BZ.TransformCoordinatesFromFloatsToRef(0,0,0,M,Z)}clone(){const M=new L;return d.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.nc(),M.direction2=this.direction2.nc(),M}parse(M){x.BZ.FromArrayToRef(M.direction1,0,this.direction1),x.BZ.FromArrayToRef(M.direction2,0,this.direction2)}}class u{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=M,this.radiusRange=Z,this.directionRandomizer=P}startDirectionFunction(M,Z,P,c){const w=P.position.UZ(M.getTranslation()).normalize(),v=(0,K.RandomRange)(0,this.directionRandomizer),G=(0,K.RandomRange)(0,this.directionRandomizer),mM=(0,K.RandomRange)(0,this.directionRandomizer);w.x+=v,w.y+=G,w.z+=mM,w.normalize(),c?Z.v(w):x.BZ.TransformNormalFromFloatsToRef(w.x,w.y,w.z,M,Z)}startPositionFunction(M,Z,P,c){const w=this.radius-(0,K.RandomRange)(0,this.radius*this.radiusRange),v=(0,K.RandomRange)(0,1),G=(0,K.RandomRange)(0,2*Math.PI),mM=Math.acos(2*v-1),d=w*Math.cos(G)*Math.sin(mM),O=w*Math.cos(mM),H=w*Math.sin(G)*Math.sin(mM);c?Z.lc(d,O,H):x.BZ.TransformCoordinatesFromFloatsToRef(d,O,H,M,Z)}clone(){const M=new u(this.radius,this.directionRandomizer);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class N extends u{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.BZ(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0);super(M),this.direction1=Z,this.direction2=P}startDirectionFunction(M,Z){const P=(0,K.RandomRange)(this.direction1.x,this.direction2.x),c=(0,K.RandomRange)(this.direction1.y,this.direction2.y),w=(0,K.RandomRange)(this.direction1.z,this.direction2.z);x.BZ.TransformNormalFromFloatsToRef(P,c,w,M,Z)}clone(){const M=new N(this.radius,this.direction1,this.direction2);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.nc(),M.direction2=this.direction2.nc(),M}parse(M){super.parse(M),this.direction1.v(M.direction1),this.direction2.v(M.direction2)}}class J{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(M,Z,P,c){const w=x.TmpVectors.BZ[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,P,w);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,P,w);const M=x.TmpVectors.BZ[1];w.subtractToRef(P.position,M),M.scaleToRef(1/P.lifeTime,w)}else w.set(0,0,0);c?Z.v(w):x.BZ.TransformNormalToRef(w,M,Z)}startPositionFunction(M,Z,P,c){const w=x.TmpVectors.BZ[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,P,w):w.set(0,0,0),c?Z.v(w):x.BZ.TransformCoordinatesToRef(w,M,Z)}clone(){const M=new J;return d.c.DeepCopy(this,M),M}applyToShader(M){}buildUniformLayout(M){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.particlePositionGenerator=this.particlePositionGenerator,M.particleDestinationGenerator=this.particleDestinationGenerator,M}parse(M){M.particlePositionGenerator&&(this.particlePositionGenerator=M.particlePositionGenerator),M.particleDestinationGenerator&&(this.particleDestinationGenerator=M.particleDestinationGenerator)}}var t=P(12430);class F{get mesh(){return this._mesh}set mesh(M){this._mesh!==M&&(this._mesh=M,M?(this._indices=M.Fc(),this._positions=M.getVerticesData(t.g.PositionKind),this._normals=M.getVerticesData(t.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=x.BZ.Zero(),this._mesh=null,this.direction1=new x.BZ(0,1,0),this.direction2=new x.BZ(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=M}startDirectionFunction(M,Z,P,c){if(this.useMeshNormalsForDirection&&this._normals)return void x.BZ.TransformNormalToRef(this._storedNormal,M,Z);const w=(0,K.RandomRange)(this.direction1.x,this.direction2.x),v=(0,K.RandomRange)(this.direction1.y,this.direction2.y),G=(0,K.RandomRange)(this.direction1.z,this.direction2.z);c?Z.lc(w,v,G):x.BZ.TransformNormalFromFloatsToRef(w,v,G,M,Z)}startPositionFunction(M,Z,P,c){if(!this._indices||!this._positions)return;const w=3*(Math.random()*(this._indices.length/3)|0),v=Math.random(),G=Math.random()*(1-v),mM=1-v-G,K=this._indices[w],d=this._indices[w+1],O=this._indices[w+2],H=x.TmpVectors.BZ[0],j=x.TmpVectors.BZ[1],B=x.TmpVectors.BZ[2],U=x.TmpVectors.BZ[3];x.BZ.FromArrayToRef(this._positions,3*K,H),x.BZ.FromArrayToRef(this._positions,3*d,j),x.BZ.FromArrayToRef(this._positions,3*O,B),U.x=v*H.x+G*j.x+mM*B.x,U.y=v*H.y+G*j.y+mM*B.y,U.z=v*H.z+G*j.z+mM*B.z,c?Z.lc(U.x,U.y,U.z):x.BZ.TransformCoordinatesFromFloatsToRef(U.x,U.y,U.z,M,Z),this.useMeshNormalsForDirection&&this._normals&&(x.BZ.FromArrayToRef(this._normals,3*K,H),x.BZ.FromArrayToRef(this._normals,3*d,j),x.BZ.FromArrayToRef(this._normals,3*O,B),this._storedNormal.x=v*H.x+G*j.x+mM*B.x,this._storedNormal.y=v*H.y+G*j.y+mM*B.y,this._storedNormal.z=v*H.z+G*j.z+mM*B.z)}clone(){const M=new F(this.mesh);return d.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var M;const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.nc(),Z.direction2=this.direction2.nc(),Z.meshId=null===(M=this.mesh)||void 0===M?void 0:M.id,Z.useMeshNormalsForDirection=this.useMeshNormalsForDirection,Z}parse(M,Z){x.BZ.FromArrayToRef(M.direction1,0,this.direction1),x.BZ.FromArrayToRef(M.direction2,0,this.direction2),M.meshId&&Z&&(this.mesh=Z.getLastMeshById(M.meshId)),this.useMeshNormalsForDirection=M.useMeshNormalsForDirection}}class D{_isUbo(M){return void 0!==M.addUniform}constructor(M){this._isUbo(M)?(this.setMatrix3x3=M.updateMatrix3x3.bind(M),this.setMatrix2x2=M.updateMatrix2x2.bind(M),this.setFloat=M.updateFloat.bind(M),this.setFloat2=M.updateFloat2.bind(M),this.setFloat3=M.updateFloat3.bind(M),this.setFloat4=M.updateFloat4.bind(M),this.setFloatArray=M.updateFloatArray.bind(M),this.setArray=M.updateArray.bind(M),this.setIntArray=M.updateIntArray.bind(M),this.setMatrix=M.Nc.bind(M),this.setMatrices=M.updateMatrices.bind(M),this.setVector3=M.updateVector3.bind(M),this.setVector4=M.updateVector4.bind(M),this.setColor3=M.updateColor3.bind(M),this.setColor4=M.updateColor4.bind(M),this.setDirectColor4=M.updateDirectColor4.bind(M),this.setInt=M.updateInt.bind(M),this.setInt2=M.updateInt2.bind(M),this.setInt3=M.updateInt3.bind(M),this.setInt4=M.updateInt4.bind(M)):(this.setMatrix3x3=M.setMatrix3x3.bind(M),this.setMatrix2x2=M.setMatrix2x2.bind(M),this.setFloat=M.setFloat.bind(M),this.setFloat2=M.setFloat2.bind(M),this.setFloat3=M.setFloat3.bind(M),this.setFloat4=M.setFloat4.bind(M),this.setFloatArray=M.setFloatArray.bind(M),this.setArray=M.setArray.bind(M),this.setIntArray=M.setIntArray.bind(M),this.setMatrix=M.setMatrix.bind(M),this.setMatrices=M.setMatrices.bind(M),this.setVector3=M.setVector3.bind(M),this.setVector4=M.setVector4.bind(M),this.setColor3=M.setColor3.bind(M),this.setColor4=M.setColor4.bind(M),this.setDirectColor4=M.setDirectColor4.bind(M),this.setInt=M.setInt.bind(M),this.setInt2=M.setInt2.bind(M),this.setInt3=M.setInt3.bind(M),this.setInt4=M.setInt4.bind(M))}}var l=P(12271);const h="gpuUpdateParticlesPixelShader",Q="#version 300 es\nvoid main() {discard;}\n";l.c.ShadersStore[h]||(l.c.ShadersStore[h]=Q);const I="gpuUpdateParticlesVertexShader",s="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";l.c.ShadersStore[I]||(l.c.ShadersStore[I]=s);(0,G.g)("BABYLON.WebGL2ParticleSystem",class{constructor(M,Z){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=M,this._engine=Z,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var M;return(null===(M=this._updateEffect)||void 0===M?void 0:M.isReady())??!1}createUpdateBuffer(M){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof J&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=M,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new D(this._updateEffect)}createVertexBuffers(M,Z){this._updateVAO.push(this._createUpdateVAO(M)),this._renderVAO.push(this._engine.recordVertexArrayObject(Z,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=Z}createParticleBuffer(M){return M}bindDrawBuffers(M,Z,P){P?this._engine.bindBuffers(this._renderVertexBuffers,P,Z):this._engine.bindVertexArrayObject(this._renderVAO[M],null)}preUpdateParticleBuffer(){const M=this._engine;if(this._engine.enableEffect(this._updateEffect),!M.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(M,Z,P){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[M],null);const x=this._engine;x.bindTransformFeedbackBuffer(Z.getBuffer()),x.setRasterizerState(!1),x.beginTransformFeedback(!0),x.drawArraysType(3,0,P),x.endTransformFeedback(),x.setRasterizerState(!0),x.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let M=0;M<this._updateVAO.length;M++)this._engine.releaseVertexArrayObject(this._updateVAO[M]);this._updateVAO.length=0;for(let M=0;M<this._renderVAO.length;M++)this._engine.releaseVertexArrayObject(this._renderVAO[M]);this._renderVAO.length=0}_createUpdateVAO(M){const Z={};Z.position=M.createVertexBuffer("position",0,3);let P=3;Z.age=M.createVertexBuffer("age",P,1),P+=1,Z.size=M.createVertexBuffer("size",P,3),P+=3,Z.life=M.createVertexBuffer("life",P,1),P+=1,Z.seed=M.createVertexBuffer("seed",P,4),P+=4,Z.direction=M.createVertexBuffer("direction",P,3),P+=3,this._parent.particleEmitterType instanceof J&&(Z.initialPosition=M.createVertexBuffer("initialPosition",P,3),P+=3),this._parent._colorGradientsTexture||(Z.color=M.createVertexBuffer("color",P,4),P+=4),this._parent._isBillboardBased||(Z.initialDirection=M.createVertexBuffer("initialDirection",P,3),P+=3),this._parent.noiseTexture&&(Z.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",P,3),P+=3,Z.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",P,3),P+=3),this._parent._angularSpeedGradientsTexture?(Z.angle=M.createVertexBuffer("angle",P,1),P+=1):(Z.angle=M.createVertexBuffer("angle",P,2),P+=2),this._parent._isAnimationSheetEnabled&&(Z.cellIndex=M.createVertexBuffer("cellIndex",P,1),P+=1,this._parent.spriteRandomStartCell&&(Z.cellStartOffset=M.createVertexBuffer("cellStartOffset",P,1),P+=1));const x=this._engine.recordVertexArrayObject(Z,null,this._updateEffect);return this._engine.bindArrayBuffer(null),x}});class C{constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,x=arguments.length>3?arguments[3]:void 0;this._engine=M,this._label=x,this._engine._storageBuffers.push(this),this._create(Z,P)}_create(M,Z){this._bufferSize=M,this._creationFlags=Z,this._buffer=this._engine.createStorageBuffer(M,Z,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(M,Z,P){this._buffer&&this._engine.updateStorageBuffer(this._buffer,M,Z,P)}async read(M,Z,P,x){return await this._engine.readFromStorageBuffer(this._buffer,M,Z,P,x)}dispose(){const M=this._engine._storageBuffers,Z=M.indexOf(this);-1!==Z&&(M[Z]=M[M.length-1],M.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var R=P(12351),W=P(12359),k=P(12394),A=P(12344),o=P(12664),E=P(12199),r=P(12296),q=P(12572);class e{constructor(){this._gpuTimeInFrameId=-1,this.counter=new q.b}_addDuration(M,Z){M<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==M?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(Z,!1),this._gpuTimeInFrameId=M):this.counter.addCount(Z,!1))}}var b=P(12258);class a{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=M,this._engine=Z,this.uniqueId=o.d.UniqueId,Z.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new e),this._engine.getCaps().supportComputeShaders?x.bindingsMapping?(this._context=Z.createComputeContext(),this._shaderPath=P,this._options={bindingsMapping:{},defines:[],...x}):E.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):E.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(M,Z){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=this._bindings[M];this._bindings[M]={type:P?0:4,object:Z,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!x||x.object!==Z||x.type!==this._bindings[M].type)}setStorageTexture(M,Z){const P=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==Z),this._bindings[M]={type:1,object:Z,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setExternalTexture(M,Z){const P=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==Z),this._bindings[M]={type:6,object:Z,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setVideoTexture(M,Z){return!!Z.externalTexture&&(this.setExternalTexture(M,Z.externalTexture),!0)}setUniformBuffer(M,Z){const P=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==Z),this._bindings[M]={type:a._BufferIsDataBuffer(Z)?7:2,object:Z,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setStorageBuffer(M,Z){const P=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==Z),this._bindings[M]={type:a._BufferIsDataBuffer(Z)?7:3,object:Z,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setTextureSampler(M,Z){const P=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!P||!Z.compareSampler(P.object)),this._bindings[M]={type:5,object:Z,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}isReady(){let M=this._effect;for(const c in this._bindings){const M=this._bindings[c],Z=M.type,P=M.object;switch(Z){case 0:case 4:case 1:if(!P.isReady())return!1;break;case 6:if(!P.isReady())return!1;break}}const Z=[],P=this._shaderPath;if(this._options.defines)for(let c=0;c<this._options.defines.length;c++)Z.push(this._options.defines[c]);const x=Z.join("\n");return this._cachedDefines!==x&&(this._cachedDefines=x,M=this._engine.createComputeEffect(P,{defines:x,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=M),!!M.isReady()}dispatch(M,Z,P){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,M,Z,P,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const P=a._BufferIsDataBuffer(M)?M:M.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,P,Z,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const Z in this._bindings){const P=this._bindings[Z];if(!this._options.bindingsMapping[Z])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+Z+"'");switch(P.type){case 0:{const x=this._samplers[Z],c=P.object;var M;if(!x||!c._texture||!x.compareSampler(c._texture))this._samplers[Z]=(new r.e).setParameters(c.wrapU,c.wrapV,c.wrapR,c.anisotropicFilteringLevel,c._texture.samplingMode,null===(M=c._texture)||void 0===M?void 0:M._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const M=P.object;M.getBuffer()!==P.buffer&&(P.buffer=M.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((c=>{(0,b.d)((()=>this.dispatch(M,Z,P)),c,void 0,x)}))}serialize(){const M=k.b.Serialize(this);M.options=this._options,M.shaderPath=this._shaderPath,M.xj={},M.textures={};for(const Z in this._bindings){const P=this._bindings[Z],x=P.object;switch(P.type){case 0:case 4:case 1:{const c=x.serialize();c&&(M.textures[Z]=c,M.xj[Z]={type:P.type});break}}}return M}static Parse(M,Z,P){const x=k.b.Parse((()=>new a(M.name,Z.getEngine(),M.shaderPath,M.options)),M,Z,P);for(const c in M.textures){const w=M.xj[c],v=A.e.Parse(M.textures[c],Z,P);0===w.type?x.setTexture(c,v):4===w.type?x.setTexture(c,v,!1):x.setStorageTexture(c,v)}return x}static _BufferIsDataBuffer(M){return void 0!==M.underlyingResource}}(0,R.c)([(0,W.H)()],a.prototype,"name",void 0),(0,R.c)([(0,W.H)()],a.prototype,"fastMode",void 0),(0,G.g)("BABYLON.ComputeShader",a);var y=P(12623);const f="gpuUpdateParticlesComputeShader",Y="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";l.c.ShadersStoreWGSL[f]||(l.c.ShadersStoreWGSL[f]=Y);(0,G.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(M,Z){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=M,this._engine=Z}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var M;return(null===(M=this._updateComputeShader)||void 0===M?void 0:M.isReady())??!1}createUpdateBuffer(M){var Z;const P={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(P.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(P.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(P.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(P.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(P.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(P.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(P.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new a("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:P,defines:M.split("\n")}),null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=new y.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new D(this._simParamsComputeShader)}createVertexBuffers(M,Z){this._renderVertexBuffers.push(Z)}createParticleBuffer(M){const Z=new C(this._engine,4*M.length,11,"ComputeShaderParticleSystemBuffer");return Z.update(M),this._bufferComputeShader.push(Z),Z.getBuffer()}bindDrawBuffers(M,Z,P){this._engine.bindBuffers(this._renderVertexBuffers[M],P,Z)}preUpdateParticleBuffer(){}updateParticleBuffer(M,Z,P){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[M]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^M]),this._updateComputeShader.dispatch(Math.ceil(P/64))}releaseBuffers(){var M;for(let Z=0;Z<this._bufferComputeShader.length;++Z)this._bufferComputeShader[Z].dispose();this._bufferComputeShader.length=0,null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(M,Z,P){this.gradient=M,this.color1=Z,this.color2=P}getColorToRef(M){this.color2?v.Ic.LerpToRef(this.color1,this.color2,Math.random(),M):M.v(this.color1)}}class i{constructor(M,Z){this.gradient=M,this.color=Z}}class T{constructor(M,Z,P){this.gradient=M,this.factor1=Z,this.factor2=P}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class p{static GetCurrentGradient(M,Z,P){if(Z[0].gradient>M)return void P(Z[0],Z[0],1);for(let c=0;c<Z.length-1;c++){const x=Z[c],w=Z[c+1];if(M>=x.gradient&&M<=w.gradient){return void P(x,w,(M-x.gradient)/(w.gradient-x.gradient))}}const x=Z.length-1;P(Z[x],Z[x],1)}}var S=P(12184),X=P(12841),V=P(12225);class g{constructor(M){this.particleSystem=M,this.position=x.BZ.Zero(),this.direction=x.BZ.Zero(),this.color=new v.Ic(0,0,0,0),this.colorStep=new v.Ic(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new x.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new v.Ic(0,0,0,0),this._currentColor2=new v.Ic(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=g._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let M=this.age,Z=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===Z?(Z=1,M=this._randomCellOffset):M+=this._randomCellOffset);const P=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let x;x=this._initialSpriteCellLoop?(0,K.Clamp)(M*Z%this.lifeTime/this.lifeTime):(0,K.Clamp)(M*Z/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+x*P|0}_inheritParticleInfoToSubEmitter(M){if(M.particleSystem.xZ.position){const Z=M.particleSystem.xZ;if(Z.position.v(this.position),M.inheritDirection){const M=x.TmpVectors.BZ[0];this.direction.normalizeToRef(M),Z.setDirection(M,0,Math.PI/2)}}else{M.particleSystem.xZ.v(this.position)}this.direction.scaleToRef(M.inheritedVelocityAmount/2,x.TmpVectors.BZ[0]),M.particleSystem._inheritedVelocityOffset.v(x.TmpVectors.BZ[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const M of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(M)}_reset(){this.age=0,this.id=g._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(M){M.position.v(this.position),this._initialDirection?M._initialDirection?M._initialDirection.v(this._initialDirection):M._initialDirection=this._initialDirection.clone():M._initialDirection=null,M.direction.v(this.direction),this.Nm&&(M.Nm?M.Nm.v(this.Nm):M.Nm=this.Nm.clone()),M.color.v(this.color),M.colorStep.v(this.colorStep),M.lifeTime=this.lifeTime,M.age=this.age,M._randomCellOffset=this._randomCellOffset,M.size=this.size,M.scale.v(this.scale),M.angle=this.angle,M.angularSpeed=this.angularSpeed,M.particleSystem=this.particleSystem,M.cellIndex=this.cellIndex,M.id=this.id,M._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(M._currentColorGradient=this._currentColorGradient,M._currentColor1.v(this._currentColor1),M._currentColor2.v(this._currentColor2)),this._currentSizeGradient&&(M._currentSizeGradient=this._currentSizeGradient,M._currentSize1=this._currentSize1,M._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(M._currentAngularSpeedGradient=this._currentAngularSpeedGradient,M._currentAngularSpeed1=this._currentAngularSpeed1,M._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(M._currentVelocityGradient=this._currentVelocityGradient,M._currentVelocity1=this._currentVelocity1,M._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(M._currentLimitVelocityGradient=this._currentLimitVelocityGradient,M._currentLimitVelocity1=this._currentLimitVelocity1,M._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(M._currentDragGradient=this._currentDragGradient,M._currentDrag1=this._currentDrag1,M._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(M._initialStartSpriteCellId=this._initialStartSpriteCellId,M._initialEndSpriteCellId=this._initialEndSpriteCellId,M._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(M.remapData&&this.remapData?M.remapData.v(this.remapData):M.remapData=new x.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.v(this._randomNoiseCoordinates1),M._randomNoiseCoordinates2.v(this._randomNoiseCoordinates2)):(M._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),M._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}g._Count=0;var MM=P(12471),ZM=(P(12530),P(12735)),PM=P(12731),xM=P(12614);function cM(M,Z){const P=(0,K.RandomRange)(0,1);v.Ic.LerpToRef(Z.color1,Z.color2,P,M.color),Z.colorDead.subtractToRef(M.color,Z._colorDiff),Z._colorDiff.scaleToRef(1/M.lifeTime,M.colorStep)}function wM(M,Z){M._currentColorGradient=Z._colorGradients[0],M._currentColorGradient.getColorToRef(M.color),M._currentColor1.v(M.color),Z._colorGradients.length>1?Z._colorGradients[1].getColorToRef(M._currentColor2):M._currentColor2.v(M.color)}function vM(M,Z){const P=Z._colorGradients;p.GetCurrentGradient(Z._ratio,P,((Z,P,x)=>{Z!==M._currentColorGradient&&(M._currentColor1.v(M._currentColor2),P.getColorToRef(M._currentColor2),M._currentColorGradient=Z),v.Ic.LerpToRef(M._currentColor1,M._currentColor2,x,M.color)}))}function GM(M,Z){M.colorStep.scaleToRef(Z._scaledUpdateSpeed,Z._scaledColorStep),M.color.addInPlace(Z._scaledColorStep),M.color.a<0&&(M.color.a=0)}function mZ(M,Z){p.GetCurrentGradient(Z._ratio,Z._angularSpeedGradients,((Z,P,x)=>{Z!==M._currentAngularSpeedGradient&&(M._currentAngularSpeed1=M._currentAngularSpeed2,M._currentAngularSpeed2=P.getFactor(),M._currentAngularSpeedGradient=Z),M.angularSpeed=(0,K.Lerp)(M._currentAngularSpeed1,M._currentAngularSpeed2,x)}))}function KM(M,Z){M.angle+=M.angularSpeed*Z._scaledUpdateSpeed}function dM(M,Z){Z.particleEmitterType.startDirectionFunction(Z._emitterWorldMatrix,M.direction,M,Z.isLocal,Z._emitterInverseWorldMatrix)}function OM(M,Z){Z.startDirectionFunction(Z._emitterWorldMatrix,M.direction,M,Z.isLocal)}function HM(M,Z){M._currentVelocityGradient=Z._velocityGradients[0],M._currentVelocity1=M._currentVelocityGradient.getFactor(),Z._velocityGradients.length>1?M._currentVelocity2=Z._velocityGradients[1].getFactor():M._currentVelocity2=M._currentVelocity1}function jM(M,Z){M._currentLimitVelocityGradient=Z._limitVelocityGradients[0],M._currentLimitVelocity1=M._currentLimitVelocityGradient.getFactor(),Z._limitVelocityGradients.length>1?M._currentLimitVelocity2=Z._limitVelocityGradients[1].getFactor():M._currentLimitVelocity2=M._currentLimitVelocity1}function BM(M,Z){p.GetCurrentGradient(Z._ratio,Z._velocityGradients,((P,x,c)=>{P!==M._currentVelocityGradient&&(M._currentVelocity1=M._currentVelocity2,M._currentVelocity2=x.getFactor(),M._currentVelocityGradient=P),Z._directionScale*=(0,K.Lerp)(M._currentVelocity1,M._currentVelocity2,c)}))}function UM(M,Z){p.GetCurrentGradient(Z._ratio,Z._limitVelocityGradients,((P,x,c)=>{P!==M._currentLimitVelocityGradient&&(M._currentLimitVelocity1=M._currentLimitVelocity2,M._currentLimitVelocity2=x.getFactor(),M._currentLimitVelocityGradient=P);const w=(0,K.Lerp)(M._currentLimitVelocity1,M._currentLimitVelocity2,c);M.direction.length()>w&&M.direction.scaleInPlace(Z.limitVelocityDamping)}))}function nM(M,Z){M.direction.scaleToRef(Z._directionScale,Z._scaledDirection)}function LM(M,Z){Z.particleEmitterType.startPositionFunction(Z._emitterWorldMatrix,M.position,M,Z.isLocal)}function uM(M,Z){Z.startPositionFunction(Z._emitterWorldMatrix,M.position,M,Z.isLocal)}function NM(M,Z){M.Nm?M.Nm.v(M.position):M.Nm=M.position.clone(),x.BZ.TransformCoordinatesToRef(M.Nm,Z._emitterWorldMatrix,M.position)}function JM(M,Z){Z.isLocal&&M.Nm?(M.Nm.addInPlace(Z._scaledDirection),x.BZ.TransformCoordinatesToRef(M.Nm,Z._emitterWorldMatrix,M.position)):M.position.addInPlace(Z._scaledDirection)}function tM(M,Z){M._currentDragGradient=Z._dragGradients[0],M._currentDrag1=M._currentDragGradient.getFactor(),Z._dragGradients.length>1?M._currentDrag2=Z._dragGradients[1].getFactor():M._currentDrag2=M._currentDrag1}function FM(M,Z){p.GetCurrentGradient(Z._ratio,Z._dragGradients,((P,x,c)=>{P!==M._currentDragGradient&&(M._currentDrag1=M._currentDrag2,M._currentDrag2=x.getFactor(),M._currentDragGradient=P);const w=(0,K.Lerp)(M._currentDrag1,M._currentDrag2,c);Z._scaledDirection.scaleInPlace(1-w)}))}function DM(M,Z){M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.lc(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2.lc(Math.random(),Math.random(),Math.random())):(M._randomNoiseCoordinates1=new x.BZ(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2=new x.BZ(Math.random(),Math.random(),Math.random()))}function lM(M,Z){const P=Z._noiseTextureData,c=Z._noiseTextureSize;if(P&&c&&M._randomNoiseCoordinates1){const w=Z._fetchR(M._randomNoiseCoordinates1.x,M._randomNoiseCoordinates1.y,c.width,c.height,P),v=Z._fetchR(M._randomNoiseCoordinates1.z,M._randomNoiseCoordinates2.x,c.width,c.height,P),G=Z._fetchR(M._randomNoiseCoordinates2.y,M._randomNoiseCoordinates2.z,c.width,c.height,P),mM=x.TmpVectors.BZ[0],K=x.TmpVectors.BZ[1];mM.lc((2*w-1)*Z.noiseStrength.x,(2*v-1)*Z.noiseStrength.y,(2*G-1)*Z.noiseStrength.z),mM.scaleToRef(Z._tempScaledUpdateSpeed,K),M.direction.addInPlace(K)}}function hM(M,Z){Z.gravity.scaleToRef(Z._tempScaledUpdateSpeed,Z._scaledGravity),M.direction.addInPlace(Z._scaledGravity)}function QM(M,Z){M.size=(0,K.RandomRange)(Z.minSize,Z.maxSize),M.scale.lc((0,K.RandomRange)(Z.minScaleX,Z.maxScaleX),(0,K.RandomRange)(Z.minScaleY,Z.maxScaleY))}function IM(M,Z){M._currentSizeGradient=Z._sizeGradients[0],M._currentSize1=M._currentSizeGradient.getFactor(),M.size=M._currentSize1,Z._sizeGradients.length>1?M._currentSize2=Z._sizeGradients[1].getFactor():M._currentSize2=M._currentSize1,M.scale.lc((0,K.RandomRange)(Z.minScaleX,Z.maxScaleX),(0,K.RandomRange)(Z.minScaleY,Z.maxScaleY))}function sM(M,Z){const P=Z._actualFrame/Z.targetStopDuration;p.GetCurrentGradient(P,Z._startSizeGradients,((P,x,c)=>{P!==Z._currentStartSizeGradient&&(Z._currentStartSize1=Z._currentStartSize2,Z._currentStartSize2=x.getFactor(),Z._currentStartSizeGradient=P);const w=(0,K.Lerp)(Z._currentStartSize1,Z._currentStartSize2,c);M.scale.scaleInPlace(w)}))}function CM(M,Z){p.GetCurrentGradient(Z._ratio,Z._sizeGradients,((Z,P,x)=>{Z!==M._currentSizeGradient&&(M._currentSize1=M._currentSize2,M._currentSize2=P.getFactor(),M._currentSizeGradient=Z),M.size=(0,K.Lerp)(M._currentSize1,M._currentSize2,x)}))}function RM(M,Z){M.remapData=new x.Vector4(0,1,0,1)}function WM(M,Z){Z._colorRemapGradients&&Z._colorRemapGradients.length>0&&p.GetCurrentGradient(Z._ratio,Z._colorRemapGradients,((Z,P,x)=>{const c=(0,K.Lerp)(Z.factor1,P.factor1,x),w=(0,K.Lerp)(Z.factor2,P.factor2,x);M.remapData.x=c,M.remapData.y=w-c})),Z._alphaRemapGradients&&Z._alphaRemapGradients.length>0&&p.GetCurrentGradient(Z._ratio,Z._alphaRemapGradients,((Z,P,x)=>{const c=(0,K.Lerp)(Z.factor1,P.factor1,x),w=(0,K.Lerp)(Z.factor2,P.factor2,x);M.remapData.z=c,M.remapData.w=w-c}))}function kM(M,Z){const P=(0,K.Clamp)(Z._actualFrame/Z.targetStopDuration);p.GetCurrentGradient(P,Z._lifeTimeGradients,((Z,x)=>{const c=Z,w=x,v=c.getFactor(),G=w.getFactor(),mM=(P-c.gradient)/(w.gradient-c.gradient);M.lifeTime=(0,K.Lerp)(v,G,mM)})),Z._emitPower=(0,K.RandomRange)(Z.minEmitPower,Z.maxEmitPower)}function AM(M,Z){M.lifeTime=(0,K.RandomRange)(Z.minLifeTime,Z.maxLifeTime),Z._emitPower=(0,K.RandomRange)(Z.minEmitPower,Z.maxEmitPower)}function oM(M,Z){0===Z._emitPower?(M._initialDirection?M._initialDirection.v(M.direction):M._initialDirection=M.direction.clone(),M.direction.set(0,0,0)):(M._initialDirection=null,M.direction.scaleInPlace(Z._emitPower)),M.direction.addInPlace(Z._inheritedVelocityOffset)}function EM(M,Z){M.angularSpeed=(0,K.RandomRange)(Z.minAngularSpeed,Z.maxAngularSpeed),M.angle=(0,K.RandomRange)(Z.minInitialRotation,Z.maxInitialRotation)}function rM(M,Z){M._currentAngularSpeedGradient=Z._angularSpeedGradients[0],M.angularSpeed=M._currentAngularSpeedGradient.getFactor(),M._currentAngularSpeed1=M.angularSpeed,Z._angularSpeedGradients.length>1?M._currentAngularSpeed2=Z._angularSpeedGradients[1].getFactor():M._currentAngularSpeed2=M._currentAngularSpeed1,M.angle=(0,K.RandomRange)(Z.minInitialRotation,Z.maxInitialRotation)}function qM(M,Z){M._initialStartSpriteCellId=Z.startSpriteCellID,M._initialEndSpriteCellId=Z.endSpriteCellID,M._initialSpriteCellLoop=Z.spriteCellLoop}function eM(M,Z){M.previousItem=Z.previousItem,M.nextItem=Z,Z.previousItem&&(Z.previousItem.nextItem=M),Z.previousItem=M}function bM(M,Z){M.previousItem=Z,M.nextItem=Z.nextItem,Z.nextItem&&(Z.nextItem.previousItem=M),Z.nextItem=M}function aM(M,Z){let P=Z;for(;P.nextItem;)P=P.nextItem;M.previousItem=P,M.nextItem=P.nextItem,P.nextItem=M}function yM(M){M.previousItem&&(M.previousItem.nextItem=M.nextItem),M.nextItem&&(M.nextItem.previousItem=M.previousItem)}class fM extends mM{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(M){this._startDirectionFunction!==M&&(this._startDirectionFunction=M,this._directionProcessing.process=M?OM:dM)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(M){this._startPositionFunction!==M&&(this._startPositionFunction=M,this._positionCreation.process=M?uM:LM)}set onDispose(M){this._onDisposeObserver&&this.Gc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Gc.add(M)}get K(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(M){this._useRampGradients!==M&&(this._useRampGradients=M,this._resetEffect(),M?(this._rampCreation={process:RM,previousItem:null,nextItem:null},bM(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:WM,previousItem:null,nextItem:null},bM(this._remapGradientProcessing,this._gravityProcessing)):(yM(this._rampCreation),yM(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(M){this._isLocal!==M&&(this._isLocal=M,M?(this._isLocalCreation={process:NM,previousItem:null,nextItem:null},bM(this._isLocalCreation,this._positionCreation)):yM(this._isLocalCreation))}get particles(){return this.VH}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(M){this._animationSheetEnabled!==M&&(this._animationSheetEnabled=M,M?(this._sheetCreation={process:qM,previousItem:null,nextItem:null},bM(this._sheetCreation,this._colorCreation)):yM(this._sheetCreation),this._reset())}getActiveCount(){return this.VH.length}getClassName(){return"Ac"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var M;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(M=this._customWrappers[Z])||void 0===M?void 0:M.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[M]??this._customWrappers[0]}setCustomEffect(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Z]=new MM.e(this._engine),this._customWrappers[Z].effect=M,this._customWrappers[Z].drawContext&&(this._customWrappers[Z].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(M){if(this.noiseTexture!==M){if(this._noiseTexture=M,!M)return yM(this._noiseCreation),void yM(this._noiseProcessing);this._noiseCreation={process:DM,previousItem:null,nextItem:null},bM(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:lM,previousItem:null,nextItem:null},bM(this._noiseProcessing,this._positionProcessing)}}constructor(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,mM=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(M),this._emitterInverseWorldMatrix=x.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new x.BZ,this.Gc=new S.b,this.onStoppedObservable=new S.b,this.onStartedObservable=new S.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.VH=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new v.Ic(0,0,0,0),this._colorDiff=new v.Ic(0,0,0,0),this._scaledDirection=x.BZ.Zero(),this._scaledGravity=x.BZ.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=M=>{},this.recycleParticle=M=>{const Z=this.VH.pop();Z!==M&&Z.copyTo(M),this._stockParticles.push(Z)},this._createParticle=()=>{let M;return 0!==this._stockParticles.length?(M=this._stockParticles.pop(),M._reset()):M=new g(this),this._prepareParticle(M),M},this.paused=!1,this._shadersLoaded=!1,this._capacity=Z,this._epsilon=G,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=x.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||V.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SH.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:AM,previousItem:null,nextItem:null},this._positionCreation={process:LM,previousItem:null,nextItem:null},bM(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:dM,previousItem:null,nextItem:null},bM(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:oM,previousItem:null,nextItem:null},bM(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:QM,previousItem:null,nextItem:null},bM(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:EM,previousItem:null,nextItem:null},bM(this._angleCreation,this._sizeCreation),this._colorCreation={process:cM,previousItem:null,nextItem:null},bM(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,mM||(this._colorProcessing={process:GM,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:KM,previousItem:null,nextItem:null},bM(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:nM,previousItem:null,nextItem:null},bM(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:JM,previousItem:null,nextItem:null},bM(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:hM,previousItem:null,nextItem:null},bM(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=w,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new MM.e(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new O,this.updateFunction=M=>{var Z;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(Z=this.noiseTexture.getContent())||void 0===Z||Z.then((M=>{this._noiseTextureData=M})));const P=M===this.VH;for(let x=0;x<M.length;x++){const Z=M[x];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const c=Z.age;if(Z.age+=this._tempScaledUpdateSpeed,Z.age>Z.lifeTime){const M=Z.age-c,P=Z.lifeTime-c;this._tempScaledUpdateSpeed=P*this._tempScaledUpdateSpeed/M,Z.age=Z.lifeTime}this._ratio=Z.age/Z.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let w=this._updateQueueStart;for(;w;)w.process(Z,this),w=w.nextItem;if(this._isAnimationSheetEnabled&&!mM&&Z.updateCellIndex(),Z._inheritParticleInfoToSubEmitters(),Z.age>=Z.lifeTime){if(this._emitFromParticle(Z),Z._attachedSubEmitters){for(const M of Z._attachedSubEmitters)M.particleSystem.disposeOnStop=!0,M.particleSystem.stop();Z._attachedSubEmitters=null}this.recycleParticle(Z),P&&x--}else;}}}serialize(M){throw new Error("Method not implemented.")}clone(M,Z){throw new Error("Method not implemented.")}_addFactorGradient(M,Z,P,x){const c=new T(Z,P,x);M.push(c),M.sort(((M,Z)=>M.gradient<Z.gradient?-1:M.gradient>Z.gradient?1:0))}_removeFactorGradient(M,Z){if(!M)return;let P=0;for(const x of M){if(x.gradient===Z){M.splice(P,1);break}P++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=kM:this._lifeTimeCreation.process=AM}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:sM,previousItem:null,nextItem:null},bM(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(yM(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(M){this.targetStopDuration!==M&&(this._targetStopDuration=M,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(M,Z,P){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,M,Z,P),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(M){return this._removeFactorGradient(this._lifeTimeGradients,M),this._syncLifeTimeCreation(),this}addSizeGradient(M,Z,P){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=IM,this._sizeGradientProcessing={process:CM,previousItem:null,nextItem:null},eM(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,M,Z,P),this}removeSizeGradient(M){var Z;return this._removeFactorGradient(this._sizeGradients,M),0===(null===(Z=this._sizeGradients)||void 0===Z?void 0:Z.length)&&(yM(this._sizeGradientProcessing),this._sizeCreation.process=QM),this}addColorRemapGradient(M,Z,P){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,M,Z,P),this}removeColorRemapGradient(M){return this._removeFactorGradient(this._colorRemapGradients,M),this}addAlphaRemapGradient(M,Z,P){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,M,Z,P),this}removeAlphaRemapGradient(M){return this._removeFactorGradient(this._alphaRemapGradients,M),this}addAngularSpeedGradient(M,Z,P){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=rM,this._angularSpeedGradientProcessing={process:mZ,previousItem:null,nextItem:null},eM(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,M,Z,P),this}removeAngularSpeedGradient(M){var Z;return this._removeFactorGradient(this._angularSpeedGradients,M),0===(null===(Z=this._angularSpeedGradients)||void 0===Z?void 0:Z.length)&&(this._angleCreation.process=EM,yM(this._angularSpeedGradientProcessing)),this}addVelocityGradient(M,Z,P){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:HM,previousItem:null,nextItem:null},bM(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:BM,previousItem:null,nextItem:null},eM(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,M,Z,P),this}removeVelocityGradient(M){var Z;return this._removeFactorGradient(this._velocityGradients,M),0===(null===(Z=this._velocityGradients)||void 0===Z?void 0:Z.length)&&(yM(this._velocityCreation),yM(this._velocityGradientProcessing)),this}addLimitVelocityGradient(M,Z,P){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:jM,previousItem:null,nextItem:null},bM(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:UM,previousItem:null,nextItem:null},bM(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,M,Z,P),this}removeLimitVelocityGradient(M){var Z;return this._removeFactorGradient(this._limitVelocityGradients,M),0===(null===(Z=this._limitVelocityGradients)||void 0===Z?void 0:Z.length)&&(yM(this._limitVelocityCreation),yM(this._limitVelocityGradientProcessing)),this}addDragGradient(M,Z,P){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:tM,previousItem:null,nextItem:null},eM(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:FM,previousItem:null,nextItem:null},eM(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,M,Z,P),this}removeDragGradient(M){var Z;return this._removeFactorGradient(this._dragGradients,M),0===(null===(Z=this._dragGradients)||void 0===Z?void 0:Z.length)&&(yM(this._dragCreation),yM(this._dragGradientProcessing)),this}addEmitRateGradient(M,Z,P){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,M,Z,P),this}removeEmitRateGradient(M){return this._removeFactorGradient(this._emitRateGradients,M),this}addStartSizeGradient(M,Z,P){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,M,Z,P),this._syncStartSizeCreation(),this}removeStartSizeGradient(M){return this._removeFactorGradient(this._startSizeGradients,M),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const M=new Uint8Array(4*this._rawTextureWidth),Z=v.TmpColors.uZ[0];for(let P=0;P<this._rawTextureWidth;P++){const x=P/this._rawTextureWidth;p.GetCurrentGradient(x,this._rampGradients,((x,c,w)=>{v.uZ.LerpToRef(x.color,c.color,w,Z),M[4*P]=255*Z.r,M[4*P+1]=255*Z.g,M[4*P+2]=255*Z.b,M[4*P+3]=255}))}this._rampGradientsTexture=X.e.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((M,Z)=>M.gradient<Z.gradient?-1:M.gradient>Z.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(M,Z){this._rampGradients||(this._rampGradients=[]);const P=new i(M,Z);return this._rampGradients.push(P),this._syncRampGradientTexture(),this}removeRampGradient(M){return this._removeGradientAndTexture(M,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(M,Z,P){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=wM,this._colorProcessing.process=vM);const x=new z(M,Z,P);return this._colorGradients.push(x),this._colorGradients.sort(((M,Z)=>M.gradient<Z.gradient?-1:M.gradient>Z.gradient?1:0)),this}removeColorGradient(M){if(!this._colorGradients)return this;let Z=0;for(const P of this._colorGradients){if(P.gradient===M){this._colorGradients.splice(Z,1);break}Z++}return 0===this._colorGradients.length&&(this._colorCreation.process=cM,this._colorProcessing.process=GM),this}resetDrawCache(){if(this._drawWrappers){for(const M of this._drawWrappers)if(M)for(const Z of M)null===Z||void 0===Z||Z.dispose();this._drawWrappers=[]}}_fetchR(M,Z,P,x,c){return c[4*(((M=.5*Math.abs(M)+.5)*P%P|0)+((Z=.5*Math.abs(Z)+.5)*x%x|0)*P)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const M=this._engine,Z=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*Z),this._vertexBuffer=new t.c(M,this._vertexData,!0,Z);let P=0;const x=this._vertexBuffer.createVertexBuffer(t.g.PositionKind,P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[t.g.PositionKind]=x,P+=3;const c=this._vertexBuffer.createVertexBuffer(t.g.ColorKind,P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[t.g.ColorKind]=c,P+=4;const w=this._vertexBuffer.createVertexBuffer("angle",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=w,P+=1;const v=this._vertexBuffer.createVertexBuffer("size",P,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=v,P+=2,this._isAnimationSheetEnabled){const M=this._vertexBuffer.createVertexBuffer("cellIndex",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=M,P+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const M=this._vertexBuffer.createVertexBuffer("direction",P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=M,P+=3}if(this._useRampGradients){const M=this._vertexBuffer.createVertexBuffer("remapData",P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=M,P+=4}let G;if(this._useInstancing){const Z=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new t.c(M,Z,!1,2),G=this._spriteBuffer.createVertexBuffer("offset",0,2)}else G=this._vertexBuffer.createVertexBuffer("offset",P,2,this._vertexBufferSize,this._useInstancing),P+=2;this._vertexBuffers.offset=G,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const M=[],Z=[];let P=0;for(let x=0;x<this._capacity;x++)M.push(P),M.push(P+1),M.push(P+2),M.push(P),M.push(P+2),M.push(P+3),Z.push(P,P+1,P+1,P+2,P+2,P+3,P+3,P,P,P+3),P+=4;this._indexBuffer=this._engine.createIndexBuffer(M),this._linesIndexBuffer=this._engine.createIndexBuffer(Z)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(M)setTimeout((()=>{this.start(0)}),M);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var Z;-1!==(null===(Z=this.xZ)||void 0===Z?void 0:Z.getClassName().indexOf("Mesh"))&&this.xZ.Jc(!0);const M=this.noiseTexture;if(M&&M.onGeneratedObservable)M.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),M.render()}))}));else for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(M))}_postStop(M){}reset(){this._stockParticles.length=0,this.VH.length=0}_appendParticleVertex(M,Z,P,c){let w=M*this._vertexBufferSize;if(this._vertexData[w++]=Z.position.x+this.fK.x,this._vertexData[w++]=Z.position.y+this.fK.y,this._vertexData[w++]=Z.position.z+this.fK.z,this._vertexData[w++]=Z.color.r,this._vertexData[w++]=Z.color.g,this._vertexData[w++]=Z.color.b,this._vertexData[w++]=Z.color.a,this._vertexData[w++]=Z.angle,this._vertexData[w++]=Z.scale.x*Z.size,this._vertexData[w++]=Z.scale.y*Z.size,this._isAnimationSheetEnabled&&(this._vertexData[w++]=Z.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[w++]=Z.direction.x,this._vertexData[w++]=Z.direction.y,this._vertexData[w++]=Z.direction.z);else if(Z._initialDirection){let M=Z._initialDirection;this.isLocal&&(x.BZ.TransformNormalToRef(M,this._emitterWorldMatrix,x.TmpVectors.BZ[0]),M=x.TmpVectors.BZ[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[w++]=M.x,this._vertexData[w++]=M.y,this._vertexData[w++]=M.z}else{let M=Z.direction;this.isLocal&&(x.BZ.TransformNormalToRef(M,this._emitterWorldMatrix,x.TmpVectors.BZ[0]),M=x.TmpVectors.BZ[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[w++]=M.x,this._vertexData[w++]=M.y,this._vertexData[w++]=M.z}this._useRampGradients&&Z.remapData&&(this._vertexData[w++]=Z.remapData.x,this._vertexData[w++]=Z.remapData.y,this._vertexData[w++]=Z.remapData.z,this._vertexData[w++]=Z.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===P?P=this._epsilon:1===P&&(P=1-this._epsilon),0===c?c=this._epsilon:1===c&&(c=1-this._epsilon)),this._vertexData[w++]=P,this._vertexData[w++]=c)}_prepareParticle(M){}_createNewOnes(M){let Z;for(let P=0;P<M&&this.VH.length!==this._capacity;P++){Z=this._createParticle(),this.VH.push(Z);let M=this._createQueueStart;for(;M;)M.process(Z,this),M=M.nextItem;Z._inheritParticleInfoToSubEmitters()}}_update(M){if(this._alive=this.VH.length>0,this.xZ.position){const M=this.xZ;this._emitterWorldMatrix=M.getWorldMatrix()}else{const M=this.xZ;this._emitterWorldMatrix=x.Matrix.Translation(M.x,M.y,M.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.VH),this._createNewOnes(M)}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=[t.g.PositionKind,t.g.ColorKind,"angle","offset","size"];return M&&x.push("cellIndex"),Z||x.push("direction"),P&&x.push("remapData"),x}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,ZM.e)(x),M&&x.push("particlesInfos"),Z&&x.push("logarithmicDepthConstant"),P&&(x.push("vFogInfos"),x.push("vFogColor")),x}fillDefines(M,Z){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ZM.h)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&M.push("#define FOG")),this._isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),Z===mM.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&M.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case 2:M.push("#define BILLBOARDY");break;case 8:case 9:M.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&M.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:M.push("#define BILLBOARDMODE_ALL")}P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,Z,P){Z.push(...fM._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),M.push(...fM._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,xM.d)(M,this._imageProcessingConfigurationDefines),(0,xM.c)(P,this._imageProcessingConfigurationDefines))}_getWrapper(M){const Z=this._getCustomDrawWrapper(M);if(null!==Z&&void 0!==Z&&Z.effect)return Z;const P=[];this.fillDefines(P,M);const x=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let c=this._drawWrappers[x];c||(c=this._drawWrappers[x]=[]);let w=c[M];w||(w=new MM.e(this._engine),w.drawContext&&(w.drawContext.useInstancing=this._useInstancing),c[M]=w);const v=P.join("\n");if(w.defines!==v){const M=[],Z=[],P=[];this.fillUniformsAttributesAndSamplerNames(Z,M,P),w.setEffect(this._engine.createEffect("particles",M,Z,P,v,void 0,void 0,void 0,void 0,this._shaderLanguage),v)}return w}animate(){var M;let Z,P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!P&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(P?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this.manualEmitCount>-1)Z=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let M=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const Z=this._actualFrame/this.targetStopDuration;p.GetCurrentGradient(Z,this._emitRateGradients,((Z,P,x)=>{Z!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=P.getFactor(),this._currentEmitRateGradient=Z),M=(0,K.Lerp)(this._currentEmitRate1,this._currentEmitRate2,x)}))}Z=M*this._scaledUpdateSpeed|0,this._newPartsExcess+=M*this._scaledUpdateSpeed-Z}if(this._newPartsExcess>1&&(Z+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?Z=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(Z),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!P){let M=0;for(let Z=0;Z<this.VH.length;Z++){const P=this.VH[Z];this._appendParticleVertices(M,P),M+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.VH.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(M,Z){this._appendParticleVertex(M++,Z,0,0),this._useInstancing||(this._appendParticleVertex(M++,Z,1,0),this._appendParticleVertex(M++,Z,1,1),this._appendParticleVertex(M++,Z,0,1))}rebuild(){var M;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(M=this._spriteBuffer)||void 0===M||M._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!fM.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(P.bind(P,13835)),Promise.resolve().then(P.bind(P,13788))])):await Promise.all([Promise.resolve().then(P.bind(P,13775)),Promise.resolve().then(P.bind(P,13766))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.xZ||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==mM.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(mM.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(mM.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(M){const Z=this._getWrapper(M),P=Z.effect,c=this._engine;c.enableEffect(Z);const w=this.defaultViewMatrix??this._scene.getViewMatrix();if(P.setTexture("diffuseSampler",this.particleTexture),P.setMatrix("view",w),P.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();P.setFloat3("particlesInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,this.spriteCellWidth/M.width)}if(P.setVector2("translationPivot",this.translationPivot),P.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;P.setVector3("eyePosition",M.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),P.setTexture("rampSampler",this._rampGradientsTexture));const v=P.defines;var G,mM,K,d,O,H;(this._scene&&((0,ZM.f)(P,this,this._scene),this.applyFog&&(0,PM.g)(this._scene,void 0,P)),v.indexOf("#define BILLBOARDMODE_ALL")>=0&&(w.invertToRef(x.TmpVectors.Matrix[0]),P.setMatrix("invView",x.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?c.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,P):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,P)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(mM=this._scene)&&void 0!==mM&&mM.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?c.bindBuffers(this._vertexBuffers,null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._linesIndexBuffer:this._indexBuffer,P):c.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:null,P);(this.useLogarithmicDepth&&this._scene&&(0,PM.m)(v,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),this._setEngineBasedOnBlendMode(M),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),this._useInstancing)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?c.drawElementsType(6,0,10,this.VH.length):c.drawArraysType(7,0,4,this.VH.length):null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?c.drawElementsType(1,0,10*this.VH.length):c.drawElementsType(0,0,6*this.VH.length);return this.VH.length}render(){if(!this.isReady()||!this.VH.length)return 0;const M=this._engine;M.setState&&(M.setState(!1),this.forceDepthWrite&&M.setDepthWrite(!0));let Z=0;return Z=this.blendMode===mM.BLENDMODE_MULTIPLYADD?this._render(mM.BLENDMODE_MULTIPLY)+this._render(mM.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),Z}_onDispose(){}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(Z,P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const M=this._scene.SH.indexOf(this);M>-1&&this._scene.SH.splice(M,1),this._scene._activeParticleSystems.dispose()}this.Gc.notifyObservers(this),this.Gc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}fM.ForceGLSL=!1;var YM,zM=P(12213);!function(M){M[M.ATTACHED=0]="ATTACHED",M[M.END=1]="END"}(YM||(YM={}));class iM{constructor(M){if(this.particleSystem=M,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!M.xZ||!M.xZ.dispose){const Z=(0,G.e)("BABYLON.AbstractMesh");M.xZ=new Z("SubemitterSystemEmitter",M.DM()),M._disposeEmitterOnDispose=!0}}clone(){let M=this.particleSystem.xZ;if(M){if(M instanceof x.BZ)M=M.clone();else if(-1!==M.getClassName().indexOf("Mesh")){M=new((0,G.e)("BABYLON.Mesh"))("",M.DM()),M.isVisible=!1}}else M=new x.BZ;const Z=new iM(this.particleSystem.clone(this.particleSystem.name,M));return Z.particleSystem.name+="Clone",Z.type=this.type,Z.inheritDirection=this.inheritDirection,Z.inheritedVelocityAmount=this.inheritedVelocityAmount,Z.particleSystem._disposeEmitterOnDispose=!0,Z.particleSystem.disposeOnStop=!0,Z}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};return Z.type=this.type,Z.inheritDirection=this.inheritDirection,Z.inheritedVelocityAmount=this.inheritedVelocityAmount,Z.particleSystem=this.particleSystem.serialize(M),Z}static _ParseParticleSystem(M,Z,P){throw(0,zM.d)("ParseParticle")}static Parse(M,Z,P){const x=M.particleSystem,c=new iM(iM._ParseParticleSystem(x,Z,P,!0));return c.type=M.type,c.inheritDirection=M.inheritDirection,c.inheritedVelocityAmount=M.inheritedVelocityAmount,c.particleSystem._isSubEmitter=!0,c}dispose(){this.particleSystem.dispose()}}var TM=P(12260);function pM(M,Z){const P=new L;return P.direction1=M,P.direction2=Z,P}function SM(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function XM(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function VM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.BZ(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0);return new N(M,Z,P)}function gM(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function MZ(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0),w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.BZ(0,1,0);return new U(M,Z,P,c,w)}function ZZ(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new H(M,Z)}function PZ(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0);return new j(M,Z,P,c)}const xZ=x.BZ.Zero(),cZ=x.BZ.Zero(),wZ=x.BZ.Zero();class vZ{constructor(){this.strength=0,this.position=x.BZ.Zero()}_processParticle(M,Z){this.position.subtractToRef(M.position,xZ);const P=xZ.lengthSquared()+1;xZ.normalize().scaleToRef(this.strength/P,cZ),cZ.scaleToRef(Z._tempScaledUpdateSpeed,wZ),M.direction.addInPlace(wZ)}serialize(){return{position:this.position.nc(),strength:this.strength}}}class GZ extends fM{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=M=>{if(!this._subEmitters||0===this._subEmitters.length)return;const Z=Math.floor(Math.random()*this._subEmitters.length);for(const P of this._subEmitters[Z])if(1===P.type){const Z=P.clone();M._inheritParticleInfoToSubEmitter(Z),Z.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(Z.particleSystem),Z.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(M,Z){const P=pM(M,Z);return this.particleEmitterType=P,P}get flowMap(){return this._flowMap}set flowMap(M){this._flowMap!==M&&(this._flowMap=M,this._flowMapUpdate&&(yM(this._flowMapUpdate),this._flowMapUpdate=null),M&&(this._flowMapUpdate={process:M=>{var Z;const P=null===(Z=this.DM())||void 0===Z?void 0:Z.getTransformMatrix();this._flowMap._processParticle(M,this.flowMapStrength*this._tempScaledUpdateSpeed,P)},previousItem:null,nextItem:null},bM(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(M){this._attractors.push(M),1===this._attractors.length&&(this._attractorUpdate={process:M=>{for(const Z of this._attractors)Z._processParticle(M,this)},previousItem:null,nextItem:null},bM(this._attractorUpdate,this._directionProcessing))}removeAttractor(M){const Z=this._attractors.indexOf(M);-1!==Z&&this._attractors.splice(Z,1),0===this._attractors.length&&yM(this._attractorUpdate)}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(M)}createHemisphericEmitter(){const M=SM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=XM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=VM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.BZ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=gM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=MZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.BZ(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=ZZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=PZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,Z,P,x){const c=new O;return this.particleEmitterType=c,this.direction1=M,this.direction2=Z,this.minEmitBox=P,this.maxEmitBox=x,c}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const M of this.subEmitters)M instanceof GZ?this._subEmitters.push([new iM(M)]):M instanceof iM?this._subEmitters.push([M]):M instanceof Array&&this._subEmitters.push(M)}_stopSubEmitters(){if(this.activeSubSystems){for(const M of this.activeSubSystems)M.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const M=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==M&&this._rootParticleSystem.activeSubSystems.splice(M,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(M){M&&this._stopSubEmitters()}_prepareParticle(M){if(this._subEmitters&&this._subEmitters.length>0){const Z=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];M._attachedSubEmitters=[];for(const P of Z)if(0===P.type){const Z=P.clone();M._attachedSubEmitters.push(Z),Z.particleSystem.start()}}}_onDispose(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),M&&this.particles)for(const P of this.particles)if(P._attachedSubEmitters)for(let M=P._attachedSubEmitters.length-1;M>=0;M-=1)P._attachedSubEmitters[M].dispose();if(Z&&this.activeSubSystems)for(let P=this.activeSubSystems.length-1;P>=0;P-=1)this.activeSubSystems[P].dispose();if(this._subEmitters&&this._subEmitters.length){for(let M=0;M<this._subEmitters.length;M++)for(const Z of this._subEmitters[M])Z.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.xZ&&this.xZ.dispose&&this.xZ.dispose(!0)}static _Parse(M,Z,P,c){let w;w=P instanceof TM.e?null:P;const mM=(0,G.e)("BABYLON.Texture");if(mM&&w&&(M.texture?Z.particleTexture=mM.Parse(M.texture,w,c):M.textureName&&(Z.particleTexture=new mM(c+M.textureName,w,!1,void 0===M.invertY||M.invertY),Z.particleTexture.name=M.textureName)),M.emitterId||0===M.emitterId||void 0!==M.xZ?M.emitterId&&w?Z.xZ=w.getLastMeshById(M.emitterId):Z.xZ=x.BZ.NZ(M.xZ):Z.xZ=x.BZ.Zero(),Z.isLocal=!!M.isLocal,void 0!==M.renderingGroupId&&(Z.renderingGroupId=M.renderingGroupId),void 0!==M.isBillboardBased&&(Z.isBillboardBased=M.isBillboardBased),void 0!==M.billboardMode&&(Z.billboardMode=M.billboardMode),void 0!==M.useLogarithmicDepth&&(Z.useLogarithmicDepth=M.useLogarithmicDepth),M.animations){for(let P=0;P<M.animations.length;P++){const x=M.animations[P],c=(0,G.e)("BABYLON.Animation");c&&Z.animations.push(c.Parse(x))}Z.beginAnimationOnStart=M.beginAnimationOnStart,Z.beginAnimationFrom=M.beginAnimationFrom,Z.beginAnimationTo=M.beginAnimationTo,Z.beginAnimationLoop=M.beginAnimationLoop}if(M.autoAnimate&&w&&w.beginAnimation(Z,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),Z.startDelay=0|M.startDelay,Z.minAngularSpeed=M.minAngularSpeed,Z.maxAngularSpeed=M.maxAngularSpeed,Z.minSize=M.minSize,Z.maxSize=M.maxSize,M.minScaleX&&(Z.minScaleX=M.minScaleX,Z.maxScaleX=M.maxScaleX,Z.minScaleY=M.minScaleY,Z.maxScaleY=M.maxScaleY),void 0!==M.preWarmCycles&&(Z.preWarmCycles=M.preWarmCycles,Z.preWarmStepOffset=M.preWarmStepOffset),void 0!==M.minInitialRotation&&(Z.minInitialRotation=M.minInitialRotation,Z.maxInitialRotation=M.maxInitialRotation),Z.minLifeTime=M.minLifeTime,Z.maxLifeTime=M.maxLifeTime,Z.minEmitPower=M.minEmitPower,Z.maxEmitPower=M.maxEmitPower,Z.emitRate=M.emitRate,Z.gravity=x.BZ.NZ(M.gravity),M.noiseStrength&&(Z.noiseStrength=x.BZ.NZ(M.noiseStrength)),Z.color1=v.Ic.NZ(M.color1),Z.color2=v.Ic.NZ(M.color2),Z.colorDead=v.Ic.NZ(M.colorDead),Z.updateSpeed=M.updateSpeed,Z.targetStopDuration=M.targetStopDuration,Z.blendMode=M.blendMode,M.colorGradients)for(const x of M.colorGradients)Z.addColorGradient(x.gradient,v.Ic.NZ(x.color1),x.color2?v.Ic.NZ(x.color2):void 0);if(M.rampGradients){for(const P of M.rampGradients)Z.addRampGradient(P.gradient,v.uZ.NZ(P.color));Z.useRampGradients=M.useRampGradients}if(M.colorRemapGradients)for(const x of M.colorRemapGradients)Z.addColorRemapGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.alphaRemapGradients)for(const x of M.alphaRemapGradients)Z.addAlphaRemapGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.sizeGradients)for(const x of M.sizeGradients)Z.addSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.angularSpeedGradients)for(const x of M.angularSpeedGradients)Z.addAngularSpeedGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.velocityGradients)for(const x of M.velocityGradients)Z.addVelocityGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.dragGradients)for(const x of M.dragGradients)Z.addDragGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.emitRateGradients)for(const x of M.emitRateGradients)Z.addEmitRateGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.startSizeGradients)for(const x of M.startSizeGradients)Z.addStartSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.lifeTimeGradients)for(const x of M.lifeTimeGradients)Z.addLifeTimeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.limitVelocityGradients){for(const P of M.limitVelocityGradients)Z.addLimitVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);Z.limitVelocityDamping=M.limitVelocityDamping}if(M.noiseTexture&&w){const P=(0,G.e)("BABYLON.ProceduralTexture");Z.noiseTexture=P.Parse(M.noiseTexture,w,c)}let K;if(M.particleEmitterType){switch(M.particleEmitterType.type){case"SphereParticleEmitter":K=new u;break;case"SphereDirectedParticleEmitter":K=new N;break;case"ConeEmitter":case"ConeParticleEmitter":K=new H;break;case"ConeDirectedParticleEmitter":K=new j;break;case"CylinderParticleEmitter":K=new B;break;case"CylinderDirectedParticleEmitter":K=new U;break;case"HemisphericParticleEmitter":K=new n;break;case"PointParticleEmitter":K=new L;break;case"MeshParticleEmitter":K=new F;break;case"CustomParticleEmitter":K=new J;break;default:K=new O}K.parse(M.particleEmitterType,w)}else K=new O,K.parse(M,w);Z.particleEmitterType=K,Z.startSpriteCellID=M.startSpriteCellID,Z.endSpriteCellID=M.endSpriteCellID,Z.spriteCellLoop=M.spriteCellLoop??!0,Z.spriteCellWidth=M.spriteCellWidth,Z.spriteCellHeight=M.spriteCellHeight,Z.spriteCellChangeSpeed=M.spriteCellChangeSpeed,Z.spriteRandomStartCell=M.spriteRandomStartCell,Z.disposeOnStop=M.disposeOnStop??!1,Z.manualEmitCount=M.manualEmitCount??-1}static Parse(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0;const G=M.name;let mM,K,d=null,O=null;if(Z instanceof TM.e?mM=Z:(K=Z,mM=K.getEngine()),M.customShader&&mM.createEffectForParticles){O=M.customShader;const Z=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"";d=mM.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,Z)}const H=new GZ(G,w||M.tZ,Z,d,M.isAnimationSheetEnabled);if(H.customShader=O,H._rootUrl=P,M.id&&(H.id=M.id),M.subEmitters){H.subEmitters=[];for(const x of M.subEmitters){const M=[];for(const c of x)M.push(iM.Parse(c,Z,P));H.subEmitters.push(M)}}if(M.attractors)for(const v of M.attractors){const M=new vZ;M.position=x.BZ.NZ(v.position),M.strength=v.strength,H.addAttractor(M)}return GZ._Parse(M,H,Z,P),M.textureMask&&(H.textureMask=v.Ic.NZ(M.textureMask)),M.fK&&(H.fK=x.BZ.NZ(M.fK)),M.preventAutoStart&&(H.preventAutoStart=M.preventAutoStart),c||H.preventAutoStart||H.start(),H}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};if(GZ._Serialize(Z,this,M),Z.textureMask=this.textureMask.nc(),Z.customShader=this.customShader,Z.preventAutoStart=this.preventAutoStart,Z.fK=this.fK.nc(),this.subEmitters){Z.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const P of this._subEmitters){const x=[];for(const Z of P)x.push(Z.serialize(M));Z.subEmitters.push(x)}}if(this._attractors&&this._attractors.length){Z.attractors=[];for(const M of this._attractors)Z.attractors.push(M.serialize())}return Z}static _Serialize(M,Z,P){if(M.name=Z.name,M.id=Z.id,M.tZ=Z.getCapacity(),M.disposeOnStop=Z.disposeOnStop,M.manualEmitCount=Z.manualEmitCount,Z.xZ.position){const P=Z.xZ;M.emitterId=P.id}else{const P=Z.xZ;M.xZ=P.nc()}Z.particleEmitterType&&(M.particleEmitterType=Z.particleEmitterType.serialize()),Z.particleTexture&&(P?M.texture=Z.particleTexture.serialize():(M.textureName=Z.particleTexture.name,M.invertY=!!Z.particleTexture._invertY)),M.isLocal=Z.isLocal,k.b.AppendSerializedAnimations(Z,M),M.beginAnimationOnStart=Z.beginAnimationOnStart,M.beginAnimationFrom=Z.beginAnimationFrom,M.beginAnimationTo=Z.beginAnimationTo,M.beginAnimationLoop=Z.beginAnimationLoop,M.startDelay=Z.startDelay,M.renderingGroupId=Z.renderingGroupId,M.isBillboardBased=Z.isBillboardBased,M.billboardMode=Z.billboardMode,M.minAngularSpeed=Z.minAngularSpeed,M.maxAngularSpeed=Z.maxAngularSpeed,M.minSize=Z.minSize,M.maxSize=Z.maxSize,M.minScaleX=Z.minScaleX,M.maxScaleX=Z.maxScaleX,M.minScaleY=Z.minScaleY,M.maxScaleY=Z.maxScaleY,M.minEmitPower=Z.minEmitPower,M.maxEmitPower=Z.maxEmitPower,M.minLifeTime=Z.minLifeTime,M.maxLifeTime=Z.maxLifeTime,M.emitRate=Z.emitRate,M.gravity=Z.gravity.nc(),M.noiseStrength=Z.noiseStrength.nc(),M.color1=Z.color1.nc(),M.color2=Z.color2.nc(),M.colorDead=Z.colorDead.nc(),M.updateSpeed=Z.updateSpeed,M.targetStopDuration=Z.targetStopDuration,M.blendMode=Z.blendMode,M.preWarmCycles=Z.preWarmCycles,M.preWarmStepOffset=Z.preWarmStepOffset,M.minInitialRotation=Z.minInitialRotation,M.maxInitialRotation=Z.maxInitialRotation,M.startSpriteCellID=Z.startSpriteCellID,M.spriteCellLoop=Z.spriteCellLoop,M.endSpriteCellID=Z.endSpriteCellID,M.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,M.spriteCellWidth=Z.spriteCellWidth,M.spriteCellHeight=Z.spriteCellHeight,M.spriteRandomStartCell=Z.spriteRandomStartCell,M.isAnimationSheetEnabled=Z.isAnimationSheetEnabled,M.useLogarithmicDepth=Z.useLogarithmicDepth;const x=Z.getColorGradients();if(x){M.colorGradients=[];for(const Z of x){const P={gradient:Z.gradient,color1:Z.color1.nc()};Z.color2?P.color2=Z.color2.nc():P.color2=Z.color1.nc(),M.colorGradients.push(P)}}const c=Z.getRampGradients();if(c){M.rampGradients=[];for(const Z of c){const P={gradient:Z.gradient,color:Z.color.nc()};M.rampGradients.push(P)}M.useRampGradients=Z.useRampGradients}const w=Z.getColorRemapGradients();if(w){M.colorRemapGradients=[];for(const Z of w){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.colorRemapGradients.push(P)}}const v=Z.getAlphaRemapGradients();if(v){M.alphaRemapGradients=[];for(const Z of v){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.alphaRemapGradients.push(P)}}const G=Z.getSizeGradients();if(G){M.sizeGradients=[];for(const Z of G){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.sizeGradients.push(P)}}const mM=Z.getAngularSpeedGradients();if(mM){M.angularSpeedGradients=[];for(const Z of mM){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.angularSpeedGradients.push(P)}}const K=Z.getVelocityGradients();if(K){M.velocityGradients=[];for(const Z of K){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.velocityGradients.push(P)}}const d=Z.getDragGradients();if(d){M.dragGradients=[];for(const Z of d){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.dragGradients.push(P)}}const O=Z.getEmitRateGradients();if(O){M.emitRateGradients=[];for(const Z of O){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.emitRateGradients.push(P)}}const H=Z.getStartSizeGradients();if(H){M.startSizeGradients=[];for(const Z of H){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.startSizeGradients.push(P)}}const j=Z.getLifeTimeGradients();if(j){M.lifeTimeGradients=[];for(const Z of j){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.lifeTimeGradients.push(P)}}const B=Z.getLimitVelocityGradients();if(B){M.limitVelocityGradients=[];for(const Z of B){const P={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?P.factor2=Z.factor2:P.factor2=Z.factor1,M.limitVelocityGradients.push(P)}M.limitVelocityDamping=Z.limitVelocityDamping}Z.noiseTexture&&(M.noiseTexture=Z.noiseTexture.serialize())}clone(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x={...this._customWrappers};let c=null;const w=this._engine;if(w.createEffectForParticles&&null!=this.customShader){c=this.customShader;const M=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",Z=w.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,M);x[0]?x[0].effect=Z:this.setCustomEffect(Z,0)}const v=this.serialize(P),G=GZ.Parse(v,this._scene||this._engine,this._rootUrl);return G.name=M,G.customShader=c,G._customWrappers=x,void 0===Z&&(Z=this.xZ),this.noiseTexture&&(G.noiseTexture=this.noiseTexture.clone()),G.xZ=Z,this.preventAutoStart||G.start(),G}}GZ.BILLBOARDMODE_Y=2,GZ.BILLBOARDMODE_ALL=7,GZ.BILLBOARDMODE_STRETCHED=8,GZ.BILLBOARDMODE_STRETCHED_LOCAL=9,iM._ParseParticleSystem=GZ.Parse;var mP=P(12605),KZ=P(12596),dZ=P(12482);dZ.d.prototype.createTransformFeedback=function(){const M=this._gl.createTransformFeedback();if(!M)throw new Error("Unable to create Transform Feedback");return M},dZ.d.prototype.deleteTransformFeedback=function(M){this._gl.deleteTransformFeedback(M)},dZ.d.prototype.bindTransformFeedback=function(M){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,M)},dZ.d.prototype.beginTransformFeedback=function(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(M?this._gl.POINTS:this._gl.TRIANGLES)},dZ.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},dZ.d.prototype.setTranformFeedbackVaryings=function(M,Z){this._gl.transformFeedbackVaryings(M,Z,this._gl.INTERLEAVED_ATTRIBS)},dZ.d.prototype.bindTransformFeedbackBuffer=function(M){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M?M.underlyingResource:null)},dZ.d.prototype.readTransformFeedbackBuffer=function(M){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M)};const OZ="clipPlaneFragmentDeclaration2",HZ="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";l.c.IncludesShadersStore[OZ]||(l.c.IncludesShadersStore[OZ]=HZ);P(13668),P(13670),P(13672),P(13674),P(13682),P(13691),P(13693),P(13697);const jZ="gpuRenderParticlesPixelShader",BZ="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";l.c.ShadersStore[jZ]||(l.c.ShadersStore[jZ]=BZ);const UZ="clipPlaneVertexDeclaration2",nZ="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";l.c.IncludesShadersStore[UZ]||(l.c.IncludesShadersStore[UZ]=nZ);P(13705),P(13713),P(13721),P(13729);const LZ="gpuRenderParticlesVertexShader",uZ="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";l.c.ShadersStore[LZ]||(l.c.ShadersStore[LZ]=uZ);class NZ extends mM{static get IsSupported(){if(!V.b.LastCreatedEngine)return!1;const M=V.b.LastCreatedEngine.getCaps();return M.supportTransformFeedbacks||M.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(M){this._maxActiveParticleCount=Math.min(M,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(M){this.maxActiveParticleCount=M}createPointEmitter(M,Z){const P=pM(M,Z);return this.particleEmitterType=P,P}createHemisphericEmitter(){const M=SM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=XM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=VM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.BZ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=gM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=MZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.BZ(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=ZZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=PZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.BZ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.BZ(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,Z,P,x){const c=new O;return this.particleEmitterType=c,this.direction1=M,this.direction2=Z,this.minEmitBox=P,this.maxEmitBox=x,c}get flowMap(){return this._flowMap}set flowMap(M){this._flowMap!==M&&(this._flowMap=M)}isReady(){if(!this.xZ||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==GZ.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(GZ.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(GZ.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";M?setTimeout((()=>{this.start(0)}),M):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var M;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(M=this._customWrappers[Z])||void 0===M?void 0:M.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[M]??this._customWrappers[0]}setCustomEffect(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Z]=new MM.e(this._engine),this._customWrappers[Z].effect=M}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(M,Z,P){return super._removeGradientAndTexture(M,Z,P),this._releaseBuffers(),this}addColorGradient(M,Z){this._colorGradients||(this._colorGradients=[]);const P=new z(M,Z);return this._colorGradients.push(P),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(M&&this._colorGradients.sort(((M,Z)=>M.gradient<Z.gradient?-1:M.gradient>Z.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(M){return this._removeGradientAndTexture(M,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const Z in this._drawWrappers){var M;null===(M=this._drawWrappers[Z].drawContext)||void 0===M||M.reset()}}_addFactorGradient(M,Z,P){const x=new T(Z,P);M.push(x),this._releaseBuffers()}addSizeGradient(M,Z){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,M,Z),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(M){return this._removeGradientAndTexture(M,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(M,Z){if(!M)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&M.sort(((M,Z)=>M.gradient<Z.gradient?-1:M.gradient>Z.gradient?1:0));const P=this;P[Z]&&(P[Z].dispose(),P[Z]=null)}addAngularSpeedGradient(M,Z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,M,Z),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(M){return this._removeGradientAndTexture(M,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(M,Z){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,M,Z),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(M){return this._removeGradientAndTexture(M,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(M,Z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,M,Z),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(M){return this._removeGradientAndTexture(M,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(M,Z){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,M,Z),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(M){return this._removeGradientAndTexture(M,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(M){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(M),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Gc=new S.b,this.onStoppedObservable=new S.b,this.onStartedObservable=new S.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=x.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||V.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SH.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,G.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,G.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,G.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,G.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new MM.e(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers={0:new MM.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(Z=Z??{}).randomTextureSize||delete Z.randomTextureSize;const v={tZ:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...Z},mM=Z;isFinite(mM)&&(v.tZ=mM),this._capacity=v.tZ,this._maxActiveParticleCount=v.tZ,this._currentActiveCount=0,this._isAnimationSheetEnabled=w,this.particleEmitterType=new O;const K=Math.min(this._engine.getCaps().maxTextureSize,v.randomTextureSize);let d=[];for(let x=0;x<K;++x)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture=new X.e(new Float32Array(d),K,1,5,P,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,d=[];for(let x=0;x<K;++x)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture2=new X.e(new Float32Array(d),K,1,5,P,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=K}_reset(){this._releaseBuffers()}_createVertexBuffers(M,Z,P){const x={};x.position=Z.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let c=3;x.age=Z.createVertexBuffer("age",c,1,this._attributesStrideSize,!0),c+=1,x.size=Z.createVertexBuffer("size",c,3,this._attributesStrideSize,!0),c+=3,x.life=Z.createVertexBuffer("life",c,1,this._attributesStrideSize,!0),c+=1,c+=4,this.billboardMode===GZ.BILLBOARDMODE_STRETCHED&&(x.direction=Z.createVertexBuffer("direction",c,3,this._attributesStrideSize,!0)),c+=3,this._platform.alignDataInBuffer&&(c+=1),this.particleEmitterType instanceof J&&(c+=3,this._platform.alignDataInBuffer&&(c+=1)),this._colorGradientsTexture||(x.color=Z.createVertexBuffer("color",c,4,this._attributesStrideSize,!0),c+=4),this._isBillboardBased||(x.initialDirection=Z.createVertexBuffer("initialDirection",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),this.noiseTexture&&(x.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1),x.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),x.angle=Z.createVertexBuffer("angle",c,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?c++:c+=2,this._isAnimationSheetEnabled&&(x.cellIndex=Z.createVertexBuffer("cellIndex",c,1,this._attributesStrideSize,!0),c+=1,this.spriteRandomStartCell&&(x.cellStartOffset=Z.createVertexBuffer("cellStartOffset",c,1,this._attributesStrideSize,!0),c+=1)),x.offset=P.createVertexBuffer("offset",0,2),x.uv=P.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(x),this._platform.createVertexBuffers(M,x),this.resetDrawCache()}_initialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!M)return;const Z=this._engine,P=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof J&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const c=this.particleEmitterType instanceof J,w=x.TmpVectors.BZ[0];let v=0;for(let x=0;x<this._capacity;x++)if(P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),c?(this.particleEmitterType.particleDestinationGenerator(x,null,w),P.push(w.x),P.push(w.y),P.push(w.z)):(P.push(0),P.push(0),P.push(0)),this._platform.alignDataInBuffer&&P.push(0),v+=16,c&&(this.particleEmitterType.particlePositionGenerator(x,null,w),P.push(w.x),P.push(w.y),P.push(w.z),this._platform.alignDataInBuffer&&P.push(0),v+=4),this._colorGradientsTexture||(P.push(0),P.push(0),P.push(0),P.push(0),v+=4),this.isBillboardBased||(P.push(0),P.push(0),P.push(0),this._platform.alignDataInBuffer&&P.push(0),v+=4),this.noiseTexture&&(P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),v+=8),P.push(0),v+=1,this._angularSpeedGradientsTexture||(P.push(0),v+=1),this._isAnimationSheetEnabled&&(P.push(0),v+=1,this.spriteRandomStartCell&&(P.push(0),v+=1)),this._platform.alignDataInBuffer){let M=3-(v+3&3);for(v+=M;M-- >0;)P.push(0)}const G=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),mM=this._platform.createParticleBuffer(P),K=this._platform.createParticleBuffer(P);this._buffer0=new t.c(Z,mM,!1,this._attributesStrideSize),this._buffer1=new t.c(Z,K,!1,this._attributesStrideSize),this._spriteBuffer=new t.c(Z,G,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let M=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(M+="\n#define BILLBOARD"),this._colorGradientsTexture&&(M+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(M+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(M+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(M+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(M+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(M+="\n#define DRAGGRADIENTS"),this._flowMap&&(M+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(M+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(M+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(M+="\n#define NOISE"),this.isLocal&&(M+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===M||(this._cachedUpdateDefines=M,this._updateBuffer=this._platform.createUpdateBuffer(M)),this._platform.isUpdateBufferReady()}_getWrapper(M){const Z=this._getCustomDrawWrapper(M);if(null!==Z&&void 0!==Z&&Z.effect)return Z;const P=[];this.fillDefines(P,M);let x=this._drawWrappers[M];x||(x=new MM.e(this._engine),x.drawContext&&(x.drawContext.useInstancing=!0),this._drawWrappers[M]=x);const c=P.join("\n");if(x.defines!==c){const M=[],Z=[],P=[];this.fillUniformsAttributesAndSamplerNames(Z,M,P),x.setEffect(this._engine.createEffect("gpuRenderParticles",M,Z,P,c),c)}return x}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const c=[t.g.PositionKind,"age","life","size","angle"];return M||c.push(t.g.ColorKind),Z&&c.push("cellIndex"),P||c.push("initialDirection"),x&&c.push("direction"),c.push("offset",t.g.UVKind),c}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=["emitterWM","fK","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,ZM.e)(x),M&&x.push("sheetInfos"),Z&&x.push("logarithmicDepthConstant"),P&&(x.push("vFogInfos"),x.push("vFogColor")),x}fillDefines(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ZM.h)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==KZ.e.FOGMODE_NONE&&M.push("#define FOG")),Z===GZ.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this.isLocal&&M.push("#define LOCAL"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case GZ.BILLBOARDMODE_Y:M.push("#define BILLBOARDY");break;case GZ.BILLBOARDMODE_STRETCHED:M.push("#define BILLBOARDSTRETCHED");break;case GZ.BILLBOARDMODE_ALL:M.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&M.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,Z,P){Z.push(...NZ._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===GZ.BILLBOARDMODE_STRETCHED)),M.push(...NZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(mP.c.PrepareUniforms(M,this._imageProcessingConfigurationDefines),mP.c.PrepareSamplers(P,this._imageProcessingConfigurationDefines))}animate(){var M;let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(M,Z){const P=this[Z];if(!M||!M.length||P)return;const x=new Float32Array(this._rawTextureWidth);for(let c=0;c<this._rawTextureWidth;c++){const Z=c/this._rawTextureWidth;p.GetCurrentGradient(Z,M,((M,Z,P)=>{x[c]=(0,K.Lerp)(M.factor1,Z.factor1,P)}))}this[Z]=X.e.CreateRTexture(x,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[Z].name=Z.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const M=new Uint8Array(4*this._rawTextureWidth),Z=v.TmpColors.Ic[0];for(let P=0;P<this._rawTextureWidth;P++){const x=P/this._rawTextureWidth;p.GetCurrentGradient(x,this._colorGradients,((x,c,w)=>{v.Ic.LerpToRef(x.color1,c.color1,w,Z),M[4*P]=255*Z.r,M[4*P+1]=255*Z.g,M[4*P+2]=255*Z.b,M[4*P+3]=255*Z.a}))}this._colorGradientsTexture=X.e.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(M,Z){var P,c,w,v;const G=this._getWrapper(M),mM=G.effect;this._engine.enableEffect(G);const K=(null===(P=this._scene)||void 0===P?void 0:P.getViewMatrix())||x.Matrix.IdentityReadOnly;if(mM.setMatrix("view",K),mM.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),mM.setTexture("diffuseSampler",this.particleTexture),mM.setVector2("translationPivot",this.translationPivot),mM.setVector3("fK",this.fK),this.isLocal&&mM.setMatrix("emitterWM",Z),this._colorGradientsTexture?mM.setTexture("colorGradientSampler",this._colorGradientsTexture):mM.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();mM.setFloat3("sheetInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,M.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;mM.setVector3("eyePosition",M.globalPosition)}const d=mM.defines;if(this._scene&&((0,ZM.f)(mM,this,this._scene),this.applyFog&&(0,PM.g)(this._scene,void 0,mM)),d.indexOf("#define BILLBOARDMODE_ALL")>=0){const M=K.clone();M.invert(),mM.setMatrix("invView",M)}return this.useLogarithmicDepth&&this._scene&&(0,PM.m)(d,mM,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(mM),this._setEngineBasedOnBlendMode(M),this._platform.bindDrawBuffers(this._targetIndex,mM,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(mM),null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(v=this._scene)&&void 0!==v&&v.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(M){if(!this.xZ||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!M)if(this.xZ.position){M=this.xZ.getWorldMatrix()}else{const Z=this.xZ;M=x.TmpVectors.Matrix[0],x.Matrix.TranslationToRef(Z.x,Z.y,Z.z,M)}const Z=this._engine,P=Z.getDepthWrite();if(Z.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const M=this.DM();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",M.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",M),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const c=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=c,Z.setDepthWrite(P)}render(){let M,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!Z&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let M=0;M<this.preWarmCycles;M++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const M=0|this._accumulatedCount;this._accumulatedCount-=M,this._currentActiveCount+=M}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.xZ.position){M=this.xZ.getWorldMatrix()}else{const Z=this.xZ;M=x.TmpVectors.Matrix[0],x.Matrix.TranslationToRef(Z.x,Z.y,Z.z,M)}const c=this._engine;this.updateInAnimate||this._update(M);let w=0;return Z||P||(c.setState(!1),this.forceDepthWrite&&c.setDepthWrite(!0),w=this.blendMode===GZ.BLENDMODE_MULTIPLYADD?this._render(GZ.BLENDMODE_MULTIPLY,M)+this._render(GZ.BLENDMODE_ADD,M):this._render(this.blendMode,M),this._engine.setAlphaMode(0)),w}rebuild(){const M=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(M,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,M()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const Z in this._drawWrappers){this._drawWrappers[Z].dispose()}if(this._drawWrappers={},this._scene){const M=this._scene.SH.indexOf(this);M>-1&&this._scene.SH.splice(M,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let Z=0;Z<this._renderVertexBuffers.length;++Z){const M=this._renderVertexBuffers[Z];for(const Z in M)M[Z].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Gc.notifyObservers(this),this.Gc.clear()}clone(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x={...this._customWrappers};let c=null;const w=this._engine;if(w.createEffectForParticles&&null!=this.customShader){c=this.customShader;const M=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";x[0]=w.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,M,void 0,void 0,void 0,this)}const v=this.serialize(P),G=NZ.Parse(v,this._scene||this._engine,this._rootUrl);return G.name=M,G.customShader=c,G._customWrappers=x,void 0===Z&&(Z=this.xZ),this.noiseTexture&&(G.noiseTexture=this.noiseTexture.clone()),G.xZ=Z,G}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};return GZ._Serialize(Z,this,M),Z.activeParticleCount=this.activeParticleCount,Z.randomTextureSize=this._randomTextureSize,Z.customShader=this.customShader,Z}static Parse(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0;const w=M.name;let v,G;Z instanceof TM.e?v=Z:(G=Z,v=G.getEngine());const mM=new NZ(w,{tZ:c||M.tZ,randomTextureSize:M.randomTextureSize},Z,null,M.isAnimationSheetEnabled);if(mM._rootUrl=P,M.customShader&&v.createEffectForParticles){const Z=M.customShader,P=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"",x=v.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,P,void 0,void 0,void 0,mM);mM.setCustomEffect(x,0),mM.customShader=Z}return M.id&&(mM.id=M.id),M.activeParticleCount&&(mM.activeParticleCount=M.activeParticleCount),GZ._Parse(M,mM,Z,P),M.preventAutoStart&&(mM.preventAutoStart=M.preventAutoStart),x||mM.preventAutoStart||mM.start(),mM}}var JZ=P(12175),tZ=P(13736),FZ=P(12743);class DZ{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(M){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const Z of this.systems)Z.xZ=M;this._emitterNode=M}setEmitterAsSphere(M,Z,P){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:M,renderingGroupId:Z};const x=(0,tZ.b)("emitterSphere",{diameter:M.diameter,segments:M.segments},P);x.renderingGroupId=Z;const c=new FZ.LZ("emitterSphereMaterial",P);c.emissiveColor=M.color,x.material=c;for(const w of this.systems)w.xZ=x;this._emitterNode=x}start(M){for(const Z of this.systems)M&&(Z.xZ=M),Z.start()}dispose(){for(const M of this.systems)M.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={systems:[]};for(const P of this.systems)Z.systems.push(P.serialize(M));return this._emitterNode&&(Z.xZ=this._emitterCreationOptions),Z}static Parse(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;const c=new DZ,w=this.BaseAssetsUrl+"/textures/";Z=Z||V.b.LastCreatedScene;for(const v of M.systems)c.systems.push(P?NZ.Parse(v,Z,w,!0,x):GZ.Parse(v,Z,w,!0,x));if(M.xZ){const P=M.xZ.options;if("Sphere"===M.xZ.kind)c.setEmitterAsSphere({diameter:P.diameter,segments:P.segments,color:v.uZ.NZ(P.color)},M.xZ.renderingGroupId,Z)}return c}}DZ.BaseAssetsUrl="https://assets.babylonjs.com/particles";var lZ=P(12220);class hZ{static CreateDefault(M){let Z,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,x=arguments.length>2?arguments[2]:void 0;Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new NZ("default system",{tZ:P},x):new GZ("default system",P,x),Z.xZ=M;const c=JZ.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return Z.particleTexture=new A.e(c,Z.DM()),Z.createConeEmitter(.1,Math.PI/4),Z.color1=new v.Ic(1,1,1,1),Z.color2=new v.Ic(1,1,1,1),Z.colorDead=new v.Ic(1,1,1,0),Z.minSize=.1,Z.maxSize=.1,Z.minEmitPower=2,Z.maxEmitPower=2,Z.updateSpeed=1/60,Z.emitRate=30,Z}static CreateAsync(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;Z||(Z=V.b.LastCreatedScene);const c={};return Z.addPendingData(c),new Promise(((w,v)=>{if(P&&!NZ.IsSupported)return Z.removePendingData(c),v("Particle system with GPU is not supported.");JZ.Tools.LoadFile(`${hZ.BaseAssetsUrl}/systems/${M}.json`,(M=>{Z.removePendingData(c);const v=JSON.parse(M.toString());return w(DZ.Parse(v,Z,P,x))}),void 0,void 0,void 0,(()=>(Z.removePendingData(c),v(`An error occurred with the creation of your particle system. Check if your type '${M}' exists.`))))}))}static ExportSet(M){const Z=new DZ;for(const P of M)Z.systems.push(P);return Z}static ParseFromFileAsync(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",w=arguments.length>5?arguments[5]:void 0;return new Promise(((v,G)=>{const mM=new lZ.c;mM.addEventListener("readystatechange",(()=>{if(4==mM.readyState)if(200==mM.status){const Z=JSON.parse(mM.responseText);let G;G=x?NZ.Parse(Z,P,c,!1,w):GZ.Parse(Z,P,c,!1,w),M&&(G.name=M),v(G)}else G("Unable to load the particle system")})),mM.open("GET",Z),mM.send()}))}static ParseFromSnippetAsync(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",c=arguments.length>4?arguments[4]:void 0;if("_BLANK"===M){const M=this.CreateDefault(null);return M.start(),Promise.resolve(M)}return new Promise(((w,v)=>{const G=new lZ.c;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const v=JSON.parse(JSON.parse(G.responseText).jsonPayload),mM=JSON.parse(v.particleSystem);let K;K=P?NZ.Parse(mM,Z,x,!1,c):GZ.Parse(mM,Z,x,!1,c),K.snippetId=M,w(K)}else v("Unable to load the snippet "+M)})),G.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),G.send()}))}}hZ.BaseAssetsUrl=DZ.BaseAssetsUrl,hZ.SnippetUrl="https://snippet.babylonjs.com",hZ.CreateFromSnippetAsync=hZ.ParseFromSnippetAsync;var QZ=P(12825),IZ=P(12639),sZ=P(13743);(0,sZ.e)(IZ.d.NAME_PARTICLESYSTEM,((M,Z,P,x)=>{const c=(0,sZ.h)(IZ.d.NAME_PARTICLESYSTEM);if(c&&void 0!==M.SH&&null!==M.SH)for(let w=0,v=M.SH.length;w<v;w++){const v=M.SH[w];P.SH.push(c(v,Z,x))}})),(0,sZ.b)(IZ.d.NAME_PARTICLESYSTEM,((M,Z,P)=>{if(M.activeParticleCount){return NZ.Parse(M,Z,P)}return GZ.Parse(M,Z,P)})),TM.e.prototype.createEffectForParticles=function(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",w=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0,mM=arguments.length>7?arguments[7]:void 0,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0,O=[],H=[];const j=[];return mM?mM.fillUniformsAttributesAndSamplerNames(H,O,j):(O=GZ._GetAttributeNamesOrOptions(),H=GZ._GetEffectCreationOptions()),-1===c.indexOf(" BILLBOARD")&&(c+="\n#define BILLBOARD\n"),null!==mM&&void 0!==mM&&mM.isAnimationSheetEnabled&&-1===c.indexOf(" ANIMATESHEET")&&(c+="\n#define ANIMATESHEET\n"),-1===x.indexOf("diffuseSampler")&&x.push("diffuseSampler"),this.createEffect({vertex:d??(null===mM||void 0===mM?void 0:mM.vertexShaderName)??"particles",fragmentElement:M},O,H.concat(Z),j.concat(x),c,w,v,G,void 0,K,(async()=>{0===K?await Promise.resolve().then(P.bind(P,13775)):await Promise.resolve().then(P.bind(P,13835))}))},QZ.c.prototype.getEmittedParticleSystems=function(){const M=[];for(let Z=0;Z<this.DM().SH.length;Z++){const P=this.DM().SH[Z];P.xZ===this&&M.push(P)}return M},QZ.c.prototype.getHierarchyEmittedParticleSystems=function(){const M=[],Z=this.getDescendants();Z.push(this);for(let P=0;P<this.DM().SH.length;P++){const x=this.DM().SH[P],c=x.xZ;c.position&&-1!==Z.indexOf(c)&&M.push(x)}return M};P(12703),P(12717),P(12800);P(12805),P(13750),P(12561),P(12689),P(12839);P(12555);var CZ;P(13754),P(12390);!function(M){M[M.Color=2]="Color",M[M.UV=1]="UV",M[M.Random=0]="Random",M[M.Stated=3]="Stated"}(CZ||(CZ={}));var RZ=P(12581);const WZ=new x.BZ(0,0,0),kZ=new x.BZ(0,0,0),AZ=new x.BZ(0,0,0);class oZ{constructor(M,Z,P){this.width=M,this.height=Z,this.data=P}processFlowable(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;if(!P)return;P instanceof x.Matrix?x.BZ.TransformCoordinatesToRef(M.position,P,AZ):(AZ.x=P.x,AZ.y=P.y,AZ.z=P.z);const c=.5*AZ.x+.5,w=1-(.5*AZ.y+.5),v=Math.floor(c*this.width),G=Math.floor(w*this.height);if(v<0||v>=this.width||G<0||G>=this.height)return;const mM=4*(G*this.width+v),K=this.data[mM]/255*2-1,d=this.data[mM+1]/255*2-1,O=this.data[mM+2]/255*2-1,H=this.data[mM+3]/255;WZ.set(K,d,O),WZ.scaleToRef(Z*H,kZ),M.direction.addInPlace(kZ)}_processParticle(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;this.processFlowable(M,Z,P)}static async FromUrlAsync(M){return await new Promise(((Z,P)=>{const x=document.createElement("canvas"),c=x.getContext("2d");let w=null;const v=new Image;v.crossOrigin="anonymous",v.src=M,v.onerror=Z=>{P(new Error(`Failed to load image: ${M} : ${Z}`))},v.onload=()=>{x.width=v.width,x.height=v.height,c.drawImage(v,0,0),w=c.getImageData(0,0,x.width,x.height),Z(new oZ(x.width,x.height,w.data))}}))}static async ExtractFromTextureAsync(M){return await new Promise(((Z,P)=>{if(!M.isReady())return void M.onLoadObservable.addOnce((async()=>{try{const P=await this.ExtractFromTextureAsync(M);Z(P)}catch(x){P(x)}}));const x=M.getSize();RZ.l.GetTextureDataAsync(M,x.width,x.height).then((M=>{Z(new oZ(x.width,x.height,new Uint8ClampedArray(M)))})).catch(P)}))}}var EZ,rZ,qZ,eZ,bZ,aZ,yZ,fZ,YZ;!function(M){M[M.Int=1]="Int",M[M.Float=2]="Float",M[M.Vector2=4]="Vector2",M[M.BZ=8]="BZ",M[M.Matrix=16]="Matrix",M[M.Particle=32]="Particle",M[M.Texture=64]="Texture",M[M.Ic=128]="Ic",M[M.FloatGradient=256]="FloatGradient",M[M.Vector2Gradient=512]="Vector2Gradient",M[M.Vector3Gradient=1024]="Vector3Gradient",M[M.Color4Gradient=2048]="Color4Gradient",M[M.System=4096]="System",M[M.AutoDetect=8192]="AutoDetect",M[M.BasedOnInput=16384]="BasedOnInput",M[M.Undefined=32768]="Undefined",M[M.All=65535]="All"}(EZ||(EZ={})),function(M){M[M.Compatible=0]="Compatible",M[M.TypeIncompatible=1]="TypeIncompatible",M[M.HierarchyIssue=2]="HierarchyIssue"}(rZ||(rZ={})),function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(qZ||(qZ={}));class zZ{get direction(){return this._direction}get type(){if(this._type===EZ.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===EZ.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(M){this._type=M}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((M=>M.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(M,Z,P){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=EZ.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new S.b,this.onDisconnectionObservable=new S.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=Z,this.name=M,this._direction=P}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(M){var Z;return this.isConnected?null!==(Z=this._connectedPoint)&&void 0!==Z&&Z._storedFunction?this._connectedPoint._storedFunction(M):this._connectedPoint._storedValue:this.value}canConnectTo(M){return 0===this.checkCompatibilityState(M)}checkCompatibilityState(M){const Z=this._ownerBlock,P=M.ownerBlock;if(this.type!==M.type&&M.innerType!==EZ.AutoDetect)return M.acceptedConnectionPointTypes&&-1!==M.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(M.excludedConnectionPointTypes&&-1!==M.excludedConnectionPointTypes.indexOf(this.type))return 1;let x=P,c=Z;return 0===this.direction&&(x=Z,c=P),x.isAnAncestorOf(c)?2:0}connectTo(M){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(M))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${M.ownerBlock.name}".${M.name}`;return this._endpoints.push(M),M._connectedPoint=this,this.onConnectionObservable.notifyObservers(M),M.onConnectionObservable.notifyObservers(this),this}disconnectFrom(M){const Z=this._endpoints.indexOf(M);return-1===Z||(this._endpoints.splice(Z,1),M._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(M),M.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(M){let Z=1;for(;Z<EZ.All;)M&Z||this.excludedConnectionPointTypes.push(Z),Z<<=1}serialize(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const Z={};return Z.name=this.name,Z.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.nc?(Z.valueType="BABYLON."+this.value.getClassName(),Z.value=this.value.nc()):(Z.valueType="number",Z.value=this.value)),M&&this.connectedPoint&&(Z.inputName=this.name,Z.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,Z.targetConnectionName=this.connectedPoint.name,Z.isExposedOnFrame=!0,Z.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(Z.isExposedOnFrame=!0,Z.exposedPortPosition=this.exposedPortPosition),Z}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class iZ{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(M){this._name=M}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(M){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new S.b,this.Gc=new S.b,this.onInputChangedObservable=new S.b,this.visibleOnFrame=!1,this._name=M,this.uniqueId=o.d.UniqueId}_inputRename(M){return M}_outputRename(M){return M}isAnAncestorOf(M){for(const Z of this._outputs)if(Z.hasEndpoints)for(const P of Z.endpoints){if(P.ownerBlock===M)return!0;if(P.ownerBlock.isAnAncestorOf(M))return!0}return!1}isAnAncestorOfType(M){if(this.getClassName()===M)return!0;for(const Z of this._outputs)if(Z.hasEndpoints)for(const P of Z.endpoints)if(P.ownerBlock.isAnAncestorOfType(M))return!0;return!1}getInputByName(M){const Z=this._inputs.filter((Z=>Z.name===M));return Z.length?Z[0]:null}_linkConnectionTypes(M,Z){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[Z]._acceptedConnectionPointType=this._inputs[M]:(this._inputs[M]._linkedConnectionSource=this._inputs[Z],this._inputs[M]._isMainLinkSource=!0),this._inputs[Z]._linkedConnectionSource=this._inputs[M]}registerInput(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0;const v=new zZ(M,this,0);return v.type=Z,v.isOptional=P,v.defaultValue=x,v.value=x,v.valueMin=c,v.valueMax=w,this._inputs.push(v),this.onInputChangedObservable.notifyObservers(v),this}registerOutput(M,Z,P){return(P=P??new zZ(M,this,1)).type=Z,this._outputs.push(P),this}_build(M){}_customBuildStep(M){}build(M){if(this._buildId===M.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((M=>M.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=M.buildId;for(const Z of this._inputs){if(!Z.connectedPoint){Z.isOptional||M.notConnectedNonOptionalInputs.push(Z);continue}const P=Z.connectedPoint.ownerBlock;P&&P!==this&&!P.isSystem&&P.build(M)}return this._customBuildStep(M),M.verbose&&E.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(M),this.onBuildObservable.notifyObservers(this),!1}serialize(){const M={};M.customType="BABYLON."+this.getClassName(),M.id=this.uniqueId,M.name=this.name,M.visibleOnFrame=this.visibleOnFrame,M.inputs=[],M.outputs=[];for(const Z of this.inputs)M.inputs.push(Z.serialize());for(const Z of this.outputs)M.outputs.push(Z.serialize(!1));return M}_deserialize(M){this._name=M.name,this.comments=M.comments,this.visibleOnFrame=!!M.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(M)}_deserializePortDisplayNamesAndExposedOnFrame(M){const Z=M.inputs,P=M.outputs;if(Z)for(const x of Z){const M=this.inputs.find((M=>M.name===x.name));if(!M)return;if(x.displayName&&(M.displayName=x.displayName),x.isExposedOnFrame&&(M.isExposedOnFrame=x.isExposedOnFrame,M.exposedPortPosition=x.exposedPortPosition),void 0!==x.value&&null!==x.value)if("number"===x.valueType)M.value=x.value;else{const Z=(0,G.e)(x.valueType);Z&&(M.value=Z.NZ(x.value))}}if(P)for(let x=0;x<P.length;x++){const M=P[x];M.displayName&&(this.outputs[x].displayName=M.displayName),M.isExposedOnFrame&&(this.outputs[x].isExposedOnFrame=M.isExposedOnFrame,this.outputs[x].exposedPortPosition=M.exposedPortPosition)}}clone(){const M=this.serialize(),Z=(0,G.e)(M.customType);if(Z){const P=new Z;return P._deserialize(M),P}return null}dispose(){this.Gc.notifyObservers(this),this.Gc.clear();for(const M of this.inputs)M.dispose();for(const M of this.outputs)M.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function TZ(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",x=arguments.length>3?arguments[3]:void 0;return(c,w)=>{let v=c._propStore;v||(v=[],c._propStore=v),v.push({propertyName:w,displayName:M,type:Z,groupName:P,options:x??{},className:c.getClassName()})}}(0,R.c)([(0,W.H)("comment")],iZ.prototype,"comments",void 0),function(M){M[M.Boolean=0]="Boolean",M[M.Float=1]="Float",M[M.Int=2]="Int",M[M.Vector2=3]="Vector2",M[M.List=4]="List",M[M.Ic=5]="Ic",M[M.SamplingMode=6]="SamplingMode",M[M.TextureFormat=7]="TextureFormat",M[M.TextureType=8]="TextureType"}(eZ||(eZ={})),function(M){M[M.None=0]="None",M[M.Position=1]="Position",M[M.Direction=2]="Direction",M[M.Age=3]="Age",M[M.Lifetime=4]="Lifetime",M[M.Color=5]="Color",M[M.ScaledDirection=6]="ScaledDirection",M[M.Scale=7]="Scale",M[M.AgeGradient=8]="AgeGradient",M[M.Angle=9]="Angle",M[M.SpriteCellIndex=16]="SpriteCellIndex",M[M.SpriteCellStart=17]="SpriteCellStart",M[M.SpriteCellEnd=18]="SpriteCellEnd"}(bZ||(bZ={})),function(M){M[M.None=0]="None",M[M.Time=1]="Time",M[M.Delta=2]="Delta",M[M.Emitter=3]="Emitter"}(aZ||(aZ={}));class pZ{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let M="";for(const Z of this.notConnectedNonOptionalInputs)M+=`input ${Z.name} from block ${Z.ownerBlock.name}[${Z.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(M)throw"Build of Node Particle System Set failed:\n"+M}adapt(M,Z){const P=M.getConnectedValue(this)||0;if(M.type===Z)return P;switch(Z){case EZ.Vector2:return new x.Vector2(P,P);case EZ.BZ:return new x.BZ(P,P,P);case EZ.Ic:return new v.Ic(P,P,P,P)}return null}getContextualValue(M){if(!this.particleContext||!this.systemContext)return null;switch(M){case bZ.Position:return this.particleContext.position;case bZ.Direction:return this.particleContext.direction;case bZ.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case bZ.Color:return this.particleContext.color;case bZ.Age:return this.particleContext.age;case bZ.Lifetime:return this.particleContext.lifeTime;case bZ.Angle:return this.particleContext.angle;case bZ.Scale:return this.particleContext.scale;case bZ.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case bZ.SpriteCellEnd:return this.systemContext.endSpriteCellID;case bZ.SpriteCellIndex:return this.particleContext.cellIndex;case bZ.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.xZ.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.xZ.absolutePosition:this.systemContext.xZ:null}getSystemValue(M){if(!this.particleContext||!this.systemContext)return null;switch(M){case aZ.Time:return this.systemContext._actualFrame;case aZ.Delta:return this.systemContext._scaledUpdateSpeed;case aZ.Emitter:if(this.isEmitterTransformNode){return this.systemContext.xZ.absolutePosition}return this.systemContext.xZ}return null}}function SZ(M,Z,P){const x=new pZ;x.nZ=Z;const c=M.createSystem(x);return c.canStart=()=>!0,c.xZ=P.clone(),c.disposeOnStop=!0,c.start(),c}class XZ extends iZ{constructor(M){super(M),this.blendMode=mM.BLENDMODE_ONEONE,this.tZ=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",EZ.Particle),this.registerInput("texture",EZ.Texture),this.registerInput("onStart",EZ.System,!0),this.registerInput("onEnd",EZ.System,!0),this.registerOutput("system",EZ.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(M){M.tZ=this.tZ,M.buildId=this._buildId++,this.build(M);const Z=this.particle.getConnectedValue(M);return Z.particleTexture=this.texture.getConnectedValue(M),Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.name=this.name,Z._nodeGenerated=!0,Z._targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,this.system._storedValue=this,Z.canStart=()=>!this.doNoStart,Z.onStartedObservable.add((P=>{const x=this.onStart.getConnectedValue(M);x&&P.onStartedObservable.addOnce((()=>{M.systemContext=Z;const P=SZ(x,M.nZ,M.emitterPosition);this.Gc.addOnce((()=>{P.dispose()}))}));const c=this.onEnd.getConnectedValue(M);c&&P.onStoppedObservable.addOnce((()=>{M.systemContext=Z;const P=SZ(c,M.nZ,M.emitterPosition);this.Gc.addOnce((()=>{P.dispose()}))}))})),this.Gc.addOnce((()=>{Z.dispose()})),Z}serialize(){const M=super.serialize();return M.tZ=this.tZ,M.emitRate=this.emitRate,M.blendMode=this.blendMode,M.doNoStart=this.doNoStart,M.targetStopDuration=this.targetStopDuration,M.startDelay=this.startDelay,M}_deserialize(M){super._deserialize(M),this.tZ=M.tZ,this.emitRate=M.emitRate,this.doNoStart=!!M.doNoStart,void 0!==M.blendMode&&(this.blendMode=M.blendMode),void 0!==M.targetStopDuration&&(this.targetStopDuration=M.targetStopDuration),void 0!==M.startDelay&&(this.startDelay=M.startDelay)}}(0,R.c)([TZ("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:mM.BLENDMODE_ONEONE},{label:"Standard",value:mM.BLENDMODE_STANDARD},{label:"Add",value:mM.BLENDMODE_ADD},{label:"Multiply",value:mM.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:mM.BLENDMODE_MULTIPLYADD}]})],XZ.prototype,"blendMode",void 0),(0,R.c)([TZ("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],XZ.prototype,"tZ",void 0),(0,R.c)([TZ("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XZ.prototype,"emitRate",void 0),(0,R.c)([TZ("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XZ.prototype,"targetStopDuration",void 0),(0,R.c)([TZ("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XZ.prototype,"startDelay",void 0),(0,R.c)([TZ("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],XZ.prototype,"doNoStart",void 0),(0,G.g)("BABYLON.SystemBlock",XZ);class VZ extends iZ{get type(){if(this._type===EZ.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=EZ.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=EZ.Vector2,this._type;case"BZ":return this._type=EZ.BZ,this._type;case"Ic":return this._type=EZ.Ic,this._type;case"Matrix":return this._type=EZ.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===bZ.None&&this._systemSource!==aZ.None}get systemSource(){return this._systemSource}set systemSource(M){if(this._systemSource=M,M!==aZ.None){switch(this._contextualSource=bZ.None,this._type=EZ.Float,M){case aZ.Time:case aZ.Delta:this._type=EZ.Float;break;case aZ.Emitter:this._type=EZ.BZ}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==bZ.None}get contextualValue(){return this._contextualSource}set contextualValue(M){if(this._contextualSource=M,M!==bZ.None){switch(this._systemSource=aZ.None,M){case bZ.Scale:this._type=EZ.Vector2;break;case bZ.Position:case bZ.Direction:case bZ.ScaledDirection:this._type=EZ.BZ;break;case bZ.Color:this._type=EZ.Ic;break;case bZ.Age:case bZ.Lifetime:case bZ.Angle:case bZ.AgeGradient:this._type=EZ.Float;break;case bZ.SpriteCellEnd:case bZ.SpriteCellStart:case bZ.SpriteCellIndex:this._type=EZ.Int}this.output&&(this.output.type=this._type)}}constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EZ.AutoDetect;super(M),this._type=EZ.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new S.b,this._systemSource=aZ.None,this._contextualSource=bZ.None,this._type=Z,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",Z)}get value(){return this._storedValue}set value(M){this.type===EZ.Float&&this.min!==this.max&&(M=Math.max(this.min,M),M=Math.min(this.max,M)),this._storedValue=M,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(M){this._valueCallback=M}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case EZ.Int:case EZ.Float:this.value=0;break;case EZ.Vector2:this.value=x.Vector2.Zero();break;case EZ.BZ:this.value=x.BZ.Zero();break;case EZ.Ic:this.value=new v.Ic(1,1,1,1);break;case EZ.Matrix:this.value=x.Matrix.Identity()}}_build(M){super._build(M),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=M=>M.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=M=>M.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const M=super.serialize();return M.type=this.type,M.contextualValue=this.contextualValue,M.systemSource=this.systemSource,M.min=this.min,M.max=this.max,M.groupInInspector=this.groupInInspector,M.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.nc?(M.valueType="BABYLON."+this._storedValue.getClassName(),M.value=this._storedValue.nc()):(M.valueType="number",M.value=this._storedValue)),M}_deserialize(M){if(super._deserialize(M),this._type=M.type,this.contextualValue=M.contextualValue,this.systemSource=M.systemSource||aZ.None,this.min=M.min||0,this.max=M.max||0,this.groupInInspector=M.groupInInspector||"",void 0!==M.displayInInspector&&(this.displayInInspector=M.displayInInspector),M.valueType)if("number"===M.valueType)this._storedValue=M.value;else{const Z=(0,G.e)(M.valueType);Z&&(this._storedValue=Z.NZ(M.value))}}}(0,G.g)("BABYLON.ParticleInputBlock",VZ);class gZ extends iZ{get url(){return this._url}set url(M){this._url!==M&&(this._cachedData=null,this._url=M,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(M){this._textureDataUrl!==M&&(this._cachedData=null,this._textureDataUrl=M,this._url="",this._sourceTexture=null)}set sourceTexture(M){this._sourceTexture!==M&&(this._cachedData=null,this._sourceTexture=M,this._url="",this._textureDataUrl="")}constructor(M){super(M),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",EZ.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const M=this.texture._storedValue;return await new Promise(((Z,P)=>{if(!M.isReady())return void M.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),Z(this._cachedData)}catch(M){P(M)}}));const x=M.getSize();RZ.l.GetTextureDataAsync(M,x.width,x.height).then((P=>{this._cachedData={width:x.width,height:x.height,data:new Uint8ClampedArray(P)},M.dispose(),Z(this._cachedData)})).catch(P)}))}_build(M){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new A.e(this._textureDataUrl,M.nZ):this.texture._storedValue=new A.e(this._url,M.nZ):this.texture._storedValue=null}serialize(){const M=super.serialize();return M.url=this.url,M.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(M.textureDataUrl=this.textureDataUrl),M}_deserialize(M){super._deserialize(M),this.url=M.url,this.serializedCachedData=!!M.serializedCachedData,M.textureDataUrl&&(this.textureDataUrl=M.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,G.g)("BABYLON.ParticleTextureSourceBlock",gZ);class MP extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("position",EZ.BZ),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(M){const Z=this.particle.getConnectedValue(M);if(this.output._storedValue=Z,!this.position.isConnected)return;const P={process:P=>{M.particleContext=P,M.systemContext=Z,P.position.v(this.position.getConnectedValue(M))},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P}}(0,G.g)("BABYLON.UpdatePositionBlock",MP),function(M){M[M.Add=0]="Add",M[M.Subtract=1]="Subtract",M[M.Multiply=2]="Multiply",M[M.Divide=3]="Divide",M[M.Max=4]="Max",M[M.Min=5]="Min"}(yZ||(yZ={}));class ZP extends iZ{constructor(M){super(M),this.operation=yZ.Add,this.registerInput("left",EZ.AutoDetect),this.registerInput("right",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this.output._typeConnectionSource=this.left;const Z=[EZ.Matrix,EZ.Particle,EZ.Texture,EZ.System,EZ.FloatGradient,EZ.Color4Gradient,EZ.Vector2Gradient,EZ.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...Z),this.right.excludedConnectionPointTypes.push(...Z),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(M){let Z;const P=this.left,c=this.right;if(!P.isConnected||!c.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const w=P.type===EZ.Float||P.type===EZ.Int,G=c.type===EZ.Float||c.type===EZ.Int,mM=w&&G;switch(this.operation){case yZ.Add:Z=mM?M=>P.getConnectedValue(M)+c.getConnectedValue(M):w?M=>M.adapt(P,c.type).add(c.getConnectedValue(M)):M=>P.getConnectedValue(M).add(M.adapt(c,P.type));break;case yZ.Subtract:Z=mM?M=>P.getConnectedValue(M)-c.getConnectedValue(M):w?M=>M.adapt(P,c.type).UZ(c.getConnectedValue(M)):M=>P.getConnectedValue(M).UZ(M.adapt(c,P.type));break;case yZ.Multiply:Z=mM?M=>P.getConnectedValue(M)*c.getConnectedValue(M):w?M=>M.adapt(P,c.type).multiply(c.getConnectedValue(M)):M=>P.getConnectedValue(M).multiply(M.adapt(c,P.type));break;case yZ.Divide:Z=mM?M=>P.getConnectedValue(M)/c.getConnectedValue(M):w?M=>M.adapt(P,c.type).divide(c.getConnectedValue(M)):M=>P.getConnectedValue(M).divide(M.adapt(c,P.type));break;case yZ.Min:if(mM)Z=M=>Math.min(P.getConnectedValue(M),c.getConnectedValue(M));else{const[M,G]=w?[c,P]:[P,c];switch(M.type){case EZ.Vector2:Z=Z=>x.Vector2.Minimize(M.getConnectedValue(Z),Z.adapt(G,M.type));break;case EZ.BZ:Z=Z=>x.BZ.Minimize(M.getConnectedValue(Z),Z.adapt(G,M.type));break;case EZ.Ic:Z=Z=>{const P=M.getConnectedValue(Z),{r:x,g:c,b:w,a:mM}=Z.adapt(G,M.type);return new v.Ic(Math.min(P.r,x),Math.min(P.g,c),Math.min(P.b,w),Math.min(P.a,mM))}}}break;case yZ.Max:if(!mM){const[M,G]=w?[c,P]:[P,c];switch(M.type){case EZ.Vector2:Z=Z=>x.Vector2.Maximize(M.getConnectedValue(Z),Z.adapt(G,M.type));break;case EZ.BZ:Z=Z=>x.BZ.Maximize(M.getConnectedValue(Z),Z.adapt(G,M.type));break;case EZ.Ic:Z=Z=>{const P=M.getConnectedValue(Z),{r:x,g:c,b:w,a:mM}=Z.adapt(G,M.type);return new v.Ic(Math.max(P.r,x),Math.min(P.g,c),Math.min(P.b,w),Math.min(P.a,mM))}}break}Z=M=>Math.max(P.getConnectedValue(M),c.getConnectedValue(M))}this.output._storedFunction=M=>P.type===EZ.Int?0|Z(M):Z(M)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===EZ.Int||this.left.type===EZ.Float&&this.right.type!==EZ.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[M,Z]of[[this.left,this.right],[this.right,this.left]])M.acceptedConnectionPointTypes=[EZ.Int,EZ.Float],Z.isConnected&&(M.acceptedConnectionPointTypes.push(Z.type),Z.type!==EZ.Int&&Z.type!==EZ.Float||M.acceptedConnectionPointTypes.push(EZ.Vector2,EZ.BZ,EZ.Ic))}dispose(){super.dispose();for(const M of this._connectionObservers)M.remove();this._connectionObservers.length=0}serialize(){const M=super.serialize();return M.operation=this.operation,M}_deserialize(M){super._deserialize(M),this.operation=M.operation}}(0,R.c)([TZ("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:yZ.Add},{label:"Subtract",value:yZ.Subtract},{label:"Multiply",value:yZ.Multiply},{label:"Divide",value:yZ.Divide},{label:"Max",value:yZ.Max},{label:"Min",value:yZ.Min}]})],ZP.prototype,"operation",void 0),(0,G.g)("BABYLON.ParticleMathBlock",ZP);class PP extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("direction1",EZ.BZ,!0,new x.BZ(0,1,0)),this.registerInput("direction2",EZ.BZ,!0,new x.BZ(0,1,0)),this.registerInput("minEmitBox",EZ.BZ,!0,new x.BZ(-.5,-.5,-.5)),this.registerInput("maxEmitBox",EZ.BZ,!0,new x.BZ(.5,.5,.5)),this.registerOutput("output",EZ.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(M){const Z=this.particle.getConnectedValue(M);Z._directionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.direction1.getConnectedValue(M),w=this.direction2.getConnectedValue(M),v=(0,K.RandomRange)(c.x,w.x),G=(0,K.RandomRange)(c.y,w.y),mM=(0,K.RandomRange)(c.z,w.z);M.isEmitterTransformNode?x.BZ.TransformNormalFromFloatsToRef(v,G,mM,M.emitterWorldMatrix,P.direction):P.direction.lc(v,G,mM)},Z._positionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.minEmitBox.getConnectedValue(M),w=this.maxEmitBox.getConnectedValue(M),v=(0,K.RandomRange)(c.x,w.x),G=(0,K.RandomRange)(c.y,w.y),mM=(0,K.RandomRange)(c.z,w.z);M.isEmitterTransformNode?x.BZ.TransformCoordinatesFromFloatsToRef(v,G,mM,M.emitterWorldMatrix,P.position):(P.position.lc(v,G,mM),P.position.addInPlace(M.emitterPosition))},this.output._storedValue=Z}}(0,G.g)("BABYLON.BoxShapeBlock",PP);class xP extends iZ{constructor(M){super(M),this.registerInput("emitPower",EZ.Float,!0,1),this.registerInput("lifeTime",EZ.Float,!0,1),this.registerInput("color",EZ.Ic,!0,new v.Ic(1,1,1,1)),this.registerInput("scale",EZ.Vector2,!0,new x.Vector2(1,1)),this.registerInput("angle",EZ.Float,!0,0),this.registerOutput("particle",EZ.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(M){const Z=new GZ(this.name,M.tZ,M.nZ,null,!1,void 0,!0);Z.particleEmitterType=new L,Z._lifeTimeCreation.process=(Z,P)=>{M.particleContext=Z,Z.lifeTime=this.lifeTime.getConnectedValue(M),P._emitPower=this.emitPower.getConnectedValue(M)},Z._colorCreation.process=Z=>{M.particleContext=Z,Z.color.v(this.color.getConnectedValue(M))},Z._sizeCreation.process=Z=>{M.particleContext=Z,Z.size=1,Z.scale.v(this.scale.getConnectedValue(M))},Z._angleCreation.process=Z=>{M.particleContext=Z,Z.angle=this.angle.getConnectedValue(M)},this.particle._storedValue=Z}}(0,G.g)("BABYLON.CreateParticleBlock",xP);class cP{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const M=[];for(const Z of this.attachedBlocks)Z.isInput&&M.push(Z);return M}constructor(M){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new S.b,this.name=M}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(M)&&this.attachedBlocks.push(M);for(const P of M.inputs){const x=P.connectedPoint;if(x){const P=x.ownerBlock;P!==M&&this._initializeBlock(P,Z)}}}async buildAsync(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((P=>{const x=new DZ;for(const M of this._systemBlocks)this._initializeBlock(M);for(const c of this.systemBlocks){const P=new pZ;P.buildId=this._buildId++,P.nZ=M,P.verbose=Z;const w=c.createSystem(P);P.emitErrors(),x.systems.push(w)}this.onBuildObservable.notifyObservers(this),P(x)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const M=new XZ("Particle system"),Z=new MP("Update position");Z.output.connectTo(M.particle);const P=new VZ("Position");P.contextualValue=bZ.Position;const x=new VZ("Scaled direction");x.contextualValue=bZ.ScaledDirection;const c=new ZP("Add");c.operation=yZ.Add,P.output.connectTo(c.left),x.output.connectTo(c.right),c.output.connectTo(Z.position);const w=new xP("Create particle"),v=new PP("Box shape");w.particle.connectTo(v.particle),v.output.connectTo(Z.particle);const G=new gZ("Texture");G.texture.connectTo(M.texture),G.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(M)}removeBlock(M){const Z=this.attachedBlocks.indexOf(M);if(Z>-1&&this.attachedBlocks.splice(Z,1),M.isSystem){const Z=this._systemBlocks.indexOf(M);Z>-1&&this._systemBlocks.splice(Z,1)}}parseSerializedObject(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z||this.clear();const P={};for(const x of M.UO){const M=(0,G.e)(x.customType);if(M){const Z=new M;Z._deserialize(x),P[x.id]=Z,this.attachedBlocks.push(Z),Z.isSystem&&this._systemBlocks.push(Z)}}for(const x of this.attachedBlocks)if(x.isTeleportOut){const M=x,Z=M._tempEntryPointUniqueId;if(Z){const x=P[Z];x&&x.attachToEndpoint(M)}}for(let x=0;x<M.UO.length;x++){const c=M.UO[x],w=P[c.id];w&&(w.inputs.length&&c.inputs.some((M=>M.targetConnectionName))&&!Z||this._restoreConnections(w,M,P))}if(M.locations||M.editorData&&M.editorData.locations){const x=M.locations||M.editorData.locations;for(const M of x)P[M.Ew]&&(M.Ew=P[M.Ew].uniqueId);Z&&this.editorData&&this.editorData.locations&&x.concat(this.editorData.locations),M.locations?this.editorData={locations:x}:(this.editorData=M.editorData,this.editorData.locations=x);const c=[];for(const M in P)c[M]=P[M].uniqueId;this.editorData.map=c}this.comment=M.comment}_restoreConnections(M,Z,P){for(const x of M.outputs)for(const c of Z.UO){const w=P[c.id];if(w)for(const v of c.inputs)if(P[v.targetBlockId]!==M||v.targetConnectionName!==x.name);else{const M=w.getInputByName(v.inputName);if(!M||M.isConnected)continue;x.connectTo(M,!0),this._restoreConnections(w,Z,P)}}}serialize(M){const Z=M?{}:k.b.Serialize(this);Z.editorData=JSON.parse(JSON.stringify(this.editorData));let P=[];M?P=M:Z.customType="BABYLON.NodeParticleSystemSet",Z.UO=[];for(const x of P)Z.UO.push(x.serialize());if(!M)for(const x of this.attachedBlocks)-1===P.indexOf(x)&&Z.UO.push(x.serialize());return Z}dispose(){for(const M of this.attachedBlocks)M.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(M){const Z=new cP(M);return Z.setToDefault(),Z}static Parse(M){const Z=k.b.Parse((()=>new cP(M.name)),M,null);return Z.parseSerializedObject(M),Z}static ParseFromSnippetAsync(M,Z){return"_BLANK"===M?Promise.resolve(cP.CreateDefault("blank")):new Promise(((P,x)=>{const c=new lZ.c;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const v=JSON.parse(JSON.parse(c.responseText).jsonPayload),G=JSON.parse(v.nodeParticle);Z||(Z=k.b.Parse((()=>new cP(M)),G,null)),Z.parseSerializedObject(G),Z.snippetId=M;try{P(Z)}catch(w){x(w)}}else x("Unable to load the snippet "+M)})),c.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),c.send()}))}}cP.EditorURL=`${JZ.Tools._DefaultCdnUrl}/v${TM.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,cP.SnippetUrl="https://snippet.babylonjs.com",(0,R.c)([(0,W.H)()],cP.prototype,"name",void 0),(0,R.c)([(0,W.H)("comment")],cP.prototype,"comment",void 0),function(M){M[M.None=0]="None",M[M.PerParticle=1]="PerParticle",M[M.PerSystem=2]="PerSystem"}(fZ||(fZ={}));class wP extends iZ{constructor(M){super(M),this._currentLockId=-2,this.lockMode=fZ.PerParticle,this.registerInput("min",EZ.AutoDetect,!0,0),this.registerInput("max",EZ.AutoDetect,!0,1),this.registerOutput("output",EZ.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(EZ.Float|EZ.Int|EZ.Vector2|EZ.BZ|EZ.Ic),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(EZ.Float|EZ.Int|EZ.Vector2|EZ.BZ|EZ.Ic),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=EZ.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let M=null;switch(this._currentLockId=-2,this.min.type){case EZ.AutoDetect:case EZ.Int:case EZ.Float:M=M=>{const Z=this.min.getConnectedValue(M)||0,P=this.max.getConnectedValue(M)||1;return Z+Math.random()*(P-Z)};break;case EZ.Vector2:M=M=>{const Z=this.min.getConnectedValue(M)||x.Vector2.Zero(),P=this.max.getConnectedValue(M)||x.Vector2.One();return new x.Vector2(Z.x+Math.random()*(P.x-Z.x),Z.y+Math.random()*(P.y-Z.y))};break;case EZ.BZ:M=M=>{const Z=this.min.getConnectedValue(M)||x.BZ.Zero(),P=this.max.getConnectedValue(M)||x.BZ.One();return new x.BZ(Z.x+Math.random()*(P.x-Z.x),Z.y+Math.random()*(P.y-Z.y),Z.z+Math.random()*(P.z-Z.z))};break;case EZ.Ic:M=M=>{const Z=this.min.getConnectedValue(M)||new v.Ic(0,0,0,0),P=this.max.getConnectedValue(M)||new v.Ic(1,1,1,1);return new v.Ic(Z.x+Math.random()*(P.x-Z.x),Z.y+Math.random()*(P.y-Z.y),Z.z+Math.random()*(P.z-Z.z),Z.w+Math.random()*(P.w-Z.w))}}this.output._storedFunction=Z=>{var P;let x=0;switch(this.lockMode){case fZ.PerParticle:x=(null===(P=Z.particleContext)||void 0===P?void 0:P.id)||-1;break;case fZ.PerSystem:x=Z.buildId||0}return this._currentLockId!==x&&(this.lockMode!==fZ.None&&(this._currentLockId=x),this.output._storedValue=M(Z)),this.output._storedValue}}serialize(){const M=super.serialize();return M.lockMode=this.lockMode,M}_deserialize(M){super._deserialize(M),this.lockMode=M.lockMode}}(0,R.c)([TZ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:fZ.None},{label:"Per particle",value:fZ.PerParticle},{label:"Per system",value:fZ.PerSystem}]})],wP.prototype,"lockMode",void 0),(0,G.g)("BABYLON.ParticleRandomBlock",wP);class vP extends iZ{constructor(M){super(M),this._currentLockId=-2,this.lockMode=fZ.PerParticle,this.registerInput("min",EZ.AutoDetect),this.registerInput("max",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const Z=[EZ.Matrix,EZ.Particle,EZ.Texture,EZ.System,EZ.FloatGradient,EZ.Color4Gradient,EZ.Vector2Gradient,EZ.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...Z),this.max.excludedConnectionPointTypes.push(...Z)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let M=null;switch(this._currentLockId=-2,this.min.type){case EZ.Float:case EZ.Int:M=M=>{const Z=this.min.getConnectedValue(M),P=this.max.getConnectedValue(M);return Math.random()*(P-Z)+Z};break;case EZ.Vector2:M=M=>{const Z=this.min.getConnectedValue(M),P=this.max.getConnectedValue(M);return new x.Vector2(Math.random()*(P.x-Z.x)+Z.x,Math.random()*(P.y-Z.y)+Z.y)};break;case EZ.BZ:M=M=>{const Z=this.min.getConnectedValue(M),P=this.max.getConnectedValue(M);return new x.BZ(Math.random()*(P.x-Z.x)+Z.x,Math.random()*(P.y-Z.y)+Z.y,Math.random()*(P.z-Z.z)+Z.z)};break;case EZ.Ic:M=M=>{const Z=this.min.getConnectedValue(M),P=this.max.getConnectedValue(M);return new v.Ic(Math.random()*(P.r-Z.r)+Z.r,Math.random()*(P.g-Z.g)+Z.g,Math.random()*(P.b-Z.b)+Z.b,Math.random()*(P.a-Z.a)+Z.a)}}this.output._storedFunction=Z=>{var P;let x=0;switch(this.lockMode){case fZ.PerParticle:x=(null===(P=Z.particleContext)||void 0===P?void 0:P.id)||-1;break;case fZ.PerSystem:x=Z.buildId||0}return this._currentLockId!==x&&(this.lockMode!==fZ.None&&(this._currentLockId=x),this.output._storedValue=M(Z)),this.output._storedValue}}serialize(){const M=super.serialize();return M.lockMode=this.lockMode,M}_deserialize(M){super._deserialize(M),void 0!==M.lockMode&&(this.lockMode=M.lockMode)}}(0,R.c)([TZ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:fZ.None},{label:"Per particle",value:fZ.PerParticle},{label:"Per system",value:fZ.PerSystem}]})],vP.prototype,"lockMode",void 0),(0,G.g)("BABYLON.RandomRangeBlock",vP);(0,G.g)("BABYLON.ParticleLerpBlock",class extends iZ{constructor(M){super(M),this.registerInput("left",EZ.AutoDetect),this.registerInput("right",EZ.AutoDetect),this.registerInput("gradient",EZ.Float,!0,0,0,1),this.registerOutput("output",EZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(EZ.Float|EZ.Int|EZ.Vector2|EZ.BZ|EZ.Ic)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const M=(M,Z,P)=>(1-M)*Z+M*P;this.output._storedFunction=Z=>{const P=this.left.getConnectedValue(Z),c=this.right.getConnectedValue(Z),w=this.gradient.getConnectedValue(Z);switch(this.left.type){case EZ.Int:case EZ.Float:return M(w,P,c);case EZ.Vector2:return new x.Vector2(M(w,P.x,c.x),M(w,P.y,c.y));case EZ.BZ:return new x.BZ(M(w,P.x,c.x),M(w,P.y,c.y),M(w,P.z,c.z));case EZ.Ic:return new v.Ic(M(w,P.r,c.r),M(w,P.g,c.g),M(w,P.b,c.b),M(w,P.a,c.a))}return 0}}});(0,G.g)("BABYLON.UpdateDirectionBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("direction",EZ.BZ),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(M){const Z=this.particle.getConnectedValue(M);if(this.output._storedValue=Z,!this.direction.isConnected)return;const P={process:P=>{M.particleContext=P,M.systemContext=Z,P.direction.v(this.direction.getConnectedValue(M))},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P}});(0,G.g)("BABYLON.UpdateColorBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("color",EZ.Ic),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(M){const Z=this.particle.getConnectedValue(M);if(this.output._storedValue=Z,!this.color.isConnected)return;const P={process:P=>{M.particleContext=P,M.systemContext=Z,P.color.v(this.color.getConnectedValue(M))},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P}});(0,G.g)("BABYLON.UpdateScaleBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("scale",EZ.Vector2),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(M){const Z=this.particle.getConnectedValue(M);if(this.output._storedValue=Z,!this.scale.isConnected)return;const P={process:P=>{M.particleContext=P,M.systemContext=Z,P.scale.v(this.scale.getConnectedValue(M))},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P}});(0,G.g)("BABYLON.UpdateAngleBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("angle",EZ.Float),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(M){const Z=this.particle.getConnectedValue(M);if(this.output._storedValue=Z,!this.angle.isConnected)return;const P={process:P=>{M.particleContext=P,M.systemContext=Z,P.angle=this.angle.getConnectedValue(M)},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P}});(0,G.g)("BABYLON.BasicPositionUpdateBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(M){const Z=this.particle.getConnectedValue(M),P={process:P=>{M.particleContext=P,M.systemContext=Z,P.direction.scaleToRef(Z._directionScale,Z._scaledDirection),P.position.addInPlace(Z._scaledDirection)},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P,this.output._storedValue=Z}});(0,G.g)("BABYLON.BasicSpriteUpdateBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(M){const Z=this.particle.getConnectedValue(M),P={process:P=>{M.particleContext=P,M.systemContext=Z,P.updateCellIndex()},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P,this.output._storedValue=Z}});(0,G.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("cellIndex",EZ.Int),this.registerOutput("output",EZ.Particle),this.cellIndex.acceptedConnectionPointTypes=[EZ.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(M){const Z=this.particle.getConnectedValue(M);if(this.output._storedValue=Z,!this.cellIndex.isConnected)return;const P={process:P=>{M.particleContext=P,M.systemContext=Z,P.cellIndex=Math.floor(this.cellIndex.getConnectedValue(M))},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P}});class GP extends iZ{constructor(M){super(M),this.strength=1,this.registerInput("particle",EZ.Particle),this.registerInput("flowMap",EZ.Texture),this.registerOutput("output",EZ.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(M){var Z;const P=this.particle.getConnectedValue(M),x=M.nZ;let c;(null===(Z=this.flowMap.connectedPoint)||void 0===Z?void 0:Z.ownerBlock).extractTextureContentAsync().then((M=>{M&&(c=new oZ(M.width,M.height,M.data))}));const w={process:M=>{const Z=x.getTransformMatrix();c&&c._processParticle(M,this.strength*P._tempScaledUpdateSpeed,Z)},previousItem:null,nextItem:null};P._updateQueueStart?aM(w,P._updateQueueStart):P._updateQueueStart=w,this.output._storedValue=P}serialize(){const M=super.serialize();return M.strength=this.strength,M}_deserialize(M){super._deserialize(M),this.strength=M.strength}}(0,R.c)([TZ("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],GP.prototype,"strength",void 0),(0,G.g)("BABYLON.UpdateFlowMapBlock",GP);(0,G.g)("BABYLON.SphereShapeBlock",class extends iZ{constructor(M){super(M),this.registerInput("input",EZ.Particle),this.registerInput("radius",EZ.Float,!0,1),this.registerInput("radiusRange",EZ.Float,!0,1,0,1),this.registerInput("directionRandomizer",EZ.Float,!0,0,0,1),this.registerOutput("output",EZ.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(M){const Z=this.input.getConnectedValue(M);Z._directionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.directionRandomizer.getConnectedValue(M),w=P.position.UZ(M.emitterPosition).normalize(),v=(0,K.RandomRange)(0,c),G=(0,K.RandomRange)(0,c),mM=(0,K.RandomRange)(0,c);w.x+=v,w.y+=G,w.z+=mM,w.normalize(),M.isEmitterTransformNode?x.BZ.TransformNormalFromFloatsToRef(v,G,mM,M.emitterWorldMatrix,P.direction):P.direction.lc(v,G,mM)},Z._positionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.radius.getConnectedValue(M),w=this.radiusRange.getConnectedValue(M),v=c-(0,K.RandomRange)(0,c*w),G=(0,K.RandomRange)(0,1),mM=(0,K.RandomRange)(0,2*Math.PI),d=Math.acos(2*G-1),O=v*Math.cos(mM)*Math.sin(d),H=v*Math.cos(d),j=v*Math.sin(mM)*Math.sin(d);M.isEmitterTransformNode?x.BZ.TransformCoordinatesFromFloatsToRef(O,H,j,M.emitterWorldMatrix,P.position):(P.position.lc(O,H,j),P.position.addInPlace(M.emitterPosition))},this.output._storedValue=Z}});(0,G.g)("BABYLON.PointShapeBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("direction1",EZ.BZ,!0,new x.BZ(0,1,0)),this.registerInput("direction2",EZ.BZ,!0,new x.BZ(0,1,0)),this.registerOutput("output",EZ.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){const Z=this.particle.getConnectedValue(M);Z._directionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.direction1.getConnectedValue(M),w=this.direction2.getConnectedValue(M),v=(0,K.RandomRange)(c.x,w.x),G=(0,K.RandomRange)(c.y,w.y),mM=(0,K.RandomRange)(c.z,w.z);M.isEmitterTransformNode?x.BZ.TransformNormalFromFloatsToRef(v,G,mM,M.emitterWorldMatrix,P.direction):P.direction.lc(v,G,mM)},Z._positionCreation.process=P=>{M.systemContext=Z,M.isEmitterTransformNode?x.BZ.TransformCoordinatesFromFloatsToRef(0,0,0,M.emitterWorldMatrix,P.position):P.position.v(M.emitterPosition)},this.output._storedValue=Z}});(0,G.g)("BABYLON.CustomShapeBlock",class extends iZ{constructor(M){super(M),this.registerInput("particle",EZ.Particle),this.registerInput("position",EZ.BZ,!0,new x.BZ(0,0,0)),this.registerInput("direction",EZ.BZ,!0,new x.BZ(0,1,0)),this.registerOutput("output",EZ.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){const Z=this.particle.getConnectedValue(M);Z._directionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.direction.getConnectedValue(M);M.isEmitterTransformNode?x.BZ.TransformNormalToRef(c,M.emitterWorldMatrix,P.direction):P.direction.v(c)},Z._positionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.position.getConnectedValue(M);M.isEmitterTransformNode?x.BZ.TransformCoordinatesToRef(c,M.emitterWorldMatrix,P.position):(P.position.v(c),P.position.addInPlace(M.emitterPosition))},this.output._storedValue=Z}});(0,G.g)("BABYLON.CylinderShapeBlock",class extends iZ{constructor(M){super(M),this._tempVector=x.BZ.Zero(),this.registerInput("particle",EZ.Particle),this.registerInput("radius",EZ.Float,!0,1),this.registerInput("height",EZ.Float,!0,1,0),this.registerInput("radiusRange",EZ.Float,!0,1,0,1),this.registerInput("directionRandomizer",EZ.Float,!0,0,0,1),this.registerOutput("output",EZ.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(M){const Z=this.particle.getConnectedValue(M);Z._directionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.directionRandomizer.getConnectedValue(M);P.position.subtractToRef(M.emitterPosition,this._tempVector),this._tempVector.normalize(),M.isEmitterTransformNode&&x.BZ.TransformNormalToRef(this._tempVector,M.emitterInverseWorldMatrix,this._tempVector);const w=(0,K.RandomRange)(-c/2,c/2);let v=Math.atan2(this._tempVector.x,this._tempVector.z);v+=(0,K.RandomRange)(-Math.PI/2,Math.PI/2)*c,this._tempVector.y=w,this._tempVector.x=Math.sin(v),this._tempVector.z=Math.cos(v),this._tempVector.normalize(),M.isEmitterTransformNode?x.BZ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M.emitterWorldMatrix,P.direction):P.direction.v(this._tempVector)},Z._positionCreation.process=P=>{M.particleContext=P,M.systemContext=Z;const c=this.height.getConnectedValue(M),w=this.radiusRange.getConnectedValue(M),v=this.radius.getConnectedValue(M),G=(0,K.RandomRange)(-c/2,c/2),mM=(0,K.RandomRange)(0,2*Math.PI),d=(0,K.RandomRange)((1-w)*(1-w),1),O=Math.sqrt(d)*v,H=O*Math.cos(mM),j=O*Math.sin(mM);M.isEmitterTransformNode?x.BZ.TransformCoordinatesFromFloatsToRef(H,G,j,M.emitterWorldMatrix,P.position):(P.position.lc(H,G,j),P.position.addInPlace(M.emitterPosition))},this.output._storedValue=Z}});class mx extends iZ{constructor(M){super(M),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",EZ.Particle),this.registerOutput("output",EZ.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);const Z=this.particle.getConnectedValue(M);Z._isAnimationSheetEnabled=!0,Z.spriteCellWidth=this.width,Z.spriteCellHeight=this.height,Z.startSpriteCellID=this.start,Z.endSpriteCellID=this.end,Z.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=Z}serialize(){const M=super.serialize();return M.width=this.width,M.height=this.height,M.start=this.start,M.end=this.end,M.randomStartCell=this.randomStartCell,M}_deserialize(M){super._deserialize(M),this.width=M.width,this.height=M.height,this.start=M.start,this.end=M.end,this.randomStartCell=M.randomStartCell}}(0,R.c)([TZ("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mx.prototype,"start",void 0),(0,R.c)([TZ("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mx.prototype,"end",void 0),(0,R.c)([TZ("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mx.prototype,"width",void 0),(0,R.c)([TZ("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mx.prototype,"height",void 0),(0,R.c)([TZ("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mx.prototype,"loop",void 0),(0,R.c)([TZ("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mx.prototype,"randomStartCell",void 0),(0,G.g)("BABYLON.SetupSpriteSheetBlock",mx);class KP extends iZ{constructor(M){super(M),this.reference=0,this.registerInput("value",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=M=>{switch(M){case EZ.Float:return EZ.FloatGradient;case EZ.Vector2:return EZ.Vector2Gradient;case EZ.BZ:return EZ.Vector3Gradient;case EZ.Ic:return EZ.Color4Gradient}return M},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(EZ.Float|EZ.Vector2|EZ.BZ|EZ.Ic)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=M=>null}serialize(){const M=super.serialize();return M.reference=this.reference,M}_deserialize(M){super._deserialize(M),this.reference=M.reference}}(0,R.c)([TZ("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],KP.prototype,"reference",void 0),(0,G.g)("BABYLON.ParticleGradientValueBlock",KP);(0,G.g)("BABYLON.ParticleGradientBlock",class extends iZ{constructor(M){super(M),this._entryCount=1,this.registerInput("gradient",EZ.Float,!0,1,0,1),this.registerInput("value0",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=M=>{switch(M){case EZ.FloatGradient:return EZ.Float;case EZ.Vector2Gradient:return EZ.Vector2;case EZ.Vector3Gradient:return EZ.BZ;case EZ.Color4Gradient:return EZ.Ic}return M},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(EZ.FloatGradient|EZ.Vector2Gradient|EZ.Vector3Gradient|EZ.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(M){this._inputs[M].onConnectionObservable.add((()=>{this._entryCount>M||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),EZ.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const M=[];for(let P=1;P<this._inputs.length;P++){var Z;if(this._inputs[P].isConnected)M.push(null===(Z=this._inputs[P].connectedPoint)||void 0===Z?void 0:Z.ownerBlock)}M.sort(((M,Z)=>M.reference-Z.reference)),this.output._storedFunction=Z=>{const P=this.gradient.getConnectedValue(Z);if(1===M.length)return M[0].value.getConnectedValue(Z);let c=null;for(let w=M.length-1;w>=0;w--){const G=M[w];if(G.reference<=P){const M=G.value.getConnectedValue(Z);if(c){const w=c.value.getConnectedValue(Z),mM=c.reference,d=G.reference,O=Math.max(0,Math.min(1,(P-d)/(mM-d)));switch(this.output.type){case EZ.Float:return(0,K.Lerp)(M,w,O);case EZ.Vector2:return x.Vector2.Lerp(M,w,O);case EZ.BZ:return x.BZ.Lerp(M,w,O);case EZ.Ic:return v.Ic.Lerp(M,w,O)}}return M}c=G}return 0}}});(0,G.g)("BABYLON.ParticleConverterBlock",class extends iZ{constructor(M){super(M),this.registerInput("color ",EZ.Ic,!0),this.registerInput("xyz ",EZ.BZ,!0),this.registerInput("xy ",EZ.Vector2,!0),this.registerInput("zw ",EZ.Vector2,!0),this.registerInput("x ",EZ.Float,!0),this.registerInput("y ",EZ.Float,!0),this.registerInput("z ",EZ.Float,!0),this.registerInput("w ",EZ.Float,!0),this.registerOutput("color",EZ.Ic),this.registerOutput("xyz",EZ.BZ),this.registerOutput("xy",EZ.Vector2),this.registerOutput("zw",EZ.Vector2),this.registerOutput("x",EZ.Float),this.registerOutput("y",EZ.Float),this.registerOutput("z",EZ.Float),this.registerOutput("w",EZ.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(M){return"color "===M?"colorIn":"xyz "===M?"xyzIn":"xy "===M?"xyIn":"zw "===M?"zwIn":"x "===M?"xIn":"y "===M?"yIn":"z "===M?"zIn":"w "===M?"wIn":M}_outputRename(M){switch(M){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return M}}_build(M){super._build(M);const Z=this.xIn,P=this.yIn,c=this.zIn,w=this.wIn,G=this.xyIn,mM=this.zwIn,K=this.xyzIn,d=this.colorIn,O=this.colorOut,H=this.xyzOut,j=this.xyOut,B=this.zwOut,U=this.xOut,n=this.yOut,L=this.zOut,u=this.wOut,N=M=>{if(d.isConnected)return d.getConnectedValue(M);let x=0,O=0,H=0,j=0;if(Z.isConnected&&(x=Z.getConnectedValue(M)),P.isConnected&&(O=P.getConnectedValue(M)),c.isConnected&&(H=c.getConnectedValue(M)),w.isConnected&&(j=w.getConnectedValue(M)),G.isConnected){const Z=G.getConnectedValue(M);Z&&(x=Z.x,O=Z.y)}if(mM.isConnected){const Z=mM.getConnectedValue(M);Z&&(H=Z.x,j=Z.y)}if(K.isConnected){const Z=K.getConnectedValue(M);Z&&(x=Z.x,O=Z.y,H=Z.z)}return new v.Ic(x,O,H,j)};O._storedFunction=M=>N(M),H._storedFunction=M=>{const Z=N(M);return new x.BZ(Z.r,Z.g,Z.b)},j._storedFunction=M=>{const Z=N(M);return new x.Vector2(Z.r,Z.g)},B._storedFunction=M=>{const Z=N(M);return new x.Vector2(Z.b,Z.a)},U._storedFunction=M=>N(M).r,n._storedFunction=M=>N(M).g,L._storedFunction=M=>N(M).b,u._storedFunction=M=>N(M).a}}),function(M){M[M.Cos=0]="Cos",M[M.Sin=1]="Sin",M[M.Abs=2]="Abs",M[M.Exp=3]="Exp",M[M.Exp2=4]="Exp2",M[M.Round=5]="Round",M[M.Floor=6]="Floor",M[M.Ceiling=7]="Ceiling",M[M.Sqrt=8]="Sqrt",M[M.Log=9]="Log",M[M.Tan=10]="Tan",M[M.ArcTan=11]="ArcTan",M[M.ArcCos=12]="ArcCos",M[M.ArcSin=13]="ArcSin",M[M.Sign=14]="Sign",M[M.Negate=15]="Negate",M[M.OneMinus=16]="OneMinus",M[M.Reciprocal=17]="Reciprocal",M[M.ToDegrees=18]="ToDegrees",M[M.ToRadians=19]="ToRadians",M[M.Fract=20]="Fract"}(YZ||(YZ={}));class dP extends iZ{constructor(M){super(M),this.operation=YZ.Cos,this.registerInput("input",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(EZ.Float|EZ.Int|EZ.Vector2|EZ.BZ|EZ.Ic)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);let Z=null;switch(this.operation){case YZ.Cos:Z=M=>Math.cos(M);break;case YZ.Sin:Z=M=>Math.sin(M);break;case YZ.Abs:Z=M=>Math.abs(M);break;case YZ.Exp:Z=M=>Math.exp(M);break;case YZ.Exp2:Z=M=>Math.pow(2,M);break;case YZ.Round:Z=M=>Math.round(M);break;case YZ.Floor:Z=M=>Math.floor(M);break;case YZ.Ceiling:Z=M=>Math.ceil(M);break;case YZ.Sqrt:Z=M=>Math.sqrt(M);break;case YZ.Log:Z=M=>Math.log(M);break;case YZ.Tan:Z=M=>Math.tan(M);break;case YZ.ArcTan:Z=M=>Math.atan(M);break;case YZ.ArcCos:Z=M=>Math.acos(M);break;case YZ.ArcSin:Z=M=>Math.asin(M);break;case YZ.Sign:Z=M=>Math.sign(M);break;case YZ.Negate:Z=M=>-M;break;case YZ.OneMinus:Z=M=>1-M;break;case YZ.Reciprocal:Z=M=>1/M;break;case YZ.ToRadians:Z=M=>M*Math.PI/180;break;case YZ.ToDegrees:Z=M=>180*M/Math.PI;break;case YZ.Fract:Z=M=>M>=0?M-Math.floor(M):M-Math.ceil(M)}if(!Z)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case EZ.Int:case EZ.Float:this.output._storedFunction=M=>{const P=this.input.getConnectedValue(M);return Z(P)};break;case EZ.Vector2:this.output._storedFunction=M=>{const P=this.input.getConnectedValue(M);return new x.Vector2(Z(P.x),Z(P.y))};break;case EZ.BZ:this.output._storedFunction=M=>{const P=this.input.getConnectedValue(M);return new x.BZ(Z(P.x),Z(P.y),Z(P.z))};break;case EZ.Ic:this.output._storedFunction=M=>{const P=this.input.getConnectedValue(M);return new v.Ic(Z(P.r),Z(P.g),Z(P.b),Z(P.a))}}return this}serialize(){const M=super.serialize();return M.operation=this.operation,M}_deserialize(M){super._deserialize(M),this.operation=M.operation}}(0,R.c)([TZ("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:YZ.Cos},{label:"Sin",value:YZ.Sin},{label:"Abs",value:YZ.Abs},{label:"Exp",value:YZ.Exp},{label:"Exp2",value:YZ.Exp2},{label:"Round",value:YZ.Round},{label:"Floor",value:YZ.Floor},{label:"Ceiling",value:YZ.Ceiling},{label:"Sqrt",value:YZ.Sqrt},{label:"Log",value:YZ.Log},{label:"Tan",value:YZ.Tan},{label:"ArcTan",value:YZ.ArcTan},{label:"ArcCos",value:YZ.ArcCos},{label:"ArcSin",value:YZ.ArcSin},{label:"Sign",value:YZ.Sign},{label:"Negate",value:YZ.Negate},{label:"OneMinus",value:YZ.OneMinus},{label:"Reciprocal",value:YZ.Reciprocal},{label:"ToDegrees",value:YZ.ToDegrees},{label:"ToRadians",value:YZ.ToRadians},{label:"Fract",value:YZ.Fract}]})],dP.prototype,"operation",void 0),(0,G.g)("BABYLON.ParticleTrigonometryBlock",dP);var OP,HP=P(13759);class jP extends iZ{constructor(M){super(M),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(EZ.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(EZ.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(EZ.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(EZ.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(EZ.System),this._inputs[0].excludedConnectionPointTypes.push(EZ.Particle),this._inputs[0].excludedConnectionPointTypes.push(EZ.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const Z=M=>{const Z=this.input.getConnectedValue(M);if(this.log.length>=this.stackSize)return Z;if(null===Z||void 0===Z)return this.log.push(["null",""]),Z;switch(this.input.type){case EZ.Vector2:this.log.push([(0,HP.i)(Z,4),Z.toString()]);break;case EZ.BZ:this.log.push([(0,HP.m)(Z,4),Z.toString()]);break;case EZ.Ic:this.log.push([`{R: ${Z.r.toFixed(4)} G: ${Z.g.toFixed(4)} B: ${Z.b.toFixed(4)} A: ${Z.a.toFixed(4)}}`,Z.toString()]);break;default:this.log.push([Z.toString(),Z.toString()])}return Z};this.output.isConnected?this.output._storedFunction=Z:this.output._storedValue=Z(M)}serialize(){const M=super.serialize();return M.stackSize=this.stackSize,M}_deserialize(M){super._deserialize(M),this.stackSize=M.stackSize}}(0,R.c)([TZ("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],jP.prototype,"stackSize",void 0),(0,G.g)("BABYLON.ParticleDebugBlock",jP);(0,G.g)("BABYLON.ParticleElbowBlock",class extends iZ{constructor(M){super(M),this.registerInput("input",EZ.AutoDetect),this.registerOutput("output",EZ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);const Z=this._outputs[0],P=this._inputs[0];Z._storedFunction=M=>P.getConnectedValue(M)}});(0,G.g)("BABYLON.ParticleTeleportInBlock",class extends iZ{get endpoints(){return this._endpoints}constructor(M){super(M),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",EZ.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(M){if(this.getClassName()===M)return!0;for(const Z of this.endpoints)if(Z.isAnAncestorOfType(M))return!0;return!1}isAnAncestorOf(M){for(const Z of this.endpoints){if(Z===M)return!0;if(Z.isAnAncestorOf(M))return!0}return!1}attachToEndpoint(M){M.detach(),this._endpoints.push(M),M._entryPoint=this,M._outputs[0]._typeConnectionSource=this._inputs[0],M._tempEntryPointUniqueId=null,M.name="> "+this.name}detachFromEndpoint(M){const Z=this._endpoints.indexOf(M);-1!==Z&&(this._endpoints.splice(Z,1),M._outputs[0]._typeConnectionSource=null,M._entryPoint=null)}_build(){for(const M of this._endpoints)M.output._storedFunction=M=>this.input.getConnectedValue(M)}});(0,G.g)("BABYLON.ParticleTeleportOutBlock",class extends iZ{constructor(M){super(M),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",EZ.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(M){this.entryPoint&&this.entryPoint.build(M)}clone(){const M=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(M),M}serialize(){var M;const Z=super.serialize();return Z.entryPoint=(null===(M=this.entryPoint)||void 0===M?void 0:M.uniqueId)??"",Z}_deserialize(M){super._deserialize(M),this._tempEntryPointUniqueId=M.entryPoint}}),function(M){M[M.Equal=0]="Equal",M[M.NotEqual=1]="NotEqual",M[M.LessThan=2]="LessThan",M[M.GreaterThan=3]="GreaterThan",M[M.LessOrEqual=4]="LessOrEqual",M[M.GreaterOrEqual=5]="GreaterOrEqual",M[M.Xor=6]="Xor",M[M.Or=7]="Or",M[M.And=8]="And"}(OP||(OP={}));class BP extends iZ{constructor(M){super(M),this.test=OP.Equal,this.epsilon=0,this.registerInput("left",EZ.Float),this.registerInput("right",EZ.Float,!0,0),this.registerInput("ifTrue",EZ.AutoDetect,!0,1),this.registerInput("ifFalse",EZ.AutoDetect,!0,0),this.registerOutput("output",EZ.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=EZ.Float,this._inputs[0].acceptedConnectionPointTypes.push(EZ.Int),this._inputs[1].acceptedConnectionPointTypes.push(EZ.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const M=M=>{const Z=this.left.getConnectedValue(M),P=this.right.getConnectedValue(M);let x=!1;switch(this.test){case OP.Equal:x=(0,K.WithinEpsilon)(Z,P,this.epsilon);break;case OP.NotEqual:x=!(0,K.WithinEpsilon)(Z,P,this.epsilon);break;case OP.LessThan:x=Z<P+this.epsilon;break;case OP.GreaterThan:x=Z>P-this.epsilon;break;case OP.LessOrEqual:x=Z<=P+this.epsilon;break;case OP.GreaterOrEqual:x=Z>=P-this.epsilon;break;case OP.Xor:x=!!Z&&!P||!Z&&!!P;break;case OP.Or:x=!!Z||!!P;break;case OP.And:x=!!Z&&!!P}return x};this.output._storedFunction=Z=>M(Z)?this.ifTrue.getConnectedValue(Z):this.ifFalse.getConnectedValue(Z)}serialize(){const M=super.serialize();return M.test=this.test,M.epsilon=this.epsilon,M}_deserialize(M){super._deserialize(M),this.test=M.test,void 0!==M.epsilon&&(this.epsilon=M.epsilon)}}(0,R.c)([TZ("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:OP.Equal},{label:"NotEqual",value:OP.NotEqual},{label:"LessThan",value:OP.LessThan},{label:"GreaterThan",value:OP.GreaterThan},{label:"LessOrEqual",value:OP.LessOrEqual},{label:"GreaterOrEqual",value:OP.GreaterOrEqual},{label:"Xor",value:OP.Xor},{label:"Or",value:OP.Or},{label:"And",value:OP.And}]})],BP.prototype,"test",void 0),(0,R.c)([TZ("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BP.prototype,"epsilon",void 0),(0,G.g)("BABYLON.ParticleConditionBlock",BP);class UP extends iZ{constructor(M){super(M),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",EZ.Particle),this.registerInput("condition",EZ.Float,!0,0),this.registerInput("system",EZ.System),this.registerOutput("output",EZ.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){this._triggerCount=0;const Z=this.input.getConnectedValue(M),P={process:P=>{if(M.particleContext=P,M.systemContext=Z,0!==this.condition.getConnectedValue(M)&&(0===this.limit||this._triggerCount<this.limit)){const x=(new Date).getTime();if(this._previousOne&&x-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=x;const c=this.system.getConnectedValue(M);if(c){const x=SZ(c,M.nZ,P.position);x.Gc.addOnce((()=>{this._triggerCount--})),Z.Gc.addOnce((()=>{x.dispose()}))}}},previousItem:null,nextItem:null};Z._updateQueueStart?aM(P,Z._updateQueueStart):Z._updateQueueStart=P,this.output._storedValue=Z}serialize(){const M=super.serialize();return M.limit=this.limit,M.delay=this.delay,M}_deserialize(M){super._deserialize(M),void 0!==M.limit&&(this.limit=M.limit),void 0!==M.delay&&(this.delay=M.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,R.c)([TZ("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UP.prototype,"limit",void 0),(0,R.c)([TZ("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UP.prototype,"delay",void 0),(0,G.g)("BABYLON.ParticleTriggerBlock",UP);P(13766),P(13775),P(13788),P(13835)},13818:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneFragment",w="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13791:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneFragmentDeclaration",w="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13851:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneVertex",w="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13838:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneVertexDeclaration",w="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13827:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogFragment",w="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13814:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogFragmentDeclaration",w="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13857:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogVertex",w="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13847:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogVertexDeclaration",w="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13807:(M,Z,P)=>{"use strict";var x=P(12271);const c="helperFunctions",w="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13797:(M,Z,P)=>{"use strict";var x=P(12271);const c="imageProcessingDeclaration",w="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13809:(M,Z,P)=>{"use strict";var x=P(12271);const c="imageProcessingFunctions",w="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13804:(M,Z,P)=>{"use strict";var x=P(12271);const c="logDepthDeclaration",w="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13824:(M,Z,P)=>{"use strict";var x=P(12271);const c="logDepthFragment",w="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13866:(M,Z,P)=>{"use strict";var x=P(12271);const c="logDepthVertex",w="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";x.c.IncludesShadersStoreWGSL[c]||(x.c.IncludesShadersStoreWGSL[c]=w)},13788:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{particlesPixelShaderWGSL:()=>v});var x=P(12271);P(13791),P(13797),P(13804),P(13807),P(13809),P(13814),P(13818),P(13824),P(13827);const c="particlesPixelShader",w="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";x.c.ShadersStoreWGSL[c]||(x.c.ShadersStoreWGSL[c]=w);const v={name:c,shader:w}},13835:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{particlesVertexShaderWGSL:()=>v});var x=P(12271);P(13838),P(13847),P(13804),P(13851),P(13857),P(13866);const c="particlesVertexShader",w="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";x.c.ShadersStoreWGSL[c]||(x.c.ShadersStoreWGSL[c]=w);const v={name:c,shader:w}},13691:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneFragment",w="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13769:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneFragmentDeclaration",w="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13713:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneVertex",w="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13779:(M,Z,P)=>{"use strict";var x=P(12271);const c="clipPlaneVertexDeclaration",w="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13697:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogFragment",w="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13682:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogFragmentDeclaration",w="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13721:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogVertex",w="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13705:(M,Z,P)=>{"use strict";var x=P(12271);const c="fogVertexDeclaration",w="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13672:(M,Z,P)=>{"use strict";var x=P(12271);const c="helperFunctions",w="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13668:(M,Z,P)=>{"use strict";var x=P(12271);const c="imageProcessingDeclaration",w="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13674:(M,Z,P)=>{"use strict";var x=P(12271);const c="imageProcessingFunctions",w="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13670:(M,Z,P)=>{"use strict";var x=P(12271);const c="logDepthDeclaration",w="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13693:(M,Z,P)=>{"use strict";var x=P(12271);const c="logDepthFragment",w="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13729:(M,Z,P)=>{"use strict";var x=P(12271);const c="logDepthVertex",w="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";x.c.IncludesShadersStore[c]||(x.c.IncludesShadersStore[c]=w)},13766:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{particlesPixelShader:()=>v});var x=P(12271);P(13769),P(13668),P(13670),P(13672),P(13674),P(13682),P(13691),P(13693),P(13697);const c="particlesPixelShader",w="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";x.c.ShadersStore[c]||(x.c.ShadersStore[c]=w);const v={name:c,shader:w}},13775:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{particlesVertexShader:()=>v});var x=P(12271);P(13779),P(13705),P(13670),P(13713),P(13721),P(13729);const c="particlesVertexShader",w="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";x.c.ShadersStore[c]||(x.c.ShadersStore[c]=w);const v={name:c,shader:w}},14124:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{FlowGraphGLTFDataProvider:()=>w});var x=P(14093),c=P(14073);class w extends x.c{constructor(M){var Z,P;super();const x=M.glTF,w=(null===(Z=x.animations)||void 0===Z?void 0:Z.map((M=>M._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",c.e,w);const v=(null===(P=x.nodes)||void 0===P?void 0:P.map((M=>M._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",c.e,v)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14013:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>n,f:()=>B,g:()=>j,j:()=>U});var x=P(12373),c=P(12845),w=P(12406),v=P(14015);const G=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class mM{constructor(M,Z){this._gltf=M,this._infoTree=Z}convert(M){let Z,P=this._gltf,x=this._infoTree;if(!M.startsWith("/"))throw new Error("Path must start with a /");const c=M.split("/");if(c.shift(),c[c.length-1].includes(".length")){const M=c[c.length-1].split(".");c.pop(),c.push(...M)}let w=!1;for(const mM of c){const c="length"===mM;if(c&&!x.__array__)throw new Error(`Path ${M} is invalid`);if(x.__ignoreObjectTree__&&(w=!0),x.__array__&&!c)x=x.__array__;else if(x=x[mM],!x)throw new Error(`Path ${M} is invalid`);if(!w)if(void 0===P){if(!G.find((Z=>Z.regex.test(M))))throw new Error(`Path ${M} is invalid`)}else if(!c){var v;P=null===(v=P)||void 0===v?void 0:v[mM]}(x.__target__||c)&&(Z=P)}return{object:Z,info:x}}}function K(M,Z,P,x){const c=d(M,Z);return x?c[P][x]:c[P]}function d(M,Z,P){var x,w;return null===(x=M._data)||void 0===x||null===(w=x[(null===P||void 0===P?void 0:P.fillMode)??c.d.MATERIAL_TriangleFillMode])||void 0===w?void 0:w.babylonMaterial}function O(M,Z){return{offset:{componentsCount:2,type:"Vector2",get:(P,c,w)=>{const v=K(P,w,M,Z);return new x.Vector2(null===v||void 0===v?void 0:v.uOffset,null===v||void 0===v?void 0:v.vOffset)},getTarget:d,set:(P,x,c,w)=>{const v=K(x,w,M,Z);v.uOffset=P.x,v.vOffset=P.y},getPropertyName:[()=>`${M}${Z?"."+Z:""}.uOffset`,()=>`${M}${Z?"."+Z:""}.vOffset`]},rotation:{type:"number",get:(P,x,c)=>{var w;return null===(w=K(P,c,M,Z))||void 0===w?void 0:w.wAng},getTarget:d,set:(P,x,c,w)=>K(x,w,M,Z).wAng=P,getPropertyName:[()=>`${M}${Z?"."+Z:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(P,c,w)=>{const v=K(P,w,M,Z);return new x.Vector2(null===v||void 0===v?void 0:v.uScale,null===v||void 0===v?void 0:v.vScale)},getTarget:d,set:(P,x,c,w)=>{const v=K(x,w,M,Z);v.uScale=P.x,v.vScale=P.y},getPropertyName:[()=>`${M}${Z?"."+Z:""}.uScale`,()=>`${M}${Z?"."+Z:""}.vScale`]}}}const H={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:M=>{var Z,P;return new x.Vector2((null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.orthoLeft)??0,(null===(P=M._babylonCamera)||void 0===P?void 0:P.orthoRight)??0)},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.orthoLeft=M.x,Z._babylonCamera.orthoRight=M.y)},getTarget:M=>M,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:M=>{var Z,P;return new x.Vector2((null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.orthoBottom)??0,(null===(P=M._babylonCamera)||void 0===P?void 0:P.orthoTop)??0)},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.orthoBottom=M.x,Z._babylonCamera.orthoTop=M.y)},getTarget:M=>M,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:M=>{var Z;return null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.maxZ},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.maxZ=M)},getTarget:M=>M,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:M=>{var Z;return null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.uc},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.uc=M)},getTarget:M=>M,getPropertyName:[()=>"uc"]}},perspective:{aspectRatio:{type:"number",get:M=>{var Z;return null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.getEngine().getAspectRatio(M._babylonCamera)},getTarget:M=>M,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:M=>{var Z;return null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.fov},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.fov=M)},getTarget:M=>M,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:M=>{var Z;return null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.maxZ},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.maxZ=M)},getTarget:M=>M,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:M=>{var Z;return null===(Z=M._babylonCamera)||void 0===Z?void 0:Z.uc},set:(M,Z)=>{Z._babylonCamera&&(Z._babylonCamera.uc=M)},getTarget:M=>M,getPropertyName:[()=>"uc"]}}}},nodes:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"BZ",get:M=>{var Z;return null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.position},set:(M,Z)=>{var P;return null===(P=Z._babylonTransformNode)||void 0===P?void 0:P.position.v(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:M=>{var Z;return null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.rotationQuaternion},set:(M,Z)=>{var P,x;return null===(P=Z._babylonTransformNode)||void 0===P||null===(x=P.rotationQuaternion)||void 0===x?void 0:x.v(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"BZ",get:M=>{var Z;return null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.hc},set:(M,Z)=>{var P;return null===(P=Z._babylonTransformNode)||void 0===P?void 0:P.hc.v(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"hc"]},weights:{length:{type:"number",get:M=>M._numMorphTargets,getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(M,Z)=>{var P,x;return void 0!==Z?null===(P=M._primitiveBabylonMeshes)||void 0===P||null===(x=P[0].morphTargetManager)||void 0===x?void 0:x.getTarget(Z).influence:void 0},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(M,Z)=>[0],getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:M=>{var Z,P,c;return x.Matrix.Compose(null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.hc,null===(P=M._babylonTransformNode)||void 0===P?void 0:P.rotationQuaternion,null===(c=M._babylonTransformNode)||void 0===c?void 0:c.position)},getTarget:M=>M._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:M=>{var Z,P,c,w;const v=x.Matrix.Identity();let G=M.parent;for(;G&&G.parent;)G=G.parent;const mM=(null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.position._isDirty)||(null===(P=M._babylonTransformNode)||void 0===P||null===(c=P.rotationQuaternion)||void 0===c?void 0:c._isDirty)||(null===(w=M._babylonTransformNode)||void 0===w?void 0:w.hc._isDirty);if(G){var K;const Z=null===(K=G._babylonTransformNode)||void 0===K?void 0:K.Jc(!0).invert();var d,O;if(Z)null===(d=M._babylonTransformNode)||void 0===d||null===(O=d.Jc(mM))||void 0===O||O.multiplyToRef(Z,v)}else M._babylonTransformNode&&v.v(M._babylonTransformNode.Jc(mM));return v},getTarget:M=>M._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:M=>{var Z,P;return null===(Z=M._babylonTransformNode)||void 0===Z||null===(P=Z.getChildren((M=>M instanceof v.c),!0)[0])||void 0===P?void 0:P.Rc},getTarget:M=>{var Z;return null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.getChildren((M=>M instanceof v.c),!0)[0]},set:(M,Z)=>{if(Z._babylonTransformNode){const P=Z._babylonTransformNode.getChildren((M=>M instanceof v.c),!0)[0];P&&(P.Rc=M)}}},color:{type:"uZ",get:M=>{var Z,P;return null===(Z=M._babylonTransformNode)||void 0===Z||null===(P=Z.getChildren((M=>M instanceof v.c),!0)[0])||void 0===P?void 0:P.Wc},getTarget:M=>{var Z;return null===(Z=M._babylonTransformNode)||void 0===Z?void 0:Z.getChildren((M=>M instanceof v.c),!0)[0]},set:(M,Z)=>{if(Z._babylonTransformNode){const P=Z._babylonTransformNode.getChildren((M=>M instanceof v.c),!0)[0];P&&(P.Wc=M)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"uZ",get:(M,Z,P)=>d(M,Z,P).emissiveColor,set:(M,Z,P,x)=>d(Z,P,x).emissiveColor.v(M),getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:O("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(M,Z,P)=>{var x;return null===(x=K(M,P,"bumpTexture"))||void 0===x?void 0:x.level},set:(M,Z,P,x)=>{const c=K(Z,x,"bumpTexture");c&&(c.level=M)},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:O("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(M,Z,P)=>d(M,Z,P).ambientTextureStrength,set:(M,Z,P,x)=>{const c=d(Z,P,x);c&&(c.ambientTextureStrength=M)},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:O("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Ic",get:(M,Z,P)=>{const x=d(M,Z,P);return w.Ic.FromColor3(x.albedoColor,x.alpha)},set:(M,Z,P,x)=>{const c=d(Z,P,x);c.albedoColor.set(M.r,M.g,M.b),c.alpha=M.a},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:O("albedoTexture")}},metallicFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).metallic,set:(M,Z,P,x)=>{const c=d(Z,P,x);c&&(c.metallic=M)},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).roughness,set:(M,Z,P,x)=>{const c=d(Z,P,x);c&&(c.roughness=M)},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:O("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(M,Z,P)=>d(M,Z,P).anisotropy.Rc,set:(M,Z,P,x)=>{d(Z,P,x).anisotropy.Rc=M},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(M,Z,P)=>d(M,Z,P).anisotropy.angle,set:(M,Z,P,x)=>{d(Z,P,x).anisotropy.angle=M},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:O("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).clearCoat.Rc,set:(M,Z,P,x)=>{d(Z,P,x).clearCoat.Rc=M},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).clearCoat.roughness,set:(M,Z,P,x)=>{d(Z,P,x).clearCoat.roughness=M},getTarget:(M,Z,P)=>d(M,Z,P),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:O("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(M,Z,P)=>{var x;return null===(x=d(M,Z,P).clearCoat.bumpTexture)||void 0===x?void 0:x.level},getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).clearCoat.bumpTexture.level=M},extensions:{KHR_texture_transform:O("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:O("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(M,Z,P)=>d(M,Z,P).subSurface.dispersion,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).subSurface.dispersion=M}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(M,Z,P)=>d(M,Z,P).emissiveIntensity,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).emissiveIntensity=M}},KHR_materials_ior:{ior:{type:"number",get:(M,Z,P)=>d(M,Z,P).indexOfRefraction,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).indexOfRefraction=M}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).iridescence.Rc,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).iridescence.Rc=M},iridescenceIor:{type:"number",get:(M,Z,P)=>d(M,Z,P).iridescence.indexOfRefraction,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).iridescence.indexOfRefraction=M},iridescenceTexture:{extensions:{KHR_texture_transform:O("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(M,Z,P)=>d(M,Z,P).iridescence.maximumThickness,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).iridescence.maximumThickness=M},iridescenceThicknessMinimum:{type:"number",get:(M,Z,P)=>d(M,Z,P).iridescence.minimumThickness,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).iridescence.minimumThickness=M},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:O("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"uZ",get:(M,Z,P)=>d(M,Z,P).sheen.color,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).sheen.color.v(M)},sheenColorTexture:{extensions:{KHR_texture_transform:O("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).sheen.Rc,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).sheen.Rc=M},sheenRoughnessTexture:{extensions:{KHR_texture_transform:O("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).metallicF0Factor,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).metallicF0Factor=M,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"uZ",get:(M,Z,P)=>d(M,Z,P).metallicReflectanceColor,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).metallicReflectanceColor.v(M),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:O("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:O("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).subSurface.refractionIntensity,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).subSurface.refractionIntensity=M,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:O("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).subSurface.translucencyIntensity,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).subSurface.translucencyIntensity=M},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:O("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"uZ",get:(M,Z,P)=>d(M,Z,P).subSurface.translucencyColor,getTarget:d,set:(M,Z,P,x)=>{var c;return M&&(null===(c=d(Z,P,x).subSurface.translucencyColor)||void 0===c?void 0:c.v(M))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:O("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"uZ",get:(M,Z,P)=>d(M,Z,P).subSurface.tintColor,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).subSurface.tintColor.v(M)},attenuationDistance:{type:"number",get:(M,Z,P)=>d(M,Z,P).subSurface.tintColorAtDistance,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).subSurface.tintColorAtDistance=M},thicknessFactor:{type:"number",get:(M,Z,P)=>d(M,Z,P).subSurface.maximumThickness,getTarget:d,set:(M,Z,P,x)=>d(Z,P,x).subSurface.maximumThickness=M},thicknessTexture:{extensions:{KHR_texture_transform:O("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonLight)),getPropertyName:[M=>"length"]},__array__:{__target__:!0,color:{type:"uZ",get:M=>{var Z;return null===(Z=M._babylonLight)||void 0===Z?void 0:Z.Wc},set:(M,Z)=>{var P;return null===(P=Z._babylonLight)||void 0===P?void 0:P.Wc.v(M)},getTarget:M=>M._babylonLight,getPropertyName:[M=>"diffuse"]},Rc:{type:"number",get:M=>{var Z;return null===(Z=M._babylonLight)||void 0===Z?void 0:Z.Rc},set:(M,Z)=>Z._babylonLight?Z._babylonLight.Rc=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"intensity"]},range:{type:"number",get:M=>{var Z;return null===(Z=M._babylonLight)||void 0===Z?void 0:Z.range},set:(M,Z)=>Z._babylonLight?Z._babylonLight.range=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"range"]},spot:{innerConeAngle:{type:"number",get:M=>{var Z;return null===(Z=M._babylonLight)||void 0===Z?void 0:Z.innerAngle},set:(M,Z)=>Z._babylonLight?Z._babylonLight.innerAngle=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"innerConeAngle"]},outerConeAngle:{type:"number",get:M=>{var Z;return null===(Z=M._babylonLight)||void 0===Z?void 0:Z.angle},set:(M,Z)=>Z._babylonLight?Z._babylonLight.angle=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonLight)),getPropertyName:[M=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonTexture)),getPropertyName:[M=>"length"]},__array__:{__target__:!0,Rc:{type:"number",get:M=>{var Z;return null===(Z=M._babylonTexture)||void 0===Z?void 0:Z.level},set:(M,Z)=>{Z._babylonTexture&&(Z._babylonTexture.level=M)},getTarget:M=>M._babylonTexture},rotation:{type:"Quaternion",get:M=>{var Z;return M._babylonTexture&&x.Quaternion.FromRotationMatrix(null===(Z=M._babylonTexture)||void 0===Z?void 0:Z.getReflectionTextureMatrix())},set:(M,Z)=>{var P;Z._babylonTexture&&(null!==(P=Z._babylonTexture.DM())&&void 0!==P&&P.useRightHandedSystem||(M=x.Quaternion.Inverse(M)),x.Matrix.FromQuaternionToRef(M,Z._babylonTexture.getReflectionTextureMatrix()))},getTarget:M=>M._babylonTexture}}}}},animations:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>{var Z;return null===(Z=M.primitives[0]._instanceData)||void 0===Z?void 0:Z.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function j(M){return new mM(M,H)}function B(M){const Z=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let P=H;for(const x of Z)x&&(P=P[x]);if(P&&P.type&&P.get)return P}function U(M,Z){const P=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let x=H;for(const c of P)c&&(x=x[c]);x&&x.type&&x.get&&(x.interpolation=Z)}function n(M,Z){const P=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let x=H;for(const c of P)if(c){if(!x[c]){if("?"===c){x.__ignoreObjectTree__=!0;continue}x[c]={},"__array__"===c&&(x[c].__target__=!0)}x=x[c]}Object.assign(x,Z)}},14019:(M,Z,P)=>{"use strict";P.r(Z),P.d(Z,{AnimationPropertyInfo:()=>K,TransformNodeAnimationPropertyInfo:()=>d,WeightAnimationPropertyInfo:()=>O,getQuaternion:()=>G,getVector3:()=>v,getWeights:()=>mM});var x=P(12890),c=P(12373),w=P(14013);function v(M,Z,P,x){return c.BZ.NZ(Z,P).scaleInPlace(x)}function G(M,Z,P,x){return c.Quaternion.NZ(Z,P).scaleInPlace(x)}function mM(M,Z,P,x){const c=new Array(M._numMorphTargets);for(let w=0;w<c.length;w++)c[w]=Z[P++]*x;return c}class K{constructor(M,Z,P,x){this.type=M,this.name=Z,this.getValue=P,this.getStride=x}_buildAnimation(M,Z,P){const c=new x.d(M,this.name,Z,this.type);return c.setKeys(P),c}}class d extends K{buildAnimations(M,Z,P,x){const c=[];return c.push({babylonAnimatable:M._babylonTransformNode,babylonAnimation:this._buildAnimation(Z,P,x)}),c}}class O extends K{buildAnimations(M,Z,P,c){const w=[];if(M._numMorphTargets)for(let v=0;v<M._numMorphTargets;v++){const G=new x.d(`${Z}_${v}`,this.name,P,this.type);if(G.setKeys(c.map((M=>({frame:M.frame,inTangent:M.inTangent?M.inTangent[v]:void 0,value:M.value[v],outTangent:M.outTangent?M.outTangent[v]:void 0,interpolation:M.interpolation})))),M._primitiveBabylonMeshes)for(const Z of M._primitiveBabylonMeshes)if(Z.morphTargetManager){const M=Z.morphTargetManager.getTarget(v),P=G.clone();M.animations.push(P),w.push({babylonAnimatable:M,babylonAnimation:P})}}return w}}(0,w.j)("/nodes/{}/translation",[new d(x.d.ANIMATIONTYPE_VECTOR3,"position",v,(()=>3))]),(0,w.j)("/nodes/{}/rotation",[new d(x.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",G,(()=>4))]),(0,w.j)("/nodes/{}/scale",[new d(x.d.ANIMATIONTYPE_VECTOR3,"hc",v,(()=>3))]),(0,w.j)("/nodes/{}/weights",[new O(x.d.ANIMATIONTYPE_FLOAT,"influence",mM,(M=>M._numMorphTargets))])},13973:(M,Z,P)=>{"use strict";class x{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((M,Z)=>{this._resolve=M,this._reject=Z}))}}var c=P(12373),w=P(12406),v=P(12175),G=P(12828),mM=P(13982),K=P(13995),d=P(12184),O=P(12841),H=P(12890),j=P(12896),B=P(12225),U=P(12199),n=P(12207);class L{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(M){this._useTextureToStoreBoneMatrices=M,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(M){this._animationPropertiesOverride=M}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(M,Z,P){this.name=M,this.id=Z,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=c.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new d.b,this.bones=[],this._scene=P||B.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const x=this._scene.getEngine().getCaps();this._canUseTextureForBones=x.textureFloat&&x.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((M=>!M.getParent()))}getTransformMatrices(M){if(this.needInitialSkinMatrix){if(!M)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return M._bonesTransformMatrices||this.prepare(!0),M._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(M){return this.needInitialSkinMatrix&&M._transformMatrixTexture?M._transformMatrixTexture:this._transformMatrixTexture}DM(){return this._scene}toString(M){let Z=`Name: ${this.name}, nBones: ${this.bones.length}`;if(Z+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,M){Z+=", Ranges: {";let M=!0;for(const P in this._ranges)M&&(Z+=", ",M=!1),Z+=P;Z+="}"}return Z}getBoneIndexByName(M){for(let Z=0,P=this.bones.length;Z<P;Z++)if(this.bones[Z].name===M)return Z;return-1}createAnimationRange(M,Z,P){if(!this._ranges[M]){this._ranges[M]=new j.e(M,Z,P);for(let x=0,c=this.bones.length;x<c;x++)this.bones[x].animations[0]&&this.bones[x].animations[0].createRange(M,Z,P)}}deleteAnimationRange(M){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let P=0,x=this.bones.length;P<x;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].deleteRange(M,Z);this._ranges[M]=null}getAnimationRange(M){return this._ranges[M]||null}getAnimationRanges(){const M=[];let Z;for(Z in this._ranges)M.push(this._ranges[Z]);return M}copyAnimationRange(M,Z){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[Z]||!M.getAnimationRange(Z))return!1;let x=!0;const c=this._getHighestAnimationFrame()+1,w={},v=M.bones;let G,mM;for(mM=0,G=v.length;mM<G;mM++)w[v[mM].name]=v[mM];this.bones.length!==v.length&&(U.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${v.length}`),x=!1);const K=P&&this.dimensionsAtRest&&M.dimensionsAtRest?this.dimensionsAtRest.divide(M.dimensionsAtRest):null;for(mM=0,G=this.bones.length;mM<G;mM++){const M=this.bones[mM].name,v=w[M];v?x=x&&this.bones[mM].copyAnimationRange(v,Z,c,P,K):(U.d.Warn("copyAnimationRange: not same rig, missing source bone "+M),x=!1)}const d=M.getAnimationRange(Z);return d&&(this._ranges[Z]=new j.e(Z,d.from+c,d.to+c)),x}returnToRest(){for(const M of this.bones)-1!==M._index&&M.returnToRest()}_getHighestAnimationFrame(){let M=0;for(let Z=0,P=this.bones.length;Z<P;Z++)if(this.bones[Z].animations[0]){const P=this.bones[Z].animations[0].getHighestFrame();M<P&&(M=P)}return M}beginAnimation(M,Z,P,x){const c=this.getAnimationRange(M);return c?this._scene.beginAnimation(this,c.from,c.to,Z,P,x):null}static MakeAnimationAdditive(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const x=M.getAnimationRange(P);if(!x)return null;const c=M._scene.getAllAnimatablesByTarget(M);let w=null;for(let G=0;G<c.length;G++){const M=c[G];if(M.fromFrame===(null===x||void 0===x?void 0:x.from)&&M.toFrame===(null===x||void 0===x?void 0:x.to)){w=M;break}}const v=M.getAnimatables();for(let G=0;G<v.length;G++){const M=v[G].animations;if(M)for(let x=0;x<M.length;x++)H.d.MakeAnimationAdditive(M[x],Z,P)}return w&&(w.isAdditive=!0),M}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(M){this._meshesWithPoseMatrix.push(M)}_unregisterMeshWithPoseMatrix(M){const Z=this._meshesWithPoseMatrix.indexOf(M);Z>-1&&this._meshesWithPoseMatrix.splice(Z,1)}_computeTransformMatrices(M,Z){this.onBeforeComputeObservable.notifyObservers(this);for(let P=0;P<this.bones.length;P++){const x=this.bones[P];x._childUpdateId++;const c=x.getParent();if(c?x.getLocalMatrix().multiplyToRef(c.getFinalMatrix(),x.getFinalMatrix()):Z?x.getLocalMatrix().multiplyToRef(Z,x.getFinalMatrix()):x.getFinalMatrix().v(x.getLocalMatrix()),-1!==x._index){const Z=null===x._index?P:x._index;x.getAbsoluteInverseBindMatrix().multiplyToArray(x.getFinalMatrix(),M,16*Z)}}this._identity.copyToArray(M,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const M=this.DM().getRenderId();if(this._currentRenderId===M)return;this._currentRenderId=M}if(this._numBonesWithLinkedTransformNode>0)for(const M of this.bones)if(M._linkedTransformNode){const Z=M._linkedTransformNode;M.position=Z.position,Z.rotationQuaternion?M.rotationQuaternion=Z.rotationQuaternion:M.rotation=Z.rotation,M.hc=Z.hc}if(this.needInitialSkinMatrix)for(const M of this._meshesWithPoseMatrix){const Z=M.getPoseMatrix();let P=this._isDirty;if(M._bonesTransformMatrices&&M._bonesTransformMatrices.length===16*(this.bones.length+1)||(M._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),P=!0),P){if(this._synchronizedWithMesh!==M){this._synchronizedWithMesh=M;for(const M of this.bones)if(!M.getParent()){M.getBindMatrix().multiplyToRef(Z,c.TmpVectors.Matrix[1]),M._updateAbsoluteBindMatrices(c.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const Z=4*(this.bones.length+1);M._transformMatrixTexture&&M._transformMatrixTexture.getSize().width===Z||(M._transformMatrixTexture&&M._transformMatrixTexture.dispose(),M._transformMatrixTexture=O.e.CreateRGBATexture(M._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(M._bonesTransformMatrices,Z),this.isUsingTextureForMatrices&&M._transformMatrixTexture&&M._transformMatrixTexture.update(M._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=O.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let M=0;M<this.bones.length;M++)this._animatables.push(this.bones[M])}return this._animatables}clone(M,Z){const P=new L(M,Z||M,this._scene);P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let x=0;x<this.bones.length;x++){const M=this.bones[x];let Z=null;const c=M.getParent();if(c){const M=this.bones.indexOf(c);Z=P.bones[M]}const w=new K.e(M.name,P,Z,M.getBindMatrix().clone(),M.getRestMatrix().clone());w._index=M._index,M._linkedTransformNode&&w.linkTransformNode(M._linkedTransformNode),n.c.DeepCopy(M.animations,w.animations)}if(this._ranges){P._ranges={};for(const M in this._ranges){const Z=this._ranges[M];Z&&(P._ranges[M]=Z.clone())}}return this._isDirty=!0,P.prepare(!0),P}enableBlending(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const Z of this.bones)for(const P of Z.animations)P.enableBlending=!0,P.blendingSpeed=M}dispose(){if(this._meshesWithPoseMatrix.length=0,this.DM().stopAnimation(this),this.DM().removeSkeleton(this),this._parentContainer){const M=this._parentContainer.skeletons.indexOf(this);M>-1&&this._parentContainer.skeletons.splice(M,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const M={};M.name=this.name,M.id=this.id,this.dimensionsAtRest&&(M.dimensionsAtRest=this.dimensionsAtRest.nc()),M.bones=[],M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){var Z;const x=this.bones[P],c=x.getParent(),w={parentBoneIndex:c?this.bones.indexOf(c):-1,index:x.getIndex(),name:x.name,id:x.id,matrix:x.getBindMatrix().nc(),rest:x.getRestMatrix().nc(),linkedTransformNodeId:null===(Z=x.getTransformNode())||void 0===Z?void 0:Z.id};M.bones.push(w),x.length&&(w.length=x.length),x.metadata&&(w.metadata=x.metadata),x.animations&&x.animations.length>0&&(w.animation=x.animations[0].serialize()),M.ranges=[];for(const Z in this._ranges){const P=this._ranges[Z];if(!P)continue;const x={};x.name=Z,x.from=P.from,x.to=P.to,M.ranges.push(x)}}return M}static Parse(M,Z){const P=new L(M.name,M.id,Z);let x;for(M.dimensionsAtRest&&(P.dimensionsAtRest=c.BZ.NZ(M.dimensionsAtRest)),P.needInitialSkinMatrix=M.needInitialSkinMatrix,x=0;x<M.bones.length;x++){const Z=M.bones[x],w=M.bones[x].index;let v=null;Z.parentBoneIndex>-1&&(v=P.bones[Z.parentBoneIndex]);const G=Z.rest?c.Matrix.NZ(Z.rest):null,mM=new K.e(Z.name,P,v,c.Matrix.NZ(Z.matrix),G,null,w);void 0!==Z.id&&null!==Z.id&&(mM.id=Z.id),Z.length&&(mM.length=Z.length),Z.metadata&&(mM.metadata=Z.metadata),Z.animation&&mM.animations.push(H.d.Parse(Z.animation)),void 0!==Z.linkedTransformNodeId&&null!==Z.linkedTransformNodeId&&(P._hasWaitingData=!0,mM._waitingTransformNodeId=Z.linkedTransformNodeId)}if(M.ranges)for(x=0;x<M.ranges.length;x++){const Z=M.ranges[x];P.createAnimationRange(Z.name,Z.from,Z.to)}return P}computeAbsoluteMatrices(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||M)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(M)}getPoseMatrix(){let M=null;return this._meshesWithPoseMatrix.length>0&&(M=this._meshesWithPoseMatrix[0].getPoseMatrix()),M}sortBones(){const M=[],Z=new Array(this.bones.length);for(let P=0;P<this.bones.length;P++)this._sortBones(P,M,Z);this.bones=M}_sortBones(M,Z,P){if(P[M])return;P[M]=!0;const x=this.bones[M];if(!x)return;void 0===x._index&&(x._index=M);const c=x.getParent();c&&this._sortBones(this.bones.indexOf(c),Z,P),Z.push(x)}setCurrentPoseAsRest(){for(const M of this.bones)M.setCurrentPoseAsRest()}}var u=P(12680),N=P(12856),J=P(12344),t=P(12784),F=P(12430),D=P(12835),l=P(12800),h=P(12825),Q=P(12899),I=P(12457),s=P(13948);class C{set areUpdatesFrozen(M){M?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new I.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,M||(M=B.b.LastCreatedScene),this._scene=M,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const M=this._scene.getEngine().getCaps();this._canUseTextureForTargets=M.canUseGLVertexID&&M.textureFloat&&M.maxVertexTextureImageUnits>0&&M.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return C.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?C.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(M){this._numMaxInfluencers!==M&&(this._numMaxInfluencers=M,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(M){this._useTextureToStoreTargets!==M&&(this._useTextureToStoreTargets=M,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var M;return C.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(M=this._scene)&&void 0!==M&&M.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(M){return this._activeTargets.data[M]}getTarget(M){return this._targets[M]}getTargetByName(M){for(const Z of this._targets)if(Z.name===M)return Z;return null}addTarget(M){this._targets.push(M),this._targetInfluenceChangedObservers.push(M.onInfluenceChanged.add((M=>{this.areUpdatesFrozen&&M&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(M)}))),this._targetDataLayoutChangedObservers.push(M._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(M){const Z=this._targets.indexOf(M);Z>=0&&(this._targets.splice(Z,1),M.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(Z,1)[0]),M._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(Z,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(M)}_bind(M){M.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),M.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),M.setTexture("morphTargets",this._targetStoreTexture),M.setInt("morphTargetCount",this.numInfluencers)}clone(){const M=new C(this._scene);for(const Z of this._targets)M.addTarget(Z.clone());return M.enablePositionMorphing=this.enablePositionMorphing,M.enableNormalMorphing=this.enableNormalMorphing,M.enableTangentMorphing=this.enableTangentMorphing,M.enableUVMorphing=this.enableUVMorphing,M.enableUV2Morphing=this.enableUV2Morphing,M.enableColorMorphing=this.enableColorMorphing,M}serialize(){const M={};M.id=this.uniqueId,M.targets=[];for(const Z of this._targets)M.targets.push(Z.serialize());return M}_syncActiveTargets(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const Z=!!this._targetStoreTexture,P=this.isUsingTextureForTargets;(this._mustSynchronize||Z!==P)&&(this._mustSynchronize=!1,this.synchronize());let x=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let c=-1;for(const w of this._targets)if(c++,0!==w.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=C.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(w),this._morphTargetTextureIndices[x]=c,this._tempInfluences[x++]=w.influence}this._morphTargetTextureIndices.length!==x&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,x)),this._influences&&this._influences.length===x||(this._influences=new Float32Array(x));for(let w=0;w<x;w++)this._influences[w]=this._tempInfluences[w];if(M&&this._scene)for(const w of this._scene.meshes)w.morphTargetManager===this&&(P?w._markSubMeshesAsAttributesDirty():w._syncGeometryWithMorphTargetManager())}synchronize(){var M;if(!this._scene||this.areUpdatesFrozen)return;const Z=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(M=this._targetStoreTexture)||void 0===M||M.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>Z.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const P of this._targets){this._supportsPositions=this._supportsPositions&&P.hasPositions,this._supportsNormals=this._supportsNormals&&P.hasNormals,this._supportsTangents=this._supportsTangents&&P.hasTangents,this._supportsUVs=this._supportsUVs&&P.hasUVs,this._supportsUV2s=this._supportsUV2s&&P.hasUV2s,this._supportsColors=this._supportsColors&&P.hasColors;const M=P.vertexCount;if(0===this._vertexCount)this._vertexCount=M;else if(this._vertexCount!==M)return void U.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${P.name}": ${M}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const M=Z.getCaps().maxTextureSize;this._textureWidth>M&&(this._textureHeight=Math.ceil(this._textureWidth/M),this._textureWidth=M);const P=this._targets.length,x=new Float32Array(P*this._textureWidth*this._textureHeight*4);let c=0;for(let Z=0;Z<P;Z++){const M=this._targets[Z],P=M.getPositions(),w=M.getNormals(),v=M.getUVs(),G=M.getTangents(),mM=M.getUV2s(),K=M.getColors();c=Z*this._textureWidth*this._textureHeight*4;for(let Z=0;Z<this._vertexCount;Z++)this._supportsPositions&&P&&(x[c]=P[3*Z],x[c+1]=P[3*Z+1],x[c+2]=P[3*Z+2],c+=4),this._supportsNormals&&w&&(x[c]=w[3*Z],x[c+1]=w[3*Z+1],x[c+2]=w[3*Z+2],c+=4),this._supportsUVs&&v&&(x[c]=v[2*Z],x[c+1]=v[2*Z+1],c+=4),this._supportsTangents&&G&&(x[c]=G[3*Z],x[c+1]=G[3*Z+1],x[c+2]=G[3*Z+2],c+=4),this._supportsUV2s&&mM&&(x[c]=mM[2*Z],x[c+1]=mM[2*Z+1],c+=4),this._supportsColors&&K&&(x[c]=K[4*Z],x[c+1]=K[4*Z+1],x[c+2]=K[4*Z+2],x[c+3]=K[4*Z+3],c+=4)}this._targetStoreTexture=s.b.CreateRGBATexture(x,this._textureWidth,this._textureHeight,P,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const P of this._scene.meshes)P.morphTargetManager===this&&P._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const M=this._parentContainer.morphTargetManagers.indexOf(this);M>-1&&this._parentContainer.morphTargetManagers.splice(M,1),this._parentContainer=null}for(const M of this._targets)this._scene.stopAnimation(M)}}static Parse(M,Z){const P=new C(Z);for(const x of M.targets)P.addTarget(Q.c.Parse(x,Z));return P}}C.EnableTextureStorage=!0,C.MaxActiveMorphTargetsInVertexAttributeMode=8,C.ConstantTargetCountForTextureMode=0;var R=P(14002),W=P(12230),k=P(12703);const A=new Map,o=A;function E(M,Z,P){r(M)&&U.d.Warn(`Extension with the name '${M}' already exists`),A.set(M,{isGLTFExtension:Z,factory:P})}function r(M){return A.delete(M)}var q=P(14013),e=P(12960),b=P(12448);class a{static Get(M,Z,P){if(!Z||void 0==P||!Z[P])throw new Error(`${M}: Failed to find index (${P})`);return Z[P]}static TryGet(M,Z){return M&&void 0!=Z&&M[Z]?M[Z]:null}static Assign(M){if(M)for(let Z=0;Z<M.length;Z++)M[Z].index=Z}}function y(M){if(M.min&&M.max){const Z=M.min,P=M.max,x=c.TmpVectors.BZ[0].lc(Z[0],Z[1],Z[2]),w=c.TmpVectors.BZ[1].lc(P[0],P[1],P[2]);if(M.normalized&&5126!==M.componentType){let Z=1;switch(M.componentType){case 5120:Z=127;break;case 5121:Z=255;break;case 5122:Z=32767;break;case 5123:Z=65535}const P=1/Z;x.scaleInPlace(P),w.scaleInPlace(P)}return new k.d(x,w)}return null}class f{static RegisterExtension(M,Z){E(M,!1,Z)}static UnregisterExtension(M){return r(M)}get jc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(M){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=M}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((M=>M.dispose&&M.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(M,Z,P,x,c,w){let v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=Z,this._assetContainer=P,this._loadData(x);let w=null;if(M){const Z={};if(this._gltf.nodes)for(const M of this._gltf.nodes)M.name&&(Z[M.name]=M.index);w=(M instanceof Array?M:[M]).map((M=>{const P=Z[M];if(void 0===P)throw new Error(`Failed to find node '${M}'`);return P}))}return await this._loadAsync(c,v,w,(()=>({meshes:this._getMeshes(),SH:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=M,this._loadData(Z),await this._loadAsync(P,c,null,(()=>{}))}async _loadAsync(M,Z,P,x){return await Promise.resolve().then((async()=>{this._rootUrl=M,this._uniqueRootUrl=!M.startsWith("file:")&&Z?M:`${M}${Date.now()}/`,this._fileName=Z,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const c=`${R.k[R.k.LOADING]} => ${R.k[R.k.READY]}`,w=`${R.k[R.k.LOADING]} => ${R.k[R.k.COMPLETE]}`;this._parent._startPerformanceCounter(c),this._parent._startPerformanceCounter(w),this._parent._setState(R.k.LOADING),this._extensionsOnLoading();const G=new Array;if(!this.parent.loadOnlyMaterials)if(P)G.push(this.loadSceneAsync("/nodes",{nodes:P,index:-1}));else if(void 0!=this._gltf.nZ||this._gltf.scenes&&this._gltf.scenes[0]){const M=a.Get("/scene",this._gltf.scenes,this._gltf.nZ||0);G.push(this.loadSceneAsync(`/scenes/${M.index}`,M))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let M=0;M<this._gltf.materials.length;++M){const Z=this._gltf.materials[M],P="/materials/"+M,x=u.d.TriangleFillMode;G.push(this._loadMaterialAsync(P,Z,null,x,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&G.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&G.push(this._compileShadowGeneratorsAsync());const mM=Promise.all(G).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Lm(!0);for(const M of this._babylonScene.materials){const Z=M;void 0!==Z.maxSimultaneousLights&&(Z.maxSimultaneousLights=Math.max(Z.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(R.k.READY),this._skipStartAnimationStep||this._startAnimations(),x()}));return await mM.then((M=>(this._parent._endPerformanceCounter(c),v.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(w),this._parent._setState(R.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(M=>{this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()}))})),M)))})).catch((M=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()),M}))}_loadData(M){if(this._gltf=M.json,this._setupData(),M.bin){const Z=this._gltf.buffers;if(Z&&Z[0]&&!Z[0].uri){const P=Z[0];(P.byteLength<M.bin.byteLength-3||P.byteLength>M.bin.byteLength)&&U.d.Warn(`Binary buffer length (${P.byteLength}) from JSON does not match chunk length (${M.bin.byteLength})`),this._bin=M.bin}else U.d.Warn("Unexpected BIN chunk")}}_setupData(){if(a.Assign(this._gltf.accessors),a.Assign(this._gltf.animations),a.Assign(this._gltf.buffers),a.Assign(this._gltf.bufferViews),a.Assign(this._gltf.cameras),a.Assign(this._gltf.images),a.Assign(this._gltf.materials),a.Assign(this._gltf.meshes),a.Assign(this._gltf.nodes),a.Assign(this._gltf.samplers),a.Assign(this._gltf.scenes),a.Assign(this._gltf.skins),a.Assign(this._gltf.textures),this._gltf.nodes){const M={};for(const P of this._gltf.nodes)if(P.children)for(const Z of P.children)M[Z]=P.index;const Z=this._createRootNode();for(const P of this._gltf.nodes){const x=M[P.index];P.parent=void 0===x?Z:this._gltf.nodes[x]}}}async _loadExtensionsAsync(){const M=[];if(o.forEach(((Z,P)=>{var x;!1===(null===(x=this.parent.extensionOptions[P])||void 0===x?void 0:x.enabled)?Z.isGLTFExtension&&this.isExtensionUsed(P)&&U.d.Warn(`Extension ${P} is used but has been explicitly disabled.`):Z.isGLTFExtension&&!this.isExtensionUsed(P)||M.push((async()=>{const M=await Z.factory(this);return M.name!==P&&U.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${M.name} !== ${P}`),this._parent.onExtensionLoadedObservable.notifyObservers(M),M})())})),this._extensions.push(...await Promise.all(M)),this._extensions.sort(((M,Z)=>(M.order||Number.MAX_VALUE)-(Z.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const P of this._gltf.extensionsRequired){if(!this._extensions.some((M=>M.name===P&&M.enabled))){var Z;if(!1===(null===(Z=this.parent.extensionOptions[P])||void 0===Z?void 0:Z.enabled))throw new Error(`Required extension ${P} is disabled`);throw new Error(`Required extension ${P} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new h.c("__root__",this._babylonScene);this._rootBabylonMesh=M,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Lm(!1);const Z={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case R.g.AUTO:this._babylonScene.useRightHandedSystem||(Z.rotation=[0,1,0,0],Z.scale=[1,1,-1],f._LoadTransform(Z,this._rootBabylonMesh));break;case R.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(M),Z}loadSceneAsync(M,Z){const P=this._extensionsLoadSceneAsync(M,Z);if(P)return P;const x=new Array;if(this.logOpen(`${M} ${Z.name||""}`),Z.nodes)for(const c of Z.nodes){const Z=a.Get(`${M}/nodes/${c}`,this._gltf.nodes,c);x.push(this.loadNodeAsync(`/nodes/${Z.index}`,Z,(M=>{M.parent=this._rootBabylonMesh})))}for(const c of this._postSceneLoadActions)c();return x.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(x).then((()=>{}))}_forEachPrimitive(M,Z){if(M._primitiveBabylonMeshes)for(const P of M._primitiveBabylonMeshes)Z(P)}_getGeometries(){const M=[],Z=this._gltf.nodes;if(Z)for(const P of Z)this._forEachPrimitive(P,(Z=>{const P=Z.tc;P&&-1===M.indexOf(P)&&M.push(P)}));return M}_getMeshes(){const M=[];this._rootBabylonMesh instanceof l.b&&M.push(this._rootBabylonMesh);const Z=this._gltf.nodes;if(Z)for(const P of Z)this._forEachPrimitive(P,(Z=>{M.push(Z)}));return M}_getTransformNodes(){const M=[],Z=this._gltf.nodes;if(Z)for(const P of Z)P._babylonTransformNode&&"rc"===P._babylonTransformNode.getClassName()&&M.push(P._babylonTransformNode),P._babylonTransformNodeForSkin&&M.push(P._babylonTransformNodeForSkin);return M}_getSkeletons(){const M=[],Z=this._gltf.skins;if(Z)for(const P of Z)P._data&&M.push(P._data.babylonSkeleton);return M}_getAnimationGroups(){const M=[],Z=this._gltf.animations;if(Z)for(const P of Z)P._babylonAnimationGroup&&M.push(P._babylonAnimationGroup);return M}_startAnimations(){switch(this._parent.animationStartMode){case R.f.NONE:break;case R.f.FIRST:{const M=this._getAnimationGroups();0!==M.length&&M[0].start(!0);break}case R.f.ALL:{const M=this._getAnimationGroups();for(const Z of M)Z.start(!0);break}default:return void U.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadNodeAsync(M,Z,P);if(x)return x;if(Z._babylonTransformNode)throw new Error(`${M}: Invalid recursive node hierarchy`);const c=new Array;this.logOpen(`${M} ${Z.name||""}`);const w=x=>{if(f.AddPointerMetadata(x,M),f._LoadTransform(Z,x),void 0!=Z.camera){const P=a.Get(`${M}/camera`,this._gltf.cameras,Z.camera);c.push(this.loadCameraAsync(`/cameras/${P.index}`,P,(M=>{M.parent=x,this._babylonScene.useRightHandedSystem||(x.hc.x=-1)})))}if(Z.children)for(const P of Z.children){const Z=a.Get(`${M}/children/${P}`,this._gltf.nodes,P);c.push(this.loadNodeAsync(`/nodes/${Z.index}`,Z,(M=>{M.parent=x})))}P(x)},v=void 0!=Z.mesh,G=this._parent.loadSkins&&void 0!=Z.skin;if(!v||G){const M=Z.name||`node${Z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new t.b(M,this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==Z.mesh?Z._babylonTransformNode=P:Z._babylonTransformNodeForSkin=P,w(P)}if(v)if(G){const P=a.Get(`${M}/mesh`,this._gltf.meshes,Z.mesh);c.push(this._loadMeshAsync(`/meshes/${P.index}`,Z,P,(P=>{const x=Z._babylonTransformNodeForSkin;P.metadata=(0,e.d)(x.metadata,P.metadata||{});const w=a.Get(`${M}/skin`,this._gltf.skins,Z.skin);c.push(this._loadSkinAsync(`/skins/${w.index}`,Z,w,(M=>{this._forEachPrimitive(Z,(Z=>{Z.skeleton=M})),this._postSceneLoadActions.push((()=>{if(void 0!=w.skeleton){const M=a.Get(`/skins/${w.index}/skeleton`,this._gltf.nodes,w.skeleton).parent;Z.index===M.index?P.parent=x.parent:P.parent=M._babylonTransformNode}else P.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:x,skinnedNode:P})}))})))})))}else{const P=a.Get(`${M}/mesh`,this._gltf.meshes,Z.mesh);c.push(this._loadMeshAsync(`/meshes/${P.index}`,Z,P,w))}return this.logClose(),Promise.all(c).then((()=>(this._forEachPrimitive(Z,(M=>{const Z=M;!Z.isAnInstance&&Z.tc&&Z.tc.useBoundingInfoFromGeometry?M.kM():M.refreshBoundingInfo(!0,!0)})),Z._babylonTransformNode)))}_loadMeshAsync(M,Z,P,x){const c=P.primitives;if(!c||!c.length)throw new Error(`${M}: Primitives are missing`);void 0==c[0].index&&a.Assign(c);const w=new Array;this.logOpen(`${M} ${P.name||""}`);const v=Z.name||`node${Z.index}`;if(1===c.length){const x=P.primitives[0];w.push(this._loadMeshPrimitiveAsync(`${M}/primitives/${x.index}`,v,Z,P,x,(M=>{Z._babylonTransformNode=M,Z._primitiveBabylonMeshes=[M]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,Z._babylonTransformNode=new t.b(v,this._babylonScene),Z._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._primitiveBabylonMeshes=[];for(const x of c)w.push(this._loadMeshPrimitiveAsync(`${M}/primitives/${x.index}`,`${v}_primitive${x.index}`,Z,P,x,(M=>{M.parent=Z._babylonTransformNode,Z._primitiveBabylonMeshes.push(M)})))}return x(Z._babylonTransformNode),this.logClose(),Promise.all(w).then((()=>Z._babylonTransformNode))}_loadMeshPrimitiveAsync(M,Z,P,x,c,w){const v=this._extensionsLoadMeshPrimitiveAsync(M,Z,P,x,c,w);if(v)return v;this.logOpen(`${M}`);const G=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==P.skin&&!x.primitives[0].targets;let mM,K;if(G&&c._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,mM=c._instanceData.babylonSourceMesh.createInstance(Z),mM._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K=c._instanceData.promise;else{const w=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new h.c(Z,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.sideOrientation=this._babylonScene.useRightHandedSystem?u.d.CounterClockWiseSideOrientation:u.d.ClockWiseSideOrientation,this._createMorphTargets(M,P,x,c,v),w.push(this._loadVertexDataAsync(M,c,v).then((async Z=>await this._loadMorphTargetsAsync(M,c,v,Z).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,Z.RM(v),Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const d=f._GetDrawMode(M,c.mode);if(void 0==c.material){let M=this._defaultBabylonMaterialData[d];M||(M=this._createDefaultMaterial("__GLTFLoader._default",d),this._parent.onMaterialLoadedObservable.notifyObservers(M),this._defaultBabylonMaterialData[d]=M),v.material=M}else if(!this.parent.skipMaterials){const Z=a.Get(`${M}/material`,this._gltf.materials,c.material);w.push(this._loadMaterialAsync(`/materials/${Z.index}`,Z,v,d,(M=>{v.material=M})))}K=Promise.all(w),G&&(c._instanceData={babylonSourceMesh:v,promise:K}),mM=v}return f.AddPointerMetadata(mM,M),this._parent.onMeshLoadedObservable.notifyObservers(mM),w(mM),this.logClose(),K.then((()=>mM))}_loadVertexDataAsync(M,Z,P){const x=this._extensionsLoadVertexDataAsync(M,Z,P);if(x)return x;const c=Z.attributes;if(!c)throw new Error(`${M}: Attributes are missing`);const w=new Array,v=new D.d(P.name,this._babylonScene);if(void 0==Z.indices)P.isUnIndexed=!0;else{const P=a.Get(`${M}/indices`,this._gltf.accessors,Z.indices);w.push(this._loadIndicesAccessorAsync(`/accessors/${P.index}`,P).then((M=>{v.setIndices(M)})))}const G=(Z,x,G)=>{if(void 0==c[Z])return;P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(x)&&P._delayInfo.push(x);const mM=a.Get(`${M}/attributes/${Z}`,this._gltf.accessors,c[Z]);w.push(this._loadVertexAccessorAsync(`/accessors/${mM.index}`,mM,x).then((M=>{if(M.getKind()===F.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!P.skeleton){const M=y(mM);M&&(v._boundingInfo=M,v.useBoundingInfoFromGeometry=!0)}v.setVerticesBuffer(M,mM.count)}))),x==F.g.MatricesIndicesExtraKind&&(P.numBoneInfluencers=8),G&&G(mM)};return G("POSITION",F.g.PositionKind),G("NORMAL",F.g.NormalKind),G("TANGENT",F.g.TangentKind),G("TEXCOORD_0",F.g.UVKind),G("TEXCOORD_1",F.g.UV2Kind),G("TEXCOORD_2",F.g.UV3Kind),G("TEXCOORD_3",F.g.UV4Kind),G("TEXCOORD_4",F.g.UV5Kind),G("TEXCOORD_5",F.g.UV6Kind),G("JOINTS_0",F.g.MatricesIndicesKind),G("WEIGHTS_0",F.g.MatricesWeightsKind),G("JOINTS_1",F.g.MatricesIndicesExtraKind),G("WEIGHTS_1",F.g.MatricesWeightsExtraKind),G("COLOR_0",F.g.ColorKind,(M=>{"VEC4"===M.type&&(P.hasVertexAlpha=!0)})),Promise.all(w).then((()=>v))}_createMorphTargets(M,Z,P,x,c){if(!x.targets||!this._parent.loadMorphTargets)return;if(void 0==Z._numMorphTargets)Z._numMorphTargets=x.targets.length;else if(x.targets.length!==Z._numMorphTargets)throw new Error(`${M}: Primitives do not have the same number of targets`);const w=P.extras?P.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,c.morphTargetManager=new C(this._babylonScene),c.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.morphTargetManager.areUpdatesFrozen=!0;for(let v=0;v<x.targets.length;v++){const M=Z.weights?Z.weights[v]:P.weights?P.weights[v]:0,x=w?w[v]:`morphTarget${v}`;c.morphTargetManager.addTarget(new Q.c(x,M,c.DM()))}}_loadMorphTargetsAsync(M,Z,P,x){if(!Z.targets||!this._parent.loadMorphTargets)return Promise.resolve();const c=new Array,w=P.morphTargetManager;for(let v=0;v<w.numTargets;v++){const P=w.getTarget(v);c.push(this._loadMorphTargetVertexDataAsync(`${M}/targets/${v}`,x,Z.targets[v],P))}return Promise.all(c).then((()=>{w.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(M,Z,P,x){const c=new Array,w=(x,w,v)=>{if(void 0==P[x])return;const G=Z.getVertexBuffer(w);if(!G)return;const mM=a.Get(`${M}/${x}`,this._gltf.accessors,P[x]);c.push(this._loadFloatAccessorAsync(`/accessors/${mM.index}`,mM).then((M=>{v(G,M)})))};return w("POSITION",F.g.PositionKind,((M,Z)=>{const P=new Float32Array(Z.length);M.forEach(Z.length,((M,x)=>{P[x]=Z[x]+M})),x.setPositions(P)})),w("NORMAL",F.g.NormalKind,((M,Z)=>{const P=new Float32Array(Z.length);M.forEach(P.length,((M,x)=>{P[x]=Z[x]+M})),x.setNormals(P)})),w("TANGENT",F.g.TangentKind,((M,Z)=>{const P=new Float32Array(Z.length/3*4);let c=0;M.forEach(Z.length/3*4,((M,x)=>{(x+1)%4!==0&&(P[c]=Z[c]+M,c++)})),x.setTangents(P)})),w("TEXCOORD_0",F.g.UVKind,((M,Z)=>{const P=new Float32Array(Z.length);M.forEach(Z.length,((M,x)=>{P[x]=Z[x]+M})),x.setUVs(P)})),w("TEXCOORD_1",F.g.UV2Kind,((M,Z)=>{const P=new Float32Array(Z.length);M.forEach(Z.length,((M,x)=>{P[x]=Z[x]+M})),x.setUV2s(P)})),w("COLOR_0",F.g.ColorKind,((Z,P)=>{let c=null;const w=Z.getSize();if(3===w){c=new Float32Array(P.length/3*4),Z.forEach(P.length,((M,Z)=>{const x=Math.floor(Z/3),w=Z%3;c[4*x+w]=P[3*x+w]+M}));for(let M=0;M<P.length/3;++M)c[4*M+3]=1}else{if(4!==w)throw new Error(`${M}: Invalid number of components (${w}) for COLOR_0 attribute`);c=new Float32Array(P.length),Z.forEach(P.length,((M,Z)=>{c[Z]=P[Z]+M}))}x.setColors(c)})),await Promise.all(c).then((()=>{}))}static _LoadTransform(M,Z){if(void 0!=M.skin)return;let P=c.BZ.Zero(),x=c.Quaternion.Identity(),w=c.BZ.One();if(M.matrix){c.Matrix.NZ(M.matrix).decompose(w,x,P)}else M.translation&&(P=c.BZ.NZ(M.translation)),M.rotation&&(x=c.Quaternion.NZ(M.rotation)),M.scale&&(w=c.BZ.NZ(M.scale));Z.position=P,Z.rotationQuaternion=x,Z.hc=w}_loadSkinAsync(M,Z,P,x){if(!this._parent.loadSkins)return Promise.resolve();const c=this._extensionsLoadSkinAsync(M,Z,P);if(c)return c;if(P._data)return x(P._data.babylonSkeleton),P._data.promise;const w=`skeleton${P.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new L(P.name||w,w,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(M,P,v);const G=this._loadSkinInverseBindMatricesDataAsync(M,P).then((M=>{this._updateBoneMatrices(v,M)}));return P._data={babylonSkeleton:v,promise:G},x(v),G}_loadBones(M,Z,P){if(void 0==Z.skeleton||this._parent.alwaysComputeSkeletonRootNode){const P=this._findSkeletonRootNode(`${M}/joints`,Z.joints);if(P)if(void 0===Z.skeleton)Z.skeleton=P.index;else{const x=(M,Z)=>{for(;Z.parent;Z=Z.parent)if(Z.parent===M)return!0;return!1},c=a.Get(`${M}/skeleton`,this._gltf.nodes,Z.skeleton);c===P||x(c,P)||(U.d.Warn(`${M}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),Z.skeleton=P.index)}else U.d.Warn(`${M}: Failed to find common root`)}const x={};for(const c of Z.joints){const w=a.Get(`${M}/joints/${c}`,this._gltf.nodes,c);this._loadBone(w,Z,P,x)}}_findSkeletonRootNode(M,Z){if(0===Z.length)return null;const P={};for(const c of Z){const Z=[];let x=a.Get(`${M}/${c}`,this._gltf.nodes,c);for(;-1!==x.index;)Z.unshift(x),x=x.parent;P[c]=Z}let x=null;for(let c=0;;++c){let M=P[Z[0]];if(c>=M.length)return x;const w=M[c];for(let v=1;v<Z.length;++v)if(M=P[Z[v]],c>=M.length||w!==M[c])return x;x=w}}_loadBone(M,Z,P,x){M._isJoint=!0;let c=x[M.index];if(c)return c;let w=null;M.index!==Z.skeleton&&(M.parent&&-1!==M.parent.index?w=this._loadBone(M.parent,Z,P,x):void 0!==Z.skeleton&&U.d.Warn(`/skins/${Z.index}/skeleton: Skeleton node is not a common root`));const v=Z.joints.indexOf(M.index);return c=new K.e(M.name||`joint${M.index}`,P,w,this._getNodeMatrix(M),null,null,v),x[M.index]=c,this._postSceneLoadActions.push((()=>{c.linkTransformNode(M._babylonTransformNode)})),c}_loadSkinInverseBindMatricesDataAsync(M,Z){if(void 0==Z.inverseBindMatrices)return Promise.resolve(null);const P=a.Get(`${M}/inverseBindMatrices`,this._gltf.accessors,Z.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${P.index}`,P)}_updateBoneMatrices(M,Z){for(const P of M.bones){const M=c.Matrix.Identity(),x=P._index;Z&&-1!==x&&(c.Matrix.FromArrayToRef(Z,16*x,M),M.invertToRef(M));const w=P.getParent();w&&M.multiplyToRef(w.getAbsoluteInverseBindMatrix(),M),P.Nc(M,!1,!1),P._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(M){return M.matrix?c.Matrix.NZ(M.matrix):c.Matrix.Compose(M.scale?c.BZ.NZ(M.scale):c.BZ.One(),M.rotation?c.Quaternion.NZ(M.rotation):c.Quaternion.Identity(),M.translation?c.BZ.NZ(M.translation):c.BZ.Zero())}loadCameraAsync(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadCameraAsync(M,Z,P);if(x)return x;const w=new Array;this.logOpen(`${M} ${Z.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new mM.e(Z.name||`camera${Z.index}`,c.BZ.Zero(),this._babylonScene,!1);switch(v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._babylonCamera=v,v.setTarget(new c.BZ(0,0,-1)),Z.type){case"perspective":{const P=Z.perspective;if(!P)throw new Error(`${M}: Camera perspective properties are missing`);v.fov=P.yfov,v.uc=P.znear,v.maxZ=P.zfar||0;break}case"orthographic":if(!Z.orthographic)throw new Error(`${M}: Camera orthographic properties are missing`);v.mode=G.e.ORTHOGRAPHIC_CAMERA,v.orthoLeft=-Z.orthographic.xmag,v.orthoRight=Z.orthographic.xmag,v.orthoBottom=-Z.orthographic.ymag,v.orthoTop=Z.orthographic.ymag,v.uc=Z.orthographic.znear,v.maxZ=Z.orthographic.zfar;break;default:throw new Error(`${M}: Invalid camera type (${Z.type})`)}return f.AddPointerMetadata(v,M),this._parent.onCameraLoadedObservable.notifyObservers(v),P(v),this.logClose(),Promise.all(w).then((()=>v))}_loadAnimationsAsync(){const M=this._gltf.animations;if(!M)return Promise.resolve();const Z=new Array;for(let P=0;P<M.length;P++){const x=M[P];Z.push(this.loadAnimationAsync(`/animations/${x.index}`,x).then((M=>{0===M.targetedAnimations.length&&M.dispose()})))}return Promise.all(Z).then((()=>{}))}loadAnimationAsync(M,Z){const x=this._extensionsLoadAnimationAsync(M,Z);return x||P.e(78).then(P.bind(P,15547)).then((P=>{let{AnimationGroup:x}=P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new x(Z.name||`animation${Z.index}`,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._babylonAnimationGroup=c;const w=new Array;a.Assign(Z.channels),a.Assign(Z.samplers);for(const v of Z.channels)w.push(this._loadAnimationChannelAsync(`${M}/channels/${v.index}`,M,Z,v,((M,Z)=>{M.animations=M.animations||[],M.animations.push(Z),c.addTargetedAnimation(Z,M)})));return Promise.all(w).then((()=>(c.normalize(0),c)))}))}async _loadAnimationChannelAsync(M,Z,x,c,w){const v=this._extensionsLoadAnimationChannelAsync(M,Z,x,c,w);if(v)return await v;if(void 0==c.target.node)return await Promise.resolve();const G=a.Get(`${M}/target/node`,this._gltf.nodes,c.target.node),mM=c.target.path,K="weights"===mM;if(K&&!G._numMorphTargets||!K&&!G._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!K&&!G._isJoint)return await Promise.resolve();let d;switch(await Promise.resolve().then(P.bind(P,14019)),mM){case"translation":var O;d=null===(O=(0,q.f)("/nodes/{}/translation"))||void 0===O?void 0:O.interpolation;break;case"rotation":var H;d=null===(H=(0,q.f)("/nodes/{}/rotation"))||void 0===H?void 0:H.interpolation;break;case"scale":var j;d=null===(j=(0,q.f)("/nodes/{}/scale"))||void 0===j?void 0:j.interpolation;break;case"weights":var B;d=null===(B=(0,q.f)("/nodes/{}/weights"))||void 0===B?void 0:B.interpolation;break;default:throw new Error(`${M}/target/path: Invalid value (${c.target.path})`)}if(!d)throw new Error(`${M}/target/path: Could not find interpolation properties for target path (${c.target.path})`);const U={object:G,info:d};return await this._loadAnimationChannelFromTargetInfoAsync(M,Z,x,c,U,w)}_loadAnimationChannelFromTargetInfoAsync(M,Z,P,x,c,w){const v=this.parent.targetFps,G=1/v,mM=a.Get(`${M}/sampler`,P.samplers,x.sampler);return this._loadAnimationSamplerAsync(`${Z}/samplers/${x.sampler}`,mM).then((M=>{let Z=0;const mM=c.object,K=c.info;for(const c of K){const K=c.getStride(mM),d=M.input,O=M.output,H=new Array(d.length);let j=0;switch(M.interpolation){case"STEP":for(let M=0;M<d.length;M++){const Z=c.getValue(mM,O,j,1);j+=K,H[M]={frame:d[M]*v,value:Z,interpolation:1}}break;case"CUBICSPLINE":for(let M=0;M<d.length;M++){const Z=c.getValue(mM,O,j,G);j+=K;const P=c.getValue(mM,O,j,1);j+=K;const x=c.getValue(mM,O,j,G);j+=K,H[M]={frame:d[M]*v,inTangent:Z,value:P,outTangent:x}}break;case"LINEAR":for(let M=0;M<d.length;M++){const Z=c.getValue(mM,O,j,1);j+=K,H[M]={frame:d[M]*v,value:Z}}}if(j>0){const M=`${P.name||`animation${P.index}`}_channel${x.index}_${Z}`,G=c.buildAnimations(mM,M,v,H);for(const P of G)Z++,w(P.babylonAnimatable,P.babylonAnimation)}}}))}_loadAnimationSamplerAsync(M,Z){if(Z._data)return Z._data;const P=Z.interpolation||"LINEAR";switch(P){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${M}/interpolation: Invalid value (${Z.interpolation})`)}const x=a.Get(`${M}/input`,this._gltf.accessors,Z.input),c=a.Get(`${M}/output`,this._gltf.accessors,Z.output);return Z._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${x.index}`,x),this._loadFloatAccessorAsync(`/accessors/${c.index}`,c)]).then((M=>{let[Z,x]=M;return{input:Z,interpolation:P,output:x}})),Z._data}loadBufferAsync(M,Z,P,x){const c=this._extensionsLoadBufferAsync(M,Z,P,x);if(c)return c;if(!Z._data)if(Z.uri)Z._data=this.loadUriAsync(`${M}/uri`,Z,Z.uri);else{if(!this._bin)throw new Error(`${M}: Uri is missing or the binary glTF is missing its binary chunk`);Z._data=this._bin.readAsync(0,Z.byteLength)}return Z._data.then((Z=>{try{return new Uint8Array(Z.buffer,Z.byteOffset+P,x)}catch(c){throw new Error(`${M}: ${c.message}`)}}))}loadBufferViewAsync(M,Z){const P=this._extensionsLoadBufferViewAsync(M,Z);if(P)return P;if(Z._data)return Z._data;const x=a.Get(`${M}/buffer`,this._gltf.buffers,Z.buffer);return Z._data=this.loadBufferAsync(`/buffers/${x.index}`,x,Z.byteOffset||0,Z.byteLength),Z._data}_loadAccessorAsync(M,Z,P){if(Z._data)return Z._data;const x=f._GetNumComponents(M,Z.type),c=x*F.g.GetTypeByteLength(Z.componentType),w=x*Z.count;if(void 0==Z.bufferView)Z._data=Promise.resolve(new P(w));else{const v=a.Get(`${M}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((G=>{if(5126!==Z.componentType||Z.normalized||v.byteStride&&v.byteStride!==c){const M=new P(w);return F.g.ForEach(G,Z.byteOffset||0,v.byteStride||c,x,Z.componentType,M.length,Z.normalized||!1,((Z,P)=>{M[P]=Z})),M}return f._GetTypedArray(M,Z.componentType,G,Z.byteOffset,w)}))}if(Z.sparse){const w=Z.sparse;Z._data=Z._data.then((v=>{const G=v,mM=a.Get(`${M}/sparse/indices/bufferView`,this._gltf.bufferViews,w.indices.bufferView),K=a.Get(`${M}/sparse/values/bufferView`,this._gltf.bufferViews,w.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${mM.index}`,mM),this.loadBufferViewAsync(`/bufferViews/${K.index}`,K)]).then((v=>{let[mM,K]=v;const d=f._GetTypedArray(`${M}/sparse/indices`,w.indices.componentType,mM,w.indices.byteOffset,w.count),O=x*w.count;let H;if(5126!==Z.componentType||Z.normalized){const v=f._GetTypedArray(`${M}/sparse/values`,Z.componentType,K,w.values.byteOffset,O);H=new P(O),F.g.ForEach(v,0,c,x,Z.componentType,H.length,Z.normalized||!1,((M,Z)=>{H[Z]=M}))}else H=f._GetTypedArray(`${M}/sparse/values`,Z.componentType,K,w.values.byteOffset,O);let j=0;for(let M=0;M<d.length;M++){let Z=d[M]*x;for(let M=0;M<x;M++)G[Z++]=H[j++]}return G}))}))}return Z._data}_loadFloatAccessorAsync(M,Z){return this._loadAccessorAsync(M,Z,Float32Array)}_loadIndicesAccessorAsync(M,Z){if("SCALAR"!==Z.type)throw new Error(`${M}/type: Invalid value ${Z.type}`);if(5121!==Z.componentType&&5123!==Z.componentType&&5125!==Z.componentType)throw new Error(`${M}/componentType: Invalid value ${Z.componentType}`);if(Z._data)return Z._data;if(Z.sparse){const P=f._GetTypedArrayConstructor(`${M}/componentType`,Z.componentType);Z._data=this._loadAccessorAsync(M,Z,P)}else{const P=a.Get(`${M}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((P=>f._GetTypedArray(M,Z.componentType,P,Z.byteOffset,Z.count)))}return Z._data}_loadVertexBufferViewAsync(M){if(M._babylonBuffer)return M._babylonBuffer;const Z=this._babylonScene.getEngine();return M._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((M=>new F.c(Z,M,!1))),M._babylonBuffer}_loadVertexAccessorAsync(M,Z,P){var x;if(null!==(x=Z._babylonVertexBuffer)&&void 0!==x&&x[P])return Z._babylonVertexBuffer[P];Z._babylonVertexBuffer||(Z._babylonVertexBuffer={});const c=this._babylonScene.getEngine();if(Z.sparse||void 0==Z.bufferView)Z._babylonVertexBuffer[P]=this._loadFloatAccessorAsync(M,Z).then((M=>new F.g(c,M,P,!1)));else{const x=a.Get(`${M}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._babylonVertexBuffer[P]=this._loadVertexBufferViewAsync(x).then((w=>{const v=f._GetNumComponents(M,Z.type);return new F.g(c,w,P,!1,void 0,x.byteStride,void 0,Z.byteOffset,v,Z.componentType,Z.normalized,!0,void 0,!0)}))}return Z._babylonVertexBuffer[P]}_loadMaterialMetallicRoughnessPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return Z&&(Z.baseColorFactor?(P.albedoColor=w.uZ.NZ(Z.baseColorFactor),P.alpha=Z.baseColorFactor[3]):P.albedoColor=w.uZ.White(),P.metallic=void 0==Z.metallicFactor?1:Z.metallicFactor,P.roughness=void 0==Z.roughnessFactor?1:Z.roughnessFactor,Z.baseColorTexture&&x.push(this.loadTextureInfoAsync(`${M}/baseColorTexture`,Z.baseColorTexture,(M=>{M.name=`${P.name} (Base Color)`,P.albedoTexture=M}))),Z.metallicRoughnessTexture&&(Z.metallicRoughnessTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${M}/metallicRoughnessTexture`,Z.metallicRoughnessTexture,(M=>{M.name=`${P.name} (Metallic Roughness)`,P.metallicTexture=M}))),P.useMetallnessFromMetallicTextureBlue=!0,P.useRoughnessFromMetallicTextureGreen=!0,P.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(x).then((()=>{}))}_loadMaterialAsync(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const w=this._extensionsLoadMaterialAsync(M,Z,P,x,c);if(w)return w;Z._data=Z._data||{};let v=Z._data[x];if(!v){this.logOpen(`${M} ${Z.name||""}`);const P=this.createMaterial(M,Z,x);v={babylonMaterial:P,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(M,Z,P)},Z._data[x]=v,f.AddPointerMetadata(P,M),this._parent.onMaterialLoadedObservable.notifyObservers(P),this.logClose()}return P&&(v.babylonMeshes.push(P),P.Gc.addOnce((()=>{const M=v.babylonMeshes.indexOf(P);-1!==M&&v.babylonMeshes.splice(M,1)}))),c(v.babylonMaterial),v.promise.then((()=>v.babylonMaterial))}_createDefaultMaterial(M,Z){this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new N.d(M,this._babylonScene);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.fillMode=Z,P.enableSpecularAntiAliasing=!0,P.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,P.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,P.transparencyMode=N.d.PBRMATERIAL_OPAQUE,P.metallic=1,P.roughness=1,P}createMaterial(M,Z,P){const x=this._extensionsCreateMaterial(M,Z,P);if(x)return x;const c=Z.name||`material${Z.index}`;return this._createDefaultMaterial(c,P)}loadMaterialPropertiesAsync(M,Z,P){const x=this._extensionsLoadMaterialPropertiesAsync(M,Z,P);if(x)return x;const c=new Array;return c.push(this.loadMaterialBasePropertiesAsync(M,Z,P)),Z.pbrMetallicRoughness&&c.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${M}/pbrMetallicRoughness`,Z.pbrMetallicRoughness,P)),this.loadMaterialAlphaProperties(M,Z,P),Promise.all(c).then((()=>{}))}loadMaterialBasePropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return P.emissiveColor=Z.emissiveFactor?w.uZ.NZ(Z.emissiveFactor):new w.uZ(0,0,0),Z.doubleSided&&(P.Dc=!1,P.twoSidedLighting=!0),Z.normalTexture&&(Z.normalTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${M}/normalTexture`,Z.normalTexture,(M=>{M.name=`${P.name} (Normal)`,P.bumpTexture=M}))),P.invertNormalMapX=!this._babylonScene.useRightHandedSystem,P.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=Z.normalTexture.scale&&P.bumpTexture&&(P.bumpTexture.level=Z.normalTexture.scale),P.forceIrradianceInFragment=!0),Z.occlusionTexture&&(Z.occlusionTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${M}/occlusionTexture`,Z.occlusionTexture,(M=>{M.name=`${P.name} (Occlusion)`,P.ambientTexture=M}))),P.useAmbientInGrayScale=!0,void 0!=Z.occlusionTexture.strength&&(P.ambientTextureStrength=Z.occlusionTexture.strength)),Z.emissiveTexture&&x.push(this.loadTextureInfoAsync(`${M}/emissiveTexture`,Z.emissiveTexture,(M=>{M.name=`${P.name} (Emissive)`,P.emissiveTexture=M}))),Promise.all(x).then((()=>{}))}loadMaterialAlphaProperties(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);switch(Z.alphaMode||"OPAQUE"){case"OPAQUE":P.transparencyMode=N.d.PBRMATERIAL_OPAQUE,P.alpha=1;break;case"MASK":P.transparencyMode=N.d.PBRMATERIAL_ALPHATEST,P.alphaCutOff=void 0==Z.alphaCutoff?.5:Z.alphaCutoff,P.albedoTexture&&(P.albedoTexture.Lc=!0);break;case"BLEND":P.transparencyMode=N.d.PBRMATERIAL_ALPHABLEND,P.albedoTexture&&(P.albedoTexture.Lc=!0,P.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${M}/alphaMode: Invalid value (${Z.alphaMode})`)}}loadTextureInfoAsync(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadTextureInfoAsync(M,Z,P);if(x)return x;if(this.logOpen(`${M}`),Z.texCoord>=6)throw new Error(`${M}/texCoord: Invalid value (${Z.texCoord})`);const c=a.Get(`${M}/index`,this._gltf.textures,Z.index);c._textureInfo=Z;const w=this._loadTextureAsync(`/textures/${Z.index}`,c,(x=>{x.coordinatesIndex=Z.texCoord||0,f.AddPointerMetadata(x,M),this._parent.onTextureLoadedObservable.notifyObservers(x),P(x)}));return this.logClose(),w}_loadTextureAsync(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadTextureAsync(M,Z,P);if(x)return x;this.logOpen(`${M} ${Z.name||""}`);const c=void 0==Z.sampler?f.DefaultSampler:a.Get(`${M}/sampler`,this._gltf.samplers,Z.sampler),w=a.Get(`${M}/source`,this._gltf.images,Z.source),v=this._createTextureAsync(M,c,w,P,void 0,!Z._textureInfo.nonColorData);return this.logClose(),v}_createTextureAsync(M,Z,P){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},w=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0;const G=this._loadSampler(`/samplers/${Z.index}`,Z),mM=new Array,K=new x;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d={noMipmap:G.noMipMaps,invertY:!1,samplingMode:G.samplingMode,S:()=>{this._disposed||K.resolve()},onError:(Z,P)=>{this._disposed||K.reject(new Error(`${M}: ${P&&P.message?P.message:Z||"Failed to load texture"}`))},mimeType:P.mimeType??(0,W.j)(P.uri??""),loaderOptions:w,useSRGBBuffer:!!v&&this._parent.useSRGBBuffers},O=new J.e(null,this._babylonScene,d);return O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,mM.push(K.promise),mM.push(this.loadImageAsync(`/images/${P.index}`,P).then((M=>{const Z=P.uri||`${this._fileName}#image${P.index}`,x=`data:${this._uniqueRootUrl}${Z}`;O.updateURL(x,M);const c=O.getInternalTexture();c&&(c.label=P.name)}))),O.wrapU=G.wrapU,O.wrapV=G.wrapV,c(O),this._parent.useGltfTextureNames&&(O.name=P.name||P.uri||`image${P.index}`),Promise.all(mM).then((()=>O))}_loadSampler(M,Z){return Z._data||(Z._data={noMipMaps:9728===Z.minFilter||9729===Z.minFilter,samplingMode:f._GetTextureSamplingMode(M,Z),wrapU:f._GetTextureWrapMode(`${M}/wrapS`,Z.wrapS),wrapV:f._GetTextureWrapMode(`${M}/wrapT`,Z.wrapT)}),Z._data}loadImageAsync(M,Z){if(!Z._data){if(this.logOpen(`${M} ${Z.name||""}`),Z.uri)Z._data=this.loadUriAsync(`${M}/uri`,Z,Z.uri);else{const P=a.Get(`${M}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}this.logClose()}return Z._data}loadUriAsync(M,Z,P){const x=this._extensionsLoadUriAsync(M,Z,P);if(x)return x;if(!f._ValidateUri(P))throw new Error(`${M}: '${P}' is invalid`);if((0,W.k)(P)){const Z=new Uint8Array((0,W.e)(P));return this.log(`${M}: Decoded ${P.substring(0,64)}... (${Z.length} bytes)`),Promise.resolve(Z)}return this.log(`${M}: Loading ${P}`),this._parent.preprocessUrlAsync(this._rootUrl+P).then((Z=>new Promise(((x,c)=>{this._parent._loadFile(this._babylonScene,Z,(Z=>{this._disposed||(this.log(`${M}: Loaded ${P} (${Z.byteLength} bytes)`),x(new Uint8Array(Z)))}),!0,(Z=>{c(new W.m(`${M}: Failed to load '${P}'${Z?": "+Z.status+" "+Z.statusText:""}`,Z))}))}))))}static AddPointerMetadata(M,Z){M.metadata=M.metadata||{};const P=M._internalMetadata=M._internalMetadata||{},x=P.jc=P.jc||{};(x.pointers=x.pointers||[]).push(Z)}static _GetTextureWrapMode(M,Z){switch(Z=void 0==Z?10497:Z){case 33071:return J.e.CLAMP_ADDRESSMODE;case 33648:return J.e.MIRROR_ADDRESSMODE;case 10497:return J.e.WRAP_ADDRESSMODE;default:return U.d.Warn(`${M}: Invalid value (${Z})`),J.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(M,Z){const P=void 0==Z.magFilter?9729:Z.magFilter,x=void 0==Z.minFilter?9987:Z.minFilter;if(9729===P)switch(x){case 9728:return J.e.LINEAR_NEAREST;case 9729:return J.e.LINEAR_LINEAR;case 9984:return J.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return J.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return J.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return J.e.LINEAR_LINEAR_MIPLINEAR;default:return U.d.Warn(`${M}/minFilter: Invalid value (${x})`),J.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==P&&U.d.Warn(`${M}/magFilter: Invalid value (${P})`),x){case 9728:return J.e.NEAREST_NEAREST;case 9729:return J.e.NEAREST_LINEAR;case 9984:return J.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return J.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return J.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return J.e.NEAREST_LINEAR_MIPLINEAR;default:return U.d.Warn(`${M}/minFilter: Invalid value (${x})`),J.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(M,Z){try{return(0,b.s)(Z)}catch(P){throw new Error(`${M}: ${P.message}`)}}static _GetTypedArray(M,Z,P,x,c){const w=P.buffer;x=P.byteOffset+(x||0);const v=f._GetTypedArrayConstructor(`${M}/componentType`,Z),G=F.g.GetTypeByteLength(Z);return x%G!==0?(U.d.Warn(`${M}: Copying buffer as byte offset (${x}) is not a multiple of component type byte length (${G})`),new v(w.slice(x,x+c*G),0)):new v(w,x,c)}static _GetNumComponents(M,Z){switch(Z){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${M}: Invalid type (${Z})`)}static _ValidateUri(M){return v.Tools.IsBase64(M)||-1===M.indexOf("..")}static _GetDrawMode(M,Z){switch(void 0==Z&&(Z=4),Z){case 0:return u.d.PointListDrawMode;case 1:return u.d.LineListDrawMode;case 2:return u.d.LineLoopDrawMode;case 3:return u.d.LineStripDrawMode;case 4:return u.d.TriangleFillMode;case 5:return u.d.TriangleStripDrawMode;case 6:return u.d.TriangleFanDrawMode}throw new Error(`${M}: Invalid mesh primitive mode (${Z})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const M=new Array;if(this._gltf.materials)for(const Z of this._gltf.materials)if(Z._data)for(const P in Z._data){const x=Z._data[P];for(const Z of x.babylonMeshes){Z.Jc(!0);const P=x.babylonMaterial;M.push(P.forceCompilationAsync(Z)),M.push(P.forceCompilationAsync(Z,{useInstances:!0})),this._parent.useClipPlane&&(M.push(P.forceCompilationAsync(Z,{clipPlane:!0})),M.push(P.forceCompilationAsync(Z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const M=new Array,Z=this._babylonScene.lights;for(const P of Z){const Z=P.getShadowGenerator();Z&&M.push(Z.forceCompilationAsync())}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(M){for(const Z of this._extensions)Z.enabled&&M(Z)}_applyExtensions(M,Z,P){for(const x of this._extensions)if(x.enabled){const c=`${x.name}.${Z}`,w=M;w._activeLoaderExtensionFunctions=w._activeLoaderExtensionFunctions||{};const v=w._activeLoaderExtensionFunctions;if(!v[c]){v[c]=!0;try{const M=P(x);if(M)return M}finally{delete v[c]}}}return null}_extensionsOnLoading(){this._forEachExtensions((M=>M.onLoading&&M.onLoading()))}_extensionsOnReady(){this._forEachExtensions((M=>M.onReady&&M.onReady()))}_extensionsLoadSceneAsync(M,Z){return this._applyExtensions(Z,"loadScene",(P=>P.loadSceneAsync&&P.loadSceneAsync(M,Z)))}_extensionsLoadNodeAsync(M,Z,P){return this._applyExtensions(Z,"loadNode",(x=>x.loadNodeAsync&&x.loadNodeAsync(M,Z,P)))}_extensionsLoadCameraAsync(M,Z,P){return this._applyExtensions(Z,"loadCamera",(x=>x.loadCameraAsync&&x.loadCameraAsync(M,Z,P)))}_extensionsLoadVertexDataAsync(M,Z,P){return this._applyExtensions(Z,"loadVertexData",(x=>x._loadVertexDataAsync&&x._loadVertexDataAsync(M,Z,P)))}_extensionsLoadMeshPrimitiveAsync(M,Z,P,x,c,w){return this._applyExtensions(c,"loadMeshPrimitive",(v=>v._loadMeshPrimitiveAsync&&v._loadMeshPrimitiveAsync(M,Z,P,x,c,w)))}_extensionsLoadMaterialAsync(M,Z,P,x,c){return this._applyExtensions(Z,"loadMaterial",(w=>w._loadMaterialAsync&&w._loadMaterialAsync(M,Z,P,x,c)))}_extensionsCreateMaterial(M,Z,P){return this._applyExtensions(Z,"createMaterial",(x=>x.createMaterial&&x.createMaterial(M,Z,P)))}_extensionsLoadMaterialPropertiesAsync(M,Z,P){return this._applyExtensions(Z,"loadMaterialProperties",(x=>x.loadMaterialPropertiesAsync&&x.loadMaterialPropertiesAsync(M,Z,P)))}_extensionsLoadTextureInfoAsync(M,Z,P){return this._applyExtensions(Z,"loadTextureInfo",(x=>x.loadTextureInfoAsync&&x.loadTextureInfoAsync(M,Z,P)))}_extensionsLoadTextureAsync(M,Z,P){return this._applyExtensions(Z,"loadTexture",(x=>x._loadTextureAsync&&x._loadTextureAsync(M,Z,P)))}_extensionsLoadAnimationAsync(M,Z){return this._applyExtensions(Z,"loadAnimation",(P=>P.loadAnimationAsync&&P.loadAnimationAsync(M,Z)))}_extensionsLoadAnimationChannelAsync(M,Z,P,x,c){return this._applyExtensions(P,"loadAnimationChannel",(w=>w._loadAnimationChannelAsync&&w._loadAnimationChannelAsync(M,Z,P,x,c)))}_extensionsLoadSkinAsync(M,Z,P){return this._applyExtensions(P,"loadSkin",(x=>x._loadSkinAsync&&x._loadSkinAsync(M,Z,P)))}_extensionsLoadUriAsync(M,Z,P){return this._applyExtensions(Z,"loadUri",(x=>x._loadUriAsync&&x._loadUriAsync(M,Z,P)))}_extensionsLoadBufferViewAsync(M,Z){return this._applyExtensions(Z,"loadBufferView",(P=>P.loadBufferViewAsync&&P.loadBufferViewAsync(M,Z)))}_extensionsLoadBufferAsync(M,Z,P,x){return this._applyExtensions(Z,"loadBuffer",(c=>c.loadBufferAsync&&c.loadBufferAsync(M,Z,P,x)))}static LoadExtensionAsync(M,Z,P,x){if(!Z.extensions)return null;const c=Z.extensions[P];return c?x(`${M}/extensions/${P}`,c):null}static LoadExtraAsync(M,Z,P,x){if(!Z.extras)return null;const c=Z.extras[P];return c?x(`${M}/extras/${P}`,c):null}isExtensionUsed(M){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(M)}logOpen(M){this._parent._logOpen(M)}logClose(){this._parent._logClose()}log(M){this._parent._log(M)}startPerformanceCounter(M){this._parent._startPerformanceCounter(M)}endPerformanceCounter(M){this._parent._endPerformanceCounter(M)}}f.DefaultSampler={index:-1},R.e._CreateGLTF2Loader=M=>new f(M);var Y=P(14019),z=P(12549),i=P(12394),T=P(14028),p=P(14035);class S extends p.d{constructor(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,mM=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",M),this._texture=M.getEngine().createRawCubeTexture(Z,P,x,c,w,v,G,mM)}update(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,M,Z,P,x,c)}updateRGBDAsync(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,T.l)(this._texture,M,Z,P,x).then((()=>{}))}clone(){return i.b.Clone((()=>{const M=this.DM(),Z=this._texture,P=new S(M,Z._bufferViewArray,Z.width,Z.format,Z.type,Z.generateMipMaps,Z.invertY,Z.samplingMode,Z._compression);return 13===Z.source&&P.updateRGBDAsync(Z._bufferViewArrayArray,Z._sphericalPolynomial,Z._lodGenerationScale,Z._lodGenerationOffset),P}),this)}}const X="EXT_lights_image_based";class V{constructor(M){this.name=X,this._loader=M,this.enabled=this._loader.isExtensionUsed(X)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.jc.extensions;if(M&&M[this.name]){const Z=M[this.name];this._lights=Z.lights}}loadSceneAsync(M,Z){return f.LoadExtensionAsync(M,Z,this.name,(async(P,x)=>{this._loader._allMaterialsDirtyRequired=!0;const c=new Array;c.push(this._loader.loadSceneAsync(M,Z)),this._loader.logOpen(`${P}`);const w=a.Get(`${P}/light`,this._lights,x.Zc);return c.push(this._loadLightAsync(`/extensions/${this.name}/lights/${x.Zc}`,w).then((M=>{this._loader.babylonScene.environmentTexture=M}))),this._loader.logClose(),await Promise.all(c).then((()=>{}))}))}_loadLightAsync(M,Z){if(!Z._loaded){const P=new Array;this._loader.logOpen(`${M}`);const x=new Array(Z.specularImages.length);for(let c=0;c<Z.specularImages.length;c++){const w=Z.specularImages[c];x[c]=new Array(w.length);for(let Z=0;Z<w.length;Z++){const v=`${M}/specularImages/${c}/${Z}`;this._loader.logOpen(`${v}`);const G=w[Z],mM=a.Get(v,this._loader.jc.images,G);P.push(this._loader.loadImageAsync(`/images/${G}`,mM).then((M=>{x[c][Z]=M}))),this._loader.logClose()}}this._loader.logClose(),Z._loaded=Promise.all(P).then((async()=>{const P=new S(this._loader.babylonScene,null,Z.specularImageSize);if(P.name=Z.name||"environment",Z._babylonTexture=P,void 0!=Z.Rc&&(P.level=Z.Rc),Z.rotation){let M=c.Quaternion.NZ(Z.rotation);this._loader.babylonScene.useRightHandedSystem||(M=c.Quaternion.Inverse(M)),c.Matrix.FromQuaternionToRef(M,P.getReflectionTextureMatrix())}if(!Z.irradianceCoefficients)throw new Error(`${M}: Irradiance coefficients are missing`);const w=z.d.NZ(Z.irradianceCoefficients);w.scaleInPlace(Z.Rc),w.convertIrradianceToLambertianRadiance();const v=z.h.FromHarmonics(w),G=(x.length-1)/Math.log2(Z.specularImageSize);return await P.updateRGBDAsync(x,v,G)}))}return Z._loaded.then((()=>Z._babylonTexture))}}r(X),E(X,!0,(M=>new V(M)));P(12930);const g="EXT_mesh_gpu_instancing";class MM{constructor(M){this.name=g,this._loader=M,this.enabled=this._loader.isExtensionUsed(g)}dispose(){this._loader=null}loadNodeAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(M,x)=>{this._loader._disableInstancedMesh++;const w=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,P);if(this._loader._disableInstancedMesh--,!Z._primitiveBabylonMeshes)return await w;const v=new Array;let G=0;const mM=Z=>{if(void 0==x.attributes[Z])return void v.push(Promise.resolve(null));const P=a.Get(`${M}/attributes/${Z}`,this._loader.jc.accessors,x.attributes[Z]);if(v.push(this._loader._loadFloatAccessorAsync(`/accessors/${P.bufferView}`,P)),0===G)G=P.count;else if(G!==P.count)throw new Error(`${M}/attributes: Instance buffer accessors do not have the same count.`)};return mM("TRANSLATION"),mM("ROTATION"),mM("SCALE"),await w.then((async M=>{const[P,x,w]=await Promise.all(v),mM=new Float32Array(16*G);c.TmpVectors.BZ[0].lc(0,0,0),c.TmpVectors.Quaternion[0].lc(0,0,0,1),c.TmpVectors.BZ[1].lc(1,1,1);for(let Z=0;Z<G;++Z)P&&c.BZ.FromArrayToRef(P,3*Z,c.TmpVectors.BZ[0]),x&&c.Quaternion.FromArrayToRef(x,4*Z,c.TmpVectors.Quaternion[0]),w&&c.BZ.FromArrayToRef(w,3*Z,c.TmpVectors.BZ[1]),c.Matrix.ComposeToRef(c.TmpVectors.BZ[1],c.TmpVectors.Quaternion[0],c.TmpVectors.BZ[0],c.TmpVectors.Matrix[0]),c.TmpVectors.Matrix[0].copyToArray(mM,16*Z);for(const c of Z._primitiveBabylonMeshes)c.nH("matrix",mM,16,!0);return M}))}))}}r(g),E(g,!0,(M=>new MM(M)));let ZM=0,PM=null;class xM{static get Default(){return xM._Default||(xM._Default=new xM),xM._Default}constructor(){const M=xM.Configuration.decoder;this._decoderModulePromise=v.Tools.LoadBabylonScriptAsync(M.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(M,Z,P,x,c){await this._decoderModulePromise,0===ZM&&(MeshoptDecoder.useWorkers(1),ZM=1);const w=await MeshoptDecoder.decodeGltfBufferAsync(Z,P,M,x,c);return null!==PM&&clearTimeout(PM),PM=setTimeout((()=>{MeshoptDecoder.useWorkers(0),ZM=0,PM=null}),1e3),w}}xM.Configuration={decoder:{url:`${v.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},xM._Default=null;const cM="EXT_meshopt_compression";class wM{constructor(M){this.name=cM,this.enabled=M.isExtensionUsed(cM),this._loader=M}dispose(){this._loader=null}loadBufferViewAsync(M,Z){return f.LoadExtensionAsync(M,Z,this.name,(async(P,x)=>{const c=Z;if(c._meshOptData)return await c._meshOptData;const w=a.Get(`${M}/buffer`,this._loader.jc.buffers,x.buffer);return c._meshOptData=this._loader.loadBufferAsync(`/buffers/${w.index}`,w,x.byteOffset||0,x.byteLength).then((async M=>await xM.Default.decodeGltfBufferAsync(M,x.count,x.byteStride,x.mode,x.filter))),await c._meshOptData}))}}r(cM),E(cM,!0,(M=>new wM(M)));const vM="EXT_texture_webp";class GM{constructor(M){this.name=vM,this._loader=M,this.enabled=M.isExtensionUsed(vM)}dispose(){this._loader=null}_loadTextureAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=void 0==Z.sampler?f.DefaultSampler:a.Get(`${M}/sampler`,this._loader.jc.samplers,Z.sampler),v=a.Get(`${x}/source`,this._loader.jc.images,c.source);return await this._loader._createTextureAsync(M,w,v,(M=>{P(M)}),void 0,!Z._textureInfo.nonColorData)}))}}r(vM),E(vM,!0,(M=>new GM(M)));const mZ="EXT_texture_avif";class KM{constructor(M){this.name=mZ,this._loader=M,this.enabled=M.isExtensionUsed(mZ)}dispose(){this._loader=null}_loadTextureAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=void 0==Z.sampler?f.DefaultSampler:a.Get(`${M}/sampler`,this._loader.jc.samplers,Z.sampler),v=a.Get(`${x}/source`,this._loader.jc.images,c.source);return await this._loader._createTextureAsync(M,w,v,(M=>{P(M)}),void 0,!Z._textureInfo.nonColorData)}))}}r(mZ),E(mZ,!0,(M=>new KM(M)));var dM=P(14015),OM=P(12902);const HM="EXT_lights_ies";class jM{constructor(M){this.name=HM,this._loader=M,this.enabled=this._loader.isExtensionUsed(HM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.jc.extensions;if(M&&M[this.name]){const Z=M[this.name];this._lights=Z.lights,a.Assign(this._lights)}}loadNodeAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,v)=>{let G,mM;this._loader._allMaterialsDirtyRequired=!0;const K=await this._loader.loadNodeAsync(M,Z,(M=>{mM=a.Get(x,this._lights,v.Zc);const Z=mM.name||M.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,G=new dM.c(Z,c.BZ.Zero(),c.BZ.Backward(),0,1,this._loader.babylonScene),G.angle=Math.PI/2,G.innerAngle=0,G._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,mM._babylonLight=G,G.falloffType=OM.d.FALLOFF_GLTF,G.Wc=v.color?w.uZ.NZ(v.color):w.uZ.White(),G.Rc=v.multiplier||1,G.range=Number.MAX_VALUE,G.parent=M,this._loader._babylonLights.push(G),f.AddPointerMetadata(G,x),P(M)}));let d;if(mM.uri)d=await this._loader.loadUriAsync(M,mM,mM.uri);else{const Z=a.Get(`${M}/bufferView`,this._loader.jc.bufferViews,mM.bufferView);d=await this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}return G.iesProfileTexture=new J.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,d,!0,void 0,void 0,void 0,void 0,".ies"),K}))}}r(HM),E(HM,!0,(M=>new jM(M)));var BM=P(14042);const UM="KHR_draco_mesh_compression";class nM{constructor(M){this.name=UM,this.useNormalizedFlagFromAccessor=!0,this._loader=M,this.enabled=BM.b.DefaultAvailable&&this._loader.isExtensionUsed(UM)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{if(void 0!=Z.mode&&4!==Z.mode&&5!==Z.mode)throw new Error(`${M}: Unsupported mode ${Z.mode}`);const w={},v={},G=(M,x)=>{const G=c.attributes[M];if(void 0!=G&&(P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(x)&&P._delayInfo.push(x),w[x]=G,this.useNormalizedFlagFromAccessor)){const P=a.TryGet(this._loader.jc.accessors,Z.attributes[M]);P&&(v[x]=P.normalized||!1)}};G("POSITION",F.g.PositionKind),G("NORMAL",F.g.NormalKind),G("TANGENT",F.g.TangentKind),G("TEXCOORD_0",F.g.UVKind),G("TEXCOORD_1",F.g.UV2Kind),G("TEXCOORD_2",F.g.UV3Kind),G("TEXCOORD_3",F.g.UV4Kind),G("TEXCOORD_4",F.g.UV5Kind),G("TEXCOORD_5",F.g.UV6Kind),G("JOINTS_0",F.g.MatricesIndicesKind),G("WEIGHTS_0",F.g.MatricesWeightsKind),G("COLOR_0",F.g.ColorKind);const mM=a.Get(x,this._loader.jc.bufferViews,c.bufferView);return mM._dracoBabylonGeometry||(mM._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${mM.index}`,mM).then((async x=>{const c=this.dracoDecoder||BM.b.Default,G=a.TryGet(this._loader.jc.accessors,Z.attributes.POSITION),mM=this._loader.parent.alwaysComputeBoundingBox||P.skeleton||!G?null:y(G);return await c._decodeMeshToGeometryForGltfAsync(P.name,this._loader.babylonScene,x,w,v,mM).catch((Z=>{throw new Error(`${M}: ${Z.message}`)}))}))),await mM._dracoBabylonGeometry}))}}r(UM),E(UM,!0,(M=>new nM(M)));var LM=P(14047),uM=P(12351),NM=P(12359),JM=P(12791),tM=P(12962),FM=P(12317);JM.c.AddNodeConstructor("Light_Type_0",((M,Z)=>()=>new DM(M,c.BZ.Zero(),Z)));class DM extends tM.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(M){this._shadowAngle=M,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(M){const Z=this.needCube();if(this._direction=M,this.needCube()!==Z&&this._shadowGenerators){const M=this._shadowGenerators.values();for(let Z=M.next();!0!==Z.done;Z=M.next()){Z.value.recreateShadowMap()}}}constructor(M,Z,P){super(M,P),this._shadowAngle=Math.PI/2,this.position=Z}getClassName(){return"PointLight"}getTypeID(){return OM.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(M){if(this.direction)return super.getShadowDirection(M);switch(M){case 0:return new c.BZ(1,0,0);case 1:return new c.BZ(-1,0,0);case 2:return new c.BZ(0,-1,0);case 3:return new c.BZ(0,1,0);case 4:return new c.BZ(0,0,1);case 5:return new c.BZ(0,0,-1)}return c.BZ.Zero()}_setDefaultShadowProjectionMatrix(M,Z,P){const x=this.DM().activeCamera;if(!x)return;const w=void 0!==this.shadowMinZ?this.shadowMinZ:x.uc,v=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,G=this.DM().getEngine().cc;c.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,G?v:w,G?w:v,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,G)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,Z){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,Z):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,Z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,Z),this}transferToNodeMaterialEffect(M,Z){return this.computeTransformedInformation()?M.setFloat3(Z,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):M.setFloat3(Z,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(M,Z){M["POINTLIGHT"+Z]=!0}}(0,uM.c)([(0,NM.H)()],DM.prototype,"shadowAngle",null),(0,FM.g)("BABYLON.PointLight",DM);const lM="KHR_lights_punctual";class hM{constructor(M){this.name=lM,this._loader=M,this.enabled=this._loader.isExtensionUsed(lM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.jc.extensions;if(M&&M[this.name]){const Z=M[this.name];this._lights=Z.lights,a.Assign(this._lights)}}loadNodeAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,v)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(M,Z,(M=>{let Z;const G=a.Get(x,this._lights,v.Zc),mM=G.name||M.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,G.type){case"directional":{const M=new LM.d(mM,c.BZ.Backward(),this._loader.babylonScene);M.position.Qc(0),Z=M;break}case"point":Z=new DM(mM,c.BZ.Zero(),this._loader.babylonScene);break;case"spot":{const M=new dM.c(mM,c.BZ.Zero(),c.BZ.Backward(),0,1,this._loader.babylonScene);M.angle=2*(G.spot&&G.spot.outerConeAngle||Math.PI/4),M.innerAngle=2*(G.spot&&G.spot.innerConeAngle||0),Z=M;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${x}: Invalid light type (${G.type})`)}Z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,G._babylonLight=Z,Z.falloffType=OM.d.FALLOFF_GLTF,Z.Wc=G.color?w.uZ.NZ(G.color):w.uZ.White(),Z.Rc=void 0==G.Rc?1:G.Rc,Z.range=void 0==G.range?Number.MAX_VALUE:G.range,Z.parent=M,this._loader._babylonLights.push(Z),f.AddPointerMetadata(Z,x),P(M)})))))}}r(lM),E(lM,!0,(M=>new hM(M)));const QM="KHR_materials_pbrSpecularGlossiness";class IM{constructor(M){this.name=QM,this.order=200,this._loader=M,this.enabled=this._loader.isExtensionUsed(QM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialBasePropertiesAsync(M,Z,P)),w.push(this._loadSpecularGlossinessPropertiesAsync(x,c,P)),this._loader.loadMaterialAlphaProperties(M,Z,P),await Promise.all(w).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return P.metallic=null,P.roughness=null,Z.diffuseFactor?(P.albedoColor=w.uZ.NZ(Z.diffuseFactor),P.alpha=Z.diffuseFactor[3]):P.albedoColor=w.uZ.White(),P.reflectivityColor=Z.specularFactor?w.uZ.NZ(Z.specularFactor):w.uZ.White(),P.microSurface=void 0==Z.glossinessFactor?1:Z.glossinessFactor,Z.diffuseTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTexture`,Z.diffuseTexture,(M=>{M.name=`${P.name} (Diffuse)`,P.albedoTexture=M}))),Z.specularGlossinessTexture&&(x.push(this._loader.loadTextureInfoAsync(`${M}/specularGlossinessTexture`,Z.specularGlossinessTexture,(M=>{M.name=`${P.name} (Specular Glossiness)`,P.reflectivityTexture=M,P.reflectivityTexture.Lc=!0}))),P.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(x).then((()=>{}))}}r(QM),E(QM,!0,(M=>new IM(M)));const sM="KHR_materials_unlit";class CM{constructor(M){this.name=sM,this.order=210,this._loader=M,this.enabled=this._loader.isExtensionUsed(sM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async()=>await this._loadUnlitPropertiesAsync(M,Z,P)))}_loadUnlitPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;P.unlit=!0;const c=Z.pbrMetallicRoughness;return c&&(c.baseColorFactor?(P.albedoColor=w.uZ.NZ(c.baseColorFactor),P.alpha=c.baseColorFactor[3]):P.albedoColor=w.uZ.White(),c.baseColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/baseColorTexture`,c.baseColorTexture,(M=>{M.name=`${P.name} (Base Color)`,P.albedoTexture=M})))),Z.doubleSided&&(P.Dc=!1,P.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(M,Z,P),Promise.all(x).then((()=>{}))}}r(sM),E(sM,!0,(M=>new CM(M)));const RM="KHR_materials_clearcoat";class WM{constructor(M){this.name=RM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(RM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadClearCoatPropertiesAsync(x,c,P)),await Promise.all(w)}))}_loadClearCoatPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return P.clearCoat.isEnabled=!0,P.clearCoat.useRoughnessFromMainTexture=!1,P.clearCoat.remapF0OnInterfaceChange=!1,void 0!=Z.clearcoatFactor?P.clearCoat.Rc=Z.clearcoatFactor:P.clearCoat.Rc=0,Z.clearcoatTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatTexture`,Z.clearcoatTexture,(M=>{M.name=`${P.name} (ClearCoat)`,P.clearCoat.texture=M}))),void 0!=Z.clearcoatRoughnessFactor?P.clearCoat.roughness=Z.clearcoatRoughnessFactor:P.clearCoat.roughness=0,Z.clearcoatRoughnessTexture&&(Z.clearcoatRoughnessTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatRoughnessTexture`,Z.clearcoatRoughnessTexture,(M=>{M.name=`${P.name} (ClearCoat Roughness)`,P.clearCoat.textureRoughness=M})))),Z.clearcoatNormalTexture&&(Z.clearcoatNormalTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatNormalTexture`,Z.clearcoatNormalTexture,(M=>{M.name=`${P.name} (ClearCoat Normal)`,P.clearCoat.bumpTexture=M}))),P.invertNormalMapX=!P.DM().useRightHandedSystem,P.invertNormalMapY=P.DM().useRightHandedSystem,void 0!=Z.clearcoatNormalTexture.scale&&(P.clearCoat.bumpTexture.level=Z.clearcoatNormalTexture.scale)),Promise.all(x).then((()=>{}))}}r(RM),E(RM,!0,(M=>new WM(M)));const kM="KHR_materials_iridescence";class AM{constructor(M){this.name=kM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(kM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadIridescencePropertiesAsync(x,c,P)),await Promise.all(w).then((()=>{}))}))}_loadIridescencePropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return P.iridescence.isEnabled=!0,P.iridescence.Rc=Z.iridescenceFactor??0,P.iridescence.indexOfRefraction=Z.iridescenceIor??Z.iridescenceIOR??1.3,P.iridescence.minimumThickness=Z.iridescenceThicknessMinimum??100,P.iridescence.maximumThickness=Z.iridescenceThicknessMaximum??400,Z.iridescenceTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/iridescenceTexture`,Z.iridescenceTexture,(M=>{M.name=`${P.name} (Iridescence)`,P.iridescence.texture=M}))),Z.iridescenceThicknessTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/iridescenceThicknessTexture`,Z.iridescenceThicknessTexture,(M=>{M.name=`${P.name} (Iridescence Thickness)`,P.iridescence.thicknessTexture=M}))),Promise.all(x).then((()=>{}))}}r(kM),E(kM,!0,(M=>new AM(M)));const oM="KHR_materials_anisotropy";class EM{constructor(M){this.name=oM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(oM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadIridescencePropertiesAsync(x,c,P)),await Promise.all(w)}))}async _loadIridescencePropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;P.anisotropy.isEnabled=!0,P.anisotropy.Rc=Z.anisotropyStrength??0,P.anisotropy.angle=Z.anisotropyRotation??0,Z.anisotropyTexture&&(Z.anisotropyTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/anisotropyTexture`,Z.anisotropyTexture,(M=>{M.name=`${P.name} (Anisotropy Intensity)`,P.anisotropy.texture=M})))),await Promise.all(x)}}r(oM),E(oM,!0,(M=>new EM(M)));const rM="KHR_materials_emissive_strength";class qM{constructor(M){this.name=rM,this.order=170,this._loader=M,this.enabled=this._loader.isExtensionUsed(rM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>await this._loader.loadMaterialPropertiesAsync(M,Z,P).then((()=>{this._loadEmissiveProperties(x,c,P)}))))}_loadEmissiveProperties(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);void 0!==Z.emissiveStrength&&(P.emissiveIntensity=Z.emissiveStrength)}}r(rM),E(rM,!0,(M=>new qM(M)));const eM="KHR_materials_sheen";class bM{constructor(M){this.name=eM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(eM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadSheenPropertiesAsync(x,c,P)),await Promise.all(w).then((()=>{}))}))}_loadSheenPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return P.sheen.isEnabled=!0,P.sheen.Rc=1,void 0!=Z.sheenColorFactor?P.sheen.color=w.uZ.NZ(Z.sheenColorFactor):P.sheen.color=w.uZ.Black(),Z.sheenColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/sheenColorTexture`,Z.sheenColorTexture,(M=>{M.name=`${P.name} (Sheen Color)`,P.sheen.texture=M}))),void 0!==Z.sheenRoughnessFactor?P.sheen.roughness=Z.sheenRoughnessFactor:P.sheen.roughness=0,Z.sheenRoughnessTexture&&(Z.sheenRoughnessTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/sheenRoughnessTexture`,Z.sheenRoughnessTexture,(M=>{M.name=`${P.name} (Sheen Roughness)`,P.sheen.textureRoughness=M})))),P.sheen.albedoScaling=!0,P.sheen.useRoughnessFromMainTexture=!1,Promise.all(x).then((()=>{}))}}r(eM),E(eM,!0,(M=>new bM(M)));var aM=P(12845);const yM="KHR_materials_specular";class fM{constructor(M){this.name=yM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(yM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;if(w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadSpecularPropertiesAsync(x,c,P)),c.extensions&&c.extensions.EXT_materials_specular_edge_color&&P instanceof N.d){c.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(P.brdf.dielectricSpecularModel=aM.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,P.brdf.conductorSpecularModel=aM.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(w).then((()=>{}))}))}_loadSpecularPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return void 0!==Z.specularFactor&&(P.metallicF0Factor=Z.specularFactor),void 0!==Z.specularColorFactor&&(P.metallicReflectanceColor=w.uZ.NZ(Z.specularColorFactor)),Z.specularTexture&&(Z.specularTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/specularTexture`,Z.specularTexture,(M=>{M.name=`${P.name} (Specular)`,P.metallicReflectanceTexture=M,P.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),Z.specularColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/specularColorTexture`,Z.specularColorTexture,(M=>{M.name=`${P.name} (Specular Color)`,P.reflectanceTexture=M}))),Promise.all(x).then((()=>{}))}}r(yM),E(yM,!0,(M=>new fM(M)));const YM="KHR_materials_ior";class zM{constructor(M){this.name=YM,this.order=180,this._loader=M,this.enabled=this._loader.isExtensionUsed(YM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadIorPropertiesAsync(x,c,P)),await Promise.all(w).then((()=>{}))}))}_loadIorPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);return void 0!==Z.ior?P.indexOfRefraction=Z.ior:P.indexOfRefraction=zM._DEFAULT_IOR,Promise.resolve()}}zM._DEFAULT_IOR=1.5,r(YM),E(YM,!0,(M=>new zM(M)));const iM="KHR_materials_variants";class TM{constructor(M){this.name=iM,this._loader=M,this.enabled=this._loader.isExtensionUsed(iM)}dispose(){this._loader=null}static GetAvailableVariants(M){const Z=this._GetExtensionMetadata(M);return Z?Object.keys(Z.variants):[]}getAvailableVariants(M){return TM.GetAvailableVariants(M)}static SelectVariant(M,Z){const P=this._GetExtensionMetadata(M);if(!P)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${iM} extension`);const x=M=>{const Z=P.variants[M];if(Z)for(const P of Z)P.mesh.material=P.material};if(Z instanceof Array)for(const c of Z)x(c);else x(Z);P.lastSelected=Z}selectVariant(M,Z){TM.SelectVariant(M,Z)}static Reset(M){const Z=this._GetExtensionMetadata(M);if(!Z)throw new Error(`Cannot reset on a glTF mesh that does not have the ${iM} extension`);for(const P of Z.original)P.mesh.material=P.material;Z.lastSelected=null}reset(M){TM.Reset(M)}static GetLastSelectedVariant(M){const Z=this._GetExtensionMetadata(M);if(!Z)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${iM} extension`);return Z.lastSelected}getLastSelectedVariant(M){return TM.GetLastSelectedVariant(M)}static _GetExtensionMetadata(M){var Z,P;return(null===M||void 0===M||null===(Z=M._internalMetadata)||void 0===Z||null===(P=Z.jc)||void 0===P?void 0:P[iM])||null}onLoading(){const M=this._loader.jc.extensions;if(M&&M[this.name]){const Z=M[this.name];this._variants=Z.variants}}onReady(){const M=this._loader.rootBabylonMesh;if(M){var Z;const P=this._loader.parent.extensionOptions[iM];null!==P&&void 0!==P&&P.defaultVariant&&TM.SelectVariant(M,P.defaultVariant),null===P||void 0===P||null===(Z=P.onLoaded)||void 0===Z||Z.call(P,{get variants(){return TM.GetAvailableVariants(M)},get selectedVariant(){const Z=TM.GetLastSelectedVariant(M);return Z?Array.isArray(Z)?Z[0]:Z:TM.GetAvailableVariants(M)[0]},set selectedVariant(Z){TM.SelectVariant(M,Z)}})}}_loadMeshPrimitiveAsync(M,Z,P,x,c,w){return f.LoadExtensionAsync(M,c,this.name,(async(v,G)=>{const mM=new Array;return mM.push(this._loader._loadMeshPrimitiveAsync(M,Z,P,x,c,(Z=>{if(w(Z),Z instanceof h.c){const P=f._GetDrawMode(M,c.mode),x=this._loader.rootBabylonMesh,w=x?x._internalMetadata=x._internalMetadata||{}:{},K=w.jc=w.jc||{},d=K[iM]=K[iM]||{lastSelected:null,original:[],variants:{}};d.original.push({mesh:Z,material:Z.material});for(let M=0;M<G.mappings.length;++M){const c=G.mappings[M],w=a.Get(`${v}/mappings/${M}/material`,this._loader.jc.materials,c.material);mM.push(this._loader._loadMaterialAsync(`#/materials/${c.material}`,w,Z,P,(M=>{for(let P=0;P<c.variants.length;++P){const w=c.variants[P],v=a.Get(`/extensions/${iM}/variants/${w}`,this._variants,w);d.variants[v.name]=d.variants[v.name]||[],d.variants[v.name].push({mesh:Z,material:M}),Z.onClonedObservable.add((M=>{const P=M;let c=null,w=P;do{if(w=w.parent,!w)return;c=TM._GetExtensionMetadata(w)}while(null===c);if(x&&c===TM._GetExtensionMetadata(x)){w._internalMetadata={};for(const M in x._internalMetadata)w._internalMetadata[M]=x._internalMetadata[M];w._internalMetadata.jc=[];for(const M in x._internalMetadata.jc)w._internalMetadata.jc[M]=x._internalMetadata.jc[M];w._internalMetadata.jc[iM]={lastSelected:null,original:[],variants:{}};for(const M of c.original)w._internalMetadata.jc[iM].original.push({mesh:M.mesh,material:M.material});for(const M in c.variants)if(Object.prototype.hasOwnProperty.call(c.variants,M)){w._internalMetadata.jc[iM].variants[M]=[];for(const Z of c.variants[M])w._internalMetadata.jc[iM].variants[M].push({mesh:Z.mesh,material:Z.material})}c=w._internalMetadata.jc[iM]}for(const x of c.original)x.mesh===Z&&(x.mesh=P);for(const x of c.variants[v.name])x.mesh===Z&&(x.mesh=P)}))}})))}}}))),await Promise.all(mM).then((M=>{let[Z]=M;return Z}))}))}}r(iM),E(iM,!0,(M=>new TM(M)));var pM=P(12418);class SM{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:aM.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(M,Z){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...SM._GetDefaultOptions(),...M},this._scene=Z,this._scene._transmissionHelper=this,this.onErrorObservable=new d.b,this._scene.Gc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(M){if(!Object.keys(M).filter((Z=>this._options[Z]!==M[Z])).length)return;const Z={...this._options,...M},P=this._options;this._options=Z,Z.renderSize===P.renderSize&&Z.renderTargetTextureType===P.renderTargetTextureType&&Z.generateMipmaps===P.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=Z.samples,this._opaqueRenderTarget.lodGenerationScale=Z.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=Z.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(M){return!!M&&!!(M instanceof N.d&&M.subSurface.isRefractionEnabled)}_addMesh(M){this._materialObservers[M.uniqueId]=M.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),v.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(M.material)?(M.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(M)&&this._transparentMeshesCache.push(M)):-1===this._opaqueMeshesCache.indexOf(M)&&this._opaqueMeshesCache.push(M)}))}_removeMesh(M){M.onMaterialChangedObservable.remove(this._materialObservers[M.uniqueId]),delete this._materialObservers[M.uniqueId];let Z=this._transparentMeshesCache.indexOf(M);-1!==Z&&this._transparentMeshesCache.splice(Z,1),Z=this._opaqueMeshesCache.indexOf(M),-1!==Z&&this._opaqueMeshesCache.splice(Z,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(M){const Z=this._transparentMeshesCache.indexOf(M),P=this._opaqueMeshesCache.indexOf(M);this._shouldRenderAsTransmission(M.material)?(M.material instanceof N.d&&(M.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==P?(this._opaqueMeshesCache.splice(P,1),this._transparentMeshesCache.push(M)):-1===Z&&this._transparentMeshesCache.push(M)):-1!==Z?(this._transparentMeshesCache.splice(Z,1),this._opaqueMeshesCache.push(M)):-1===P&&this._opaqueMeshesCache.push(M)}_isRenderTargetValid(){var M;return null!==(null===(M=this._opaqueRenderTarget)||void 0===M?void 0:M.getInternalTexture())}_setupRenderTargets(){var M;let Z;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new pM.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(M=this._options.clearColor)||void 0===M?void 0:M.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((M=>{Z=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?M.clearColor.v(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(M.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=Z}));for(const P of this._transparentMeshesCache)this._shouldRenderAsTransmission(P.material)&&(P.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const XM="KHR_materials_transmission";class VM{constructor(M){this.name=XM,this.order=175,this._loader=M,this.enabled=this._loader.isExtensionUsed(XM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadTransparentPropertiesAsync(x,Z,P,c)),await Promise.all(w).then((()=>{}))}))}_loadTransparentPropertiesAsync(M,Z,P,x){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const c=P;if(c.subSurface.isRefractionEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.useAlbedoToTintRefraction=!0,void 0===x.transmissionFactor)return c.subSurface.refractionIntensity=0,c.subSurface.isRefractionEnabled=!1,Promise.resolve();{var w;c.subSurface.refractionIntensity=x.transmissionFactor;const M=c.DM();if(c.subSurface.refractionIntensity&&!M._transmissionHelper)new SM({},c.DM());else if(c.subSurface.refractionIntensity&&(null===(w=M._transmissionHelper)||void 0===w||!w._isRenderTargetValid())){var v;null===(v=M._transmissionHelper)||void 0===v||v._setupRenderTargets()}}return c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,x.transmissionTexture?(x.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${M}/transmissionTexture`,x.transmissionTexture,void 0).then((M=>{M.name=`${P.name} (Transmission)`,c.subSurface.refractionIntensityTexture=M,c.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}r(XM),E(XM,!0,(M=>new VM(M)));const gM="KHR_materials_diffuse_transmission";class MZ{constructor(M){this.name=gM,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(gM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadTranslucentPropertiesAsync(x,Z,P,c)),await Promise.all(w).then((()=>{}))}))}_loadTranslucentPropertiesAsync(M,Z,P,x){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const c=P;if(c.subSurface.isTranslucencyEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,c.subSurface.useAlbedoToTintTranslucency=!1,void 0===x.diffuseTransmissionFactor)return c.subSurface.translucencyIntensity=0,c.subSurface.isTranslucencyEnabled=!1,Promise.resolve();c.subSurface.translucencyIntensity=x.diffuseTransmissionFactor;const v=new Array;return c.subSurface.useGltfStyleTextures=!0,x.diffuseTransmissionTexture&&(x.diffuseTransmissionTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTransmissionTexture`,x.diffuseTransmissionTexture).then((M=>{M.name=`${P.name} (Diffuse Transmission)`,c.subSurface.translucencyIntensityTexture=M})))),void 0!==x.diffuseTransmissionColorFactor?c.subSurface.translucencyColor=w.uZ.NZ(x.diffuseTransmissionColorFactor):c.subSurface.translucencyColor=w.uZ.White(),x.diffuseTransmissionColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTransmissionColorTexture`,x.diffuseTransmissionColorTexture).then((M=>{M.name=`${P.name} (Diffuse Transmission Color)`,c.subSurface.translucencyColorTexture=M}))),Promise.all(v).then((()=>{}))}}r(gM),E(gM,!0,(M=>new MZ(M)));const ZZ="KHR_materials_volume";class PZ{constructor(M){this.name=ZZ,this.order=173,this._loader=M,this.enabled=this._loader.isExtensionUsed(ZZ),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadVolumePropertiesAsync(x,Z,P,c)),await Promise.all(w).then((()=>{}))}))}_loadVolumePropertiesAsync(M,Z,P,x){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);if(!P.subSurface.isRefractionEnabled&&!P.subSurface.isTranslucencyEnabled||!x.thicknessFactor)return Promise.resolve();P.subSurface.volumeIndexOfRefraction=P.indexOfRefraction;const c=void 0!==x.attenuationDistance?x.attenuationDistance:Number.MAX_VALUE;return P.subSurface.tintColorAtDistance=c,void 0!==x.attenuationColor&&3==x.attenuationColor.length&&P.subSurface.tintColor.lc(x.attenuationColor[0],x.attenuationColor[1],x.attenuationColor[2]),P.subSurface.minimumThickness=0,P.subSurface.maximumThickness=x.thicknessFactor,P.subSurface.useThicknessAsDepth=!0,x.thicknessTexture?(x.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${M}/thicknessTexture`,x.thicknessTexture).then((M=>{M.name=`${P.name} (Thickness)`,P.subSurface.thicknessTexture=M,P.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}r(ZZ),E(ZZ,!0,(M=>new PZ(M)));const xZ="KHR_materials_dispersion";class cZ{constructor(M){this.name=xZ,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(xZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadDispersionPropertiesAsync(x,Z,P,c)),await Promise.all(w).then((()=>{}))}))}_loadDispersionPropertiesAsync(M,Z,P,x){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);return P.subSurface.isRefractionEnabled&&x.dispersion?(P.subSurface.isDispersionEnabled=!0,P.subSurface.dispersion=x.dispersion,Promise.resolve()):Promise.resolve()}}r(xZ),E(xZ,!0,(M=>new cZ(M)));const wZ="EXT_materials_diffuse_roughness";class vZ{constructor(M){this.name=wZ,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(wZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(M,Z,P)),w.push(this._loadDiffuseRoughnessPropertiesAsync(x,c,P)),await Promise.all(w).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(M,Z,P){if(!(P instanceof N.d))throw new Error(`${M}: Material type not supported`);const x=new Array;return P.brdf.baseDiffuseModel=aM.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=Z.diffuseRoughnessFactor?P.baseDiffuseRoughness=Z.diffuseRoughnessFactor:P.baseDiffuseRoughness=0,Z.diffuseRoughnessTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/diffuseRoughnessTexture`,Z.diffuseRoughnessTexture,(M=>{M.name=`${P.name} (Diffuse Roughness)`,P.baseDiffuseRoughnessTexture=M}))),Promise.all(x).then((()=>{}))}}r(wZ),E(wZ,!0,(M=>new vZ(M)));const GZ="KHR_mesh_quantization";class mP{constructor(M){this.name=GZ,this.enabled=M.isExtensionUsed(GZ)}dispose(){}}r(GZ),E(GZ,!0,(M=>new mP(M)));const KZ="KHR_texture_basisu";class dZ{constructor(M){this.name=KZ,this._loader=M,this.enabled=M.isExtensionUsed(KZ)}dispose(){this._loader=null}_loadTextureAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>{const w=void 0==Z.sampler?f.DefaultSampler:a.Get(`${M}/sampler`,this._loader.jc.samplers,Z.sampler),v=a.Get(`${x}/source`,this._loader.jc.images,c.source);return await this._loader._createTextureAsync(M,w,v,(M=>{P(M)}),Z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!Z._textureInfo.nonColorData)}))}}r(KZ),E(KZ,!0,(M=>new dZ(M)));const OZ="KHR_texture_transform";class HZ{constructor(M){this.name=OZ,this._loader=M,this.enabled=this._loader.isExtensionUsed(OZ)}dispose(){this._loader=null}loadTextureInfoAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(x,c)=>await this._loader.loadTextureInfoAsync(M,Z,(M=>{if(!(M instanceof J.e))throw new Error(`${x}: Texture type not supported`);c.offset&&(M.uOffset=c.offset[0],M.vOffset=c.offset[1]),M.uRotationCenter=0,M.vRotationCenter=0,c.rotation&&(M.wAng=-c.rotation),c.scale&&(M.uScale=c.scale[0],M.vScale=c.scale[1]),void 0!=c.texCoord&&(M.coordinatesIndex=c.texCoord),P(M)}))))}}r(OZ),E(OZ,!0,(M=>new HZ(M)));const jZ="KHR_xmp_json_ld";class BZ{constructor(M){this.name=jZ,this.order=100,this._loader=M,this.enabled=this._loader.isExtensionUsed(jZ)}dispose(){this._loader=null}onLoading(){var M,Z,P;if(null===this._loader.rootBabylonMesh)return;const x=null===(M=this._loader.jc.extensions)||void 0===M?void 0:M.KHR_xmp_json_ld,c=null===(Z=this._loader.jc.asset)||void 0===Z||null===(P=Z.extensions)||void 0===P?void 0:P.KHR_xmp_json_ld;if(x&&c){const M=+c.packet;x.packets&&M<x.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=x.packets[M])}}}function UZ(M,Z,P,x){return w.uZ.NZ(Z,P).scale(x)}function nZ(M,Z,P,x){return Z[P]*x}function LZ(M,Z,P,x){return-Z[P]*x}function uZ(M,Z,P,x){return Z[P+1]*x}function NZ(M,Z,P,x){return Z[P]*x*2}function JZ(M){return{scale:[new FZ(H.d.ANIMATIONTYPE_FLOAT,`${M}.uScale`,nZ,(()=>2)),new FZ(H.d.ANIMATIONTYPE_FLOAT,`${M}.vScale`,uZ,(()=>2))],offset:[new FZ(H.d.ANIMATIONTYPE_FLOAT,`${M}.uOffset`,nZ,(()=>2)),new FZ(H.d.ANIMATIONTYPE_FLOAT,`${M}.vOffset`,uZ,(()=>2))],rotation:[new FZ(H.d.ANIMATIONTYPE_FLOAT,`${M}.wAng`,LZ,(()=>1))]}}r(jZ),E(jZ,!0,(M=>new BZ(M)));class tZ extends Y.AnimationPropertyInfo{buildAnimations(M,Z,P,x){return[{babylonAnimatable:M._babylonCamera,babylonAnimation:this._buildAnimation(Z,P,x)}]}}class FZ extends Y.AnimationPropertyInfo{buildAnimations(M,Z,P,x){const c=[];for(const w in M._data)c.push({babylonAnimatable:M._data[w].babylonMaterial,babylonAnimation:this._buildAnimation(Z,P,x)});return c}}class DZ extends Y.AnimationPropertyInfo{buildAnimations(M,Z,P,x){return[{babylonAnimatable:M._babylonLight,babylonAnimation:this._buildAnimation(Z,P,x)}]}}(0,q.j)("/cameras/{}/orthographic/xmag",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"orthoLeft",LZ,(()=>1)),new tZ(H.d.ANIMATIONTYPE_FLOAT,"orthoRight",uZ,(()=>1))]),(0,q.j)("/cameras/{}/orthographic/ymag",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"orthoBottom",LZ,(()=>1)),new tZ(H.d.ANIMATIONTYPE_FLOAT,"orthoTop",uZ,(()=>1))]),(0,q.j)("/cameras/{}/orthographic/zfar",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"maxZ",nZ,(()=>1))]),(0,q.j)("/cameras/{}/orthographic/znear",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"uc",nZ,(()=>1))]),(0,q.j)("/cameras/{}/perspective/yfov",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"fov",nZ,(()=>1))]),(0,q.j)("/cameras/{}/perspective/zfar",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"maxZ",nZ,(()=>1))]),(0,q.j)("/cameras/{}/perspective/znear",[new tZ(H.d.ANIMATIONTYPE_FLOAT,"uc",nZ,(()=>1))]),(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new FZ(H.d.ANIMATIONTYPE_COLOR3,"albedoColor",UZ,(()=>4)),new FZ(H.d.ANIMATIONTYPE_FLOAT,"alpha",(function(M,Z,P,x){return Z[P+3]*x}),(()=>4))]),(0,q.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"metallic",nZ,(()=>1))]),(0,q.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"roughness",nZ,(()=>1))]);const lZ=JZ("albedoTexture");(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",lZ.scale),(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",lZ.offset),(0,q.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",lZ.rotation);const hZ=JZ("metallicTexture");(0,q.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",hZ.scale),(0,q.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",hZ.offset),(0,q.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",hZ.rotation),(0,q.j)("/materials/{}/emissiveFactor",[new FZ(H.d.ANIMATIONTYPE_COLOR3,"emissiveColor",UZ,(()=>3))]);const QZ=JZ("bumpTexture");(0,q.j)("/materials/{}/normalTexture/scale",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",nZ,(()=>1))]),(0,q.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",QZ.scale),(0,q.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",QZ.offset),(0,q.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",QZ.rotation),(0,q.j)("/materials/{}/occlusionTexture/strength",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",nZ,(()=>1))]);const IZ=JZ("ambientTexture");(0,q.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",IZ.scale),(0,q.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",IZ.offset),(0,q.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",IZ.rotation);const sZ=JZ("emissiveTexture");(0,q.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",sZ.scale),(0,q.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",sZ.offset),(0,q.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",sZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",nZ,(()=>1))]);const CZ=JZ("anisotropy.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",CZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",CZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",CZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",nZ,(()=>1))]);const RZ=JZ("clearCoat.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",RZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",RZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",RZ.rotation);const WZ=JZ("clearCoat.bumpTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",WZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",WZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",WZ.rotation);const kZ=JZ("clearCoat.textureRoughness");(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",kZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",kZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",kZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",nZ,(()=>1))]);const AZ=JZ("iridescence.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",AZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",AZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",AZ.rotation);const oZ=JZ("iridescence.thicknessTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",oZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",oZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",oZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new FZ(H.d.ANIMATIONTYPE_COLOR3,"sheen.color",UZ,(()=>3))]),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",nZ,(()=>1))]);const EZ=JZ("sheen.texture");(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",EZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",EZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",EZ.rotation);const rZ=JZ("sheen.textureRoughness");(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",rZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",rZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",rZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new FZ(H.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",UZ,(()=>3))]);const qZ=JZ("metallicReflectanceTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",qZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",qZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",qZ.rotation);const eZ=JZ("reflectanceTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",eZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",eZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",eZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",nZ,(()=>1))]);const bZ=JZ("subSurface.refractionIntensityTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",bZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",bZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",bZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new FZ(H.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",UZ,(()=>3))]),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",nZ,(()=>1))]),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",nZ,(()=>1))]);const aZ=JZ("subSurface.thicknessTexture");(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",aZ.scale),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",aZ.offset),(0,q.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",aZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new FZ(H.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",nZ,(()=>1))]);const yZ=JZ("subSurface.translucencyIntensityTexture");(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",yZ.scale),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",yZ.offset),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",yZ.rotation),(0,q.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new FZ(H.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",UZ,(()=>3))]);const fZ=JZ("subSurface.translucencyColorTexture");(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",fZ.scale),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",fZ.offset),(0,q.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",fZ.rotation),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new DZ(H.d.ANIMATIONTYPE_COLOR3,"diffuse",UZ,(()=>3))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new DZ(H.d.ANIMATIONTYPE_FLOAT,"intensity",nZ,(()=>1))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new DZ(H.d.ANIMATIONTYPE_FLOAT,"range",nZ,(()=>1))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new DZ(H.d.ANIMATIONTYPE_FLOAT,"innerAngle",NZ,(()=>1))]),(0,q.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new DZ(H.d.ANIMATIONTYPE_FLOAT,"angle",NZ,(()=>1))]),(0,q.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new DZ(H.d.ANIMATIONTYPE_COLOR3,"diffuse",UZ,(()=>3))]),(0,q.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new DZ(H.d.ANIMATIONTYPE_FLOAT,"intensity",nZ,(()=>1))]);const YZ="KHR_animation_pointer";class zZ{constructor(M){this.name=YZ,this._loader=M,this._pathToObjectConverter=(0,q.g)(this._loader.jc)}get enabled(){return this._loader.isExtensionUsed(YZ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(M,Z,P,x,c){var w;const v=null===(w=x.target.extensions)||void 0===w?void 0:w.KHR_animation_pointer;if(!v||!this._pathToObjectConverter)return null;"pointer"!==x.target.path&&U.d.Warn(`${M}/target/path: Value (${x.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=x.target.node&&U.d.Warn(`${M}/target/node: Value (${x.target.node}) must not be present when using the ${this.name} extension`);const G=`${M}/extensions/${this.name}`,mM=v.pointer;if(!mM)throw new Error(`${G}: Pointer is missing`);try{const w=this._pathToObjectConverter.convert(mM);if(!w.info.interpolation)throw new Error(`${G}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(M,Z,P,x,{object:w.object,info:w.info.interpolation},c)}catch(K){return U.d.Warn(`${G}/pointer: Invalid pointer (${mM}) skipped`),null}}}r(YZ),E(YZ,!0,(M=>new zZ(M)));class iZ{constructor(M,Z,P){this.frame=M,this.action=Z,this.onlyOnce=P,this.isDone=!1}_clone(){return new iZ(this.frame,this.action,this.onlyOnce)}}var TZ=P(12213),pZ=P(12260),SZ=P(12258);class XZ{get loop(){return this._loop}set loop(M){M!==this._loop&&(this._loop=M,this.updateOptions({loop:M}))}get currentTime(){var M;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.audioContext&&(this.isPlaying||this.isPaused)){const M=this.isPaused?0:pZ.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+M}return 0}get spatialSound(){return this._spatialSound}set spatialSound(M){if(M==this._spatialSound)return;const Z=this.isPlaying;this.pause(),M?(this._spatialSound=M,this._updateSpatialParameters()):this._disableSpatialSound(),Z&&this.play()}constructor(M,Z,P){var x;let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new d.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=c.BZ.Zero(),this._localDirection=new c.BZ(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=M,P=P||B.b.LastCreatedScene)if(this._scene=P,XZ._SceneComponentInitialization(P),this._readyToPlayCallback=w,this._customAttenuationFunction=(M,Z,P,x,c)=>Z<P?M*(1-Z/P):0,G&&(this.autoplay=G.autoplay||!1,this._loop=G.loop||!1,void 0!==G.volume&&(this._volume=G.volume),this._spatialSound=G.spatialSound??!1,this.maxDistance=G.maxDistance??100,this.useCustomAttenuation=G.useCustomAttenuation??!1,this.rolloffFactor=G.rolloffFactor||1,this.refDistance=G.refDistance||1,this.distanceModel=G.distanceModel||"linear",this._playbackRate=G.playbackRate||1,this._streaming=G.streaming??!1,this._length=G.length,this._offset=G.offset),null!==(x=pZ.e.audioEngine)&&void 0!==x&&x.canUseWebAudio&&pZ.e.audioEngine.audioContext){this._soundGain=pZ.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let M=!0;if(Z)try{"string"===typeof Z?(this._urlType="String",this._url=Z):Z instanceof ArrayBuffer?this._urlType="ArrayBuffer":Z instanceof HTMLMediaElement?this._urlType="MediaElement":Z instanceof MediaStream?this._urlType="MediaStream":Z instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(Z)&&(this._urlType="Array");let P=[],x=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=pZ.e.audioEngine.audioContext.createMediaElementSource(Z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=pZ.e.audioEngine.audioContext.createMediaStreamSource(Z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":Z.byteLength>0&&(x=!0,this._soundLoaded(Z));break;case"AudioBuffer":this._audioBufferLoaded(Z);break;case"String":P.push(Z);case"Array":0===P.length&&(P=Z);for(let M=0;M<P.length;M++){const Z=P[M];if(x=G&&G.skipCodecCheck||-1!==Z.indexOf(".mp3",Z.length-4)&&pZ.e.audioEngine.isMP3supported||-1!==Z.indexOf(".ogg",Z.length-4)&&pZ.e.audioEngine.isOGGsupported||-1!==Z.indexOf(".wav",Z.length-4)||-1!==Z.indexOf(".m4a",Z.length-4)||-1!==Z.indexOf(".mp4",Z.length-4)||-1!==Z.indexOf("blob:"),x){this._streaming?(this._htmlAudioElement=new Audio(Z),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,v.Tools.SetCorsBehavior(Z,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(Z,(M=>{this._soundLoaded(M)}),void 0,!0,!0,(M=>{M&&U.d.Error("XHR "+M.status+" error on: "+Z+"."),U.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:M=!1}M?x||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):U.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(mM){U.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),pZ.e.audioEngine&&!pZ.e.audioEngine.WarnedWebAudioUnsupported&&(U.d.Error("Web Audio is not supported by your browser."),pZ.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var M;null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(M){var Z;null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.audioContext&&(this._audioBuffer=M,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(M){var Z;null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.audioContext&&pZ.e.audioEngine.audioContext.decodeAudioData(M,(M=>{this._audioBufferLoaded(M)}),(M=>{U.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+M)}))}setAudioBuffer(M){var Z;null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this._audioBuffer=M,this._isReadyToPlay=!0)}updateOptions(M){M&&(this.loop=M.loop??this.loop,this.maxDistance=M.maxDistance??this.maxDistance,this.useCustomAttenuation=M.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=M.rolloffFactor??this.rolloffFactor,this.refDistance=M.refDistance??this.refDistance,this.distanceModel=M.distanceModel??this.distanceModel,this._playbackRate=M.playbackRate??this._playbackRate,this._length=M.length??void 0,this.spatialSound=M.spatialSound??this._spatialSound,this._setOffset(M.offset??void 0),this.setVolume(M.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var M;null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&pZ.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??pZ.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var M;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(M=this._soundPanner)||void 0===M||M.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var M;null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(M){var Z;null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(M),this._isOutputConnected=!0)}setDirectionalCone(M,Z,P){Z<M?U.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=M,this._coneOuterAngle=Z,this._coneOuterGain=P,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!=this._coneInnerAngle){var Z;if(this._coneOuterAngle<M)return void U.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M,null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!=this._coneOuterAngle){var Z;if(M<this._coneInnerAngle)return void U.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M,null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(M){var Z;M.equals(this._position)||(this._position.v(M),null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(M){var Z;this._localDirection=M,null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const M=this._connectedTransformNode.getWorldMatrix(),Z=c.BZ.TransformNormal(this._localDirection,M);Z.normalize(),this._soundPanner.orientationX.value=Z.x,this._soundPanner.orientationY.value=Z.y,this._soundPanner.orientationZ.value=Z.z}updateDistanceFromListener(){var M;if(null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const M=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.UZ(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,M,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(M){this._customAttenuationFunction=M}play(M,Z,P){var x;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(x=pZ.e.audioEngine)&&void 0!==x&&x.audioContext)try{var c,w;this._clearTimeoutsAndObservers();let x=M?(null===(c=pZ.e.audioEngine)||void 0===c?void 0:c.audioContext.currentTime)+M:null===(w=pZ.e.audioEngine)||void 0===w?void 0:w.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=pZ.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const M=()=>{var P;if(null!==(P=pZ.e.audioEngine)&&void 0!==P&&P.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=Z??0;const P=this._htmlAudioElement.play();void 0!==P&&P.catch((()=>{var Z,P;(null===(Z=pZ.e.audioEngine)||void 0===Z||Z.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(P=pZ.e.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{M()})))}))}else{var x;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(x=pZ.e.audioEngine)||void 0===x?void 0:x.onAudioUnlockedObservable.addOnce((()=>{M()}))}};M()}}else{var v;const c=()=>{var c;if(null!==(c=pZ.e.audioEngine)&&void 0!==c&&c.audioContext){var w;if(P=P||this._length,void 0!==Z&&this._setOffset(Z),this._soundSource){const M=this._soundSource;M.onended=()=>{M.disconnect()}}if(this._soundSource=null===(w=pZ.e.audioEngine)||void 0===w?void 0:w.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var v;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==Z&&(this._soundSource.loopStart=Z),void 0!==P&&(this._soundSource.loopEnd=(0|Z)+P),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},x=M?(null===(v=pZ.e.audioEngine)||void 0===v?void 0:v.audioContext.currentTime)+M:pZ.e.audioEngine.audioContext.currentTime;const c=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(x,c,this.loop?void 0:P)}}};"suspended"===(null===(v=pZ.e.audioEngine)||void 0===v?void 0:v.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var M;"suspended"===(null===(M=pZ.e.audioEngine)||void 0===M?void 0:M.audioContext.state)?(pZ.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=pZ.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{c()})))):c()}),500):c()}this._startTime=x,this.isPlaying=!0,this.isPaused=!1}catch(G){U.d.Error("Error while trying to play audio: "+this.name+", "+G.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(M){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var P;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(P=this._streamingSource)||void 0===P||P.disconnect();this.isPlaying=!1}else if(null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource){const Z=M?pZ.e.audioEngine.audioContext.currentTime+M:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(Z)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var M;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Z;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(Z=this._streamingSource)||void 0===Z||Z.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=pZ.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(M,Z){var P;null!==(P=pZ.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._soundGain&&(Z&&pZ.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(pZ.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,pZ.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(M,pZ.e.audioEngine.audioContext.currentTime+Z)):this._soundGain.gain.value=M),this._volume=M}setPlaybackRate(M){this._playbackRate=M,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(M){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=M,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=M=>this._onRegisterAfterWorldMatrixUpdate(M),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(M){var Z;if(M.getBoundingInfo){const Z=M.getBoundingInfo();this.setPosition(Z.boundingSphere.centerWorld)}else this.setPosition(M.absolutePosition);null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const M=()=>{(0,SZ.d)((()=>this._isReadyToPlay),(()=>{P._audioBuffer=this.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,this._offset,this._length)}),void 0,300)},Z={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},P=new XZ(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,Z);return this.useCustomAttenuation&&P.setAttenuationFunction(this._customAttenuationFunction),P.setPosition(this._position),P.setPlaybackRate(this._playbackRate),M(),P}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const M={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(M.connectedMeshId=this._connectedTransformNode.id),M.position=this._position.nc(),M.refDistance=this.refDistance,M.distanceModel=this.distanceModel,M.isDirectional=this._isDirectional,M.localDirectionToMesh=this._localDirection.nc(),M.coneInnerAngle=this._coneInnerAngle,M.coneOuterAngle=this._coneOuterAngle,M.coneOuterGain=this._coneOuterGain),M}static Parse(M,Z,P,x){const w=M.name;let v;v=M.url?P+M.url:P+w;const G={autoplay:M.autoplay,loop:M.loop,volume:M.volume,spatialSound:M.spatialSound,maxDistance:M.maxDistance,rolloffFactor:M.rolloffFactor,refDistance:M.refDistance,distanceModel:M.distanceModel,playbackRate:M.playbackRate};let mM;if(x){const M=()=>{(0,SZ.d)((()=>x._isReadyToPlay),(()=>{mM._audioBuffer=x.getAudioBuffer(),mM._isReadyToPlay=!0,mM.autoplay&&mM.play(0,mM._offset,mM._length)}),void 0,300)};mM=new XZ(w,new ArrayBuffer(0),Z,null,G),M()}else mM=new XZ(w,v,Z,(()=>{Z.removePendingData(mM)}),G),Z.addPendingData(mM);if(M.position){const Z=c.BZ.NZ(M.position);mM.setPosition(Z)}if(M.isDirectional&&(mM.setDirectionalCone(M.coneInnerAngle||360,M.coneOuterAngle||360,M.coneOuterGain||0),M.localDirectionToMesh)){const Z=c.BZ.NZ(M.localDirectionToMesh);mM.setLocalDirectionToMesh(Z)}if(M.connectedMeshId){const P=Z.getMeshById(M.connectedMeshId);P&&mM.attachToMesh(P)}return M.metadata&&(mM.metadata=M.metadata),mM}_setOffset(M){this._offset!==M&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=M)}_clearTimeoutsAndObservers(){var M;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(M=pZ.e.audioEngine)||void 0===M||M.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}XZ._SceneComponentInitialization=M=>{throw(0,TZ.d)("AudioSceneComponent")},(0,FM.g)("BABYLON.Sound",XZ);class VZ{constructor(M,Z,P){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],Z.length!==P.length)throw new Error("Sounds length does not equal weights length");this.loop=M,this._weights=P;let x=0;for(const w of P)x+=w;const c=x>0?1/x:0;for(let w=0;w<this._weights.length;w++)this._weights[w]*=c;this._sounds=Z;for(const w of this._sounds)w.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!==this._coneInnerAngle){if(this._coneOuterAngle<M)return void U.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M;for(const Z of this._sounds)Z.directionalConeInnerAngle=M}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!==this._coneOuterAngle){if(M<this._coneInnerAngle)return void U.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M;for(const Z of this._sounds)Z.directionalConeOuterAngle=M}}get volume(){return this._volume}set volume(M){if(M!==this._volume)for(const Z of this._sounds)Z.setVolume(M)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(M){if(!this.isPaused){this.stop();const M=Math.random();let Z=0;for(let P=0;P<this._weights.length;P++)if(Z+=this._weights[P],M<=Z){this._currentIndex=P;break}}const Z=this._sounds[this._currentIndex??0];Z.isReady()?Z.play(0,this.isPaused?void 0:M):Z.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class gZ{constructor(M){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(M=M||B.b.LastCreatedScene)&&(this._scene=M,this.soundCollection=[],this._options=Z,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var M;null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&pZ.e.audioEngine.audioContext&&(this._outputAudioNode=pZ.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(pZ.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(pZ.e.audioEngine&&pZ.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(M){var Z;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&M.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==M.soundTrackId&&(-1===M.soundTrackId?this._scene.mainSoundTrack.removeSound(M):this._scene.soundTracks&&this._scene.soundTracks[M.soundTrackId].removeSound(M)),this.soundCollection.push(M),M.soundTrackId=this.id}removeSound(M){const Z=this.soundCollection.indexOf(M);-1!==Z&&this.soundCollection.splice(Z,1)}setVolume(M){var Z;null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=M)}switchPanningModelToHRTF(){var M;if(null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let Z=0;Z<this.soundCollection.length;Z++)this.soundCollection[Z].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var M;if(null!==(M=pZ.e.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let Z=0;Z<this.soundCollection.length;Z++)this.soundCollection[Z].switchPanningModelToEqualPower()}connectToAnalyser(M){var Z;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=M,null!==(Z=pZ.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,pZ.e.audioEngine.masterGain))}}var MP=P(12639),ZP=P(12596),PP=P(12192);pZ.e.AudioEngineFactory=(M,Z,P)=>new xP(M,Z,P);class xP{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new d.b,this.onAudioLockedObservable=new d.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,PP.p)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const x=document.createElement("audio");this._hostElement=M,this._audioContext=Z,this._audioDestination=P;try{x&&x.canPlayType&&(x.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||x.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(c){}try{x&&x.canPlayType&&x.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(c){}}lock(){this._triggerSuspendedState()}unlock(){var M,Z;if("running"===(null===(M=this._audioContext)||void 0===M?void 0:M.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(Z=this._audioContext)||void 0===Z||Z.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{U.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var M;null===(M=this._audioContext)||void 0===M||M.addEventListener("statechange",(()=>{var M;this.unlocked&&"running"!==(null===(M=this._audioContext)||void 0===M?void 0:M.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var M;return null!==(M=this._audioContext)&&void 0!==M&&M.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(M){this.canUseWebAudio=!1,U.d.Error("Web Audio: "+M.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(M){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const M=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",Z=document.createElement("style");Z.appendChild(document.createTextNode(M)),document.getElementsByTagName("head")[0].appendChild(Z),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var M;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(M=this._audioContext)||void 0===M||M.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(M){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=M)}connectToAnalyser(M){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=M,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var cP=P(12209);(0,P(13743).e)(MP.d.NAME_AUDIO,((M,Z,P,x)=>{let c,w=[];if(P.Cj=P.Cj||[],void 0!==M.Cj&&null!==M.Cj)for(let G=0,mM=M.Cj.length;G<mM;G++){var v;const mM=M.Cj[G];null!==(v=pZ.e.audioEngine)&&void 0!==v&&v.canUseWebAudio?(mM.url||(mM.url=mM.name),w[mM.url]?P.Cj.push(XZ.Parse(mM,Z,x,w[mM.url])):(c=XZ.Parse(mM,Z,x),w[mM.url]=c,P.Cj.push(c))):P.Cj.push(new XZ(mM.name,null,Z))}w=[]})),Object.defineProperty(ZP.e.prototype,"mainSoundTrack",{get:function(){let M=this._getComponent(MP.d.NAME_AUDIO);return M||(M=new wP(this),this.xc(M)),this._mainSoundTrack||(this._mainSoundTrack=new gZ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ZP.e.prototype.getSoundByName=function(M){let Z;for(Z=0;Z<this.mainSoundTrack.soundCollection.length;Z++)if(this.mainSoundTrack.soundCollection[Z].name===M)return this.mainSoundTrack.soundCollection[Z];if(this.soundTracks)for(let P=0;P<this.soundTracks.length;P++)for(Z=0;Z<this.soundTracks[P].soundCollection.length;Z++)if(this.soundTracks[P].soundCollection[Z].name===M)return this.soundTracks[P].soundCollection[Z];return null},Object.defineProperty(ZP.e.prototype,"audioEnabled",{get:function(){let M=this._getComponent(MP.d.NAME_AUDIO);return M||(M=new wP(this),this.xc(M)),M.audioEnabled},set:function(M){let Z=this._getComponent(MP.d.NAME_AUDIO);Z||(Z=new wP(this),this.xc(Z)),M?Z.enableAudio():Z.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ZP.e.prototype,"headphone",{get:function(){let M=this._getComponent(MP.d.NAME_AUDIO);return M||(M=new wP(this),this.xc(M)),M.headphone},set:function(M){let Z=this._getComponent(MP.d.NAME_AUDIO);Z||(Z=new wP(this),this.xc(Z)),M?Z.switchAudioModeForHeadphones():Z.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ZP.e.prototype,"audioListenerPositionProvider",{get:function(){let M=this._getComponent(MP.d.NAME_AUDIO);return M||(M=new wP(this),this.xc(M)),M.audioListenerPositionProvider},set:function(M){let Z=this._getComponent(MP.d.NAME_AUDIO);if(Z||(Z=new wP(this),this.xc(Z)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");Z.audioListenerPositionProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(ZP.e.prototype,"audioListenerRotationProvider",{get:function(){let M=this._getComponent(MP.d.NAME_AUDIO);return M||(M=new wP(this),this.xc(M)),M.audioListenerRotationProvider},set:function(M){let Z=this._getComponent(MP.d.NAME_AUDIO);if(Z||(Z=new wP(this),this.xc(Z)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");Z.audioListenerRotationProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(ZP.e.prototype,"audioPositioningRefreshRate",{get:function(){let M=this._getComponent(MP.d.NAME_AUDIO);return M||(M=new wP(this),this.xc(M)),M.audioPositioningRefreshRate},set:function(M){let Z=this._getComponent(MP.d.NAME_AUDIO);Z||(Z=new wP(this),this.xc(Z)),Z.audioPositioningRefreshRate=M},enumerable:!0,configurable:!0});class wP{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(M){this.name=MP.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new c.BZ,this._cachedCameraPosition=new c.BZ,this._lastCheck=0,this._invertMatrixTemp=new c.Matrix,this._cameraDirectionTemp=new c.BZ,(M=M||B.b.LastCreatedScene)&&(this.nZ=M,M.soundTracks=[],M.Cj=[])}register(){this.nZ._afterRenderStage.registerStep(MP.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(M){if(M.Cj=[],this.nZ.soundTracks)for(let Z=0;Z<this.nZ.soundTracks.length;Z++){const P=this.nZ.soundTracks[Z];for(let Z=0;Z<P.soundCollection.length;Z++)M.Cj.push(P.soundCollection[Z].serialize())}}addFromContainer(M){if(M.Cj)for(const Z of M.Cj)Z.play(),Z.autoplay=!0,this.nZ.mainSoundTrack.addSound(Z)}removeFromContainer(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(M.Cj)for(const P of M.Cj)P.stop(),P.autoplay=!1,this.nZ.mainSoundTrack.removeSound(P),Z&&P.dispose()}dispose(){const M=this.nZ;if(M._mainSoundTrack&&M.mainSoundTrack.dispose(),M.soundTracks)for(let Z=0;Z<M.soundTracks.length;Z++)M.soundTracks[Z].dispose()}disableAudio(){const M=this.nZ;let Z;for(this._audioEnabled=!1,pZ.e.audioEngine&&pZ.e.audioEngine.audioContext&&pZ.e.audioEngine.audioContext.suspend(),Z=0;Z<M.mainSoundTrack.soundCollection.length;Z++)M.mainSoundTrack.soundCollection[Z].pause();if(M.soundTracks)for(Z=0;Z<M.soundTracks.length;Z++)for(let P=0;P<M.soundTracks[Z].soundCollection.length;P++)M.soundTracks[Z].soundCollection[P].pause()}enableAudio(){const M=this.nZ;let Z;for(this._audioEnabled=!0,pZ.e.audioEngine&&pZ.e.audioEngine.audioContext&&pZ.e.audioEngine.audioContext.resume(),Z=0;Z<M.mainSoundTrack.soundCollection.length;Z++)M.mainSoundTrack.soundCollection[Z].isPaused&&M.mainSoundTrack.soundCollection[Z].play();if(M.soundTracks)for(Z=0;Z<M.soundTracks.length;Z++)for(let P=0;P<M.soundTracks[Z].soundCollection.length;P++)M.soundTracks[Z].soundCollection[P].isPaused&&M.soundTracks[Z].soundCollection[P].play()}switchAudioModeForHeadphones(){const M=this.nZ;if(this._headphone=!0,M.mainSoundTrack.switchPanningModelToHRTF(),M.soundTracks)for(let Z=0;Z<M.soundTracks.length;Z++)M.soundTracks[Z].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const M=this.nZ;if(this._headphone=!1,M.mainSoundTrack.switchPanningModelToEqualPower(),M.soundTracks)for(let Z=0;Z<M.soundTracks.length;Z++)M.soundTracks[Z].switchPanningModelToEqualPower()}_afterRender(){const M=cP.c.Now;if(this._lastCheck&&M-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=M;const Z=this.nZ;if(!this._audioEnabled||!Z._mainSoundTrack||!Z.soundTracks||0===Z._mainSoundTrack.soundCollection.length&&1===Z.soundTracks.length)return;const P=pZ.e.audioEngine;if(P&&P.audioContext){let M,x=Z.activeCamera;if(Z.activeCameras&&Z.activeCameras.length>0&&(x=Z.activeCameras[0]),this.audioListenerPositionProvider){const M=this.audioListenerPositionProvider();P.audioContext.listener.setPosition(M.x||0,M.y||0,M.z||0)}else x?this._cachedCameraPosition.equals(x.globalPosition)||(this._cachedCameraPosition.v(x.globalPosition),P.audioContext.listener.setPosition(x.globalPosition.x,x.globalPosition.y,x.globalPosition.z)):P.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const M=this.audioListenerRotationProvider();P.audioContext.listener.setOrientation(M.x||0,M.y||0,M.z||0,0,1,0)}else x?(x.rigCameras&&x.rigCameras.length>0&&(x=x.rigCameras[0]),x.getViewMatrix().invertToRef(this._invertMatrixTemp),c.BZ.TransformNormalToRef(wP._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.v(this._cameraDirectionTemp),P.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):P.audioContext.listener.setOrientation(0,0,0,0,1,0);for(M=0;M<Z.mainSoundTrack.soundCollection.length;M++){const P=Z.mainSoundTrack.soundCollection[M];P.useCustomAttenuation&&P.updateDistanceFromListener()}if(Z.soundTracks)for(M=0;M<Z.soundTracks.length;M++)for(let P=0;P<Z.soundTracks[M].soundCollection.length;P++){const x=Z.soundTracks[M].soundCollection[P];x.useCustomAttenuation&&x.updateDistanceFromListener()}}}}wP._CameraDirection=new c.BZ(0,0,-1),XZ._SceneComponentInitialization=M=>{let Z=M._getComponent(MP.d.NAME_AUDIO);Z||(Z=new wP(M),M.xc(Z))};const vP="MSFT_audio_emitter";class GP{constructor(M){this.name=vP,this._loader=M,this.enabled=this._loader.isExtensionUsed(vP)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const M=this._loader.jc.extensions;if(M&&M[this.name]){const Z=M[this.name];this._clips=Z.clips,this._emitters=Z.emitters,a.Assign(this._clips),a.Assign(this._emitters)}}loadSceneAsync(M,Z){return f.LoadExtensionAsync(M,Z,this.name,(async(P,x)=>{const c=new Array;c.push(this._loader.loadSceneAsync(M,Z));for(const M of x.emitters){const Z=a.Get(`${P}/emitters`,this._emitters,M);if(void 0!=Z.refDistance||void 0!=Z.maxDistance||void 0!=Z.rolloffFactor||void 0!=Z.distanceModel||void 0!=Z.innerAngle||void 0!=Z.outerAngle)throw new Error(`${P}: Direction or Distance properties are not allowed on emitters attached to a scene`);c.push(this._loadEmitterAsync(`${P}/emitters/${Z.index}`,Z))}await Promise.all(c)}))}loadNodeAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(M,x)=>{const w=new Array,G=await this._loader.loadNodeAsync(M,Z,(Z=>{for(const P of x.emitters){const x=a.Get(`${M}/emitters`,this._emitters,P);w.push(this._loadEmitterAsync(`${M}/emitters/${x.index}`,x).then((()=>{for(const M of x._babylonSounds)M.attachToMesh(Z),void 0==x.innerAngle&&void 0==x.outerAngle||(M.setLocalDirectionToMesh(c.BZ.Forward()),M.setDirectionalCone(2*v.Tools.ToDegrees(void 0==x.innerAngle?Math.PI:x.innerAngle),2*v.Tools.ToDegrees(void 0==x.outerAngle?Math.PI:x.outerAngle),0))})))}P(Z)}));return await Promise.all(w),G}))}loadAnimationAsync(M,Z){return f.LoadExtensionAsync(M,Z,this.name,(async(P,x)=>{const c=await this._loader.loadAnimationAsync(M,Z),w=new Array;a.Assign(x.events);for(const v of x.events)w.push(this._loadAnimationEventAsync(`${P}/events/${v.index}`,M,Z,v,c));return await Promise.all(w),c}))}_loadClipAsync(M,Z){if(Z._objectURL)return Z._objectURL;let P;if(Z.uri)P=this._loader.loadUriAsync(M,Z,Z.uri);else{const x=a.Get(`${M}/bufferView`,this._loader.jc.bufferViews,Z.bufferView);P=this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return Z._objectURL=P.then((M=>URL.createObjectURL(new Blob([M],{type:Z.mimeType})))),Z._objectURL}_loadEmitterAsync(M,Z){if(Z._babylonSounds=Z._babylonSounds||[],!Z._babylonData){const M=new Array,P=Z.name||`emitter${Z.index}`,x={loop:!1,autoplay:!1,volume:void 0==Z.volume?1:Z.volume};for(let w=0;w<Z.clips.length;w++){const c=`/extensions/${this.name}/clips`,v=a.Get(c,this._clips,Z.clips[w].clip);M.push(this._loadClipAsync(`${c}/${Z.clips[w].clip}`,v).then((M=>{const c=Z._babylonSounds[w]=new XZ(P,M,this._loader.babylonScene,null,x);c.refDistance=Z.refDistance||1,c.maxDistance=Z.maxDistance||256,c.rolloffFactor=Z.rolloffFactor||1,c.distanceModel=Z.distanceModel||"exponential"})))}const c=Promise.all(M).then((()=>{const M=Z.clips.map((M=>M.weight||1)),P=new VZ(Z.loop||!1,Z._babylonSounds,M);Z.innerAngle&&(P.directionalConeInnerAngle=2*v.Tools.ToDegrees(Z.innerAngle)),Z.outerAngle&&(P.directionalConeOuterAngle=2*v.Tools.ToDegrees(Z.outerAngle)),Z.volume&&(P.volume=Z.volume),Z._babylonData.sound=P}));Z._babylonData={loaded:c}}return Z._babylonData.loaded}_getEventAction(M,Z,P,x,c){switch(P){case"play":return M=>{const P=(c||0)+(M-x);Z.play(P)};case"stop":return()=>{Z.stop()};case"pause":return()=>{Z.pause()};default:throw new Error(`${M}: Unsupported action ${P}`)}}_loadAnimationEventAsync(M,Z,P,x,c){if(0==c.targetedAnimations.length)return Promise.resolve();const w=c.targetedAnimations[0],v=x.xZ,G=a.Get(`/extensions/${this.name}/emitters`,this._emitters,v);return this._loadEmitterAsync(M,G).then((()=>{const Z=G._babylonData.sound;if(Z){const P=new iZ(x.time,this._getEventAction(M,Z,x.action,x.time,x.startOffset));w.animation.addEvent(P),c.onAnimationGroupEndObservable.add((()=>{Z.stop()})),c.onAnimationGroupPauseObservable.add((()=>{Z.pause()}))}}))}}r(vP),E(vP,!0,(M=>new GP(M)));const mx="MSFT_lod";class KP{constructor(M){var Z;this.name=mx,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new d.b,this.onMaterialLODsLoadedObservable=new d.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=M,this.maxLODsToLoad=(null===(Z=this._loader.parent.extensionOptions[mx])||void 0===Z?void 0:Z.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(mx)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let M=0;M<this._nodePromiseLODs.length;M++){const Z=Promise.all(this._nodePromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter(`Node LOD ${M}`),this._loader.log(`Loaded node LOD ${M}`)),this.onNodeLODsLoadedObservable.notifyObservers(M),M!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${M+1}`),this._loadBufferLOD(this._nodeBufferLODs,M+1),this._nodeSignalLODs[M]&&this._nodeSignalLODs[M].resolve())}));this._loader._completePromises.push(Z)}for(let M=0;M<this._materialPromiseLODs.length;M++){const Z=Promise.all(this._materialPromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter(`Material LOD ${M}`),this._loader.log(`Loaded material LOD ${M}`)),this.onMaterialLODsLoadedObservable.notifyObservers(M),M!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${M+1}`),this._loadBufferLOD(this._materialBufferLODs,M+1),this._materialSignalLODs[M]&&this._materialSignalLODs[M].resolve())}));this._loader._completePromises.push(Z)}}loadSceneAsync(M,Z){const P=this._loader.loadSceneAsync(M,Z);return this._loadBufferLOD(this._bufferLODs,0),P}loadNodeAsync(M,Z,P){return f.LoadExtensionAsync(M,Z,this.name,(async(M,c)=>{let w;const v=this._getLODs(M,Z,this._loader.jc.nodes,c.ids);this._loader.logOpen(`${M}`);for(let Z=0;Z<v.length;Z++){const M=v[Z];0!==Z&&(this._nodeIndexLOD=Z,this._nodeSignalLODs[Z]=this._nodeSignalLODs[Z]||new x);const c=M=>{P(M),M.Lm(!1)},G=this._loader.loadNodeAsync(`/nodes/${M.index}`,M,c).then((M=>{if(0!==Z){const M=v[Z-1];M._babylonTransformNode&&(this._disposeTransformNode(M._babylonTransformNode),delete M._babylonTransformNode)}return M.Lm(!0),M}));this._nodePromiseLODs[Z]=this._nodePromiseLODs[Z]||[],0===Z?w=G:(this._nodeIndexLOD=null,this._nodePromiseLODs[Z].push(G))}return this._loader.logClose(),await w}))}_loadMaterialAsync(M,Z,P,x,c){return this._nodeIndexLOD?null:f.LoadExtensionAsync(M,Z,this.name,(async(M,w)=>{let v;const G=this._getLODs(M,Z,this._loader.jc.materials,w.ids);this._loader.logOpen(`${M}`);for(let Z=0;Z<G.length;Z++){const M=G[Z];0!==Z&&(this._materialIndexLOD=Z);const w=this._loader._loadMaterialAsync(`/materials/${M.index}`,M,P,x,(M=>{0===Z&&c(M)})).then((M=>{if(0!==Z){c(M);const P=G[Z-1]._data;P[x]&&(this._disposeMaterials([P[x].babylonMaterial]),delete P[x])}return M}));this._materialPromiseLODs[Z]=this._materialPromiseLODs[Z]||[],0===Z?v=w:(this._materialIndexLOD=null,this._materialPromiseLODs[Z].push(w))}return this._loader.logClose(),await v}))}_loadUriAsync(M,Z,P){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const c=this._nodeIndexLOD-1;return this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new x,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(M,Z,P)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const c=this._materialIndexLOD-1;return this._materialSignalLODs[c]=this._materialSignalLODs[c]||new x,this._materialSignalLODs[c].promise.then((async()=>await this._loader.loadUriAsync(M,Z,P)))}return null}loadBufferAsync(M,Z,P,c){if(this._loader.parent.useRangeRequests&&!Z.uri){if(!this._loader.bin)throw new Error(`${M}: Uri is missing or the binary glTF is missing its binary chunk`);const Z=async(M,Z)=>{const w=P,v=w+c-1;let G=M[Z];return G?(G.start=Math.min(G.start,w),G.end=Math.max(G.end,v)):(G={start:w,end:v,loaded:new x},M[Z]=G),await G.loaded.promise.then((M=>new Uint8Array(M.buffer,M.byteOffset+P-G.start,c)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Z(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Z(this._materialBufferLODs,this._materialIndexLOD):Z(this._bufferLODs,0)}return null}_loadBufferLOD(M,Z){const P=M[Z];P&&(this._loader.log(`Loading buffer range [${P.start}-${P.end}]`),this._loader.bin.readAsync(P.start,P.end-P.start+1).then((M=>{P.loaded.resolve(M)}),(M=>{P.loaded.reject(M)})))}_getLODs(M,Z,P,x){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const c=[];for(let w=x.length-1;w>=0;w--)if(c.push(a.Get(`${M}/ids/${x[w]}`,P,x[w])),c.length===this.maxLODsToLoad)return c;return c.push(Z),c}_disposeTransformNode(M){const Z=[],P=M.material;P&&Z.push(P);for(const c of M.getChildMeshes())c.material&&Z.push(c.material);M.dispose();const x=Z.filter((M=>this._loader.babylonScene.meshes.every((Z=>Z.material!=M))));this._disposeMaterials(x)}_disposeMaterials(M){const Z={};for(const P of M){for(const M of P.getActiveTextures())Z[M.uniqueId]=M;P.dispose()}for(const P in Z)for(const M of this._loader.babylonScene.materials)M.hasTexture(Z[P])&&delete Z[P];for(const P in Z)Z[P].dispose()}}r(mx),E(mx,!0,(M=>new KP(M)));const dP="MSFT_minecraftMesh";class OP{constructor(M){this.name=dP,this._loader=M,this.enabled=this._loader.isExtensionUsed(dP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtraAsync(M,Z,this.name,(async(x,c)=>{if(c){if(!(P instanceof N.d))throw new Error(`${x}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(M,Z,P);return P.needAlphaBlending()&&(P.forceDepthWrite=!0,P.separateCullingPass=!0),P.Dc=P.forceDepthWrite,P.twoSidedLighting=!0,await c}}))}}r(dP),E(dP,!0,(M=>new OP(M)));const HP="MSFT_sRGBFactors";class jP{constructor(M){this.name=HP,this._loader=M,this.enabled=this._loader.isExtensionUsed(HP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,Z,P){return f.LoadExtraAsync(M,Z,this.name,(async(x,c)=>{if(c){if(!(P instanceof N.d))throw new Error(`${x}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(M,Z,P),w=P.DM().getEngine().useExactSrgbConversions;return P.albedoTexture||P.albedoColor.toLinearSpaceToRef(P.albedoColor,w),P.reflectivityTexture||P.reflectivityColor.toLinearSpaceToRef(P.reflectivityColor,w),await c}}))}}r(HP),E(HP,!0,(M=>new jP(M)));var BP=P(14051);const UP={};var nP=P(14109),LP=P(14090),uP=P(14059),NP=P(14073);function JP(M,Z){for(const P of M)for(const M of P.dataOutputs)if(M.uniqueId===Z)return M;throw new Error("Could not find data out connection with unique id "+Z)}function tP(M,Z){for(const P of M)if(P instanceof LP.b)for(const M of P.signalInputs)if(M.uniqueId===Z)return M;throw new Error("Could not find signal in connection with unique id "+Z)}async function FP(M,Z){const x=await Promise.all(M.allBlocks.map((async M=>{const Z=function(M){switch(M){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([P.e(78),P.e(79)]).then(P.bind(P,15554))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await P.e(80).then(P.bind(P,15557))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await P.e(81).then(P.bind(P,15559))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await P.e(82).then(P.bind(P,15568))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await P.e(83).then(P.bind(P,15571))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await P.e(84).then(P.bind(P,15578))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await P.e(85).then(P.bind(P,15582))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await P.e(86).then(P.bind(P,15589))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await P.e(87).then(P.bind(P,15594))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await P.e(90).then(P.bind(P,15622))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await P.e(90).then(P.bind(P,15622))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await P.e(90).then(P.bind(P,15622))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await P.e(90).then(P.bind(P,15622))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await P.e(95).then(P.bind(P,15625))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await P.e(96).then(P.bind(P,15632))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await P.e(97).then(P.bind(P,15640))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await P.e(98).then(P.bind(P,15644))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await P.e(99).then(P.bind(P,15652))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await P.e(100).then(P.bind(P,15658))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await P.e(101).then(P.bind(P,15660))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await P.e(102).then(P.bind(P,15664))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await P.e(103).then(P.bind(P,15673))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await P.e(104).then(P.bind(P,15676))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await P.e(105).then(P.bind(P,15681))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await P.e(106).then(P.bind(P,15683))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await P.e(107).then(P.bind(P,15687))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await P.e(108).then(P.bind(P,15693))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await P.e(109).then(P.bind(P,15702))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await P.e(110).then(P.bind(P,15709))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await P.e(111).then(P.bind(P,15713))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await P.e(112).then(P.bind(P,15718))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await P.e(113).then(P.bind(P,15725))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await P.e(92).then(P.bind(P,15731))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await P.e(114).then(P.bind(P,15736))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await P.e(115).then(P.bind(P,15740))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await P.e(116).then(P.bind(P,15745))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await P.e(93).then(P.bind(P,15748))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await P.e(88).then(P.bind(P,15598))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await P.e(94).then(P.bind(P,15756))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await P.e(89).then(P.bind(P,15618))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await P.e(90).then(P.bind(P,15622))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await P.e(90).then(P.bind(P,15622))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await P.e(91).then(P.bind(P,15763))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await P.e(91).then(P.bind(P,15763))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await P.e(91).then(P.bind(P,15763))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await P.e(91).then(P.bind(P,15763))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await P.e(91).then(P.bind(P,15763))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await P.e(91).then(P.bind(P,15763))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await P.e(117).then(P.bind(P,15772))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await P.e(118).then(P.bind(P,15781))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await P.e(119).then(P.bind(P,15784))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await P.e(120).then(P.bind(P,15790))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await P.e(121).then(P.bind(P,15799))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await P.e(122).then(P.bind(P,15808))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await P.e(123).then(P.bind(P,15812))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await P.e(124).then(P.bind(P,15819))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await P.e(125).then(P.bind(P,15822))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await P.e(126).then(P.bind(P,15826))).FlowGraphDataSwitchBlock;default:if(UP[M])return UP[M];throw new Error(`Unknown block name ${M}`)}}(M.className);return await Z()})));return function(M,Z,P){const x=Z.coordinator.createGraph(),c=[],w=Z.valueParseFunction??uP.d;for(let v=0;v<M.allBlocks.length;v++){const G=lP(M.allBlocks[v],{nZ:Z.coordinator.config.nZ,pathConverter:Z.pathConverter,assetsContainer:Z.coordinator.config.nZ,valueParseFunction:w},P[v]);c.push(G),G instanceof nP.b&&x.addEventBlock(G)}for(const v of c){for(const M of v.dataInputs)for(const Z of M.connectedPointIds){const P=JP(c,Z);M.connectTo(P)}if(v instanceof LP.b)for(const M of v.signalOutputs)for(const Z of M.connectedPointIds){const P=tP(c,Z);M.connectTo(P)}}for(const v of M.executionContexts)DP(v,{graph:x,valueParseFunction:w},M.rightHanded);return x}(M,Z,x)}function DP(M,Z,P){const x=Z.graph.createContext();M.enableLogging&&(x.enableLogging=!0),x.treatDataAsRightHanded=P||!1;const c=Z.valueParseFunction??uP.d;x.uniqueId=M.uniqueId;const w=x.DM();if(M._assetsContext){var v,G,mM,K,d,O,H,j,B,U;const Z=M._assetsContext,P={meshes:null===(v=Z.meshes)||void 0===v?void 0:v.map((M=>w.getMeshById(M))),lights:null===(G=Z.lights)||void 0===G?void 0:G.map((M=>w.getLightByName(M))),cameras:null===(mM=Z.cameras)||void 0===mM?void 0:mM.map((M=>w.getCameraByName(M))),materials:null===(K=Z.materials)||void 0===K?void 0:K.map((M=>w.getMaterialById(M))),textures:null===(d=Z.textures)||void 0===d?void 0:d.map((M=>w.getTextureByName(M))),animations:null===(O=Z.animations)||void 0===O?void 0:O.map((M=>w.animations.find((Z=>Z.name===M)))),skeletons:null===(H=Z.skeletons)||void 0===H?void 0:H.map((M=>w.getSkeletonByName(M))),SH:null===(j=Z.SH)||void 0===j?void 0:j.map((M=>w.getParticleSystemById(M))),animationGroups:null===(B=Z.animationGroups)||void 0===B?void 0:B.map((M=>w.getAnimationGroupByName(M))),transformNodes:null===(U=Z.transformNodes)||void 0===U?void 0:U.map((M=>w.getTransformNodeById(M))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Cj:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};x.assetsContext=P}for(const n in M._userVariables){const Z=c(n,M._userVariables,x.assetsContext,w);x.userVariables[n]=Z}for(const n in M._connectionValues){const Z=c(n,M._connectionValues,x.assetsContext,w);x._setConnectionValueByKey(n,Z)}return x}function lP(M,Z,P){const x={},c=Z.valueParseFunction??uP.d;if(M.config)for(const v in M.config)x[v]=c(v,M.config,Z.assetsContainer||Z.nZ,Z.nZ);if((0,uP.j)(M.className)){if(!Z.pathConverter)throw new Error("Path converter is required for this block");x.pathConverter=Z.pathConverter}const w=new P(x);w.uniqueId=M.uniqueId;for(let v=0;v<M.dataInputs.length;v++){const Z=w.getDataInput(M.dataInputs[v].name);if(!Z)throw new Error("Could not find data input with name "+M.dataInputs[v].name+" in block "+M.className);Z.deserialize(M.dataInputs[v])}for(let v=0;v<M.dataOutputs.length;v++){const Z=w.getDataOutput(M.dataOutputs[v].name);if(!Z)throw new Error("Could not find data output with name "+M.dataOutputs[v].name+" in block "+M.className);Z.deserialize(M.dataOutputs[v])}return w.metadata=M.metadata,w.deserialize&&w.deserialize(M),w}function hP(M){const[Z,P]=M.split(":");return QP({op:Z,extension:P})}function QP(M){var Z;let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const x=M.extension?null===(Z=sP[M.extension])||void 0===Z?void 0:Z[M.op]:CP[M.op];if(!x&&(U.d.Warn(`No mapping found for operation ${M.op} and extension ${M.extension||"KHR_interactivity"}`),P)){const Z={},P={flows:{}};if(M.inputValueSockets){Z.values={};for(const P in M.inputValueSockets)Z.values[P]={name:P}}return M.outputValueSockets&&(P.values={},Object.keys(M.outputValueSockets).forEach((M=>{P.values[M]={name:M}}))),{UO:[],inputs:Z,outputs:P}}return x}function IP(M,Z,P){sP[Z]||(sP[Z]={}),sP[Z][M]=P}const sP={BABYLON:{"flow/log":{UO:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},CP={"event/onStart":{UO:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{UO:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{UO:["FlowGraphSendCustomEventBlock"],extraProcessor(M,Z,P,x,c){if("event/send"!==Z.op||!M.configuration||1!==Object.keys(M.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const w=M.configuration.event.value[0];if("number"!==typeof w)throw new Error("Event id should be a number");const v=x.arrays.events[w],G=c[0];return G.config||(G.config={}),G.config.eventId=v.eventId,G.config.eventData=v.eventData,c}},"event/receive":{UO:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(M,Z){var P;if(!M.configuration)return U.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const x=M.configuration.event;if(!x)return U.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const c=x.value[0];if("number"!==typeof c)return U.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(P=Z.events)||void 0===P?void 0:P[c])?{valid:!0}:(U.d.Error(`Event with id ${c} not found`),{valid:!1,error:`Event with id ${c} not found`})},extraProcessor(M,Z,P,x,c){if("event/receive"!==Z.op||!M.configuration||1!==Object.keys(M.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const w=M.configuration.event.value[0];if("number"!==typeof w)throw new Error("Event id should be a number");const v=x.arrays.events[w],G=c[0];return G.config||(G.config={}),G.config.eventId=v.eventId,G.config.eventData=v.eventData,c}},"math/e":RP("FlowGraphEBlock"),"math/pi":RP("FlowGraphPIBlock"),"math/inf":RP("FlowGraphInfBlock"),"math/nan":RP("FlowGraphNaNBlock"),"math/abs":RP("FlowGraphAbsBlock"),"math/sign":RP("FlowGraphSignBlock"),"math/trunc":RP("FlowGraphTruncBlock"),"math/floor":RP("FlowGraphFloorBlock"),"math/ceil":RP("FlowGraphCeilBlock"),"math/round":{UO:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c){var w;return(w=c[0]).config||(w.config={}),c[0].config.roundHalfAwayFromZero=!0,c}},"math/fract":RP("FlowGraphFractBlock"),"math/neg":RP("FlowGraphNegationBlock"),"math/add":RP("FlowGraphAddBlock",["a","b"],!0),"math/sub":RP("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{UO:["FlowGraphMultiplyBlock"],extraProcessor(M,Z,P,x,c){var w;(w=c[0]).config||(w.config={}),c[0].config.useMatrixPerComponent=!0,c[0].config.preventIntegerFloatArithmetic=!0;let v=-1;return Object.keys(M.values||{}).find((Z=>{var P;return void 0!==(null===(P=M.values)||void 0===P?void 0:P[Z].type)&&(v=M.values[Z].type,!0)})),-1!==v&&(c[0].config.type=x.arrays.types[v].flowGraphType),c},validation:M=>M.values?WP(M):{valid:!0}},"math/div":RP("FlowGraphDivideBlock",["a","b"],!0),"math/rem":RP("FlowGraphModuloBlock",["a","b"]),"math/min":RP("FlowGraphMinBlock",["a","b"]),"math/max":RP("FlowGraphMaxBlock",["a","b"]),"math/clamp":RP("FlowGraphClampBlock",["a","b","c"]),"math/saturate":RP("FlowGraphSaturateBlock"),"math/mix":RP("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":RP("FlowGraphEqualityBlock",["a","b"]),"math/lt":RP("FlowGraphLessThanBlock",["a","b"]),"math/le":RP("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":RP("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":RP("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":RP("FlowGraphIsNaNBlock"),"math/isinf":RP("FlowGraphIsInfBlock"),"math/select":{UO:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{UO:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":RP("FlowGraphSinBlock"),"math/cos":RP("FlowGraphCosBlock"),"math/tan":RP("FlowGraphTanBlock"),"math/asin":RP("FlowGraphASinBlock"),"math/acos":RP("FlowGraphACosBlock"),"math/atan":RP("FlowGraphATanBlock"),"math/atan2":RP("FlowGraphATan2Block",["a","b"]),"math/sinh":RP("FlowGraphSinhBlock"),"math/cosh":RP("FlowGraphCoshBlock"),"math/tanh":RP("FlowGraphTanhBlock"),"math/asinh":RP("FlowGraphASinhBlock"),"math/acosh":RP("FlowGraphACoshBlock"),"math/atanh":RP("FlowGraphATanhBlock"),"math/exp":RP("FlowGraphExponentialBlock"),"math/log":RP("FlowGraphLogBlock"),"math/log2":RP("FlowGraphLog2Block"),"math/log10":RP("FlowGraphLog10Block"),"math/sqrt":RP("FlowGraphSquareRootBlock"),"math/cbrt":RP("FlowGraphCubeRootBlock"),"math/pow":RP("FlowGraphPowerBlock",["a","b"]),"math/length":RP("FlowGraphLengthBlock"),"math/normalize":RP("FlowGraphNormalizeBlock"),"math/dot":RP("FlowGraphDotBlock",["a","b"]),"math/cross":RP("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":RP("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":RP("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{UO:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{UO:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{UO:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{UO:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{UO:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{UO:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{UO:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":RP("FlowGraphTransposeBlock"),"math/determinant":RP("FlowGraphDeterminantBlock"),"math/inverse":RP("FlowGraphInvertMatrixBlock"),"math/matmul":RP("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{UO:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"hc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c,w){const v=c[0].dataInputs.find((M=>"rotationQuaternion"===M.name));if(!v)throw new Error("Rotation quaternion input not found");return w._connectionValues[v.uniqueId]&&(w._connectionValues[v.uniqueId].type="Quaternion"),c}},"math/matDecompose":{UO:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"hc"}}}},"math/quatConjugate":RP("FlowGraphConjugateBlock",["a"]),"math/quatMul":{UO:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c){var w;return(w=c[0]).config||(w.config={}),c[0].config.type="Quaternion",c}},"math/quatAngleBetween":RP("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{UO:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":RP("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":RP("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{UO:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c){var w;return(w=c[0]).config||(w.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract2x2":{UO:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{UO:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c){var w;return(w=c[0]).config||(w.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract3x3":{UO:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{UO:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c){var w;return(w=c[0]).config||(w.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract4x4":{UO:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{UO:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c,w){var v,G;(G=c[0]).config||(G.config={});const mM=c[0].dataInputs[0];return c[0].config.valueType=(null===(v=w._connectionValues[mM.uniqueId])||void 0===v?void 0:v.type)??"FlowGraphInteger",c}},"math/and":{UO:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c,w){var v,G,mM;(mM=c[0]).config||(mM.config={});const K=c[0].dataInputs[0],d=c[0].dataInputs[1];return c[0].config.valueType=(null===(v=w._connectionValues[K.uniqueId])||void 0===v?void 0:v.type)??(null===(G=w._connectionValues[d.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",c}},"math/or":{UO:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c,w){var v,G,mM;(mM=c[0]).config||(mM.config={});const K=c[0].dataInputs[0],d=c[0].dataInputs[1];return c[0].config.valueType=(null===(v=w._connectionValues[K.uniqueId])||void 0===v?void 0:v.type)??(null===(G=w._connectionValues[d.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",c}},"math/xor":{UO:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,Z,P,x,c,w){var v,G,mM;(mM=c[0]).config||(mM.config={});const K=c[0].dataInputs[0],d=c[0].dataInputs[1];return c[0].config.valueType=(null===(v=w._connectionValues[K.uniqueId])||void 0===v?void 0:v.type)??(null===(G=w._connectionValues[d.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",c}},"math/asr":RP("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":RP("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":RP("FlowGraphLeadingZerosBlock"),"math/ctz":RP("FlowGraphTrailingZerosBlock"),"math/popcnt":RP("FlowGraphOneBitsCounterBlock"),"math/rad":RP("FlowGraphDegToRadBlock"),"math/deg":RP("FlowGraphRadToDegBlock"),"type/boolToInt":RP("FlowGraphBooleanToInt"),"type/boolToFloat":RP("FlowGraphBooleanToFloat"),"type/intToBool":RP("FlowGraphIntToBoolean"),"type/intToFloat":RP("FlowGraphIntToFloat"),"type/floatToInt":RP("FlowGraphFloatToInt"),"type/floatToBool":RP("FlowGraphFloatToBoolean"),"flow/sequence":{UO:["FlowGraphSequenceBlock"],extraProcessor(M,Z,P,x,c){const w=c[0];return w.config||(w.config={}),w.config.outputSignalCount=Object.keys(M.flows||[]).length,w.signalOutputs.forEach(((M,Z)=>{M.name="out_"+Z})),c}},"flow/branch":{UO:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{UO:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(M){if(M.configuration&&M.configuration.cases){const Z=M.configuration.cases.value;if(!Z.every((M=>"number"===typeof M&&/^-?\d+$/.test(M.toString()))))return U.d.Warn("Switch cases should be integers. Using empty array instead."),M.configuration.cases.value=[],{valid:!0};const P=new Set(Z);M.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(M,Z,P,x,c){if("flow/switch"!==Z.op||!M.flows||0===Object.keys(M.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return c[0].signalOutputs.forEach((M=>{"default"!==M.name&&(M.name="out_"+M.name)})),c}},"flow/while":{UO:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{UO:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(M,Z,P,x,c){const w=c[0];return w.config||(w.config={}),w.config.incrementIndexWhenLoopDone=!0,c}},"flow/doN":{UO:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{UO:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(M,Z,P,x,c){if("flow/multiGate"!==Z.op||!M.flows||0===Object.keys(M.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const w=c[0];return w.config||(w.config={}),w.config.outputSignalCount=Object.keys(M.flows).length,w.signalOutputs.forEach(((M,Z)=>{M.name="out_"+Z})),c}},"flow/waitAll":{UO:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(M){var Z,P;return"number"!==typeof(null===(Z=M.configuration)||void 0===Z||null===(P=Z.inputFlows)||void 0===P?void 0:P.value[0])&&(M.configuration=M.configuration||{inputFlows:{value:[0]}},M.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{UO:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{UO:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{UO:["FlowGraphCancelDelayBlock"]},"variable/get":{UO:["FlowGraphGetVariableBlock"],validation(M){var Z,P;return null!==(Z=M.configuration)&&void 0!==Z&&null!==(P=Z.variable)&&void 0!==P&&P.value?{valid:!0}:(U.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(M,Z)=>[Z.getVariableName(M[0])]}}},"variable/set":{UO:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(M,Z)=>[Z.getVariableName(M[0])]}}},"variable/setMultiple":{UO:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(M,Z)=>[M[0].map((M=>Z.getVariableName(M)))]}},extraProcessor:(M,Z,P,x,c)=>(c[0].dataInputs.forEach((M=>{M.name=x.getVariableName(+M.name)})),c)},"variable/interpolate":{UO:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(M,Z)=>[Z.getVariableName(M[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:M=>!0===M[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",NP:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",NP:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",NP:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",NP:"FlowGraphPlayAnimationBlock"},out:{name:"out",NP:"FlowGraphPlayAnimationBlock"},done:{name:"done",NP:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(M,Z,P,x,c){var w,v,G;const mM=c[0],K=null===(w=M.configuration)||void 0===w?void 0:w.variable.value[0];if("number"!==typeof K)throw U.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const d=x.arrays.staticVariables[K];"undefined"===typeof mM.config.animationType.value&&(x.arrays.staticVariables,mM.config.animationType.value=(0,NP.N)(d.type));const O=c[4];return O.config||(O.config={}),(v=O.config).variable||(v.variable={}),O.config.variable.value=x.getVariableName(K),(G=c[3]).config||(G.config={}),c}},"pointer/get":{UO:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",NP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",NP:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,Z,P,x,c)=>(c.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className&&(M.config||(M.config={}),M.config.outputValue=!0)})),c)},"pointer/set":{UO:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",NP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",NP:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,Z,P,x,c)=>(c.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className&&(M.config||(M.config={}),M.config.outputValue=!0)})),c)},"pointer/interpolate":{UO:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",NP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",NP:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",NP:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",NP:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",NP:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",NP:"FlowGraphPlayAnimationBlock"},out:{name:"out",NP:"FlowGraphPlayAnimationBlock"},done:{name:"done",NP:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,Z,P,x,c)=>(c.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className?(Z.config||(Z.config={}),Z.config.outputValue=!0):"FlowGraphInterpolationBlock"===Z.className&&(Z.config||(Z.config={}),Object.keys(M.values||[]).forEach((P=>{var c;const w=null===(c=M.values)||void 0===c?void 0:c[P];if("value"===P&&w){const M=w.type;void 0!==M&&(Z.config.animationType=x.arrays.types[M].flowGraphType)}})))})),c)},"animation/start":{UO:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",NP:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(M,Z)=>[M[0]*Z._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(M,Z)=>[M[0]*Z._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,Z,P,x,c,w,v){const G=c[c.length-1];return G.config||(G.config={}),G.config.glTF=v,c}},"animation/stop":{UO:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",NP:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,Z,P,x,c,w,v){const G=c[c.length-1];return G.config||(G.config={}),G.config.glTF=v,c}},"animation/stopAt":{UO:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",NP:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(M,Z)=>[M[0]*Z._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,Z,P,x,c,w,v){const G=c[c.length-1];return G.config||(G.config={}),G.config.glTF=v,c}},"math/switch":{UO:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(M){if(M.configuration&&M.configuration.cases){const Z=M.configuration.cases.value;if(!Z.every((M=>"number"===typeof M&&/^-?\d+$/.test(M.toString()))))return U.d.Warn("Switch cases should be integers. Using empty array instead."),M.configuration.cases.value=[],{valid:!0};const P=new Set(Z);M.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(M,Z,P,x,c){const w=c[0];return w.dataInputs.forEach((M=>{"default"!==M.name&&"case"!==M.name&&(M.name="in_"+M.name)})),w.config||(w.config={}),w.config.treatCasesAsIntegers=!0,c}},"debug/log":{UO:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function RP(M){let Z=arguments.length>2?arguments[2]:void 0;return{UO:[M],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((M,Z)=>(M[Z]={name:Z},M)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(M,P,x,c,w){var v;if(Z){(v=w[0]).config||(v.config={}),w[0].config.preventIntegerFloatArithmetic=!0;let Z=-1;Object.keys(M.values||{}).find((P=>{var x;return void 0!==(null===(x=M.values)||void 0===x?void 0:x[P].type)&&(Z=M.values[P].type,!0)})),-1!==Z&&(w[0].config.type=c.arrays.types[Z].flowGraphType)}return w},validation:M=>Z?WP(M):{valid:!0}}}function WP(M){if(M.values){const Z=Object.keys(M.values).map((Z=>M.values[Z].type)).filter((M=>void 0!==M));if(!Z.every((M=>M===Z[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}CP["math/compose"]=CP["math/matCompose"],CP["math/decompose"]=CP["math/matDecompose"];var kP=P(12325);const AP={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"BZ",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class oP{constructor(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=M,this._gltf=Z,this._animationTargetFps=P,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const M of this._interactivityGraph.types)this._types.push(AP[M.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const M of this._interactivityGraph.declarations){const Z=QP(M);if(!Z)throw U.d.Error(["No mapping found for declaration",M]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:Z,fullOperationName:M.extension?M.op+":"+M.extension:M.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const M of this._interactivityGraph.variables){const Z=this._parseVariable(M);this._staticVariables.push(Z)}}_parseVariable(M,Z){const P=this._types[M.type];if(!P)throw U.d.Error(["No type found for variable",M]),new Error("Error parsing variables");if(M.value&&M.value.length!==P.length)throw U.d.Error(["Invalid value length for variable",M,P]),new Error("Error parsing variables");const x=M.value||[];if(!x.length)switch(P.flowGraphType){case"boolean":x.push(!1);break;case"FlowGraphInteger":x.push(0);break;case"number":x.push(NaN);break;case"Vector2":x.push(NaN,NaN);break;case"BZ":x.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":x.fill(NaN,0,4);break;case"Matrix":x.fill(NaN,0,16);break;case"Matrix3D":x.fill(NaN,0,9)}return"number"===P.elementType&&"string"===typeof x[0]&&(x[0]=parseFloat(x[0])),{type:P.flowGraphType,value:Z?Z(x,this):x}}_parseEvents(){if(this._interactivityGraph.events)for(const M of this._interactivityGraph.events){const Z={eventId:M.id||"internalEvent_"+this._internalEventsCounter++};M.values&&(Z.eventData=Object.keys(M.values).map((Z=>{var P;const x=null===(P=M.values)||void 0===P?void 0:P[Z];if(!x)throw U.d.Error(["No value found for event key",Z]),new Error("Error parsing events");const c=this._types[x.type];if(!c)throw U.d.Error(["No type found for event value",x]),new Error("Error parsing events");const w="undefined"!==typeof x.value?this._parseVariable(x):void 0;return{id:Z,type:c.flowGraphType,eventData:!0,value:w}}))),this._events.push(Z)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const Z of this._interactivityGraph.nodes){if("number"!==typeof Z.declaration)throw U.d.Error(["No declaration found for node",Z]),new Error("Error parsing nodes");const P=this._mappings[Z.declaration];if(!P)throw U.d.Error(["No mapping found for node",Z]),new Error("Error parsing nodes");if(P.flowGraphMapping.validation){const x=P.flowGraphMapping.validation(Z,this._interactivityGraph,this._gltf);var M;if(!x.valid)throw new Error(`Error validating interactivity node ${null===(M=this._interactivityGraph.declarations)||void 0===M?void 0:M[Z.declaration].op} - ${x.error}`)}const x=[];for(const M of P.flowGraphMapping.UO){const c=this._getEmptyBlock(M,P.fullOperationName);this._parseNodeConfiguration(Z,c,P.flowGraphMapping,M),x.push(c)}this._nodes.push({UO:x,fullOperationName:P.fullOperationName})}}_getEmptyBlock(M,Z){return{uniqueId:(0,kP.c)(),className:M,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:Z,metadata:{}}}_parseNodeConfiguration(M,Z,P,x){const c=Z.config;if(M.configuration){const Z=Object.keys(M.configuration);for(const G of Z){var w,v;const Z=null===(w=M.configuration)||void 0===w?void 0:w[G];if(!Z)throw U.d.Error(["No value found for node configuration",G]),new Error("Error parsing node configuration");const mM=null===(v=P.configuration)||void 0===v?void 0:v[G];if(mM&&mM.NP?mM.NP===x:0===P.UO.indexOf(x)){const M=(null===mM||void 0===mM?void 0:mM.name)||G;Z&&"undefined"!==typeof Z.value||"undefined"===typeof(null===mM||void 0===mM?void 0:mM.defaultValue)?Z.value.length>=0?c[M]={value:1===Z.value.length?Z.value[0]:Z.value}:U.d.Warn(["Invalid value for node configuration",Z]):c[M]={value:mM.defaultValue},mM&&mM.dataTransformer&&(c[M].value=mM.dataTransformer([c[M].value],this)[0])}}}}_parseNodeConnections(M){for(let F=0;F<this._nodes.length;F++){var Z;const D=null===(Z=this._interactivityGraph.nodes)||void 0===Z?void 0:Z[F];if(!D)throw U.d.Error(["No node found for interactivity node",this._nodes[F]]),new Error("Error parsing node connections");const l=this._nodes[F],h=this._mappings[D.declaration];if(!h)throw U.d.Error(["No mapping found for node",D]),new Error("Error parsing node connections");const Q=D.flows||{},I=Object.keys(Q).sort();for(const M of I){var P,x,c,w;const Z=Q[M],K=null===(P=h.flowGraphMapping.outputs)||void 0===P||null===(x=P.flows)||void 0===x?void 0:x[M],d=(null===K||void 0===K?void 0:K.name)||M,O=this._createNewSocketConnection(d,!0);(K&&K.NP&&l.UO.find((M=>M.className===K.NP))||l.UO[0]).signalOutputs.push(O);const H=Z.node,j=this._nodes[H];if(!j)throw U.d.Error(["No node found for input node id",H]),new Error("Error parsing node connections");const B=hP(j.fullOperationName);if(!B)throw U.d.Error(["No mapping found for input node",j]),new Error("Error parsing node connections");let n=null===(c=B.inputs)||void 0===c||null===(w=c.flows)||void 0===w?void 0:w[Z.socket||"in"],L=!1;if(!n)for(const M in null===(v=B.inputs)||void 0===v?void 0:v.flows){var v,G,mM;if(M.startsWith("[")&&M.endsWith("]"))L=!0,n=null===(G=B.inputs)||void 0===G||null===(mM=G.flows)||void 0===mM?void 0:mM[M]}const u=n?L?n.name.replace("$1",Z.socket||""):n.name:Z.socket||"in",N=n&&n.NP&&j.UO.find((M=>M.className===n.NP))||j.UO[0];let J=N.signalInputs.find((M=>M.name===u));J||(J=this._createNewSocketConnection(u),N.signalInputs.push(J)),J.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(J.uniqueId)}const s=D.values||{},C=Object.keys(s);for(const Z of C){var K,d;const P=s[Z];let x=null===(K=h.flowGraphMapping.inputs)||void 0===K||null===(d=K.values)||void 0===d?void 0:d[Z],c=!1;if(!x)for(const M in null===(O=h.flowGraphMapping.inputs)||void 0===O?void 0:O.values){var O,H,j;if(M.startsWith("[")&&M.endsWith("]"))c=!0,x=null===(H=h.flowGraphMapping.inputs)||void 0===H||null===(j=H.values)||void 0===j?void 0:j[M]}const w=x?c?x.name.replace("$1",Z):x.name:Z,v=this._createNewSocketConnection(w);if((x&&x.NP&&l.UO.find((M=>M.className===x.NP))||l.UO[0]).dataInputs.push(v),void 0!==P.value){const Z=this._parseVariable(P,x&&x.dataTransformer);M._connectionValues[v.uniqueId]=Z}else{if("undefined"===typeof P.node)throw U.d.Error(["Invalid value for value connection",P]),new Error("Error parsing node connections");{var B,n,L;const M=P.node,Z=P.socket||"value",x=this._nodes[M];if(!x)throw U.d.Error(["No node found for output socket reference",P]),new Error("Error parsing node connections");const c=hP(x.fullOperationName);if(!c)throw U.d.Error(["No mapping found for output socket reference",P]),new Error("Error parsing node connections");let w=null===(B=c.outputs)||void 0===B||null===(n=B.values)||void 0===n?void 0:n[Z],G=!1;if(!w)for(const P in null===(u=c.outputs)||void 0===u?void 0:u.values){var u,N,J;if(P.startsWith("[")&&P.endsWith("]"))G=!0,w=null===(N=c.outputs)||void 0===N||null===(J=N.values)||void 0===J?void 0:J[P]}const mM=w?G?w.name.replace("$1",Z):null===(L=w)||void 0===L?void 0:L.name:Z,K=w&&w.NP&&x.UO.find((M=>M.className===w.NP))||x.UO[0];let d=K.dataOutputs.find((M=>M.name===mM));d||(d=this._createNewSocketConnection(mM,!0),K.dataOutputs.push(d)),v.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(v.uniqueId)}}}if(h.flowGraphMapping.interBlockConnectors)for(const M of h.flowGraphMapping.interBlockConnectors){const Z=M.input,P=M.output,x=M.isVariable;this._connectFlowGraphNodes(Z,P,l.UO[M.inputBlockIndex],l.UO[M.outputBlockIndex],x)}if(h.flowGraphMapping.extraProcessor){var t;const Z=null===(t=this._interactivityGraph.declarations)||void 0===t?void 0:t[D.declaration];if(!Z)throw U.d.Error(["No declaration found for extra processor",D]),new Error("Error parsing node connections");l.UO=h.flowGraphMapping.extraProcessor(D,Z,h.flowGraphMapping,this,l.UO,M,this._gltf)}}}_createNewSocketConnection(M,Z){return{uniqueId:(0,kP.c)(),name:M,_connectionType:Z?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(M,Z,P,x,c){const w=c?P.dataInputs:P.signalInputs,v=c?x.dataOutputs:x.signalOutputs,G=w.find((Z=>Z.name===M))||this._createNewSocketConnection(M),mM=v.find((M=>M.name===Z))||this._createNewSocketConnection(Z,!0);w.find((Z=>Z.name===M))||w.push(G),v.find((M=>M.name===Z))||v.push(mM),G.connectedPointIds.push(mM.uniqueId),mM.connectedPointIds.push(G.uniqueId)}getVariableName(M){return"staticVariable_"+M}serializeToFlowGraph(){const M={uniqueId:(0,kP.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(M);for(let Z=0;Z<this._staticVariables.length;Z++){const P=this._staticVariables[Z];M._userVariables[this.getVariableName(Z)]=P}return{rightHanded:!0,allBlocks:this._nodes.reduce(((M,Z)=>M.concat(Z.UO)),[]),executionContexts:[M]}}}const EP="KHR_interactivity";class rP{constructor(M){this._loader=M,this.name=EP,this.enabled=this._loader.isExtensionUsed(EP),this._pathConverter=(0,q.g)(this._loader.jc),M._skipStartAnimationStep=!0;const Z=M.babylonScene;Z&&function(M){(0,q.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!M.activeCamera)return new c.Quaternion(NaN,NaN,NaN,NaN);const Z=c.Quaternion.FromRotationMatrix(M.activeCamera.getWorldMatrix()).normalize();return M.useRightHandedSystem||(Z.w*=-1,Z.x*=-1),Z},type:"Quaternion",getTarget:()=>M.activeCamera}),(0,q.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!M.activeCamera)return new c.BZ(NaN,NaN,NaN);const Z=M.activeCamera.getWorldMatrix().getTranslation();return M.useRightHandedSystem||(Z.x*=-1),Z},type:"BZ",getTarget:()=>M.activeCamera}),(0,q.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:M=>{var Z;return(null===(Z=M._babylonAnimationGroup)||void 0===Z?void 0:Z.isPlaying)??!1},type:"boolean",getTarget:M=>M._babylonAnimationGroup}),(0,q.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:M=>{var Z;return((null===(Z=M._babylonAnimationGroup)||void 0===Z?void 0:Z.from)??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,q.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:M=>{var Z;return((null===(Z=M._babylonAnimationGroup)||void 0===Z?void 0:Z.to)??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,q.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:M=>{var Z;return((null===(Z=M._babylonAnimationGroup)||void 0===Z?void 0:Z.getCurrentFrame())??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,q.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:M=>{var Z;return((null===(Z=M._babylonAnimationGroup)||void 0===Z?void 0:Z.getCurrentFrame())??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup})}(Z)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var M;if(!this._loader.babylonScene||!this._pathConverter)return;const Z=this._loader.babylonScene,P=null===(M=this._loader.jc.extensions)||void 0===M?void 0:M.KHR_interactivity;if(!P)return;const x=new BP.d({nZ:Z});x.dispatchEventsSynchronously=!1;const c=P.graphs.map((M=>new oP(M,this._loader.jc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(c.map((async M=>await FP(M,{coordinator:x,pathConverter:this._pathConverter})))),x.start()}}var qP;qP=async()=>(await Promise.resolve().then(P.bind(P,14124))).FlowGraphGLTFDataProvider,UP[`${EP}/${"FlowGraphGLTFDataProvider"}`]=qP,r(EP),E(EP,!0,(M=>new rP(M)));const eP="KHR_node_visibility";(0,q.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:M=>{const Z=M._babylonTransformNode;return!Z||void 0===Z.isVisible||Z.isVisible},set:(M,Z)=>{var P,x;null===(P=Z._primitiveBabylonMeshes)||void 0===P||P.forEach((M=>{M.inheritVisibility=!0})),Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=M),null===(x=Z._primitiveBabylonMeshes)||void 0===x||x.forEach((Z=>{Z.isVisible=M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class bP{constructor(M){this.name=eP,this._loader=M,this.enabled=M.isExtensionUsed(eP)}async onReady(){var M;null===(M=this._loader.jc.nodes)||void 0===M||M.forEach((M=>{var Z,P,x,c;(null===(Z=M._primitiveBabylonMeshes)||void 0===Z||Z.forEach((M=>{M.inheritVisibility=!0})),null!==(P=M.extensions)&&void 0!==P&&P.KHR_node_visibility)&&(!1===(null===(x=M.extensions)||void 0===x?void 0:x.KHR_node_visibility.visible)&&(M._babylonTransformNode&&(M._babylonTransformNode.isVisible=!1),null===(c=M._primitiveBabylonMeshes)||void 0===c||c.forEach((M=>{M.isVisible=!1}))))}))}dispose(){this._loader=null}}r(eP),E(eP,!0,(M=>new bP(M)));const aP="KHR_node_selectability";IP("event/onSelect",aP,{UO:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",NP:"FlowGraphGetVariableBlock",dataTransformer:M=>["pickedMesh_"+M[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",NP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,Z,P,x,c,w,v){var G,mM,K,d,O,H;const j=c[c.length-1];j.config=j.config||{},j.config.glTF=v;const B=null===(G=M.configuration)||void 0===G||null===(mM=G.nodeIndex)||void 0===mM?void 0:mM.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const U="pickedMesh_"+B;return c[1].config.variable=U,w._userVariables[U]={className:"Mesh",id:null===v||void 0===v||null===(K=v.nodes)||void 0===K||null===(d=K[B]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===v||void 0===v||null===(O=v.nodes)||void 0===O||null===(H=O[B]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},c}}),(0,q.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:M=>{const Z=M._babylonTransformNode;return!Z||void 0===Z.jK||Z.jK},set:(M,Z)=>{var P;null===(P=Z._primitiveBabylonMeshes)||void 0===P||P.forEach((Z=>{Z.jK=M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"jK"],type:"boolean"});class yP{constructor(M){this.name=aP,this._loader=M,this.enabled=M.isExtensionUsed(aP)}async onReady(){var M;null===(M=this._loader.jc.nodes)||void 0===M||M.forEach((M=>{var Z,P,x;null!==(Z=M.extensions)&&void 0!==Z&&Z.KHR_node_selectability&&!1===(null===(P=M.extensions)||void 0===P?void 0:P.KHR_node_selectability.selectable)&&(null===(x=M._babylonTransformNode)||void 0===x||x.getChildMeshes().forEach((M=>{M.jK=!1})))}))}dispose(){this._loader=null}}r(aP),E(aP,!0,(M=>new yP(M)));const fP="KHR_node_hoverability",YP="targetMeshPointerOver_";IP("event/onHoverIn",fP,{UO:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",NP:"FlowGraphGetVariableBlock",dataTransformer:M=>[YP+M[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",NP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,Z,P,x,c,w,v){var G,mM,K,d,O,H;const j=c[c.length-1];j.config=j.config||{},j.config.glTF=v;const B=null===(G=M.configuration)||void 0===G||null===(mM=G.nodeIndex)||void 0===mM?void 0:mM.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const U=YP+B;return c[1].config.variable=U,w._userVariables[U]={className:"Mesh",id:null===v||void 0===v||null===(K=v.nodes)||void 0===K||null===(d=K[B]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===v||void 0===v||null===(O=v.nodes)||void 0===O||null===(H=O[B]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},c}});const zP="targetMeshPointerOut_";IP("event/onHoverOut",fP,{UO:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",NP:"FlowGraphGetVariableBlock",dataTransformer:M=>[zP+M[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",NP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,Z,P,x,c,w,v){var G,mM,K,d,O,H;const j=c[c.length-1];j.config=j.config||{},j.config.glTF=v;const B=null===(G=M.configuration)||void 0===G||null===(mM=G.nodeIndex)||void 0===mM?void 0:mM.value[0];if(void 0===B||"number"!==typeof B)throw new Error("nodeIndex not found in configuration");const U=zP+B;return c[1].config.variable=U,w._userVariables[U]={className:"Mesh",id:null===v||void 0===v||null===(K=v.nodes)||void 0===K||null===(d=K[B]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===v||void 0===v||null===(O=v.nodes)||void 0===O||null===(H=O[B]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},c}}),(0,q.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:M=>{const Z=M._babylonTransformNode;return!Z||void 0===Z.pointerOverDisableMeshTesting||Z.pointerOverDisableMeshTesting},set:(M,Z)=>{var P;null===(P=Z._primitiveBabylonMeshes)||void 0===P||P.forEach((Z=>{Z.pointerOverDisableMeshTesting=!M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class iP{constructor(M){this.name=fP,this._loader=M,this.enabled=M.isExtensionUsed(fP)}async onReady(){var M;null===(M=this._loader.jc.nodes)||void 0===M||M.forEach((M=>{var Z,P,x;null!==(Z=M.extensions)&&void 0!==Z&&Z.KHR_node_hoverability&&!1===(null===(P=M.extensions)||void 0===P?void 0:P.KHR_node_hoverability.hoverable)&&(null===(x=M._babylonTransformNode)||void 0===x||x.getChildMeshes().forEach((M=>{M.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}r(fP),E(fP,!0,(M=>new iP(M)));const TP="ExtrasAsMetadata";class pP{_assignExtras(M,Z){if(Z.extras&&Object.keys(Z.extras).length>0){const P=M.metadata=M.metadata||{};(P.jc=P.jc||{}).extras=Z.extras}}constructor(M){this.name=TP,this.enabled=!0,this._loader=M}dispose(){this._loader=null}loadNodeAsync(M,Z,P){return this._loader.loadNodeAsync(M,Z,(M=>{this._assignExtras(M,Z),P(M)}))}loadCameraAsync(M,Z,P){return this._loader.loadCameraAsync(M,Z,(M=>{this._assignExtras(M,Z),P(M)}))}createMaterial(M,Z,P){const x=this._loader.createMaterial(M,Z,P);return this._assignExtras(x,Z),x}}r(TP),E(TP,!1,(M=>new pP(M)));P(14124)},14002:(M,Z,P)=>{"use strict";P.d(Z,{e:()=>W,f:()=>h,g:()=>l,k:()=>Q});var x=P(12184),c=P(12175),w=P(13642),v=P(12825),G=P(12784),mM=P(12800),K=P(12199),d=P(12225),O=P(12821),H=P(12902),j=P(12828),B=P(12398);class U{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.SH=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Cj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(M){this._environmentTexture=M}getNodes(){let M=[];M=M.concat(this.meshes),M=M.concat(this.lights),M=M.concat(this.cameras),M=M.concat(this.transformNodes);for(const Z of this.skeletons)M=M.concat(Z.bones);return M}}class n extends U{}class L{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const M=this.rootNodes;for(const x of M)x.dispose();M.length=0;const Z=this.skeletons;for(const x of Z)x.dispose();Z.length=0;const P=this.animationGroups;for(const x of P)x.dispose();P.length=0}}class u extends U{constructor(M){super(),this._wasAddedToScene=!1,(M=M||d.b.LastCreatedScene)&&(this.nZ=M,this.proceduralTextures=[],M.Gc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=M.getEngine().onContextRestoredObservable.add((()=>{for(const M of this.geometries)M._rebuild();for(const M of this.meshes)M._rebuild();for(const M of this.SH)M.rebuild();for(const M of this.textures)M._rebuild()})))}_topologicalSort(M){const Z=new Map;for(const v of M)Z.set(v.uniqueId,v);const P={dependsOn:new Map,dependedBy:new Map};for(const v of M){const M=v.uniqueId;P.dependsOn.set(M,new Set),P.dependedBy.set(M,new Set)}for(const v of M){const M=v.uniqueId,x=P.dependsOn.get(M);if(v instanceof O.b){const c=v.sourceMesh;Z.has(c.uniqueId)&&(x.add(c.uniqueId),P.dependedBy.get(c.uniqueId).add(M))}const c=P.dependedBy.get(M);for(const w of v.getDescendants()){const x=w.uniqueId;if(Z.has(x)){c.add(x);P.dependsOn.get(x).add(M)}}}const x=[],c=[];for(const v of M){const M=v.uniqueId;0===P.dependsOn.get(M).size&&(c.push(v),Z.delete(M))}const w=c;for(;w.length>0;){const M=w.shift();x.push(M);const c=P.dependedBy.get(M.uniqueId);for(const x of Array.from(c.values())){const c=P.dependsOn.get(x);c.delete(M.uniqueId),0===c.size&&Z.get(x)&&(w.push(Z.get(x)),Z.delete(x))}}return Z.size>0&&(K.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),Z.forEach((M=>{K.d.Error(M.name)}))),x}_addNodeAndDescendantsToList(M,Z,P,x){if(P&&(!x||x(P))&&!Z.has(P.uniqueId)){M.push(P),Z.add(P.uniqueId);for(const c of P.getDescendants(!0))this._addNodeAndDescendantsToList(M,Z,c,x)}}_isNodeInContainer(M){return M instanceof mM.b&&-1!==this.meshes.indexOf(M)||(M instanceof G.b&&-1!==this.transformNodes.indexOf(M)||(M instanceof H.d&&-1!==this.lights.indexOf(M)||M instanceof j.e&&-1!==this.cameras.indexOf(M)))}_isValidHierarchy(){for(const M of this.meshes)if(M.parent&&!this._isNodeInContainer(M.parent))return K.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.transformNodes)if(M.parent&&!this._isNodeInContainer(M.parent))return K.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.lights)if(M.parent&&!this._isNodeInContainer(M.parent))return K.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.cameras)if(M.parent&&!this._isNodeInContainer(M.parent))return K.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(M){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const x={},w={},G=new L,mM=[],K=[],d={doNotInstantiate:!0,...P},O=[],H=new Set;for(const c of this.transformNodes)null===c.parent&&this._addNodeAndDescendantsToList(O,H,c,d.predicate);for(const c of this.meshes)null===c.parent&&this._addNodeAndDescendantsToList(O,H,c,d.predicate);const j=this._topologicalSort(O),B=(P,c)=>{if(((Z,P)=>{if(x[Z.uniqueId]=P.uniqueId,w[P.uniqueId]=P,M&&(P.name=M(Z.name)),P instanceof v.c){const M=P;if(M.morphTargetManager){const P=Z.morphTargetManager;M.morphTargetManager=P.clone();for(let Z=0;Z<P.numTargets;Z++){const c=P.getTarget(Z),v=M.morphTargetManager.getTarget(Z);x[c.uniqueId]=v.uniqueId,w[v.uniqueId]=v}}}})(P,c),P.parent){const M=x[P.parent.uniqueId],Z=w[M];c.parent=Z||P.parent}if(c.position&&P.position&&c.position.v(P.position),c.rotationQuaternion&&P.rotationQuaternion&&c.rotationQuaternion.v(P.rotationQuaternion),c.rotation&&P.rotation&&c.rotation.v(P.rotation),c.hc&&P.hc&&c.hc.v(P.hc),c.material){const v=c;if(v.material)if(Z){const Z=P.material;if(-1===K.indexOf(Z)){let P=Z.clone(M?M(Z.name):"Clone of "+Z.name);if(K.push(Z),x[Z.uniqueId]=P.uniqueId,w[P.uniqueId]=P,"MultiMaterial"===Z.getClassName()){const c=Z;for(const Z of c.sc)Z&&(P=Z.clone(M?M(Z.name):"Clone of "+Z.name),K.push(Z),x[Z.uniqueId]=P.uniqueId,w[P.uniqueId]=P);c.sc=c.sc.map((M=>M&&w[x[M.uniqueId]]))}}"InstancedMesh"!==v.getClassName()&&(v.material=w[x[Z.uniqueId]])}else"MultiMaterial"===v.material.getClassName()?-1===this.nZ.multiMaterials.indexOf(v.material)&&this.nZ.addMultiMaterial(v.material):-1===this.nZ.materials.indexOf(v.material)&&this.nZ.addMaterial(v.material)}null===c.parent&&G.rootNodes.push(c)};for(const c of j)if("InstancedMesh"===c.getClassName()){const M=c,Z=M.sourceMesh,P=x[Z.uniqueId];B(M,("number"===typeof P?w[P]:Z).createInstance(M.name))}else{let M=!0;"rc"===c.getClassName()||"Node"===c.getClassName()||c.skeleton||!c.getTotalVertices||0===c.getTotalVertices()?M=!1:d.doNotInstantiate&&(M="function"===typeof d.doNotInstantiate?!d.doNotInstantiate(c):!d.doNotInstantiate);const Z=M?c.createInstance(`instance of ${c.name}`):c.clone(`Clone of ${c.name}`,null,!0);if(!Z)throw new Error(`Could not clone or instantiate node on Asset Container ${c.name}`);B(c,Z)}for(const c of this.skeletons){if(d.predicate&&!d.predicate(c))continue;const Z=c.clone(M?M(c.name):"Clone of "+c.name);for(const M of this.meshes)if(M.skeleton===c&&!M.isAnInstance){const P=w[x[M.uniqueId]];if(!P||P.isAnInstance)continue;if(P.skeleton=Z,-1!==mM.indexOf(Z))continue;mM.push(Z);for(const M of Z.bones)M._linkedTransformNode&&(M._linkedTransformNode=w[x[M._linkedTransformNode.uniqueId]])}G.skeletons.push(Z)}for(const c of this.animationGroups){if(d.predicate&&!d.predicate(c))continue;const Z=c.clone(M?M(c.name):"Clone of "+c.name,(M=>w[x[M.uniqueId]]||M));G.animationGroups.push(Z)}return G}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.nZ.environmentTexture=this.environmentTexture);for(const M of this.nZ._serializableComponents)M.addFromContainer(this);this.nZ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Z=[];for(const P of this.cameras)M&&!M(P)||(this.nZ.addCamera(P),Z.push(P));for(const P of this.lights)M&&!M(P)||(this.nZ.addLight(P),Z.push(P));for(const P of this.meshes)M&&!M(P)||(this.nZ.PO(P),Z.push(P));for(const P of this.skeletons)M&&!M(P)||this.nZ.addSkeleton(P);for(const P of this.animations)M&&!M(P)||this.nZ.addAnimation(P);for(const P of this.animationGroups)M&&!M(P)||this.nZ.addAnimationGroup(P);for(const P of this.multiMaterials)M&&!M(P)||this.nZ.addMultiMaterial(P);for(const P of this.materials)M&&!M(P)||this.nZ.addMaterial(P);for(const P of this.morphTargetManagers)M&&!M(P)||this.nZ.addMorphTargetManager(P);for(const P of this.geometries)M&&!M(P)||this.nZ.addGeometry(P);for(const P of this.transformNodes)M&&!M(P)||(this.nZ.addTransformNode(P),Z.push(P));for(const P of this.actionManagers)M&&!M(P)||this.nZ.addActionManager(P);for(const P of this.textures)M&&!M(P)||this.nZ.addTexture(P);for(const P of this.reflectionProbes)M&&!M(P)||this.nZ.addReflectionProbe(P);for(const P of Z)P.parent&&-1===this.nZ.getNodes().indexOf(P.parent)&&(P.setParent?P.setParent(null):P.parent=null)}removeAllFromScene(){this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.nZ.environmentTexture&&(this.nZ.environmentTexture=null);for(const M of this.nZ._serializableComponents)M.removeFromContainer(this)}removeFromScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const Z of this.cameras)M&&!M(Z)||this.nZ.removeCamera(Z);for(const Z of this.lights)M&&!M(Z)||this.nZ.removeLight(Z);for(const Z of this.meshes)M&&!M(Z)||this.nZ.ZO(Z,!0);for(const Z of this.skeletons)M&&!M(Z)||this.nZ.removeSkeleton(Z);for(const Z of this.animations)M&&!M(Z)||this.nZ.removeAnimation(Z);for(const Z of this.animationGroups)M&&!M(Z)||this.nZ.removeAnimationGroup(Z);for(const Z of this.multiMaterials)M&&!M(Z)||this.nZ.removeMultiMaterial(Z);for(const Z of this.materials)M&&!M(Z)||this.nZ.removeMaterial(Z);for(const Z of this.morphTargetManagers)M&&!M(Z)||this.nZ.removeMorphTargetManager(Z);for(const Z of this.geometries)M&&!M(Z)||this.nZ.removeGeometry(Z);for(const Z of this.transformNodes)M&&!M(Z)||this.nZ.removeTransformNode(Z);for(const Z of this.actionManagers)M&&!M(Z)||this.nZ.removeActionManager(Z);for(const Z of this.textures)M&&!M(Z)||this.nZ.removeTexture(Z);for(const Z of this.reflectionProbes)M&&!M(Z)||this.nZ.removeReflectionProbe(Z)}dispose(){const M=this.cameras.slice(0);for(const j of M)j.dispose();this.cameras.length=0;const Z=this.lights.slice(0);for(const j of Z)j.dispose();this.lights.length=0;const P=this.meshes.slice(0);for(const j of P)j.dispose();this.meshes.length=0;const x=this.skeletons.slice(0);for(const j of x)j.dispose();this.skeletons.length=0;const c=this.animationGroups.slice(0);for(const j of c)j.dispose();this.animationGroups.length=0;const w=this.multiMaterials.slice(0);for(const j of w)j.dispose();this.multiMaterials.length=0;const v=this.materials.slice(0);for(const j of v)j.dispose();this.materials.length=0;const G=this.geometries.slice(0);for(const j of G)j.dispose();this.geometries.length=0;const mM=this.transformNodes.slice(0);for(const j of mM)j.dispose();this.transformNodes.length=0;const K=this.actionManagers.slice(0);for(const j of K)j.dispose();this.actionManagers.length=0;const d=this.textures.slice(0);for(const j of d)j.dispose();this.textures.length=0;const O=this.reflectionProbes.slice(0);for(const j of O)j.dispose();this.reflectionProbes.length=0;const H=this.morphTargetManagers.slice(0);for(const j of H)j.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const j of this.nZ._serializableComponents)j.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.nZ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(M,Z,P){if(M&&Z)for(const x of M){let M=!0;if(P)for(const Z of P)if(x===Z){M=!1;break}M&&(Z.push(x),x._parentContainer=this)}}moveAllFromScene(M){this._wasAddedToScene=!1,void 0===M&&(M=new n);for(const Z in this)Object.prototype.hasOwnProperty.call(this,Z)&&(this[Z]=this[Z]||("_environmentTexture"===Z?null:[]),this._moveAssets(this.nZ[Z],this[Z],M[Z]));this.environmentTexture=this.nZ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const M=new v.c("assetContainerRootMesh",this.nZ);for(const Z of this.meshes)Z.parent||M.addChild(Z);return this.meshes.unshift(M),M}mergeAnimationsTo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.b.LastCreatedScene,Z=arguments.length>1?arguments[1]:void 0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!M)return K.d.Error("No scene available to merge animations to"),[];const x=P||(Z=>{let P=null;const x=Z.animations.length?Z.animations[0].targetProperty:"",c=Z.name.split(".").join("").split("_primitive")[0];switch(x){case"position":case"rotationQuaternion":P=M.getTransformNodeByName(Z.name)||M.getTransformNodeByName(c);break;case"influence":P=M.getMorphTargetByName(Z.name)||M.getMorphTargetByName(c);break;default:P=M.getNodeByName(Z.name)||M.getNodeByName(c)}return P}),c=this.getNodes();for(const G of c){const M=x(G);if(null!==M){for(const Z of G.animations){const P=M.animations.filter((M=>M.targetProperty===Z.targetProperty));for(const Z of P){const P=M.animations.indexOf(Z,0);P>-1&&M.animations.splice(P,1)}}M.animations=M.animations.concat(G.animations)}}const w=[],v=this.animationGroups.slice();for(const G of v){w.push(G.clone(G.name,x));for(const M of G.animatables)M.stop()}for(const G of Z){const Z=x(G.target);Z&&(M.beginAnimation(Z,G.fromFrame,G.toFrame,G.loopAnimation,G.speedRatio,G.onAnimationEnd?G.onAnimationEnd:void 0,void 0,!0,void 0,G.onAnimationLoop?G.onAnimationLoop:void 0),M.stopAnimation(G.target))}return w}populateRootNodes(){this.rootNodes.length=0;for(const M of this.meshes)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.transformNodes)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.lights)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.cameras)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)}addAllAssetsToContainer(M){if(!M)return;const Z=[],P=new Set;for(Z.push(M);Z.length>0;){const M=Z.pop();if(M instanceof v.c?(M.tc&&-1===this.geometries.indexOf(M.tc)&&this.geometries.push(M.tc),this.meshes.push(M)):M instanceof O.b?this.meshes.push(M):M instanceof G.b?this.transformNodes.push(M):M instanceof H.d?this.lights.push(M):M instanceof j.e&&this.cameras.push(M),M instanceof mM.b){if(M.material&&-1===this.materials.indexOf(M.material)){this.materials.push(M.material);for(const Z of M.material.getActiveTextures())-1===this.textures.indexOf(Z)&&this.textures.push(Z)}M.skeleton&&-1===this.skeletons.indexOf(M.skeleton)&&this.skeletons.push(M.skeleton),M.morphTargetManager&&-1===this.morphTargetManagers.indexOf(M.morphTargetManager)&&this.morphTargetManagers.push(M.morphTargetManager)}for(const x of M.getChildren())P.has(x)||Z.push(x);P.add(M)}this.populateRootNodes()}_getByTags(M,Z,P){if(void 0===Z)return M;const x=[];for(const c in M){const w=M[c];B.e&&B.e.MatchesQuery(w,Z)&&(!P||P(w))&&x.push(w)}return x}getMeshesByTags(M,Z){return this._getByTags(this.meshes,M,Z)}getCamerasByTags(M,Z){return this._getByTags(this.cameras,M,Z)}getLightsByTags(M,Z){return this._getByTags(this.lights,M,Z)}getMaterialsByTags(M,Z){return this._getByTags(this.materials,M,Z).concat(this._getByTags(this.multiMaterials,M,Z))}getTransformNodesByTags(M,Z){return this._getByTags(this.transformNodes,M,Z)}}var N=P(12245);class J{constructor(M){this.byteOffset=0,this.buffer=M}async loadAsync(M){const Z=await this.buffer.readAsync(this.byteOffset,M);this._dataView=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),this._dataByteOffset=0}readUint32(){const M=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,M}readUint8Array(M){const Z=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,M);return this._dataByteOffset+=M,this.byteOffset+=M,Z}readString(M){return(0,N.i)(this.readUint8Array(M))}skipBytes(M){this._dataByteOffset+=M,this.byteOffset+=M}}var t=P(14004);const F="Z2xURg",D={name:"jc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:M=>-1!==M.indexOf("asset")&&-1!==M.indexOf("version")||M.startsWith("data:base64,"+F)||M.startsWith("data:;base64,"+F)||M.startsWith("data:application/octet-stream;base64,"+F)||M.startsWith("data:model/gltf-binary;base64,"+F)};var l,h,Q,I=P(12230),s=P(12238);function C(M,Z,P){try{return Promise.resolve(new Uint8Array(M,Z,P))}catch(x){return Promise.reject(x)}}!function(M){M[M.AUTO=0]="AUTO",M[M.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(l||(l={})),function(M){M[M.NONE=0]="NONE",M[M.FIRST=1]="FIRST",M[M.ALL=2]="ALL"}(h||(h={})),function(M){M[M.LOADING=0]="LOADING",M[M.READY=1]="READY",M[M.COMPLETE=2]="COMPLETE"}(Q||(Q={}));class R{constructor(){this.coordinateSystemMode=l.AUTO,this.animationStartMode=h.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=M=>Promise.resolve(M),this.extensionOptions={}}v(M){M&&(this.onParsed=M.onParsed,this.coordinateSystemMode=M.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=M.animationStartMode??this.animationStartMode,this.loadNodeAnimations=M.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=M.loadSkins??this.loadSkins,this.loadMorphTargets=M.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=M.compileMaterials??this.compileMaterials,this.useClipPlane=M.useClipPlane??this.useClipPlane,this.compileShadowGenerators=M.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=M.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=M.useRangeRequests??this.useRangeRequests,this.createInstances=M.createInstances??this.createInstances,this.alwaysComputeBoundingBox=M.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=M.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=M.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=M.skipMaterials??this.skipMaterials,this.useSRGBBuffers=M.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=M.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=M.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=M.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=M.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=M.customRootNode,this.onMeshLoaded=M.onMeshLoaded,this.onSkinLoaded=M.onSkinLoaded,this.onTextureLoaded=M.onTextureLoaded,this.onMaterialLoaded=M.onMaterialLoaded,this.onCameraLoaded=M.onCameraLoaded,this.extensionOptions=M.extensionOptions??this.extensionOptions)}}class W extends R{constructor(M){super(),this.onParsedObservable=new x.b,this.onMeshLoadedObservable=new x.b,this.onSkinLoadedObservable=new x.b,this.onTextureLoadedObservable=new x.b,this.onMaterialLoadedObservable=new x.b,this.onCameraLoadedObservable=new x.b,this.onCompleteObservable=new x.b,this.onErrorObservable=new x.b,this.Gc=new x.b,this.onExtensionLoadedObservable=new x.b,this.validate=!1,this.onValidatedObservable=new x.b,this._loader=null,this._state=null,this._requests=new Array,this.name=D.name,this.extensions=D.extensions,this.onLoaderStateChangedObservable=new x.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.v(M)}set onParsed(M){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),M&&(this._onParsedObserver=this.onParsedObservable.add(M))}set onMeshLoaded(M){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),M&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(M))}set onSkinLoaded(M){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),M&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((Z=>M(Z.node,Z.skinnedNode))))}set onTextureLoaded(M){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),M&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(M))}set onMaterialLoaded(M){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),M&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(M))}set onCameraLoaded(M){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),M&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(M))}set onComplete(M){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(M)}set onError(M){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(M)}set onDispose(M){this._onDisposeObserver&&this.Gc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Gc.add(M)}set onExtensionLoaded(M){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(M)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(M){this._loggingEnabled!==M&&(this._loggingEnabled=M,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(M){this._capturePerformanceCounters!==M&&(this._capturePerformanceCounters=M,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(M){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(M)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const M of this._requests)M.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=M=>Promise.resolve(M),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Gc.notifyObservers(void 0),this.Gc.clear()}loadFile(M,Z,P,w,v,G,mM,d){if(ArrayBuffer.isView(Z))return this._loadBinary(M,Z,P,w,mM,d),null;this._progressCallback=v;const O=Z.name||c.Tools.GetFilename(Z);if(G){if(this.useRangeRequests){this.validate&&K.d.Warn("glTF validation is not supported when range requests are enabled");const P={abort:()=>{},onCompleteObservable:new x.b},c={readAsync:(P,x)=>new Promise(((c,w)=>{this._loadFile(M,Z,(M=>{c(new Uint8Array(M))}),!0,(M=>{w(M)}),(M=>{M.setRequestHeader("Range",`bytes=${P}-${P+x-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new J(c)).then((M=>{P.onCompleteObservable.notifyObservers(P),w(M)}),mM?M=>mM(void 0,M):void 0),P}return this._loadFile(M,Z,(Z=>{this._validate(M,new Uint8Array(Z,0,Z.byteLength),P,O),this._unpackBinaryAsync(new J({readAsync:(M,P)=>C(Z,M,P),byteLength:Z.byteLength})).then((M=>{w(M)}),mM?M=>mM(void 0,M):void 0)}),!0,mM)}return this._loadFile(M,Z,(Z=>{try{this._validate(M,Z,P,O),w({json:this._parseJson(Z)})}catch{mM&&mM()}}),!1,mM)}_loadBinary(M,Z,P,x,c,w){this._validate(M,new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength),P,w),this._unpackBinaryAsync(new J({readAsync:(M,P)=>function(M,Z,P){try{if(Z<0||Z>=M.byteLength)throw new RangeError("Offset is out of range.");if(Z+P>M.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(M.buffer,M.byteOffset+Z,P))}catch(x){return Promise.reject(x)}}(Z,M,P),byteLength:Z.byteLength})).then((M=>{x(M)}),c?M=>c(void 0,M):void 0)}importMeshAsync(M,Z,P,x,c,w){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(P),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(P),this._loader.importMeshAsync(M,Z,null,P,x,c,w))))}loadAsync(M,Z,P,x,c){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(Z),this._loader.loadAsync(M,Z,P,x,c))))}loadAssetContainerAsync(M,Z,P,x,c){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(Z);const w=new u(M),v=[];this.onMaterialLoadedObservable.add((M=>{v.push(M)}));const G=[];this.onTextureLoadedObservable.add((M=>{G.push(M)}));const mM=[];this.onCameraLoadedObservable.add((M=>{mM.push(M)}));const K=[];return this.onMeshLoadedObservable.add((M=>{M.morphTargetManager&&K.push(M.morphTargetManager)})),this._loader.importMeshAsync(null,M,w,Z,P,x,c).then((M=>(Array.prototype.push.apply(w.geometries,M.geometries),Array.prototype.push.apply(w.meshes,M.meshes),Array.prototype.push.apply(w.SH,M.SH),Array.prototype.push.apply(w.skeletons,M.skeletons),Array.prototype.push.apply(w.animationGroups,M.animationGroups),Array.prototype.push.apply(w.materials,v),Array.prototype.push.apply(w.textures,G),Array.prototype.push.apply(w.lights,M.lights),Array.prototype.push.apply(w.transformNodes,M.transformNodes),Array.prototype.push.apply(w.cameras,mM),Array.prototype.push.apply(w.morphTargetManagers,K),w)))}))}canDirectLoad(M){return D.canDirectLoad(M)}directLoad(M,Z){if(Z.startsWith("base64,"+F)||Z.startsWith(";base64,"+F)||Z.startsWith("application/octet-stream;base64,"+F)||Z.startsWith("model/gltf-binary;base64,"+F)){const P=(0,I.e)(Z);return this._validate(M,new Uint8Array(P,0,P.byteLength)),this._unpackBinaryAsync(new J({readAsync:(M,Z)=>C(P,M,Z),byteLength:P.byteLength}))}return this._validate(M,Z),Promise.resolve({json:this._parseJson(Z)})}createPlugin(M){return new W(M[D.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((M,Z)=>{this.onCompleteObservable.addOnce((()=>{M()})),this.onErrorObservable.addOnce((M=>{Z(M)}))}))}_setState(M){this._state!==M&&(this._state=M,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Q[this._state]))}_loadFile(M,Z,P,x,c,w){const v=M._loadFile(Z,P,(M=>{this._onProgress(M,v)}),!0,x,c,w);return v.onCompleteObservable.add((()=>{v._lengthComputable=!0,v._total=v._loaded})),this._requests.push(v),v}_onProgress(M,Z){if(!this._progressCallback)return;Z._lengthComputable=M.lengthComputable,Z._loaded=M.loaded,Z._total=M.total;let P=!0,x=0,c=0;for(const w of this._requests){if(void 0===w._lengthComputable||void 0===w._loaded||void 0===w._total)return;P=P&&w._lengthComputable,x+=w._loaded,c+=w._total}this._progressCallback({lengthComputable:P,loaded:x,total:P?c:0})}_validate(M,Z){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),t.d.ValidateAsync(Z,P,x,(Z=>this.preprocessUrlAsync(P+Z).then((Z=>M._loadFileAsync(Z,void 0,!0,!0).then((M=>new Uint8Array(M,0,M.byteLength))))))).then((M=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(M),this.onValidatedObservable.clear()}),(M=>{this._endPerformanceCounter("Validate JSON"),c.Tools.Warn(`Failed to validate: ${M.message}`),this.onValidatedObservable.clear()})))}_getLoader(M){const Z=M.json.asset||{};this._log(`Asset version: ${Z.version}`),Z.minVersion&&this._log(`Asset minimum version: ${Z.minVersion}`),Z.generator&&this._log(`Asset generator: ${Z.generator}`);const P=W._parseVersion(Z.version);if(!P)throw new Error("Invalid version: "+Z.version);if(void 0!==Z.minVersion){const M=W._parseVersion(Z.minVersion);if(!M)throw new Error("Invalid minimum version: "+Z.minVersion);if(W._compareVersion(M,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+Z.minVersion)}const x={1:W._CreateGLTF1Loader,2:W._CreateGLTF2Loader}[P.major];if(!x)throw new Error("Unsupported version: "+Z.version);return x(this)}_parseJson(M){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${M.length}`);const Z=JSON.parse(M);return this._endPerformanceCounter("Parse JSON"),Z}_unpackBinaryAsync(M){return this._startPerformanceCounter("Unpack Binary"),M.loadAsync(20).then((()=>{const Z=M.readUint32();if(1179937895!==Z)throw new s.m("Unexpected magic: "+Z,s.i.GLTFLoaderUnexpectedMagicError);const P=M.readUint32();this.loggingEnabled&&this._log(`Binary version: ${P}`);const x=M.readUint32();let c;switch(this.useRangeRequests||x===M.buffer.byteLength||K.d.Warn(`Length in header does not match actual data length: ${x} != ${M.buffer.byteLength}`),P){case 1:c=this._unpackBinaryV1Async(M,x);break;case 2:c=this._unpackBinaryV2Async(M,x);break;default:throw new Error("Unsupported version: "+P)}return this._endPerformanceCounter("Unpack Binary"),c}))}_unpackBinaryV1Async(M,Z){const P=M.readUint32(),x=M.readUint32();if(0!==x)throw new Error(`Unexpected content format: ${x}`);const c=Z-M.byteOffset,w={json:this._parseJson(M.readString(P)),bin:null};if(0!==c){const Z=M.byteOffset;w.bin={readAsync:(P,x)=>M.buffer.readAsync(Z+P,x),byteLength:c}}return Promise.resolve(w)}_unpackBinaryV2Async(M,Z){const P=1313821514,x=5130562,c=M.readUint32();if(M.readUint32()!==P)throw new Error("First chunk format is not JSON");return M.byteOffset+c===Z?M.loadAsync(c).then((()=>({json:this._parseJson(M.readString(c)),bin:null}))):M.loadAsync(c+8).then((()=>{const w={json:this._parseJson(M.readString(c)),bin:null},v=()=>{const c=M.readUint32();switch(M.readUint32()){case P:throw new Error("Unexpected JSON chunk");case x:{const Z=M.byteOffset;w.bin={readAsync:(P,x)=>M.buffer.readAsync(Z+P,x),byteLength:c},M.skipBytes(c);break}default:M.skipBytes(c)}return M.byteOffset!==Z?M.loadAsync(8).then(v):Promise.resolve(w)};return v()}))}static _parseVersion(M){if("1.0"===M||"1.0.1"===M)return{major:1,minor:0};const Z=(M+"").match(/^(\d+)\.(\d+)/);return Z?{major:parseInt(Z[1]),minor:parseInt(Z[2])}:null}static _compareVersion(M,Z){return M.major>Z.major?1:M.major<Z.major?-1:M.minor>Z.minor?1:M.minor<Z.minor?-1:0}_logOpen(M){this._log(M),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(M){const Z=W._logSpaces.substring(0,2*this._logIndentLevel);K.d.Log(`${Z}${M}`)}_logDisabled(M){}_startPerformanceCounterEnabled(M){c.Tools.StartPerformanceCounter(M)}_startPerformanceCounterDisabled(M){}_endPerformanceCounterEnabled(M){c.Tools.EndPerformanceCounter(M)}_endPerformanceCounterDisabled(M){}}W.IncrementalLoading=!0,W.HomogeneousCoordinates=!1,W._logSpaces="                                ",(0,w.e)(new W)},14004:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>v});var x=P(12175);function c(M,Z,P,x){const c={externalResourceFunction:x};return P&&(c.uri="file:"===Z?P:Z+P),ArrayBuffer.isView(M)?GLTFValidator.validateBytes(M,c):GLTFValidator.validateString(M,c)}function w(){const M=[];onmessage=Z=>{const P=Z.data;switch(P.id){case"init":importScripts(P.url);break;case"validate":c(P.data,P.rootUrl,P.fileName,(Z=>new Promise(((P,x)=>{const c=M.length;M.push({resolve:P,reject:x}),postMessage({id:"getExternalResource",index:c,uri:Z})})))).then((M=>{postMessage({id:"validate.resolve",value:M})}),(M=>{postMessage({id:"validate.reject",reason:M})}));break;case"getExternalResource.resolve":M[P.index].resolve(P.value);break;case"getExternalResource.reject":M[P.index].reject(P.reason)}}}class v{static ValidateAsync(M,Z,P,v){return"function"===typeof Worker?new Promise(((G,mM)=>{const K=`${c}(${w})()`,d=URL.createObjectURL(new Blob([K],{type:"application/javascript"})),O=new Worker(d),H=M=>{O.removeEventListener("error",H),O.removeEventListener("message",j),mM(M)},j=M=>{const Z=M.data;switch(Z.id){case"getExternalResource":v(Z.uri).then((M=>{O.postMessage({id:"getExternalResource.resolve",index:Z.index,value:M},[M.buffer])}),(M=>{O.postMessage({id:"getExternalResource.reject",index:Z.index,reason:M})}));break;case"validate.resolve":O.removeEventListener("error",H),O.removeEventListener("message",j),G(Z.value),O.terminate();break;case"validate.reject":O.removeEventListener("error",H),O.removeEventListener("message",j),mM(Z.reason),O.terminate()}};if(O.addEventListener("error",H),O.addEventListener("message",j),O.postMessage({id:"init",url:x.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(M)){const x=M.slice();O.postMessage({id:"validate",data:x,rootUrl:Z,fileName:P},[x.buffer])}else O.postMessage({id:"validate",data:M,rootUrl:Z,fileName:P})})):(this._LoadScriptPromise||(this._LoadScriptPromise=x.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>c(M,Z,P,v))))}}v.Configuration={url:`${x.Tools._DefaultCdnUrl}/gltf_validator.js`}},14585:(M,Z,P)=>{"use strict";P.d(Z,{d:()=>D});var x=P(12351),c=P(12359),w=P(12394),v=P(12373),G=P(12759),mM=P(12675),K=P(12430),d=P(12596),O=P(12317),H=P(12271);P(13769),P(13670),P(13682),P(13672),P(13691),P(13693),P(13697);const j="imageProcessingCompatibility",B="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";H.c.IncludesShadersStore[j]||(H.c.IncludesShadersStore[j]=B);const U="skyPixelShader",n="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";H.c.ShadersStore[U]||(H.c.ShadersStore[U]=n);P(13779),P(13705),P(13713),P(13729),P(13721);const L="skyVertexShader",u="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";H.c.ShadersStore[L]||(H.c.ShadersStore[L]=u);var N=P(12672),J=P(12735),t=P(12731);class F extends G.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends mM.d{constructor(M,Z){super(M,Z),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new v.BZ(0,100,0),this.useSunPosition=!1,this.cameraOffset=v.BZ.Zero(),this.up=v.BZ.Up(),this.dithering=!1,this._cameraPosition=v.BZ.Zero(),this._skyOrientation=new v.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(M,Z){const P=Z._drawWrapper;if(this.isFrozen&&P.effect&&P._wasPreviouslyReady)return!0;Z.materialDefines||(Z.materialDefines=new F);const x=Z.materialDefines,c=this.DM();if(this._isReadyForSubMesh(Z))return!0;if((0,t.P)(M,c,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,x),(0,t.H)(M,x,!0,!1),x.IMAGEPROCESSINGPOSTPROCESS!==c.imageProcessingConfiguration.applyByPostProcess&&x.markAsMiscDirty(),x.DITHER!==this.dithering&&x.markAsMiscDirty(),x.isDirty){x.markAsProcessed(),c.resetCachedMaterial();const M=new N.e;x.FOG&&M.addFallback(1,"FOG"),x.IMAGEPROCESSINGPOSTPROCESS=c.imageProcessingConfiguration.applyByPostProcess,x.DITHER=this.dithering;const P=[K.g.PositionKind];x.VERTEXCOLOR&&P.push(K.g.ColorKind);const w="sky",v=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,J.e)(v);const G=x.toString();Z.setEffect(c.getEngine().createEffect(w,P,v,[],G,M,this.onCompiled,this.onError),x,this._materialContext)}return!(!Z.effect||!Z.effect.isReady())&&(x._renderId=c.getRenderId(),P._wasPreviouslyReady=!0,!0)}bindForSubMesh(M,Z,P){const x=this.DM(),c=P.materialDefines;if(!c)return;const w=P.effect;if(!w)return;this._activeEffect=w,this.bindOnlyWorldMatrix(M),this._activeEffect.setMatrix("viewProjection",x.getTransformMatrix()),this._mustRebind(x,w,P)&&((0,J.f)(w,this,x),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,t.m)(c,w,x)),x.fogEnabled&&Z.applyFog&&x.fogMode!==d.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",x.getViewMatrix()),(0,t.g)(x,Z,this._activeEffect);const G=x.activeCamera;if(G){const M=G.getWorldMatrix();this._cameraPosition.x=M.m[12],this._cameraPosition.y=M.m[13],this._cameraPosition.z=M.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const M=Math.PI*(this.inclination-.5),Z=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(Z)*Math.cos(M),this.sunPosition.y=this.distance*Math.sin(-M),this.sunPosition.z=this.distance*Math.sin(Z)*Math.cos(M),v.Quaternion.FromUnitVectorsToRef(v.BZ.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(Z,this._activeEffect,P)}getAnimatables(){return[]}dispose(M){super.dispose(M)}clone(M){return w.b.Clone((()=>new D(M,this.DM())),this)}serialize(){const M=super.serialize();return M.customType="BABYLON.SkyMaterial",M}getClassName(){return"SkyMaterial"}static Parse(M,Z,P){return w.b.Parse((()=>new D(M.name,Z)),M,Z,P)}}(0,x.c)([(0,c.H)()],D.prototype,"luminance",void 0),(0,x.c)([(0,c.H)()],D.prototype,"turbidity",void 0),(0,x.c)([(0,c.H)()],D.prototype,"rayleigh",void 0),(0,x.c)([(0,c.H)()],D.prototype,"mieCoefficient",void 0),(0,x.c)([(0,c.H)()],D.prototype,"mieDirectionalG",void 0),(0,x.c)([(0,c.H)()],D.prototype,"distance",void 0),(0,x.c)([(0,c.H)()],D.prototype,"inclination",void 0),(0,x.c)([(0,c.H)()],D.prototype,"azimuth",void 0),(0,x.c)([(0,c.E)()],D.prototype,"sunPosition",void 0),(0,x.c)([(0,c.H)()],D.prototype,"useSunPosition",void 0),(0,x.c)([(0,c.E)()],D.prototype,"cameraOffset",void 0),(0,x.c)([(0,c.E)()],D.prototype,"up",void 0),(0,x.c)([(0,c.H)()],D.prototype,"dithering",void 0),(0,O.g)("BABYLON.SkyMaterial",D)},13067:(M,Z,P)=>{"use strict";function x(M,Z){Z.headers=M.headers||{},Z.statusMessage=M.statusText,Z.statusCode=M.status,Z.data=M.response}function c(M,Z,P){return new Promise((function(c,w){P=P||{};var v,G,mM,K=new XMLHttpRequest,d=P.body,O=P.headers||{};for(v in P.timeout&&(K.timeout=P.timeout),K.ontimeout=K.onerror=function(M){M.timeout="timeout"==M.type,w(M)},K.open(M,Z.href||Z),K.onload=function(){for(mM=K.getAllResponseHeaders().trim().split(/[\r\n]+/),x(K,K);G=mM.shift();)G=G.split(": "),K.headers[G.shift().toLowerCase()]=G.join(": ");if((G=K.headers["content-type"])&&~G.indexOf("application/json"))try{K.data=JSON.parse(K.data,P.reviver)}catch(M){return x(K,M),w(M)}(K.status>=400?w:c)(K)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(O["content-type"]="application/json",d=JSON.stringify(d)),K.withCredentials=!!P.withCredentials,O)K.setRequestHeader(v,O[v]);K.send(d)}))}P.r(Z),P.d(Z,{del:()=>mM,get:()=>w,patch:()=>G,post:()=>v,put:()=>K,send:()=>c});var w=c.bind(c,"GET"),v=c.bind(c,"POST"),G=c.bind(c,"PATCH"),mM=c.bind(c,"DELETE"),K=c.bind(c,"PUT")},14691:(M,Z,P)=>{"use strict";P.d(Z,{b:()=>O});const x=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,w=1/3,v=1/6,G=(Math.sqrt(5)-1)/4,mM=(5-Math.sqrt(5))/20,K=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),d=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const O=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const Z="function"==typeof M?M:function(M){let Z=0,P=0,x=0,c=1;const w=function(){let M=4022871197;return function(Z){Z=Z.toString();for(let P=0;P<Z.length;P++){M+=Z.charCodeAt(P);let x=.02519603282416938*M;M=x>>>0,x-=M,x*=M,M=x>>>0,x-=M,M+=4294967296*x}return 2.3283064365386963e-10*(M>>>0)}}();Z=w(" "),P=w(" "),x=w(" "),Z-=w(M),Z<0&&(Z+=1);P-=w(M),P<0&&(P+=1);x-=w(M),x<0&&(x+=1);return function(){const M=2091639*Z+2.3283064365386963e-10*c;return Z=P,P=x,x=M-(c=0|M)}}(M);this.p=function(M){const Z=new Uint8Array(256);for(let P=0;P<256;P++)Z[P]=P;for(let P=0;P<255;P++){const x=P+~~(M()*(256-P)),c=Z[P];Z[P]=Z[x],Z[x]=c}return Z}(Z),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let P=0;P<512;P++)this.perm[P]=this.p[255&P],this.permMod12[P]=this.perm[P]%12}noise2D(M,Z){const P=this.permMod12,w=this.perm;let v=0,G=0,mM=0;const d=(M+Z)*x,O=Math.floor(M+d),H=Math.floor(Z+d),j=(O+H)*c,B=M-(O-j),U=Z-(H-j);let n,L;B>U?(n=1,L=0):(n=0,L=1);const u=B-n+c,N=U-L+c,J=B-1+2*c,t=U-1+2*c,F=255&O,D=255&H;let l=.5-B*B-U*U;if(l>=0){const M=3*P[F+w[D]];l*=l,v=l*l*(K[M]*B+K[M+1]*U)}let h=.5-u*u-N*N;if(h>=0){const M=3*P[F+n+w[D+L]];h*=h,G=h*h*(K[M]*u+K[M+1]*N)}let Q=.5-J*J-t*t;if(Q>=0){const M=3*P[F+1+w[D+1]];Q*=Q,mM=Q*Q*(K[M]*J+K[M+1]*t)}return 70*(v+G+mM)}noise3D(M,Z,P){const x=this.permMod12,c=this.perm;let G,mM,d,O;const H=(M+Z+P)*w,j=Math.floor(M+H),B=Math.floor(Z+H),U=Math.floor(P+H),n=(j+B+U)*v,L=M-(j-n),u=Z-(B-n),N=P-(U-n);let J,t,F,D,l,h;L>=u?u>=N?(J=1,t=0,F=0,D=1,l=1,h=0):L>=N?(J=1,t=0,F=0,D=1,l=0,h=1):(J=0,t=0,F=1,D=1,l=0,h=1):u<N?(J=0,t=0,F=1,D=0,l=1,h=1):L<N?(J=0,t=1,F=0,D=0,l=1,h=1):(J=0,t=1,F=0,D=1,l=1,h=0);const Q=L-J+v,I=u-t+v,s=N-F+v,C=L-D+2*v,R=u-l+2*v,W=N-h+2*v,k=L-1+.5,A=u-1+.5,o=N-1+.5,E=255&j,r=255&B,q=255&U;let e=.6-L*L-u*u-N*N;if(e<0)G=0;else{const M=3*x[E+c[r+c[q]]];e*=e,G=e*e*(K[M]*L+K[M+1]*u+K[M+2]*N)}let b=.6-Q*Q-I*I-s*s;if(b<0)mM=0;else{const M=3*x[E+J+c[r+t+c[q+F]]];b*=b,mM=b*b*(K[M]*Q+K[M+1]*I+K[M+2]*s)}let a=.6-C*C-R*R-W*W;if(a<0)d=0;else{const M=3*x[E+D+c[r+l+c[q+h]]];a*=a,d=a*a*(K[M]*C+K[M+1]*R+K[M+2]*W)}let y=.6-k*k-A*A-o*o;if(y<0)O=0;else{const M=3*x[E+1+c[r+1+c[q+1]]];y*=y,O=y*y*(K[M]*k+K[M+1]*A+K[M+2]*o)}return 32*(G+mM+d+O)}noise4D(M,Z,P,x){const c=this.perm;let w,v,K,O,H;const j=(M+Z+P+x)*G,B=Math.floor(M+j),U=Math.floor(Z+j),n=Math.floor(P+j),L=Math.floor(x+j),u=(B+U+n+L)*mM,N=M-(B-u),J=Z-(U-u),t=P-(n-u),F=x-(L-u);let D=0,l=0,h=0,Q=0;N>J?D++:l++,N>t?D++:h++,N>F?D++:Q++,J>t?l++:h++,J>F?l++:Q++,t>F?h++:Q++;const I=D>=3?1:0,s=l>=3?1:0,C=h>=3?1:0,R=Q>=3?1:0,W=D>=2?1:0,k=l>=2?1:0,A=h>=2?1:0,o=Q>=2?1:0,E=D>=1?1:0,r=l>=1?1:0,q=h>=1?1:0,e=Q>=1?1:0,b=N-I+mM,a=J-s+mM,y=t-C+mM,f=F-R+mM,Y=N-W+2*mM,z=J-k+2*mM,i=t-A+2*mM,T=F-o+2*mM,p=N-E+3*mM,S=J-r+3*mM,X=t-q+3*mM,V=F-e+3*mM,g=N-1+4*mM,MM=J-1+4*mM,ZM=t-1+4*mM,PM=F-1+4*mM,xM=255&B,cM=255&U,wM=255&n,vM=255&L;let GM=.6-N*N-J*J-t*t-F*F;if(GM<0)w=0;else{const M=c[xM+c[cM+c[wM+c[vM]]]]%32*4;GM*=GM,w=GM*GM*(d[M]*N+d[M+1]*J+d[M+2]*t+d[M+3]*F)}let mZ=.6-b*b-a*a-y*y-f*f;if(mZ<0)v=0;else{const M=c[xM+I+c[cM+s+c[wM+C+c[vM+R]]]]%32*4;mZ*=mZ,v=mZ*mZ*(d[M]*b+d[M+1]*a+d[M+2]*y+d[M+3]*f)}let KM=.6-Y*Y-z*z-i*i-T*T;if(KM<0)K=0;else{const M=c[xM+W+c[cM+k+c[wM+A+c[vM+o]]]]%32*4;KM*=KM,K=KM*KM*(d[M]*Y+d[M+1]*z+d[M+2]*i+d[M+3]*T)}let dM=.6-p*p-S*S-X*X-V*V;if(dM<0)O=0;else{const M=c[xM+E+c[cM+r+c[wM+q+c[vM+e]]]]%32*4;dM*=dM,O=dM*dM*(d[M]*p+d[M+1]*S+d[M+2]*X+d[M+3]*V)}let OM=.6-g*g-MM*MM-ZM*ZM-PM*PM;if(OM<0)H=0;else{const M=c[xM+1+c[cM+1+c[wM+1+c[vM+1]]]]%32*4;OM*=OM,H=OM*OM*(d[M]*g+d[M+1]*MM+d[M+2]*ZM+d[M+3]*PM)}return 27*(w+v+K+O+H)}}}}]);