/*! For license information please see v7vvaj.32.1d40a239.chunk.js.LICENSE.txt */
(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[32],{14523:(o,v,V)=>{"use strict";var g=V(14527),E=V(14535),I=V(14542);V.g.__TYPEDARRAY_POOL||(V.g.__TYPEDARRAY_POOL={UINT8:E([32,0]),UINT16:E([32,0]),UINT32:E([32,0]),INT8:E([32,0]),INT16:E([32,0]),INT32:E([32,0]),FLOAT:E([32,0]),DOUBLE:E([32,0]),DATA:E([32,0]),UINT8C:E([32,0]),BUFFER:E([32,0])});var Q="undefined"!==typeof Uint8ClampedArray,U=V.g.__TYPEDARRAY_POOL;U.UINT8C||(U.UINT8C=E([32,0])),U.BUFFER||(U.BUFFER=E([32,0]));var n=U.DATA,O=U.BUFFER;function h(o){if(o){var v=o.length||o.byteLength,V=g.log2(v);n[V].push(o)}}function x(o){o=g.nextPow2(o);var v=g.log2(o),V=n[v];return V.length>0?V.pop():new ArrayBuffer(o)}function f(o){return new Uint8Array(x(o),0,o)}function l(o){return new Uint16Array(x(2*o),0,o)}function S(o){return new Uint32Array(x(4*o),0,o)}function T(o){return new Int8Array(x(o),0,o)}function c(o){return new Int16Array(x(2*o),0,o)}function R(o){return new Int32Array(x(4*o),0,o)}function j(o){return new Float32Array(x(4*o),0,o)}function t(o){return new Float64Array(x(8*o),0,o)}function s(o){return Q?new Uint8ClampedArray(x(o),0,o):f(o)}function L(o){return new DataView(x(o),0,o)}v.free=function(o){if(I(o))O[g.log2(o.length)].push(o);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(o)&&(o=o.buffer),!o)return;var v=o.length||o.byteLength,V=0|g.log2(v);n[V].push(o)}},v.freeUint8=v.freeUint16=v.freeUint32=v.freeInt8=v.freeInt16=v.freeInt32=v.freeFloat32=v.freeFloat=v.freeFloat64=v.freeDouble=v.freeUint8Clamped=v.freeDataView=function(o){h(o.buffer)},v.freeArrayBuffer=h,v.freeBuffer=function(o){O[g.log2(o.length)].push(o)},v.malloc=function(o,v){if(void 0===v||"arraybuffer"===v)return x(o);switch(v){case"uint8":return f(o);case"uint16":return l(o);case"uint32":return S(o);case"int8":return T(o);case"int16":return c(o);case"int32":return R(o);case"float":case"float32":return j(o);case"double":case"float64":return t(o);case"uint8_clamped":return s(o);case"buffer":throw"Buffer not supported";case"data":case"dataview":return L(o);default:return null}return null},v.mallocArrayBuffer=x,v.mallocUint8=f,v.mallocUint16=l,v.mallocUint32=S,v.mallocInt8=T,v.mallocInt16=c,v.mallocInt32=R,v.mallocFloat32=v.mallocFloat=j,v.mallocFloat64=v.mallocDouble=t,v.mallocUint8Clamped=s,v.mallocDataView=L,v.clearCache=function(){for(var o=0;o<32;++o)U.UINT8[o].length=0,U.UINT16[o].length=0,U.UINT32[o].length=0,U.INT8[o].length=0,U.INT16[o].length=0,U.INT32[o].length=0,U.FLOAT[o].length=0,U.DOUBLE[o].length=0,U.UINT8C[o].length=0,n[o].length=0,O[o].length=0}},14609:(o,v,V)=>{o.exports=E;var g=V(13337);function E(o,v){if(!(this instanceof E))return new E(o,v);var V=g.create();g.add(V,o,v),this.base=g.min(g.create(),o,V),this.CO=g.clone(v),this.max=g.max(g.create(),o,V),this.mag=g.length(this.CO)}var I=E.prototype;I.width=function(){return this.CO[0]},I.height=function(){return this.CO[1]},I.depth=function(){return this.CO[2]},I.x0=function(){return this.base[0]},I.y0=function(){return this.base[1]},I.z0=function(){return this.base[2]},I.x1=function(){return this.max[0]},I.y1=function(){return this.max[1]},I.z1=function(){return this.max[2]},I.translate=function(o){return g.add(this.max,this.max,o),g.add(this.base,this.base,o),this},I.setPosition=function(o){return g.add(this.max,o,this.CO),g.k(this.base,o),this},I.expand=function(o){var v=g.create(),V=g.create();return g.max(v,o.max,this.max),g.min(V,o.base,this.base),g.Rv(v,v,V),new E(V,v)},I.intersects=function(o){return!(o.base[0]>this.max[0])&&(!(o.base[1]>this.max[1])&&(!(o.base[2]>this.max[2])&&(!(o.max[0]<this.base[0])&&(!(o.max[1]<this.base[1])&&!(o.max[2]<this.base[2])))))},I.touches=function(o){var v=this.union(o);return null!==v&&(0==v.width()||0==v.height()||0==v.depth())},I.union=function(o){if(!this.intersects(o))return null;var v=Math.max(o.base[0],this.base[0]),V=Math.max(o.base[1],this.base[1]),g=Math.max(o.base[2],this.base[2]);return new E([v,V,g],[Math.min(o.max[0],this.max[0])-v,Math.min(o.max[1],this.max[1])-V,Math.min(o.max[2],this.max[2])-g])}},14527:(o,v)=>{"use strict";function V(o){var v=32;return(o&=-o)&&v--,65535&o&&(v-=16),16711935&o&&(v-=8),252645135&o&&(v-=4),858993459&o&&(v-=2),1431655765&o&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(o){return(o>0)-(o<0)},v.abs=function(o){var v=o>>31;return(o^v)-v},v.min=function(o,v){return v^(o^v)&-(o<v)},v.max=function(o,v){return o^(o^v)&-(o<v)},v.isPow2=function(o){return!(o&o-1)&&!!o},v.log2=function(o){var v,V;return v=(o>65535)<<4,v|=V=((o>>>=v)>255)<<3,v|=V=((o>>>=V)>15)<<2,(v|=V=((o>>>=V)>3)<<1)|(o>>>=V)>>1},v.log10=function(o){return o>=1e9?9:o>=1e8?8:o>=1e7?7:o>=1e6?6:o>=1e5?5:o>=1e4?4:o>=1e3?3:o>=100?2:o>=10?1:0},v.popCount=function(o){return 16843009*((o=(858993459&(o-=o>>>1&1431655765))+(o>>>2&858993459))+(o>>>4)&252645135)>>>24},v.countTrailingZeros=V,v.nextPow2=function(o){return o+=0===o,--o,o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)+1},v.prevPow2=function(o){return o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)-(o>>>1)},v.parity=function(o){return o^=o>>>16,o^=o>>>8,o^=o>>>4,27030>>>(o&=15)&1};var g=new Array(256);!function(o){for(var v=0;v<256;++v){var V=v,g=v,E=7;for(V>>>=1;V;V>>>=1)g<<=1,g|=1&V,--E;o[v]=g<<E&255}}(g),v.reverse=function(o){return g[255&o]<<24|g[o>>>8&255]<<16|g[o>>>16&255]<<8|g[o>>>24&255]},v.interleave2=function(o,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(o,v){return(o=65535&((o=16711935&((o=252645135&((o=858993459&((o=o>>>v&1431655765)|o>>>1))|o>>>2))|o>>>4))|o>>>16))<<16>>16},v.interleave3=function(o,v,V){return o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2),(o|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<2},v.deinterleave3=function(o,v){return(o=1023&((o=4278190335&((o=251719695&((o=3272356035&((o=o>>>v&1227133513)|o>>>2))|o>>>4))|o>>>8))|o>>>16))<<22>>22},v.nextCombination=function(o){var v=o|o-1;return v+1|(~v&-~v)-1>>>V(o)+1}},14518:(o,v,V)=>{"use strict";o.exports=function(o,v,V){switch(arguments.length){case 1:return g=[],O(E=o,E,h,!0),g;case 2:return"function"===typeof v?O(o,o,v,!0):function(o,v){return g=[],O(o,v,h,!1),g}(o,v);case 3:return O(o,v,V,!1);default:throw new Error("box-intersect: Invalid arguments")}var E};var g,E=V(14523),I=V(14549),Q=V(14560);function U(o,v){for(var V=0;V<o;++V)if(!(v[V]<=v[V+o]))return!0;return!1}function n(o,v,V,g){for(var E=0,I=0,Q=0,n=o.length;Q<n;++Q){var O=o[Q];if(!U(v,O)){for(var h=0;h<2*v;++h)V[E++]=O[h];g[I++]=Q}}return I}function O(o,v,V,g){var U=o.length,O=v.length;if(!(U<=0||O<=0)){var h=o[0].length>>>1;if(!(h<=0)){var x,f=E.mallocDouble(2*h*U),l=E.mallocInt32(U);if((U=n(o,h,f,l))>0){if(1===h&&g)I.init(U),x=I.sweepComplete(h,V,0,U,f,l,0,U,f,l);else{var S=E.mallocDouble(2*h*O),T=E.mallocInt32(O);(O=n(v,h,S,T))>0&&(I.init(U+O),x=1===h?I.sweepBipartite(h,V,0,U,f,l,0,O,S,T):Q(h,V,g,U,f,l,O,S,T),E.free(S),E.free(T))}E.free(f),E.free(l)}return x}}}function h(o,v){g.push([o,v])}},14564:(o,v)=>{"use strict";var V="d",g="ax",E="fp",I="es",Q="rs",U="re",n="rb",O="bs",h="be",x="bb",f=[V,g,"vv",Q,U,n,"ri",O,h,x,"bi"];function l(o){var v="bruteForce"+(o?"Full":"Partial"),g=[],Q=f.slice();o||Q.splice(3,0,E);var U=["function "+v+"("+Q.join()+"){"];function n(v,E){var Q=function(o,v,g){var E="bruteForce"+(o?"Red":"Blue")+(v?"Flip":"")+(g?"Full":""),Q=["function ",E,"(",f.join(),"){","var ",I,"=2*",V,";"],U="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",n="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(g?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return o?Q.push(U,"Q",":",n):Q.push(n,"Q",":",U),g?Q.push("if(y1<x0||x1<y0)continue;"):v?Q.push("if(y0<=x0||x1<y0)continue;"):Q.push("if(y0<x0||x1<y0)continue;"),Q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),v?Q.push("yi,xi"):Q.push("xi,yi"),Q.push(");if(rv!==void 0)return rv;}}}"),{name:E,code:Q.join("")}}(v,E,o);g.push(Q.code),U.push("return "+Q.name+"("+f.join()+");")}U.push("if(re-rs>be-bs){"),o?(n(!0,!1),U.push("}else{"),n(!1,!1)):(U.push("if(fp){"),n(!0,!0),U.push("}else{"),n(!0,!1),U.push("}}else{if(fp){"),n(!1,!0),U.push("}else{"),n(!1,!1),U.push("}")),U.push("}}return "+v);var O=g.join("")+U.join("");return new Function(O)()}v.partial=l(!1),v.full=l(!0)},14560:(o,v,V)=>{"use strict";o.exports=function(o,v,V,I,h,i,J,d,N){!function(o,v){var V=8*E.log2(v+1)*(o+1)|0,I=E.nextPow2(s*V);b.length<I&&(g.free(b),b=g.mallocInt32(I));var Q=E.nextPow2(L*V);u.length<Q&&(g.free(u),u=g.mallocDouble(Q))}(o,I+J);var Y,q=0,P=2*o;mo(q++,0,0,I,0,J,V?16:0,-1/0,1/0),V||mo(q++,0,0,J,0,I,1,-1/0,1/0);for(;q>0;){var M=(q-=1)*s,W=b[M],w=b[M+1],z=b[M+2],y=b[M+3],H=b[M+4],e=b[M+5],D=q*L,Z=u[D],K=u[D+1],X=1&e,r=!!(16&e),B=h,A=i,C=d,p=N;if(X&&(B=d,A=N,C=h,p=i),!(2&e&&w>=(z=c(o,W,w,z,B,A,K)))&&!(4&e&&(w=R(o,W,w,z,B,A,Z))>=z)){var G=z-w,k=H-y;if(r){if(o*G*(G+k)<l){if(void 0!==(Y=n.scanComplete(o,W,v,w,z,B,A,y,H,C,p)))return Y;continue}}else{if(o*Math.min(G,k)<x){if(void 0!==(Y=Q(o,W,v,X,w,z,B,A,y,H,C,p)))return Y;continue}if(o*G*k<f){if(void 0!==(Y=n.scanBipartite(o,W,v,X,w,z,B,A,y,H,C,p)))return Y;continue}}var oo=S(o,W,w,z,B,A,Z,K);if(w<oo)if(o*(oo-w)<x){if(void 0!==(Y=U(o,W+1,v,w,oo,B,A,y,H,C,p)))return Y}else if(W===o-2){if(void 0!==(Y=X?n.sweepBipartite(o,v,y,H,C,p,w,oo,B,A):n.sweepBipartite(o,v,w,oo,B,A,y,H,C,p)))return Y}else mo(q++,W+1,w,oo,y,H,X,-1/0,1/0),mo(q++,W+1,y,H,w,oo,1^X,-1/0,1/0);if(oo<z){var vo=O(o,W,y,H,C,p),Vo=C[P*vo+W],go=T(o,W,vo,H,C,p,Vo);if(go<H&&mo(q++,W,oo,z,go,H,(4|X)+(r?16:0),Vo,K),y<vo&&mo(q++,W,oo,z,y,vo,(2|X)+(r?16:0),Z,Vo),vo+1===go){if(void 0!==(Y=r?F(o,W,v,oo,z,B,A,vo,C,p[vo]):a(o,W,v,X,oo,z,B,A,vo,C,p[vo])))return Y}else if(vo<go){var Eo;if(r){if(oo<(Eo=j(o,W,oo,z,B,A,Vo))){var Io=T(o,W,oo,Eo,B,A,Vo);if(W===o-2){if(oo<Io&&void 0!==(Y=n.sweepComplete(o,v,oo,Io,B,A,vo,go,C,p)))return Y;if(Io<Eo&&void 0!==(Y=n.sweepBipartite(o,v,Io,Eo,B,A,vo,go,C,p)))return Y}else oo<Io&&mo(q++,W+1,oo,Io,vo,go,16,-1/0,1/0),Io<Eo&&(mo(q++,W+1,Io,Eo,vo,go,0,-1/0,1/0),mo(q++,W+1,vo,go,Io,Eo,1,-1/0,1/0))}}else oo<(Eo=X?t(o,W,oo,z,B,A,Vo):j(o,W,oo,z,B,A,Vo))&&(W===o-2?Y=X?n.sweepBipartite(o,v,vo,go,C,p,oo,Eo,B,A):n.sweepBipartite(o,v,oo,Eo,B,A,vo,go,C,p):(mo(q++,W+1,oo,Eo,vo,go,X,-1/0,1/0),mo(q++,W+1,vo,go,oo,Eo,1^X,-1/0,1/0)))}}}}};var g=V(14523),E=V(14527),I=V(14564),Q=I.partial,U=I.full,n=V(14549),O=V(14566),h=V(14574),x=128,f=1<<22,l=1<<22,S=h("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),T=h("lo===p0",["p0"]),c=h("lo<p0",["p0"]),R=h("hi<=p0",["p0"]),j=h("lo<=p0&&p0<=hi",["p0"]),t=h("lo<p0&&p0<=hi",["p0"]),s=6,L=2,b=g.mallocInt32(1024),u=g.mallocDouble(1024);function mo(o,v,V,g,E,I,Q,U,n){var O=s*o;b[O]=v,b[O+1]=V,b[O+2]=g,b[O+3]=E,b[O+4]=I,b[O+5]=Q;var h=L*o;u[h]=U,u[h+1]=n}function a(o,v,V,g,E,I,Q,U,n,O,h){var x=2*o,f=n*x,l=O[f+v];o:for(var S=E,T=E*x;S<I;++S,T+=x){var c=Q[T+v],R=Q[T+v+o];if(!(l<c||R<l)&&(!g||l!==c)){for(var j,t=U[S],s=v+1;s<o;++s){c=Q[T+s],R=Q[T+s+o];var L=O[f+s],b=O[f+s+o];if(R<L||b<c)continue o}if(void 0!==(j=g?V(h,t):V(t,h)))return j}}}function F(o,v,V,g,E,I,Q,U,n,O){var h=2*o,x=U*h,f=n[x+v];o:for(var l=g,S=g*h;l<E;++l,S+=h){var T=Q[l];if(T!==O){var c=I[S+v],R=I[S+v+o];if(!(f<c||R<f)){for(var j=v+1;j<o;++j){c=I[S+j],R=I[S+j+o];var t=n[x+j],s=n[x+j+o];if(R<t||s<c)continue o}var L=V(T,O);if(void 0!==L)return L}}}}},14566:(o,v,V)=>{"use strict";o.exports=function(o,v,V,Q,U,n){if(Q<=V+1)return V;var O=V,h=Q,x=Q+V>>>1,f=2*o,l=x,S=U[f*x+v];for(;O<h;){if(h-O<E){I(o,v,O,h,U,n),S=U[f*x+v];break}var T=h-O,c=Math.random()*T+O|0,R=U[f*c+v],j=Math.random()*T+O|0,t=U[f*j+v],s=Math.random()*T+O|0,L=U[f*s+v];R<=t?L>=t?(l=j,S=t):R>=L?(l=c,S=R):(l=s,S=L):t>=L?(l=j,S=t):L>=R?(l=c,S=R):(l=s,S=L);for(var b=f*(h-1),u=f*l,mo=0;mo<f;++mo,++b,++u){var a=U[b];U[b]=U[u],U[u]=a}var F=n[h-1];n[h-1]=n[l],n[l]=F;for(b=f*(h-1),u=f*(l=g(o,v,O,h-1,U,n,S)),mo=0;mo<f;++mo,++b,++u){a=U[b];U[b]=U[u],U[u]=a}F=n[h-1];if(n[h-1]=n[l],n[l]=F,x<l){for(h=l-1;O<h&&U[f*(h-1)+v]===S;)h-=1;h+=1}else{if(!(l<x))break;for(O=l+1;O<h&&U[f*O+v]===S;)O+=1}}return g(o,v,V,x,U,n,U[f*x+v])};var g=V(14574)("lo<p0",["p0"]),E=8;function I(o,v,V,g,E,I){for(var Q=2*o,U=Q*(V+1)+v,n=V+1;n<g;++n,U+=Q)for(var O=E[U],h=n,x=Q*(n-1);h>V&&E[x+v]>O;--h,x-=Q){for(var f=x,l=x+Q,S=0;S<Q;++S,++f,++l){var T=E[f];E[f]=E[l],E[l]=T}var c=I[h];I[h]=I[h-1],I[h-1]=c}}},14574:o=>{"use strict";o.exports=function(o,V){var g="abcdef".split("").concat(V),E=[];o.indexOf("lo")>=0&&E.push("lo=e[k+n]");o.indexOf("hi")>=0&&E.push("hi=e[k+o]");return g.push(v.replace("_",E.join()).replace("$",o)),Function.apply(void 0,g)};var v="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14557:o=>{"use strict";o.exports=function(o,g){g<=4*v?V(0,g-1,o):O(0,g-1,o)};var v=32;function V(o,v,V){for(var g=2*(o+1),E=o+1;E<=v;++E){for(var I=V[g++],Q=V[g++],U=E,n=g-2;U-- >o;){var O=V[n-2],h=V[n-1];if(O<I)break;if(O===I&&h<Q)break;V[n]=O,V[n+1]=h,n-=2}V[n]=I,V[n+1]=Q}}function g(o,v,V){v*=2;var g=V[o*=2],E=V[o+1];V[o]=V[v],V[o+1]=V[v+1],V[v]=g,V[v+1]=E}function E(o,v,V){v*=2,V[o*=2]=V[v],V[o+1]=V[v+1]}function I(o,v,V,g){v*=2,V*=2;var E=g[o*=2],I=g[o+1];g[o]=g[v],g[o+1]=g[v+1],g[v]=g[V],g[v+1]=g[V+1],g[V]=E,g[V+1]=I}function Q(o,v,V,g,E){v*=2,E[o*=2]=E[v],E[v]=V,E[o+1]=E[v+1],E[v+1]=g}function U(o,v,V){v*=2;var g=V[o*=2],E=V[v];return!(g<E)&&(g!==E||V[o+1]>V[v+1])}function n(o,v,V,g){var E=g[o*=2];return E<v||E===v&&g[o+1]<V}function O(o,h,x){var f=(h-o+1)/6|0,l=o+f,S=h-f,T=o+h>>1,c=T-f,R=T+f,j=l,t=c,s=T,L=R,b=S,u=o+1,mo=h-1,a=0;U(j,t,x)&&(a=j,j=t,t=a),U(L,b,x)&&(a=L,L=b,b=a),U(j,s,x)&&(a=j,j=s,s=a),U(t,s,x)&&(a=t,t=s,s=a),U(j,L,x)&&(a=j,j=L,L=a),U(s,L,x)&&(a=s,s=L,L=a),U(t,b,x)&&(a=t,t=b,b=a),U(t,s,x)&&(a=t,t=s,s=a),U(L,b,x)&&(a=L,L=b,b=a);for(var F=x[2*t],i=x[2*t+1],J=x[2*L],d=x[2*L+1],N=2*j,Y=2*s,q=2*b,P=2*l,M=2*T,W=2*S,w=0;w<2;++w){var z=x[N+w],y=x[Y+w],H=x[q+w];x[P+w]=z,x[M+w]=y,x[W+w]=H}E(c,o,x),E(R,h,x);for(var e=u;e<=mo;++e)if(n(e,F,i,x))e!==u&&g(e,u,x),++u;else if(!n(e,J,d,x))for(;;){if(n(mo,J,d,x)){n(mo,F,i,x)?(I(e,u,mo,x),++u,--mo):(g(e,mo,x),--mo);break}if(--mo<e)break}Q(o,u-1,F,i,x),Q(h,mo+1,J,d,x),u-2-o<=v?V(o,u-2,x):O(o,u-2,x),h-(mo+2)<=v?V(mo+2,h,x):O(mo+2,h,x),mo-u<=v?V(u,mo,x):O(u,mo,x)}},14549:(o,v,V)=>{"use strict";o.exports={init:function(o){var v=E.nextPow2(o);n.length<v&&(g.free(n),n=g.mallocInt32(v));O.length<v&&(g.free(O),O=g.mallocInt32(v));h.length<v&&(g.free(h),h=g.mallocInt32(v));x.length<v&&(g.free(x),x=g.mallocInt32(v));f.length<v&&(g.free(f),f=g.mallocInt32(v));l.length<v&&(g.free(l),l=g.mallocInt32(v));var V=8*v;S.length<V&&(g.free(S),S=g.mallocDouble(V))},sweepBipartite:function(o,v,V,g,E,U,f,l,R,j){for(var t=0,s=2*o,L=o-1,b=s-1,u=V;u<g;++u){var mo=U[u],a=s*u;S[t++]=E[a+L],S[t++]=-(mo+1),S[t++]=E[a+b],S[t++]=mo}for(u=f;u<l;++u){mo=j[u]+Q;var F=s*u;S[t++]=R[F+L],S[t++]=-mo,S[t++]=R[F+b],S[t++]=mo}var i=t>>>1;I(S,i);var J=0,d=0;for(u=0;u<i;++u){var N=0|S[2*u+1];if(N>=Q)T(h,x,d--,N=N-Q|0);else if(N>=0)T(n,O,J--,N);else if(N<=-Q){N=-N-Q|0;for(var Y=0;Y<J;++Y){if(void 0!==(q=v(n[Y],N)))return q}c(h,x,d++,N)}else{N=-N-1|0;for(Y=0;Y<d;++Y){var q;if(void 0!==(q=v(N,h[Y])))return q}c(n,O,J++,N)}}},sweepComplete:function(o,v,V,g,E,Q,U,R,j,t){for(var s=0,L=2*o,b=o-1,u=L-1,mo=V;mo<g;++mo){var a=Q[mo]+1<<1,F=L*mo;S[s++]=E[F+b],S[s++]=-a,S[s++]=E[F+u],S[s++]=a}for(mo=U;mo<R;++mo){a=t[mo]+1<<1;var i=L*mo;S[s++]=j[i+b],S[s++]=1|-a,S[s++]=j[i+u],S[s++]=1|a}var J=s>>>1;I(S,J);var d=0,N=0,Y=0;for(mo=0;mo<J;++mo){var q=0|S[2*mo+1],P=1&q;if(mo<J-1&&q>>1===S[2*mo+3]>>1&&(P=2,mo+=1),q<0){for(var M=-(q>>1)-1,W=0;W<Y;++W){if(void 0!==(w=v(f[W],M)))return w}if(0!==P)for(W=0;W<d;++W){if(void 0!==(w=v(n[W],M)))return w}if(1!==P)for(W=0;W<N;++W){var w;if(void 0!==(w=v(h[W],M)))return w}0===P?c(n,O,d++,M):1===P?c(h,x,N++,M):2===P&&c(f,l,Y++,M)}else{M=(q>>1)-1;0===P?T(n,O,d--,M):1===P?T(h,x,N--,M):2===P&&T(f,l,Y--,M)}}},scanBipartite:function(o,v,V,g,E,U,h,x,f,l,R,j){var t=0,s=2*o,L=v,b=v+o,u=1,mo=1;g?mo=Q:u=Q;for(var a=E;a<U;++a){var F=a+u,i=s*a;S[t++]=h[i+L],S[t++]=-F,S[t++]=h[i+b],S[t++]=F}for(a=f;a<l;++a){F=a+mo;var J=s*a;S[t++]=R[J+L],S[t++]=-F}var d=t>>>1;I(S,d);var N=0;for(a=0;a<d;++a){var Y=0|S[2*a+1];if(Y<0){var q=!1;if((F=-Y)>=Q?(q=!g,F-=Q):(q=!!g,F-=1),q)c(n,O,N++,F);else{var P=j[F],M=s*F,W=R[M+v+1],w=R[M+v+1+o];o:for(var z=0;z<N;++z){var y=n[z],H=s*y;if(!(w<h[H+v+1]||h[H+v+1+o]<W)){for(var e=v+2;e<o;++e)if(R[M+e+o]<h[H+e]||h[H+e+o]<R[M+e])continue o;var D,Z=x[y];if(void 0!==(D=g?V(P,Z):V(Z,P)))return D}}}}else T(n,O,N--,Y-u)}},scanComplete:function(o,v,V,g,E,U,O,h,x,f,l){for(var T=0,c=2*o,R=v,j=v+o,t=g;t<E;++t){var s=t+Q,L=c*t;S[T++]=U[L+R],S[T++]=-s,S[T++]=U[L+j],S[T++]=s}for(t=h;t<x;++t){s=t+1;var b=c*t;S[T++]=f[b+R],S[T++]=-s}var u=T>>>1;I(S,u);var mo=0;for(t=0;t<u;++t){var a=0|S[2*t+1];if(a<0){if((s=-a)>=Q)n[mo++]=s-Q;else{var F=l[s-=1],i=c*s,J=f[i+v+1],d=f[i+v+1+o];o:for(var N=0;N<mo;++N){var Y=n[N],q=O[Y];if(q===F)break;var P=c*Y;if(!(d<U[P+v+1]||U[P+v+1+o]<J)){for(var M=v+2;M<o;++M)if(f[i+M+o]<U[P+M]||U[P+M+o]<f[i+M])continue o;var W=V(q,F);if(void 0!==W)return W}}}}else{for(s=a-Q,N=mo-1;N>=0;--N)if(n[N]===s){for(M=N+1;M<mo;++M)n[M-1]=n[M];break}--mo}}}};var g=V(14523),E=V(14527),I=V(14557),Q=1<<28,U=1024,n=g.mallocInt32(U),O=g.mallocInt32(U),h=g.mallocInt32(U),x=g.mallocInt32(U),f=g.mallocInt32(U),l=g.mallocInt32(U),S=g.mallocDouble(8192);function T(o,v,V,g){var E=v[g],I=o[V-1];o[E]=I,v[I]=E}function c(o,v,V,g){o[V]=g,v[g]=V}},14535:o=>{"use strict";function v(o,V,g){var E=0|o[g];if(E<=0)return[];var I,Q=new Array(E);if(g===o.length-1)for(I=0;I<E;++I)Q[I]=V;else for(I=0;I<E;++I)Q[I]=v(o,V,g+1);return Q}o.exports=function(o,V){switch("undefined"===typeof V&&(V=0),typeof o){case"number":if(o>0)return function(o,v){var V,g;for(V=new Array(o),g=0;g<o;++g)V[g]=v;return V}(0|o,V);break;case"object":if("number"===typeof o.length)return v(o,V,0)}return[]}},14491:(o,v,V)=>{o.exports=function(){var o=this;this.components={},this.comps=this.components;var v=this.components,V=1,E={},I=[],Q=[],U={timeout:!1,removals:[],multiComps:[]};function n(o,V){var g=v[V],I=E[V],Q=I.hash[o];Q&&(I.remove(o),g.tv&&(g.multi?(Q.forEach((v=>{v&&g.tv(o,v)})),Q.length=0):g.tv(o,Q)),U.removals.push(I),O())}function O(){U.timeout||(U.timeout=!0,setTimeout(h,1))}function h(){U.timeout=!1,x()}function x(){U.multiComps.length&&function(o){for(var v=0;v<o.length;v++){var{entID:V,data:g}=o[v],E=g.hash[V];if(E){for(var I=0;I<E.length;I++)E[I]||(E.splice(I,1),I--);0===E.length&&(g.remove(V),U.removals.push(g))}}o.length=0}(U.multiComps),U.removals.length&&function(o){for(var v=0;v<o.length;v++){o[v].flush()}o.length=0}(U.removals)}this.Wx=E,this._systems=I,this._renderSystems=Q,this.kO=function(v){var g=V++;return Array.isArray(v)&&v.forEach((v=>o.Mn(g,v))),g},this.deleteEntity=function(v){return Object.keys(E).forEach((o=>{E[o].hash[v]&&n(v,o)})),o},this.mx=function(o){if(!o)throw new Error("Missing component definition");var V=o.name;if(!V)throw new Error("Component definition must have a name property.");if("string"!==typeof V)throw new Error("Component name must be a string.");if(""===V)throw new Error("Component name must be a non-empty string.");if(E[V])throw new Error(`Component ${V} already exists.`);var U={};return U.name=V,U.multi=!!o.multi,U.order=isNaN(o.order)?99:o.order,U.stateConstructor=o.stateConstructor||null,U.state=o.state||{},U.NU=o.NU||null,U.tv=o.tv||null,U.system=o.system||null,U.wU=o.wU||null,v[V]=U,E[V]=new g,E[V]._pendingMultiCleanup=!1,E[V]._multiCleanupIDs=U.multi?[]:null,U.system&&(I.push(V),I.sort(((o,V)=>v[o].order-v[V].order))),U.wU&&(Q.push(V),Q.sort(((o,V)=>v[o].order-v[V].order))),V},this.overwriteComponent=function(o,V){var g=v[o];if(!g)throw new Error(`Unknown component: ${o}`);if(!V)throw new Error("Missing component definition");if(g.name!==V.name)throw new Error("Overwriting component must use the same name property.");var U={};U.name=o,U.multi=!!V.multi,U.order=isNaN(V.order)?99:V.order,U.state=V.state||{},U.NU=V.NU||null,U.tv=V.tv||null,U.system=V.system||null,U.wU=V.wU||null,v[o]=U,E[o]._pendingMultiCleanup=!1,E[o]._multiCleanupIDs=U.multi?[]:null;var n=I.indexOf(o);U.system&&n<0&&I.push(o),!U.system&&n>=0&&I.splice(n,1),I.sort(((o,V)=>v[o].order-v[V].order));var O=Q.indexOf(o);U.wU&&O<0&&Q.push(o),!U.wU&&O>=0&&Q.splice(O,1),Q.sort(((o,V)=>v[o].order-v[V].order));var h=U.state;return this.PO(o).forEach((o=>{for(var v in h)v in o||(o[v]=h[v]);U.NU&&U.NU(o.MU,o)})),o},this.deleteComponent=function(V){var g=E[V];if(!g)throw new Error(`Unknown component: ${V}`);g.flush(),g.list.forEach((o=>{o&&n(o.MU||o[0].MU,V)}));var U=I.indexOf(V),O=Q.indexOf(V);return U>-1&&I.splice(U,1),O>-1&&Q.splice(O,1),E[V].dispose(),delete E[V],delete v[V],o},this.Mn=function(o,V,g){var I,Q=v[V],U=E[V];if(!U)throw new Error(`Unknown component: ${V}.`);if(U.hash[o]&&!Q.multi)throw new Error(`Entity ${o} already has component: ${V}.`);if(Q.stateConstructor){if(!(I=new Q.stateConstructor).hasOwnProperty("MU"))throw new Error(`Component ${Q.name} stateConstructor type does not have property __id`)}else I=Object.assign({},{MU:o},Q.state,g);if(I.MU=o,Q.multi){var n=U.hash[o];n||(n=[],U.add(o,n)),n.push(I)}else U.add(o,I);return Q.NU&&Q.NU(o,I),this},this.Xn=function(o,v){var V=E[v];if(!V)throw new Error(`Unknown component: ${v}.`);return!!V.hash[o]},this.yn=function(v,V){if(!E[V])throw new Error(`Unknown component: ${V}.`);return n(v,V),o},this.getState=function(o,v){var V=E[v];if(!V)throw new Error(`Unknown component: ${v}.`);return V.hash[o]},this.PO=function(o){var v=E[o];if(!v)throw new Error(`Unknown component: ${o}.`);return x(),v.list},this.Xl=function(o){if(!E[o])throw new Error(`Unknown component: ${o}.`);var v=E[o].hash;return o=>v[o]},this.Cl=function(o){if(!E[o])throw new Error(`Unknown component: ${o}.`);var v=E[o].hash;return o=>!!v[o]},this.TU=function(V){x();for(var g=0;g<I.length;g++){var Q=I[g],U=v[Q],n=E[Q];U.system(V,n.list),x()}return o},this.render=function(V){x();for(var g=0;g<Q.length;g++){var I=Q[g],U=v[I],n=E[I];U.wU(V,n.list),x()}return o},this.removeMultiComponent=function(V,g,I){var Q=v[g],n=E[g];if(!n)throw new Error(`Unknown component: ${g}.`);if(!Q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(o,v,V,g){var E=V.hash[o];if(E){var I=E[g];I&&(E[g]=null,v.tv&&v.tv(o,I),U.multiComps.push({entID:o,data:V}),O())}}(V,Q,n,I),o}};var g=V(14494)},14494:o=>{function v(o,v){var V=o._map[v];if(delete o.hash[v],delete o._map[v],V===o.list.length-1)o.list.pop();else{var g=o.list.pop();if(o.list[V]=g,null===g||null===g[0]){var E=o.list.length;for(var I in o._map)if(o._map[I]===E)return void(o._map[I]=V)}else{var Q=g.MU||g[0].MU;o._map[Q]=V}}}o.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(o,v){if("number"===typeof this._map[o]){var V=this._map[o];this.hash[o]=v,this.list[V]=v}else this._map[o]=this.list.length,this.hash[o]=v,this.list.push(v)}remove(o){var v=this._map[o];this.hash[o]=null,this.list[v]=null,this._pendingRemovals.push(o)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var o=0;o<this._pendingRemovals.length;o++){var V=this._pendingRemovals[o];null===this.hash[V]&&v(this,V)}this._pendingRemovals.length=0}}},14447:o=>{"use strict";var v,V="object"===typeof Reflect?Reflect:null,g=function(o,v,V){return Function.prototype.apply.call(o,v,V)};v=V&&"function"===typeof V.ownKeys?V.ownKeys:Object.getOwnPropertySymbols?function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:function(o){return Object.getOwnPropertyNames(o)};var E=Number.isNaN||function(o){return o!==o};function I(){I.init.call(this)}o.exports=I,o.exports.once=function(o,v){return new Promise((function(V,g){function E(V){o.removeListener(v,I),g(V)}function I(){"function"===typeof o.removeListener&&o.removeListener("error",E),V([].slice.call(arguments))}T(o,v,I,{once:!0}),"error"!==v&&function(o,v,V){"function"===typeof o.on&&T(o,"error",v,V)}(o,E,{once:!0})}))},I.EventEmitter=I,I.prototype._events=void 0,I.prototype._eventsCount=0,I.prototype._maxListeners=void 0;var Q=10;function U(o){if("function"!==typeof o)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}function n(o){return void 0===o._maxListeners?I.defaultMaxListeners:o._maxListeners}function O(o,v,V,g){var E,I,Q,O;if(U(V),void 0===(I=o._events)?(I=o._events=Object.create(null),o._eventsCount=0):(void 0!==I.newListener&&(o.emit("newListener",v,V.listener?V.listener:V),I=o._events),Q=I[v]),void 0===Q)Q=I[v]=V,++o._eventsCount;else if("function"===typeof Q?Q=I[v]=g?[V,Q]:[Q,V]:g?Q.unshift(V):Q.push(V),(E=n(o))>0&&Q.length>E&&!Q.warned){Q.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+Q.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.lo=o,h.type=v,h.count=Q.length,O=h,console&&console.warn&&console.warn(O)}return o}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(o,v,V){var g={fired:!1,wrapFn:void 0,target:o,type:v,listener:V},E=h.bind(g);return E.listener=V,g.wrapFn=E,E}function f(o,v,V){var g=o._events;if(void 0===g)return[];var E=g[v];return void 0===E?[]:"function"===typeof E?V?[E.listener||E]:[E]:V?function(o){for(var v=new Array(o.length),V=0;V<v.length;++V)v[V]=o[V].listener||o[V];return v}(E):S(E,E.length)}function l(o){var v=this._events;if(void 0!==v){var V=v[o];if("function"===typeof V)return 1;if(void 0!==V)return V.length}return 0}function S(o,v){for(var V=new Array(v),g=0;g<v;++g)V[g]=o[g];return V}function T(o,v,V,g){if("function"===typeof o.on)g.once?o.once(v,V):o.on(v,V);else{if("function"!==typeof o.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o);o.addEventListener(v,(function E(I){g.once&&o.removeEventListener(v,E),V(I)}))}}Object.defineProperty(I,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function(o){if("number"!==typeof o||o<0||E(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");Q=o}}),I.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},I.prototype.setMaxListeners=function(o){if("number"!==typeof o||o<0||E(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this},I.prototype.getMaxListeners=function(){return n(this)},I.prototype.emit=function(o){for(var v=[],V=1;V<arguments.length;V++)v.push(arguments[V]);var E="error"===o,I=this._events;if(void 0!==I)E=E&&void 0===I.error;else if(!E)return!1;if(E){var Q;if(v.length>0&&(Q=v[0]),Q instanceof Error)throw Q;var U=new Error("Unhandled error."+(Q?" ("+Q.message+")":""));throw U.context=Q,U}var n=I[o];if(void 0===n)return!1;if("function"===typeof n)g(n,this,v);else{var O=n.length,h=S(n,O);for(V=0;V<O;++V)g(h[V],this,v)}return!0},I.prototype.addListener=function(o,v){return O(this,o,v,!1)},I.prototype.on=I.prototype.addListener,I.prototype.prependListener=function(o,v){return O(this,o,v,!0)},I.prototype.once=function(o,v){return U(v),this.on(o,x(this,o,v)),this},I.prototype.prependOnceListener=function(o,v){return U(v),this.prependListener(o,x(this,o,v)),this},I.prototype.removeListener=function(o,v){var V,g,E,I,Q;if(U(v),void 0===(g=this._events))return this;if(void 0===(V=g[o]))return this;if(V===v||V.listener===v)0===--this._eventsCount?this._events=Object.create(null):(delete g[o],g.removeListener&&this.emit("removeListener",o,V.listener||v));else if("function"!==typeof V){for(E=-1,I=V.length-1;I>=0;I--)if(V[I]===v||V[I].listener===v){Q=V[I].listener,E=I;break}if(E<0)return this;0===E?V.shift():function(o,v){for(;v+1<o.length;v++)o[v]=o[v+1];o.pop()}(V,E),1===V.length&&(g[o]=V[0]),void 0!==g.removeListener&&this.emit("removeListener",o,Q||v)}return this},I.prototype.off=I.prototype.removeListener,I.prototype.Qv=function(o){var v,V,g;if(void 0===(V=this._events))return this;if(void 0===V.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==V[o]&&(0===--this._eventsCount?this._events=Object.create(null):delete V[o]),this;if(0===arguments.length){var E,I=Object.keys(V);for(g=0;g<I.length;++g)"removeListener"!==(E=I[g])&&this.Qv(E);return this.Qv("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(v=V[o]))this.removeListener(o,v);else if(void 0!==v)for(g=v.length-1;g>=0;g--)this.removeListener(o,v[g]);return this},I.prototype.listeners=function(o){return f(this,o,!0)},I.prototype.rawListeners=function(o){return f(this,o,!1)},I.listenerCount=function(o,v){return"function"===typeof o.listenerCount?o.listenerCount(v):l.call(o,v)},I.prototype.listenerCount=l,I.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]}},14740:o=>{"use strict";o.exports=function(o,v,V,g,E,I){var Q=+v[0],U=+v[1],n=+v[2],O=+V[0],h=+V[1],x=+V[2],f=Math.sqrt(O*O+h*h+x*x);if(0===f)throw new Error("Can't raycast along a zero vector");return function(o,v,V,g,E,I,Q,U,n,O){for(var h=0,x=Math.floor,f=0|x(v),l=0|x(V),S=0|x(g),T=E>0?1:-1,c=I>0?1:-1,R=Q>0?1:-1,j=Math.abs(1/E),t=Math.abs(1/I),s=Math.abs(1/Q),L=j<1/0?j*(T>0?f+1-v:v-f):1/0,b=t<1/0?t*(c>0?l+1-V:V-l):1/0,u=s<1/0?s*(R>0?S+1-g:g-S):1/0,mo=-1;h<=U;){var a=o(f,l,S);if(a)return n&&(n[0]=v+h*E,n[1]=V+h*I,n[2]=g+h*Q),O&&(O[0]=O[1]=O[2]=0,0===mo&&(O[0]=-T),1===mo&&(O[1]=-c),2===mo&&(O[2]=-R)),a;L<b?L<u?(f+=T,h=L,L+=j,mo=0):(S+=R,h=u,u+=s,mo=2):b<u?(l+=c,h=b,b+=t,mo=1):(S+=R,h=u,u+=s,mo=2)}return n&&(n[0]=v+h*E,n[1]=V+h*I,n[2]=g+h*Q),O&&(O[0]=O[1]=O[2]=0),0}(o,Q,U,n,O/=f,h/=f,x/=f,g="undefined"===typeof g?64:+g,E,I)}},14773:(o,v,V)=>{"use strict";V.d(v,{d:()=>I});var g=V(14447);function E(){this.Kf=!1,this.stopPropagation=!1,this.Xf=!1,this.disabled=!1}class I{constructor(o,v){this.version="0.7.0";var V=Object.assign({},new E,v||{});this.element=o||document,this.Kf=!!V.Kf,this.stopPropagation=!!V.stopPropagation,this.Xf=!!V.Xf,this.disabled=!!V.disabled,this.filterEvents=(o,v)=>!0,this.down=new g.EventEmitter,this.up=new g.EventEmitter,this.state={},this.iO={dx:0,dy:0,Wl:0,FO:0,wl:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?U(this):document.addEventListener("DOMContentLoaded",(o=>{U(this)}),{once:!0})}bind(o){for(var v=arguments.length,V=new Array(v>1?v-1:0),g=1;g<v;g++)V[g-1]=arguments[g];V.forEach((v=>{var V=this._keyBindmap[v]||[];V.includes(o)||(V.push(o),this._keyBindmap[v]=V)})),this.state[o]=!!this.state[o],this.pressCount[o]=this.pressCount[o]||0,this.releaseCount[o]=this.releaseCount[o]||0}unbind(o){for(var v in this._keyBindmap){var V=this._keyBindmap[v],g=V.indexOf(o);g>-1&&V.splice(g,1)}}getBindings(){var o={};for(var v in this._keyBindmap){this._keyBindmap[v].forEach((V=>{o[V]=o[V]||[],o[V].push(v)}))}return o}TU(){Q(this.iO),Q(this.pressCount),Q(this.releaseCount)}}function Q(o){for(var v in o)o[v]=0}function U(o){window.addEventListener("keydown",S.bind(null,o,!0),!1),window.addEventListener("keyup",S.bind(null,o,!1),!1);var v={passive:!0};o.element.addEventListener("touchstart",x.bind(void 0,o),{passive:!1}),o.element.addEventListener("touchend",l.bind(void 0,o),v),o.element.addEventListener("mousedown",T.bind(null,o,!0),v),window.document.addEventListener("mouseup",T.bind(null,o,!1),v),o.element.addEventListener("touchmove",c.bind(null,o),v),o.element.addEventListener("mousemove",c.bind(null,o),v),window.PointerEvent,o.element.addEventListener("wheel",R.bind(null,o),v),o.element.addEventListener("contextmenu",j.bind(null,o),!1),window.addEventListener("blur",t.bind(null,o),!1)}var n=0,O=0,h=null;function x(o,v){v.preventDefault(),f(v)}function f(o){let v=!1;for(let V=0;V<o.touches.length;++V)if(o.touches[V].identifier===h){v=!0;break}if(!v){const v=o.changedTouches[0];n=v.clientX,O=v.clientY,h=v.identifier}}function l(o,v){for(var V=v.changedTouches,g=0;g<V.length;++g)V[g].identifier===h&&(h=null)}function S(o,v,V){s(V.code,v,o,V)}function T(o,v,V){if("pointerId"in V)if(v){if(null!==o._touches.currID)return;o._touches.currID=V.pointerId}else{if(o._touches.currID!==V.pointerId)return;o._touches.currID=null}return s("Mouse"+("button"in V?V.button+1:1),v,o,V),!1}function c(o,v){var V=v.movementX||v.mozMovementX||0,g=v.movementY||v.mozMovementY||0;if(v.touches&&0===(V|g)){var E=function(o){f(o);for(let v=0;v<o.changedTouches.length;++v)if(o.changedTouches[v].identifier==h){const V=o.changedTouches[v],g=[V.clientX-n,V.clientY-O];return n=V.clientX,O=V.clientY,g}return console.error(`Did not find touch id ${h}`),[0,0]}(v);V=E[0],g=E[1]}o.iO.dx+=V,o.iO.dy+=g}function R(o,v){var V=1;switch(v.deltaMode){case 0:V=1;break;case 1:V=12;break;case 2:V=o.element.clientHeight||window.innerHeight}o.iO.Wl+=(v.deltaX||0)*V,o.iO.FO+=(v.deltaY||0)*V,o.iO.wl+=(v.deltaZ||0)*V}function j(o,v){if(!o.Xf)return v.preventDefault(),!1}function t(o){for(var v in o._keyStates)o._keyStates[v]&&(/^Mouse\d/.test(v)||s(v,!1,o,{code:v,note:"svl6vuzu75r",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(o,v,V,g){var E=V._keyBindmap[o];E&&(L(V._keyStates[o],v)&&(V._keyStates[o]=v,E.forEach((o=>{(!V.filterEvents||V.filterEvents(g,o))&&function(o,v,V,g){var E=v?V.pressCount:V.releaseCount;E[o]=(E[o]||0)+1;var I=V._bindPressCount[o]||0;(I+=v?1:-1)<0&&(I=0);V._bindPressCount[o]=I;var Q=V.state[o];if(L(Q,I)){V.state[o]=I>0;var U=v?V.down:V.up;V.disabled||U.emit(o,g)}}(o,v,V,g)}))),"button"in g||(V.Kf&&!g.defaultPrevented&&g.preventDefault(),V.stopPropagation&&g.stopPropagation()))}function L(o,v){return o?!v:v}},13406:o=>{o.exports=function(o,v,V){return o[0]=v[0]+V[0],o[1]=v[1]+V[1],o[2]=v[2]+V[2],o}},13359:(o,v,V)=>{o.exports=function(o,v){var V=g(o[0],o[1],o[2]),Q=g(v[0],v[1],v[2]);E(V,V),E(Q,Q);var U=I(V,Q);return U>1?0:Math.acos(U)};var g=V(13361),E=V(13366),I=V(13374)},13465:o=>{o.exports=function(o,v){return o[0]=Math.ceil(v[0]),o[1]=Math.ceil(v[1]),o[2]=Math.ceil(v[2]),o}},13357:o=>{o.exports=function(o){var v=new Float32Array(3);return v[0]=o[0],v[1]=o[1],v[2]=o[2],v}},13379:o=>{o.exports=function(o,v){return o[0]=v[0],o[1]=v[1],o[2]=v[2],o}},13352:o=>{o.exports=function(){var o=new Float32Array(3);return o[0]=0,o[1]=0,o[2]=0,o}},13516:o=>{o.exports=function(o,v,V){var g=v[0],E=v[1],I=v[2],Q=V[0],U=V[1],n=V[2];return o[0]=E*n-I*U,o[1]=I*Q-g*n,o[2]=g*U-E*Q,o}},13478:(o,v,V)=>{o.exports=V(13476)},13476:o=>{o.exports=function(o,v){var V=v[0]-o[0],g=v[1]-o[1],E=v[2]-o[2];return Math.sqrt(V*V+g*g+E*E)}},13442:(o,v,V)=>{o.exports=V(13439)},13439:o=>{o.exports=function(o,v,V){return o[0]=v[0]/V[0],o[1]=v[1]/V[1],o[2]=v[2]/V[2],o}},13374:o=>{o.exports=function(o,v){return o[0]*v[0]+o[1]*v[1]+o[2]*v[2]}},13345:o=>{o.exports=1e-6},13391:(o,v,V)=>{o.exports=function(o,v){var V=o[0],E=o[1],I=o[2],Q=v[0],U=v[1],n=v[2];return Math.abs(V-Q)<=g*Math.max(1,Math.abs(V),Math.abs(Q))&&Math.abs(E-U)<=g*Math.max(1,Math.abs(E),Math.abs(U))&&Math.abs(I-n)<=g*Math.max(1,Math.abs(I),Math.abs(n))};var g=V(13345)},13399:o=>{o.exports=function(o,v){return o[0]===v[0]&&o[1]===v[1]&&o[2]===v[2]}},13460:o=>{o.exports=function(o,v){return o[0]=Math.floor(v[0]),o[1]=Math.floor(v[1]),o[2]=Math.floor(v[2]),o}},13574:(o,v,V)=>{o.exports=function(o,v,V,E,I,Q){var U,n;v||(v=3);V||(V=0);n=E?Math.min(E*v+V,o.length):o.length;for(U=V;U<n;U+=v)g[0]=o[U],g[1]=o[U+1],g[2]=o[U+2],I(g,g,Q),o[U]=g[0],o[U+1]=g[1],o[U+2]=g[2];return o};var g=V(13352)()},13361:o=>{o.exports=function(o,v,V){var g=new Float32Array(3);return g[0]=o,g[1]=v,g[2]=V,g}},13337:(o,v,V)=>{o.exports={EPSILON:V(13345),create:V(13352),clone:V(13357),angle:V(13359),QU:V(13361),k:V(13379),set:V(13388),equals:V(13391),exactEquals:V(13399),add:V(13406),Rv:V(13415),sub:V(13419),multiply:V(13427),mul:V(13434),divide:V(13439),div:V(13442),min:V(13445),max:V(13452),floor:V(13460),ceil:V(13465),round:V(13467),scale:V(13469),UU:V(13471),distance:V(13476),j:V(13478),squaredDistance:V(13484),sqrDist:V(13486),length:V(13489),len:V(13497),squaredLength:V(13500),nU:V(13502),negate:V(13507),inverse:V(13509),normalize:V(13366),dot:V(13374),cross:V(13516),gU:V(13525),random:V(13528),transformMat4:V(13535),transformMat3:V(13539),transformQuat:V(13545),OU:V(13553),hU:V(13560),xU:V(13569),forEach:V(13574)}},13509:o=>{o.exports=function(o,v){return o[0]=1/v[0],o[1]=1/v[1],o[2]=1/v[2],o}},13497:(o,v,V)=>{o.exports=V(13489)},13489:o=>{o.exports=function(o){var v=o[0],V=o[1],g=o[2];return Math.sqrt(v*v+V*V+g*g)}},13525:o=>{o.exports=function(o,v,V,g){var E=v[0],I=v[1],Q=v[2];return o[0]=E+g*(V[0]-E),o[1]=I+g*(V[1]-I),o[2]=Q+g*(V[2]-Q),o}},13452:o=>{o.exports=function(o,v,V){return o[0]=Math.max(v[0],V[0]),o[1]=Math.max(v[1],V[1]),o[2]=Math.max(v[2],V[2]),o}},13445:o=>{o.exports=function(o,v,V){return o[0]=Math.min(v[0],V[0]),o[1]=Math.min(v[1],V[1]),o[2]=Math.min(v[2],V[2]),o}},13434:(o,v,V)=>{o.exports=V(13427)},13427:o=>{o.exports=function(o,v,V){return o[0]=v[0]*V[0],o[1]=v[1]*V[1],o[2]=v[2]*V[2],o}},13507:o=>{o.exports=function(o,v){return o[0]=-v[0],o[1]=-v[1],o[2]=-v[2],o}},13366:o=>{o.exports=function(o,v){var V=v[0],g=v[1],E=v[2],I=V*V+g*g+E*E;I>0&&(I=1/Math.sqrt(I),o[0]=v[0]*I,o[1]=v[1]*I,o[2]=v[2]*I);return o}},13528:o=>{o.exports=function(o,v){v=v||1;var V=2*Math.random()*Math.PI,g=2*Math.random()-1,E=Math.sqrt(1-g*g)*v;return o[0]=Math.cos(V)*E,o[1]=Math.sin(V)*E,o[2]=g*v,o}},13553:o=>{o.exports=function(o,v,V,g){var E=V[1],I=V[2],Q=v[1]-E,U=v[2]-I,n=Math.sin(g),O=Math.cos(g);return o[0]=v[0],o[1]=E+Q*O-U*n,o[2]=I+Q*n+U*O,o}},13560:o=>{o.exports=function(o,v,V,g){var E=V[0],I=V[2],Q=v[0]-E,U=v[2]-I,n=Math.sin(g),O=Math.cos(g);return o[0]=E+U*n+Q*O,o[1]=v[1],o[2]=I+U*O-Q*n,o}},13569:o=>{o.exports=function(o,v,V,g){var E=V[0],I=V[1],Q=v[0]-E,U=v[1]-I,n=Math.sin(g),O=Math.cos(g);return o[0]=E+Q*O-U*n,o[1]=I+Q*n+U*O,o[2]=v[2],o}},13467:o=>{o.exports=function(o,v){return o[0]=Math.round(v[0]),o[1]=Math.round(v[1]),o[2]=Math.round(v[2]),o}},13469:o=>{o.exports=function(o,v,V){return o[0]=v[0]*V,o[1]=v[1]*V,o[2]=v[2]*V,o}},13471:o=>{o.exports=function(o,v,V,g){return o[0]=v[0]+V[0]*g,o[1]=v[1]+V[1]*g,o[2]=v[2]+V[2]*g,o}},13388:o=>{o.exports=function(o,v,V,g){return o[0]=v,o[1]=V,o[2]=g,o}},13486:(o,v,V)=>{o.exports=V(13484)},13502:(o,v,V)=>{o.exports=V(13500)},13484:o=>{o.exports=function(o,v){var V=v[0]-o[0],g=v[1]-o[1],E=v[2]-o[2];return V*V+g*g+E*E}},13500:o=>{o.exports=function(o){var v=o[0],V=o[1],g=o[2];return v*v+V*V+g*g}},13419:(o,v,V)=>{o.exports=V(13415)},13415:o=>{o.exports=function(o,v,V){return o[0]=v[0]-V[0],o[1]=v[1]-V[1],o[2]=v[2]-V[2],o}},13539:o=>{o.exports=function(o,v,V){var g=v[0],E=v[1],I=v[2];return o[0]=g*V[0]+E*V[3]+I*V[6],o[1]=g*V[1]+E*V[4]+I*V[7],o[2]=g*V[2]+E*V[5]+I*V[8],o}},13535:o=>{o.exports=function(o,v,V){var g=v[0],E=v[1],I=v[2],Q=V[3]*g+V[7]*E+V[11]*I+V[15];return Q=Q||1,o[0]=(V[0]*g+V[4]*E+V[8]*I+V[12])/Q,o[1]=(V[1]*g+V[5]*E+V[9]*I+V[13])/Q,o[2]=(V[2]*g+V[6]*E+V[10]*I+V[14])/Q,o}},13545:o=>{o.exports=function(o,v,V){var g=v[0],E=v[1],I=v[2],Q=V[0],U=V[1],n=V[2],O=V[3],h=O*g+U*I-n*E,x=O*E+n*g-Q*I,f=O*I+Q*E-U*g,l=-Q*g-U*E-n*I;return o[0]=h*O+l*-Q+x*-n-f*-U,o[1]=x*O+l*-U+f*-Q-h*-n,o[2]=f*O+l*-n+h*-U-x*-Q,o}},14472:o=>{"use strict";o.exports=function(o){for(var v=new Array(o),V=0;V<o;++V)v[V]=V;return v}},14542:o=>{o.exports=function(o){return null!=o&&null!=o.constructor&&"function"===typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)}},14745:(o,v,V)=>{"use strict";V.d(v,{c:()=>g});class g{constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Vx=!1,this.gx=!1,this.ox=30,this.vx=0,this.lx=!1,this.fullscreen=!1,this.Ix=function(o){},this.Qx=function(){},this.hx=function(){},this.IV=function(){},this.Ux=function(o){},this.onFullscreenChanged=function(o){},O((()=>{!function(o,v){o._nowObject=performance||Date,o._lastTick=0,o._renderAccum=0,o._rt=0,o._frameCB=U.bind(null,o),requestAnimationFrame(o._frameCB),v>0&&(o._intervalCB=Q.bind(null,o),o._interval=setInterval(o._intervalCB,Math.max(v,1e3/o.ox/2)))}(this,v),function(o,v){if(!v)return;var V=!1,g=!1;document.addEventListener("pointerlockchange",(g=>{V=document.pointerLockElement===v,o.Ux(V)})),document.addEventListener("fullscreenchange",(V=>{g=document.fullscreenElement===v,o.onFullscreenChanged(g)})),Object.defineProperty(o,"lx",{get:()=>V,set:o=>{o&&!V?n(v):V&&!o&&function(o){o.exitPointerLock&&o.exitPointerLock()}(document)}}),Object.defineProperty(o,"fullscreen",{get:()=>g,set:o=>{o&&!g?v.requestFullscreen():g&&!o&&document.exitFullscreen()}}),v.addEventListener("click",(E=>{o.Vx&&!V&&n(v),o.gx&&!g&&v.requestFullscreen()}));var E=()=>o.IV();if(window.ResizeObserver){new ResizeObserver(E).observe(v)}else window.addEventListener("resize",E)}(this,o),this.hx()}))}}var E=3,I=20;function Q(o){for(var v=1e3/o.ox,V=o._nowObject.now()+I,g=0;o._nowObject.now()>=o._lastTick+v&&o._nowObject.now()<V&&++g<=E;)o.Ix(v),o._lastTick+=v;var Q=5*(v+5),U=o._nowObject.now();if(U-o._lastTick>Q)for(;U>=o._lastTick+v;)o._lastTick+=v}function U(o){requestAnimationFrame(o._frameCB),Q(o);var v=o._nowObject.now(),V=v-o._rt;if(o._rt=v,o.vx>0){o._renderAccum+=V;var g=1e3/o.vx;if(o._renderAccum<g)return;o._renderAccum=Math.min(o._renderAccum-g,g)}var E=1e3/o.ox,I=(v-o._lastTick)/E;o.Qx(V,I,E)}function n(o){o.requestPointerLock&&o.requestPointerLock()}var O=o=>{if("loading"===document.readyState){var v=()=>{document.removeEventListener("readystatechange",v),o()};document.addEventListener("readystatechange",v)}else setTimeout(o,1)}},14466:(o,v,V)=>{var g=V(14472),E=V(14480),I="undefined"!==typeof Float64Array;function Q(o,v){return o[0]-v[0]}function U(){var o,v=this.stride,V=new Array(v.length);for(o=0;o<V.length;++o)V[o]=[Math.abs(v[o]),o];V.sort(Q);var g=new Array(V.length);for(o=0;o<g.length;++o)g[o]=V[o][1];return g}function n(o,v){var V=["View",v,"d",o].join("");v<0&&(V="View_Nil"+o);var E="generic"===o;if(-1===v){var I="function "+V+"(a){this.data=a;};var proto="+V+".prototype;proto.dtype='"+o+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+V+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+V+"(a){return new "+V+"(a);}";return new Function(I)()}if(0===v){I="function "+V+"(a,d) {this.data = a;this.offset = d};var proto="+V+".prototype;proto.dtype='"+o+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+V+"_copy() {return new "+V+"(this.data,this.offset)};proto.pick=function "+V+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+V+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+V+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+V+"(a,b,c,d){return new "+V+"(a,d)}";return new Function("TrivialArray",I)(O[o][0])}I=["'use strict'"];var Q=g(v),n=Q.map((function(o){return"i"+o})),h="this.offset+"+Q.map((function(o){return"this.stride["+o+"]*i"+o})).join("+"),x=Q.map((function(o){return"b"+o})).join(","),f=Q.map((function(o){return"c"+o})).join(",");I.push("function "+V+"(a,"+x+","+f+",d){this.data=a","this.shape=["+x+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+V+".prototype","proto.dtype='"+o+"'","proto.dimension="+v),I.push("Object.defineProperty(proto,'size',{get:function "+V+"_size(){return "+Q.map((function(o){return"this.shape["+o+"]"})).join("*"),"}})"),1===v?I.push("proto.order=[0]"):(I.push("Object.defineProperty(proto,'order',{get:"),v<4?(I.push("function "+V+"_order(){"),2===v?I.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&I.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):I.push("ORDER})")),I.push("proto.set=function "+V+"_set("+n.join(",")+",v){"),E?I.push("return this.data.set("+h+",v)}"):I.push("return this.data["+h+"]=v}"),I.push("proto.get=function "+V+"_get("+n.join(",")+"){"),E?I.push("return this.data.get("+h+")}"):I.push("return this.data["+h+"]}"),I.push("proto.index=function "+V+"_index(",n.join(),"){return "+h+"}"),I.push("proto.hi=function "+V+"_hi("+n.join(",")+"){return new "+V+"(this.data,"+Q.map((function(o){return["(typeof i",o,"!=='number'||i",o,"<0)?this.shape[",o,"]:i",o,"|0"].join("")})).join(",")+","+Q.map((function(o){return"this.stride["+o+"]"})).join(",")+",this.offset)}");var l=Q.map((function(o){return"a"+o+"=this.shape["+o+"]"})),S=Q.map((function(o){return"c"+o+"=this.stride["+o+"]"}));I.push("proto.lo=function "+V+"_lo("+n.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+S.join(","));for(var T=0;T<v;++T)I.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");I.push("return new "+V+"(this.data,"+Q.map((function(o){return"a"+o})).join(",")+","+Q.map((function(o){return"c"+o})).join(",")+",b)}"),I.push("proto.step=function "+V+"_step("+n.join(",")+"){var "+Q.map((function(o){return"a"+o+"=this.shape["+o+"]"})).join(",")+","+Q.map((function(o){return"b"+o+"=this.stride["+o+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<v;++T)I.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");I.push("return new "+V+"(this.data,"+Q.map((function(o){return"a"+o})).join(",")+","+Q.map((function(o){return"b"+o})).join(",")+",c)}");var c=new Array(v),R=new Array(v);for(T=0;T<v;++T)c[T]="a[i"+T+"]",R[T]="b[i"+T+"]";I.push("proto.transpose=function "+V+"_transpose("+n+"){"+n.map((function(o,v){return o+"=("+o+"===undefined?"+v+":"+o+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+V+"(this.data,"+c.join(",")+","+R.join(",")+",this.offset)}"),I.push("proto.pick=function "+V+"_pick("+n+"){var a=[],b=[],c=this.offset");for(T=0;T<v;++T)I.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return I.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),I.push("return function construct_"+V+"(data,shape,stride,offset){return new "+V+"(data,"+Q.map((function(o){return"shape["+o+"]"})).join(",")+","+Q.map((function(o){return"stride["+o+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",I.join("\n"))(O[o],U)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};o.exports=function(o,v,V,g){if(void 0===o)return(0,O.array[0])([]);"number"===typeof o&&(o=[o]),void 0===v&&(v=[o.length]);var Q=v.length;if(void 0===V){V=new Array(Q);for(var U=Q-1,h=1;U>=0;--U)V[U]=h,h*=v[U]}if(void 0===g){g=0;for(U=0;U<Q;++U)V[U]<0&&(g-=(v[U]-1)*V[U])}for(var x=function(o){if(E(o))return"buffer";if(I)switch(Object.prototype.toString.call(o)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(o)?"array":"generic"}(o),f=O[x];f.length<=Q+1;)f.push(n(x,f.length-1));return(0,f[Q+1])(o,v,V,g)}},14480:o=>{function v(o){return!!o.constructor&&"function"===typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)}o.exports=function(o){return null!=o&&(v(o)||function(o){return"function"===typeof o.readFloatLE&&"function"===typeof o.slice&&v(o.slice(0,0))}(o)||!!o._isBuffer)}},14616:o=>{"use strict";var v=[],V=[],g=[],E=[],I=[],Q=[],U=[],n=[],O=[],h=[],x=[],f=[];o.exports=function(o,l,S,T,c,R){for(var j=U,t=O,s=h,L=f,b=0;b<3;b++)j[b]=+S[b],s[b]=+l.max[b],t[b]=+l.base[b];R||(R=1e-10);var u=function(o,U,O,h,f,l){var S=v,T=V,c=g,R=E,j=I,t=Q,s=n,L=Math.floor,b=0,u=0,mo=0,a=0,F=0;if(i(),0===mo)return 0;for(a=N();u<=mo;){if(J(a)&&d())return b;a=N()}for(b+=mo,F=0;F<3;F++)h[F]+=O[F],f[F]+=O[F];return b;function i(){if(u=0,0!==(mo=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2])))for(var o=0;o<3;o++){var v=O[o]>=0;R[o]=v?1:-1;var V=v?f[o]:h[o];S[o]=v?h[o]:f[o],T[o]=Y(V,R[o]),c[o]=q(S[o],R[o]),s[o]=O[o]/mo,j[o]=Math.abs(1/s[o]);var g=v?T[o]+1-V:V-T[o];t[o]=j[o]<1/0?j[o]*g:1/0}}function J(v){for(var V=R[0],g=0===v?T[0]:c[0],E=T[0]+V,I=R[1],Q=1===v?T[1]:c[1],U=T[1]+I,n=R[2],O=2===v?T[2]:c[2],h=T[2]+n,x=g;x!=E;x+=V)for(var f=Q;f!=U;f+=I)for(var l=O;l!=h;l+=n)if(o(x,f,l))return!0;return!1}function d(){b+=u;var o=R[a],v=u/mo,V=x;for(F=0;F<3;F++){var g=O[F]*v;h[F]+=g,f[F]+=g,V[F]=O[F]-g}if(o>0?f[a]=Math.round(f[a]):h[a]=Math.round(h[a]),U(b,a,o,V))return!0;for(F=0;F<3;F++)O[F]=V[F];return i(),0===mo}function N(){var o=t[0]<t[1]?t[0]<t[2]?0:2:t[1]<t[2]?1:2,v=t[o]-u;for(u=t[o],T[o]+=R[o],t[o]+=j[o],F=0;F<3;F++)S[F]+=v*s[F],c[F]=q(S[F],R[F]);return o}function Y(o,v){return L(o-v*l)}function q(o,v){return L(o+v*l)}}(o,T,j,t,s,R);if(!c){for(b=0;b<3;b++)L[b]=S[b]>0?s[b]-l.max[b]:t[b]-l.base[b];l.translate(L)}return u}},14782:(o,v,V)=>{"use strict";V.d(v,{d:()=>x});var g=V(14609),E=V(13337);class I{constructor(o,v,V,I,Q,U,n){this.qO=new g(o.base,o.CO),this.NE=v,this.friction=V,this.restitution=I,this.CQ=Q,this.ES=U,this.pQ=!!n,this.AO=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.KS=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.UO=E.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=E.create(),this._impulses=E.create(),this._sleepFrameCount=10}loadFromCopy(o){E.k(this.qO.base,o.qO.base),E.k(this.qO.CO,o.qO.CO),E.k(this.qO.max,o.qO.max),this.qO.mag=o.qO.mag,this.NE=o.NE,this.friction=o.friction,this.restitution=o.restitution,this.CQ=o.CQ,this.ES=o.ES,this.pQ=o.pQ,this.AO=o.AO,this.fluidDrag=o.fluidDrag,this.KS=o.KS,this.preventFallOffEdge=o.preventFallOffEdge,this.rolledBackLastTick=o.rolledBackLastTick,E.k(this.UO,o.UO),E.k(this.resting,o.resting),this.inFluid=o.inFluid,this._ratioInFluid=o._ratioInFluid,E.k(this._forces,o._forces),E.k(this._impulses,o._impulses),this._sleepFrameCount=o._sleepFrameCount}setPosition(o){Q(o),E.Rv(o,o,this.qO.base),this.qO.translate(o),this.hO()}mg(){return E.clone(this.qO.base)}applyForce(o){Q(o),E.add(this._forces,this._forces,o),this.hO()}applyImpulse(o){Q(o),E.add(this._impulses,this._impulses,o),this.hO()}hO(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Q=o=>{};var U=V(14609),n=V(13337),O=V(14616);function h(){this.AO=.1,this.fluidDrag=.4,this.VU=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function x(o,v,V){o=Object.assign(new h,o),this.gravity=o.gravity||[0,-10,0],this.AO=o.AO||.1,this.VU=o.VU||2,this.fluidDrag=o.fluidDrag||.4,this.minBounceImpulse=o.minBounceImpulse,this.bodies=[],this.al=o.al,this.testSolid=v,this.testFluid=V}x.prototype.xS=function(o,v,V,g,E,Q){o=o||new U([0,0,0],[1,1,1]),"undefined"==typeof v&&(v=1),"undefined"==typeof V&&(V=1),"undefined"==typeof g&&(g=0),"undefined"==typeof E&&(E=1);var n=new I(o,v,V,g,E,Q);return this.bodies.push(n),n},x.prototype.fS=function(o){var v=this.bodies.indexOf(o);v<0||(this.bodies.splice(v,1),o.qO=o.ES=null)};var f=n.create(),l=n.create(),S=n.create(),T=n.create(),c=n.create(),R=n.create(),j=n.create(),t=new U([0,0,0],[1,1,1]),s=new I(t,1,1,0,1,(()=>{}),!1);function L(o,v,V){return v=V,v*=1-(1-o.ratioInFluid)**2}x.prototype.TU=function(o){o/=1e3;var v=z(0,n.squaredLength(this.gravity));this.bodies.forEach((V=>function(o,v,V,g){n.k(c,v.resting),o.al&&s.loadFromCopy(v);if(v.NE<=0)return n.set(v.UO,0,0,0),n.set(v._forces,0,0,0),void n.set(v._impulses,0,0,0);var E=g||0===v.CQ;if(function(o,v,V,g){if(v._sleepFrameCount>0)return!1;if(g)return!0;var E=!1,I=.5*V*V*v.CQ;return n.scale(w,o.gravity,I),O(o.testSolid,v.qO,w,(function(){return E=!0,!0}),!0),E}(o,v,V,E))return;v._sleepFrameCount--,function(o,v){var V=v.qO,g=Math.floor(V.base[0]),E=Math.floor(V.base[2]),I=Math.floor(V.base[1]),Q=Math.floor(V.max[1]);if(!o.testFluid(g,I,E))return v.inFluid=!1,void(v.ratioInFluid=0);var U=1,O=I+1;for(;O<=Q&&o.testFluid(g,O,E);)U++,O++;var h=(I+U-V.base[1])/V.CO[1];h>1&&(h=1);var x=V.CO[0]*V.CO[1]*V.CO[2]*h,f=u;n.scale(f,o.gravity,-o.VU*x*v.CQ),v.applyForce(f),v.inFluid=!0,v.ratioInFluid=h}(o,v),H(v._forces),H(v._impulses),H(v.UO),H(v.resting),n.scale(f,v._forces,1/v.NE),n.UU(f,f,o.gravity,v.CQ),n.scale(l,v._impulses,1/v.NE),n.UU(l,l,f,V),n.add(v.UO,v.UO,l),v.friction&&(mo(o,0,v,l,V),mo(o,1,v,l,V),mo(o,2,v,l,V));var I=v.fluidDrag>=0?v.fluidDrag:o.fluidDrag,Q=v.AO>=0?v.AO:o.AO,U=Q,h=Q;v.inFluid&&(U=L(v,U,v.fluidDragHoriz>=0?v.fluidDragHoriz:I),h=L(v,h,v.fluidDragVert>=0?v.fluidDragVert:I));U=Math.max(1-U*V/v.NE,0),h=Math.max(1-h*V/v.NE,0),n.set(b,U,h,U),n.multiply(v.UO,v.UO,b),n.scale(S,v.UO,V),n.set(v._forces,0,0,0),n.set(v._impulses,0,0,0),v.pQ&&y(i,v.qO);n.k(R,S),n.set(j,0,0,0),v.preventFallOffEdge&&function(o,v,V,g){if(!v.resting[1]||V[1]>0)return;var E=P;y(E,v.qO);for(var I=0;I<3;I+=2){n.set(q,0,0,0),q[I]=V[I];var Q=!0;(Q=(Q=(Q=(Q=Q&&!W(o,E.base[0]+q[0]+1e-5,E.base[1],E.base[2]+q[2]+1e-5))&&!W(o,E.max[0]+q[0]-1e-5,E.base[1],E.base[2]+q[2]+1e-5))&&!W(o,E.base[0]+q[0]+1e-5,E.base[1],E.max[2]+q[2]-1e-5))&&!W(o,E.max[0]+q[0]-1e-5,E.base[1],E.max[2]+q[2]-1e-5))?(g[I]=V[I]>0?1:-1,V[I]=0):0===I&&(n.set(M,V[0],0,0),F(o,E,M,g,v.slideOnCollision))}}(o,v,S,j);F(o,v.qO,S,v.resting,v.slideOnCollision),v.pQ&&function(o,v,V,g){if(v.resting[1]>=0&&!v.inFluid)return;var E=0!==v.resting[0],I=0!==v.resting[2];if(!E&&!I)return;var Q=Math.abs(g[0]/g[2]),U=4;if(!E&&Q>U)return;if(!I&&Q<1/U)return;n.add(d,V.base,g);var h=o.testSolid;O(h,V,g,(function(o,v,V,g){if(1!==v)return!0;g[v]=0}));var x=V.base[1],f=v.inFluid?1.951:1.001,l=Math.floor(x+f)-x;n.set(N,0,l,0);var S=!1;if(O(h,V,N,(function(o,v,V,g){return S=!0,!0})),S)return;n.Rv(Y,d,V.base),Y[1]=0,F(o,V,Y,J,!0);var T=z(V.base[0],d[0]),c=z(V.base[2],d[2]);if(E&&!T&&(!c||!I))return;if(I&&(!T||!E)&&!c)return;var R=!0;if(R=R&&!W(o,V.base[0]+1e-5,V.base[1],V.base[2]+1e-5),R=R&&!W(o,V.max[0]-1e-5,V.base[1],V.base[2]+1e-5),R=R&&!W(o,V.base[0]+1e-5,V.base[1],V.max[2]-1e-5),R=R&&!W(o,V.max[0]-1e-5,V.base[1],V.max[2]-1e-5),R)return;y(v.qO,V),v.resting[0]=J[0],v.resting[2]=J[2],v.KS&&v.KS()}(o,v,i,R);for(var x=0;x<3;++x)v.resting[x]=v.resting[x]||j[x],T[x]=0,v.resting[x]&&(c[x]||(T[x]=-v.UO[x]),v.UO[x]=0);var t=n.length(T);t>.001&&(n.scale(T,T,v.NE),v.ES&&v.ES(T),v.restitution>0&&t>o.minBounceImpulse&&(n.scale(T,T,v.restitution),v.applyImpulse(T)));var a=n.squaredLength(v.UO);a>1e-5&&v.hO();o.al&&o.al(v)?(v.loadFromCopy(s),v.rolledBackLastTick=!0):v.rolledBackLastTick=!1}(this,V,o,v)))};var b=n.create([0,0,0]);var u=n.create();function mo(o,v,V,g,E){var I=V.resting[v],Q=g[v];if(!V.alwaysApplyHorizFriction||1!==v){if(0===I)return;if(I*Q<=0)return}n.k(a,V.UO),a[v]=0;var U=n.length(a);if(!z(U,0)){var O=Math.abs(V.friction*o.gravity[v]*E),h=U>O?(U-O)/U:0;V.UO[(v+1)%3]*=h,V.UO[(v+2)%3]*=h}}var a=n.create();function F(o,v,V,g,E){return n.set(g,0,0,0),O(o.testSolid,v,V,(function(o,v,V,I){g[v]=V,I[v]=0,E||(I[0]=0,I[1]=0,I[2]=0)}))}var i=new U([],[]),J=n.create(),d=n.create(),N=n.create(),Y=n.create();var q=n.create(),P=new U([],[]),M=n.create();function W(o,v,V,g){return o.testSolid(Math.floor(v),Math.floor(V-1),Math.floor(g))}var w=n.create();function z(o,v){return Math.abs(o-v)<1e-5}function y(o,v){for(var V=0;V<3;V++)o.base[V]=v.base[V],o.max[V]=v.max[V],o.CO[V]=v.CO[V]}var H=function(o){}},13196:function(o,v){!function(o){"use strict";var v=function(o,V){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,v){o.__proto__=v}||function(o,v){for(var V in v)Object.prototype.hasOwnProperty.call(v,V)&&(o[V]=v[V])},v(o,V)};function V(o,V){if("function"!==typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function g(){this.constructor=o}v(o,V),o.prototype=null===V?Object.create(V):(g.prototype=V.prototype,new g)}function g(o,v,V,g){var E,I=arguments.length,Q=I<3?v:null===g?g=Object.getOwnPropertyDescriptor(v,V):g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Q=Reflect.decorate(o,v,V,g);else for(var U=o.length-1;U>=0;U--)(E=o[U])&&(Q=(I<3?E(Q):I>3?E(v,V,Q):E(v,V))||Q);return I>3&&Q&&Object.defineProperty(v,V,Q),Q}function E(o,v,V){if(V||2===arguments.length)for(var g,E=0,I=v.length;E<I;E++)!g&&E in v||(g||(g=Array.prototype.slice.call(v,0,E)),g[E]=v[E]);return o.concat(g||Array.prototype.slice.call(v))}var I,Q=255,U=213;o.OPERATION=void 0,(I=o.OPERATION||(o.OPERATION={}))[I.ADD=128]="ADD",I[I.REPLACE=0]="REPLACE",I[I.DELETE=64]="DELETE",I[I.DELETE_AND_ADD=192]="DELETE_AND_ADD",I[I.TOUCH=1]="TOUCH",I[I.CLEAR=10]="CLEAR";var n=function(){function v(o,v,V){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=o,this.setParent(v,V)}return v.prototype.setParent=function(o,v,V){var g=this;if(this.indexes||(this.indexes=this.ref instanceof qo?this.ref._definition.indexes:{}),this.parent=o,this.parentIndex=V,v)if(this.root=v,this.ref instanceof qo){var E=this.ref._definition;for(var I in E.schema){var Q=this.ref[I];if(Q&&Q.$changes){var U=E.indexes[I];Q.$changes.setParent(this.ref,v,U)}}}else"object"===typeof this.ref&&this.ref.forEach((function(o,v){if(o instanceof qo){var V=o.$changes,E=g.ref.$changes.indexes[v];V.setParent(g.ref,g.root,E)}}))},v.prototype.operation=function(o){this.changes.set(--this.currentCustomOperation,o)},v.prototype.change=function(v,V){void 0===V&&(V=o.OPERATION.ADD);var g="number"===typeof v?v:this.indexes[v];this.assertValidIndex(g,v);var E=this.changes.get(g);E&&E.op!==o.OPERATION.DELETE&&E.op!==o.OPERATION.TOUCH||this.changes.set(g,{op:E&&E.op===o.OPERATION.DELETE?o.OPERATION.DELETE_AND_ADD:V,index:g}),this.allChanges.add(g),this.changed=!0,this.touchParents()},v.prototype.touch=function(v){var V="number"===typeof v?v:this.indexes[v];this.assertValidIndex(V,v),this.changes.has(V)||this.changes.set(V,{op:o.OPERATION.TOUCH,index:V}),this.allChanges.add(V),this.touchParents()},v.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},v.prototype.getType=function(o){if(this.ref._definition)return(v=this.ref._definition).schema[v.fieldsByIndex[o]];var v,V=(v=this.parent._definition).schema[v.fieldsByIndex[this.parentIndex]];return Object.values(V)[0]},v.prototype.getChildrenFilter=function(){var o=this.parent._definition.childFilters;return o&&o[this.parentIndex]},v.prototype.getValue=function(o){return this.ref.getByIndex(o)},v.prototype.delete=function(v){var V="number"===typeof v?v:this.indexes[v];if(void 0!==V){var g=this.getValue(V);this.changes.set(V,{op:o.OPERATION.DELETE,index:V}),this.allChanges.delete(V),delete this.caches[V],g&&g.$changes&&(g.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(v," (").concat(V,")"))},v.prototype.discard=function(v,V){var g=this;void 0===v&&(v=!1),void 0===V&&(V=!1),this.ref instanceof qo||this.changes.forEach((function(v){if(v.op===o.OPERATION.DELETE){var V=g.ref.getIndex(v.index);delete g.indexes[V]}})),this.changes.clear(),this.changed=v,V&&this.allChanges.clear(),this.currentCustomOperation=0},v.prototype.discardAll=function(){var o=this;this.changes.forEach((function(v){var V=o.getValue(v.index);V&&V.$changes&&V.$changes.discardAll()})),this.discard()},v.prototype.cache=function(o,v){this.caches[o]=v},v.prototype.clone=function(){return new v(this.ref,this.parent,this.root)},v.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},v.prototype.assertValidIndex=function(o,v){if(void 0===o)throw new Error('ChangeTree: missing index for field "'.concat(v,'"'))},v}();function O(o,v,V,g){return o[v]||(o[v]=[]),o[v].push(V),null===g||void 0===g||g.forEach((function(o,v){return V(o,v)})),function(){return x(o[v],o[v].indexOf(V))}}function h(v){var V=this,g="string"!==typeof this.$changes.getType();this.$items.forEach((function(E,I){v.push({refId:V.$changes.refId,op:o.OPERATION.DELETE,field:I,value:void 0,previousValue:E}),g&&V.$changes.root.removeRef(E.$changes.refId)}))}function x(o,v){if(-1===v||v>=o.length)return!1;for(var V=o.length-1,g=v;g<V;g++)o[g]=o[g+1];return o.length=V,!0}var f=function(o,v){var V=o.toString(),g=v.toString();return V<g?-1:V>g?1:0};function l(o){return o.$proxy=!0,o=new Proxy(o,{get:function(o,v){return"symbol"===typeof v||isNaN(v)?o[v]:o.at(v)},set:function(o,v,V){if("symbol"===typeof v||isNaN(v))o[v]=V;else{var g=Array.from(o.$items.keys()),E=parseInt(g[v]||v);void 0===V||null===V?o.deleteAt(E):o.setAt(E,V)}return!0},deleteProperty:function(o,v){return"number"===typeof v?o.deleteAt(v):delete o[v],!0}})}var S=function(){function v(){for(var o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,o)}return v.prototype.NU=function(v,V){return void 0===V&&(V=!0),O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,v,V?this.$items:void 0)},v.prototype.tv=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,v)},v.is=function(o){return Array.isArray(o)||void 0!==o.array},Object.defineProperty(v.prototype,"length",{get:function(){return this.$items.size},set:function(o){0===o?this.clear():this.splice(o,this.length-o)},enumerable:!1,configurable:!0}),v.prototype.push=function(){for(var o,v=this,V=[],g=0;g<arguments.length;g++)V[g]=arguments[g];return V.forEach((function(V){o=v.$refId++,v.setAt(o,V)})),o},v.prototype.pop=function(){var o=Array.from(this.$indexes.values()).pop();if(void 0!==o){this.$changes.delete(o),this.$indexes.delete(o);var v=this.$items.get(o);return this.$items.delete(o),v}},v.prototype.at=function(o){var v=Array.from(this.$items.keys())[o];return this.$items.get(v)},v.prototype.setAt=function(v,V){var g,E;if(void 0!==V&&null!==V){if(this.$items.get(v)!==V){void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,v);var I=null!==(E=null===(g=this.$changes.indexes[v])||void 0===g?void 0:g.op)&&void 0!==E?E:o.OPERATION.ADD;this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,V),this.$changes.change(v,I)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},v.prototype.deleteAt=function(o){var v=Array.from(this.$items.keys())[o];return void 0!==v&&this.$deleteAt(v)},v.prototype.$deleteAt=function(o){return this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.concat=function(){for(var o,V=[],g=0;g<arguments.length;g++)V[g]=arguments[g];return new(v.bind.apply(v,E([void 0],(o=Array.from(this.$items.values())).concat.apply(o,V),!1)))},v.prototype.join=function(o){return Array.from(this.$items.values()).join(o)},v.prototype.reverse=function(){var o=this,v=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(V,g){o.setAt(v[g],V)})),this},v.prototype.shift=function(){var o=Array.from(this.$items.keys()).shift();if(void 0!==o){var v=this.$items.get(o);return this.$deleteAt(o),v}},v.prototype.slice=function(o,V){var g=new v;return g.push.apply(g,Array.from(this.$items.values()).slice(o,V)),g},v.prototype.sort=function(o){var v=this;void 0===o&&(o=f);var V=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(o).forEach((function(o,g){v.setAt(V[g],o)})),this},v.prototype.splice=function(o,v){void 0===v&&(v=this.length-o);for(var V=Array.from(this.$items.keys()),g=[],E=o;E<o+v;E++)g.push(this.$items.get(V[E])),this.$deleteAt(V[E]);return g},v.prototype.unshift=function(){for(var o=this,v=[],V=0;V<arguments.length;V++)v[V]=arguments[V];var g=this.length,E=v.length,I=Array.from(this.$items.values());return v.forEach((function(v,V){o.setAt(V,v)})),I.forEach((function(v,V){o.setAt(E+V,v)})),g+E},v.prototype.indexOf=function(o,v){return Array.from(this.$items.values()).indexOf(o,v)},v.prototype.lastIndexOf=function(o,v){return void 0===v&&(v=this.length-1),Array.from(this.$items.values()).lastIndexOf(o,v)},v.prototype.every=function(o,v){return Array.from(this.$items.values()).every(o,v)},v.prototype.some=function(o,v){return Array.from(this.$items.values()).some(o,v)},v.prototype.forEach=function(o,v){Array.from(this.$items.values()).forEach(o,v)},v.prototype.map=function(o,v){return Array.from(this.$items.values()).map(o,v)},v.prototype.filter=function(o,v){return Array.from(this.$items.values()).filter(o,v)},v.prototype.reduce=function(o,v){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},v.prototype.reduceRight=function(o,v){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},v.prototype.find=function(o,v){return Array.from(this.$items.values()).find(o,v)},v.prototype.findIndex=function(o,v){return Array.from(this.$items.values()).findIndex(o,v)},v.prototype.fill=function(o,v,V){throw new Error("ArraySchema#fill() not implemented")},v.prototype.copyWithin=function(o,v,V){throw new Error("ArraySchema#copyWithin() not implemented")},v.prototype.toString=function(){return this.$items.toString()},v.prototype.toLocaleString=function(){return this.$items.toLocaleString()},v.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},v.prototype.includes=function(o,v){return Array.from(this.$items.values()).includes(o,v)},v.prototype.flatMap=function(o,v){throw new Error("ArraySchema#flatMap() is not supported.")},v.prototype.flat=function(o){throw new Error("ArraySchema#flat() is not supported.")},v.prototype.findLast=function(){var o=Array.from(this.$items.values());return o.findLast.apply(o,arguments)},v.prototype.findLastIndex=function(){var o=Array.from(this.$items.values());return o.findLastIndex.apply(o,arguments)},v.prototype.setIndex=function(o,v){this.$indexes.set(o,v)},v.prototype.getIndex=function(o){return this.$indexes.get(o)},v.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},v.prototype.deleteByIndex=function(o){var v=this.$indexes.get(o);this.$items.delete(v),this.$indexes.delete(o)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){return this.toArray().map((function(o){return"function"===typeof o.toJSON?o.toJSON():o}))},v.prototype.clone=function(o){return o?new(v.bind.apply(v,E([void 0],Array.from(this.$items.values()),!1))):new(v.bind.apply(v,E([void 0],this.map((function(o){return o.$changes?o.clone():o})),!1)))},v}();function T(o){return o.$proxy=!0,o=new Proxy(o,{get:function(o,v){return"symbol"!==typeof v&&"undefined"===typeof o[v]?o.get(v):o[v]},set:function(o,v,V){return"symbol"!==typeof v&&-1===v.indexOf("$")&&"NU"!==v&&"tv"!==v&&"onChange"!==v?o.set(v,V):o[v]=V,!0},deleteProperty:function(o,v){return o.delete(v),!0}})}var c=function(){function v(o){var V=this;if(this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o)if(o instanceof Map||o instanceof v)o.forEach((function(o,v){return V.set(v,o)}));else for(var g in o)this.set(g,o[g])}return v.prototype.NU=function(v,V){return void 0===V&&(V=!0),O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,v,V?this.$items:void 0)},v.prototype.tv=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,v)},v.is=function(o){return void 0!==o.map},v.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(v.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.set=function(v,V){if(void 0===V||null===V)throw new Error("MapSchema#set('".concat(v,"', ").concat(V,"): trying to set ").concat(V," value on '").concat(v,"'."));v=v.toString();var g="undefined"!==typeof this.$changes.indexes[v],E=g?this.$changes.indexes[v]:this.$refId++,I=g?o.OPERATION.REPLACE:o.OPERATION.ADD,Q=void 0!==V.$changes;if(Q&&V.$changes.setParent(this,this.$changes.root,E),g){if(!Q&&this.$items.get(v)===V)return;Q&&this.$items.get(v)!==V&&(I=o.OPERATION.ADD)}else this.$changes.indexes[v]=E,this.$indexes.set(E,v);return this.$items.set(v,V),this.$changes.change(v,I),this},v.prototype.get=function(o){return this.$items.get(o)},v.prototype.delete=function(o){return this.$changes.delete(o),this.$items.delete(o)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(o){return this.$items.has(o)},v.prototype.forEach=function(o){this.$items.forEach(o)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(o,v){this.$indexes.set(o,v)},v.prototype.getIndex=function(o){return this.$indexes.get(o)},v.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},v.prototype.deleteByIndex=function(o){var v=this.$indexes.get(o);this.$items.delete(v),this.$indexes.delete(o)},v.prototype.toJSON=function(){var o={};return this.forEach((function(v,V){o[V]="function"===typeof v.toJSON?v.toJSON():v})),o},v.prototype.clone=function(o){var V;return o?V=Object.assign(new v,this):(V=new v,this.forEach((function(o,v){o.$changes?V.set(v,o.clone()):V.set(v,o)}))),V},v}(),R={};function j(o,v){R[o]=v}function t(o){return R[o]}var s=function(){function o(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return o.create=function(v){var V=new o;return V.schema=Object.assign({},v&&v.schema||{}),V.indexes=Object.assign({},v&&v.indexes||{}),V.fieldsByIndex=Object.assign({},v&&v.fieldsByIndex||{}),V.descriptors=Object.assign({},v&&v.descriptors||{}),V.deprecated=Object.assign({},v&&v.deprecated||{}),V},o.prototype.addField=function(o,v){var V=this.getNextFieldIndex();this.fieldsByIndex[V]=o,this.indexes[o]=V,this.schema[o]=Array.isArray(v)?{array:v[0]}:v},o.prototype.hasField=function(o){return void 0!==this.indexes[o]},o.prototype.addFilter=function(o,v){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[o]]=v,this.indexesWithFilters.push(this.indexes[o]),!0},o.prototype.addChildrenFilter=function(o,v){var V=this.indexes[o],g=this.schema[o];if(t(Object.keys(g)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[V]=v,!0;console.warn("@filterChildren: field '".concat(o,"' can't have children. Ignoring filter."))},o.prototype.getChildrenFilter=function(o){return this.childFilters&&this.childFilters[this.indexes[o]]},o.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},o}();function L(o){return o._context&&o._context.useFilters}var b=function(){function o(){this.types={},this.schemas=new Map,this.useFilters=!1}return o.prototype.has=function(o){return this.schemas.has(o)},o.prototype.get=function(o){return this.types[o]},o.prototype.add=function(o,v){void 0===v&&(v=this.schemas.size),o._definition=s.create(o._definition),o._typeid=v,this.types[v]=o,this.schemas.set(o,v)},o.create=function(v){return void 0===v&&(v={}),function(V){return v.context||(v.context=new o),mo(V,v)}},o}(),u=new b;function mo(o,v){return void 0===v&&(v={}),function(V,g){var I=v.context||u,Q=V.constructor;if(Q._context=I,!o)throw new Error("".concat(Q.name,': @type() reference provided for "').concat(g,"\" is undefined. Make sure you don't have any circular dependencies."));I.has(Q)||I.add(Q);var U=Q._definition;if(U.addField(g,o),U.descriptors[g]){if(U.deprecated[g])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(g,"' definition on '").concat(Q.name,"'.\nCheck @type() annotation"))}catch(R){var n=R.stack.split("\n")[4].trim();throw new Error("".concat(R.message," ").concat(n))}}var O=S.is(o),h=!O&&c.is(o);if("string"!==typeof o&&!qo.is(o)){var x=Object.values(o)[0];"string"===typeof x||I.has(x)||I.add(x)}if(v.manual)U.descriptors[g]={enumerable:!0,configurable:!0,writable:!0};else{var f="_".concat(g);U.descriptors[f]={enumerable:!1,configurable:!1,writable:!0},U.descriptors[g]={get:function(){return this[f]},set:function(o){o!==this[f]&&(void 0!==o&&null!==o?(!O||o instanceof S||(o=new(S.bind.apply(S,E([void 0],o,!1)))),!h||o instanceof c||(o=new c(o)),void 0===o.$proxy&&(h?o=T(o):O&&(o=l(o))),this.$changes.change(g),o.$changes&&o.$changes.setParent(this,this.$changes.root,this._definition.indexes[g])):this[f]&&this.$changes.delete(g),this[f]=o)},enumerable:!0,configurable:!0}}}}function a(o){return function(v,V){var g=v.constructor;g._definition.addFilter(V,o)&&(g._context.useFilters=!0)}}function F(o){return function(v,V){var g=v.constructor;g._definition.addChildrenFilter(V,o)&&(g._context.useFilters=!0)}}function i(o){return void 0===o&&(o=!0),function(v,V){var g=v.constructor._definition;g.deprecated[V]=!0,o&&(g.descriptors[V]={get:function(){throw new Error("".concat(V," is deprecated."))},set:function(o){},enumerable:!1,configurable:!0})}}function J(o,v,V){for(var g in void 0===V&&(V={}),V.context||(V.context=o._context||V.context||u),v)mo(v[g],V)(o.prototype,g);return o}function d(o){for(var v=0,V=0,g=0,E=o.length;g<E;g++)(v=o.charCodeAt(g))<128?V+=1:v<2048?V+=2:v<55296||v>=57344?V+=3:(g++,V+=4);return V}function N(o,v,V){for(var g=0,E=0,I=V.length;E<I;E++)(g=V.charCodeAt(E))<128?o[v++]=g:g<2048?(o[v++]=192|g>>6,o[v++]=128|63&g):g<55296||g>=57344?(o[v++]=224|g>>12,o[v++]=128|g>>6&63,o[v++]=128|63&g):(E++,g=65536+((1023&g)<<10|1023&V.charCodeAt(E)),o[v++]=240|g>>18,o[v++]=128|g>>12&63,o[v++]=128|g>>6&63,o[v++]=128|63&g)}function Y(o,v){o.push(255&v)}function q(o,v){o.push(255&v)}function P(o,v){o.push(255&v),o.push(v>>8&255)}function M(o,v){o.push(255&v),o.push(v>>8&255)}function W(o,v){o.push(255&v),o.push(v>>8&255),o.push(v>>16&255),o.push(v>>24&255)}function w(o,v){var V=v>>24,g=v>>16,E=v>>8,I=v;o.push(255&I),o.push(255&E),o.push(255&g),o.push(255&V)}function z(o,v){var V=Math.floor(v/Math.pow(2,32));w(o,v>>>0),w(o,V)}function y(o,v){var V=v/Math.pow(2,32)|0;w(o,v>>>0),w(o,V)}function H(o,v){X(o,v)}function e(o,v){r(o,v)}var D=new Int32Array(2),Z=new Float32Array(D.buffer),K=new Float64Array(D.buffer);function X(o,v){Z[0]=v,W(o,D[0])}function r(o,v){K[0]=v,W(o,D[0]),W(o,D[1])}function B(o,v){return q(o,v?1:0)}function A(o,v){v||(v="");var V=d(v),g=0;if(V<32)o.push(160|V),g=1;else if(V<256)o.push(217),q(o,V),g=2;else if(V<65536)o.push(218),M(o,V),g=3;else{if(!(V<4294967296))throw new Error("String too long");o.push(219),w(o,V),g=5}return N(o,o.length,v),g+V}function C(o,v){return isNaN(v)?C(o,0):isFinite(v)?v!==(0|v)?(o.push(203),r(o,v),9):v>=0?v<128?(q(o,v),1):v<256?(o.push(204),q(o,v),2):v<65536?(o.push(205),M(o,v),3):v<4294967296?(o.push(206),w(o,v),5):(o.push(207),y(o,v),9):v>=-32?(o.push(224|v+32),1):v>=-128?(o.push(208),Y(o,v),2):v>=-32768?(o.push(209),P(o,v),3):v>=-2147483648?(o.push(210),W(o,v),5):(o.push(211),z(o,v),9):C(o,v>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:N,int8:Y,uint8:q,int16:P,uint16:M,int32:W,uint32:w,int64:z,uint64:y,float32:H,float64:e,writeFloat32:X,writeFloat64:r,boolean:B,string:A,number:C});function G(o,v,V){for(var g="",E=0,I=v,Q=v+V;I<Q;I++){var U=o[I];0!==(128&U)?192!==(224&U)?224!==(240&U)?240!==(248&U)?console.error("Invalid byte "+U.toString(16)):(E=(7&U)<<18|(63&o[++I])<<12|(63&o[++I])<<6|63&o[++I])>=65536?(E-=65536,g+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):g+=String.fromCharCode(E):g+=String.fromCharCode((15&U)<<12|(63&o[++I])<<6|63&o[++I]):g+=String.fromCharCode((31&U)<<6|63&o[++I]):g+=String.fromCharCode(U)}return g}function k(o,v){return oo(o,v)<<24>>24}function oo(o,v){return o[v.offset++]}function vo(o,v){return Vo(o,v)<<16>>16}function Vo(o,v){return o[v.offset++]|o[v.offset++]<<8}function go(o,v){return o[v.offset++]|o[v.offset++]<<8|o[v.offset++]<<16|o[v.offset++]<<24}function Eo(o,v){return go(o,v)>>>0}function Io(o,v){return fo(o,v)}function Qo(o,v){return lo(o,v)}function Uo(o,v){var V=Eo(o,v);return go(o,v)*Math.pow(2,32)+V}function no(o,v){var V=Eo(o,v);return Eo(o,v)*Math.pow(2,32)+V}var Oo=new Int32Array(2),ho=new Float32Array(Oo.buffer),xo=new Float64Array(Oo.buffer);function fo(o,v){return Oo[0]=go(o,v),ho[0]}function lo(o,v){return Oo[0]=go(o,v),Oo[1]=go(o,v),xo[0]}function So(o,v){return oo(o,v)>0}function To(o,v){var V,g=o[v.offset++];g<192?V=31&g:217===g?V=oo(o,v):218===g?V=Vo(o,v):219===g&&(V=Eo(o,v));var E=G(o,v.offset,V);return v.offset+=V,E}function co(o,v){var V=o[v.offset];return V<192&&V>160||217===V||218===V||219===V}function Ro(o,v){var V=o[v.offset++];return V<128?V:202===V?fo(o,v):203===V?lo(o,v):204===V?oo(o,v):205===V?Vo(o,v):206===V?Eo(o,v):207===V?no(o,v):208===V?k(o,v):209===V?vo(o,v):210===V?go(o,v):211===V?Uo(o,v):V>223?-1*(255-V+1):void 0}function jo(o,v){var V=o[v.offset];return V<128||V>=202&&V<=211}function to(o,v){return o[v.offset]<160}function so(o,v){return o[v.offset-1]===Q&&(o[v.offset]<128||o[v.offset]>=202&&o[v.offset]<=211)}var Lo=Object.freeze({__proto__:null,int8:k,uint8:oo,int16:vo,uint16:Vo,int32:go,uint32:Eo,float32:Io,float64:Qo,int64:Uo,uint64:no,readFloat32:fo,readFloat64:lo,boolean:So,string:To,stringCheck:co,number:Ro,numberCheck:jo,arrayCheck:to,switchStructureCheck:so}),bo=function(){function v(o){var v=this;this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach((function(o){return v.add(o)}))}return v.prototype.NU=function(v,V){return void 0===V&&(V=!0),O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,v,V?this.$items:void 0)},v.prototype.tv=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,v)},v.is=function(o){return void 0!==o.collection},v.prototype.add=function(o){var v=this.$refId++;return void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,v),this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,o),this.$changes.change(v),v},v.prototype.at=function(o){var v=Array.from(this.$items.keys())[o];return this.$items.get(v)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(o){for(var v,V,g=this.$items.entries();(V=g.next())&&!V.done;)if(o===V.value[1]){v=V.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(o){return Array.from(this.$items.values()).some((function(v){return v===o}))},v.prototype.forEach=function(o){var v=this;this.$items.forEach((function(V,g,E){return o(V,g,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(o,v){this.$indexes.set(o,v)},v.prototype.getIndex=function(o){return this.$indexes.get(o)},v.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},v.prototype.deleteByIndex=function(o){var v=this.$indexes.get(o);this.$items.delete(v),this.$indexes.delete(o)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var o=[];return this.forEach((function(v,V){o.push("function"===typeof v.toJSON?v.toJSON():v)})),o},v.prototype.clone=function(o){var V;return o?V=Object.assign(new v,this):(V=new v,this.forEach((function(o){o.$changes?V.add(o.clone()):V.add(o)}))),V},v}(),uo=function(){function v(o){var v=this;this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach((function(o){return v.add(o)}))}return v.prototype.NU=function(v,V){return void 0===V&&(V=!0),O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,v,V?this.$items:void 0)},v.prototype.tv=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,v)},v.is=function(o){return void 0!==o.set},v.prototype.add=function(v){var V,g;if(this.has(v))return!1;var E=this.$refId++;void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,E);var I=null!==(g=null===(V=this.$changes.indexes[E])||void 0===V?void 0:V.op)&&void 0!==g?g:o.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,v),this.$changes.change(E,I),E},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(o){for(var v,V,g=this.$items.entries();(V=g.next())&&!V.done;)if(o===V.value[1]){v=V.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(o){for(var v,V=this.$items.values(),g=!1;(v=V.next())&&!v.done;)if(o===v.value){g=!0;break}return g},v.prototype.forEach=function(o){var v=this;this.$items.forEach((function(V,g,E){return o(V,g,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(o,v){this.$indexes.set(o,v)},v.prototype.getIndex=function(o){return this.$indexes.get(o)},v.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},v.prototype.deleteByIndex=function(o){var v=this.$indexes.get(o);this.$items.delete(v),this.$indexes.delete(o)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var o=[];return this.forEach((function(v,V){o.push("function"===typeof v.toJSON?v.toJSON():v)})),o},v.prototype.clone=function(o){var V;return o?V=Object.assign(new v,this):(V=new v,this.forEach((function(o){o.$changes?V.add(o.clone()):V.add(o)}))),V},v}(),mv=function(){function o(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return o.prototype.addRefId=function(o){this.refIds.has(o)||(this.refIds.add(o),this.containerIndexes.set(o,new Set))},o.get=function(v){return void 0===v.$filterState&&(v.$filterState=new o),v.$filterState},o}(),ao=function(){function o(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return o.prototype.getNextUniqueId=function(){return this.nextUniqueId++},o.prototype.addRef=function(o,v,V){void 0===V&&(V=!0),this.refs.set(o,v),V&&(this.refCounts[o]=(this.refCounts[o]||0)+1)},o.prototype.removeRef=function(o){this.refCounts[o]=this.refCounts[o]-1,this.deletedRefs.add(o)},o.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},o.prototype.garbageCollectDeletedRefs=function(){var o=this;this.deletedRefs.forEach((function(v){if(!(o.refCounts[v]>0)){var V=o.refs.get(v);if(V instanceof qo)for(var g in V._definition.schema)"string"!==typeof V._definition.schema[g]&&V[g]&&V[g].$changes&&o.removeRef(V[g].$changes.refId);else{var E=V.$changes.parent._definition,I=E.schema[E.fieldsByIndex[V.$changes.parentIndex]];"function"===typeof Object.values(I)[0]&&Array.from(V.values()).forEach((function(v){return o.removeRef(v.$changes.refId)}))}o.refs.delete(v),delete o.refCounts[v]}})),this.deletedRefs.clear()},o}(),Fo=function(o){function v(){return null!==o&&o.apply(this,arguments)||this}return V(v,o),v}(Error);function io(o,v,V,g){var E,I=!1;switch(v){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(o)&&console.log('trying to encode "NaN" in '.concat(V.constructor.name,"#").concat(g));break;case"string":E="string",I=!0;break;case"boolean":return}if(typeof o!==E&&(!I||I&&null!==o)){var Q="'".concat(JSON.stringify(o),"'").concat(o&&o.constructor&&" (".concat(o.constructor.name,")")||"");throw new Fo("a '".concat(E,"' was expected, but ").concat(Q," was provided in ").concat(V.constructor.name,"#").concat(g))}}function Jo(o,v,V,g){if(!(o instanceof v))throw new Fo("a '".concat(v.name,"' was expected, but '").concat(o.constructor.name,"' was provided in ").concat(V.constructor.name,"#").concat(g))}function No(o,v,V,g,E){io(V,o,g,E);var I=p[o];if(!I)throw new Fo("a '".concat(o,"' was expected, but ").concat(V," was provided in ").concat(g.constructor.name,"#").concat(E));I(v,V)}function Yo(o,v,V){return Lo[o](v,V)}var qo=function(){function v(){for(var o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];Object.defineProperties(this,{$changes:{value:new n(this,void 0,new ao),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var V=this._definition.descriptors;V&&Object.defineProperties(this,V),o[0]&&this.assign(o[0])}return v.onError=function(o){console.error(o)},v.is=function(o){return o._definition&&void 0!==o._definition.schema},v.prototype.onChange=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,v)},v.prototype.tv=function(v){return O(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,v)},v.prototype.assign=function(o){return Object.assign(this,o),this},Object.defineProperty(v.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),v.prototype.setDirty=function(o,v){this.$changes.change(o,v)},v.prototype.listen=function(o,v,V){var g=this;return void 0===V&&(V=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[o]||(this.$callbacks[o]=[]),this.$callbacks[o].push(v),V&&void 0!==this[o]&&v(this[o],void 0),function(){return x(g.$callbacks[o],g.$callbacks[o].indexOf(v))}},v.prototype.decode=function(V,g,E){var I;void 0===g&&(g={offset:0}),void 0===E&&(E=this);var U=[],n=this.$changes.root,O=V.length,h=0;for(n.refs.set(h,this);g.offset<O;){var x=V[g.offset++];if(x!=Q){var f=E.$changes,l=void 0!==E._definition,T=l?x>>6<<6:x;if(T!==o.OPERATION.CLEAR){var R=l?x%(T||255):Ro(V,g),j=l?E._definition.fieldsByIndex[R]:"",s=f.getType(R),L=void 0,b=void 0,u=void 0;if(l?b=E["_".concat(j)]:(b=E.getByIndex(R),(T&o.OPERATION.ADD)===o.OPERATION.ADD?(u=E instanceof c?To(V,g):R,E.setIndex(R,u)):u=E.getIndex(R)),(T&o.OPERATION.DELETE)===o.OPERATION.DELETE&&(T!==o.OPERATION.DELETE_AND_ADD&&E.deleteByIndex(R),b&&b.$changes&&n.removeRef(b.$changes.refId),L=null),void 0!==j){if(T===o.OPERATION.DELETE);else if(v.is(s)){var mo=Ro(V,g);if(L=n.refs.get(mo),T!==o.OPERATION.REPLACE){var a=this.getSchemaType(V,g,s);L||((L=this.createTypeInstance(a)).$changes.refId=mo,b&&(L.$callbacks=b.$callbacks,b.$changes.refId&&mo!==b.$changes.refId&&n.removeRef(b.$changes.refId))),n.addRef(mo,L,L!==b)}}else if("string"===typeof s)L=Yo(s,V,g);else{var F=t(Object.keys(s)[0]),i=Ro(V,g),J=n.refs.has(i)?b||n.refs.get(i):new F.constructor;if((L=J.clone(!0)).$changes.refId=i,b&&(L.$callbacks=b.$callbacks,b.$changes.refId&&i!==b.$changes.refId)){n.removeRef(b.$changes.refId);for(var d=b.entries(),N=void 0;(N=d.next())&&!N.done;){var Y=(I=N.value)[0],q=I[1];U.push({refId:i,op:o.OPERATION.DELETE,field:Y,value:void 0,previousValue:q})}}n.addRef(i,L,J!==b)}if(null!==L&&void 0!==L)if(L.$changes&&L.$changes.setParent(f.ref,f.root,R),E instanceof v)E[j]=L;else if(E instanceof c)Y=u,E.$items.set(Y,L),E.$changes.allChanges.add(R);else if(E instanceof S)E.setAt(R,L);else if(E instanceof bo){var P=E.add(L);E.setIndex(R,P)}else E instanceof uo&&!1!==(P=E.add(L))&&E.setIndex(R,P);b!==L&&U.push({refId:h,op:T,field:j,dynamicIndex:u,value:L,previousValue:b})}else{console.warn("@colyseus/schema: definition mismatch");for(var M={offset:g.offset};g.offset<O&&(!so(V,g)||(M.offset=g.offset+1,!n.refs.has(Ro(V,M))));)g.offset++}}else E.clear(U)}else{h=Ro(V,g);var W=n.refs.get(h);if(!W)throw new Error('"refId" not found: '.concat(h));E=W}}return this._triggerChanges(U),n.garbageCollectDeletedRefs(),U},v.prototype.encode=function(V,g,E){void 0===V&&(V=!1),void 0===g&&(g=[]),void 0===E&&(E=!1);for(var I=this.$changes,U=new WeakSet,n=[I],O=1,h=0;h<O;h++){var x=n[h],f=x.ref,l=f instanceof v;x.ensureRefId(),U.add(x),x!==I&&(x.changed||V)&&(q(g,Q),C(g,x.refId));for(var S=V?Array.from(x.allChanges):Array.from(x.changes.values()),T=0,R=S.length;T<R;T++){var j=V?{op:o.OPERATION.ADD,index:S[T]}:S[T],s=j.index,L=l?f._definition.fieldsByIndex&&f._definition.fieldsByIndex[s]:s,b=g.length;if(j.op!==o.OPERATION.TOUCH)if(l)q(g,s|j.op);else{if(q(g,j.op),j.op===o.OPERATION.CLEAR)continue;C(g,s)}if(l||(j.op&o.OPERATION.ADD)!=o.OPERATION.ADD||f instanceof c&&A(g,x.ref.$indexes.get(s)),j.op!==o.OPERATION.DELETE){var u=x.getType(s),mo=x.getValue(s);if(mo&&mo.$changes&&!U.has(mo.$changes)&&(n.push(mo.$changes),mo.$changes.ensureRefId(),O++),j.op!==o.OPERATION.TOUCH){if(v.is(u))Jo(mo,u,f,L),C(g,mo.$changes.refId),(j.op&o.OPERATION.ADD)===o.OPERATION.ADD&&this.tryEncodeTypeId(g,u,mo.constructor);else if("string"===typeof u)No(u,g,mo,f,L);else{var a=t(Object.keys(u)[0]);Jo(f["_".concat(L)],a.constructor,f,L),C(g,mo.$changes.refId)}E&&x.cache(s,g.slice(b))}}}V||E||x.discard()}return g},v.prototype.encodeAll=function(o){return this.encode(!0,[],o)},v.prototype.applyFilters=function(V,g){var E,I;void 0===g&&(g=!1);for(var U=this,n=new Set,O=mv.get(V),h=[this.$changes],x=1,f=[],l=function(l){var S=h[l];if(n.has(S.refId))return"continue";var T=S.ref,R=T instanceof v;q(f,Q),C(f,S.refId);var j=O.refIds.has(S),t=g||!j;O.addRefId(S);var s=O.containerIndexes.get(S),L=t?Array.from(S.allChanges):Array.from(S.changes.values());!g&&R&&T._definition.indexesWithFilters&&T._definition.indexesWithFilters.forEach((function(v){!s.has(v)&&S.allChanges.has(v)&&(t?L.push(v):L.push({op:o.OPERATION.ADD,index:v}))}));for(var b=0,u=L.length;b<u;b++){var mo=t?{op:o.OPERATION.ADD,index:L[b]}:L[b];if(mo.op!==o.OPERATION.CLEAR){var a=mo.index;if(mo.op!==o.OPERATION.DELETE){var F=S.getValue(a),i=S.getType(a);if(R){if((J=T._definition.filters&&T._definition.filters[a])&&!J.call(T,V,F,U)){F&&F.$changes&&n.add(F.$changes.refId);continue}}else{var J,d=S.parent;if((J=S.getChildrenFilter())&&!J.call(d,V,T.$indexes.get(a),F,U)){F&&F.$changes&&n.add(F.$changes.refId);continue}}if(F.$changes&&(h.push(F.$changes),x++),mo.op!==o.OPERATION.TOUCH)if(mo.op===o.OPERATION.ADD||R)f.push.apply(f,null!==(E=S.caches[a])&&void 0!==E?E:[]),s.add(a);else if(s.has(a))f.push.apply(f,null!==(I=S.caches[a])&&void 0!==I?I:[]);else{if(s.add(a),q(f,o.OPERATION.ADD),C(f,a),T instanceof c){var N=S.ref.$indexes.get(a);A(f,N)}F.$changes?C(f,F.$changes.refId):p[i](f,F)}else F.$changes&&!R&&(q(f,o.OPERATION.ADD),C(f,a),T instanceof c&&(N=S.ref.$indexes.get(a),A(f,N)),C(f,F.$changes.refId))}else R?q(f,mo.op|a):(q(f,mo.op),C(f,a))}else q(f,mo.op)}},S=0;S<x;S++)l(S);return f},v.prototype.clone=function(){var o,v=new this.constructor,V=this._definition.schema;for(var g in V)"object"===typeof this[g]&&"function"===typeof(null===(o=this[g])||void 0===o?void 0:o.clone)?v[g]=this[g].clone():v[g]=this[g];return v},v.prototype.toJSON=function(){var o=this._definition.schema,v=this._definition.deprecated,V={};for(var g in o)v[g]||null===this[g]||"undefined"===typeof this[g]||(V[g]="function"===typeof this[g].toJSON?this[g].toJSON():this["_".concat(g)]);return V},v.prototype.discardAllChanges=function(){this.$changes.discardAll()},v.prototype.getByIndex=function(o){return this[this._definition.fieldsByIndex[o]]},v.prototype.deleteByIndex=function(o){this[this._definition.fieldsByIndex[o]]=void 0},v.prototype.tryEncodeTypeId=function(o,v,V){v._typeid!==V._typeid&&(q(o,U),C(o,V._typeid))},v.prototype.getSchemaType=function(o,v,V){var g;return o[v.offset]===U&&(v.offset++,g=this.constructor._context.get(Ro(o,v))),g||V},v.prototype.createTypeInstance=function(o){var v=new o;return v.$changes.root=this.$changes.root,v},v.prototype._triggerChanges=function(V){for(var g,E,I,Q,U,n,O,h,x,f=new Set,l=this.$changes.root.refs,S=function(S){var T=V[S],c=T.refId,R=l.get(c),j=R.$callbacks;if((T.op&o.OPERATION.DELETE)===o.OPERATION.DELETE&&T.previousValue instanceof v&&(null===(E=null===(g=T.previousValue.$callbacks)||void 0===g?void 0:g[o.OPERATION.DELETE])||void 0===E||E.forEach((function(o){return o()}))),!j)return"continue";if(R instanceof v){if(!f.has(c))try{null===(I=null===j||void 0===j?void 0:j[o.OPERATION.REPLACE])||void 0===I||I.forEach((function(o){return o()}))}catch(t){v.onError(t)}try{j.hasOwnProperty(T.field)&&(null===(Q=j[T.field])||void 0===Q||Q.forEach((function(o){return o(T.value,T.previousValue)})))}catch(t){v.onError(t)}}else T.op===o.OPERATION.ADD&&void 0===T.previousValue?null===(U=j[o.OPERATION.ADD])||void 0===U||U.forEach((function(o){var v;return o(T.value,null!==(v=T.dynamicIndex)&&void 0!==v?v:T.field)})):T.op===o.OPERATION.DELETE?void 0!==T.previousValue&&(null===(n=j[o.OPERATION.DELETE])||void 0===n||n.forEach((function(o){var v;return o(T.previousValue,null!==(v=T.dynamicIndex)&&void 0!==v?v:T.field)}))):T.op===o.OPERATION.DELETE_AND_ADD&&(void 0!==T.previousValue&&(null===(O=j[o.OPERATION.DELETE])||void 0===O||O.forEach((function(o){var v;return o(T.previousValue,null!==(v=T.dynamicIndex)&&void 0!==v?v:T.field)}))),null===(h=j[o.OPERATION.ADD])||void 0===h||h.forEach((function(o){var v;return o(T.value,null!==(v=T.dynamicIndex)&&void 0!==v?v:T.field)}))),T.value!==T.previousValue&&(null===(x=j[o.OPERATION.REPLACE])||void 0===x||x.forEach((function(o){var v;return o(T.value,null!==(v=T.dynamicIndex)&&void 0!==v?v:T.field)})));f.add(c)},T=0;T<V.length;T++)S(T)},v._definition=s.create(),v}();function Po(o){for(var v=[o.$changes],V=1,g={},E=g,I=function(o){var V=v[o];V.changes.forEach((function(o){var v=V.ref,g=o.index,I=v._definition?v._definition.fieldsByIndex[g]:v.$indexes.get(g);E[I]=V.getValue(g)}))},Q=0;Q<V;Q++)I(Q);return g}var Mo={context:new b},Wo=function(o){function v(){return null!==o&&o.apply(this,arguments)||this}return V(v,o),g([mo("string",Mo)],v.prototype,"name",void 0),g([mo("string",Mo)],v.prototype,"type",void 0),g([mo("number",Mo)],v.prototype,"referencedType",void 0),v}(qo),wo=function(o){function v(){var v=null!==o&&o.apply(this,arguments)||this;return v.fields=new S,v}return V(v,o),g([mo("number",Mo)],v.prototype,"id",void 0),g([mo([Wo],Mo)],v.prototype,"fields",void 0),v}(qo),zo=function(o){function v(){var v=null!==o&&o.apply(this,arguments)||this;return v.types=new S,v}return V(v,o),v.encode=function(o){var V=o.constructor,g=new v;g.rootType=V._typeid;var E=function(o,v){for(var V in v){var E=new Wo;E.name=V;var I=void 0;if("string"===typeof v[V])I=v[V];else{var Q=v[V],U=void 0;qo.is(Q)?(I="ref",U=v[V]):"string"===typeof Q[I=Object.keys(Q)[0]]?I+=":"+Q[I]:U=Q[I],E.referencedType=U?U._typeid:-1}E.type=I,o.fields.push(E)}g.types.push(o)},I=V._context.types;for(var Q in I){var U=new wo;U.id=Number(Q),E(U,I[Q]._definition.schema)}return g.encodeAll()},v.decode=function(o,g){var E=new b,I=new v;I.decode(o,g);var Q=I.types.reduce((function(o,v){var g=function(o){function v(){return null!==o&&o.apply(this,arguments)||this}return V(v,o),v}(qo),I=v.id;return o[I]=g,E.add(g,I),o}),{});I.types.forEach((function(o){var v=Q[o.id];o.fields.forEach((function(o){var V;if(void 0!==o.referencedType){var g=o.type,I=Q[o.referencedType];if(!I){var U=o.type.split(":");g=U[0],I=U[1]}"ref"===g?mo(I,{context:E})(v.prototype,o.name):mo(((V={})[g]=I,V),{context:E})(v.prototype,o.name)}else mo(o.type,{context:E})(v.prototype,o.name)}))}));var U=Q[I.rootType],n=new U;for(var O in U._definition.schema){var h=U._definition.schema[O];"string"!==typeof h&&(n[O]="function"===typeof h?new h:new(t(Object.keys(h)[0]).constructor))}return n},g([mo([wo],Mo)],v.prototype,"types",void 0),g([mo("number",Mo)],v.prototype,"rootType",void 0),v}(qo);j("map",{constructor:c}),j("array",{constructor:S}),j("set",{constructor:uo}),j("collection",{constructor:bo}),o.ArraySchema=S,o.CollectionSchema=bo,o.Context=b,o.MapSchema=c,o.Reflection=zo,o.ReflectionField=Wo,o.ReflectionType=wo,o.Schema=qo,o.SchemaDefinition=s,o.SetSchema=uo,o.decode=Lo,o.defineTypes=J,o.deprecated=i,o.dumpChanges=Po,o.encode=p,o.filter=a,o.filterChildren=F,o.hasFilter=L,o.registerType=j,o.type=mo,Object.defineProperty(o,"__esModule",{value:!0})}(v)},14663:o=>{"use strict";o.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14657:(o,v,V)=>{var g=V(14663),E=V(14671),I=Object.hasOwnProperty,Q=Object.create(null);for(var U in g)I.call(g,U)&&(Q[g[U]]=U);var n=o.exports={to:{},get:{}};function O(o,v,V){return Math.min(Math.max(v,o),V)}function h(o){var v=Math.round(o).toString(16).toUpperCase();return v.length<2?"0"+v:v}n.get=function(o){var v,V;switch(o.substring(0,3).toLowerCase()){case"hsl":v=n.get.hsl(o),V="hsl";break;case"hwb":v=n.get.hwb(o),V="hwb";break;default:v=n.get.rgb(o),V="rgb"}return v?{model:V,value:v}:null},n.get.rgb=function(o){if(!o)return null;var v,V,E,Q=[0,0,0,1];if(v=o.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(E=v[2],v=v[1],V=0;V<3;V++){var U=2*V;Q[V]=parseInt(v.slice(U,U+2),16)}E&&(Q[3]=parseInt(E,16)/255)}else if(v=o.match(/^#([a-f0-9]{3,4})$/i)){for(E=(v=v[1])[3],V=0;V<3;V++)Q[V]=parseInt(v[V]+v[V],16);E&&(Q[3]=parseInt(E+E,16)/255)}else if(v=o.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(V=0;V<3;V++)Q[V]=parseInt(v[V+1],0);v[4]&&(v[5]?Q[3]=.01*parseFloat(v[4]):Q[3]=parseFloat(v[4]))}else{if(!(v=o.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(v=o.match(/^(\w+)$/))?"transparent"===v[1]?[0,0,0,0]:I.call(g,v[1])?((Q=g[v[1]])[3]=1,Q):null:null;for(V=0;V<3;V++)Q[V]=Math.round(2.55*parseFloat(v[V+1]));v[4]&&(v[5]?Q[3]=.01*parseFloat(v[4]):Q[3]=parseFloat(v[4]))}for(V=0;V<3;V++)Q[V]=O(Q[V],0,255);return Q[3]=O(Q[3],0,1),Q},n.get.hsl=function(o){if(!o)return null;var v=o.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var V=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,O(parseFloat(v[2]),0,100),O(parseFloat(v[3]),0,100),O(isNaN(V)?1:V,0,1)]}return null},n.get.hwb=function(o){if(!o)return null;var v=o.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var V=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,O(parseFloat(v[2]),0,100),O(parseFloat(v[3]),0,100),O(isNaN(V)?1:V,0,1)]}return null},n.to.hex=function(){var o=E(arguments);return"#"+h(o[0])+h(o[1])+h(o[2])+(o[3]<1?h(Math.round(255*o[3])):"")},n.to.rgb=function(){var o=E(arguments);return o.length<4||1===o[3]?"rgb("+Math.round(o[0])+", "+Math.round(o[1])+", "+Math.round(o[2])+")":"rgba("+Math.round(o[0])+", "+Math.round(o[1])+", "+Math.round(o[2])+", "+o[3]+")"},n.to.rgb.percent=function(){var o=E(arguments),v=Math.round(o[0]/255*100),V=Math.round(o[1]/255*100),g=Math.round(o[2]/255*100);return o.length<4||1===o[3]?"rgb("+v+"%, "+V+"%, "+g+"%)":"rgba("+v+"%, "+V+"%, "+g+"%, "+o[3]+")"},n.to.hsl=function(){var o=E(arguments);return o.length<4||1===o[3]?"hsl("+o[0]+", "+o[1]+"%, "+o[2]+"%)":"hsla("+o[0]+", "+o[1]+"%, "+o[2]+"%, "+o[3]+")"},n.to.hwb=function(){var o=E(arguments),v="";return o.length>=4&&1!==o[3]&&(v=", "+o[3]),"hwb("+o[0]+", "+o[1]+"%, "+o[2]+"%"+v+")"},n.to.keyword=function(o){return Q[o.slice(0,3)]}},14649:(o,v,V)=>{const g=V(14657),E=V(14678),I=["keyword","gray","hex"],Q={};for(const l of Object.keys(E))Q[[...E[l].labels].sort().join("")]=l;const U={};function n(o,v){if(!(this instanceof n))return new n(o,v);if(v&&v in I&&(v=null),v&&!(v in E))throw new Error("Unknown model: "+v);let V,O;if(null==o)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(o instanceof n)this.model=o.model,this.color=[...o.color],this.valpha=o.valpha;else if("string"===typeof o){const v=g.get(o);if(null===v)throw new Error("Unable to parse color from string: "+o);this.model=v.model,O=E[this.model].channels,this.color=v.value.slice(0,O),this.valpha="number"===typeof v.value[O]?v.value[O]:1}else if(o.length>0){this.model=v||"rgb",O=E[this.model].channels;const V=Array.prototype.slice.call(o,0,O);this.color=f(V,O),this.valpha="number"===typeof o[O]?o[O]:1}else if("number"===typeof o)this.model="rgb",this.color=[o>>16&255,o>>8&255,255&o],this.valpha=1;else{this.valpha=1;const v=Object.keys(o);"alpha"in o&&(v.splice(v.indexOf("alpha"),1),this.valpha="number"===typeof o.alpha?o.alpha:0);const g=v.sort().join("");if(!(g in Q))throw new Error("Unable to parse color from object: "+JSON.stringify(o));this.model=Q[g];const{labels:I}=E[this.model],U=[];for(V=0;V<I.length;V++)U.push(o[I[V]]);this.color=f(U)}if(U[this.model])for(O=E[this.model].channels,V=0;V<O;V++){const o=U[this.model][V];o&&(this.color[V]=o(this.color[V]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}n.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(o){let v=this.model in g.to?this:this.rgb();v=v.round("number"===typeof o?o:1);const V=1===v.valpha?v.color:[...v.color,this.valpha];return g.to[v.model](V)},percentString(o){const v=this.rgb().round("number"===typeof o?o:1),V=1===v.valpha?v.color:[...v.color,this.valpha];return g.to.rgb.percent(V)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const o={},{channels:v}=E[this.model],{labels:V}=E[this.model];for(let g=0;g<v;g++)o[V[g]]=this.color[g];return 1!==this.valpha&&(o.alpha=this.valpha),o},unitArray(){const o=this.rgb().color;return o[0]/=255,o[1]/=255,o[2]/=255,1!==this.valpha&&o.push(this.valpha),o},unitObject(){const o=this.rgb().object();return o.r/=255,o.g/=255,o.b/=255,1!==this.valpha&&(o.alpha=this.valpha),o},round(o){return o=Math.max(o||0,0),new n([...this.color.map(O(o)),this.valpha],this.model)},alpha(o){return void 0!==o?new n([...this.color,Math.max(0,Math.min(1,o))],this.model):this.valpha},red:h("rgb",0,x(255)),green:h("rgb",1,x(255)),blue:h("rgb",2,x(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(o=>(o%360+360)%360)),saturationl:h("hsl",1,x(100)),lightness:h("hsl",2,x(100)),saturationv:h("hsv",1,x(100)),value:h("hsv",2,x(100)),chroma:h("hcg",1,x(100)),gray:h("hcg",2,x(100)),white:h("hwb",1,x(100)),wblack:h("hwb",2,x(100)),cyan:h("cmyk",0,x(100)),magenta:h("cmyk",1,x(100)),yellow:h("cmyk",2,x(100)),black:h("cmyk",3,x(100)),x:h("xyz",0,x(95.047)),y:h("xyz",1,x(100)),z:h("xyz",2,x(108.833)),l:h("lab",0,x(100)),a:h("lab",1),b:h("lab",2),keyword(o){return void 0!==o?new n(o):E[this.model].keyword(this.color)},hex(o){return void 0!==o?new n(o):g.to.hex(this.rgb().round().color)},hexa(o){if(void 0!==o)return new n(o);const v=this.rgb().round().color;let V=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===V.length&&(V="0"+V),g.to.hex(v)+V},rgbNumber(){const o=this.rgb().color;return(255&o[0])<<16|(255&o[1])<<8|255&o[2]},luminosity(){const o=this.rgb().color,v=[];for(const[V,g]of o.entries()){const o=g/255;v[V]=o<=.04045?o/12.92:((o+.055)/1.055)**2.4}return.2126*v[0]+.7152*v[1]+.0722*v[2]},contrast(o){const v=this.luminosity(),V=o.luminosity();return v>V?(v+.05)/(V+.05):(V+.05)/(v+.05)},level(o){const v=this.contrast(o);return v>=7?"AAA":v>=4.5?"AA":""},isDark(){const o=this.rgb().color;return(2126*o[0]+7152*o[1]+722*o[2])/1e4<128},isLight(){return!this.isDark()},negate(){const o=this.rgb();for(let v=0;v<3;v++)o.color[v]=255-o.color[v];return o},lighten(o){const v=this.hsl();return v.color[2]+=v.color[2]*o,v},darken(o){const v=this.hsl();return v.color[2]-=v.color[2]*o,v},saturate(o){const v=this.hsl();return v.color[1]+=v.color[1]*o,v},desaturate(o){const v=this.hsl();return v.color[1]-=v.color[1]*o,v},whiten(o){const v=this.hwb();return v.color[1]+=v.color[1]*o,v},blacken(o){const v=this.hwb();return v.color[2]+=v.color[2]*o,v},grayscale(){const o=this.rgb().color,v=.3*o[0]+.59*o[1]+.11*o[2];return n.rgb(v,v,v)},fade(o){return this.alpha(this.valpha-this.valpha*o)},opaquer(o){return this.alpha(this.valpha+this.valpha*o)},rotate(o){const v=this.hsl();let V=v.color[0];return V=(V+o)%360,V=V<0?360+V:V,v.color[0]=V,v},mix(o,v){if(!o||!o.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof o);const V=o.rgb(),g=this.rgb(),E=void 0===v?.5:v,I=2*E-1,Q=V.alpha()-g.alpha(),U=((I*Q===-1?I:(I+Q)/(1+I*Q))+1)/2,O=1-U;return n.rgb(U*V.red()+O*g.red(),U*V.green()+O*g.green(),U*V.blue()+O*g.blue(),V.alpha()*E+g.alpha()*(1-E))}};for(const l of Object.keys(E)){if(I.includes(l))continue;const{channels:o}=E[l];n.prototype[l]=function(){if(this.model===l)return new n(this);for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];return v.length>0?new n(v,l):new n([...(g=E[this.model][l].raw(this.color),Array.isArray(g)?g:[g]),this.valpha],l);var g},n[l]=function(){for(var v=arguments.length,V=new Array(v),g=0;g<v;g++)V[g]=arguments[g];let E=V[0];return"number"===typeof E&&(E=f(V,o)),new n(E,l)}}function O(o){return function(v){return function(o,v){return Number(o.toFixed(v))}(v,o)}}function h(o,v,V){o=Array.isArray(o)?o:[o];for(const g of o)(U[g]||(U[g]=[]))[v]=V;return o=o[0],function(g){let E;return void 0!==g?(V&&(g=V(g)),E=this[o](),E.color[v]=g,E):(E=this[o]().color[v],V&&(E=V(E)),E)}}function x(o){return function(v){return Math.max(0,Math.min(o,v))}}function f(o,v){for(let V=0;V<v;V++)"number"!==typeof o[V]&&(o[V]=0);return o}o.exports=n},14683:(o,v,V)=>{const g=V(14688),E={};for(const Q of Object.keys(g))E[g[Q]]=Q;const I={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};o.exports=I;for(const Q of Object.keys(I)){if(!("channels"in I[Q]))throw new Error("missing channels property: "+Q);if(!("labels"in I[Q]))throw new Error("missing channel labels property: "+Q);if(I[Q].labels.length!==I[Q].channels)throw new Error("channel and label counts mismatch: "+Q);const{channels:o,labels:v}=I[Q];delete I[Q].channels,delete I[Q].labels,Object.defineProperty(I[Q],"channels",{value:o}),Object.defineProperty(I[Q],"labels",{value:v})}I.rgb.hsl=function(o){const v=o[0]/255,V=o[1]/255,g=o[2]/255,E=Math.min(v,V,g),I=Math.max(v,V,g),Q=I-E;let U,n;I===E?U=0:v===I?U=(V-g)/Q:V===I?U=2+(g-v)/Q:g===I&&(U=4+(v-V)/Q),U=Math.min(60*U,360),U<0&&(U+=360);const O=(E+I)/2;return n=I===E?0:O<=.5?Q/(I+E):Q/(2-I-E),[U,100*n,100*O]},I.rgb.hsv=function(o){let v,V,g,E,I;const Q=o[0]/255,U=o[1]/255,n=o[2]/255,O=Math.max(Q,U,n),h=O-Math.min(Q,U,n),x=function(o){return(O-o)/6/h+.5};return 0===h?(E=0,I=0):(I=h/O,v=x(Q),V=x(U),g=x(n),Q===O?E=g-V:U===O?E=1/3+v-g:n===O&&(E=2/3+V-v),E<0?E+=1:E>1&&(E-=1)),[360*E,100*I,100*O]},I.rgb.hwb=function(o){const v=o[0],V=o[1];let g=o[2];const E=I.rgb.hsl(o)[0],Q=1/255*Math.min(v,Math.min(V,g));return g=1-1/255*Math.max(v,Math.max(V,g)),[E,100*Q,100*g]},I.rgb.cmyk=function(o){const v=o[0]/255,V=o[1]/255,g=o[2]/255,E=Math.min(1-v,1-V,1-g);return[100*((1-v-E)/(1-E)||0),100*((1-V-E)/(1-E)||0),100*((1-g-E)/(1-E)||0),100*E]},I.rgb.keyword=function(o){const v=E[o];if(v)return v;let V,I=1/0;for(const E of Object.keys(g)){const v=g[E],n=(U=v,((Q=o)[0]-U[0])**2+(Q[1]-U[1])**2+(Q[2]-U[2])**2);n<I&&(I=n,V=E)}var Q,U;return V},I.keyword.rgb=function(o){return g[o]},I.rgb.xyz=function(o){let v=o[0]/255,V=o[1]/255,g=o[2]/255;v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92;return[100*(.4124*v+.3576*V+.1805*g),100*(.2126*v+.7152*V+.0722*g),100*(.0193*v+.1192*V+.9505*g)]},I.rgb.lab=function(o){const v=I.rgb.xyz(o);let V=v[0],g=v[1],E=v[2];V/=95.047,g/=100,E/=108.883,V=V>.008856?V**(1/3):7.787*V+16/116,g=g>.008856?g**(1/3):7.787*g+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*g-16,500*(V-g),200*(g-E)]},I.hsl.rgb=function(o){const v=o[0]/360,V=o[1]/100,g=o[2]/100;let E,I,Q;if(0===V)return Q=255*g,[Q,Q,Q];E=g<.5?g*(1+V):g+V-g*V;const U=2*g-E,n=[0,0,0];for(let O=0;O<3;O++)I=v+1/3*-(O-1),I<0&&I++,I>1&&I--,Q=6*I<1?U+6*(E-U)*I:2*I<1?E:3*I<2?U+(E-U)*(2/3-I)*6:U,n[O]=255*Q;return n},I.hsl.hsv=function(o){const v=o[0];let V=o[1]/100,g=o[2]/100,E=V;const I=Math.max(g,.01);g*=2,V*=g<=1?g:2-g,E*=I<=1?I:2-I;return[v,100*(0===g?2*E/(I+E):2*V/(g+V)),100*((g+V)/2)]},I.hsv.rgb=function(o){const v=o[0]/60,V=o[1]/100;let g=o[2]/100;const E=Math.floor(v)%6,I=v-Math.floor(v),Q=255*g*(1-V),U=255*g*(1-V*I),n=255*g*(1-V*(1-I));switch(g*=255,E){case 0:return[g,n,Q];case 1:return[U,g,Q];case 2:return[Q,g,n];case 3:return[Q,U,g];case 4:return[n,Q,g];case 5:return[g,Q,U]}},I.hsv.hsl=function(o){const v=o[0],V=o[1]/100,g=o[2]/100,E=Math.max(g,.01);let I,Q;Q=(2-V)*g;const U=(2-V)*E;return I=V*E,I/=U<=1?U:2-U,I=I||0,Q/=2,[v,100*I,100*Q]},I.hwb.rgb=function(o){const v=o[0]/360;let V=o[1]/100,g=o[2]/100;const E=V+g;let I;E>1&&(V/=E,g/=E);const Q=Math.floor(6*v),U=1-g;I=6*v-Q,0!==(1&Q)&&(I=1-I);const n=V+I*(U-V);let O,h,x;switch(Q){default:case 6:case 0:O=U,h=n,x=V;break;case 1:O=n,h=U,x=V;break;case 2:O=V,h=U,x=n;break;case 3:O=V,h=n,x=U;break;case 4:O=n,h=V,x=U;break;case 5:O=U,h=V,x=n}return[255*O,255*h,255*x]},I.cmyk.rgb=function(o){const v=o[0]/100,V=o[1]/100,g=o[2]/100,E=o[3]/100;return[255*(1-Math.min(1,v*(1-E)+E)),255*(1-Math.min(1,V*(1-E)+E)),255*(1-Math.min(1,g*(1-E)+E))]},I.xyz.rgb=function(o){const v=o[0]/100,V=o[1]/100,g=o[2]/100;let E,I,Q;return E=3.2406*v+-1.5372*V+-.4986*g,I=-.9689*v+1.8758*V+.0415*g,Q=.0557*v+-.204*V+1.057*g,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,I=I>.0031308?1.055*I**(1/2.4)-.055:12.92*I,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,E=Math.min(Math.max(0,E),1),I=Math.min(Math.max(0,I),1),Q=Math.min(Math.max(0,Q),1),[255*E,255*I,255*Q]},I.xyz.lab=function(o){let v=o[0],V=o[1],g=o[2];v/=95.047,V/=100,g/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,g=g>.008856?g**(1/3):7.787*g+16/116;return[116*V-16,500*(v-V),200*(V-g)]},I.lab.xyz=function(o){let v,V,g;V=(o[0]+16)/116,v=o[1]/500+V,g=V-o[2]/200;const E=V**3,I=v**3,Q=g**3;return V=E>.008856?E:(V-16/116)/7.787,v=I>.008856?I:(v-16/116)/7.787,g=Q>.008856?Q:(g-16/116)/7.787,v*=95.047,V*=100,g*=108.883,[v,V,g]},I.lab.lch=function(o){const v=o[0],V=o[1],g=o[2];let E;E=360*Math.atan2(g,V)/2/Math.PI,E<0&&(E+=360);return[v,Math.sqrt(V*V+g*g),E]},I.lch.lab=function(o){const v=o[0],V=o[1],g=o[2]/360*2*Math.PI;return[v,V*Math.cos(g),V*Math.sin(g)]},I.rgb.ansi16=function(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[V,g,E]=o;let Q=null===v?I.rgb.hsv(o)[2]:v;if(Q=Math.round(Q/50),0===Q)return 30;let U=30+(Math.round(E/255)<<2|Math.round(g/255)<<1|Math.round(V/255));return 2===Q&&(U+=60),U},I.hsv.ansi16=function(o){return I.rgb.ansi16(I.hsv.rgb(o),o[2])},I.rgb.ansi256=function(o){const v=o[0],V=o[1],g=o[2];if(v===V&&V===g)return v<8?16:v>248?231:Math.round((v-8)/247*24)+232;return 16+36*Math.round(v/255*5)+6*Math.round(V/255*5)+Math.round(g/255*5)},I.ansi16.rgb=function(o){let v=o%10;if(0===v||7===v)return o>50&&(v+=3.5),v=v/10.5*255,[v,v,v];const V=.5*(1+~~(o>50));return[(1&v)*V*255,(v>>1&1)*V*255,(v>>2&1)*V*255]},I.ansi256.rgb=function(o){if(o>=232){const v=10*(o-232)+8;return[v,v,v]}let v;o-=16;return[Math.floor(o/36)/5*255,Math.floor((v=o%36)/6)/5*255,v%6/5*255]},I.rgb.hex=function(o){const v=(((255&Math.round(o[0]))<<16)+((255&Math.round(o[1]))<<8)+(255&Math.round(o[2]))).toString(16).toUpperCase();return"000000".substring(v.length)+v},I.hex.rgb=function(o){const v=o.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!v)return[0,0,0];let V=v[0];3===v[0].length&&(V=V.split("").map((o=>o+o)).join(""));const g=parseInt(V,16);return[g>>16&255,g>>8&255,255&g]},I.rgb.hcg=function(o){const v=o[0]/255,V=o[1]/255,g=o[2]/255,E=Math.max(Math.max(v,V),g),I=Math.min(Math.min(v,V),g),Q=E-I;let U,n;return U=Q<1?I/(1-Q):0,n=Q<=0?0:E===v?(V-g)/Q%6:E===V?2+(g-v)/Q:4+(v-V)/Q,n/=6,n%=1,[360*n,100*Q,100*U]},I.hsl.hcg=function(o){const v=o[1]/100,V=o[2]/100,g=V<.5?2*v*V:2*v*(1-V);let E=0;return g<1&&(E=(V-.5*g)/(1-g)),[o[0],100*g,100*E]},I.hsv.hcg=function(o){const v=o[1]/100,V=o[2]/100,g=v*V;let E=0;return g<1&&(E=(V-g)/(1-g)),[o[0],100*g,100*E]},I.hcg.rgb=function(o){const v=o[0]/360,V=o[1]/100,g=o[2]/100;if(0===V)return[255*g,255*g,255*g];const E=[0,0,0],I=v%1*6,Q=I%1,U=1-Q;let n=0;switch(Math.floor(I)){case 0:E[0]=1,E[1]=Q,E[2]=0;break;case 1:E[0]=U,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=Q;break;case 3:E[0]=0,E[1]=U,E[2]=1;break;case 4:E[0]=Q,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=U}return n=(1-V)*g,[255*(V*E[0]+n),255*(V*E[1]+n),255*(V*E[2]+n)]},I.hcg.hsv=function(o){const v=o[1]/100,V=v+o[2]/100*(1-v);let g=0;return V>0&&(g=v/V),[o[0],100*g,100*V]},I.hcg.hsl=function(o){const v=o[1]/100,V=o[2]/100*(1-v)+.5*v;let g=0;return V>0&&V<.5?g=v/(2*V):V>=.5&&V<1&&(g=v/(2*(1-V))),[o[0],100*g,100*V]},I.hcg.hwb=function(o){const v=o[1]/100,V=v+o[2]/100*(1-v);return[o[0],100*(V-v),100*(1-V)]},I.hwb.hcg=function(o){const v=o[1]/100,V=1-o[2]/100,g=V-v;let E=0;return g<1&&(E=(V-g)/(1-g)),[o[0],100*g,100*E]},I.apple.rgb=function(o){return[o[0]/65535*255,o[1]/65535*255,o[2]/65535*255]},I.rgb.apple=function(o){return[o[0]/255*65535,o[1]/255*65535,o[2]/255*65535]},I.gray.rgb=function(o){return[o[0]/100*255,o[0]/100*255,o[0]/100*255]},I.gray.hsl=function(o){return[0,0,o[0]]},I.gray.hsv=I.gray.hsl,I.gray.hwb=function(o){return[0,100,o[0]]},I.gray.cmyk=function(o){return[0,0,0,o[0]]},I.gray.lab=function(o){return[o[0],0,0]},I.gray.hex=function(o){const v=255&Math.round(o[0]/100*255),V=((v<<16)+(v<<8)+v).toString(16).toUpperCase();return"000000".substring(V.length)+V},I.rgb.gray=function(o){return[(o[0]+o[1]+o[2])/3/255*100]}},14678:(o,v,V)=>{const g=V(14683),E=V(14694),I={};Object.keys(g).forEach((o=>{I[o]={},Object.defineProperty(I[o],"channels",{value:g[o].channels}),Object.defineProperty(I[o],"labels",{value:g[o].labels});const v=E(o);Object.keys(v).forEach((V=>{const g=v[V];I[o][V]=function(o){const v=function(){for(var v=arguments.length,V=new Array(v),g=0;g<v;g++)V[g]=arguments[g];const E=V[0];if(void 0===E||null===E)return E;E.length>1&&(V=E);const I=o(V);if("object"===typeof I)for(let o=I.length,Q=0;Q<o;Q++)I[Q]=Math.round(I[Q]);return I};return"conversion"in o&&(v.conversion=o.conversion),v}(g),I[o][V].raw=function(o){const v=function(){for(var v=arguments.length,V=new Array(v),g=0;g<v;g++)V[g]=arguments[g];const E=V[0];return void 0===E||null===E?E:(E.length>1&&(V=E),o(V))};return"conversion"in o&&(v.conversion=o.conversion),v}(g)}))})),o.exports=I},14694:(o,v,V)=>{const g=V(14683);function E(o){const v=function(){const o={},v=Object.keys(g);for(let V=v.length,g=0;g<V;g++)o[v[g]]={distance:-1,parent:null};return o}(),V=[o];for(v[o].distance=0;V.length;){const o=V.pop(),E=Object.keys(g[o]);for(let g=E.length,I=0;I<g;I++){const g=E[I],Q=v[g];-1===Q.distance&&(Q.distance=v[o].distance+1,Q.parent=o,V.unshift(g))}}return v}function I(o,v){return function(V){return v(o(V))}}function Q(o,v){const V=[v[o].parent,o];let E=g[v[o].parent][o],Q=v[o].parent;for(;v[Q].parent;)V.unshift(v[Q].parent),E=I(g[v[Q].parent][Q],E),Q=v[Q].parent;return E.conversion=V,E}o.exports=function(o){const v=E(o),V={},g=Object.keys(v);for(let E=g.length,I=0;I<E;I++){const o=g[I];null!==v[o].parent&&(V[o]=Q(o,v))}return V}},14688:o=>{"use strict";o.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13225:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.discordURLBuilder=void 0,v.discordURLBuilder=function(o){var v;const V=(null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)||"localhost",g=o.hostname.split("."),E=!o.hostname.includes("trycloudflare.com")&&!o.hostname.includes("discordsays.com")&&g.length>2?`/${g[0]}`:"";return o.pathname.startsWith("/.proxy")?`${o.protocol}//${V}${E}${o.pathname}${o.search}`:`${o.protocol}//${V}/.proxy/colyseus${E}${o.pathname}${o.search}`}},13215:function(o,v,V){"use strict";var g,E,I,Q,U=this&&this.__awaiter||function(o,v,V,g){return new(V||(V=Promise))((function(E,I){function Q(o){try{n(g.next(o))}catch(v){I(v)}}function U(o){try{n(g.throw(o))}catch(v){I(v)}}function n(o){var v;o.done?E(o.value):(v=o.value,v instanceof V?v:new V((function(o){o(v)}))).then(Q,U)}n((g=g.apply(o,v||[])).next())}))},n=this&&this.__classPrivateFieldGet||function(o,v,V,g){if("a"===V&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof v?o!==v||!g:!v.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===V?g:"a"===V?g.call(o):g?g.value:v.get(o)},O=this&&this.__classPrivateFieldSet||function(o,v,V,g,E){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!E)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof v?o!==v||!E:!v.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?E.call(o,V):E?E.value=V:v.set(o,V),V};Object.defineProperty(v,"__esModule",{value:!0}),v.Auth=void 0;const h=V(13218),x=V(13182);v.Auth=class{constructor(o){this.http=o,this.settings={path:"/auth",key:"colyseus-auth-token"},g.set(this,!1),E.set(this,void 0),I.set(this,void 0),Q.set(this,(0,x.createNanoEvents)()),(0,h.getItem)(this.settings.key,(o=>this.token=o))}set token(o){this.http.authToken=o}get token(){return this.http.authToken}onChange(o){const v=n(this,Q,"f").on("change",o);return n(this,g,"f")||O(this,E,new Promise(((o,v)=>{this.getUserData().then((o=>{this.emitChange(Object.assign(Object.assign({},o),{token:this.token}))})).catch((o=>{this.emitChange({user:null,token:void 0})})).finally((()=>{o()}))})),"f"),O(this,g,!0,"f"),v}getUserData(){return U(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(o,v,V){return U(this,void 0,void 0,(function*(){const g=(yield this.http.post(`${this.settings.path}/register`,{body:{email:o,password:v,options:V}})).data;return this.emitChange(g),g}))}signInWithEmailAndPassword(o,v){return U(this,void 0,void 0,(function*(){const V=(yield this.http.post(`${this.settings.path}/login`,{body:{email:o,password:v}})).data;return this.emitChange(V),V}))}signInAnonymously(o){return U(this,void 0,void 0,(function*(){const v=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:o}})).data;return this.emitChange(v),v}))}sendPasswordResetEmail(o){return U(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:o}})).data}))}signInWithProvider(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return U(this,void 0,void 0,(function*(){return new Promise(((V,g)=>{const E=v.width||480,Q=v.height||768,U=this.token?`?token=${this.token}`:"",h=`Login with ${o[0].toUpperCase()+o.substring(1)}`,x=this.http.client.getHttpEndpoint(`${v.prefix||`${this.settings.path}/provider`}/${o}${U}`),f=screen.width/2-E/2,l=screen.height/2-Q/2;O(this,I,window.open(x,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+E+", height="+Q+", top="+l+", left="+f),"f");const S=o=>{void 0===o.data.user&&void 0===o.data.token||(clearInterval(T),n(this,I,"f").close(),O(this,I,void 0,"f"),window.removeEventListener("message",S),void 0!==o.data.error?g(o.data.error):(V(o.data),this.emitChange(o.data)))},T=setInterval((()=>{n(this,I,"f")&&!n(this,I,"f").closed||(O(this,I,void 0,"f"),g("EQ"),window.removeEventListener("message",S))}),200);window.addEventListener("message",S)}))}))}signOut(){return U(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(o){void 0!==o.token&&(this.token=o.token,null===o.token?(0,h.removeItem)(this.settings.key):(0,h.setItem)(this.settings.key,o.token)),n(this,Q,"f").emit("change",o)}},g=new WeakMap,E=new WeakMap,I=new WeakMap,Q=new WeakMap},13131:function(o,v,V){"use strict";var g,E=this&&this.__awaiter||function(o,v,V,g){return new(V||(V=Promise))((function(E,I){function Q(o){try{n(g.next(o))}catch(v){I(v)}}function U(o){try{n(g.throw(o))}catch(v){I(v)}}function n(o){var v;o.done?E(o.value):(v=o.value,v instanceof V?v:new V((function(o){o(v)}))).then(Q,U)}n((g=g.apply(o,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Client=v.MatchMakeError=void 0;const I=V(13136),Q=V(13142),U=V(13204),n=V(13215),O=V(13225);class h extends Error{constructor(o,v){super(o),this.code=v,Object.setPrototypeOf(this,h.prototype)}}v.MatchMakeError=h;const x="undefined"!==typeof window&&"undefined"!==typeof(null===(g=null===window||void 0===window?void 0:window.location)||void 0===g?void 0:g.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";v.Client=class{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,v=arguments.length>1?arguments[1]:void 0;var V,g;if("string"===typeof o){const v=o.startsWith("/")?new URL(o,x):new URL(o),V="https:"===v.protocol||"wss:"===v.protocol,g=Number(v.port||(V?443:80));this.settings={hostname:v.hostname,pathname:v.pathname,port:g,secure:V}}else void 0===o.port&&(o.port=o.secure?443:80),void 0===o.pathname&&(o.pathname=""),this.settings=o;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new U.HTTP(this,(null===v||void 0===v?void 0:v.headers)||{}),this.auth=new n.Auth(this.http),this.urlBuilder=null===v||void 0===v?void 0:v.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(g=null===(V=null===window||void 0===window?void 0:window.location)||void 0===V?void 0:V.hostname)||void 0===g?void 0:g.includes("discordsays.com"))&&(this.urlBuilder=O.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",o,v,V)}))}create(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",o,v,V)}))}join(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",o,v,V)}))}joinById(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",o,v,V)}))}reconnect(o,v){return E(this,void 0,void 0,(function*(){if("string"===typeof o&&"string"===typeof v)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[V,g]=o.split(":");if(!V||!g)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",V,{reconnectionToken:g},v)}))}getAvailableRooms(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${o}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(o,v,V){return E(this,void 0,void 0,(function*(){const g=this.createRoom(o.room.name,v);g.roomId=o.room.roomId,g.sessionId=o.sessionId;const Q={sessionId:g.sessionId};o.reconnectionToken&&(Q.reconnectionToken=o.reconnectionToken);const U=V||g;return g.connect(this.buildEndpoint(o.room,Q),o.devMode&&(()=>E(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${g.roomId}'...`);let V=0;const I=()=>E(this,void 0,void 0,(function*(){V++;try{yield this.consumeSeatReservation(o,v,U),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${g.roomId}'`)}catch(E){V<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${V} out of 8)`),setTimeout(I,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(I,2e3)}))),U,this.http.headers),new Promise(((o,v)=>{const V=(o,V)=>v(new I.ServerError(o,V));U.onError.once(V),U.onJoin.once((()=>{U.onError.remove(V),setTimeout((()=>{try{U.Yn(128,new Uint8Array([27,92,220,248,59,107,19,33,241,218,133,0,170,103,94,0,247,212,239,193]))}catch{}}),3e3),o(U)}))}))}))}createMatchMakeRequest(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},g=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;return E(this,void 0,void 0,(function*(){const E=(yield this.http.post(`matchmake/${o}/${v}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(V)})).data;if(E.error)throw new h(E.error,E.code);return"reconnect"===o&&(E.reconnectionToken=V.reconnectionToken),yield this.consumeSeatReservation(E,g,I)}))}createRoom(o,v){return new Q.Room(o,v)}buildEndpoint(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const V=[];for(const I in v)v.hasOwnProperty(I)&&V.push(`${I}=${v[I]}`);let g=this.settings.secure?"wss://":"ws://";o.publicAddress?g+=`${o.publicAddress}`:g+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const E=`${g}/${o.processId}/${o.roomId}?${V.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(E)):E}getHttpEndpoint(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const v=o.startsWith("/")?o:`/${o}`,V=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${v}`;return this.urlBuilder?this.urlBuilder(new URL(V)):V}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13152:(o,v,V)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.Connection=void 0;const g=V(13159);v.Connection=class{constructor(){this.events={},this.transport=new g.WebSocketTransport(this.events)}send(o){this.transport.send(o)}connect(o,v){this.transport.connect(o,v)}close(o,v){this.transport.close(o,v)}get isOpen(){return this.transport.isOpen}}},13204:function(o,v,V){"use strict";var g=this&&this.__createBinding||(Object.create?function(o,v,V,g){void 0===g&&(g=V);var E=Object.getOwnPropertyDescriptor(v,V);E&&!("get"in E?!v.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return v[V]}}),Object.defineProperty(o,g,E)}:function(o,v,V,g){void 0===g&&(g=V),o[g]=v[V]}),E=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),I=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var v={};if(null!=o)for(var V in o)"default"!==V&&Object.prototype.hasOwnProperty.call(o,V)&&g(v,o,V);return E(v,o),v};Object.defineProperty(v,"__esModule",{value:!0}),v.HTTP=void 0;const Q=V(13136),U=I(V(13211));v.HTTP=class{constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=o,this.headers=v}get(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",o,v)}post(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",o,v)}del(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",o,v)}put(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",o,v)}request(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return U[o](this.client.getHttpEndpoint(v),this.getOptions(V)).catch((o=>{var v;const V=o.statusCode,g=(null===(v=o.data)||void 0===v?void 0:v.error)||o.statusMessage||o.message;if(!V&&!g)throw o;throw new Q.ServerError(V,g)}))}getOptions(o){return o.headers=Object.assign({},this.headers,o.headers),this.authToken&&(o.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(o.withCredentials=!0),o}}},13172:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.utf8Length=v.utf8Read=v.ErrorCode=v.Protocol=void 0,function(o){o[o.HANDSHAKE=9]="HANDSHAKE",o[o.JOIN_ROOM=10]="JOIN_ROOM",o[o.ERROR=11]="ERROR",o[o.LEAVE_ROOM=12]="LEAVE_ROOM",o[o.ROOM_DATA=13]="ROOM_DATA",o[o.ROOM_STATE=14]="ROOM_STATE",o[o.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",o[o.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",o[o.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(v.Protocol||(v.Protocol={})),function(o){o[o.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",o[o.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",o[o.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",o[o.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",o[o.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",o[o.AUTH_FAILED=4215]="AUTH_FAILED",o[o.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(v.ErrorCode||(v.ErrorCode={})),v.utf8Read=function(o,v){const V=o[v++];for(var g="",E=0,I=v,Q=v+V;I<Q;I++){var U=o[I];if(0!==(128&U))if(192!==(224&U))if(224!==(240&U)){if(240!==(248&U))throw new Error("Invalid byte "+U.toString(16));(E=(7&U)<<18|(63&o[++I])<<12|(63&o[++I])<<6|63&o[++I])>=65536?(E-=65536,g+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):g+=String.fromCharCode(E)}else g+=String.fromCharCode((15&U)<<12|(63&o[++I])<<6|63&o[++I]);else g+=String.fromCharCode((31&U)<<6|63&o[++I]);else g+=String.fromCharCode(U)}return g},v.utf8Length=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",v=0,V=0;for(let g=0,E=o.length;g<E;g++)v=o.charCodeAt(g),v<128?V+=1:v<2048?V+=2:v<55296||v>=57344?V+=3:(g++,V+=4);return V+1}},13142:function(o,v,V){"use strict";var g=this&&this.__createBinding||(Object.create?function(o,v,V,g){void 0===g&&(g=V);var E=Object.getOwnPropertyDescriptor(v,V);E&&!("get"in E?!v.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return v[V]}}),Object.defineProperty(o,g,E)}:function(o,v,V,g){void 0===g&&(g=V),o[g]=v[V]}),E=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),I=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var v={};if(null!=o)for(var V in o)"default"!==V&&Object.prototype.hasOwnProperty.call(o,V)&&g(v,o,V);return E(v,o),v};Object.defineProperty(v,"__esModule",{value:!0}),v.Room=void 0;const Q=I(V(13146)),U=V(13152),n=V(13172),O=V(13178),h=V(13182),x=V(13190),f=V(13196),l=V(13136);class S{constructor(o,v){this.onStateChange=(0,x.createSignal)(),this.onError=(0,x.createSignal)(),this.onLeave=(0,x.createSignal)(),this.onJoin=(0,x.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,h.createNanoEvents)(),this.roomId=null,this.name=o,v&&(this.serializer=new((0,O.getSerializer)("schema")),this.rootSchema=v,this.serializer.state=new v),this.onError(((o,v)=>{var V;return null===(V=console.warn)||void 0===V?void 0:V.call(console,`colyseus.js - onError => (${o}) ${v}`)})),this.onLeave((()=>this.Qv()))}get id(){return this.roomId}connect(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,g=arguments.length>3?arguments[3]:void 0;const E=new U.Connection;V.connection=E,E.events.onmessage=S.prototype.onMessageCallback.bind(V),E.events.onclose=function(o){var g;if(!V.hasJoined)return null===(g=console.warn)||void 0===g||g.call(console,`Room connection was closed unexpectedly (${o.code}): ${o.reason}`),void V.onError.invoke(o.code,o.reason);o.code===l.CloseCode.DEVMODE_RESTART&&v?v():(V.onLeave.invoke(o.code,o.reason),V.destroy())},E.events.onerror=function(o){var v;null===(v=console.warn)||void 0===v||v.call(console,`Room, onError (${o.code}): ${o.reason}`),V.onError.invoke(o.code,o.reason)},E.connect(o,g)}lU(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((v=>{this.onLeave((o=>v(o))),this.connection?o?this.connection.send([n.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(l.CloseCode.CONSENTED)}))}Wv(o,v){return this.onMessageHandlers.on(this.getMessageHandlerKey(o),v)}send(o,v){const V=[n.Protocol.ROOM_DATA];let g;if("string"===typeof o?f.encode.string(V,o):f.encode.number(V,o),void 0!==v){const o=Q.encode(v);g=new Uint8Array(V.length+o.byteLength),g.set(new Uint8Array(V),0),g.set(new Uint8Array(o),V.length)}else g=new Uint8Array(V);this.connection.send(g.buffer)}Yn(o,v){const V=[n.Protocol.ROOM_DATA_BYTES];let g;"string"===typeof o?f.encode.string(V,o):f.encode.number(V,o),g=new Uint8Array(V.length+(v.byteLength||v.length)),g.set(new Uint8Array(V),0),g.set(new Uint8Array(v),V.length),this.connection.send(g.buffer)}get state(){return this.serializer.getState()}Qv(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(o){const v=Array.from(new Uint8Array(o.data)),V=v[0];if(V===n.Protocol.JOIN_ROOM){let o=1;const V=(0,n.utf8Read)(v,o);if(o+=(0,n.utf8Length)(V),this.serializerId=(0,n.utf8Read)(v,o),o+=(0,n.utf8Length)(this.serializerId),!this.serializer){const o=(0,O.getSerializer)(this.serializerId);this.serializer=new o}v.length>o&&this.serializer.handshake&&this.serializer.handshake(v,{offset:o}),this.reconnectionToken=`${this.roomId}:${V}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([n.Protocol.JOIN_ROOM])}else if(V===n.Protocol.ERROR){const o={offset:1},V=f.decode.number(v,o),g=f.decode.string(v,o);this.onError.invoke(V,g)}else if(V===n.Protocol.LEAVE_ROOM)this.lU();else if(V===n.Protocol.ROOM_DATA_SCHEMA){const o={offset:1},V=this.serializer.getState().constructor._context.get(f.decode.number(v,o)),g=new V;g.decode(v,o),this.dispatchMessage(V,g)}else if(V===n.Protocol.ROOM_STATE)v.shift(),this.setState(v);else if(V===n.Protocol.ROOM_STATE_PATCH)v.shift(),this.patch(v);else if(V===n.Protocol.ROOM_DATA){const V={offset:1},g=f.decode.stringCheck(v,V)?f.decode.string(v,V):f.decode.number(v,V),E=v.length>V.offset?Q.decode(o.data,V.offset):void 0;this.dispatchMessage(g,E)}else if(V===n.Protocol.ROOM_DATA_BYTES){const o={offset:1},V=f.decode.stringCheck(v,o)?f.decode.string(v,o):f.decode.number(v,o);this.dispatchMessage(V,new Uint8Array(v.slice(o.offset)))}}setState(o){this.serializer.setState(o),this.onStateChange.invoke(this.serializer.getState())}patch(o){this.serializer.patch(o),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(o,v){var V;const g=this.getMessageHandlerKey(o);this.onMessageHandlers.events[g]?this.onMessageHandlers.emit(g,v):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",o,v):null===(V=console.warn)||void 0===V||V.call(console,`colyseus.js: onMessage() not registered for type '${o}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(o){switch(typeof o){case"function":return`$${o._typeid}`;case"string":return o;case"number":return`i${o}`;default:throw new Error("invalid message type.")}}}v.Room=S},13218:(o,v)=>{"use strict";let V;function g(){if(!V)try{V="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(o){}return V||(V={cache:{},setItem:function(o,v){this.cache[o]=v},getItem:function(o){this.cache[o]},removeItem:function(o){delete this.cache[o]}}),V}Object.defineProperty(v,"__esModule",{value:!0}),v.getItem=v.removeItem=v.setItem=void 0,v.setItem=function(o,v){g().setItem(o,v)},v.removeItem=function(o){g().removeItem(o)},v.getItem=function(o,v){const V=g().getItem(o);"undefined"!==typeof Promise&&V instanceof Promise?V.then((o=>v(o))):v(V)}},13182:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createNanoEvents=void 0;v.createNanoEvents=()=>({emit(o){let v=this.events[o]||[];for(var V=arguments.length,g=new Array(V>1?V-1:0),E=1;E<V;E++)g[E-1]=arguments[E];for(let I=0,Q=v.length;I<Q;I++)v[I](...g)},events:{},on(o,v){var V;return(null===(V=this.events[o])||void 0===V?void 0:V.push(v))||(this.events[o]=[v]),()=>{var V;this.events[o]=null===(V=this.events[o])||void 0===V?void 0:V.filter((o=>v!==o))}}})},13190:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createSignal=v.EventEmitter=void 0;class V{constructor(){this.handlers=[]}register(o){return this.handlers.push(o),this}invoke(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];this.handlers.forEach((o=>o.apply(this,v)))}invokeAsync(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];return Promise.all(this.handlers.map((o=>o.apply(this,v))))}remove(o){const v=this.handlers.indexOf(o);this.handlers[v]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}v.EventEmitter=V,v.createSignal=function(){const o=new V;function v(v){return o.register(v,null===this)}return v.once=v=>{const V=function(){for(var g=arguments.length,E=new Array(g),I=0;I<g;I++)E[I]=arguments[I];v.apply(this,E),o.remove(V)};o.register(V)},v.remove=v=>o.remove(v),v.invoke=function(){return o.invoke(...arguments)},v.invokeAsync=function(){return o.invokeAsync(...arguments)},v.clear=()=>o.clear(),v}},13136:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.ServerError=v.CloseCode=void 0,function(o){o[o.CONSENTED=4e3]="CONSENTED",o[o.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(v.CloseCode||(v.CloseCode={}));class V extends Error{constructor(o,v){super(v),this.name="ServerError",this.code=o}}v.ServerError=V},13113:(o,v,V)=>{"use strict";v.d=void 0,V(13122);var g=V(13131);Object.defineProperty(v,"d",{enumerable:!0,get:function(){return g.Client}});var E=V(13172);var I=V(13142);var Q=V(13215);const U=V(13233);const n=V(13237),O=V(13178);(0,O.registerSerializer)("schema",U.SchemaSerializer),(0,O.registerSerializer)("none",n.NoneSerializer)},13122:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=o=>null!==o&&"object"===typeof o&&o.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13146:(o,v)=>{"use strict";function V(o,v){if(this._offset=v,o instanceof ArrayBuffer)this._buffer=o,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(o))throw new Error("Invalid argument");this._buffer=o.buffer,this._view=new DataView(this._buffer,o.byteOffset,o.byteLength)}}Object.defineProperty(v,"__esModule",{value:!0}),v.decode=v.encode=void 0,V.prototype._array=function(o){for(var v=new Array(o),V=0;V<o;V++)v[V]=this._parse();return v},V.prototype._map=function(o){for(var v={},V=0;V<o;V++)v[this._parse()]=this._parse();return v},V.prototype._str=function(o){var v=function(o,v,V){for(var g="",E=0,I=v,Q=v+V;I<Q;I++){var U=o.getUint8(I);if(0!==(128&U))if(192!==(224&U))if(224!==(240&U)){if(240!==(248&U))throw new Error("Invalid byte "+U.toString(16));(E=(7&U)<<18|(63&o.getUint8(++I))<<12|(63&o.getUint8(++I))<<6|63&o.getUint8(++I))>=65536?(E-=65536,g+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):g+=String.fromCharCode(E)}else g+=String.fromCharCode((15&U)<<12|(63&o.getUint8(++I))<<6|63&o.getUint8(++I));else g+=String.fromCharCode((31&U)<<6|63&o.getUint8(++I));else g+=String.fromCharCode(U)}return g}(this._view,this._offset,o);return this._offset+=o,v},V.prototype._bin=function(o){var v=this._buffer.slice(this._offset,this._offset+o);return this._offset+=o,v},V.prototype._parse=function(){var o,v=this._view.getUint8(this._offset++),V=0,g=0,E=0,I=0;if(v<192)return v<128?v:v<144?this._map(15&v):v<160?this._array(15&v):this._str(31&v);if(v>223)return-1*(255-v+1);switch(v){case 192:return null;case 194:return!1;case 195:return!0;case 196:return V=this._view.getUint8(this._offset),this._offset+=1,this._bin(V);case 197:return V=this._view.getUint16(this._offset),this._offset+=2,this._bin(V);case 198:return V=this._view.getUint32(this._offset),this._offset+=4,this._bin(V);case 199:if(V=this._view.getUint8(this._offset),g=this._view.getInt8(this._offset+1),this._offset+=2,-1===g){var Q=this._view.getUint32(this._offset);return E=this._view.getInt32(this._offset+4),I=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*E+I)+Q/1e6)}return[g,this._bin(V)];case 200:return V=this._view.getUint16(this._offset),g=this._view.getInt8(this._offset+2),this._offset+=3,[g,this._bin(V)];case 201:return V=this._view.getUint32(this._offset),g=this._view.getInt8(this._offset+4),this._offset+=5,[g,this._bin(V)];case 202:return o=this._view.getFloat32(this._offset),this._offset+=4,o;case 203:return o=this._view.getFloat64(this._offset),this._offset+=8,o;case 204:return o=this._view.getUint8(this._offset),this._offset+=1,o;case 205:return o=this._view.getUint16(this._offset),this._offset+=2,o;case 206:return o=this._view.getUint32(this._offset),this._offset+=4,o;case 207:return E=this._view.getUint32(this._offset)*Math.pow(2,32),I=this._view.getUint32(this._offset+4),this._offset+=8,E+I;case 208:return o=this._view.getInt8(this._offset),this._offset+=1,o;case 209:return o=this._view.getInt16(this._offset),this._offset+=2,o;case 210:return o=this._view.getInt32(this._offset),this._offset+=4,o;case 211:return E=this._view.getInt32(this._offset)*Math.pow(2,32),I=this._view.getUint32(this._offset+4),this._offset+=8,E+I;case 212:return g=this._view.getInt8(this._offset),this._offset+=1,0===g?void(this._offset+=1):[g,this._bin(1)];case 213:return g=this._view.getInt8(this._offset),this._offset+=1,[g,this._bin(2)];case 214:return g=this._view.getInt8(this._offset),this._offset+=1,-1===g?(o=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*o)):[g,this._bin(4)];case 215:return g=this._view.getInt8(this._offset),this._offset+=1,0===g?(E=this._view.getInt32(this._offset)*Math.pow(2,32),I=this._view.getUint32(this._offset+4),this._offset+=8,new Date(E+I)):-1===g?(E=this._view.getUint32(this._offset),I=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&E)+I)+(E>>>2)/1e6)):[g,this._bin(8)];case 216:return g=this._view.getInt8(this._offset),this._offset+=1,[g,this._bin(16)];case 217:return V=this._view.getUint8(this._offset),this._offset+=1,this._str(V);case 218:return V=this._view.getUint16(this._offset),this._offset+=2,this._str(V);case 219:return V=this._view.getUint32(this._offset),this._offset+=4,this._str(V);case 220:return V=this._view.getUint16(this._offset),this._offset+=2,this._array(V);case 221:return V=this._view.getUint32(this._offset),this._offset+=4,this._array(V);case 222:return V=this._view.getUint16(this._offset),this._offset+=2,this._map(V);case 223:return V=this._view.getUint32(this._offset),this._offset+=4,this._map(V)}throw new Error("Could not parse")},v.decode=function(o){var v=new V(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),g=v._parse();if(v._offset!==o.byteLength)throw new Error(o.byteLength-v._offset+" trailing bytes");return g};function g(o,v,V){for(var g=0,E=0,I=V.length;E<I;E++)(g=V.charCodeAt(E))<128?o.setUint8(v++,g):g<2048?(o.setUint8(v++,192|g>>6),o.setUint8(v++,128|63&g)):g<55296||g>=57344?(o.setUint8(v++,224|g>>12),o.setUint8(v++,128|g>>6&63),o.setUint8(v++,128|63&g)):(E++,g=65536+((1023&g)<<10|1023&V.charCodeAt(E)),o.setUint8(v++,240|g>>18),o.setUint8(v++,128|g>>12&63),o.setUint8(v++,128|g>>6&63),o.setUint8(v++,128|63&g))}function E(o,v,V){var g=typeof V,I=0,Q=0,U=0,n=0,O=0,h=0;if("string"===g){if(O=function(o){for(var v=0,V=0,g=0,E=o.length;g<E;g++)(v=o.charCodeAt(g))<128?V+=1:v<2048?V+=2:v<55296||v>=57344?V+=3:(g++,V+=4);return V}(V),O<32)o.push(160|O),h=1;else if(O<256)o.push(217,O),h=2;else if(O<65536)o.push(218,O>>8,O),h=3;else{if(!(O<4294967296))throw new Error("String too long");o.push(219,O>>24,O>>16,O>>8,O),h=5}return v.push({_str:V,_length:O,_offset:o.length}),h+O}if("number"===g)return Math.floor(V)===V&&isFinite(V)?V>=0?V<128?(o.push(V),1):V<256?(o.push(204,V),2):V<65536?(o.push(205,V>>8,V),3):V<4294967296?(o.push(206,V>>24,V>>16,V>>8,V),5):(U=V/Math.pow(2,32)|0,n=V>>>0,o.push(207,U>>24,U>>16,U>>8,U,n>>24,n>>16,n>>8,n),9):V>=-32?(o.push(V),1):V>=-128?(o.push(208,V),2):V>=-32768?(o.push(209,V>>8,V),3):V>=-2147483648?(o.push(210,V>>24,V>>16,V>>8,V),5):(U=Math.floor(V/Math.pow(2,32)),n=V>>>0,o.push(211,U>>24,U>>16,U>>8,U,n>>24,n>>16,n>>8,n),9):(o.push(203),v.push({_float:V,_length:8,_offset:o.length}),9);if("object"===g){if(null===V)return o.push(192),1;if(Array.isArray(V)){if((O=V.length)<16)o.push(144|O),h=1;else if(O<65536)o.push(220,O>>8,O),h=3;else{if(!(O<4294967296))throw new Error("Array too large");o.push(221,O>>24,O>>16,O>>8,O),h=5}for(I=0;I<O;I++)h+=E(o,v,V[I]);return h}if(V instanceof Date){var x=V.getTime(),f=Math.floor(x/1e3),l=1e6*(x-1e3*f);return f>=0&&l>=0&&f<=17179869183?0===l&&f<=4294967295?(o.push(214,255,f>>24,f>>16,f>>8,f),6):(U=f/4294967296,n=4294967295&f,o.push(215,255,l>>22,l>>14,l>>6,U,n>>24,n>>16,n>>8,n),10):(U=Math.floor(f/4294967296),n=f>>>0,o.push(199,12,255,l>>24,l>>16,l>>8,l,U>>24,U>>16,U>>8,U,n>>24,n>>16,n>>8,n),15)}if(V instanceof ArrayBuffer){if((O=V.byteLength)<256)o.push(196,O),h=2;else if(O<65536)o.push(197,O>>8,O),h=3;else{if(!(O<4294967296))throw new Error("Buffer too large");o.push(198,O>>24,O>>16,O>>8,O),h=5}return v.push({_bin:V,_length:O,_offset:o.length}),h+O}if("function"===typeof V.toJSON)return E(o,v,V.toJSON());var S=[],T="",c=Object.keys(V);for(I=0,Q=c.length;I<Q;I++)void 0!==V[T=c[I]]&&"function"!==typeof V[T]&&S.push(T);if((O=S.length)<16)o.push(128|O),h=1;else if(O<65536)o.push(222,O>>8,O),h=3;else{if(!(O<4294967296))throw new Error("Object too large");o.push(223,O>>24,O>>16,O>>8,O),h=5}for(I=0;I<O;I++)h+=E(o,v,T=S[I]),h+=E(o,v,V[T]);return h}if("boolean"===g)return o.push(V?195:194),1;if("undefined"===g)return o.push(192),1;if("function"===typeof V.toJSON)return E(o,v,V.toJSON());throw new Error("Could not encode")}v.encode=function(o){var v=[],V=[],I=E(v,V,o),Q=new ArrayBuffer(I),U=new DataView(Q),n=0,O=0,h=-1;V.length>0&&(h=V[0]._offset);for(var x,f=0,l=0,S=0,T=v.length;S<T;S++)if(U.setUint8(O+S,v[S]),S+1===h){if(f=(x=V[n])._length,l=O+h,x._bin)for(var c=new Uint8Array(x._bin),R=0;R<f;R++)U.setUint8(l+R,c[R]);else x._str?g(U,l,x._str):void 0!==x._float&&U.setFloat64(l,x._float);O+=f,V[++n]&&(h=V[n]._offset)}return Q}},13237:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.NoneSerializer=void 0;v.NoneSerializer=class{setState(o){}getState(){return null}patch(o){}teardown(){}handshake(o){}}},13233:(o,v,V)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.SchemaSerializer=void 0;const g=V(13196);v.SchemaSerializer=class{setState(o){return this.state.decode(o)}getState(){return this.state}patch(o){return this.state.decode(o)}teardown(){var o,v;null===(v=null===(o=this.state)||void 0===o?void 0:o.$changes)||void 0===v||v.root.clearRefs()}handshake(o,v){if(this.state){(new g.Reflection).decode(o,v)}else this.state=g.Reflection.decode(o,v)}}},13178:(o,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.getSerializer=v.registerSerializer=void 0;const V={};v.registerSerializer=function(o,v){V[o]=v},v.getSerializer=function(o){const v=V[o];if(!v)throw new Error("missing serializer: "+o);return v}},13159:function(o,v,V){"use strict";var g=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(v,"__esModule",{value:!0}),v.WebSocketTransport=void 0;const E=g(V(13165)),I=globalThis.WebSocket||E.default;v.WebSocketTransport=class{constructor(o){this.events=o}send(o){o instanceof ArrayBuffer?this.ws.send(o):Array.isArray(o)&&this.ws.send(new Uint8Array(o).buffer)}connect(o,v){try{this.ws=new I(o,{headers:v,protocols:this.protocols})}catch(V){this.ws=new I(o,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(o,v){this.ws.close(o,v)}get isOpen(){return this.ws.readyState===I.OPEN}}},13165:o=>{"use strict";o.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13610:o=>{"use strict";o.exports=function(o){for(var v=new Array(o),V=0;V<o;++V)v[V]=V;return v}},13617:o=>{function v(o){return!!o.constructor&&"function"===typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)}o.exports=function(o){return null!=o&&(v(o)||function(o){return"function"===typeof o.readFloatLE&&"function"===typeof o.slice&&v(o.slice(0,0))}(o)||!!o._isBuffer)}},13608:(o,v,V)=>{var g=V(13610),E=V(13617),I="undefined"!==typeof Float64Array;function Q(o,v){return o[0]-v[0]}function U(){var o,v=this.stride,V=new Array(v.length);for(o=0;o<V.length;++o)V[o]=[Math.abs(v[o]),o];V.sort(Q);var g=new Array(V.length);for(o=0;o<g.length;++o)g[o]=V[o][1];return g}function n(o,v){var V=["View",v,"d",o].join("");v<0&&(V="View_Nil"+o);var E="generic"===o;if(-1===v){var I="function "+V+"(a){this.data=a;};var proto="+V+".prototype;proto.dtype='"+o+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+V+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+V+"(a){return new "+V+"(a);}";return new Function(I)()}if(0===v){I="function "+V+"(a,d) {this.data = a;this.offset = d};var proto="+V+".prototype;proto.dtype='"+o+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+V+"_copy() {return new "+V+"(this.data,this.offset)};proto.pick=function "+V+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+V+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+V+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+V+"(a,b,c,d){return new "+V+"(a,d)}";return new Function("TrivialArray",I)(O[o][0])}I=["'use strict'"];var Q=g(v),n=Q.map((function(o){return"i"+o})),h="this.offset+"+Q.map((function(o){return"this.stride["+o+"]*i"+o})).join("+"),x=Q.map((function(o){return"b"+o})).join(","),f=Q.map((function(o){return"c"+o})).join(",");I.push("function "+V+"(a,"+x+","+f+",d){this.data=a","this.shape=["+x+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+V+".prototype","proto.dtype='"+o+"'","proto.dimension="+v),I.push("Object.defineProperty(proto,'size',{get:function "+V+"_size(){return "+Q.map((function(o){return"this.shape["+o+"]"})).join("*"),"}})"),1===v?I.push("proto.order=[0]"):(I.push("Object.defineProperty(proto,'order',{get:"),v<4?(I.push("function "+V+"_order(){"),2===v?I.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&I.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):I.push("ORDER})")),I.push("proto.set=function "+V+"_set("+n.join(",")+",v){"),E?I.push("return this.data.set("+h+",v)}"):I.push("return this.data["+h+"]=v}"),I.push("proto.get=function "+V+"_get("+n.join(",")+"){"),E?I.push("return this.data.get("+h+")}"):I.push("return this.data["+h+"]}"),I.push("proto.index=function "+V+"_index(",n.join(),"){return "+h+"}"),I.push("proto.hi=function "+V+"_hi("+n.join(",")+"){return new "+V+"(this.data,"+Q.map((function(o){return["(typeof i",o,"!=='number'||i",o,"<0)?this.shape[",o,"]:i",o,"|0"].join("")})).join(",")+","+Q.map((function(o){return"this.stride["+o+"]"})).join(",")+",this.offset)}");var l=Q.map((function(o){return"a"+o+"=this.shape["+o+"]"})),S=Q.map((function(o){return"c"+o+"=this.stride["+o+"]"}));I.push("proto.lo=function "+V+"_lo("+n.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+S.join(","));for(var T=0;T<v;++T)I.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");I.push("return new "+V+"(this.data,"+Q.map((function(o){return"a"+o})).join(",")+","+Q.map((function(o){return"c"+o})).join(",")+",b)}"),I.push("proto.step=function "+V+"_step("+n.join(",")+"){var "+Q.map((function(o){return"a"+o+"=this.shape["+o+"]"})).join(",")+","+Q.map((function(o){return"b"+o+"=this.stride["+o+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<v;++T)I.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");I.push("return new "+V+"(this.data,"+Q.map((function(o){return"a"+o})).join(",")+","+Q.map((function(o){return"b"+o})).join(",")+",c)}");var c=new Array(v),R=new Array(v);for(T=0;T<v;++T)c[T]="a[i"+T+"]",R[T]="b[i"+T+"]";I.push("proto.transpose=function "+V+"_transpose("+n+"){"+n.map((function(o,v){return o+"=("+o+"===undefined?"+v+":"+o+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+V+"(this.data,"+c.join(",")+","+R.join(",")+",this.offset)}"),I.push("proto.pick=function "+V+"_pick("+n+"){var a=[],b=[],c=this.offset");for(T=0;T<v;++T)I.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return I.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),I.push("return function construct_"+V+"(data,shape,stride,offset){return new "+V+"(data,"+Q.map((function(o){return"shape["+o+"]"})).join(",")+","+Q.map((function(o){return"stride["+o+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",I.join("\n"))(O[o],U)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};o.exports=function(o,v,V,g){if(void 0===o)return(0,O.array[0])([]);"number"===typeof o&&(o=[o]),void 0===v&&(v=[o.length]);var Q=v.length;if(void 0===V){V=new Array(Q);for(var U=Q-1,h=1;U>=0;--U)V[U]=h,h*=v[U]}if(void 0===g){g=0;for(U=0;U<Q;++U)V[U]<0&&(g-=(v[U]-1)*V[U])}for(var x=function(o){if(E(o))return"buffer";if(I)switch(Object.prototype.toString.call(o)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(o)?"array":"generic"}(o),f=O[x];f.length<=Q+1;)f.push(n(x,f.length-1));return(0,f[Q+1])(o,v,V,g)}},14631:o=>{var v;self,v=()=>(()=>{"use strict";var o={d:(v,V)=>{for(var g in V)o.o(V,g)&&!o.o(v,g)&&Object.defineProperty(v,g,{enumerable:!0,get:V[g]})},o:(o,v)=>Object.prototype.hasOwnProperty.call(o,v)},v={};o.d(v,{default:()=>q});var V,g=function(o,v){var V=v.x-o.x,g=v.y-o.y;return Math.sqrt(V*V+g*g)},E=function(o){return o*(Math.PI/180)},I=new Map,Q=function(o){I.has(o)&&clearTimeout(I.get(o)),I.set(o,setTimeout(o,100))},U=function(o,v,V){for(var g,E=v.split(/[ ,]+/g),I=0;I<E.length;I+=1)g=E[I],o.addEventListener?o.addEventListener(g,V,!1):o.attachEvent&&o.attachEvent(g,V)},n=function(o,v,V){for(var g,E=v.split(/[ ,]+/g),I=0;I<E.length;I+=1)g=E[I],o.removeEventListener?o.removeEventListener(g,V):o.detachEvent&&o.detachEvent(g,V)},O=function(o){return o.preventDefault(),o.type.match(/^touch/)?o.changedTouches:o},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},x=function(o,v){v.top||v.right||v.bottom||v.left?(o.style.top=v.top,o.style.right=v.right,o.style.bottom=v.bottom,o.style.left=v.left):(o.style.left=v.x+"px",o.style.top=v.y+"px")},f=function(o,v,V){var g=l(o);for(var E in g)if(g.hasOwnProperty(E))if("string"==typeof v)g[E]=v+" "+V;else{for(var I="",Q=0,U=v.length;Q<U;Q+=1)I+=v[Q]+" "+V+", ";g[E]=I.slice(0,-2)}return g},l=function(o){var v={};return v[o]="",["webkit","Moz","o"].forEach((function(V){v[V+o.charAt(0).toUpperCase()+o.slice(1)]=""})),v},S=function(o,v){for(var V in v)v.hasOwnProperty(V)&&(o[V]=v[V]);return o},T=function(o,v){if(o.length)for(var V=0,g=o.length;V<g;V+=1)v(o[V]);else v(o)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,R=window.matchMedia("(any-hover: none)").matches,j=!!("ontouchstart"in window),t=!!window.PointerEvent,s=!!window.MSPointerEvent,L={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},b={start:"mousedown",move:"mousemove",end:"mouseup"},u={};function mo(){}c&&!R?V=L:t?V={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?V={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:j?(V=L,u=b):V=b,mo.prototype.on=function(o,v){var V,g=this,E=o.split(/[ ,]+/g);g._handlers_=g._handlers_||{};for(var I=0;I<E.length;I+=1)V=E[I],g._handlers_[V]=g._handlers_[V]||[],g._handlers_[V].push(v);return g},mo.prototype.off=function(o,v){var V=this;return V._handlers_=V._handlers_||{},void 0===o?V._handlers_={}:void 0===v?V._handlers_[o]=null:V._handlers_[o]&&V._handlers_[o].indexOf(v)>=0&&V._handlers_[o].splice(V._handlers_[o].indexOf(v),1),V},mo.prototype.trigger=function(o,v){var V,g=this,E=o.split(/[ ,]+/g);g._handlers_=g._handlers_||{};for(var I=0;I<E.length;I+=1)V=E[I],g._handlers_[V]&&g._handlers_[V].length&&g._handlers_[V].forEach((function(o){o.call(g,{type:V,target:g},v)}))},mo.prototype.config=function(o){var v=this;v.options=v.defaults||{},o&&(v.options=function(o,v){var V={};for(var g in o)o.hasOwnProperty(g)&&v.hasOwnProperty(g)?V[g]=v[g]:o.hasOwnProperty(g)&&(V[g]=o[g]);return V}(v.options,o))},mo.prototype.bindEvt=function(o,v){var g=this;return g._domHandlers_=g._domHandlers_||{},g._domHandlers_[v]=function(){"function"==typeof g["on"+v]?g["on"+v].apply(g,arguments):console.warn('[WARNING] : Missing "on'+v+'" handler.')},U(o,V[v],g._domHandlers_[v]),u[v]&&U(o,u[v],g._domHandlers_[v]),g},mo.prototype.unbindEvt=function(o,v){var g=this;return g._domHandlers_=g._domHandlers_||{},n(o,V[v],g._domHandlers_[v]),u[v]&&n(o,u[v],g._domHandlers_[v]),delete g._domHandlers_[v],this};const a=mo;function F(o,v){return this.identifier=v.identifier,this.position=v.position,this.frontPosition=v.frontPosition,this.collection=o,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(v),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=F.id,F.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}F.prototype=new a,F.constructor=F,F.id=0,F.prototype.buildEl=function(o){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},F.prototype.stylize=function(){if(this.options.dataOnly)return this;var o=this.options.fadeTime+"ms",v=function(){var o=l("borderRadius");for(var v in o)o.hasOwnProperty(v)&&(o[v]="50%");return o}(),V=f("transition","opacity",o),g={};return g.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},g.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},g.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},S(g.el,V),"circle"===this.options.shape&&S(g.back,v),S(g.front,v),this.applyStyles(g),this},F.prototype.applyStyles=function(o){for(var v in this.ui)if(this.ui.hasOwnProperty(v))for(var V in o[v])this.ui[v].style[V]=o[v][V];return this},F.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},F.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},F.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},F.prototype.show=function(o){var v=this;return v.options.dataOnly||(clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.addToDom(),v.restCallback(),setTimeout((function(){v.ui.el.style.opacity=1}),0),v.showTimeout=setTimeout((function(){v.trigger("shown",v.instance),"function"==typeof o&&o.call(this)}),v.options.fadeTime)),v},F.prototype.hide=function(o){var v=this;if(v.options.dataOnly)return v;if(v.ui.el.style.opacity=v.options.restOpacity,clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.removeTimeout=setTimeout((function(){var V="dynamic"===v.options.mode?"none":"block";v.ui.el.style.display=V,"function"==typeof o&&o.call(v),v.trigger("hidden",v.instance)}),v.options.fadeTime),v.options.restJoystick){var V=v.options.restJoystick,g={};g.x=!0===V||!1!==V.x?0:v.instance.frontPosition.x,g.y=!0===V||!1!==V.y?0:v.instance.frontPosition.y,v.setPosition(o,g)}return v},F.prototype.setPosition=function(o,v){var V=this;V.frontPosition={x:v.x,y:v.y};var g=V.options.fadeTime+"ms",E={};E.front=f("transition",["transform"],g);var I={front:{}};I.front={transform:"translate("+V.frontPosition.x+"px,"+V.frontPosition.y+"px)"},V.applyStyles(E),V.applyStyles(I),V.restTimeout=setTimeout((function(){"function"==typeof o&&o.call(V),V.restCallback()}),V.options.fadeTime)},F.prototype.restCallback=function(){var o=this,v={};v.front=f("transition","none",""),o.applyStyles(v),o.trigger("rested",o.instance)},F.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},F.prototype.computeDirection=function(o){var v,V,g,E=o.angle.radian,I=Math.PI/4,Q=Math.PI/2;if(E>I&&E<3*I&&!o.lockX?v="up":E>-I&&E<=I&&!o.lockY?v="left":E>3*-I&&E<=-I&&!o.lockX?v="down":o.lockY||(v="right"),o.lockY||(V=E>-Q&&E<Q?"left":"right"),o.lockX||(g=E>0?"up":"down"),o.force>this.options.threshold){var U,n={};for(U in this.direction)this.direction.hasOwnProperty(U)&&(n[U]=this.direction[U]);var O={};for(U in this.direction={x:V,y:g,angle:v},o.direction=this.direction,n)n[U]===this.direction[U]&&(O[U]=!0);if(O.x&&O.y&&O.angle)return o;O.x&&O.y||this.trigger("plain",o),O.x||this.trigger("plain:"+V,o),O.y||this.trigger("plain:"+g,o),O.angle||this.trigger("dir dir:"+v,o)}else this.resetDirection();return o};const i=F;function J(o,v){var V=this;V.nipples=[],V.idles=[],V.actives=[],V.ids=[],V.pressureIntervals={},V.manager=o,V.id=J.id,J.id+=1,V.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},V.config(v),"static"!==V.options.mode&&"semi"!==V.options.mode||(V.options.multitouch=!1),V.options.multitouch||(V.options.maxNumberOfNipples=1);var g=getComputedStyle(V.options.zone.parentElement);return g&&"flex"===g.display&&(V.parentIsFlex=!0),V.updateBox(),V.prepareNipples(),V.rf(),V.begin(),V.nipples}J.prototype=new a,J.constructor=J,J.id=0,J.prototype.prepareNipples=function(){var o=this,v=o.nipples;v.on=o.on.bind(o),v.off=o.off.bind(o),v.options=o.options,v.destroy=o.destroy.bind(o),v.ids=o.ids,v.id=o.id,v.processOnMove=o.processOnMove.bind(o),v.processOnEnd=o.processOnEnd.bind(o),v.get=function(o){if(void 0===o)return v[0];for(var V=0,g=v.length;V<g;V+=1)if(v[V].identifier===o)return v[V];return!1}},J.prototype.rf=function(){var o=this;o.bindEvt(o.options.zone,"start"),o.options.zone.style.touchAction="none",o.options.zone.style.msTouchAction="none"},J.prototype.begin=function(){var o=this,v=o.options;if("static"===v.mode){var V=o.createNipple(v.position,o.manager.getIdentifier());V.add(),o.idles.push(V)}},J.prototype.createNipple=function(o,v){var V=this,g=V.manager.scroll,E={},I=V.options,Q=V.parentIsFlex?g.x:g.x+V.box.left,U=V.parentIsFlex?g.y:g.y+V.box.top;if(o.x&&o.y)E={x:o.x-Q,y:o.y-U};else if(o.top||o.right||o.bottom||o.left){var n=document.createElement("DIV");n.style.display="hidden",n.style.top=o.top,n.style.right=o.right,n.style.bottom=o.bottom,n.style.left=o.left,n.style.position="absolute",I.zone.appendChild(n);var O=n.getBoundingClientRect();I.zone.removeChild(n),E=o,o={x:O.left+g.x,y:O.top+g.y}}var h=new i(V,{color:I.color,size:I.size,threshold:I.threshold,fadeTime:I.fadeTime,dataOnly:I.dataOnly,restJoystick:I.restJoystick,restOpacity:I.restOpacity,mode:I.mode,identifier:v,position:o,zone:I.zone,frontPosition:{x:0,y:0},shape:I.shape});return I.dataOnly||(x(h.ui.el,E),x(h.ui.front,h.frontPosition)),V.nipples.push(h),V.trigger("added "+h.identifier+":added",h),V.manager.trigger("added "+h.identifier+":added",h),V.bindNipple(h),h},J.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},J.prototype.bindNipple=function(o){var v,V=this,g=function(o,g){v=o.type+" "+g.id+":"+o.type,V.trigger(v,g)};o.on("destroyed",V.onDestroyed.bind(V)),o.on("shown hidden rested dir plain",g),o.on("dir:up dir:right dir:down dir:left",g),o.on("plain:up plain:right plain:down plain:left",g)},J.prototype.pressureFn=function(o,v,V){var g=this,E=0;clearInterval(g.pressureIntervals[V]),g.pressureIntervals[V]=setInterval(function(){var V=o.force||o.pressure||o.webkitForce||0;V!==E&&(v.trigger("pressure",V),g.trigger("pressure "+v.identifier+":pressure",V),E=V)}.bind(g),100)},J.prototype.onstart=function(o){var v=this,V=v.options,g=o;return o=O(o),v.updateBox(),T(o,(function(E){v.actives.length<V.maxNumberOfNipples?v.processOnStart(E):g.type.match(/^touch/)&&(Object.keys(v.manager.ids).forEach((function(V){if(Object.values(g.touches).findIndex((function(o){return o.identifier===V}))<0){var E=[o[0]];E.identifier=V,v.processOnEnd(E)}})),v.actives.length<V.maxNumberOfNipples&&v.processOnStart(E))})),v.manager.bindDocument(),!1},J.prototype.processOnStart=function(o){var v,V=this,E=V.options,I=V.manager.getIdentifier(o),Q=o.force||o.pressure||o.webkitForce||0,U={x:o.pageX,y:o.pageY},n=V.getOrCreate(I,U);n.identifier!==I&&V.manager.removeIdentifier(n.identifier),n.identifier=I;var O=function(v){v.trigger("start",v),V.trigger("start "+v.id+":start",v),v.show(),Q>0&&V.pressureFn(o,v,v.identifier),V.processOnMove(o)};if((v=V.idles.indexOf(n))>=0&&V.idles.splice(v,1),V.actives.push(n),V.ids.push(n.identifier),"semi"!==E.mode)O(n);else{if(!(g(U,n.position)<=E.catchDistance))return n.destroy(),void V.processOnStart(o);O(n)}return n},J.prototype.getOrCreate=function(o,v){var V,g=this,E=g.options;return/(semi|static)/.test(E.mode)?(V=g.idles[0])?(g.idles.splice(0,1),V):"semi"===E.mode?g.createNipple(v,o):(console.warn("Coudln't find the needed nipple."),!1):V=g.createNipple(v,o)},J.prototype.processOnMove=function(o){var v=this,V=v.options,I=v.manager.getIdentifier(o),Q=v.nipples.get(I),U=v.manager.scroll;if(function(o){return isNaN(o.buttons)?0!==o.pressure:0!==o.buttons}(o)){if(!Q)return console.error("Found zombie joystick with ID "+I),void v.manager.removeIdentifier(I);if(V.dynamicPage){var n=Q.el.getBoundingClientRect();Q.position={x:U.x+n.left,y:U.y+n.top}}Q.identifier=I;var O=Q.options.size/2,h={x:o.pageX,y:o.pageY};V.lockX&&(h.y=Q.position.y),V.lockY&&(h.x=Q.position.x);var x,f,l,S,T,c,R,j,t,s,L=g(h,Q.position),b=(x=h,l=(f=Q.position).x-x.x,S=f.y-x.y,function(o){return o*(180/Math.PI)}(Math.atan2(S,l))),u=E(b),mo=L/O,a={distance:L,position:h};if("circle"===Q.options.shape?(T=Math.min(L,O),R=Q.position,j=T,s={x:0,y:0},t=E(t=b),s.x=R.x-j*Math.cos(t),s.y=R.y-j*Math.sin(t),c=s):(c=function(o,v,V){return{x:Math.min(Math.max(o.x,v.x-V),v.x+V),y:Math.min(Math.max(o.y,v.y-V),v.y+V)}}(h,Q.position,O),T=g(c,Q.position)),V.follow){if(L>O){var F=h.x-c.x,i=h.y-c.y;Q.position.x+=F,Q.position.y+=i,Q.el.style.top=Q.position.y-(v.box.top+U.y)+"px",Q.el.style.left=Q.position.x-(v.box.left+U.x)+"px",L=g(h,Q.position)}}else h=c,L=T;var J=h.x-Q.position.x,d=h.y-Q.position.y;Q.frontPosition={x:J,y:d},V.dataOnly||(Q.ui.front.style.transform="translate("+J+"px,"+d+"px)");var N={identifier:Q.identifier,position:h,force:mo,pressure:o.force||o.pressure||o.webkitForce||0,distance:L,angle:{radian:u,degree:b},vector:{x:J/O,y:-d/O},raw:a,instance:Q,lockX:V.lockX,lockY:V.lockY};(N=Q.computeDirection(N)).angle={radian:E(180-b),degree:180-b},Q.trigger("move",N),v.trigger("move "+Q.id+":move",N)}else this.processOnEnd(o)},J.prototype.processOnEnd=function(o){var v=this,V=v.options,g=v.manager.getIdentifier(o),E=v.nipples.get(g),I=v.manager.removeIdentifier(E.identifier);E&&(V.dataOnly||E.hide((function(){"dynamic"===V.mode&&(E.trigger("removed",E),v.trigger("removed "+E.id+":removed",E),v.manager.trigger("removed "+E.id+":removed",E),E.destroy())})),clearInterval(v.pressureIntervals[E.identifier]),E.resetDirection(),E.trigger("end",E),v.trigger("end "+E.id+":end",E),v.ids.indexOf(E.identifier)>=0&&v.ids.splice(v.ids.indexOf(E.identifier),1),v.actives.indexOf(E)>=0&&v.actives.splice(v.actives.indexOf(E),1),/(semi|static)/.test(V.mode)?v.idles.push(E):v.nipples.indexOf(E)>=0&&v.nipples.splice(v.nipples.indexOf(E),1),v.manager.unbindDocument(),/(semi|static)/.test(V.mode)&&(v.manager.ids[I.id]=I.identifier))},J.prototype.onDestroyed=function(o,v){var V=this;V.nipples.indexOf(v)>=0&&V.nipples.splice(V.nipples.indexOf(v),1),V.actives.indexOf(v)>=0&&V.actives.splice(V.actives.indexOf(v),1),V.idles.indexOf(v)>=0&&V.idles.splice(V.idles.indexOf(v),1),V.ids.indexOf(v.identifier)>=0&&V.ids.splice(V.ids.indexOf(v.identifier),1),V.manager.removeIdentifier(v.identifier),V.manager.unbindDocument()},J.prototype.destroy=function(){var o=this;for(var v in o.unbindEvt(o.options.zone,"start"),o.nipples.forEach((function(o){o.destroy()})),o.pressureIntervals)o.pressureIntervals.hasOwnProperty(v)&&clearInterval(o.pressureIntervals[v]);o.trigger("destroyed",o.nipples),o.manager.unbindDocument(),o.off()};const d=J;function N(o){var v=this;v.ids={},v.index=0,v.collections=[],v.scroll=h(),v.config(o),v.prepareCollections();var V=function(){var o;v.collections.forEach((function(V){V.forEach((function(V){o=V.el.getBoundingClientRect(),V.position={x:v.scroll.x+o.left,y:v.scroll.y+o.top}}))}))};U(window,"resize",(function(){Q(V)}));var g=function(){v.scroll=h()};return U(window,"scroll",(function(){Q(g)})),v.collections}N.prototype=new a,N.constructor=N,N.prototype.prepareCollections=function(){var o=this;o.collections.create=o.create.bind(o),o.collections.on=o.on.bind(o),o.collections.off=o.off.bind(o),o.collections.destroy=o.destroy.bind(o),o.collections.get=function(v){var V;return o.collections.every((function(o){return!(V=o.get(v))})),V}},N.prototype.create=function(o){return this.createCollection(o)},N.prototype.createCollection=function(o){var v=this,V=new d(v,o);return v.bindCollection(V),v.collections.push(V),V},N.prototype.bindCollection=function(o){var v,V=this,g=function(o,g){v=o.type+" "+g.id+":"+o.type,V.trigger(v,g)};o.on("destroyed",V.onDestroyed.bind(V)),o.on("shown hidden rested dir plain",g),o.on("dir:up dir:right dir:down dir:left",g),o.on("plain:up plain:right plain:down plain:left",g)},N.prototype.bindDocument=function(){var o=this;o.binded||(o.bindEvt(document,"move").bindEvt(document,"end"),o.binded=!0)},N.prototype.unbindDocument=function(o){var v=this;Object.keys(v.ids).length&&!0!==o||(v.unbindEvt(document,"move").unbindEvt(document,"end"),v.binded=!1)},N.prototype.getIdentifier=function(o){var v;return o?void 0===(v=void 0===o.identifier?o.pointerId:o.identifier)&&(v=this.latest||0):v=this.index,void 0===this.ids[v]&&(this.ids[v]=this.index,this.index+=1),this.latest=v,this.ids[v]},N.prototype.removeIdentifier=function(o){var v={};for(var V in this.ids)if(this.ids[V]===o){v.id=V,v.identifier=this.ids[V],delete this.ids[V];break}return v},N.prototype.onmove=function(o){return this.onAny("move",o),!1},N.prototype.onend=function(o){return this.onAny("end",o),!1},N.prototype.oncancel=function(o){return this.onAny("end",o),!1},N.prototype.onAny=function(o,v){var V,g=this,E="processOn"+o.charAt(0).toUpperCase()+o.slice(1);v=O(v);var I=function(o,v,V){V.ids.indexOf(v)>=0&&(V[E](o),o._found_=!0)};return T(v,(function(o){V=g.getIdentifier(o),T(g.collections,I.bind(null,o,V)),o._found_||g.removeIdentifier(V)})),!1},N.prototype.destroy=function(){var o=this;o.unbindDocument(!0),o.ids={},o.index=0,o.collections.forEach((function(o){o.destroy()})),o.off()},N.prototype.onDestroyed=function(o,v){var V=this;if(V.collections.indexOf(v)<0)return!1;V.collections.splice(V.collections.indexOf(v),1)};var Y=new N;const q={create:function(o){return Y.create(o)},factory:Y};return v.default})(),o.exports=v()},13634:(o,v,V)=>{"use strict";const{Deflate:g,deflate:E,deflateRaw:I,gzip:Q}=V(13640),{Inflate:U,inflate:n,inflateRaw:O,ungzip:h}=V(13710),x=V(13682);o.exports.Deflate=g,o.exports.deflate=E,o.exports.deflateRaw=I,o.exports.gzip=Q,o.exports.Inflate=U,o.exports.inflate=n,o.exports.inflateRaw=O,o.exports.ungzip=h,o.exports.constants=x},13640:(o,v,V)=>{"use strict";const g=V(13646),E=V(13686),I=V(13693),Q=V(13674),U=V(13701),n=Object.prototype.toString,{Z_NO_FLUSH:O,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:x,Z_FINISH:f,Z_OK:l,Z_STREAM_END:S,Z_DEFAULT_COMPRESSION:T,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:R}=V(13682);function j(o){this.options=E.assign({level:T,method:R,eo:16384,windowBits:15,memLevel:8,strategy:c},o||{});let v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.xv="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;let V=g.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(V!==l)throw new Error(Q[V]);if(v.header&&g.deflateSetHeader(this.strm,v.header),v.dictionary){let o;if(o="string"===typeof v.dictionary?I.string2buf(v.dictionary):"[object ArrayBuffer]"===n.call(v.dictionary)?new Uint8Array(v.dictionary):v.dictionary,V=g.deflateSetDictionary(this.strm,o),V!==l)throw new Error(Q[V]);this._dict_set=!0}}function t(o,v){const V=new j(v);if(V.push(o,!0),V.err)throw V.xv||Q[V.err];return V.result}j.prototype.push=function(o,v){const V=this.strm,E=this.options.eo;let Q,U;if(this.ended)return!1;for(U=v===~~v?v:!0===v?f:O,"string"===typeof o?V.input=I.string2buf(o):"[object ArrayBuffer]"===n.call(o)?V.input=new Uint8Array(o):V.input=o,V.next_in=0,V.avail_in=V.input.length;;)if(0===V.avail_out&&(V.output=new Uint8Array(E),V.next_out=0,V.avail_out=E),(U===h||U===x)&&V.avail_out<=6)this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;else{if(Q=g.deflate(V,U),Q===S)return V.next_out>0&&this.onData(V.output.subarray(0,V.next_out)),Q=g.deflateEnd(this.strm),this.onEnd(Q),this.ended=!0,Q===l;if(0!==V.avail_out){if(U>0&&V.next_out>0)this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;else if(0===V.avail_in)break}else this.onData(V.output)}return!0},j.prototype.onData=function(o){this.chunks.push(o)},j.prototype.onEnd=function(o){o===l&&(this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.xv=this.strm.xv},o.exports.Deflate=j,o.exports.deflate=t,o.exports.deflateRaw=function(o,v){return(v=v||{}).raw=!0,t(o,v)},o.exports.gzip=function(o,v){return(v=v||{}).gzip=!0,t(o,v)},o.exports.constants=V(13682)},13710:(o,v,V)=>{"use strict";const g=V(13718),E=V(13686),I=V(13693),Q=V(13674),U=V(13701),n=V(13735),O=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:x,Z_OK:f,Z_STREAM_END:l,Z_NEED_DICT:S,Z_STREAM_ERROR:T,Z_DATA_ERROR:c,Z_MEM_ERROR:R}=V(13682);function j(o){this.options=E.assign({eo:65536,windowBits:15,to:""},o||{});const v=this.options;v.raw&&v.windowBits>=0&&v.windowBits<16&&(v.windowBits=-v.windowBits,0===v.windowBits&&(v.windowBits=-15)),!(v.windowBits>=0&&v.windowBits<16)||o&&o.windowBits||(v.windowBits+=32),v.windowBits>15&&v.windowBits<48&&0===(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.xv="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;let V=g.inflateInit2(this.strm,v.windowBits);if(V!==f)throw new Error(Q[V]);if(this.header=new n,g.inflateGetHeader(this.strm,this.header),v.dictionary&&("string"===typeof v.dictionary?v.dictionary=I.string2buf(v.dictionary):"[object ArrayBuffer]"===O.call(v.dictionary)&&(v.dictionary=new Uint8Array(v.dictionary)),v.raw&&(V=g.inflateSetDictionary(this.strm,v.dictionary),V!==f)))throw new Error(Q[V])}function t(o,v){const V=new j(v);if(V.push(o),V.err)throw V.xv||Q[V.err];return V.result}j.prototype.push=function(o,v){const V=this.strm,E=this.options.eo,Q=this.options.dictionary;let U,n,j;if(this.ended)return!1;for(n=v===~~v?v:!0===v?x:h,"[object ArrayBuffer]"===O.call(o)?V.input=new Uint8Array(o):V.input=o,V.next_in=0,V.avail_in=V.input.length;;){for(0===V.avail_out&&(V.output=new Uint8Array(E),V.next_out=0,V.avail_out=E),U=g.inflate(V,n),U===S&&Q&&(U=g.inflateSetDictionary(V,Q),U===f?U=g.inflate(V,n):U===c&&(U=S));V.avail_in>0&&U===l&&V.state.wrap>0&&0!==o[V.next_in];)g.inflateReset(V),U=g.inflate(V,n);switch(U){case T:case c:case S:case R:return this.onEnd(U),this.ended=!0,!1}if(j=V.avail_out,V.next_out&&(0===V.avail_out||U===l))if("string"===this.options.to){let o=I.utf8border(V.output,V.next_out),v=V.next_out-o,g=I.buf2string(V.output,o);V.next_out=v,V.avail_out=E-v,v&&V.output.set(V.output.subarray(o,o+v),0),this.onData(g)}else this.onData(V.output.length===V.next_out?V.output:V.output.subarray(0,V.next_out));if(U!==f||0!==j){if(U===l)return U=g.inflateEnd(this.strm),this.onEnd(U),this.ended=!0,!0;if(0===V.avail_in)break}}return!0},j.prototype.onData=function(o){this.chunks.push(o)},j.prototype.onEnd=function(o){o===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.xv=this.strm.xv},o.exports.Inflate=j,o.exports.inflate=t,o.exports.inflateRaw=function(o,v){return(v=v||{}).raw=!0,t(o,v)},o.exports.ungzip=t,o.exports.constants=V(13682)},13686:o=>{"use strict";const v=(o,v)=>Object.prototype.hasOwnProperty.call(o,v);o.exports.assign=function(o){const V=Array.prototype.slice.call(arguments,1);for(;V.length;){const g=V.shift();if(g){if("object"!==typeof g)throw new TypeError(g+"must be non-object");for(const V in g)v(g,V)&&(o[V]=g[V])}}return o},o.exports.flattenChunks=o=>{let v=0;for(let g=0,E=o.length;g<E;g++)v+=o[g].length;const V=new Uint8Array(v);for(let g=0,E=0,I=o.length;g<I;g++){let v=o[g];V.set(v,E),E+=v.length}return V}},13693:o=>{"use strict";let v=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(g){v=!1}const V=new Uint8Array(256);for(let E=0;E<256;E++)V[E]=E>=252?6:E>=248?5:E>=240?4:E>=224?3:E>=192?2:1;V[254]=V[254]=1,o.exports.string2buf=o=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(o);let v,V,g,E,I,Q=o.length,U=0;for(E=0;E<Q;E++)V=o.charCodeAt(E),55296===(64512&V)&&E+1<Q&&(g=o.charCodeAt(E+1),56320===(64512&g)&&(V=65536+(V-55296<<10)+(g-56320),E++)),U+=V<128?1:V<2048?2:V<65536?3:4;for(v=new Uint8Array(U),I=0,E=0;I<U;E++)V=o.charCodeAt(E),55296===(64512&V)&&E+1<Q&&(g=o.charCodeAt(E+1),56320===(64512&g)&&(V=65536+(V-55296<<10)+(g-56320),E++)),V<128?v[I++]=V:V<2048?(v[I++]=192|V>>>6,v[I++]=128|63&V):V<65536?(v[I++]=224|V>>>12,v[I++]=128|V>>>6&63,v[I++]=128|63&V):(v[I++]=240|V>>>18,v[I++]=128|V>>>12&63,v[I++]=128|V>>>6&63,v[I++]=128|63&V);return v};o.exports.buf2string=(o,g)=>{const E=g||o.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(o.subarray(0,g));let I,Q;const U=new Array(2*E);for(Q=0,I=0;I<E;){let v=o[I++];if(v<128){U[Q++]=v;continue}let g=V[v];if(g>4)U[Q++]=65533,I+=g-1;else{for(v&=2===g?31:3===g?15:7;g>1&&I<E;)v=v<<6|63&o[I++],g--;g>1?U[Q++]=65533:v<65536?U[Q++]=v:(v-=65536,U[Q++]=55296|v>>10&1023,U[Q++]=56320|1023&v)}}return((o,V)=>{if(V<65534&&o.subarray&&v)return String.fromCharCode.apply(null,o.length===V?o:o.subarray(0,V));let g="";for(let v=0;v<V;v++)g+=String.fromCharCode(o[v]);return g})(U,Q)},o.exports.utf8border=(o,v)=>{(v=v||o.length)>o.length&&(v=o.length);let g=v-1;for(;g>=0&&128===(192&o[g]);)g--;return g<0||0===g?v:g+V[o[g]]>v?g:v}},13659:o=>{"use strict";o.exports=(o,v,V,g)=>{let E=65535&o,I=o>>>16&65535,Q=0;for(;0!==V;){Q=V>2e3?2e3:V,V-=Q;do{E=E+v[g++]|0,I=I+E|0}while(--Q);E%=65521,I%=65521}return E|I<<16}},13682:o=>{"use strict";o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13666:o=>{"use strict";const v=new Uint32Array((()=>{let o,v=[];for(var V=0;V<256;V++){o=V;for(var g=0;g<8;g++)o=1&o?3988292384^o>>>1:o>>>1;v[V]=o}return v})());o.exports=(o,V,g,E)=>{const I=v,Q=E+g;o^=-1;for(let v=E;v<Q;v++)o=o>>>8^I[255&(o^V[v])];return~o}},13646:(o,v,V)=>{"use strict";const{_tr_init:g,_tr_stored_block:E,_tr_flush_block:I,_tr_tally:Q,_tr_align:U}=V(13651),n=V(13659),O=V(13666),h=V(13674),{Z_NO_FLUSH:x,Z_PARTIAL_FLUSH:f,Z_FULL_FLUSH:l,Z_FINISH:S,Z_BLOCK:T,Z_OK:c,Z_STREAM_END:R,Z_STREAM_ERROR:j,Z_DATA_ERROR:t,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:L,Z_FILTERED:b,Z_HUFFMAN_ONLY:u,Z_RLE:mo,Z_FIXED:a,Z_DEFAULT_STRATEGY:F,Z_UNKNOWN:i,Z_DEFLATED:J}=V(13682),d=258,N=262,Y=103,q=113,P=666,M=(o,v)=>(o.xv=h[v],v),W=o=>(o<<1)-(o>4?9:0),w=o=>{let v=o.length;for(;--v>=0;)o[v]=0};let z=(o,v,V)=>(v<<o.hash_shift^V)&o.hash_mask;const y=o=>{const v=o.state;let V=v.pending;V>o.avail_out&&(V=o.avail_out),0!==V&&(o.output.set(v.pending_buf.subarray(v.pending_out,v.pending_out+V),o.next_out),o.next_out+=V,v.pending_out+=V,o.total_out+=V,o.avail_out-=V,v.pending-=V,0===v.pending&&(v.pending_out=0))},H=(o,v)=>{I(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,v),o.block_start=o.strstart,y(o.strm)},e=(o,v)=>{o.pending_buf[o.pending++]=v},D=(o,v)=>{o.pending_buf[o.pending++]=v>>>8&255,o.pending_buf[o.pending++]=255&v},Z=(o,v,V,g)=>{let E=o.avail_in;return E>g&&(E=g),0===E?0:(o.avail_in-=E,v.set(o.input.subarray(o.next_in,o.next_in+E),V),1===o.state.wrap?o.adler=n(o.adler,v,E,V):2===o.state.wrap&&(o.adler=O(o.adler,v,E,V)),o.next_in+=E,o.total_in+=E,E)},K=(o,v)=>{let V,g,E=o.max_chain_length,I=o.strstart,Q=o.prev_length,U=o.nice_match;const n=o.strstart>o.w_size-N?o.strstart-(o.w_size-N):0,O=o.window,h=o.w_mask,x=o.prev,f=o.strstart+d;let l=O[I+Q-1],S=O[I+Q];o.prev_length>=o.good_match&&(E>>=2),U>o.lookahead&&(U=o.lookahead);do{if(V=v,O[V+Q]===S&&O[V+Q-1]===l&&O[V]===O[I]&&O[++V]===O[I+1]){I+=2,V++;do{}while(O[++I]===O[++V]&&O[++I]===O[++V]&&O[++I]===O[++V]&&O[++I]===O[++V]&&O[++I]===O[++V]&&O[++I]===O[++V]&&O[++I]===O[++V]&&O[++I]===O[++V]&&I<f);if(g=d-(f-I),I=f-d,g>Q){if(o.match_start=v,Q=g,g>=U)break;l=O[I+Q-1],S=O[I+Q]}}}while((v=x[v&h])>n&&0!==--E);return Q<=o.lookahead?Q:o.lookahead},X=o=>{const v=o.w_size;let V,g,E,I,Q;do{if(I=o.window_size-o.lookahead-o.strstart,o.strstart>=v+(v-N)){o.window.set(o.window.subarray(v,v+v),0),o.match_start-=v,o.strstart-=v,o.block_start-=v,g=o.hash_size,V=g;do{E=o.head[--V],o.head[V]=E>=v?E-v:0}while(--g);g=v,V=g;do{E=o.prev[--V],o.prev[V]=E>=v?E-v:0}while(--g);I+=v}if(0===o.strm.avail_in)break;if(g=Z(o.strm,o.window,o.strstart+o.lookahead,I),o.lookahead+=g,o.lookahead+o.insert>=3)for(Q=o.strstart-o.insert,o.ins_h=o.window[Q],o.ins_h=z(o,o.ins_h,o.window[Q+1]);o.insert&&(o.ins_h=z(o,o.ins_h,o.window[Q+3-1]),o.prev[Q&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=Q,Q++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<N&&0!==o.strm.avail_in)},r=(o,v)=>{let V,g;for(;;){if(o.lookahead<N){if(X(o),o.lookahead<N&&v===x)return 1;if(0===o.lookahead)break}if(V=0,o.lookahead>=3&&(o.ins_h=z(o,o.ins_h,o.window[o.strstart+3-1]),V=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),0!==V&&o.strstart-V<=o.w_size-N&&(o.match_length=K(o,V)),o.match_length>=3)if(g=Q(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do{o.strstart++,o.ins_h=z(o,o.ins_h,o.window[o.strstart+3-1]),V=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart}while(0!==--o.match_length);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=z(o,o.ins_h,o.window[o.strstart+1]);else g=Q(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(g&&(H(o,!1),0===o.strm.avail_out))return 1}return o.insert=o.strstart<2?o.strstart:2,v===S?(H(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(H(o,!1),0===o.strm.avail_out)?1:2},B=(o,v)=>{let V,g,E;for(;;){if(o.lookahead<N){if(X(o),o.lookahead<N&&v===x)return 1;if(0===o.lookahead)break}if(V=0,o.lookahead>=3&&(o.ins_h=z(o,o.ins_h,o.window[o.strstart+3-1]),V=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,0!==V&&o.prev_length<o.max_lazy_match&&o.strstart-V<=o.w_size-N&&(o.match_length=K(o,V),o.match_length<=5&&(o.strategy===b||3===o.match_length&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){E=o.strstart+o.lookahead-3,g=Q(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do{++o.strstart<=E&&(o.ins_h=z(o,o.ins_h,o.window[o.strstart+3-1]),V=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart)}while(0!==--o.prev_length);if(o.match_available=0,o.match_length=2,o.strstart++,g&&(H(o,!1),0===o.strm.avail_out))return 1}else if(o.match_available){if(g=Q(o,0,o.window[o.strstart-1]),g&&H(o,!1),o.strstart++,o.lookahead--,0===o.strm.avail_out)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(g=Q(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,v===S?(H(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(H(o,!1),0===o.strm.avail_out)?1:2};function A(o,v,V,g,E){this.good_length=o,this.max_lazy=v,this.nice_length=V,this.max_chain=g,this.func=E}const C=[new A(0,0,0,0,((o,v)=>{let V=65535;for(V>o.pending_buf_size-5&&(V=o.pending_buf_size-5);;){if(o.lookahead<=1){if(X(o),0===o.lookahead&&v===x)return 1;if(0===o.lookahead)break}o.strstart+=o.lookahead,o.lookahead=0;const g=o.block_start+V;if((0===o.strstart||o.strstart>=g)&&(o.lookahead=o.strstart-g,o.strstart=g,H(o,!1),0===o.strm.avail_out))return 1;if(o.strstart-o.block_start>=o.w_size-N&&(H(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,v===S?(H(o,!0),0===o.strm.avail_out?3:4):(o.strstart>o.block_start&&(H(o,!1),o.strm.avail_out),1)})),new A(4,4,8,4,r),new A(4,5,16,8,r),new A(4,6,32,32,r),new A(4,4,16,16,B),new A(8,16,32,32,B),new A(8,16,128,128,B),new A(8,32,128,256,B),new A(32,128,258,1024,B),new A(32,258,258,4096,B)];function p(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const G=o=>{if(!o||!o.state)return M(o,j);o.total_in=o.total_out=0,o.data_type=i;const v=o.state;return v.pending=0,v.pending_out=0,v.wrap<0&&(v.wrap=-v.wrap),v.status=v.wrap?42:q,o.adler=2===v.wrap?0:1,v.last_flush=x,g(v),c},k=o=>{const v=G(o);var V;return v===c&&((V=o.state).window_size=2*V.w_size,w(V.head),V.max_lazy_match=C[V.level].max_lazy,V.good_match=C[V.level].good_length,V.nice_match=C[V.level].nice_length,V.max_chain_length=C[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=2,V.match_available=0,V.ins_h=0),v},oo=(o,v,V,g,E,I)=>{if(!o)return j;let Q=1;if(v===L&&(v=6),g<0?(Q=0,g=-g):g>15&&(Q=2,g-=16),E<1||E>9||V!==J||g<8||g>15||v<0||v>9||I<0||I>a)return M(o,j);8===g&&(g=9);const U=new p;return o.state=U,U.strm=o,U.wrap=Q,U.gzhead=null,U.w_bits=g,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=E+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+3-1)/3),U.window=new Uint8Array(2*U.w_size),U.head=new Uint16Array(U.hash_size),U.prev=new Uint16Array(U.w_size),U.lit_bufsize=1<<E+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new Uint8Array(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=v,U.strategy=I,U.method=V,k(o)};o.exports.deflateInit=(o,v)=>oo(o,v,J,15,8,F),o.exports.deflateInit2=oo,o.exports.deflateReset=k,o.exports.deflateResetKeep=G,o.exports.deflateSetHeader=(o,v)=>o&&o.state?2!==o.state.wrap?j:(o.state.gzhead=v,c):j,o.exports.deflate=(o,v)=>{let V,g;if(!o||!o.state||v>T||v<0)return o?M(o,j):j;const I=o.state;if(!o.output||!o.input&&0!==o.avail_in||I.status===P&&v!==S)return M(o,0===o.avail_out?s:j);I.strm=o;const n=I.last_flush;if(I.last_flush=v,42===I.status)if(2===I.wrap)o.adler=0,e(I,31),e(I,139),e(I,8),I.gzhead?(e(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),e(I,255&I.gzhead.time),e(I,I.gzhead.time>>8&255),e(I,I.gzhead.time>>16&255),e(I,I.gzhead.time>>24&255),e(I,9===I.level?2:I.strategy>=u||I.level<2?4:0),e(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(e(I,255&I.gzhead.extra.length),e(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(o.adler=O(o.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(e(I,0),e(I,0),e(I,0),e(I,0),e(I,0),e(I,9===I.level?2:I.strategy>=u||I.level<2?4:0),e(I,3),I.status=q);else{let v=J+(I.w_bits-8<<4)<<8,V=-1;V=I.strategy>=u||I.level<2?0:I.level<6?1:6===I.level?2:3,v|=V<<6,0!==I.strstart&&(v|=32),v+=31-v%31,I.status=q,D(I,v),0!==I.strstart&&(D(I,o.adler>>>16),D(I,65535&o.adler)),o.adler=1}if(69===I.status)if(I.gzhead.extra){for(V=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>V&&(o.adler=O(o.adler,I.pending_buf,I.pending-V,V)),y(o),V=I.pending,I.pending!==I.pending_buf_size));)e(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>V&&(o.adler=O(o.adler,I.pending_buf,I.pending-V,V)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(73===I.status)if(I.gzhead.name){V=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>V&&(o.adler=O(o.adler,I.pending_buf,I.pending-V,V)),y(o),V=I.pending,I.pending===I.pending_buf_size)){g=1;break}g=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,e(I,g)}while(0!==g);I.gzhead.hcrc&&I.pending>V&&(o.adler=O(o.adler,I.pending_buf,I.pending-V,V)),0===g&&(I.gzindex=0,I.status=91)}else I.status=91;if(91===I.status)if(I.gzhead.comment){V=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>V&&(o.adler=O(o.adler,I.pending_buf,I.pending-V,V)),y(o),V=I.pending,I.pending===I.pending_buf_size)){g=1;break}g=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,e(I,g)}while(0!==g);I.gzhead.hcrc&&I.pending>V&&(o.adler=O(o.adler,I.pending_buf,I.pending-V,V)),0===g&&(I.status=Y)}else I.status=Y;if(I.status===Y&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&y(o),I.pending+2<=I.pending_buf_size&&(e(I,255&o.adler),e(I,o.adler>>8&255),o.adler=0,I.status=q)):I.status=q),0!==I.pending){if(y(o),0===o.avail_out)return I.last_flush=-1,c}else if(0===o.avail_in&&W(v)<=W(n)&&v!==S)return M(o,s);if(I.status===P&&0!==o.avail_in)return M(o,s);if(0!==o.avail_in||0!==I.lookahead||v!==x&&I.status!==P){let V=I.strategy===u?((o,v)=>{let V;for(;;){if(0===o.lookahead&&(X(o),0===o.lookahead)){if(v===x)return 1;break}if(o.match_length=0,V=Q(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,V&&(H(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,v===S?(H(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(H(o,!1),0===o.strm.avail_out)?1:2})(I,v):I.strategy===mo?((o,v)=>{let V,g,E,I;const U=o.window;for(;;){if(o.lookahead<=d){if(X(o),o.lookahead<=d&&v===x)return 1;if(0===o.lookahead)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(E=o.strstart-1,g=U[E],g===U[++E]&&g===U[++E]&&g===U[++E])){I=o.strstart+d;do{}while(g===U[++E]&&g===U[++E]&&g===U[++E]&&g===U[++E]&&g===U[++E]&&g===U[++E]&&g===U[++E]&&g===U[++E]&&E<I);o.match_length=d-(I-E),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(V=Q(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(V=Q(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),V&&(H(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,v===S?(H(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(H(o,!1),0===o.strm.avail_out)?1:2})(I,v):C[I.level].func(I,v);if(3!==V&&4!==V||(I.status=P),1===V||3===V)return 0===o.avail_out&&(I.last_flush=-1),c;if(2===V&&(v===f?U(I):v!==T&&(E(I,0,0,!1),v===l&&(w(I.head),0===I.lookahead&&(I.strstart=0,I.block_start=0,I.insert=0))),y(o),0===o.avail_out))return I.last_flush=-1,c}return v!==S?c:I.wrap<=0?R:(2===I.wrap?(e(I,255&o.adler),e(I,o.adler>>8&255),e(I,o.adler>>16&255),e(I,o.adler>>24&255),e(I,255&o.total_in),e(I,o.total_in>>8&255),e(I,o.total_in>>16&255),e(I,o.total_in>>24&255)):(D(I,o.adler>>>16),D(I,65535&o.adler)),y(o),I.wrap>0&&(I.wrap=-I.wrap),0!==I.pending?c:R)},o.exports.deflateEnd=o=>{if(!o||!o.state)return j;const v=o.state.status;return 42!==v&&69!==v&&73!==v&&91!==v&&v!==Y&&v!==q&&v!==P?M(o,j):(o.state=null,v===q?M(o,t):c)},o.exports.deflateSetDictionary=(o,v)=>{let V=v.length;if(!o||!o.state)return j;const g=o.state,E=g.wrap;if(2===E||1===E&&42!==g.status||g.lookahead)return j;if(1===E&&(o.adler=n(o.adler,v,V,0)),g.wrap=0,V>=g.w_size){0===E&&(w(g.head),g.strstart=0,g.block_start=0,g.insert=0);let o=new Uint8Array(g.w_size);o.set(v.subarray(V-g.w_size,V),0),v=o,V=g.w_size}const I=o.avail_in,Q=o.next_in,U=o.input;for(o.avail_in=V,o.next_in=0,o.input=v,X(g);g.lookahead>=3;){let o=g.strstart,v=g.lookahead-2;do{g.ins_h=z(g,g.ins_h,g.window[o+3-1]),g.prev[o&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=o,o++}while(--v);g.strstart=o,g.lookahead=2,X(g)}return g.strstart+=g.lookahead,g.block_start=g.strstart,g.insert=g.lookahead,g.lookahead=0,g.match_length=g.prev_length=2,g.match_available=0,o.next_in=Q,o.input=U,o.avail_in=I,g.wrap=E,c},o.exports.deflateInfo="pako deflate (from Nodeca project)"},13735:o=>{"use strict";o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13726:o=>{"use strict";o.exports=function(o,v){let V,g,E,I,Q,U,n,O,h,x,f,l,S,T,c,R,j,t,s,L,b,u,mo,a;const F=o.state;V=o.next_in,mo=o.input,g=V+(o.avail_in-5),E=o.next_out,a=o.output,I=E-(v-o.avail_out),Q=E+(o.avail_out-257),U=F.dmax,n=F.wsize,O=F.whave,h=F.wnext,x=F.window,f=F.hold,l=F.bits,S=F.lencode,T=F.distcode,c=(1<<F.lenbits)-1,R=(1<<F.distbits)-1;o:do{l<15&&(f+=mo[V++]<<l,l+=8,f+=mo[V++]<<l,l+=8),j=S[f&c];v:for(;;){if(t=j>>>24,f>>>=t,l-=t,t=j>>>16&255,0===t)a[E++]=65535&j;else{if(!(16&t)){if(0===(64&t)){j=S[(65535&j)+(f&(1<<t)-1)];continue v}if(32&t){F.mode=12;break o}o.xv="invalid literal/length code",F.mode=30;break o}s=65535&j,t&=15,t&&(l<t&&(f+=mo[V++]<<l,l+=8),s+=f&(1<<t)-1,f>>>=t,l-=t),l<15&&(f+=mo[V++]<<l,l+=8,f+=mo[V++]<<l,l+=8),j=T[f&R];V:for(;;){if(t=j>>>24,f>>>=t,l-=t,t=j>>>16&255,!(16&t)){if(0===(64&t)){j=T[(65535&j)+(f&(1<<t)-1)];continue V}o.xv="invalid distance code",F.mode=30;break o}if(L=65535&j,t&=15,l<t&&(f+=mo[V++]<<l,l+=8,l<t&&(f+=mo[V++]<<l,l+=8)),L+=f&(1<<t)-1,L>U){o.xv="invalid distance too far back",F.mode=30;break o}if(f>>>=t,l-=t,t=E-I,L>t){if(t=L-t,t>O&&F.sane){o.xv="invalid distance too far back",F.mode=30;break o}if(b=0,u=x,0===h){if(b+=n-t,t<s){s-=t;do{a[E++]=x[b++]}while(--t);b=E-L,u=a}}else if(h<t){if(b+=n+h-t,t-=h,t<s){s-=t;do{a[E++]=x[b++]}while(--t);if(b=0,h<s){t=h,s-=t;do{a[E++]=x[b++]}while(--t);b=E-L,u=a}}}else if(b+=h-t,t<s){s-=t;do{a[E++]=x[b++]}while(--t);b=E-L,u=a}for(;s>2;)a[E++]=u[b++],a[E++]=u[b++],a[E++]=u[b++],s-=3;s&&(a[E++]=u[b++],s>1&&(a[E++]=u[b++]))}else{b=E-L;do{a[E++]=a[b++],a[E++]=a[b++],a[E++]=a[b++],s-=3}while(s>2);s&&(a[E++]=a[b++],s>1&&(a[E++]=a[b++]))}break}}break}}while(V<g&&E<Q);s=l>>3,V-=s,l-=s<<3,f&=(1<<l)-1,o.next_in=V,o.next_out=E,o.avail_in=V<g?g-V+5:5-(V-g),o.avail_out=E<Q?Q-E+257:257-(E-Q),F.hold=f,F.bits=l}},13718:(o,v,V)=>{"use strict";const g=V(13659),E=V(13666),I=V(13726),Q=V(13730),{Z_FINISH:U,Z_BLOCK:n,Z_TREES:O,Z_OK:h,Z_STREAM_END:x,Z_NEED_DICT:f,Z_STREAM_ERROR:l,Z_DATA_ERROR:S,Z_MEM_ERROR:T,Z_BUF_ERROR:c,Z_DEFLATED:R}=V(13682),j=12,t=30,s=o=>(o>>>24&255)+(o>>>8&65280)+((65280&o)<<8)+((255&o)<<24);function L(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const b=o=>{if(!o||!o.state)return l;const v=o.state;return o.total_in=o.total_out=v.total=0,o.xv="",v.wrap&&(o.adler=1&v.wrap),v.mode=1,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new Int32Array(852),v.distcode=v.distdyn=new Int32Array(592),v.sane=1,v.back=-1,h},u=o=>{if(!o||!o.state)return l;const v=o.state;return v.wsize=0,v.whave=0,v.wnext=0,b(o)},mo=(o,v)=>{let V;if(!o||!o.state)return l;const g=o.state;return v<0?(V=0,v=-v):(V=1+(v>>4),v<48&&(v&=15)),v&&(v<8||v>15)?l:(null!==g.window&&g.wbits!==v&&(g.window=null),g.wrap=V,g.wbits=v,u(o))},a=(o,v)=>{if(!o)return l;const V=new L;o.state=V,V.window=null;const g=mo(o,v);return g!==h&&(o.state=null),g};let F,i,J=!0;const d=o=>{if(J){F=new Int32Array(512),i=new Int32Array(32);let v=0;for(;v<144;)o.lens[v++]=8;for(;v<256;)o.lens[v++]=9;for(;v<280;)o.lens[v++]=7;for(;v<288;)o.lens[v++]=8;for(Q(1,o.lens,0,288,F,0,o.work,{bits:9}),v=0;v<32;)o.lens[v++]=5;Q(2,o.lens,0,32,i,0,o.work,{bits:5}),J=!1}o.lencode=F,o.lenbits=9,o.distcode=i,o.distbits=5},N=(o,v,V,g)=>{let E;const I=o.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Uint8Array(I.wsize)),g>=I.wsize?(I.window.set(v.subarray(V-I.wsize,V),0),I.wnext=0,I.whave=I.wsize):(E=I.wsize-I.wnext,E>g&&(E=g),I.window.set(v.subarray(V-g,V-g+E),I.wnext),(g-=E)?(I.window.set(v.subarray(V-g,V),0),I.wnext=g,I.whave=I.wsize):(I.wnext+=E,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=E))),0};o.exports.inflateReset=u,o.exports.inflateReset2=mo,o.exports.inflateResetKeep=b,o.exports.inflateInit=o=>a(o,15),o.exports.inflateInit2=a,o.exports.inflate=(o,v)=>{let V,L,b,u,mo,a,F,i,J,Y,q,P,M,W,w,z,y,H,e,D,Z,K,X=0;const r=new Uint8Array(4);let B,A;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!o||!o.state||!o.output||!o.input&&0!==o.avail_in)return l;V=o.state,V.mode===j&&(V.mode=13),mo=o.next_out,b=o.output,F=o.avail_out,u=o.next_in,L=o.input,a=o.avail_in,i=V.hold,J=V.bits,Y=a,q=F,K=h;o:for(;;)switch(V.mode){case 1:if(0===V.wrap){V.mode=13;break}for(;J<16;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(2&V.wrap&&35615===i){V.check=0,r[0]=255&i,r[1]=i>>>8&255,V.check=E(V.check,r,2,0),i=0,J=0,V.mode=2;break}if(V.flags=0,V.head&&(V.head.done=!1),!(1&V.wrap)||(((255&i)<<8)+(i>>8))%31){o.xv="incorrect header check",V.mode=t;break}if((15&i)!==R){o.xv="unknown compression method",V.mode=t;break}if(i>>>=4,J-=4,Z=8+(15&i),0===V.wbits)V.wbits=Z;else if(Z>V.wbits){o.xv="invalid window size",V.mode=t;break}V.dmax=1<<V.wbits,o.adler=V.check=1,V.mode=512&i?10:j,i=0,J=0;break;case 2:for(;J<16;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(V.flags=i,(255&V.flags)!==R){o.xv="unknown compression method",V.mode=t;break}if(57344&V.flags){o.xv="unknown header flags set",V.mode=t;break}V.head&&(V.head.text=i>>8&1),512&V.flags&&(r[0]=255&i,r[1]=i>>>8&255,V.check=E(V.check,r,2,0)),i=0,J=0,V.mode=3;case 3:for(;J<32;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}V.head&&(V.head.time=i),512&V.flags&&(r[0]=255&i,r[1]=i>>>8&255,r[2]=i>>>16&255,r[3]=i>>>24&255,V.check=E(V.check,r,4,0)),i=0,J=0,V.mode=4;case 4:for(;J<16;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}V.head&&(V.head.xflags=255&i,V.head.os=i>>8),512&V.flags&&(r[0]=255&i,r[1]=i>>>8&255,V.check=E(V.check,r,2,0)),i=0,J=0,V.mode=5;case 5:if(1024&V.flags){for(;J<16;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}V.length=i,V.head&&(V.head.extra_len=i),512&V.flags&&(r[0]=255&i,r[1]=i>>>8&255,V.check=E(V.check,r,2,0)),i=0,J=0}else V.head&&(V.head.extra=null);V.mode=6;case 6:if(1024&V.flags&&(P=V.length,P>a&&(P=a),P&&(V.head&&(Z=V.head.extra_len-V.length,V.head.extra||(V.head.extra=new Uint8Array(V.head.extra_len)),V.head.extra.set(L.subarray(u,u+P),Z)),512&V.flags&&(V.check=E(V.check,L,P,u)),a-=P,u+=P,V.length-=P),V.length))break o;V.length=0,V.mode=7;case 7:if(2048&V.flags){if(0===a)break o;P=0;do{Z=L[u+P++],V.head&&Z&&V.length<65536&&(V.head.name+=String.fromCharCode(Z))}while(Z&&P<a);if(512&V.flags&&(V.check=E(V.check,L,P,u)),a-=P,u+=P,Z)break o}else V.head&&(V.head.name=null);V.length=0,V.mode=8;case 8:if(4096&V.flags){if(0===a)break o;P=0;do{Z=L[u+P++],V.head&&Z&&V.length<65536&&(V.head.comment+=String.fromCharCode(Z))}while(Z&&P<a);if(512&V.flags&&(V.check=E(V.check,L,P,u)),a-=P,u+=P,Z)break o}else V.head&&(V.head.comment=null);V.mode=9;case 9:if(512&V.flags){for(;J<16;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(i!==(65535&V.check)){o.xv="header crc mismatch",V.mode=t;break}i=0,J=0}V.head&&(V.head.hcrc=V.flags>>9&1,V.head.done=!0),o.adler=V.check=0,V.mode=j;break;case 10:for(;J<32;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}o.adler=V.check=s(i),i=0,J=0,V.mode=11;case 11:if(0===V.havedict)return o.next_out=mo,o.avail_out=F,o.next_in=u,o.avail_in=a,V.hold=i,V.bits=J,f;o.adler=V.check=1,V.mode=j;case j:if(v===n||v===O)break o;case 13:if(V.last){i>>>=7&J,J-=7&J,V.mode=27;break}for(;J<3;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}switch(V.last=1&i,i>>>=1,J-=1,3&i){case 0:V.mode=14;break;case 1:if(d(V),V.mode=20,v===O){i>>>=2,J-=2;break o}break;case 2:V.mode=17;break;case 3:o.xv="invalid block type",V.mode=t}i>>>=2,J-=2;break;case 14:for(i>>>=7&J,J-=7&J;J<32;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if((65535&i)!==(i>>>16^65535)){o.xv="invalid stored block lengths",V.mode=t;break}if(V.length=65535&i,i=0,J=0,V.mode=15,v===O)break o;case 15:V.mode=16;case 16:if(P=V.length,P){if(P>a&&(P=a),P>F&&(P=F),0===P)break o;b.set(L.subarray(u,u+P),mo),a-=P,u+=P,F-=P,mo+=P,V.length-=P;break}V.mode=j;break;case 17:for(;J<14;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(V.nlen=257+(31&i),i>>>=5,J-=5,V.ndist=1+(31&i),i>>>=5,J-=5,V.ncode=4+(15&i),i>>>=4,J-=4,V.nlen>286||V.ndist>30){o.xv="too many length or distance symbols",V.mode=t;break}V.have=0,V.mode=18;case 18:for(;V.have<V.ncode;){for(;J<3;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}V.lens[C[V.have++]]=7&i,i>>>=3,J-=3}for(;V.have<19;)V.lens[C[V.have++]]=0;if(V.lencode=V.lendyn,V.lenbits=7,B={bits:V.lenbits},K=Q(0,V.lens,0,19,V.lencode,0,V.work,B),V.lenbits=B.bits,K){o.xv="invalid code lengths set",V.mode=t;break}V.have=0,V.mode=19;case 19:for(;V.have<V.nlen+V.ndist;){for(;X=V.lencode[i&(1<<V.lenbits)-1],w=X>>>24,z=X>>>16&255,y=65535&X,!(w<=J);){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(y<16)i>>>=w,J-=w,V.lens[V.have++]=y;else{if(16===y){for(A=w+2;J<A;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(i>>>=w,J-=w,0===V.have){o.xv="invalid bit length repeat",V.mode=t;break}Z=V.lens[V.have-1],P=3+(3&i),i>>>=2,J-=2}else if(17===y){for(A=w+3;J<A;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}i>>>=w,J-=w,Z=0,P=3+(7&i),i>>>=3,J-=3}else{for(A=w+7;J<A;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}i>>>=w,J-=w,Z=0,P=11+(127&i),i>>>=7,J-=7}if(V.have+P>V.nlen+V.ndist){o.xv="invalid bit length repeat",V.mode=t;break}for(;P--;)V.lens[V.have++]=Z}}if(V.mode===t)break;if(0===V.lens[256]){o.xv="invalid code -- missing end-of-block",V.mode=t;break}if(V.lenbits=9,B={bits:V.lenbits},K=Q(1,V.lens,0,V.nlen,V.lencode,0,V.work,B),V.lenbits=B.bits,K){o.xv="invalid literal/lengths set",V.mode=t;break}if(V.distbits=6,V.distcode=V.distdyn,B={bits:V.distbits},K=Q(2,V.lens,V.nlen,V.ndist,V.distcode,0,V.work,B),V.distbits=B.bits,K){o.xv="invalid distances set",V.mode=t;break}if(V.mode=20,v===O)break o;case 20:V.mode=21;case 21:if(a>=6&&F>=258){o.next_out=mo,o.avail_out=F,o.next_in=u,o.avail_in=a,V.hold=i,V.bits=J,I(o,q),mo=o.next_out,b=o.output,F=o.avail_out,u=o.next_in,L=o.input,a=o.avail_in,i=V.hold,J=V.bits,V.mode===j&&(V.back=-1);break}for(V.back=0;X=V.lencode[i&(1<<V.lenbits)-1],w=X>>>24,z=X>>>16&255,y=65535&X,!(w<=J);){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(z&&0===(240&z)){for(H=w,e=z,D=y;X=V.lencode[D+((i&(1<<H+e)-1)>>H)],w=X>>>24,z=X>>>16&255,y=65535&X,!(H+w<=J);){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}i>>>=H,J-=H,V.back+=H}if(i>>>=w,J-=w,V.back+=w,V.length=y,0===z){V.mode=26;break}if(32&z){V.back=-1,V.mode=j;break}if(64&z){o.xv="invalid literal/length code",V.mode=t;break}V.extra=15&z,V.mode=22;case 22:if(V.extra){for(A=V.extra;J<A;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}V.length+=i&(1<<V.extra)-1,i>>>=V.extra,J-=V.extra,V.back+=V.extra}V.was=V.length,V.mode=23;case 23:for(;X=V.distcode[i&(1<<V.distbits)-1],w=X>>>24,z=X>>>16&255,y=65535&X,!(w<=J);){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(0===(240&z)){for(H=w,e=z,D=y;X=V.distcode[D+((i&(1<<H+e)-1)>>H)],w=X>>>24,z=X>>>16&255,y=65535&X,!(H+w<=J);){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}i>>>=H,J-=H,V.back+=H}if(i>>>=w,J-=w,V.back+=w,64&z){o.xv="invalid distance code",V.mode=t;break}V.offset=y,V.extra=15&z,V.mode=24;case 24:if(V.extra){for(A=V.extra;J<A;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}V.offset+=i&(1<<V.extra)-1,i>>>=V.extra,J-=V.extra,V.back+=V.extra}if(V.offset>V.dmax){o.xv="invalid distance too far back",V.mode=t;break}V.mode=25;case 25:if(0===F)break o;if(P=q-F,V.offset>P){if(P=V.offset-P,P>V.whave&&V.sane){o.xv="invalid distance too far back",V.mode=t;break}P>V.wnext?(P-=V.wnext,M=V.wsize-P):M=V.wnext-P,P>V.length&&(P=V.length),W=V.window}else W=b,M=mo-V.offset,P=V.length;P>F&&(P=F),F-=P,V.length-=P;do{b[mo++]=W[M++]}while(--P);0===V.length&&(V.mode=21);break;case 26:if(0===F)break o;b[mo++]=V.length,F--,V.mode=21;break;case 27:if(V.wrap){for(;J<32;){if(0===a)break o;a--,i|=L[u++]<<J,J+=8}if(q-=F,o.total_out+=q,V.total+=q,q&&(o.adler=V.check=V.flags?E(V.check,b,q,mo-q):g(V.check,b,q,mo-q)),q=F,(V.flags?i:s(i))!==V.check){o.xv="incorrect data check",V.mode=t;break}i=0,J=0}V.mode=28;case 28:if(V.wrap&&V.flags){for(;J<32;){if(0===a)break o;a--,i+=L[u++]<<J,J+=8}if(i!==(4294967295&V.total)){o.xv="incorrect length check",V.mode=t;break}i=0,J=0}V.mode=29;case 29:K=x;break o;case t:K=S;break o;case 31:return T;default:return l}return o.next_out=mo,o.avail_out=F,o.next_in=u,o.avail_in=a,V.hold=i,V.bits=J,(V.wsize||q!==o.avail_out&&V.mode<t&&(V.mode<27||v!==U))&&N(o,o.output,o.next_out,q-o.avail_out)?(V.mode=31,T):(Y-=o.avail_in,q-=o.avail_out,o.total_in+=Y,o.total_out+=q,V.total+=q,V.wrap&&q&&(o.adler=V.check=V.flags?E(V.check,b,q,o.next_out-q):g(V.check,b,q,o.next_out-q)),o.data_type=V.bits+(V.last?64:0)+(V.mode===j?128:0)+(20===V.mode||15===V.mode?256:0),(0===Y&&0===q||v===U)&&K===h&&(K=c),K)},o.exports.inflateEnd=o=>{if(!o||!o.state)return l;let v=o.state;return v.window&&(v.window=null),o.state=null,h},o.exports.inflateGetHeader=(o,v)=>{if(!o||!o.state)return l;const V=o.state;return 0===(2&V.wrap)?l:(V.head=v,v.done=!1,h)},o.exports.inflateSetDictionary=(o,v)=>{const V=v.length;let E,I,Q;return o&&o.state?(E=o.state,0!==E.wrap&&11!==E.mode?l:11===E.mode&&(I=1,I=g(I,v,V,0),I!==E.check)?S:(Q=N(o,v,V,V),Q?(E.mode=31,T):(E.havedict=1,h))):l},o.exports.inflateInfo="pako inflate (from Nodeca project)"},13730:o=>{"use strict";const v=15,V=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),g=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),I=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);o.exports=(o,Q,U,n,O,h,x,f)=>{const l=f.bits;let S,T,c,R,j,t,s=0,L=0,b=0,u=0,mo=0,a=0,F=0,i=0,J=0,d=0,N=null,Y=0;const q=new Uint16Array(16),P=new Uint16Array(16);let M,W,w,z=null,y=0;for(s=0;s<=v;s++)q[s]=0;for(L=0;L<n;L++)q[Q[U+L]]++;for(mo=l,u=v;u>=1&&0===q[u];u--);if(mo>u&&(mo=u),0===u)return O[h++]=20971520,O[h++]=20971520,f.bits=1,0;for(b=1;b<u&&0===q[b];b++);for(mo<b&&(mo=b),i=1,s=1;s<=v;s++)if(i<<=1,i-=q[s],i<0)return-1;if(i>0&&(0===o||1!==u))return-1;for(P[1]=0,s=1;s<v;s++)P[s+1]=P[s]+q[s];for(L=0;L<n;L++)0!==Q[U+L]&&(x[P[Q[U+L]]++]=L);if(0===o?(N=z=x,t=19):1===o?(N=V,Y-=257,z=g,y-=257,t=256):(N=E,z=I,t=-1),d=0,L=0,s=b,j=h,a=mo,F=0,c=-1,J=1<<mo,R=J-1,1===o&&J>852||2===o&&J>592)return 1;for(;;){M=s-F,x[L]<t?(W=0,w=x[L]):x[L]>t?(W=z[y+x[L]],w=N[Y+x[L]]):(W=96,w=0),S=1<<s-F,T=1<<a,b=T;do{T-=S,O[j+(d>>F)+T]=M<<24|W<<16|w}while(0!==T);for(S=1<<s-1;d&S;)S>>=1;if(0!==S?(d&=S-1,d+=S):d=0,L++,0===--q[s]){if(s===u)break;s=Q[U+x[L]]}if(s>mo&&(d&R)!==c){for(0===F&&(F=mo),j+=b,a=s-F,i=1<<a;a+F<u&&(i-=q[a+F],!(i<=0));)a++,i<<=1;if(J+=1<<a,1===o&&J>852||2===o&&J>592)return 1;c=d&R,O[c]=mo<<24|a<<16|j-h}}return 0!==d&&(O[j+d]=s-F<<24|64<<16),f.bits=mo,0}},13674:o=>{"use strict";o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13651:o=>{"use strict";function v(o){let v=o.length;for(;--v>=0;)o[v]=0}const V=256,g=286,E=30,I=15,Q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),U=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);v(h);const x=new Array(60);v(x);const f=new Array(512);v(f);const l=new Array(256);v(l);const S=new Array(29);v(S);const T=new Array(E);function c(o,v,V,g,E){this.static_tree=o,this.extra_bits=v,this.extra_base=V,this.elems=g,this.max_length=E,this.has_stree=o&&o.length}let R,j,t;function s(o,v){this.dyn_tree=o,this.max_code=0,this.stat_desc=v}v(T);const L=o=>o<256?f[o]:f[256+(o>>>7)],b=(o,v)=>{o.pending_buf[o.pending++]=255&v,o.pending_buf[o.pending++]=v>>>8&255},u=(o,v,V)=>{o.bi_valid>16-V?(o.bi_buf|=v<<o.bi_valid&65535,b(o,o.bi_buf),o.bi_buf=v>>16-o.bi_valid,o.bi_valid+=V-16):(o.bi_buf|=v<<o.bi_valid&65535,o.bi_valid+=V)},mo=(o,v,V)=>{u(o,V[2*v],V[2*v+1])},a=(o,v)=>{let V=0;do{V|=1&o,o>>>=1,V<<=1}while(--v>0);return V>>>1},F=(o,v,V)=>{const g=new Array(16);let E,Q,U=0;for(E=1;E<=I;E++)g[E]=U=U+V[E-1]<<1;for(Q=0;Q<=v;Q++){let v=o[2*Q+1];0!==v&&(o[2*Q]=a(g[v]++,v))}},i=o=>{let v;for(v=0;v<g;v++)o.dyn_ltree[2*v]=0;for(v=0;v<E;v++)o.dyn_dtree[2*v]=0;for(v=0;v<19;v++)o.bl_tree[2*v]=0;o.dyn_ltree[512]=1,o.opt_len=o.static_len=0,o.last_lit=o.matches=0},J=o=>{o.bi_valid>8?b(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},d=(o,v,V,g)=>{const E=2*v,I=2*V;return o[E]<o[I]||o[E]===o[I]&&g[v]<=g[V]},N=(o,v,V)=>{const g=o.heap[V];let E=V<<1;for(;E<=o.heap_len&&(E<o.heap_len&&d(v,o.heap[E+1],o.heap[E],o.depth)&&E++,!d(v,g,o.heap[E],o.depth));)o.heap[V]=o.heap[E],V=E,E<<=1;o.heap[V]=g},Y=(o,v,g)=>{let E,I,n,O,h=0;if(0!==o.last_lit)do{E=o.pending_buf[o.d_buf+2*h]<<8|o.pending_buf[o.d_buf+2*h+1],I=o.pending_buf[o.l_buf+h],h++,0===E?mo(o,I,v):(n=l[I],mo(o,n+V+1,v),O=Q[n],0!==O&&(I-=S[n],u(o,I,O)),E--,n=L(E),mo(o,n,g),O=U[n],0!==O&&(E-=T[n],u(o,E,O)))}while(h<o.last_lit);mo(o,256,v)},q=(o,v)=>{const V=v.dyn_tree,g=v.stat_desc.static_tree,E=v.stat_desc.has_stree,Q=v.stat_desc.elems;let U,n,O,h=-1;for(o.heap_len=0,o.heap_max=573,U=0;U<Q;U++)0!==V[2*U]?(o.heap[++o.heap_len]=h=U,o.depth[U]=0):V[2*U+1]=0;for(;o.heap_len<2;)O=o.heap[++o.heap_len]=h<2?++h:0,V[2*O]=1,o.depth[O]=0,o.opt_len--,E&&(o.static_len-=g[2*O+1]);for(v.max_code=h,U=o.heap_len>>1;U>=1;U--)N(o,V,U);O=Q;do{U=o.heap[1],o.heap[1]=o.heap[o.heap_len--],N(o,V,1),n=o.heap[1],o.heap[--o.heap_max]=U,o.heap[--o.heap_max]=n,V[2*O]=V[2*U]+V[2*n],o.depth[O]=(o.depth[U]>=o.depth[n]?o.depth[U]:o.depth[n])+1,V[2*U+1]=V[2*n+1]=O,o.heap[1]=O++,N(o,V,1)}while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],((o,v)=>{const V=v.dyn_tree,g=v.max_code,E=v.stat_desc.static_tree,Q=v.stat_desc.has_stree,U=v.stat_desc.extra_bits,n=v.stat_desc.extra_base,O=v.stat_desc.max_length;let h,x,f,l,S,T,c=0;for(l=0;l<=I;l++)o.bl_count[l]=0;for(V[2*o.heap[o.heap_max]+1]=0,h=o.heap_max+1;h<573;h++)x=o.heap[h],l=V[2*V[2*x+1]+1]+1,l>O&&(l=O,c++),V[2*x+1]=l,x>g||(o.bl_count[l]++,S=0,x>=n&&(S=U[x-n]),T=V[2*x],o.opt_len+=T*(l+S),Q&&(o.static_len+=T*(E[2*x+1]+S)));if(0!==c){do{for(l=O-1;0===o.bl_count[l];)l--;o.bl_count[l]--,o.bl_count[l+1]+=2,o.bl_count[O]--,c-=2}while(c>0);for(l=O;0!==l;l--)for(x=o.bl_count[l];0!==x;)f=o.heap[--h],f>g||(V[2*f+1]!==l&&(o.opt_len+=(l-V[2*f+1])*V[2*f],V[2*f+1]=l),x--)}})(o,v),F(V,h,o.bl_count)},P=(o,v,V)=>{let g,E,I=-1,Q=v[1],U=0,n=7,O=4;for(0===Q&&(n=138,O=3),v[2*(V+1)+1]=65535,g=0;g<=V;g++)E=Q,Q=v[2*(g+1)+1],++U<n&&E===Q||(U<O?o.bl_tree[2*E]+=U:0!==E?(E!==I&&o.bl_tree[2*E]++,o.bl_tree[32]++):U<=10?o.bl_tree[34]++:o.bl_tree[36]++,U=0,I=E,0===Q?(n=138,O=3):E===Q?(n=6,O=3):(n=7,O=4))},M=(o,v,V)=>{let g,E,I=-1,Q=v[1],U=0,n=7,O=4;for(0===Q&&(n=138,O=3),g=0;g<=V;g++)if(E=Q,Q=v[2*(g+1)+1],!(++U<n&&E===Q)){if(U<O)do{mo(o,E,o.bl_tree)}while(0!==--U);else 0!==E?(E!==I&&(mo(o,E,o.bl_tree),U--),mo(o,16,o.bl_tree),u(o,U-3,2)):U<=10?(mo(o,17,o.bl_tree),u(o,U-3,3)):(mo(o,18,o.bl_tree),u(o,U-11,7));U=0,I=E,0===Q?(n=138,O=3):E===Q?(n=6,O=3):(n=7,O=4)}};let W=!1;const w=(o,v,V,g)=>{u(o,0+(g?1:0),3),((o,v,V,g)=>{J(o),g&&(b(o,V),b(o,~V)),o.pending_buf.set(o.window.subarray(v,v+V),o.pending),o.pending+=V})(o,v,V,!0)};o.exports._tr_init=o=>{W||((()=>{let o,v,V,O,s;const L=new Array(16);for(V=0,O=0;O<28;O++)for(S[O]=V,o=0;o<1<<Q[O];o++)l[V++]=O;for(l[V-1]=O,s=0,O=0;O<16;O++)for(T[O]=s,o=0;o<1<<U[O];o++)f[s++]=O;for(s>>=7;O<E;O++)for(T[O]=s<<7,o=0;o<1<<U[O]-7;o++)f[256+s++]=O;for(v=0;v<=I;v++)L[v]=0;for(o=0;o<=143;)h[2*o+1]=8,o++,L[8]++;for(;o<=255;)h[2*o+1]=9,o++,L[9]++;for(;o<=279;)h[2*o+1]=7,o++,L[7]++;for(;o<=287;)h[2*o+1]=8,o++,L[8]++;for(F(h,287,L),o=0;o<E;o++)x[2*o+1]=5,x[2*o]=a(o,5);R=new c(h,Q,257,g,I),j=new c(x,U,0,E,I),t=new c(new Array(0),n,0,19,7)})(),W=!0),o.l_desc=new s(o.dyn_ltree,R),o.d_desc=new s(o.dyn_dtree,j),o.bl_desc=new s(o.bl_tree,t),o.bi_buf=0,o.bi_valid=0,i(o)},o.exports._tr_stored_block=w,o.exports._tr_flush_block=(o,v,g,E)=>{let I,Q,U=0;o.level>0?(2===o.strm.data_type&&(o.strm.data_type=(o=>{let v,g=4093624447;for(v=0;v<=31;v++,g>>>=1)if(1&g&&0!==o.dyn_ltree[2*v])return 0;if(0!==o.dyn_ltree[18]||0!==o.dyn_ltree[20]||0!==o.dyn_ltree[26])return 1;for(v=32;v<V;v++)if(0!==o.dyn_ltree[2*v])return 1;return 0})(o)),q(o,o.l_desc),q(o,o.d_desc),U=(o=>{let v;for(P(o,o.dyn_ltree,o.l_desc.max_code),P(o,o.dyn_dtree,o.d_desc.max_code),q(o,o.bl_desc),v=18;v>=3&&0===o.bl_tree[2*O[v]+1];v--);return o.opt_len+=3*(v+1)+5+5+4,v})(o),I=o.opt_len+3+7>>>3,Q=o.static_len+3+7>>>3,Q<=I&&(I=Q)):I=Q=g+5,g+4<=I&&-1!==v?w(o,v,g,E):4===o.strategy||Q===I?(u(o,2+(E?1:0),3),Y(o,h,x)):(u(o,4+(E?1:0),3),((o,v,V,g)=>{let E;for(u(o,v-257,5),u(o,V-1,5),u(o,g-4,4),E=0;E<g;E++)u(o,o.bl_tree[2*O[E]+1],3);M(o,o.dyn_ltree,v-1),M(o,o.dyn_dtree,V-1)})(o,o.l_desc.max_code+1,o.d_desc.max_code+1,U+1),Y(o,o.dyn_ltree,o.dyn_dtree)),i(o),E&&J(o)},o.exports._tr_tally=(o,v,g)=>(o.pending_buf[o.d_buf+2*o.last_lit]=v>>>8&255,o.pending_buf[o.d_buf+2*o.last_lit+1]=255&v,o.pending_buf[o.l_buf+o.last_lit]=255&g,o.last_lit++,0===v?o.dyn_ltree[2*g]++:(o.matches++,v--,o.dyn_ltree[2*(l[g]+V+1)]++,o.dyn_dtree[2*L(v)]++),o.last_lit===o.lit_bufsize-1),o.exports._tr_align=o=>{u(o,2,3),mo(o,256,h),(o=>{16===o.bi_valid?(b(o,o.bi_buf),o.bi_buf=0,o.bi_valid=0):o.bi_valid>=8&&(o.pending_buf[o.pending++]=255&o.bi_buf,o.bi_buf>>=8,o.bi_valid-=8)})(o)}},13701:o=>{"use strict";o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.xv="",this.state=null,this.data_type=2,this.adler=0}},13326:o=>{function v(o,v,V){for(var g=o.length,E=-1/0,I=1/0,Q=0;Q<g;Q++){var U=(V[0][Q]-o[Q])/v[Q],n=(V[1][Q]-o[Q])/v[Q];if(U>n){var O=U;U=n,n=O}if(n<E||U>I)return 1/0;U>E&&(E=U),n<I&&(I=n)}return E>I?1/0:E}o.exports=function(o,V,g,E){var I=v(V,g,E);if(I===1/0)o=null;else{o=o||[];for(var Q=0;Q<V.length;Q++)o[Q]=V[Q]+g[Q]*I}return o},o.exports.distance=v},14711:(o,v,V)=>{"use strict";V.d(v,{c:()=>Q});var g=V(31);const E=g.useLayoutEffect;const I=function(o){var v=(0,g.useRef)(o);return E((function(){v.current=o})),v};var Q=function(o){var v=I(o);(0,g.nv)((function(){var o=function(o){var V;if(null!=v.current&&(V=v.current(o)),o.defaultPrevented&&(o.returnValue=""),"string"===typeof V)return o.returnValue=V,V};return window.addEventListener("beforeunload",o),function(){window.removeEventListener("beforeunload",o)}}),[])}},14671:(o,v,V)=>{"use strict";var g=V(14675),E=Array.prototype.concat,I=Array.prototype.slice,Q=o.exports=function(o){for(var v=[],V=0,Q=o.length;V<Q;V++){var U=o[V];g(U)?v=E.call(v,I.call(U)):v.push(U)}return v};Q.wrap=function(o){return function(){return o(Q(arguments))}}},14675:o=>{o.exports=function(o){return!(!o||"string"===typeof o)&&(o instanceof Array||Array.isArray(o)||o.length>=0&&(o.splice instanceof Function||Object.getOwnPropertyDescriptor(o,o.length-1)&&"String"!==o.constructor.name))}},13597:(o,v,V)=>{var g=V(13601);function E(o){for(var v,V,E=0,I=o.length,Q=0;Q<o.length;){for(v=o[Q],V=0;Q<I&&o[Q]===v;)++Q,++V;E+=g.log2(V)/7|0,E+=g.log2(v>>>0)/7|0,E+=2}return E}v.size=E,v.encode=function(o,v){v||(v=new Uint8Array(E(o)));for(var V,g,I=0,Q=v.length,U=0;U<o.length;){for(V=o[U],g=0;U<o.length&&o[U]===V;)++U,++g;for(;I<Q&&g>=128;)v[I++]=128+(127&g),g>>>=7;if(I>=Q)throw new Error("RLE buffer overflow");for(v[I++]=g,V>>>=0;I<Q&&V>=128;)v[I++]=128+(127&V),V>>>=7;if(I>=Q)throw new Error("RLE buffer overflow");v[I++]=V}return v},v.decode=function(o,v){for(var V,g,E,I,Q=v.length,U=o.length,n=0,O=0;O<U;){for(V=0,g=0;O<U&&o[O]>=128;)V+=(127&o[O++])<<g,g+=7;if(V+=o[O++]<<g,O>=U)throw new Error("RLE buffer underrun");if(n+V>Q)throw new Error("Chunk buffer overflow");for(E=0,g=0;O<U&&o[O]>=128;)E+=(127&o[O++])<<g,g+=7;if(O>=U)throw new Error("RLE buffer underrun");for(E+=o[O++]<<g,I=0;I<V;++I)v[n++]=E}return v}},13601:(o,v)=>{"use strict";function V(o){var v=32;return(o&=-o)&&v--,65535&o&&(v-=16),16711935&o&&(v-=8),252645135&o&&(v-=4),858993459&o&&(v-=2),1431655765&o&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(o){return(o>0)-(o<0)},v.abs=function(o){var v=o>>31;return(o^v)-v},v.min=function(o,v){return v^(o^v)&-(o<v)},v.max=function(o,v){return o^(o^v)&-(o<v)},v.isPow2=function(o){return!(o&o-1)&&!!o},v.log2=function(o){var v,V;return v=(o>65535)<<4,v|=V=((o>>>=v)>255)<<3,v|=V=((o>>>=V)>15)<<2,(v|=V=((o>>>=V)>3)<<1)|(o>>>=V)>>1},v.log10=function(o){return o>=1e9?9:o>=1e8?8:o>=1e7?7:o>=1e6?6:o>=1e5?5:o>=1e4?4:o>=1e3?3:o>=100?2:o>=10?1:0},v.popCount=function(o){return 16843009*((o=(858993459&(o-=o>>>1&1431655765))+(o>>>2&858993459))+(o>>>4)&252645135)>>>24},v.countTrailingZeros=V,v.nextPow2=function(o){return o+=0===o,--o,o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)+1},v.prevPow2=function(o){return o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)-(o>>>1)},v.parity=function(o){return o^=o>>>16,o^=o>>>8,o^=o>>>4,27030>>>(o&=15)&1};var g=new Array(256);!function(o){for(var v=0;v<256;++v){var V=v,g=v,E=7;for(V>>>=1;V;V>>>=1)g<<=1,g|=1&V,--E;o[v]=g<<E&255}}(g),v.reverse=function(o){return g[255&o]<<24|g[o>>>8&255]<<16|g[o>>>16&255]<<8|g[o>>>24&255]},v.interleave2=function(o,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(o,v){return(o=65535&((o=16711935&((o=252645135&((o=858993459&((o=o>>>v&1431655765)|o>>>1))|o>>>2))|o>>>4))|o>>>16))<<16>>16},v.interleave3=function(o,v,V){return o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2),(o|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2))<<2},v.deinterleave3=function(o,v){return(o=1023&((o=4278190335&((o=251719695&((o=3272356035&((o=o>>>v&1227133513)|o>>>2))|o>>>4))|o>>>8))|o>>>16))<<22>>22},v.nextCombination=function(o){var v=o|o-1;return v+1|(~v&-~v)-1>>>V(o)+1}},13629:o=>{"use strict";o.exports=function(o,v,V,g){var E=self||window;try{try{var I;try{I=new E.Blob([o])}catch(O){(I=new(E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder)).append(o),I=I.getBlob()}var Q=E.URL||E.webkitURL,U=Q.createObjectURL(I),n=new E[v](U,V);return Q.revokeObjectURL(U),n}catch(O){return new E[v]("data:application/javascript,".concat(encodeURIComponent(o)),V)}}catch(O){if(!g)throw Error("Inline worker is not supported");return new E[v](g,V)}}},13307:(o,v,V)=>{"use strict";function g(o,v,V,g,E){var I={};return Object.keys(g).forEach((function(o){I[o]=g[o]})),I.enumerable=!!I.enumerable,I.configurable=!!I.configurable,("value"in I||I.initializer)&&(I.writable=!0),I=V.slice().reverse().reduce((function(V,g){return g(o,v,V)||V}),I),E&&void 0!==I.initializer&&(I.value=I.initializer?I.initializer.call(E):void 0,I.initializer=void 0),void 0===I.initializer&&(Object.defineProperty(o,v,I),I=null),I}V.d(v,{c:()=>g})},13298:(o,v,V)=>{"use strict";function g(o,v,V,g){V&&Object.defineProperty(o,v,{enumerable:V.enumerable,configurable:V.configurable,writable:V.writable,value:V.initializer?V.initializer.call(g):void 0})}V.d(v,{d:()=>g})},14705:(o,v,V)=>{"use strict";V.d(v,{c:()=>Q,f:()=>x,j:()=>U,l:()=>I,n:()=>n,r:()=>E,v:()=>O,x:()=>h});var g=V(12719);class E{constructor(){this._easingMode=E.EASINGMODE_EASEIN}setEasingMode(o){const v=Math.min(Math.max(o,0),2);this._easingMode=v}getEasingMode(){return this._easingMode}easeInCore(o){throw new Error("You must implement this method")}ease(o){switch(this._easingMode){case E.EASINGMODE_EASEIN:return this.easeInCore(o);case E.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-o)}return o>=.5?.5*(1-this.easeInCore(2*(1-o)))+.5:.5*this.easeInCore(2*o)}}E.EASINGMODE_EASEIN=0,E.EASINGMODE_EASEOUT=1,E.EASINGMODE_EASEINOUT=2;class I extends E{easeInCore(o){return o=Math.max(0,Math.min(1,o)),1-Math.sqrt(1-o*o)}}class Q extends E{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=o}easeInCore(o){const v=Math.max(0,this.amplitude);return Math.pow(o,3)-o*v*Math.sin(3.141592653589793*o)}}class U extends E{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=o,this.bounciness=v}easeInCore(o){const v=Math.max(0,this.bounces);let V=this.bounciness;V<=1&&(V=1.001);const g=Math.pow(V,v),E=1-V,I=(1-g)/E+.5*g,Q=o*I,U=Math.log(-Q*(1-V)+1)/Math.log(V),n=Math.floor(U),O=n+1,h=(1-Math.pow(V,n))/(E*I),x=.5*(h+(1-Math.pow(V,O))/(E*I)),f=o-x,l=x-h;return-Math.pow(1/V,v-n)/(l*l)*(f-l)*(f+l)}}class n extends E{easeInCore(o){return o*o*o}}class O extends E{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=o,this.springiness=v}easeInCore(o){let v;const V=Math.max(0,this.oscillations),g=Math.max(0,this.springiness);return v=0==g?o:(Math.exp(g*o)-1)/(Math.exp(g)-1),v*Math.sin((6.283185307179586*V+1.5707963267948966)*o)}}class h extends E{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=o}easeInCore(o){return this.exponent<=0?o:(Math.exp(this.exponent*o)-1)/(Math.exp(this.exponent)-1)}}class x extends E{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=o,this.y1=v,this.x2=V,this.y2=g}easeInCore(o){return g.e.Interpolate(o,this.x1,this.y1,this.x2,this.y2)}}},14170:(o,v,V)=>{"use strict";V.d(v,{e:()=>Q});var g=V(12488),E=V(12503),I=V(12932);class Q extends I.c{get _matrix(){return this._compose(),this.hl}set _matrix(o){(o.updateFlag!==this.hl.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.hl.U(o),this._markAsDirtyAndDecompose())}constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(o,v.Fo(),!1),this.name=o,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=v,this.hl=(null===E||void 0===E?void 0:E.clone())??g.Matrix.Identity(),this._restMatrix=I??this.hl.clone(),this._bindMatrix=Q??this.hl.clone(),this._index=U,this._absoluteMatrix=new g.Matrix,this._absoluteBindMatrix=new g.Matrix,this._absoluteInverseBindMatrix=new g.Matrix,this._finalMatrix=new g.Matrix,v.bones.push(this),this.setParent(V,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(o){this.setParent(o)}setParent(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==o){if(this.parent){const o=this.parent.children.indexOf(this);-1!==o&&this.parent.children.splice(o,1)}this._parentNode=o,this.parent&&this.parent.children.push(this),v&&this._updateAbsoluteBindMatrices(),this.eO()}}getLocalMatrix(){return this._compose(),this.hl}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(o){this._restMatrix.U(o)}setRestPose(o){this.setRestMatrix(o)}getBindPose(){return this.getBindMatrix()}setBindMatrix(o){this.Bg(o)}setBindPose(o){this.setBindMatrix(o)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const o=g.TmpVectors.cv[0],v=g.TmpVectors.Quaternion[0],V=g.TmpVectors.cv[1];this.getRestMatrix().decompose(o,v,V),this._linkedTransformNode.position.U(V),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??g.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.U(v),this._linkedTransformNode.jU.U(o)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(o){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=o,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ZU}set position(o){this._decompose(),this.ZU.U(o),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(o){this.setRotation(o)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(o){this.setRotationQuaternion(o)}get jU(){return this.getScale()}set jU(o){this.setScale(o)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=g.cv.Zero(),this._localRotation=g.Quaternion.Zero(),this.ZU=g.cv.Zero()),this.hl.decompose(this._localScaling,this._localRotation,this.ZU))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,g.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.ZU,this.hl)):this._needToCompose=!1)}Bg(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.U(o),v&&this._updateAbsoluteBindMatrices(),V?this._matrix=o:this.eO()}_updateAbsoluteBindMatrices(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(o||(o=this._bindMatrix),this.parent?o.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.U(o),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),v)for(let V=0;V<this.children.length;V++)this.children[V]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}eO(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.eO(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.eO(),this._needToDecompose=!0}_updatePosition(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const I=this.getLocalMatrix();if(0==v)E?(I.addAtIndex(12,o.x),I.addAtIndex(13,o.y),I.addAtIndex(14,o.z)):I.setTranslationFromFloats(o.x,o.y,o.z);else{let v=null;V&&(v=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const U=Q._TmpMats[0],n=Q._TmpVecs[0];this.parent?V&&v?(U.U(this.parent.getAbsoluteMatrix()),U.multiplyToRef(v,U)):U.U(this.parent.getAbsoluteMatrix()):g.Matrix.IdentityToRef(U),E&&U.setTranslationFromFloats(0,0,0),U.invert(),g.cv.TransformCoordinatesToRef(o,U,n),E?(I.addAtIndex(12,n.x),I.addAtIndex(13,n.y),I.addAtIndex(14,n.z)):I.setTranslationFromFloats(n.x,n.y,n.z)}this._markAsDirtyAndDecompose()}translate(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this._updatePosition(o,v,V,!0)}setPosition(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this._updatePosition(o,v,V,!1)}setAbsolutePosition(o,v){this.setPosition(o,1,v)}scale(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=this.getLocalMatrix(),U=Q._TmpMats[0];g.Matrix.ScalingToRef(o,v,V,U),U.multiplyToRef(I,I),U.invert();for(const g of this.children){const E=g.getLocalMatrix();E.multiplyToRef(U,E),E.multiplyAtIndex(12,o),E.multiplyAtIndex(13,v),E.multiplyAtIndex(14,V),g._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),E)for(const g of this.children)g.scale(o,v,V,E)}setScale(o){this._decompose(),this._localScaling.U(o),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(o){this._decompose(),o.U(this._localScaling)}setYawPitchRoll(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4?arguments[4]:void 0;if(0===E){const U=Q._TmpQuat;return g.Quaternion.RotationYawPitchRollToRef(o,v,V,U),void this.setRotationQuaternion(U,E,I)}const U=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,I))return;const n=Q._TmpMats[1];g.Matrix.RotationYawPitchRollToRef(o,v,V,n),U.multiplyToRef(n,n),this._rotateWithMatrix(n,E,I)}rotate(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;const I=Q._TmpMats[0];I.setTranslationFromFloats(0,0,0),g.Matrix.RotationAxisToRef(o,v,I),this._rotateWithMatrix(I,V,E)}setAxisAngle(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;if(0===V){const I=Q._TmpQuat;return g.Quaternion.RotationAxisToRef(o,v,I),void this.setRotationQuaternion(I,V,E)}const I=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,E))return;const U=Q._TmpMats[1];g.Matrix.RotationAxisToRef(o,v,U),I.multiplyToRef(U,U),this._rotateWithMatrix(U,V,E)}setRotation(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(o.y,o.x,o.z,v,V)}setRotationQuaternion(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;if(0===v)return this._decompose(),this._localRotation.U(o),void this._markAsDirtyAndCompose();const E=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,V))return;const I=Q._TmpMats[1];g.Matrix.FromQuaternionToRef(o,I),E.multiplyToRef(I,I),this._rotateWithMatrix(I,v,V)}setRotationMatrix(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;if(0===v){const E=Q._TmpQuat;return g.Quaternion.FromRotationMatrixToRef(o,E),void this.setRotationQuaternion(E,v,V)}const E=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,V))return;const I=Q._TmpMats[1];I.U(o),E.multiplyToRef(o,I),this._rotateWithMatrix(I,v,V)}_rotateWithMatrix(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;const g=this.getLocalMatrix(),E=g.m[12],I=g.m[13],U=g.m[14],n=this.getParent(),O=Q._TmpMats[3],h=Q._TmpMats[4];n&&1==v?(V?(O.U(V.getWorldMatrix()),n.getAbsoluteMatrix().multiplyToRef(O,O)):O.U(n.getAbsoluteMatrix()),h.U(O),h.invert(),g.multiplyToRef(O,g),g.multiplyToRef(o,g),g.multiplyToRef(h,g)):1==v&&V?(O.U(V.getWorldMatrix()),h.U(O),h.invert(),g.multiplyToRef(O,g),g.multiplyToRef(o,g),g.multiplyToRef(h,g)):g.multiplyToRef(o,g),g.setTranslationFromFloats(E,I,U),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(o,v){const V=Q._TmpMats[2];return o.U(this.getAbsoluteMatrix()),v?(o.multiplyToRef(v.getWorldMatrix(),o),g.Matrix.ScalingToRef(v.jU.x,v.jU.y,v.jU.z,V)):g.Matrix.IdentityToRef(V),o.invert(),!isNaN(o.m[0])&&(V.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyToRef(V,o),!0)}mg(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=g.cv.Zero();return this.getPositionToRef(o,v,V),V}getPositionToRef(){let o=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const o=this.getLocalMatrix();v.x=o.m[12],v.y=o.m[13],v.z=o.m[14]}else{let V=null;o&&(V=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let g=Q._TmpMats[0];o&&V?(g.U(this.getAbsoluteMatrix()),g.multiplyToRef(V,g)):g=this.getAbsoluteMatrix(),v.x=g.m[12],v.y=g.m[13],v.z=g.m[14]}}getAbsolutePosition(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=g.cv.Zero();return this.getPositionToRef(1,o,v),v}getAbsolutePositionToRef(o,v){this.getPositionToRef(1,o,v)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.hl.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.U(this.hl);const o=this._skeleton.getPoseMatrix();o&&this._absoluteMatrix.multiplyToRef(o,this._absoluteMatrix)}const o=this.children,v=o.length;for(let V=0;V<v;V++)o[V].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}jn(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=g.cv.Zero();return this.getDirectionToRef(o,v,V),V}getDirectionToRef(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,E=null;v&&(E=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=Q._TmpMats[0];I.U(this.getAbsoluteMatrix()),v&&E&&I.multiplyToRef(E,I),g.cv.TransformNormalToRef(o,I,V),V.normalize()}getRotation(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=g.cv.Zero();return this.getRotationToRef(o,v,V),V}getRotationToRef(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;const g=Q._TmpQuat;this.getRotationQuaternionToRef(o,v,g),g.toEulerAnglesToRef(V)}getRotationQuaternion(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=g.Quaternion.Identity();return this.getRotationQuaternionToRef(o,v,V),V}getRotationQuaternionToRef(){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),v.U(this._localRotation);else{const V=Q._TmpMats[0],g=this.getAbsoluteMatrix();o?g.multiplyToRef(o.getWorldMatrix(),V):V.U(g),V.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyAtIndex(1,this._scalingDeterminant),V.multiplyAtIndex(2,this._scalingDeterminant),V.decompose(void 0,v,void 0)}}getRotationMatrix(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1?arguments[1]:void 0;const V=g.Matrix.Identity();return this.getRotationMatrixToRef(o,v,V),V}getRotationMatrixToRef(){let o=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(v);else{const V=Q._TmpMats[0],g=this.getAbsoluteMatrix();o?g.multiplyToRef(o.getWorldMatrix(),V):V.U(g),V.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyAtIndex(1,this._scalingDeterminant),V.multiplyAtIndex(2,this._scalingDeterminant),V.getRotationMatrixToRef(v)}}getAbsolutePositionFromLocal(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=g.cv.Zero();return this.getAbsolutePositionFromLocalToRef(o,v,V),V}getAbsolutePositionFromLocalToRef(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,E=null;v&&(E=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=Q._TmpMats[0];I.U(this.getAbsoluteMatrix()),v&&E&&I.multiplyToRef(E,I),g.cv.TransformCoordinatesToRef(o,I,V)}getLocalPositionFromAbsolute(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=g.cv.Zero();return this.getLocalPositionFromAbsoluteToRef(o,v,V),V}getLocalPositionFromAbsoluteToRef(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,E=null;v&&(E=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=Q._TmpMats[0];I.U(this.getAbsoluteMatrix()),v&&E&&I.multiplyToRef(E,I),I.invert(),g.cv.TransformCoordinatesToRef(o,I,V)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const o=this._skeleton.bones.indexOf(this);if(-1!==o&&this._skeleton.bones.splice(o,1),this._parentNode&&this._parentNode.children){const o=this._parentNode.children,v=o.indexOf(this);-1!==v&&o.splice(v,1)}super.dispose()}}Q._TmpVecs=(0,E.b)(2,g.cv.Zero),Q._TmpQuat=g.Quaternion.Identity(),Q._TmpMats=(0,E.b)(5,g.Matrix.Identity)},14699:(o,v,V)=>{"use strict";V.d(v,{d:()=>q});var g=V(12473),E=V(12479),I=V(12297),Q=V(12488),U=V(12511),n=V(12932),O=V(12958),h=V(12780),x=V(12321),f=V(12497);class l{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(o){this._zoomStopsAnimation=o}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(o){this._idleRotationSpeed=o}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(o){this._idleRotationWaitTime=o}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(o){this._idleRotationSpinupTime=o}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(o){this._attachedCamera=o;const v=this._attachedCamera.Fo();this._onPrePointerObservableObserver=v.onPrePointerObservable.add((o=>{o.type!==h.e.POINTERDOWN?o.type===h.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=o.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const o=x.e.Now;let v=0;null!=this._lastFrameTime&&(v=o-this._lastFrameTime),this._lastFrameTime=o,this._applyUserInteraction();const V=o-this._lastInteractionTime-this._idleRotationWaitTime,g=Math.max(Math.min(V/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*g,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(v/1e3))}))}detach(){if(!this._attachedCamera)return;const o=this._attachedCamera.Fo();this._onPrePointerObservableObserver&&o.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(o){this._lastInteractionTime=o??x.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<f.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let o=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(o=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?o:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=x.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var S=V(14705),T=V(13035);class c{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(o){if(this._autoTransitionRange===o)return;this._autoTransitionRange=o;const v=this._attachedCamera;v&&(o?this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((o=>{if(o&&(o.Ag(!0),o.getBoundingInfo)){const v=o.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*v,this.upperRadiusTransitionRange=.05*v}})):this._onMeshTargetChangedObserver&&v.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(o){this._attachedCamera=o,this._onAfterCheckInputsObserver=o.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(o){return!!this._attachedCamera&&(this._attachedCamera.radius===o&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(o){if(!this._attachedCamera)return;this._radiusBounceTransition||(c.EasingFunction.setEasingMode(c.EasingMode),this._radiusBounceTransition=T.b.CreateAnimation("radius",T.b.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const v=T.b.TransitionTo("radius",this._attachedCamera.radius+o,this._attachedCamera,this._attachedCamera.Fo(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));v&&this._animatables.push(v)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}c.EasingFunction=new S.c(.3),c.EasingMode=S.r.EASINGMODE_EASEOUT;class R{constructor(){this.onTargetFramingAnimationEndObservable=new I.e,this._mode=R.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(o){this._mode=o}get mode(){return this._mode}set radiusScale(o){this._radiusScale=o}get radiusScale(){return this._radiusScale}set positionScale(o){this._positionScale=o}get positionScale(){return this._positionScale}set defaultElevation(o){this._defaultElevation=o}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(o){this._elevationReturnTime=o}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(o){this._elevationReturnWaitTime=o}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(o){this._zoomStopsAnimation=o}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(o){this._framingTime=o}get framingTime(){return this._framingTime}init(){}attach(o){this._attachedCamera=o;const v=this._attachedCamera.Fo();R.EasingFunction.setEasingMode(R.EasingMode),this._onPrePointerObservableObserver=v.onPrePointerObservable.add((o=>{o.type!==h.e.POINTERDOWN?o.type===h.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=o.onMeshTargetChangedObservable.add((o=>{o&&o.getBoundingInfo&&this.zoomOnMesh(o,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=o.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const o=this._attachedCamera.Fo();this._onPrePointerObservableObserver&&o.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o.Ag(!0);const g=o.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(g.minimumWorld,g.maximumWorld,v,V)}zoomOnMeshHierarchy(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o.Ag(!0);const g=o.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(g.min,g.max,v,V)}zoomOnMeshesHierarchy(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new Q.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new Q.cv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let I=0;I<o.length;I++){const v=o[I].getHierarchyBoundingVectors(!0);Q.cv.CheckExtends(v.min,g,E),Q.cv.CheckExtends(v.max,g,E)}this.zoomOnBoundingInfo(g,E,v,V)}zoomOnBoundingInfo(o,v){let V,g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const I=o.y,U=I+(v.y-I)*this._positionScale,n=v.Rv(o).scale(.5);if(!isFinite(U))return!1;if(g)V=new Q.cv(0,U,0);else{const v=o.add(n);V=new Q.cv(v.x,U,v.z)}this._vectorTransition||(this._vectorTransition=T.b.CreateAnimation("target",T.b.ANIMATIONTYPE_VECTOR3,60,R.EasingFunction)),this._betaIsAnimating=!0;let O=T.b.TransitionTo("target",V,this._attachedCamera,this._attachedCamera.Fo(),60,this._vectorTransition,this._framingTime);O&&this._animatables.push(O);let h=0;if(this._mode===R.FitFrustumSidesMode){const V=this._calculateLowerRadiusFromModelBoundingSphere(o,v);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=n.length()+this._attachedCamera.Xg),h=V}else this._mode===R.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(o,v),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Xg));if(this.autoCorrectCameraLimitsAndSensibility){const V=v.Rv(o).length();this._attachedCamera.panningSensibility=5e3/V,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=T.b.CreateAnimation("radius",T.b.ANIMATIONTYPE_FLOAT,60,R.EasingFunction)),O=T.b.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.Fo(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),E&&E(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),O&&this._animatables.push(O),!0}_calculateLowerRadiusFromModelBoundingSphere(o,v){const V=this._attachedCamera;if(!V)return 0;let g=V._calculateLowerRadiusFromModelBoundingSphere(o,v,this._radiusScale);return V.lowerRadiusLimit&&this._mode===R.IgnoreBoundsSizeMode&&(g=g<V.lowerRadiusLimit?V.lowerRadiusLimit:g),V.upperRadiusLimit&&(g=g>V.upperRadiusLimit?V.upperRadiusLimit:g),g}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const o=x.e.Now-this._lastInteractionTime,v=.5*Math.PI-this._defaultElevation,V=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>V&&o>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=T.b.CreateAnimation("beta",T.b.ANIMATIONTYPE_FLOAT,60,R.EasingFunction));const o=T.b.TransitionTo("beta",v,this._attachedCamera,this._attachedCamera.Fo(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));o&&this._animatables.push(o)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=x.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}R.EasingFunction=new S.x,R.EasingMode=S.r.EASINGMODE_EASEINOUT,R.IgnoreBoundsSizeMode=0,R.FitFrustumSidesMode=1;var j=V(12967),t=V(13005),s=V(14166),L=V(12291);class b{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(o){o=L.Tools.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),V=v.getInputElement();let g=0,E=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=I=>{var Q,U;const n=I.event,O="touch"===n.pointerType;if(I.type!==h.e.POINTERMOVE&&-1===this.buttons.indexOf(n.button))return;const x=n.target;if(this._altKey=n.altKey,this._ctrlKey=n.ctrlKey,this._metaKey=n.metaKey,this._shiftKey=n.shiftKey,this._buttonsPressed=n.buttons,v.isPointerLock){const o=n.movementX,v=n.movementY;this.onTouch(null,o,v),this._pointA=null,this._pointB=null}else{if(I.type!==h.e.POINTERDOWN&&I.type!==h.e.POINTERDOUBLETAP&&O&&(null===(Q=this._pointA)||void 0===Q?void 0:Q.pointerId)!==n.pointerId&&(null===(U=this._pointB)||void 0===U?void 0:U.pointerId)!==n.pointerId)return;if(I.type!==h.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!O)if(I.type===h.e.POINTERDOUBLETAP)this.onDoubleTap(n.pointerType);else if(I.type!==h.e.POINTERUP||this._currentMousePointerIdDown!==n.pointerId&&!O){if(I.type===h.e.POINTERMOVE)if(o||n.preventDefault(),this._pointA&&null===this._pointB){const o=n.clientX-this._pointA.x,v=n.clientY-this._pointA.y;this._pointA.x=n.clientX,this._pointA.y=n.clientY,this.onTouch(this._pointA,o,v)}else if(this._pointA&&this._pointB){const o=this._pointA.pointerId===n.pointerId?this._pointA:this._pointB;o.x=n.clientX,o.y=n.clientY;const v=this._pointA.x-this._pointB.x,V=this._pointA.y-this._pointB.y,Q=v*v+V*V,U={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:n.pointerId,type:I.type};this.onMultiTouch(this._pointA,this._pointB,g,Q,E,U),E=U,g=Q}}else{try{null===x||void 0===x||x.releasePointerCapture(n.pointerId)}catch(f){}O||(this._pointB=null),v._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==n.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==n.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==g||E)&&(this.onMultiTouch(this._pointA,this._pointB,g,0,E,null),g=0,E=null),this._currentMousePointerIdDown=-1,this.onButtonUp(n),o||n.preventDefault()}else{try{null===x||void 0===x||x.setPointerCapture(n.pointerId)}catch(f){}if(null===this._pointA)this._pointA={x:n.clientX,y:n.clientY,pointerId:n.pointerId,type:n.pointerType};else{if(null!==this._pointB)return;this._pointB={x:n.clientX,y:n.clientY,pointerId:n.pointerId,type:n.pointerType}}-1!==this._currentMousePointerIdDown||O||(this._currentMousePointerIdDown=n.pointerId),this.onButtonDown(n),o||(n.preventDefault(),V&&V.focus())}}},this._observer=this.camera.Fo()._inputManager._addCameraPointerObserver(this._pointerInput,h.e.POINTERDOWN|h.e.POINTERUP|h.e.POINTERMOVE|h.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,g=0,E=null,this.onLostFocus()},this._contextMenuBind=o=>this.onContextMenu(o),V&&V.addEventListener("contextmenu",this._contextMenuBind,!1);const I=this.camera.Fo().getEngine().getHostWindow();I&&L.Tools.RegisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}Qf(){if(this._onLostFocus){const o=this.camera.Fo().getEngine().getHostWindow();o&&L.Tools.UnregisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Fo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const o=this.camera.Fo().getEngine().getInputElement();o&&o.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(o){}onTouch(o,v,V){}onMultiTouch(o,v,V,g,E,I){}onContextMenu(o){o.preventDefault()}onButtonDown(o){}onButtonUp(o){}onLostFocus(){}}(0,g.c)([(0,E.K)()],b.prototype,"buttons",void 0);class u extends b{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(o,v){if(0!==this.panningSensibility&&o&&v){const V=v.x-o.x,g=v.y-o.y;this.camera.inertialPanningX+=-V/this.panningSensibility,this.camera.inertialPanningY+=g/this.panningSensibility}}_computePinchZoom(o,v){const V=this.camera.radius||u.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=V*Math.sqrt(o)/Math.sqrt(v):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(v-o)*V*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(v-o)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(o,v,V){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=V/this.panningSensibility):(this.camera.inertialAlphaOffset-=v/this.angularSensibilityX,this.camera.inertialBetaOffset-=V/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(o,v,V,g,E,I){0===V&&null===E||0===g&&null===I||(this.multiTouchPanAndZoom?(this._computePinchZoom(V,g),this._computeMultiTouchPanning(E,I)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(g)-Math.sqrt(V))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(V,g),this._isPinching=!0):this._computeMultiTouchPanning(E,I)):this.multiTouchPanning?this._computeMultiTouchPanning(E,I):this.pinchZoom&&this._computePinchZoom(V,g))}onButtonDown(o){this._isPanClick=o.button===this.camera._panningMouseButton}onButtonUp(o){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}u.MinimumRadiusForPinch=.001,(0,g.c)([(0,E.K)()],u.prototype,"buttons",void 0),(0,g.c)([(0,E.K)()],u.prototype,"angularSensibilityX",void 0),(0,g.c)([(0,E.K)()],u.prototype,"angularSensibilityY",void 0),(0,g.c)([(0,E.K)()],u.prototype,"pinchPrecision",void 0),(0,g.c)([(0,E.K)()],u.prototype,"pinchDeltaPercentage",void 0),(0,g.c)([(0,E.K)()],u.prototype,"useNaturalPinchZoom",void 0),(0,g.c)([(0,E.K)()],u.prototype,"pinchZoom",void 0),(0,g.c)([(0,E.K)()],u.prototype,"panningSensibility",void 0),(0,g.c)([(0,E.K)()],u.prototype,"multiTouchPanning",void 0),(0,g.c)([(0,E.K)()],u.prototype,"multiTouchPanAndZoom",void 0),s.e.ArcRotateCameraPointersInput=u;var mo=V(12782);class a{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(o){o=L.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Fo(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const V=v.event;if(!V.metaKey)if(v.type===mo.e.KEYDOWN){if(this._ctrlPressed=V.ctrlKey,this._altPressed=V.altKey,-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysReset.indexOf(V.keyCode)){-1===this._keys.indexOf(V.keyCode)&&this._keys.push(V.keyCode),V.preventDefault&&(o||V.preventDefault())}}else if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysReset.indexOf(V.keyCode)){const v=this._keys.indexOf(V.keyCode);v>=0&&this._keys.splice(v,1),V.preventDefault&&(o||V.preventDefault())}})))}Qf(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const o=this.camera;for(let v=0;v<this._keys.length;v++){const V=this._keys[v];-1!==this.keysLeft.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningX-=1/this.panningSensibility:o.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?o.inertialRadiusOffset+=1/this.zoomingSensibility:o.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningX+=1/this.panningSensibility:o.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(V)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?o.inertialRadiusOffset-=1/this.zoomingSensibility:o.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(V)&&o.useInputToRestoreState&&o.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,g.c)([(0,E.K)()],a.prototype,"keysUp",void 0),(0,g.c)([(0,E.K)()],a.prototype,"keysDown",void 0),(0,g.c)([(0,E.K)()],a.prototype,"keysLeft",void 0),(0,g.c)([(0,E.K)()],a.prototype,"keysRight",void 0),(0,g.c)([(0,E.K)()],a.prototype,"keysReset",void 0),(0,g.c)([(0,E.K)()],a.prototype,"panningSensibility",void 0),(0,g.c)([(0,E.K)()],a.prototype,"zoomingSensibility",void 0),(0,g.c)([(0,E.K)()],a.prototype,"useAltToZoom",void 0),(0,g.c)([(0,E.K)()],a.prototype,"angularSpeed",void 0),s.e.ArcRotateCameraKeyboardMoveInput=a;var F=V(12556),i=V(12784);class J{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Q.cv(0,0,0),this._globalOffset=new Q.cv(0,0,0),this._inertialPanning=Q.cv.Zero()}_computeDeltaFromMouseWheelLegacyEvent(o,v){let V=0;const g=.01*o*this.wheelDeltaPercentage*v;return V=o>0?g/(1+this.wheelDeltaPercentage):g*(1+this.wheelDeltaPercentage),V}attachControl(o){o=L.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==h.e.POINTERWHEEL)return;const V=v.event;let g=0;const E=V.deltaMode===i.b.DOM_DELTA_LINE?40:1,I=-V.deltaY*E;if(this.customComputeDeltaFromMouseWheel)g=this.customComputeDeltaFromMouseWheel(I,this,V);else if(this.wheelDeltaPercentage){if(g=this._computeDeltaFromMouseWheelLegacyEvent(I,this.camera.radius),g>0){let o=this.camera.radius,v=this.camera.inertialRadiusOffset+g;for(let V=0;V<20&&!(o<=v)&&!(Math.abs(v*this.camera.inertia)<.001);V++)o-=v,v*=this.camera.inertia;o=(0,U.Clamp)(o,0,Number.MAX_VALUE),g=this._computeDeltaFromMouseWheelLegacyEvent(I,o)}}else g=I/(40*this.wheelPrecision);g&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(g)):this.camera.inertialRadiusOffset+=g),V.preventDefault&&(o||V.preventDefault())},this._observer=this.camera.Fo()._inputManager._addCameraPointerObserver(this._wheel,h.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.tU(0)}Qf(){this._observer&&(this.camera.Fo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const o=this.camera;0+o.inertialAlphaOffset+o.inertialBetaOffset+o.inertialRadiusOffset&&(this._updateHitPlane(),o.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(o.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const o=this.camera,v=o.target.Rv(o.position);this._hitPlane=F.c.FromPositionAndNormal(o.target,v)}_getPosition(){const o=this.camera,v=o.Fo(),V=v.createPickingRay(v.pointerX,v.pointerY,Q.Matrix.Identity(),o,!1);0===o.targetScreenOffset.x&&0===o.targetScreenOffset.y||(this._viewOffset.set(o.targetScreenOffset.x,o.targetScreenOffset.y,0),o.getViewMatrix().invertToRef(o._cameraTransformMatrix),this._globalOffset=Q.cv.TransformNormal(this._viewOffset,o._cameraTransformMatrix),V.origin.addInPlace(this._globalOffset));let g=0;return this._hitPlane&&(g=V.intersectsPlane(this._hitPlane)??0),V.origin.addInPlace(V.direction.scaleInPlace(g))}_zoomToMouse(o){const v=this.camera,V=1-v.inertia;if(v.lowerRadiusLimit){const g=v.lowerRadiusLimit??0;v.radius-(v.inertialRadiusOffset+o)/V<g&&(o=(v.radius-g)*V-v.inertialRadiusOffset)}if(v.upperRadiusLimit){const g=v.upperRadiusLimit??0;v.radius-(v.inertialRadiusOffset+o)/V>g&&(o=(v.radius-g)*V-v.inertialRadiusOffset)}const g=o/V/v.radius,E=this._getPosition(),I=Q.TmpVectors.cv[6];E.subtractToRef(v.target,I),I.scaleInPlace(g),I.scaleInPlace(V),this._inertialPanning.addInPlace(I),v.inertialRadiusOffset+=o}_zeroIfClose(o){Math.abs(o.x)<f.d&&(o.x=0),Math.abs(o.y)<f.d&&(o.y=0),Math.abs(o.z)<f.d&&(o.z=0)}}(0,g.c)([(0,E.K)()],J.prototype,"wheelPrecision",void 0),(0,g.c)([(0,E.K)()],J.prototype,"zoomToMouseLocation",void 0),(0,g.c)([(0,E.K)()],J.prototype,"wheelDeltaPercentage",void 0),s.e.ArcRotateCameraMouseWheelInput=J;class d extends s.f{constructor(o){super(o)}addMouseWheel(){return this.add(new J),this}addPointers(){return this.add(new u),this}addKeyboard(){return this.add(new a),this}}var N=V(12449);function Y(o,v){return isNaN(o)?v:o}n.c.AddNodeConstructor("ArcRotateCamera",((o,v)=>()=>new q(o,0,0,1,Q.cv.Zero(),v)));class q extends t.c{get target(){return this._target}set target(o){this.setTarget(o)}get targetHost(){return this._targetHost}set targetHost(o){o&&this.setTarget(o)}getTarget(){return this.target}get position(){return this._position}set position(o){this.setPosition(o)}set upVector(o){this._upToYMatrix||(this._yToUpMatrix=new Q.Matrix,this._upToYMatrix=new Q.Matrix,this._upVector=Q.cv.Zero()),o.normalize(),this._upVector.U(o),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Q.Matrix.RotationAlignToRef(Q.cv.UpReadOnly,this._upVector,this._yToUpMatrix),Q.Matrix.RotationAlignToRef(this._upVector,Q.cv.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const o=this.inputs.attached.pointers;return o?o.angularSensibilityX:0}set angularSensibilityX(o){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityX=o)}get angularSensibilityY(){const o=this.inputs.attached.pointers;return o?o.angularSensibilityY:0}set angularSensibilityY(o){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityY=o)}get pinchPrecision(){const o=this.inputs.attached.pointers;return o?o.pinchPrecision:0}set pinchPrecision(o){const v=this.inputs.attached.pointers;v&&(v.pinchPrecision=o)}get pinchDeltaPercentage(){const o=this.inputs.attached.pointers;return o?o.pinchDeltaPercentage:0}set pinchDeltaPercentage(o){const v=this.inputs.attached.pointers;v&&(v.pinchDeltaPercentage=o)}get useNaturalPinchZoom(){const o=this.inputs.attached.pointers;return!!o&&o.useNaturalPinchZoom}set useNaturalPinchZoom(o){const v=this.inputs.attached.pointers;v&&(v.useNaturalPinchZoom=o)}get panningSensibility(){const o=this.inputs.attached.pointers;return o?o.panningSensibility:0}set panningSensibility(o){const v=this.inputs.attached.pointers;v&&(v.panningSensibility=o)}get keysUp(){const o=this.inputs.attached.keyboard;return o?o.keysUp:[]}set keysUp(o){const v=this.inputs.attached.keyboard;v&&(v.keysUp=o)}get keysDown(){const o=this.inputs.attached.keyboard;return o?o.keysDown:[]}set keysDown(o){const v=this.inputs.attached.keyboard;v&&(v.keysDown=o)}get keysLeft(){const o=this.inputs.attached.keyboard;return o?o.keysLeft:[]}set keysLeft(o){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=o)}get keysRight(){const o=this.inputs.attached.keyboard;return o?o.keysRight:[]}set keysRight(o){const v=this.inputs.attached.keyboard;v&&(v.keysRight=o)}get wheelPrecision(){const o=this.inputs.attached.mousewheel;return o?o.wheelPrecision:0}set wheelPrecision(o){const v=this.inputs.attached.mousewheel;v&&(v.wheelPrecision=o)}get zoomToMouseLocation(){const o=this.inputs.attached.mousewheel;return!!o&&o.zoomToMouseLocation}set zoomToMouseLocation(o){const v=this.inputs.attached.mousewheel;v&&(v.zoomToMouseLocation=o)}get wheelDeltaPercentage(){const o=this.inputs.attached.mousewheel;return o?o.wheelDeltaPercentage:0}set wheelDeltaPercentage(o){const v=this.inputs.attached.mousewheel;v&&(v.wheelDeltaPercentage=o)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(o){o!==this.useBouncingBehavior&&(o?(this._bouncingBehavior=new c,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(o){o!==this.useFramingBehavior&&(o?(this._framingBehavior=new R,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(o){o!==this.useAutoRotationBehavior&&(o?(this._autoRotationBehavior=new l,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(o,v,V,g,E,U){var n;let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(o,Q.cv.Zero(),U,O),n=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Q.cv.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Q.Matrix,this.panningAxis=new Q.cv(1,1,0),this._transformedDirection=new Q.cv,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new I.e,this.checkCollisions=!1,this.collisionRadius=new Q.cv(.5,.5,.5),this._previousPosition=Q.cv.Zero(),this._collisionVelocity=Q.cv.Zero(),this._newPosition=Q.cv.Zero(),this._computationVector=Q.cv.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Q.cv(NaN,NaN,NaN),this._goalTargetScreenOffset=new Q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V?(n.setPosition(v),n.ES&&n.ES(V)):n._previousPosition.U(n._position);const g=Math.cos(n.alpha),E=Math.sin(n.alpha),I=Math.cos(n.beta);let Q=Math.sin(n.beta);0===Q&&(Q=1e-4);const U=n._getTargetPosition();n._computationVector.RU(n.radius*g*Q,n.radius*I,n.radius*E*Q),U.addToRef(n._computationVector,n._newPosition),n._position.U(n._newPosition);let O=n.upVector;n.allowUpsideDown&&n.beta<0&&(O=O.clone(),O=O.negate()),n._computeViewMatrix(n._position,U,O),n._viewMatrix.addAtIndex(12,n.targetScreenOffset.x),n._viewMatrix.addAtIndex(13,n.targetScreenOffset.y),n._collisionTriggered=!1},this._target=Q.cv.Zero(),E&&this.setTarget(E),this.alpha=v,this.beta=V,this.radius=g,this.getViewMatrix(),this.inputs=new d(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Q.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Q.Vector2.Zero()}_updateCache(o){o||super._updateCache(),this._cache._target.U(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.U(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const o=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?o.addToRef(this._targetBoundingCenter,this._target):this._target.U(o)}const o=this._getLockedTargetPosition();return o||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>f.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,I=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=I?this._currentInterpolationFactor=I:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=Y(o,this._goalAlpha),this._goalBeta=Y(v,this._goalBeta),this._goalRadius=Y(V,this._goalRadius),this._goalTarget.set(Y(g.x,this._goalTarget.x),Y(g.y,this._goalTarget.y),Y(g.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(Y(E.x,this._goalTargetScreenOffset.x),Y(E.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,U.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,U.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,U.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,U.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const E=arguments;v=L.Tools.BackCompatCameraNoPreventDefault(E),this._useCtrlForPanning=V,this._panningMouseButton=g,"boolean"===typeof E[0]&&(E.length>1&&(this._useCtrlForPanning=E[1]),E.length>2&&(this._panningMouseButton=E[2])),this.inputs.attachElement(v),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Qf(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let o=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){o=!0;const v=this.invertRotation?-1:1,V=this._calculateHandednessMultiplier();let g=this.inertialAlphaOffset*V;this.beta<0&&(g*=-1),this.alpha+=g*v,this.beta+=this.inertialBetaOffset*v,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<f.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<f.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*f.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){o=!0;const v=new Q.cv(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),v.multiplyInPlace(this.panningAxis),Q.cv.TransformNormalToRef(v,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const o=this.upVector,v=Q.cv.CrossToRef(this._transformedDirection,o,this._transformedDirection);Q.cv.CrossToRef(o,v,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Q.cv.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.U(this._transformedDirection)}else{if(this.parent){const o=Q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(o),o.transposeToRef(o),Q.cv.TransformCoordinatesToRef(this._transformedDirection,o,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*f.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*f.d&&(this.inertialPanningY=0)}if(o)this.stopInterpolation();else if(this._isInterpolating){let o=!1;const v=this._scene.getEngine().getDeltaTime()/1e3,V=1-Math.pow(2,-v/this._currentInterpolationFactor),g=Y(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const v=Q.TmpVectors.cv[0].set(Y(this._goalTarget.x,this._target.x),Y(this._goalTarget.y,this._target.y),Y(this._goalTarget.z,this._target.z));Q.cv.LerpToRef(this.target,v,V,this._target),10*Q.cv.Distance(this.target,v)/g<f.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.U(v),this.setTarget(this.target,!1,!0,!0)):o=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const v=Q.Quaternion.RotationAlphaBetaGammaToRef(Y(this._goalAlpha,this.alpha),Y(this._goalBeta,this.beta),0,Q.TmpVectors.Quaternion[0]),g=Q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Q.TmpVectors.Quaternion[1]),E=Q.Quaternion.SlerpToRef(g,v,V,Q.TmpVectors.Quaternion[2]);E.normalize();const I=E.toAlphaBetaGammaToRef(Q.TmpVectors.cv[0]);if(this.alpha=I.x,this.beta=I.y,E.isApprox(v,f.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const o=v.toAlphaBetaGammaToRef(Q.TmpVectors.cv[0]);this.alpha=o.x,this.beta=o.y}else o=!0}if(isNaN(this._goalRadius)||(this.radius+=(g-this.radius)*V,Math.abs(g/this.radius-1)<f.d?(this._goalRadius=NaN,this.radius=g):o=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const v=Q.TmpVectors.Vector2[0].set(Y(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),Y(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Q.Vector2.LerpToRef(this.targetScreenOffset,v,V,this.targetScreenOffset),Q.Vector2.Distance(this.targetScreenOffset,v)<f.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.U(v)):o=!0}this._isInterpolating=o}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Q.cv.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const o=this.alpha;var v,V;this.alpha=function(o){let v=Math.PI/2;return 0===o.x&&0===o.z||(v=Math.acos(o.x/Math.sqrt(Math.pow(o.x,2)+Math.pow(o.z,2)))),o.z<0&&(v=2*Math.PI-v),v}(this._computationVector),this.beta=(v=this._computationVector.y,V=this.radius,Math.acos(v/V));const g=Math.round((o-this.alpha)/(2*Math.PI));this.alpha+=2*g*Math.PI,this._checkLimits()}setPosition(o){this._position.equals(o)||(this._position.U(o),this.rebuildAnglesAndRadius())}setTarget(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(g=this.overrideCloneAlphaBetaRadius??g,o.Ag)v&&o.getBoundingInfo?this._targetBoundingCenter=o.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,o.Ag(),this._targetHost=o,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const v=o,g=this._getTargetPosition();if(g&&!V&&g.equals(v))return;this._targetHost=null,this._target=v,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}g||this.rebuildAnglesAndRadius()}_getViewMatrix(){const o=Math.cos(this.alpha),v=Math.sin(this.alpha),V=Math.cos(this.beta);let g=Math.sin(this.beta);0===g&&(g=1e-4),0===this.radius&&(this.radius=1e-4);const E=this._getTargetPosition();if(this._computationVector.RU(this.radius*o*g,this.radius*V,this.radius*v*g),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Q.cv.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),E.addToRef(this._computationVector,this._newPosition),this.Fo().collisionsEnabled&&this.checkCollisions){const o=this.Fo().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,o.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.U(this._newPosition);let o=this.upVector;this.allowUpsideDown&&g<0&&(o=o.negate()),this._computeViewMatrix(this._position,E,o),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.U(E),this._viewMatrix}zoomOn(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o=o||this.Fo().meshes;const V=O.e.MinMax(o);let g=this._calculateLowerRadiusFromModelBoundingSphere(V.min,V.max);if(g=Math.max(Math.min(g,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=g*this.zoomOnFactor,this.mode===j.e.ORTHOGRAPHIC_CAMERA){const o=this.Fo().getEngine().getAspectRatio(this),v=g*this.zoomOnFactor/2;this.orthoLeft=-v*o,this.orthoRight=v*o,this.orthoBottom=-v,this.orthoTop=v}this.focusOn({min:V.min,max:V.max,distance:g},v)}focusOn(o){let v,V,g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===o.min){const g=o||this.Fo().meshes;v=O.e.MinMax(g),V=Q.cv.Distance(v.min,v.max)}else{v=o,V=o.distance}this._target=O.e.Center(v),g||(this.maxZ=2*V)}createRigCamera(o,v){let V=0;switch(this.cameraRigMode){case j.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case j.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case j.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case j.e.RIG_MODE_VR:V=this._cameraRigParams.stereoHalfAngle*(0===v?1:-1);break;case j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V=this._cameraRigParams.stereoHalfAngle*(0===v?-1:1)}const g=new q(o,this.alpha+V,this.beta,this.radius,this._target,this.Fo());return g._cameraRigParams={},g.isRigCamera=!0,g.rigParent=this,g.upVector=this.upVector,g.mode=this.mode,g.orthoLeft=this.orthoLeft,g.orthoRight=this.orthoRight,g.orthoBottom=this.orthoBottom,g.orthoTop=this.orthoTop,g}_updateRigCameras(){const o=this._rigCameras[0],v=this._rigCameras[1];switch(o.beta=v.beta=this.beta,this.cameraRigMode){case j.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case j.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case j.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case j.e.RIG_MODE_VR:o.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const g=Q.cv.Distance(o,v),E=this.Fo().getEngine().getAspectRatio(this),I=Math.tan(this.fov/2),U=I*E,n=.5*g*V,O=n*Math.sqrt(1+1/(U*U)),h=n*Math.sqrt(1+1/(I*I));return Math.max(O,h)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,g.c)([(0,E.K)()],q.prototype,"alpha",void 0),(0,g.c)([(0,E.K)()],q.prototype,"beta",void 0),(0,g.c)([(0,E.K)()],q.prototype,"radius",void 0),(0,g.c)([(0,E.K)()],q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,g.c)([(0,E.G)("target")],q.prototype,"_target",void 0),(0,g.c)([(0,E.y)("targetHost")],q.prototype,"_targetHost",void 0),(0,g.c)([(0,E.K)()],q.prototype,"inertialAlphaOffset",void 0),(0,g.c)([(0,E.K)()],q.prototype,"inertialBetaOffset",void 0),(0,g.c)([(0,E.K)()],q.prototype,"inertialRadiusOffset",void 0),(0,g.c)([(0,E.K)()],q.prototype,"lowerAlphaLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"upperAlphaLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"lowerBetaLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"upperBetaLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"lowerRadiusLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"upperRadiusLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"lowerTargetYLimit",void 0),(0,g.c)([(0,E.K)()],q.prototype,"inertialPanningX",void 0),(0,g.c)([(0,E.K)()],q.prototype,"inertialPanningY",void 0),(0,g.c)([(0,E.K)()],q.prototype,"pinchToPanMaxDistance",void 0),(0,g.c)([(0,E.K)()],q.prototype,"panningDistanceLimit",void 0),(0,g.c)([(0,E.G)()],q.prototype,"panningOriginTarget",void 0),(0,g.c)([(0,E.K)()],q.prototype,"panningInertia",void 0),(0,g.c)([(0,E.K)()],q.prototype,"zoomToMouseLocation",null),(0,g.c)([(0,E.K)()],q.prototype,"zoomOnFactor",void 0),(0,g.c)([(0,E.E)()],q.prototype,"targetScreenOffset",void 0),(0,g.c)([(0,E.K)()],q.prototype,"allowUpsideDown",void 0),(0,g.c)([(0,E.K)()],q.prototype,"useInputToRestoreState",void 0),(0,g.c)([(0,E.K)()],q.prototype,"restoreStateInterpolationFactor",void 0),(0,N.h)("BABYLON.ArcRotateCamera",q)},14166:(o,v,V)=>{"use strict";V.d(v,{e:()=>Q,f:()=>U});var g=V(12308),E=V(12535),I=V(12967),Q={};class U{constructor(o){this.attachedToElement=!1,this.attached={},this.camera=o,this.checkInputs=()=>{}}add(o){const v=o.getSimpleName();this.attached[v]?g.b.Warn("camera input of type "+v+" already exists on camera"):(this.attached[v]=o,o.camera=this.camera,o.checkInputs&&(this.checkInputs=this._addCheckInputs(o.checkInputs.bind(o))),this.attachedToElement&&o.attachControl(this.noPreventDefault))}remove(o){for(const v in this.attached){const V=this.attached[v];if(V===o)return V.Qf(),V.camera=null,delete this.attached[v],void this.rebuildInputCheck()}}removeByType(o){for(const v in this.attached){const V=this.attached[v];V.getClassName()===o&&(V.Qf(),V.camera=null,delete this.attached[v],this.rebuildInputCheck())}}_addCheckInputs(o){const v=this.checkInputs;return()=>{v(),o()}}attachInput(o){this.attachedToElement&&o.attachControl(this.noPreventDefault)}attachElement(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){o=!I.e.ForceAttachControlToAlwaysPreventDefault&&o,this.attachedToElement=!0,this.noPreventDefault=o;for(const v in this.attached)this.attached[v].attachControl(o)}}detachElement(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const v in this.attached)this.attached[v].Qf(),o&&(this.attached[v].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const o in this.attached){const v=this.attached[o];v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(o){const v={};for(const V in this.attached){const o=this.attached[V],g=E.c.Serialize(o);v[o.getClassName()]=g}o.inputsmgr=v}parse(o){const v=o.inputsmgr;if(v){this.clear();for(const o in v){const V=Q[o];if(V){const g=v[o],I=E.c.Parse((()=>new V),g,null);this.add(I)}}}else for(const V in this.attached){const v=Q[this.attached[V].getClassName()];if(v){const g=E.c.Parse((()=>new v),o,null);this.remove(this.attached[V]),this.add(g)}}}}},14162:(o,v,V)=>{"use strict";V.d(v,{d:()=>b});var g=V(12473),E=V(12479),I=V(12488),Q=V(13005),U=V(14166),n=V(12782),O=V(12291);class h{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(o){o=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Fo(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const V=v.event;if(!V.metaKey)if(v.type===n.e.KEYDOWN){if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysUpward.indexOf(V.keyCode)||-1!==this.keysDownward.indexOf(V.keyCode)||-1!==this.keysRotateLeft.indexOf(V.keyCode)||-1!==this.keysRotateRight.indexOf(V.keyCode)||-1!==this.keysRotateUp.indexOf(V.keyCode)||-1!==this.keysRotateDown.indexOf(V.keyCode)){-1===this._keys.indexOf(V.keyCode)&&this._keys.push(V.keyCode),o||V.preventDefault()}}else if(-1!==this.keysUp.indexOf(V.keyCode)||-1!==this.keysDown.indexOf(V.keyCode)||-1!==this.keysLeft.indexOf(V.keyCode)||-1!==this.keysRight.indexOf(V.keyCode)||-1!==this.keysUpward.indexOf(V.keyCode)||-1!==this.keysDownward.indexOf(V.keyCode)||-1!==this.keysRotateLeft.indexOf(V.keyCode)||-1!==this.keysRotateRight.indexOf(V.keyCode)||-1!==this.keysRotateUp.indexOf(V.keyCode)||-1!==this.keysRotateDown.indexOf(V.keyCode)){const v=this._keys.indexOf(V.keyCode);v>=0&&this._keys.splice(v,1),o||V.preventDefault()}})))}Qf(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const o=this.camera;for(let v=0;v<this._keys.length;v++){const V=this._keys[v],g=o._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(V)?o._localDirection.RU(-g,0,0):-1!==this.keysUp.indexOf(V)?o._localDirection.RU(0,0,g):-1!==this.keysRight.indexOf(V)?o._localDirection.RU(g,0,0):-1!==this.keysDown.indexOf(V)?o._localDirection.RU(0,0,-g):-1!==this.keysUpward.indexOf(V)?o._localDirection.RU(0,g,0):-1!==this.keysDownward.indexOf(V)?o._localDirection.RU(0,-g,0):-1!==this.keysRotateLeft.indexOf(V)?(o._localDirection.RU(0,0,0),o.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(V)?(o._localDirection.RU(0,0,0),o.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(V)?(o._localDirection.RU(0,0,0),o.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(V)&&(o._localDirection.RU(0,0,0),o.cameraRotation.x+=this._getLocalRotation()),o.Fo().useRightHandedSystem&&(o._localDirection.z*=-1),o.getViewMatrix().invertToRef(o._cameraTransformMatrix),I.cv.TransformNormalToRef(o._localDirection,o._cameraTransformMatrix,o._transformedDirection),o.cameraDirection.addInPlace(o._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const o=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*o}}(0,g.c)([(0,E.K)()],h.prototype,"keysUp",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysUpward",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysDown",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysDownward",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysLeft",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysRight",void 0),(0,g.c)([(0,E.K)()],h.prototype,"rotationSpeed",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysRotateLeft",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysRotateRight",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysRotateUp",void 0),(0,g.c)([(0,E.K)()],h.prototype,"keysRotateDown",void 0),U.e.FreeCameraKeyboardMoveInput=h;var x=V(12297),f=V(12780);class l{constructor(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=o,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new x.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(o){o=O.Tools.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),V=v.getInputElement();this._pointerInput||(this._pointerInput=g=>{const E=g.event,I="touch"===E.pointerType;if(!this.touchEnabled&&I)return;if(g.type!==f.e.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const Q=E.target;if(g.type===f.e.POINTERDOWN){if(I&&-1!==this._activePointerId||!I&&-1!==this._currentActiveButton)return;this._activePointerId=E.pointerId;try{null===Q||void 0===Q||Q.setPointerCapture(E.pointerId)}catch(U){}-1===this._currentActiveButton&&(this._currentActiveButton=E.button),this._previousPosition={x:E.clientX,y:E.clientY},o||(E.preventDefault(),V&&V.focus()),v.isPointerLock&&this._onMouseMove&&this._onMouseMove(g.event)}else if(g.type===f.e.POINTERUP){if(I&&this._activePointerId!==E.pointerId||!I&&this._currentActiveButton!==E.button)return;try{null===Q||void 0===Q||Q.releasePointerCapture(E.pointerId)}catch(U){}this._currentActiveButton=-1,this._previousPosition=null,o||E.preventDefault(),this._activePointerId=-1}else if(g.type===f.e.POINTERMOVE&&(this._activePointerId===E.pointerId||!I))if(v.isPointerLock&&this._onMouseMove)this._onMouseMove(g.event);else if(this._previousPosition){const v=this.camera._calculateHandednessMultiplier(),V=(E.clientX-this._previousPosition.x)*v,g=E.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=V/this.angularSensibility,this.camera.cameraRotation.x+=g/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:V,offsetY:g}),this._previousPosition={x:E.clientX,y:E.clientY},o||E.preventDefault()}}),this._onMouseMove=V=>{if(!v.isPointerLock)return;const g=this.camera._calculateHandednessMultiplier(),E=V.movementX*g;this.camera.cameraRotation.y+=E/this.angularSensibility;const I=V.movementY;this.camera.cameraRotation.x+=I/this.angularSensibility,this._previousPosition=null,o||V.preventDefault()},this._observer=this.camera.Fo()._inputManager._addCameraPointerObserver(this._pointerInput,f.e.POINTERDOWN|f.e.POINTERUP|f.e.POINTERMOVE),V&&(this._contextMenuBind=o=>this.onContextMenu(o),V.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(o){o.preventDefault()}Qf(){if(this._observer){if(this.camera.Fo()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const o=this.camera.getEngine().getInputElement();o&&o.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,g.c)([(0,E.K)()],l.prototype,"buttons",void 0),(0,g.c)([(0,E.K)()],l.prototype,"angularSensibility",void 0),U.e.FreeCameraMouseInput=l;var S,T=V(12784);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new x.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(o){o=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==f.e.POINTERWHEEL)return;const V=v.event,g=V.deltaMode===T.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*g*V.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*g*V.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*g*V.deltaZ/this._normalize,V.preventDefault&&(o||V.preventDefault())},this._observer=this.camera.Fo()._inputManager._addCameraPointerObserver(this._wheel,f.e.POINTERWHEEL)}Qf(){this._observer&&(this.camera.Fo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,g.c)([(0,E.K)()],c.prototype,"wheelPrecisionX",void 0),(0,g.c)([(0,E.K)()],c.prototype,"wheelPrecisionY",void 0),(0,g.c)([(0,E.K)()],c.prototype,"wheelPrecisionZ",void 0),function(o){o[o.MoveRelative=0]="MoveRelative",o[o.RotateRelative=1]="RotateRelative",o[o.MoveScene=2]="MoveScene"}(S||(S={}));class R extends c{constructor(){super(...arguments),this._moveRelative=I.cv.Zero(),this._rotateRelative=I.cv.Zero(),this._moveScene=I.cv.Zero(),this._wheelXAction=S.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=S.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(o){null===o&&this._wheelXAction!==S.MoveRelative||(this._wheelXAction=S.MoveRelative,this._wheelXActionCoordinate=o)}get wheelXMoveRelative(){return this._wheelXAction!==S.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(o){null===o&&this._wheelYAction!==S.MoveRelative||(this._wheelYAction=S.MoveRelative,this._wheelYActionCoordinate=o)}get wheelYMoveRelative(){return this._wheelYAction!==S.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(o){null===o&&this._wheelZAction!==S.MoveRelative||(this._wheelZAction=S.MoveRelative,this._wheelZActionCoordinate=o)}get wheelZMoveRelative(){return this._wheelZAction!==S.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(o){null===o&&this._wheelXAction!==S.RotateRelative||(this._wheelXAction=S.RotateRelative,this._wheelXActionCoordinate=o)}get wheelXRotateRelative(){return this._wheelXAction!==S.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(o){null===o&&this._wheelYAction!==S.RotateRelative||(this._wheelYAction=S.RotateRelative,this._wheelYActionCoordinate=o)}get wheelYRotateRelative(){return this._wheelYAction!==S.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(o){null===o&&this._wheelZAction!==S.RotateRelative||(this._wheelZAction=S.RotateRelative,this._wheelZActionCoordinate=o)}get wheelZRotateRelative(){return this._wheelZAction!==S.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(o){null===o&&this._wheelXAction!==S.MoveScene||(this._wheelXAction=S.MoveScene,this._wheelXActionCoordinate=o)}get wheelXMoveScene(){return this._wheelXAction!==S.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(o){null===o&&this._wheelYAction!==S.MoveScene||(this._wheelYAction=S.MoveScene,this._wheelYActionCoordinate=o)}get wheelYMoveScene(){return this._wheelYAction!==S.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(o){null===o&&this._wheelZAction!==S.MoveScene||(this._wheelZAction=S.MoveScene,this._wheelZActionCoordinate=o)}get wheelZMoveScene(){return this._wheelZAction!==S.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.tU(0),this._rotateRelative.tU(0),this._moveScene.tU(0),this._updateCamera(),this.camera.Fo().useRightHandedSystem&&(this._moveRelative.z*=-1);const o=I.Matrix.Zero();this.camera.getViewMatrix().invertToRef(o);const v=I.cv.Zero();I.cv.TransformNormalToRef(this._moveRelative,o,v),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(v),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(o,v,V){if(0===o)return;if(null===v||null===V)return;let g=null;switch(v){case S.MoveRelative:g=this._moveRelative;break;case S.RotateRelative:g=this._rotateRelative;break;case S.MoveScene:g=this._moveScene}switch(V){case 0:g.set(o,0,0);break;case 1:g.set(0,o,0);break;case 2:g.set(0,0,o)}}}(0,g.c)([(0,E.K)()],R.prototype,"wheelXMoveRelative",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelYMoveRelative",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelZMoveRelative",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelXRotateRelative",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelYRotateRelative",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelZRotateRelative",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelXMoveScene",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelYMoveScene",null),(0,g.c)([(0,E.K)()],R.prototype,"wheelZMoveScene",null),U.e.FreeCameraMouseWheelInput=R;class j{constructor(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=o,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=O.Tools.IsSafari()}attachControl(o){o=O.Tools.BackCompatCameraNoPreventDefault(arguments);let v=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=V=>{const g=V.event,E="mouse"===g.pointerType||this._isSafari&&"undefined"===typeof g.pointerType;if(this.allowMouse||!E)if(V.type===f.e.POINTERDOWN){if(o||g.preventDefault(),this._pointerPressed.push(g.pointerId),1!==this._pointerPressed.length)return;v={x:g.clientX,y:g.clientY}}else if(V.type===f.e.POINTERUP){o||g.preventDefault();const V=this._pointerPressed.indexOf(g.pointerId);if(-1===V)return;if(this._pointerPressed.splice(V,1),0!=V)return;v=null,this._offsetX=null,this._offsetY=null}else if(V.type===f.e.POINTERMOVE){if(o||g.preventDefault(),!v)return;if(0!=this._pointerPressed.indexOf(g.pointerId))return;this._offsetX=g.clientX-v.x,this._offsetY=-(g.clientY-v.y)}}),this._observer=this.camera.Fo()._inputManager._addCameraPointerObserver(this._pointerInput,f.e.POINTERDOWN|f.e.POINTERUP|f.e.POINTERMOVE),this._onLostFocus){const o=this.camera.getEngine().getInputElement();o&&o.addEventListener("blur",this._onLostFocus)}}Qf(){if(this._pointerInput){if(this._observer&&(this.camera.Fo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const o=this.camera.getEngine().getInputElement();o&&o.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const o=this.camera,v=o._calculateHandednessMultiplier();o.cameraRotation.y=v*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)o.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const v=o._computeLocalCameraSpeed(),V=new I.cv(0,0,0!==this.touchMoveSensibility?v*this._offsetY/this.touchMoveSensibility:0);I.Matrix.RotationYawPitchRollToRef(o.rotation.y,o.rotation.x,0,o._cameraRotationMatrix),o.cameraDirection.addInPlace(I.cv.TransformCoordinates(V,o._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,g.c)([(0,E.K)()],j.prototype,"touchAngularSensibility",void 0),(0,g.c)([(0,E.K)()],j.prototype,"touchMoveSensibility",void 0),U.e.FreeCameraTouchInput=j;class t extends U.f{constructor(o){super(o),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new h),this}addMouse(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new l(o),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new R,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new j),this}clear(){super.clear(),this._mouseInput=null}}var s=V(12449),L=V(12381);class b extends Q.c{get angularSensibility(){const o=this.inputs.attached.mouse;return o?o.angularSensibility:0}set angularSensibility(o){const v=this.inputs.attached.mouse;v&&(v.angularSensibility=o)}get keysUp(){const o=this.inputs.attached.keyboard;return o?o.keysUp:[]}set keysUp(o){const v=this.inputs.attached.keyboard;v&&(v.keysUp=o)}get keysUpward(){const o=this.inputs.attached.keyboard;return o?o.keysUpward:[]}set keysUpward(o){const v=this.inputs.attached.keyboard;v&&(v.keysUpward=o)}get keysDown(){const o=this.inputs.attached.keyboard;return o?o.keysDown:[]}set keysDown(o){const v=this.inputs.attached.keyboard;v&&(v.keysDown=o)}get keysDownward(){const o=this.inputs.attached.keyboard;return o?o.keysDownward:[]}set keysDownward(o){const v=this.inputs.attached.keyboard;v&&(v.keysDownward=o)}get keysLeft(){const o=this.inputs.attached.keyboard;return o?o.keysLeft:[]}set keysLeft(o){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=o)}get keysRight(){const o=this.inputs.attached.keyboard;return o?o.keysRight:[]}set keysRight(o){const v=this.inputs.attached.keyboard;v&&(v.keysRight=o)}get keysRotateLeft(){const o=this.inputs.attached.keyboard;return o?o.keysRotateLeft:[]}set keysRotateLeft(o){const v=this.inputs.attached.keyboard;v&&(v.keysRotateLeft=o)}get keysRotateRight(){const o=this.inputs.attached.keyboard;return o?o.keysRotateRight:[]}set keysRotateRight(o){const v=this.inputs.attached.keyboard;v&&(v.keysRotateRight=o)}get keysRotateUp(){const o=this.inputs.attached.keyboard;return o?o.keysRotateUp:[]}set keysRotateUp(o){const v=this.inputs.attached.keyboard;v&&(v.keysRotateUp=o)}get keysRotateDown(){const o=this.inputs.attached.keyboard;return o?o.keysRotateDown:[]}set keysRotateDown(o){const v=this.inputs.attached.keyboard;v&&(v.keysRotateDown=o)}constructor(o,v,V){var g;super(o,v,V,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),g=this,this.ellipsoid=new I.cv(.5,1,.5),this.ellipsoidOffset=new I.cv(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=I.cv.Zero(),this._diffPosition=I.cv.Zero(),this._newPosition=I.cv.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g._newPosition.U(v),g._newPosition.subtractToRef(g._oldPosition,g._diffPosition),g._diffPosition.length()>L.c.CollisionsEpsilon&&(g.position.addToRef(g._diffPosition,g._deferredPositionUpdate),g._deferOnly?g._deferredUpdated=!0:g.position.U(g._deferredPositionUpdate),g.ES&&V&&g.ES(V))},this.inputs=new t(this),this.inputs.addKeyboard().addMouse()}attachControl(o,v){v=O.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(v)}Qf(){this.inputs.detachElement(),this.cameraDirection=new I.cv(0,0,0),this.cameraRotation=new I.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(o){this._collisionMask=isNaN(o)?-1:o}_collideWithWorld(o){let v;v=this.parent?I.cv.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,v.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const V=this.Fo().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let g=o;this.applyGravity&&(g=o.add(this.Fo().gravity)),V.getNewPosition(this._oldPosition,g,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=I.cv.Zero(),this._transformedDirection=I.cv.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(o){this._needMoveForGravity=o}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Fo().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"nh"}}(0,g.c)([(0,E.G)()],b.prototype,"ellipsoid",void 0),(0,g.c)([(0,E.G)()],b.prototype,"ellipsoidOffset",void 0),(0,g.c)([(0,E.K)()],b.prototype,"checkCollisions",void 0),(0,g.c)([(0,E.K)()],b.prototype,"applyGravity",void 0),(0,s.h)("BABYLON.FreeCamera",b)},14752:(o,v,V)=>{"use strict";V.d(v,{c:()=>I});var g=V(12593),E=V(14761);class I{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=V,this.Rx=[],this._maxBlockCapacity=v||64,this._selectionContent=new g.c(1024),this._creationFunc=o}update(o,v,V){E.e._CreateBlocks(o,v,V,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Vh(o){for(let v=0;v<this.bh.length;v++){this.bh[v].addEntry(o)}}oh(o){for(let v=0;v<this.bh.length;v++){this.bh[v].removeEntry(o)}}select(o,v){this._selectionContent.reset();for(let V=0;V<this.bh.length;V++){this.bh[V].select(o,this._selectionContent,v)}return v?this._selectionContent.concat(this.Rx):this._selectionContent.concatWithNoDuplicate(this.Rx),this._selectionContent}intersects(o,v,V){this._selectionContent.reset();for(let g=0;g<this.bh.length;g++){this.bh[g].intersects(o,v,this._selectionContent,V)}return V?this._selectionContent.concat(this.Rx):this._selectionContent.concatWithNoDuplicate(this.Rx),this._selectionContent}intersectsRay(o){this._selectionContent.reset();for(let v=0;v<this.bh.length;v++){this.bh[v].intersectsRay(o,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Rx),this._selectionContent}}I.CreationFuncForMeshes=(o,v)=>{const V=o.getBoundingInfo();!o.isBlocked&&V.boundingBox.intersectsMinMax(v.bx,v.ux)&&v.entries.push(o)},I.CreationFuncForSubMeshes=(o,v)=>{o.getBoundingInfo().boundingBox.intersectsMinMax(v.bx,v.ux)&&v.entries.push(o)}},14761:(o,v,V)=>{"use strict";V.d(v,{e:()=>I});var g=V(12488),E=V(12858);class I{constructor(o,v,V,g,E,I){this.entries=[],this.mf=new Array,this._capacity=V,this._depth=g,this._maxDepth=E,this._creationFunc=I,this._minPoint=o,this._maxPoint=v,this.mf.push(o.clone()),this.mf.push(v.clone()),this.mf.push(o.clone()),this.mf[2].x=v.x,this.mf.push(o.clone()),this.mf[3].y=v.y,this.mf.push(o.clone()),this.mf[4].z=v.z,this.mf.push(v.clone()),this.mf[5].z=o.z,this.mf.push(v.clone()),this.mf[6].x=o.x,this.mf.push(v.clone()),this.mf[7].y=o.y}get yv(){return this._capacity}get bx(){return this._minPoint}get ux(){return this._maxPoint}addEntry(o){if(this.bh)for(let v=0;v<this.bh.length;v++){this.bh[v].addEntry(o)}else this._creationFunc(o,this),this.entries.length>this.yv&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(o){if(this.bh){for(let v=0;v<this.bh.length;v++){this.bh[v].removeEntry(o)}return}const v=this.entries.indexOf(o);v>-1&&this.entries.splice(v,1)}addEntries(o){for(let v=0;v<o.length;v++){const V=o[v];this.addEntry(V)}}select(o,v,V){if(E.d.IsInFrustum(this.mf,o)){if(this.bh){for(let g=0;g<this.bh.length;g++){this.bh[g].select(o,v,V)}return}V?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}}intersects(o,v,V,g){if(E.d.IntersectsSphere(this._minPoint,this._maxPoint,o,v)){if(this.bh){for(let E=0;E<this.bh.length;E++){this.bh[E].intersects(o,v,V,g)}return}g?V.concat(this.entries):V.concatWithNoDuplicate(this.entries)}}intersectsRay(o,v){if(o.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.bh){for(let V=0;V<this.bh.length;V++){this.bh[V].intersectsRay(o,v)}return}v.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){I._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(o,v,V,E,Q,U,n,O){n.bh=new Array;const h=new g.cv((v.x-o.x)/2,(v.y-o.y)/2,(v.z-o.z)/2);for(let g=0;g<2;g++)for(let v=0;v<2;v++)for(let x=0;x<2;x++){const f=o.add(h.multiplyByFloats(g,v,x)),l=o.add(h.multiplyByFloats(g+1,v+1,x+1)),S=new I(f,l,E,Q+1,U,O);S.addEntries(V),n.bh.push(S)}}}},14763:(o,v,V)=>{"use strict";V.d(v,{e:()=>h});var g=V(12747),E=V(12488),I=V(12936),Q=V(13941),U=V(12776),n=V(14752),O=V(12339);g.b.prototype.createOrUpdateSelectionOctree=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,V=this._getComponent(U.d.NAME_OCTREE);V||(V=new h(this),this.Ig(V)),this.Sx||(this.Sx=new n.c(n.c.CreationFuncForMeshes,o,v));const g=this.getWorldExtends();return this.Sx.update(g.min,g.max,this.meshes),this.Sx},Object.defineProperty(g.b.prototype,"selectionOctree",{get:function(){return this.Sx},enumerable:!0,configurable:!0}),I.d.prototype.createOrUpdateSubmeshesOctree=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const V=this.Fo();let g=V._getComponent(U.d.NAME_OCTREE);g||(g=new h(V),V.Ig(g)),this._submeshesOctree||(this._submeshesOctree=new n.c(n.c.CreationFuncForSubMeshes,o,v)),this.Ag(!0);const E=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(E.minimumWorld,E.maximumWorld,this.wg),this._submeshesOctree};class h{constructor(o){this.name=U.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Q.c(E.cv.Zero(),new E.cv(1,1,1)),(o=o||O.d.LastCreatedScene)&&(this.jv=o,this.jv.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.jv.getActiveSubMeshCandidates=o=>this.getActiveSubMeshCandidates(o),this.jv.getCollidingSubMeshCandidates=(o,v)=>this.getCollidingSubMeshCandidates(o,v),this.jv.getIntersectingSubMeshCandidates=(o,v)=>this.getIntersectingSubMeshCandidates(o,v))}register(){this.jv.onMeshRemovedObservable.add((o=>{const v=this.jv.selectionOctree;if(void 0!==v&&null!==v){const V=v.Rx.indexOf(o);-1!==V&&v.Rx.splice(V,1)}})),this.jv.onMeshImportedObservable.add((o=>{const v=this.jv.selectionOctree;void 0!==v&&null!==v&&v.Vh(o)}))}getActiveMeshCandidates(){var o;return(null===(o=this.jv.Sx)||void 0===o?void 0:o.select(this.jv.frustumPlanes))||this.jv._getDefaultMeshCandidates()}getActiveSubMeshCandidates(o){if(o._submeshesOctree&&o.useOctreeForRenderingSelection){return o._submeshesOctree.select(this.jv.frustumPlanes)}return this.jv._getDefaultSubMeshCandidates(o)}getIntersectingSubMeshCandidates(o,v){if(o._submeshesOctree&&o.useOctreeForPicking){Q.c.TransformToRef(v,o.getWorldMatrix(),this._tempRay);return o._submeshesOctree.intersectsRay(this._tempRay)}return this.jv._getDefaultSubMeshCandidates(o)}getCollidingSubMeshCandidates(o,v){if(o._submeshesOctree&&o.useOctreeForCollisions){const V=v._velocityWorldLength+Math.max(v._radius.x,v._radius.y,v._radius.z);return o._submeshesOctree.intersects(v._basePointWorld,V)}return this.jv._getDefaultSubMeshCandidates(o)}rebuild(){}dispose(){}}},13941:(o,v,V)=>{"use strict";V.d(v,{c:()=>l});var g=V(12747),E=V(12967),I=V(12497),Q=V(12488),U=V(12503),n=V(12844),O=V(12774),h=V(12339),x=V(12792);const f={internalPickerForMesh:void 0};class l{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:I.d;this.origin=o,this.direction=v,this.length=V,this.epsilon=g}clone(){return new l(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const g=l._TmpVector3[0].RU(o.x-V,o.y-V,o.z-V),E=l._TmpVector3[1].RU(v.x+V,v.y+V,v.z+V);let I,Q,U,n,O=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<g.x||this.origin.x>E.x)return!1}else if(I=1/this.direction.x,Q=(g.x-this.origin.x)*I,U=(E.x-this.origin.x)*I,U===-1/0&&(U=1/0),Q>U&&(n=Q,Q=U,U=n),O=Math.max(Q,O),h=Math.min(U,h),O>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<g.y||this.origin.y>E.y)return!1}else if(I=1/this.direction.y,Q=(g.y-this.origin.y)*I,U=(E.y-this.origin.y)*I,U===-1/0&&(U=1/0),Q>U&&(n=Q,Q=U,U=n),O=Math.max(Q,O),h=Math.min(U,h),O>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<g.z||this.origin.z>E.z)return!1}else if(I=1/this.direction.z,Q=(g.z-this.origin.z)*I,U=(E.z-this.origin.z)*I,U===-1/0&&(U=1/0),Q>U&&(n=Q,Q=U,U=n),O=Math.max(Q,O),h=Math.min(U,h),O>h)return!1;return!0}intersectsBox(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(o.minimum,o.maximum,v)}intersectsSphere(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=o.center.x-this.origin.x,g=o.center.y-this.origin.y,E=o.center.z-this.origin.z,I=V*V+g*g+E*E,Q=o.radius+v,U=Q*Q;if(I<=U)return!0;const n=V*this.direction.x+g*this.direction.y+E*this.direction.z;if(n<0)return!1;return I-n*n<=U}intersectsTriangle(o,v,V){const g=l._TmpVector3[0],E=l._TmpVector3[1],I=l._TmpVector3[2],U=l._TmpVector3[3],O=l._TmpVector3[4];v.subtractToRef(o,g),V.subtractToRef(o,E),Q.cv.CrossToRef(this.direction,E,I);const h=Q.cv.Dot(g,I);if(0===h)return null;const x=1/h;this.origin.subtractToRef(o,U);const f=Q.cv.Dot(U,I)*x;if(f<-this.epsilon||f>1+this.epsilon)return null;Q.cv.CrossToRef(U,g,O);const S=Q.cv.Dot(this.direction,O)*x;if(S<-this.epsilon||f+S>1+this.epsilon)return null;const T=Q.cv.Dot(E,O)*x;return T>this.length?null:new n.b(1-f-S,f,T)}intersectsPlane(o){let v;const V=Q.cv.Dot(o.normal,this.direction);if(Math.abs(V)<9.99999997475243e-7)return null;{const g=Q.cv.Dot(o.normal,this.origin);return v=(-o.d-g)/V,v<0?v<-9.99999997475243e-7?null:0:v}}intersectsAxis(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(o){case"y":{const o=(this.origin.y-v)/this.direction.y;return o>0?null:new Q.cv(this.origin.x+this.direction.x*-o,v,this.origin.z+this.direction.z*-o)}case"x":{const o=(this.origin.x-v)/this.direction.x;return o>0?null:new Q.cv(v,this.origin.y+this.direction.y*-o,this.origin.z+this.direction.z*-o)}case"z":{const o=(this.origin.z-v)/this.direction.z;return o>0?null:new Q.cv(this.origin.x+this.direction.x*-o,this.origin.y+this.direction.y*-o,v)}default:return null}}intersectsMesh(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=Q.TmpVectors.Matrix[0];return o.getWorldMatrix().invertToRef(U),this._tmpRay?l.TransformToRef(this,U,this._tmpRay):this._tmpRay=l.Transform(this,U),o.intersects(this._tmpRay,v,V,g,E,I)}intersectsMeshes(o,v,V){V?V.length=0:V=[];for(let g=0;g<o.length;g++){const E=this.intersectsMesh(o[g],v);E.hit&&V.push(E)}return V.sort(this._comparePickingInfo),V}_comparePickingInfo(o,v){return o.distance<v.distance?-1:o.distance>v.distance?1:0}intersectionSegment(o,v,V){const g=this.origin,E=Q.TmpVectors.cv[0],I=Q.TmpVectors.cv[1],U=Q.TmpVectors.cv[2],n=Q.TmpVectors.cv[3];v.subtractToRef(o,E),this.direction.scaleToRef(l._Rayl,U),g.addToRef(U,I),o.subtractToRef(g,n);const O=Q.cv.Dot(E,E),h=Q.cv.Dot(E,U),x=Q.cv.Dot(U,U),f=Q.cv.Dot(E,n),S=Q.cv.Dot(U,n),T=O*x-h*h;let c,R,j=T,t=T;T<l._Smallnum?(c=0,j=1,R=S,t=x):(c=h*S-x*f,R=O*S-h*f,c<0?(c=0,R=S,t=x):c>j&&(c=j,R=S+h,t=x)),R<0?(R=0,-f<0?c=0:-f>O?c=j:(c=-f,j=O)):R>t&&(R=t,-f+h<0?c=0:-f+h>O?c=j:(c=-f+h,j=O));const s=Math.abs(c)<l._Smallnum?0:c/j,L=Math.abs(R)<l._Smallnum?0:R/t,b=Q.TmpVectors.cv[4];U.scaleToRef(L,b);const u=Q.TmpVectors.cv[5];E.scaleToRef(s,u),u.addInPlace(n);const mo=Q.TmpVectors.cv[6];u.subtractToRef(b,mo);return L>0&&L<=this.length&&mo.lengthSquared()<V*V?u.length():-1}update(o,v,V,g,E,I,U){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){l._RayDistant||(l._RayDistant=l.Zero()),l._RayDistant.unprojectRayToRef(o,v,V,g,Q.Matrix.IdentityReadOnly,I,U);const n=Q.TmpVectors.Matrix[0];E.invertToRef(n),l.TransformToRef(l._RayDistant,n,this)}else this.unprojectRayToRef(o,v,V,g,E,I,U);return this}static Zero(){return new l(Q.cv.Zero(),Q.cv.Zero())}static CreateNew(o,v,V,g,E,I,Q){return l.Zero().update(o,v,V,g,E,I,Q)}static CreateNewFromTo(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.Matrix.IdentityReadOnly;const g=new l(new Q.cv(0,0,0),new Q.cv(0,0,0));return l.CreateFromToToRef(o,v,g,V)}static CreateFromToToRef(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.Matrix.IdentityReadOnly;V.origin.U(o);const E=v.subtractToRef(o,V.direction),I=Math.sqrt(E.x*E.x+E.y*E.y+E.z*E.z);return V.length=I,V.direction.normalize(),l.TransformToRef(V,g,V)}static Transform(o,v){const V=new l(new Q.cv(0,0,0),new Q.cv(0,0,0));return l.TransformToRef(o,v,V),V}static TransformToRef(o,v,V){Q.cv.TransformCoordinatesToRef(o.origin,v,V.origin),Q.cv.TransformNormalToRef(o.direction,v,V.direction),V.length=o.length,V.epsilon=o.epsilon;const g=V.direction,E=g.length();if(0!==E&&1!==E){const o=1/E;g.x*=o,g.y*=o,g.z*=o,V.length*=E}return V}unprojectRayToRef(o,v,V,g,E,I,U){const n=Q.TmpVectors.Matrix[0];E.multiplyToRef(I,n),n.multiplyToRef(U,n),n.invert();const O=h.d.LastCreatedEngine,x=Q.TmpVectors.cv[0];x.x=o/V*2-1,x.y=-(v/g*2-1),x.z=null!==O&&void 0!==O&&O.Ug?1:null!==O&&void 0!==O&&O.isNDCHalfZRange?0:-1;const f=Q.TmpVectors.cv[1].RU(x.x,x.y,1-1e-8),l=Q.TmpVectors.cv[2],S=Q.TmpVectors.cv[3];Q.cv._UnprojectFromInvertedMatrixToRef(x,n,l),Q.cv._UnprojectFromInvertedMatrixToRef(f,n,S),this.origin.U(l),S.subtractToRef(l,this.direction),this.direction.normalize()}}function S(o,v,V,g,E){let I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=l.Zero();return T(o,v,V,g,Q,E,I),Q}function T(o,v,V,g,E,I){let U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const O=o.getEngine();if(!I&&!(I=o.activeCamera))return o;const h=I.viewport,x=O.getRenderHeight(),{x:f,y:l,width:S,height:T}=h.toGlobal(O.getRenderWidth(),x),c=1/O.getHardwareScalingLevel();return v=v*c-f,V=V*c-(x-l-T),E.update(v,V,S,T,g||Q.Matrix.IdentityReadOnly,U?Q.Matrix.IdentityReadOnly:I.getViewMatrix(),I.getProjectionMatrix(),n),o}function c(o,v,V,g,E){if(!O.e)return o;const I=o.getEngine();if(!E&&!(E=o.activeCamera))throw new Error("Active camera not set");const U=E.viewport,n=I.getRenderHeight(),{x:h,y:x,width:f,height:l}=U.toGlobal(I.getRenderWidth(),n),S=Q.Matrix.Identity(),T=1/I.getHardwareScalingLevel();return v=v*T-h,V=V*T-(n-x-l),g.update(v,V,f,l,S,S,E.getProjectionMatrix()),o}function R(o,v,V,g,E,I,Q,U){const n=v(g,V.enableDistantPicking),O=V.intersects(n,E,Q,I,g,U);return O&&O.hit?!E&&null!=o&&O.distance>=o.distance?null:O:null}function j(o,v,V,g,E,I){let U=null;const n=!!(o.activeCameras&&o.activeCameras.length>1&&o.cameraToUseForPointers!==o.activeCamera),h=o.cameraToUseForPointers||o.activeCamera,x=f.internalPickerForMesh||R;for(let O=0;O<o.meshes.length;O++){const f=o.meshes[O];if(V){if(!V(f,-1))continue}else if(!f.isEnabled()||!f.isVisible||!f.wn)continue;const l=n&&f.isWorldMatrixCameraDependent(),S=f.Ag(l,h);if(f.hasThinInstances&&f.cO){const o=x(U,v,f,S,!0,!0,I);if(o){if(E)return o;const n=Q.TmpVectors.Matrix[1],O=f.thinInstanceGetWorldMatrices();for(let o=0;o<O.length;o++){if(V&&!V(f,o))continue;O[o].multiplyToRef(S,n);const Q=x(U,v,f,n,g,E,I,!0);if(Q&&(U=Q,U.thinInstanceIndex=o,g))return U}}}else{const o=x(U,v,f,S,g,E,I);if(o&&(U=o,g))return U}}return U||new O.e}function t(o,v,V,g){if(!O.e)return null;const E=[],I=!!(o.activeCameras&&o.activeCameras.length>1&&o.cameraToUseForPointers!==o.activeCamera),U=o.cameraToUseForPointers||o.activeCamera,n=f.internalPickerForMesh||R;for(let O=0;O<o.meshes.length;O++){const h=o.meshes[O];if(V){if(!V(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.wn)continue;const x=I&&h.isWorldMatrixCameraDependent(),f=h.Ag(x,U);if(h.hasThinInstances&&h.cO){if(n(null,v,h,f,!0,!0,g)){const o=Q.TmpVectors.Matrix[1],I=h.thinInstanceGetWorldMatrices();for(let Q=0;Q<I.length;Q++){if(V&&!V(h,Q))continue;I[Q].multiplyToRef(f,o);const U=n(null,v,h,o,!1,!1,g,!0);U&&(U.thinInstanceIndex=Q,E.push(U))}}}else{const o=n(null,v,h,f,!1,!1,g);o&&E.push(o)}}return E}function s(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,g=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;g||(g=o.getWorldMatrix()),v.length=V,E?v.origin.U(E):v.origin.U(o.position);const I=Q.TmpVectors.cv[2];I.set(0,0,o._scene.useRightHandedSystem?-1:1);const U=Q.TmpVectors.cv[3];return Q.cv.TransformNormalToRef(I,g,U),Q.cv.NormalizeToRef(U,v.direction),v}var L,b;l._TmpVector3=(0,U.b)(6,Q.cv.Zero),l._RayDistant=l.Zero(),l._Smallnum=1e-8,l._Rayl=1e9,L=g.b,(b=E.e)&&(b.prototype.getForwardRay=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,v=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;return s(this,new l(Q.cv.Zero(),Q.cv.Zero(),o),o,v,V)},b.prototype.getForwardRayToRef=function(o){return s(this,o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),L&&(x.b._IsPickingAvailable=!0,L.prototype.createPickingRay=function(o,v,V,g){return S(this,o,v,V,g,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),g.b.prototype.createPickingRayToRef=function(o,v,V,g,E){return T(this,o,v,V,g,E,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},g.b.prototype.createPickingRayInCameraSpace=function(o,v,V){return function(o,v,V,g){const E=l.Zero();return c(o,v,V,E,g),E}(this,o,v,V)},g.b.prototype.createPickingRayInCameraSpaceToRef=function(o,v,V,g){return c(this,o,v,V,g)},g.b.prototype.pickWithBoundingInfo=function(o,v,V,g,E){return function(o,v,V,g,E,I){if(!O.e)return null;const U=j(o,(g=>(o._tempPickingRay||(o._tempPickingRay=l.Zero()),T(o,v,V,g,o._tempPickingRay,I||null),o._tempPickingRay)),g,E,!0);return U&&(U.ray=S(o,v,V,Q.Matrix.Identity(),I||null)),U}(this,o,v,V,g,E)},g.b.prototype.cV=function(o,v,V,g,E,I){return function(o,v,V,g,E,I,U){const n=j(o,((g,E)=>(o._tempPickingRay||(o._tempPickingRay=l.Zero()),T(o,v,V,g,o._tempPickingRay,I||null,!1,E),o._tempPickingRay)),g,E,!1,U);return n&&(n.ray=S(o,v,V,Q.Matrix.Identity(),I||null)),n}(this,o,v,V,g,E,I)},g.b.prototype.pickWithRay=function(o,v,V,g){return function(o,v,V,g,E){const I=j(o,(V=>(o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=Q.Matrix.Identity()),V.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=l.Zero()),l.TransformToRef(v,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform)),V,g,!1,E);return I&&(I.ray=v),I}(this,o,v,V,g)},g.b.prototype.multiPick=function(o,v,V,g,E){return function(o,v,V,g,E,I){return t(o,(g=>S(o,v,V,g,E||null)),g,I)}(this,o,v,V,g,E)},g.b.prototype.multiPickWithRay=function(o,v,V){return function(o,v,V,g){return t(o,(V=>(o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=Q.Matrix.Identity()),V.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=l.Zero()),l.TransformToRef(v,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform)),V,g)}(this,o,v,V)}},14211:(o,v,V)=>{"use strict";var g=V(12418),E=V(12308),I=V(12347),Q=V(12452),U=V(12381),n=V(12436);U.c.prototype._partialLoadFile=function(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(o,(o=>{V[v]=o,V._internalCount++,6===V._internalCount&&g(V)}),void 0,void 0,!0,((o,v)=>{E&&o&&E(o.status+" "+o.statusText,v)}))},U.c.prototype._cascadeLoadFiles=function(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=[];E._internalCount=0;for(let I=0;I<6;I++)this._partialLoadFile(V[I],I,E,v,g)},U.c.prototype._cascadeLoadImgs=function(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5?arguments[5]:void 0;const Q=[];Q._internalCount=0;for(let U=0;U<6;U++)this._partialLoadImg(g[U],U,Q,o,v,V,E,I)},U.c.prototype._partialLoadImg=function(o,v,V,g,E,U){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0;const h=(0,Q.b)();(0,I.m)(o,(o=>{V[v]=o,V._internalCount++,g&&g.removePendingData(h),6===V._internalCount&&U&&U(E,V)}),((o,v)=>{g&&g.removePendingData(h),n&&n(o,v)}),g?g.offlineProvider:null,O),g&&g.addPendingData(h)},U.c.prototype.createCubeTextureBase=function(o,v,V,I){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,R=arguments.length>14&&void 0!==arguments[14]&&arguments[14],j=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const t=S||new g.c(this,7);t.isCube=!0,t.url=o,t.generateMipMaps=!I,t._lodGenerationScale=f,t._lodGenerationOffset=l,t._useSRGBBuffer=!!R&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!I),t!==S&&(t.label=o.substring(0,60)),this._doNotHandleContextLost||(t._extension=h,t._files=V,t._buffer=j);const s=o;this._transformTextureUrl&&!S&&(o=this._transformTextureUrl(o));const L=h??function(o){const v=o.split("?")[0],V=v.lastIndexOf(".");return V>-1?v.substring(V).toLowerCase():""}(o),b=(0,n.b)(L),u=(o,v)=>{t.dispose(),U?U(o,v):o&&E.b.Warn(o)},mo=(g,U)=>{o===s?g&&u(g.status+" "+g.statusText,U):(E.b.Warn(`Failed to load ${o}, falling back to the ${s}`),this.createCubeTextureBase(s,v,V,!!I,Q,u,O,h,x,f,l,t,T,c,R,j))};if(b)b.then((g=>{const E=o=>{T&&T(t,o),g.loadCubeData(o,t,x,Q,((o,v)=>{u(o,v)}))};j?E(j):V&&6===V.length?g.supportCascades?this._cascadeLoadFiles(v,(o=>E(o.map((o=>new Uint8Array(o))))),V,u):u("Textures type does not support cascades."):this._loadFile(o,(o=>E(new Uint8Array(o))),void 0,void 0,!0,mo)}));else{if(!V||0===V.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(v,t,((o,v)=>{c&&c(o,v)}),V,u)}return this._internalTexturesCache.push(t),t}},14769:(o,v,V)=>{"use strict";V(12308);var g=V(12623);V(12418),V(12583),V(12410),V(12675),V(12631);g.c},14236:(o,v,V)=>{"use strict";V.d(v,{c:()=>E});var g=V(12449);class E{constructor(o){this.value=this._toInt(o)}_toInt(o){return 0|o}add(o){return new E(this.value+o.value)}Rv(o){return new E(this.value-o.value)}multiply(o){return new E(Math.imul(this.value,o.value))}divide(o){return new E(this.value/o.value)}getClassName(){return E.ClassName}equals(o){return this.value===o.value}static FromValue(o){return new E(o)}toString(){return this.value.toString()}}E.ClassName="FlowGraphInteger",(0,g.h)("FlowGraphInteger",E)},14243:(o,v,V)=>{"use strict";V.d(v,{c:()=>E,e:()=>I});var g=V(12488);class E{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.tg=o}get m(){return this.tg}transformVector(o){return this.transformVectorToRef(o,new g.Vector2)}transformVectorToRef(o,v){return v.x=o.x*this.tg[0]+o.y*this.tg[1],v.y=o.x*this.tg[2]+o.y*this.tg[3],v}Dg(){return this.toArray()}toArray(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let v=0;v<4;v++)o[v]=this.tg[v];return o}RV(o){for(let v=0;v<4;v++)this.tg[v]=o[v];return this}multiplyToRef(o,v){const V=o.tg,g=this.tg,E=v.tg;return E[0]=V[0]*g[0]+V[1]*g[2],E[1]=V[0]*g[1]+V[1]*g[3],E[2]=V[2]*g[0]+V[3]*g[2],E[3]=V[2]*g[1]+V[3]*g[3],v}multiply(o){return this.multiplyToRef(o,new E)}divideToRef(o,v){const V=this.tg,g=o.tg,E=v.tg;return E[0]=V[0]/g[0],E[1]=V[1]/g[1],E[2]=V[2]/g[2],E[3]=V[3]/g[3],v}divide(o){return this.divideToRef(o,new E)}addToRef(o,v){const V=this.tg,g=o.m,E=v.m;return E[0]=V[0]+g[0],E[1]=V[1]+g[1],E[2]=V[2]+g[2],E[3]=V[3]+g[3],v}add(o){return this.addToRef(o,new E)}subtractToRef(o,v){const V=this.tg,g=o.m,E=v.m;return E[0]=V[0]-g[0],E[1]=V[1]-g[1],E[2]=V[2]-g[2],E[3]=V[3]-g[3],v}Rv(o){return this.subtractToRef(o,new E)}transpose(){const o=this.tg;return new E([o[0],o[2],o[1],o[3]])}determinant(){const o=this.tg;return o[0]*o[3]-o[1]*o[2]}inverse(){const o=this.determinant();if(0===o)throw new Error("Matrix is not invertible");const v=this.tg,V=1/o;return new E([v[3]*V,-v[1]*V,-v[2]*V,v[0]*V])}equals(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=this.tg,g=o.m;return 0===v?V[0]===g[0]&&V[1]===g[1]&&V[2]===g[2]&&V[3]===g[3]:Math.abs(V[0]-g[0])<v&&Math.abs(V[1]-g[1])<v&&Math.abs(V[2]-g[2])<v&&Math.abs(V[3]-g[3])<v}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.tg.join(", ")})`}}class I{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.tg=o}get m(){return this.tg}transformVector(o){return this.transformVectorToRef(o,new g.cv)}transformVectorToRef(o,v){const V=this.tg;return v.x=o.x*V[0]+o.y*V[1]+o.z*V[2],v.y=o.x*V[3]+o.y*V[4]+o.z*V[5],v.z=o.x*V[6]+o.y*V[7]+o.z*V[8],v}multiplyToRef(o,v){const V=o.tg,g=this.tg,E=v.m;return E[0]=V[0]*g[0]+V[1]*g[3]+V[2]*g[6],E[1]=V[0]*g[1]+V[1]*g[4]+V[2]*g[7],E[2]=V[0]*g[2]+V[1]*g[5]+V[2]*g[8],E[3]=V[3]*g[0]+V[4]*g[3]+V[5]*g[6],E[4]=V[3]*g[1]+V[4]*g[4]+V[5]*g[7],E[5]=V[3]*g[2]+V[4]*g[5]+V[5]*g[8],E[6]=V[6]*g[0]+V[7]*g[3]+V[8]*g[6],E[7]=V[6]*g[1]+V[7]*g[4]+V[8]*g[7],E[8]=V[6]*g[2]+V[7]*g[5]+V[8]*g[8],v}multiply(o){return this.multiplyToRef(o,new I)}divideToRef(o,v){const V=this.tg,g=o.m,E=v.m;return E[0]=V[0]/g[0],E[1]=V[1]/g[1],E[2]=V[2]/g[2],E[3]=V[3]/g[3],E[4]=V[4]/g[4],E[5]=V[5]/g[5],E[6]=V[6]/g[6],E[7]=V[7]/g[7],E[8]=V[8]/g[8],v}divide(o){return this.divideToRef(o,new I)}addToRef(o,v){const V=this.tg,g=o.m,E=v.m;return E[0]=V[0]+g[0],E[1]=V[1]+g[1],E[2]=V[2]+g[2],E[3]=V[3]+g[3],E[4]=V[4]+g[4],E[5]=V[5]+g[5],E[6]=V[6]+g[6],E[7]=V[7]+g[7],E[8]=V[8]+g[8],v}add(o){return this.addToRef(o,new I)}subtractToRef(o,v){const V=this.tg,g=o.m,E=v.m;return E[0]=V[0]-g[0],E[1]=V[1]-g[1],E[2]=V[2]-g[2],E[3]=V[3]-g[3],E[4]=V[4]-g[4],E[5]=V[5]-g[5],E[6]=V[6]-g[6],E[7]=V[7]-g[7],E[8]=V[8]-g[8],v}Rv(o){return this.subtractToRef(o,new I)}toArray(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let v=0;v<9;v++)o[v]=this.tg[v];return o}Dg(){return this.toArray()}RV(o){for(let v=0;v<9;v++)this.tg[v]=o[v];return this}transpose(){const o=this.tg;return new I([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]])}determinant(){const o=this.tg;return o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6])}inverse(){const o=this.determinant();if(0===o)throw new Error("Matrix is not invertible");const v=this.tg,V=1/o;return new I([(v[4]*v[8]-v[5]*v[7])*V,(v[2]*v[7]-v[1]*v[8])*V,(v[1]*v[5]-v[2]*v[4])*V,(v[5]*v[6]-v[3]*v[8])*V,(v[0]*v[8]-v[2]*v[6])*V,(v[2]*v[3]-v[0]*v[5])*V,(v[3]*v[7]-v[4]*v[6])*V,(v[1]*v[6]-v[0]*v[7])*V,(v[0]*v[4]-v[1]*v[3])*V])}equals(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const V=this.tg,g=o.m;return 0===v?V[0]===g[0]&&V[1]===g[1]&&V[2]===g[2]&&V[3]===g[3]&&V[4]===g[4]&&V[5]===g[5]&&V[6]===g[6]&&V[7]===g[7]&&V[8]===g[8]:Math.abs(V[0]-g[0])<v&&Math.abs(V[1]-g[1])<v&&Math.abs(V[2]-g[2])<v&&Math.abs(V[3]-g[3])<v&&Math.abs(V[4]-g[4])<v&&Math.abs(V[5]-g[5])<v&&Math.abs(V[6]-g[6])<v&&Math.abs(V[7]-g[7])<v&&Math.abs(V[8]-g[8])<v}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.tg.join(", ")})`}}},14246:(o,v,V)=>{"use strict";var g;function E(o,v,V,g){switch(v){case"Animation":return g?o.animations.find((o=>o.uniqueId===V))??null:o.animations[V]??null;case"AnimationGroup":return g?o.animationGroups.find((o=>o.uniqueId===V))??null:o.animationGroups[V]??null;case"Mesh":return g?o.meshes.find((o=>o.uniqueId===V))??null:o.meshes[V]??null;case"Material":return g?o.materials.find((o=>o.uniqueId===V))??null:o.materials[V]??null;case"jh":return g?o.cameras.find((o=>o.uniqueId===V))??null:o.cameras[V]??null;case"Light":return g?o.lights.find((o=>o.uniqueId===V))??null:o.lights[V]??null;default:return null}}V.d(v,{e:()=>E}),function(o){o.Animation="Animation",o.AnimationGroup="AnimationGroup",o.Mesh="Mesh",o.Material="Material",o.jh="jh",o.Light="Light"}(g||(g={}))},14281:(o,v,V)=>{"use strict";V.d(v,{e:()=>E});var g=V(14283);class E extends g.d{constructor(o,v){if(super(o),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),v)for(const V of v)this._eventsSignalOutputs[V]=this._registerSignalOutput(V+"Event")}_executeOnTick(o){}_startPendingTasks(o){o._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(o),this._resetAfterCanceled(o)),this._preparePendingTasks(o),o._addPendingBlock(this),this.out._activateSignal(o),o._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(o){o._deleteExecutionVariable(this,"_initialized"),o._removePendingBlock(this)}}},14259:(o,v,V)=>{"use strict";V.d(v,{b:()=>O});var g=V(12452),E=V(12449),I=V(14261),Q=V(12297),U=V(14231);class n extends I.c{constructor(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.defaultValue,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(o,v,V),this.richType=g,this._defaultValue=E,this._optional=I,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Q.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(o){this._isDisabled!==o&&(this._isDisabled=o,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(o,v){v._getConnectionValue(this)!==o&&(v._setConnectionValue(this,o),this.onValueChangedObservable.notifyObservers(o))}resetToDefaultValue(o){o._setConnectionValue(this,this._defaultValue)}connectTo(o){this._isDisabled||super.connectTo(o)}_getValueOrDefault(o){const v=o._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(v):v}getValue(o){if(1===this.connectionType){o._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(o);const v=this._getValueOrDefault(o);return this._lastValue=v,this.richType.typeTransformer?this.richType.typeTransformer(v):v}const v=this.isConnected()?this._connectedPoint[0].getValue(o):this._getValueOrDefault(o);return this._lastValue=v,this.richType.typeTransformer?this.richType.typeTransformer(v):v}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(o),o.richType={},this.richType.serialize(o.richType),o.optional=this._optional,(0,U.d)("defaultValue",this._defaultValue,o)}}(0,E.h)("FlowGraphDataConnection",n);class O{constructor(o){var v;this.config=o,this.uniqueId=(0,g.b)(),this.name=(null===(v=this.config)||void 0===v?void 0:v.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(o){}registerDataInput(o,v,V){const g=new n(o,0,this,v,V);return this.dataInputs.push(g),g}registerDataOutput(o,v,V){const g=new n(o,1,this,v,V);return this.dataOutputs.push(g),g}getDataInput(o){return this.dataInputs.find((v=>v.name===o))}getDataOutput(o){return this.dataOutputs.find((v=>v.name===o))}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.d;if(o.uniqueId=this.uniqueId,o.config={},this.config){const V=this.config,g=Object.keys(V);for(const E of g)v(E,V[E],o.config)}o.dataInputs=[],o.dataOutputs=[],o.className=this.getClassName();for(const V of this.dataInputs){const v={};V.serialize(v),o.dataInputs.push(v)}for(const V of this.dataOutputs){const v={};V.serialize(v),o.dataOutputs.push(v)}}deserialize(o){}_log(o,v,V){var g;null===(g=o.logger)||void 0===g||g.addLogItem({action:v,jV:V,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14261:(o,v,V)=>{"use strict";V.d(v,{c:()=>I});var g,E=V(12452);!function(o){o[o.Input=0]="Input",o[o.Output=1]="Output"}(g||(g={}));class I{constructor(o,v,V){this._ownerBlock=V,this._connectedPoint=[],this.uniqueId=(0,E.b)(),this.connectedPointIds=[],this.name=o,this._connectionType=v}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(o){if(this._connectionType===o._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||o._isSingularConnection()&&o._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(o),o._connectedPoint.push(this)}disconnectFrom(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=this._connectedPoint.indexOf(o),g=o._connectedPoint.indexOf(this);-1!==V&&-1!==g&&(v&&this._connectedPoint.splice(V,1),o._connectedPoint.splice(g,1))}disconnectFromAll(){for(const o of this._connectedPoint)this.disconnectFrom(o,!1);this._connectedPoint.length=0}dispose(){for(const o of this._connectedPoint)this.disconnectFrom(o)}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o.uniqueId=this.uniqueId,o.name=this.name,o._connectionType=this._connectionType,o.connectedPointIds=[],o.className=this.getClassName();for(const v of this._connectedPoint)o.connectedPointIds.push(v.uniqueId)}getClassName(){return"FGConnection"}deserialize(o){this.uniqueId=o.uniqueId,this.name=o.name,this._connectionType=o._connectionType,this.connectedPointIds=o.connectedPointIds}}},14229:(o,v,V)=>{"use strict";V.d(v,{d:()=>t});var g,E=V(12297),I=V(12473),Q=V(12479),U=V(12452),n=V(14231),O=V(14246),h=V(12308);!function(o){o.ExecuteBlock="ExecuteBlock",o.ExecuteEvent="ExecuteEvent",o.TriggerConnection="TriggerConnection",o.ContextVariableSet="ContextVariableSet",o.GlobalVariableSet="GlobalVariableSet",o.GlobalVariableDelete="GlobalVariableDelete",o.GlobalVariableGet="GlobalVariableGet",o.AddConnection="AddConnection",o.GetConnectionValue="GetConnectionValue",o.SetConnectionValue="SetConnectionValue",o.ActivateSignal="ActivateSignal",o.ContextVariableGet="ContextVariableGet"}(g||(g={}));class x{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(o){if(o.time||(o.time=Date.now()),this.log.push(o),this.logToConsole){var v;const V=null===(v=o.jV)||void 0===v?void 0:v.value;"object"===typeof V&&V.getClassName?h.b.Log(`[FGLog] ${o.className}:${o.uniqueId.split("-")[0]} ${o.action} - ${JSON.stringify(V.getClassName())}: ${V.toString()}`):h.b.Log(`[FGLog] ${o.className}:${o.uniqueId.split("-")[0]} ${o.action} - ${JSON.stringify(o.jV)}`)}}getItemsOfType(o){return this.log.filter((v=>v.action===o))}}class f{get enableLogging(){return this._enableLogging}set enableLogging(o){this._enableLogging!==o&&(this._enableLogging=o,this._enableLogging?(this.logger=new x,this.logger.logToConsole=!0):this.logger=null)}constructor(o){this.uniqueId=(0,U.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=o,this.assetsContext=o.assetsContext??o.jv}hasVariable(o){return o in this._userVariables}setVariable(o,v){var V;this._userVariables[o]=v,null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",jV:{name:o,value:v}})}getAsset(o,v){return(0,O.e)(this.assetsContext,o,v)}getVariable(o){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",jV:{name:o,value:this._userVariables[o]}}),this._userVariables[o]}get userVariables(){return this._userVariables}Fo(){return this._configuration.jv}_getUniqueIdPrefixedName(o,v){return`${o.uniqueId}_${v}`}_getGlobalContextVariable(o,v){var V;return null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",jV:{name:o,defaultValue:v,possibleValue:this._globalContextVariables[o]}}),this._hasGlobalContextVariable(o)?this._globalContextVariables[o]:v}_setGlobalContextVariable(o,v){var V;null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",jV:{name:o,value:v}}),this._globalContextVariables[o]=v}_deleteGlobalContextVariable(o){var v;null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",jV:{name:o}}),delete this._globalContextVariables[o]}_hasGlobalContextVariable(o){return o in this._globalContextVariables}_setExecutionVariable(o,v,V){this._executionVariables[this._getUniqueIdPrefixedName(o,v)]=V}_getExecutionVariable(o,v,V){return this._hasExecutionVariable(o,v)?this._executionVariables[this._getUniqueIdPrefixedName(o,v)]:V}_deleteExecutionVariable(o,v){delete this._executionVariables[this._getUniqueIdPrefixedName(o,v)]}_hasExecutionVariable(o,v){return this._getUniqueIdPrefixedName(o,v)in this._executionVariables}_hasConnectionValue(o){return o.uniqueId in this._connectionValues}_setConnectionValue(o,v){var V;this._connectionValues[o.uniqueId]=v,null===(V=this.logger)||void 0===V||V.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",jV:{connectionPointId:o.uniqueId,value:v}})}_setConnectionValueByKey(o,v){this._connectionValues[o]=v}_getConnectionValue(o){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",jV:{connectionPointId:o.uniqueId,value:this._connectionValues[o.uniqueId]}}),this._connectionValues[o.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(o){this._pendingBlocks.includes(o)||(this._pendingBlocks.push(o),this._pendingBlocks.sort(((o,v)=>o.priority-v.priority)))}_removePendingBlock(o){const v=this._pendingBlocks.indexOf(o);-1!==v&&this._pendingBlocks.splice(v,1)}_clearPendingBlocks(){for(const o of this._pendingBlocks)o._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(o){var v;this.onNodeExecutedObservable.notifyObservers(o),null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:o.getClassName(),uniqueId:o.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(o){this._setGlobalContextVariable("timeSinceStart",o.timeSinceStart),this._setGlobalContextVariable("deltaTime",o.deltaTime);for(const V of this._pendingBlocks){var v;null===(v=V._executeOnTick)||void 0===v||v.call(V,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.d;o.uniqueId=this.uniqueId,o._userVariables={};for(const g in this._userVariables)v(g,this._userVariables[g],o._userVariables);o._connectionValues={};for(const g in this._connectionValues)v(g,this._connectionValues[g],o._connectionValues);var V;this.assetsContext!==this.Fo()&&(o._assetsContext={meshes:this.assetsContext.meshes.map((o=>o.id)),materials:this.assetsContext.materials.map((o=>o.id)),textures:this.assetsContext.textures.map((o=>o.name)),animations:this.assetsContext.animations.map((o=>o.name)),lights:this.assetsContext.lights.map((o=>o.id)),cameras:this.assetsContext.cameras.map((o=>o.id)),Ll:null===(V=this.assetsContext.Ll)||void 0===V?void 0:V.map((o=>o.name)),skeletons:this.assetsContext.skeletons.map((o=>o.id)),Mf:this.assetsContext.Mf.map((o=>o.name)),geometries:this.assetsContext.geometries.map((o=>o.id)),multiMaterials:this.assetsContext.multiMaterials.map((o=>o.id)),transformNodes:this.assetsContext.transformNodes.map((o=>o.id))})}getClassName(){return"FlowGraphContext"}}(0,I.c)([(0,Q.K)()],f.prototype,"uniqueId",void 0);var l=V(14250),S=V(12780);class T{constructor(o){this.onEventTriggeredObservable=new E.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=o,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Tg.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const o=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",jV:{timeSinceStart:this._startingTime,deltaTime:o}}),this._startingTime+=o})),this._meshPickedObserver=this._scene.onPointerObservable.add((o=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",jV:o})}),S.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((o=>{const v=o.pointerId,V=o.mesh,g=this._pointerUnderMeshState[v];!g&&V?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",jV:{pointerId:v,mesh:V}}):g&&!V?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",jV:{pointerId:v,mesh:g}}):g&&V&&g!==V&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",jV:{pointerId:v,mesh:g,over:V}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",jV:{pointerId:v,mesh:V,out:g}})),this._pointerUnderMeshState[v]=V}),S.e.POINTERMOVE)}dispose(){var o,v,V,g,E;null===(o=this._sceneDisposeObserver)||void 0===o||o.remove(),null===(v=this._sceneReadyObserver)||void 0===v||v.remove(),null===(V=this._sceneOnBeforeRenderObserver)||void 0===V||V.remove(),null===(g=this._meshPickedObserver)||void 0===g||g.remove(),null===(E=this._meshUnderPointerObserver)||void 0===E||E.remove(),this.onEventTriggeredObservable.clear()}}var c,R=V(14267);!function(o){o[o.Stopped=0]="Stopped",o[o.Started=1]="Started"}(c||(c={}));class j{get state(){return this._state}set state(o){this._state=o,this.onStateChangedObservable.notifyObservers(o)}constructor(o){this.onStateChangedObservable=new E.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=o.jv,this._sceneEventCoordinator=new T(this._scene),this._coordinator=o.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((o=>{for(const v of this._executionContexts){const V=this._getContextualOrder(o.type,v);for(const g of V)if(!g._executeEvent(v,o.jV))break}switch(o.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const v of this._executionContexts)v._notifyOnTick(o.jV);break;case"SceneDispose":this.dispose()}}))}createContext(){const o=new f({jv:this._scene,coordinator:this._coordinator});return this._executionContexts.push(o),o}getContext(o){return this._executionContexts[o]}addEventBlock(o){if("PointerOver"!==o.type&&"PointerOut"!==o.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==o.type&&this._eventBlocks[o.type].push(o),1===this.state)for(const v of this._executionContexts)o._startPendingTasks(v);else this.onStateChangedObservable.addOnce((v=>{if(1===v)for(const V of this._executionContexts)o._startPendingTasks(V)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((o=>{1===o&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const o of this._executionContexts)for(const v in this._eventBlocks){const V=this._getContextualOrder(v,o);for(const v of V)v._startPendingTasks(o)}}_getContextualOrder(o,v){const V=this._eventBlocks[o].sort(((o,v)=>v.initPriority-o.initPriority));if("MeshPick"===o){const o=[];for(const g of V){const E=g.asset.getValue(v);let I=0;for(;I<V.length;I++){const o=V[I].asset.getValue(v);if(E&&o&&(0,R.m)(E,o))break}o.splice(I,0,g)}return o}return V}dispose(){var o;if(0!==this.state){this.state=0;for(const o of this._executionContexts)o._clearPendingBlocks();this._executionContexts.length=0;for(const o in this._eventBlocks)this._eventBlocks[o].length=0;null===(o=this._eventObserver)||void 0===o||o.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(o){const v=[],V=new Set;for(const g in this._eventBlocks)for(const o of this._eventBlocks[g])v.push(o),V.add(o.uniqueId);for(;v.length>0;){const g=v.pop();o(g);for(const o of g.dataInputs)for(const g of o._connectedPoint)V.has(g._ownerBlock.uniqueId)||(v.push(g._ownerBlock),V.add(g._ownerBlock.uniqueId));if(g instanceof l.b)for(const o of g.signalOutputs)for(const g of o._connectedPoint)V.has(g._ownerBlock.uniqueId)||(v.push(g._ownerBlock),V.add(g._ownerBlock.uniqueId))}}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1?arguments[1]:void 0;o.allBlocks=[],this.visitAllBlocks((v=>{const V={};v.serialize(V),o.allBlocks.push(V)})),o.executionContexts=[];for(const V of this._executionContexts){const g={};V.serialize(g,v),o.executionContexts.push(g)}}}class t{constructor(o){this.config=o,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.jv.Tg.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.jv.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const o=this._executeOnNextFrame.slice(0);if(o.length)for(const v of o){this.notifyCustomEvent(v.id,v.data,!1);const o=this._executeOnNextFrame.findIndex((o=>o.uniqueId===v.uniqueId));-1!==o&&this._executeOnNextFrame.splice(o,1)}}));(t.SceneCoordinators.get(this.config.jv)??[]).push(this)}createGraph(){const o=new j({jv:this.config.jv,coordinator:this});return this._flowGraphs.push(o),o}removeGraph(o){const v=this._flowGraphs.indexOf(o);-1!==v&&(o.dispose(),this._flowGraphs.splice(v,1))}start(){for(const o of this._flowGraphs)o.start()}dispose(){var o,v;for(const E of this._flowGraphs)E.dispose();this._flowGraphs.length=0,null===(o=this._disposeObserver)||void 0===o||o.remove(),null===(v=this._onBeforeRenderObserver)||void 0===v||v.remove();const V=t.SceneCoordinators.get(this.config.jv)??[],g=V.indexOf(this);-1!==g&&V.splice(g,1)}serialize(o,v){o._flowGraphs=[];for(const V of this._flowGraphs){const g={};V.serialize(g,v),o._flowGraphs.push(g)}o.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(o){let v=this._customEventsMap.get(o);return v||(v=new E.e,this._customEventsMap.set(o,v)),v}notifyCustomEvent(o,v){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:o,data:v,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(o)){const v=this._eventExecutionCounter.get(o);if(this._eventExecutionCounter.set(o,v+1),v>=t.MaxEventTypeExecutionPerFrame)return void(v===t.MaxEventTypeExecutionPerFrame&&h.b.Warn(`FlowGraphCoordinator: Too many executions of event "${o}".`))}else this._eventExecutionCounter.set(o,1);const V=this._customEventsMap.get(o);V&&V.notifyObservers(v)}}t.MaxEventsPerType=30,t.MaxEventTypeExecutionPerFrame=30,t.SceneCoordinators=new Map},14275:(o,v,V)=>{"use strict";V.d(v,{e:()=>E});var g=V(14281);class E extends g.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(o){o._notifyExecuteNode(this),this.done._activateSignal(o)}}},14250:(o,v,V)=>{"use strict";V.d(v,{b:()=>U});var g=V(14259),E=V(14261),I=V(12449);class Q extends E.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(o){super.connectTo(o),this._connectedPoint.sort(((o,v)=>v.priority-o.priority))}_activateSignal(o){var v;if(null===(v=o.logger)||void 0===v||v.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,jV:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)o._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(o,this),o._increaseExecutionId();else for(const V of this._connectedPoint)V._activateSignal(o)}}(0,I.h)("FlowGraphSignalConnection",Q);class U extends g.b{constructor(o){super(o),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(o){const v=new Q(o,0,this);return this.signalInputs.push(v),v}_registerSignalOutput(o){const v=new Q(o,1,this);return this.signalOutputs.push(v),v}_unregisterSignalInput(o){const v=this.signalInputs.findIndex((v=>v.name===o));-1!==v&&(this.signalInputs[v].dispose(),this.signalInputs.splice(v,1))}_unregisterSignalOutput(o){const v=this.signalOutputs.findIndex((v=>v.name===o));-1!==v&&(this.signalOutputs[v].dispose(),this.signalOutputs.splice(v,1))}_reportError(o,v){this.error.jV="string"===typeof v?new Error(v):v,this.error._activateSignal(o)}getSignalInput(o){return this.signalInputs.find((v=>v.name===o))}getSignalOutput(o){return this.signalOutputs.find((v=>v.name===o))}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(o),o.signalInputs=[],o.signalOutputs=[];for(const v of this.signalInputs){const V={};v.serialize(V),o.signalInputs.push(V)}for(const v of this.signalOutputs){const V={};v.serialize(V),o.signalOutputs.push(V)}}deserialize(o){for(let v=0;v<o.signalInputs.length;v++){const V=this.getSignalInput(o.signalInputs[v].name);if(!V)throw new Error("Could not find signal input with name "+o.signalInputs[v].name+" in block "+o.className);V.deserialize(o.signalInputs[v])}for(let v=0;v<o.signalOutputs.length;v++){const V=this.getSignalOutput(o.signalOutputs[v].name);if(!V)throw new Error("Could not find signal output with name "+o.signalOutputs[v].name+" in block "+o.className);V.deserialize(o.signalOutputs[v])}}getClassName(){return"FlowGraphExecutionBlock"}}},14283:(o,v,V)=>{"use strict";V.d(v,{d:()=>E});var g=V(14250);class E extends g.b{constructor(o){super(o),this.out=this._registerSignalOutput("out")}}},14241:(o,v,V)=>{"use strict";V.d(v,{C:()=>S,F:()=>T,H:()=>a,K:()=>F,M:()=>mo,N:()=>u,e:()=>O,f:()=>f,i:()=>b,k:()=>c,o:()=>R,r:()=>j,t:()=>x,u:()=>L,w:()=>h,z:()=>l});var g,E=V(12488),I=V(12547),Q=V(14236),U=V(14243);!function(o){o.Any="any",o.String="string",o.Number="number",o.Boolean="boolean",o.Object="object",o.Integer="FlowGraphInteger",o.Vector2="Vector2",o.cv="cv",o.Vector4="Vector4",o.Quaternion="Quaternion",o.Matrix="Matrix",o.Matrix2D="Matrix2D",o.Matrix3D="Matrix3D",o.Lv="Lv",o.sU="sU"}(g||(g={}));class n{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=o,this.defaultValue=v,this.animationType=V}serialize(o){o.typeName=this.typeName,o.defaultValue=this.defaultValue}}const O=new n("any",void 0),h=new n("string",""),x=new n("number",0,0),f=new n("boolean",!1),l=new n("Vector2",E.Vector2.Zero(),5),S=new n("cv",E.cv.Zero(),1),T=new n("Vector4",E.Vector4.Zero()),c=new n("Matrix",E.Matrix.Identity(),3),R=new n("Matrix2D",new U.c),j=new n("Matrix3D",new U.e),t=new n("Lv",I.Lv.Black(),4),s=new n("sU",new I.sU(0,0,0,0),7),L=new n("Quaternion",E.Quaternion.Identity(),2);L.typeTransformer=o=>{if(o.getClassName){if("Vector4"===o.getClassName())return E.Quaternion.bv(o.Dg());if("cv"===o.getClassName())return E.Quaternion.FromEulerVector(o);if("Matrix"===o.getClassName())return E.Quaternion.FromRotationMatrix(o)}return o};const b=new n("FlowGraphInteger",new Q.c(0),0);function u(o){const v=o;switch(typeof o){case"string":return h;case"number":return x;case"boolean":return f;case"object":if(v.getClassName)switch(v.getClassName()){case"Vector2":return l;case"cv":return S;case"Vector4":return T;case"Matrix":return c;case"Lv":return t;case"sU":return s;case"Quaternion":return L;case"FlowGraphInteger":return b;case"Matrix2D":return R;case"Matrix3D":return j}return O;default:return O}}function mo(o){switch(o){case"string":return h;case"number":return x;case"boolean":return f;case"Vector2":return l;case"cv":return S;case"Vector4":return T;case"Matrix":return c;case"Lv":return t;case"sU":return s;case"Quaternion":return L;case"FlowGraphInteger":return b;case"Matrix2D":return R;case"Matrix3D":return j;default:return O}}function a(o){switch(o){case"number":default:return 0;case"Vector2":return 5;case"cv":return 1;case"Matrix":return 3;case"Lv":return 4;case"sU":return 7;case"Quaternion":return 2}}function F(o){switch(o){case 0:return x;case 5:return l;case 1:return S;case 3:return c;case 4:return t;case 7:return s;case 2:return L;default:return O}}},14231:(o,v,V)=>{"use strict";V.d(v,{b:()=>h,d:()=>O,h:()=>x});var g=V(12547),E=V(12488),I=V(14236),Q=V(14241),U=V(14243);function n(o){return"Vector2"===o||"cv"===o||"Vector4"===o||"Quaternion"===o||"Lv"===o||"sU"===o}function O(o,v,V){var g;const E=(null===v||void 0===v||null===(g=v.getClassName)||void 0===g?void 0:g.call(v))??"";if(n(E)||function(o){return"Matrix"===o||"Matrix2D"===o||"Matrix3D"===o}(E))V[o]={value:v.Dg(),className:E};else if("FlowGraphInteger"===E)V[o]={value:v.value,className:E};else if(E&&(v.id||v.name))V[o]={id:v.id,name:v.name,className:E};else{if("object"===typeof v)throw new Error(`Could not serialize value ${v}`);V[o]=v}}function h(o,v,V,O){const x=v[o];let f;const l=(null===x||void 0===x?void 0:x.type)??(null===x||void 0===x?void 0:x.className);if(function(o){return"Mesh"===o||"AbstractMesh"===o||"GroundMesh"===o||"InstanceMesh"===o||"LinesMesh"===o||"GoldbergMesh"===o||"GreasedLineMesh"===o||"TrailMesh"===o}(l)){let o=O.meshes.filter((o=>x.id?o.id===x.id:o.name===x.name));0===o.length&&(o=O.transformNodes.filter((o=>x.id?o.id===x.id:o.name===x.name))),f=x.uniqueId?o.find((o=>o.uniqueId===x.uniqueId)):o[0]}else if(n(l))f=function(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===o)return E.Vector2.bv(v);if("cv"===o)return V&&(v[2]*=-1),E.cv.bv(v);if("Vector4"===o)return E.Vector4.bv(v);if("Quaternion"===o)return V&&(v[2]*=-1,v[3]*=-1),E.Quaternion.bv(v);if("Lv"===o)return new g.Lv(v[0],v[1],v[2]);if("sU"===o)return new g.sU(v[0],v[1],v[2],v[3]);throw new Error(`Unknown vector class name ${o}`)}(l,x.value);else if(function(o){return"AnimationGroup"===o}(l)){const o=O.animationGroups.filter((o=>o.name===x.name));f=1===o.length?o[0]:o.find((o=>o.uniqueId===x.uniqueId))}else f="Matrix"===l?E.Matrix.bv(x.value):"Matrix2D"===l?new U.c(x.value):"Matrix3D"===l?new U.e(x.value):"FlowGraphInteger"===l?I.c.FromValue(x.value):"number"===l||"string"===l||"boolean"===l?x.value[0]:x&&void 0!==x.value?x.value:Array.isArray(x)?x.reduce(((o,v)=>v.eventData?(o[v.id]={type:(0,Q.M)(v.type)},"undefined"!==typeof v.value&&(o[v.id].value=h("value",v,V,O)),o):o),{}):x;return f}function x(o){return"FlowGraphJsonPointerParserBlock"===o}},14267:(o,v,V)=>{"use strict";function g(o,v){return!(!o.parent||o.parent!==v&&!g(o.parent,v))}function E(o){if(o.getClassName)return o.getClassName()}function I(o,v){return o===v&&("Vector2"===o||"cv"===o||"Vector4"===o||"Quaternion"===o)}function Q(o,v){return o===v&&("Matrix"===o||"Matrix2D"===o||"Matrix3D"===o)}function U(o,v){return"FlowGraphInteger"===o&&"FlowGraphInteger"===v}function n(o,v){const V="number"===typeof o||"number"===typeof(null===o||void 0===o?void 0:o.value);return V&&!v?!isNaN(O(o)):V}function O(o){return"number"===typeof o?o:o.value}V.d(v,{c:()=>U,e:()=>Q,h:()=>I,i:()=>E,m:()=>g,p:()=>O,t:()=>n})},13623:(o,v,V)=>{"use strict";V.r(v),V.d(v,{SceneInstrumentation:()=>I});var g=V(12291),E=V(12725);class I{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(o){o!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=o,o?(this._onBeforeActiveMeshesEvaluationObserver=this.jv.onBeforeActiveMeshesEvaluationObservable.add((()=>{g.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.jv.onAfterActiveMeshesEvaluationObservable.add((()=>{g.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.jv.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.jv.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(o){o!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=o,o?(this._onBeforeRenderTargetsRenderObserver=this.jv.onBeforeRenderTargetsRenderObservable.add((()=>{g.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.jv.onAfterRenderTargetsRenderObservable.add((()=>{g.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.jv.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.jv.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(o){o!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=o,o?(this._onBeforeParticlesRenderingObserver=this.jv.onBeforeParticlesRenderingObservable.add((()=>{g.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.jv.onAfterParticlesRenderingObservable.add((()=>{g.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.jv.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.jv.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(o){o!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=o,this.jv.spriteManagers&&(o?(this._onBeforeSpritesRenderingObserver=this.jv.onBeforeSpritesRenderingObservable.add((()=>{g.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.jv.onAfterSpritesRenderingObservable.add((()=>{g.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.jv.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.jv.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(o){o!==this._capturePhysicsTime&&this.jv.onBeforePhysicsObservable&&(this._capturePhysicsTime=o,o?(this._onBeforePhysicsObserver=this.jv.onBeforePhysicsObservable.add((()=>{g.Tools.StartPerformanceCounter("Oh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.jv.onAfterPhysicsObservable.add((()=>{g.Tools.EndPerformanceCounter("Oh"),this._physicsTime.endMonitoring()}))):(this.jv.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.jv.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(o){o!==this._captureAnimationsTime&&(this._captureAnimationsTime=o,o?this._onAfterAnimationsObserver=this.jv.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.jv.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(o){this._captureFrameTime=o}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(o){this._captureInterFrameTime=o}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(o){o!==this._captureRenderTime&&(this._captureRenderTime=o,o?(this._onBeforeDrawPhaseObserver=this.jv.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),g.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.jv.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),g.Tools.EndPerformanceCounter("Main render")}))):(this.jv.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.jv.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(o){o!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=o,o?(this._onBeforeCameraRenderObserver=this.jv.onBeforeCameraRenderObservable.add((o=>{this._cameraRenderTime.beginMonitoring(),g.Tools.StartPerformanceCounter(`Rendering camera ${o.name}`)})),this._onAfterCameraRenderObserver=this.jv.onAfterCameraRenderObservable.add((o=>{this._cameraRenderTime.endMonitoring(!1),g.Tools.EndPerformanceCounter(`Rendering camera ${o.name}`)}))):(this.jv.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.jv.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.jv.getEngine()._drawCalls}constructor(o){this.jv=o,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new E.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new E.e,this._captureFrameTime=!1,this._frameTime=new E.e,this._captureRenderTime=!1,this._renderTime=new E.e,this._captureInterFrameTime=!1,this._interFrameTime=new E.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new E.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new E.e,this._capturePhysicsTime=!1,this._physicsTime=new E.e,this._captureAnimationsTime=!1,this._animationsTime=new E.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new E.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=o.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(g.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.jv.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=o.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(g.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fg(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fg(),this._captureParticlesRenderTime&&this._particlesRenderTime.fg(),this._captureSpritesRenderTime&&this._spritesRenderTime.fg(),this._captureRenderTime&&this._renderTime.fg(),this._captureCameraRenderTime&&this._cameraRenderTime.fg()}))}dispose(){this._disposed||(this.jv.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.jv.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.jv.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.jv.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.jv.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.jv.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.jv.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.jv.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.jv.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.jv.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.jv.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.jv.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.jv.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.jv.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.jv.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.jv.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.jv.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.jv=null,this._disposed=!0)}}},14223:(o,v,V)=>{"use strict";V.d(v,{c:()=>h});var g=V(12473),E=V(12479),I=V(12488),Q=V(12932),U=V(13049),n=V(13099),O=V(12449);Q.c.AddNodeConstructor("Light_Type_1",((o,v)=>()=>new h(o,I.cv.Zero(),v)));class h extends n.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(o){this._shadowFrustumSize=o,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(o){this._shadowOrthoScale=o,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(o){this._orthoLeft=o}get orthoRight(){return this._orthoRight}set orthoRight(o){this._orthoRight=o}get orthoTop(){return this._orthoTop}set orthoTop(o){this._orthoTop=o}get orthoBottom(){return this._orthoBottom}set orthoBottom(o){this._orthoBottom=o}constructor(o,v,V){super(o,V),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=v.scale(-1),this.direction=v}getClassName(){return"fh"}getTypeID(){return U.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(o,v,V){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(o):this._setDefaultAutoExtendShadowProjectionMatrix(o,v,V)}_setDefaultFixedFrustumShadowProjectionMatrix(o){const v=this.Fo().activeCamera;v&&I.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:v.Xg,void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,o,this.Fo().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(o,v,V){const g=this.Fo().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const o=I.cv.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let g=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let Q=0;Q<V.length;Q++){const U=V[Q];if(!U)continue;const n=U.getBoundingInfo().boundingBox;for(let V=0;V<n.vectorsWorld.length;V++)I.cv.TransformCoordinatesToRef(n.vectorsWorld[V],v,o),o.x<this._orthoLeft&&(this._orthoLeft=o.x),o.y<this._orthoBottom&&(this._orthoBottom=o.y),o.x>this._orthoRight&&(this._orthoRight=o.x),o.y>this._orthoTop&&(this._orthoTop=o.y),this.autoCalcShadowZBounds&&(o.z<g&&(g=o.z),o.z>E&&(E=o.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=g,this._shadowMaxZ=E)}const E=this._orthoRight-this._orthoLeft,Q=this._orthoTop-this._orthoBottom,U=void 0!==this.shadowMinZ?this.shadowMinZ:(null===g||void 0===g?void 0:g.Xg)||0,n=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===g||void 0===g?void 0:g.maxZ)||1e4,O=this.Fo().getEngine().Ug;I.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-Q*this.shadowOrthoScale,this._orthoTop+Q*this.shadowOrthoScale,O?n:U,O?U:n,o,this.Fo().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(o,v){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,v),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,v),this)}transferToNodeMaterialEffect(o,v){return this.computeTransformedInformation()?(o.setFloat3(v,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(o.setFloat3(v,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(o){const v=this._scene.getEngine();return!v.Ug&&v.isNDCHalfZRange?0:1}getDepthMaxZ(o){const v=this._scene.getEngine();return v.Ug&&v.isNDCHalfZRange?0:1}prepareLightSpecificDefines(o,v){o["DIRLIGHT"+v]=!0}}(0,g.c)([(0,E.K)()],h.prototype,"shadowFrustumSize",null),(0,g.c)([(0,E.K)()],h.prototype,"shadowOrthoScale",null),(0,g.c)([(0,E.K)()],h.prototype,"autoUpdateExtends",void 0),(0,g.c)([(0,E.K)()],h.prototype,"autoCalcShadowZBounds",void 0),(0,g.c)([(0,E.K)("orthoLeft")],h.prototype,"_orthoLeft",void 0),(0,g.c)([(0,E.K)("orthoRight")],h.prototype,"_orthoRight",void 0),(0,g.c)([(0,E.K)("orthoTop")],h.prototype,"_orthoTop",void 0),(0,g.c)([(0,E.K)("orthoBottom")],h.prototype,"_orthoBottom",void 0),(0,O.h)("BABYLON.DirectionalLight",h)},14708:(o,v,V)=>{"use strict";V.d(v,{d:()=>h});var g=V(12473),E=V(12479),I=V(12488),Q=V(12547),U=V(12932),n=V(13049),O=V(12449);U.c.AddNodeConstructor("Light_Type_3",((o,v)=>()=>new h(o,I.cv.Zero(),v)));class h extends n.c{constructor(o,v,V){super(o,V),this.groundColor=new Q.Lv(0,0,0),this.direction=v||I.cv.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Th"}setDirectionToTarget(o){return this.direction=I.cv.Normalize(o.Rv(I.cv.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(o,v){const V=I.cv.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",V.x,V.y,V.z,0,v),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.uU),v),this}transferToNodeMaterialEffect(o,v){const V=I.cv.Normalize(this.direction);return o.setFloat3(v,V.x,V.y,V.z),this}Ag(){return this._worldMatrix||(this._worldMatrix=I.Matrix.Identity()),this._worldMatrix}getTypeID(){return n.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(o,v){o["HEMILIGHT"+v]=!0}}(0,g.c)([(0,E.m)()],h.prototype,"groundColor",void 0),(0,g.c)([(0,E.G)()],h.prototype,"direction",void 0),(0,O.h)("BABYLON.HemisphericLight",h)},14189:(o,v,V)=>{"use strict";V.d(v,{c:()=>x});var g=V(12473),E=V(12479),I=V(12488),Q=V(12932),U=V(13049),n=V(13099),O=V(12471),h=V(12449);Q.c.AddNodeConstructor("Light_Type_2",((o,v)=>()=>new x(o,I.cv.Zero(),I.cv.Zero(),0,0,v)));class x extends n.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(o){this._iesProfileTexture!==o&&(this._iesProfileTexture=o,this._iesProfileTexture&&x._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(o){this._angle=o,this._cosHalfAngle=Math.cos(.5*o),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(o){this._innerAngle=o,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(o){this._shadowAngleScale=o,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(o){this._projectionTextureLightNear=o,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(o){this._projectionTextureLightFar=o,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(o){this._projectionTextureUpDirection=o,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(o){this._projectionTexture!==o&&(this._projectionTexture=o,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(x._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):x._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(o){return void 0!==o.onGeneratedObservable}static _IsTexture(o){return void 0!==o.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(o){this._projectionTextureProjectionLightMatrix=o,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(o,v,V,g,E,Q){super(o,Q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=I.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=I.cv.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=I.cv.Zero(),this._projectionTextureViewLightMatrix=I.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=I.Matrix.Zero(),this._projectionTextureScalingMatrix=I.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=v,this.direction=V,this.angle=g,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return U.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(o){super._setDirection(o),this._projectionTextureViewLightDirty=!0}_setPosition(o){super._setPosition(o),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(o,v,V){const g=this.Fo().activeCamera;if(!g)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,Q=void 0!==this.shadowMinZ?this.shadowMinZ:g.Xg,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:g.maxZ,n=this.Fo().getEngine().Ug;I.Matrix.PerspectiveFovLHToRef(E,1,n?U:Q,n?Q:U,o,!0,this._scene.getEngine().isNDCHalfZRange,void 0,n)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),I.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const o=this.projectionTextureLightFar,v=this.projectionTextureLightNear,V=o/(o-v),g=-V*v,E=1/Math.tan(this._angle/2);I.Matrix.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,V,1,0,0,g,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof O.e){const o=this._projectionTexture.uScale/2,v=this._projectionTexture.vScale/2;I.Matrix.FromValuesToRef(o,0,0,0,0,v,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(o,v){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),o.setMatrix("textureProjectionMatrix"+v,this._projectionTextureMatrix),o.setTexture("projectionLightTexture"+v,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&o.setTexture("iesLightTexture"+v,this._iesProfileTexture),this}transferToEffect(o,v){let V;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,v),V=I.cv.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,v),V=I.cv.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",V.x,V.y,V.z,this._cosHalfAngle,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,v),this}transferToNodeMaterialEffect(o,v){let V;return V=this.computeTransformedInformation()?I.cv.Normalize(this.transformedDirection):I.cv.Normalize(this.direction),this.Fo().useRightHandedSystem?o.setFloat3(v,-V.x,-V.y,-V.z):o.setFloat3(v,V.x,V.y,V.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(o){const v=this._scene.getEngine(),V=void 0!==this.shadowMinZ?this.shadowMinZ:(null===o||void 0===o?void 0:o.Xg)??0;return v.Ug&&v.isNDCHalfZRange?V:this._scene.getEngine().isNDCHalfZRange?0:V}getDepthMaxZ(o){const v=this._scene.getEngine(),V=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===o||void 0===o?void 0:o.maxZ)??1e4;return v.Ug&&v.isNDCHalfZRange?0:V}prepareLightSpecificDefines(o,v){o["SPOTLIGHT"+v]=!0,o["PROJECTEDLIGHTTEXTURE"+v]=!(!this.projectionTexture||!this.projectionTexture.isReady()),o["IESLIGHTTEXTURE"+v]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,g.c)([(0,E.K)()],x.prototype,"angle",null),(0,g.c)([(0,E.K)()],x.prototype,"innerAngle",null),(0,g.c)([(0,E.K)()],x.prototype,"shadowAngleScale",null),(0,g.c)([(0,E.K)()],x.prototype,"exponent",void 0),(0,g.c)([(0,E.K)()],x.prototype,"projectionTextureLightNear",null),(0,g.c)([(0,E.K)()],x.prototype,"projectionTextureLightFar",null),(0,g.c)([(0,E.K)()],x.prototype,"projectionTextureUpDirection",null),(0,g.c)([(0,E.C)("projectedLightTexture")],x.prototype,"_projectionTexture",void 0),(0,h.h)("BABYLON.SpotLight",x)},13928:(o,v,V)=>{"use strict";V.d(v,{c:()=>Q,g:()=>I,i:()=>U});const g={},E={};function I(o,v){g[o]=v}function Q(o,v){E[o]=v}function U(o){return E[o]?E[o]:null}},13819:(o,v,V)=>{"use strict";V.d(v,{c:()=>u,e:()=>M});var g,E=V(12291),I=V(12297),Q=V(12747),U=V(12339),n=V(12308),O=V(12979),h=V(12347),x=V(12354),f=V(12452),l=V(12381),S=V(12332);!function(o){o[o.Clean=0]="Clean",o[o.Stop=1]="Stop",o[o.Sync=2]="Sync",o[o.NoSync=3]="NoSync"}(g||(g={}));const T=new I.e,c={};let R=!1;function j(){return c[".babylon"]}function t(o,v){const V=c[o];return V||(n.b.Warn("Unable to find a plugin to load "+o+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),v?j():void 0)}function s(o,v,V){let g="Unable to load from "+(o.rawData?"binary data":o.url);return v?g+=`: ${v}`:V&&(g+=`: ${V}`),g}async function L(o,v,V,g,E,I,Q,U,n){var O;const x="data:"===(f=o.url).substring(0,5)?f.substring(5):null;var f;if(o.rawData&&!Q)throw"When using ArrayBufferView to load data the file extension must be provided.";const R=x||Q?"":function(o){const v=o.indexOf("?");-1!==v&&(o=o.substring(0,v));const V=o.lastIndexOf(".");return o.substring(V,o.length).toLowerCase()}(o.url);let s=Q?t(Q,!0):x?function(o){for(const v in c){const V=c[v].plugin;if(V.canDirectLoad&&V.canDirectLoad(o))return c[v]}return j()}(o.url):t(R,!1);if(!s&&R){if(o.url&&!o.url.startsWith("blob:")){const v=await async function(o,v){const V=v.method||"GET";return await new Promise(((g,E)=>{const I=new S.b;I.addEventListener("readystatechange",(()=>{if(4==I.readyState)if(200==I.status){const o={};if(v.responseHeaders)for(const V of v.responseHeaders)o[V]=I.getResponseHeader(V)||"";g({response:I.response,headerValues:o})}else E(`Unable to fetch data from ${o}. Error code: ${I.status}`)})),I.open(V,o),I.send()}))}(o.url,{method:"HEAD",responseHeaders:["Content-Type"]}),V=v.headerValues?v.headerValues["Content-Type"]:"";V&&(s=function(o){for(const v in c){const V=c[v];if(V.mimeType===o)return V}}(V))}s||(s=j())}if(!s)throw new Error(`No plugin or fallback for ${Q??o.url}`);if(!1===(null===n||void 0===n||null===(O=n[s.plugin.name])||void 0===O?void 0:O.enabled))throw new Error(`The '${s.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(o.rawData&&!s.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(o=>{if(s.plugin.createPlugin){const v=s.plugin.createPlugin(n??{});return v instanceof Promise?(v.then(o).catch((o=>{E("Error instantiating plugin.",o)})),null):(o(v),v)}return o(s.plugin),s.plugin})((n=>{var O;if(!n)throw`The loader plugin corresponding to the '${Q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(T.notifyObservers(n),x&&(n.canDirectLoad&&n.canDirectLoad(o.url)||!(0,h.h)(o.url))){if(n.directLoad){const o=n.directLoad(v,x);o instanceof Promise?o.then((o=>{V(n,o)})).catch((o=>{E("Error in directLoad of _loadData: "+o,o)})):V(n,o)}else V(n,x);return}const f=s.isBinary,S=(o,g)=>{v.l?E("Scene has been disposed"):V(n,o,g)};let c=null,R=!1;null===(O=n.Tg)||void 0===O||O.add((()=>{R=!0,c&&(c.abort(),c=null),I()}));const j=()=>{if(R)return;const V=(o,v)=>{E(null===o||void 0===o?void 0:o.statusText,v)};if(!n.loadFile&&o.rawData)throw"Plugin does not support loading ArrayBufferView.";c=n.loadFile?n.loadFile(v,o.rawData||o.file||o.url,o.rootUrl,S,g,f,V,U):v._loadFile(o.file||o.url,S,g,!0,f,V)},t=v.getEngine();let L=t.enableOfflineSupport;if(L){let V=!1;for(const g of v.disableOfflineSupportExceptionRules)if(g.test(o.url)){V=!0;break}L=!V}L&&l.c.OfflineProviderFactory?v.offlineProvider=l.c.OfflineProviderFactory(o.url,j,t.disableManifestCheck):j()}))}function b(o,v){let V,g,I=null,Q=null;if(v)if(v.name)V=`file:${v.name}`,g=v.name,I=v;else if(ArrayBuffer.isView(v))V="",g=(0,f.b)(),Q=v;else if(v.startsWith("data:"))V=v,g="";else if(o){const I=v;if("/"===I.substring(0,1))return E.Tools.Error("Wrong sceneFilename parameter"),null;V=o+I,g=I}else V=v,g=E.Tools.GetFilename(v),o=E.Tools.GetFolderPath(v);else V=o,g=E.Tools.GetFilename(o),o=E.Tools.GetFolderPath(o);return{url:V,rootUrl:o,name:g,file:I,rawData:Q}}function u(o){if("string"===typeof o.extensions){const v=o.extensions;c[v.toLowerCase()]={plugin:o,isBinary:!1}}else{const v=o.extensions,V=Object.keys(v);for(const g of V)c[g.toLowerCase()]={plugin:o,isBinary:v[g].isBinary,mimeType:v[g].mimeType}}}async function mo(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U.d.LastCreatedScene,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!g)return n.b.Error("No scene available to import mesh to"),null;const l=b(v,V);if(!l)return null;const S={};g.addPendingData(S);const T=()=>{g.removePendingData(S)},c=(o,v)=>{const V=s(l,o,v);Q?Q(g,V,new x.i(V,x.f.SceneLoaderError,v)):n.b.Error(V),T()},R=I?o=>{try{I(o)}catch(v){c("Error in onProgress callback: "+v,v)}}:void 0,j=(o,v,V,I,Q,U,n,O)=>{if(g.importedMeshesFiles.push(l.url),E)try{E(o,v,V,I,Q,U,n,O)}catch(h){c("Error in onSuccess callback: "+h,h)}g.removePendingData(S)};return await L(l,g,((v,V,E)=>{if(v.rewriteRootURL&&(l.rootUrl=v.rewriteRootURL(l.rootUrl,E)),v.importMesh){const E=[],I=[],Q=[];if(!v.importMesh(o,g,V,l.rootUrl,E,I,Q,c))return;g.loadingPluginName=v.name,j(E,I,Q,[],[],[],[],[])}else{v.importMeshAsync(o,g,V,l.rootUrl,R,l.name).then((o=>{g.loadingPluginName=v.name,j(o.meshes,o.Mf,o.skeletons,o.animationGroups,o.transformNodes,o.geometries,o.lights,o.spriteManagers)})).catch((o=>{c(o.message,o)}))}}),R,c,T,O,h,f)}async function a(o,v,V,g,E,I,Q,U){return await new Promise(((n,O)=>{try{mo(o,v,V,g,((o,v,V,g,E,I,Q,U)=>{n({meshes:o,Mf:v,skeletons:V,animationGroups:g,transformNodes:E,geometries:I,lights:Q,spriteManagers:U})}),E,((o,v,V)=>{O(V||new Error(v))}),I,Q,U).catch(O)}catch(x){O(x)}}))}async function F(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.d.LastCreatedEngine,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};V?await J(o,v,new Q.b(V),g,I,n,O,h,x):E.Tools.Error("No engine available")}async function i(o,v,V,g,E,I,Q){return await new Promise(((U,n)=>{F(o,v,V,(o=>{U(o)}),g,((o,v,V)=>{n(V||new Error(v))}),E,I,Q)}))}async function J(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.d.LastCreatedScene,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!V)return n.b.Error("No scene available to append to"),null;const l=b(o,v);if(!l)return null;const S={};V.addPendingData(S);const T=()=>{V.removePendingData(S)};O.e.ShowLoadingScreen&&!R&&(R=!0,V.getEngine().displayLoadingUI(),V.executeWhenReady((()=>{V.getEngine().hideLoadingUI(),R=!1})));const c=(o,v)=>{const g=s(l,o,v);I?I(V,g,new x.i(g,x.f.SceneLoaderError,v)):n.b.Error(g),T()},j=E?o=>{try{E(o)}catch(v){c("Error in onProgress callback",v)}}:void 0,t=()=>{if(g)try{g(V)}catch(o){c("Error in onSuccess callback",o)}V.removePendingData(S)};return await L(l,V,((o,v)=>{if(o.load){if(!o.load(V,v,l.rootUrl,c))return;V.loadingPluginName=o.name,t()}else{o.loadAsync(V,v,l.rootUrl,j,l.name).then((()=>{V.loadingPluginName=o.name,t()})).catch((o=>{c(o.message,o)}))}}),j,c,T,Q,h,f)}async function d(o,v,V,g,E,I,Q){return await new Promise(((U,n)=>{try{J(o,v,V,(o=>{U(o)}),g,((o,v,V)=>{n(V||new Error(v))}),E,I,Q).catch(n)}catch(x){n(x)}}))}async function N(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.d.LastCreatedScene,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!V)return n.b.Error("No scene available to load asset container to"),null;const f=b(o,v);if(!f)return null;const l={};V.addPendingData(l);const S=()=>{V.removePendingData(l)},T=(o,v)=>{const g=s(f,o,v);I?I(V,g,new x.i(g,x.f.SceneLoaderError,v)):n.b.Error(g),S()},c=E?o=>{try{E(o)}catch(v){T("Error in onProgress callback",v)}}:void 0,R=o=>{if(g)try{g(o)}catch(v){T("Error in onSuccess callback",v)}V.removePendingData(l)};return await L(f,V,((o,v)=>{if(o.loadAssetContainer){const g=o.loadAssetContainer(V,v,f.rootUrl,T);if(!g)return;g.populateRootNodes(),V.loadingPluginName=o.name,R(g)}else if(o.loadAssetContainerAsync){o.loadAssetContainerAsync(V,v,f.rootUrl,c,f.name).then((v=>{v.populateRootNodes(),V.loadingPluginName=o.name,R(v)})).catch((o=>{T(o.message,o)}))}else T("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,T,S,Q,O,h)}async function Y(o,v,V,g,E,I,Q){return await new Promise(((U,n)=>{try{N(o,v,V,(o=>{U(o)}),g,((o,v,V)=>{n(V||new Error(v))}),E,I,Q).catch(n)}catch(x){n(x)}}))}async function q(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.d.LastCreatedScene,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!V)return void n.b.Error("No scene available to load animations to");if(g){for(const g of V.animatables)g.reset();V.stopAllAnimations();const o=V.animationGroups.slice();for(const V of o)V.dispose();const v=V.getNodes();for(const V of v)V.animations&&(V.animations=[])}else switch(E){case 0:const o=V.animationGroups.slice();for(const v of o)v.dispose();break;case 1:for(const v of V.animationGroups)v.stop();break;case 2:for(const v of V.animationGroups)v.reset(),v.restart();break;case 3:break;default:return void n.b.Error("Unknown animation group loading mode value '"+E+"'")}const S=V.animatables.length;await N(o,v,V,(o=>{o.mergeAnimationsTo(V,V.animatables.slice(S),I),o.dispose(),V.onAnimationFileImportedObservable.notifyObservers(V),Q&&Q(V)}),O,h,x,f,l)}async function P(o,v,V,g,E,I,Q,U,n,O){return await new Promise(((h,f)=>{try{q(o,v,V,g,E,I,(o=>{h(o)}),Q,((o,v,V)=>{f(V||new Error(v))}),U,n,O).catch(f)}catch(x){f(x)}}))}class M{static get ForceFullSceneLoadingForIncremental(){return O.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(o){O.e.ForceFullSceneLoadingForIncremental=o}static get ShowLoadingScreen(){return O.e.ShowLoadingScreen}static set ShowLoadingScreen(o){O.e.ShowLoadingScreen=o}static get loggingLevel(){return O.e.loggingLevel}static set loggingLevel(o){O.e.loggingLevel=o}static get CleanBoneMatrixWeights(){return O.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(o){O.e.CleanBoneMatrixWeights=o}static GetDefaultPlugin(){return j()}static GetPluginForExtension(o){var v;return null===(v=t(o,!0))||void 0===v?void 0:v.plugin}static IsPluginForExtensionAvailable(o){return function(o){return!!c[o]}(o)}static RegisterPlugin(o){u(o)}static ImportMesh(o,v,V,g,E,I,Q,n,O){mo(o,v,V,g,E,I,Q,n,O).catch((o=>null===Q||void 0===Q?void 0:Q(U.d.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async ImportMeshAsync(o,v,V,g,E,I,Q){return await a(o,v,V,g,E,I,Q)}static Load(o,v,V,g,E,I,Q,n){F(o,v,V,g,E,I,Q,n).catch((o=>null===I||void 0===I?void 0:I(U.d.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async LoadAsync(o,v,V,g,E,I){return await i(o,v,V,g,E,I)}static Append(o,v,V,g,E,I,Q,n){J(o,v,V,g,E,I,Q,n).catch((o=>null===I||void 0===I?void 0:I(V??U.d.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async AppendAsync(o,v,V,g,E,I){return await d(o,v,V,g,E,I)}static LoadAssetContainer(o,v,V,g,E,I,Q,n){N(o,v,V,g,E,I,Q,n).catch((o=>null===I||void 0===I?void 0:I(V??U.d.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async LoadAssetContainerAsync(o,v,V,g,E,I){return await Y(o,v,V,g,E,I)}static ImportAnimations(o,v,V,g,E,I,Q,n,O,h,x){q(o,v,V,g,E,I,Q,n,O,h,x).catch((o=>null===O||void 0===O?void 0:O(V??U.d.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async ImportAnimationsAsync(o,v,V,g,E,I,Q,U,n,O,h){return await P(o,v,V,g,E,I,U,O,h)}}M.NO_LOGGING=0,M.MINIMAL_LOGGING=1,M.SUMMARY_LOGGING=2,M.DETAILED_LOGGING=3,M.OnPluginActivatedObservable=T},14208:(o,v,V)=>{"use strict";V.d(v,{b:()=>f});var g=V(12473),E=V(12479),I=V(12291),Q=V(12488),U=V(12518),n=V(12471),O=V(12449),h=V(12297),x=V(12535);V(14211);class f extends U.b{set boundingBoxSize(o){if(this._boundingBoxSize&&this._boundingBoxSize.equals(o))return;this._boundingBoxSize=o;const v=this.Fo();v&&v.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(o){this._rotationY=o,this.setReflectionTextureMatrix(Q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(o,v,V){let g="";for(const E of o)g+=E;return new f(g,v,null,V,o)}static CreateFromPrefilteredData(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=v.useDelayedTextureLoading;v.useDelayedTextureLoading=!1;const I=new f(o,v,null,!1,null,null,null,void 0,!0,V,g);return v.useDelayedTextureLoading=E,I}constructor(o,v){var V;let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,S=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,R=arguments.length>13?arguments[13]:void 0,j=arguments.length>14?arguments[14]:void 0;super(v),this.onLoadObservable=new h.e,this.boundingBoxPosition=Q.cv.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Q.Matrix,this._buffer=null,this.name=o,this.url=o,this._noMipmap=E,this.Kg=!1,this.isCube=!0,this._textureMatrix=Q.Matrix.Identity(),this.coordinatesMode=n.e.CUBIC_MODE;let t=null,s=null;null===g||Array.isArray(g)?(this._noMipmap=E,this._format=x,this._createPolynomials=S,t=g,this._loaderOptions=R,this._useSRGBBuffer=j,this._lodScale=T,this._lodOffset=c):(t=g.extensions??null,this._noMipmap=g.noMipmap??!1,I=g.files??null,s=g.buffer??null,this._format=g.format??5,f=g.prefiltered??!1,l=g.forcedExtension??null,this._createPolynomials=g.createPolynomials??!1,this._lodScale=g.lodScale??.8,this._lodOffset=g.lodOffset??0,this._loaderOptions=g.loaderOptions,this._useSRGBBuffer=g.useSRGBBuffer,U=g.C??null,O=g.onError??null),(o||I)&&this.updateURL(o,l,U,f,O,t,null===(V=this.Fo())||void 0===V?void 0:V.useDelayedTextureLoading,I,s)}getClassName(){return"CubeTexture"}updateURL(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=o),this.url=o,v&&(this._forcedExtension=v);const O=o.lastIndexOf("."),h=v||(O>-1?o.substring(O).toLowerCase():""),x=0===h.indexOf(".dds"),f=0===h.indexOf(".env"),l=0===h.indexOf(".basis");if(f?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=g,g&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),U)this._files=U;else if(l||f||x||I||(I=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,I){for(let v=0;v<I.length;v++)this._files.push(o+I[v]);this._extensions=I}this._buffer=n,Q?(this.delayLoadState=4,this._delayedOnLoad=V,this._delayedOnError=E):this._loadTexture(V,E)}delayLoad(o){4===this.delayLoadState&&(o&&(this._forcedExtension=o),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(o){var v,V;if(o.updateFlag===this._textureMatrix.updateFlag)return;o.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(V=this.Fo())||void 0===V||V.markAllMaterialsAsDirty(1,(o=>-1!==o.getActiveTextures().indexOf(this))));if(this._textureMatrix=o,null===(v=this.Fo())||void 0===v||!v.useRightHandedSystem)return;const g=Q.TmpVectors.cv[0],E=Q.TmpVectors.Quaternion[0],I=Q.TmpVectors.cv[1];this._textureMatrix.decompose(g,E,I),E.z*=-1,E.w*=-1,Q.Matrix.ComposeToRef(g,E,I,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var o;return null!==(o=this.Fo())&&void 0!==o&&o.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this.Fo(),g=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const E=()=>{var v;(this.onLoadObservable.notifyObservers(this),g)&&(g.dispose(),null===(v=this.Fo())||void 0===v||v.markAllMaterialsAsDirty(1));o&&o()},Q=(o,V)=>{this._loadingError=!0,this._errorObject={message:o,exception:V},v&&v(o,V),n.e.OnTextureLoadErrorObservable.notifyObservers(this)};var U;this._texture?this._texture.isReady?I.Tools.SetImmediate((()=>E())):this._texture.onLoadedObservable.add((()=>E())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,V,this._lodScale,this._lodOffset,o,Q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,V,this._files,this._noMipmap,o,Q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(U=this._texture)||void 0===U||U.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(o,v,V){const g=x.c.Parse((()=>{let g=!1;return o.prefiltered&&(g=o.prefiltered),new f(V+(o.url??o.name),v,o.extensions,!1,o.files||null,null,null,void 0,g,o.forcedExtension)}),o,v);if(o.boundingBoxPosition&&(g.boundingBoxPosition=Q.cv.bv(o.boundingBoxPosition)),o.boundingBoxSize&&(g.boundingBoxSize=Q.cv.bv(o.boundingBoxSize)),o.animations)for(let E=0;E<o.animations.length;E++){const v=o.animations[E],V=(0,O.d)("BABYLON.Animation");V&&g.animations.push(V.Parse(v))}return g}clone(){let o=0;const v=x.c.Clone((()=>{const v=new f(this.url,this.Fo()||this._getEngine(),this._extensions,this._noMipmap,this._files);return o=v.uniqueId,v}),this);return v.uniqueId=o,v}}(0,g.c)([(0,E.K)()],f.prototype,"url",void 0),(0,g.c)([(0,E.G)()],f.prototype,"boundingBoxPosition",void 0),(0,g.c)([(0,E.G)()],f.prototype,"boundingBoxSize",null),(0,g.c)([(0,E.K)("rotationY")],f.prototype,"rotationY",null),(0,g.c)([(0,E.K)("files")],f.prototype,"_files",void 0),(0,g.c)([(0,E.K)("forcedExtension")],f.prototype,"_forcedExtension",void 0),(0,g.c)([(0,E.K)("extensions")],f.prototype,"_extensions",void 0),(0,g.c)([(0,E.u)("textureMatrix")],f.prototype,"_textureMatrix",void 0),(0,g.c)([(0,E.u)("textureMatrixRefraction")],f.prototype,"_textureMatrixRefraction",void 0),n.e._CubeTextureParser=f.Parse,(0,O.h)("BABYLON.CubeTexture",f)},14719:(o,v,V)=>{"use strict";V.d(v,{c:()=>n});var g=V(12308),E=V(12471),I=V(12454),Q=V(12628),U=V(12418);Q.ThinEngine.prototype.createDynamicTexture=function(o,v,V,g){const E=new U.c(this,4);return E.baseWidth=o,E.baseHeight=v,V&&(o=this.needPOTTextures?(0,I.d)(o,this._caps.maxTextureSize):o,v=this.needPOTTextures?(0,I.d)(v,this._caps.maxTextureSize):v),E.width=o,E.height=v,E.isReady=!1,E.generateMipMaps=V,E.samplingMode=g,this.updateTextureSamplingMode(g,E),this._internalTexturesCache.push(E),E},Q.ThinEngine.prototype.updateDynamicTexture=function(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!o)return;const Q=this._gl,U=Q.TEXTURE_2D,n=this._bindTextureDirectly(U,o,!0,I);this._unpackFlipY(void 0===V?o.invertY:V),g&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const O=this._getWebGLTextureType(o.type),h=this._getInternalFormat(E||o.format),x=this._getRGBABufferInternalSizedFormat(o.type,h);Q.texImage2D(U,0,x,h,O,v),o.generateMipMaps&&Q.generateMipmap(U),n||this._bindTextureDirectly(U,null),g&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E&&(o.format=E),o._dynamicTextureSource=v,o._premulAlpha=g,o.invertY=V||!1,o.isReady=!0};class n extends E.e{constructor(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,U=arguments.length>6?arguments[6]:void 0;const n=!V||V._isScene;super(null,n?V:null===V||void 0===V?void 0:V.jv,n?!g:V,U,I,void 0,void 0,void 0,void 0,Q),this.name=o,this.wrapU=E.e.CLAMP_ADDRESSMODE,this.wrapV=E.e.CLAMP_ADDRESSMODE,this._generateMipMaps=g;const O=this._getEngine();if(!O)return;if(v.getContext)this._canvas=v,this._ownCanvas=!1,this._texture=O.createDynamicTexture(this._canvas.width,this._canvas.height,g,I);else{this._canvas=O.createCanvas(1,1),this._ownCanvas=!0;const o=v;o.width||0===o.width?this._texture=O.createDynamicTexture(o.width,o.height,g,I):this._texture=O.createDynamicTexture(v,v,g,I)}const h=this.getSize();this._canvas.width!==h.width&&(this._canvas.width=h.width),this._canvas.height!==h.height&&(this._canvas.height=h.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(o){this._canvas.width=o.width,this._canvas.height=o.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(o.width,o.height,this._generateMipMaps,this.samplingMode)}scale(o){const v=this.getSize();v.width*=o,v.height*=o,this._recreate(v)}scaleTo(o,v){const V=this.getSize();V.width=o,V.height=v,this._recreate(V)}getContext(){return this._context}clear(o){const v=this.getSize();o&&(this._context.fillStyle=o),this._context.clearRect(0,0,v.width,v.height)}update(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===o||o,v,this._format||void 0,void 0,V)}drawText(o,v,V,g,E,I,Q){let U=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const n=this.getSize();if(I&&(this._context.fillStyle=I,this._context.fillRect(0,0,n.width,n.height)),this._context.font=g,null===v||void 0===v){const V=this._context.measureText(o);v=(n.width-V.width)/2}if(null===V||void 0===V){const o=parseInt(g.replace(/\D/g,""));V=n.height/2+o/3.65}this._context.fillStyle=E||"",this._context.fillText(o,v,V),U&&this.update(Q)}dispose(){var o,v;(super.dispose(),this._ownCanvas)&&(null===(o=this._canvas)||void 0===o||null===(v=o.remove)||void 0===v||v.call(o));this._canvas=null,this._context=null}clone(){const o=this.Fo();if(!o)return this;const v=this.getSize(),V=new n(this.name,v,o,this._generateMipMaps);return V.Kg=this.Kg,V.level=this.level,V.wrapU=this.wrapU,V.wrapV=this.wrapV,V}serialize(){const o=this.Fo();o&&!o.isReady()&&g.b.Warn("The scene must be ready before serializing the dynamic texture");const v=super.serialize();return n._IsCanvasElement(this._canvas)&&(v.base64String=this._canvas.toDataURL()),v.invertY=this._invertY,v.samplingMode=this.samplingMode,v}static _IsCanvasElement(o){return void 0!==o.toDataURL}_rebuild(){this.update()}}},14131:(o,v,V)=>{"use strict";V.d(v,{c:()=>E});var g=V(12471);class E extends g.e{get depth(){return this._depth}constructor(o,v,V,E,I,Q){let U=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],n=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:g.e.TRILINEAR_SAMPLINGMODE,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;super(null,Q,!U,n),this.format=I,this._texture=Q.getEngine().createRawTexture2DArray(o,v,V,E,I,U,n,O,null,h,x),this._depth=E,this.is2DArray=!0}update(o){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,o,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(o,v,V,g,I){return new E(o,v,V,g,5,I,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13948:(o,v,V)=>{"use strict";V.d(v,{e:()=>U,i:()=>n,j:()=>I,l:()=>Q});var g=V(12511),E=V(12488);function I(o,v){return`{X: ${o.x.toFixed(v)} Y: ${o.y.toFixed(v)}}`}function Q(o,v){return`{X: ${o._x.toFixed(v)} Y: ${o._y.toFixed(v)} Z: ${o._z.toFixed(v)}}`}function U(o,v){return 2*Math.acos((0,g.Clamp)(E.Quaternion.Dot(o,v)))}function n(o,v){const V=new E.Quaternion;return function(o,v,V){const I=E.cv.Cross(o,v),Q=Math.acos((0,g.Clamp)(E.cv.Dot(o,v),-1,1));E.Quaternion.RotationAxisToRef(I,Q,V)}(o,v,V),V}},13762:(o,v,V)=>{"use strict";V.d(v,{b:()=>O});var g=V(12488),E=V(12547),I=V(12958),Q=V(12944),U=V(12564);V(13770);function n(o){let v=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const V=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],I=[];let n=[];const O=o.width||o.size||1,h=o.height||o.size||1,x=o.depth||o.size||1,f=o.wrap||!1;let l=void 0===o.topBaseAt?1:o.topBaseAt,S=void 0===o.bottomBaseAt?0:o.bottomBaseAt;l=(l+4)%4,S=(S+4)%4;let T=[2,0,3,1][l],c=[2,0,1,3][S],R=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(f){v=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],R=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let o=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],V=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const g=[17,18,19,16],E=[22,23,20,21];for(;T>0;)o.unshift(o.pop()),g.unshift(g.pop()),T--;for(;c>0;)V.unshift(V.pop()),E.unshift(E.pop()),c--;o=o.flat(),V=V.flat(),R=R.concat(o).concat(V),v.push(g[0],g[2],g[3],g[0],g[1],g[2]),v.push(E[0],E[2],E[3],E[0],E[1],E[2])}const j=[O/2,h/2,x/2];n=R.reduce(((o,v,V)=>o.concat(v*j[V%3])),[]);const t=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,s=o.faceUV||new Array(6),L=o.faceColors,b=[];for(let Q=0;Q<6;Q++)void 0===s[Q]&&(s[Q]=new g.Vector4(0,0,1,1)),L&&void 0===L[Q]&&(L[Q]=new E.sU(1,1,1,1));for(let g=0;g<6;g++)if(I.push(s[g].z,U.e?1-s[g].w:s[g].w),I.push(s[g].x,U.e?1-s[g].w:s[g].w),I.push(s[g].x,U.e?1-s[g].y:s[g].y),I.push(s[g].z,U.e?1-s[g].y:s[g].y),L)for(let o=0;o<4;o++)b.push(L[g].r,L[g].g,L[g].b,L[g].a);Q.d._ComputeSides(t,n,v,V,I,o.frontUVs,o.backUVs);const u=new Q.d;if(u.indices=v,u.Jo=n,u.do=V,u.Yo=I,L){const o=t===Q.d.DOUBLESIDE?b.concat(b):b;u.No=o}return u}function O(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new I.e(o,V);v.sideOrientation=I.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return n(v).Po(g,v.updatable),g}Q.d.CreateBox=n,I.e.CreateBox=function(o,v){return O(o,{size:v,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13935:(o,v,V)=>{"use strict";V.d(v,{e:()=>U});var g=V(12958),E=V(12944),I=V(12564);function Q(o){const v=[],V=[],g=[],Q=[],U=o.radius||.5,n=o.tessellation||64,O=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1,h=0===o.sideOrientation?0:o.sideOrientation||E.d.DEFAULTSIDE;v.push(0,0,0),Q.push(.5,.5);const x=2*Math.PI*O,f=1===O?x/n:x/(n-1);let l=0;for(let E=0;E<n;E++){const o=Math.cos(l),V=Math.sin(l),g=(o+1)/2,E=(1-V)/2;v.push(U*o,U*V,0),Q.push(g,I.e?1-E:E),l+=f}1===O&&(v.push(v[3],v[4],v[5]),Q.push(Q[2],I.e?1-Q[3]:Q[3]));const S=v.length/3;for(let E=1;E<S-1;E++)V.push(E+1,0,E);E.d.ComputeNormals(v,V,g),E.d._ComputeSides(h,v,V,g,Q,o.frontUVs,o.backUVs);const T=new E.d;return T.indices=V,T.Jo=v,T.do=g,T.Yo=Q,T}function U(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new g.e(o,V);v.sideOrientation=g.e._GetDefaultSideOrientation(v.sideOrientation),E._originalBuilderSideOrientation=v.sideOrientation;return Q(v).Po(E,v.updatable),E}E.d.CreateDisc=Q,g.e.CreateDisc=function(o,v,V){return U(o,{radius:v,tessellation:V,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13770:(o,v,V)=>{"use strict";V.d(v,{g:()=>c,d:()=>j,i:()=>R});var g=V(12488),E=V(12547),I=V(12958),Q=V(12944),U=V(12577);I.e._GroundMeshParser=(o,v)=>n.Parse(o,v);class n extends I.e{constructor(o,v){super(o,v),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=o,this._subdivisionsY=o,this.subdivide(o);const V=this;V.createOrUpdateSubmeshesOctree&&V.createOrUpdateSubmeshesOctree(v)}getHeightAtCoordinates(o,v){const V=this.getWorldMatrix(),E=g.TmpVectors.Matrix[5];V.invertToRef(E);const I=g.TmpVectors.cv[8];if(g.cv.TransformCoordinatesFromFloatsToRef(o,0,v,E,I),o=I.x,v=I.z,o<this._minX||o>=this._maxX||v<=this._minZ||v>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Q=this._getFacetAt(o,v),U=-(Q.x*o+Q.z*v+Q.w)/Q.y;return g.cv.TransformCoordinatesFromFloatsToRef(0,U,0,V,I),I.y}getNormalAtCoordinates(o,v){const V=new g.cv(0,1,0);return this.getNormalAtCoordinatesToRef(o,v,V),V}getNormalAtCoordinatesToRef(o,v,V){const E=this.getWorldMatrix(),I=g.TmpVectors.Matrix[5];E.invertToRef(I);const Q=g.TmpVectors.cv[8];if(g.cv.TransformCoordinatesFromFloatsToRef(o,0,v,I,Q),o=Q.x,v=Q.z,o<this._minX||o>this._maxX||v<this._minZ||v>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const U=this._getFacetAt(o,v);return g.cv.TransformNormalFromFloatsToRef(U.x,U.y,U.z,E,V),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(o,v){const V=Math.floor((o+this._maxX)*this._subdivisionsX/this._width),g=Math.floor(-(v+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),E=this._heightQuads[g*this._subdivisionsX+V];let I;return I=v<E.slope.x*o+E.slope.y?E.facet1:E.facet2,I}_initHeightQuads(){const o=this._subdivisionsX,v=this._subdivisionsY;this._heightQuads=[];for(let V=0;V<v;V++)for(let v=0;v<o;v++){const E={slope:g.Vector2.Zero(),facet1:new g.Vector4(0,0,0,0),facet2:new g.Vector4(0,0,0,0)};this._heightQuads[V*o+v]=E}return this}_computeHeightQuads(){const o=this.getVerticesData(U.e.PositionKind);if(!o)return this;const v=g.TmpVectors.cv[3],V=g.TmpVectors.cv[2],E=g.TmpVectors.cv[1],I=g.TmpVectors.cv[0],Q=g.TmpVectors.cv[4],n=g.TmpVectors.cv[5],O=g.TmpVectors.cv[6],h=g.TmpVectors.cv[7],x=g.TmpVectors.cv[8];let f=0,l=0,S=0,T=0,c=0,R=0,j=0;const t=this._subdivisionsX,s=this._subdivisionsY;for(let U=0;U<s;U++)for(let s=0;s<t;s++){f=3*s,l=U*(t+1)*3,S=(U+1)*(t+1)*3,v.x=o[l+f],v.y=o[l+f+1],v.z=o[l+f+2],V.x=o[l+f+3],V.y=o[l+f+4],V.z=o[l+f+5],E.x=o[S+f],E.y=o[S+f+1],E.z=o[S+f+2],I.x=o[S+f+3],I.y=o[S+f+4],I.z=o[S+f+5],T=(I.z-v.z)/(I.x-v.x),c=v.z-T*v.x,V.subtractToRef(v,Q),E.subtractToRef(v,n),I.subtractToRef(v,O),g.cv.CrossToRef(O,n,h),g.cv.CrossToRef(Q,O,x),h.normalize(),x.normalize(),R=-(h.x*v.x+h.y*v.y+h.z*v.z),j=-(x.x*V.x+x.y*V.y+x.z*V.z);const L=this._heightQuads[U*t+s];L.slope.RU(T,c),L.facet1.RU(h.x,h.y,h.z,R),L.facet2.RU(x.x,x.y,x.z,j)}return this}serialize(o){super.serialize(o),o.subdivisionsX=this._subdivisionsX,o.subdivisionsY=this._subdivisionsY,o.minX=this._minX,o.maxX=this._maxX,o.Xg=this._minZ,o.maxZ=this._maxZ,o.width=this._width,o.height=this._height}static Parse(o,v){const V=new n(o.name,v);return V._subdivisionsX=o.subdivisionsX||1,V._subdivisionsY=o.subdivisionsY||1,V._minX=o.minX,V._maxX=o.maxX,V._minZ=o.Xg,V._maxZ=o.maxZ,V._width=o.width,V._height=o.height,V}}var O=V(12291),h=V(12339),x=V(12497),f=V(12564);function l(o){const v=[],V=[],E=[],I=[];let U,n;const O=o.width||o.size||1,h=o.height||o.size||1,x=0|(o.subdivisionsX||o.subdivisions||1),l=0|(o.subdivisionsY||o.subdivisions||1);for(U=0;U<=l;U++)for(n=0;n<=x;n++){const o=new g.cv(n*O/x-O/2,0,(l-U)*h/l-h/2),v=new g.cv(0,1,0);V.push(o.x,o.y,o.z),E.push(v.x,v.y,v.z),I.push(n/x,f.e?U/l:1-U/l)}for(U=0;U<l;U++)for(n=0;n<x;n++)v.push(n+1+(U+1)*(x+1)),v.push(n+1+U*(x+1)),v.push(n+U*(x+1)),v.push(n+(U+1)*(x+1)),v.push(n+1+(U+1)*(x+1)),v.push(n+U*(x+1));const S=new Q.d;return S.indices=v,S.Jo=V,S.do=E,S.Yo=I,S}function S(o){const v=void 0!==o.xmin&&null!==o.xmin?o.xmin:-1,V=void 0!==o.zmin&&null!==o.zmin?o.zmin:-1,E=void 0!==o.xmax&&null!==o.xmax?o.xmax:1,I=void 0!==o.zmax&&null!==o.zmax?o.zmax:1,U=o.subdivisions||{w:1,h:1},n=o.precision||{w:1,h:1},O=[],h=[],x=[],f=[];let l,S,T,c;U.h=U.h<1?1:U.h,U.w=U.w<1?1:U.w,n.w=n.w<1?1:n.w,n.h=n.h<1?1:n.h;const R=(E-v)/U.w,j=(I-V)/U.h;function t(o,v,V,E){const I=h.length/3,Q=n.w+1;for(l=0;l<n.h;l++)for(S=0;S<n.w;S++){const o=[I+S+l*Q,I+(S+1)+l*Q,I+(S+1)+(l+1)*Q,I+S+(l+1)*Q];O.push(o[1]),O.push(o[2]),O.push(o[3]),O.push(o[0]),O.push(o[1]),O.push(o[3])}const U=g.cv.Zero(),T=new g.cv(0,1,0);for(l=0;l<=n.h;l++)for(U.z=l*(E-v)/n.h+v,S=0;S<=n.w;S++)U.x=S*(V-o)/n.w+o,U.y=0,h.push(U.x,U.y,U.z),x.push(T.x,T.y,T.z),f.push(S/n.w,l/n.h)}for(T=0;T<U.h;T++)for(c=0;c<U.w;c++)t(v+c*R,V+T*j,v+(c+1)*R,V+(T+1)*j);const s=new Q.d;return s.indices=O,s.Jo=h,s.do=x,s.Yo=f,s}function T(o){const v=[],V=[],I=[],U=[];let n,O;const h=o.colorFilter||new E.Lv(.3,.59,.11),f=o.alphaFilter||0;let l=!1;if(o.minHeight>o.maxHeight){l=!0;const v=o.maxHeight;o.maxHeight=o.minHeight,o.minHeight=v}for(n=0;n<=o.subdivisions;n++)for(O=0;O<=o.subdivisions;O++){const v=new g.cv(O*o.width/o.subdivisions-o.width/2,0,(o.subdivisions-n)*o.height/o.subdivisions-o.height/2),E=4*(((v.x+o.width/2)/o.width*(o.bufferWidth-1)|0)+((1-(v.z+o.height/2)/o.height)*(o.bufferHeight-1)|0)*o.bufferWidth);let Q=o.buffer[E]/255,S=o.buffer[E+1]/255,T=o.buffer[E+2]/255;const c=o.buffer[E+3]/255;l&&(Q=1-Q,S=1-S,T=1-T);const R=Q*h.r+S*h.g+T*h.b;v.y=c>=f?o.minHeight+(o.maxHeight-o.minHeight)*R:o.minHeight-x.d,o.heightBuffer&&(o.heightBuffer[n*(o.subdivisions+1)+O]=v.y),V.push(v.x,v.y,v.z),I.push(0,0,0),U.push(O/o.subdivisions,1-n/o.subdivisions)}for(n=0;n<o.subdivisions;n++)for(O=0;O<o.subdivisions;O++){const g=O+1+(n+1)*(o.subdivisions+1),E=O+1+n*(o.subdivisions+1),I=O+n*(o.subdivisions+1),Q=O+(n+1)*(o.subdivisions+1),U=V[3*g+1]>=o.minHeight,h=V[3*E+1]>=o.minHeight,x=V[3*I+1]>=o.minHeight;U&&h&&x&&(v.push(g),v.push(E),v.push(I));V[3*Q+1]>=o.minHeight&&U&&x&&(v.push(Q),v.push(g),v.push(I))}Q.d.ComputeNormals(V,v,I);const S=new Q.d;return S.indices=v,S.Jo=V,S.do=I,S.Yo=U,S}function c(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const V=new n(o,arguments.length>2?arguments[2]:void 0);V._setReady(!1),V._subdivisionsX=v.subdivisionsX||v.subdivisions||1,V._subdivisionsY=v.subdivisionsY||v.subdivisions||1,V._width=v.width||1,V._height=v.height||1,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ;return l(v).Po(V,v.updatable),V._setReady(!0),V}function R(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new I.e(o,V);return S(v).Po(g,v.updatable),g}function j(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const I=V.width||10,Q=V.height||10,U=V.subdivisions||1,x=V.minHeight||0,f=V.maxHeight||1,l=V.colorFilter||new E.Lv(.3,.59,.11),S=V.alphaFilter||0,c=V.updatable,R=V.onReady;g=g||h.d.LastCreatedScene;const j=new n(o,g);let t;j._subdivisionsX=U,j._subdivisionsY=U,j._width=I,j._height=Q,j._maxX=j._width/2,j._maxZ=j._height/2,j._minX=-j._maxX,j._minZ=-j._maxZ,j._setReady(!1),V.passHeightBufferInCallback&&(t=new Float32Array((U+1)*(U+1)));const s=(o,v,V)=>{T({width:I,height:Q,subdivisions:U,minHeight:x,maxHeight:f,colorFilter:l,buffer:o,bufferWidth:v,bufferHeight:V,alphaFilter:S,heightBuffer:t}).Po(j,c),R&&R(j,t),j._setReady(!0)};if("string"===typeof v){const o=o=>{var v;const V=o.width,E=o.height;if(g.l)return;const I=null===(v=g)||void 0===v?void 0:v.getEngine().resizeImageBitmap(o,V,E);s(I,V,E)};O.Tools.LoadImage(v,o,V.onError?V.onError:()=>{},g.offlineProvider)}else s(v.data,v.width,v.height);return j}Q.d.CreateGround=l,Q.d.CreateTiledGround=S,Q.d.CreateGroundFromHeightMap=T,I.e.CreateGround=(o,v,V,g,E,I)=>c(o,{width:v,height:V,subdivisions:g,updatable:I},E),I.e.CreateTiledGround=(o,v,V,g,E,I,Q,U,n)=>R(o,{xmin:v,zmin:V,xmax:g,zmax:E,subdivisions:I,precision:Q,updatable:n},U),I.e.CreateGroundFromHeightMap=(o,v,V,g,E,I,Q,U,n,O,h)=>j(o,v,{width:V,height:g,subdivisions:E,minHeight:I,maxHeight:Q,updatable:n,onReady:O,alphaFilter:h},U)},14416:(o,v,V)=>{"use strict";V.d(v,{c:()=>l,d:()=>x,f:()=>f});var g=V(12488),E=V(12958),I=V(12944),Q=V(13052),U=V(12577),n=V(12308);function O(o){const v=[],V=[],g=o.lines,E=o.No,Q=[];let U=0;for(let I=0;I<g.length;I++){const o=g[I];for(let g=0;g<o.length;g++){const{x:n,y:O,z:h}=o[g];if(V.push(n,O,h),E){const o=E[I],{r:v,g:V,b:U,a:n}=o[g];Q.push(v,V,U,n)}g>0&&(v.push(U-1),v.push(U)),U++}}const n=new I.d;return n.indices=v,n.Jo=V,E&&(n.No=Q),n}function h(o){const v=o.dashSize||3,V=o.gapSize||1,E=o.dashNb||200,Q=o.points,U=[],n=[],O=g.cv.Zero();let h=0,x=0,f=0,l=0,S=0,T=0,c=0;for(c=0;c<Q.length-1;c++)Q[c+1].subtractToRef(Q[c],O),h+=O.length();for(f=h/E,l=v*f/(v+V),c=0;c<Q.length-1;c++){Q[c+1].subtractToRef(Q[c],O),x=Math.floor(O.length()/f),O.normalize();for(let o=0;o<x;o++)S=f*o,U.push(Q[c].x+S*O.x,Q[c].y+S*O.y,Q[c].z+S*O.z),U.push(Q[c].x+(S+l)*O.x,Q[c].y+(S+l)*O.y,Q[c].z+(S+l)*O.z),n.push(T,T+1),T+=2}const R=new I.d;return R.Jo=U,R.indices=n,R}function x(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=v.instance,E=v.lines,I=v.No;if(g){const o=g.getVerticesData(U.e.PositionKind);let v,V;I&&(v=g.getVerticesData(U.e.ColorKind));let Q=0,n=0;for(let g=0;g<E.length;g++){const U=E[g];for(let E=0;E<U.length;E++)o[Q]=U[E].x,o[Q+1]=U[E].y,o[Q+2]=U[E].z,I&&v&&(V=I[g],v[n]=V[E].r,v[n+1]=V[E].g,v[n+2]=V[E].b,v[n+3]=V[E].a,n+=4),Q+=3}return g.updateVerticesData(U.e.PositionKind,o,!1,!1),I&&v&&g.updateVerticesData(U.e.ColorKind,v,!1,!1),g.refreshBoundingInfo(),g}const n=!!I,h=new Q.d(o,V,null,void 0,void 0,n,v.useVertexAlpha,v.material);return O(v).Po(h,v.updatable),h}function f(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=v.No?[v.No]:null;return x(o,{lines:[v.points],updatable:v.updatable,instance:v.instance,No:g,useVertexAlpha:v.useVertexAlpha,material:v.material},V)}function l(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=v.points,U=v.instance,O=v.gapSize||1,x=v.dashSize||3;if(U){const o=o=>{const v=g.cv.Zero(),V=o.length/6;let E=0,Q=0,n=0,O=0,h=0,x=0,f=0,l=0;for(f=0;f<I.length-1;f++)I[f+1].subtractToRef(I[f],v),E+=v.length();n=E/V;const S=U._creationDataStorage.dashSize;for(O=S*n/(S+U._creationDataStorage.gapSize),f=0;f<I.length-1;f++)for(I[f+1].subtractToRef(I[f],v),Q=Math.floor(v.length()/n),v.normalize(),l=0;l<Q&&x<o.length;)h=n*l,o[x]=I[f].x+h*v.x,o[x+1]=I[f].y+h*v.y,o[x+2]=I[f].z+h*v.z,o[x+3]=I[f].x+(h+O)*v.x,o[x+4]=I[f].y+(h+O)*v.y,o[x+5]=I[f].z+(h+O)*v.z,x+=6,l++;for(;x<o.length;)o[x]=I[f].x,o[x+1]=I[f].y,o[x+2]=I[f].z,x+=3};return(v.dashNb||v.dashSize||v.gapSize||v.useVertexAlpha||v.material)&&n.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),U.updateMeshPositions(o,!1),U}const f=new Q.d(o,V,null,void 0,void 0,void 0,v.useVertexAlpha,v.material);return h(v).Po(f,v.updatable),f._creationDataStorage=new E.i,f._creationDataStorage.dashSize=x,f._creationDataStorage.gapSize=O,f}I.d.CreateLineSystem=O,I.d.CreateDashedLines=h,E.e.TO=function(o,v){return f(o,{points:v,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},E.e.CreateDashedLines=function(o,v,V,g,E){return l(o,{points:v,dashSize:V,gapSize:g,dashNb:E,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13826:(o,v,V)=>{"use strict";V.d(v,{e:()=>U,h:()=>n});var g=V(12958),E=V(12944),I=V(12564);function Q(o){const v=[],V=[],g=[],Q=[],U=void 0!==o.width?o.width:void 0!==o.size?o.size:1,n=void 0!==o.height?o.height:void 0!==o.size?o.size:1,O=0===o.sideOrientation?0:o.sideOrientation||E.d.DEFAULTSIDE,h=U/2,x=n/2;V.push(-h,-x,0),g.push(0,0,-1),Q.push(0,I.e?1:0),V.push(h,-x,0),g.push(0,0,-1),Q.push(1,I.e?1:0),V.push(h,x,0),g.push(0,0,-1),Q.push(1,I.e?0:1),V.push(-h,x,0),g.push(0,0,-1),Q.push(0,I.e?0:1),v.push(0),v.push(1),v.push(2),v.push(0),v.push(2),v.push(3),E.d._ComputeSides(O,V,v,g,Q,o.frontUVs,o.backUVs);const f=new E.d;return f.indices=v,f.Jo=V,f.do=g,f.Yo=Q,f}function U(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new g.e(o,V);v.sideOrientation=g.e._GetDefaultSideOrientation(v.sideOrientation),E._originalBuilderSideOrientation=v.sideOrientation;return Q(v).Po(E,v.updatable),v.sourcePlane&&(E.translate(v.sourcePlane.normal,-v.sourcePlane.d),E.setDirection(v.sourcePlane.normal.scale(-1))),E}const n={jO:U};E.d.jO=Q,g.e.jO=(o,v,V,g,E)=>U(o,{size:v,width:v,height:v,sideOrientation:E,updatable:g},V)},13922:(o,v,V)=>{"use strict";V.d(v,{d:()=>n});var g=V(12488),E=V(12958),I=V(12944),Q=V(12564);function U(o){const v=0|(o.segments||32),V=o.diameterX||o.diameter||1,E=o.diameterY||o.diameter||1,U=o.diameterZ||o.diameter||1,n=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1,O=o.slice&&o.slice<=0?1:o.slice||1,h=0===o.sideOrientation?0:o.sideOrientation||I.d.DEFAULTSIDE,x=!!o.dedupTopBottomIndices,f=new g.cv(V/2,E/2,U/2),l=2+v,S=2*l,T=[],c=[],R=[],j=[];for(let I=0;I<=l;I++){const o=I/l,v=o*Math.PI*O;for(let V=0;V<=S;V++){const E=V/S,I=E*Math.PI*2*n,U=g.Matrix.RotationZ(-v),O=g.Matrix.RotationY(I),h=g.cv.TransformCoordinates(g.cv.Up(),U),x=g.cv.TransformCoordinates(h,O),l=x.multiply(f),T=x.divide(f).normalize();c.push(l.x,l.y,l.z),R.push(T.x,T.y,T.z),j.push(E,Q.e?1-o:o)}if(I>0){const o=c.length/3;for(let v=o-2*(S+1);v+S+2<o;v++)x?(I>1&&(T.push(v),T.push(v+1),T.push(v+S+1)),(I<l||O<1)&&(T.push(v+S+1),T.push(v+1),T.push(v+S+2))):(T.push(v),T.push(v+1),T.push(v+S+1),T.push(v+S+1),T.push(v+1),T.push(v+S+2))}}I.d._ComputeSides(h,c,T,R,j,o.frontUVs,o.backUVs);const t=new I.d;return t.indices=T,t.Jo=c,t.do=R,t.Yo=j,t}function n(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return U(v).Po(g,v.updatable),g}I.d.CreateSphere=U,E.e.CreateSphere=(o,v,V,g,E,I)=>n(o,{segments:v,diameterX:V,diameterY:V,diameterZ:V,sideOrientation:I,updatable:E},g)},14727:(o,v,V)=>{"use strict";V.d(v,{b:()=>U});var g=V(13077),E=V(14220),I=V(13093),Q=V(12944);class U{static get Configuration(){return{get decoder(){return E.d.DefaultConfiguration},set decoder(o){E.d.DefaultConfiguration=o}}}static set Configuration(o){E.d.DefaultConfiguration=o.decoder}static get DecoderAvailable(){return(0,g.f)(E.d.DefaultConfiguration)}static get Default(){return U._Default??(U._Default=new U),U._Default}static ResetDefault(o){U._Default&&(o||U._Default.dispose(),U._Default=null)}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.DefaultNumWorkers;const v="number"===typeof o?{...E.d.DefaultConfiguration,numWorkers:o}:{...E.d.DefaultConfiguration,...o};this._decoder=new E.d(v)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(o,v,V){return this._decoder.decodeMeshToMeshDataAsync(o,v,V)}async decodeMeshToGeometryAsync(o,v,V,g){return await this._decoder.decodeMeshToGeometryAsync(o,v,V,g)}async _decodeMeshToGeometryForGltfAsync(o,v,V,g,E,I){return await this._decoder._decodeMeshToGeometryForGltfAsync(o,v,V,g,E,I)}async decodeMeshAsync(o,v){const V=await this._decoder.decodeMeshToMeshDataAsync(o,v),g=new Q.d;V.indices&&(g.indices=V.indices);for(const E of V.attributes){const o=I.c.GetFloatData(E.data,E.size,I.c.GetDataType(E.data),E.byteOffset,E.byteStride,E.normalized,V.totalVertices);g.set(o,E.kind)}return g}}U.DefaultNumWorkers=(0,g.d)(),U._Default=null},14220:(o,v,V)=>{"use strict";V.d(v,{d:()=>O});var g=V(13077),E=V(12291),I=V(12970),Q=V(13093),U=V(12308),n=V(13091);class O extends g.b{static get DefaultAvailable(){return(0,g.f)(O.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(o){O._Default&&(o||O._Default.dispose(),O._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(o,v){return{module:await(v||DracoDecoderModule)({wasmBinary:o})}}_getWorkerContent(){return`${n.b}(${n.c})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultConfiguration)}decodeMeshToMeshDataAsync(o,v,V){const g=o instanceof ArrayBuffer?new Int8Array(o):new Int8Array(o.buffer,o.byteOffset,o.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async o=>await new Promise(((E,I)=>{o.push(((o,Q)=>{let n=null;const O=[],h=v=>{o.removeEventListener("error",h),o.removeEventListener("message",x),I(v),Q()},x=v=>{const g=v.data;switch(g.id){case"indices":n=g.data;break;case"attribute":O.push({kind:g.kind,data:g.data,size:g.size,byteOffset:g.byteOffset,byteStride:g.byteStride,normalized:(I=g.kind,f=g.normalized,V&&void 0!==V[I]?(f!==V[I]&&U.b.Warn(`Normalized flag from Draco data (${f}) does not match normalized flag from glTF accessor (${V[I]}). Using flag from glTF accessor.`),V[I]):f)});break;case"decodeMeshDone":o.removeEventListener("error",h),o.removeEventListener("message",x),E({indices:n,attributes:O,totalVertices:g.totalVertices}),Q()}var I,f};o.addEventListener("error",h),o.addEventListener("message",x);const f=g.slice();o.postMessage({id:"decodeMesh",dataView:f,attributes:v},[f.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((o=>{let V=null;const E=[],I=(0,n.b)(o.module,g,v,(o=>{V=o}),((o,v,V,g,I,Q)=>{E.push({kind:o,data:v,size:V,byteOffset:g,byteStride:I,normalized:Q})}));return{indices:V,attributes:E,totalVertices:I}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(o,v,V,g){const E=await this.decodeMeshToMeshDataAsync(V,g),U=new I.e(o,v);E.indices&&U.setIndices(E.indices);for(const I of E.attributes)U.setVerticesBuffer(new Q.c(v.getEngine(),I.data,I.kind,!1,void 0,I.byteStride,void 0,I.byteOffset,I.size,void 0,I.normalized,!0),E.totalVertices);return U}async _decodeMeshToGeometryForGltfAsync(o,v,V,g,E,U){const n=await this.decodeMeshToMeshDataAsync(V,g,E),O=new I.e(o,v);U&&(O._boundingInfo=U,O.useBoundingInfoFromGeometry=!0),n.indices&&O.setIndices(n.indices);for(const I of n.attributes)O.setVerticesBuffer(new Q.c(v.getEngine(),I.data,I.kind,!1,void 0,I.byteStride,void 0,I.byteOffset,I.size,void 0,I.normalized,!0),n.totalVertices);return O}}O.DefaultConfiguration={wasmUrl:`${E.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},O._Default=null},14407:(o,v,V)=>{"use strict";V.d(v,{d:()=>Uo});var g=V(12488),E=V(12958),I=V(12577),Q=V(12944),U=V(12564);function n(o){let v=o.pathArray;const V=o.closeArray||!1,g=o.closePath||!1,E=o.invertUV||!1,n=Math.floor(v[0].length/2);let O=o.offset||n;O=O>n?n:Math.floor(O);const h=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,x=o.Yo,f=o.No,l=[],S=[],T=[],c=[],R=[],j=[],t=[],s=[];let L;const b=[],u=[];let mo,a,F;if(v.length<2){const o=[],V=[];for(a=0;a<v[0].length-O;a++)o.push(v[0][a]),V.push(v[0][a+O]);v=[o,V]}let i=0;const J=g?1:0,d=V?1:0;let N,Y,q,P,M,W;for(L=v[0].length,mo=0;mo<v.length+d;mo++){for(t[mo]=0,R[mo]=[0],N=mo===v.length?v[0]:v[mo],Y=N.length,L=L<Y?L:Y,F=0;F<Y;)l.push(N[F].x,N[F].y,N[F].z),F>0&&(q=N[F].Rv(N[F-1]).length(),P=q+t[mo],R[mo].push(P),t[mo]=P),F++;g&&(F--,l.push(N[0].x,N[0].y,N[0].z),q=N[F].Rv(N[0]).length(),P=q+t[mo],R[mo].push(P),t[mo]=P),b[mo]=Y+J,u[mo]=i,i+=Y+J}let w,z,y=null,H=null;for(a=0;a<L+J;a++)for(s[a]=0,j[a]=[0],mo=0;mo<v.length-1+d;mo++)M=v[mo],W=mo===v.length-1?v[0]:v[mo+1],a===L?(y=M[0],H=W[0]):(y=M[a],H=W[a]),q=H.Rv(y).length(),P=q+s[a],j[a].push(P),s[a]=P;if(x)for(mo=0;mo<x.length;mo++)c.push(x[mo].x,U.e?1-x[mo].y:x[mo].y);else for(mo=0;mo<v.length+d;mo++)for(a=0;a<L+J;a++)w=0!=t[mo]?R[mo][a]/t[mo]:0,z=0!=s[a]?j[a][mo]/s[a]:0,E?c.push(z,w):c.push(w,U.e?1-z:z);mo=0;let e=0,D=b[mo]-1,Z=b[mo+1]-1,K=D<Z?D:Z,X=u[1]-u[0];const r=b.length-1;for(;e<=K&&mo<r;)S.push(e,e+X,e+1),S.push(e+X+1,e+1,e+X),e+=1,e===K&&(mo++,X=u[mo+1]-u[mo],D=b[mo]-1,Z=b[mo+1]-1,e=u[mo],K=D<Z?D+e:Z+e);if(Q.d.ComputeNormals(l,S,T),g){let o=0,V=0;for(mo=0;mo<v.length;mo++){o=3*u[mo],V=mo+1<v.length?3*(u[mo+1]-1):T.length-3,T[o]=.5*(T[o]+T[V]),T[o+1]=.5*(T[o+1]+T[V+1]),T[o+2]=.5*(T[o+2]+T[V+2]);const g=Math.sqrt(T[o]*T[o]+T[o+1]*T[o+1]+T[o+2]*T[o+2]);T[o]/=g,T[o+1]/=g,T[o+2]/=g,T[V]=T[o],T[V+1]=T[o+1],T[V+2]=T[o+2]}}if(V){let o=3*u[0],V=3*u[v.length];for(a=0;a<L+J;a++){T[o]=.5*(T[o]+T[V]),T[o+1]=.5*(T[o+1]+T[V+1]),T[o+2]=.5*(T[o+2]+T[V+2]);const v=Math.sqrt(T[o]*T[o]+T[o+1]*T[o+1]+T[o+2]*T[o+2]);T[o]/=v,T[o+1]/=v,T[o+2]/=v,T[V]=T[o],T[V+1]=T[o+1],T[V+2]=T[o+2],o+=3,V+=3}}Q.d._ComputeSides(h,l,S,T,c,o.frontUVs,o.backUVs);let B=null;if(f){B=new Float32Array(4*f.length);for(let o=0;o<f.length;o++)B[4*o]=f[o].r,B[4*o+1]=f[o].g,B[4*o+2]=f[o].b,B[4*o+3]=f[o].a}const A=new Q.d,C=new Float32Array(l),p=new Float32Array(T),G=new Float32Array(c);return A.indices=S,A.Jo=C,A.do=p,A.Yo=G,B&&A.set(B,I.e.ColorKind),g&&(A._idx=u),A}function O(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=v.pathArray,h=v.closeArray,x=v.closePath,f=E.e._GetDefaultSideOrientation(v.sideOrientation),l=v.instance,S=v.updatable;if(l){const o=g.TmpVectors.cv[0].tU(Number.MAX_VALUE),V=g.TmpVectors.cv[1].tU(-Number.MAX_VALUE),n=v=>{let g=O[0].length;const I=l;let Q=0;const U=I._originalBuilderSideOrientation===E.e.DOUBLESIDE?2:1;for(let E=1;E<=U;++E)for(let U=0;U<O.length;++U){const E=O[U],n=E.length;g=g<n?g:n;for(let I=0;I<g;++I){const g=E[I];v[Q]=g.x,v[Q+1]=g.y,v[Q+2]=g.z,o.minimizeInPlaceFromFloats(g.x,g.y,g.z),V.maximizeInPlaceFromFloats(g.x,g.y,g.z),Q+=3}if(I._creationDataStorage&&I._creationDataStorage.closePath){const o=E[0];v[Q]=o.x,v[Q+1]=o.y,v[Q+2]=o.z,Q+=3}}},h=l.getVerticesData(I.e.PositionKind);if(n(h),l.hasBoundingInfo?l.getBoundingInfo().reConstruct(o,V,l._worldMatrix):l.buildBoundingInfo(o,V,l._worldMatrix),l.updateVerticesData(I.e.PositionKind,h,!1,!1),v.No){const o=l.getVerticesData(I.e.ColorKind);for(let V=0,g=0;V<v.No.length;V++,g+=4){const E=v.No[V];o[g]=E.r,o[g+1]=E.g,o[g+2]=E.b,o[g+3]=E.a}l.updateVerticesData(I.e.ColorKind,o,!1,!1)}if(v.Yo){const o=l.getVerticesData(I.e.UVKind);for(let V=0;V<v.Yo.length;V++)o[2*V]=v.Yo[V].x,o[2*V+1]=U.e?1-v.Yo[V].y:v.Yo[V].y;l.updateVerticesData(I.e.UVKind,o,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){const o=l.QQ(),v=l.getVerticesData(I.e.NormalKind),V=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(Q.d.ComputeNormals(h,o,v,V),l._creationDataStorage&&l._creationDataStorage.closePath){let o=0,V=0;for(let g=0;g<O.length;g++)o=3*l._creationDataStorage.idx[g],V=g+1<O.length?3*(l._creationDataStorage.idx[g+1]-1):v.length-3,v[o]=.5*(v[o]+v[V]),v[o+1]=.5*(v[o+1]+v[V+1]),v[o+2]=.5*(v[o+2]+v[V+2]),v[V]=v[o],v[V+1]=v[o+1],v[V+2]=v[o+2]}l.areNormalsFrozen||l.updateVerticesData(I.e.NormalKind,v,!1,!1)}return l}{const g=new E.e(o,V);g._originalBuilderSideOrientation=f,g._creationDataStorage=new E.i;const I=n(v);return x&&(g._creationDataStorage.idx=I._idx),g._creationDataStorage.closePath=x,g._creationDataStorage.closeArray=h,I.Po(g,S),g}}Q.d.CreateRibbon=n,E.e.CreateRibbon=function(o,v){return O(o,{pathArray:v,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var h=V(13935),x=V(13762),f=V(12547);function l(o){const v=o.pattern||E.e.NO_FLIP,V=o.tileWidth||o.tileSize||1,g=o.tileHeight||o.tileSize||1,I=o.alignHorizontal||0,U=o.alignVertical||0,n=o.width||o.size||1,O=Math.floor(n/V);let h=n-O*V;const x=o.height||o.size||1,f=Math.floor(x/g);let l=x-f*g;const S=V*O/2,T=g*f/2;let c=0,R=0,j=0,t=0,s=0,L=0;if(h>0||l>0){switch(j=-S,t=-T,s=S,L=T,I){case E.e.CENTER:h/=2,j-=h,s+=h;break;case E.e.LEFT:s+=h,c=-h/2;break;case E.e.RIGHT:j-=h,c=h/2}switch(U){case E.e.CENTER:l/=2,t-=l,L+=l;break;case E.e.BOTTOM:L+=l,R=-l/2;break;case E.e.TOP:t-=l,R=l/2}}const b=[],u=[],mo=[];mo[0]=[0,0,1,0,1,1,0,1],mo[1]=[0,0,1,0,1,1,0,1],v!==E.e.ROTATE_TILE&&v!==E.e.ROTATE_ROW||(mo[1]=[1,1,0,1,0,0,1,0]),v!==E.e.FLIP_TILE&&v!==E.e.FLIP_ROW||(mo[1]=[1,0,0,0,0,1,1,1]),v!==E.e.FLIP_N_ROTATE_TILE&&v!==E.e.FLIP_N_ROTATE_ROW||(mo[1]=[0,1,1,1,1,0,0,0]);let a=[];const F=[],i=[];let J=0;for(let Q=0;Q<f;Q++)for(let o=0;o<O;o++)b.push(o*V-S+c,Q*g-T+R,0),b.push((o+1)*V-S+c,Q*g-T+R,0),b.push((o+1)*V-S+c,(Q+1)*g-T+R,0),b.push(o*V-S+c,(Q+1)*g-T+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),a=v===E.e.FLIP_TILE||v===E.e.ROTATE_TILE||v===E.e.FLIP_N_ROTATE_TILE?a.concat(mo[(o%2+Q%2)%2]):v===E.e.FLIP_ROW||v===E.e.ROTATE_ROW||v===E.e.FLIP_N_ROTATE_ROW?a.concat(mo[Q%2]):a.concat(mo[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),J+=4;if(h>0||l>0){const o=l>0&&(U===E.e.CENTER||U===E.e.TOP),Q=l>0&&(U===E.e.CENTER||U===E.e.BOTTOM),n=h>0&&(I===E.e.CENTER||I===E.e.RIGHT),x=h>0&&(I===E.e.CENTER||I===E.e.LEFT);let mo,d,N,Y,q=[];if(o&&n&&(b.push(j+c,t+R,0),b.push(-S+c,t+R,0),b.push(-S+c,t+l+R,0),b.push(j+c,t+l+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,mo=1-h/V,d=1-l/g,N=1,Y=1,q=[mo,d,N,d,N,Y,mo,Y],v===E.e.ROTATE_ROW&&(q=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),v===E.e.FLIP_ROW&&(q=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),v===E.e.FLIP_N_ROTATE_ROW&&(q=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]),a=a.concat(q),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o&&x&&(b.push(S+c,t+R,0),b.push(s+c,t+R,0),b.push(s+c,t+l+R,0),b.push(S+c,t+l+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,mo=0,d=1-l/g,N=h/V,Y=1,q=[mo,d,N,d,N,Y,mo,Y],(v===E.e.ROTATE_ROW||v===E.e.ROTATE_TILE&&O%2===0)&&(q=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),(v===E.e.FLIP_ROW||v===E.e.FLIP_TILE&&O%2===0)&&(q=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),(v===E.e.FLIP_N_ROTATE_ROW||v===E.e.FLIP_N_ROTATE_TILE&&O%2===0)&&(q=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]),a=a.concat(q),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&n&&(b.push(j+c,T+R,0),b.push(-S+c,T+R,0),b.push(-S+c,L+R,0),b.push(j+c,L+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,mo=1-h/V,d=0,N=1,Y=l/g,q=[mo,d,N,d,N,Y,mo,Y],(v===E.e.ROTATE_ROW&&f%2===1||v===E.e.ROTATE_TILE&&f%1===0)&&(q=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),(v===E.e.FLIP_ROW&&f%2===1||v===E.e.FLIP_TILE&&f%2===0)&&(q=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),(v===E.e.FLIP_N_ROTATE_ROW&&f%2===1||v===E.e.FLIP_N_ROTATE_TILE&&f%2===0)&&(q=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]),a=a.concat(q),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&x&&(b.push(S+c,T+R,0),b.push(s+c,T+R,0),b.push(s+c,L+R,0),b.push(S+c,L+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,mo=0,d=0,N=h/V,Y=l/g,q=[mo,d,N,d,N,Y,mo,Y],(v===E.e.ROTATE_ROW&&f%2===1||v===E.e.ROTATE_TILE&&(f+O)%2===1)&&(q=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),(v===E.e.FLIP_ROW&&f%2===1||v===E.e.FLIP_TILE&&(f+O)%2===1)&&(q=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),(v===E.e.FLIP_N_ROTATE_ROW&&f%2===1||v===E.e.FLIP_N_ROTATE_TILE&&(f+O)%2===1)&&(q=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]),a=a.concat(q),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o){const o=[];mo=0,d=1-l/g,N=1,Y=1,o[0]=[mo,d,N,d,N,Y,mo,Y],o[1]=[mo,d,N,d,N,Y,mo,Y],v!==E.e.ROTATE_TILE&&v!==E.e.ROTATE_ROW||(o[1]=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),v!==E.e.FLIP_TILE&&v!==E.e.FLIP_ROW||(o[1]=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),v!==E.e.FLIP_N_ROTATE_TILE&&v!==E.e.FLIP_N_ROTATE_ROW||(o[1]=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]);for(let g=0;g<O;g++)b.push(g*V-S+c,t+R,0),b.push((g+1)*V-S+c,t+R,0),b.push((g+1)*V-S+c,t+l+R,0),b.push(g*V-S+c,t+l+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,a=v===E.e.FLIP_TILE||v===E.e.ROTATE_TILE||v===E.e.FLIP_N_ROTATE_TILE?a.concat(o[(g+1)%2]):v===E.e.FLIP_ROW||v===E.e.ROTATE_ROW||v===E.e.FLIP_N_ROTATE_ROW?a.concat(o[1]):a.concat(o[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const o=[];mo=0,d=0,N=1,Y=l/g,o[0]=[mo,d,N,d,N,Y,mo,Y],o[1]=[mo,d,N,d,N,Y,mo,Y],v!==E.e.ROTATE_TILE&&v!==E.e.ROTATE_ROW||(o[1]=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),v!==E.e.FLIP_TILE&&v!==E.e.FLIP_ROW||(o[1]=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),v!==E.e.FLIP_N_ROTATE_TILE&&v!==E.e.FLIP_N_ROTATE_ROW||(o[1]=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]);for(let g=0;g<O;g++)b.push(g*V-S+c,L-l+R,0),b.push((g+1)*V-S+c,L-l+R,0),b.push((g+1)*V-S+c,L+R,0),b.push(g*V-S+c,L+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,a=v===E.e.FLIP_TILE||v===E.e.ROTATE_TILE||v===E.e.FLIP_N_ROTATE_TILE?a.concat(o[(g+f)%2]):v===E.e.FLIP_ROW||v===E.e.ROTATE_ROW||v===E.e.FLIP_N_ROTATE_ROW?a.concat(o[f%2]):a.concat(o[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const o=[];mo=1-h/V,d=0,N=1,Y=1,o[0]=[mo,d,N,d,N,Y,mo,Y],o[1]=[mo,d,N,d,N,Y,mo,Y],v!==E.e.ROTATE_TILE&&v!==E.e.ROTATE_ROW||(o[1]=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),v!==E.e.FLIP_TILE&&v!==E.e.FLIP_ROW||(o[1]=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),v!==E.e.FLIP_N_ROTATE_TILE&&v!==E.e.FLIP_N_ROTATE_ROW||(o[1]=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]);for(let V=0;V<f;V++)b.push(j+c,V*g-T+R,0),b.push(j+h+c,V*g-T+R,0),b.push(j+h+c,(V+1)*g-T+R,0),b.push(j+c,(V+1)*g-T+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,a=v===E.e.FLIP_TILE||v===E.e.ROTATE_TILE||v===E.e.FLIP_N_ROTATE_TILE?a.concat(o[(V+1)%2]):v===E.e.FLIP_ROW||v===E.e.ROTATE_ROW||v===E.e.FLIP_N_ROTATE_ROW?a.concat(o[V%2]):a.concat(o[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const o=[];mo=0,d=0,N=h/g,Y=1,o[0]=[mo,d,N,d,N,Y,mo,Y],o[1]=[mo,d,N,d,N,Y,mo,Y],v!==E.e.ROTATE_TILE&&v!==E.e.ROTATE_ROW||(o[1]=[1-mo,1-d,1-N,1-d,1-N,1-Y,1-mo,1-Y]),v!==E.e.FLIP_TILE&&v!==E.e.FLIP_ROW||(o[1]=[1-mo,d,1-N,d,1-N,Y,1-mo,Y]),v!==E.e.FLIP_N_ROTATE_TILE&&v!==E.e.FLIP_N_ROTATE_ROW||(o[1]=[mo,1-d,N,1-d,N,1-Y,mo,1-Y]);for(let V=0;V<f;V++)b.push(s-h+c,V*g-T+R,0),b.push(s+c,V*g-T+R,0),b.push(s+c,(V+1)*g-T+R,0),b.push(s-h+c,(V+1)*g-T+R,0),i.push(J,J+1,J+3,J+1,J+2,J+3),J+=4,a=v===E.e.FLIP_TILE||v===E.e.ROTATE_TILE||v===E.e.FLIP_N_ROTATE_TILE?a.concat(o[(V+O)%2]):v===E.e.FLIP_ROW||v===E.e.ROTATE_ROW||v===E.e.FLIP_N_ROTATE_ROW?a.concat(o[V%2]):a.concat(o[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const d=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE;Q.d._ComputeSides(d,b,i,u,a,o.frontUVs,o.backUVs);const N=new Q.d;N.indices=i,N.Jo=b,N.do=u,N.Yo=a;const Y=d===Q.d.DOUBLESIDE?F.concat(F):F;return N.No=Y,N}function S(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return l(v).Po(g,v.updatable),g}function T(o){const v=o.faceUV||new Array(6),V=o.faceColors,I=o.pattern||E.e.NO_FLIP,n=o.width||o.size||1,O=o.height||o.size||1,h=o.depth||o.size||1,x=o.tileWidth||o.tileSize||1,S=o.tileHeight||o.tileSize||1,T=o.alignHorizontal||0,c=o.alignVertical||0,R=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE;for(let E=0;E<6;E++)void 0===v[E]&&(v[E]=new g.Vector4(0,0,1,1)),V&&void 0===V[E]&&(V[E]=new f.sU(1,1,1,1));const j=n/2,t=O/2,s=h/2,L=[];for(let g=0;g<2;g++)L[g]=l({pattern:I,tileWidth:x,tileHeight:S,width:n,height:O,alignVertical:c,alignHorizontal:T,sideOrientation:R});for(let g=2;g<4;g++)L[g]=l({pattern:I,tileWidth:x,tileHeight:S,width:h,height:O,alignVertical:c,alignHorizontal:T,sideOrientation:R});let b=c;c===E.e.BOTTOM?b=E.e.TOP:c===E.e.TOP&&(b=E.e.BOTTOM);for(let g=4;g<6;g++)L[g]=l({pattern:I,tileWidth:x,tileHeight:S,width:n,height:h,alignVertical:b,alignHorizontal:T,sideOrientation:R});let u=[],mo=[],a=[],F=[];const i=[],J=[],d=[],N=[];let Y=0,q=0;for(let E=0;E<6;E++){const o=L[E].Jo.length;J[E]=[],d[E]=[];for(let v=0;v<o/3;v++)J[E].push(new g.cv(L[E].Jo[3*v],L[E].Jo[3*v+1],L[E].Jo[3*v+2])),d[E].push(new g.cv(L[E].do[3*v],L[E].do[3*v+1],L[E].do[3*v+2]));Y=L[E].Yo.length,N[E]=[];for(let V=0;V<Y;V+=2)N[E][V]=v[E].x+(v[E].z-v[E].x)*L[E].Yo[V],N[E][V+1]=v[E].y+(v[E].w-v[E].y)*L[E].Yo[V+1],U.e&&(N[E][V+1]=1-N[E][V+1]);if(a=a.concat(N[E]),F=F.concat(L[E].indices.map((o=>o+q))),q+=J[E].length,V)for(let v=0;v<4;v++)i.push(V[E].r,V[E].g,V[E].b,V[E].a)}const P=new g.cv(0,0,s),M=g.Matrix.RotationY(Math.PI);u=J[0].map((o=>g.cv.TransformNormal(o,M).add(P))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[]),mo=d[0].map((o=>g.cv.TransformNormal(o,M))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[]),u=u.concat(J[1].map((o=>o.Rv(P))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[])),mo=mo.concat(d[1].map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[]));const W=new g.cv(j,0,0),w=g.Matrix.RotationY(-Math.PI/2);u=u.concat(J[2].map((o=>g.cv.TransformNormal(o,w).add(W))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[])),mo=mo.concat(d[2].map((o=>g.cv.TransformNormal(o,w))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[]));const z=g.Matrix.RotationY(Math.PI/2);u=u.concat(J[3].map((o=>g.cv.TransformNormal(o,z).Rv(W))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[])),mo=mo.concat(d[3].map((o=>g.cv.TransformNormal(o,z))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[]));const y=new g.cv(0,t,0),H=g.Matrix.RotationX(Math.PI/2);u=u.concat(J[4].map((o=>g.cv.TransformNormal(o,H).add(y))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[])),mo=mo.concat(d[4].map((o=>g.cv.TransformNormal(o,H))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[]));const e=g.Matrix.RotationX(-Math.PI/2);u=u.concat(J[5].map((o=>g.cv.TransformNormal(o,e).Rv(y))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[])),mo=mo.concat(d[5].map((o=>g.cv.TransformNormal(o,e))).map((o=>[o.x,o.y,o.z])).reduce(((o,v)=>o.concat(v)),[])),Q.d._ComputeSides(R,u,F,mo,a);const D=new Q.d;if(D.indices=F,D.Jo=u,D.do=mo,D.Yo=a,V){const o=R===Q.d.DOUBLESIDE?i.concat(i):i;D.No=o}return D}function c(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return T(v).Po(g,v.updatable),g}Q.d.CreateTiledPlane=l;Q.d.CreateTiledBox=T;var R=V(13922),j=V(12747),t=V(12706);function s(o){const v=o.height||2;let V=0===o.diameterTop?0:o.diameterTop||o.diameter||1,I=0===o.diameterBottom?0:o.diameterBottom||o.diameter||1;V=V||1e-5,I=I||1e-5;const n=0|(o.tessellation||24),O=0|(o.subdivisions||1),h=!!o.hasRings,x=!!o.enclose,l=0===o.cap?0:o.cap||E.e.CAP_ALL,S=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1,T=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,c=o.faceUV||new Array(3),R=o.faceColors,j=2+(1+(1!==S&&x?2:0))*(h?O:1);let s;for(s=0;s<j;s++)R&&void 0===R[s]&&(R[s]=new f.sU(1,1,1,1));for(s=0;s<j;s++)c&&void 0===c[s]&&(c[s]=new g.Vector4(0,0,1,1));const L=[],b=[],u=[],mo=[],a=[],F=2*Math.PI*S/n;let i,J,d;const N=(I-V)/2/v,Y=g.cv.Zero(),q=g.cv.Zero(),P=g.cv.Zero(),M=g.cv.Zero(),W=g.cv.Zero(),w=t.e.Y;let z,y,H,e=1,D=1,Z=0,K=0;for(z=0;z<=O;z++)for(J=z/O,d=(J*(V-I)+I)/2,e=h&&0!==z&&z!==O?2:1,H=0;H<e;H++){for(h&&(D+=H),x&&(D+=2*H),y=0;y<=n;y++)i=y*F,Y.x=Math.cos(-i)*d,Y.y=-v/2+J*v,Y.z=Math.sin(-i)*d,0===V&&z===O?(q.x=u[u.length-3*(n+1)],q.y=u[u.length-3*(n+1)+1],q.z=u[u.length-3*(n+1)+2]):(q.x=Y.x,q.z=Y.z,q.y=Math.sqrt(q.x*q.x+q.z*q.z)*N,q.normalize()),0===y&&(P.U(Y),M.U(q)),b.push(Y.x,Y.y,Y.z),u.push(q.x,q.y,q.z),K=h?Z!==D?c[D].y:c[D].w:c[D].y+(c[D].w-c[D].y)*J,mo.push(c[D].x+(c[D].z-c[D].x)*y/n,U.e?1-K:K),R&&a.push(R[D].r,R[D].g,R[D].b,R[D].a);1!==S&&x&&(b.push(Y.x,Y.y,Y.z),b.push(0,Y.y,0),b.push(0,Y.y,0),b.push(P.x,P.y,P.z),g.cv.CrossToRef(w,q,W),W.normalize(),u.push(W.x,W.y,W.z,W.x,W.y,W.z),g.cv.CrossToRef(M,w,W),W.normalize(),u.push(W.x,W.y,W.z,W.x,W.y,W.z),K=h?Z!==D?c[D+1].y:c[D+1].w:c[D+1].y+(c[D+1].w-c[D+1].y)*J,mo.push(c[D+1].x,U.e?1-K:K),mo.push(c[D+1].z,U.e?1-K:K),K=h?Z!==D?c[D+2].y:c[D+2].w:c[D+2].y+(c[D+2].w-c[D+2].y)*J,mo.push(c[D+2].x,U.e?1-K:K),mo.push(c[D+2].z,U.e?1-K:K),R&&(a.push(R[D+1].r,R[D+1].g,R[D+1].b,R[D+1].a),a.push(R[D+1].r,R[D+1].g,R[D+1].b,R[D+1].a),a.push(R[D+2].r,R[D+2].g,R[D+2].b,R[D+2].a),a.push(R[D+2].r,R[D+2].g,R[D+2].b,R[D+2].a))),Z!==D&&(Z=D)}const X=1!==S&&x?n+4:n;for(z=0,D=0;D<O;D++){let o=0,v=0,V=0,g=0;for(y=0;y<n;y++)o=z*(X+1)+y,v=(z+1)*(X+1)+y,V=z*(X+1)+(y+1),g=(z+1)*(X+1)+(y+1),L.push(o,v,V),L.push(g,V,v);1!==S&&x&&(L.push(o+2,v+2,V+2),L.push(g+2,V+2,v+2),L.push(o+4,v+4,V+4),L.push(g+4,V+4,v+4)),z=h?z+2:z+1}const r=o=>{const E=o?V/2:I/2;if(0===E)return;let Q,O,h;const x=o?c[j-1]:c[0];let f=null;R&&(f=o?R[j-1]:R[0]);const l=b.length/3,T=o?v/2:-v/2,t=new g.cv(0,T,0);b.push(t.x,t.y,t.z),u.push(0,o?1:-1,0);const s=x.y+.5*(x.w-x.y);mo.push(x.x+.5*(x.z-x.x),U.e?1-s:s),f&&a.push(f.r,f.g,f.b,f.a);const F=new g.Vector2(.5,.5);for(h=0;h<=n;h++){Q=2*Math.PI*h*S/n;const v=Math.cos(-Q),V=Math.sin(-Q);O=new g.cv(v*E,T,V*E);const I=new g.Vector2(v*F.x+.5,V*F.y+.5);b.push(O.x,O.y,O.z),u.push(0,o?1:-1,0);const l=x.y+(x.w-x.y)*I.y;mo.push(x.x+(x.z-x.x)*I.x,U.e?1-l:l),f&&a.push(f.r,f.g,f.b,f.a)}for(h=0;h<n;h++)o?(L.push(l),L.push(l+(h+2)),L.push(l+(h+1))):(L.push(l),L.push(l+(h+1)),L.push(l+(h+2)))};l!==E.e.CAP_START&&l!==E.e.CAP_ALL||r(!1),l!==E.e.CAP_END&&l!==E.e.CAP_ALL||r(!0),Q.d._ComputeSides(T,b,L,u,mo,o.frontUVs,o.backUVs);const B=new Q.d;return B.indices=L,B.Jo=b,B.do=u,B.Yo=mo,R&&(B.No=a),B}function L(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return s(v).Po(g,v.updatable),g}function b(o){const v=[],V=[],E=[],I=[],n=o.diameter||1,O=o.thickness||.5,h=0|(o.tessellation||16),x=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,f=h+1;for(let Q=0;Q<=h;Q++){const o=Q/h,x=Q*Math.PI*2/h-Math.PI/2,l=g.Matrix.Translation(n/2,0,0).multiply(g.Matrix.RotationY(x));for(let n=0;n<=h;n++){const x=1-n/h,S=n*Math.PI*2/h+Math.PI,T=Math.cos(S),c=Math.sin(S);let R=new g.cv(T,c,0),j=R.scale(O/2);const t=new g.Vector2(o,x);j=g.cv.TransformCoordinates(j,l),R=g.cv.TransformNormal(R,l),V.push(j.x,j.y,j.z),E.push(R.x,R.y,R.z),I.push(t.x,U.e?1-t.y:t.y);const s=(Q+1)%f,L=(n+1)%f;v.push(Q*f+n),v.push(Q*f+L),v.push(s*f+n),v.push(Q*f+L),v.push(s*f+L),v.push(s*f+n)}}Q.d._ComputeSides(x,V,v,E,I,o.frontUVs,o.backUVs);const l=new Q.d;return l.indices=v,l.Jo=V,l.do=E,l.Yo=I,l}function u(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return b(v).Po(g,v.updatable),g}Q.d.CreateCylinder=s,E.e.CreateCylinder=(o,v,V,g,I,Q,U,n,O)=>{void 0!==U&&U instanceof j.b||(void 0!==U&&(O=n||E.e.DEFAULTSIDE,n=U),U=Q,Q=1);return L(o,{height:v,diameterTop:V,diameterBottom:g,tessellation:I,subdivisions:Q,sideOrientation:O,updatable:n},U)};function mo(o){const v=[],V=[],E=[],I=[],n=o.radius||2,O=o.tube||.5,h=o.radialSegments||32,x=o.tubularSegments||32,f=o.p||2,l=o.q||3,S=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,T=o=>{const v=Math.cos(o),V=Math.sin(o),E=l/f*o,I=Math.cos(E),Q=n*(2+I)*.5*v,U=n*(2+I)*V*.5,O=n*Math.sin(E)*.5;return new g.cv(Q,U,O)};let c,R;for(c=0;c<=h;c++){const o=c%h/h*2*f*Math.PI,v=T(o),E=T(o+.01),Q=E.Rv(v);let n=E.add(v);const l=g.cv.Cross(Q,n);for(n=g.cv.Cross(l,Q),l.normalize(),n.normalize(),R=0;R<x;R++){const o=R%x/x*2*Math.PI,g=-O*Math.cos(o),E=O*Math.sin(o);V.push(v.x+g*n.x+E*l.x),V.push(v.y+g*n.y+E*l.y),V.push(v.z+g*n.z+E*l.z),I.push(c/h),I.push(U.e?1-R/x:R/x)}}for(c=0;c<h;c++)for(R=0;R<x;R++){const o=(R+1)%x,V=c*x+R,g=(c+1)*x+R,E=(c+1)*x+o,I=c*x+o;v.push(I),v.push(g),v.push(V),v.push(I),v.push(E),v.push(g)}Q.d.ComputeNormals(V,v,E),Q.d._ComputeSides(S,V,v,E,I,o.frontUVs,o.backUVs);const j=new Q.d;return j.indices=v,j.Jo=V,j.do=E,j.Yo=I,j}function a(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2?arguments[2]:void 0;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return mo(v).Po(g,v.updatable),g}Q.d.CreateTorus=b,E.e.CreateTorus=(o,v,V,g,E,I,Q)=>u(o,{diameter:v,thickness:V,tessellation:g,sideOrientation:Q,updatable:I},E);Q.d.CreateTorusKnot=mo,E.e.CreateTorusKnot=(o,v,V,g,E,I,Q,U,n,O)=>a(o,{radius:v,tube:V,radialSegments:g,tubularSegments:E,p:I,q:Q,sideOrientation:O,updatable:n},U);var F=V(14416),i=V(13067),J=V(12719);function d(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=v.path,I=v.shape,Q=v.scale||1,U=v.rotation||0,n=0===v.cap?0:v.cap||E.e.NO_CAP,O=v.updatable,h=E.e._GetDefaultSideOrientation(v.sideOrientation),x=v.instance||null,f=v.invertUV||!1,l=v.closeShape||!1,S=v.closePath||!1,T=v.capFunction||null;return Y(o,I,g,Q,U,null,null,S,l,n,!1,V,!!O,h,x,f,v.frontUVs||null,v.backUVs||null,v.firstNormal||null,!!v.adjustFrame,T)}function N(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=v.path,I=v.shape,Q=v.scaleFunction||(()=>1),U=v.rotationFunction||(()=>0),n=v.closePath||v.ribbonCloseArray||!1,O=v.closeShape||v.ribbonClosePath||!1,h=0===v.cap?0:v.cap||E.e.NO_CAP,x=v.updatable,f=v.firstNormal||null,l=v.adjustFrame||!1,S=E.e._GetDefaultSideOrientation(v.sideOrientation),T=v.instance,c=v.invertUV||!1,R=v.capFunction||null;return Y(o,I,g,null,null,Q,U,n,O,h,!0,V,!!x,S,T||null,c,v.frontUVs||null,v.backUVs||null,f,l,R||null)}function Y(o,v,V,I,Q,U,n,h,x,f,l,S,T,c,R,j,t,s,L,b,u){const mo=(o,v,V,I,Q,U,n,O,h,x,f)=>{const l=V.getTangents(),S=V.getNormals(),T=V.getBinormals(),c=V.getDistances();if(f)for(let E=0;E<l.length;E++)if(0==l[E].x&&0==l[E].y&&0==l[E].z&&l[E].U(l[E-1]),0==S[E].x&&0==S[E].y&&0==S[E].z&&S[E].U(S[E-1]),0==T[E].x&&0==T[E].y&&0==T[E].z&&T[E].U(T[E-1]),E>0){let o=l[E-1];g.cv.Dot(o,l[E])<0&&l[E].scaleInPlace(-1),o=S[E-1],g.cv.Dot(o,S[E])<0&&S[E].scaleInPlace(-1),o=T[E-1],g.cv.Dot(o,T[E])<0&&T[E].scaleInPlace(-1)}let R=0;const j=x&&O?O:()=>null!==U?U:0,t=x&&n?n:()=>null!==Q?Q:1;let s=h===E.e.NO_CAP||h===E.e.CAP_END?0:2;const L=g.TmpVectors.Matrix[0];for(let E=0;E<v.length;E++){const V=[],Q=j(E,c[E]),U=t(E,c[E]);g.Matrix.RotationAxisToRef(l[E],R,L);for(let I=0;I<o.length;I++){const Q=l[E].scale(o[I].z).add(S[E].scale(o[I].x)).add(T[E].scale(o[I].y)),n=g.cv.Zero();g.cv.TransformCoordinatesToRef(Q,L,n),n.scaleInPlace(U).addInPlace(v[E]),V[I]=n}I[s]=V,R+=Q,s++}const b=u||(o=>{const v=Array(),V=g.cv.Zero();let E;for(E=0;E<o.length;E++)V.addInPlace(o[E]);for(V.scaleInPlace(1/o.length),E=0;E<o.length;E++)v.push(V);return v});switch(h){case E.e.NO_CAP:break;case E.e.CAP_START:I[0]=b(I[2]),I[1]=I[2];break;case E.e.CAP_END:I[s]=I[s-1],I[s+1]=b(I[s-1]);break;case E.e.CAP_ALL:I[0]=b(I[2]),I[1]=I[2],I[s]=I[s-1],I[s+1]=b(I[s-1])}return I};let a,F;if(R){const o=R._creationDataStorage;return a=L?o.path3D.update(V,L):o.path3D.update(V),F=mo(v,V,o.path3D,o.pathArray,I,Q,U,n,o.cap,l,b),R=O("",{pathArray:F,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:R},S||void 0)}a=L?new J.o(V,L):new J.o(V);F=mo(v,V,a,new Array,I,Q,U,n,f=f<0||f>3?0:f,l,b);const i=O(o,{pathArray:F,closeArray:h,closePath:x,updatable:T,sideOrientation:c,invertUV:j,frontUVs:t||void 0,backUVs:s||void 0},S);return i._creationDataStorage.pathArray=F,i._creationDataStorage.path3D=a,i._creationDataStorage.cap=f,i}function q(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=v.arc?v.arc<=0||v.arc>1?1:v.arc:1,Q=void 0===v.closed||v.closed,U=v.shape,n=v.radius||1,h=v.tessellation||64,x=v.clip||0,f=v.updatable,l=E.e._GetDefaultSideOrientation(v.sideOrientation),S=v.cap||E.e.NO_CAP,T=2*Math.PI,c=[],R=v.invertUV||!1;let j=0,t=0;const s=T/h*I;let L,b;for(j=0;j<=h-x;j++){for(b=[],S!=E.e.CAP_START&&S!=E.e.CAP_ALL||(b.push(new g.cv(0,U[0].y,0)),b.push(new g.cv(Math.cos(j*s)*U[0].x*n,U[0].y,Math.sin(j*s)*U[0].x*n))),t=0;t<U.length;t++)L=new g.cv(Math.cos(j*s)*U[t].x*n,U[t].y,Math.sin(j*s)*U[t].x*n),b.push(L);S!=E.e.CAP_END&&S!=E.e.CAP_ALL||(b.push(new g.cv(Math.cos(j*s)*U[U.length-1].x*n,U[U.length-1].y,Math.sin(j*s)*U[U.length-1].x*n)),b.push(new g.cv(0,U[U.length-1].y,0))),c.push(b)}return O(o,{pathArray:c,closeArray:Q,sideOrientation:l,updatable:f,invertUV:R,frontUVs:v.frontUVs,backUVs:v.backUVs},V)}E.e.ExtrudeShape=function(o,v,V,g,I,Q){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return d(o,{shape:v,path:V,scale:g,rotation:I,cap:0===Q?0:Q||E.e.NO_CAP,sideOrientation:O,instance:h,updatable:n},U)},E.e.ExtrudeShapeCustom=(o,v,V,g,I,Q,U,n,O,h,x,f)=>N(o,{shape:v,path:V,scaleFunction:g,rotationFunction:I,ribbonCloseArray:Q,ribbonClosePath:U,cap:0===n?0:n||E.e.NO_CAP,sideOrientation:x,instance:f,updatable:h},O);E.e.CreateLathe=(o,v,V,g,E,I,Q)=>q(o,{shape:v,radius:V,tessellation:g,sideOrientation:Q,updatable:I},E);var P=V(13826),M=V(13770);function W(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=v.path;let Q=v.instance,U=1;void 0!==v.radius?U=v.radius:Q&&(U=Q._creationDataStorage.radius);const n=v.tessellation||64,h=v.radiusFunction||null;let x=v.cap||E.e.NO_CAP;const f=v.invertUV||!1,l=v.updatable,S=E.e._GetDefaultSideOrientation(v.sideOrientation);v.arc=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1;const T=(o,v,V,I,Q,U,n,O)=>{const h=v.getTangents(),x=v.getNormals(),f=v.getDistances(),l=2*Math.PI/Q*O,S=U||(()=>I);let T,c,R,j;const t=g.TmpVectors.Matrix[0];let s=n===E.e.NO_CAP||n===E.e.CAP_END?0:2;for(let E=0;E<o.length;E++){c=S(E,f[E]),T=Array(),R=x[E];for(let v=0;v<Q;v++)g.Matrix.RotationAxisToRef(h[E],l*v,t),j=T[v]?T[v]:g.cv.Zero(),g.cv.TransformCoordinatesToRef(R,t,j),j.scaleInPlace(c).addInPlace(o[E]),T[v]=j;V[s]=T,s++}const L=(v,V)=>{const g=Array();for(let E=0;E<v;E++)g.push(o[V]);return g};switch(n){case E.e.NO_CAP:break;case E.e.CAP_START:V[0]=L(Q,0),V[1]=V[2].slice(0);break;case E.e.CAP_END:V[s]=V[s-1].slice(0),V[s+1]=L(Q,o.length-1);break;case E.e.CAP_ALL:V[0]=L(Q,0),V[1]=V[2].slice(0),V[s]=V[s-1].slice(0),V[s+1]=L(Q,o.length-1)}return V};let c,R;if(Q){const o=Q._creationDataStorage,V=v.arc||o.arc;return c=o.path3D.update(I),R=T(I,c,o.pathArray,U,o.tessellation,h,o.cap,V),Q=O("",{pathArray:R,instance:Q}),o.path3D=c,o.pathArray=R,o.arc=V,o.radius=U,Q}c=new J.o(I);x=x<0||x>3?0:x,R=T(I,c,new Array,U,n,h,x,v.arc);const j=O(o,{pathArray:R,closePath:!0,closeArray:!1,updatable:l,sideOrientation:S,invertUV:f,frontUVs:v.frontUVs,backUVs:v.backUVs},V);return j._creationDataStorage.pathArray=R,j._creationDataStorage.path3D=c,j._creationDataStorage.tessellation=n,j._creationDataStorage.cap=x,j._creationDataStorage.arc=v.arc,j._creationDataStorage.radius=U,j}function w(o){const v=[];v[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},v[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},v[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},v[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},v[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},v[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},v[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},v[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},v[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},v[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},v[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},v[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},v[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},v[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},v[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const V=o.type&&(o.type<0||o.type>=v.length)?0:o.type||0,E=o.size,I=o.sizeX||E||1,n=o.sizeY||E||1,O=o.sizeZ||E||1,h=o.custom||v[V],x=h.face.length,l=o.faceUV||new Array(x),S=o.faceColors,T=void 0===o.flat||o.flat,c=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,R=[],j=[],t=[],s=[],L=[];let b=0,u=0;const mo=[];let a,F,i,J,d,N,Y=0,q=0;if(T)for(q=0;q<x;q++)S&&void 0===S[q]&&(S[q]=new f.sU(1,1,1,1)),l&&void 0===l[q]&&(l[q]=new g.Vector4(0,0,1,1));if(T)for(q=0;q<x;q++){const o=h.face[q].length;for(i=2*Math.PI/o,J=.5*Math.tan(i/2),d=.5,Y=0;Y<o;Y++)R.push(h.vertex[h.face[q][Y]][0]*I,h.vertex[h.face[q][Y]][1]*n,h.vertex[h.face[q][Y]][2]*O),mo.push(b),b++,a=l[q].x+(l[q].z-l[q].x)*(.5+J),F=l[q].y+(l[q].w-l[q].y)*(d-.5),s.push(a,U.e?1-F:F),N=J*Math.cos(i)-d*Math.sin(i),d=J*Math.sin(i)+d*Math.cos(i),J=N,S&&L.push(S[q].r,S[q].g,S[q].b,S[q].a);for(Y=0;Y<o-2;Y++)j.push(mo[0+u],mo[Y+2+u],mo[Y+1+u]);u+=o}else{for(Y=0;Y<h.vertex.length;Y++)R.push(h.vertex[Y][0]*I,h.vertex[Y][1]*n,h.vertex[Y][2]*O),s.push(0,U.e?1:0);for(q=0;q<x;q++)for(Y=0;Y<h.face[q].length-2;Y++)j.push(h.face[q][0],h.face[q][Y+2],h.face[q][Y+1])}Q.d.ComputeNormals(R,j,t),Q.d._ComputeSides(c,R,j,t,s,o.frontUVs,o.backUVs);const P=new Q.d;return P.Jo=R,P.indices=j,P.do=t,P.Yo=s,S&&T&&(P.No=L),P}function z(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return w(v).Po(g,v.updatable),g}E.e.CreateTube=(o,v,V,g,E,I,Q,U,n,O)=>W(o,{path:v,radius:V,tessellation:g,radiusFunction:E,arc:1,cap:I,updatable:U,sideOrientation:n,instance:O},Q);function y(o){const v=o.sideOrientation||Q.d.DEFAULTSIDE,V=o.radius||1,E=void 0===o.flat||o.flat,I=0|(o.subdivisions||4),n=o.radiusX||V,O=o.radiusY||V,h=o.radiusZ||V,x=(1+Math.sqrt(5))/2,f=[-1,x,-0,1,x,0,-1,-x,0,1,-x,0,0,-1,-x,0,1,-x,0,-1,x,0,1,x,x,0,1,x,0,-1,-x,0,1,-x,0,-1],l=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],S=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],T=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],R=[],j=[],t=[],s=[];let L=0;const b=new Array(3),u=new Array(3);let mo;for(mo=0;mo<3;mo++)b[mo]=g.cv.Zero(),u[mo]=g.Vector2.Zero();for(let Q=0;Q<20;Q++){for(mo=0;mo<3;mo++){const o=l[3*Q+mo];b[mo].RU(f[3*S[o]],f[3*S[o]+1],f[3*S[o]+2]),b[mo].normalize(),u[mo].RU(.134765625*T[2*o]+.05859375+-.0390625*c[Q],.2333984375*T[2*o+1]+.025390625+.01953125*c[Q])}const o=(o,v,V,Q)=>{const x=g.cv.Lerp(b[0],b[2],v/I),f=g.cv.Lerp(b[1],b[2],v/I),l=I===v?b[2]:g.cv.Lerp(x,f,o/(I-v));let S;if(l.normalize(),E){const o=g.cv.Lerp(b[0],b[2],Q/I),v=g.cv.Lerp(b[1],b[2],Q/I);S=g.cv.Lerp(o,v,V/(I-Q))}else S=new g.cv(l.x,l.y,l.z);S.x/=n,S.y/=O,S.z/=h,S.normalize();const T=g.Vector2.Lerp(u[0],u[2],v/I),c=g.Vector2.Lerp(u[1],u[2],v/I),mo=I===v?u[2]:g.Vector2.Lerp(T,c,o/(I-v));j.push(l.x*n,l.y*O,l.z*h),t.push(S.x,S.y,S.z),s.push(mo.x,U.e?1-mo.y:mo.y),R.push(L),L++};for(let v=0;v<I;v++)for(let V=0;V+v<I;V++)o(V,v,V+1/3,v+1/3),o(V+1,v,V+1/3,v+1/3),o(V,v+1,V+1/3,v+1/3),V+v+1<I&&(o(V+1,v,V+2/3,v+2/3),o(V+1,v+1,V+2/3,v+2/3),o(V,v+1,V+2/3,v+2/3))}Q.d._ComputeSides(v,j,R,t,s,o.frontUVs,o.backUVs);const a=new Q.d;return a.indices=R,a.Jo=j,a.do=t,a.Yo=s,a}function H(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new E.e(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),g._originalBuilderSideOrientation=v.sideOrientation;return y(v).Po(g,v.updatable),g}Q.d.CreatePolyhedron=w,E.e.CreatePolyhedron=(o,v,V)=>z(o,v,V);Q.d.CreateIcoSphere=y,E.e.CreateIcoSphere=(o,v,V)=>H(o,v,V);var e=V(12511);const D=new g.cv(1,0,0),Z=new g.cv(-1,0,0),K=new g.cv(0,1,0),X=new g.cv(0,-1,0),r=new g.cv(0,0,1),B=new g.cv(0,0,-1);class A{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.cv.Zero(),v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.cv.Up(),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Vector2.Zero(),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=o,this.normal=v,this.uv=V,this.vertexIdx=E,this.vertexIdxForBones=I,this.localPositionOverride=Q,this.localNormalOverride=U,this.matrixIndicesOverride=n,this.matrixWeightsOverride=O}clone(){var o,v,V,g;return new A(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(o=this.localPositionOverride)||void 0===o?void 0:o.slice(),null===(v=this.localNormalOverride)||void 0===v?void 0:v.slice(),null===(V=this.matrixIndicesOverride)||void 0===V?void 0:V.slice(),null===(g=this.matrixWeightsOverride)||void 0===g?void 0:g.slice())}}function C(o,v,V){var n,O,h,x,f;const l=!!v.skeleton,S=!(null===(n=v.morphTargetManager)||void 0===n||!n.numTargets),T=V.localMode||l,c=v.QQ(),R=l||S?v.qU(!0,!0):v.getVerticesData(I.e.PositionKind),j=l||S?v.getNormalsData(!0,!0):v.getVerticesData(I.e.NormalKind),t=T?l?v.getVerticesData(I.e.PositionKind):R:null,s=T?l?v.getVerticesData(I.e.NormalKind):j:null,L=v.getVerticesData(I.e.UVKind),b=l?v.getVerticesData(I.e.MatricesIndicesKind):null,u=l?v.getVerticesData(I.e.MatricesWeightsKind):null,mo=l?v.getVerticesData(I.e.MatricesIndicesExtraKind):null,a=l?v.getVerticesData(I.e.MatricesWeightsExtraKind):null,F=V.position||g.cv.Zero();let i=V.normal||g.cv.Up();const J=V.size||g.cv.One(),d=V.angle||0;if(!i){const o=new g.cv(0,0,1),V=v.Fo().activeCamera,E=g.cv.TransformCoordinates(o,V.getWorldMatrix());i=V.globalPosition.Rv(E)}const N=-Math.atan2(i.z,i.x)-Math.PI/2,Y=Math.sqrt(i.x*i.x+i.z*i.z),q=Math.atan2(i.y,Y),P=new Q.d;P.indices=[],P.Jo=[],P.do=[],P.Yo=[],P.matricesIndices=l?[]:null,P.matricesWeights=l?[]:null,P.matricesIndicesExtra=mo?[]:null,P.matricesWeightsExtra=a?[]:null;let M=0;const W=(o,v)=>{const E=new A;if(!c||!R||!j)return E;const I=c[o];if(E.vertexIdx=3*I,E.vertexIdxForBones=4*I,E.position=new g.cv(R[3*I],R[3*I+1],R[3*I+2]),g.cv.TransformCoordinatesToRef(E.position,v,E.position),E.normal=new g.cv(j[3*I],j[3*I+1],j[3*I+2]),g.cv.TransformNormalToRef(E.normal,v,E.normal),V.captureUVS&&L){const o=L[2*I+1];E.uv=new g.Vector2(L[2*I],U.e?1-o:o)}return E},w=[0,0,0,0],z=(o,v)=>{if(0===o.length)return o;const V=.5*Math.abs(g.cv.Dot(J,v)),E=(o,v,V,g)=>{for(let E=0;E<g;++E)if(o[V+E]===v)return V+E;return-1},I=(o,I)=>{const Q=g.cv.GetClipFactor(o.position,I.position,v,V);let U=w,n=w;if(b&&u){const v=o.matrixIndicesOverride?0:o.vertexIdxForBones,V=o.matrixIndicesOverride??b,g=o.matrixWeightsOverride??u,O=I.matrixIndicesOverride?0:I.vertexIdxForBones,h=I.matrixIndicesOverride??b,x=I.matrixWeightsOverride??u;U=[0,0,0,0],n=[0,0,0,0];let f=0;for(let o=0;o<4;++o)if(g[v+o]>0){const I=E(h,V[v+o],O,4);U[f]=V[v+o],n[f]=(0,e.Lerp)(g[v+o],I>=0?x[I]:0,Q),f++}for(let o=0;o<4&&f<4;++o){const g=h[O+o];-1===E(V,g,v,4)&&(U[f]=g,n[f]=(0,e.Lerp)(0,x[O+o],Q),f++)}const l=n[0]+n[1]+n[2]+n[3];n[0]/=l,n[1]/=l,n[2]/=l,n[3]/=l}const O=o.localPositionOverride?o.localPositionOverride[0]:(null===t||void 0===t?void 0:t[o.vertexIdx])??0,h=o.localPositionOverride?o.localPositionOverride[1]:(null===t||void 0===t?void 0:t[o.vertexIdx+1])??0,x=o.localPositionOverride?o.localPositionOverride[2]:(null===t||void 0===t?void 0:t[o.vertexIdx+2])??0,f=I.localPositionOverride?I.localPositionOverride[0]:(null===t||void 0===t?void 0:t[I.vertexIdx])??0,l=I.localPositionOverride?I.localPositionOverride[1]:(null===t||void 0===t?void 0:t[I.vertexIdx+1])??0,S=I.localPositionOverride?I.localPositionOverride[2]:(null===t||void 0===t?void 0:t[I.vertexIdx+2])??0,T=o.localNormalOverride?o.localNormalOverride[0]:(null===s||void 0===s?void 0:s[o.vertexIdx])??0,c=o.localNormalOverride?o.localNormalOverride[1]:(null===s||void 0===s?void 0:s[o.vertexIdx+1])??0,R=o.localNormalOverride?o.localNormalOverride[2]:(null===s||void 0===s?void 0:s[o.vertexIdx+2])??0,j=T+((I.localNormalOverride?I.localNormalOverride[0]:(null===s||void 0===s?void 0:s[I.vertexIdx])??0)-T)*Q,L=c+((I.localNormalOverride?I.localNormalOverride[1]:(null===s||void 0===s?void 0:s[I.vertexIdx+1])??0)-c)*Q,mo=R+((I.localNormalOverride?I.localNormalOverride[2]:(null===s||void 0===s?void 0:s[I.vertexIdx+2])??0)-R)*Q,a=Math.sqrt(j*j+L*L+mo*mo);return new A(g.cv.Lerp(o.position,I.position,Q),g.cv.Lerp(o.normal,I.normal,Q).normalize(),g.Vector2.Lerp(o.uv,I.uv,Q),-1,-1,t?[O+(f-O)*Q,h+(l-h)*Q,x+(S-x)*Q]:null,s?[j/a,L/a,mo/a]:null,U,n)};let Q=null;o.length>3&&(Q=[]);for(let U=0;U<o.length;U+=3){let E=0,n=null,O=null,h=null,x=null;const f=g.cv.Dot(o[U].position,v)-V>0,l=g.cv.Dot(o[U+1].position,v)-V>0,S=g.cv.Dot(o[U+2].position,v)-V>0;switch(E=(f?1:0)+(l?1:0)+(S?1:0),E){case 0:o.length>3?(Q.push(o[U]),Q.push(o[U+1]),Q.push(o[U+2])):Q=o;break;case 1:if(Q=Q??new Array,f&&(n=o[U+1],O=o[U+2],h=I(o[U],n),x=I(o[U],O)),l){n=o[U],O=o[U+2],h=I(o[U+1],n),x=I(o[U+1],O),Q.push(h),Q.push(O.clone()),Q.push(n.clone()),Q.push(O.clone()),Q.push(h.clone()),Q.push(x);break}S&&(n=o[U],O=o[U+1],h=I(o[U+2],n),x=I(o[U+2],O)),n&&O&&h&&x&&(Q.push(n.clone()),Q.push(O.clone()),Q.push(h),Q.push(x),Q.push(h.clone()),Q.push(O.clone()));break;case 2:Q=Q??new Array,f||(n=o[U].clone(),O=I(n,o[U+1]),h=I(n,o[U+2]),Q.push(n),Q.push(O),Q.push(h)),l||(n=o[U+1].clone(),O=I(n,o[U+2]),h=I(n,o[U]),Q.push(n),Q.push(O),Q.push(h)),S||(n=o[U+2].clone(),O=I(n,o[U]),h=I(n,o[U+1]),Q.push(n),Q.push(O),Q.push(h))}}return Q},y=v instanceof E.e?v:null,H=null===y||void 0===y?void 0:y._thinInstanceDataStorage.matrixData,C=(null===y||void 0===y?void 0:y.bU)||1,p=g.TmpVectors.Matrix[0];p.U(g.Matrix.IdentityReadOnly);for(let E=0;E<C;++E){if(null!==y&&void 0!==y&&y.hasThinInstances&&H){const o=16*E;p.setRowFromFloats(0,H[o+0],H[o+1],H[o+2],H[o+3]),p.setRowFromFloats(1,H[o+4],H[o+5],H[o+6],H[o+7]),p.setRowFromFloats(2,H[o+8],H[o+9],H[o+10],H[o+11]),p.setRowFromFloats(3,H[o+12],H[o+13],H[o+14],H[o+15])}const o=g.Matrix.RotationYawPitchRoll(N,q,d).multiply(g.Matrix.Translation(F.x,F.y,F.z)),I=g.Matrix.Invert(o),Q=v.getWorldMatrix(),n=p.multiply(Q).multiply(I),O=new Array(3);for(let v=0;v<c.length;v+=3){let o=O;if(o[0]=W(v,n),o[1]=W(v+1,n),o[2]=W(v+2,n),!(V.cullBackFaces&&-o[0].normal.z<=0&&-o[1].normal.z<=0&&-o[2].normal.z<=0)&&(o=z(o,D),o&&(o=z(o,Z),o&&(o=z(o,K),o&&(o=z(o,X),o&&(o=z(o,r),o&&(o=z(o,B),o)))))))for(let v=0;v<o.length;v++){const g=o[v];if(P.indices.push(M),T?(g.localPositionOverride?(P.Jo[3*M]=g.localPositionOverride[0],P.Jo[3*M+1]=g.localPositionOverride[1],P.Jo[3*M+2]=g.localPositionOverride[2]):t&&(P.Jo[3*M]=t[g.vertexIdx],P.Jo[3*M+1]=t[g.vertexIdx+1],P.Jo[3*M+2]=t[g.vertexIdx+2]),g.localNormalOverride?(P.do[3*M]=g.localNormalOverride[0],P.do[3*M+1]=g.localNormalOverride[1],P.do[3*M+2]=g.localNormalOverride[2]):s&&(P.do[3*M]=s[g.vertexIdx],P.do[3*M+1]=s[g.vertexIdx+1],P.do[3*M+2]=s[g.vertexIdx+2])):(g.position.toArray(P.Jo,3*M),g.normal.toArray(P.do,3*M)),P.matricesIndices&&P.matricesWeights&&(g.matrixIndicesOverride?(P.matricesIndices[4*M]=g.matrixIndicesOverride[0],P.matricesIndices[4*M+1]=g.matrixIndicesOverride[1],P.matricesIndices[4*M+2]=g.matrixIndicesOverride[2],P.matricesIndices[4*M+3]=g.matrixIndicesOverride[3]):(b&&(P.matricesIndices[4*M]=b[g.vertexIdxForBones],P.matricesIndices[4*M+1]=b[g.vertexIdxForBones+1],P.matricesIndices[4*M+2]=b[g.vertexIdxForBones+2],P.matricesIndices[4*M+3]=b[g.vertexIdxForBones+3]),mo&&P.matricesIndicesExtra&&(P.matricesIndicesExtra[4*M]=mo[g.vertexIdxForBones],P.matricesIndicesExtra[4*M+1]=mo[g.vertexIdxForBones+1],P.matricesIndicesExtra[4*M+2]=mo[g.vertexIdxForBones+2],P.matricesIndicesExtra[4*M+3]=mo[g.vertexIdxForBones+3])),g.matrixWeightsOverride?(P.matricesWeights[4*M]=g.matrixWeightsOverride[0],P.matricesWeights[4*M+1]=g.matrixWeightsOverride[1],P.matricesWeights[4*M+2]=g.matrixWeightsOverride[2],P.matricesWeights[4*M+3]=g.matrixWeightsOverride[3]):(u&&(P.matricesWeights[4*M]=u[g.vertexIdxForBones],P.matricesWeights[4*M+1]=u[g.vertexIdxForBones+1],P.matricesWeights[4*M+2]=u[g.vertexIdxForBones+2],P.matricesWeights[4*M+3]=u[g.vertexIdxForBones+3]),a&&P.matricesWeightsExtra&&(P.matricesWeightsExtra[4*M]=a[g.vertexIdxForBones],P.matricesWeightsExtra[4*M+1]=a[g.vertexIdxForBones+1],P.matricesWeightsExtra[4*M+2]=a[g.vertexIdxForBones+2],P.matricesWeightsExtra[4*M+3]=a[g.vertexIdxForBones+3]))),V.captureUVS)g.uv.toArray(P.Yo,2*M);else{P.Yo.push(.5+g.position.x/J.x);const o=.5+g.position.y/J.y;P.Yo.push(U.e?1-o:o)}M++}}}0===P.indices.length&&(P.indices=null),0===P.Jo.length&&(P.Jo=null),0===P.do.length&&(P.do=null),0===P.Yo.length&&(P.Yo=null),0===(null===(O=P.matricesIndices)||void 0===O?void 0:O.length)&&(P.matricesIndices=null),0===(null===(h=P.matricesWeights)||void 0===h?void 0:h.length)&&(P.matricesWeights=null),0===(null===(x=P.matricesIndicesExtra)||void 0===x?void 0:x.length)&&(P.matricesIndicesExtra=null),0===(null===(f=P.matricesWeightsExtra)||void 0===f?void 0:f.length)&&(P.matricesWeightsExtra=null);const G=new E.e(o,v.Fo());return P.Po(G),T?(G.skeleton=v.skeleton,G.parent=v):(G.position=F.clone(),G.rotation=new g.cv(q,N,d)),G.Ag(!0),G.refreshBoundingInfo(!0,!0),G}function p(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const v=0|Math.max(o.subdivisions?o.subdivisions:2,1),V=0|Math.max(o.tessellation?o.tessellation:16,3),E=Math.max(o.height?o.height:1,0),I=Math.max(o.radius?o.radius:.25,0),n=0|Math.max(o.capSubdivisions?o.capSubdivisions:6,1),O=V,h=v,x=Math.max(o.radiusTop?o.radiusTop:I,0),f=Math.max(o.radiusBottom?o.radiusBottom:I,0),l=E-(x+f),S=2*Math.PI,T=Math.max(o.topCapSubdivisions?o.topCapSubdivisions:n,1),c=Math.max(o.bottomCapSubdivisions?o.bottomCapSubdivisions:n,1),R=Math.acos((f-x)/E);let j=[];const t=[],s=[],L=[];let b=0;const u=[],mo=.5*l,a=.5*Math.PI;let F,i;const J=g.cv.Zero(),d=g.cv.Zero(),N=Math.cos(R),Y=Math.sin(R),q=new g.Vector2(x*Y,mo+x*N).Rv(new g.Vector2(f*Y,f*N-mo)).length(),P=x*R+q+f*(a-R);let M=0;for(i=0;i<=T;i++){const o=[],v=a-R*(i/T);M+=x*R/T;const V=Math.cos(v),g=Math.sin(v),E=V*x;for(F=0;F<=O;F++){const v=F/O,I=v*S+0,Q=Math.sin(I),n=Math.cos(I);d.x=E*Q,d.y=mo+g*x,d.z=E*n,t.push(d.x,d.y,d.z),J.set(V*Q,g,V*n),s.push(J.x,J.y,J.z),L.push(v,U.e?M/P:1-M/P),o.push(b),b++}u.push(o)}const W=E-x-f+N*x-N*f,w=Y*(f-x)/W;for(i=1;i<=h;i++){const o=[];M+=q/h;const v=Y*(i*(f-x)/h+x);for(F=0;F<=O;F++){const V=F/O,g=V*S+0,E=Math.sin(g),I=Math.cos(g);d.x=v*E,d.y=mo+N*x-i*W/h,d.z=v*I,t.push(d.x,d.y,d.z),J.set(E,w,I).normalize(),s.push(J.x,J.y,J.z),L.push(V,U.e?M/P:1-M/P),o.push(b),b++}u.push(o)}for(i=1;i<=c;i++){const o=[],v=a-R-(Math.PI-R)*(i/c);M+=f*R/c;const V=Math.cos(v),g=Math.sin(v),E=V*f;for(F=0;F<=O;F++){const v=F/O,I=v*S+0,Q=Math.sin(I),n=Math.cos(I);d.x=E*Q,d.y=g*f-mo,d.z=E*n,t.push(d.x,d.y,d.z),J.set(V*Q,g,V*n),s.push(J.x,J.y,J.z),L.push(v,U.e?M/P:1-M/P),o.push(b),b++}u.push(o)}for(F=0;F<O;F++)for(i=0;i<T+h+c;i++){const o=u[i][F],v=u[i+1][F],V=u[i+1][F+1],g=u[i][F+1];j.push(o),j.push(v),j.push(g),j.push(v),j.push(V),j.push(g)}if(j=j.reverse(),o.orientation&&!o.orientation.equals(g.cv.Up())){const v=new g.Matrix;o.orientation.clone().scale(.5*Math.PI).cross(g.cv.Up()).toQuaternion().toRotationMatrix(v);const V=g.cv.Zero();for(let o=0;o<t.length;o+=3)V.set(t[o],t[o+1],t[o+2]),g.cv.TransformCoordinatesToRef(V.clone(),v,V),t[o]=V.x,t[o+1]=V.y,t[o+2]=V.z}const z=new Q.d;return z.Jo=t,z.do=s,z.Yo=L,z.indices=j,z}function G(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:g.cv.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new E.e(o,V);return p(v).Po(I,v.updatable),I}E.e.CreateDecal=(o,v,V,g,E,I)=>C(o,v,{position:V,normal:g,size:E,angle:I});E.e.CreateCapsule=(o,v,V)=>G(o,v,V),Q.d.CreateCapsule=p;var k=V(12308),oo=V(12497);class vo{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=o,this.y=v,o!==Math.floor(o)&&(o=Math.floor(o),k.b.Warn("x is not an integer, floor(x) used")),v!==Math.floor(v)&&(v=Math.floor(v),k.b.Warn("y is not an integer, floor(y) used"))}clone(){return new vo(this.x,this.y)}rotate60About(o){const v=this.x;return this.x=o.x+o.y-this.y,this.y=v+this.y-o.x,this}rotateNeg60About(o){const v=this.x;return this.x=v+this.y-o.y,this.y=o.x+o.y-v,this}rotate120(o,v){o!==Math.floor(o)&&(o=Math.floor(o),k.b.Warn("m not an integer only floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),k.b.Warn("n not an integer only floor(n) used"));const V=this.x;return this.x=o-V-this.y,this.y=v+V,this}rotateNeg120(o,v){o!==Math.floor(o)&&(o=Math.floor(o),k.b.Warn("m is not an integer, floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),k.b.Warn("n is not an integer,   floor(n) used"));const V=this.x;return this.x=this.y-v,this.y=o+v-V-this.y,this}toCartesianOrigin(o,v){const V=g.cv.Zero();return V.x=o.x+2*this.x*v+this.y*v,V.y=o.y+Math.sqrt(3)*this.y*v,V}static Zero(){return new vo(0,0)}}class Vo{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new go("icosahedron","Regular",[[0,oo.f,-1],[-oo.f,1,0],[-1,0,-oo.f],[1,0,-oo.f],[oo.f,1,0],[0,oo.f,1],[-1,0,oo.f],[-oo.f,-1,0],[0,-oo.f,-1],[oo.f,-1,0],[1,0,oo.f],[0,-oo.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let o=12;const v={},V=this.m,g=this.n;let E,I,Q,U,n,O=V,h=1,x=0;0!==g&&(O=(0,e.HighestCommonFactor)(V,g)),h=V/O,x=g/O;const f=vo.Zero(),l=new vo(V,g),S=new vo(-g,V+g),T=vo.Zero(),c=vo.Zero(),R=vo.Zero();let j,t,s,L,b=[];const u=[],mo=this.vertByDist,a=(V,g,E,I)=>{j=V+"|"+E,t=g+"|"+I,j in v||t in v?j in v&&!(t in v)?v[t]=v[j]:t in v&&!(j in v)&&(v[j]=v[t]):(v[j]=o,v[t]=o,o++),mo[E][0]>2?u[v[j]]=[-mo[E][0],mo[E][1],v[j]]:u[v[j]]=[b[mo[E][0]],mo[E][1],v[j]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let F=0;F<20;F++){if(b=this.IDATA.face[F],Q=b[2],U=b[1],n=b[0],s=f.x+"|"+f.y,j=F+"|"+s,j in v||(v[j]=Q,u[Q]=[b[mo[s][0]],mo[s][1]]),s=l.x+"|"+l.y,j=F+"|"+s,j in v||(v[j]=U,u[U]=[b[mo[s][0]],mo[s][1]]),s=S.x+"|"+S.y,j=F+"|"+s,j in v||(v[j]=n,u[n]=[b[mo[s][0]],mo[s][1]]),E=this.IDATA.edgematch[F][0],I=this.IDATA.edgematch[F][1],"B"===I)for(let o=1;o<O;o++)c.x=V-o*(h+x),c.y=g+o*h,R.x=-o*x,R.y=o*(h+x),s=c.x+"|"+c.y,L=R.x+"|"+R.y,a(F,E,s,L);if("O"===I)for(let o=1;o<O;o++)R.x=-o*x,R.y=o*(h+x),T.x=o*h,T.y=o*x,s=R.x+"|"+R.y,L=T.x+"|"+T.y,a(F,E,s,L);if(E=this.IDATA.edgematch[F][2],I=this.IDATA.edgematch[F][3],I&&"A"===I)for(let o=1;o<O;o++)T.x=o*h,T.y=o*x,c.x=V-(O-o)*(h+x),c.y=g+(O-o)*h,s=T.x+"|"+T.y,L=c.x+"|"+c.y,a(F,E,s,L);for(let V=0;V<this.vertices.length;V++)s=this.vertices[V].x+"|"+this.vertices[V].y,j=F+"|"+s,j in v||(v[j]=o++,mo[s][0]>2?u[v[j]]=[-mo[s][0],mo[s][1],v[j]]:u[v[j]]=[b[mo[s][0]],mo[s][1],v[j]])}this.closestTo=u,this.vecToidx=v}calcCoeffs(){const o=this.m,v=this.n,V=Math.sqrt(3)/3,g=o*o+v*v+o*v;this.coau=(o+v)/g,this.cobu=-v/g,this.coav=-V*(o-v)/g,this.cobv=V*(2*o+v)/g}createInnerFacets(){const o=this.m,v=this.n;for(let V=0;V<v+o+1;V++)for(let o=this.min[V];o<this.max[V]+1;o++)o<this.max[V]&&o<this.max[V+1]+1&&this.innerFacets.push(["|"+o+"|"+V,"|"+o+"|"+(V+1),"|"+(o+1)+"|"+V]),V>0&&o<this.max[V-1]&&o+1<this.max[V]+1&&this.innerFacets.push(["|"+o+"|"+V,"|"+(o+1)+"|"+V,"|"+(o+1)+"|"+(V-1)])}edgeVecsABOB(){const o=this.m,v=this.n,V=new vo(-v,o+v);for(let g=1;g<o+v;g++){const o=new vo(this.min[g],g),v=new vo(this.min[g-1],g-1),E=new vo(this.min[g+1],g+1),I=o.clone(),Q=v.clone(),U=E.clone();I.rotate60About(V),Q.rotate60About(V),U.rotate60About(V);const n=new vo(this.max[I.y],I.y),O=new vo(this.max[I.y-1],I.y-1),h=new vo(this.max[I.y-1]-1,I.y-1);I.x===n.x&&I.y===n.y||(I.x!==O.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([o,O,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([o,h,n])):I.y===U.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([o,v,O]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([o,O,E])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([o,v,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([o,O,n])))}}mapABOBtoOBOA(){const o=new vo(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const V=[];for(let g=0;g<3;g++)o.x=this.isoVecsABOB[v][g].x,o.y=this.isoVecsABOB[v][g].y,0===this.vertexTypes[v][g]&&o.rotateNeg120(this.m,this.n),V.push(o.clone());this.isoVecsOBOA.push(V)}}mapABOBtoBAOA(){const o=new vo(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const V=[];for(let g=0;g<3;g++)o.x=this.isoVecsABOB[v][g].x,o.y=this.isoVecsABOB[v][g].y,1===this.vertexTypes[v][g]&&o.rotate120(this.m,this.n),V.push(o.clone());this.isoVecsBAOA.push(V)}}MapToFace(o,v){const V=this.IDATA.face[o],E=V[2],I=V[1],Q=V[0],U=g.cv.bv(this.IDATA.vertex[E]),n=g.cv.bv(this.IDATA.vertex[I]),O=g.cv.bv(this.IDATA.vertex[Q]),h=n.Rv(U),x=O.Rv(U),f=h.scale(this.coau).add(x.scale(this.cobu)),l=h.scale(this.coav).add(x.scale(this.cobv)),S=[];let T,c=g.TmpVectors.cv[0];for(let g=0;g<this.cartesian.length;g++)c=f.scale(this.cartesian[g].x).add(l.scale(this.cartesian[g].y)).add(U),S[g]=[c.x,c.y,c.z],T=o+"|"+this.vertices[g].x+"|"+this.vertices[g].y,v.vertex[this.vecToidx[T]]=[c.x,c.y,c.z]}build(o,v){const V=[],g=vo.Zero(),E=new vo(o,v),I=new vo(-v,o+v);V.push(g,E,I);for(let s=v;s<o+1;s++)for(let v=0;v<o+1-s;v++)V.push(new vo(v,s));if(v>0){const g=(0,e.HighestCommonFactor)(o,v),E=o/g,I=v/g;for(let U=1;U<g;U++)V.push(new vo(U*E,U*I)),V.push(new vo(-U*I,U*(E+I))),V.push(new vo(o-U*(E+I),v+U*E));const Q=o/v;for(let U=1;U<v;U++)for(let g=0;g<U*Q;g++)V.push(new vo(g,U)),V.push(new vo(g,U).rotate120(o,v)),V.push(new vo(g,U).rotateNeg120(o,v))}V.sort(((o,v)=>o.x-v.x)),V.sort(((o,v)=>o.y-v.y));const Q=new Array(o+v+1),U=new Array(o+v+1);for(let s=0;s<Q.length;s++)Q[s]=1/0,U[s]=-1/0;let n=0,O=0;const h=V.length;for(let s=0;s<h;s++)O=V[s].x,n=V[s].y,Q[n]=Math.min(O,Q[n]),U[n]=Math.max(O,U[n]);const x=(V,g)=>{const E=V.clone();return"A"===g&&E.rotateNeg120(o,v),"B"===g&&E.rotate120(o,v),E.x<0?E.y:E.x+E.y},f=[],l=[],S=[],T=[],c={},R=[];let j=-1,t=-1;for(let s=0;s<h;s++)f[s]=V[s].toCartesianOrigin(new vo(0,0),.5),l[s]=x(V[s],"O"),S[s]=x(V[s],"A"),T[s]=x(V[s],"B"),l[s]===S[s]&&S[s]===T[s]?(j=3,t=l[s]):l[s]===S[s]?(j=4,t=l[s]):S[s]===T[s]?(j=5,t=S[s]):T[s]===l[s]&&(j=6,t=l[s]),l[s]<S[s]&&l[s]<T[s]&&(j=2,t=l[s]),S[s]<l[s]&&S[s]<T[s]&&(j=1,t=S[s]),T[s]<S[s]&&T[s]<l[s]&&(j=0,t=T[s]),R.push([j,t,V[s].x,V[s].y]);R.sort(((o,v)=>o[2]-v[2])),R.sort(((o,v)=>o[3]-v[3])),R.sort(((o,v)=>o[1]-v[1])),R.sort(((o,v)=>o[0]-v[0]));for(let s=0;s<R.length;s++)c[R[s][2]+"|"+R[s][3]]=[R[s][0],R[s][1],s];return this.m=o,this.n=v,this.vertices=V,this.vertByDist=c,this.cartesian=f,this.min=Q,this.max=U,this}}class go{constructor(o,v,V,g){this.name=o,this.category=v,this.vertex=V,this.face=g}}class Eo extends go{innerToData(o,v){for(let V=0;V<v.innerFacets.length;V++)this.face.push(v.innerFacets[V].map((V=>v.vecToidx[o+V])))}mapABOBtoDATA(o,v){const V=v.IDATA.edgematch[o][0];for(let g=0;g<v.isoVecsABOB.length;g++){const E=[];for(let I=0;I<3;I++)0===v.vertexTypes[g][I]?E.push(o+"|"+v.isoVecsABOB[g][I].x+"|"+v.isoVecsABOB[g][I].y):E.push(V+"|"+v.isoVecsABOB[g][I].x+"|"+v.isoVecsABOB[g][I].y);this.face.push([v.vecToidx[E[0]],v.vecToidx[E[1]],v.vecToidx[E[2]]])}}mapOBOAtoDATA(o,v){const V=v.IDATA.edgematch[o][0];for(let g=0;g<v.isoVecsOBOA.length;g++){const E=[];for(let I=0;I<3;I++)1===v.vertexTypes[g][I]?E.push(o+"|"+v.isoVecsOBOA[g][I].x+"|"+v.isoVecsOBOA[g][I].y):E.push(V+"|"+v.isoVecsOBOA[g][I].x+"|"+v.isoVecsOBOA[g][I].y);this.face.push([v.vecToidx[E[0]],v.vecToidx[E[1]],v.vecToidx[E[2]]])}}mapBAOAtoDATA(o,v){const V=v.IDATA.edgematch[o][2];for(let g=0;g<v.isoVecsBAOA.length;g++){const E=[];for(let I=0;I<3;I++)1===v.vertexTypes[g][I]?E.push(o+"|"+v.isoVecsBAOA[g][I].x+"|"+v.isoVecsBAOA[g][I].y):E.push(V+"|"+v.isoVecsBAOA[g][I].x+"|"+v.isoVecsBAOA[g][I].y);this.face.push([v.vecToidx[E[0]],v.vecToidx[E[1]],v.vecToidx[E[2]]])}}orderData(o){const v=[];for(let I=0;I<13;I++)v[I]=[];const V=o.closestTo;for(let I=0;I<V.length;I++)V[I][0]>-1?V[I][1]>0&&v[V[I][0]].push([I,V[I][1]]):v[12].push([I,V[I][0]]);const g=[];for(let I=0;I<12;I++)g[I]=I;let E=12;for(let I=0;I<12;I++){v[I].sort(((o,v)=>o[1]-v[1]));for(let o=0;o<v[I].length;o++)g[v[I][o][0]]=E++}for(let I=0;I<v[12].length;I++)g[v[12][I][0]]=E++;for(let I=0;I<this.vertex.length;I++)this.vertex[I].push(g[I]);this.vertex.sort(((o,v)=>o[3]-v[3]));for(let I=0;I<this.vertex.length;I++)this.vertex[I].pop();for(let I=0;I<this.face.length;I++)for(let o=0;o<this.face[I].length;o++)this.face[I][o]=g[this.face[I][o]];this.sharedNodes=v[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(o,v){const V=[],g=[];let E=v.pop();g.push(E);let I=this.face[E].indexOf(o);I=(I+2)%3;let Q=this.face[E][I];V.push(Q);let U=0;for(;v.length>0;)E=v[U],this.face[E].indexOf(Q)>-1?(I=(this.face[E].indexOf(Q)+1)%3,Q=this.face[E][I],V.push(Q),g.push(E),v.splice(U,1),U=0):U++;return this.adjacentFaces.push(V),g}toGoldbergPolyhedronData(){const o=new go("GeoDual","Goldberg",[],[]);o.name="GD dual";const v=this.vertex.length,V=new Array(v);for(let n=0;n<v;n++)V[n]=[];for(let n=0;n<this.face.length;n++)for(let o=0;o<3;o++)V[this.face[n][o]].push(n);let g=0,E=0,I=0,Q=[],U=[];this.adjacentFaces=[];for(let n=0;n<V.length;n++){o.face[n]=this.setOrder(n,V[n].concat([]));for(const v of V[n]){g=0,E=0,I=0,Q=this.face[v];for(let o=0;o<3;o++)U=this.vertex[Q[o]],g+=U[0],E+=U[1],I+=U[2];o.vertex[v]=[g/3,E/3,I/3]}}return o}static BuildGeodesicData(o){const v=new Eo("Geodesic-m-n","Geodesic",[[0,oo.f,-1],[-oo.f,1,0],[-1,0,-oo.f],[1,0,-oo.f],[oo.f,1,0],[0,oo.f,1],[-1,0,oo.f],[-oo.f,-1,0],[0,-oo.f,-1],[oo.f,-1,0],[1,0,oo.f],[0,-oo.f,1]],[]);o.setIndices(),o.calcCoeffs(),o.createInnerFacets(),o.edgeVecsABOB(),o.mapABOBtoOBOA(),o.mapABOBtoBAOA();for(let V=0;V<o.IDATA.face.length;V++)o.MapToFace(V,v),v.innerToData(V,o),"B"===o.IDATA.edgematch[V][1]&&v.mapABOBtoDATA(V,o),"O"===o.IDATA.edgematch[V][1]&&v.mapOBOAtoDATA(V,o),"A"===o.IDATA.edgematch[V][3]&&v.mapBAOAtoDATA(V,o);v.orderData(o);return v.vertex=v.vertex.map((function(o){const v=o[0],V=o[1],g=o[2],E=Math.sqrt(v*v+V*V+g*g);return o[0]*=1/E,o[1]*=1/E,o[2]*=1/E,o})),v}}E.e._GoldbergMeshParser=(o,v)=>Io.Parse(o,v);class Io extends E.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(o,v){return void 0===v?(o>this.goldbergData.nbUnsharedFaces-1&&(k.b.Warn("Maximum number of unshared faces used"),o=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+o):(o>11&&(k.b.Warn("Last pole used"),o=11),v>this.goldbergData.nbFacesAtPole-1&&(k.b.Warn("Maximum number of faces at a pole used"),v=this.goldbergData.nbFacesAtPole-1),12+o*this.goldbergData.nbFacesAtPole+v)}_changeGoldbergFaceColors(o){for(let V=0;V<o.length;V++){const v=o[V][0],g=o[V][1],E=o[V][2];for(let o=v;o<g+1;o++)this.goldbergData.faceColors[o]=E}const v=[];for(let V=0;V<12;V++)for(let o=0;o<5;o++)v.push(this.goldbergData.faceColors[V].r,this.goldbergData.faceColors[V].g,this.goldbergData.faceColors[V].b,this.goldbergData.faceColors[V].a);for(let V=12;V<this.goldbergData.faceColors.length;V++)for(let o=0;o<6;o++)v.push(this.goldbergData.faceColors[V].r,this.goldbergData.faceColors[V].g,this.goldbergData.faceColors[V].b,this.goldbergData.faceColors[V].a);return v}setGoldbergFaceColors(o){const v=this._changeGoldbergFaceColors(o);this.zo(I.e.ColorKind,v)}updateGoldbergFaceColors(o){const v=this._changeGoldbergFaceColors(o);this.updateVerticesData(I.e.ColorKind,v)}_changeGoldbergFaceUVs(o){const v=this.getVerticesData(I.e.UVKind);for(let V=0;V<o.length;V++){const g=o[V][0],E=o[V][1],I=o[V][2],Q=o[V][3],U=o[V][4],n=[],O=[];let h,x;for(let o=0;o<5;o++)h=I.x+Q*Math.cos(U+o*Math.PI/2.5),x=I.y+Q*Math.sin(U+o*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),n.push(h,x);for(let o=0;o<6;o++)h=I.x+Q*Math.cos(U+o*Math.PI/3),x=I.y+Q*Math.sin(U+o*Math.PI/3),h<0&&(h=0),h>1&&(h=1),O.push(h,x);for(let o=g;o<Math.min(12,E+1);o++)for(let V=0;V<5;V++)v[10*o+2*V]=n[2*V],v[10*o+2*V+1]=n[2*V+1];for(let o=Math.max(12,g);o<E+1;o++)for(let V=0;V<6;V++)v[12*o-24+2*V]=O[2*V],v[12*o-23+2*V]=O[2*V+1]}return v}setGoldbergFaceUVs(o){const v=this._changeGoldbergFaceUVs(o);this.zo(I.e.UVKind,v)}updateGoldbergFaceUVs(o){const v=this._changeGoldbergFaceUVs(o);this.updateVerticesData(I.e.UVKind,v)}placeOnGoldbergFaceAt(o,v,V){const E=g.cv.RotationFromAxis(this.goldbergData.faceXaxis[v],this.goldbergData.faceYaxis[v],this.goldbergData.faceZaxis[v]);o.rotation=E,o.position=this.goldbergData.faceCenters[v].add(this.goldbergData.faceXaxis[v].scale(V.x)).add(this.goldbergData.faceYaxis[v].scale(V.y)).add(this.goldbergData.faceZaxis[v].scale(V.z))}serialize(o){super.serialize(o),o.type="GoldbergMesh";const v={};if(v.adjacentFaces=this.goldbergData.adjacentFaces,v.nbSharedFaces=this.goldbergData.nbSharedFaces,v.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,v.nbFaces=this.goldbergData.nbFaces,v.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){v.faceColors=[];for(const o of this.goldbergData.faceColors)v.faceColors.push(o.Dg())}if(this.goldbergData.faceCenters){v.faceCenters=[];for(const o of this.goldbergData.faceCenters)v.faceCenters.push(o.Dg())}if(this.goldbergData.faceZaxis){v.faceZaxis=[];for(const o of this.goldbergData.faceZaxis)v.faceZaxis.push(o.Dg())}if(this.goldbergData.faceYaxis){v.faceYaxis=[];for(const o of this.goldbergData.faceYaxis)v.faceYaxis.push(o.Dg())}if(this.goldbergData.faceXaxis){v.faceXaxis=[];for(const o of this.goldbergData.faceXaxis)v.faceXaxis.push(o.Dg())}o.goldbergData=v}static Parse(o,v){const V=o.goldbergData;V.faceColors=V.faceColors.map((o=>f.sU.bv(o))),V.faceCenters=V.faceCenters.map((o=>g.cv.bv(o))),V.faceZaxis=V.faceZaxis.map((o=>g.cv.bv(o))),V.faceXaxis=V.faceXaxis.map((o=>g.cv.bv(o))),V.faceYaxis=V.faceYaxis.map((o=>g.cv.bv(o)));const E=new Io(o.name,v);return E.goldbergData=V,E}}var Qo=V(13058);const Uo={CreateBox:x.b,CreateTiledBox:c,CreateSphere:R.d,CreateDisc:h.e,CreateIcoSphere:H,CreateRibbon:O,CreateCylinder:L,CreateTorus:u,CreateTorusKnot:a,CreateLineSystem:F.d,TO:F.f,CreateDashedLines:F.c,ExtrudeShape:d,ExtrudeShapeCustom:N,CreateLathe:q,CreateTiledPlane:S,jO:P.e,CreateGround:M.g,CreateTiledGround:M.i,CreateGroundFromHeightMap:M.d,CreatePolygon:i.c,ExtrudePolygon:i.g,CreateTube:W,CreatePolyhedron:z,CreateGeodesic:function(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=v.m||1;g!==Math.floor(g)&&(g=Math.floor(g),k.b.Warn("m not an integer only floor(m) used"));let E=v.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),k.b.Warn("n not an integer only floor(n) used")),E>g){const o=E;E=g,g=o,k.b.Warn("n > m therefore m and n swapped")}const I=new Vo;return I.build(g,E),z(o,{custom:Eo.BuildGeodesicData(I),size:v.size,sizeX:v.sizeX,sizeY:v.sizeY,sizeZ:v.sizeZ,faceUV:v.faceUV,faceColors:v.faceColors,flat:v.flat,updatable:v.updatable,sideOrientation:v.sideOrientation,frontUVs:v.frontUVs,backUVs:v.backUVs},V)},CreateGoldberg:function(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=v.size,n=v.sizeX||I||1,O=v.sizeY||I||1,h=v.sizeZ||I||1;let x=v.m||1;x!==Math.floor(x)&&(x=Math.floor(x),k.b.Warn("m not an integer only floor(m) used"));let l=v.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),k.b.Warn("n not an integer only floor(n) used")),l>x){const o=l;l=x,x=o,k.b.Warn("n > m therefore m and n swapped")}const S=new Vo;S.build(x,l);const T=Eo.BuildGeodesicData(S),c=T.toGoldbergPolyhedronData(),R=new Io(o,V);v.sideOrientation=E.e._GetDefaultSideOrientation(v.sideOrientation),R._originalBuilderSideOrientation=v.sideOrientation;(function(o,v){const V=o.size,E=o.sizeX||V||1,I=o.sizeY||V||1,n=o.sizeZ||V||1,O=0===o.sideOrientation?0:o.sideOrientation||Q.d.DEFAULTSIDE,h=[],x=[],f=[],l=[];let S=1/0,T=-1/0,c=1/0,R=-1/0;for(let g=0;g<v.vertex.length;g++)S=Math.min(S,v.vertex[g][0]*E),T=Math.max(T,v.vertex[g][0]*E),c=Math.min(c,v.vertex[g][1]*I),R=Math.max(R,v.vertex[g][1]*I);let j=0;for(let Q=0;Q<v.face.length;Q++){const o=v.face[Q],V=g.cv.bv(v.vertex[o[0]]),O=g.cv.bv(v.vertex[o[2]]),t=g.cv.bv(v.vertex[o[1]]),s=O.Rv(V),L=t.Rv(V),b=g.cv.Cross(L,s).normalize();for(let g=0;g<o.length;g++){f.push(b.x,b.y,b.z);const V=v.vertex[o[g]];h.push(V[0]*E,V[1]*I,V[2]*n);const Q=(V[1]*I-c)/(R-c);l.push((V[0]*E-S)/(T-S),U.e?1-Q:Q)}for(let v=0;v<o.length-2;v++)x.push(j,j+v+2,j+v+1);j+=o.length}Q.d._ComputeSides(O,h,x,f,l);const t=new Q.d;return t.Jo=h,t.indices=x,t.do=f,t.Yo=l,t})(v,c).Po(R,v.updatable),R.goldbergData.nbSharedFaces=T.sharedNodes,R.goldbergData.nbUnsharedFaces=T.poleNodes,R.goldbergData.adjacentFaces=T.adjacentFaces,R.goldbergData.nbFaces=R.goldbergData.nbSharedFaces+R.goldbergData.nbUnsharedFaces,R.goldbergData.nbFacesAtPole=(R.goldbergData.nbUnsharedFaces-12)/12;for(let E=0;E<T.vertex.length;E++)R.goldbergData.faceCenters.push(g.cv.bv(T.vertex[E])),R.goldbergData.faceCenters[E].x*=n,R.goldbergData.faceCenters[E].y*=O,R.goldbergData.faceCenters[E].z*=h,R.goldbergData.faceColors.push(new f.sU(1,1,1,1));for(let E=0;E<c.face.length;E++){const o=c.face[E],v=g.cv.bv(c.vertex[o[0]]),V=g.cv.bv(c.vertex[o[2]]),I=g.cv.bv(c.vertex[o[1]]),Q=V.Rv(v),U=I.Rv(v),n=g.cv.Cross(U,Q).normalize(),O=g.cv.Cross(U,n).normalize();R.goldbergData.faceXaxis.push(U.normalize()),R.goldbergData.faceYaxis.push(n),R.goldbergData.faceZaxis.push(O)}return R},CreateDecal:C,CreateCapsule:G,CreateText:Qo.g}},13840:(o,v,V)=>{"use strict";V.d(v,{b:()=>nv});var g=V(12488),E=V(12892);class I extends E.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Q=V(12547),U=(V(12662),V(12449));class n{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(o){this._targetStopDuration!==o&&(this._targetStopDuration=o)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(o){this._noiseTexture!==o&&(this._noiseTexture=o,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(o){this._animationSheetEnabled!==o&&(this._animationSheetEnabled=o)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(o){this._isAnimationSheetEnabled!=o&&(this._isAnimationSheetEnabled=o,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(o){this._useLogarithmicDepth=o&&this.Fo().getEngine().getCaps().fragmentDepthSupported}Fo(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(o){switch(o){case n.BLENDMODE_MULTIPLYADD:return;case n.BLENDMODE_ADD:o=1;break;case n.BLENDMODE_ONEONE:o=6;break;case n.BLENDMODE_STANDARD:o=2;break;case n.BLENDMODE_MULTIPLY:o=4;break;case n.BLENDMODE_SUBTRACT:o=3}this._engine.setAlphaMode(o)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:g.cv.Zero()}set direction1(o){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=o)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:g.cv.Zero()}set direction2(o){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=o)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:g.cv.Zero()}set minEmitBox(o){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=o)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:g.cv.Zero()}set maxEmitBox(o){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=o)}get billboardMode(){return this._billboardMode}set billboardMode(o){this._billboardMode!==o&&(this._billboardMode=o,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(o){this._isBillboardBased!==o&&(this._isBillboardBased=o,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(o){this._attachImageProcessingConfiguration(o)}_attachImageProcessingConfiguration(o){o!==this._imageProcessingConfiguration&&(!o&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=o)}_reset(){}_removeGradientAndTexture(o,v,V){if(!v)return this;let g=0;for(const E of v){if(E.gradient===o){v.splice(g,1);break}g++}return V&&V.dispose(),this}constructor(o){this.animations=[],this.renderingGroupId=0,this.lo=g.cv.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new g.cv(10,10,10),this.onAnimationEnd=null,this.blendMode=n.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new g.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.fO=new g.cv(0,0,0),this._useLogarithmicDepth=!1,this.gravity=g.cv.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Q.sU(1,1,1,1),this.color2=new Q.sU(1,1,1,1),this.colorDead=new Q.sU(0,0,0,1),this.textureMask=new Q.sU(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new I,this.id=o,this.name=o}createPointEmitter(o,v){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new g.cv(0,1,0),arguments.length>2&&void 0!==arguments[2]||new g.cv(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new g.cv(0,1,0),arguments.length>4&&void 0!==arguments[4]||new g.cv(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new g.cv(0,1,0),arguments.length>3&&void 0!==arguments[3]||new g.cv(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(o,v,V,g){throw new Error("Method not implemented.")}}n.BLENDMODE_ONEONE=0,n.BLENDMODE_STANDARD=1,n.BLENDMODE_ADD=2,n.BLENDMODE_MULTIPLY=3,n.BLENDMODE_MULTIPLYADD=4,n.BLENDMODE_SUBTRACT=-1,(0,U.h)("BABYLON.BaseParticleSystem",n);var O=V(12511),h=V(12313);class x{constructor(){this.direction1=new g.cv(0,1,0),this.direction2=new g.cv(0,1,0),this.minEmitBox=new g.cv(-.5,-.5,-.5),this.maxEmitBox=new g.cv(.5,.5,.5)}startDirectionFunction(o,v,V,E){const I=(0,O.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,O.RandomRange)(this.direction1.y,this.direction2.y),U=(0,O.RandomRange)(this.direction1.z,this.direction2.z);if(E)return v.x=I,v.y=Q,void(v.z=U);g.cv.TransformNormalFromFloatsToRef(I,Q,U,o,v)}startPositionFunction(o,v,V,E){const I=(0,O.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Q=(0,O.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),U=(0,O.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(E)return v.x=I,v.y=Q,void(v.z=U);g.cv.TransformCoordinatesFromFloatsToRef(I,Q,U,o,v)}clone(){const o=new x;return h.b.DeepCopy(this,o),o}applyToShader(o){o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2),o.setVector3("minEmitBox",this.minEmitBox),o.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(o){o.addUniform("direction1",3),o.addUniform("direction2",3),o.addUniform("minEmitBox",3),o.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.direction1=this.direction1.Dg(),o.direction2=this.direction2.Dg(),o.minEmitBox=this.minEmitBox.Dg(),o.maxEmitBox=this.maxEmitBox.Dg(),o}parse(o){g.cv.FromArrayToRef(o.direction1,0,this.direction1),g.cv.FromArrayToRef(o.direction2,0,this.direction2),g.cv.FromArrayToRef(o.minEmitBox,0,this.minEmitBox),g.cv.FromArrayToRef(o.maxEmitBox,0,this.maxEmitBox)}}class f{get radius(){return this._radius}set radius(o){this._radius=o,this._buildHeight()}get angle(){return this._angle}set angle(o){this._angle=o,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=V,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=v,this.radius=o}startDirectionFunction(o,v,V,E){E?g.TmpVectors.cv[0].U(V.ZU).normalize():V.position.subtractToRef(o.getTranslation(),g.TmpVectors.cv[0]).normalize();const I=(0,O.RandomRange)(0,this.directionRandomizer),Q=(0,O.RandomRange)(0,this.directionRandomizer),U=(0,O.RandomRange)(0,this.directionRandomizer);v.x=g.TmpVectors.cv[0].x+I,v.y=g.TmpVectors.cv[0].y+Q,v.z=g.TmpVectors.cv[0].z+U,v.normalize()}startPositionFunction(o,v,V,E){const I=(0,O.RandomRange)(0,2*Math.PI);let Q;this.emitFromSpawnPointOnly?Q=1e-4:(Q=(0,O.RandomRange)(0,this.heightRange),Q=1-Q*Q);let U=this._radius-(0,O.RandomRange)(0,this._radius*this.radiusRange);U*=Q;const n=U*Math.sin(I),h=U*Math.cos(I),x=Q*this._height;if(E)return v.x=n,v.y=x,void(v.z=h);g.cv.TransformCoordinatesFromFloatsToRef(n,x,h,o,v)}clone(){const o=new f(this._radius,this._angle,this.directionRandomizer);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat2("radius",this._radius,this.radiusRange),o.setFloat("coneAngle",this._angle),o.setFloat2("height",this._height,this.heightRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",2),o.addUniform("coneAngle",1),o.addUniform("height",2),o.addUniform("directionRandomizer",1)}getEffectDefines(){let o="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(o+="\n#define CONEEMITTERSPAWNPOINT"),o}getClassName(){return"ConeParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this._radius,o.angle=this._angle,o.directionRandomizer=this.directionRandomizer,o.radiusRange=this.radiusRange,o.heightRange=this.heightRange,o.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,o}parse(o){this.radius=o.radius,this.angle=o.angle,this.directionRandomizer=o.directionRandomizer,this.radiusRange=void 0!==o.radiusRange?o.radiusRange:1,this.heightRange=void 0!==o.radiusRange?o.heightRange:1,this.emitFromSpawnPointOnly=void 0!==o.emitFromSpawnPointOnly&&o.emitFromSpawnPointOnly}}class l extends f{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0);super(o,v),this.direction1=V,this.direction2=E}startDirectionFunction(o,v){const V=(0,O.RandomRange)(this.direction1.x,this.direction2.x),E=(0,O.RandomRange)(this.direction1.y,this.direction2.y),I=(0,O.RandomRange)(this.direction1.z,this.direction2.z);g.cv.TransformNormalFromFloatsToRef(V,E,I,o,v)}clone(){const o=new l(this.radius,this.angle,this.direction1,this.direction2);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const o=super.serialize();return o.direction1=this.direction1.Dg(),o.direction2=this.direction2.Dg(),o}parse(o){super.parse(o),this.direction1.U(o.direction1),this.direction2.U(o.direction2)}}class S{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=o,this.height=v,this.radiusRange=V,this.directionRandomizer=E,this._tempVector=g.cv.Zero()}startDirectionFunction(o,v,V,E,I){V.position.subtractToRef(o.getTranslation(),this._tempVector),this._tempVector.normalize(),g.cv.TransformNormalToRef(this._tempVector,I,this._tempVector);const Q=(0,O.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Q,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),E?v.U(this._tempVector):g.cv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,o,v)}startPositionFunction(o,v,V,E){const I=(0,O.RandomRange)(-this.height/2,this.height/2),Q=(0,O.RandomRange)(0,2*Math.PI),U=(0,O.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),n=Math.sqrt(U)*this.radius,h=n*Math.cos(Q),x=n*Math.sin(Q);E?v.RU(h,I,x):g.cv.TransformCoordinatesFromFloatsToRef(h,I,x,o,v)}clone(){const o=new S(this.radius,this.directionRandomizer);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("height",this.height),o.setFloat("radiusRange",this.radiusRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("height",1),o.addUniform("radiusRange",1),o.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this.radius,o.height=this.height,o.radiusRange=this.radiusRange,o.directionRandomizer=this.directionRandomizer,o}parse(o){this.radius=o.radius,this.height=o.height,this.radiusRange=o.radiusRange,this.directionRandomizer=o.directionRandomizer}}class T extends S{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0),I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new g.cv(0,1,0);super(o,v,V),this.direction1=E,this.direction2=I}startDirectionFunction(o,v,V,E){const I=(0,O.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,O.RandomRange)(this.direction1.y,this.direction2.y),U=(0,O.RandomRange)(this.direction1.z,this.direction2.z);E?v.RU(I,Q,U):g.cv.TransformNormalFromFloatsToRef(I,Q,U,o,v)}clone(){const o=new T(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("height",this.height),o.setFloat("radiusRange",this.radiusRange),o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("height",1),o.addUniform("radiusRange",1),o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const o=super.serialize();return o.direction1=this.direction1.Dg(),o.direction2=this.direction2.Dg(),o}parse(o){super.parse(o),g.cv.FromArrayToRef(o.direction1,0,this.direction1),g.cv.FromArrayToRef(o.direction2,0,this.direction2)}}class c{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=o,this.radiusRange=v,this.directionRandomizer=V}startDirectionFunction(o,v,V,E){const I=V.position.Rv(o.getTranslation()).normalize(),Q=(0,O.RandomRange)(0,this.directionRandomizer),U=(0,O.RandomRange)(0,this.directionRandomizer),n=(0,O.RandomRange)(0,this.directionRandomizer);I.x+=Q,I.y+=U,I.z+=n,I.normalize(),E?v.U(I):g.cv.TransformNormalFromFloatsToRef(I.x,I.y,I.z,o,v)}startPositionFunction(o,v,V,E){const I=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),Q=(0,O.RandomRange)(0,1),U=(0,O.RandomRange)(0,2*Math.PI),n=Math.acos(2*Q-1),h=I*Math.cos(U)*Math.sin(n),x=I*Math.cos(n),f=I*Math.sin(U)*Math.sin(n);E?v.RU(h,Math.abs(x),f):g.cv.TransformCoordinatesFromFloatsToRef(h,Math.abs(x),f,o,v)}clone(){const o=new c(this.radius,this.directionRandomizer);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this.radius,o.radiusRange=this.radiusRange,o.directionRandomizer=this.directionRandomizer,o}parse(o){this.radius=o.radius,this.radiusRange=o.radiusRange,this.directionRandomizer=o.directionRandomizer}}class R{constructor(){this.direction1=new g.cv(0,1,0),this.direction2=new g.cv(0,1,0)}startDirectionFunction(o,v,V,E){const I=(0,O.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,O.RandomRange)(this.direction1.y,this.direction2.y),U=(0,O.RandomRange)(this.direction1.z,this.direction2.z);E?v.RU(I,Q,U):g.cv.TransformNormalFromFloatsToRef(I,Q,U,o,v)}startPositionFunction(o,v,V,E){E?v.RU(0,0,0):g.cv.TransformCoordinatesFromFloatsToRef(0,0,0,o,v)}clone(){const o=new R;return h.b.DeepCopy(this,o),o}applyToShader(o){o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.direction1=this.direction1.Dg(),o.direction2=this.direction2.Dg(),o}parse(o){g.cv.FromArrayToRef(o.direction1,0,this.direction1),g.cv.FromArrayToRef(o.direction2,0,this.direction2)}}class j{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=o,this.radiusRange=v,this.directionRandomizer=V}startDirectionFunction(o,v,V,E){const I=V.position.Rv(o.getTranslation()).normalize(),Q=(0,O.RandomRange)(0,this.directionRandomizer),U=(0,O.RandomRange)(0,this.directionRandomizer),n=(0,O.RandomRange)(0,this.directionRandomizer);I.x+=Q,I.y+=U,I.z+=n,I.normalize(),E?v.U(I):g.cv.TransformNormalFromFloatsToRef(I.x,I.y,I.z,o,v)}startPositionFunction(o,v,V,E){const I=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),Q=(0,O.RandomRange)(0,1),U=(0,O.RandomRange)(0,2*Math.PI),n=Math.acos(2*Q-1),h=I*Math.cos(U)*Math.sin(n),x=I*Math.cos(n),f=I*Math.sin(U)*Math.sin(n);E?v.RU(h,x,f):g.cv.TransformCoordinatesFromFloatsToRef(h,x,f,o,v)}clone(){const o=new j(this.radius,this.directionRandomizer);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this.radius,o.radiusRange=this.radiusRange,o.directionRandomizer=this.directionRandomizer,o}parse(o){this.radius=o.radius,this.radiusRange=o.radiusRange,this.directionRandomizer=o.directionRandomizer}}class t extends j{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.cv(0,1,0),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0);super(o),this.direction1=v,this.direction2=V}startDirectionFunction(o,v){const V=(0,O.RandomRange)(this.direction1.x,this.direction2.x),E=(0,O.RandomRange)(this.direction1.y,this.direction2.y),I=(0,O.RandomRange)(this.direction1.z,this.direction2.z);g.cv.TransformNormalFromFloatsToRef(V,E,I,o,v)}clone(){const o=new t(this.radius,this.direction1,this.direction2);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const o=super.serialize();return o.direction1=this.direction1.Dg(),o.direction2=this.direction2.Dg(),o}parse(o){super.parse(o),this.direction1.U(o.direction1),this.direction2.U(o.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(o,v,V,E){const I=g.TmpVectors.cv[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,V,I);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,V,I);const o=g.TmpVectors.cv[1];I.subtractToRef(V.position,o),o.scaleToRef(1/V.lifeTime,I)}else I.set(0,0,0);E?v.U(I):g.cv.TransformNormalToRef(I,o,v)}startPositionFunction(o,v,V,E){const I=g.TmpVectors.cv[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,V,I):I.set(0,0,0),E?v.U(I):g.cv.TransformCoordinatesToRef(I,o,v)}clone(){const o=new s;return h.b.DeepCopy(this,o),o}applyToShader(o){}buildUniformLayout(o){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.particlePositionGenerator=this.particlePositionGenerator,o.particleDestinationGenerator=this.particleDestinationGenerator,o}parse(o){o.particlePositionGenerator&&(this.particlePositionGenerator=o.particlePositionGenerator),o.particleDestinationGenerator&&(this.particleDestinationGenerator=o.particleDestinationGenerator)}}var L=V(12577);class b{get mesh(){return this._mesh}set mesh(o){this._mesh!==o&&(this._mesh=o,o?(this._indices=o.QQ(),this._positions=o.getVerticesData(L.e.PositionKind),this._normals=o.getVerticesData(L.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=g.cv.Zero(),this._mesh=null,this.direction1=new g.cv(0,1,0),this.direction2=new g.cv(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=o}startDirectionFunction(o,v,V,E){if(this.useMeshNormalsForDirection&&this._normals)return void g.cv.TransformNormalToRef(this._storedNormal,o,v);const I=(0,O.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,O.RandomRange)(this.direction1.y,this.direction2.y),U=(0,O.RandomRange)(this.direction1.z,this.direction2.z);E?v.RU(I,Q,U):g.cv.TransformNormalFromFloatsToRef(I,Q,U,o,v)}startPositionFunction(o,v,V,E){if(!this._indices||!this._positions)return;const I=3*(Math.random()*(this._indices.length/3)|0),Q=Math.random(),U=Math.random()*(1-Q),n=1-Q-U,O=this._indices[I],h=this._indices[I+1],x=this._indices[I+2],f=g.TmpVectors.cv[0],l=g.TmpVectors.cv[1],S=g.TmpVectors.cv[2],T=g.TmpVectors.cv[3];g.cv.FromArrayToRef(this._positions,3*O,f),g.cv.FromArrayToRef(this._positions,3*h,l),g.cv.FromArrayToRef(this._positions,3*x,S),T.x=Q*f.x+U*l.x+n*S.x,T.y=Q*f.y+U*l.y+n*S.y,T.z=Q*f.z+U*l.z+n*S.z,E?v.RU(T.x,T.y,T.z):g.cv.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,o,v),this.useMeshNormalsForDirection&&this._normals&&(g.cv.FromArrayToRef(this._normals,3*O,f),g.cv.FromArrayToRef(this._normals,3*h,l),g.cv.FromArrayToRef(this._normals,3*x,S),this._storedNormal.x=Q*f.x+U*l.x+n*S.x,this._storedNormal.y=Q*f.y+U*l.y+n*S.y,this._storedNormal.z=Q*f.z+U*l.z+n*S.z)}clone(){const o=new b(this.mesh);return h.b.DeepCopy(this,o),o}applyToShader(o){o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var o;const v={};return v.type=this.getClassName(),v.direction1=this.direction1.Dg(),v.direction2=this.direction2.Dg(),v.meshId=null===(o=this.mesh)||void 0===o?void 0:o.id,v.useMeshNormalsForDirection=this.useMeshNormalsForDirection,v}parse(o,v){g.cv.FromArrayToRef(o.direction1,0,this.direction1),g.cv.FromArrayToRef(o.direction2,0,this.direction2),o.meshId&&v&&(this.mesh=v.getLastMeshById(o.meshId)),this.useMeshNormalsForDirection=o.useMeshNormalsForDirection}}class u{_isUbo(o){return void 0!==o.addUniform}constructor(o){this._isUbo(o)?(this.setMatrix3x3=o.updateMatrix3x3.bind(o),this.setMatrix2x2=o.updateMatrix2x2.bind(o),this.setFloat=o.updateFloat.bind(o),this.setFloat2=o.updateFloat2.bind(o),this.setFloat3=o.updateFloat3.bind(o),this.setFloat4=o.updateFloat4.bind(o),this.setFloatArray=o.updateFloatArray.bind(o),this.setArray=o.updateArray.bind(o),this.setIntArray=o.updateIntArray.bind(o),this.setMatrix=o.Bg.bind(o),this.setMatrices=o.updateMatrices.bind(o),this.setVector3=o.updateVector3.bind(o),this.setVector4=o.updateVector4.bind(o),this.setColor3=o.updateColor3.bind(o),this.setColor4=o.updateColor4.bind(o),this.setDirectColor4=o.updateDirectColor4.bind(o),this.setInt=o.updateInt.bind(o),this.setInt2=o.updateInt2.bind(o),this.setInt3=o.updateInt3.bind(o),this.setInt4=o.updateInt4.bind(o)):(this.setMatrix3x3=o.setMatrix3x3.bind(o),this.setMatrix2x2=o.setMatrix2x2.bind(o),this.setFloat=o.setFloat.bind(o),this.setFloat2=o.setFloat2.bind(o),this.setFloat3=o.setFloat3.bind(o),this.setFloat4=o.setFloat4.bind(o),this.setFloatArray=o.setFloatArray.bind(o),this.setArray=o.setArray.bind(o),this.setIntArray=o.setIntArray.bind(o),this.setMatrix=o.setMatrix.bind(o),this.setMatrices=o.setMatrices.bind(o),this.setVector3=o.setVector3.bind(o),this.setVector4=o.setVector4.bind(o),this.setColor3=o.setColor3.bind(o),this.setColor4=o.setColor4.bind(o),this.setDirectColor4=o.setDirectColor4.bind(o),this.setInt=o.setInt.bind(o),this.setInt2=o.setInt2.bind(o),this.setInt3=o.setInt3.bind(o),this.setInt4=o.setInt4.bind(o))}}var mo=V(12396);const a="gpuUpdateParticlesPixelShader",F="#version 300 es\nvoid main() {discard;}\n";mo.b.ShadersStore[a]||(mo.b.ShadersStore[a]=F);const i="gpuUpdateParticlesVertexShader",J="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";mo.b.ShadersStore[i]||(mo.b.ShadersStore[i]=J);(0,U.h)("BABYLON.WebGL2ParticleSystem",class{constructor(o,v){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=o,this._engine=v,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var o;return(null===(o=this._updateEffect)||void 0===o?void 0:o.isReady())??!1}createUpdateBuffer(o){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=o,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new u(this._updateEffect)}createVertexBuffers(o,v){this._updateVAO.push(this._createUpdateVAO(o)),this._renderVAO.push(this._engine.recordVertexArrayObject(v,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=v}createParticleBuffer(o){return o}bindDrawBuffers(o,v,V){V?this._engine.bindBuffers(this._renderVertexBuffers,V,v):this._engine.bindVertexArrayObject(this._renderVAO[o],null)}preUpdateParticleBuffer(){const o=this._engine;if(this._engine.enableEffect(this._updateEffect),!o.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(o,v,V){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[o],null);const g=this._engine;g.bindTransformFeedbackBuffer(v.getBuffer()),g.setRasterizerState(!1),g.beginTransformFeedback(!0),g.drawArraysType(3,0,V),g.endTransformFeedback(),g.setRasterizerState(!0),g.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let o=0;o<this._updateVAO.length;o++)this._engine.releaseVertexArrayObject(this._updateVAO[o]);this._updateVAO.length=0;for(let o=0;o<this._renderVAO.length;o++)this._engine.releaseVertexArrayObject(this._renderVAO[o]);this._renderVAO.length=0}_createUpdateVAO(o){const v={};v.position=o.createVertexBuffer("position",0,3);let V=3;v.age=o.createVertexBuffer("age",V,1),V+=1,v.size=o.createVertexBuffer("size",V,3),V+=3,v.life=o.createVertexBuffer("life",V,1),V+=1,v.seed=o.createVertexBuffer("seed",V,4),V+=4,v.direction=o.createVertexBuffer("direction",V,3),V+=3,this._parent.particleEmitterType instanceof s&&(v.initialPosition=o.createVertexBuffer("initialPosition",V,3),V+=3),this._parent._colorGradientsTexture||(v.color=o.createVertexBuffer("color",V,4),V+=4),this._parent._isBillboardBased||(v.initialDirection=o.createVertexBuffer("initialDirection",V,3),V+=3),this._parent.noiseTexture&&(v.noiseCoordinates1=o.createVertexBuffer("noiseCoordinates1",V,3),V+=3,v.noiseCoordinates2=o.createVertexBuffer("noiseCoordinates2",V,3),V+=3),this._parent._angularSpeedGradientsTexture?(v.angle=o.createVertexBuffer("angle",V,1),V+=1):(v.angle=o.createVertexBuffer("angle",V,2),V+=2),this._parent._isAnimationSheetEnabled&&(v.cellIndex=o.createVertexBuffer("cellIndex",V,1),V+=1,this._parent.spriteRandomStartCell&&(v.cellStartOffset=o.createVertexBuffer("cellStartOffset",V,1),V+=1));const g=this._engine.recordVertexArrayObject(v,null,this._updateEffect);return this._engine.bindArrayBuffer(null),g}});class d{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,g=arguments.length>3?arguments[3]:void 0;this._engine=o,this._label=g,this._engine._storageBuffers.push(this),this._create(v,V)}_create(o,v){this._bufferSize=o,this._creationFlags=v,this._buffer=this._engine.createStorageBuffer(o,v,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(o,v,V){this._buffer&&this._engine.updateStorageBuffer(this._buffer,o,v,V)}async read(o,v,V,g){return await this._engine.readFromStorageBuffer(this._buffer,o,v,V,g)}dispose(){const o=this._engine._storageBuffers,v=o.indexOf(this);-1!==v&&(o[v]=o[o.length-1],o.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var N=V(12473),Y=V(12479),q=V(12535),P=V(12471),M=V(12801),W=V(12308),w=V(12427),z=V(12725);class y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new z.e}_addDuration(o,v){o<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==o?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(v,!1),this._gpuTimeInFrameId=o):this.counter.addCount(v,!1))}}var H=V(12374);class e{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=o,this._engine=v,this.uniqueId=M.e.UniqueId,v.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new y),this._engine.getCaps().supportComputeShaders?g.bindingsMapping?(this._context=v.createComputeContext(),this._shaderPath=V,this._options={bindingsMapping:{},defines:[],...g}):W.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):W.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=this._bindings[o];this._bindings[o]={type:V?0:4,object:v,indexInGroupEntries:null===g||void 0===g?void 0:g.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!g||g.object!==v||g.type!==this._bindings[o].type)}setStorageTexture(o,v){const V=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==v),this._bindings[o]={type:1,object:v,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setExternalTexture(o,v){const V=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==v),this._bindings[o]={type:6,object:v,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setVideoTexture(o,v){return!!v.externalTexture&&(this.setExternalTexture(o,v.externalTexture),!0)}setUniformBuffer(o,v){const V=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==v),this._bindings[o]={type:e._BufferIsDataBuffer(v)?7:2,object:v,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setStorageBuffer(o,v){const V=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!V||V.object!==v),this._bindings[o]={type:e._BufferIsDataBuffer(v)?7:3,object:v,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}setTextureSampler(o,v){const V=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!V||!v.compareSampler(V.object)),this._bindings[o]={type:5,object:v,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries}}isReady(){let o=this._effect;for(const E in this._bindings){const o=this._bindings[E],v=o.type,V=o.object;switch(v){case 0:case 4:case 1:if(!V.isReady())return!1;break;case 6:if(!V.isReady())return!1;break}}const v=[],V=this._shaderPath;if(this._options.defines)for(let E=0;E<this._options.defines.length;E++)v.push(this._options.defines[E]);const g=v.join("\n");return this._cachedDefines!==g&&(this._cachedDefines=g,o=this._engine.createComputeEffect(V,{defines:g,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=o),!!o.isReady()}dispatch(o,v,V){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,o,v,V,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const V=e._BufferIsDataBuffer(o)?o:o.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,V,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const v in this._bindings){const V=this._bindings[v];if(!this._options.bindingsMapping[v])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+v+"'");switch(V.type){case 0:{const g=this._samplers[v],E=V.object;var o;if(!g||!E._texture||!g.compareSampler(E._texture))this._samplers[v]=(new w.c).setParameters(E.wrapU,E.wrapV,E.wrapR,E.anisotropicFilteringLevel,E._texture.samplingMode,null===(o=E._texture)||void 0===o?void 0:o._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const o=V.object;o.getBuffer()!==V.buffer&&(V.buffer=o.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((E=>{(0,H.d)((()=>this.dispatch(o,v,V)),E,void 0,g)}))}serialize(){const o=q.c.Serialize(this);o.options=this._options,o.shaderPath=this._shaderPath,o.rf={},o.textures={};for(const v in this._bindings){const V=this._bindings[v],g=V.object;switch(V.type){case 0:case 4:case 1:{const E=g.serialize();E&&(o.textures[v]=E,o.rf[v]={type:V.type});break}}}return o}static Parse(o,v,V){const g=q.c.Parse((()=>new e(o.name,v.getEngine(),o.shaderPath,o.options)),o,v,V);for(const E in o.textures){const I=o.rf[E],Q=P.e.Parse(o.textures[E],v,V);0===I.type?g.setTexture(E,Q):4===I.type?g.setTexture(E,Q,!1):g.setStorageTexture(E,Q)}return g}static _BufferIsDataBuffer(o){return void 0!==o.underlyingResource}}(0,N.c)([(0,Y.K)()],e.prototype,"name",void 0),(0,N.c)([(0,Y.K)()],e.prototype,"fastMode",void 0),(0,U.h)("BABYLON.ComputeShader",e);var D=V(12766);const Z="gpuUpdateParticlesComputeShader",K="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";mo.b.ShadersStoreWGSL[Z]||(mo.b.ShadersStoreWGSL[Z]=K);(0,U.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(o,v){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=o,this._engine=v}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var o;return(null===(o=this._updateComputeShader)||void 0===o?void 0:o.isReady())??!1}createUpdateBuffer(o){var v;const V={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(V.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(V.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(V.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(V.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(V.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(V.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(V.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new e("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:V,defines:o.split("\n")}),null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=new D.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new u(this._simParamsComputeShader)}createVertexBuffers(o,v){this._renderVertexBuffers.push(v)}createParticleBuffer(o){const v=new d(this._engine,4*o.length,11,"ComputeShaderParticleSystemBuffer");return v.update(o),this._bufferComputeShader.push(v),v.getBuffer()}bindDrawBuffers(o,v,V){this._engine.bindBuffers(this._renderVertexBuffers[o],V,v)}preUpdateParticleBuffer(){}updateParticleBuffer(o,v,V){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[o]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^o]),this._updateComputeShader.dispatch(Math.ceil(V/64))}releaseBuffers(){var o;for(let v=0;v<this._bufferComputeShader.length;++v)this._bufferComputeShader[v].dispose();this._bufferComputeShader.length=0,null===(o=this._simParamsComputeShader)||void 0===o||o.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class X{constructor(o,v,V){this.gradient=o,this.color1=v,this.color2=V}getColorToRef(o){this.color2?Q.sU.LerpToRef(this.color1,this.color2,Math.random(),o):o.U(this.color1)}}class r{constructor(o,v){this.gradient=o,this.color=v}}class B{constructor(o,v,V){this.gradient=o,this.factor1=v,this.factor2=V}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class A{static GetCurrentGradient(o,v,V){if(v[0].gradient>o)return void V(v[0],v[0],1);for(let E=0;E<v.length-1;E++){const g=v[E],I=v[E+1];if(o>=g.gradient&&o<=I.gradient){return void V(g,I,(o-g.gradient)/(I.gradient-g.gradient))}}const g=v.length-1;V(v[g],v[g],1)}}var C=V(12297),p=V(12989),G=V(12339);class k{constructor(o){this.particleSystem=o,this.position=g.cv.Zero(),this.direction=g.cv.Zero(),this.color=new Q.sU(0,0,0,0),this.colorStep=new Q.sU(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new g.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Q.sU(0,0,0,0),this._currentColor2=new Q.sU(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=k._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let o=this.age,v=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===v?(v=1,o=this._randomCellOffset):o+=this._randomCellOffset);const V=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let g;g=this._initialSpriteCellLoop?(0,O.Clamp)(o*v%this.lifeTime/this.lifeTime):(0,O.Clamp)(o*v/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+g*V|0}_inheritParticleInfoToSubEmitter(o){if(o.particleSystem.lo.position){const v=o.particleSystem.lo;if(v.position.U(this.position),o.inheritDirection){const o=g.TmpVectors.cv[0];this.direction.normalizeToRef(o),v.setDirection(o,0,Math.PI/2)}}else{o.particleSystem.lo.U(this.position)}this.direction.scaleToRef(o.inheritedVelocityAmount/2,g.TmpVectors.cv[0]),o.particleSystem._inheritedVelocityOffset.U(g.TmpVectors.cv[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const o of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(o)}_reset(){this.age=0,this.id=k._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(o){o.position.U(this.position),this._initialDirection?o._initialDirection?o._initialDirection.U(this._initialDirection):o._initialDirection=this._initialDirection.clone():o._initialDirection=null,o.direction.U(this.direction),this.ZU&&(o.ZU?o.ZU.U(this.ZU):o.ZU=this.ZU.clone()),o.color.U(this.color),o.colorStep.U(this.colorStep),o.lifeTime=this.lifeTime,o.age=this.age,o._randomCellOffset=this._randomCellOffset,o.size=this.size,o.scale.U(this.scale),o.angle=this.angle,o.angularSpeed=this.angularSpeed,o.particleSystem=this.particleSystem,o.cellIndex=this.cellIndex,o.id=this.id,o._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(o._currentColorGradient=this._currentColorGradient,o._currentColor1.U(this._currentColor1),o._currentColor2.U(this._currentColor2)),this._currentSizeGradient&&(o._currentSizeGradient=this._currentSizeGradient,o._currentSize1=this._currentSize1,o._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(o._currentAngularSpeedGradient=this._currentAngularSpeedGradient,o._currentAngularSpeed1=this._currentAngularSpeed1,o._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(o._currentVelocityGradient=this._currentVelocityGradient,o._currentVelocity1=this._currentVelocity1,o._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(o._currentLimitVelocityGradient=this._currentLimitVelocityGradient,o._currentLimitVelocity1=this._currentLimitVelocity1,o._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(o._currentDragGradient=this._currentDragGradient,o._currentDrag1=this._currentDrag1,o._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(o._initialStartSpriteCellId=this._initialStartSpriteCellId,o._initialEndSpriteCellId=this._initialEndSpriteCellId,o._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(o.remapData&&this.remapData?o.remapData.U(this.remapData):o.remapData=new g.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(o._randomNoiseCoordinates1?(o._randomNoiseCoordinates1.U(this._randomNoiseCoordinates1),o._randomNoiseCoordinates2.U(this._randomNoiseCoordinates2)):(o._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),o._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}k._Count=0;var oo=V(12615),vo=(V(12654),V(12884)),Vo=V(12878),go=V(12761);function Eo(o,v){const V=(0,O.RandomRange)(0,1);Q.sU.LerpToRef(v.color1,v.color2,V,o.color),v.colorDead.subtractToRef(o.color,v._colorDiff),v._colorDiff.scaleToRef(1/o.lifeTime,o.colorStep)}function Io(o,v){o._currentColorGradient=v._colorGradients[0],o._currentColorGradient.getColorToRef(o.color),o._currentColor1.U(o.color),v._colorGradients.length>1?v._colorGradients[1].getColorToRef(o._currentColor2):o._currentColor2.U(o.color)}function Qo(o,v){const V=v._colorGradients;A.GetCurrentGradient(v._ratio,V,((v,V,g)=>{v!==o._currentColorGradient&&(o._currentColor1.U(o._currentColor2),V.getColorToRef(o._currentColor2),o._currentColorGradient=v),Q.sU.LerpToRef(o._currentColor1,o._currentColor2,g,o.color)}))}function Uo(o,v){o.colorStep.scaleToRef(v._scaledUpdateSpeed,v._scaledColorStep),o.color.addInPlace(v._scaledColorStep),o.color.a<0&&(o.color.a=0)}function no(o,v){A.GetCurrentGradient(v._ratio,v._angularSpeedGradients,((v,V,g)=>{v!==o._currentAngularSpeedGradient&&(o._currentAngularSpeed1=o._currentAngularSpeed2,o._currentAngularSpeed2=V.getFactor(),o._currentAngularSpeedGradient=v),o.angularSpeed=(0,O.Lerp)(o._currentAngularSpeed1,o._currentAngularSpeed2,g)}))}function Oo(o,v){o.angle+=o.angularSpeed*v._scaledUpdateSpeed}function ho(o,v){v.particleEmitterType.startDirectionFunction(v._emitterWorldMatrix,o.direction,o,v.isLocal,v._emitterInverseWorldMatrix)}function xo(o,v){v.startDirectionFunction(v._emitterWorldMatrix,o.direction,o,v.isLocal)}function fo(o,v){o._currentVelocityGradient=v._velocityGradients[0],o._currentVelocity1=o._currentVelocityGradient.getFactor(),v._velocityGradients.length>1?o._currentVelocity2=v._velocityGradients[1].getFactor():o._currentVelocity2=o._currentVelocity1}function lo(o,v){o._currentLimitVelocityGradient=v._limitVelocityGradients[0],o._currentLimitVelocity1=o._currentLimitVelocityGradient.getFactor(),v._limitVelocityGradients.length>1?o._currentLimitVelocity2=v._limitVelocityGradients[1].getFactor():o._currentLimitVelocity2=o._currentLimitVelocity1}function So(o,v){A.GetCurrentGradient(v._ratio,v._velocityGradients,((V,g,E)=>{V!==o._currentVelocityGradient&&(o._currentVelocity1=o._currentVelocity2,o._currentVelocity2=g.getFactor(),o._currentVelocityGradient=V),v._directionScale*=(0,O.Lerp)(o._currentVelocity1,o._currentVelocity2,E)}))}function To(o,v){A.GetCurrentGradient(v._ratio,v._limitVelocityGradients,((V,g,E)=>{V!==o._currentLimitVelocityGradient&&(o._currentLimitVelocity1=o._currentLimitVelocity2,o._currentLimitVelocity2=g.getFactor(),o._currentLimitVelocityGradient=V);const I=(0,O.Lerp)(o._currentLimitVelocity1,o._currentLimitVelocity2,E);o.direction.length()>I&&o.direction.scaleInPlace(v.limitVelocityDamping)}))}function co(o,v){o.direction.scaleToRef(v._directionScale,v._scaledDirection)}function Ro(o,v){v.particleEmitterType.startPositionFunction(v._emitterWorldMatrix,o.position,o,v.isLocal)}function jo(o,v){v.startPositionFunction(v._emitterWorldMatrix,o.position,o,v.isLocal)}function to(o,v){o.ZU?o.ZU.U(o.position):o.ZU=o.position.clone(),g.cv.TransformCoordinatesToRef(o.ZU,v._emitterWorldMatrix,o.position)}function so(o,v){v.isLocal&&o.ZU?(o.ZU.addInPlace(v._scaledDirection),g.cv.TransformCoordinatesToRef(o.ZU,v._emitterWorldMatrix,o.position)):o.position.addInPlace(v._scaledDirection)}function Lo(o,v){o._currentDragGradient=v._dragGradients[0],o._currentDrag1=o._currentDragGradient.getFactor(),v._dragGradients.length>1?o._currentDrag2=v._dragGradients[1].getFactor():o._currentDrag2=o._currentDrag1}function bo(o,v){A.GetCurrentGradient(v._ratio,v._dragGradients,((V,g,E)=>{V!==o._currentDragGradient&&(o._currentDrag1=o._currentDrag2,o._currentDrag2=g.getFactor(),o._currentDragGradient=V);const I=(0,O.Lerp)(o._currentDrag1,o._currentDrag2,E);v._scaledDirection.scaleInPlace(1-I)}))}function uo(o,v){o._randomNoiseCoordinates1?(o._randomNoiseCoordinates1.RU(Math.random(),Math.random(),Math.random()),o._randomNoiseCoordinates2.RU(Math.random(),Math.random(),Math.random())):(o._randomNoiseCoordinates1=new g.cv(Math.random(),Math.random(),Math.random()),o._randomNoiseCoordinates2=new g.cv(Math.random(),Math.random(),Math.random()))}function mv(o,v){const V=v._noiseTextureData,E=v._noiseTextureSize;if(V&&E&&o._randomNoiseCoordinates1){const I=v._fetchR(o._randomNoiseCoordinates1.x,o._randomNoiseCoordinates1.y,E.width,E.height,V),Q=v._fetchR(o._randomNoiseCoordinates1.z,o._randomNoiseCoordinates2.x,E.width,E.height,V),U=v._fetchR(o._randomNoiseCoordinates2.y,o._randomNoiseCoordinates2.z,E.width,E.height,V),n=g.TmpVectors.cv[0],O=g.TmpVectors.cv[1];n.RU((2*I-1)*v.noiseStrength.x,(2*Q-1)*v.noiseStrength.y,(2*U-1)*v.noiseStrength.z),n.scaleToRef(v._tempScaledUpdateSpeed,O),o.direction.addInPlace(O)}}function ao(o,v){v.gravity.scaleToRef(v._tempScaledUpdateSpeed,v._scaledGravity),o.direction.addInPlace(v._scaledGravity)}function Fo(o,v){o.size=(0,O.RandomRange)(v.minSize,v.maxSize),o.scale.RU((0,O.RandomRange)(v.minScaleX,v.maxScaleX),(0,O.RandomRange)(v.minScaleY,v.maxScaleY))}function io(o,v){o._currentSizeGradient=v._sizeGradients[0],o._currentSize1=o._currentSizeGradient.getFactor(),o.size=o._currentSize1,v._sizeGradients.length>1?o._currentSize2=v._sizeGradients[1].getFactor():o._currentSize2=o._currentSize1,o.scale.RU((0,O.RandomRange)(v.minScaleX,v.maxScaleX),(0,O.RandomRange)(v.minScaleY,v.maxScaleY))}function Jo(o,v){const V=v._actualFrame/v.targetStopDuration;A.GetCurrentGradient(V,v._startSizeGradients,((V,g,E)=>{V!==v._currentStartSizeGradient&&(v._currentStartSize1=v._currentStartSize2,v._currentStartSize2=g.getFactor(),v._currentStartSizeGradient=V);const I=(0,O.Lerp)(v._currentStartSize1,v._currentStartSize2,E);o.scale.scaleInPlace(I)}))}function No(o,v){A.GetCurrentGradient(v._ratio,v._sizeGradients,((v,V,g)=>{v!==o._currentSizeGradient&&(o._currentSize1=o._currentSize2,o._currentSize2=V.getFactor(),o._currentSizeGradient=v),o.size=(0,O.Lerp)(o._currentSize1,o._currentSize2,g)}))}function Yo(o,v){o.remapData=new g.Vector4(0,1,0,1)}function qo(o,v){v._colorRemapGradients&&v._colorRemapGradients.length>0&&A.GetCurrentGradient(v._ratio,v._colorRemapGradients,((v,V,g)=>{const E=(0,O.Lerp)(v.factor1,V.factor1,g),I=(0,O.Lerp)(v.factor2,V.factor2,g);o.remapData.x=E,o.remapData.y=I-E})),v._alphaRemapGradients&&v._alphaRemapGradients.length>0&&A.GetCurrentGradient(v._ratio,v._alphaRemapGradients,((v,V,g)=>{const E=(0,O.Lerp)(v.factor1,V.factor1,g),I=(0,O.Lerp)(v.factor2,V.factor2,g);o.remapData.z=E,o.remapData.w=I-E}))}function Po(o,v){const V=(0,O.Clamp)(v._actualFrame/v.targetStopDuration);A.GetCurrentGradient(V,v._lifeTimeGradients,((v,g)=>{const E=v,I=g,Q=E.getFactor(),U=I.getFactor(),n=(V-E.gradient)/(I.gradient-E.gradient);o.lifeTime=(0,O.Lerp)(Q,U,n)})),v._emitPower=(0,O.RandomRange)(v.minEmitPower,v.maxEmitPower)}function Mo(o,v){o.lifeTime=(0,O.RandomRange)(v.minLifeTime,v.maxLifeTime),v._emitPower=(0,O.RandomRange)(v.minEmitPower,v.maxEmitPower)}function Wo(o,v){0===v._emitPower?(o._initialDirection?o._initialDirection.U(o.direction):o._initialDirection=o.direction.clone(),o.direction.set(0,0,0)):(o._initialDirection=null,o.direction.scaleInPlace(v._emitPower)),o.direction.addInPlace(v._inheritedVelocityOffset)}function wo(o,v){o.angularSpeed=(0,O.RandomRange)(v.minAngularSpeed,v.maxAngularSpeed),o.angle=(0,O.RandomRange)(v.minInitialRotation,v.maxInitialRotation)}function zo(o,v){o._currentAngularSpeedGradient=v._angularSpeedGradients[0],o.angularSpeed=o._currentAngularSpeedGradient.getFactor(),o._currentAngularSpeed1=o.angularSpeed,v._angularSpeedGradients.length>1?o._currentAngularSpeed2=v._angularSpeedGradients[1].getFactor():o._currentAngularSpeed2=o._currentAngularSpeed1,o.angle=(0,O.RandomRange)(v.minInitialRotation,v.maxInitialRotation)}function yo(o,v){o._initialStartSpriteCellId=v.startSpriteCellID,o._initialEndSpriteCellId=v.endSpriteCellID,o._initialSpriteCellLoop=v.spriteCellLoop}function Ho(o,v){o.previousItem=v.previousItem,o.nextItem=v,v.previousItem&&(v.previousItem.nextItem=o),v.previousItem=o}function eo(o,v){o.previousItem=v,o.nextItem=v.nextItem,v.nextItem&&(v.nextItem.previousItem=o),v.nextItem=o}function Do(o,v){let V=v;for(;V.nextItem;)V=V.nextItem;o.previousItem=V,o.nextItem=V.nextItem,V.nextItem=o}function Zo(o){o.previousItem&&(o.previousItem.nextItem=o.nextItem),o.nextItem&&(o.nextItem.previousItem=o.previousItem)}class Ko extends n{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(o){this._startDirectionFunction!==o&&(this._startDirectionFunction=o,this._directionProcessing.process=o?xo:ho)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(o){this._startPositionFunction!==o&&(this._startPositionFunction=o,this._positionCreation.process=o?jo:Ro)}set onDispose(o){this._onDisposeObserver&&this.Tg.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tg.add(o)}get l(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(o){this._useRampGradients!==o&&(this._useRampGradients=o,this._resetEffect(),o?(this._rampCreation={process:Yo,previousItem:null,nextItem:null},eo(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:qo,previousItem:null,nextItem:null},eo(this._remapGradientProcessing,this._gravityProcessing)):(Zo(this._rampCreation),Zo(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(o){this._isLocal!==o&&(this._isLocal=o,o?(this._isLocalCreation={process:to,previousItem:null,nextItem:null},eo(this._isLocalCreation,this._positionCreation)):Zo(this._isLocalCreation))}get particles(){return this.wf}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(o){this._animationSheetEnabled!==o&&(this._animationSheetEnabled=o,o?(this._sheetCreation={process:yo,previousItem:null,nextItem:null},eo(this._sheetCreation,this._colorCreation)):Zo(this._sheetCreation),this._reset())}getActiveCount(){return this.wf.length}getClassName(){return"mh"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var o;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(o=this._customWrappers[v])||void 0===o?void 0:o.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[o]??this._customWrappers[0]}setCustomEffect(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new oo.c(this._engine),this._customWrappers[v].effect=o,this._customWrappers[v].drawContext&&(this._customWrappers[v].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(o){if(this.noiseTexture!==o){if(this._noiseTexture=o,!o)return Zo(this._noiseCreation),void Zo(this._noiseProcessing);this._noiseCreation={process:uo,previousItem:null,nextItem:null},eo(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:mv,previousItem:null,nextItem:null},eo(this._noiseProcessing,this._positionProcessing)}}constructor(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(o),this._emitterInverseWorldMatrix=g.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new g.cv,this.Tg=new C.e,this.onStoppedObservable=new C.e,this.onStartedObservable=new C.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.wf=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Q.sU(0,0,0,0),this._colorDiff=new Q.sU(0,0,0,0),this._scaledDirection=g.cv.Zero(),this._scaledGravity=g.cv.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=o=>{},this.recycleParticle=o=>{const v=this.wf.pop();v!==o&&v.copyTo(o),this._stockParticles.push(v)},this._createParticle=()=>{let o;return 0!==this._stockParticles.length?(o=this._stockParticles.pop(),o._reset()):o=new k(this),this._prepareParticle(o),o},this.paused=!1,this._shadersLoaded=!1,this._capacity=v,this._epsilon=U,V&&"Scene"!==V.getClassName()?(this._engine=V,this.defaultProjectionMatrix=g.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=V||G.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Mf.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Mo,previousItem:null,nextItem:null},this._positionCreation={process:Ro,previousItem:null,nextItem:null},eo(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:ho,previousItem:null,nextItem:null},eo(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Wo,previousItem:null,nextItem:null},eo(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Fo,previousItem:null,nextItem:null},eo(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:wo,previousItem:null,nextItem:null},eo(this._angleCreation,this._sizeCreation),this._colorCreation={process:Eo,previousItem:null,nextItem:null},eo(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,n||(this._colorProcessing={process:Uo,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Oo,previousItem:null,nextItem:null},eo(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:co,previousItem:null,nextItem:null},eo(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:so,previousItem:null,nextItem:null},eo(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ao,previousItem:null,nextItem:null},eo(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=I,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new oo.c(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new x,this.updateFunction=o=>{var v;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(v=this.noiseTexture.getContent())||void 0===v||v.then((o=>{this._noiseTextureData=o})));const V=o===this.wf;for(let g=0;g<o.length;g++){const v=o[g];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const E=v.age;if(v.age+=this._tempScaledUpdateSpeed,v.age>v.lifeTime){const o=v.age-E,V=v.lifeTime-E;this._tempScaledUpdateSpeed=V*this._tempScaledUpdateSpeed/o,v.age=v.lifeTime}this._ratio=v.age/v.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let I=this._updateQueueStart;for(;I;)I.process(v,this),I=I.nextItem;if(this._isAnimationSheetEnabled&&!n&&v.updateCellIndex(),v._inheritParticleInfoToSubEmitters(),v.age>=v.lifeTime){if(this._emitFromParticle(v),v._attachedSubEmitters){for(const o of v._attachedSubEmitters)o.particleSystem.disposeOnStop=!0,o.particleSystem.stop();v._attachedSubEmitters=null}this.recycleParticle(v),V&&g--}else;}}}serialize(o){throw new Error("Method not implemented.")}clone(o,v){throw new Error("Method not implemented.")}_addFactorGradient(o,v,V,g){const E=new B(v,V,g);o.push(E),o.sort(((o,v)=>o.gradient<v.gradient?-1:o.gradient>v.gradient?1:0))}_removeFactorGradient(o,v){if(!o)return;let V=0;for(const g of o){if(g.gradient===v){o.splice(V,1);break}V++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Po:this._lifeTimeCreation.process=Mo}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Jo,previousItem:null,nextItem:null},eo(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Zo(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(o){this.targetStopDuration!==o&&(this._targetStopDuration=o,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(o,v,V){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,o,v,V),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(o){return this._removeFactorGradient(this._lifeTimeGradients,o),this._syncLifeTimeCreation(),this}addSizeGradient(o,v,V){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=io,this._sizeGradientProcessing={process:No,previousItem:null,nextItem:null},Ho(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,o,v,V),this}removeSizeGradient(o){var v;return this._removeFactorGradient(this._sizeGradients,o),0===(null===(v=this._sizeGradients)||void 0===v?void 0:v.length)&&(Zo(this._sizeGradientProcessing),this._sizeCreation.process=Fo),this}addColorRemapGradient(o,v,V){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,o,v,V),this}removeColorRemapGradient(o){return this._removeFactorGradient(this._colorRemapGradients,o),this}addAlphaRemapGradient(o,v,V){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,o,v,V),this}removeAlphaRemapGradient(o){return this._removeFactorGradient(this._alphaRemapGradients,o),this}addAngularSpeedGradient(o,v,V){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=zo,this._angularSpeedGradientProcessing={process:no,previousItem:null,nextItem:null},Ho(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,o,v,V),this}removeAngularSpeedGradient(o){var v;return this._removeFactorGradient(this._angularSpeedGradients,o),0===(null===(v=this._angularSpeedGradients)||void 0===v?void 0:v.length)&&(this._angleCreation.process=wo,Zo(this._angularSpeedGradientProcessing)),this}addVelocityGradient(o,v,V){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:fo,previousItem:null,nextItem:null},eo(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:So,previousItem:null,nextItem:null},Ho(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,o,v,V),this}removeVelocityGradient(o){var v;return this._removeFactorGradient(this._velocityGradients,o),0===(null===(v=this._velocityGradients)||void 0===v?void 0:v.length)&&(Zo(this._velocityCreation),Zo(this._velocityGradientProcessing)),this}addLimitVelocityGradient(o,v,V){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:lo,previousItem:null,nextItem:null},eo(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:To,previousItem:null,nextItem:null},eo(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,o,v,V),this}removeLimitVelocityGradient(o){var v;return this._removeFactorGradient(this._limitVelocityGradients,o),0===(null===(v=this._limitVelocityGradients)||void 0===v?void 0:v.length)&&(Zo(this._limitVelocityCreation),Zo(this._limitVelocityGradientProcessing)),this}addDragGradient(o,v,V){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Lo,previousItem:null,nextItem:null},Ho(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:bo,previousItem:null,nextItem:null},Ho(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,o,v,V),this}removeDragGradient(o){var v;return this._removeFactorGradient(this._dragGradients,o),0===(null===(v=this._dragGradients)||void 0===v?void 0:v.length)&&(Zo(this._dragCreation),Zo(this._dragGradientProcessing)),this}addEmitRateGradient(o,v,V){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,o,v,V),this}removeEmitRateGradient(o){return this._removeFactorGradient(this._emitRateGradients,o),this}addStartSizeGradient(o,v,V){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,o,v,V),this._syncStartSizeCreation(),this}removeStartSizeGradient(o){return this._removeFactorGradient(this._startSizeGradients,o),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const o=new Uint8Array(4*this._rawTextureWidth),v=Q.TmpColors.Lv[0];for(let V=0;V<this._rawTextureWidth;V++){const g=V/this._rawTextureWidth;A.GetCurrentGradient(g,this._rampGradients,((g,E,I)=>{Q.Lv.LerpToRef(g.color,E.color,I,v),o[4*V]=255*v.r,o[4*V+1]=255*v.g,o[4*V+2]=255*v.b,o[4*V+3]=255}))}this._rampGradientsTexture=p.e.CreateRGBATexture(o,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((o,v)=>o.gradient<v.gradient?-1:o.gradient>v.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(o,v){this._rampGradients||(this._rampGradients=[]);const V=new r(o,v);return this._rampGradients.push(V),this._syncRampGradientTexture(),this}removeRampGradient(o){return this._removeGradientAndTexture(o,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(o,v,V){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Io,this._colorProcessing.process=Qo);const g=new X(o,v,V);return this._colorGradients.push(g),this._colorGradients.sort(((o,v)=>o.gradient<v.gradient?-1:o.gradient>v.gradient?1:0)),this}removeColorGradient(o){if(!this._colorGradients)return this;let v=0;for(const V of this._colorGradients){if(V.gradient===o){this._colorGradients.splice(v,1);break}v++}return 0===this._colorGradients.length&&(this._colorCreation.process=Eo,this._colorProcessing.process=Uo),this}resetDrawCache(){if(this._drawWrappers){for(const o of this._drawWrappers)if(o)for(const v of o)null===v||void 0===v||v.dispose();this._drawWrappers=[]}}_fetchR(o,v,V,g,E){return E[4*(((o=.5*Math.abs(o)+.5)*V%V|0)+((v=.5*Math.abs(v)+.5)*g%g|0)*V)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const o=this._engine,v=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*v),this._vertexBuffer=new L.b(o,this._vertexData,!0,v);let V=0;const g=this._vertexBuffer.createVertexBuffer(L.e.PositionKind,V,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.e.PositionKind]=g,V+=3;const E=this._vertexBuffer.createVertexBuffer(L.e.ColorKind,V,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.e.ColorKind]=E,V+=4;const I=this._vertexBuffer.createVertexBuffer("angle",V,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=I,V+=1;const Q=this._vertexBuffer.createVertexBuffer("size",V,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Q,V+=2,this._isAnimationSheetEnabled){const o=this._vertexBuffer.createVertexBuffer("cellIndex",V,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=o,V+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const o=this._vertexBuffer.createVertexBuffer("direction",V,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=o,V+=3}if(this._useRampGradients){const o=this._vertexBuffer.createVertexBuffer("remapData",V,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=o,V+=4}let U;if(this._useInstancing){const v=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new L.b(o,v,!1,2),U=this._spriteBuffer.createVertexBuffer("offset",0,2)}else U=this._vertexBuffer.createVertexBuffer("offset",V,2,this._vertexBufferSize,this._useInstancing),V+=2;this._vertexBuffers.offset=U,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const o=[],v=[];let V=0;for(let g=0;g<this._capacity;g++)o.push(V),o.push(V+1),o.push(V+2),o.push(V),o.push(V+2),o.push(V+3),v.push(V,V+1,V+1,V+2,V+2,V+3,V+3,V,V,V+3),V+=4;this._indexBuffer=this._engine.createIndexBuffer(o),this._linesIndexBuffer=this._engine.createIndexBuffer(v)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(o)setTimeout((()=>{this.start(0)}),o);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var v;-1!==(null===(v=this.lo)||void 0===v?void 0:v.getClassName().indexOf("Mesh"))&&this.lo.Ag(!0);const o=this.noiseTexture;if(o&&o.onGeneratedObservable)o.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),o.render()}))}));else for(let v=0;v<this.preWarmCycles;v++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(o))}_postStop(o){}reset(){this._stockParticles.length=0,this.wf.length=0}_appendParticleVertex(o,v,V,E){let I=o*this._vertexBufferSize;if(this._vertexData[I++]=v.position.x+this.fO.x,this._vertexData[I++]=v.position.y+this.fO.y,this._vertexData[I++]=v.position.z+this.fO.z,this._vertexData[I++]=v.color.r,this._vertexData[I++]=v.color.g,this._vertexData[I++]=v.color.b,this._vertexData[I++]=v.color.a,this._vertexData[I++]=v.angle,this._vertexData[I++]=v.scale.x*v.size,this._vertexData[I++]=v.scale.y*v.size,this._isAnimationSheetEnabled&&(this._vertexData[I++]=v.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[I++]=v.direction.x,this._vertexData[I++]=v.direction.y,this._vertexData[I++]=v.direction.z);else if(v._initialDirection){let o=v._initialDirection;this.isLocal&&(g.cv.TransformNormalToRef(o,this._emitterWorldMatrix,g.TmpVectors.cv[0]),o=g.TmpVectors.cv[0]),0===o.x&&0===o.z&&(o.x=.001),this._vertexData[I++]=o.x,this._vertexData[I++]=o.y,this._vertexData[I++]=o.z}else{let o=v.direction;this.isLocal&&(g.cv.TransformNormalToRef(o,this._emitterWorldMatrix,g.TmpVectors.cv[0]),o=g.TmpVectors.cv[0]),0===o.x&&0===o.z&&(o.x=.001),this._vertexData[I++]=o.x,this._vertexData[I++]=o.y,this._vertexData[I++]=o.z}this._useRampGradients&&v.remapData&&(this._vertexData[I++]=v.remapData.x,this._vertexData[I++]=v.remapData.y,this._vertexData[I++]=v.remapData.z,this._vertexData[I++]=v.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===V?V=this._epsilon:1===V&&(V=1-this._epsilon),0===E?E=this._epsilon:1===E&&(E=1-this._epsilon)),this._vertexData[I++]=V,this._vertexData[I++]=E)}_prepareParticle(o){}_createNewOnes(o){let v;for(let V=0;V<o&&this.wf.length!==this._capacity;V++){v=this._createParticle(),this.wf.push(v);let o=this._createQueueStart;for(;o;)o.process(v,this),o=o.nextItem;v._inheritParticleInfoToSubEmitters()}}_update(o){if(this._alive=this.wf.length>0,this.lo.position){const o=this.lo;this._emitterWorldMatrix=o.getWorldMatrix()}else{const o=this.lo;this._emitterWorldMatrix=g.Matrix.Translation(o.x,o.y,o.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.wf),this._createNewOnes(o)}static _GetAttributeNamesOrOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=[L.e.PositionKind,L.e.ColorKind,"angle","offset","size"];return o&&g.push("cellIndex"),v||g.push("direction"),V&&g.push("remapData"),g}static _GetEffectCreationOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,vo.b)(g),o&&g.push("particlesInfos"),v&&g.push("logarithmicDepthConstant"),V&&(g.push("vFogInfos"),g.push("vFogColor")),g}fillDefines(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,vo.g)(this,this._scene,o),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&o.push("#define FOG")),this._isAnimationSheetEnabled&&o.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&o.push("#define LOGARITHMICDEPTH"),v===n.BLENDMODE_MULTIPLY&&o.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&o.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(o.push("#define BILLBOARD"),this.billboardMode){case 2:o.push("#define BILLBOARDY");break;case 8:case 9:o.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&o.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:o.push("#define BILLBOARDMODE_ALL")}V&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),o.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(o,v,V){v.push(...Ko._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),o.push(...Ko._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),V.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,go.g)(o,this._imageProcessingConfigurationDefines),(0,go.e)(V,this._imageProcessingConfigurationDefines))}_getWrapper(o){const v=this._getCustomDrawWrapper(o);if(null!==v&&void 0!==v&&v.effect)return v;const V=[];this.fillDefines(V,o);const g=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let E=this._drawWrappers[g];E||(E=this._drawWrappers[g]=[]);let I=E[o];I||(I=new oo.c(this._engine),I.drawContext&&(I.drawContext.useInstancing=this._useInstancing),E[o]=I);const Q=V.join("\n");if(I.defines!==Q){const o=[],v=[],V=[];this.fillUniformsAttributesAndSamplerNames(v,o,V),I.setEffect(this._engine.createEffect("particles",o,v,V,Q,void 0,void 0,void 0,void 0,this._shaderLanguage),Q)}return I}animate(){var o;let v,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!V&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(V?this.preWarmStepOffset:(null===(o=this._scene)||void 0===o?void 0:o.getAnimationRatio())||1),this.manualEmitCount>-1)v=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let o=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const v=this._actualFrame/this.targetStopDuration;A.GetCurrentGradient(v,this._emitRateGradients,((v,V,g)=>{v!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=V.getFactor(),this._currentEmitRateGradient=v),o=(0,O.Lerp)(this._currentEmitRate1,this._currentEmitRate2,g)}))}v=o*this._scaledUpdateSpeed|0,this._newPartsExcess+=o*this._scaledUpdateSpeed-v}if(this._newPartsExcess>1&&(v+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?v=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(v),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!V){let o=0;for(let v=0;v<this.wf.length;v++){const V=this.wf[v];this._appendParticleVertices(o,V),o+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.wf.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(o,v){this._appendParticleVertex(o++,v,0,0),this._useInstancing||(this._appendParticleVertex(o++,v,1,0),this._appendParticleVertex(o++,v,1,1),this._appendParticleVertex(o++,v,0,1))}rebuild(){var o;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(o=this._spriteBuffer)||void 0===o||o._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Ko.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(V.bind(V,14026)),Promise.resolve().then(V.bind(V,13972))])):await Promise.all([Promise.resolve().then(V.bind(V,13965)),Promise.resolve().then(V.bind(V,13954))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.lo||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==n.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(n.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(n.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(o){const v=this._getWrapper(o),V=v.effect,E=this._engine;E.enableEffect(v);const I=this.defaultViewMatrix??this._scene.getViewMatrix();if(V.setTexture("diffuseSampler",this.particleTexture),V.setMatrix("view",I),V.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const o=this.particleTexture.getBaseSize();V.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,this.spriteCellWidth/o.width)}if(V.setVector2("translationPivot",this.translationPivot),V.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const o=this._scene.activeCamera;V.setVector3("eyePosition",o.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),V.setTexture("rampSampler",this._rampGradientsTexture));const Q=V.defines;var U,n,O,h,x,f;(this._scene&&((0,vo.c)(V,this,this._scene),this.applyFog&&(0,Vo.e)(this._scene,void 0,V)),Q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(I.invertToRef(g.TmpVectors.Matrix[0]),V.setMatrix("invView",g.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?E.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,V):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,V)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?E.bindBuffers(this._vertexBuffers,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBuffer:this._indexBuffer,V):E.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null,V);(this.useLogarithmicDepth&&this._scene&&(0,Vo.j)(Q,V,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(V),this._setEngineBasedOnBlendMode(o),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(V),this._useInstancing)?null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?E.drawElementsType(6,0,10,this.wf.length):E.drawArraysType(7,0,4,this.wf.length):null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?E.drawElementsType(1,0,10*this.wf.length):E.drawElementsType(0,0,6*this.wf.length);return this.wf.length}render(){if(!this.isReady()||!this.wf.length)return 0;const o=this._engine;o.setState&&(o.setState(!1),this.forceDepthWrite&&o.setDepthWrite(!0));let v=0;return v=this.blendMode===n.BLENDMODE_MULTIPLYADD?this._render(n.BLENDMODE_MULTIPLY)+this._render(n.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),v}_onDispose(){}dispose(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),o&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),o&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(v,V),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const o=this._scene.Mf.indexOf(this);o>-1&&this._scene.Mf.splice(o,1),this._scene._activeParticleSystems.dispose()}this.Tg.notifyObservers(this),this.Tg.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Ko.ForceGLSL=!1;var Xo,ro=V(12325);!function(o){o[o.ATTACHED=0]="ATTACHED",o[o.END=1]="END"}(Xo||(Xo={}));class Bo{constructor(o){if(this.particleSystem=o,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!o.lo||!o.lo.dispose){const v=(0,U.d)("BABYLON.AbstractMesh");o.lo=new v("SubemitterSystemEmitter",o.Fo()),o._disposeEmitterOnDispose=!0}}clone(){let o=this.particleSystem.lo;if(o){if(o instanceof g.cv)o=o.clone();else if(-1!==o.getClassName().indexOf("Mesh")){o=new((0,U.d)("BABYLON.Mesh"))("",o.Fo()),o.isVisible=!1}}else o=new g.cv;const v=new Bo(this.particleSystem.clone(this.particleSystem.name,o));return v.particleSystem.name+="Clone",v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem._disposeEmitterOnDispose=!0,v.particleSystem.disposeOnStop=!0,v}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem=this.particleSystem.serialize(o),v}static _ParseParticleSystem(o,v,V){throw(0,ro.b)("ParseParticle")}static Parse(o,v,V){const g=o.particleSystem,E=new Bo(Bo._ParseParticleSystem(g,v,V,!0));return E.type=o.type,E.inheritDirection=o.inheritDirection,E.inheritedVelocityAmount=o.inheritedVelocityAmount,E.particleSystem._isSubEmitter=!0,E}dispose(){this.particleSystem.dispose()}}var Ao=V(12381);function Co(o,v){const V=new R;return V.direction1=o,V.direction2=v,V}function po(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Go(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ko(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.cv(0,1,0),V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0);return new t(o,v,V)}function ov(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function vv(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0),I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new g.cv(0,1,0);return new T(o,v,V,E,I)}function Vv(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new f(o,v)}function gv(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0);return new l(o,v,V,E)}const Ev=g.cv.Zero(),Iv=g.cv.Zero(),Qv=g.cv.Zero();class Uv{constructor(){this.strength=0,this.position=g.cv.Zero()}_processParticle(o,v){this.position.subtractToRef(o.position,Ev);const V=Ev.lengthSquared()+1;Ev.normalize().scaleToRef(this.strength/V,Iv),Iv.scaleToRef(v._tempScaledUpdateSpeed,Qv),o.direction.addInPlace(Qv)}serialize(){return{position:this.position.Dg(),strength:this.strength}}}class nv extends Ko{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=o=>{if(!this._subEmitters||0===this._subEmitters.length)return;const v=Math.floor(Math.random()*this._subEmitters.length);for(const V of this._subEmitters[v])if(1===V.type){const v=V.clone();o._inheritParticleInfoToSubEmitter(v),v.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(v.particleSystem),v.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(o,v){const V=Co(o,v);return this.particleEmitterType=V,V}get flowMap(){return this._flowMap}set flowMap(o){this._flowMap!==o&&(this._flowMap=o,this._flowMapUpdate&&(Zo(this._flowMapUpdate),this._flowMapUpdate=null),o&&(this._flowMapUpdate={process:o=>{var v;const V=null===(v=this.Fo())||void 0===v?void 0:v.getTransformMatrix();this._flowMap._processParticle(o,this.flowMapStrength*this._tempScaledUpdateSpeed,V)},previousItem:null,nextItem:null},eo(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(o){this._attractors.push(o),1===this._attractors.length&&(this._attractorUpdate={process:o=>{for(const v of this._attractors)v._processParticle(o,this)},previousItem:null,nextItem:null},eo(this._attractorUpdate,this._directionProcessing))}removeAttractor(o){const v=this._attractors.indexOf(o);-1!==v&&this._attractors.splice(v,1),0===this._attractors.length&&Zo(this._attractorUpdate)}start(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(o)}createHemisphericEmitter(){const o=po(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createSphereEmitter(){const o=Go(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createDirectedSphereEmitter(){const o=ko(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.cv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0));return this.particleEmitterType=o,o}createCylinderEmitter(){const o=ov(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=o,o}createDirectedCylinderEmitter(){const o=vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new g.cv(0,1,0));return this.particleEmitterType=o,o}createConeEmitter(){const o=Vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=o,o}createDirectedConeEmitter(){const o=gv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0));return this.particleEmitterType=o,o}createBoxEmitter(o,v,V,g){const E=new x;return this.particleEmitterType=E,this.direction1=o,this.direction2=v,this.minEmitBox=V,this.maxEmitBox=g,E}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const o of this.subEmitters)o instanceof nv?this._subEmitters.push([new Bo(o)]):o instanceof Bo?this._subEmitters.push([o]):o instanceof Array&&this._subEmitters.push(o)}_stopSubEmitters(){if(this.activeSubSystems){for(const o of this.activeSubSystems)o.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const o=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==o&&this._rootParticleSystem.activeSubSystems.splice(o,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(o){o&&this._stopSubEmitters()}_prepareParticle(o){if(this._subEmitters&&this._subEmitters.length>0){const v=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];o._attachedSubEmitters=[];for(const V of v)if(0===V.type){const v=V.clone();o._attachedSubEmitters.push(v),v.particleSystem.start()}}}_onDispose(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),o&&this.particles)for(const V of this.particles)if(V._attachedSubEmitters)for(let o=V._attachedSubEmitters.length-1;o>=0;o-=1)V._attachedSubEmitters[o].dispose();if(v&&this.activeSubSystems)for(let V=this.activeSubSystems.length-1;V>=0;V-=1)this.activeSubSystems[V].dispose();if(this._subEmitters&&this._subEmitters.length){for(let o=0;o<this._subEmitters.length;o++)for(const v of this._subEmitters[o])v.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.lo&&this.lo.dispose&&this.lo.dispose(!0)}static _Parse(o,v,V,E){let I;I=V instanceof Ao.c?null:V;const n=(0,U.d)("BABYLON.Texture");if(n&&I&&(o.texture?v.particleTexture=n.Parse(o.texture,I,E):o.textureName&&(v.particleTexture=new n(E+o.textureName,I,!1,void 0===o.invertY||o.invertY),v.particleTexture.name=o.textureName)),o.emitterId||0===o.emitterId||void 0!==o.lo?o.emitterId&&I?v.lo=I.getLastMeshById(o.emitterId):v.lo=g.cv.bv(o.lo):v.lo=g.cv.Zero(),v.isLocal=!!o.isLocal,void 0!==o.renderingGroupId&&(v.renderingGroupId=o.renderingGroupId),void 0!==o.isBillboardBased&&(v.isBillboardBased=o.isBillboardBased),void 0!==o.billboardMode&&(v.billboardMode=o.billboardMode),void 0!==o.useLogarithmicDepth&&(v.useLogarithmicDepth=o.useLogarithmicDepth),o.animations){for(let V=0;V<o.animations.length;V++){const g=o.animations[V],E=(0,U.d)("BABYLON.Animation");E&&v.animations.push(E.Parse(g))}v.beginAnimationOnStart=o.beginAnimationOnStart,v.beginAnimationFrom=o.beginAnimationFrom,v.beginAnimationTo=o.beginAnimationTo,v.beginAnimationLoop=o.beginAnimationLoop}if(o.autoAnimate&&I&&I.beginAnimation(v,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),v.startDelay=0|o.startDelay,v.minAngularSpeed=o.minAngularSpeed,v.maxAngularSpeed=o.maxAngularSpeed,v.minSize=o.minSize,v.maxSize=o.maxSize,o.minScaleX&&(v.minScaleX=o.minScaleX,v.maxScaleX=o.maxScaleX,v.minScaleY=o.minScaleY,v.maxScaleY=o.maxScaleY),void 0!==o.preWarmCycles&&(v.preWarmCycles=o.preWarmCycles,v.preWarmStepOffset=o.preWarmStepOffset),void 0!==o.minInitialRotation&&(v.minInitialRotation=o.minInitialRotation,v.maxInitialRotation=o.maxInitialRotation),v.minLifeTime=o.minLifeTime,v.maxLifeTime=o.maxLifeTime,v.minEmitPower=o.minEmitPower,v.maxEmitPower=o.maxEmitPower,v.emitRate=o.emitRate,v.gravity=g.cv.bv(o.gravity),o.noiseStrength&&(v.noiseStrength=g.cv.bv(o.noiseStrength)),v.color1=Q.sU.bv(o.color1),v.color2=Q.sU.bv(o.color2),v.colorDead=Q.sU.bv(o.colorDead),v.updateSpeed=o.updateSpeed,v.targetStopDuration=o.targetStopDuration,v.blendMode=o.blendMode,o.colorGradients)for(const g of o.colorGradients)v.addColorGradient(g.gradient,Q.sU.bv(g.color1),g.color2?Q.sU.bv(g.color2):void 0);if(o.rampGradients){for(const V of o.rampGradients)v.addRampGradient(V.gradient,Q.Lv.bv(V.color));v.useRampGradients=o.useRampGradients}if(o.colorRemapGradients)for(const g of o.colorRemapGradients)v.addColorRemapGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.alphaRemapGradients)for(const g of o.alphaRemapGradients)v.addAlphaRemapGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.sizeGradients)for(const g of o.sizeGradients)v.addSizeGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.angularSpeedGradients)for(const g of o.angularSpeedGradients)v.addAngularSpeedGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.velocityGradients)for(const g of o.velocityGradients)v.addVelocityGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.dragGradients)for(const g of o.dragGradients)v.addDragGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.emitRateGradients)for(const g of o.emitRateGradients)v.addEmitRateGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.startSizeGradients)for(const g of o.startSizeGradients)v.addStartSizeGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.lifeTimeGradients)for(const g of o.lifeTimeGradients)v.addLifeTimeGradient(g.gradient,void 0!==g.factor1?g.factor1:g.factor,g.factor2);if(o.limitVelocityGradients){for(const V of o.limitVelocityGradients)v.addLimitVelocityGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);v.limitVelocityDamping=o.limitVelocityDamping}if(o.noiseTexture&&I){const V=(0,U.d)("BABYLON.ProceduralTexture");v.noiseTexture=V.Parse(o.noiseTexture,I,E)}let O;if(o.particleEmitterType){switch(o.particleEmitterType.type){case"SphereParticleEmitter":O=new j;break;case"SphereDirectedParticleEmitter":O=new t;break;case"ConeEmitter":case"ConeParticleEmitter":O=new f;break;case"ConeDirectedParticleEmitter":O=new l;break;case"CylinderParticleEmitter":O=new S;break;case"CylinderDirectedParticleEmitter":O=new T;break;case"HemisphericParticleEmitter":O=new c;break;case"PointParticleEmitter":O=new R;break;case"MeshParticleEmitter":O=new b;break;case"CustomParticleEmitter":O=new s;break;default:O=new x}O.parse(o.particleEmitterType,I)}else O=new x,O.parse(o,I);v.particleEmitterType=O,v.startSpriteCellID=o.startSpriteCellID,v.endSpriteCellID=o.endSpriteCellID,v.spriteCellLoop=o.spriteCellLoop??!0,v.spriteCellWidth=o.spriteCellWidth,v.spriteCellHeight=o.spriteCellHeight,v.spriteCellChangeSpeed=o.spriteCellChangeSpeed,v.spriteRandomStartCell=o.spriteRandomStartCell,v.disposeOnStop=o.disposeOnStop??!1,v.manualEmitCount=o.manualEmitCount??-1}static Parse(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0;const U=o.name;let n,O,h=null,x=null;if(v instanceof Ao.c?n=v:(O=v,n=O.getEngine()),o.customShader&&n.createEffectForParticles){x=o.customShader;const v=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";h=n.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,v)}const f=new nv(U,I||o.yv,v,h,o.isAnimationSheetEnabled);if(f.customShader=x,f._rootUrl=V,o.id&&(f.id=o.id),o.subEmitters){f.subEmitters=[];for(const g of o.subEmitters){const o=[];for(const E of g)o.push(Bo.Parse(E,v,V));f.subEmitters.push(o)}}if(o.attractors)for(const Q of o.attractors){const o=new Uv;o.position=g.cv.bv(Q.position),o.strength=Q.strength,f.addAttractor(o)}return nv._Parse(o,f,v,V),o.textureMask&&(f.textureMask=Q.sU.bv(o.textureMask)),o.fO&&(f.fO=g.cv.bv(o.fO)),o.preventAutoStart&&(f.preventAutoStart=o.preventAutoStart),E||f.preventAutoStart||f.start(),f}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};if(nv._Serialize(v,this,o),v.textureMask=this.textureMask.Dg(),v.customShader=this.customShader,v.preventAutoStart=this.preventAutoStart,v.fO=this.fO.Dg(),this.subEmitters){v.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const V of this._subEmitters){const g=[];for(const v of V)g.push(v.serialize(o));v.subEmitters.push(g)}}if(this._attractors&&this._attractors.length){v.attractors=[];for(const o of this._attractors)v.attractors.push(o.serialize())}return v}static _Serialize(o,v,V){if(o.name=v.name,o.id=v.id,o.yv=v.getCapacity(),o.disposeOnStop=v.disposeOnStop,o.manualEmitCount=v.manualEmitCount,v.lo.position){const V=v.lo;o.emitterId=V.id}else{const V=v.lo;o.lo=V.Dg()}v.particleEmitterType&&(o.particleEmitterType=v.particleEmitterType.serialize()),v.particleTexture&&(V?o.texture=v.particleTexture.serialize():(o.textureName=v.particleTexture.name,o.invertY=!!v.particleTexture._invertY)),o.isLocal=v.isLocal,q.c.AppendSerializedAnimations(v,o),o.beginAnimationOnStart=v.beginAnimationOnStart,o.beginAnimationFrom=v.beginAnimationFrom,o.beginAnimationTo=v.beginAnimationTo,o.beginAnimationLoop=v.beginAnimationLoop,o.startDelay=v.startDelay,o.renderingGroupId=v.renderingGroupId,o.isBillboardBased=v.isBillboardBased,o.billboardMode=v.billboardMode,o.minAngularSpeed=v.minAngularSpeed,o.maxAngularSpeed=v.maxAngularSpeed,o.minSize=v.minSize,o.maxSize=v.maxSize,o.minScaleX=v.minScaleX,o.maxScaleX=v.maxScaleX,o.minScaleY=v.minScaleY,o.maxScaleY=v.maxScaleY,o.minEmitPower=v.minEmitPower,o.maxEmitPower=v.maxEmitPower,o.minLifeTime=v.minLifeTime,o.maxLifeTime=v.maxLifeTime,o.emitRate=v.emitRate,o.gravity=v.gravity.Dg(),o.noiseStrength=v.noiseStrength.Dg(),o.color1=v.color1.Dg(),o.color2=v.color2.Dg(),o.colorDead=v.colorDead.Dg(),o.updateSpeed=v.updateSpeed,o.targetStopDuration=v.targetStopDuration,o.blendMode=v.blendMode,o.preWarmCycles=v.preWarmCycles,o.preWarmStepOffset=v.preWarmStepOffset,o.minInitialRotation=v.minInitialRotation,o.maxInitialRotation=v.maxInitialRotation,o.startSpriteCellID=v.startSpriteCellID,o.spriteCellLoop=v.spriteCellLoop,o.endSpriteCellID=v.endSpriteCellID,o.spriteCellChangeSpeed=v.spriteCellChangeSpeed,o.spriteCellWidth=v.spriteCellWidth,o.spriteCellHeight=v.spriteCellHeight,o.spriteRandomStartCell=v.spriteRandomStartCell,o.isAnimationSheetEnabled=v.isAnimationSheetEnabled,o.useLogarithmicDepth=v.useLogarithmicDepth;const g=v.getColorGradients();if(g){o.colorGradients=[];for(const v of g){const V={gradient:v.gradient,color1:v.color1.Dg()};v.color2?V.color2=v.color2.Dg():V.color2=v.color1.Dg(),o.colorGradients.push(V)}}const E=v.getRampGradients();if(E){o.rampGradients=[];for(const v of E){const V={gradient:v.gradient,color:v.color.Dg()};o.rampGradients.push(V)}o.useRampGradients=v.useRampGradients}const I=v.getColorRemapGradients();if(I){o.colorRemapGradients=[];for(const v of I){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.colorRemapGradients.push(V)}}const Q=v.getAlphaRemapGradients();if(Q){o.alphaRemapGradients=[];for(const v of Q){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.alphaRemapGradients.push(V)}}const U=v.getSizeGradients();if(U){o.sizeGradients=[];for(const v of U){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.sizeGradients.push(V)}}const n=v.getAngularSpeedGradients();if(n){o.angularSpeedGradients=[];for(const v of n){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.angularSpeedGradients.push(V)}}const O=v.getVelocityGradients();if(O){o.velocityGradients=[];for(const v of O){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.velocityGradients.push(V)}}const h=v.getDragGradients();if(h){o.dragGradients=[];for(const v of h){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.dragGradients.push(V)}}const x=v.getEmitRateGradients();if(x){o.emitRateGradients=[];for(const v of x){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.emitRateGradients.push(V)}}const f=v.getStartSizeGradients();if(f){o.startSizeGradients=[];for(const v of f){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.startSizeGradients.push(V)}}const l=v.getLifeTimeGradients();if(l){o.lifeTimeGradients=[];for(const v of l){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.lifeTimeGradients.push(V)}}const S=v.getLimitVelocityGradients();if(S){o.limitVelocityGradients=[];for(const v of S){const V={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?V.factor2=v.factor2:V.factor2=v.factor1,o.limitVelocityGradients.push(V)}o.limitVelocityDamping=v.limitVelocityDamping}v.noiseTexture&&(o.noiseTexture=v.noiseTexture.serialize())}clone(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g={...this._customWrappers};let E=null;const I=this._engine;if(I.createEffectForParticles&&null!=this.customShader){E=this.customShader;const o=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",v=I.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,o);g[0]?g[0].effect=v:this.setCustomEffect(v,0)}const Q=this.serialize(V),U=nv.Parse(Q,this._scene||this._engine,this._rootUrl);return U.name=o,U.customShader=E,U._customWrappers=g,void 0===v&&(v=this.lo),this.noiseTexture&&(U.noiseTexture=this.noiseTexture.clone()),U.lo=v,this.preventAutoStart||U.start(),U}}nv.BILLBOARDMODE_Y=2,nv.BILLBOARDMODE_ALL=7,nv.BILLBOARDMODE_STRETCHED=8,nv.BILLBOARDMODE_STRETCHED_LOCAL=9,Bo._ParseParticleSystem=nv.Parse;var Ov=V(12753),hv=V(12747),xv=V(12623);xv.c.prototype.createTransformFeedback=function(){const o=this._gl.createTransformFeedback();if(!o)throw new Error("Unable to create Transform Feedback");return o},xv.c.prototype.deleteTransformFeedback=function(o){this._gl.deleteTransformFeedback(o)},xv.c.prototype.bindTransformFeedback=function(o){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,o)},xv.c.prototype.beginTransformFeedback=function(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(o?this._gl.POINTS:this._gl.TRIANGLES)},xv.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},xv.c.prototype.setTranformFeedbackVaryings=function(o,v){this._gl.transformFeedbackVaryings(o,v,this._gl.INTERLEAVED_ATTRIBS)},xv.c.prototype.bindTransformFeedbackBuffer=function(o){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,o?o.underlyingResource:null)},xv.c.prototype.readTransformFeedbackBuffer=function(o){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,o)};const fv="clipPlaneFragmentDeclaration2",lv="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";mo.b.IncludesShadersStore[fv]||(mo.b.IncludesShadersStore[fv]=lv);V(13844),V(13851),V(13856),V(13865),V(13873),V(13875),V(13878),V(13884);const Sv="gpuRenderParticlesPixelShader",Tv="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";mo.b.ShadersStore[Sv]||(mo.b.ShadersStore[Sv]=Tv);const cv="clipPlaneVertexDeclaration2",Rv="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";mo.b.IncludesShadersStore[cv]||(mo.b.IncludesShadersStore[cv]=Rv);V(13888),V(13897),V(13906),V(13915);const jv="gpuRenderParticlesVertexShader",tv="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";mo.b.ShadersStore[jv]||(mo.b.ShadersStore[jv]=tv);class sv extends n{static get IsSupported(){if(!G.d.LastCreatedEngine)return!1;const o=G.d.LastCreatedEngine.getCaps();return o.supportTransformFeedbacks||o.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(o){this._maxActiveParticleCount=Math.min(o,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(o){this.maxActiveParticleCount=o}createPointEmitter(o,v){const V=Co(o,v);return this.particleEmitterType=V,V}createHemisphericEmitter(){const o=po(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createSphereEmitter(){const o=Go(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createDirectedSphereEmitter(){const o=ko(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.cv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0));return this.particleEmitterType=o,o}createCylinderEmitter(){const o=ov(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=o,o}createDirectedCylinderEmitter(){const o=vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new g.cv(0,1,0));return this.particleEmitterType=o,o}createConeEmitter(){const o=Vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=o,o}createDirectedConeEmitter(){const o=gv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.cv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g.cv(0,1,0));return this.particleEmitterType=o,o}createBoxEmitter(o,v,V,g){const E=new x;return this.particleEmitterType=E,this.direction1=o,this.direction2=v,this.minEmitBox=V,this.maxEmitBox=g,E}get flowMap(){return this._flowMap}set flowMap(o){this._flowMap!==o&&(this._flowMap=o)}isReady(){if(!this.lo||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==nv.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(nv.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(nv.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";o?setTimeout((()=>{this.start(0)}),o):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var o;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(o=this._customWrappers[v])||void 0===o?void 0:o.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[o]??this._customWrappers[0]}setCustomEffect(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new oo.c(this._engine),this._customWrappers[v].effect=o}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(o,v,V){return super._removeGradientAndTexture(o,v,V),this._releaseBuffers(),this}addColorGradient(o,v){this._colorGradients||(this._colorGradients=[]);const V=new X(o,v);return this._colorGradients.push(V),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(o&&this._colorGradients.sort(((o,v)=>o.gradient<v.gradient?-1:o.gradient>v.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(o){return this._removeGradientAndTexture(o,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const v in this._drawWrappers){var o;null===(o=this._drawWrappers[v].drawContext)||void 0===o||o.reset()}}_addFactorGradient(o,v,V){const g=new B(v,V);o.push(g),this._releaseBuffers()}addSizeGradient(o,v){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,o,v),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(o){return this._removeGradientAndTexture(o,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(o,v){if(!o)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&o.sort(((o,v)=>o.gradient<v.gradient?-1:o.gradient>v.gradient?1:0));const V=this;V[v]&&(V[v].dispose(),V[v]=null)}addAngularSpeedGradient(o,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,o,v),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(o){return this._removeGradientAndTexture(o,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(o,v){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,o,v),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(o){return this._removeGradientAndTexture(o,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(o,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,o,v),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(o){return this._removeGradientAndTexture(o,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(o,v){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,o,v),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(o){return this._removeGradientAndTexture(o,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(o){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(o),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Tg=new C.e,this.onStoppedObservable=new C.e,this.onStartedObservable=new C.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,V&&"Scene"!==V.getClassName()?(this._engine=V,this.defaultProjectionMatrix=g.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=V||G.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Mf.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,U.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,U.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,U.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,U.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new oo.c(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers={0:new oo.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(v=v??{}).randomTextureSize||delete v.randomTextureSize;const Q={yv:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...v},n=v;isFinite(n)&&(Q.yv=n),this._capacity=Q.yv,this._maxActiveParticleCount=Q.yv,this._currentActiveCount=0,this._isAnimationSheetEnabled=I,this.particleEmitterType=new x;const O=Math.min(this._engine.getCaps().maxTextureSize,Q.randomTextureSize);let h=[];for(let g=0;g<O;++g)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new p.e(new Float32Array(h),O,1,5,V,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let g=0;g<O;++g)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new p.e(new Float32Array(h),O,1,5,V,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=O}_reset(){this._releaseBuffers()}_createVertexBuffers(o,v,V){const g={};g.position=v.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let E=3;g.age=v.createVertexBuffer("age",E,1,this._attributesStrideSize,!0),E+=1,g.size=v.createVertexBuffer("size",E,3,this._attributesStrideSize,!0),E+=3,g.life=v.createVertexBuffer("life",E,1,this._attributesStrideSize,!0),E+=1,E+=4,this.billboardMode===nv.BILLBOARDMODE_STRETCHED&&(g.direction=v.createVertexBuffer("direction",E,3,this._attributesStrideSize,!0)),E+=3,this._platform.alignDataInBuffer&&(E+=1),this.particleEmitterType instanceof s&&(E+=3,this._platform.alignDataInBuffer&&(E+=1)),this._colorGradientsTexture||(g.color=v.createVertexBuffer("color",E,4,this._attributesStrideSize,!0),E+=4),this._isBillboardBased||(g.initialDirection=v.createVertexBuffer("initialDirection",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),this.noiseTexture&&(g.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1),g.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),g.angle=v.createVertexBuffer("angle",E,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?E++:E+=2,this._isAnimationSheetEnabled&&(g.cellIndex=v.createVertexBuffer("cellIndex",E,1,this._attributesStrideSize,!0),E+=1,this.spriteRandomStartCell&&(g.cellStartOffset=v.createVertexBuffer("cellStartOffset",E,1,this._attributesStrideSize,!0),E+=1)),g.offset=V.createVertexBuffer("offset",0,2),g.uv=V.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(g),this._platform.createVertexBuffers(o,g),this.resetDrawCache()}_initialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!o)return;const v=this._engine,V=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const E=this.particleEmitterType instanceof s,I=g.TmpVectors.cv[0];let Q=0;for(let g=0;g<this._capacity;g++)if(V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(0),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),E?(this.particleEmitterType.particleDestinationGenerator(g,null,I),V.push(I.x),V.push(I.y),V.push(I.z)):(V.push(0),V.push(0),V.push(0)),this._platform.alignDataInBuffer&&V.push(0),Q+=16,E&&(this.particleEmitterType.particlePositionGenerator(g,null,I),V.push(I.x),V.push(I.y),V.push(I.z),this._platform.alignDataInBuffer&&V.push(0),Q+=4),this._colorGradientsTexture||(V.push(0),V.push(0),V.push(0),V.push(0),Q+=4),this.isBillboardBased||(V.push(0),V.push(0),V.push(0),this._platform.alignDataInBuffer&&V.push(0),Q+=4),this.noiseTexture&&(V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),this._platform.alignDataInBuffer&&V.push(0),V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),this._platform.alignDataInBuffer&&V.push(0),Q+=8),V.push(0),Q+=1,this._angularSpeedGradientsTexture||(V.push(0),Q+=1),this._isAnimationSheetEnabled&&(V.push(0),Q+=1,this.spriteRandomStartCell&&(V.push(0),Q+=1)),this._platform.alignDataInBuffer){let o=3-(Q+3&3);for(Q+=o;o-- >0;)V.push(0)}const U=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),n=this._platform.createParticleBuffer(V),O=this._platform.createParticleBuffer(V);this._buffer0=new L.b(v,n,!1,this._attributesStrideSize),this._buffer1=new L.b(v,O,!1,this._attributesStrideSize),this._spriteBuffer=new L.b(v,U,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let o=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(o+="\n#define BILLBOARD"),this._colorGradientsTexture&&(o+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(o+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(o+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(o+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(o+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(o+="\n#define DRAGGRADIENTS"),this._flowMap&&(o+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(o+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(o+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(o+="\n#define NOISE"),this.isLocal&&(o+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===o||(this._cachedUpdateDefines=o,this._updateBuffer=this._platform.createUpdateBuffer(o)),this._platform.isUpdateBufferReady()}_getWrapper(o){const v=this._getCustomDrawWrapper(o);if(null!==v&&void 0!==v&&v.effect)return v;const V=[];this.fillDefines(V,o);let g=this._drawWrappers[o];g||(g=new oo.c(this._engine),g.drawContext&&(g.drawContext.useInstancing=!0),this._drawWrappers[o]=g);const E=V.join("\n");if(g.defines!==E){const o=[],v=[],V=[];this.fillUniformsAttributesAndSamplerNames(v,o,V),g.setEffect(this._engine.createEffect("gpuRenderParticles",o,v,V,E),E)}return g}static _GetAttributeNamesOrOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=[L.e.PositionKind,"age","life","size","angle"];return o||E.push(L.e.ColorKind),v&&E.push("cellIndex"),V||E.push("initialDirection"),g&&E.push("direction"),E.push("offset",L.e.UVKind),E}static _GetEffectCreationOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=["emitterWM","fO","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,vo.b)(g),o&&g.push("sheetInfos"),v&&g.push("logarithmicDepthConstant"),V&&(g.push("vFogInfos"),g.push("vFogColor")),g}fillDefines(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,vo.g)(this,this._scene,o),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==hv.b.FOGMODE_NONE&&o.push("#define FOG")),v===nv.BLENDMODE_MULTIPLY&&o.push("#define BLENDMULTIPLYMODE"),this.isLocal&&o.push("#define LOCAL"),this.useLogarithmicDepth&&o.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(o.push("#define BILLBOARD"),this.billboardMode){case nv.BILLBOARDMODE_Y:o.push("#define BILLBOARDY");break;case nv.BILLBOARDMODE_STRETCHED:o.push("#define BILLBOARDSTRETCHED");break;case nv.BILLBOARDMODE_ALL:o.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&o.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&o.push("#define ANIMATESHEET"),V&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),o.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(o,v,V){v.push(...sv._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===nv.BILLBOARDMODE_STRETCHED)),o.push(...sv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),V.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ov.c.PrepareUniforms(o,this._imageProcessingConfigurationDefines),Ov.c.PrepareSamplers(V,this._imageProcessingConfigurationDefines))}animate(){var o;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(v?this.preWarmStepOffset:(null===(o=this._scene)||void 0===o?void 0:o.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(o,v){const V=this[v];if(!o||!o.length||V)return;const g=new Float32Array(this._rawTextureWidth);for(let E=0;E<this._rawTextureWidth;E++){const v=E/this._rawTextureWidth;A.GetCurrentGradient(v,o,((o,v,V)=>{g[E]=(0,O.Lerp)(o.factor1,v.factor1,V)}))}this[v]=p.e.CreateRTexture(g,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[v].name=v.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const o=new Uint8Array(4*this._rawTextureWidth),v=Q.TmpColors.sU[0];for(let V=0;V<this._rawTextureWidth;V++){const g=V/this._rawTextureWidth;A.GetCurrentGradient(g,this._colorGradients,((g,E,I)=>{Q.sU.LerpToRef(g.color1,E.color1,I,v),o[4*V]=255*v.r,o[4*V+1]=255*v.g,o[4*V+2]=255*v.b,o[4*V+3]=255*v.a}))}this._colorGradientsTexture=p.e.CreateRGBATexture(o,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(o,v){var V,E,I,Q;const U=this._getWrapper(o),n=U.effect;this._engine.enableEffect(U);const O=(null===(V=this._scene)||void 0===V?void 0:V.getViewMatrix())||g.Matrix.IdentityReadOnly;if(n.setMatrix("view",O),n.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),n.setTexture("diffuseSampler",this.particleTexture),n.setVector2("translationPivot",this.translationPivot),n.setVector3("fO",this.fO),this.isLocal&&n.setMatrix("emitterWM",v),this._colorGradientsTexture?n.setTexture("colorGradientSampler",this._colorGradientsTexture):n.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const o=this.particleTexture.getBaseSize();n.setFloat3("sheetInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const o=this._scene.activeCamera;n.setVector3("eyePosition",o.globalPosition)}const h=n.defines;if(this._scene&&((0,vo.c)(n,this,this._scene),this.applyFog&&(0,Vo.e)(this._scene,void 0,n)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const o=O.clone();o.invert(),n.setMatrix("invView",o)}return this.useLogarithmicDepth&&this._scene&&(0,Vo.j)(h,n,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),this._setEngineBasedOnBlendMode(o),this._platform.bindDrawBuffers(this._targetIndex,n,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(n),null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(o){if(!this.lo||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!o)if(this.lo.position){o=this.lo.getWorldMatrix()}else{const v=this.lo;o=g.TmpVectors.Matrix[0],g.Matrix.TranslationToRef(v.x,v.y,v.z,o)}const v=this._engine,V=v.getDepthWrite();if(v.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const o=this.Fo();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",o.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",o),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,v.setDepthWrite(V)}render(){let o,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!v&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let o=0;o<this.preWarmCycles;o++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const o=0|this._accumulatedCount;this._accumulatedCount-=o,this._currentActiveCount+=o}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.lo.position){o=this.lo.getWorldMatrix()}else{const v=this.lo;o=g.TmpVectors.Matrix[0],g.Matrix.TranslationToRef(v.x,v.y,v.z,o)}const E=this._engine;this.updateInAnimate||this._update(o);let I=0;return v||V||(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0),I=this.blendMode===nv.BLENDMODE_MULTIPLYADD?this._render(nv.BLENDMODE_MULTIPLY,o)+this._render(nv.BLENDMODE_ADD,o):this._render(this.blendMode,o),this._engine.setAlphaMode(0)),I}rebuild(){const o=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(o,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,o()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const v in this._drawWrappers){this._drawWrappers[v].dispose()}if(this._drawWrappers={},this._scene){const o=this._scene.Mf.indexOf(this);o>-1&&this._scene.Mf.splice(o,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let v=0;v<this._renderVertexBuffers.length;++v){const o=this._renderVertexBuffers[v];for(const v in o)o[v].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),o&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),o&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Tg.notifyObservers(this),this.Tg.clear()}clone(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g={...this._customWrappers};let E=null;const I=this._engine;if(I.createEffectForParticles&&null!=this.customShader){E=this.customShader;const o=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";g[0]=I.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,o,void 0,void 0,void 0,this)}const Q=this.serialize(V),U=sv.Parse(Q,this._scene||this._engine,this._rootUrl);return U.name=o,U.customShader=E,U._customWrappers=g,void 0===v&&(v=this.lo),this.noiseTexture&&(U.noiseTexture=this.noiseTexture.clone()),U.lo=v,U}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return nv._Serialize(v,this,o),v.activeParticleCount=this.activeParticleCount,v.randomTextureSize=this._randomTextureSize,v.customShader=this.customShader,v}static Parse(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const I=o.name;let Q,U;v instanceof Ao.c?Q=v:(U=v,Q=U.getEngine());const n=new sv(I,{yv:E||o.yv,randomTextureSize:o.randomTextureSize},v,null,o.isAnimationSheetEnabled);if(n._rootUrl=V,o.customShader&&Q.createEffectForParticles){const v=o.customShader,V=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"",g=Q.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,V,void 0,void 0,void 0,n);n.setCustomEffect(g,0),n.customShader=v}return o.id&&(n.id=o.id),o.activeParticleCount&&(n.activeParticleCount=o.activeParticleCount),nv._Parse(o,n,v,V),o.preventAutoStart&&(n.preventAutoStart=o.preventAutoStart),g||n.preventAutoStart||n.start(),n}}var Lv=V(12291),bv=V(13922),uv=V(12888);class mV{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(o){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const v of this.systems)v.lo=o;this._emitterNode=o}setEmitterAsSphere(o,v,V){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:o,renderingGroupId:v};const g=(0,bv.d)("emitterSphere",{diameter:o.diameter,segments:o.segments},V);g.renderingGroupId=v;const E=new uv.sv("emitterSphereMaterial",V);E.emissiveColor=o.color,g.material=E;for(const I of this.systems)I.lo=g;this._emitterNode=g}start(o){for(const v of this.systems)o&&(v.lo=o),v.start()}dispose(){for(const o of this.systems)o.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={systems:[]};for(const V of this.systems)v.systems.push(V.serialize(o));return this._emitterNode&&(v.lo=this._emitterCreationOptions),v}static Parse(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0;const E=new mV,I=this.BaseAssetsUrl+"/textures/";v=v||G.d.LastCreatedScene;for(const Q of o.systems)E.systems.push(V?sv.Parse(Q,v,I,!0,g):nv.Parse(Q,v,I,!0,g));if(o.lo){const V=o.lo.options;if("Sphere"===o.lo.kind)E.setEmitterAsSphere({diameter:V.diameter,segments:V.segments,color:Q.Lv.bv(V.color)},o.lo.renderingGroupId,v)}return E}}mV.BaseAssetsUrl="https://assets.babylonjs.com/particles";var av=V(12332);class Fv{static CreateDefault(o){let v,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,g=arguments.length>2?arguments[2]:void 0;v=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new sv("default system",{yv:V},g):new nv("default system",V,g),v.lo=o;const E=Lv.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return v.particleTexture=new P.e(E,v.Fo()),v.createConeEmitter(.1,Math.PI/4),v.color1=new Q.sU(1,1,1,1),v.color2=new Q.sU(1,1,1,1),v.colorDead=new Q.sU(1,1,1,0),v.minSize=.1,v.maxSize=.1,v.minEmitPower=2,v.maxEmitPower=2,v.updateSpeed=1/60,v.emitRate=30,v}static CreateAsync(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0;v||(v=G.d.LastCreatedScene);const E={};return v.addPendingData(E),new Promise(((I,Q)=>{if(V&&!sv.IsSupported)return v.removePendingData(E),Q("Particle system with GPU is not supported.");Lv.Tools.LoadFile(`${Fv.BaseAssetsUrl}/systems/${o}.json`,(o=>{v.removePendingData(E);const Q=JSON.parse(o.toString());return I(mV.Parse(Q,v,V,g))}),void 0,void 0,void 0,(()=>(v.removePendingData(E),Q(`An error occurred with the creation of your particle system. Check if your type '${o}' exists.`))))}))}static ExportSet(o){const v=new mV;for(const V of o)v.systems.push(V);return v}static ParseFromFileAsync(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",I=arguments.length>5?arguments[5]:void 0;return new Promise(((Q,U)=>{const n=new av.b;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const v=JSON.parse(n.responseText);let U;U=g?sv.Parse(v,V,E,!1,I):nv.Parse(v,V,E,!1,I),o&&(U.name=o),Q(U)}else U("Unable to load the particle system")})),n.open("GET",v),n.send()}))}static ParseFromSnippetAsync(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0;if("_BLANK"===o){const o=this.CreateDefault(null);return o.start(),Promise.resolve(o)}return new Promise(((I,Q)=>{const U=new av.b;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const Q=JSON.parse(JSON.parse(U.responseText).jsonPayload),n=JSON.parse(Q.particleSystem);let O;O=V?sv.Parse(n,v,g,!1,E):nv.Parse(n,v,g,!1,E),O.snippetId=o,I(O)}else Q("Unable to load the snippet "+o)})),U.open("GET",this.SnippetUrl+"/"+o.replace(/#/g,"/")),U.send()}))}}Fv.BaseAssetsUrl=mV.BaseAssetsUrl,Fv.SnippetUrl="https://snippet.babylonjs.com",Fv.CreateFromSnippetAsync=Fv.ParseFromSnippetAsync;var iv=V(12958),Jv=V(12776),dv=V(13928);(0,dv.g)(Jv.d.NAME_PARTICLESYSTEM,((o,v,V,g)=>{const E=(0,dv.i)(Jv.d.NAME_PARTICLESYSTEM);if(E&&void 0!==o.Mf&&null!==o.Mf)for(let I=0,Q=o.Mf.length;I<Q;I++){const Q=o.Mf[I];V.Mf.push(E(Q,v,g))}})),(0,dv.c)(Jv.d.NAME_PARTICLESYSTEM,((o,v,V)=>{if(o.activeParticleCount){return sv.Parse(o,v,V)}return nv.Parse(o,v,V)})),Ao.c.prototype.createEffectForParticles=function(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",I=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,x=[],f=[];const l=[];return n?n.fillUniformsAttributesAndSamplerNames(f,x,l):(x=nv._GetAttributeNamesOrOptions(),f=nv._GetEffectCreationOptions()),-1===E.indexOf(" BILLBOARD")&&(E+="\n#define BILLBOARD\n"),null!==n&&void 0!==n&&n.isAnimationSheetEnabled&&-1===E.indexOf(" ANIMATESHEET")&&(E+="\n#define ANIMATESHEET\n"),-1===g.indexOf("diffuseSampler")&&g.push("diffuseSampler"),this.createEffect({vertex:h??(null===n||void 0===n?void 0:n.vertexShaderName)??"particles",fragmentElement:o},x,f.concat(v),l.concat(g),E,I,Q,U,void 0,O,(async()=>{0===O?await Promise.resolve().then(V.bind(V,13965)):await Promise.resolve().then(V.bind(V,14026))}))},iv.e.prototype.getEmittedParticleSystems=function(){const o=[];for(let v=0;v<this.Fo().Mf.length;v++){const V=this.Fo().Mf[v];V.lo===this&&o.push(V)}return o},iv.e.prototype.getHierarchyEmittedParticleSystems=function(){const o=[],v=this.getDescendants();v.push(this);for(let V=0;V<this.Fo().Mf.length;V++){const g=this.Fo().Mf[V],E=g.lo;E.position&&-1!==v.indexOf(E)&&o.push(g)}return o};V(12852),V(12865),V(12936);V(12944),V(13935),V(12706),V(12835),V(12981);V(12697);var Nv;V(13941),V(12518);!function(o){o[o.Color=2]="Color",o[o.UV=1]="UV",o[o.Random=0]="Random",o[o.Stated=3]="Stated"}(Nv||(Nv={}));var Yv=V(12737);const qv=new g.cv(0,0,0),Pv=new g.cv(0,0,0),Mv=new g.cv(0,0,0);class Wv{constructor(o,v,V){this.width=o,this.height=v,this.data=V}processFlowable(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2?arguments[2]:void 0;if(!V)return;V instanceof g.Matrix?g.cv.TransformCoordinatesToRef(o.position,V,Mv):(Mv.x=V.x,Mv.y=V.y,Mv.z=V.z);const E=.5*Mv.x+.5,I=1-(.5*Mv.y+.5),Q=Math.floor(E*this.width),U=Math.floor(I*this.height);if(Q<0||Q>=this.width||U<0||U>=this.height)return;const n=4*(U*this.width+Q),O=this.data[n]/255*2-1,h=this.data[n+1]/255*2-1,x=this.data[n+2]/255*2-1,f=this.data[n+3]/255;qv.set(O,h,x),qv.scaleToRef(v*f,Pv),o.direction.addInPlace(Pv)}_processParticle(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,V=arguments.length>2?arguments[2]:void 0;this.processFlowable(o,v,V)}static async FromUrlAsync(o){return await new Promise(((v,V)=>{const g=document.createElement("canvas"),E=g.getContext("2d");let I=null;const Q=new Image;Q.crossOrigin="anonymous",Q.src=o,Q.onerror=v=>{V(new Error(`Failed to load image: ${o} : ${v}`))},Q.onload=()=>{g.width=Q.width,g.height=Q.height,E.drawImage(Q,0,0),I=E.getImageData(0,0,g.width,g.height),v(new Wv(g.width,g.height,I.data))}}))}static async ExtractFromTextureAsync(o){return await new Promise(((v,V)=>{if(!o.isReady())return void o.onLoadObservable.addOnce((async()=>{try{const V=await this.ExtractFromTextureAsync(o);v(V)}catch(g){V(g)}}));const g=o.getSize();Yv.m.GetTextureDataAsync(o,g.width,g.height).then((o=>{v(new Wv(g.width,g.height,new Uint8ClampedArray(o)))})).catch(V)}))}}var wv,zv,yv,Hv,ev,Dv,Zv,Kv,Xv;!function(o){o[o.Int=1]="Int",o[o.Float=2]="Float",o[o.Vector2=4]="Vector2",o[o.cv=8]="cv",o[o.Matrix=16]="Matrix",o[o.Particle=32]="Particle",o[o.Texture=64]="Texture",o[o.sU=128]="sU",o[o.FloatGradient=256]="FloatGradient",o[o.Vector2Gradient=512]="Vector2Gradient",o[o.Vector3Gradient=1024]="Vector3Gradient",o[o.Color4Gradient=2048]="Color4Gradient",o[o.System=4096]="System",o[o.AutoDetect=8192]="AutoDetect",o[o.BasedOnInput=16384]="BasedOnInput",o[o.Undefined=32768]="Undefined",o[o.All=65535]="All"}(wv||(wv={})),function(o){o[o.Compatible=0]="Compatible",o[o.TypeIncompatible=1]="TypeIncompatible",o[o.HierarchyIssue=2]="HierarchyIssue"}(zv||(zv={})),function(o){o[o.Input=0]="Input",o[o.Output=1]="Output"}(yv||(yv={}));class rv{get direction(){return this._direction}get type(){if(this._type===wv.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===wv.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(o){this._type=o}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((o=>o.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(o,v,V){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=wv.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new C.e,this.onDisconnectionObservable=new C.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=v,this.name=o,this._direction=V}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(o){var v;return this.isConnected?null!==(v=this._connectedPoint)&&void 0!==v&&v._storedFunction?this._connectedPoint._storedFunction(o):this._connectedPoint._storedValue:this.value}canConnectTo(o){return 0===this.checkCompatibilityState(o)}checkCompatibilityState(o){const v=this._ownerBlock,V=o.ownerBlock;if(this.type!==o.type&&o.innerType!==wv.AutoDetect)return o.acceptedConnectionPointTypes&&-1!==o.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(o.excludedConnectionPointTypes&&-1!==o.excludedConnectionPointTypes.indexOf(this.type))return 1;let g=V,E=v;return 0===this.direction&&(g=v,E=V),g.isAnAncestorOf(E)?2:0}connectTo(o){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(o))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${o.ownerBlock.name}".${o.name}`;return this._endpoints.push(o),o._connectedPoint=this,this.onConnectionObservable.notifyObservers(o),o.onConnectionObservable.notifyObservers(this),this}disconnectFrom(o){const v=this._endpoints.indexOf(o);return-1===v||(this._endpoints.splice(v,1),o._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(o),o.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(o){let v=1;for(;v<wv.All;)o&v||this.excludedConnectionPointTypes.push(v),v<<=1}serialize(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const v={};return v.name=this.name,v.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Dg?(v.valueType="BABYLON."+this.value.getClassName(),v.value=this.value.Dg()):(v.valueType="number",v.value=this.value)),o&&this.connectedPoint&&(v.inputName=this.name,v.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,v.targetConnectionName=this.connectedPoint.name,v.isExposedOnFrame=!0,v.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(v.isExposedOnFrame=!0,v.exposedPortPosition=this.exposedPortPosition),v}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Bv{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(o){this._name=o}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(o){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new C.e,this.Tg=new C.e,this.onInputChangedObservable=new C.e,this.visibleOnFrame=!1,this._name=o,this.uniqueId=M.e.UniqueId}_inputRename(o){return o}_outputRename(o){return o}isAnAncestorOf(o){for(const v of this._outputs)if(v.hasEndpoints)for(const V of v.endpoints){if(V.ownerBlock===o)return!0;if(V.ownerBlock.isAnAncestorOf(o))return!0}return!1}isAnAncestorOfType(o){if(this.getClassName()===o)return!0;for(const v of this._outputs)if(v.hasEndpoints)for(const V of v.endpoints)if(V.ownerBlock.isAnAncestorOfType(o))return!0;return!1}getInputByName(o){const v=this._inputs.filter((v=>v.name===o));return v.length?v[0]:null}_linkConnectionTypes(o,v){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[v]._acceptedConnectionPointType=this._inputs[o]:(this._inputs[o]._linkedConnectionSource=this._inputs[v],this._inputs[o]._isMainLinkSource=!0),this._inputs[v]._linkedConnectionSource=this._inputs[o]}registerInput(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,I=arguments.length>5?arguments[5]:void 0;const Q=new rv(o,this,0);return Q.type=v,Q.isOptional=V,Q.defaultValue=g,Q.value=g,Q.valueMin=E,Q.valueMax=I,this._inputs.push(Q),this.onInputChangedObservable.notifyObservers(Q),this}registerOutput(o,v,V){return(V=V??new rv(o,this,1)).type=v,this._outputs.push(V),this}_build(o){}_customBuildStep(o){}build(o){if(this._buildId===o.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((o=>o.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=o.buildId;for(const v of this._inputs){if(!v.connectedPoint){v.isOptional||o.notConnectedNonOptionalInputs.push(v);continue}const V=v.connectedPoint.ownerBlock;V&&V!==this&&!V.isSystem&&V.build(o)}return this._customBuildStep(o),o.verbose&&W.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(o),this.onBuildObservable.notifyObservers(this),!1}serialize(){const o={};o.customType="BABYLON."+this.getClassName(),o.id=this.uniqueId,o.name=this.name,o.visibleOnFrame=this.visibleOnFrame,o.inputs=[],o.outputs=[];for(const v of this.inputs)o.inputs.push(v.serialize());for(const v of this.outputs)o.outputs.push(v.serialize(!1));return o}_deserialize(o){this._name=o.name,this.comments=o.comments,this.visibleOnFrame=!!o.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(o)}_deserializePortDisplayNamesAndExposedOnFrame(o){const v=o.inputs,V=o.outputs;if(v)for(const g of v){const o=this.inputs.find((o=>o.name===g.name));if(!o)return;if(g.displayName&&(o.displayName=g.displayName),g.isExposedOnFrame&&(o.isExposedOnFrame=g.isExposedOnFrame,o.exposedPortPosition=g.exposedPortPosition),void 0!==g.value&&null!==g.value)if("number"===g.valueType)o.value=g.value;else{const v=(0,U.d)(g.valueType);v&&(o.value=v.bv(g.value))}}if(V)for(let g=0;g<V.length;g++){const o=V[g];o.displayName&&(this.outputs[g].displayName=o.displayName),o.isExposedOnFrame&&(this.outputs[g].isExposedOnFrame=o.isExposedOnFrame,this.outputs[g].exposedPortPosition=o.exposedPortPosition)}}clone(){const o=this.serialize(),v=(0,U.d)(o.customType);if(v){const V=new v;return V._deserialize(o),V}return null}dispose(){this.Tg.notifyObservers(this),this.Tg.clear();for(const o of this.inputs)o.dispose();for(const o of this.outputs)o.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Av(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",g=arguments.length>3?arguments[3]:void 0;return(E,I)=>{let Q=E._propStore;Q||(Q=[],E._propStore=Q),Q.push({propertyName:I,displayName:o,type:v,groupName:V,options:g??{},className:E.getClassName()})}}(0,N.c)([(0,Y.K)("comment")],Bv.prototype,"comments",void 0),function(o){o[o.Boolean=0]="Boolean",o[o.Float=1]="Float",o[o.Int=2]="Int",o[o.Vector2=3]="Vector2",o[o.List=4]="List",o[o.sU=5]="sU",o[o.SamplingMode=6]="SamplingMode",o[o.TextureFormat=7]="TextureFormat",o[o.TextureType=8]="TextureType"}(Hv||(Hv={})),function(o){o[o.None=0]="None",o[o.Position=1]="Position",o[o.Direction=2]="Direction",o[o.Age=3]="Age",o[o.Lifetime=4]="Lifetime",o[o.Color=5]="Color",o[o.ScaledDirection=6]="ScaledDirection",o[o.Scale=7]="Scale",o[o.AgeGradient=8]="AgeGradient",o[o.Angle=9]="Angle",o[o.SpriteCellIndex=16]="SpriteCellIndex",o[o.SpriteCellStart=17]="SpriteCellStart",o[o.SpriteCellEnd=18]="SpriteCellEnd"}(ev||(ev={})),function(o){o[o.None=0]="None",o[o.Time=1]="Time",o[o.Delta=2]="Delta",o[o.Emitter=3]="Emitter"}(Dv||(Dv={}));class Cv{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let o="";for(const v of this.notConnectedNonOptionalInputs)o+=`input ${v.name} from block ${v.ownerBlock.name}[${v.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(o)throw"Build of Node Particle System Set failed:\n"+o}adapt(o,v){const V=o.getConnectedValue(this)||0;if(o.type===v)return V;switch(v){case wv.Vector2:return new g.Vector2(V,V);case wv.cv:return new g.cv(V,V,V);case wv.sU:return new Q.sU(V,V,V,V)}return null}getContextualValue(o){if(!this.particleContext||!this.systemContext)return null;switch(o){case ev.Position:return this.particleContext.position;case ev.Direction:return this.particleContext.direction;case ev.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case ev.Color:return this.particleContext.color;case ev.Age:return this.particleContext.age;case ev.Lifetime:return this.particleContext.lifeTime;case ev.Angle:return this.particleContext.angle;case ev.Scale:return this.particleContext.scale;case ev.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case ev.SpriteCellEnd:return this.systemContext.endSpriteCellID;case ev.SpriteCellIndex:return this.particleContext.cellIndex;case ev.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.lo.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.lo.absolutePosition:this.systemContext.lo:null}getSystemValue(o){if(!this.particleContext||!this.systemContext)return null;switch(o){case Dv.Time:return this.systemContext._actualFrame;case Dv.Delta:return this.systemContext._scaledUpdateSpeed;case Dv.Emitter:if(this.isEmitterTransformNode){return this.systemContext.lo.absolutePosition}return this.systemContext.lo}return null}}function pv(o,v,V){const g=new Cv;g.jv=v;const E=o.createSystem(g);return E.canStart=()=>!0,E.lo=V.clone(),E.disposeOnStop=!0,E.start(),E}class Gv extends Bv{constructor(o){super(o),this.blendMode=n.BLENDMODE_ONEONE,this.yv=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",wv.Particle),this.registerInput("texture",wv.Texture),this.registerInput("onStart",wv.System,!0),this.registerInput("onEnd",wv.System,!0),this.registerOutput("system",wv.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(o){o.yv=this.yv,o.buildId=this._buildId++,this.build(o);const v=this.particle.getConnectedValue(o);return v.particleTexture=this.texture.getConnectedValue(o),v.emitRate=this.emitRate,v.blendMode=this.blendMode,v.name=this.name,v._nodeGenerated=!0,v._targetStopDuration=this.targetStopDuration,v.startDelay=this.startDelay,this.system._storedValue=this,v.canStart=()=>!this.doNoStart,v.onStartedObservable.add((V=>{const g=this.onStart.getConnectedValue(o);g&&V.onStartedObservable.addOnce((()=>{o.systemContext=v;const V=pv(g,o.jv,o.emitterPosition);this.Tg.addOnce((()=>{V.dispose()}))}));const E=this.onEnd.getConnectedValue(o);E&&V.onStoppedObservable.addOnce((()=>{o.systemContext=v;const V=pv(E,o.jv,o.emitterPosition);this.Tg.addOnce((()=>{V.dispose()}))}))})),this.Tg.addOnce((()=>{v.dispose()})),v}serialize(){const o=super.serialize();return o.yv=this.yv,o.emitRate=this.emitRate,o.blendMode=this.blendMode,o.doNoStart=this.doNoStart,o.targetStopDuration=this.targetStopDuration,o.startDelay=this.startDelay,o}_deserialize(o){super._deserialize(o),this.yv=o.yv,this.emitRate=o.emitRate,this.doNoStart=!!o.doNoStart,void 0!==o.blendMode&&(this.blendMode=o.blendMode),void 0!==o.targetStopDuration&&(this.targetStopDuration=o.targetStopDuration),void 0!==o.startDelay&&(this.startDelay=o.startDelay)}}(0,N.c)([Av("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:n.BLENDMODE_ONEONE},{label:"Standard",value:n.BLENDMODE_STANDARD},{label:"Add",value:n.BLENDMODE_ADD},{label:"Multiply",value:n.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:n.BLENDMODE_MULTIPLYADD}]})],Gv.prototype,"blendMode",void 0),(0,N.c)([Av("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Gv.prototype,"yv",void 0),(0,N.c)([Av("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gv.prototype,"emitRate",void 0),(0,N.c)([Av("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gv.prototype,"targetStopDuration",void 0),(0,N.c)([Av("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gv.prototype,"startDelay",void 0),(0,N.c)([Av("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gv.prototype,"doNoStart",void 0),(0,U.h)("BABYLON.SystemBlock",Gv);class kv extends Bv{get type(){if(this._type===wv.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=wv.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=wv.Vector2,this._type;case"cv":return this._type=wv.cv,this._type;case"sU":return this._type=wv.sU,this._type;case"Matrix":return this._type=wv.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===ev.None&&this._systemSource!==Dv.None}get systemSource(){return this._systemSource}set systemSource(o){if(this._systemSource=o,o!==Dv.None){switch(this._contextualSource=ev.None,this._type=wv.Float,o){case Dv.Time:case Dv.Delta:this._type=wv.Float;break;case Dv.Emitter:this._type=wv.cv}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==ev.None}get contextualValue(){return this._contextualSource}set contextualValue(o){if(this._contextualSource=o,o!==ev.None){switch(this._systemSource=Dv.None,o){case ev.Scale:this._type=wv.Vector2;break;case ev.Position:case ev.Direction:case ev.ScaledDirection:this._type=wv.cv;break;case ev.Color:this._type=wv.sU;break;case ev.Age:case ev.Lifetime:case ev.Angle:case ev.AgeGradient:this._type=wv.Float;break;case ev.SpriteCellEnd:case ev.SpriteCellStart:case ev.SpriteCellIndex:this._type=wv.Int}this.output&&(this.output.type=this._type)}}constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wv.AutoDetect;super(o),this._type=wv.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new C.e,this._systemSource=Dv.None,this._contextualSource=ev.None,this._type=v,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",v)}get value(){return this._storedValue}set value(o){this.type===wv.Float&&this.min!==this.max&&(o=Math.max(this.min,o),o=Math.min(this.max,o)),this._storedValue=o,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(o){this._valueCallback=o}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case wv.Int:case wv.Float:this.value=0;break;case wv.Vector2:this.value=g.Vector2.Zero();break;case wv.cv:this.value=g.cv.Zero();break;case wv.sU:this.value=new Q.sU(1,1,1,1);break;case wv.Matrix:this.value=g.Matrix.Identity()}}_build(o){super._build(o),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=o=>o.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=o=>o.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const o=super.serialize();return o.type=this.type,o.contextualValue=this.contextualValue,o.systemSource=this.systemSource,o.min=this.min,o.max=this.max,o.groupInInspector=this.groupInInspector,o.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Dg?(o.valueType="BABYLON."+this._storedValue.getClassName(),o.value=this._storedValue.Dg()):(o.valueType="number",o.value=this._storedValue)),o}_deserialize(o){if(super._deserialize(o),this._type=o.type,this.contextualValue=o.contextualValue,this.systemSource=o.systemSource||Dv.None,this.min=o.min||0,this.max=o.max||0,this.groupInInspector=o.groupInInspector||"",void 0!==o.displayInInspector&&(this.displayInInspector=o.displayInInspector),o.valueType)if("number"===o.valueType)this._storedValue=o.value;else{const v=(0,U.d)(o.valueType);v&&(this._storedValue=v.bv(o.value))}}}(0,U.h)("BABYLON.ParticleInputBlock",kv);class oV extends Bv{get url(){return this._url}set url(o){this._url!==o&&(this._cachedData=null,this._url=o,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(o){this._textureDataUrl!==o&&(this._cachedData=null,this._textureDataUrl=o,this._url="",this._sourceTexture=null)}set sourceTexture(o){this._sourceTexture!==o&&(this._cachedData=null,this._sourceTexture=o,this._url="",this._textureDataUrl="")}constructor(o){super(o),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",wv.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const o=this.texture._storedValue;return await new Promise(((v,V)=>{if(!o.isReady())return void o.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),v(this._cachedData)}catch(o){V(o)}}));const g=o.getSize();Yv.m.GetTextureDataAsync(o,g.width,g.height).then((V=>{this._cachedData={width:g.width,height:g.height,data:new Uint8ClampedArray(V)},o.dispose(),v(this._cachedData)})).catch(V)}))}_build(o){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new P.e(this._textureDataUrl,o.jv):this.texture._storedValue=new P.e(this._url,o.jv):this.texture._storedValue=null}serialize(){const o=super.serialize();return o.url=this.url,o.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(o.textureDataUrl=this.textureDataUrl),o}_deserialize(o){super._deserialize(o),this.url=o.url,this.serializedCachedData=!!o.serializedCachedData,o.textureDataUrl&&(this.textureDataUrl=o.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,U.h)("BABYLON.ParticleTextureSourceBlock",oV);class vV extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("position",wv.cv),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(o){const v=this.particle.getConnectedValue(o);if(this.output._storedValue=v,!this.position.isConnected)return;const V={process:V=>{o.particleContext=V,o.systemContext=v,V.position.U(this.position.getConnectedValue(o))},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V}}(0,U.h)("BABYLON.UpdatePositionBlock",vV),function(o){o[o.Add=0]="Add",o[o.Subtract=1]="Subtract",o[o.Multiply=2]="Multiply",o[o.Divide=3]="Divide",o[o.Max=4]="Max",o[o.Min=5]="Min"}(Zv||(Zv={}));class VV extends Bv{constructor(o){super(o),this.operation=Zv.Add,this.registerInput("left",wv.AutoDetect),this.registerInput("right",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this.output._typeConnectionSource=this.left;const v=[wv.Matrix,wv.Particle,wv.Texture,wv.System,wv.FloatGradient,wv.Color4Gradient,wv.Vector2Gradient,wv.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...v),this.right.excludedConnectionPointTypes.push(...v),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(o){let v;const V=this.left,E=this.right;if(!V.isConnected||!E.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const I=V.type===wv.Float||V.type===wv.Int,U=E.type===wv.Float||E.type===wv.Int,n=I&&U;switch(this.operation){case Zv.Add:v=n?o=>V.getConnectedValue(o)+E.getConnectedValue(o):I?o=>o.adapt(V,E.type).add(E.getConnectedValue(o)):o=>V.getConnectedValue(o).add(o.adapt(E,V.type));break;case Zv.Subtract:v=n?o=>V.getConnectedValue(o)-E.getConnectedValue(o):I?o=>o.adapt(V,E.type).Rv(E.getConnectedValue(o)):o=>V.getConnectedValue(o).Rv(o.adapt(E,V.type));break;case Zv.Multiply:v=n?o=>V.getConnectedValue(o)*E.getConnectedValue(o):I?o=>o.adapt(V,E.type).multiply(E.getConnectedValue(o)):o=>V.getConnectedValue(o).multiply(o.adapt(E,V.type));break;case Zv.Divide:v=n?o=>V.getConnectedValue(o)/E.getConnectedValue(o):I?o=>o.adapt(V,E.type).divide(E.getConnectedValue(o)):o=>V.getConnectedValue(o).divide(o.adapt(E,V.type));break;case Zv.Min:if(n)v=o=>Math.min(V.getConnectedValue(o),E.getConnectedValue(o));else{const[o,U]=I?[E,V]:[V,E];switch(o.type){case wv.Vector2:v=v=>g.Vector2.Minimize(o.getConnectedValue(v),v.adapt(U,o.type));break;case wv.cv:v=v=>g.cv.Minimize(o.getConnectedValue(v),v.adapt(U,o.type));break;case wv.sU:v=v=>{const V=o.getConnectedValue(v),{r:g,g:E,b:I,a:n}=v.adapt(U,o.type);return new Q.sU(Math.min(V.r,g),Math.min(V.g,E),Math.min(V.b,I),Math.min(V.a,n))}}}break;case Zv.Max:if(!n){const[o,U]=I?[E,V]:[V,E];switch(o.type){case wv.Vector2:v=v=>g.Vector2.Maximize(o.getConnectedValue(v),v.adapt(U,o.type));break;case wv.cv:v=v=>g.cv.Maximize(o.getConnectedValue(v),v.adapt(U,o.type));break;case wv.sU:v=v=>{const V=o.getConnectedValue(v),{r:g,g:E,b:I,a:n}=v.adapt(U,o.type);return new Q.sU(Math.max(V.r,g),Math.min(V.g,E),Math.min(V.b,I),Math.min(V.a,n))}}break}v=o=>Math.max(V.getConnectedValue(o),E.getConnectedValue(o))}this.output._storedFunction=o=>V.type===wv.Int?0|v(o):v(o)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===wv.Int||this.left.type===wv.Float&&this.right.type!==wv.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[o,v]of[[this.left,this.right],[this.right,this.left]])o.acceptedConnectionPointTypes=[wv.Int,wv.Float],v.isConnected&&(o.acceptedConnectionPointTypes.push(v.type),v.type!==wv.Int&&v.type!==wv.Float||o.acceptedConnectionPointTypes.push(wv.Vector2,wv.cv,wv.sU))}dispose(){super.dispose();for(const o of this._connectionObservers)o.remove();this._connectionObservers.length=0}serialize(){const o=super.serialize();return o.operation=this.operation,o}_deserialize(o){super._deserialize(o),this.operation=o.operation}}(0,N.c)([Av("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Zv.Add},{label:"Subtract",value:Zv.Subtract},{label:"Multiply",value:Zv.Multiply},{label:"Divide",value:Zv.Divide},{label:"Max",value:Zv.Max},{label:"Min",value:Zv.Min}]})],VV.prototype,"operation",void 0),(0,U.h)("BABYLON.ParticleMathBlock",VV);class gV extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("direction1",wv.cv,!0,new g.cv(0,1,0)),this.registerInput("direction2",wv.cv,!0,new g.cv(0,1,0)),this.registerInput("minEmitBox",wv.cv,!0,new g.cv(-.5,-.5,-.5)),this.registerInput("maxEmitBox",wv.cv,!0,new g.cv(.5,.5,.5)),this.registerOutput("output",wv.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(o){const v=this.particle.getConnectedValue(o);v._directionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.direction1.getConnectedValue(o),I=this.direction2.getConnectedValue(o),Q=(0,O.RandomRange)(E.x,I.x),U=(0,O.RandomRange)(E.y,I.y),n=(0,O.RandomRange)(E.z,I.z);o.isEmitterTransformNode?g.cv.TransformNormalFromFloatsToRef(Q,U,n,o.emitterWorldMatrix,V.direction):V.direction.RU(Q,U,n)},v._positionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.minEmitBox.getConnectedValue(o),I=this.maxEmitBox.getConnectedValue(o),Q=(0,O.RandomRange)(E.x,I.x),U=(0,O.RandomRange)(E.y,I.y),n=(0,O.RandomRange)(E.z,I.z);o.isEmitterTransformNode?g.cv.TransformCoordinatesFromFloatsToRef(Q,U,n,o.emitterWorldMatrix,V.position):(V.position.RU(Q,U,n),V.position.addInPlace(o.emitterPosition))},this.output._storedValue=v}}(0,U.h)("BABYLON.BoxShapeBlock",gV);class EV extends Bv{constructor(o){super(o),this.registerInput("emitPower",wv.Float,!0,1),this.registerInput("lifeTime",wv.Float,!0,1),this.registerInput("color",wv.sU,!0,new Q.sU(1,1,1,1)),this.registerInput("scale",wv.Vector2,!0,new g.Vector2(1,1)),this.registerInput("angle",wv.Float,!0,0),this.registerOutput("particle",wv.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(o){const v=new nv(this.name,o.yv,o.jv,null,!1,void 0,!0);v.particleEmitterType=new R,v._lifeTimeCreation.process=(v,V)=>{o.particleContext=v,v.lifeTime=this.lifeTime.getConnectedValue(o),V._emitPower=this.emitPower.getConnectedValue(o)},v._colorCreation.process=v=>{o.particleContext=v,v.color.U(this.color.getConnectedValue(o))},v._sizeCreation.process=v=>{o.particleContext=v,v.size=1,v.scale.U(this.scale.getConnectedValue(o))},v._angleCreation.process=v=>{o.particleContext=v,v.angle=this.angle.getConnectedValue(o)},this.particle._storedValue=v}}(0,U.h)("BABYLON.CreateParticleBlock",EV);class IV{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const o=[];for(const v of this.attachedBlocks)v.isInput&&o.push(v);return o}constructor(o){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new C.e,this.name=o}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(o)&&this.attachedBlocks.push(o);for(const V of o.inputs){const g=V.connectedPoint;if(g){const V=g.ownerBlock;V!==o&&this._initializeBlock(V,v)}}}async buildAsync(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((V=>{const g=new mV;for(const o of this._systemBlocks)this._initializeBlock(o);for(const E of this.systemBlocks){const V=new Cv;V.buildId=this._buildId++,V.jv=o,V.verbose=v;const I=E.createSystem(V);V.emitErrors(),g.systems.push(I)}this.onBuildObservable.notifyObservers(this),V(g)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const o=new Gv("Particle system"),v=new vV("Update position");v.output.connectTo(o.particle);const V=new kv("Position");V.contextualValue=ev.Position;const g=new kv("Scaled direction");g.contextualValue=ev.ScaledDirection;const E=new VV("Add");E.operation=Zv.Add,V.output.connectTo(E.left),g.output.connectTo(E.right),E.output.connectTo(v.position);const I=new EV("Create particle"),Q=new gV("Box shape");I.particle.connectTo(Q.particle),Q.output.connectTo(v.particle);const U=new oV("Texture");U.texture.connectTo(o.texture),U.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(o)}removeBlock(o){const v=this.attachedBlocks.indexOf(o);if(v>-1&&this.attachedBlocks.splice(v,1),o.isSystem){const v=this._systemBlocks.indexOf(o);v>-1&&this._systemBlocks.splice(v,1)}}parseSerializedObject(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v||this.clear();const V={};for(const g of o.bh){const o=(0,U.d)(g.customType);if(o){const v=new o;v._deserialize(g),V[g.id]=v,this.attachedBlocks.push(v),v.isSystem&&this._systemBlocks.push(v)}}for(const g of this.attachedBlocks)if(g.isTeleportOut){const o=g,v=o._tempEntryPointUniqueId;if(v){const g=V[v];g&&g.attachToEndpoint(o)}}for(let g=0;g<o.bh.length;g++){const E=o.bh[g],I=V[E.id];I&&(I.inputs.length&&E.inputs.some((o=>o.targetConnectionName))&&!v||this._restoreConnections(I,o,V))}if(o.locations||o.editorData&&o.editorData.locations){const g=o.locations||o.editorData.locations;for(const o of g)V[o.ig]&&(o.ig=V[o.ig].uniqueId);v&&this.editorData&&this.editorData.locations&&g.concat(this.editorData.locations),o.locations?this.editorData={locations:g}:(this.editorData=o.editorData,this.editorData.locations=g);const E=[];for(const o in V)E[o]=V[o].uniqueId;this.editorData.map=E}this.comment=o.comment}_restoreConnections(o,v,V){for(const g of o.outputs)for(const E of v.bh){const I=V[E.id];if(I)for(const Q of E.inputs)if(V[Q.targetBlockId]!==o||Q.targetConnectionName!==g.name);else{const o=I.getInputByName(Q.inputName);if(!o||o.isConnected)continue;g.connectTo(o,!0),this._restoreConnections(I,v,V)}}}serialize(o){const v=o?{}:q.c.Serialize(this);v.editorData=JSON.parse(JSON.stringify(this.editorData));let V=[];o?V=o:v.customType="BABYLON.NodeParticleSystemSet",v.bh=[];for(const g of V)v.bh.push(g.serialize());if(!o)for(const g of this.attachedBlocks)-1===V.indexOf(g)&&v.bh.push(g.serialize());return v}dispose(){for(const o of this.attachedBlocks)o.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(o){const v=new IV(o);return v.setToDefault(),v}static Parse(o){const v=q.c.Parse((()=>new IV(o.name)),o,null);return v.parseSerializedObject(o),v}static ParseFromSnippetAsync(o,v){return"_BLANK"===o?Promise.resolve(IV.CreateDefault("blank")):new Promise(((V,g)=>{const E=new av.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const Q=JSON.parse(JSON.parse(E.responseText).jsonPayload),U=JSON.parse(Q.nodeParticle);v||(v=q.c.Parse((()=>new IV(o)),U,null)),v.parseSerializedObject(U),v.snippetId=o;try{V(v)}catch(I){g(I)}}else g("Unable to load the snippet "+o)})),E.open("GET",this.SnippetUrl+"/"+o.replace(/#/g,"/")),E.send()}))}}IV.EditorURL=`${Lv.Tools._DefaultCdnUrl}/v${Ao.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,IV.SnippetUrl="https://snippet.babylonjs.com",(0,N.c)([(0,Y.K)()],IV.prototype,"name",void 0),(0,N.c)([(0,Y.K)("comment")],IV.prototype,"comment",void 0),function(o){o[o.None=0]="None",o[o.PerParticle=1]="PerParticle",o[o.PerSystem=2]="PerSystem"}(Kv||(Kv={}));class QV extends Bv{constructor(o){super(o),this._currentLockId=-2,this.lockMode=Kv.PerParticle,this.registerInput("min",wv.AutoDetect,!0,0),this.registerInput("max",wv.AutoDetect,!0,1),this.registerOutput("output",wv.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wv.Float|wv.Int|wv.Vector2|wv.cv|wv.sU),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wv.Float|wv.Int|wv.Vector2|wv.cv|wv.sU),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=wv.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let o=null;switch(this._currentLockId=-2,this.min.type){case wv.AutoDetect:case wv.Int:case wv.Float:o=o=>{const v=this.min.getConnectedValue(o)||0,V=this.max.getConnectedValue(o)||1;return v+Math.random()*(V-v)};break;case wv.Vector2:o=o=>{const v=this.min.getConnectedValue(o)||g.Vector2.Zero(),V=this.max.getConnectedValue(o)||g.Vector2.One();return new g.Vector2(v.x+Math.random()*(V.x-v.x),v.y+Math.random()*(V.y-v.y))};break;case wv.cv:o=o=>{const v=this.min.getConnectedValue(o)||g.cv.Zero(),V=this.max.getConnectedValue(o)||g.cv.One();return new g.cv(v.x+Math.random()*(V.x-v.x),v.y+Math.random()*(V.y-v.y),v.z+Math.random()*(V.z-v.z))};break;case wv.sU:o=o=>{const v=this.min.getConnectedValue(o)||new Q.sU(0,0,0,0),V=this.max.getConnectedValue(o)||new Q.sU(1,1,1,1);return new Q.sU(v.x+Math.random()*(V.x-v.x),v.y+Math.random()*(V.y-v.y),v.z+Math.random()*(V.z-v.z),v.w+Math.random()*(V.w-v.w))}}this.output._storedFunction=v=>{var V;let g=0;switch(this.lockMode){case Kv.PerParticle:g=(null===(V=v.particleContext)||void 0===V?void 0:V.id)||-1;break;case Kv.PerSystem:g=v.buildId||0}return this._currentLockId!==g&&(this.lockMode!==Kv.None&&(this._currentLockId=g),this.output._storedValue=o(v)),this.output._storedValue}}serialize(){const o=super.serialize();return o.lockMode=this.lockMode,o}_deserialize(o){super._deserialize(o),this.lockMode=o.lockMode}}(0,N.c)([Av("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Kv.None},{label:"Per particle",value:Kv.PerParticle},{label:"Per system",value:Kv.PerSystem}]})],QV.prototype,"lockMode",void 0),(0,U.h)("BABYLON.ParticleRandomBlock",QV);class UV extends Bv{constructor(o){super(o),this._currentLockId=-2,this.lockMode=Kv.PerParticle,this.registerInput("min",wv.AutoDetect),this.registerInput("max",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const v=[wv.Matrix,wv.Particle,wv.Texture,wv.System,wv.FloatGradient,wv.Color4Gradient,wv.Vector2Gradient,wv.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...v),this.max.excludedConnectionPointTypes.push(...v)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let o=null;switch(this._currentLockId=-2,this.min.type){case wv.Float:case wv.Int:o=o=>{const v=this.min.getConnectedValue(o),V=this.max.getConnectedValue(o);return Math.random()*(V-v)+v};break;case wv.Vector2:o=o=>{const v=this.min.getConnectedValue(o),V=this.max.getConnectedValue(o);return new g.Vector2(Math.random()*(V.x-v.x)+v.x,Math.random()*(V.y-v.y)+v.y)};break;case wv.cv:o=o=>{const v=this.min.getConnectedValue(o),V=this.max.getConnectedValue(o);return new g.cv(Math.random()*(V.x-v.x)+v.x,Math.random()*(V.y-v.y)+v.y,Math.random()*(V.z-v.z)+v.z)};break;case wv.sU:o=o=>{const v=this.min.getConnectedValue(o),V=this.max.getConnectedValue(o);return new Q.sU(Math.random()*(V.r-v.r)+v.r,Math.random()*(V.g-v.g)+v.g,Math.random()*(V.b-v.b)+v.b,Math.random()*(V.a-v.a)+v.a)}}this.output._storedFunction=v=>{var V;let g=0;switch(this.lockMode){case Kv.PerParticle:g=(null===(V=v.particleContext)||void 0===V?void 0:V.id)||-1;break;case Kv.PerSystem:g=v.buildId||0}return this._currentLockId!==g&&(this.lockMode!==Kv.None&&(this._currentLockId=g),this.output._storedValue=o(v)),this.output._storedValue}}serialize(){const o=super.serialize();return o.lockMode=this.lockMode,o}_deserialize(o){super._deserialize(o),void 0!==o.lockMode&&(this.lockMode=o.lockMode)}}(0,N.c)([Av("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Kv.None},{label:"Per particle",value:Kv.PerParticle},{label:"Per system",value:Kv.PerSystem}]})],UV.prototype,"lockMode",void 0),(0,U.h)("BABYLON.RandomRangeBlock",UV);(0,U.h)("BABYLON.ParticleLerpBlock",class extends Bv{constructor(o){super(o),this.registerInput("left",wv.AutoDetect),this.registerInput("right",wv.AutoDetect),this.registerInput("gradient",wv.Float,!0,0,0,1),this.registerOutput("output",wv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wv.Float|wv.Int|wv.Vector2|wv.cv|wv.sU)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const o=(o,v,V)=>(1-o)*v+o*V;this.output._storedFunction=v=>{const V=this.left.getConnectedValue(v),E=this.right.getConnectedValue(v),I=this.gradient.getConnectedValue(v);switch(this.left.type){case wv.Int:case wv.Float:return o(I,V,E);case wv.Vector2:return new g.Vector2(o(I,V.x,E.x),o(I,V.y,E.y));case wv.cv:return new g.cv(o(I,V.x,E.x),o(I,V.y,E.y),o(I,V.z,E.z));case wv.sU:return new Q.sU(o(I,V.r,E.r),o(I,V.g,E.g),o(I,V.b,E.b),o(I,V.a,E.a))}return 0}}});(0,U.h)("BABYLON.UpdateDirectionBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("direction",wv.cv),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(o){const v=this.particle.getConnectedValue(o);if(this.output._storedValue=v,!this.direction.isConnected)return;const V={process:V=>{o.particleContext=V,o.systemContext=v,V.direction.U(this.direction.getConnectedValue(o))},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V}});(0,U.h)("BABYLON.UpdateColorBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("color",wv.sU),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(o){const v=this.particle.getConnectedValue(o);if(this.output._storedValue=v,!this.color.isConnected)return;const V={process:V=>{o.particleContext=V,o.systemContext=v,V.color.U(this.color.getConnectedValue(o))},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V}});(0,U.h)("BABYLON.UpdateScaleBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("scale",wv.Vector2),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(o){const v=this.particle.getConnectedValue(o);if(this.output._storedValue=v,!this.scale.isConnected)return;const V={process:V=>{o.particleContext=V,o.systemContext=v,V.scale.U(this.scale.getConnectedValue(o))},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V}});(0,U.h)("BABYLON.UpdateAngleBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("angle",wv.Float),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(o){const v=this.particle.getConnectedValue(o);if(this.output._storedValue=v,!this.angle.isConnected)return;const V={process:V=>{o.particleContext=V,o.systemContext=v,V.angle=this.angle.getConnectedValue(o)},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V}});(0,U.h)("BABYLON.BasicPositionUpdateBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(o){const v=this.particle.getConnectedValue(o),V={process:V=>{o.particleContext=V,o.systemContext=v,V.direction.scaleToRef(v._directionScale,v._scaledDirection),V.position.addInPlace(v._scaledDirection)},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V,this.output._storedValue=v}});(0,U.h)("BABYLON.BasicSpriteUpdateBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(o){const v=this.particle.getConnectedValue(o),V={process:V=>{o.particleContext=V,o.systemContext=v,V.updateCellIndex()},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V,this.output._storedValue=v}});(0,U.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("cellIndex",wv.Int),this.registerOutput("output",wv.Particle),this.cellIndex.acceptedConnectionPointTypes=[wv.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(o){const v=this.particle.getConnectedValue(o);if(this.output._storedValue=v,!this.cellIndex.isConnected)return;const V={process:V=>{o.particleContext=V,o.systemContext=v,V.cellIndex=Math.floor(this.cellIndex.getConnectedValue(o))},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V}});class nV extends Bv{constructor(o){super(o),this.strength=1,this.registerInput("particle",wv.Particle),this.registerInput("flowMap",wv.Texture),this.registerOutput("output",wv.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(o){var v;const V=this.particle.getConnectedValue(o),g=o.jv;let E;(null===(v=this.flowMap.connectedPoint)||void 0===v?void 0:v.ownerBlock).extractTextureContentAsync().then((o=>{o&&(E=new Wv(o.width,o.height,o.data))}));const I={process:o=>{const v=g.getTransformMatrix();E&&E._processParticle(o,this.strength*V._tempScaledUpdateSpeed,v)},previousItem:null,nextItem:null};V._updateQueueStart?Do(I,V._updateQueueStart):V._updateQueueStart=I,this.output._storedValue=V}serialize(){const o=super.serialize();return o.strength=this.strength,o}_deserialize(o){super._deserialize(o),this.strength=o.strength}}(0,N.c)([Av("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nV.prototype,"strength",void 0),(0,U.h)("BABYLON.UpdateFlowMapBlock",nV);(0,U.h)("BABYLON.SphereShapeBlock",class extends Bv{constructor(o){super(o),this.registerInput("input",wv.Particle),this.registerInput("radius",wv.Float,!0,1),this.registerInput("radiusRange",wv.Float,!0,1,0,1),this.registerInput("directionRandomizer",wv.Float,!0,0,0,1),this.registerOutput("output",wv.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(o){const v=this.input.getConnectedValue(o);v._directionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.directionRandomizer.getConnectedValue(o),I=V.position.Rv(o.emitterPosition).normalize(),Q=(0,O.RandomRange)(0,E),U=(0,O.RandomRange)(0,E),n=(0,O.RandomRange)(0,E);I.x+=Q,I.y+=U,I.z+=n,I.normalize(),o.isEmitterTransformNode?g.cv.TransformNormalFromFloatsToRef(Q,U,n,o.emitterWorldMatrix,V.direction):V.direction.RU(Q,U,n)},v._positionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.radius.getConnectedValue(o),I=this.radiusRange.getConnectedValue(o),Q=E-(0,O.RandomRange)(0,E*I),U=(0,O.RandomRange)(0,1),n=(0,O.RandomRange)(0,2*Math.PI),h=Math.acos(2*U-1),x=Q*Math.cos(n)*Math.sin(h),f=Q*Math.cos(h),l=Q*Math.sin(n)*Math.sin(h);o.isEmitterTransformNode?g.cv.TransformCoordinatesFromFloatsToRef(x,f,l,o.emitterWorldMatrix,V.position):(V.position.RU(x,f,l),V.position.addInPlace(o.emitterPosition))},this.output._storedValue=v}});(0,U.h)("BABYLON.PointShapeBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("direction1",wv.cv,!0,new g.cv(0,1,0)),this.registerInput("direction2",wv.cv,!0,new g.cv(0,1,0)),this.registerOutput("output",wv.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(o){const v=this.particle.getConnectedValue(o);v._directionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.direction1.getConnectedValue(o),I=this.direction2.getConnectedValue(o),Q=(0,O.RandomRange)(E.x,I.x),U=(0,O.RandomRange)(E.y,I.y),n=(0,O.RandomRange)(E.z,I.z);o.isEmitterTransformNode?g.cv.TransformNormalFromFloatsToRef(Q,U,n,o.emitterWorldMatrix,V.direction):V.direction.RU(Q,U,n)},v._positionCreation.process=V=>{o.systemContext=v,o.isEmitterTransformNode?g.cv.TransformCoordinatesFromFloatsToRef(0,0,0,o.emitterWorldMatrix,V.position):V.position.U(o.emitterPosition)},this.output._storedValue=v}});(0,U.h)("BABYLON.CustomShapeBlock",class extends Bv{constructor(o){super(o),this.registerInput("particle",wv.Particle),this.registerInput("position",wv.cv,!0,new g.cv(0,0,0)),this.registerInput("direction",wv.cv,!0,new g.cv(0,1,0)),this.registerOutput("output",wv.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(o){const v=this.particle.getConnectedValue(o);v._directionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.direction.getConnectedValue(o);o.isEmitterTransformNode?g.cv.TransformNormalToRef(E,o.emitterWorldMatrix,V.direction):V.direction.U(E)},v._positionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.position.getConnectedValue(o);o.isEmitterTransformNode?g.cv.TransformCoordinatesToRef(E,o.emitterWorldMatrix,V.position):(V.position.U(E),V.position.addInPlace(o.emitterPosition))},this.output._storedValue=v}});(0,U.h)("BABYLON.CylinderShapeBlock",class extends Bv{constructor(o){super(o),this._tempVector=g.cv.Zero(),this.registerInput("particle",wv.Particle),this.registerInput("radius",wv.Float,!0,1),this.registerInput("height",wv.Float,!0,1,0),this.registerInput("radiusRange",wv.Float,!0,1,0,1),this.registerInput("directionRandomizer",wv.Float,!0,0,0,1),this.registerOutput("output",wv.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(o){const v=this.particle.getConnectedValue(o);v._directionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.directionRandomizer.getConnectedValue(o);V.position.subtractToRef(o.emitterPosition,this._tempVector),this._tempVector.normalize(),o.isEmitterTransformNode&&g.cv.TransformNormalToRef(this._tempVector,o.emitterInverseWorldMatrix,this._tempVector);const I=(0,O.RandomRange)(-E/2,E/2);let Q=Math.atan2(this._tempVector.x,this._tempVector.z);Q+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*E,this._tempVector.y=I,this._tempVector.x=Math.sin(Q),this._tempVector.z=Math.cos(Q),this._tempVector.normalize(),o.isEmitterTransformNode?g.cv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,o.emitterWorldMatrix,V.direction):V.direction.U(this._tempVector)},v._positionCreation.process=V=>{o.particleContext=V,o.systemContext=v;const E=this.height.getConnectedValue(o),I=this.radiusRange.getConnectedValue(o),Q=this.radius.getConnectedValue(o),U=(0,O.RandomRange)(-E/2,E/2),n=(0,O.RandomRange)(0,2*Math.PI),h=(0,O.RandomRange)((1-I)*(1-I),1),x=Math.sqrt(h)*Q,f=x*Math.cos(n),l=x*Math.sin(n);o.isEmitterTransformNode?g.cv.TransformCoordinatesFromFloatsToRef(f,U,l,o.emitterWorldMatrix,V.position):(V.position.RU(f,U,l),V.position.addInPlace(o.emitterPosition))},this.output._storedValue=v}});class OV extends Bv{constructor(o){super(o),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",wv.Particle),this.registerOutput("output",wv.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){super._build(o);const v=this.particle.getConnectedValue(o);v._isAnimationSheetEnabled=!0,v.spriteCellWidth=this.width,v.spriteCellHeight=this.height,v.startSpriteCellID=this.start,v.endSpriteCellID=this.end,v.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=v}serialize(){const o=super.serialize();return o.width=this.width,o.height=this.height,o.start=this.start,o.end=this.end,o.randomStartCell=this.randomStartCell,o}_deserialize(o){super._deserialize(o),this.width=o.width,this.height=o.height,this.start=o.start,this.end=o.end,this.randomStartCell=o.randomStartCell}}(0,N.c)([Av("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OV.prototype,"start",void 0),(0,N.c)([Av("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OV.prototype,"end",void 0),(0,N.c)([Av("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OV.prototype,"width",void 0),(0,N.c)([Av("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OV.prototype,"height",void 0),(0,N.c)([Av("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],OV.prototype,"loop",void 0),(0,N.c)([Av("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],OV.prototype,"randomStartCell",void 0),(0,U.h)("BABYLON.SetupSpriteSheetBlock",OV);class hV extends Bv{constructor(o){super(o),this.reference=0,this.registerInput("value",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=o=>{switch(o){case wv.Float:return wv.FloatGradient;case wv.Vector2:return wv.Vector2Gradient;case wv.cv:return wv.Vector3Gradient;case wv.sU:return wv.Color4Gradient}return o},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wv.Float|wv.Vector2|wv.cv|wv.sU)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=o=>null}serialize(){const o=super.serialize();return o.reference=this.reference,o}_deserialize(o){super._deserialize(o),this.reference=o.reference}}(0,N.c)([Av("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],hV.prototype,"reference",void 0),(0,U.h)("BABYLON.ParticleGradientValueBlock",hV);(0,U.h)("BABYLON.ParticleGradientBlock",class extends Bv{constructor(o){super(o),this._entryCount=1,this.registerInput("gradient",wv.Float,!0,1,0,1),this.registerInput("value0",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=o=>{switch(o){case wv.FloatGradient:return wv.Float;case wv.Vector2Gradient:return wv.Vector2;case wv.Vector3Gradient:return wv.cv;case wv.Color4Gradient:return wv.sU}return o},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(wv.FloatGradient|wv.Vector2Gradient|wv.Vector3Gradient|wv.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(o){this._inputs[o].onConnectionObservable.add((()=>{this._entryCount>o||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),wv.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const o=[];for(let V=1;V<this._inputs.length;V++){var v;if(this._inputs[V].isConnected)o.push(null===(v=this._inputs[V].connectedPoint)||void 0===v?void 0:v.ownerBlock)}o.sort(((o,v)=>o.reference-v.reference)),this.output._storedFunction=v=>{const V=this.gradient.getConnectedValue(v);if(1===o.length)return o[0].value.getConnectedValue(v);let E=null;for(let I=o.length-1;I>=0;I--){const U=o[I];if(U.reference<=V){const o=U.value.getConnectedValue(v);if(E){const I=E.value.getConnectedValue(v),n=E.reference,h=U.reference,x=Math.max(0,Math.min(1,(V-h)/(n-h)));switch(this.output.type){case wv.Float:return(0,O.Lerp)(o,I,x);case wv.Vector2:return g.Vector2.Lerp(o,I,x);case wv.cv:return g.cv.Lerp(o,I,x);case wv.sU:return Q.sU.Lerp(o,I,x)}}return o}E=U}return 0}}});(0,U.h)("BABYLON.ParticleConverterBlock",class extends Bv{constructor(o){super(o),this.registerInput("color ",wv.sU,!0),this.registerInput("xyz ",wv.cv,!0),this.registerInput("xy ",wv.Vector2,!0),this.registerInput("zw ",wv.Vector2,!0),this.registerInput("x ",wv.Float,!0),this.registerInput("y ",wv.Float,!0),this.registerInput("z ",wv.Float,!0),this.registerInput("w ",wv.Float,!0),this.registerOutput("color",wv.sU),this.registerOutput("xyz",wv.cv),this.registerOutput("xy",wv.Vector2),this.registerOutput("zw",wv.Vector2),this.registerOutput("x",wv.Float),this.registerOutput("y",wv.Float),this.registerOutput("z",wv.Float),this.registerOutput("w",wv.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(o){return"color "===o?"colorIn":"xyz "===o?"xyzIn":"xy "===o?"xyIn":"zw "===o?"zwIn":"x "===o?"xIn":"y "===o?"yIn":"z "===o?"zIn":"w "===o?"wIn":o}_outputRename(o){switch(o){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return o}}_build(o){super._build(o);const v=this.xIn,V=this.yIn,E=this.zIn,I=this.wIn,U=this.xyIn,n=this.zwIn,O=this.xyzIn,h=this.colorIn,x=this.colorOut,f=this.xyzOut,l=this.xyOut,S=this.zwOut,T=this.xOut,c=this.yOut,R=this.zOut,j=this.wOut,t=o=>{if(h.isConnected)return h.getConnectedValue(o);let g=0,x=0,f=0,l=0;if(v.isConnected&&(g=v.getConnectedValue(o)),V.isConnected&&(x=V.getConnectedValue(o)),E.isConnected&&(f=E.getConnectedValue(o)),I.isConnected&&(l=I.getConnectedValue(o)),U.isConnected){const v=U.getConnectedValue(o);v&&(g=v.x,x=v.y)}if(n.isConnected){const v=n.getConnectedValue(o);v&&(f=v.x,l=v.y)}if(O.isConnected){const v=O.getConnectedValue(o);v&&(g=v.x,x=v.y,f=v.z)}return new Q.sU(g,x,f,l)};x._storedFunction=o=>t(o),f._storedFunction=o=>{const v=t(o);return new g.cv(v.r,v.g,v.b)},l._storedFunction=o=>{const v=t(o);return new g.Vector2(v.r,v.g)},S._storedFunction=o=>{const v=t(o);return new g.Vector2(v.b,v.a)},T._storedFunction=o=>t(o).r,c._storedFunction=o=>t(o).g,R._storedFunction=o=>t(o).b,j._storedFunction=o=>t(o).a}}),function(o){o[o.Cos=0]="Cos",o[o.Sin=1]="Sin",o[o.Abs=2]="Abs",o[o.Exp=3]="Exp",o[o.Exp2=4]="Exp2",o[o.Round=5]="Round",o[o.Floor=6]="Floor",o[o.Ceiling=7]="Ceiling",o[o.Sqrt=8]="Sqrt",o[o.Log=9]="Log",o[o.Tan=10]="Tan",o[o.ArcTan=11]="ArcTan",o[o.ArcCos=12]="ArcCos",o[o.ArcSin=13]="ArcSin",o[o.Sign=14]="Sign",o[o.Negate=15]="Negate",o[o.OneMinus=16]="OneMinus",o[o.Reciprocal=17]="Reciprocal",o[o.ToDegrees=18]="ToDegrees",o[o.ToRadians=19]="ToRadians",o[o.Fract=20]="Fract"}(Xv||(Xv={}));class xV extends Bv{constructor(o){super(o),this.operation=Xv.Cos,this.registerInput("input",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(wv.Float|wv.Int|wv.Vector2|wv.cv|wv.sU)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){super._build(o);let v=null;switch(this.operation){case Xv.Cos:v=o=>Math.cos(o);break;case Xv.Sin:v=o=>Math.sin(o);break;case Xv.Abs:v=o=>Math.abs(o);break;case Xv.Exp:v=o=>Math.exp(o);break;case Xv.Exp2:v=o=>Math.pow(2,o);break;case Xv.Round:v=o=>Math.round(o);break;case Xv.Floor:v=o=>Math.floor(o);break;case Xv.Ceiling:v=o=>Math.ceil(o);break;case Xv.Sqrt:v=o=>Math.sqrt(o);break;case Xv.Log:v=o=>Math.log(o);break;case Xv.Tan:v=o=>Math.tan(o);break;case Xv.ArcTan:v=o=>Math.atan(o);break;case Xv.ArcCos:v=o=>Math.acos(o);break;case Xv.ArcSin:v=o=>Math.asin(o);break;case Xv.Sign:v=o=>Math.sign(o);break;case Xv.Negate:v=o=>-o;break;case Xv.OneMinus:v=o=>1-o;break;case Xv.Reciprocal:v=o=>1/o;break;case Xv.ToRadians:v=o=>o*Math.PI/180;break;case Xv.ToDegrees:v=o=>180*o/Math.PI;break;case Xv.Fract:v=o=>o>=0?o-Math.floor(o):o-Math.ceil(o)}if(!v)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case wv.Int:case wv.Float:this.output._storedFunction=o=>{const V=this.input.getConnectedValue(o);return v(V)};break;case wv.Vector2:this.output._storedFunction=o=>{const V=this.input.getConnectedValue(o);return new g.Vector2(v(V.x),v(V.y))};break;case wv.cv:this.output._storedFunction=o=>{const V=this.input.getConnectedValue(o);return new g.cv(v(V.x),v(V.y),v(V.z))};break;case wv.sU:this.output._storedFunction=o=>{const V=this.input.getConnectedValue(o);return new Q.sU(v(V.r),v(V.g),v(V.b),v(V.a))}}return this}serialize(){const o=super.serialize();return o.operation=this.operation,o}_deserialize(o){super._deserialize(o),this.operation=o.operation}}(0,N.c)([Av("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Xv.Cos},{label:"Sin",value:Xv.Sin},{label:"Abs",value:Xv.Abs},{label:"Exp",value:Xv.Exp},{label:"Exp2",value:Xv.Exp2},{label:"Round",value:Xv.Round},{label:"Floor",value:Xv.Floor},{label:"Ceiling",value:Xv.Ceiling},{label:"Sqrt",value:Xv.Sqrt},{label:"Log",value:Xv.Log},{label:"Tan",value:Xv.Tan},{label:"ArcTan",value:Xv.ArcTan},{label:"ArcCos",value:Xv.ArcCos},{label:"ArcSin",value:Xv.ArcSin},{label:"Sign",value:Xv.Sign},{label:"Negate",value:Xv.Negate},{label:"OneMinus",value:Xv.OneMinus},{label:"Reciprocal",value:Xv.Reciprocal},{label:"ToDegrees",value:Xv.ToDegrees},{label:"ToRadians",value:Xv.ToRadians},{label:"Fract",value:Xv.Fract}]})],xV.prototype,"operation",void 0),(0,U.h)("BABYLON.ParticleTrigonometryBlock",xV);var fV,lV=V(13948);class SV extends Bv{constructor(o){super(o),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(wv.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(wv.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(wv.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(wv.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(wv.System),this._inputs[0].excludedConnectionPointTypes.push(wv.Particle),this._inputs[0].excludedConnectionPointTypes.push(wv.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const v=o=>{const v=this.input.getConnectedValue(o);if(this.log.length>=this.stackSize)return v;if(null===v||void 0===v)return this.log.push(["null",""]),v;switch(this.input.type){case wv.Vector2:this.log.push([(0,lV.j)(v,4),v.toString()]);break;case wv.cv:this.log.push([(0,lV.l)(v,4),v.toString()]);break;case wv.sU:this.log.push([`{R: ${v.r.toFixed(4)} G: ${v.g.toFixed(4)} B: ${v.b.toFixed(4)} A: ${v.a.toFixed(4)}}`,v.toString()]);break;default:this.log.push([v.toString(),v.toString()])}return v};this.output.isConnected?this.output._storedFunction=v:this.output._storedValue=v(o)}serialize(){const o=super.serialize();return o.stackSize=this.stackSize,o}_deserialize(o){super._deserialize(o),this.stackSize=o.stackSize}}(0,N.c)([Av("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],SV.prototype,"stackSize",void 0),(0,U.h)("BABYLON.ParticleDebugBlock",SV);(0,U.h)("BABYLON.ParticleElbowBlock",class extends Bv{constructor(o){super(o),this.registerInput("input",wv.AutoDetect),this.registerOutput("output",wv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){super._build(o);const v=this._outputs[0],V=this._inputs[0];v._storedFunction=o=>V.getConnectedValue(o)}});(0,U.h)("BABYLON.ParticleTeleportInBlock",class extends Bv{get endpoints(){return this._endpoints}constructor(o){super(o),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",wv.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(o){if(this.getClassName()===o)return!0;for(const v of this.endpoints)if(v.isAnAncestorOfType(o))return!0;return!1}isAnAncestorOf(o){for(const v of this.endpoints){if(v===o)return!0;if(v.isAnAncestorOf(o))return!0}return!1}attachToEndpoint(o){o.detach(),this._endpoints.push(o),o._entryPoint=this,o._outputs[0]._typeConnectionSource=this._inputs[0],o._tempEntryPointUniqueId=null,o.name="> "+this.name}detachFromEndpoint(o){const v=this._endpoints.indexOf(o);-1!==v&&(this._endpoints.splice(v,1),o._outputs[0]._typeConnectionSource=null,o._entryPoint=null)}_build(){for(const o of this._endpoints)o.output._storedFunction=o=>this.input.getConnectedValue(o)}});(0,U.h)("BABYLON.ParticleTeleportOutBlock",class extends Bv{constructor(o){super(o),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",wv.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(o){this.entryPoint&&this.entryPoint.build(o)}clone(){const o=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(o),o}serialize(){var o;const v=super.serialize();return v.entryPoint=(null===(o=this.entryPoint)||void 0===o?void 0:o.uniqueId)??"",v}_deserialize(o){super._deserialize(o),this._tempEntryPointUniqueId=o.entryPoint}}),function(o){o[o.Equal=0]="Equal",o[o.NotEqual=1]="NotEqual",o[o.LessThan=2]="LessThan",o[o.GreaterThan=3]="GreaterThan",o[o.LessOrEqual=4]="LessOrEqual",o[o.GreaterOrEqual=5]="GreaterOrEqual",o[o.Xor=6]="Xor",o[o.Or=7]="Or",o[o.And=8]="And"}(fV||(fV={}));class TV extends Bv{constructor(o){super(o),this.test=fV.Equal,this.epsilon=0,this.registerInput("left",wv.Float),this.registerInput("right",wv.Float,!0,0),this.registerInput("ifTrue",wv.AutoDetect,!0,1),this.registerInput("ifFalse",wv.AutoDetect,!0,0),this.registerOutput("output",wv.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=wv.Float,this._inputs[0].acceptedConnectionPointTypes.push(wv.Int),this._inputs[1].acceptedConnectionPointTypes.push(wv.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const o=o=>{const v=this.left.getConnectedValue(o),V=this.right.getConnectedValue(o);let g=!1;switch(this.test){case fV.Equal:g=(0,O.WithinEpsilon)(v,V,this.epsilon);break;case fV.NotEqual:g=!(0,O.WithinEpsilon)(v,V,this.epsilon);break;case fV.LessThan:g=v<V+this.epsilon;break;case fV.GreaterThan:g=v>V-this.epsilon;break;case fV.LessOrEqual:g=v<=V+this.epsilon;break;case fV.GreaterOrEqual:g=v>=V-this.epsilon;break;case fV.Xor:g=!!v&&!V||!v&&!!V;break;case fV.Or:g=!!v||!!V;break;case fV.And:g=!!v&&!!V}return g};this.output._storedFunction=v=>o(v)?this.ifTrue.getConnectedValue(v):this.ifFalse.getConnectedValue(v)}serialize(){const o=super.serialize();return o.test=this.test,o.epsilon=this.epsilon,o}_deserialize(o){super._deserialize(o),this.test=o.test,void 0!==o.epsilon&&(this.epsilon=o.epsilon)}}(0,N.c)([Av("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:fV.Equal},{label:"NotEqual",value:fV.NotEqual},{label:"LessThan",value:fV.LessThan},{label:"GreaterThan",value:fV.GreaterThan},{label:"LessOrEqual",value:fV.LessOrEqual},{label:"GreaterOrEqual",value:fV.GreaterOrEqual},{label:"Xor",value:fV.Xor},{label:"Or",value:fV.Or},{label:"And",value:fV.And}]})],TV.prototype,"test",void 0),(0,N.c)([Av("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],TV.prototype,"epsilon",void 0),(0,U.h)("BABYLON.ParticleConditionBlock",TV);class cV extends Bv{constructor(o){super(o),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",wv.Particle),this.registerInput("condition",wv.Float,!0,0),this.registerInput("system",wv.System),this.registerOutput("output",wv.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(o){this._triggerCount=0;const v=this.input.getConnectedValue(o),V={process:V=>{if(o.particleContext=V,o.systemContext=v,0!==this.condition.getConnectedValue(o)&&(0===this.limit||this._triggerCount<this.limit)){const g=(new Date).getTime();if(this._previousOne&&g-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=g;const E=this.system.getConnectedValue(o);if(E){const g=pv(E,o.jv,V.position);g.Tg.addOnce((()=>{this._triggerCount--})),v.Tg.addOnce((()=>{g.dispose()}))}}},previousItem:null,nextItem:null};v._updateQueueStart?Do(V,v._updateQueueStart):v._updateQueueStart=V,this.output._storedValue=v}serialize(){const o=super.serialize();return o.limit=this.limit,o.delay=this.delay,o}_deserialize(o){super._deserialize(o),void 0!==o.limit&&(this.limit=o.limit),void 0!==o.delay&&(this.delay=o.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,N.c)([Av("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cV.prototype,"limit",void 0),(0,N.c)([Av("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cV.prototype,"delay",void 0),(0,U.h)("BABYLON.ParticleTriggerBlock",cV);V(13954),V(13965),V(13972),V(14026)},14009:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneFragment",I="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},13975:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneFragmentDeclaration",I="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14037:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneVertex",I="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14029:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneVertexDeclaration",I="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14021:(o,v,V)=>{"use strict";var g=V(12396);const E="fogFragment",I="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14e3:(o,v,V)=>{"use strict";var g=V(12396);const E="fogFragmentDeclaration",I="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14046:(o,v,V)=>{"use strict";var g=V(12396);const E="fogVertex",I="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14034:(o,v,V)=>{"use strict";var g=V(12396);const E="fogVertexDeclaration",I="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},13991:(o,v,V)=>{"use strict";var g=V(12396);const E="helperFunctions",I="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},13980:(o,v,V)=>{"use strict";var g=V(12396);const E="imageProcessingDeclaration",I="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},13993:(o,v,V)=>{"use strict";var g=V(12396);const E="imageProcessingFunctions",I="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},13989:(o,v,V)=>{"use strict";var g=V(12396);const E="logDepthDeclaration",I="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14013:(o,v,V)=>{"use strict";var g=V(12396);const E="logDepthFragment",I="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},14050:(o,v,V)=>{"use strict";var g=V(12396);const E="logDepthVertex",I="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";g.b.IncludesShadersStoreWGSL[E]||(g.b.IncludesShadersStoreWGSL[E]=I)},13972:(o,v,V)=>{"use strict";V.r(v),V.d(v,{particlesPixelShaderWGSL:()=>Q});var g=V(12396);V(13975),V(13980),V(13989),V(13991),V(13993),V(14e3),V(14009),V(14013),V(14021);const E="particlesPixelShader",I="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";g.b.ShadersStoreWGSL[E]||(g.b.ShadersStoreWGSL[E]=I);const Q={name:E,shader:I}},14026:(o,v,V)=>{"use strict";V.r(v),V.d(v,{particlesVertexShaderWGSL:()=>Q});var g=V(12396);V(14029),V(14034),V(13989),V(14037),V(14046),V(14050);const E="particlesVertexShader",I="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";g.b.ShadersStoreWGSL[E]||(g.b.ShadersStoreWGSL[E]=I);const Q={name:E,shader:I}},13875:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneFragment",I="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13963:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneFragmentDeclaration",I="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13897:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneVertex",I="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13970:(o,v,V)=>{"use strict";var g=V(12396);const E="clipPlaneVertexDeclaration",I="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13884:(o,v,V)=>{"use strict";var g=V(12396);const E="fogFragment",I="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13873:(o,v,V)=>{"use strict";var g=V(12396);const E="fogFragmentDeclaration",I="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13906:(o,v,V)=>{"use strict";var g=V(12396);const E="fogVertex",I="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13888:(o,v,V)=>{"use strict";var g=V(12396);const E="fogVertexDeclaration",I="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13856:(o,v,V)=>{"use strict";var g=V(12396);const E="helperFunctions",I="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13844:(o,v,V)=>{"use strict";var g=V(12396);const E="imageProcessingDeclaration",I="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13865:(o,v,V)=>{"use strict";var g=V(12396);const E="imageProcessingFunctions",I="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13851:(o,v,V)=>{"use strict";var g=V(12396);const E="logDepthDeclaration",I="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13878:(o,v,V)=>{"use strict";var g=V(12396);const E="logDepthFragment",I="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13915:(o,v,V)=>{"use strict";var g=V(12396);const E="logDepthVertex",I="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";g.b.IncludesShadersStore[E]||(g.b.IncludesShadersStore[E]=I)},13954:(o,v,V)=>{"use strict";V.r(v),V.d(v,{particlesPixelShader:()=>Q});var g=V(12396);V(13963),V(13844),V(13851),V(13856),V(13865),V(13873),V(13875),V(13878),V(13884);const E="particlesPixelShader",I="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";g.b.ShadersStore[E]||(g.b.ShadersStore[E]=I);const Q={name:E,shader:I}},13965:(o,v,V)=>{"use strict";V.r(v),V.d(v,{particlesVertexShader:()=>Q});var g=V(12396);V(13970),V(13888),V(13851),V(13897),V(13906),V(13915);const E="particlesVertexShader",I="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";g.b.ShadersStore[E]||(g.b.ShadersStore[E]=I);const Q={name:E,shader:I}},14291:(o,v,V)=>{"use strict";V.r(v),V.d(v,{FlowGraphGLTFDataProvider:()=>I});var g=V(14259),E=V(14241);class I extends g.b{constructor(o){var v,V;super();const g=o.glTF,I=(null===(v=g.animations)||void 0===v?void 0:v.map((o=>o._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",E.e,I);const Q=(null===(V=g.nodes)||void 0===V?void 0:V.map((o=>o._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",E.e,Q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14183:(o,v,V)=>{"use strict";V.d(v,{e:()=>c,i:()=>S,j:()=>l,l:()=>T});var g=V(12488),E=V(12996),I=V(12547),Q=V(14189);const U=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class n{constructor(o,v){this._gltf=o,this._infoTree=v}convert(o){let v,V=this._gltf,g=this._infoTree;if(!o.startsWith("/"))throw new Error("Path must start with a /");const E=o.split("/");if(E.shift(),E[E.length-1].includes(".length")){const o=E[E.length-1].split(".");E.pop(),E.push(...o)}let I=!1;for(const n of E){const E="length"===n;if(E&&!g.__array__)throw new Error(`Path ${o} is invalid`);if(g.__ignoreObjectTree__&&(I=!0),g.__array__&&!E)g=g.__array__;else if(g=g[n],!g)throw new Error(`Path ${o} is invalid`);if(!I)if(void 0===V){if(!U.find((v=>v.regex.test(o))))throw new Error(`Path ${o} is invalid`)}else if(!E){var Q;V=null===(Q=V)||void 0===Q?void 0:Q[n]}(g.__target__||E)&&(v=V)}return{object:v,info:g}}}function O(o,v,V,g){const E=h(o,v);return g?E[V][g]:E[V]}function h(o,v,V){var g,I;return null===(g=o._data)||void 0===g||null===(I=g[(null===V||void 0===V?void 0:V.fillMode)??E.c.MATERIAL_TriangleFillMode])||void 0===I?void 0:I.babylonMaterial}function x(o,v){return{offset:{componentsCount:2,type:"Vector2",get:(V,E,I)=>{const Q=O(V,I,o,v);return new g.Vector2(null===Q||void 0===Q?void 0:Q.uOffset,null===Q||void 0===Q?void 0:Q.vOffset)},getTarget:h,set:(V,g,E,I)=>{const Q=O(g,I,o,v);Q.uOffset=V.x,Q.vOffset=V.y},getPropertyName:[()=>`${o}${v?"."+v:""}.uOffset`,()=>`${o}${v?"."+v:""}.vOffset`]},rotation:{type:"number",get:(V,g,E)=>{var I;return null===(I=O(V,E,o,v))||void 0===I?void 0:I.wAng},getTarget:h,set:(V,g,E,I)=>O(g,I,o,v).wAng=V,getPropertyName:[()=>`${o}${v?"."+v:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(V,E,I)=>{const Q=O(V,I,o,v);return new g.Vector2(null===Q||void 0===Q?void 0:Q.uScale,null===Q||void 0===Q?void 0:Q.vScale)},getTarget:h,set:(V,g,E,I)=>{const Q=O(g,I,o,v);Q.uScale=V.x,Q.vScale=V.y},getPropertyName:[()=>`${o}${v?"."+v:""}.uScale`,()=>`${o}${v?"."+v:""}.vScale`]}}}const f={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:o=>{var v,V;return new g.Vector2((null===(v=o._babylonCamera)||void 0===v?void 0:v.orthoLeft)??0,(null===(V=o._babylonCamera)||void 0===V?void 0:V.orthoRight)??0)},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.orthoLeft=o.x,v._babylonCamera.orthoRight=o.y)},getTarget:o=>o,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:o=>{var v,V;return new g.Vector2((null===(v=o._babylonCamera)||void 0===v?void 0:v.orthoBottom)??0,(null===(V=o._babylonCamera)||void 0===V?void 0:V.orthoTop)??0)},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.orthoBottom=o.x,v._babylonCamera.orthoTop=o.y)},getTarget:o=>o,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:o=>{var v;return null===(v=o._babylonCamera)||void 0===v?void 0:v.maxZ},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.maxZ=o)},getTarget:o=>o,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:o=>{var v;return null===(v=o._babylonCamera)||void 0===v?void 0:v.Xg},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.Xg=o)},getTarget:o=>o,getPropertyName:[()=>"Xg"]}},perspective:{aspectRatio:{type:"number",get:o=>{var v;return null===(v=o._babylonCamera)||void 0===v?void 0:v.getEngine().getAspectRatio(o._babylonCamera)},getTarget:o=>o,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:o=>{var v;return null===(v=o._babylonCamera)||void 0===v?void 0:v.fov},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.fov=o)},getTarget:o=>o,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:o=>{var v;return null===(v=o._babylonCamera)||void 0===v?void 0:v.maxZ},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.maxZ=o)},getTarget:o=>o,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:o=>{var v;return null===(v=o._babylonCamera)||void 0===v?void 0:v.Xg},set:(o,v)=>{v._babylonCamera&&(v._babylonCamera.Xg=o)},getTarget:o=>o,getPropertyName:[()=>"Xg"]}}}},nodes:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"cv",get:o=>{var v;return null===(v=o._babylonTransformNode)||void 0===v?void 0:v.position},set:(o,v)=>{var V;return null===(V=v._babylonTransformNode)||void 0===V?void 0:V.position.U(o)},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:o=>{var v;return null===(v=o._babylonTransformNode)||void 0===v?void 0:v.rotationQuaternion},set:(o,v)=>{var V,g;return null===(V=v._babylonTransformNode)||void 0===V||null===(g=V.rotationQuaternion)||void 0===g?void 0:g.U(o)},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"cv",get:o=>{var v;return null===(v=o._babylonTransformNode)||void 0===v?void 0:v.jU},set:(o,v)=>{var V;return null===(V=v._babylonTransformNode)||void 0===V?void 0:V.jU.U(o)},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"jU"]},weights:{length:{type:"number",get:o=>o._numMorphTargets,getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(o,v)=>{var V,g;return void 0!==v?null===(V=o._primitiveBabylonMeshes)||void 0===V||null===(g=V[0].morphTargetManager)||void 0===g?void 0:g.getTarget(v).influence:void 0},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(o,v)=>[0],getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:o=>{var v,V,E;return g.Matrix.Compose(null===(v=o._babylonTransformNode)||void 0===v?void 0:v.jU,null===(V=o._babylonTransformNode)||void 0===V?void 0:V.rotationQuaternion,null===(E=o._babylonTransformNode)||void 0===E?void 0:E.position)},getTarget:o=>o._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:o=>{var v,V,E,I;const Q=g.Matrix.Identity();let U=o.parent;for(;U&&U.parent;)U=U.parent;const n=(null===(v=o._babylonTransformNode)||void 0===v?void 0:v.position._isDirty)||(null===(V=o._babylonTransformNode)||void 0===V||null===(E=V.rotationQuaternion)||void 0===E?void 0:E._isDirty)||(null===(I=o._babylonTransformNode)||void 0===I?void 0:I.jU._isDirty);if(U){var O;const v=null===(O=U._babylonTransformNode)||void 0===O?void 0:O.Ag(!0).invert();var h,x;if(v)null===(h=o._babylonTransformNode)||void 0===h||null===(x=h.Ag(n))||void 0===x||x.multiplyToRef(v,Q)}else o._babylonTransformNode&&Q.U(o._babylonTransformNode.Ag(n));return Q},getTarget:o=>o._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:o=>{var v,V;return null===(v=o._babylonTransformNode)||void 0===v||null===(V=v.getChildren((o=>o instanceof Q.c),!0)[0])||void 0===V?void 0:V.uU},getTarget:o=>{var v;return null===(v=o._babylonTransformNode)||void 0===v?void 0:v.getChildren((o=>o instanceof Q.c),!0)[0]},set:(o,v)=>{if(v._babylonTransformNode){const V=v._babylonTransformNode.getChildren((o=>o instanceof Q.c),!0)[0];V&&(V.uU=o)}}},color:{type:"Lv",get:o=>{var v,V;return null===(v=o._babylonTransformNode)||void 0===v||null===(V=v.getChildren((o=>o instanceof Q.c),!0)[0])||void 0===V?void 0:V.mn},getTarget:o=>{var v;return null===(v=o._babylonTransformNode)||void 0===v?void 0:v.getChildren((o=>o instanceof Q.c),!0)[0]},set:(o,v)=>{if(v._babylonTransformNode){const V=v._babylonTransformNode.getChildren((o=>o instanceof Q.c),!0)[0];V&&(V.mn=o)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Lv",get:(o,v,V)=>h(o,v,V).emissiveColor,set:(o,v,V,g)=>h(v,V,g).emissiveColor.U(o),getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:x("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(o,v,V)=>{var g;return null===(g=O(o,V,"bumpTexture"))||void 0===g?void 0:g.level},set:(o,v,V,g)=>{const E=O(v,g,"bumpTexture");E&&(E.level=o)},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:x("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(o,v,V)=>h(o,v,V).ambientTextureStrength,set:(o,v,V,g)=>{const E=h(v,V,g);E&&(E.ambientTextureStrength=o)},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:x("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"sU",get:(o,v,V)=>{const g=h(o,v,V);return I.sU.FromColor3(g.albedoColor,g.alpha)},set:(o,v,V,g)=>{const E=h(v,V,g);E.albedoColor.set(o.r,o.g,o.b),E.alpha=o.a},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:x("albedoTexture")}},metallicFactor:{type:"number",get:(o,v,V)=>h(o,v,V).metallic,set:(o,v,V,g)=>{const E=h(v,V,g);E&&(E.metallic=o)},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(o,v,V)=>h(o,v,V).roughness,set:(o,v,V,g)=>{const E=h(v,V,g);E&&(E.roughness=o)},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:x("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(o,v,V)=>h(o,v,V).anisotropy.uU,set:(o,v,V,g)=>{h(v,V,g).anisotropy.uU=o},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(o,v,V)=>h(o,v,V).anisotropy.angle,set:(o,v,V,g)=>{h(v,V,g).anisotropy.angle=o},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:x("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(o,v,V)=>h(o,v,V).clearCoat.uU,set:(o,v,V,g)=>{h(v,V,g).clearCoat.uU=o},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(o,v,V)=>h(o,v,V).clearCoat.roughness,set:(o,v,V,g)=>{h(v,V,g).clearCoat.roughness=o},getTarget:(o,v,V)=>h(o,v,V),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:x("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(o,v,V)=>{var g;return null===(g=h(o,v,V).clearCoat.bumpTexture)||void 0===g?void 0:g.level},getTarget:h,set:(o,v,V,g)=>h(v,V,g).clearCoat.bumpTexture.level=o},extensions:{KHR_texture_transform:x("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:x("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(o,v,V)=>h(o,v,V).subSurface.dispersion,getTarget:h,set:(o,v,V,g)=>h(v,V,g).subSurface.dispersion=o}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(o,v,V)=>h(o,v,V).emissiveIntensity,getTarget:h,set:(o,v,V,g)=>h(v,V,g).emissiveIntensity=o}},KHR_materials_ior:{ior:{type:"number",get:(o,v,V)=>h(o,v,V).indexOfRefraction,getTarget:h,set:(o,v,V,g)=>h(v,V,g).indexOfRefraction=o}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(o,v,V)=>h(o,v,V).iridescence.uU,getTarget:h,set:(o,v,V,g)=>h(v,V,g).iridescence.uU=o},iridescenceIor:{type:"number",get:(o,v,V)=>h(o,v,V).iridescence.indexOfRefraction,getTarget:h,set:(o,v,V,g)=>h(v,V,g).iridescence.indexOfRefraction=o},iridescenceTexture:{extensions:{KHR_texture_transform:x("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(o,v,V)=>h(o,v,V).iridescence.maximumThickness,getTarget:h,set:(o,v,V,g)=>h(v,V,g).iridescence.maximumThickness=o},iridescenceThicknessMinimum:{type:"number",get:(o,v,V)=>h(o,v,V).iridescence.minimumThickness,getTarget:h,set:(o,v,V,g)=>h(v,V,g).iridescence.minimumThickness=o},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:x("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Lv",get:(o,v,V)=>h(o,v,V).sheen.color,getTarget:h,set:(o,v,V,g)=>h(v,V,g).sheen.color.U(o)},sheenColorTexture:{extensions:{KHR_texture_transform:x("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(o,v,V)=>h(o,v,V).sheen.uU,getTarget:h,set:(o,v,V,g)=>h(v,V,g).sheen.uU=o},sheenRoughnessTexture:{extensions:{KHR_texture_transform:x("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(o,v,V)=>h(o,v,V).metallicF0Factor,getTarget:h,set:(o,v,V,g)=>h(v,V,g).metallicF0Factor=o,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Lv",get:(o,v,V)=>h(o,v,V).metallicReflectanceColor,getTarget:h,set:(o,v,V,g)=>h(v,V,g).metallicReflectanceColor.U(o),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:x("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:x("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(o,v,V)=>h(o,v,V).subSurface.refractionIntensity,getTarget:h,set:(o,v,V,g)=>h(v,V,g).subSurface.refractionIntensity=o,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:x("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(o,v,V)=>h(o,v,V).subSurface.translucencyIntensity,getTarget:h,set:(o,v,V,g)=>h(v,V,g).subSurface.translucencyIntensity=o},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:x("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Lv",get:(o,v,V)=>h(o,v,V).subSurface.translucencyColor,getTarget:h,set:(o,v,V,g)=>{var E;return o&&(null===(E=h(v,V,g).subSurface.translucencyColor)||void 0===E?void 0:E.U(o))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:x("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Lv",get:(o,v,V)=>h(o,v,V).subSurface.tintColor,getTarget:h,set:(o,v,V,g)=>h(v,V,g).subSurface.tintColor.U(o)},attenuationDistance:{type:"number",get:(o,v,V)=>h(o,v,V).subSurface.tintColorAtDistance,getTarget:h,set:(o,v,V,g)=>h(v,V,g).subSurface.tintColorAtDistance=o},thicknessFactor:{type:"number",get:(o,v,V)=>h(o,v,V).subSurface.maximumThickness,getTarget:h,set:(o,v,V,g)=>h(v,V,g).subSurface.maximumThickness=o},thicknessTexture:{extensions:{KHR_texture_transform:x("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonLight)),getPropertyName:[o=>"length"]},__array__:{__target__:!0,color:{type:"Lv",get:o=>{var v;return null===(v=o._babylonLight)||void 0===v?void 0:v.mn},set:(o,v)=>{var V;return null===(V=v._babylonLight)||void 0===V?void 0:V.mn.U(o)},getTarget:o=>o._babylonLight,getPropertyName:[o=>"diffuse"]},uU:{type:"number",get:o=>{var v;return null===(v=o._babylonLight)||void 0===v?void 0:v.uU},set:(o,v)=>v._babylonLight?v._babylonLight.uU=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"intensity"]},range:{type:"number",get:o=>{var v;return null===(v=o._babylonLight)||void 0===v?void 0:v.range},set:(o,v)=>v._babylonLight?v._babylonLight.range=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"range"]},spot:{innerConeAngle:{type:"number",get:o=>{var v;return null===(v=o._babylonLight)||void 0===v?void 0:v.innerAngle},set:(o,v)=>v._babylonLight?v._babylonLight.innerAngle=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"innerConeAngle"]},outerConeAngle:{type:"number",get:o=>{var v;return null===(v=o._babylonLight)||void 0===v?void 0:v.angle},set:(o,v)=>v._babylonLight?v._babylonLight.angle=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonLight)),getPropertyName:[o=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonTexture)),getPropertyName:[o=>"length"]},__array__:{__target__:!0,uU:{type:"number",get:o=>{var v;return null===(v=o._babylonTexture)||void 0===v?void 0:v.level},set:(o,v)=>{v._babylonTexture&&(v._babylonTexture.level=o)},getTarget:o=>o._babylonTexture},rotation:{type:"Quaternion",get:o=>{var v;return o._babylonTexture&&g.Quaternion.FromRotationMatrix(null===(v=o._babylonTexture)||void 0===v?void 0:v.getReflectionTextureMatrix())},set:(o,v)=>{var V;v._babylonTexture&&(null!==(V=v._babylonTexture.Fo())&&void 0!==V&&V.useRightHandedSystem||(o=g.Quaternion.Inverse(o)),g.Matrix.FromQuaternionToRef(o,v._babylonTexture.getReflectionTextureMatrix()))},getTarget:o=>o._babylonTexture}}}}},animations:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>{var v;return null===(v=o.primitives[0]._instanceData)||void 0===v?void 0:v.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function l(o){return new n(o,f)}function S(o){const v=o.split("/").map((o=>o.replace(/{}/g,"__array__")));let V=f;for(const g of v)g&&(V=V[g]);if(V&&V.type&&V.get)return V}function T(o,v){const V=o.split("/").map((o=>o.replace(/{}/g,"__array__")));let g=f;for(const E of V)E&&(g=g[E]);g&&g.type&&g.get&&(g.interpolation=v)}function c(o,v){const V=o.split("/").map((o=>o.replace(/{}/g,"__array__")));let g=f;for(const E of V)if(E){if(!g[E]){if("?"===E){g.__ignoreObjectTree__=!0;continue}g[E]={},"__array__"===E&&(g[E].__target__=!0)}g=g[E]}Object.assign(g,v)}},14197:(o,v,V)=>{"use strict";V.r(v),V.d(v,{AnimationPropertyInfo:()=>O,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>x,getQuaternion:()=>U,getVector3:()=>Q,getWeights:()=>n});var g=V(13035),E=V(12488),I=V(14183);function Q(o,v,V,g){return E.cv.bv(v,V).scaleInPlace(g)}function U(o,v,V,g){return E.Quaternion.bv(v,V).scaleInPlace(g)}function n(o,v,V,g){const E=new Array(o._numMorphTargets);for(let I=0;I<E.length;I++)E[I]=v[V++]*g;return E}class O{constructor(o,v,V,g){this.type=o,this.name=v,this.getValue=V,this.getStride=g}_buildAnimation(o,v,V){const E=new g.b(o,this.name,v,this.type);return E.setKeys(V),E}}class h extends O{buildAnimations(o,v,V,g){const E=[];return E.push({babylonAnimatable:o._babylonTransformNode,babylonAnimation:this._buildAnimation(v,V,g)}),E}}class x extends O{buildAnimations(o,v,V,E){const I=[];if(o._numMorphTargets)for(let Q=0;Q<o._numMorphTargets;Q++){const U=new g.b(`${v}_${Q}`,this.name,V,this.type);if(U.setKeys(E.map((o=>({frame:o.frame,inTangent:o.inTangent?o.inTangent[Q]:void 0,value:o.value[Q],outTangent:o.outTangent?o.outTangent[Q]:void 0,interpolation:o.interpolation})))),o._primitiveBabylonMeshes)for(const v of o._primitiveBabylonMeshes)if(v.morphTargetManager){const o=v.morphTargetManager.getTarget(Q),V=U.clone();o.animations.push(V),I.push({babylonAnimatable:o,babylonAnimation:V})}}return I}}(0,I.l)("/nodes/{}/translation",[new h(g.b.ANIMATIONTYPE_VECTOR3,"position",Q,(()=>3))]),(0,I.l)("/nodes/{}/rotation",[new h(g.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",U,(()=>4))]),(0,I.l)("/nodes/{}/scale",[new h(g.b.ANIMATIONTYPE_VECTOR3,"jU",Q,(()=>3))]),(0,I.l)("/nodes/{}/weights",[new x(g.b.ANIMATIONTYPE_FLOAT,"influence",n,(o=>o._numMorphTargets))])},14157:(o,v,V)=>{"use strict";class g{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((o,v)=>{this._resolve=o,this._reject=v}))}}var E=V(12488),I=V(12547),Q=V(12291),U=V(12967),n=V(14162),O=V(14170),h=V(12297),x=V(12989),f=V(13035),l=V(13040),S=V(12339),T=V(12308),c=V(12313);class R{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(o){this._useTextureToStoreBoneMatrices=o,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(o){this._animationPropertiesOverride=o}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(o,v,V){this.name=o,this.id=v,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=E.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new h.e,this.bones=[],this._scene=V||S.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const g=this._scene.getEngine().getCaps();this._canUseTextureForBones=g.textureFloat&&g.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((o=>!o.getParent()))}getTransformMatrices(o){if(this.needInitialSkinMatrix){if(!o)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return o._bonesTransformMatrices||this.prepare(!0),o._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(o){return this.needInitialSkinMatrix&&o._transformMatrixTexture?o._transformMatrixTexture:this._transformMatrixTexture}Fo(){return this._scene}toString(o){let v=`Name: ${this.name}, nBones: ${this.bones.length}`;if(v+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,o){v+=", Ranges: {";let o=!0;for(const V in this._ranges)o&&(v+=", ",o=!1),v+=V;v+="}"}return v}getBoneIndexByName(o){for(let v=0,V=this.bones.length;v<V;v++)if(this.bones[v].name===o)return v;return-1}createAnimationRange(o,v,V){if(!this._ranges[o]){this._ranges[o]=new l.e(o,v,V);for(let g=0,E=this.bones.length;g<E;g++)this.bones[g].animations[0]&&this.bones[g].animations[0].createRange(o,v,V)}}deleteAnimationRange(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let V=0,g=this.bones.length;V<g;V++)this.bones[V].animations[0]&&this.bones[V].animations[0].deleteRange(o,v);this._ranges[o]=null}getAnimationRange(o){return this._ranges[o]||null}getAnimationRanges(){const o=[];let v;for(v in this._ranges)o.push(this._ranges[v]);return o}copyAnimationRange(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[v]||!o.getAnimationRange(v))return!1;let g=!0;const E=this._getHighestAnimationFrame()+1,I={},Q=o.bones;let U,n;for(n=0,U=Q.length;n<U;n++)I[Q[n].name]=Q[n];this.bones.length!==Q.length&&(T.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Q.length}`),g=!1);const O=V&&this.dimensionsAtRest&&o.dimensionsAtRest?this.dimensionsAtRest.divide(o.dimensionsAtRest):null;for(n=0,U=this.bones.length;n<U;n++){const o=this.bones[n].name,Q=I[o];Q?g=g&&this.bones[n].copyAnimationRange(Q,v,E,V,O):(T.b.Warn("copyAnimationRange: not same rig, missing source bone "+o),g=!1)}const h=o.getAnimationRange(v);return h&&(this._ranges[v]=new l.e(v,h.from+E,h.to+E)),g}returnToRest(){for(const o of this.bones)-1!==o._index&&o.returnToRest()}_getHighestAnimationFrame(){let o=0;for(let v=0,V=this.bones.length;v<V;v++)if(this.bones[v].animations[0]){const V=this.bones[v].animations[0].getHighestFrame();o<V&&(o=V)}return o}beginAnimation(o,v,V,g){const E=this.getAnimationRange(o);return E?this._scene.beginAnimation(this,E.from,E.to,v,V,g):null}static MakeAnimationAdditive(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2?arguments[2]:void 0;const g=o.getAnimationRange(V);if(!g)return null;const E=o._scene.getAllAnimatablesByTarget(o);let I=null;for(let U=0;U<E.length;U++){const o=E[U];if(o.fromFrame===(null===g||void 0===g?void 0:g.from)&&o.toFrame===(null===g||void 0===g?void 0:g.to)){I=o;break}}const Q=o.getAnimatables();for(let U=0;U<Q.length;U++){const o=Q[U].animations;if(o)for(let g=0;g<o.length;g++)f.b.MakeAnimationAdditive(o[g],v,V)}return I&&(I.isAdditive=!0),o}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(o){this._meshesWithPoseMatrix.push(o)}_unregisterMeshWithPoseMatrix(o){const v=this._meshesWithPoseMatrix.indexOf(o);v>-1&&this._meshesWithPoseMatrix.splice(v,1)}_computeTransformMatrices(o,v){this.onBeforeComputeObservable.notifyObservers(this);for(let V=0;V<this.bones.length;V++){const g=this.bones[V];g._childUpdateId++;const E=g.getParent();if(E?g.getLocalMatrix().multiplyToRef(E.getFinalMatrix(),g.getFinalMatrix()):v?g.getLocalMatrix().multiplyToRef(v,g.getFinalMatrix()):g.getFinalMatrix().U(g.getLocalMatrix()),-1!==g._index){const v=null===g._index?V:g._index;g.getAbsoluteInverseBindMatrix().multiplyToArray(g.getFinalMatrix(),o,16*v)}}this._identity.copyToArray(o,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const o=this.Fo().getRenderId();if(this._currentRenderId===o)return;this._currentRenderId=o}if(this._numBonesWithLinkedTransformNode>0)for(const o of this.bones)if(o._linkedTransformNode){const v=o._linkedTransformNode;o.position=v.position,v.rotationQuaternion?o.rotationQuaternion=v.rotationQuaternion:o.rotation=v.rotation,o.jU=v.jU}if(this.needInitialSkinMatrix)for(const o of this._meshesWithPoseMatrix){const v=o.getPoseMatrix();let V=this._isDirty;if(o._bonesTransformMatrices&&o._bonesTransformMatrices.length===16*(this.bones.length+1)||(o._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),V=!0),V){if(this._synchronizedWithMesh!==o){this._synchronizedWithMesh=o;for(const o of this.bones)if(!o.getParent()){o.getBindMatrix().multiplyToRef(v,E.TmpVectors.Matrix[1]),o._updateAbsoluteBindMatrices(E.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const v=4*(this.bones.length+1);o._transformMatrixTexture&&o._transformMatrixTexture.getSize().width===v||(o._transformMatrixTexture&&o._transformMatrixTexture.dispose(),o._transformMatrixTexture=x.e.CreateRGBATexture(o._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(o._bonesTransformMatrices,v),this.isUsingTextureForMatrices&&o._transformMatrixTexture&&o._transformMatrixTexture.update(o._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=x.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let o=0;o<this.bones.length;o++)this._animatables.push(this.bones[o])}return this._animatables}clone(o,v){const V=new R(o,v||o,this._scene);V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let g=0;g<this.bones.length;g++){const o=this.bones[g];let v=null;const E=o.getParent();if(E){const o=this.bones.indexOf(E);v=V.bones[o]}const I=new O.e(o.name,V,v,o.getBindMatrix().clone(),o.getRestMatrix().clone());I._index=o._index,o._linkedTransformNode&&I.linkTransformNode(o._linkedTransformNode),c.b.DeepCopy(o.animations,I.animations)}if(this._ranges){V._ranges={};for(const o in this._ranges){const v=this._ranges[o];v&&(V._ranges[o]=v.clone())}}return this._isDirty=!0,V.prepare(!0),V}enableBlending(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const v of this.bones)for(const V of v.animations)V.enableBlending=!0,V.blendingSpeed=o}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Fo().stopAnimation(this),this.Fo().removeSkeleton(this),this._parentContainer){const o=this._parentContainer.skeletons.indexOf(this);o>-1&&this._parentContainer.skeletons.splice(o,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const o={};o.name=this.name,o.id=this.id,this.dimensionsAtRest&&(o.dimensionsAtRest=this.dimensionsAtRest.Dg()),o.bones=[],o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let V=0;V<this.bones.length;V++){var v;const g=this.bones[V],E=g.getParent(),I={parentBoneIndex:E?this.bones.indexOf(E):-1,index:g.getIndex(),name:g.name,id:g.id,matrix:g.getBindMatrix().Dg(),rest:g.getRestMatrix().Dg(),linkedTransformNodeId:null===(v=g.getTransformNode())||void 0===v?void 0:v.id};o.bones.push(I),g.length&&(I.length=g.length),g.metadata&&(I.metadata=g.metadata),g.animations&&g.animations.length>0&&(I.animation=g.animations[0].serialize()),o.ranges=[];for(const v in this._ranges){const V=this._ranges[v];if(!V)continue;const g={};g.name=v,g.from=V.from,g.to=V.to,o.ranges.push(g)}}return o}static Parse(o,v){const V=new R(o.name,o.id,v);let g;for(o.dimensionsAtRest&&(V.dimensionsAtRest=E.cv.bv(o.dimensionsAtRest)),V.needInitialSkinMatrix=o.needInitialSkinMatrix,g=0;g<o.bones.length;g++){const v=o.bones[g],I=o.bones[g].index;let Q=null;v.parentBoneIndex>-1&&(Q=V.bones[v.parentBoneIndex]);const U=v.rest?E.Matrix.bv(v.rest):null,n=new O.e(v.name,V,Q,E.Matrix.bv(v.matrix),U,null,I);void 0!==v.id&&null!==v.id&&(n.id=v.id),v.length&&(n.length=v.length),v.metadata&&(n.metadata=v.metadata),v.animation&&n.animations.push(f.b.Parse(v.animation)),void 0!==v.linkedTransformNodeId&&null!==v.linkedTransformNodeId&&(V._hasWaitingData=!0,n._waitingTransformNodeId=v.linkedTransformNodeId)}if(o.ranges)for(g=0;g<o.ranges.length;g++){const v=o.ranges[g];V.createAnimationRange(v.name,v.from,v.to)}return V}computeAbsoluteMatrices(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||o)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(o)}getPoseMatrix(){let o=null;return this._meshesWithPoseMatrix.length>0&&(o=this._meshesWithPoseMatrix[0].getPoseMatrix()),o}sortBones(){const o=[],v=new Array(this.bones.length);for(let V=0;V<this.bones.length;V++)this._sortBones(V,o,v);this.bones=o}_sortBones(o,v,V){if(V[o])return;V[o]=!0;const g=this.bones[o];if(!g)return;void 0===g._index&&(g._index=o);const E=g.getParent();E&&this._sortBones(this.bones.indexOf(E),v,V),v.push(g)}setCurrentPoseAsRest(){for(const o of this.bones)o.setCurrentPoseAsRest()}}var j=V(12829),t=V(13011),s=V(12471),L=V(12928),b=V(12577),u=V(12970),mo=V(12936),a=V(12958),F=V(13047),i=V(12593),J=V(14131);class d{set areUpdatesFrozen(o){o?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,o||(o=S.d.LastCreatedScene),this._scene=o,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const o=this._scene.getEngine().getCaps();this._canUseTextureForTargets=o.canUseGLVertexID&&o.textureFloat&&o.maxVertexTextureImageUnits>0&&o.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return d.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?d.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(o){this._numMaxInfluencers!==o&&(this._numMaxInfluencers=o,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(o){this._useTextureToStoreTargets!==o&&(this._useTextureToStoreTargets=o,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var o;return d.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(o=this._scene)&&void 0!==o&&o.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(o){return this._activeTargets.data[o]}getTarget(o){return this._targets[o]}getTargetByName(o){for(const v of this._targets)if(v.name===o)return v;return null}addTarget(o){this._targets.push(o),this._targetInfluenceChangedObservers.push(o.onInfluenceChanged.add((o=>{this.areUpdatesFrozen&&o&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(o)}))),this._targetDataLayoutChangedObservers.push(o._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(o){const v=this._targets.indexOf(o);v>=0&&(this._targets.splice(v,1),o.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(v,1)[0]),o._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(v,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(o)}_bind(o){o.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),o.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),o.setTexture("morphTargets",this._targetStoreTexture),o.setInt("morphTargetCount",this.numInfluencers)}clone(){const o=new d(this._scene);for(const v of this._targets)o.addTarget(v.clone());return o.enablePositionMorphing=this.enablePositionMorphing,o.enableNormalMorphing=this.enableNormalMorphing,o.enableTangentMorphing=this.enableTangentMorphing,o.enableUVMorphing=this.enableUVMorphing,o.enableUV2Morphing=this.enableUV2Morphing,o.enableColorMorphing=this.enableColorMorphing,o}serialize(){const o={};o.id=this.uniqueId,o.targets=[];for(const v of this._targets)o.targets.push(v.serialize());return o}_syncActiveTargets(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const v=!!this._targetStoreTexture,V=this.isUsingTextureForTargets;(this._mustSynchronize||v!==V)&&(this._mustSynchronize=!1,this.synchronize());let g=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let E=-1;for(const I of this._targets)if(E++,0!==I.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=d.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(I),this._morphTargetTextureIndices[g]=E,this._tempInfluences[g++]=I.influence}this._morphTargetTextureIndices.length!==g&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,g)),this._influences&&this._influences.length===g||(this._influences=new Float32Array(g));for(let I=0;I<g;I++)this._influences[I]=this._tempInfluences[I];if(o&&this._scene)for(const I of this._scene.meshes)I.morphTargetManager===this&&(V?I._markSubMeshesAsAttributesDirty():I._syncGeometryWithMorphTargetManager())}synchronize(){var o;if(!this._scene||this.areUpdatesFrozen)return;const v=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(o=this._targetStoreTexture)||void 0===o||o.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>v.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const V of this._targets){this._supportsPositions=this._supportsPositions&&V.hasPositions,this._supportsNormals=this._supportsNormals&&V.hasNormals,this._supportsTangents=this._supportsTangents&&V.hasTangents,this._supportsUVs=this._supportsUVs&&V.hasUVs,this._supportsUV2s=this._supportsUV2s&&V.hasUV2s,this._supportsColors=this._supportsColors&&V.hasColors;const o=V.vertexCount;if(0===this._vertexCount)this._vertexCount=o;else if(this._vertexCount!==o)return void T.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${V.name}": ${o}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const o=v.getCaps().maxTextureSize;this._textureWidth>o&&(this._textureHeight=Math.ceil(this._textureWidth/o),this._textureWidth=o);const V=this._targets.length,g=new Float32Array(V*this._textureWidth*this._textureHeight*4);let E=0;for(let v=0;v<V;v++){const o=this._targets[v],V=o.getPositions(),I=o.getNormals(),Q=o.getUVs(),U=o.getTangents(),n=o.getUV2s(),O=o.getColors();E=v*this._textureWidth*this._textureHeight*4;for(let v=0;v<this._vertexCount;v++)this._supportsPositions&&V&&(g[E]=V[3*v],g[E+1]=V[3*v+1],g[E+2]=V[3*v+2],E+=4),this._supportsNormals&&I&&(g[E]=I[3*v],g[E+1]=I[3*v+1],g[E+2]=I[3*v+2],E+=4),this._supportsUVs&&Q&&(g[E]=Q[2*v],g[E+1]=Q[2*v+1],E+=4),this._supportsTangents&&U&&(g[E]=U[3*v],g[E+1]=U[3*v+1],g[E+2]=U[3*v+2],E+=4),this._supportsUV2s&&n&&(g[E]=n[2*v],g[E+1]=n[2*v+1],E+=4),this._supportsColors&&O&&(g[E]=O[4*v],g[E+1]=O[4*v+1],g[E+2]=O[4*v+2],g[E+3]=O[4*v+3],E+=4)}this._targetStoreTexture=J.c.CreateRGBATexture(g,this._textureWidth,this._textureHeight,V,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const V of this._scene.meshes)V.morphTargetManager===this&&V._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const o=this._parentContainer.morphTargetManagers.indexOf(this);o>-1&&this._parentContainer.morphTargetManagers.splice(o,1),this._parentContainer=null}for(const o of this._targets)this._scene.stopAnimation(o)}}static Parse(o,v){const V=new d(v);for(const g of o.targets)V.addTarget(F.d.Parse(g,v));return V}}d.EnableTextureStorage=!0,d.MaxActiveMorphTargetsInVertexAttributeMode=8,d.ConstantTargetCountForTextureMode=0;var N=V(14175),Y=V(12347),q=V(12852);const P=new Map,M=P;function W(o,v,V){w(o)&&T.b.Warn(`Extension with the name '${o}' already exists`),P.set(o,{isGLTFExtension:v,factory:V})}function w(o){return P.delete(o)}var z=V(14183),y=V(13096),H=V(12585);class e{static Get(o,v,V){if(!v||void 0==V||!v[V])throw new Error(`${o}: Failed to find index (${V})`);return v[V]}static TryGet(o,v){return o&&void 0!=v&&o[v]?o[v]:null}static Assign(o){if(o)for(let v=0;v<o.length;v++)o[v].index=v}}function D(o){if(o.min&&o.max){const v=o.min,V=o.max,g=E.TmpVectors.cv[0].RU(v[0],v[1],v[2]),I=E.TmpVectors.cv[1].RU(V[0],V[1],V[2]);if(o.normalized&&5126!==o.componentType){let v=1;switch(o.componentType){case 5120:v=127;break;case 5121:v=255;break;case 5122:v=32767;break;case 5123:v=65535}const V=1/v;g.scaleInPlace(V),I.scaleInPlace(V)}return new q.c(g,I)}return null}class Z{static RegisterExtension(o,v){W(o,!1,v)}static UnregisterExtension(o){return w(o)}get Ng(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(o){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=o}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((o=>o.dispose&&o.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(o,v,V,g,E,I){let Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=v,this._assetContainer=V,this._loadData(g);let I=null;if(o){const v={};if(this._gltf.nodes)for(const o of this._gltf.nodes)o.name&&(v[o.name]=o.index);I=(o instanceof Array?o:[o]).map((o=>{const V=v[o];if(void 0===V)throw new Error(`Failed to find node '${o}'`);return V}))}return await this._loadAsync(E,Q,I,(()=>({meshes:this._getMeshes(),Mf:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=o,this._loadData(v),await this._loadAsync(V,E,null,(()=>{}))}async _loadAsync(o,v,V,g){return await Promise.resolve().then((async()=>{this._rootUrl=o,this._uniqueRootUrl=!o.startsWith("file:")&&v?o:`${o}${Date.now()}/`,this._fileName=v,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const E=`${N.l[N.l.LOADING]} => ${N.l[N.l.READY]}`,I=`${N.l[N.l.LOADING]} => ${N.l[N.l.COMPLETE]}`;this._parent._startPerformanceCounter(E),this._parent._startPerformanceCounter(I),this._parent._setState(N.l.LOADING),this._extensionsOnLoading();const U=new Array;if(!this.parent.loadOnlyMaterials)if(V)U.push(this.loadSceneAsync("/nodes",{nodes:V,index:-1}));else if(void 0!=this._gltf.jv||this._gltf.scenes&&this._gltf.scenes[0]){const o=e.Get("/scene",this._gltf.scenes,this._gltf.jv||0);U.push(this.loadSceneAsync(`/scenes/${o.index}`,o))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let o=0;o<this._gltf.materials.length;++o){const v=this._gltf.materials[o],V="/materials/"+o,g=j.e.TriangleFillMode;U.push(this._loadMaterialAsync(V,v,null,g,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&U.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&U.push(this._compileShadowGeneratorsAsync());const n=Promise.all(U).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.eU(!0);for(const o of this._babylonScene.materials){const v=o;void 0!==v.maxSimultaneousLights&&(v.maxSimultaneousLights=Math.max(v.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(N.l.READY),this._skipStartAnimationStep||this._startAnimations(),g()}));return await n.then((o=>(this._parent._endPerformanceCounter(E),Q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(I),this._parent._setState(N.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(o=>{this._parent.onErrorObservable.notifyObservers(o),this._parent.onErrorObservable.clear(),this.dispose()}))})),o)))})).catch((o=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(o),this._parent.onErrorObservable.clear(),this.dispose()),o}))}_loadData(o){if(this._gltf=o.json,this._setupData(),o.bin){const v=this._gltf.buffers;if(v&&v[0]&&!v[0].uri){const V=v[0];(V.byteLength<o.bin.byteLength-3||V.byteLength>o.bin.byteLength)&&T.b.Warn(`Binary buffer length (${V.byteLength}) from JSON does not match chunk length (${o.bin.byteLength})`),this._bin=o.bin}else T.b.Warn("Unexpected BIN chunk")}}_setupData(){if(e.Assign(this._gltf.accessors),e.Assign(this._gltf.animations),e.Assign(this._gltf.buffers),e.Assign(this._gltf.bufferViews),e.Assign(this._gltf.cameras),e.Assign(this._gltf.images),e.Assign(this._gltf.materials),e.Assign(this._gltf.meshes),e.Assign(this._gltf.nodes),e.Assign(this._gltf.samplers),e.Assign(this._gltf.scenes),e.Assign(this._gltf.skins),e.Assign(this._gltf.textures),this._gltf.nodes){const o={};for(const V of this._gltf.nodes)if(V.children)for(const v of V.children)o[v]=V.index;const v=this._createRootNode();for(const V of this._gltf.nodes){const g=o[V.index];V.parent=void 0===g?v:this._gltf.nodes[g]}}}async _loadExtensionsAsync(){const o=[];if(M.forEach(((v,V)=>{var g;!1===(null===(g=this.parent.extensionOptions[V])||void 0===g?void 0:g.enabled)?v.isGLTFExtension&&this.isExtensionUsed(V)&&T.b.Warn(`Extension ${V} is used but has been explicitly disabled.`):v.isGLTFExtension&&!this.isExtensionUsed(V)||o.push((async()=>{const o=await v.factory(this);return o.name!==V&&T.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${o.name} !== ${V}`),this._parent.onExtensionLoadedObservable.notifyObservers(o),o})())})),this._extensions.push(...await Promise.all(o)),this._extensions.sort(((o,v)=>(o.order||Number.MAX_VALUE)-(v.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const V of this._gltf.extensionsRequired){if(!this._extensions.some((o=>o.name===V&&o.enabled))){var v;if(!1===(null===(v=this.parent.extensionOptions[V])||void 0===v?void 0:v.enabled))throw new Error(`Required extension ${V} is disabled`);throw new Error(`Required extension ${V} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new a.e("__root__",this._babylonScene);this._rootBabylonMesh=o,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.eU(!1);const v={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case N.i.AUTO:this._babylonScene.useRightHandedSystem||(v.rotation=[0,1,0,0],v.scale=[1,1,-1],Z._LoadTransform(v,this._rootBabylonMesh));break;case N.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(o),v}loadSceneAsync(o,v){const V=this._extensionsLoadSceneAsync(o,v);if(V)return V;const g=new Array;if(this.logOpen(`${o} ${v.name||""}`),v.nodes)for(const E of v.nodes){const v=e.Get(`${o}/nodes/${E}`,this._gltf.nodes,E);g.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(o=>{o.parent=this._rootBabylonMesh})))}for(const E of this._postSceneLoadActions)E();return g.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(g).then((()=>{}))}_forEachPrimitive(o,v){if(o._primitiveBabylonMeshes)for(const V of o._primitiveBabylonMeshes)v(V)}_getGeometries(){const o=[],v=this._gltf.nodes;if(v)for(const V of v)this._forEachPrimitive(V,(v=>{const V=v.kg;V&&-1===o.indexOf(V)&&o.push(V)}));return o}_getMeshes(){const o=[];this._rootBabylonMesh instanceof mo.d&&o.push(this._rootBabylonMesh);const v=this._gltf.nodes;if(v)for(const V of v)this._forEachPrimitive(V,(v=>{o.push(v)}));return o}_getTransformNodes(){const o=[],v=this._gltf.nodes;if(v)for(const V of v)V._babylonTransformNode&&"Qh"===V._babylonTransformNode.getClassName()&&o.push(V._babylonTransformNode),V._babylonTransformNodeForSkin&&o.push(V._babylonTransformNodeForSkin);return o}_getSkeletons(){const o=[],v=this._gltf.skins;if(v)for(const V of v)V._data&&o.push(V._data.babylonSkeleton);return o}_getAnimationGroups(){const o=[],v=this._gltf.animations;if(v)for(const V of v)V._babylonAnimationGroup&&o.push(V._babylonAnimationGroup);return o}_startAnimations(){switch(this._parent.animationStartMode){case N.f.NONE:break;case N.f.FIRST:{const o=this._getAnimationGroups();0!==o.length&&o[0].start(!0);break}case N.f.ALL:{const o=this._getAnimationGroups();for(const v of o)v.start(!0);break}default:return void T.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const g=this._extensionsLoadNodeAsync(o,v,V);if(g)return g;if(v._babylonTransformNode)throw new Error(`${o}: Invalid recursive node hierarchy`);const E=new Array;this.logOpen(`${o} ${v.name||""}`);const I=g=>{if(Z.AddPointerMetadata(g,o),Z._LoadTransform(v,g),void 0!=v.camera){const V=e.Get(`${o}/camera`,this._gltf.cameras,v.camera);E.push(this.loadCameraAsync(`/cameras/${V.index}`,V,(o=>{o.parent=g,this._babylonScene.useRightHandedSystem||(g.jU.x=-1)})))}if(v.children)for(const V of v.children){const v=e.Get(`${o}/children/${V}`,this._gltf.nodes,V);E.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(o=>{o.parent=g})))}V(g)},Q=void 0!=v.mesh,U=this._parent.loadSkins&&void 0!=v.skin;if(!Q||U){const o=v.name||`node${v.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new L.b(o,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==v.mesh?v._babylonTransformNode=V:v._babylonTransformNodeForSkin=V,I(V)}if(Q)if(U){const V=e.Get(`${o}/mesh`,this._gltf.meshes,v.mesh);E.push(this._loadMeshAsync(`/meshes/${V.index}`,v,V,(V=>{const g=v._babylonTransformNodeForSkin;V.metadata=(0,y.c)(g.metadata,V.metadata||{});const I=e.Get(`${o}/skin`,this._gltf.skins,v.skin);E.push(this._loadSkinAsync(`/skins/${I.index}`,v,I,(o=>{this._forEachPrimitive(v,(v=>{v.skeleton=o})),this._postSceneLoadActions.push((()=>{if(void 0!=I.skeleton){const o=e.Get(`/skins/${I.index}/skeleton`,this._gltf.nodes,I.skeleton).parent;v.index===o.index?V.parent=g.parent:V.parent=o._babylonTransformNode}else V.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:g,skinnedNode:V})}))})))})))}else{const V=e.Get(`${o}/mesh`,this._gltf.meshes,v.mesh);E.push(this._loadMeshAsync(`/meshes/${V.index}`,v,V,I))}return this.logClose(),Promise.all(E).then((()=>(this._forEachPrimitive(v,(o=>{const v=o;!v.isAnInstance&&v.kg&&v.kg.useBoundingInfoFromGeometry?o.Wo():o.refreshBoundingInfo(!0,!0)})),v._babylonTransformNode)))}_loadMeshAsync(o,v,V,g){const E=V.primitives;if(!E||!E.length)throw new Error(`${o}: Primitives are missing`);void 0==E[0].index&&e.Assign(E);const I=new Array;this.logOpen(`${o} ${V.name||""}`);const Q=v.name||`node${v.index}`;if(1===E.length){const g=V.primitives[0];I.push(this._loadMeshPrimitiveAsync(`${o}/primitives/${g.index}`,Q,v,V,g,(o=>{v._babylonTransformNode=o,v._primitiveBabylonMeshes=[o]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,v._babylonTransformNode=new L.b(Q,this._babylonScene),v._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._primitiveBabylonMeshes=[];for(const g of E)I.push(this._loadMeshPrimitiveAsync(`${o}/primitives/${g.index}`,`${Q}_primitive${g.index}`,v,V,g,(o=>{o.parent=v._babylonTransformNode,v._primitiveBabylonMeshes.push(o)})))}return g(v._babylonTransformNode),this.logClose(),Promise.all(I).then((()=>v._babylonTransformNode))}_loadMeshPrimitiveAsync(o,v,V,g,E,I){const Q=this._extensionsLoadMeshPrimitiveAsync(o,v,V,g,E,I);if(Q)return Q;this.logOpen(`${o}`);const U=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==V.skin&&!g.primitives[0].targets;let n,O;if(U&&E._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,n=E._instanceData.babylonSourceMesh.createInstance(v),n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O=E._instanceData.promise;else{const I=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new a.e(v,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.sideOrientation=this._babylonScene.useRightHandedSystem?j.e.CounterClockWiseSideOrientation:j.e.ClockWiseSideOrientation,this._createMorphTargets(o,V,g,E,Q),I.push(this._loadVertexDataAsync(o,E,Q).then((async v=>await this._loadMorphTargetsAsync(o,E,Q,v).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,v.Po(Q),v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=Z._GetDrawMode(o,E.mode);if(void 0==E.material){let o=this._defaultBabylonMaterialData[h];o||(o=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(o),this._defaultBabylonMaterialData[h]=o),Q.material=o}else if(!this.parent.skipMaterials){const v=e.Get(`${o}/material`,this._gltf.materials,E.material);I.push(this._loadMaterialAsync(`/materials/${v.index}`,v,Q,h,(o=>{Q.material=o})))}O=Promise.all(I),U&&(E._instanceData={babylonSourceMesh:Q,promise:O}),n=Q}return Z.AddPointerMetadata(n,o),this._parent.onMeshLoadedObservable.notifyObservers(n),I(n),this.logClose(),O.then((()=>n))}_loadVertexDataAsync(o,v,V){const g=this._extensionsLoadVertexDataAsync(o,v,V);if(g)return g;const E=v.attributes;if(!E)throw new Error(`${o}: Attributes are missing`);const I=new Array,Q=new u.e(V.name,this._babylonScene);if(void 0==v.indices)V.isUnIndexed=!0;else{const V=e.Get(`${o}/indices`,this._gltf.accessors,v.indices);I.push(this._loadIndicesAccessorAsync(`/accessors/${V.index}`,V).then((o=>{Q.setIndices(o)})))}const U=(v,g,U)=>{if(void 0==E[v])return;V._delayInfo=V._delayInfo||[],-1===V._delayInfo.indexOf(g)&&V._delayInfo.push(g);const n=e.Get(`${o}/attributes/${v}`,this._gltf.accessors,E[v]);I.push(this._loadVertexAccessorAsync(`/accessors/${n.index}`,n,g).then((o=>{if(o.getKind()===b.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!V.skeleton){const o=D(n);o&&(Q._boundingInfo=o,Q.useBoundingInfoFromGeometry=!0)}Q.setVerticesBuffer(o,n.count)}))),g==b.e.MatricesIndicesExtraKind&&(V.numBoneInfluencers=8),U&&U(n)};return U("POSITION",b.e.PositionKind),U("NORMAL",b.e.NormalKind),U("TANGENT",b.e.TangentKind),U("TEXCOORD_0",b.e.UVKind),U("TEXCOORD_1",b.e.UV2Kind),U("TEXCOORD_2",b.e.UV3Kind),U("TEXCOORD_3",b.e.UV4Kind),U("TEXCOORD_4",b.e.UV5Kind),U("TEXCOORD_5",b.e.UV6Kind),U("JOINTS_0",b.e.MatricesIndicesKind),U("WEIGHTS_0",b.e.MatricesWeightsKind),U("JOINTS_1",b.e.MatricesIndicesExtraKind),U("WEIGHTS_1",b.e.MatricesWeightsExtraKind),U("COLOR_0",b.e.ColorKind,(o=>{"VEC4"===o.type&&(V.hasVertexAlpha=!0)})),Promise.all(I).then((()=>Q))}_createMorphTargets(o,v,V,g,E){if(!g.targets||!this._parent.loadMorphTargets)return;if(void 0==v._numMorphTargets)v._numMorphTargets=g.targets.length;else if(g.targets.length!==v._numMorphTargets)throw new Error(`${o}: Primitives do not have the same number of targets`);const I=V.extras?V.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,E.morphTargetManager=new d(this._babylonScene),E.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.morphTargetManager.areUpdatesFrozen=!0;for(let Q=0;Q<g.targets.length;Q++){const o=v.weights?v.weights[Q]:V.weights?V.weights[Q]:0,g=I?I[Q]:`morphTarget${Q}`;E.morphTargetManager.addTarget(new F.d(g,o,E.Fo()))}}_loadMorphTargetsAsync(o,v,V,g){if(!v.targets||!this._parent.loadMorphTargets)return Promise.resolve();const E=new Array,I=V.morphTargetManager;for(let Q=0;Q<I.numTargets;Q++){const V=I.getTarget(Q);E.push(this._loadMorphTargetVertexDataAsync(`${o}/targets/${Q}`,g,v.targets[Q],V))}return Promise.all(E).then((()=>{I.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(o,v,V,g){const E=new Array,I=(g,I,Q)=>{if(void 0==V[g])return;const U=v.getVertexBuffer(I);if(!U)return;const n=e.Get(`${o}/${g}`,this._gltf.accessors,V[g]);E.push(this._loadFloatAccessorAsync(`/accessors/${n.index}`,n).then((o=>{Q(U,o)})))};return I("POSITION",b.e.PositionKind,((o,v)=>{const V=new Float32Array(v.length);o.forEach(v.length,((o,g)=>{V[g]=v[g]+o})),g.setPositions(V)})),I("NORMAL",b.e.NormalKind,((o,v)=>{const V=new Float32Array(v.length);o.forEach(V.length,((o,g)=>{V[g]=v[g]+o})),g.setNormals(V)})),I("TANGENT",b.e.TangentKind,((o,v)=>{const V=new Float32Array(v.length/3*4);let E=0;o.forEach(v.length/3*4,((o,g)=>{(g+1)%4!==0&&(V[E]=v[E]+o,E++)})),g.setTangents(V)})),I("TEXCOORD_0",b.e.UVKind,((o,v)=>{const V=new Float32Array(v.length);o.forEach(v.length,((o,g)=>{V[g]=v[g]+o})),g.setUVs(V)})),I("TEXCOORD_1",b.e.UV2Kind,((o,v)=>{const V=new Float32Array(v.length);o.forEach(v.length,((o,g)=>{V[g]=v[g]+o})),g.setUV2s(V)})),I("COLOR_0",b.e.ColorKind,((v,V)=>{let E=null;const I=v.getSize();if(3===I){E=new Float32Array(V.length/3*4),v.forEach(V.length,((o,v)=>{const g=Math.floor(v/3),I=v%3;E[4*g+I]=V[3*g+I]+o}));for(let o=0;o<V.length/3;++o)E[4*o+3]=1}else{if(4!==I)throw new Error(`${o}: Invalid number of components (${I}) for COLOR_0 attribute`);E=new Float32Array(V.length),v.forEach(V.length,((o,v)=>{E[v]=V[v]+o}))}g.setColors(E)})),await Promise.all(E).then((()=>{}))}static _LoadTransform(o,v){if(void 0!=o.skin)return;let V=E.cv.Zero(),g=E.Quaternion.Identity(),I=E.cv.One();if(o.matrix){E.Matrix.bv(o.matrix).decompose(I,g,V)}else o.translation&&(V=E.cv.bv(o.translation)),o.rotation&&(g=E.Quaternion.bv(o.rotation)),o.scale&&(I=E.cv.bv(o.scale));v.position=V,v.rotationQuaternion=g,v.jU=I}_loadSkinAsync(o,v,V,g){if(!this._parent.loadSkins)return Promise.resolve();const E=this._extensionsLoadSkinAsync(o,v,V);if(E)return E;if(V._data)return g(V._data.babylonSkeleton),V._data.promise;const I=`skeleton${V.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new R(V.name||I,I,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(o,V,Q);const U=this._loadSkinInverseBindMatricesDataAsync(o,V).then((o=>{this._updateBoneMatrices(Q,o)}));return V._data={babylonSkeleton:Q,promise:U},g(Q),U}_loadBones(o,v,V){if(void 0==v.skeleton||this._parent.alwaysComputeSkeletonRootNode){const V=this._findSkeletonRootNode(`${o}/joints`,v.joints);if(V)if(void 0===v.skeleton)v.skeleton=V.index;else{const g=(o,v)=>{for(;v.parent;v=v.parent)if(v.parent===o)return!0;return!1},E=e.Get(`${o}/skeleton`,this._gltf.nodes,v.skeleton);E===V||g(E,V)||(T.b.Warn(`${o}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),v.skeleton=V.index)}else T.b.Warn(`${o}: Failed to find common root`)}const g={};for(const E of v.joints){const I=e.Get(`${o}/joints/${E}`,this._gltf.nodes,E);this._loadBone(I,v,V,g)}}_findSkeletonRootNode(o,v){if(0===v.length)return null;const V={};for(const E of v){const v=[];let g=e.Get(`${o}/${E}`,this._gltf.nodes,E);for(;-1!==g.index;)v.unshift(g),g=g.parent;V[E]=v}let g=null;for(let E=0;;++E){let o=V[v[0]];if(E>=o.length)return g;const I=o[E];for(let Q=1;Q<v.length;++Q)if(o=V[v[Q]],E>=o.length||I!==o[E])return g;g=I}}_loadBone(o,v,V,g){o._isJoint=!0;let E=g[o.index];if(E)return E;let I=null;o.index!==v.skeleton&&(o.parent&&-1!==o.parent.index?I=this._loadBone(o.parent,v,V,g):void 0!==v.skeleton&&T.b.Warn(`/skins/${v.index}/skeleton: Skeleton node is not a common root`));const Q=v.joints.indexOf(o.index);return E=new O.e(o.name||`joint${o.index}`,V,I,this._getNodeMatrix(o),null,null,Q),g[o.index]=E,this._postSceneLoadActions.push((()=>{E.linkTransformNode(o._babylonTransformNode)})),E}_loadSkinInverseBindMatricesDataAsync(o,v){if(void 0==v.inverseBindMatrices)return Promise.resolve(null);const V=e.Get(`${o}/inverseBindMatrices`,this._gltf.accessors,v.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${V.index}`,V)}_updateBoneMatrices(o,v){for(const V of o.bones){const o=E.Matrix.Identity(),g=V._index;v&&-1!==g&&(E.Matrix.FromArrayToRef(v,16*g,o),o.invertToRef(o));const I=V.getParent();I&&o.multiplyToRef(I.getAbsoluteInverseBindMatrix(),o),V.Bg(o,!1,!1),V._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(o){return o.matrix?E.Matrix.bv(o.matrix):E.Matrix.Compose(o.scale?E.cv.bv(o.scale):E.cv.One(),o.rotation?E.Quaternion.bv(o.rotation):E.Quaternion.Identity(),o.translation?E.cv.bv(o.translation):E.cv.Zero())}loadCameraAsync(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const g=this._extensionsLoadCameraAsync(o,v,V);if(g)return g;const I=new Array;this.logOpen(`${o} ${v.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new n.d(v.name||`camera${v.index}`,E.cv.Zero(),this._babylonScene,!1);switch(Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonCamera=Q,Q.setTarget(new E.cv(0,0,-1)),v.type){case"perspective":{const V=v.perspective;if(!V)throw new Error(`${o}: Camera perspective properties are missing`);Q.fov=V.yfov,Q.Xg=V.znear,Q.maxZ=V.zfar||0;break}case"orthographic":if(!v.orthographic)throw new Error(`${o}: Camera orthographic properties are missing`);Q.mode=U.e.ORTHOGRAPHIC_CAMERA,Q.orthoLeft=-v.orthographic.xmag,Q.orthoRight=v.orthographic.xmag,Q.orthoBottom=-v.orthographic.ymag,Q.orthoTop=v.orthographic.ymag,Q.Xg=v.orthographic.znear,Q.maxZ=v.orthographic.zfar;break;default:throw new Error(`${o}: Invalid camera type (${v.type})`)}return Z.AddPointerMetadata(Q,o),this._parent.onCameraLoadedObservable.notifyObservers(Q),V(Q),this.logClose(),Promise.all(I).then((()=>Q))}_loadAnimationsAsync(){const o=this._gltf.animations;if(!o)return Promise.resolve();const v=new Array;for(let V=0;V<o.length;V++){const g=o[V];v.push(this.loadAnimationAsync(`/animations/${g.index}`,g).then((o=>{0===o.targetedAnimations.length&&o.dispose()})))}return Promise.all(v).then((()=>{}))}loadAnimationAsync(o,v){const g=this._extensionsLoadAnimationAsync(o,v);return g||V.e(78).then(V.bind(V,15670)).then((V=>{let{AnimationGroup:g}=V;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new g(v.name||`animation${v.index}`,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonAnimationGroup=E;const I=new Array;e.Assign(v.channels),e.Assign(v.samplers);for(const Q of v.channels)I.push(this._loadAnimationChannelAsync(`${o}/channels/${Q.index}`,o,v,Q,((o,v)=>{o.animations=o.animations||[],o.animations.push(v),E.addTargetedAnimation(v,o)})));return Promise.all(I).then((()=>(E.normalize(0),E)))}))}async _loadAnimationChannelAsync(o,v,g,E,I){const Q=this._extensionsLoadAnimationChannelAsync(o,v,g,E,I);if(Q)return await Q;if(void 0==E.target.node)return await Promise.resolve();const U=e.Get(`${o}/target/node`,this._gltf.nodes,E.target.node),n=E.target.path,O="weights"===n;if(O&&!U._numMorphTargets||!O&&!U._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!O&&!U._isJoint)return await Promise.resolve();let h;switch(await Promise.resolve().then(V.bind(V,14197)),n){case"translation":var x;h=null===(x=(0,z.i)("/nodes/{}/translation"))||void 0===x?void 0:x.interpolation;break;case"rotation":var f;h=null===(f=(0,z.i)("/nodes/{}/rotation"))||void 0===f?void 0:f.interpolation;break;case"scale":var l;h=null===(l=(0,z.i)("/nodes/{}/scale"))||void 0===l?void 0:l.interpolation;break;case"weights":var S;h=null===(S=(0,z.i)("/nodes/{}/weights"))||void 0===S?void 0:S.interpolation;break;default:throw new Error(`${o}/target/path: Invalid value (${E.target.path})`)}if(!h)throw new Error(`${o}/target/path: Could not find interpolation properties for target path (${E.target.path})`);const T={object:U,info:h};return await this._loadAnimationChannelFromTargetInfoAsync(o,v,g,E,T,I)}_loadAnimationChannelFromTargetInfoAsync(o,v,V,g,E,I){const Q=this.parent.targetFps,U=1/Q,n=e.Get(`${o}/sampler`,V.samplers,g.sampler);return this._loadAnimationSamplerAsync(`${v}/samplers/${g.sampler}`,n).then((o=>{let v=0;const n=E.object,O=E.info;for(const E of O){const O=E.getStride(n),h=o.input,x=o.output,f=new Array(h.length);let l=0;switch(o.interpolation){case"STEP":for(let o=0;o<h.length;o++){const v=E.getValue(n,x,l,1);l+=O,f[o]={frame:h[o]*Q,value:v,interpolation:1}}break;case"CUBICSPLINE":for(let o=0;o<h.length;o++){const v=E.getValue(n,x,l,U);l+=O;const V=E.getValue(n,x,l,1);l+=O;const g=E.getValue(n,x,l,U);l+=O,f[o]={frame:h[o]*Q,inTangent:v,value:V,outTangent:g}}break;case"LINEAR":for(let o=0;o<h.length;o++){const v=E.getValue(n,x,l,1);l+=O,f[o]={frame:h[o]*Q,value:v}}}if(l>0){const o=`${V.name||`animation${V.index}`}_channel${g.index}_${v}`,U=E.buildAnimations(n,o,Q,f);for(const V of U)v++,I(V.babylonAnimatable,V.babylonAnimation)}}}))}_loadAnimationSamplerAsync(o,v){if(v._data)return v._data;const V=v.interpolation||"LINEAR";switch(V){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${o}/interpolation: Invalid value (${v.interpolation})`)}const g=e.Get(`${o}/input`,this._gltf.accessors,v.input),E=e.Get(`${o}/output`,this._gltf.accessors,v.output);return v._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${g.index}`,g),this._loadFloatAccessorAsync(`/accessors/${E.index}`,E)]).then((o=>{let[v,g]=o;return{input:v,interpolation:V,output:g}})),v._data}loadBufferAsync(o,v,V,g){const E=this._extensionsLoadBufferAsync(o,v,V,g);if(E)return E;if(!v._data)if(v.uri)v._data=this.loadUriAsync(`${o}/uri`,v,v.uri);else{if(!this._bin)throw new Error(`${o}: Uri is missing or the binary glTF is missing its binary chunk`);v._data=this._bin.readAsync(0,v.byteLength)}return v._data.then((v=>{try{return new Uint8Array(v.buffer,v.byteOffset+V,g)}catch(E){throw new Error(`${o}: ${E.message}`)}}))}loadBufferViewAsync(o,v){const V=this._extensionsLoadBufferViewAsync(o,v);if(V)return V;if(v._data)return v._data;const g=e.Get(`${o}/buffer`,this._gltf.buffers,v.buffer);return v._data=this.loadBufferAsync(`/buffers/${g.index}`,g,v.byteOffset||0,v.byteLength),v._data}_loadAccessorAsync(o,v,V){if(v._data)return v._data;const g=Z._GetNumComponents(o,v.type),E=g*b.e.GetTypeByteLength(v.componentType),I=g*v.count;if(void 0==v.bufferView)v._data=Promise.resolve(new V(I));else{const Q=e.Get(`${o}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((U=>{if(5126!==v.componentType||v.normalized||Q.byteStride&&Q.byteStride!==E){const o=new V(I);return b.e.ForEach(U,v.byteOffset||0,Q.byteStride||E,g,v.componentType,o.length,v.normalized||!1,((v,V)=>{o[V]=v})),o}return Z._GetTypedArray(o,v.componentType,U,v.byteOffset,I)}))}if(v.sparse){const I=v.sparse;v._data=v._data.then((Q=>{const U=Q,n=e.Get(`${o}/sparse/indices/bufferView`,this._gltf.bufferViews,I.indices.bufferView),O=e.Get(`${o}/sparse/values/bufferView`,this._gltf.bufferViews,I.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${n.index}`,n),this.loadBufferViewAsync(`/bufferViews/${O.index}`,O)]).then((Q=>{let[n,O]=Q;const h=Z._GetTypedArray(`${o}/sparse/indices`,I.indices.componentType,n,I.indices.byteOffset,I.count),x=g*I.count;let f;if(5126!==v.componentType||v.normalized){const Q=Z._GetTypedArray(`${o}/sparse/values`,v.componentType,O,I.values.byteOffset,x);f=new V(x),b.e.ForEach(Q,0,E,g,v.componentType,f.length,v.normalized||!1,((o,v)=>{f[v]=o}))}else f=Z._GetTypedArray(`${o}/sparse/values`,v.componentType,O,I.values.byteOffset,x);let l=0;for(let o=0;o<h.length;o++){let v=h[o]*g;for(let o=0;o<g;o++)U[v++]=f[l++]}return U}))}))}return v._data}_loadFloatAccessorAsync(o,v){return this._loadAccessorAsync(o,v,Float32Array)}_loadIndicesAccessorAsync(o,v){if("SCALAR"!==v.type)throw new Error(`${o}/type: Invalid value ${v.type}`);if(5121!==v.componentType&&5123!==v.componentType&&5125!==v.componentType)throw new Error(`${o}/componentType: Invalid value ${v.componentType}`);if(v._data)return v._data;if(v.sparse){const V=Z._GetTypedArrayConstructor(`${o}/componentType`,v.componentType);v._data=this._loadAccessorAsync(o,v,V)}else{const V=e.Get(`${o}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>Z._GetTypedArray(o,v.componentType,V,v.byteOffset,v.count)))}return v._data}_loadVertexBufferViewAsync(o){if(o._babylonBuffer)return o._babylonBuffer;const v=this._babylonScene.getEngine();return o._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((o=>new b.b(v,o,!1))),o._babylonBuffer}_loadVertexAccessorAsync(o,v,V){var g;if(null!==(g=v._babylonVertexBuffer)&&void 0!==g&&g[V])return v._babylonVertexBuffer[V];v._babylonVertexBuffer||(v._babylonVertexBuffer={});const E=this._babylonScene.getEngine();if(v.sparse||void 0==v.bufferView)v._babylonVertexBuffer[V]=this._loadFloatAccessorAsync(o,v).then((o=>new b.e(E,o,V,!1)));else{const g=e.Get(`${o}/bufferView`,this._gltf.bufferViews,v.bufferView);v._babylonVertexBuffer[V]=this._loadVertexBufferViewAsync(g).then((I=>{const Q=Z._GetNumComponents(o,v.type);return new b.e(E,I,V,!1,void 0,g.byteStride,void 0,v.byteOffset,Q,v.componentType,v.normalized,!0,void 0,!0)}))}return v._babylonVertexBuffer[V]}_loadMaterialMetallicRoughnessPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return v&&(v.baseColorFactor?(V.albedoColor=I.Lv.bv(v.baseColorFactor),V.alpha=v.baseColorFactor[3]):V.albedoColor=I.Lv.White(),V.metallic=void 0==v.metallicFactor?1:v.metallicFactor,V.roughness=void 0==v.roughnessFactor?1:v.roughnessFactor,v.baseColorTexture&&g.push(this.loadTextureInfoAsync(`${o}/baseColorTexture`,v.baseColorTexture,(o=>{o.name=`${V.name} (Base Color)`,V.albedoTexture=o}))),v.metallicRoughnessTexture&&(v.metallicRoughnessTexture.nonColorData=!0,g.push(this.loadTextureInfoAsync(`${o}/metallicRoughnessTexture`,v.metallicRoughnessTexture,(o=>{o.name=`${V.name} (Metallic Roughness)`,V.metallicTexture=o}))),V.useMetallnessFromMetallicTextureBlue=!0,V.useRoughnessFromMetallicTextureGreen=!0,V.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(g).then((()=>{}))}_loadMaterialAsync(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const I=this._extensionsLoadMaterialAsync(o,v,V,g,E);if(I)return I;v._data=v._data||{};let Q=v._data[g];if(!Q){this.logOpen(`${o} ${v.name||""}`);const V=this.createMaterial(o,v,g);Q={babylonMaterial:V,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(o,v,V)},v._data[g]=Q,Z.AddPointerMetadata(V,o),this._parent.onMaterialLoadedObservable.notifyObservers(V),this.logClose()}return V&&(Q.babylonMeshes.push(V),V.Tg.addOnce((()=>{const o=Q.babylonMeshes.indexOf(V);-1!==o&&Q.babylonMeshes.splice(o,1)}))),E(Q.babylonMaterial),Q.promise.then((()=>Q.babylonMaterial))}_createDefaultMaterial(o,v){this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new t.d(o,this._babylonScene);return V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.fillMode=v,V.enableSpecularAntiAliasing=!0,V.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,V.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,V.transparencyMode=t.d.PBRMATERIAL_OPAQUE,V.metallic=1,V.roughness=1,V}createMaterial(o,v,V){const g=this._extensionsCreateMaterial(o,v,V);if(g)return g;const E=v.name||`material${v.index}`;return this._createDefaultMaterial(E,V)}loadMaterialPropertiesAsync(o,v,V){const g=this._extensionsLoadMaterialPropertiesAsync(o,v,V);if(g)return g;const E=new Array;return E.push(this.loadMaterialBasePropertiesAsync(o,v,V)),v.pbrMetallicRoughness&&E.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${o}/pbrMetallicRoughness`,v.pbrMetallicRoughness,V)),this.loadMaterialAlphaProperties(o,v,V),Promise.all(E).then((()=>{}))}loadMaterialBasePropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return V.emissiveColor=v.emissiveFactor?I.Lv.bv(v.emissiveFactor):new I.Lv(0,0,0),v.doubleSided&&(V.cU=!1,V.twoSidedLighting=!0),v.normalTexture&&(v.normalTexture.nonColorData=!0,g.push(this.loadTextureInfoAsync(`${o}/normalTexture`,v.normalTexture,(o=>{o.name=`${V.name} (Normal)`,V.bumpTexture=o}))),V.invertNormalMapX=!this._babylonScene.useRightHandedSystem,V.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=v.normalTexture.scale&&V.bumpTexture&&(V.bumpTexture.level=v.normalTexture.scale),V.forceIrradianceInFragment=!0),v.occlusionTexture&&(v.occlusionTexture.nonColorData=!0,g.push(this.loadTextureInfoAsync(`${o}/occlusionTexture`,v.occlusionTexture,(o=>{o.name=`${V.name} (Occlusion)`,V.ambientTexture=o}))),V.useAmbientInGrayScale=!0,void 0!=v.occlusionTexture.strength&&(V.ambientTextureStrength=v.occlusionTexture.strength)),v.emissiveTexture&&g.push(this.loadTextureInfoAsync(`${o}/emissiveTexture`,v.emissiveTexture,(o=>{o.name=`${V.name} (Emissive)`,V.emissiveTexture=o}))),Promise.all(g).then((()=>{}))}loadMaterialAlphaProperties(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);switch(v.alphaMode||"OPAQUE"){case"OPAQUE":V.transparencyMode=t.d.PBRMATERIAL_OPAQUE,V.alpha=1;break;case"MASK":V.transparencyMode=t.d.PBRMATERIAL_ALPHATEST,V.alphaCutOff=void 0==v.alphaCutoff?.5:v.alphaCutoff,V.albedoTexture&&(V.albedoTexture.Kg=!0);break;case"BLEND":V.transparencyMode=t.d.PBRMATERIAL_ALPHABLEND,V.albedoTexture&&(V.albedoTexture.Kg=!0,V.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${o}/alphaMode: Invalid value (${v.alphaMode})`)}}loadTextureInfoAsync(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const g=this._extensionsLoadTextureInfoAsync(o,v,V);if(g)return g;if(this.logOpen(`${o}`),v.texCoord>=6)throw new Error(`${o}/texCoord: Invalid value (${v.texCoord})`);const E=e.Get(`${o}/index`,this._gltf.textures,v.index);E._textureInfo=v;const I=this._loadTextureAsync(`/textures/${v.index}`,E,(g=>{g.coordinatesIndex=v.texCoord||0,Z.AddPointerMetadata(g,o),this._parent.onTextureLoadedObservable.notifyObservers(g),V(g)}));return this.logClose(),I}_loadTextureAsync(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const g=this._extensionsLoadTextureAsync(o,v,V);if(g)return g;this.logOpen(`${o} ${v.name||""}`);const E=void 0==v.sampler?Z.DefaultSampler:e.Get(`${o}/sampler`,this._gltf.samplers,v.sampler),I=e.Get(`${o}/source`,this._gltf.images,v.source),Q=this._createTextureAsync(o,E,I,V,void 0,!v._textureInfo.nonColorData);return this.logClose(),Q}_createTextureAsync(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},I=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0;const U=this._loadSampler(`/samplers/${v.index}`,v),n=new Array,O=new g;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:U.noMipMaps,invertY:!1,samplingMode:U.samplingMode,C:()=>{this._disposed||O.resolve()},onError:(v,V)=>{this._disposed||O.reject(new Error(`${o}: ${V&&V.message?V.message:v||"Failed to load texture"}`))},mimeType:V.mimeType??(0,Y.g)(V.uri??""),loaderOptions:I,useSRGBBuffer:!!Q&&this._parent.useSRGBBuffers},x=new s.e(null,this._babylonScene,h);return x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.push(O.promise),n.push(this.loadImageAsync(`/images/${V.index}`,V).then((o=>{const v=V.uri||`${this._fileName}#image${V.index}`,g=`data:${this._uniqueRootUrl}${v}`;x.updateURL(g,o);const E=x.getInternalTexture();E&&(E.label=V.name)}))),x.wrapU=U.wrapU,x.wrapV=U.wrapV,E(x),this._parent.useGltfTextureNames&&(x.name=V.name||V.uri||`image${V.index}`),Promise.all(n).then((()=>x))}_loadSampler(o,v){return v._data||(v._data={noMipMaps:9728===v.minFilter||9729===v.minFilter,samplingMode:Z._GetTextureSamplingMode(o,v),wrapU:Z._GetTextureWrapMode(`${o}/wrapS`,v.wrapS),wrapV:Z._GetTextureWrapMode(`${o}/wrapT`,v.wrapT)}),v._data}loadImageAsync(o,v){if(!v._data){if(this.logOpen(`${o} ${v.name||""}`),v.uri)v._data=this.loadUriAsync(`${o}/uri`,v,v.uri);else{const V=e.Get(`${o}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}this.logClose()}return v._data}loadUriAsync(o,v,V){const g=this._extensionsLoadUriAsync(o,v,V);if(g)return g;if(!Z._ValidateUri(V))throw new Error(`${o}: '${V}' is invalid`);if((0,Y.h)(V)){const v=new Uint8Array((0,Y.d)(V));return this.log(`${o}: Decoded ${V.substring(0,64)}... (${v.length} bytes)`),Promise.resolve(v)}return this.log(`${o}: Loading ${V}`),this._parent.preprocessUrlAsync(this._rootUrl+V).then((v=>new Promise(((g,E)=>{this._parent._loadFile(this._babylonScene,v,(v=>{this._disposed||(this.log(`${o}: Loaded ${V} (${v.byteLength} bytes)`),g(new Uint8Array(v)))}),!0,(v=>{E(new Y.k(`${o}: Failed to load '${V}'${v?": "+v.status+" "+v.statusText:""}`,v))}))}))))}static AddPointerMetadata(o,v){o.metadata=o.metadata||{};const V=o._internalMetadata=o._internalMetadata||{},g=V.Ng=V.Ng||{};(g.pointers=g.pointers||[]).push(v)}static _GetTextureWrapMode(o,v){switch(v=void 0==v?10497:v){case 33071:return s.e.CLAMP_ADDRESSMODE;case 33648:return s.e.MIRROR_ADDRESSMODE;case 10497:return s.e.WRAP_ADDRESSMODE;default:return T.b.Warn(`${o}: Invalid value (${v})`),s.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(o,v){const V=void 0==v.magFilter?9729:v.magFilter,g=void 0==v.minFilter?9987:v.minFilter;if(9729===V)switch(g){case 9728:return s.e.LINEAR_NEAREST;case 9729:return s.e.LINEAR_LINEAR;case 9984:return s.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return s.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return s.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return s.e.LINEAR_LINEAR_MIPLINEAR;default:return T.b.Warn(`${o}/minFilter: Invalid value (${g})`),s.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==V&&T.b.Warn(`${o}/magFilter: Invalid value (${V})`),g){case 9728:return s.e.NEAREST_NEAREST;case 9729:return s.e.NEAREST_LINEAR;case 9984:return s.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return s.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return s.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return s.e.NEAREST_LINEAR_MIPLINEAR;default:return T.b.Warn(`${o}/minFilter: Invalid value (${g})`),s.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(o,v){try{return(0,H.q)(v)}catch(V){throw new Error(`${o}: ${V.message}`)}}static _GetTypedArray(o,v,V,g,E){const I=V.buffer;g=V.byteOffset+(g||0);const Q=Z._GetTypedArrayConstructor(`${o}/componentType`,v),U=b.e.GetTypeByteLength(v);return g%U!==0?(T.b.Warn(`${o}: Copying buffer as byte offset (${g}) is not a multiple of component type byte length (${U})`),new Q(I.slice(g,g+E*U),0)):new Q(I,g,E)}static _GetNumComponents(o,v){switch(v){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${o}: Invalid type (${v})`)}static _ValidateUri(o){return Q.Tools.IsBase64(o)||-1===o.indexOf("..")}static _GetDrawMode(o,v){switch(void 0==v&&(v=4),v){case 0:return j.e.PointListDrawMode;case 1:return j.e.LineListDrawMode;case 2:return j.e.LineLoopDrawMode;case 3:return j.e.LineStripDrawMode;case 4:return j.e.TriangleFillMode;case 5:return j.e.TriangleStripDrawMode;case 6:return j.e.TriangleFanDrawMode}throw new Error(`${o}: Invalid mesh primitive mode (${v})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const o=new Array;if(this._gltf.materials)for(const v of this._gltf.materials)if(v._data)for(const V in v._data){const g=v._data[V];for(const v of g.babylonMeshes){v.Ag(!0);const V=g.babylonMaterial;o.push(V.forceCompilationAsync(v)),o.push(V.forceCompilationAsync(v,{useInstances:!0})),this._parent.useClipPlane&&(o.push(V.forceCompilationAsync(v,{clipPlane:!0})),o.push(V.forceCompilationAsync(v,{clipPlane:!0,useInstances:!0})))}}return Promise.all(o).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const o=new Array,v=this._babylonScene.lights;for(const V of v){const v=V.getShadowGenerator();v&&o.push(v.forceCompilationAsync())}return Promise.all(o).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(o){for(const v of this._extensions)v.enabled&&o(v)}_applyExtensions(o,v,V){for(const g of this._extensions)if(g.enabled){const E=`${g.name}.${v}`,I=o;I._activeLoaderExtensionFunctions=I._activeLoaderExtensionFunctions||{};const Q=I._activeLoaderExtensionFunctions;if(!Q[E]){Q[E]=!0;try{const o=V(g);if(o)return o}finally{delete Q[E]}}}return null}_extensionsOnLoading(){this._forEachExtensions((o=>o.onLoading&&o.onLoading()))}_extensionsOnReady(){this._forEachExtensions((o=>o.onReady&&o.onReady()))}_extensionsLoadSceneAsync(o,v){return this._applyExtensions(v,"loadScene",(V=>V.loadSceneAsync&&V.loadSceneAsync(o,v)))}_extensionsLoadNodeAsync(o,v,V){return this._applyExtensions(v,"loadNode",(g=>g.loadNodeAsync&&g.loadNodeAsync(o,v,V)))}_extensionsLoadCameraAsync(o,v,V){return this._applyExtensions(v,"loadCamera",(g=>g.loadCameraAsync&&g.loadCameraAsync(o,v,V)))}_extensionsLoadVertexDataAsync(o,v,V){return this._applyExtensions(v,"loadVertexData",(g=>g._loadVertexDataAsync&&g._loadVertexDataAsync(o,v,V)))}_extensionsLoadMeshPrimitiveAsync(o,v,V,g,E,I){return this._applyExtensions(E,"loadMeshPrimitive",(Q=>Q._loadMeshPrimitiveAsync&&Q._loadMeshPrimitiveAsync(o,v,V,g,E,I)))}_extensionsLoadMaterialAsync(o,v,V,g,E){return this._applyExtensions(v,"loadMaterial",(I=>I._loadMaterialAsync&&I._loadMaterialAsync(o,v,V,g,E)))}_extensionsCreateMaterial(o,v,V){return this._applyExtensions(v,"createMaterial",(g=>g.createMaterial&&g.createMaterial(o,v,V)))}_extensionsLoadMaterialPropertiesAsync(o,v,V){return this._applyExtensions(v,"loadMaterialProperties",(g=>g.loadMaterialPropertiesAsync&&g.loadMaterialPropertiesAsync(o,v,V)))}_extensionsLoadTextureInfoAsync(o,v,V){return this._applyExtensions(v,"loadTextureInfo",(g=>g.loadTextureInfoAsync&&g.loadTextureInfoAsync(o,v,V)))}_extensionsLoadTextureAsync(o,v,V){return this._applyExtensions(v,"loadTexture",(g=>g._loadTextureAsync&&g._loadTextureAsync(o,v,V)))}_extensionsLoadAnimationAsync(o,v){return this._applyExtensions(v,"loadAnimation",(V=>V.loadAnimationAsync&&V.loadAnimationAsync(o,v)))}_extensionsLoadAnimationChannelAsync(o,v,V,g,E){return this._applyExtensions(V,"loadAnimationChannel",(I=>I._loadAnimationChannelAsync&&I._loadAnimationChannelAsync(o,v,V,g,E)))}_extensionsLoadSkinAsync(o,v,V){return this._applyExtensions(V,"loadSkin",(g=>g._loadSkinAsync&&g._loadSkinAsync(o,v,V)))}_extensionsLoadUriAsync(o,v,V){return this._applyExtensions(v,"loadUri",(g=>g._loadUriAsync&&g._loadUriAsync(o,v,V)))}_extensionsLoadBufferViewAsync(o,v){return this._applyExtensions(v,"loadBufferView",(V=>V.loadBufferViewAsync&&V.loadBufferViewAsync(o,v)))}_extensionsLoadBufferAsync(o,v,V,g){return this._applyExtensions(v,"loadBuffer",(E=>E.loadBufferAsync&&E.loadBufferAsync(o,v,V,g)))}static LoadExtensionAsync(o,v,V,g){if(!v.extensions)return null;const E=v.extensions[V];return E?g(`${o}/extensions/${V}`,E):null}static LoadExtraAsync(o,v,V,g){if(!v.extras)return null;const E=v.extras[V];return E?g(`${o}/extras/${V}`,E):null}isExtensionUsed(o){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(o)}logOpen(o){this._parent._logOpen(o)}logClose(){this._parent._logClose()}log(o){this._parent._log(o)}startPerformanceCounter(o){this._parent._startPerformanceCounter(o)}endPerformanceCounter(o){this._parent._endPerformanceCounter(o)}}Z.DefaultSampler={index:-1},N.c._CreateGLTF2Loader=o=>new Z(o);var K=V(14197),X=V(12692),r=V(12535),B=V(14199),A=V(14208);class C extends A.b{constructor(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",o),this._texture=o.getEngine().createRawCubeTexture(v,V,g,E,I,Q,U,n)}update(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,o,v,V,g,E)}updateRGBDAsync(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,B.n)(this._texture,o,v,V,g).then((()=>{}))}clone(){return r.c.Clone((()=>{const o=this.Fo(),v=this._texture,V=new C(o,v._bufferViewArray,v.width,v.format,v.type,v.generateMipMaps,v.invertY,v.samplingMode,v._compression);return 13===v.source&&V.updateRGBDAsync(v._bufferViewArrayArray,v._sphericalPolynomial,v._lodGenerationScale,v._lodGenerationOffset),V}),this)}}const p="EXT_lights_image_based";class G{constructor(o){this.name=p,this._loader=o,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const o=this._loader.Ng.extensions;if(o&&o[this.name]){const v=o[this.name];this._lights=v.lights}}loadSceneAsync(o,v){return Z.LoadExtensionAsync(o,v,this.name,(async(V,g)=>{this._loader._allMaterialsDirtyRequired=!0;const E=new Array;E.push(this._loader.loadSceneAsync(o,v)),this._loader.logOpen(`${V}`);const I=e.Get(`${V}/light`,this._lights,g.Eg);return E.push(this._loadLightAsync(`/extensions/${this.name}/lights/${g.Eg}`,I).then((o=>{this._loader.babylonScene.environmentTexture=o}))),this._loader.logClose(),await Promise.all(E).then((()=>{}))}))}_loadLightAsync(o,v){if(!v._loaded){const V=new Array;this._loader.logOpen(`${o}`);const g=new Array(v.specularImages.length);for(let E=0;E<v.specularImages.length;E++){const I=v.specularImages[E];g[E]=new Array(I.length);for(let v=0;v<I.length;v++){const Q=`${o}/specularImages/${E}/${v}`;this._loader.logOpen(`${Q}`);const U=I[v],n=e.Get(Q,this._loader.Ng.images,U);V.push(this._loader.loadImageAsync(`/images/${U}`,n).then((o=>{g[E][v]=o}))),this._loader.logClose()}}this._loader.logClose(),v._loaded=Promise.all(V).then((async()=>{const V=new C(this._loader.babylonScene,null,v.specularImageSize);if(V.name=v.name||"environment",v._babylonTexture=V,void 0!=v.uU&&(V.level=v.uU),v.rotation){let o=E.Quaternion.bv(v.rotation);this._loader.babylonScene.useRightHandedSystem||(o=E.Quaternion.Inverse(o)),E.Matrix.FromQuaternionToRef(o,V.getReflectionTextureMatrix())}if(!v.irradianceCoefficients)throw new Error(`${o}: Irradiance coefficients are missing`);const I=X.b.bv(v.irradianceCoefficients);I.scaleInPlace(v.uU),I.convertIrradianceToLambertianRadiance();const Q=X.c.FromHarmonics(I),U=(g.length-1)/Math.log2(v.specularImageSize);return await V.updateRGBDAsync(g,Q,U)}))}return v._loaded.then((()=>v._babylonTexture))}}w(p),W(p,!0,(o=>new G(o)));V(13074);const k="EXT_mesh_gpu_instancing";class oo{constructor(o){this.name=k,this._loader=o,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null}loadNodeAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(o,g)=>{this._loader._disableInstancedMesh++;const I=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,V);if(this._loader._disableInstancedMesh--,!v._primitiveBabylonMeshes)return await I;const Q=new Array;let U=0;const n=v=>{if(void 0==g.attributes[v])return void Q.push(Promise.resolve(null));const V=e.Get(`${o}/attributes/${v}`,this._loader.Ng.accessors,g.attributes[v]);if(Q.push(this._loader._loadFloatAccessorAsync(`/accessors/${V.bufferView}`,V)),0===U)U=V.count;else if(U!==V.count)throw new Error(`${o}/attributes: Instance buffer accessors do not have the same count.`)};return n("TRANSLATION"),n("ROTATION"),n("SCALE"),await I.then((async o=>{const[V,g,I]=await Promise.all(Q),n=new Float32Array(16*U);E.TmpVectors.cv[0].RU(0,0,0),E.TmpVectors.Quaternion[0].RU(0,0,0,1),E.TmpVectors.cv[1].RU(1,1,1);for(let v=0;v<U;++v)V&&E.cv.FromArrayToRef(V,3*v,E.TmpVectors.cv[0]),g&&E.Quaternion.FromArrayToRef(g,4*v,E.TmpVectors.Quaternion[0]),I&&E.cv.FromArrayToRef(I,3*v,E.TmpVectors.cv[1]),E.Matrix.ComposeToRef(E.TmpVectors.cv[1],E.TmpVectors.Quaternion[0],E.TmpVectors.cv[0],E.TmpVectors.Matrix[0]),E.TmpVectors.Matrix[0].copyToArray(n,16*v);for(const E of v._primitiveBabylonMeshes)E.Hx("matrix",n,16,!0);return o}))}))}}w(k),W(k,!0,(o=>new oo(o)));let vo=0,Vo=null;class go{static get Default(){return go._Default||(go._Default=new go),go._Default}constructor(){const o=go.Configuration.decoder;this._decoderModulePromise=Q.Tools.LoadBabylonScriptAsync(o.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(o,v,V,g,E){await this._decoderModulePromise,0===vo&&(MeshoptDecoder.useWorkers(1),vo=1);const I=await MeshoptDecoder.decodeGltfBufferAsync(v,V,o,g,E);return null!==Vo&&clearTimeout(Vo),Vo=setTimeout((()=>{MeshoptDecoder.useWorkers(0),vo=0,Vo=null}),1e3),I}}go.Configuration={decoder:{url:`${Q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},go._Default=null;const Eo="EXT_meshopt_compression";class Io{constructor(o){this.name=Eo,this.enabled=o.isExtensionUsed(Eo),this._loader=o}dispose(){this._loader=null}loadBufferViewAsync(o,v){return Z.LoadExtensionAsync(o,v,this.name,(async(V,g)=>{const E=v;if(E._meshOptData)return await E._meshOptData;const I=e.Get(`${o}/buffer`,this._loader.Ng.buffers,g.buffer);return E._meshOptData=this._loader.loadBufferAsync(`/buffers/${I.index}`,I,g.byteOffset||0,g.byteLength).then((async o=>await go.Default.decodeGltfBufferAsync(o,g.count,g.byteStride,g.mode,g.filter))),await E._meshOptData}))}}w(Eo),W(Eo,!0,(o=>new Io(o)));const Qo="EXT_texture_webp";class Uo{constructor(o){this.name=Qo,this._loader=o,this.enabled=o.isExtensionUsed(Qo)}dispose(){this._loader=null}_loadTextureAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=void 0==v.sampler?Z.DefaultSampler:e.Get(`${o}/sampler`,this._loader.Ng.samplers,v.sampler),Q=e.Get(`${g}/source`,this._loader.Ng.images,E.source);return await this._loader._createTextureAsync(o,I,Q,(o=>{V(o)}),void 0,!v._textureInfo.nonColorData)}))}}w(Qo),W(Qo,!0,(o=>new Uo(o)));const no="EXT_texture_avif";class Oo{constructor(o){this.name=no,this._loader=o,this.enabled=o.isExtensionUsed(no)}dispose(){this._loader=null}_loadTextureAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=void 0==v.sampler?Z.DefaultSampler:e.Get(`${o}/sampler`,this._loader.Ng.samplers,v.sampler),Q=e.Get(`${g}/source`,this._loader.Ng.images,E.source);return await this._loader._createTextureAsync(o,I,Q,(o=>{V(o)}),void 0,!v._textureInfo.nonColorData)}))}}w(no),W(no,!0,(o=>new Oo(o)));var ho=V(14189),xo=V(13049);const fo="EXT_lights_ies";class lo{constructor(o){this.name=fo,this._loader=o,this.enabled=this._loader.isExtensionUsed(fo)}dispose(){this._loader=null,delete this._lights}onLoading(){const o=this._loader.Ng.extensions;if(o&&o[this.name]){const v=o[this.name];this._lights=v.lights,e.Assign(this._lights)}}loadNodeAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,Q)=>{let U,n;this._loader._allMaterialsDirtyRequired=!0;const O=await this._loader.loadNodeAsync(o,v,(o=>{n=e.Get(g,this._lights,Q.Eg);const v=n.name||o.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,U=new ho.c(v,E.cv.Zero(),E.cv.Backward(),0,1,this._loader.babylonScene),U.angle=Math.PI/2,U.innerAngle=0,U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,n._babylonLight=U,U.falloffType=xo.c.FALLOFF_GLTF,U.mn=Q.color?I.Lv.bv(Q.color):I.Lv.White(),U.uU=Q.multiplier||1,U.range=Number.MAX_VALUE,U.parent=o,this._loader._babylonLights.push(U),Z.AddPointerMetadata(U,g),V(o)}));let h;if(n.uri)h=await this._loader.loadUriAsync(o,n,n.uri);else{const v=e.Get(`${o}/bufferView`,this._loader.Ng.bufferViews,n.bufferView);h=await this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}return U.iesProfileTexture=new s.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,h,!0,void 0,void 0,void 0,void 0,".ies"),O}))}}w(fo),W(fo,!0,(o=>new lo(o)));var So=V(14220);const To="KHR_draco_mesh_compression";class co{constructor(o){this.name=To,this.useNormalizedFlagFromAccessor=!0,this._loader=o,this.enabled=So.d.DefaultAvailable&&this._loader.isExtensionUsed(To)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{if(void 0!=v.mode&&4!==v.mode&&5!==v.mode)throw new Error(`${o}: Unsupported mode ${v.mode}`);const I={},Q={},U=(o,g)=>{const U=E.attributes[o];if(void 0!=U&&(V._delayInfo=V._delayInfo||[],-1===V._delayInfo.indexOf(g)&&V._delayInfo.push(g),I[g]=U,this.useNormalizedFlagFromAccessor)){const V=e.TryGet(this._loader.Ng.accessors,v.attributes[o]);V&&(Q[g]=V.normalized||!1)}};U("POSITION",b.e.PositionKind),U("NORMAL",b.e.NormalKind),U("TANGENT",b.e.TangentKind),U("TEXCOORD_0",b.e.UVKind),U("TEXCOORD_1",b.e.UV2Kind),U("TEXCOORD_2",b.e.UV3Kind),U("TEXCOORD_3",b.e.UV4Kind),U("TEXCOORD_4",b.e.UV5Kind),U("TEXCOORD_5",b.e.UV6Kind),U("JOINTS_0",b.e.MatricesIndicesKind),U("WEIGHTS_0",b.e.MatricesWeightsKind),U("COLOR_0",b.e.ColorKind);const n=e.Get(g,this._loader.Ng.bufferViews,E.bufferView);return n._dracoBabylonGeometry||(n._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((async g=>{const E=this.dracoDecoder||So.d.Default,U=e.TryGet(this._loader.Ng.accessors,v.attributes.POSITION),n=this._loader.parent.alwaysComputeBoundingBox||V.skeleton||!U?null:D(U);return await E._decodeMeshToGeometryForGltfAsync(V.name,this._loader.babylonScene,g,I,Q,n).catch((v=>{throw new Error(`${o}: ${v.message}`)}))}))),await n._dracoBabylonGeometry}))}}w(To),W(To,!0,(o=>new co(o)));var Ro=V(14223),jo=V(12473),to=V(12479),so=V(12932),Lo=V(13099),bo=V(12449);so.c.AddNodeConstructor("Light_Type_0",((o,v)=>()=>new uo(o,E.cv.Zero(),v)));class uo extends Lo.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(o){this._shadowAngle=o,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(o){const v=this.needCube();if(this._direction=o,this.needCube()!==v&&this._shadowGenerators){const o=this._shadowGenerators.values();for(let v=o.next();!0!==v.done;v=o.next()){v.value.recreateShadowMap()}}}constructor(o,v,V){super(o,V),this._shadowAngle=Math.PI/2,this.position=v}getClassName(){return"PointLight"}getTypeID(){return xo.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(o){if(this.direction)return super.getShadowDirection(o);switch(o){case 0:return new E.cv(1,0,0);case 1:return new E.cv(-1,0,0);case 2:return new E.cv(0,-1,0);case 3:return new E.cv(0,1,0);case 4:return new E.cv(0,0,1);case 5:return new E.cv(0,0,-1)}return E.cv.Zero()}_setDefaultShadowProjectionMatrix(o,v,V){const g=this.Fo().activeCamera;if(!g)return;const I=void 0!==this.shadowMinZ?this.shadowMinZ:g.Xg,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:g.maxZ,U=this.Fo().getEngine().Ug;E.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,U?Q:I,U?I:Q,o,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(o,v){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,v):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,v),this}transferToNodeMaterialEffect(o,v){return this.computeTransformedInformation()?o.setFloat3(v,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):o.setFloat3(v,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(o,v){o["POINTLIGHT"+v]=!0}}(0,jo.c)([(0,to.K)()],uo.prototype,"shadowAngle",null),(0,bo.h)("BABYLON.PointLight",uo);const mv="KHR_lights_punctual";class ao{constructor(o){this.name=mv,this._loader=o,this.enabled=this._loader.isExtensionUsed(mv)}dispose(){this._loader=null,delete this._lights}onLoading(){const o=this._loader.Ng.extensions;if(o&&o[this.name]){const v=o[this.name];this._lights=v.lights,e.Assign(this._lights)}}loadNodeAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,Q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(o,v,(o=>{let v;const U=e.Get(g,this._lights,Q.Eg),n=U.name||o.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,U.type){case"directional":{const o=new Ro.c(n,E.cv.Backward(),this._loader.babylonScene);o.position.tU(0),v=o;break}case"point":v=new uo(n,E.cv.Zero(),this._loader.babylonScene);break;case"spot":{const o=new ho.c(n,E.cv.Zero(),E.cv.Backward(),0,1,this._loader.babylonScene);o.angle=2*(U.spot&&U.spot.outerConeAngle||Math.PI/4),o.innerAngle=2*(U.spot&&U.spot.innerConeAngle||0),v=o;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${g}: Invalid light type (${U.type})`)}v._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=v,v.falloffType=xo.c.FALLOFF_GLTF,v.mn=U.color?I.Lv.bv(U.color):I.Lv.White(),v.uU=void 0==U.uU?1:U.uU,v.range=void 0==U.range?Number.MAX_VALUE:U.range,v.parent=o,this._loader._babylonLights.push(v),Z.AddPointerMetadata(v,g),V(o)})))))}}w(mv),W(mv,!0,(o=>new ao(o)));const Fo="KHR_materials_pbrSpecularGlossiness";class io{constructor(o){this.name=Fo,this.order=200,this._loader=o,this.enabled=this._loader.isExtensionUsed(Fo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialBasePropertiesAsync(o,v,V)),I.push(this._loadSpecularGlossinessPropertiesAsync(g,E,V)),this._loader.loadMaterialAlphaProperties(o,v,V),await Promise.all(I).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return V.metallic=null,V.roughness=null,v.diffuseFactor?(V.albedoColor=I.Lv.bv(v.diffuseFactor),V.alpha=v.diffuseFactor[3]):V.albedoColor=I.Lv.White(),V.reflectivityColor=v.specularFactor?I.Lv.bv(v.specularFactor):I.Lv.White(),V.microSurface=void 0==v.glossinessFactor?1:v.glossinessFactor,v.diffuseTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/diffuseTexture`,v.diffuseTexture,(o=>{o.name=`${V.name} (Diffuse)`,V.albedoTexture=o}))),v.specularGlossinessTexture&&(g.push(this._loader.loadTextureInfoAsync(`${o}/specularGlossinessTexture`,v.specularGlossinessTexture,(o=>{o.name=`${V.name} (Specular Glossiness)`,V.reflectivityTexture=o,V.reflectivityTexture.Kg=!0}))),V.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(g).then((()=>{}))}}w(Fo),W(Fo,!0,(o=>new io(o)));const Jo="KHR_materials_unlit";class No{constructor(o){this.name=Jo,this.order=210,this._loader=o,this.enabled=this._loader.isExtensionUsed(Jo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async()=>await this._loadUnlitPropertiesAsync(o,v,V)))}_loadUnlitPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;V.unlit=!0;const E=v.pbrMetallicRoughness;return E&&(E.baseColorFactor?(V.albedoColor=I.Lv.bv(E.baseColorFactor),V.alpha=E.baseColorFactor[3]):V.albedoColor=I.Lv.White(),E.baseColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/baseColorTexture`,E.baseColorTexture,(o=>{o.name=`${V.name} (Base Color)`,V.albedoTexture=o})))),v.doubleSided&&(V.cU=!1,V.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(o,v,V),Promise.all(g).then((()=>{}))}}w(Jo),W(Jo,!0,(o=>new No(o)));const Yo="KHR_materials_clearcoat";class qo{constructor(o){this.name=Yo,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(Yo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadClearCoatPropertiesAsync(g,E,V)),await Promise.all(I)}))}_loadClearCoatPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return V.clearCoat.isEnabled=!0,V.clearCoat.useRoughnessFromMainTexture=!1,V.clearCoat.remapF0OnInterfaceChange=!1,void 0!=v.clearcoatFactor?V.clearCoat.uU=v.clearcoatFactor:V.clearCoat.uU=0,v.clearcoatTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/clearcoatTexture`,v.clearcoatTexture,(o=>{o.name=`${V.name} (ClearCoat)`,V.clearCoat.texture=o}))),void 0!=v.clearcoatRoughnessFactor?V.clearCoat.roughness=v.clearcoatRoughnessFactor:V.clearCoat.roughness=0,v.clearcoatRoughnessTexture&&(v.clearcoatRoughnessTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${o}/clearcoatRoughnessTexture`,v.clearcoatRoughnessTexture,(o=>{o.name=`${V.name} (ClearCoat Roughness)`,V.clearCoat.textureRoughness=o})))),v.clearcoatNormalTexture&&(v.clearcoatNormalTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${o}/clearcoatNormalTexture`,v.clearcoatNormalTexture,(o=>{o.name=`${V.name} (ClearCoat Normal)`,V.clearCoat.bumpTexture=o}))),V.invertNormalMapX=!V.Fo().useRightHandedSystem,V.invertNormalMapY=V.Fo().useRightHandedSystem,void 0!=v.clearcoatNormalTexture.scale&&(V.clearCoat.bumpTexture.level=v.clearcoatNormalTexture.scale)),Promise.all(g).then((()=>{}))}}w(Yo),W(Yo,!0,(o=>new qo(o)));const Po="KHR_materials_iridescence";class Mo{constructor(o){this.name=Po,this.order=195,this._loader=o,this.enabled=this._loader.isExtensionUsed(Po)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadIridescencePropertiesAsync(g,E,V)),await Promise.all(I).then((()=>{}))}))}_loadIridescencePropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return V.iridescence.isEnabled=!0,V.iridescence.uU=v.iridescenceFactor??0,V.iridescence.indexOfRefraction=v.iridescenceIor??v.iridescenceIOR??1.3,V.iridescence.minimumThickness=v.iridescenceThicknessMinimum??100,V.iridescence.maximumThickness=v.iridescenceThicknessMaximum??400,v.iridescenceTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/iridescenceTexture`,v.iridescenceTexture,(o=>{o.name=`${V.name} (Iridescence)`,V.iridescence.texture=o}))),v.iridescenceThicknessTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/iridescenceThicknessTexture`,v.iridescenceThicknessTexture,(o=>{o.name=`${V.name} (Iridescence Thickness)`,V.iridescence.thicknessTexture=o}))),Promise.all(g).then((()=>{}))}}w(Po),W(Po,!0,(o=>new Mo(o)));const Wo="KHR_materials_anisotropy";class wo{constructor(o){this.name=Wo,this.order=195,this._loader=o,this.enabled=this._loader.isExtensionUsed(Wo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadIridescencePropertiesAsync(g,E,V)),await Promise.all(I)}))}async _loadIridescencePropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;V.anisotropy.isEnabled=!0,V.anisotropy.uU=v.anisotropyStrength??0,V.anisotropy.angle=v.anisotropyRotation??0,v.anisotropyTexture&&(v.anisotropyTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${o}/anisotropyTexture`,v.anisotropyTexture,(o=>{o.name=`${V.name} (Anisotropy Intensity)`,V.anisotropy.texture=o})))),await Promise.all(g)}}w(Wo),W(Wo,!0,(o=>new wo(o)));const zo="KHR_materials_emissive_strength";class yo{constructor(o){this.name=zo,this.order=170,this._loader=o,this.enabled=this._loader.isExtensionUsed(zo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>await this._loader.loadMaterialPropertiesAsync(o,v,V).then((()=>{this._loadEmissiveProperties(g,E,V)}))))}_loadEmissiveProperties(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);void 0!==v.emissiveStrength&&(V.emissiveIntensity=v.emissiveStrength)}}w(zo),W(zo,!0,(o=>new yo(o)));const Ho="KHR_materials_sheen";class eo{constructor(o){this.name=Ho,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(Ho)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadSheenPropertiesAsync(g,E,V)),await Promise.all(I).then((()=>{}))}))}_loadSheenPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return V.sheen.isEnabled=!0,V.sheen.uU=1,void 0!=v.sheenColorFactor?V.sheen.color=I.Lv.bv(v.sheenColorFactor):V.sheen.color=I.Lv.Black(),v.sheenColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/sheenColorTexture`,v.sheenColorTexture,(o=>{o.name=`${V.name} (Sheen Color)`,V.sheen.texture=o}))),void 0!==v.sheenRoughnessFactor?V.sheen.roughness=v.sheenRoughnessFactor:V.sheen.roughness=0,v.sheenRoughnessTexture&&(v.sheenRoughnessTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${o}/sheenRoughnessTexture`,v.sheenRoughnessTexture,(o=>{o.name=`${V.name} (Sheen Roughness)`,V.sheen.textureRoughness=o})))),V.sheen.albedoScaling=!0,V.sheen.useRoughnessFromMainTexture=!1,Promise.all(g).then((()=>{}))}}w(Ho),W(Ho,!0,(o=>new eo(o)));var Do=V(12996);const Zo="KHR_materials_specular";class Ko{constructor(o){this.name=Zo,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(Zo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;if(I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadSpecularPropertiesAsync(g,E,V)),E.extensions&&E.extensions.EXT_materials_specular_edge_color&&V instanceof t.d){E.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(V.brdf.dielectricSpecularModel=Do.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,V.brdf.conductorSpecularModel=Do.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(I).then((()=>{}))}))}_loadSpecularPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return void 0!==v.specularFactor&&(V.metallicF0Factor=v.specularFactor),void 0!==v.specularColorFactor&&(V.metallicReflectanceColor=I.Lv.bv(v.specularColorFactor)),v.specularTexture&&(v.specularTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${o}/specularTexture`,v.specularTexture,(o=>{o.name=`${V.name} (Specular)`,V.metallicReflectanceTexture=o,V.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),v.specularColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/specularColorTexture`,v.specularColorTexture,(o=>{o.name=`${V.name} (Specular Color)`,V.reflectanceTexture=o}))),Promise.all(g).then((()=>{}))}}w(Zo),W(Zo,!0,(o=>new Ko(o)));const Xo="KHR_materials_ior";class ro{constructor(o){this.name=Xo,this.order=180,this._loader=o,this.enabled=this._loader.isExtensionUsed(Xo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadIorPropertiesAsync(g,E,V)),await Promise.all(I).then((()=>{}))}))}_loadIorPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);return void 0!==v.ior?V.indexOfRefraction=v.ior:V.indexOfRefraction=ro._DEFAULT_IOR,Promise.resolve()}}ro._DEFAULT_IOR=1.5,w(Xo),W(Xo,!0,(o=>new ro(o)));const Bo="KHR_materials_variants";class Ao{constructor(o){this.name=Bo,this._loader=o,this.enabled=this._loader.isExtensionUsed(Bo)}dispose(){this._loader=null}static GetAvailableVariants(o){const v=this._GetExtensionMetadata(o);return v?Object.keys(v.variants):[]}getAvailableVariants(o){return Ao.GetAvailableVariants(o)}static SelectVariant(o,v){const V=this._GetExtensionMetadata(o);if(!V)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Bo} extension`);const g=o=>{const v=V.variants[o];if(v)for(const V of v)V.mesh.material=V.material};if(v instanceof Array)for(const E of v)g(E);else g(v);V.lastSelected=v}selectVariant(o,v){Ao.SelectVariant(o,v)}static Reset(o){const v=this._GetExtensionMetadata(o);if(!v)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Bo} extension`);for(const V of v.original)V.mesh.material=V.material;v.lastSelected=null}reset(o){Ao.Reset(o)}static GetLastSelectedVariant(o){const v=this._GetExtensionMetadata(o);if(!v)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Bo} extension`);return v.lastSelected}getLastSelectedVariant(o){return Ao.GetLastSelectedVariant(o)}static _GetExtensionMetadata(o){var v,V;return(null===o||void 0===o||null===(v=o._internalMetadata)||void 0===v||null===(V=v.Ng)||void 0===V?void 0:V[Bo])||null}onLoading(){const o=this._loader.Ng.extensions;if(o&&o[this.name]){const v=o[this.name];this._variants=v.variants}}onReady(){const o=this._loader.rootBabylonMesh;if(o){var v;const V=this._loader.parent.extensionOptions[Bo];null!==V&&void 0!==V&&V.defaultVariant&&Ao.SelectVariant(o,V.defaultVariant),null===V||void 0===V||null===(v=V.onLoaded)||void 0===v||v.call(V,{get variants(){return Ao.GetAvailableVariants(o)},get selectedVariant(){const v=Ao.GetLastSelectedVariant(o);return v?Array.isArray(v)?v[0]:v:Ao.GetAvailableVariants(o)[0]},set selectedVariant(v){Ao.SelectVariant(o,v)}})}}_loadMeshPrimitiveAsync(o,v,V,g,E,I){return Z.LoadExtensionAsync(o,E,this.name,(async(Q,U)=>{const n=new Array;return n.push(this._loader._loadMeshPrimitiveAsync(o,v,V,g,E,(v=>{if(I(v),v instanceof a.e){const V=Z._GetDrawMode(o,E.mode),g=this._loader.rootBabylonMesh,I=g?g._internalMetadata=g._internalMetadata||{}:{},O=I.Ng=I.Ng||{},h=O[Bo]=O[Bo]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:v,material:v.material});for(let o=0;o<U.mappings.length;++o){const E=U.mappings[o],I=e.Get(`${Q}/mappings/${o}/material`,this._loader.Ng.materials,E.material);n.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,I,v,V,(o=>{for(let V=0;V<E.variants.length;++V){const I=E.variants[V],Q=e.Get(`/extensions/${Bo}/variants/${I}`,this._variants,I);h.variants[Q.name]=h.variants[Q.name]||[],h.variants[Q.name].push({mesh:v,material:o}),v.onClonedObservable.add((o=>{const V=o;let E=null,I=V;do{if(I=I.parent,!I)return;E=Ao._GetExtensionMetadata(I)}while(null===E);if(g&&E===Ao._GetExtensionMetadata(g)){I._internalMetadata={};for(const o in g._internalMetadata)I._internalMetadata[o]=g._internalMetadata[o];I._internalMetadata.Ng=[];for(const o in g._internalMetadata.Ng)I._internalMetadata.Ng[o]=g._internalMetadata.Ng[o];I._internalMetadata.Ng[Bo]={lastSelected:null,original:[],variants:{}};for(const o of E.original)I._internalMetadata.Ng[Bo].original.push({mesh:o.mesh,material:o.material});for(const o in E.variants)if(Object.prototype.hasOwnProperty.call(E.variants,o)){I._internalMetadata.Ng[Bo].variants[o]=[];for(const v of E.variants[o])I._internalMetadata.Ng[Bo].variants[o].push({mesh:v.mesh,material:v.material})}E=I._internalMetadata.Ng[Bo]}for(const g of E.original)g.mesh===v&&(g.mesh=V);for(const g of E.variants[Q.name])g.mesh===v&&(g.mesh=V)}))}})))}}}))),await Promise.all(n).then((o=>{let[v]=o;return v}))}))}}w(Bo),W(Bo,!0,(o=>new Ao(o)));var Co=V(12566);class po{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Do.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(o,v){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...po._GetDefaultOptions(),...o},this._scene=v,this._scene._transmissionHelper=this,this.onErrorObservable=new h.e,this._scene.Tg.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(o){if(!Object.keys(o).filter((v=>this._options[v]!==o[v])).length)return;const v={...this._options,...o},V=this._options;this._options=v,v.renderSize===V.renderSize&&v.renderTargetTextureType===V.renderTargetTextureType&&v.generateMipmaps===V.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=v.samples,this._opaqueRenderTarget.lodGenerationScale=v.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=v.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(o){return!!o&&!!(o instanceof t.d&&o.subSurface.isRefractionEnabled)}_addMesh(o){this._materialObservers[o.uniqueId]=o.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(o.material)?(o.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(o)&&this._transparentMeshesCache.push(o)):-1===this._opaqueMeshesCache.indexOf(o)&&this._opaqueMeshesCache.push(o)}))}_removeMesh(o){o.onMaterialChangedObservable.remove(this._materialObservers[o.uniqueId]),delete this._materialObservers[o.uniqueId];let v=this._transparentMeshesCache.indexOf(o);-1!==v&&this._transparentMeshesCache.splice(v,1),v=this._opaqueMeshesCache.indexOf(o),-1!==v&&this._opaqueMeshesCache.splice(v,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(o){const v=this._transparentMeshesCache.indexOf(o),V=this._opaqueMeshesCache.indexOf(o);this._shouldRenderAsTransmission(o.material)?(o.material instanceof t.d&&(o.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==V?(this._opaqueMeshesCache.splice(V,1),this._transparentMeshesCache.push(o)):-1===v&&this._transparentMeshesCache.push(o)):-1!==v?(this._transparentMeshesCache.splice(v,1),this._opaqueMeshesCache.push(o)):-1===V&&this._opaqueMeshesCache.push(o)}_isRenderTargetValid(){var o;return null!==(null===(o=this._opaqueRenderTarget)||void 0===o?void 0:o.getInternalTexture())}_setupRenderTargets(){var o;let v;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Co.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(o=this._options.clearColor)||void 0===o?void 0:o.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((o=>{v=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?o.clearColor.U(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(o.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=v}));for(const V of this._transparentMeshesCache)this._shouldRenderAsTransmission(V.material)&&(V.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Go="KHR_materials_transmission";class ko{constructor(o){this.name=Go,this.order=175,this._loader=o,this.enabled=this._loader.isExtensionUsed(Go),this.enabled&&(o.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadTransparentPropertiesAsync(g,v,V,E)),await Promise.all(I).then((()=>{}))}))}_loadTransparentPropertiesAsync(o,v,V,g){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const E=V;if(E.subSurface.isRefractionEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.useAlbedoToTintRefraction=!0,void 0===g.transmissionFactor)return E.subSurface.refractionIntensity=0,E.subSurface.isRefractionEnabled=!1,Promise.resolve();{var I;E.subSurface.refractionIntensity=g.transmissionFactor;const o=E.Fo();if(E.subSurface.refractionIntensity&&!o._transmissionHelper)new po({},E.Fo());else if(E.subSurface.refractionIntensity&&(null===(I=o._transmissionHelper)||void 0===I||!I._isRenderTargetValid())){var Q;null===(Q=o._transmissionHelper)||void 0===Q||Q._setupRenderTargets()}}return E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,g.transmissionTexture?(g.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${o}/transmissionTexture`,g.transmissionTexture,void 0).then((o=>{o.name=`${V.name} (Transmission)`,E.subSurface.refractionIntensityTexture=o,E.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(Go),W(Go,!0,(o=>new ko(o)));const ov="KHR_materials_diffuse_transmission";class vv{constructor(o){this.name=ov,this.order=174,this._loader=o,this.enabled=this._loader.isExtensionUsed(ov),this.enabled&&(o.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadTranslucentPropertiesAsync(g,v,V,E)),await Promise.all(I).then((()=>{}))}))}_loadTranslucentPropertiesAsync(o,v,V,g){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const E=V;if(E.subSurface.isTranslucencyEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,E.subSurface.useAlbedoToTintTranslucency=!1,void 0===g.diffuseTransmissionFactor)return E.subSurface.translucencyIntensity=0,E.subSurface.isTranslucencyEnabled=!1,Promise.resolve();E.subSurface.translucencyIntensity=g.diffuseTransmissionFactor;const Q=new Array;return E.subSurface.useGltfStyleTextures=!0,g.diffuseTransmissionTexture&&(g.diffuseTransmissionTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${o}/diffuseTransmissionTexture`,g.diffuseTransmissionTexture).then((o=>{o.name=`${V.name} (Diffuse Transmission)`,E.subSurface.translucencyIntensityTexture=o})))),void 0!==g.diffuseTransmissionColorFactor?E.subSurface.translucencyColor=I.Lv.bv(g.diffuseTransmissionColorFactor):E.subSurface.translucencyColor=I.Lv.White(),g.diffuseTransmissionColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${o}/diffuseTransmissionColorTexture`,g.diffuseTransmissionColorTexture).then((o=>{o.name=`${V.name} (Diffuse Transmission Color)`,E.subSurface.translucencyColorTexture=o}))),Promise.all(Q).then((()=>{}))}}w(ov),W(ov,!0,(o=>new vv(o)));const Vv="KHR_materials_volume";class gv{constructor(o){this.name=Vv,this.order=173,this._loader=o,this.enabled=this._loader.isExtensionUsed(Vv),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadVolumePropertiesAsync(g,v,V,E)),await Promise.all(I).then((()=>{}))}))}_loadVolumePropertiesAsync(o,v,V,g){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);if(!V.subSurface.isRefractionEnabled&&!V.subSurface.isTranslucencyEnabled||!g.thicknessFactor)return Promise.resolve();V.subSurface.volumeIndexOfRefraction=V.indexOfRefraction;const E=void 0!==g.attenuationDistance?g.attenuationDistance:Number.MAX_VALUE;return V.subSurface.tintColorAtDistance=E,void 0!==g.attenuationColor&&3==g.attenuationColor.length&&V.subSurface.tintColor.RU(g.attenuationColor[0],g.attenuationColor[1],g.attenuationColor[2]),V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=g.thicknessFactor,V.subSurface.useThicknessAsDepth=!0,g.thicknessTexture?(g.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${o}/thicknessTexture`,g.thicknessTexture).then((o=>{o.name=`${V.name} (Thickness)`,V.subSurface.thicknessTexture=o,V.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(Vv),W(Vv,!0,(o=>new gv(o)));const Ev="KHR_materials_dispersion";class Iv{constructor(o){this.name=Ev,this.order=174,this._loader=o,this.enabled=this._loader.isExtensionUsed(Ev)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadDispersionPropertiesAsync(g,v,V,E)),await Promise.all(I).then((()=>{}))}))}_loadDispersionPropertiesAsync(o,v,V,g){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);return V.subSurface.isRefractionEnabled&&g.dispersion?(V.subSurface.isDispersionEnabled=!0,V.subSurface.dispersion=g.dispersion,Promise.resolve()):Promise.resolve()}}w(Ev),W(Ev,!0,(o=>new Iv(o)));const Qv="EXT_materials_diffuse_roughness";class Uv{constructor(o){this.name=Qv,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(Qv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(o,v,V)),I.push(this._loadDiffuseRoughnessPropertiesAsync(g,E,V)),await Promise.all(I).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(o,v,V){if(!(V instanceof t.d))throw new Error(`${o}: Material type not supported`);const g=new Array;return V.brdf.baseDiffuseModel=Do.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=v.diffuseRoughnessFactor?V.baseDiffuseRoughness=v.diffuseRoughnessFactor:V.baseDiffuseRoughness=0,v.diffuseRoughnessTexture&&g.push(this._loader.loadTextureInfoAsync(`${o}/diffuseRoughnessTexture`,v.diffuseRoughnessTexture,(o=>{o.name=`${V.name} (Diffuse Roughness)`,V.baseDiffuseRoughnessTexture=o}))),Promise.all(g).then((()=>{}))}}w(Qv),W(Qv,!0,(o=>new Uv(o)));const nv="KHR_mesh_quantization";class Ov{constructor(o){this.name=nv,this.enabled=o.isExtensionUsed(nv)}dispose(){}}w(nv),W(nv,!0,(o=>new Ov(o)));const hv="KHR_texture_basisu";class xv{constructor(o){this.name=hv,this._loader=o,this.enabled=o.isExtensionUsed(hv)}dispose(){this._loader=null}_loadTextureAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>{const I=void 0==v.sampler?Z.DefaultSampler:e.Get(`${o}/sampler`,this._loader.Ng.samplers,v.sampler),Q=e.Get(`${g}/source`,this._loader.Ng.images,E.source);return await this._loader._createTextureAsync(o,I,Q,(o=>{V(o)}),v._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!v._textureInfo.nonColorData)}))}}w(hv),W(hv,!0,(o=>new xv(o)));const fv="KHR_texture_transform";class lv{constructor(o){this.name=fv,this._loader=o,this.enabled=this._loader.isExtensionUsed(fv)}dispose(){this._loader=null}loadTextureInfoAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(g,E)=>await this._loader.loadTextureInfoAsync(o,v,(o=>{if(!(o instanceof s.e))throw new Error(`${g}: Texture type not supported`);E.offset&&(o.uOffset=E.offset[0],o.vOffset=E.offset[1]),o.uRotationCenter=0,o.vRotationCenter=0,E.rotation&&(o.wAng=-E.rotation),E.scale&&(o.uScale=E.scale[0],o.vScale=E.scale[1]),void 0!=E.texCoord&&(o.coordinatesIndex=E.texCoord),V(o)}))))}}w(fv),W(fv,!0,(o=>new lv(o)));const Sv="KHR_xmp_json_ld";class Tv{constructor(o){this.name=Sv,this.order=100,this._loader=o,this.enabled=this._loader.isExtensionUsed(Sv)}dispose(){this._loader=null}onLoading(){var o,v,V;if(null===this._loader.rootBabylonMesh)return;const g=null===(o=this._loader.Ng.extensions)||void 0===o?void 0:o.KHR_xmp_json_ld,E=null===(v=this._loader.Ng.asset)||void 0===v||null===(V=v.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld;if(g&&E){const o=+E.packet;g.packets&&o<g.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=g.packets[o])}}}function cv(o,v,V,g){return I.Lv.bv(v,V).scale(g)}function Rv(o,v,V,g){return v[V]*g}function jv(o,v,V,g){return-v[V]*g}function tv(o,v,V,g){return v[V+1]*g}function sv(o,v,V,g){return v[V]*g*2}function Lv(o){return{scale:[new uv(f.b.ANIMATIONTYPE_FLOAT,`${o}.uScale`,Rv,(()=>2)),new uv(f.b.ANIMATIONTYPE_FLOAT,`${o}.vScale`,tv,(()=>2))],offset:[new uv(f.b.ANIMATIONTYPE_FLOAT,`${o}.uOffset`,Rv,(()=>2)),new uv(f.b.ANIMATIONTYPE_FLOAT,`${o}.vOffset`,tv,(()=>2))],rotation:[new uv(f.b.ANIMATIONTYPE_FLOAT,`${o}.wAng`,jv,(()=>1))]}}w(Sv),W(Sv,!0,(o=>new Tv(o)));class bv extends K.AnimationPropertyInfo{buildAnimations(o,v,V,g){return[{babylonAnimatable:o._babylonCamera,babylonAnimation:this._buildAnimation(v,V,g)}]}}class uv extends K.AnimationPropertyInfo{buildAnimations(o,v,V,g){const E=[];for(const I in o._data)E.push({babylonAnimatable:o._data[I].babylonMaterial,babylonAnimation:this._buildAnimation(v,V,g)});return E}}class mV extends K.AnimationPropertyInfo{buildAnimations(o,v,V,g){return[{babylonAnimatable:o._babylonLight,babylonAnimation:this._buildAnimation(v,V,g)}]}}(0,z.l)("/cameras/{}/orthographic/xmag",[new bv(f.b.ANIMATIONTYPE_FLOAT,"orthoLeft",jv,(()=>1)),new bv(f.b.ANIMATIONTYPE_FLOAT,"orthoRight",tv,(()=>1))]),(0,z.l)("/cameras/{}/orthographic/ymag",[new bv(f.b.ANIMATIONTYPE_FLOAT,"orthoBottom",jv,(()=>1)),new bv(f.b.ANIMATIONTYPE_FLOAT,"orthoTop",tv,(()=>1))]),(0,z.l)("/cameras/{}/orthographic/zfar",[new bv(f.b.ANIMATIONTYPE_FLOAT,"maxZ",Rv,(()=>1))]),(0,z.l)("/cameras/{}/orthographic/znear",[new bv(f.b.ANIMATIONTYPE_FLOAT,"Xg",Rv,(()=>1))]),(0,z.l)("/cameras/{}/perspective/yfov",[new bv(f.b.ANIMATIONTYPE_FLOAT,"fov",Rv,(()=>1))]),(0,z.l)("/cameras/{}/perspective/zfar",[new bv(f.b.ANIMATIONTYPE_FLOAT,"maxZ",Rv,(()=>1))]),(0,z.l)("/cameras/{}/perspective/znear",[new bv(f.b.ANIMATIONTYPE_FLOAT,"Xg",Rv,(()=>1))]),(0,z.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new uv(f.b.ANIMATIONTYPE_COLOR3,"albedoColor",cv,(()=>4)),new uv(f.b.ANIMATIONTYPE_FLOAT,"alpha",(function(o,v,V,g){return v[V+3]*g}),(()=>4))]),(0,z.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"metallic",Rv,(()=>1))]),(0,z.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"roughness",Rv,(()=>1))]);const av=Lv("albedoTexture");(0,z.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",av.scale),(0,z.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",av.offset),(0,z.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",av.rotation);const Fv=Lv("metallicTexture");(0,z.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Fv.scale),(0,z.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Fv.offset),(0,z.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Fv.rotation),(0,z.l)("/materials/{}/emissiveFactor",[new uv(f.b.ANIMATIONTYPE_COLOR3,"emissiveColor",cv,(()=>3))]);const iv=Lv("bumpTexture");(0,z.l)("/materials/{}/normalTexture/scale",[new uv(f.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Rv,(()=>1))]),(0,z.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",iv.scale),(0,z.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",iv.offset),(0,z.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",iv.rotation),(0,z.l)("/materials/{}/occlusionTexture/strength",[new uv(f.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Rv,(()=>1))]);const Jv=Lv("ambientTexture");(0,z.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Jv.scale),(0,z.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Jv.offset),(0,z.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Jv.rotation);const dv=Lv("emissiveTexture");(0,z.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",dv.scale),(0,z.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",dv.offset),(0,z.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",dv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new uv(f.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new uv(f.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Rv,(()=>1))]);const Nv=Lv("anisotropy.texture");(0,z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Nv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Nv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Nv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Rv,(()=>1))]);const Yv=Lv("clearCoat.texture");(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Yv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Yv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Yv.rotation);const qv=Lv("clearCoat.bumpTexture");(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new uv(f.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",qv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",qv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",qv.rotation);const Pv=Lv("clearCoat.textureRoughness");(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Pv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Pv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Pv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new uv(f.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new uv(f.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new uv(f.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new uv(f.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Rv,(()=>1))]);const Mv=Lv("iridescence.texture");(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Mv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Mv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Mv.rotation);const Wv=Lv("iridescence.thicknessTexture");(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Wv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Wv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Wv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new uv(f.b.ANIMATIONTYPE_COLOR3,"sheen.color",cv,(()=>3))]),(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Rv,(()=>1))]);const wv=Lv("sheen.texture");(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",wv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",wv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",wv.rotation);const zv=Lv("sheen.textureRoughness");(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",zv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",zv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",zv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new uv(f.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",cv,(()=>3))]);const yv=Lv("metallicReflectanceTexture");(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",yv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",yv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",yv.rotation);const Hv=Lv("reflectanceTexture");(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Hv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Hv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Hv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Rv,(()=>1))]);const ev=Lv("subSurface.refractionIntensityTexture");(0,z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",ev.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",ev.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",ev.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new uv(f.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",cv,(()=>3))]),(0,z.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new uv(f.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Rv,(()=>1))]),(0,z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Rv,(()=>1))]);const Dv=Lv("subSurface.thicknessTexture");(0,z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Dv.scale),(0,z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Dv.offset),(0,z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Dv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new uv(f.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Rv,(()=>1))]);const Zv=Lv("subSurface.translucencyIntensityTexture");(0,z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Zv.scale),(0,z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Zv.offset),(0,z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Zv.rotation),(0,z.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new uv(f.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",cv,(()=>3))]);const Kv=Lv("subSurface.translucencyColorTexture");(0,z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Kv.scale),(0,z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Kv.offset),(0,z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Kv.rotation),(0,z.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new mV(f.b.ANIMATIONTYPE_COLOR3,"diffuse",cv,(()=>3))]),(0,z.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new mV(f.b.ANIMATIONTYPE_FLOAT,"intensity",Rv,(()=>1))]),(0,z.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new mV(f.b.ANIMATIONTYPE_FLOAT,"range",Rv,(()=>1))]),(0,z.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new mV(f.b.ANIMATIONTYPE_FLOAT,"innerAngle",sv,(()=>1))]),(0,z.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new mV(f.b.ANIMATIONTYPE_FLOAT,"angle",sv,(()=>1))]),(0,z.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new mV(f.b.ANIMATIONTYPE_COLOR3,"diffuse",cv,(()=>3))]),(0,z.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new mV(f.b.ANIMATIONTYPE_FLOAT,"intensity",Rv,(()=>1))]);const Xv="KHR_animation_pointer";class rv{constructor(o){this.name=Xv,this._loader=o,this._pathToObjectConverter=(0,z.j)(this._loader.Ng)}get enabled(){return this._loader.isExtensionUsed(Xv)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(o,v,V,g,E){var I;const Q=null===(I=g.target.extensions)||void 0===I?void 0:I.KHR_animation_pointer;if(!Q||!this._pathToObjectConverter)return null;"pointer"!==g.target.path&&T.b.Warn(`${o}/target/path: Value (${g.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=g.target.node&&T.b.Warn(`${o}/target/node: Value (${g.target.node}) must not be present when using the ${this.name} extension`);const U=`${o}/extensions/${this.name}`,n=Q.pointer;if(!n)throw new Error(`${U}: Pointer is missing`);try{const I=this._pathToObjectConverter.convert(n);if(!I.info.interpolation)throw new Error(`${U}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(o,v,V,g,{object:I.object,info:I.info.interpolation},E)}catch(O){return T.b.Warn(`${U}/pointer: Invalid pointer (${n}) skipped`),null}}}w(Xv),W(Xv,!0,(o=>new rv(o)));class Bv{constructor(o,v,V){this.frame=o,this.action=v,this.onlyOnce=V,this.isDone=!1}_clone(){return new Bv(this.frame,this.action,this.onlyOnce)}}var Av=V(12325),Cv=V(12381),pv=V(12374);class Gv{get loop(){return this._loop}set loop(o){o!==this._loop&&(this._loop=o,this.updateOptions({loop:o}))}get currentTime(){var o;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.audioContext&&(this.isPlaying||this.isPaused)){const o=this.isPaused?0:Cv.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+o}return 0}get spatialSound(){return this._spatialSound}set spatialSound(o){if(o==this._spatialSound)return;const v=this.isPlaying;this.pause(),o?(this._spatialSound=o,this._updateSpatialParameters()):this._disableSpatialSound(),v&&this.play()}constructor(o,v,V){var g;let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new h.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=E.cv.Zero(),this._localDirection=new E.cv(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=o,V=V||S.d.LastCreatedScene)if(this._scene=V,Gv._SceneComponentInitialization(V),this._readyToPlayCallback=I,this._customAttenuationFunction=(o,v,V,g,E)=>v<V?o*(1-v/V):0,U&&(this.autoplay=U.autoplay||!1,this._loop=U.loop||!1,void 0!==U.volume&&(this._volume=U.volume),this._spatialSound=U.spatialSound??!1,this.maxDistance=U.maxDistance??100,this.useCustomAttenuation=U.useCustomAttenuation??!1,this.rolloffFactor=U.rolloffFactor||1,this.refDistance=U.refDistance||1,this.distanceModel=U.distanceModel||"linear",this._playbackRate=U.playbackRate||1,this._streaming=U.streaming??!1,this._length=U.length,this._offset=U.offset),null!==(g=Cv.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&Cv.c.audioEngine.audioContext){this._soundGain=Cv.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let o=!0;if(v)try{"string"===typeof v?(this._urlType="String",this._url=v):v instanceof ArrayBuffer?this._urlType="ArrayBuffer":v instanceof HTMLMediaElement?this._urlType="MediaElement":v instanceof MediaStream?this._urlType="MediaStream":v instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(v)&&(this._urlType="Array");let V=[],g=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Cv.c.audioEngine.audioContext.createMediaElementSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Cv.c.audioEngine.audioContext.createMediaStreamSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":v.byteLength>0&&(g=!0,this._soundLoaded(v));break;case"AudioBuffer":this._audioBufferLoaded(v);break;case"String":V.push(v);case"Array":0===V.length&&(V=v);for(let o=0;o<V.length;o++){const v=V[o];if(g=U&&U.skipCodecCheck||-1!==v.indexOf(".mp3",v.length-4)&&Cv.c.audioEngine.isMP3supported||-1!==v.indexOf(".ogg",v.length-4)&&Cv.c.audioEngine.isOGGsupported||-1!==v.indexOf(".wav",v.length-4)||-1!==v.indexOf(".m4a",v.length-4)||-1!==v.indexOf(".mp4",v.length-4)||-1!==v.indexOf("blob:"),g){this._streaming?(this._htmlAudioElement=new Audio(v),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Q.Tools.SetCorsBehavior(v,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(v,(o=>{this._soundLoaded(o)}),void 0,!0,!0,(o=>{o&&T.b.Error("XHR "+o.status+" error on: "+v+"."),T.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:o=!1}o?g||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):T.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(n){T.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Cv.c.audioEngine&&!Cv.c.audioEngine.WarnedWebAudioUnsupported&&(T.b.Error("Web Audio is not supported by your browser."),Cv.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var o;null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(o){var v;null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.audioContext&&(this._audioBuffer=o,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(o){var v;null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.audioContext&&Cv.c.audioEngine.audioContext.decodeAudioData(o,(o=>{this._audioBufferLoaded(o)}),(o=>{T.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+o)}))}setAudioBuffer(o){var v;null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this._audioBuffer=o,this._isReadyToPlay=!0)}updateOptions(o){o&&(this.loop=o.loop??this.loop,this.maxDistance=o.maxDistance??this.maxDistance,this.useCustomAttenuation=o.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=o.rolloffFactor??this.rolloffFactor,this.refDistance=o.refDistance??this.refDistance,this.distanceModel=o.distanceModel??this.distanceModel,this._playbackRate=o.playbackRate??this._playbackRate,this._length=o.length??void 0,this.spatialSound=o.spatialSound??this._spatialSound,this._setOffset(o.offset??void 0),this.setVolume(o.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var o;null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&Cv.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Cv.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var o;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(o=this._soundPanner)||void 0===o||o.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var o;null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(o){var v;null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(o),this._isOutputConnected=!0)}setDirectionalCone(o,v,V){v<o?T.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=o,this._coneOuterAngle=v,this._coneOuterGain=V,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(o){if(o!=this._coneInnerAngle){var v;if(this._coneOuterAngle<o)return void T.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=o,null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(o){if(o!=this._coneOuterAngle){var v;if(o<this._coneInnerAngle)return void T.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=o,null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(o){var v;o.equals(this._position)||(this._position.U(o),null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(o){var v;this._localDirection=o,null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const o=this._connectedTransformNode.getWorldMatrix(),v=E.cv.TransformNormal(this._localDirection,o);v.normalize(),this._soundPanner.orientationX.value=v.x,this._soundPanner.orientationY.value=v.y,this._soundPanner.orientationZ.value=v.z}updateDistanceFromListener(){var o;if(null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const o=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Rv(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,o,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(o){this._customAttenuationFunction=o}play(o,v,V){var g;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(g=Cv.c.audioEngine)&&void 0!==g&&g.audioContext)try{var E,I;this._clearTimeoutsAndObservers();let g=o?(null===(E=Cv.c.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+o:null===(I=Cv.c.audioEngine)||void 0===I?void 0:I.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Cv.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const o=()=>{var V;if(null!==(V=Cv.c.audioEngine)&&void 0!==V&&V.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=v??0;const V=this._htmlAudioElement.play();void 0!==V&&V.catch((()=>{var v,V;(null===(v=Cv.c.audioEngine)||void 0===v||v.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(V=Cv.c.audioEngine)||void 0===V?void 0:V.onAudioUnlockedObservable.addOnce((()=>{o()})))}))}else{var g;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(g=Cv.c.audioEngine)||void 0===g?void 0:g.onAudioUnlockedObservable.addOnce((()=>{o()}))}};o()}}else{var Q;const E=()=>{var E;if(null!==(E=Cv.c.audioEngine)&&void 0!==E&&E.audioContext){var I;if(V=V||this._length,void 0!==v&&this._setOffset(v),this._soundSource){const o=this._soundSource;o.onended=()=>{o.disconnect()}}if(this._soundSource=null===(I=Cv.c.audioEngine)||void 0===I?void 0:I.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==v&&(this._soundSource.loopStart=v),void 0!==V&&(this._soundSource.loopEnd=(0|v)+V),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},g=o?(null===(Q=Cv.c.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+o:Cv.c.audioEngine.audioContext.currentTime;const E=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(g,E,this.loop?void 0:V)}}};"suspended"===(null===(Q=Cv.c.audioEngine)||void 0===Q?void 0:Q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var o;"suspended"===(null===(o=Cv.c.audioEngine)||void 0===o?void 0:o.audioContext.state)?(Cv.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Cv.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{E()})))):E()}),500):E()}this._startTime=g,this.isPlaying=!0,this.isPaused=!1}catch(U){T.b.Error("Error while trying to play audio: "+this.name+", "+U.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(o){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var V;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(V=this._streamingSource)||void 0===V||V.disconnect();this.isPlaying=!1}else if(null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource){const v=o?Cv.c.audioEngine.audioContext.currentTime+o:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(v)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var o;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var v;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(v=this._streamingSource)||void 0===v||v.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Cv.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(o,v){var V;null!==(V=Cv.c.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._soundGain&&(v&&Cv.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Cv.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Cv.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(o,Cv.c.audioEngine.audioContext.currentTime+v)):this._soundGain.gain.value=o),this._volume=o}setPlaybackRate(o){this._playbackRate=o,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(o){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=o,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=o=>this._onRegisterAfterWorldMatrixUpdate(o),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(o){var v;if(o.getBoundingInfo){const v=o.getBoundingInfo();this.setPosition(v.boundingSphere.centerWorld)}else this.setPosition(o.absolutePosition);null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const o=()=>{(0,pv.d)((()=>this._isReadyToPlay),(()=>{V._audioBuffer=this.getAudioBuffer(),V._isReadyToPlay=!0,V.autoplay&&V.play(0,this._offset,this._length)}),void 0,300)},v={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},V=new Gv(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,v);return this.useCustomAttenuation&&V.setAttenuationFunction(this._customAttenuationFunction),V.setPosition(this._position),V.setPlaybackRate(this._playbackRate),o(),V}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const o={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(o.connectedMeshId=this._connectedTransformNode.id),o.position=this._position.Dg(),o.refDistance=this.refDistance,o.distanceModel=this.distanceModel,o.isDirectional=this._isDirectional,o.localDirectionToMesh=this._localDirection.Dg(),o.coneInnerAngle=this._coneInnerAngle,o.coneOuterAngle=this._coneOuterAngle,o.coneOuterGain=this._coneOuterGain),o}static Parse(o,v,V,g){const I=o.name;let Q;Q=o.url?V+o.url:V+I;const U={autoplay:o.autoplay,loop:o.loop,volume:o.volume,spatialSound:o.spatialSound,maxDistance:o.maxDistance,rolloffFactor:o.rolloffFactor,refDistance:o.refDistance,distanceModel:o.distanceModel,playbackRate:o.playbackRate};let n;if(g){const o=()=>{(0,pv.d)((()=>g._isReadyToPlay),(()=>{n._audioBuffer=g.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,n._offset,n._length)}),void 0,300)};n=new Gv(I,new ArrayBuffer(0),v,null,U),o()}else n=new Gv(I,Q,v,(()=>{v.removePendingData(n)}),U),v.addPendingData(n);if(o.position){const v=E.cv.bv(o.position);n.setPosition(v)}if(o.isDirectional&&(n.setDirectionalCone(o.coneInnerAngle||360,o.coneOuterAngle||360,o.coneOuterGain||0),o.localDirectionToMesh)){const v=E.cv.bv(o.localDirectionToMesh);n.setLocalDirectionToMesh(v)}if(o.connectedMeshId){const V=v.getMeshById(o.connectedMeshId);V&&n.attachToMesh(V)}return o.metadata&&(n.metadata=o.metadata),n}_setOffset(o){this._offset!==o&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=o)}_clearTimeoutsAndObservers(){var o;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(o=Cv.c.audioEngine)||void 0===o||o.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Gv._SceneComponentInitialization=o=>{throw(0,Av.b)("AudioSceneComponent")},(0,bo.h)("BABYLON.Sound",Gv);class kv{constructor(o,v,V){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],v.length!==V.length)throw new Error("Sounds length does not equal weights length");this.loop=o,this._weights=V;let g=0;for(const I of V)g+=I;const E=g>0?1/g:0;for(let I=0;I<this._weights.length;I++)this._weights[I]*=E;this._sounds=v;for(const I of this._sounds)I.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(o){if(o!==this._coneInnerAngle){if(this._coneOuterAngle<o)return void T.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=o;for(const v of this._sounds)v.directionalConeInnerAngle=o}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(o){if(o!==this._coneOuterAngle){if(o<this._coneInnerAngle)return void T.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=o;for(const v of this._sounds)v.directionalConeOuterAngle=o}}get volume(){return this._volume}set volume(o){if(o!==this._volume)for(const v of this._sounds)v.setVolume(o)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(o){if(!this.isPaused){this.stop();const o=Math.random();let v=0;for(let V=0;V<this._weights.length;V++)if(v+=this._weights[V],o<=v){this._currentIndex=V;break}}const v=this._sounds[this._currentIndex??0];v.isReady()?v.play(0,this.isPaused?void 0:o):v.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class oV{constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(o=o||S.d.LastCreatedScene)&&(this._scene=o,this.soundCollection=[],this._options=v,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var o;null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&Cv.c.audioEngine.audioContext&&(this._outputAudioNode=Cv.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Cv.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Cv.c.audioEngine&&Cv.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(o){var v;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&o.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==o.soundTrackId&&(-1===o.soundTrackId?this._scene.mainSoundTrack.removeSound(o):this._scene.soundTracks&&this._scene.soundTracks[o.soundTrackId].removeSound(o)),this.soundCollection.push(o),o.soundTrackId=this.id}removeSound(o){const v=this.soundCollection.indexOf(o);-1!==v&&this.soundCollection.splice(v,1)}setVolume(o){var v;null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=o)}switchPanningModelToHRTF(){var o;if(null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var o;if(null!==(o=Cv.c.audioEngine)&&void 0!==o&&o.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToEqualPower()}connectToAnalyser(o){var v;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=o,null!==(v=Cv.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Cv.c.audioEngine.masterGain))}}var vV=V(12776),VV=V(12747),gV=V(12302);Cv.c.AudioEngineFactory=(o,v,V)=>new EV(o,v,V);class EV{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new h.e,this.onAudioLockedObservable=new h.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,gV.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const g=document.createElement("audio");this._hostElement=o,this._audioContext=v,this._audioDestination=V;try{g&&g.canPlayType&&(g.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||g.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{g&&g.canPlayType&&g.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var o,v;if("running"===(null===(o=this._audioContext)||void 0===o?void 0:o.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(v=this._audioContext)||void 0===v||v.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{T.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var o;null===(o=this._audioContext)||void 0===o||o.addEventListener("statechange",(()=>{var o;this.unlocked&&"running"!==(null===(o=this._audioContext)||void 0===o?void 0:o.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var o;return null!==(o=this._audioContext)&&void 0!==o&&o.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(o){this.canUseWebAudio=!1,T.b.Error("Web Audio: "+o.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(o){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const o=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",v=document.createElement("style");v.appendChild(document.createTextNode(o)),document.getElementsByTagName("head")[0].appendChild(v),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var o;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(o=this._audioContext)||void 0===o||o.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(o){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=o)}connectToAnalyser(o){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=o,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var IV=V(12321);(0,V(13928).g)(vV.d.NAME_AUDIO,((o,v,V,g)=>{let E,I=[];if(V.Ll=V.Ll||[],void 0!==o.Ll&&null!==o.Ll)for(let U=0,n=o.Ll.length;U<n;U++){var Q;const n=o.Ll[U];null!==(Q=Cv.c.audioEngine)&&void 0!==Q&&Q.canUseWebAudio?(n.url||(n.url=n.name),I[n.url]?V.Ll.push(Gv.Parse(n,v,g,I[n.url])):(E=Gv.Parse(n,v,g),I[n.url]=E,V.Ll.push(E))):V.Ll.push(new Gv(n.name,null,v))}I=[]})),Object.defineProperty(VV.b.prototype,"mainSoundTrack",{get:function(){let o=this._getComponent(vV.d.NAME_AUDIO);return o||(o=new QV(this),this.Ig(o)),this._mainSoundTrack||(this._mainSoundTrack=new oV(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),VV.b.prototype.getSoundByName=function(o){let v;for(v=0;v<this.mainSoundTrack.soundCollection.length;v++)if(this.mainSoundTrack.soundCollection[v].name===o)return this.mainSoundTrack.soundCollection[v];if(this.soundTracks)for(let V=0;V<this.soundTracks.length;V++)for(v=0;v<this.soundTracks[V].soundCollection.length;v++)if(this.soundTracks[V].soundCollection[v].name===o)return this.soundTracks[V].soundCollection[v];return null},Object.defineProperty(VV.b.prototype,"audioEnabled",{get:function(){let o=this._getComponent(vV.d.NAME_AUDIO);return o||(o=new QV(this),this.Ig(o)),o.audioEnabled},set:function(o){let v=this._getComponent(vV.d.NAME_AUDIO);v||(v=new QV(this),this.Ig(v)),o?v.enableAudio():v.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(VV.b.prototype,"headphone",{get:function(){let o=this._getComponent(vV.d.NAME_AUDIO);return o||(o=new QV(this),this.Ig(o)),o.headphone},set:function(o){let v=this._getComponent(vV.d.NAME_AUDIO);v||(v=new QV(this),this.Ig(v)),o?v.switchAudioModeForHeadphones():v.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(VV.b.prototype,"audioListenerPositionProvider",{get:function(){let o=this._getComponent(vV.d.NAME_AUDIO);return o||(o=new QV(this),this.Ig(o)),o.audioListenerPositionProvider},set:function(o){let v=this._getComponent(vV.d.NAME_AUDIO);if(v||(v=new QV(this),this.Ig(v)),o&&"function"!==typeof o)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");v.audioListenerPositionProvider=o},enumerable:!0,configurable:!0}),Object.defineProperty(VV.b.prototype,"audioListenerRotationProvider",{get:function(){let o=this._getComponent(vV.d.NAME_AUDIO);return o||(o=new QV(this),this.Ig(o)),o.audioListenerRotationProvider},set:function(o){let v=this._getComponent(vV.d.NAME_AUDIO);if(v||(v=new QV(this),this.Ig(v)),o&&"function"!==typeof o)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");v.audioListenerRotationProvider=o},enumerable:!0,configurable:!0}),Object.defineProperty(VV.b.prototype,"audioPositioningRefreshRate",{get:function(){let o=this._getComponent(vV.d.NAME_AUDIO);return o||(o=new QV(this),this.Ig(o)),o.audioPositioningRefreshRate},set:function(o){let v=this._getComponent(vV.d.NAME_AUDIO);v||(v=new QV(this),this.Ig(v)),v.audioPositioningRefreshRate=o},enumerable:!0,configurable:!0});class QV{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(o){this.name=vV.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new E.cv,this._cachedCameraPosition=new E.cv,this._lastCheck=0,this._invertMatrixTemp=new E.Matrix,this._cameraDirectionTemp=new E.cv,(o=o||S.d.LastCreatedScene)&&(this.jv=o,o.soundTracks=[],o.Ll=[])}register(){this.jv._afterRenderStage.registerStep(vV.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(o){if(o.Ll=[],this.jv.soundTracks)for(let v=0;v<this.jv.soundTracks.length;v++){const V=this.jv.soundTracks[v];for(let v=0;v<V.soundCollection.length;v++)o.Ll.push(V.soundCollection[v].serialize())}}addFromContainer(o){if(o.Ll)for(const v of o.Ll)v.play(),v.autoplay=!0,this.jv.mainSoundTrack.addSound(v)}removeFromContainer(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o.Ll)for(const V of o.Ll)V.stop(),V.autoplay=!1,this.jv.mainSoundTrack.removeSound(V),v&&V.dispose()}dispose(){const o=this.jv;if(o._mainSoundTrack&&o.mainSoundTrack.dispose(),o.soundTracks)for(let v=0;v<o.soundTracks.length;v++)o.soundTracks[v].dispose()}disableAudio(){const o=this.jv;let v;for(this._audioEnabled=!1,Cv.c.audioEngine&&Cv.c.audioEngine.audioContext&&Cv.c.audioEngine.audioContext.suspend(),v=0;v<o.mainSoundTrack.soundCollection.length;v++)o.mainSoundTrack.soundCollection[v].pause();if(o.soundTracks)for(v=0;v<o.soundTracks.length;v++)for(let V=0;V<o.soundTracks[v].soundCollection.length;V++)o.soundTracks[v].soundCollection[V].pause()}enableAudio(){const o=this.jv;let v;for(this._audioEnabled=!0,Cv.c.audioEngine&&Cv.c.audioEngine.audioContext&&Cv.c.audioEngine.audioContext.resume(),v=0;v<o.mainSoundTrack.soundCollection.length;v++)o.mainSoundTrack.soundCollection[v].isPaused&&o.mainSoundTrack.soundCollection[v].play();if(o.soundTracks)for(v=0;v<o.soundTracks.length;v++)for(let V=0;V<o.soundTracks[v].soundCollection.length;V++)o.soundTracks[v].soundCollection[V].isPaused&&o.soundTracks[v].soundCollection[V].play()}switchAudioModeForHeadphones(){const o=this.jv;if(this._headphone=!0,o.mainSoundTrack.switchPanningModelToHRTF(),o.soundTracks)for(let v=0;v<o.soundTracks.length;v++)o.soundTracks[v].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const o=this.jv;if(this._headphone=!1,o.mainSoundTrack.switchPanningModelToEqualPower(),o.soundTracks)for(let v=0;v<o.soundTracks.length;v++)o.soundTracks[v].switchPanningModelToEqualPower()}_afterRender(){const o=IV.e.Now;if(this._lastCheck&&o-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=o;const v=this.jv;if(!this._audioEnabled||!v._mainSoundTrack||!v.soundTracks||0===v._mainSoundTrack.soundCollection.length&&1===v.soundTracks.length)return;const V=Cv.c.audioEngine;if(V&&V.audioContext){let o,g=v.activeCamera;if(v.activeCameras&&v.activeCameras.length>0&&(g=v.activeCameras[0]),this.audioListenerPositionProvider){const o=this.audioListenerPositionProvider();V.audioContext.listener.setPosition(o.x||0,o.y||0,o.z||0)}else g?this._cachedCameraPosition.equals(g.globalPosition)||(this._cachedCameraPosition.U(g.globalPosition),V.audioContext.listener.setPosition(g.globalPosition.x,g.globalPosition.y,g.globalPosition.z)):V.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const o=this.audioListenerRotationProvider();V.audioContext.listener.setOrientation(o.x||0,o.y||0,o.z||0,0,1,0)}else g?(g.rigCameras&&g.rigCameras.length>0&&(g=g.rigCameras[0]),g.getViewMatrix().invertToRef(this._invertMatrixTemp),E.cv.TransformNormalToRef(QV._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.U(this._cameraDirectionTemp),V.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):V.audioContext.listener.setOrientation(0,0,0,0,1,0);for(o=0;o<v.mainSoundTrack.soundCollection.length;o++){const V=v.mainSoundTrack.soundCollection[o];V.useCustomAttenuation&&V.updateDistanceFromListener()}if(v.soundTracks)for(o=0;o<v.soundTracks.length;o++)for(let V=0;V<v.soundTracks[o].soundCollection.length;V++){const g=v.soundTracks[o].soundCollection[V];g.useCustomAttenuation&&g.updateDistanceFromListener()}}}}QV._CameraDirection=new E.cv(0,0,-1),Gv._SceneComponentInitialization=o=>{let v=o._getComponent(vV.d.NAME_AUDIO);v||(v=new QV(o),o.Ig(v))};const UV="MSFT_audio_emitter";class nV{constructor(o){this.name=UV,this._loader=o,this.enabled=this._loader.isExtensionUsed(UV)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const o=this._loader.Ng.extensions;if(o&&o[this.name]){const v=o[this.name];this._clips=v.clips,this._emitters=v.emitters,e.Assign(this._clips),e.Assign(this._emitters)}}loadSceneAsync(o,v){return Z.LoadExtensionAsync(o,v,this.name,(async(V,g)=>{const E=new Array;E.push(this._loader.loadSceneAsync(o,v));for(const o of g.emitters){const v=e.Get(`${V}/emitters`,this._emitters,o);if(void 0!=v.refDistance||void 0!=v.maxDistance||void 0!=v.rolloffFactor||void 0!=v.distanceModel||void 0!=v.innerAngle||void 0!=v.outerAngle)throw new Error(`${V}: Direction or Distance properties are not allowed on emitters attached to a scene`);E.push(this._loadEmitterAsync(`${V}/emitters/${v.index}`,v))}await Promise.all(E)}))}loadNodeAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(o,g)=>{const I=new Array,U=await this._loader.loadNodeAsync(o,v,(v=>{for(const V of g.emitters){const g=e.Get(`${o}/emitters`,this._emitters,V);I.push(this._loadEmitterAsync(`${o}/emitters/${g.index}`,g).then((()=>{for(const o of g._babylonSounds)o.attachToMesh(v),void 0==g.innerAngle&&void 0==g.outerAngle||(o.setLocalDirectionToMesh(E.cv.Forward()),o.setDirectionalCone(2*Q.Tools.ToDegrees(void 0==g.innerAngle?Math.PI:g.innerAngle),2*Q.Tools.ToDegrees(void 0==g.outerAngle?Math.PI:g.outerAngle),0))})))}V(v)}));return await Promise.all(I),U}))}loadAnimationAsync(o,v){return Z.LoadExtensionAsync(o,v,this.name,(async(V,g)=>{const E=await this._loader.loadAnimationAsync(o,v),I=new Array;e.Assign(g.events);for(const Q of g.events)I.push(this._loadAnimationEventAsync(`${V}/events/${Q.index}`,o,v,Q,E));return await Promise.all(I),E}))}_loadClipAsync(o,v){if(v._objectURL)return v._objectURL;let V;if(v.uri)V=this._loader.loadUriAsync(o,v,v.uri);else{const g=e.Get(`${o}/bufferView`,this._loader.Ng.bufferViews,v.bufferView);V=this._loader.loadBufferViewAsync(`/bufferViews/${g.index}`,g)}return v._objectURL=V.then((o=>URL.createObjectURL(new Blob([o],{type:v.mimeType})))),v._objectURL}_loadEmitterAsync(o,v){if(v._babylonSounds=v._babylonSounds||[],!v._babylonData){const o=new Array,V=v.name||`emitter${v.index}`,g={loop:!1,autoplay:!1,volume:void 0==v.volume?1:v.volume};for(let I=0;I<v.clips.length;I++){const E=`/extensions/${this.name}/clips`,Q=e.Get(E,this._clips,v.clips[I].clip);o.push(this._loadClipAsync(`${E}/${v.clips[I].clip}`,Q).then((o=>{const E=v._babylonSounds[I]=new Gv(V,o,this._loader.babylonScene,null,g);E.refDistance=v.refDistance||1,E.maxDistance=v.maxDistance||256,E.rolloffFactor=v.rolloffFactor||1,E.distanceModel=v.distanceModel||"exponential"})))}const E=Promise.all(o).then((()=>{const o=v.clips.map((o=>o.weight||1)),V=new kv(v.loop||!1,v._babylonSounds,o);v.innerAngle&&(V.directionalConeInnerAngle=2*Q.Tools.ToDegrees(v.innerAngle)),v.outerAngle&&(V.directionalConeOuterAngle=2*Q.Tools.ToDegrees(v.outerAngle)),v.volume&&(V.volume=v.volume),v._babylonData.sound=V}));v._babylonData={loaded:E}}return v._babylonData.loaded}_getEventAction(o,v,V,g,E){switch(V){case"play":return o=>{const V=(E||0)+(o-g);v.play(V)};case"stop":return()=>{v.stop()};case"pause":return()=>{v.pause()};default:throw new Error(`${o}: Unsupported action ${V}`)}}_loadAnimationEventAsync(o,v,V,g,E){if(0==E.targetedAnimations.length)return Promise.resolve();const I=E.targetedAnimations[0],Q=g.lo,U=e.Get(`/extensions/${this.name}/emitters`,this._emitters,Q);return this._loadEmitterAsync(o,U).then((()=>{const v=U._babylonData.sound;if(v){const V=new Bv(g.time,this._getEventAction(o,v,g.action,g.time,g.startOffset));I.animation.addEvent(V),E.onAnimationGroupEndObservable.add((()=>{v.stop()})),E.onAnimationGroupPauseObservable.add((()=>{v.pause()}))}}))}}w(UV),W(UV,!0,(o=>new nV(o)));const OV="MSFT_lod";class hV{constructor(o){var v;this.name=OV,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new h.e,this.onMaterialLODsLoadedObservable=new h.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=o,this.maxLODsToLoad=(null===(v=this._loader.parent.extensionOptions[OV])||void 0===v?void 0:v.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(OV)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let o=0;o<this._nodePromiseLODs.length;o++){const v=Promise.all(this._nodePromiseLODs[o]).then((()=>{0!==o&&(this._loader.endPerformanceCounter(`Node LOD ${o}`),this._loader.log(`Loaded node LOD ${o}`)),this.onNodeLODsLoadedObservable.notifyObservers(o),o!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${o+1}`),this._loadBufferLOD(this._nodeBufferLODs,o+1),this._nodeSignalLODs[o]&&this._nodeSignalLODs[o].resolve())}));this._loader._completePromises.push(v)}for(let o=0;o<this._materialPromiseLODs.length;o++){const v=Promise.all(this._materialPromiseLODs[o]).then((()=>{0!==o&&(this._loader.endPerformanceCounter(`Material LOD ${o}`),this._loader.log(`Loaded material LOD ${o}`)),this.onMaterialLODsLoadedObservable.notifyObservers(o),o!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${o+1}`),this._loadBufferLOD(this._materialBufferLODs,o+1),this._materialSignalLODs[o]&&this._materialSignalLODs[o].resolve())}));this._loader._completePromises.push(v)}}loadSceneAsync(o,v){const V=this._loader.loadSceneAsync(o,v);return this._loadBufferLOD(this._bufferLODs,0),V}loadNodeAsync(o,v,V){return Z.LoadExtensionAsync(o,v,this.name,(async(o,E)=>{let I;const Q=this._getLODs(o,v,this._loader.Ng.nodes,E.ids);this._loader.logOpen(`${o}`);for(let v=0;v<Q.length;v++){const o=Q[v];0!==v&&(this._nodeIndexLOD=v,this._nodeSignalLODs[v]=this._nodeSignalLODs[v]||new g);const E=o=>{V(o),o.eU(!1)},U=this._loader.loadNodeAsync(`/nodes/${o.index}`,o,E).then((o=>{if(0!==v){const o=Q[v-1];o._babylonTransformNode&&(this._disposeTransformNode(o._babylonTransformNode),delete o._babylonTransformNode)}return o.eU(!0),o}));this._nodePromiseLODs[v]=this._nodePromiseLODs[v]||[],0===v?I=U:(this._nodeIndexLOD=null,this._nodePromiseLODs[v].push(U))}return this._loader.logClose(),await I}))}_loadMaterialAsync(o,v,V,g,E){return this._nodeIndexLOD?null:Z.LoadExtensionAsync(o,v,this.name,(async(o,I)=>{let Q;const U=this._getLODs(o,v,this._loader.Ng.materials,I.ids);this._loader.logOpen(`${o}`);for(let v=0;v<U.length;v++){const o=U[v];0!==v&&(this._materialIndexLOD=v);const I=this._loader._loadMaterialAsync(`/materials/${o.index}`,o,V,g,(o=>{0===v&&E(o)})).then((o=>{if(0!==v){E(o);const V=U[v-1]._data;V[g]&&(this._disposeMaterials([V[g].babylonMaterial]),delete V[g])}return o}));this._materialPromiseLODs[v]=this._materialPromiseLODs[v]||[],0===v?Q=I:(this._materialIndexLOD=null,this._materialPromiseLODs[v].push(I))}return this._loader.logClose(),await Q}))}_loadUriAsync(o,v,V){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const E=this._nodeIndexLOD-1;return this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new g,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(o,v,V)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new g,this._materialSignalLODs[E].promise.then((async()=>await this._loader.loadUriAsync(o,v,V)))}return null}loadBufferAsync(o,v,V,E){if(this._loader.parent.useRangeRequests&&!v.uri){if(!this._loader.bin)throw new Error(`${o}: Uri is missing or the binary glTF is missing its binary chunk`);const v=async(o,v)=>{const I=V,Q=I+E-1;let U=o[v];return U?(U.start=Math.min(U.start,I),U.end=Math.max(U.end,Q)):(U={start:I,end:Q,loaded:new g},o[v]=U),await U.loaded.promise.then((o=>new Uint8Array(o.buffer,o.byteOffset+V-U.start,E)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?v(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?v(this._materialBufferLODs,this._materialIndexLOD):v(this._bufferLODs,0)}return null}_loadBufferLOD(o,v){const V=o[v];V&&(this._loader.log(`Loading buffer range [${V.start}-${V.end}]`),this._loader.bin.readAsync(V.start,V.end-V.start+1).then((o=>{V.loaded.resolve(o)}),(o=>{V.loaded.reject(o)})))}_getLODs(o,v,V,g){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const E=[];for(let I=g.length-1;I>=0;I--)if(E.push(e.Get(`${o}/ids/${g[I]}`,V,g[I])),E.length===this.maxLODsToLoad)return E;return E.push(v),E}_disposeTransformNode(o){const v=[],V=o.material;V&&v.push(V);for(const E of o.getChildMeshes())E.material&&v.push(E.material);o.dispose();const g=v.filter((o=>this._loader.babylonScene.meshes.every((v=>v.material!=o))));this._disposeMaterials(g)}_disposeMaterials(o){const v={};for(const V of o){for(const o of V.getActiveTextures())v[o.uniqueId]=o;V.dispose()}for(const V in v)for(const o of this._loader.babylonScene.materials)o.hasTexture(v[V])&&delete v[V];for(const V in v)v[V].dispose()}}w(OV),W(OV,!0,(o=>new hV(o)));const xV="MSFT_minecraftMesh";class fV{constructor(o){this.name=xV,this._loader=o,this.enabled=this._loader.isExtensionUsed(xV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtraAsync(o,v,this.name,(async(g,E)=>{if(E){if(!(V instanceof t.d))throw new Error(`${g}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(o,v,V);return V.needAlphaBlending()&&(V.forceDepthWrite=!0,V.separateCullingPass=!0),V.cU=V.forceDepthWrite,V.twoSidedLighting=!0,await E}}))}}w(xV),W(xV,!0,(o=>new fV(o)));const lV="MSFT_sRGBFactors";class SV{constructor(o){this.name=lV,this._loader=o,this.enabled=this._loader.isExtensionUsed(lV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,v,V){return Z.LoadExtraAsync(o,v,this.name,(async(g,E)=>{if(E){if(!(V instanceof t.d))throw new Error(`${g}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(o,v,V),I=V.Fo().getEngine().useExactSrgbConversions;return V.albedoTexture||V.albedoColor.toLinearSpaceToRef(V.albedoColor,I),V.reflectivityTexture||V.reflectivityColor.toLinearSpaceToRef(V.reflectivityColor,I),await E}}))}}w(lV),W(lV,!0,(o=>new SV(o)));var TV=V(14229);const cV={};var RV=V(14275),jV=V(14250),tV=V(14231),sV=V(14241);function LV(o,v){for(const V of o)for(const o of V.dataOutputs)if(o.uniqueId===v)return o;throw new Error("Could not find data out connection with unique id "+v)}function bV(o,v){for(const V of o)if(V instanceof jV.b)for(const o of V.signalInputs)if(o.uniqueId===v)return o;throw new Error("Could not find signal in connection with unique id "+v)}async function uV(o,v){const g=await Promise.all(o.allBlocks.map((async o=>{const v=function(o){switch(o){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([V.e(78),V.e(79)]).then(V.bind(V,15674))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await V.e(80).then(V.bind(V,15676))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await V.e(81).then(V.bind(V,15681))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await V.e(82).then(V.bind(V,15690))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await V.e(83).then(V.bind(V,15695))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await V.e(84).then(V.bind(V,15702))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await V.e(85).then(V.bind(V,15704))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await V.e(86).then(V.bind(V,15707))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await V.e(87).then(V.bind(V,15712))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await V.e(90).then(V.bind(V,15743))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await V.e(90).then(V.bind(V,15743))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await V.e(90).then(V.bind(V,15743))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await V.e(90).then(V.bind(V,15743))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await V.e(95).then(V.bind(V,15746))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await V.e(96).then(V.bind(V,15753))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await V.e(97).then(V.bind(V,15760))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await V.e(98).then(V.bind(V,15762))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await V.e(99).then(V.bind(V,15764))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await V.e(100).then(V.bind(V,15773))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await V.e(101).then(V.bind(V,15776))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await V.e(102).then(V.bind(V,15782))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await V.e(103).then(V.bind(V,15788))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await V.e(104).then(V.bind(V,15792))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await V.e(105).then(V.bind(V,15798))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await V.e(106).then(V.bind(V,15803))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await V.e(107).then(V.bind(V,15805))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await V.e(108).then(V.bind(V,15810))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await V.e(109).then(V.bind(V,15814))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await V.e(110).then(V.bind(V,15823))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await V.e(111).then(V.bind(V,15830))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await V.e(112).then(V.bind(V,15833))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await V.e(113).then(V.bind(V,15838))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await V.e(92).then(V.bind(V,15841))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await V.e(114).then(V.bind(V,15849))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await V.e(115).then(V.bind(V,15851))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await V.e(116).then(V.bind(V,15857))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await V.e(93).then(V.bind(V,15863))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await V.e(88).then(V.bind(V,15719))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await V.e(94).then(V.bind(V,15869))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await V.e(89).then(V.bind(V,15734))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await V.e(90).then(V.bind(V,15743))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await V.e(90).then(V.bind(V,15743))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await V.e(91).then(V.bind(V,15873))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await V.e(91).then(V.bind(V,15873))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await V.e(91).then(V.bind(V,15873))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await V.e(91).then(V.bind(V,15873))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await V.e(91).then(V.bind(V,15873))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await V.e(91).then(V.bind(V,15873))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await V.e(117).then(V.bind(V,15877))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await V.e(118).then(V.bind(V,15882))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await V.e(119).then(V.bind(V,15885))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await V.e(120).then(V.bind(V,15893))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await V.e(121).then(V.bind(V,15895))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await V.e(122).then(V.bind(V,15902))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await V.e(123).then(V.bind(V,15907))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await V.e(124).then(V.bind(V,15912))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await V.e(125).then(V.bind(V,15920))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await V.e(126).then(V.bind(V,15927))).FlowGraphDataSwitchBlock;default:if(cV[o])return cV[o];throw new Error(`Unknown block name ${o}`)}}(o.className);return await v()})));return function(o,v,V){const g=v.coordinator.createGraph(),E=[],I=v.valueParseFunction??tV.b;for(let Q=0;Q<o.allBlocks.length;Q++){const U=aV(o.allBlocks[Q],{jv:v.coordinator.config.jv,pathConverter:v.pathConverter,assetsContainer:v.coordinator.config.jv,valueParseFunction:I},V[Q]);E.push(U),U instanceof RV.e&&g.addEventBlock(U)}for(const Q of E){for(const o of Q.dataInputs)for(const v of o.connectedPointIds){const V=LV(E,v);o.connectTo(V)}if(Q instanceof jV.b)for(const o of Q.signalOutputs)for(const v of o.connectedPointIds){const V=bV(E,v);o.connectTo(V)}}for(const Q of o.executionContexts)mg(Q,{graph:g,valueParseFunction:I},o.rightHanded);return g}(o,v,g)}function mg(o,v,V){const g=v.graph.createContext();o.enableLogging&&(g.enableLogging=!0),g.treatDataAsRightHanded=V||!1;const E=v.valueParseFunction??tV.b;g.uniqueId=o.uniqueId;const I=g.Fo();if(o._assetsContext){var Q,U,n,O,h,x,f,l,S,T;const v=o._assetsContext,V={meshes:null===(Q=v.meshes)||void 0===Q?void 0:Q.map((o=>I.getMeshById(o))),lights:null===(U=v.lights)||void 0===U?void 0:U.map((o=>I.getLightByName(o))),cameras:null===(n=v.cameras)||void 0===n?void 0:n.map((o=>I.getCameraByName(o))),materials:null===(O=v.materials)||void 0===O?void 0:O.map((o=>I.getMaterialById(o))),textures:null===(h=v.textures)||void 0===h?void 0:h.map((o=>I.getTextureByName(o))),animations:null===(x=v.animations)||void 0===x?void 0:x.map((o=>I.animations.find((v=>v.name===o)))),skeletons:null===(f=v.skeletons)||void 0===f?void 0:f.map((o=>I.getSkeletonByName(o))),Mf:null===(l=v.Mf)||void 0===l?void 0:l.map((o=>I.getParticleSystemById(o))),animationGroups:null===(S=v.animationGroups)||void 0===S?void 0:S.map((o=>I.getAnimationGroupByName(o))),transformNodes:null===(T=v.transformNodes)||void 0===T?void 0:T.map((o=>I.getTransformNodeById(o))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Ll:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};g.assetsContext=V}for(const c in o._userVariables){const v=E(c,o._userVariables,g.assetsContext,I);g.userVariables[c]=v}for(const c in o._connectionValues){const v=E(c,o._connectionValues,g.assetsContext,I);g._setConnectionValueByKey(c,v)}return g}function aV(o,v,V){const g={},E=v.valueParseFunction??tV.b;if(o.config)for(const Q in o.config)g[Q]=E(Q,o.config,v.assetsContainer||v.jv,v.jv);if((0,tV.h)(o.className)){if(!v.pathConverter)throw new Error("Path converter is required for this block");g.pathConverter=v.pathConverter}const I=new V(g);I.uniqueId=o.uniqueId;for(let Q=0;Q<o.dataInputs.length;Q++){const v=I.getDataInput(o.dataInputs[Q].name);if(!v)throw new Error("Could not find data input with name "+o.dataInputs[Q].name+" in block "+o.className);v.deserialize(o.dataInputs[Q])}for(let Q=0;Q<o.dataOutputs.length;Q++){const v=I.getDataOutput(o.dataOutputs[Q].name);if(!v)throw new Error("Could not find data output with name "+o.dataOutputs[Q].name+" in block "+o.className);v.deserialize(o.dataOutputs[Q])}return I.metadata=o.metadata,I.deserialize&&I.deserialize(o),I}function FV(o){const[v,V]=o.split(":");return iV({op:v,extension:V})}function iV(o){var v;let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const g=o.extension?null===(v=dV[o.extension])||void 0===v?void 0:v[o.op]:NV[o.op];if(!g&&(T.b.Warn(`No mapping found for operation ${o.op} and extension ${o.extension||"KHR_interactivity"}`),V)){const v={},V={flows:{}};if(o.inputValueSockets){v.values={};for(const V in o.inputValueSockets)v.values[V]={name:V}}return o.outputValueSockets&&(V.values={},Object.keys(o.outputValueSockets).forEach((o=>{V.values[o]={name:o}}))),{bh:[],inputs:v,outputs:V}}return g}function JV(o,v,V){dV[v]||(dV[v]={}),dV[v][o]=V}const dV={BABYLON:{"flow/log":{bh:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},NV={"event/onStart":{bh:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{bh:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{bh:["FlowGraphSendCustomEventBlock"],extraProcessor(o,v,V,g,E){if("event/send"!==v.op||!o.configuration||1!==Object.keys(o.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const I=o.configuration.event.value[0];if("number"!==typeof I)throw new Error("Event id should be a number");const Q=g.arrays.events[I],U=E[0];return U.config||(U.config={}),U.config.eventId=Q.eventId,U.config.eventData=Q.eventData,E}},"event/receive":{bh:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(o,v){var V;if(!o.configuration)return T.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const g=o.configuration.event;if(!g)return T.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const E=g.value[0];if("number"!==typeof E)return T.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(V=v.events)||void 0===V?void 0:V[E])?{valid:!0}:(T.b.Error(`Event with id ${E} not found`),{valid:!1,error:`Event with id ${E} not found`})},extraProcessor(o,v,V,g,E){if("event/receive"!==v.op||!o.configuration||1!==Object.keys(o.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const I=o.configuration.event.value[0];if("number"!==typeof I)throw new Error("Event id should be a number");const Q=g.arrays.events[I],U=E[0];return U.config||(U.config={}),U.config.eventId=Q.eventId,U.config.eventData=Q.eventData,E}},"math/e":YV("FlowGraphEBlock"),"math/pi":YV("FlowGraphPIBlock"),"math/inf":YV("FlowGraphInfBlock"),"math/nan":YV("FlowGraphNaNBlock"),"math/abs":YV("FlowGraphAbsBlock"),"math/sign":YV("FlowGraphSignBlock"),"math/trunc":YV("FlowGraphTruncBlock"),"math/floor":YV("FlowGraphFloorBlock"),"math/ceil":YV("FlowGraphCeilBlock"),"math/round":{bh:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E){var I;return(I=E[0]).config||(I.config={}),E[0].config.roundHalfAwayFromZero=!0,E}},"math/fract":YV("FlowGraphFractBlock"),"math/neg":YV("FlowGraphNegationBlock"),"math/add":YV("FlowGraphAddBlock",["a","b"],!0),"math/sub":YV("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{bh:["FlowGraphMultiplyBlock"],extraProcessor(o,v,V,g,E){var I;(I=E[0]).config||(I.config={}),E[0].config.useMatrixPerComponent=!0,E[0].config.preventIntegerFloatArithmetic=!0;let Q=-1;return Object.keys(o.values||{}).find((v=>{var V;return void 0!==(null===(V=o.values)||void 0===V?void 0:V[v].type)&&(Q=o.values[v].type,!0)})),-1!==Q&&(E[0].config.type=g.arrays.types[Q].flowGraphType),E},validation:o=>o.values?qV(o):{valid:!0}},"math/div":YV("FlowGraphDivideBlock",["a","b"],!0),"math/rem":YV("FlowGraphModuloBlock",["a","b"]),"math/min":YV("FlowGraphMinBlock",["a","b"]),"math/max":YV("FlowGraphMaxBlock",["a","b"]),"math/clamp":YV("FlowGraphClampBlock",["a","b","c"]),"math/saturate":YV("FlowGraphSaturateBlock"),"math/mix":YV("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":YV("FlowGraphEqualityBlock",["a","b"]),"math/lt":YV("FlowGraphLessThanBlock",["a","b"]),"math/le":YV("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":YV("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":YV("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":YV("FlowGraphIsNaNBlock"),"math/isinf":YV("FlowGraphIsInfBlock"),"math/select":{bh:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{bh:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":YV("FlowGraphSinBlock"),"math/cos":YV("FlowGraphCosBlock"),"math/tan":YV("FlowGraphTanBlock"),"math/asin":YV("FlowGraphASinBlock"),"math/acos":YV("FlowGraphACosBlock"),"math/atan":YV("FlowGraphATanBlock"),"math/atan2":YV("FlowGraphATan2Block",["a","b"]),"math/sinh":YV("FlowGraphSinhBlock"),"math/cosh":YV("FlowGraphCoshBlock"),"math/tanh":YV("FlowGraphTanhBlock"),"math/asinh":YV("FlowGraphASinhBlock"),"math/acosh":YV("FlowGraphACoshBlock"),"math/atanh":YV("FlowGraphATanhBlock"),"math/exp":YV("FlowGraphExponentialBlock"),"math/log":YV("FlowGraphLogBlock"),"math/log2":YV("FlowGraphLog2Block"),"math/log10":YV("FlowGraphLog10Block"),"math/sqrt":YV("FlowGraphSquareRootBlock"),"math/cbrt":YV("FlowGraphCubeRootBlock"),"math/pow":YV("FlowGraphPowerBlock",["a","b"]),"math/length":YV("FlowGraphLengthBlock"),"math/normalize":YV("FlowGraphNormalizeBlock"),"math/dot":YV("FlowGraphDotBlock",["a","b"]),"math/cross":YV("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":YV("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":YV("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{bh:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{bh:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{bh:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{bh:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{bh:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{bh:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{bh:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":YV("FlowGraphTransposeBlock"),"math/determinant":YV("FlowGraphDeterminantBlock"),"math/inverse":YV("FlowGraphInvertMatrixBlock"),"math/matmul":YV("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{bh:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"jU",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E,I){const Q=E[0].dataInputs.find((o=>"rotationQuaternion"===o.name));if(!Q)throw new Error("Rotation quaternion input not found");return I._connectionValues[Q.uniqueId]&&(I._connectionValues[Q.uniqueId].type="Quaternion"),E}},"math/matDecompose":{bh:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"jU"}}}},"math/quatConjugate":YV("FlowGraphConjugateBlock",["a"]),"math/quatMul":{bh:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E){var I;return(I=E[0]).config||(I.config={}),E[0].config.type="Quaternion",E}},"math/quatAngleBetween":YV("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{bh:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":YV("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":YV("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{bh:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E){var I;return(I=E[0]).config||(I.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract2x2":{bh:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{bh:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E){var I;return(I=E[0]).config||(I.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract3x3":{bh:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{bh:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E){var I;return(I=E[0]).config||(I.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract4x4":{bh:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{bh:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E,I){var Q,U;(U=E[0]).config||(U.config={});const n=E[0].dataInputs[0];return E[0].config.valueType=(null===(Q=I._connectionValues[n.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",E}},"math/and":{bh:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E,I){var Q,U,n;(n=E[0]).config||(n.config={});const O=E[0].dataInputs[0],h=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=I._connectionValues[O.uniqueId])||void 0===Q?void 0:Q.type)??(null===(U=I._connectionValues[h.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",E}},"math/or":{bh:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E,I){var Q,U,n;(n=E[0]).config||(n.config={});const O=E[0].dataInputs[0],h=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=I._connectionValues[O.uniqueId])||void 0===Q?void 0:Q.type)??(null===(U=I._connectionValues[h.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",E}},"math/xor":{bh:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,v,V,g,E,I){var Q,U,n;(n=E[0]).config||(n.config={});const O=E[0].dataInputs[0],h=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=I._connectionValues[O.uniqueId])||void 0===Q?void 0:Q.type)??(null===(U=I._connectionValues[h.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",E}},"math/asr":YV("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":YV("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":YV("FlowGraphLeadingZerosBlock"),"math/ctz":YV("FlowGraphTrailingZerosBlock"),"math/popcnt":YV("FlowGraphOneBitsCounterBlock"),"math/rad":YV("FlowGraphDegToRadBlock"),"math/deg":YV("FlowGraphRadToDegBlock"),"type/boolToInt":YV("FlowGraphBooleanToInt"),"type/boolToFloat":YV("FlowGraphBooleanToFloat"),"type/intToBool":YV("FlowGraphIntToBoolean"),"type/intToFloat":YV("FlowGraphIntToFloat"),"type/floatToInt":YV("FlowGraphFloatToInt"),"type/floatToBool":YV("FlowGraphFloatToBoolean"),"flow/sequence":{bh:["FlowGraphSequenceBlock"],extraProcessor(o,v,V,g,E){const I=E[0];return I.config||(I.config={}),I.config.outputSignalCount=Object.keys(o.flows||[]).length,I.signalOutputs.forEach(((o,v)=>{o.name="out_"+v})),E}},"flow/branch":{bh:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{bh:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(o){if(o.configuration&&o.configuration.cases){const v=o.configuration.cases.value;if(!v.every((o=>"number"===typeof o&&/^-?\d+$/.test(o.toString()))))return T.b.Warn("Switch cases should be integers. Using empty array instead."),o.configuration.cases.value=[],{valid:!0};const V=new Set(v);o.configuration.cases.value=Array.from(V)}return{valid:!0}},extraProcessor(o,v,V,g,E){if("flow/switch"!==v.op||!o.flows||0===Object.keys(o.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return E[0].signalOutputs.forEach((o=>{"default"!==o.name&&(o.name="out_"+o.name)})),E}},"flow/while":{bh:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{bh:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(o,v,V,g,E){const I=E[0];return I.config||(I.config={}),I.config.incrementIndexWhenLoopDone=!0,E}},"flow/doN":{bh:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{bh:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(o,v,V,g,E){if("flow/multiGate"!==v.op||!o.flows||0===Object.keys(o.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const I=E[0];return I.config||(I.config={}),I.config.outputSignalCount=Object.keys(o.flows).length,I.signalOutputs.forEach(((o,v)=>{o.name="out_"+v})),E}},"flow/waitAll":{bh:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(o){var v,V;return"number"!==typeof(null===(v=o.configuration)||void 0===v||null===(V=v.inputFlows)||void 0===V?void 0:V.value[0])&&(o.configuration=o.configuration||{inputFlows:{value:[0]}},o.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{bh:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{bh:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{bh:["FlowGraphCancelDelayBlock"]},"variable/get":{bh:["FlowGraphGetVariableBlock"],validation(o){var v,V;return null!==(v=o.configuration)&&void 0!==v&&null!==(V=v.variable)&&void 0!==V&&V.value?{valid:!0}:(T.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(o,v)=>[v.getVariableName(o[0])]}}},"variable/set":{bh:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(o,v)=>[v.getVariableName(o[0])]}}},"variable/setMultiple":{bh:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(o,v)=>[o[0].map((o=>v.getVariableName(o)))]}},extraProcessor:(o,v,V,g,E)=>(E[0].dataInputs.forEach((o=>{o.name=g.getVariableName(+o.name)})),E)},"variable/interpolate":{bh:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(o,v)=>[v.getVariableName(o[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:o=>!0===o[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",uV:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",uV:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",uV:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",uV:"FlowGraphPlayAnimationBlock"},out:{name:"out",uV:"FlowGraphPlayAnimationBlock"},done:{name:"done",uV:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(o,v,V,g,E){var I,Q,U;const n=E[0],O=null===(I=o.configuration)||void 0===I?void 0:I.variable.value[0];if("number"!==typeof O)throw T.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const h=g.arrays.staticVariables[O];"undefined"===typeof n.config.animationType.value&&(g.arrays.staticVariables,n.config.animationType.value=(0,sV.H)(h.type));const x=E[4];return x.config||(x.config={}),(Q=x.config).variable||(Q.variable={}),x.config.variable.value=g.getVariableName(O),(U=E[3]).config||(U.config={}),E}},"pointer/get":{bh:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",uV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",uV:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(o,v,V,g,E)=>(E.forEach((o=>{"FlowGraphJsonPointerParserBlock"===o.className&&(o.config||(o.config={}),o.config.outputValue=!0)})),E)},"pointer/set":{bh:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",uV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",uV:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(o,v,V,g,E)=>(E.forEach((o=>{"FlowGraphJsonPointerParserBlock"===o.className&&(o.config||(o.config={}),o.config.outputValue=!0)})),E)},"pointer/interpolate":{bh:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",uV:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",uV:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",uV:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",uV:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",uV:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",uV:"FlowGraphPlayAnimationBlock"},out:{name:"out",uV:"FlowGraphPlayAnimationBlock"},done:{name:"done",uV:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(o,v,V,g,E)=>(E.forEach((v=>{"FlowGraphJsonPointerParserBlock"===v.className?(v.config||(v.config={}),v.config.outputValue=!0):"FlowGraphInterpolationBlock"===v.className&&(v.config||(v.config={}),Object.keys(o.values||[]).forEach((V=>{var E;const I=null===(E=o.values)||void 0===E?void 0:E[V];if("value"===V&&I){const o=I.type;void 0!==o&&(v.config.animationType=g.arrays.types[o].flowGraphType)}})))})),E)},"animation/start":{bh:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",uV:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(o,v)=>[o[0]*v._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(o,v)=>[o[0]*v._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(o,v,V,g,E,I,Q){const U=E[E.length-1];return U.config||(U.config={}),U.config.glTF=Q,E}},"animation/stop":{bh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",uV:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(o,v,V,g,E,I,Q){const U=E[E.length-1];return U.config||(U.config={}),U.config.glTF=Q,E}},"animation/stopAt":{bh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",uV:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(o,v)=>[o[0]*v._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(o,v,V,g,E,I,Q){const U=E[E.length-1];return U.config||(U.config={}),U.config.glTF=Q,E}},"math/switch":{bh:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(o){if(o.configuration&&o.configuration.cases){const v=o.configuration.cases.value;if(!v.every((o=>"number"===typeof o&&/^-?\d+$/.test(o.toString()))))return T.b.Warn("Switch cases should be integers. Using empty array instead."),o.configuration.cases.value=[],{valid:!0};const V=new Set(v);o.configuration.cases.value=Array.from(V)}return{valid:!0}},extraProcessor(o,v,V,g,E){const I=E[0];return I.dataInputs.forEach((o=>{"default"!==o.name&&"case"!==o.name&&(o.name="in_"+o.name)})),I.config||(I.config={}),I.config.treatCasesAsIntegers=!0,E}},"debug/log":{bh:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function YV(o){let v=arguments.length>2?arguments[2]:void 0;return{bh:[o],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((o,v)=>(o[v]={name:v},o)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(o,V,g,E,I){var Q;if(v){(Q=I[0]).config||(Q.config={}),I[0].config.preventIntegerFloatArithmetic=!0;let v=-1;Object.keys(o.values||{}).find((V=>{var g;return void 0!==(null===(g=o.values)||void 0===g?void 0:g[V].type)&&(v=o.values[V].type,!0)})),-1!==v&&(I[0].config.type=E.arrays.types[v].flowGraphType)}return I},validation:o=>v?qV(o):{valid:!0}}}function qV(o){if(o.values){const v=Object.keys(o.values).map((v=>o.values[v].type)).filter((o=>void 0!==o));if(!v.every((o=>o===v[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}NV["math/compose"]=NV["math/matCompose"],NV["math/decompose"]=NV["math/matDecompose"];var PV=V(12452);const MV={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"cv",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class WV{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=o,this._gltf=v,this._animationTargetFps=V,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const o of this._interactivityGraph.types)this._types.push(MV[o.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const o of this._interactivityGraph.declarations){const v=iV(o);if(!v)throw T.b.Error(["No mapping found for declaration",o]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:v,fullOperationName:o.extension?o.op+":"+o.extension:o.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const o of this._interactivityGraph.variables){const v=this._parseVariable(o);this._staticVariables.push(v)}}_parseVariable(o,v){const V=this._types[o.type];if(!V)throw T.b.Error(["No type found for variable",o]),new Error("Error parsing variables");if(o.value&&o.value.length!==V.length)throw T.b.Error(["Invalid value length for variable",o,V]),new Error("Error parsing variables");const g=o.value||[];if(!g.length)switch(V.flowGraphType){case"boolean":g.push(!1);break;case"FlowGraphInteger":g.push(0);break;case"number":g.push(NaN);break;case"Vector2":g.push(NaN,NaN);break;case"cv":g.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":g.fill(NaN,0,4);break;case"Matrix":g.fill(NaN,0,16);break;case"Matrix3D":g.fill(NaN,0,9)}return"number"===V.elementType&&"string"===typeof g[0]&&(g[0]=parseFloat(g[0])),{type:V.flowGraphType,value:v?v(g,this):g}}_parseEvents(){if(this._interactivityGraph.events)for(const o of this._interactivityGraph.events){const v={eventId:o.id||"internalEvent_"+this._internalEventsCounter++};o.values&&(v.eventData=Object.keys(o.values).map((v=>{var V;const g=null===(V=o.values)||void 0===V?void 0:V[v];if(!g)throw T.b.Error(["No value found for event key",v]),new Error("Error parsing events");const E=this._types[g.type];if(!E)throw T.b.Error(["No type found for event value",g]),new Error("Error parsing events");const I="undefined"!==typeof g.value?this._parseVariable(g):void 0;return{id:v,type:E.flowGraphType,eventData:!0,value:I}}))),this._events.push(v)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const v of this._interactivityGraph.nodes){if("number"!==typeof v.declaration)throw T.b.Error(["No declaration found for node",v]),new Error("Error parsing nodes");const V=this._mappings[v.declaration];if(!V)throw T.b.Error(["No mapping found for node",v]),new Error("Error parsing nodes");if(V.flowGraphMapping.validation){const g=V.flowGraphMapping.validation(v,this._interactivityGraph,this._gltf);var o;if(!g.valid)throw new Error(`Error validating interactivity node ${null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[v.declaration].op} - ${g.error}`)}const g=[];for(const o of V.flowGraphMapping.bh){const E=this._getEmptyBlock(o,V.fullOperationName);this._parseNodeConfiguration(v,E,V.flowGraphMapping,o),g.push(E)}this._nodes.push({bh:g,fullOperationName:V.fullOperationName})}}_getEmptyBlock(o,v){return{uniqueId:(0,PV.b)(),className:o,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:v,metadata:{}}}_parseNodeConfiguration(o,v,V,g){const E=v.config;if(o.configuration){const v=Object.keys(o.configuration);for(const U of v){var I,Q;const v=null===(I=o.configuration)||void 0===I?void 0:I[U];if(!v)throw T.b.Error(["No value found for node configuration",U]),new Error("Error parsing node configuration");const n=null===(Q=V.configuration)||void 0===Q?void 0:Q[U];if(n&&n.uV?n.uV===g:0===V.bh.indexOf(g)){const o=(null===n||void 0===n?void 0:n.name)||U;v&&"undefined"!==typeof v.value||"undefined"===typeof(null===n||void 0===n?void 0:n.defaultValue)?v.value.length>=0?E[o]={value:1===v.value.length?v.value[0]:v.value}:T.b.Warn(["Invalid value for node configuration",v]):E[o]={value:n.defaultValue},n&&n.dataTransformer&&(E[o].value=n.dataTransformer([E[o].value],this)[0])}}}}_parseNodeConnections(o){for(let b=0;b<this._nodes.length;b++){var v;const u=null===(v=this._interactivityGraph.nodes)||void 0===v?void 0:v[b];if(!u)throw T.b.Error(["No node found for interactivity node",this._nodes[b]]),new Error("Error parsing node connections");const mo=this._nodes[b],a=this._mappings[u.declaration];if(!a)throw T.b.Error(["No mapping found for node",u]),new Error("Error parsing node connections");const F=u.flows||{},i=Object.keys(F).sort();for(const o of i){var V,g,E,I;const v=F[o],O=null===(V=a.flowGraphMapping.outputs)||void 0===V||null===(g=V.flows)||void 0===g?void 0:g[o],h=(null===O||void 0===O?void 0:O.name)||o,x=this._createNewSocketConnection(h,!0);(O&&O.uV&&mo.bh.find((o=>o.className===O.uV))||mo.bh[0]).signalOutputs.push(x);const f=v.node,l=this._nodes[f];if(!l)throw T.b.Error(["No node found for input node id",f]),new Error("Error parsing node connections");const S=FV(l.fullOperationName);if(!S)throw T.b.Error(["No mapping found for input node",l]),new Error("Error parsing node connections");let c=null===(E=S.inputs)||void 0===E||null===(I=E.flows)||void 0===I?void 0:I[v.socket||"in"],R=!1;if(!c)for(const o in null===(Q=S.inputs)||void 0===Q?void 0:Q.flows){var Q,U,n;if(o.startsWith("[")&&o.endsWith("]"))R=!0,c=null===(U=S.inputs)||void 0===U||null===(n=U.flows)||void 0===n?void 0:n[o]}const j=c?R?c.name.replace("$1",v.socket||""):c.name:v.socket||"in",t=c&&c.uV&&l.bh.find((o=>o.className===c.uV))||l.bh[0];let s=t.signalInputs.find((o=>o.name===j));s||(s=this._createNewSocketConnection(j),t.signalInputs.push(s)),s.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(s.uniqueId)}const J=u.values||{},d=Object.keys(J);for(const v of d){var O,h;const V=J[v];let g=null===(O=a.flowGraphMapping.inputs)||void 0===O||null===(h=O.values)||void 0===h?void 0:h[v],E=!1;if(!g)for(const o in null===(x=a.flowGraphMapping.inputs)||void 0===x?void 0:x.values){var x,f,l;if(o.startsWith("[")&&o.endsWith("]"))E=!0,g=null===(f=a.flowGraphMapping.inputs)||void 0===f||null===(l=f.values)||void 0===l?void 0:l[o]}const I=g?E?g.name.replace("$1",v):g.name:v,Q=this._createNewSocketConnection(I);if((g&&g.uV&&mo.bh.find((o=>o.className===g.uV))||mo.bh[0]).dataInputs.push(Q),void 0!==V.value){const v=this._parseVariable(V,g&&g.dataTransformer);o._connectionValues[Q.uniqueId]=v}else{if("undefined"===typeof V.node)throw T.b.Error(["Invalid value for value connection",V]),new Error("Error parsing node connections");{var S,c,R;const o=V.node,v=V.socket||"value",g=this._nodes[o];if(!g)throw T.b.Error(["No node found for output socket reference",V]),new Error("Error parsing node connections");const E=FV(g.fullOperationName);if(!E)throw T.b.Error(["No mapping found for output socket reference",V]),new Error("Error parsing node connections");let I=null===(S=E.outputs)||void 0===S||null===(c=S.values)||void 0===c?void 0:c[v],U=!1;if(!I)for(const V in null===(j=E.outputs)||void 0===j?void 0:j.values){var j,t,s;if(V.startsWith("[")&&V.endsWith("]"))U=!0,I=null===(t=E.outputs)||void 0===t||null===(s=t.values)||void 0===s?void 0:s[V]}const n=I?U?I.name.replace("$1",v):null===(R=I)||void 0===R?void 0:R.name:v,O=I&&I.uV&&g.bh.find((o=>o.className===I.uV))||g.bh[0];let h=O.dataOutputs.find((o=>o.name===n));h||(h=this._createNewSocketConnection(n,!0),O.dataOutputs.push(h)),Q.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(Q.uniqueId)}}}if(a.flowGraphMapping.interBlockConnectors)for(const o of a.flowGraphMapping.interBlockConnectors){const v=o.input,V=o.output,g=o.isVariable;this._connectFlowGraphNodes(v,V,mo.bh[o.inputBlockIndex],mo.bh[o.outputBlockIndex],g)}if(a.flowGraphMapping.extraProcessor){var L;const v=null===(L=this._interactivityGraph.declarations)||void 0===L?void 0:L[u.declaration];if(!v)throw T.b.Error(["No declaration found for extra processor",u]),new Error("Error parsing node connections");mo.bh=a.flowGraphMapping.extraProcessor(u,v,a.flowGraphMapping,this,mo.bh,o,this._gltf)}}}_createNewSocketConnection(o,v){return{uniqueId:(0,PV.b)(),name:o,_connectionType:v?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(o,v,V,g,E){const I=E?V.dataInputs:V.signalInputs,Q=E?g.dataOutputs:g.signalOutputs,U=I.find((v=>v.name===o))||this._createNewSocketConnection(o),n=Q.find((o=>o.name===v))||this._createNewSocketConnection(v,!0);I.find((v=>v.name===o))||I.push(U),Q.find((o=>o.name===v))||Q.push(n),U.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(U.uniqueId)}getVariableName(o){return"staticVariable_"+o}serializeToFlowGraph(){const o={uniqueId:(0,PV.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(o);for(let v=0;v<this._staticVariables.length;v++){const V=this._staticVariables[v];o._userVariables[this.getVariableName(v)]=V}return{rightHanded:!0,allBlocks:this._nodes.reduce(((o,v)=>o.concat(v.bh)),[]),executionContexts:[o]}}}const wV="KHR_interactivity";class zV{constructor(o){this._loader=o,this.name=wV,this.enabled=this._loader.isExtensionUsed(wV),this._pathConverter=(0,z.j)(this._loader.Ng),o._skipStartAnimationStep=!0;const v=o.babylonScene;v&&function(o){(0,z.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!o.activeCamera)return new E.Quaternion(NaN,NaN,NaN,NaN);const v=E.Quaternion.FromRotationMatrix(o.activeCamera.getWorldMatrix()).normalize();return o.useRightHandedSystem||(v.w*=-1,v.x*=-1),v},type:"Quaternion",getTarget:()=>o.activeCamera}),(0,z.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!o.activeCamera)return new E.cv(NaN,NaN,NaN);const v=o.activeCamera.getWorldMatrix().getTranslation();return o.useRightHandedSystem||(v.x*=-1),v},type:"cv",getTarget:()=>o.activeCamera}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:o=>{var v;return(null===(v=o._babylonAnimationGroup)||void 0===v?void 0:v.isPlaying)??!1},type:"boolean",getTarget:o=>o._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:o=>{var v;return((null===(v=o._babylonAnimationGroup)||void 0===v?void 0:v.from)??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:o=>{var v;return((null===(v=o._babylonAnimationGroup)||void 0===v?void 0:v.to)??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:o=>{var v;return((null===(v=o._babylonAnimationGroup)||void 0===v?void 0:v.getCurrentFrame())??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:o=>{var v;return((null===(v=o._babylonAnimationGroup)||void 0===v?void 0:v.getCurrentFrame())??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup})}(v)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var o;if(!this._loader.babylonScene||!this._pathConverter)return;const v=this._loader.babylonScene,V=null===(o=this._loader.Ng.extensions)||void 0===o?void 0:o.KHR_interactivity;if(!V)return;const g=new TV.d({jv:v});g.dispatchEventsSynchronously=!1;const E=V.graphs.map((o=>new WV(o,this._loader.Ng,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(E.map((async o=>await uV(o,{coordinator:g,pathConverter:this._pathConverter})))),g.start()}}var yV;yV=async()=>(await Promise.resolve().then(V.bind(V,14291))).FlowGraphGLTFDataProvider,cV[`${wV}/${"FlowGraphGLTFDataProvider"}`]=yV,w(wV),W(wV,!0,(o=>new zV(o)));const HV="KHR_node_visibility";(0,z.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:o=>{const v=o._babylonTransformNode;return!v||void 0===v.isVisible||v.isVisible},set:(o,v)=>{var V,g;null===(V=v._primitiveBabylonMeshes)||void 0===V||V.forEach((o=>{o.inheritVisibility=!0})),v._babylonTransformNode&&(v._babylonTransformNode.isVisible=o),null===(g=v._primitiveBabylonMeshes)||void 0===g||g.forEach((v=>{v.isVisible=o}))},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class eV{constructor(o){this.name=HV,this._loader=o,this.enabled=o.isExtensionUsed(HV)}async onReady(){var o;null===(o=this._loader.Ng.nodes)||void 0===o||o.forEach((o=>{var v,V,g,E;(null===(v=o._primitiveBabylonMeshes)||void 0===v||v.forEach((o=>{o.inheritVisibility=!0})),null!==(V=o.extensions)&&void 0!==V&&V.KHR_node_visibility)&&(!1===(null===(g=o.extensions)||void 0===g?void 0:g.KHR_node_visibility.visible)&&(o._babylonTransformNode&&(o._babylonTransformNode.isVisible=!1),null===(E=o._primitiveBabylonMeshes)||void 0===E||E.forEach((o=>{o.isVisible=!1}))))}))}dispose(){this._loader=null}}w(HV),W(HV,!0,(o=>new eV(o)));const DV="KHR_node_selectability";JV("event/onSelect",DV,{bh:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",uV:"FlowGraphGetVariableBlock",dataTransformer:o=>["pickedMesh_"+o[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",uV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(o,v,V,g,E,I,Q){var U,n,O,h,x,f;const l=E[E.length-1];l.config=l.config||{},l.config.glTF=Q;const S=null===(U=o.configuration)||void 0===U||null===(n=U.nodeIndex)||void 0===n?void 0:n.value[0];if(void 0===S||"number"!==typeof S)throw new Error("nodeIndex not found in configuration");const T="pickedMesh_"+S;return E[1].config.variable=T,I._userVariables[T]={className:"Mesh",id:null===Q||void 0===Q||null===(O=Q.nodes)||void 0===O||null===(h=O[S]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===Q||void 0===Q||null===(x=Q.nodes)||void 0===x||null===(f=x[S]._babylonTransformNode)||void 0===f?void 0:f.uniqueId},E}}),(0,z.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:o=>{const v=o._babylonTransformNode;return!v||void 0===v.wn||v.wn},set:(o,v)=>{var V;null===(V=v._primitiveBabylonMeshes)||void 0===V||V.forEach((v=>{v.wn=o}))},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"wn"],type:"boolean"});class ZV{constructor(o){this.name=DV,this._loader=o,this.enabled=o.isExtensionUsed(DV)}async onReady(){var o;null===(o=this._loader.Ng.nodes)||void 0===o||o.forEach((o=>{var v,V,g;null!==(v=o.extensions)&&void 0!==v&&v.KHR_node_selectability&&!1===(null===(V=o.extensions)||void 0===V?void 0:V.KHR_node_selectability.selectable)&&(null===(g=o._babylonTransformNode)||void 0===g||g.getChildMeshes().forEach((o=>{o.wn=!1})))}))}dispose(){this._loader=null}}w(DV),W(DV,!0,(o=>new ZV(o)));const KV="KHR_node_hoverability",XV="targetMeshPointerOver_";JV("event/onHoverIn",KV,{bh:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",uV:"FlowGraphGetVariableBlock",dataTransformer:o=>[XV+o[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",uV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(o,v,V,g,E,I,Q){var U,n,O,h,x,f;const l=E[E.length-1];l.config=l.config||{},l.config.glTF=Q;const S=null===(U=o.configuration)||void 0===U||null===(n=U.nodeIndex)||void 0===n?void 0:n.value[0];if(void 0===S||"number"!==typeof S)throw new Error("nodeIndex not found in configuration");const T=XV+S;return E[1].config.variable=T,I._userVariables[T]={className:"Mesh",id:null===Q||void 0===Q||null===(O=Q.nodes)||void 0===O||null===(h=O[S]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===Q||void 0===Q||null===(x=Q.nodes)||void 0===x||null===(f=x[S]._babylonTransformNode)||void 0===f?void 0:f.uniqueId},E}});const rV="targetMeshPointerOut_";JV("event/onHoverOut",KV,{bh:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",uV:"FlowGraphGetVariableBlock",dataTransformer:o=>[rV+o[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",uV:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(o,v,V,g,E,I,Q){var U,n,O,h,x,f;const l=E[E.length-1];l.config=l.config||{},l.config.glTF=Q;const S=null===(U=o.configuration)||void 0===U||null===(n=U.nodeIndex)||void 0===n?void 0:n.value[0];if(void 0===S||"number"!==typeof S)throw new Error("nodeIndex not found in configuration");const T=rV+S;return E[1].config.variable=T,I._userVariables[T]={className:"Mesh",id:null===Q||void 0===Q||null===(O=Q.nodes)||void 0===O||null===(h=O[S]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===Q||void 0===Q||null===(x=Q.nodes)||void 0===x||null===(f=x[S]._babylonTransformNode)||void 0===f?void 0:f.uniqueId},E}}),(0,z.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:o=>{const v=o._babylonTransformNode;return!v||void 0===v.pointerOverDisableMeshTesting||v.pointerOverDisableMeshTesting},set:(o,v)=>{var V;null===(V=v._primitiveBabylonMeshes)||void 0===V||V.forEach((v=>{v.pointerOverDisableMeshTesting=!o}))},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class BV{constructor(o){this.name=KV,this._loader=o,this.enabled=o.isExtensionUsed(KV)}async onReady(){var o;null===(o=this._loader.Ng.nodes)||void 0===o||o.forEach((o=>{var v,V,g;null!==(v=o.extensions)&&void 0!==v&&v.KHR_node_hoverability&&!1===(null===(V=o.extensions)||void 0===V?void 0:V.KHR_node_hoverability.hoverable)&&(null===(g=o._babylonTransformNode)||void 0===g||g.getChildMeshes().forEach((o=>{o.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}w(KV),W(KV,!0,(o=>new BV(o)));const AV="ExtrasAsMetadata";class CV{_assignExtras(o,v){if(v.extras&&Object.keys(v.extras).length>0){const V=o.metadata=o.metadata||{};(V.Ng=V.Ng||{}).extras=v.extras}}constructor(o){this.name=AV,this.enabled=!0,this._loader=o}dispose(){this._loader=null}loadNodeAsync(o,v,V){return this._loader.loadNodeAsync(o,v,(o=>{this._assignExtras(o,v),V(o)}))}loadCameraAsync(o,v,V){return this._loader.loadCameraAsync(o,v,(o=>{this._assignExtras(o,v),V(o)}))}createMaterial(o,v,V){const g=this._loader.createMaterial(o,v,V);return this._assignExtras(g,v),g}}w(AV),W(AV,!1,(o=>new CV(o)));V(14291)},14175:(o,v,V)=>{"use strict";V.d(v,{c:()=>Y,f:()=>a,i:()=>mo,l:()=>F});var g=V(12297),E=V(12291),I=V(13819),Q=V(12958),U=V(12928),n=V(12936),O=V(12308),h=V(12339),x=V(12954),f=V(13049),l=V(12967),S=V(12538);class T{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Mf=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Ll=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(o){this._environmentTexture=o}getNodes(){let o=[];o=o.concat(this.meshes),o=o.concat(this.lights),o=o.concat(this.cameras),o=o.concat(this.transformNodes);for(const v of this.skeletons)o=o.concat(v.bones);return o}}class c extends T{}class R{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const o=this.rootNodes;for(const g of o)g.dispose();o.length=0;const v=this.skeletons;for(const g of v)g.dispose();v.length=0;const V=this.animationGroups;for(const g of V)g.dispose();V.length=0}}class j extends T{constructor(o){super(),this._wasAddedToScene=!1,(o=o||h.d.LastCreatedScene)&&(this.jv=o,this.proceduralTextures=[],o.Tg.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=o.getEngine().onContextRestoredObservable.add((()=>{for(const o of this.geometries)o._rebuild();for(const o of this.meshes)o._rebuild();for(const o of this.Mf)o.rebuild();for(const o of this.textures)o._rebuild()})))}_topologicalSort(o){const v=new Map;for(const Q of o)v.set(Q.uniqueId,Q);const V={dependsOn:new Map,dependedBy:new Map};for(const Q of o){const o=Q.uniqueId;V.dependsOn.set(o,new Set),V.dependedBy.set(o,new Set)}for(const Q of o){const o=Q.uniqueId,g=V.dependsOn.get(o);if(Q instanceof x.e){const E=Q.sourceMesh;v.has(E.uniqueId)&&(g.add(E.uniqueId),V.dependedBy.get(E.uniqueId).add(o))}const E=V.dependedBy.get(o);for(const I of Q.getDescendants()){const g=I.uniqueId;if(v.has(g)){E.add(g);V.dependsOn.get(g).add(o)}}}const g=[],E=[];for(const Q of o){const o=Q.uniqueId;0===V.dependsOn.get(o).size&&(E.push(Q),v.delete(o))}const I=E;for(;I.length>0;){const o=I.shift();g.push(o);const E=V.dependedBy.get(o.uniqueId);for(const g of Array.from(E.values())){const E=V.dependsOn.get(g);E.delete(o.uniqueId),0===E.size&&v.get(g)&&(I.push(v.get(g)),v.delete(g))}}return v.size>0&&(O.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),v.forEach((o=>{O.b.Error(o.name)}))),g}_addNodeAndDescendantsToList(o,v,V,g){if(V&&(!g||g(V))&&!v.has(V.uniqueId)){o.push(V),v.add(V.uniqueId);for(const E of V.getDescendants(!0))this._addNodeAndDescendantsToList(o,v,E,g)}}_isNodeInContainer(o){return o instanceof n.d&&-1!==this.meshes.indexOf(o)||(o instanceof U.b&&-1!==this.transformNodes.indexOf(o)||(o instanceof f.c&&-1!==this.lights.indexOf(o)||o instanceof l.e&&-1!==this.cameras.indexOf(o)))}_isValidHierarchy(){for(const o of this.meshes)if(o.parent&&!this._isNodeInContainer(o.parent))return O.b.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;for(const o of this.transformNodes)if(o.parent&&!this._isNodeInContainer(o.parent))return O.b.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;for(const o of this.lights)if(o.parent&&!this._isNodeInContainer(o.parent))return O.b.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;for(const o of this.cameras)if(o.parent&&!this._isNodeInContainer(o.parent))return O.b.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const g={},I={},U=new R,n=[],O=[],h={doNotInstantiate:!0,...V},x=[],f=new Set;for(const E of this.transformNodes)null===E.parent&&this._addNodeAndDescendantsToList(x,f,E,h.predicate);for(const E of this.meshes)null===E.parent&&this._addNodeAndDescendantsToList(x,f,E,h.predicate);const l=this._topologicalSort(x),S=(V,E)=>{if(((v,V)=>{if(g[v.uniqueId]=V.uniqueId,I[V.uniqueId]=V,o&&(V.name=o(v.name)),V instanceof Q.e){const o=V;if(o.morphTargetManager){const V=v.morphTargetManager;o.morphTargetManager=V.clone();for(let v=0;v<V.numTargets;v++){const E=V.getTarget(v),Q=o.morphTargetManager.getTarget(v);g[E.uniqueId]=Q.uniqueId,I[Q.uniqueId]=Q}}}})(V,E),V.parent){const o=g[V.parent.uniqueId],v=I[o];E.parent=v||V.parent}if(E.position&&V.position&&E.position.U(V.position),E.rotationQuaternion&&V.rotationQuaternion&&E.rotationQuaternion.U(V.rotationQuaternion),E.rotation&&V.rotation&&E.rotation.U(V.rotation),E.jU&&V.jU&&E.jU.U(V.jU),E.material){const Q=E;if(Q.material)if(v){const v=V.material;if(-1===O.indexOf(v)){let V=v.clone(o?o(v.name):"Clone of "+v.name);if(O.push(v),g[v.uniqueId]=V.uniqueId,I[V.uniqueId]=V,"MultiMaterial"===v.getClassName()){const E=v;for(const v of E.LU)v&&(V=v.clone(o?o(v.name):"Clone of "+v.name),O.push(v),g[v.uniqueId]=V.uniqueId,I[V.uniqueId]=V);E.LU=E.LU.map((o=>o&&I[g[o.uniqueId]]))}}"InstancedMesh"!==Q.getClassName()&&(Q.material=I[g[v.uniqueId]])}else"MultiMaterial"===Q.material.getClassName()?-1===this.jv.multiMaterials.indexOf(Q.material)&&this.jv.addMultiMaterial(Q.material):-1===this.jv.materials.indexOf(Q.material)&&this.jv.addMaterial(Q.material)}null===E.parent&&U.rootNodes.push(E)};for(const E of l)if("InstancedMesh"===E.getClassName()){const o=E,v=o.sourceMesh,V=g[v.uniqueId];S(o,("number"===typeof V?I[V]:v).createInstance(o.name))}else{let o=!0;"Qh"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?o=!1:h.doNotInstantiate&&(o="function"===typeof h.doNotInstantiate?!h.doNotInstantiate(E):!h.doNotInstantiate);const v=o?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!v)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);S(E,v)}for(const E of this.skeletons){if(h.predicate&&!h.predicate(E))continue;const v=E.clone(o?o(E.name):"Clone of "+E.name);for(const o of this.meshes)if(o.skeleton===E&&!o.isAnInstance){const V=I[g[o.uniqueId]];if(!V||V.isAnInstance)continue;if(V.skeleton=v,-1!==n.indexOf(v))continue;n.push(v);for(const o of v.bones)o._linkedTransformNode&&(o._linkedTransformNode=I[g[o._linkedTransformNode.uniqueId]])}U.skeletons.push(v)}for(const E of this.animationGroups){if(h.predicate&&!h.predicate(E))continue;const v=E.clone(o?o(E.name):"Clone of "+E.name,(o=>I[g[o.uniqueId]]||o));U.animationGroups.push(v)}return U}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.jv.environmentTexture=this.environmentTexture);for(const o of this.jv._serializableComponents)o.addFromContainer(this);this.jv.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=[];for(const V of this.cameras)o&&!o(V)||(this.jv.addCamera(V),v.push(V));for(const V of this.lights)o&&!o(V)||(this.jv.addLight(V),v.push(V));for(const V of this.meshes)o&&!o(V)||(this.jv.Vh(V),v.push(V));for(const V of this.skeletons)o&&!o(V)||this.jv.addSkeleton(V);for(const V of this.animations)o&&!o(V)||this.jv.addAnimation(V);for(const V of this.animationGroups)o&&!o(V)||this.jv.addAnimationGroup(V);for(const V of this.multiMaterials)o&&!o(V)||this.jv.addMultiMaterial(V);for(const V of this.materials)o&&!o(V)||this.jv.addMaterial(V);for(const V of this.morphTargetManagers)o&&!o(V)||this.jv.addMorphTargetManager(V);for(const V of this.geometries)o&&!o(V)||this.jv.addGeometry(V);for(const V of this.transformNodes)o&&!o(V)||(this.jv.addTransformNode(V),v.push(V));for(const V of this.actionManagers)o&&!o(V)||this.jv.addActionManager(V);for(const V of this.textures)o&&!o(V)||this.jv.addTexture(V);for(const V of this.reflectionProbes)o&&!o(V)||this.jv.addReflectionProbe(V);for(const V of v)V.parent&&-1===this.jv.getNodes().indexOf(V.parent)&&(V.setParent?V.setParent(null):V.parent=null)}removeAllFromScene(){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.jv.environmentTexture&&(this.jv.environmentTexture=null);for(const o of this.jv._serializableComponents)o.removeFromContainer(this)}removeFromScene(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const v of this.cameras)o&&!o(v)||this.jv.removeCamera(v);for(const v of this.lights)o&&!o(v)||this.jv.removeLight(v);for(const v of this.meshes)o&&!o(v)||this.jv.oh(v,!0);for(const v of this.skeletons)o&&!o(v)||this.jv.removeSkeleton(v);for(const v of this.animations)o&&!o(v)||this.jv.removeAnimation(v);for(const v of this.animationGroups)o&&!o(v)||this.jv.removeAnimationGroup(v);for(const v of this.multiMaterials)o&&!o(v)||this.jv.removeMultiMaterial(v);for(const v of this.materials)o&&!o(v)||this.jv.removeMaterial(v);for(const v of this.morphTargetManagers)o&&!o(v)||this.jv.removeMorphTargetManager(v);for(const v of this.geometries)o&&!o(v)||this.jv.removeGeometry(v);for(const v of this.transformNodes)o&&!o(v)||this.jv.removeTransformNode(v);for(const v of this.actionManagers)o&&!o(v)||this.jv.removeActionManager(v);for(const v of this.textures)o&&!o(v)||this.jv.removeTexture(v);for(const v of this.reflectionProbes)o&&!o(v)||this.jv.removeReflectionProbe(v)}dispose(){const o=this.cameras.slice(0);for(const l of o)l.dispose();this.cameras.length=0;const v=this.lights.slice(0);for(const l of v)l.dispose();this.lights.length=0;const V=this.meshes.slice(0);for(const l of V)l.dispose();this.meshes.length=0;const g=this.skeletons.slice(0);for(const l of g)l.dispose();this.skeletons.length=0;const E=this.animationGroups.slice(0);for(const l of E)l.dispose();this.animationGroups.length=0;const I=this.multiMaterials.slice(0);for(const l of I)l.dispose();this.multiMaterials.length=0;const Q=this.materials.slice(0);for(const l of Q)l.dispose();this.materials.length=0;const U=this.geometries.slice(0);for(const l of U)l.dispose();this.geometries.length=0;const n=this.transformNodes.slice(0);for(const l of n)l.dispose();this.transformNodes.length=0;const O=this.actionManagers.slice(0);for(const l of O)l.dispose();this.actionManagers.length=0;const h=this.textures.slice(0);for(const l of h)l.dispose();this.textures.length=0;const x=this.reflectionProbes.slice(0);for(const l of x)l.dispose();this.reflectionProbes.length=0;const f=this.morphTargetManagers.slice(0);for(const l of f)l.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const l of this.jv._serializableComponents)l.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.jv.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(o,v,V){if(o&&v)for(const g of o){let o=!0;if(V)for(const v of V)if(g===v){o=!1;break}o&&(v.push(g),g._parentContainer=this)}}moveAllFromScene(o){this._wasAddedToScene=!1,void 0===o&&(o=new c);for(const v in this)Object.prototype.hasOwnProperty.call(this,v)&&(this[v]=this[v]||("_environmentTexture"===v?null:[]),this._moveAssets(this.jv[v],this[v],o[v]));this.environmentTexture=this.jv.environmentTexture,this.removeAllFromScene()}createRootMesh(){const o=new Q.e("assetContainerRootMesh",this.jv);for(const v of this.meshes)v.parent||o.addChild(v);return this.meshes.unshift(o),o}mergeAnimationsTo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.d.LastCreatedScene,v=arguments.length>1?arguments[1]:void 0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!o)return O.b.Error("No scene available to merge animations to"),[];const g=V||(v=>{let V=null;const g=v.animations.length?v.animations[0].targetProperty:"",E=v.name.split(".").join("").split("_primitive")[0];switch(g){case"position":case"rotationQuaternion":V=o.getTransformNodeByName(v.name)||o.getTransformNodeByName(E);break;case"influence":V=o.getMorphTargetByName(v.name)||o.getMorphTargetByName(E);break;default:V=o.getNodeByName(v.name)||o.getNodeByName(E)}return V}),E=this.getNodes();for(const U of E){const o=g(U);if(null!==o){for(const v of U.animations){const V=o.animations.filter((o=>o.targetProperty===v.targetProperty));for(const v of V){const V=o.animations.indexOf(v,0);V>-1&&o.animations.splice(V,1)}}o.animations=o.animations.concat(U.animations)}}const I=[],Q=this.animationGroups.slice();for(const U of Q){I.push(U.clone(U.name,g));for(const o of U.animatables)o.stop()}for(const U of v){const v=g(U.target);v&&(o.beginAnimation(v,U.fromFrame,U.toFrame,U.loopAnimation,U.speedRatio,U.onAnimationEnd?U.onAnimationEnd:void 0,void 0,!0,void 0,U.onAnimationLoop?U.onAnimationLoop:void 0),o.stopAnimation(U.target))}return I}populateRootNodes(){this.rootNodes.length=0;for(const o of this.meshes)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o);for(const o of this.transformNodes)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o);for(const o of this.lights)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o);for(const o of this.cameras)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o)}addAllAssetsToContainer(o){if(!o)return;const v=[],V=new Set;for(v.push(o);v.length>0;){const o=v.pop();if(o instanceof Q.e?(o.kg&&-1===this.geometries.indexOf(o.kg)&&this.geometries.push(o.kg),this.meshes.push(o)):o instanceof x.e?this.meshes.push(o):o instanceof U.b?this.transformNodes.push(o):o instanceof f.c?this.lights.push(o):o instanceof l.e&&this.cameras.push(o),o instanceof n.d){if(o.material&&-1===this.materials.indexOf(o.material)){this.materials.push(o.material);for(const v of o.material.getActiveTextures())-1===this.textures.indexOf(v)&&this.textures.push(v)}o.skeleton&&-1===this.skeletons.indexOf(o.skeleton)&&this.skeletons.push(o.skeleton),o.morphTargetManager&&-1===this.morphTargetManagers.indexOf(o.morphTargetManager)&&this.morphTargetManagers.push(o.morphTargetManager)}for(const g of o.getChildren())V.has(g)||v.push(g);V.add(o)}this.populateRootNodes()}_getByTags(o,v,V){if(void 0===v)return o;const g=[];for(const E in o){const I=o[E];S.e&&S.e.MatchesQuery(I,v)&&(!V||V(I))&&g.push(I)}return g}getMeshesByTags(o,v){return this._getByTags(this.meshes,o,v)}getCamerasByTags(o,v){return this._getByTags(this.cameras,o,v)}getLightsByTags(o,v){return this._getByTags(this.lights,o,v)}getMaterialsByTags(o,v){return this._getByTags(this.materials,o,v).concat(this._getByTags(this.multiMaterials,o,v))}getTransformNodesByTags(o,v){return this._getByTags(this.transformNodes,o,v)}}var t=V(12358);class s{constructor(o){this.byteOffset=0,this.buffer=o}async loadAsync(o){const v=await this.buffer.readAsync(this.byteOffset,o);this._dataView=new DataView(v.buffer,v.byteOffset,v.byteLength),this._dataByteOffset=0}readUint32(){const o=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,o}readUint8Array(o){const v=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,o);return this._dataByteOffset+=o,this.byteOffset+=o,v}readString(o){return(0,t.f)(this.readUint8Array(o))}skipBytes(o){this._dataByteOffset+=o,this.byteOffset+=o}}var L=V(14177);const b="Z2xURg",u={name:"Ng",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:o=>-1!==o.indexOf("asset")&&-1!==o.indexOf("version")||o.startsWith("data:base64,"+b)||o.startsWith("data:;base64,"+b)||o.startsWith("data:application/octet-stream;base64,"+b)||o.startsWith("data:model/gltf-binary;base64,"+b)};var mo,a,F,i=V(12347),J=V(12354);function d(o,v,V){try{return Promise.resolve(new Uint8Array(o,v,V))}catch(g){return Promise.reject(g)}}!function(o){o[o.AUTO=0]="AUTO",o[o.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(mo||(mo={})),function(o){o[o.NONE=0]="NONE",o[o.FIRST=1]="FIRST",o[o.ALL=2]="ALL"}(a||(a={})),function(o){o[o.LOADING=0]="LOADING",o[o.READY=1]="READY",o[o.COMPLETE=2]="COMPLETE"}(F||(F={}));class N{constructor(){this.coordinateSystemMode=mo.AUTO,this.animationStartMode=a.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=o=>Promise.resolve(o),this.extensionOptions={}}U(o){o&&(this.onParsed=o.onParsed,this.coordinateSystemMode=o.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=o.animationStartMode??this.animationStartMode,this.loadNodeAnimations=o.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=o.loadSkins??this.loadSkins,this.loadMorphTargets=o.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=o.compileMaterials??this.compileMaterials,this.useClipPlane=o.useClipPlane??this.useClipPlane,this.compileShadowGenerators=o.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=o.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=o.useRangeRequests??this.useRangeRequests,this.createInstances=o.createInstances??this.createInstances,this.alwaysComputeBoundingBox=o.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=o.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=o.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=o.skipMaterials??this.skipMaterials,this.useSRGBBuffers=o.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=o.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=o.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=o.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=o.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=o.customRootNode,this.onMeshLoaded=o.onMeshLoaded,this.onSkinLoaded=o.onSkinLoaded,this.onTextureLoaded=o.onTextureLoaded,this.onMaterialLoaded=o.onMaterialLoaded,this.onCameraLoaded=o.onCameraLoaded,this.extensionOptions=o.extensionOptions??this.extensionOptions)}}class Y extends N{constructor(o){super(),this.onParsedObservable=new g.e,this.onMeshLoadedObservable=new g.e,this.onSkinLoadedObservable=new g.e,this.onTextureLoadedObservable=new g.e,this.onMaterialLoadedObservable=new g.e,this.onCameraLoadedObservable=new g.e,this.onCompleteObservable=new g.e,this.onErrorObservable=new g.e,this.Tg=new g.e,this.onExtensionLoadedObservable=new g.e,this.validate=!1,this.onValidatedObservable=new g.e,this._loader=null,this._state=null,this._requests=new Array,this.name=u.name,this.extensions=u.extensions,this.onLoaderStateChangedObservable=new g.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.U(o)}set onParsed(o){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),o&&(this._onParsedObserver=this.onParsedObservable.add(o))}set onMeshLoaded(o){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),o&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(o))}set onSkinLoaded(o){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),o&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((v=>o(v.node,v.skinnedNode))))}set onTextureLoaded(o){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),o&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(o))}set onMaterialLoaded(o){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),o&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(o))}set onCameraLoaded(o){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),o&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(o))}set onComplete(o){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(o)}set onError(o){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(o)}set onDispose(o){this._onDisposeObserver&&this.Tg.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tg.add(o)}set onExtensionLoaded(o){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(o)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(o){this._loggingEnabled!==o&&(this._loggingEnabled=o,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(o){this._capturePerformanceCounters!==o&&(this._capturePerformanceCounters=o,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(o){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(o)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const o of this._requests)o.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=o=>Promise.resolve(o),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Tg.notifyObservers(void 0),this.Tg.clear()}loadFile(o,v,V,I,Q,U,n,h){if(ArrayBuffer.isView(v))return this._loadBinary(o,v,V,I,n,h),null;this._progressCallback=Q;const x=v.name||E.Tools.GetFilename(v);if(U){if(this.useRangeRequests){this.validate&&O.b.Warn("glTF validation is not supported when range requests are enabled");const V={abort:()=>{},onCompleteObservable:new g.e},E={readAsync:(V,g)=>new Promise(((E,I)=>{this._loadFile(o,v,(o=>{E(new Uint8Array(o))}),!0,(o=>{I(o)}),(o=>{o.setRequestHeader("Range",`bytes=${V}-${V+g-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new s(E)).then((o=>{V.onCompleteObservable.notifyObservers(V),I(o)}),n?o=>n(void 0,o):void 0),V}return this._loadFile(o,v,(v=>{this._validate(o,new Uint8Array(v,0,v.byteLength),V,x),this._unpackBinaryAsync(new s({readAsync:(o,V)=>d(v,o,V),byteLength:v.byteLength})).then((o=>{I(o)}),n?o=>n(void 0,o):void 0)}),!0,n)}return this._loadFile(o,v,(v=>{try{this._validate(o,v,V,x),I({json:this._parseJson(v)})}catch{n&&n()}}),!1,n)}_loadBinary(o,v,V,g,E,I){this._validate(o,new Uint8Array(v.buffer,v.byteOffset,v.byteLength),V,I),this._unpackBinaryAsync(new s({readAsync:(o,V)=>function(o,v,V){try{if(v<0||v>=o.byteLength)throw new RangeError("Offset is out of range.");if(v+V>o.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(o.buffer,o.byteOffset+v,V))}catch(g){return Promise.reject(g)}}(v,o,V),byteLength:v.byteLength})).then((o=>{g(o)}),E?o=>E(void 0,o):void 0)}importMeshAsync(o,v,V,g,E,I){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(V),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(V),this._loader.importMeshAsync(o,v,null,V,g,E,I))))}loadAsync(o,v,V,g,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(v),this._loader.loadAsync(o,v,V,g,E))))}loadAssetContainerAsync(o,v,V,g,E){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(v);const I=new j(o),Q=[];this.onMaterialLoadedObservable.add((o=>{Q.push(o)}));const U=[];this.onTextureLoadedObservable.add((o=>{U.push(o)}));const n=[];this.onCameraLoadedObservable.add((o=>{n.push(o)}));const O=[];return this.onMeshLoadedObservable.add((o=>{o.morphTargetManager&&O.push(o.morphTargetManager)})),this._loader.importMeshAsync(null,o,I,v,V,g,E).then((o=>(Array.prototype.push.apply(I.geometries,o.geometries),Array.prototype.push.apply(I.meshes,o.meshes),Array.prototype.push.apply(I.Mf,o.Mf),Array.prototype.push.apply(I.skeletons,o.skeletons),Array.prototype.push.apply(I.animationGroups,o.animationGroups),Array.prototype.push.apply(I.materials,Q),Array.prototype.push.apply(I.textures,U),Array.prototype.push.apply(I.lights,o.lights),Array.prototype.push.apply(I.transformNodes,o.transformNodes),Array.prototype.push.apply(I.cameras,n),Array.prototype.push.apply(I.morphTargetManagers,O),I)))}))}canDirectLoad(o){return u.canDirectLoad(o)}directLoad(o,v){if(v.startsWith("base64,"+b)||v.startsWith(";base64,"+b)||v.startsWith("application/octet-stream;base64,"+b)||v.startsWith("model/gltf-binary;base64,"+b)){const V=(0,i.d)(v);return this._validate(o,new Uint8Array(V,0,V.byteLength)),this._unpackBinaryAsync(new s({readAsync:(o,v)=>d(V,o,v),byteLength:V.byteLength}))}return this._validate(o,v),Promise.resolve({json:this._parseJson(v)})}createPlugin(o){return new Y(o[u.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((o,v)=>{this.onCompleteObservable.addOnce((()=>{o()})),this.onErrorObservable.addOnce((o=>{v(o)}))}))}_setState(o){this._state!==o&&(this._state=o,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(F[this._state]))}_loadFile(o,v,V,g,E,I){const Q=o._loadFile(v,V,(o=>{this._onProgress(o,Q)}),!0,g,E,I);return Q.onCompleteObservable.add((()=>{Q._lengthComputable=!0,Q._total=Q._loaded})),this._requests.push(Q),Q}_onProgress(o,v){if(!this._progressCallback)return;v._lengthComputable=o.lengthComputable,v._loaded=o.loaded,v._total=o.total;let V=!0,g=0,E=0;for(const I of this._requests){if(void 0===I._lengthComputable||void 0===I._loaded||void 0===I._total)return;V=V&&I._lengthComputable,g+=I._loaded,E+=I._total}this._progressCallback({lengthComputable:V,loaded:g,total:V?E:0})}_validate(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),L.c.ValidateAsync(v,V,g,(v=>this.preprocessUrlAsync(V+v).then((v=>o._loadFileAsync(v,void 0,!0,!0).then((o=>new Uint8Array(o,0,o.byteLength))))))).then((o=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(o),this.onValidatedObservable.clear()}),(o=>{this._endPerformanceCounter("Validate JSON"),E.Tools.Warn(`Failed to validate: ${o.message}`),this.onValidatedObservable.clear()})))}_getLoader(o){const v=o.json.asset||{};this._log(`Asset version: ${v.version}`),v.minVersion&&this._log(`Asset minimum version: ${v.minVersion}`),v.generator&&this._log(`Asset generator: ${v.generator}`);const V=Y._parseVersion(v.version);if(!V)throw new Error("Invalid version: "+v.version);if(void 0!==v.minVersion){const o=Y._parseVersion(v.minVersion);if(!o)throw new Error("Invalid minimum version: "+v.minVersion);if(Y._compareVersion(o,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+v.minVersion)}const g={1:Y._CreateGLTF1Loader,2:Y._CreateGLTF2Loader}[V.major];if(!g)throw new Error("Unsupported version: "+v.version);return g(this)}_parseJson(o){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${o.length}`);const v=JSON.parse(o);return this._endPerformanceCounter("Parse JSON"),v}_unpackBinaryAsync(o){return this._startPerformanceCounter("Unpack Binary"),o.loadAsync(20).then((()=>{const v=o.readUint32();if(1179937895!==v)throw new J.i("Unexpected magic: "+v,J.f.GLTFLoaderUnexpectedMagicError);const V=o.readUint32();this.loggingEnabled&&this._log(`Binary version: ${V}`);const g=o.readUint32();let E;switch(this.useRangeRequests||g===o.buffer.byteLength||O.b.Warn(`Length in header does not match actual data length: ${g} != ${o.buffer.byteLength}`),V){case 1:E=this._unpackBinaryV1Async(o,g);break;case 2:E=this._unpackBinaryV2Async(o,g);break;default:throw new Error("Unsupported version: "+V)}return this._endPerformanceCounter("Unpack Binary"),E}))}_unpackBinaryV1Async(o,v){const V=o.readUint32(),g=o.readUint32();if(0!==g)throw new Error(`Unexpected content format: ${g}`);const E=v-o.byteOffset,I={json:this._parseJson(o.readString(V)),bin:null};if(0!==E){const v=o.byteOffset;I.bin={readAsync:(V,g)=>o.buffer.readAsync(v+V,g),byteLength:E}}return Promise.resolve(I)}_unpackBinaryV2Async(o,v){const V=1313821514,g=5130562,E=o.readUint32();if(o.readUint32()!==V)throw new Error("First chunk format is not JSON");return o.byteOffset+E===v?o.loadAsync(E).then((()=>({json:this._parseJson(o.readString(E)),bin:null}))):o.loadAsync(E+8).then((()=>{const I={json:this._parseJson(o.readString(E)),bin:null},Q=()=>{const E=o.readUint32();switch(o.readUint32()){case V:throw new Error("Unexpected JSON chunk");case g:{const v=o.byteOffset;I.bin={readAsync:(V,g)=>o.buffer.readAsync(v+V,g),byteLength:E},o.skipBytes(E);break}default:o.skipBytes(E)}return o.byteOffset!==v?o.loadAsync(8).then(Q):Promise.resolve(I)};return Q()}))}static _parseVersion(o){if("1.0"===o||"1.0.1"===o)return{major:1,minor:0};const v=(o+"").match(/^(\d+)\.(\d+)/);return v?{major:parseInt(v[1]),minor:parseInt(v[2])}:null}static _compareVersion(o,v){return o.major>v.major?1:o.major<v.major?-1:o.minor>v.minor?1:o.minor<v.minor?-1:0}_logOpen(o){this._log(o),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(o){const v=Y._logSpaces.substring(0,2*this._logIndentLevel);O.b.Log(`${v}${o}`)}_logDisabled(o){}_startPerformanceCounterEnabled(o){E.Tools.StartPerformanceCounter(o)}_startPerformanceCounterDisabled(o){}_endPerformanceCounterEnabled(o){E.Tools.EndPerformanceCounter(o)}_endPerformanceCounterDisabled(o){}}Y.IncrementalLoading=!0,Y.HomogeneousCoordinates=!1,Y._logSpaces="                                ",(0,I.c)(new Y)},14177:(o,v,V)=>{"use strict";V.d(v,{c:()=>Q});var g=V(12291);function E(o,v,V,g){const E={externalResourceFunction:g};return V&&(E.uri="file:"===v?V:v+V),ArrayBuffer.isView(o)?GLTFValidator.validateBytes(o,E):GLTFValidator.validateString(o,E)}function I(){const o=[];onmessage=v=>{const V=v.data;switch(V.id){case"init":importScripts(V.url);break;case"validate":E(V.data,V.rootUrl,V.fileName,(v=>new Promise(((V,g)=>{const E=o.length;o.push({resolve:V,reject:g}),postMessage({id:"getExternalResource",index:E,uri:v})})))).then((o=>{postMessage({id:"validate.resolve",value:o})}),(o=>{postMessage({id:"validate.reject",reason:o})}));break;case"getExternalResource.resolve":o[V.index].resolve(V.value);break;case"getExternalResource.reject":o[V.index].reject(V.reason)}}}class Q{static ValidateAsync(o,v,V,Q){return"function"===typeof Worker?new Promise(((U,n)=>{const O=`${E}(${I})()`,h=URL.createObjectURL(new Blob([O],{type:"application/javascript"})),x=new Worker(h),f=o=>{x.removeEventListener("error",f),x.removeEventListener("message",l),n(o)},l=o=>{const v=o.data;switch(v.id){case"getExternalResource":Q(v.uri).then((o=>{x.postMessage({id:"getExternalResource.resolve",index:v.index,value:o},[o.buffer])}),(o=>{x.postMessage({id:"getExternalResource.reject",index:v.index,reason:o})}));break;case"validate.resolve":x.removeEventListener("error",f),x.removeEventListener("message",l),U(v.value),x.terminate();break;case"validate.reject":x.removeEventListener("error",f),x.removeEventListener("message",l),n(v.reason),x.terminate()}};if(x.addEventListener("error",f),x.addEventListener("message",l),x.postMessage({id:"init",url:g.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(o)){const g=o.slice();x.postMessage({id:"validate",data:g,rootUrl:v,fileName:V},[g.buffer])}else x.postMessage({id:"validate",data:o,rootUrl:v,fileName:V})})):(this._LoadScriptPromise||(this._LoadScriptPromise=g.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>E(o,v,V,Q))))}}Q.Configuration={url:`${g.Tools._DefaultCdnUrl}/gltf_validator.js`}},14721:(o,v,V)=>{"use strict";V.d(v,{b:()=>u});var g=V(12473),E=V(12479),I=V(12535),Q=V(12488),U=V(12892),n=V(12825),O=V(12577),h=V(12747),x=V(12449),f=V(12396);V(13963),V(13851),V(13873),V(13856),V(13875),V(13878),V(13884);const l="imageProcessingCompatibility",S="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";f.b.IncludesShadersStore[l]||(f.b.IncludesShadersStore[l]=S);const T="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";f.b.ShadersStore[T]||(f.b.ShadersStore[T]=c);V(13970),V(13888),V(13897),V(13915),V(13906);const R="skyVertexShader",j="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";f.b.ShadersStore[R]||(f.b.ShadersStore[R]=j);var t=V(12817),s=V(12884),L=V(12878);class b extends U.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class u extends n.c{constructor(o,v){super(o,v),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Q.cv(0,100,0),this.useSunPosition=!1,this.cameraOffset=Q.cv.Zero(),this.up=Q.cv.Up(),this.dithering=!1,this._cameraPosition=Q.cv.Zero(),this._skyOrientation=new Q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(o,v){const V=v._drawWrapper;if(this.isFrozen&&V.effect&&V._wasPreviouslyReady)return!0;v.materialDefines||(v.materialDefines=new b);const g=v.materialDefines,E=this.Fo();if(this._isReadyForSubMesh(v))return!0;if((0,L.U)(o,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,g),(0,L.I)(o,g,!0,!1),g.IMAGEPROCESSINGPOSTPROCESS!==E.imageProcessingConfiguration.applyByPostProcess&&g.markAsMiscDirty(),g.DITHER!==this.dithering&&g.markAsMiscDirty(),g.isDirty){g.markAsProcessed(),E.resetCachedMaterial();const o=new t.d;g.FOG&&o.addFallback(1,"FOG"),g.IMAGEPROCESSINGPOSTPROCESS=E.imageProcessingConfiguration.applyByPostProcess,g.DITHER=this.dithering;const V=[O.e.PositionKind];g.VERTEXCOLOR&&V.push(O.e.ColorKind);const I="sky",Q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.b)(Q);const U=g.toString();v.setEffect(E.getEngine().createEffect(I,V,Q,[],U,o,this.onCompiled,this.onError),g,this._materialContext)}return!(!v.effect||!v.effect.isReady())&&(g._renderId=E.getRenderId(),V._wasPreviouslyReady=!0,!0)}bindForSubMesh(o,v,V){const g=this.Fo(),E=V.materialDefines;if(!E)return;const I=V.effect;if(!I)return;this._activeEffect=I,this.bindOnlyWorldMatrix(o),this._activeEffect.setMatrix("viewProjection",g.getTransformMatrix()),this._mustRebind(g,I,V)&&((0,s.c)(I,this,g),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,L.j)(E,I,g)),g.fogEnabled&&v.applyFog&&g.fogMode!==h.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",g.getViewMatrix()),(0,L.e)(g,v,this._activeEffect);const U=g.activeCamera;if(U){const o=U.getWorldMatrix();this._cameraPosition.x=o.m[12],this._cameraPosition.y=o.m[13],this._cameraPosition.z=o.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const o=Math.PI*(this.inclination-.5),v=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(v)*Math.cos(o),this.sunPosition.y=this.distance*Math.sin(-o),this.sunPosition.z=this.distance*Math.sin(v)*Math.cos(o),Q.Quaternion.FromUnitVectorsToRef(Q.cv.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(v,this._activeEffect,V)}getAnimatables(){return[]}dispose(o){super.dispose(o)}clone(o){return I.c.Clone((()=>new u(o,this.Fo())),this)}serialize(){const o=super.serialize();return o.customType="BABYLON.SkyMaterial",o}getClassName(){return"SkyMaterial"}static Parse(o,v,V){return I.c.Parse((()=>new u(o.name,v)),o,v,V)}}(0,g.c)([(0,E.K)()],u.prototype,"luminance",void 0),(0,g.c)([(0,E.K)()],u.prototype,"turbidity",void 0),(0,g.c)([(0,E.K)()],u.prototype,"rayleigh",void 0),(0,g.c)([(0,E.K)()],u.prototype,"mieCoefficient",void 0),(0,g.c)([(0,E.K)()],u.prototype,"mieDirectionalG",void 0),(0,g.c)([(0,E.K)()],u.prototype,"distance",void 0),(0,g.c)([(0,E.K)()],u.prototype,"inclination",void 0),(0,g.c)([(0,E.K)()],u.prototype,"azimuth",void 0),(0,g.c)([(0,E.G)()],u.prototype,"sunPosition",void 0),(0,g.c)([(0,E.K)()],u.prototype,"useSunPosition",void 0),(0,g.c)([(0,E.G)()],u.prototype,"cameraOffset",void 0),(0,g.c)([(0,E.G)()],u.prototype,"up",void 0),(0,g.c)([(0,E.K)()],u.prototype,"dithering",void 0),(0,x.h)("BABYLON.SkyMaterial",u)},13211:(o,v,V)=>{"use strict";function g(o,v){v.headers=o.headers||{},v.statusMessage=o.statusText,v.statusCode=o.status,v.data=o.response}function E(o,v,V){return new Promise((function(E,I){V=V||{};var Q,U,n,O=new XMLHttpRequest,h=V.body,x=V.headers||{};for(Q in V.timeout&&(O.timeout=V.timeout),O.ontimeout=O.onerror=function(o){o.timeout="timeout"==o.type,I(o)},O.open(o,v.href||v),O.onload=function(){for(n=O.getAllResponseHeaders().trim().split(/[\r\n]+/),g(O,O);U=n.shift();)U=U.split(": "),O.headers[U.shift().toLowerCase()]=U.join(": ");if((U=O.headers["content-type"])&&~U.indexOf("application/json"))try{O.data=JSON.parse(O.data,V.reviver)}catch(o){return g(O,o),I(o)}(O.status>=400?I:E)(O)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(x["content-type"]="application/json",h=JSON.stringify(h)),O.withCredentials=!!V.withCredentials,x)O.setRequestHeader(Q,x[Q]);O.send(h)}))}V.r(v),V.d(v,{del:()=>n,get:()=>I,patch:()=>U,post:()=>Q,put:()=>O,send:()=>E});var I=E.bind(E,"GET"),Q=E.bind(E,"POST"),U=E.bind(E,"PATCH"),n=E.bind(E,"DELETE"),O=E.bind(E,"PUT")},14831:(o,v,V)=>{"use strict";V.d(v,{e:()=>x});const g=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,I=1/3,Q=1/6,U=(Math.sqrt(5)-1)/4,n=(5-Math.sqrt(5))/20,O=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),h=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const x=class{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const v="function"==typeof o?o:function(o){let v=0,V=0,g=0,E=1;const I=function(){let o=4022871197;return function(v){v=v.toString();for(let V=0;V<v.length;V++){o+=v.charCodeAt(V);let g=.02519603282416938*o;o=g>>>0,g-=o,g*=o,o=g>>>0,g-=o,o+=4294967296*g}return 2.3283064365386963e-10*(o>>>0)}}();v=I(" "),V=I(" "),g=I(" "),v-=I(o),v<0&&(v+=1);V-=I(o),V<0&&(V+=1);g-=I(o),g<0&&(g+=1);return function(){const o=2091639*v+2.3283064365386963e-10*E;return v=V,V=g,g=o-(E=0|o)}}(o);this.p=function(o){const v=new Uint8Array(256);for(let V=0;V<256;V++)v[V]=V;for(let V=0;V<255;V++){const g=V+~~(o()*(256-V)),E=v[V];v[V]=v[g],v[g]=E}return v}(v),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let V=0;V<512;V++)this.perm[V]=this.p[255&V],this.permMod12[V]=this.perm[V]%12}noise2D(o,v){const V=this.permMod12,I=this.perm;let Q=0,U=0,n=0;const h=(o+v)*g,x=Math.floor(o+h),f=Math.floor(v+h),l=(x+f)*E,S=o-(x-l),T=v-(f-l);let c,R;S>T?(c=1,R=0):(c=0,R=1);const j=S-c+E,t=T-R+E,s=S-1+2*E,L=T-1+2*E,b=255&x,u=255&f;let mo=.5-S*S-T*T;if(mo>=0){const o=3*V[b+I[u]];mo*=mo,Q=mo*mo*(O[o]*S+O[o+1]*T)}let a=.5-j*j-t*t;if(a>=0){const o=3*V[b+c+I[u+R]];a*=a,U=a*a*(O[o]*j+O[o+1]*t)}let F=.5-s*s-L*L;if(F>=0){const o=3*V[b+1+I[u+1]];F*=F,n=F*F*(O[o]*s+O[o+1]*L)}return 70*(Q+U+n)}noise3D(o,v,V){const g=this.permMod12,E=this.perm;let U,n,h,x;const f=(o+v+V)*I,l=Math.floor(o+f),S=Math.floor(v+f),T=Math.floor(V+f),c=(l+S+T)*Q,R=o-(l-c),j=v-(S-c),t=V-(T-c);let s,L,b,u,mo,a;R>=j?j>=t?(s=1,L=0,b=0,u=1,mo=1,a=0):R>=t?(s=1,L=0,b=0,u=1,mo=0,a=1):(s=0,L=0,b=1,u=1,mo=0,a=1):j<t?(s=0,L=0,b=1,u=0,mo=1,a=1):R<t?(s=0,L=1,b=0,u=0,mo=1,a=1):(s=0,L=1,b=0,u=1,mo=1,a=0);const F=R-s+Q,i=j-L+Q,J=t-b+Q,d=R-u+2*Q,N=j-mo+2*Q,Y=t-a+2*Q,q=R-1+.5,P=j-1+.5,M=t-1+.5,W=255&l,w=255&S,z=255&T;let y=.6-R*R-j*j-t*t;if(y<0)U=0;else{const o=3*g[W+E[w+E[z]]];y*=y,U=y*y*(O[o]*R+O[o+1]*j+O[o+2]*t)}let H=.6-F*F-i*i-J*J;if(H<0)n=0;else{const o=3*g[W+s+E[w+L+E[z+b]]];H*=H,n=H*H*(O[o]*F+O[o+1]*i+O[o+2]*J)}let e=.6-d*d-N*N-Y*Y;if(e<0)h=0;else{const o=3*g[W+u+E[w+mo+E[z+a]]];e*=e,h=e*e*(O[o]*d+O[o+1]*N+O[o+2]*Y)}let D=.6-q*q-P*P-M*M;if(D<0)x=0;else{const o=3*g[W+1+E[w+1+E[z+1]]];D*=D,x=D*D*(O[o]*q+O[o+1]*P+O[o+2]*M)}return 32*(U+n+h+x)}noise4D(o,v,V,g){const E=this.perm;let I,Q,O,x,f;const l=(o+v+V+g)*U,S=Math.floor(o+l),T=Math.floor(v+l),c=Math.floor(V+l),R=Math.floor(g+l),j=(S+T+c+R)*n,t=o-(S-j),s=v-(T-j),L=V-(c-j),b=g-(R-j);let u=0,mo=0,a=0,F=0;t>s?u++:mo++,t>L?u++:a++,t>b?u++:F++,s>L?mo++:a++,s>b?mo++:F++,L>b?a++:F++;const i=u>=3?1:0,J=mo>=3?1:0,d=a>=3?1:0,N=F>=3?1:0,Y=u>=2?1:0,q=mo>=2?1:0,P=a>=2?1:0,M=F>=2?1:0,W=u>=1?1:0,w=mo>=1?1:0,z=a>=1?1:0,y=F>=1?1:0,H=t-i+n,e=s-J+n,D=L-d+n,Z=b-N+n,K=t-Y+2*n,X=s-q+2*n,r=L-P+2*n,B=b-M+2*n,A=t-W+3*n,C=s-w+3*n,p=L-z+3*n,G=b-y+3*n,k=t-1+4*n,oo=s-1+4*n,vo=L-1+4*n,Vo=b-1+4*n,go=255&S,Eo=255&T,Io=255&c,Qo=255&R;let Uo=.6-t*t-s*s-L*L-b*b;if(Uo<0)I=0;else{const o=E[go+E[Eo+E[Io+E[Qo]]]]%32*4;Uo*=Uo,I=Uo*Uo*(h[o]*t+h[o+1]*s+h[o+2]*L+h[o+3]*b)}let no=.6-H*H-e*e-D*D-Z*Z;if(no<0)Q=0;else{const o=E[go+i+E[Eo+J+E[Io+d+E[Qo+N]]]]%32*4;no*=no,Q=no*no*(h[o]*H+h[o+1]*e+h[o+2]*D+h[o+3]*Z)}let Oo=.6-K*K-X*X-r*r-B*B;if(Oo<0)O=0;else{const o=E[go+Y+E[Eo+q+E[Io+P+E[Qo+M]]]]%32*4;Oo*=Oo,O=Oo*Oo*(h[o]*K+h[o+1]*X+h[o+2]*r+h[o+3]*B)}let ho=.6-A*A-C*C-p*p-G*G;if(ho<0)x=0;else{const o=E[go+W+E[Eo+w+E[Io+z+E[Qo+y]]]]%32*4;ho*=ho,x=ho*ho*(h[o]*A+h[o+1]*C+h[o+2]*p+h[o+3]*G)}let xo=.6-k*k-oo*oo-vo*vo-Vo*Vo;if(xo<0)f=0;else{const o=E[go+1+E[Eo+1+E[Io+1+E[Qo+1]]]]%32*4;xo*=xo,f=xo*xo*(h[o]*k+h[o+1]*oo+h[o+2]*vo+h[o+3]*Vo)}return 27*(I+Q+O+x+f)}}}}]);